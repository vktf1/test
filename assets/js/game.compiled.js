'use strict';(function(){function b(a,b,c,d){a=((c.x-a.x)*(b.x-a.x)+(c.y-a.y)*(b.y-a.y))/e.squareDistance(a,b);return d?a:a.limit(0,1)}function a(a){this.message=a}function d(a){for(var b=0;b<a.length;b++){var c=a[b].string,d=a[b].prop;ig._search=a[b].versionSearch||a[b].identity;if(c){if(-1!=c.indexOf(a[b].subString))return a[b].identity}else if(d)return a[b].identity}}function c(a){var b=a.indexOf(ig._search);if(-1!=b)return parseFloat(a.substring(b+ig._search.length+1))}Number.prototype.map=function(a,
b,c,d){return b==a?d:c+(d-c)*((this-a)/(b-a))};Number.prototype.limit=function(a,b){return Math.min(b,Math.max(a,this))};Number.prototype.round=function(a){a=Math.pow(10,a||0);return Math.round(this*a)/a};Number.prototype.floor=function(){return Math.floor(this)};Number.prototype.ceil=function(){return Math.ceil(this)};Number.prototype.toInt=function(){return this|0};Array.prototype.erase=function(a){for(var b=this.length;b--;)this[b]===a&&this.splice(b,1);return this};Array.prototype.last=function(){return this[this.length-
1]};Array.prototype.intersect=function(a){for(var b=this.length;b--;)if(-1!=a.indexOf(this[b]))return!0;return!1};Array.prototype.random=function(){return this[Math.floor(Math.random()*this.length)]};String.prototype.toPath=function(a,b){return a+this.replace(/[.]/g,"/")+b};String.prototype.toDir=function(a){return a+this.substr(0,this.lastIndexOf(".")).replace(/[.]/g,"/")};String.prototype.toKey=function(a,b){return this.substring(a.length,this.length-b.length).replace(/\//g,".")};String.prototype.toCamel=
function(){return this.replace(/(\-[a-z])/g,function(a){return a.toUpperCase().replace("-","")})};String.prototype.startsWith=function(a){return this.slice(0,a.length)==a};Function.prototype.bind||(Function.prototype.bind=function(a){var b=this;return function(){var c=Array.prototype.slice.call(arguments);return b.apply(a||null,c)}});var e={};window.Vec2=e;e.create=function(a){var b={};b.x=a&&a.x||0;b.y=a&&a.y||0;return b};e.createC=function(a,b){var c={};c.x=a||0;c.y=b||0;return c};e.assign=function(a,
b){a.x=b.x||0;a.y=b.y||0;return a};e.assignC=function(a,b,c){a.x=b||0;a.y=c||0;return a};e.add=function(a,b,c){c=c||a;c.x=(a.x||0)+(b.x||0);c.y=(a.y||0)+(b.y||0);return c};e.addMulF=function(a,b,c,d){d=d||a;d.x=(a.x||0)+(b.x||0)*c;d.y=(a.y||0)+(b.y||0)*c;return d};e.addC=function(a,b,c,d){d=d||a;d.x=(a.x||0)+(b||0);d.y=(a.y||0)+((c===void 0||c===null?b:c)||0);return d};e.sub=function(a,b,c){c=c||a;c.x=(a.x||0)-(b.x||0);c.y=(a.y||0)-(b.y||0);return c};e.subC=function(a,b,c,d){d=d||a;d.x=(a.x||0)-(b||
0);d.y=(a.y||0)-((c===void 0||c===null?b:c)||0);return d};e.mul=function(a,b,c){c=c||a;c.x=(a.x||0)*(b.x||0);c.y=(a.y||0)*(b.y||0);return c};e.mulC=function(a,b,c,d){d=d||a;d.x=(a.x||0)*(b||0);d.y=(a.y||0)*((c===void 0||c===null?b:c)||0);return d};e.mulF=function(a,b,c){c=c||a;c.x=(a.x||0)*(b||0);c.y=(a.y||0)*(b||0);return c};e.div=function(a,b,c){c=c||a;c.x=(a.x||0)/(b.x||0);c.y=(a.y||0)/(b.y||0);return c};e.divC=function(a,b,c,d){d=d||a;d.x=(a.x||0)/(b||0);d.y=(a.y||0)/((c===void 0||c===null?b:
c)||0);return d};e.dot=function(a,b){return(a.x||0)*(b.x||0)+(a.y||0)*(b.y||0)};e.dotR=function(a,b){return-(a.y||0)*(b.x||0)+(a.x||0)*(b.y||0)};e.length=function(a,b,c){var d=Math.sqrt((a.x||0)*(a.x||0)+(a.y||0)*(a.y||0));return b!==void 0?e.mulC(a,d?b/d:1,null,c):d};e.limit=function(a,b,c,d){var f=e.length(a);return f>c?e.mulC(a,c/f,null,d):f<b?e.mulC(a,b/f,null,d):d?e.assign(d,a):a};e.normalize=function(a,b){return e.length(a,1,b)};e.clockangle=function(a){var b=Math.acos(-(a.y||0)/e.length(a));
a.x<0&&(b=2*Math.PI-b);return b||0};e.angle=function(a,b){return Math.acos((e.dot(a,b)/(e.length(a)*e.length(b))).limit(-1,1))||0};var f=e.create();e.create();e.angle3Point=function(a,b,c){b=e.sub(b,a,f);a=e.sub(c,a,f);return e.angle(b,a)};e.areClockwise=function(a,b){return a.y*b.x-a.x*b.y<=0};e.isAngleInRange=function(a,b,c,d){var f=Math.PI*2,c=(c%f+f)%f,d=(d%f+f)%f,g=e.angle(b,a);e.areClockwise(b,a)||(g=f-g);return c<d?c<=g&&g<=d:g<=d||g>=c};e.rotate=function(a,b,c){var c=c||a,d=a.x||0;c.x=Math.cos(b)*
d+Math.sin(b)*(a.y||0);c.y=Math.sin(-b)*d+Math.cos(b)*(a.y||0);return c};e.rotate90CW=function(a,b){var c=b||a,d=a.x||0;c.x=a.y||0;c.y=-d;return c};e.rotate90CCW=function(a,b){var c=b||a,d=a.x||0;c.x=-(a.y||0);c.y=d;return c};e.flip=function(a,b){var c=b||a;c.x=-a.x;c.y=-a.y;return c};e.rotateToward=function(a,b,c){if(e.isZero(b))return true;var d=e.dotR(a,b);if(d==0&&e.dot(a,b)>0)return true;e.rotate(a,d>0?-c:c);c=e.dotR(a,b);if(d!=0&&d*c<=0){e.assign(a,b);return true}return false};e.equal=function(a,
b){return a.x==b.x&&a.y==b.y};e.epsilonEquals=function(a,b,c){return Math.abs(b.x-a.x)>c||Math.abs(b.y-a.y)>c?false:true};e.distance=function(a,b){var c=a.x-b.x||0,d=a.y-b.y||0;return Math.sqrt(c*c+d*d)};e.lengthVec=function(a){return Math.sqrt(a.x*a.x+a.y*a.y)};e.distanceC=function(a,b,c,d){a=a-c||0;b=b-d||0;return Math.sqrt(a*a+b*b)};e.squareDistance=function(a,b){var c=a.x-b.x||0,d=a.y-b.y||0;return c*c+d*d};e.lerp=function(a,b,c,d){d=d||a;d.x=(a.x||0)*(1-c)+(b.x||0)*c;d.y=(a.y||0)*(1-c)+(b.y||
0)*c;return d};e.isZero=function(a){return a.x==0&&a.y==0};e.min=function(a,b,c){c=c||a;c.x=Math.min(a.x,b.x);c.y=Math.min(a.y,b.y);return c};e.minC=function(a,b,c,d){d=d||a;d.x=Math.min(a.x,b);d.y=Math.min(a.y,c);return d};e.max=function(a,b,c){c=c||a;c.x=Math.max(a.x,b.x);c.y=Math.max(a.y,b.y);return c};e.maxC=function(a,b,c,d){d=d||a;d.x=Math.max(a.x,b);d.y=Math.max(a.y,c);return d};e.print=function(a,b){return"Vec2[x: "+(a||0)+", y: "+(b||0)+"]"};e.round=function(a,b){var c=e.length(a),d=a.x>=
0?1:-1,g=a.y>=0?1:-1;f.x=d;f.y=0;if(e.angle(a,f)<b){a.y=0;e.length(a,c);return a}f.x=0;f.y=g;if(e.angle(a,f)<b){a.x=0;e.length(a,c);return a}f.x=d;f.y=g;if(e.angle(a,f)<b){e.assign(a,f);e.length(a,c)}return a};var g={};window.Vec3=g;g.create=function(a){var b={};b.x=a&&a.x||0;b.y=a&&a.y||0;b.z=a&&a.z||0;return b};g.createC=function(a,b,c){var d={};d.x=a||0;d.y=b||0;d.z=c||0;return d};g.assign=function(a,b){a.x=b.x||0;a.y=b.y||0;a.z=b.z||0;return a};g.assignC=function(a,b,c,d){a.x=b||0;a.y=c||0;a.z=
d||0;return a};g.add=function(a,b,c){c=c||a;c.x=(a.x||0)+(b.x||0);c.y=(a.y||0)+(b.y||0);c.z=(a.z||0)+(b.z||0);return c};g.addMulF=function(a,b,c,d){d=d||a;d.x=(a.x||0)+(b.x||0)*c;d.y=(a.y||0)+(b.y||0)*c;d.z=(a.z||0)+(b.z||0)*c;return d};g.addC=function(a,b,c,d,e){e=e||a;c=c===void 0||c===null?b:c;e.x=(a.x||0)+(b||0);e.y=(a.y||0)+(c||0);e.z=(a.z||0)+((d===void 0||d===null?c:d)||0);return e};g.sub=function(a,b,c){c=c||a;c.x=(a.x||0)-(b.x||0);c.y=(a.y||0)-(b.y||0);c.z=(a.z||0)-(b.z||0);return c};g.subC=
function(a,b,c,d,e){e=e||a;c=c===void 0||c===null?b:c;e.x=(a.x||0)-(b||0);e.y=(a.y||0)-(c||0);e.z=(a.z||0)-((d===void 0||d===null?c:d)||0);return e};g.mul=function(a,b,c){c=c||a;c.x=(a.x||0)*(b.x||0);c.y=(a.y||0)*(b.y||0);c.z=(a.z||0)*(b.z||0);return c};g.mulC=function(a,b,c,d,e){e=e||a;c=c===void 0||c===null?b:c;e.x=(a.x||0)*(b||0);e.y=(a.y||0)*(c||0);e.z=(a.z||0)*((d===void 0||d===null?c:d)||0);return e};g.mulF=function(a,b,c){c=c||a;c.x=(a.x||0)*(b||0);c.y=(a.y||0)*(b||0);c.z=(a.z||0)*(b||0);return c};
g.div=function(a,b,c){c=c||a;c.x=(a.x||0)/(b.x||0);c.y=(a.y||0)/(b.y||0);c.y=(a.z||0)/(b.z||0);return c};g.divC=function(a,b,c,d,e){e=e||a;c=c===void 0||c===null?b:c;e.x=(a.x||0)/(b||0);e.y=(a.y||0)/(c||0);e.z=(a.z||0)/((d===void 0||d===null?c:d)||0);return e};g.dot=function(a,b){return(a.x||0)*(b.x||0)+(a.y||0)*(b.y||0)+(a.z||0)*(b.z||0)};g.length=function(a,b,c){var d=Math.sqrt((a.x||0)*(a.x||0)+(a.y||0)*(a.y||0)+(a.z||0)*(a.z||0));return b!==void 0?g.mulC(a,d?b/d:1,null,c):d};g.normalize=function(a,
b){return g.length(a,1,b)};g.flip=function(a,b){var c=b||a;c.x=-a.x;c.y=-a.y;c.z=-a.z;return c};g.equal=function(a,b){return a.x==b.x&&a.y==b.y&&a.z==b.z};g.distance=function(a,b){var c=a.x-b.x||0,d=a.y-b.y||0,e=a.z-b.z||0;return Math.sqrt(c*c+d*d+e*e)};g.lerp=function(a,b,c,d){d=d||a;d.x=(a.x||0)*(1-c)+(b.x||0)*c;d.y=(a.y||0)*(1-c)+(b.y||0)*c;d.z=(a.z||0)*(1-c)+(b.z||0)*c;return d};g.clockangle=function(a){var b=Math.acos(-((a.y||0)-(a.z||0))/e.length(a));a.x<0&&(b=2*Math.PI-b);return b||0};g.print=
function(a,b,c){return"Vec3[x: "+(a||0)+", y: "+(b||0)+", z:"+(c||0)+"]"};g.isZero=function(a){return a.x==0&&a.y==0&&a.z==0};var h={};window.Line2=h;var i=e.create();h.distanceLineToPoint=function(a,c,d){var f=b(a,c,d);i.x=a.x+f*(c.x-a.x);i.y=a.y+f*(c.y-a.y);return e.distance(i,d)};h.distanceLineToLine=function(a,b,c,d){var e=h.distanceLineToPoint(a,b,c),e=Math.min(e,h.distanceLineToPoint(a,b,d)),e=Math.min(e,h.distanceLineToPoint(c,d,a));return e=Math.min(e,h.distanceLineToPoint(c,d,b))};h.closestPoint=
function(a,c,d,e,f){e=b(c,d,e,f);return h.getWeightPoint(a,c,d,e)};h.pointOnLineWeight=function(a,c,d,e){return b(a,c,d,e)};h.getWeightPoint=function(a,b,c,d){a.x=b.x+d*(c.x-b.x);a.y=b.y+d*(c.y-b.y);return a};var j=0,k=0;h.intersect=function(a,b,c,d,e){k=j=NaN;var f=(d.y-c.y)*(b.x-a.x)-(d.x-c.x)*(b.y-a.y);if(!f)return false;d=j=((d.x-c.x)*(a.y-c.y)-(d.y-c.y)*(a.x-c.x))/f;c=k=((b.x-a.x)*(a.y-c.y)-(b.y-a.y)*(a.x-c.x))/f;if(d<0||d>1||c<0||c>1)return false;if(e){c=j;e.x=a.x+c*(b.x-a.x);e.y=a.y+c*(b.y-
a.y)}return true};h.intersectRayWeight=function(a,b,c,d){k=j=NaN;b=d.y*b.x-d.x*b.y;if(!b)return false;return j=(d.x*(a.y-c.y)-d.y*(a.x-c.x))/b};h.intersectMinRange=function(a,b,c,d,f,g,i){if(!h.intersect(a,b,c,d,g))return false;a=f*0.5/e.distance(a,b);b=j;return b<a&&(!i||i[0])||b>1-a&&(!i||i[1])?false:true};h.horizontal=function(a,b){return a.y==b.y};h.vertical=function(a,b){return a.x==b.x};var l=e.create(),o=e.create();h.closestEntry=function(a,c,d,f,g,i,m,n,w,x){e.assign(l,c);e.mulF(l,g);l.y=
l.y+f;e.assign(o,d);e.mulF(o,g);o.y=o.y+f;c=e.distance(l,o);d=w;w*2>c&&(d=c/2);if(d<n)return false;w=void 0;h.intersect(l,o,i,m);i=j;isNaN(i)||k<0?i=b(l,o,m):i>=0&&i<=1&&(w=0);d=d/c;if(x){x.finalWeight=i;x.closeToEdge=i<n/c||i>1-n/c}i=i.limit(d,1-d);a.x=l.x+i*(o.x-l.x);a.y=l.y+i*(o.y-l.y);w===void 0&&(w=e.distance(a,m));return w};window.KeySpline=function(a,b,c,d){this.get=function(e){if(a==b&&c==d)return e;a:{for(var f=e,g=0;g<4;++g){var h=3*(1-3*c+3*a)*f*f+2*(3*c-6*a)*f+3*a;if(h==0){e=f;break a}f=
f-((((1-3*c+3*a)*f+(3*c-6*a))*f+3*a)*f-e)/h}e=f}return(((1-3*d+3*b)*e+(3*d-6*b))*e+3*b)*e}};window.KEY_SPLINES={EASE_IN_OUT:new window.KeySpline(0.42,0,0.58,1),EASE_OUT:new window.KeySpline(0,0,0.58,1),EASE_IN:new window.KeySpline(0.42,0,1,1),EASE:new window.KeySpline(0.25,0.1,0.25,1),EASE_SOUND:new window.KeySpline(0.5,0,0,1),LINEAR:new window.KeySpline(0,0,1,1),JUMPY:new window.KeySpline(0.31,1.51,0.53,0.94),EASE_OUT_STRONG:new window.KeySpline(0,0.5,0.58,1),EASE_IN_STRONG:new window.KeySpline(0.5,
0,0.95,0.56),LINEAR_EASE_OUT:new window.KeySpline(0.88,1,0.85,0.98),LINEAR_EASE_IN_OUT:new window.KeySpline(0.2,0,0.8,1)};a.prototype.toString=function(){return"AssertException: "+this.message};window.assert=function(b,c){if(!b)throw new a(c);};window.assertContent=function(a){for(var b=1;b<arguments.length;b++){var c=arguments[b];assert(a[c]!=void 0,"Value of '"+c+"' is undefined")}};var m=[];window.ig={game:null,debug:null,version:"1.18a",currentLang:"en_US",global:window,modules:{},resources:[],
ready:!1,loading:!1,baked:!1,nocache:"",ua:{},root:window.IG_ROOT||"",lib:window.IG_ROOT||"",_current:null,_loadQueue:[],_waitForOnload:0,$:function(a){return a.charAt(0)=="#"?document.getElementById(a.substr(1)):document.getElementsByTagName(a)},$new:function(a){return document.createElement(a)},equal:function(a,b){if(a==b)return true;if(a instanceof ig.Class||b instanceof ig.Class)return false;try{return JSON.stringify(a)==JSON.stringify(b)}catch(c){return false}},copy:function(a){if(!a||typeof a!=
"object"||a instanceof HTMLElement||a instanceof ig.Class)return a;if(a instanceof Array)for(var b=[],c=0,d=a.length;c<d;c++)b[c]=ig.copy(a[c]);else{b={};for(c in a)b[c]=ig.copy(a[c])}return b},merge:function(a,b,c){for(var d in b){var e=b[d];if(!e||typeof e!="object"||e instanceof HTMLElement||e instanceof ig.Class||c&&e instanceof Array)a[d]=e;else{if(!a[d]||typeof a[d]!="object")a[d]=e instanceof Array?[]:{};ig.merge(a[d],e)}}return a},ksort:function(a){if(!a||typeof a!="object")return[];var b=
[],c=[],d;for(d in a)b.push(d);b.sort();for(d=0;d<b.length;d++)c.push(a[b[d]]);return c},module:function(a){if(ig._current)throw"Module '"+ig._current.name+"' defines nothing";if(ig.modules[a]&&ig.modules[a].body)throw"Module '"+a+"' is already defined";ig._current={name:a,requires:[],loaded:false,body:null};ig.modules[a]=ig._current;ig._loadQueue.push(ig._current);ig._initDOMReady();return ig},requires:function(){ig._current.requires=Array.prototype.slice.call(arguments);return ig},defines:function(a){name=
ig._current.name;ig._current.body=a;ig._current=null;ig._execModules()},addResource:function(a){ig.resources.push(a)},getCacheSuffix:function(){return ig.nocache?"?nocache="+ig.nocache:""},addGameAddon:function(a){m.push(a)},initGameAddons:function(){for(var a=[],b=0;b<m.length;++b)a.push(m[b]());return a},show:function(){},mark:function(){},_loadScript:function(a,b){ig.modules[a]={name:a,requires:[],loaded:false,body:null};ig._waitForOnload++;var c=ig.lib+a.replace(/\./g,"/")+".js"+ig.getCacheSuffix(),
d=ig.$new("script");d.type="text/javascript";d.src=c;d.onload=function(){ig._waitForOnload--;ig._execModules()};d.onerror=function(){throw"Failed to load module "+a+" at "+c+" required from "+b;};ig.$("head")[0].appendChild(d)},_execModules:function(){for(var a=false,b=0;b<ig._loadQueue.length;b++){for(var c=ig._loadQueue[b],d=true,e=0;e<c.requires.length;e++){var f=c.requires[e];if(ig.modules[f])ig.modules[f].loaded||(d=false);else{d=false;ig._loadScript(f,c.name)}}if(d&&c.body){ig._loadQueue.splice(b,
1);c.loaded=true;c.body();a=true;b--}}if(a)ig._execModules();else if(!ig.baked&&ig._waitForOnload==0&&ig._loadQueue.length!=0){a=[];for(b=0;b<ig._loadQueue.length;b++){d=[];f=ig._loadQueue[b].requires;for(e=0;e<f.length;e++){c=ig.modules[f[e]];(!c||!c.loaded)&&d.push(f[e])}a.push(ig._loadQueue[b].name+" (requires: "+d.join(", ")+")")}throw"Unresolved (circular?) dependencies. Most likely there's a name/path mismatch for one of the listed modules:\n"+a.join("\n");}},_DOMReady:function(){if(!ig.modules["dom.ready"].loaded){if(!document.body)return setTimeout(ig._DOMReady,
13);ig.modules["dom.ready"].loaded=true;ig._waitForOnload--;ig._execModules()}return 0},_boot:function(){ig.nocache=window.IG_GAME_CACHE;ig.ua.pixelRatio=window.devicePixelRatio||1;ig.ua.viewport={width:window.innerWidth,height:window.innerHeight};ig.ua.screen={width:window.screen.availWidth*ig.ua.pixelRatio,height:window.screen.availHeight*ig.ua.pixelRatio};ig.ua.iPhone=/iPhone/i.test(navigator.userAgent);ig.ua.iPhone4=ig.ua.iPhone&&ig.ua.pixelRatio==2;ig.ua.iPad=/iPad/i.test(navigator.userAgent);
ig.ua.android=/android/i.test(navigator.userAgent);ig.ua.iOS=ig.ua.iPhone||ig.ua.iPad;ig.ua.mobile=ig.ua.iOS||ig.ua.android},_initDOMReady:function(){if(!ig.modules["dom.ready"]){ig._boot();ig.modules["dom.ready"]={requires:[],loaded:false,body:null};ig._waitForOnload++;if(document.readyState==="complete")ig._DOMReady();else{document.addEventListener("DOMContentLoaded",ig._DOMReady,false);window.addEventListener("load",ig._DOMReady,false)}}}};window.ig=window.ig;ig.ENTITY={};var n=!1,p=/xyz/.test(function(a){return a})?
/\bparent\b/:/.*/,r=0;window.ig.Class=function(){};var t=function(a){var b=this.prototype,c={},d;for(d in a)if(typeof a[d]=="function"&&typeof b[d]=="function"&&p.test(a[d])){c[d]=b[d];b[d]=function(a,b){return function(){var d=this.parent;this.parent=c[a];var e=b.apply(this,arguments);this.parent=d;return e}}(d,a[d])}else b[d]=a[d]};window.ig.Class.extend=function(a){function b(){if(!n){if(this.staticInstantiate){var a=this.staticInstantiate.apply(this,arguments);if(a)return a}for(var c in this)typeof this[c]==
"object"?this[c]=ig.copy(this[c]):typeof this[c]!="function"&&(this[c]=this[c]);this.init&&this.init.apply(this,arguments)}return this}var c=this.prototype;n=true;var d=new this;n=false;for(var e in a)d[e]=typeof a[e]=="function"&&typeof c[e]=="function"&&p.test(a[e])?function(a,b){return function(){var d=this.parent;this.parent=c[a];var e=b.apply(this,arguments);this.parent=d;return e}}(e,a[e]):a[e];b.prototype=d;b.prototype.constructor=b;b.extend=window.ig.Class.extend;b.inject=t;b.classId=d.classId=
++r;return b};window.ig.langFileList=[];window.ig.log=function(){};window.ig.blog=function(a){return a+": Thehe!"};window.ig.debug=function(){};window.ig.warn=function(){};window.ig.info=function(){};window.ig.LANG_CONTEXT={};window.ig.perf={update:!0,deferredUpdate:!0,draw:!0,drawSprites:!0,spriteFilter:!0,spriteShadow:!0,spriteOverlapSolver:!0,smoothMapRendering:!0,showImageAtlas:!1,showHitBoxes:!1};window.ig.profile={moveEntity:0,traceEntity:0,updateEntity:0};window.console&&(window.console.error&&
window.console.error.bind)&&(ig.error=window.console.error.bind(window.console));ig.Config=ig.Class.extend({_data:null,init:function(a){for(var b in a)this[b]=a[b];this._data=a},copy:function(){return new ig.Config(this._data)}});ig.PLATFORM_TYPES={UNKNOWN:0,DESKTOP:1,BROWSER:2,MOBILE:3,WIIU:4};ig.isPlatform=function(a){return ig.platform==ig.PLATFORM_TYPES[a]};ig.dataBrowser=[{string:navigator.userAgent,subString:"Nintendo WiiU",identity:"WiiU"},{string:navigator.userAgent,subString:"Chrome",identity:"Chrome"},
{string:navigator.userAgent,subString:"OmniWeb",versionSearch:"OmniWeb/",identity:"OmniWeb"},{string:navigator.vendor,subString:"Apple",identity:"Safari",versionSearch:"Version"},{prop:window.opera,identity:"Opera",versionSearch:"Version"},{string:navigator.vendor,subString:"iCab",identity:"iCab"},{string:navigator.vendor,subString:"KDE",identity:"Konqueror"},{string:navigator.userAgent,subString:"Firefox",identity:"Firefox"},{string:navigator.vendor,subString:"Camino",identity:"Camino"},{string:navigator.userAgent,
subString:"Netscape",identity:"Netscape"},{string:navigator.userAgent,subString:"MSIE",identity:"Explorer",versionSearch:"MSIE"},{string:navigator.userAgent,subString:"Trident",identity:"Explorer",versionSearch:"rv"},{string:navigator.userAgent,subString:"Gecko",identity:"Mozilla",versionSearch:"rv"},{string:navigator.userAgent,subString:"Mozilla",identity:"Netscape",versionSearch:"Mozilla"}];ig.dataOS=[{string:navigator.platform,subString:"Win",identity:"Windows"},{string:navigator.platform,subString:"Mac",
identity:"Mac"},{string:navigator.userAgent,subString:"iPhone",identity:"iOS"},{string:navigator.userAgent&&navigator.userAgent.toLowerCase(),subString:"android",identity:"Android"},{string:navigator.platform,subString:"Linux",identity:"Linux"}];ig.browser="Netscape";ig.browserVersion="1.0-6458b";ig.OS="WinME";ig.platform="C64";ig._search="";ig.getPlatformName=function(){switch(ig.platform){case ig.PLATFORM_TYPES.UNKNOWN:return"Unknown";case ig.PLATFORM_TYPES.DESKTOP:return"Desktop";case ig.PLATFORM_TYPES.BROWSER:return"Browser";
case ig.PLATFORM_TYPES.MOBILE:return"Mobile";case ig.PLATFORM_TYPES.WIIU:return"WiiU"}return"Say Wat?"};ig.browser=d(ig.dataBrowser)||"Unknown";ig.browserVersion=c(navigator.userAgent)||c(navigator.appVersion)||"Unknown";ig.OS=d(ig.dataOS)||"Unknown";ig.platform=window.require&&"object"==typeof window.process?ig.PLATFORM_TYPES.DESKTOP:window.nwf?ig.PLATFORM_TYPES.WIIU:"Android"==ig.dataOS||"iOS"==ig.dataOS?ig.PLATFORM_TYPES.MOBILE:"Unknown"!=ig.browser?ig.PLATFORM_TYPES.BROWSER:ig.PLATFORM_TYPES.UNKNOWN;
ig.nwjsVersion=null;ig.nwjs64=!1;if(ig.platform==ig.PLATFORM_TYPES.DESKTOP){var q=ig,s=window.process.versions["node-webkit"].match(/(\d+)\.(\d+)\.(\d+)/);q.nwjsVersion=[s[0],1E4*s[1]+100*s[2]+1*s[3],1*s[1],1*s[2],1*s[3]];ig.nwjs64="x64"==window.process.arch}ig.engineVersion=0.5;ig.engineName="Cubic Impact ("+ig.engineVersion+")";ig.baked=!0;ig.module("impact.base.worker").defines(function(){ig.Worker=ig.Class.extend({lastId:0,runningTasks:{},worker:null,key:null,init:function(a,b){this.key=b;if(window.Worker){this.worker=
new window.Worker(ig.root+a);this.worker.onmessage=this._onMessage.bind(this)}else{var c=ig.$new("script");c.type="text/javascript";c.src=ig.root+a;ig.$("head")[0].appendChild(c)}},doTask:function(a,b,c){if(this.worker){b._id=this.lastId;b._type=a;this.lastId++;this.runningTasks[b._id]={hint:b.hint,callback:c};this.worker.postMessage(b)}else{a=WORKER[this.key][a](b);a.hint=b.hint;c(a)}},_onMessage:function(a){var b=a.data._id;delete a.data._id;if(this.runningTasks[b]){a.data.hint=this.runningTasks[b].hint;
this.runningTasks[b].callback(a.data);delete this.runningTasks[b]}}})});ig.baked=!0;ig.module("impact.base.loader").defines(function(){function a(c,d,e){if(!c||typeof c!="object")return c;if(c.jsonINSTANCE)return b(c,d,e);if(c instanceof Array)for(var f=c.length;f--;){var g=a(c[f],d,e);if(c[f]!=g&&g instanceof Array&&c[f].jsonList){g.splice(0,0,f,1);c.splice.apply(c,g)}else c[f]=g}else for(f in c)c[f]=a(c[f],d,e);return c}function b(a,d,e){var f=a.jsonINSTANCE,g=e[f]||d[f];if(!g)throw Error("Could not find template '"+
f+"'");return c(g,a,d,e)}function c(d,e,f,g){if(!d||typeof d!="object")return d;if(d.jsonINSTANCE){d=ig.copy(d);return b(d,f,g)}if(d.jsonPARAM){f=e[d.jsonPARAM];if(f==void 0)if(d["default"]!==void 0)f=d["default"];else throw Error("Could not find template parameters '"+d.jsonPARAM+"' ");return a(f)}var h;if(d instanceof Array){h=[];for(var i=0;i<d.length;++i){var j=d[i];if(j.jsonIF){if(e[j.jsonIF]===void 0)continue;if(j.jsonTHEN)j=j.jsonTHEN;else{j=ig.copy(j);delete j.jsonIF}}j=c(j,e,f,g);j instanceof
Array&&d[i].jsonList?h.push.apply(h,j):h.push(j)}}else{h={};for(i in d){j=d[i];if(j.jsonIF){if(e[j.jsonIF]===void 0)continue;if(j.jsonTHEN)j=j.jsonTHEN;else{j=ig.copy(j);delete j.jsonIF}}h[i]=c(j,e,f,g)}}return h}ig.cacheList={};var d=false;ig.cleanCache=function(a){if(a)ig.nocache=ig.nocache?ig.nocache+1:1;d=true;for(var b in ig.cacheList){var c=ig.cacheList[b],e;for(e in c){var f=c[e];if(f&&f.referenceCount==0){f.emptyMapChangeCount++;if(a||f.emptyMapChangeCount>5){f.onCacheCleared&&f.onCacheCleared();
c[e]=null}}}}d=false};ig.reloadCache=function(){for(var a in ig.cacheList){var b=ig.cacheList[a],c;for(c in b){var d=b[c];d&&d.loaded&&d.reload()}}};ig.fileForwarding={};ig.getFilePath=function(a){a&&(a=a.trim());return ig.fileForwarding[a]?ig.fileForwarding[a]:a};ig.Cacheable=ig.Class.extend({cacheType:null,cacheKey:null,referenceCount:0,emptyMapChangeCount:0,staticInstantiate:function(){if(!this.constructor.cache){this.constructor.cache={};var a=this.constructor.prototype.cacheType;if(!a)throw Error("ig.Cacheable without CacheType!");
if(ig.cacheList[a]!=void 0)throw Error("Duplicated cacheType: "+a);ig.cacheList[a]=this.constructor.cache}if(a=this.cacheKey=this.getCacheKey.apply(this,arguments))if(a=this.constructor.cache[a]){a.onInstanceReused&&a.onInstanceReused();a.increaseRef();return a}return null},init:function(){this.cacheKey&&(this.constructor.cache[this.cacheKey]=this);this.increaseRef()},increaseRef:function(){this.referenceCount++;if(this.cacheKey)this.emptyMapChangeCount=0},decreaseRef:function(){this.referenceCount--;
if(this.referenceCount<0)throw Error("Call to decreaseRef() results in negative count! Key: '"+this.cacheKey+"'");if(this.referenceCount==0&&(!this.cacheKey||d)){this.onCacheCleared&&this.onCacheCleared();this.cacheKey&&(this.constructor.cache[this.cacheKey]=null)}},getCacheKey:null,onCacheCleared:null});ig.Loadable=ig.Cacheable.extend({loaded:false,failed:false,path:"",tolerateMissingResources:false,loadListeners:[],loadCollectors:[],init:function(a){this.parent();if(typeof a=="string"){this.path=
a;ig.addResourceToCollectors(this);ig.ready?this.load():ig.addResource(this)}else{this.path="[INLINE DATA]";this.loaded=true}},reload:function(){if(this.debugReload){if(this.onCacheCleared)this.onCacheCleared();this.loaded=false;ig.ready?this.load():ig.addResource(this)}},onInstanceReused:function(){this.loaded||ig.addResourceToCollectors(this)},getCacheKey:function(a){return typeof a=="string"?a:null},load:function(a){if(this.loaded)a&&a(this.cacheType,this.path,true);else{this.loadCallback=a||null;
this.loadInternal(this.path)}},loadingFinished:function(a){a?this.loaded=true:this.failed=true;if(this.loadListeners.length>0)for(var b=this.loadListeners.length;b--;)this.loadListeners[b].onLoadableComplete(this.loaded,this);this.loadListeners.length=0;ig.setResourceLoadedToCollectors(this);if(this.loadCallback){this.loadCallback(this.cacheType,this.path,a);this.loadCallback=null}},addLoadListener:function(a){if(this.loaded)a.onLoadableComplete(true,this);else this.loadListeners.push(a)}});ig.JsonLoadable=
ig.Loadable.extend({init:function(a){this.parent(a);if(typeof a=="object")this.onload(a)},loadInternal:function(){$.ajax({dataType:"json",url:ig.getFilePath(this.getJsonPath()),context:this,success:this.onJsonLoaded.bind(this),error:this.onJsonError.bind(this)})},onJsonLoaded:function(a){a=ig.jsonTemplate.resolve(a);if(!a)throw Error("Json file of path '"+this.path+"' is null. Maybe the original JSON had a syntax error and was compressed incorrectly?");ig.activateCollectors(this);this.onload(a);ig.removeCollectors(this);
this.loadingFinished(true)},onJsonError:function(){this.onerror&&this.onerror();this.loadingFinished(false)}});ig.SingleLoadable=ig.Class.extend({loaded:false,failed:false,path:"NO_PATCH",staticInstantiate:function(){return this.constructor.instance||null},init:function(){this.constructor.instance=this;ig.ready?this.load():ig.addResource(this)},load:function(a){if(this.loaded)a&&a(this.cacheType,this.path,true);else{this.loadCallback=a||null;this.loadInternal()}},loadingFinished:function(a){a?this.loaded=
true:this.failed=true;this.loadCallback&&this.loadCallback(this.cacheType,this.path,a)}});ig.Loader=ig.Class.extend({resources:[],prevResourcesCnt:0,status:0,done:false,lastPath:"",gameObjectCreated:false,_unloaded:[],_drawStatus:0,_intervalId:0,_loadCallbackBound:null,_loadIndex:0,_nextStepFunction:null,init:function(a){this.gameClass=a||null;this.resources=ig.resources;this._loadCallbackBound=this._loadCallback.bind(this)},load:function(){ig.ready=false;ig.loading=true;this.done=false;this._drawStatus=
this.status=0;if(this.resources.length){for(var a=0;a<this.resources.length;a++)this._unloaded.push(this.resources[a].cacheType+this.resources[a].path);this._loadIndex=this.resources.length;for(a=0;a<this.resources.length;a++)this.loadResource(this.resources[a]);this._intervalId=setInterval(this.draw.bind(this),16)}else this.end()},loadResource:function(a){a.load(this._loadCallbackBound)},end:function(){if(!this.done){this.done=true;this.onEnd()}},onEnd:function(){this.finalize()},finalize:function(){this.prevResourcesCnt=
ig.resources.length;ig.resources.length=0;clearInterval(this._intervalId);if(this.gameClass){if(!this.gameObjectCreated){this.gameObjectCreated=true;ig.system.setGame(this.gameClass)}if(ig.resources.length>0){this.load();return}this.prevResources=null;ig.ready=true;ig.system.setDelegate(ig.game)}else{ig.ready=true;ig.game.loadingComplete()}this._loadCallbackBound=null;ig.loading=false},draw:function(){this._drawStatus=this._drawStatus+(this.status-this._drawStatus)/5;var a=ig.system.scale,b=ig.system.width*
0.6,c=ig.system.height*0.1,d=ig.system.width*0.5-b/2,e=ig.system.height*0.5-c/2;ig.system.context.fillStyle="#000";ig.system.context.fillRect(0,0,ig.system.contextWidth,ig.system.contextHeight);ig.system.context.fillStyle="#fff";ig.system.context.fillRect(d*a,e*a,b*a,c*a);ig.system.context.fillStyle="#000";ig.system.context.fillRect(d*a+a,e*a+a,b*a-a-a,c*a-a-a);ig.system.context.fillStyle="#fff";ig.system.context.fillRect(d*a,e*a,b*a*this._drawStatus,c*a)},_loadCallback:function(a,b,c){this._unloaded.erase(a+
b);a=this._loadIndex;this._loadIndex=this.resources.length;for(var d=a;d<this.resources.length;d++)this._unloaded.push(this.resources[d].cacheType+this.resources[d].path);for(d=a;d<this.resources.length;d++)this.loadResource(this.resources[d]);!c&&!this.tolerateMissingResources&&ig.system.error(Error("Failed to load resource: "+b));this.lastPath=b;this.status=1-this._unloaded.length/this.resources.length;this._unloaded.length==0&&this.end()}});ig.LoadCollector=ig.Class.extend({listener:null,resources:[],
init:function(a){this.listener=a;ig.loadCollectors.push(this)},finalizeLoadableFetching:function(){ig.loadCollectors.erase(this);this.resources.length==0&&this.done()},addResource:function(a){if(this.resources.indexOf(a)==-1){this.resources.push(a);a.loadCollectors.push(this)}},setResourceLoaded:function(a){this.resources.erase(a);this.resources.length==0&&this.done()},done:function(){this.listener.onLoadableComplete(true,this)}});ig.loadCollectors=[];ig.addResourceToCollectors=function(a){for(var b=
ig.loadCollectors.length;b--;)ig.loadCollectors[b].addResource(a)};ig.setResourceLoadedToCollectors=function(a){for(var b=a.loadCollectors,c=b.length;c--;)b[c].setResourceLoaded(a);a.loadCollectors.length=0};ig.activateCollectors=function(a){for(var b=a.loadCollectors.length;b--;)ig.loadCollectors.push(a.loadCollectors[b])};ig.removeCollectors=function(a){for(var b=a.loadCollectors.length;b--;)ig.loadCollectors.erase(a.loadCollectors[b])};ig.JsonTemplate=ig.Class.extend({templates:[],init:function(){},
register:function(a,b){this.templates[a]=b},resolve:function(b){var c=[];if(b&&b.jsonTEMPLATES){var d=b.jsonTEMPLATES,e;for(e in d)c[e]=d[e];delete b.jsonTEMPLATES}return a(b,this.templates,c)}});ig.jsonTemplate=new ig.JsonTemplate});ig.baked=!0;ig.module("impact.base.image").requires("impact.base.worker","impact.base.loader").defines(function(){ig.Image=ig.Loadable.extend({cacheType:"Image",data:null,filtered:{},width:0,height:0,toBeFiltered:{},additionalCallbacks:[],init:function(a){sc.playerSkins&&
(a=sc.playerSkins.replaceImg(a));this.parent(a)},loadInternal:function(){this.data=new Image;this.data.onload=this.onload.bind(this);this.data.onerror=this.onerror.bind(this);this.data.src=ig.getFilePath(ig.root+this.path+ig.getCacheSuffix())},onCacheCleared:function(){this.data=null},addCallback:function(a){this.additionalCallbacks.push(a)},addFiltered:function(a,b,c){!this.filtered[a]&&!this.toBeFiltered[a]&&(this.loaded?this._createFiltered(a,b,c):this.toBeFiltered[a]={operator:b,config:c})},hasFiltered:function(a){return this.filtered[a]!=
void 0},_createFiltered:function(a,b,c){var d=ig.$new("canvas");d.width=this.data.width;d.height=this.data.height;this.data.getContext||this.resize(1);var e=d.getContext("2d").getImageData(0,0,this.data.width,this.data.height),f=this.data.getContext("2d").getImageData(0,0,this.data.width,this.data.height);c.src=f;c.dest=e;c.hint=a;this.filtered[a]=d;ig.Image.worker.doTask(b,c,this.onfiltered.bind(this))},reload:function(){this.loaded=false;this.data=new Image;this.data.onload=this.onload.bind(this);
this.data.src=ig.root+this.path+"?"+Date.now()},onload:function(){this.width=this.data.width;this.height=this.data.height;if(ig.system.scale!=1)this.resize(ig.system.scale);else this.onresized()},onresized:function(a){a&&this.data.getContext("2d").putImageData(a.result,0,0);var a=false,b;for(b in this.toBeFiltered){a=true;this._createFiltered(b,this.toBeFiltered[b].operator,this.toBeFiltered[b].config)}if(!a)this.onfiltered()},onfiltered:function(a){if(a){var b=a.hint;this.filtered[b].getContext("2d").putImageData(a.result,
0,0);delete this.toBeFiltered[b]}var a=true,c;for(c in this.toBeFiltered){a=false;break}if(a){this.loadingFinished(true);for(c=this.additionalCallbacks.length;c--;)this.additionalCallbacks[c]()}},onerror:function(){this.loadingFinished(false)},getTileSrc:function(a,b,c,d,e,f,g){e=e||0;a.x=e+Math.floor(b*c)%(g?g*c:this.width-e);a.y=(f||0)+Math.floor(b*c/(g?g*c:this.width-e))*(d||c);return a},resize:function(a){var b=this.width*a,c=this.height*a,d=ig.$new("canvas");d.width=this.width;d.height=this.height;
d=ig.system.getBufferContext(d);d.drawImage(this.data,0,0,this.width,this.height,0,0,this.width,this.height);var d=d.getImageData(0,0,this.width,this.height),e=ig.$new("canvas");e.width=b;e.height=c;b=e.getContext("2d").getImageData(0,0,b,c);this.data=e;ig.Image.worker.doTask("SCALE",{src:d,dest:b,scale:a},this.onresized.bind(this))},draw:function(a,b,c,d,e,f,g,h,i,j,m,n){e=e!==void 0?e:this.width;f=f!==void 0?f:this.height;j=j||0;i=i||null;if(this.loaded&&!(e>this.width||f>this.height)){var k=ig.system.scale,
c=c?c*k:0,d=d?d*k:0,e=e*k,f=f*k;if(!(e<=0||f<=0)){var k=g?-1:1,l=h?-1:1,m=this.filtered[m]?this.filtered[m]:this.data;if(g||h){ig.system.context.save();ig.system.context.scale(k,l)}if(n){a=a*ig.system.scale;b=b*ig.system.scale}else{a=ig.system.getDrawPos(a);b=ig.system.getDrawPos(b)}a=a*k-(g?e:0);b=b*l-(h?f:0);if(j<1){ig.system.context.drawImage(m,c,d,e,f,a,b,e,f);ig.Image.drawCount++}if(i){ig.system.context.globalAlpha=ig.system.context.globalAlpha*j;i.draw(a,b,f);ig.system.context.globalAlpha=ig.system.context.globalAlpha/
j}(g||h)&&ig.system.context.restore()}}},drawCheck:function(a,b,c,d,e,f,g,h,i,j,m){a>ig.system.width||(b>ig.system.height||a+e<0||b+f<0)||this.draw(a,b,c,d,e,f,g,h,i,j,m)},drawTileCheck:function(a,b,c,d,e,f,g,h,i,j,m,n){if(!(a>ig.system.width||b>ig.system.height||a+d<0||b+e<0)){e=e?e:d;this.draw(a,b,Math.floor(c*d)%this.width,Math.floor(c*d/this.width)*e,d,e,f,g,h,i,j,m,n)}},drawTile:function(a,b,c,d,e,f,g,h,i,j,m){var e=e?e:d,n=Math.floor(c*d/this.width)*e;if(n>this.height&&window.wm){a=ig.system.getDrawPos(a);
b=ig.system.getDrawPos(b);ig.system.context.fillStyle="magenta";ig.system.context.fillRect(a,b,d*ig.system.scale,d*ig.system.scale)}this.draw(a,b,Math.floor(c*d)%this.width,n,d,e,f,g,h,i,j,m)},createPattern:function(a,b,c,d,e){return new ig.ImagePattern(this,a,b,c,d,e)},getTileModFragment:function(a,b,c,d){c=c?c:b;return new ig.ImageModFragment(this,Math.floor(a*b)%this.width,Math.floor(a*b/this.width)*c,b,c,d)},getMaxTileIdx:function(a,b){return this.width/a*(this.height/(b||a))}});ig.ImageCanvasWrapper=
ig.Class.extend({data:null,width:0,height:0,loaded:true,filtered:{},init:function(a){this.data=a;this.width=a.width/ig.system.scale;this.height=a.height/ig.system.scale},draw:ig.Image.prototype.draw});ig.Image.drawCount=0;ig.Image.reloadCache=function(){if(ig.Image.cache)for(var a in ig.Image.cache)ig.Image.cache[a]&&ig.Image.cache[a].reload()};ig.ImagePattern=ig.Class.extend({image1:null,image2:null,pattern:null,sourceImage:null,optMode:0,sourceX:0,sourceY:0,width:0,height:0,totalWidth:0,totalHeight:0,
usePatternDraw:false,init:function(a,b,c,d,e,f){a=a instanceof ig.Image?a:new ig.Image(a);this.sourceX=b;this.sourceY=c;this.width=d;this.height=e;this.optMode=f||0;this.sourceImage=a;a.loaded?this.initBuffer():a.addCallback(this.initBuffer.bind(this))},initBuffer:function(){var a=ig.system.scale;this.sourceX=this.sourceX?this.sourceX*a:0;this.sourceY=this.sourceY?this.sourceY*a:0;this.width=(this.width?this.width:this.sourceImage.width)*a;this.height=(this.height?this.height:this.sourceImage.height)*
a;var a=ig.ImagePattern.OPT,b=this.optMode==a.NONE||this.optMode==a.REPEAT_X?1:256,c=Math.ceil((this.optMode==a.NONE||this.optMode==a.REPEAT_Y?1:256)/this.width),b=Math.ceil(b/this.height),d=c*this.width,e=b*this.height;if(this.usePatternDraw){var f=ig.$new("canvas");f.width=this.width;f.height=this.height;var g=ig.system.getBufferContext(f);g.drawImage(this.sourceImage.data,this.sourceX,this.sourceY,this.width,this.height,0,0,this.width,this.height);this.pattern=ig.system.context.createPattern(f,
"repeat")}else{f=ig.$new("canvas");f.width=d;f.height=this.optMode==a.REPEAT_X_OR_Y?this.height:e;for(var g=ig.system.getBufferContext(f),h=0;h<(this.optMode==a.REPEAT_X_OR_Y?1:b);++h)for(var i=0;i<c;++i){g.drawImage(this.sourceImage.data,this.sourceX,this.sourceY,this.width,this.height,i*this.width,h*this.height,this.width,this.height);ig.Image.drawCount++}this.image1=f;if(this.optMode==a.REPEAT_X_OR_Y){f=ig.$new("canvas");f.width=this.width;f.height=e;g=ig.system.getBufferContext(f);for(h=0;h<b;++h){g.drawImage(this.sourceImage.data,
this.sourceX,this.sourceY,this.width,this.height,0,h*this.height,this.width,this.height);ig.Image.drawCount++}this.image2=f}this.totalWidth=d;this.totalHeight=e}},clearCached:function(){if(this.image1){this.image1.width=this.image1.height=0;this.image1=null}if(this.image2){this.image2.width=this.image2.height=0;this.image2=null}},draw:function(a,b,c,d,e,f,g){g=g||ig.system.scale;c=c<0?c%this.width+this.width:c%this.width;d=d<0?d%this.height+this.height:d%this.height;c=ig.system.getDrawPos(c||0);d=
ig.system.getDrawPos(d||0);e=e*g;f=f*g;a=ig.system.getDrawPos(a);b=ig.system.getDrawPos(b);if(this.pattern){ig.system.context.fillStyle=this.pattern;var g=a%this.width,h=b%this.height;ig.system.context.translate(g-c,h-d);ig.system.context.fillRect(a-g+c,b-h+d,e,f);ig.system.context.translate(-g+c,-h+d);ig.Image.drawCount++}else{var g=this.image1,h=this.totalWidth,i=this.totalHeight;if(this.optMode==ig.ImagePattern.OPT.REPEAT_X_OR_Y)if(e<=this.width){g=this.image2;h=this.width}else i=this.height;for(var a=
a-c,b=b-d,f=f+d,e=e+c,j=0;j<f;j=j+i)for(var m=0;m<e;m=m+h){var n=m?0:c,k=j?0:d,l=Math.min(h,e-m)-n,o=Math.min(i,f-j)-k;if(l&&o){ig.system.context.drawImage(g,n,k,l,o,a+m+n,b+j+k,l,o);ig.Image.drawCount++}}}}});ig.SimpleColor=ig.Class.extend({color:null,init:function(a){this.color=a},draw:function(a,b,c,d){a=ig.system.getDrawPos(a);b=ig.system.getDrawPos(b);c=c*ig.system.scale;d=d*ig.system.scale;ig.system.context.fillStyle=this.color;ig.system.context.fillRect(a,b,c,d)}});ig.ComplexLineCircleBox=
ig.Class.extend({color:null,circleColor:null,target:{x:0,y:0},radius:10,init:function(a,b,c,d,e){this.color=a;this.circleColor=b;this.radius=e||10;this.target.x=c;this.target.y=d},draw:function(a,b,c,d){var a=ig.system.getDrawPos(a),b=ig.system.getDrawPos(b),c=c*ig.system.scale,d=d*ig.system.scale,e=ig.system.context;e.fillStyle=this.color;e.fillRect(a,b,c,d);if(ig.game._hideCircles!=void 0&&!ig.game._hideCircles){e.fillStyle=this.circleColor;e.beginPath();e.arc(a,b,this.radius,0,2*Math.PI);e.fill();
e.strokeStyle=this.color;e.stroke()}e.strokeStyle=this.color;e.beginPath();e.moveTo(a+c/2,b+d/2);e.lineTo(this.target.x-ig.game.screen.x,this.target.y-ig.game.screen.y);e.stroke()}});ig.SimpleCircle=ig.Class.extend({color:null,borderColor:null,radius:20,init:function(a,b,c){this.color=a;this.borderColor=b||"black";this.radius=c||20},draw:function(a,b,c,d){var a=ig.system.getDrawPos(a),b=ig.system.getDrawPos(b),c=c*ig.system.scale,d=d*ig.system.scale,e=ig.system.context;e.fillStyle=this.borderColor;
e.fillRect(a-Math.floor(c/2),b-Math.floor(d/2),c,d);if(ig.game._hideCircles!=void 0&&!ig.game._hideCircles){e.fillStyle=this.color;e.beginPath();e.arc(a,b,this.radius,0,2*Math.PI);e.fill();e.strokeStyle=this.borderColor;e.stroke()}}});ig.TransitionColor=ig.Class.extend({colorA:null,colorB:null,colorBWeight:0,init:function(a,b,c){this.colorA=a;this.colorB=b||b;this.colorBWeight=c||0},setColorBWeight:function(a){this.colorBWeight=a},draw:function(a,b,c,d){a=ig.system.getDrawPos(a);b=ig.system.getDrawPos(b);
c=c*ig.system.scale;d=d*ig.system.scale;ig.system.context.fillStyle=this.colorA;ig.system.context.fillRect(a,b,c,d);var e=ig.system.context.globalAlpha;ig.system.context.globalAlpha=ig.system.context.globalAlpha*this.colorBWeight;ig.system.context.fillStyle=this.colorB;ig.system.context.fillRect(a,b,c,d);ig.system.context.globalAlpha=e}});ig.DoubleColor=ig.Class.extend({color1:null,color2:null,init:function(a,b){this.color1=a;this.color2=b||a}});ig.ImagePattern.OPT={NONE:0,REPEAT_X:1,REPEAT_Y:2,REPEAT_X_OR_Y:3,
REPEAT_X_AND_Y:4};ig.ImagePatternSheet=ig.Cacheable.extend({cacheType:"ImagePatternSheet",image:null,patternTileWidth:0,patternTileHeight:0,offX:0,offY:0,xCount:0,yCount:0,optimization:ig.ImagePattern.OPT.NONE,patterns:[],init:function(a,b,c,d,e,f,g,h){this.parent();this.patternTileWidth=c;this.patternTileHeight=d||c;this.offX=e||0;this.offY=f||0;this.xCount=g||0;this.yCount=h||0;this.optimization=b||ig.ImagePattern.OPT.NONE;this.image=new ig.Image(a);if(this.image.loaded)this.onImageLoaded();else this.image.addCallback(this.onImageLoaded.bind(this))},
getCacheKey:function(a,b,c,d,e,f,g,h){return a+"|"+c+"|"+(d||c)+"|"+(e||0)+"|"+(f||0)+"|"+(g||0)+"|"+(h||0)+"|"+b},onCacheCleared:function(){this.image.decreaseRef();for(var a=this.patterns.length;a--;)this.patterns[a]&&this.patterns[a].clearCached();this.patterns.length=0},onImageLoaded:function(){for(var a=this.xCount||Math.floor((this.image.width-this.offX)/this.patternTileWidth),b=this.yCount||Math.floor((this.image.height-this.offY)/this.patternTileWidth),c=0;c<b;++c)for(var d=0;d<a;++d)this.patterns[c*
a+d]=this.image.createPattern(this.offX+d*this.patternTileWidth,this.offY+c*this.patternTileHeight,this.patternTileWidth,this.patternTileHeight,this.optimization)},getPattern:function(a){return this.patterns[a]}});ig.ImageModFragment=ig.Class.extend({image:0,sourceX:0,sourceY:0,width:0,height:0,resX:-1,resY:-1,init:function(a,b,c,d,e,f){this.image=a;this.sourceX=b*ig.system.scale;this.sourceY=c*ig.system.scale;this.width=d*ig.system.scale;this.height=e*ig.system.scale;this.color=f;ig.ImageModFragment.list.push(this)},
prepare:function(a,b){if(this.image&&this.height&&this.width){var c=ig.system.getBufferContext(ig.ImageModFragment.buffer);c.globalCompositeOperation="source-over";c.globalAlpha=1;if(this.image instanceof ig.ImagePattern){var d=ig.system.context;ig.system.context=c;this.image.draw(a,b,this.sourceX,this.sourceY,this.width,this.height,1);ig.system.context=d}else if(this.image.data){c.drawImage(this.image.data,this.sourceX,this.sourceY,this.width,this.height,a,b,this.width,this.height);ig.Image.drawCount++}c.globalCompositeOperation=
"source-atop";c.fillStyle=this.color;c.fillRect(a,b,this.width,this.height);this.resX=a;this.resY=b}},draw:function(a,b,c,d,e,f,g,h){if(this.resX!=-1){if(this.resX==-2)throw Error("Error: Tried to draw ImageModFragment twice");var i=ig.system.scale,e=e*i,f=f*i,j=g?-1:1,m=h?-1:1;if(g||h){ig.system.context.save();ig.system.context.scale(j,m)}a=ig.system.getDrawPos(a)*j-(g?e:0);b=ig.system.getDrawPos(b)*m-(h?f:0);ig.system.context.drawImage(ig.ImageModFragment.buffer,this.resX+c*i,this.resY+d*i,e,f,
a,b,e,f);ig.Image.drawCount++;(g||h)&&ig.system.context.restore()}}});ig.ImageModFragment.BUFFER_WIDTH=1024;ig.ImageModFragment.BUFFER_HEIGHT=1024;ig.ImageModFragment.buffer=ig.$new("canvas");ig.ImageModFragment.buffer.width=ig.ImageModFragment.BUFFER_WIDTH;ig.ImageModFragment.buffer.height=ig.ImageModFragment.BUFFER_HEIGHT;ig.ImageModFragment.list=[];ig.ImageModFragment.oldList=[];ig.ImageModFragment.prepared=false;ig.ImageModFragment.prepare=function(){if(!(this.prepared||this.list.length==0)){ig.system.getBufferContext(this.buffer).clearRect(0,
0,this.BUFFER_WIDTH,this.BUFFER_HEIGHT);for(var a=0,b=0,c=0,d=0;d<this.list.length;d++){var e=this.list[d];if(!(e.width>this.BUFFER_WIDTH)){if(a+e.width>this.BUFFER_WIDTH){a=0;b=c}if(!(b+e.height>this.BUFFER_HEIGHT)){e.prepare(a,b);c=Math.max(c,b+e.height);a=a+e.width}}}this.prepared=true}};ig.ImageModFragment.clear=function(){for(var a=0;a<this.oldList.length;++a)this.oldList[a].resX=-2;this.oldList=this.list;this.list=[];this.prepared=false};ig.ImageAtlas=ig.Class.extend({buffers:[],debugActive:false,
lines:[],scale:1,init:function(){},getFragment:function(a,b,c){if(ig.perf.showImageAtlas!=this.debugActive){this.debugActive=ig.perf.showImageAtlas;for(var d=this.buffers.length;d--;)this.debugActive?document.body.appendChild(this.buffers[d]):document.body.removeChild(this.buffers[d])}a=a*ig.system.scale*this.scale;b=b*ig.system.scale*this.scale;return this._getFragment(a,b,c)},fillFragments:function(){for(var a=0;a<this.lines.length;++a)for(var b=this.lines[a].entries,c=0;c<b.length;++c)b[c].fragment&&
!b[c].fragment.filled&&b[c].fragment._fill()},defragment:function(a){var b=0,c=0;if(a=a||window.IG_GAME_DEBUG)for(var d=0;d<this.buffers.length;++d)this.buffers[d].getContext("2d").clearRect(0,0,ig.system.contextWidth,ig.system.contextHeight);for(d=0;d<this.lines.length;){var e=this.lines[d];if(b+e.height>this.buffers[c].height){b=0;c=c+1}e.offY=b;e.buffer=this.buffers[c];for(var f=e.entries,g=0,h,i=0;i<f.length;)if(h=f[i].fragment){f[i].offX=g;if(a||h.offX!=g||h.offY!=b||h.buffer!=e.buffer){h.offX=
g;h.offY=b;h.buffer=e.buffer;h.lineIdx=d;f[i].fragment.filled=false}g=g+f[i].width;++i}else if(i!=f.length-1)f.splice(i,1);else{f[i].offX=g;g=g+f[i].width;++i}if(g<e.buffer.width)f[f.length-1].fragment?f.push({offX:g,width:e.buffer.width-g,fragment:null}):f[f.length-1].width=f[f.length-1].width+(e.buffer.width-g);if(e.entries.length==1&&!e.entries[0].fragment)this.lines.splice(d,1);else{b=b+e.height;++d}}for(;c+1<this.buffers.length;){a=this.buffers.pop();this.debugActive&&document.body.removeChild(a)}},
release:function(a){for(var b=this.lines[a.lineIdx].entries,c=0;c<b.length;++c)if(b[c].fragment==a){b[c].fragment=null;if(c+1<b.length&&!b[c+1].fragment){b[c].width=b[c].width+b[c+1].width;b.splice(c+1,1)}if(c>0&&!b[c-1].fragment){b[c].width=b[c].width+b[c-1].width;b[c].offX=b[c-1].offX;b.splice(c-1,1)}return}for(var d;this.lines.length>0&&(d=this.lines[this.lines-1])&&d.entries.length==1&&d.entries[0].fragment;)this.lines.pop()},_getFragment:function(a,b,c){for(var d,e,f,g=0;!f&&g<this.lines.length;++g)if(this.lines[g].height>=
b&&b/this.lines[g].height>0.5)for(var h=this.lines[g].entries,i=0;!f&&i<h.length;++i)if(!h[i].fragment&&h[i].width>=a){f=this._splitEntry(h,i,a);e=this.lines[g];d=g}if(!f){e=this._createLine(b);d=this.lines.length-1;f=this._splitEntry(e.entries,0,a)}f.fragment=new ig.ImageAtlasFragment(e.buffer,f.offX,e.offY,a,b,d,c);return f.fragment},_createLine:function(a){var b=null,c=0;if(this.lines.length>0){var d=this.lines[this.lines.length-1];if(d.buffer.height-d.offY-d.height<a)b=this._createBuffer();else{b=
d.buffer;c=d.offY+d.height}}else b=this.buffers.length>0?this.buffers[0]:this._createBuffer();a={offY:c,height:a,buffer:b,entries:[{offX:0,width:b.width,fragment:null}]};this.lines.push(a);return a},_createBuffer:function(){var a=ig.$new("canvas");a.width=ig.system.contextWidth*this.scale;a.height=ig.system.contextHeight*this.scale;this.buffers.push(a);this.debugActive&&document.body.appendChild(a);return a},_splitEntry:function(a,b,c){var d=a[b];if(c==d.width)return d;var e={offX:d.offX+c,width:d.width-
c,fragment:null};d.width=c;a.splice(b+1,0,e);return d}});ig.imageAtlas=new ig.ImageAtlas;ig.ImageAtlasFragment=ig.Class.extend({buffer:null,offX:0,offY:0,width:0,height:0,fillCallback:null,filled:false,lineIdx:0,init:function(a,b,c,d,e,f,g){this.buffer=a;this.offX=b;this.offY=c;this.width=d/ig.system.scale/ig.imageAtlas.scale;this.height=e/ig.system.scale/ig.imageAtlas.scale;this.lineIdx=f;this.fillCallback=g},invalidate:function(){this.filled=false},release:function(){ig.imageAtlas.release(this)},
draw:function(a,b,c,d,e,f,g,h){var i=ig.system.scale,e=(e||this.width)*i,f=(f||this.height)*i,d=d*i,i=g?-1:1,j=h?-1:1;if(g||h){ig.system.context.save();ig.system.context.scale(i,j)}a=ig.system.getDrawPos(a)*i-(g?e:0);b=ig.system.getDrawPos(b)*j-(h?f:0);i=ig.imageAtlas.scale;ig.system.context.drawImage(this.buffer,this.offX+c*i,this.offY+d*i,e*i,f*i,a,b,e,f);ig.Image.drawCount++;(g||h)&&ig.system.context.restore()},_fill:function(){this.filled=true;var a=ig.system.context,b=ig.system.scale*ig.imageAtlas.scale,
c=ig.system.scale,d=ig.system.context=ig.system.getBufferContext(this.buffer);d.clearRect(this.offX,this.offY,this.width*b,this.height*b);d.save();d.translate(this.offX,this.offY);d.beginPath();d.scale(ig.imageAtlas.scale,ig.imageAtlas.scale);d.rect(0,0,this.width*c,this.height*c);d.clip();this.fillCallback();d.restore();ig.system.context=a}});ig.Image.worker=new ig.Worker("impact/webworker/image-tasks.js","IMAGE");ig.ScreenBufferPool={handleList:[],freeBuffers:[],paddingX:0,paddingY:0,width:0,height:0,
updateDimensions:function(){var a=ig.CONFIG.DEFAULT_TILE_SIZE,b=ig.system.width/ig.system.zoom,c=ig.system.height/ig.system.zoom,b=Math.min(1024,b),c=Math.min(1024,c);this.paddingX=Math.ceil(Math.max(b-ig.system.width,0)/2/a)+2;this.paddingY=Math.ceil(Math.max(c-ig.system.height,0)/2/a)+2;this.width=(Math.ceil(ig.system.width/a)+this.paddingX*2)*a;this.height=(Math.ceil(ig.system.height/a)+this.paddingY*2)*a},get:function(){if(this.freeBuffers.length)return this.freeBuffers.pop();this.width||this.updateDimensions();
var a=ig.$new("canvas");a.width=this.width*ig.system.scale;a.height=this.height*ig.system.scale;return a},addHandle:function(a){this.handleList.push(a)},removeHandle:function(a){this.handleList.erase(a)},free:function(a){a&&this.freeBuffers.push(a)},clearBuffers:function(){for(var a=this.handleList.length;a--;)this.handleList[a].resetBuffer();this.reduceFreeBuffers(0);this.updateDimensions()},reduceFreeBuffers:function(a){for(var b=this.freeBuffers.length;b-- >a;)this.freeBuffers[b].width=0;this.freeBuffers.length=
Math.min(this.freeBuffers.length,a)}};ig.ScreenBuffer=ig.Class.extend({width:0,height:0,buffer:null,scroll:{x:0,y:0},off:{x:0,y:0},shift:{x:0,y:0,full:false},redrawFull:false,ownerMap:null,init:function(a){this.ownerMap=a;this.redrawFull=true;this.fetchBuffer();ig.ScreenBufferPool.addHandle(this)},clearCached:function(){if(this.buffer){ig.ScreenBufferPool.free(this.buffer);ig.ScreenBufferPool.removeHandle(this);this.ownerMap=this.buffer=null}},resetBuffer:function(){ig.ScreenBufferPool.free(this.buffer);
this.buffer=null;this.redrawFull=true},fetchBuffer:function(){this.buffer=ig.ScreenBufferPool.get();this.width=ig.ScreenBufferPool.width;this.height=ig.ScreenBufferPool.height},update:function(a){if(a.readyToDraw()){this.buffer||this.fetchBuffer();var b=ig.CONFIG.DEFAULT_TILE_SIZE;if(a==this.ownerMap){var c=Math.round(a.scroll.x)-ig.ScreenBufferPool.paddingX*b,d=Math.round(a.scroll.y)-ig.ScreenBufferPool.paddingY*b,e=c-this.scroll.x,f=d-this.scroll.y;this.shift.x=0;this.shift.y=0;this.shift.full=
false;if(Math.abs(e)>b){this.shift.x=(e>0?Math.floor(e/b):Math.ceil(e/b))*b;this.scroll.x=this.scroll.x+this.shift.x;this.off.x=this.off.x+this.shift.x;this.off.x=(this.off.x+this.width)%this.width}if(Math.abs(f)>b){this.shift.y=(f>0?Math.floor(f/b):Math.ceil(f/b))*b;this.scroll.y=this.scroll.y+this.shift.y;this.off.y=this.off.y+this.shift.y;this.off.y=(this.off.y+this.height)%this.height}if(this.redrawFull||Math.abs(this.shift.x)>=this.width||Math.abs(this.shift.y)>=this.height){this.scroll.x=Math.round(c/
b)*b;this.scroll.y=Math.round(d/b)*b;this.off.x=0;this.off.y=0;this.shift.full=true;this.redrawFull=false;b=this.buffer;ig.system.getBufferContext(b).clearRect(0,0,b.width,b.height)}}this.shift.full?this._redrawFull(a):this._redrawShift(a)}},draw:function(a,b,c,d,e,f){if(c<this.scroll.x){a=a+(this.scroll.x-c);e=e-(this.scroll.x-c);c=this.scroll.x}if(d<this.scroll.y){b=b+(this.scroll.y-d);e=e-(this.scroll.y-d);d=this.scroll.y}if(this.ownerMap&&this.ownerMap.lighter)ig.system.context.globalCompositeOperation=
"lighter";c=c-this.scroll.x+this.off.x;d=d-this.scroll.y+this.off.y;if(e>this.width)e=this.width;if(f>this.height)f=this.height;c>=this.width&&(c=c-this.width);d>=this.height&&(d=d-this.height);var g=this.buffer,h,i;if(c+e>this.width){h=c+e-this.width;e=e-h}if(d+f>this.height){i=d+f-this.height;f=f-i}e&&f&&ig.system.context.drawImage(g,c,d,e,f,a,b,e,f);h&&f&&ig.system.context.drawImage(g,0,d,h,f,a+e,b,h,f);e&&i&&ig.system.context.drawImage(g,c,0,e,i,a,b+f,e,i);h&&i&&ig.system.context.drawImage(g,
0,0,h,i,a+e,b+f,h,i);if(this.ownerMap&&this.ownerMap.lighter)ig.system.context.globalCompositeOperation="source-over"},setGridTile:function(a,b,c,d){var e=ig.CONFIG.DEFAULT_TILE_SIZE,a=a*e-this.scroll.x,b=b*e-this.scroll.y;if(!(a<0||a>=this.width||b<0||b>=this.height)){var a=(a+this.off.x)%this.width,b=(b+this.off.y)%this.height,f=ig.system.context;ig.system.context=ig.system.getBufferContext(this.buffer);ig.system.context.clearRect(a,b,e,e);c&&d.tiles&&d.tiles.drawTile(a,b,c-1,e);ig.system.context=
f}},_redrawFull:function(a){var b=this.scroll.x,c=this.scroll.y,d=this.width,e=this.height,f=ig.system.getBufferContext(this.buffer);a.preRenderScreen(f,0,0,b,c,d,e)},_redrawShift:function(a){if(this.shift.y){var b=this.shift.y>0?this.off.y-this.shift.y:this.off.y,c=this.off.x,d=Math.abs(this.shift.y),e=this.width,f=this.scroll.y+(this.shift.y>0?this.height-this.shift.y:0),g=this.scroll.x;if(this.shift.x){e=e-Math.abs(this.shift.x);if(this.shift.x<0){c=c-this.shift.x;g=g-this.shift.x}}this._splitDraw(a,
c,b,g,f,e,d)}if(this.shift.x){c=this.shift.x>0?this.off.x-this.shift.x:this.off.x;b=this.off.y;e=Math.abs(this.shift.x);d=this.height;g=this.scroll.x+(this.shift.x>0?this.width-this.shift.x:0);f=this.scroll.y;this._splitDraw(a,c,b,g,f,e,d)}},_splitDraw:function(a,b,c,d,e,f,g){b<0&&(b=b+this.width);c<0&&(c=c+this.height);var h=ig.system.getBufferContext(this.buffer),i,j;if(b+f>this.width){i=b+f-this.width;f=f-i}if(c+g>this.height){j=c+g-this.height;g=g-j}if(f&&g){a==this.ownerMap&&h.clearRect(b,c,
f,g);a.preRenderScreen(h,b,c,d,e,f,g)}if(f&&j){a==this.ownerMap&&h.clearRect(b,0,f,j);a.preRenderScreen(h,b,0,d,e+g,f,j)}if(i&&g){a==this.ownerMap&&h.clearRect(0,c,i,g);a.preRenderScreen(h,0,c,d+f,e,i,g)}if(i&&j){a==this.ownerMap&&h.clearRect(0,0,i,j);a.preRenderScreen(h,0,0,d+f,e+g,i,j)}}})});ig.baked=!0;ig.module("impact.base.font").requires("impact.base.image").defines(function(){function a(b){for(var c=0;c<b.length;++c)b[c].onIconChange()}var b={},c=ig.$new("canvas").getContext("2d");ig.LANG_LATIN_END=
591;ig.TextCommands={register:function(a,c,d){if(b[a])throw Error("Text command for key '"+a+"' is already assigned");b[a]={argument:c,apply:d}}};ig.TextCommands.register(".",false,function(a,b){b.push({index:a,command:{brake:0.2}})});ig.TextCommands.register("!",false,function(a,b){b.push({index:a,command:{brake:0.4}})});ig.TextCommands.register("\\",false,function(){return"\\"});ig.TextCommands.register("c",true,function(a,b,c){c.push({index:b,command:{color:a}})});ig.TextCommands.register("s",
true,function(a,b,c){if(d[a]===void 0)throw Error("Unsupported \\s argument: '"+a+"'. Only support values from 0-7");c.push({index:b,command:{speed:d[a]}})});ig.TextCommands.register("v",true,function(a){return ig.vars.get(a)});ig.TextCommands.register("i",true,function(a,b,c,d){a=d?d.indexMapping.indexOf(a):0;if(a!=-1)return String.fromCharCode(ig.MultiFont.ICON_START+a)});ig.Font=ig.Image.extend({cacheType:"Font",widthMap:[],indicesX:[],indicesY:[],firstChar:32,charHeight:0,sizeIndex:0,color:null,
init:function(a,b,c,d,e){this.firstChar=c==void 0?32:c;this.charHeight=b;this.sizeIndex=d;this.color=e||"white";this.parent(a)},onload:function(a){this._loadMetrics(this.data);this.parent(a)},widthForString:function(a){for(var b=0,c=0;c<a.length;c++)b=b+(this.widthMap[a.charCodeAt(c)-this.firstChar]+1||0);return b},draw:function(){throw"LOL NOPE!";},getSystemFont:function(a){return ig.SYSTEM_FONT_METRICS.size[this.sizeIndex]*ig.system.systemFontScale+(a||0)+"px "+ig.Font.systemFont},_drawChar:function(a,
b,c,d){if(!this.loaded||a<0||a>=this.indicesX.length)return 0;var e=ig.system.scale,f=(this.widthMap[a]+1)*e,g=this.charHeight*e;ig.system.context.drawImage(d!=void 0?d:this.data,this.indicesX[a]*e,this.indicesY[a]*e,f,g,ig.system.getDrawPos(b),ig.system.getDrawPos(c),f,g);return this.widthMap[a]+1},_drawSystemChar:function(a,b,c,d){var e=ig.system.context,a=String.fromCharCode(a);if(a=="\n"||a=="\r")return 0;e.font=this.getSystemFont();e.fillStyle="black";e[ig.system.imageSmoothingKey]=false;var f=
ig.system.systemFontScale,g=1/f,h=ig.SYSTEM_FONT_METRICS.baseLine[this.sizeIndex];e.save();e.translate(ig.system.getDrawPos(b),ig.system.getDrawPos(c)+h);f!=1&&e.scale(g,g);e.fillText(a,0,f);e.fillText(a,f,0);e.fillStyle=d;e.fillText(a,0,0);e.restore();return this.getSystemCharWidth(a)},getSystemCharWidth:function(a){c.font=this.getSystemFont();a=c.measureText(a);return Math.ceil(a.width/ig.system.systemFontScale)},_loadMetrics:function(a){if(!this.charHeight)this.charHeight=a.height-1;this.widthMap=
[];this.indicesX=[];this.indicesY=[];var b=ig.$new("canvas");b.width=a.width;b.height=a.height;b=b.getContext("2d");b.drawImage(a,0,0);for(var c=0,d=0;c+this.charHeight<a.height;){for(var e=0,f=b.getImageData(0,c+this.charHeight,a.width,1),g=0;g<a.width;g++){var h=g*4+3;if(f.data[h]!=0)e++;else if(f.data[h]==0&&e){this.widthMap.push(e);this.indicesX.push(g-e);this.indicesY.push(c);d++;e=0}}if(e){this.widthMap.push(e);this.indicesX.push(a.width-e);this.indicesY.push(c)}c=c+(this.charHeight+1)}}});
ig.Font.ALIGN={LEFT:0,RIGHT:1,CENTER:2};ig.Font.systemFont=false;ig.MultiFont=ig.Font.extend({cacheType:"MultiFont",fontStyles:[],iconSets:[],mapping:{},indexMapping:[],iconChangeListeners:[],colorSets:[],init:function(a,b,c,d){this.parent(a,b,void 0,c,d);this.fontStyles=[]},pushIconSet:function(b){this.iconSets.push(b);a(this.iconChangeListeners)},setIconSet:function(b,c){this.iconSets[c]=b;a(this.iconChangeListeners)},addIconChangeListener:function(a){this.iconChangeListeners.indexOf(a)==-1&&this.iconChangeListeners.push(a)},
removeIconChangeListener:function(a){this.iconChangeListeners.erase(a)},callChangeListeners:function(){a(this.iconChangeListeners)},setMapping:function(b){for(var c in b){this.mapping[c]=b[c];this.indexMapping.indexOf(c)==-1&&this.indexMapping.push(c)}a(this.iconChangeListeners)},pushColorSet:function(a,b,c){b&&!(a&&a<0)&&(this.colorSets[a]={img:b,color:c})},_getActualIndex:function(a){return a=this.mapping[this.indexMapping[a]]},getLineWidth:function(a,b,c){for(var d=0,e=0;e+1<b.lineIdx.length&&
b.lineIdx[e+1]<=c;)e++;for(b=b.lineIdx[e];b<c;b++)d=d+this.getCharWidth(a.charCodeAt(b));return d},getTextDimensions:function(a,b){for(var c=0,d=0,b=b!=void 0?b:1,e=this.charHeight+b,f=[],g=[0],h=0;h<a.length;h++)if(a.charAt(h)=="\n"){c=Math.max(c,d);f.push(d);g.push(h+1);d=0;e=e+(this.charHeight+b)}else d=d+this.getCharWidth(a.charCodeAt(h));b<0&&(e=e+-b);g.push(a.length);f.push(d);c=Math.max(c,d);return{x:c,y:e,lines:f,lineIdx:g}},wrapText:function(a,b,c,d,e){for(var f=null,g=-1,h=d?8:1,i=[],j=
b*0.75/(h-1),m=ig.LANG_DETAILS[ig.currentLang]||{};h--;){for(var n=a,k=[],l=[],o=[],p=0,r=0,s=0,v=-1,q=false,z=0,y=false,t=0;t<n.length;t++){var u=n.charAt(t),T=n.charCodeAt(t),S=this.getCharWidth(T),p=p+S;if(t>0&&m.newlineAfter&&m.newlineAfter.indexOf(u)!=-1)y=true;else if(t>0&&T>ig.LANG_LATIN_END&&m.newlineAnywhere&&(!m.newlineException||m.newlineException.indexOf(u)==-1)){v=t;z=p-S;q=true;y=false}else if(u.match(/\s/g)){v=t;z=p-S;y=q=false}else if(y){y=false;v=t;z=p-S;q=true}if((u=n.charAt(t)==
"\n")||p>b&&v!=-1){t=u?t:v;k.push(n.substr(0,t));p=u?p:z;r=Math.max(r,p);u&&(q=false);l.push(p);s=s+t;if(q){o.push(s);s=s+1}n=n.substr(t+(q?0:1));t=-1;p=0;v=-1;y=q=false;z=0}}k.push(n);l.push(p);r=Math.max(r,p);if(d){s=n=0;t=d*(k.length*this.charHeight+(k.length-1)*c);n=Math.abs(t-r)/t*50;t*0.5>r?n=n+(1E3+t/r*200):t*1.5<r&&(n=n+(1E3+r/t*200));for(t=k.length;t--;){q=l[t]/r;q<0.7&&(s=s+(t<k.length-1?200:100)*(1-q*q))}l=s+n;b=b-j;if(g==-1||g>l){g=l;f=k.join("\n");i=o}}else{f=k.join("\n");i=o}}a=e.length-
1;for(t=i.length;t--;){b=i[t];for(c=t+1;a>=0&&e[a].index>=b;){e[a].index=e[a].index+c;a--}}return f},drawLines:function(a,b,c,d,e,f){var g=this.data,h=this.color,f=f!=void 0?f:1;typeof a!="string"&&(a=a.toString());var i=null;if(d==ig.Font.ALIGN.RIGHT||d==ig.Font.ALIGN.CENTER)i=this.getTextDimensions(a);for(var j=0,m=d==ig.Font.ALIGN.LEFT?b:b-(d==ig.Font.ALIGN.CENTER?Math.floor(i.lines[j]/2):i.lines[j]),n=0,k=0;k<a.length;k++){var l=a.charCodeAt(k);if(l==10){j++;m=d==ig.Font.ALIGN.LEFT?b:b-(d==ig.Font.ALIGN.CENTER?
Math.floor(i.lines[j]/2):i.lines[j]);c=c+(this.charHeight+f)}for(;n<e.length&&e[n].index==k;++n)if(e[n].command.color!=void 0){var o=e[n].command.color;if(o>=0)if(o==0||!this.colorSets[o]){g=this.data;h=this.color}else{g=this.colorSets[o].img.data;h=this.colorSets[o].color}}if(l>=ig.MultiFont.ICON_START&&l<ig.MultiFont.ICON_END&&this.iconSets.length>0){l=this._getActualIndex(l-ig.MultiFont.ICON_START);m=m+this.iconSets[l[0]]._drawChar(l[1],m,c)}else m=ig.Font.systemFont?m+this._drawSystemChar(l,m,
c,h):m+this._drawChar(l-this.firstChar,m,c,g)}ig.Image.drawCount=ig.Image.drawCount+a.length},getCharWidth:function(a){if(a>=ig.MultiFont.ICON_START&&a<ig.MultiFont.ICON_END&&this.iconSets.length>0){a=this._getActualIndex(a-ig.MultiFont.ICON_START);return this.iconSets[a[0]].widthMap[a[1]]+1||0}return ig.Font.systemFont?this.getSystemCharWidth(String.fromCharCode(a)):this.widthMap[a-this.firstChar]+1||0}});ig.MultiFont.ICON_START=2E3;ig.MultiFont.ICON_END=3E3;ig.TextBlock=ig.Class.extend({font:null,
maxWidth:0,parsedText:"",commands:[],speed:0,padding:0,align:ig.Font.ALIGN.LEFT,size:{x:0,y:0,lines:[]},currentLine:0,currentIndex:0,currentCmd:0,currentSpeed:0,timer:0,onFinish:null,prerendered:false,drawCallback:null,init:function(a,b,c){this.font=a;this.speed=c.speed||0;this.align=c.textAlign||ig.Font.ALIGN.LEFT;this.maxWidth=c.maxWidth;this.bestRatio=c.bestRatio;if(ig.LANG_DETAILS[ig.currentLang]&&ig.LANG_DETAILS[ig.currentLang].fixedMsgWidth)this.bestRatio=0;this.linePadding=c.linePadding!=void 0?
c.linePadding:1;this.setText(b);this.reset()},setText:function(a){this.clearPrerendered();a=a||"";typeof a=="object"&&(a=a.toString());a=a.trim();this.commands.length=0;this.parsedText=ig.TextParser.parse(a||"",this.commands,this.font);if(this.maxWidth)this.parsedText=this.font.wrapText(this.parsedText,this.maxWidth,this.linePadding,this.bestRatio,this.commands);this.size=this.font.getTextDimensions(this.parsedText,this.linePadding);this.reset()},setDrawCallback:function(a){this.drawCallback=a;if(this.prerendered){this.clearPrerendered();
this.prerender()}},prerender:function(){if(!this.prerendered){this.prerendered=true;this.buffer=ig.imageAtlas.getFragment(this.size.x,this.size.y,function(){this.font.drawLines(this.parsedText,this.align==ig.Font.ALIGN.LEFT?0:this.align==ig.Font.ALIGN.CENTER?Math.floor(this.size.x/2):this.size.x,0,this.align,this.commands,this.linePadding);this.drawCallback&&this.drawCallback(this.size.x,this.size.y)}.bind(this));this.font.addIconChangeListener(this)}},clearPrerendered:function(){if(this.prerendered){this.buffer.release();
this.buffer=null;this.prerendered=false;this.font.removeIconChangeListener(this)}},reset:function(){if(this.speed){this.currentLine=this.currentIndex=this.currentCmd=this.timer=0;this.currentSpeed=this.speed;this._updateCommands()}else{this.currentLine=this.size.lines.length;this.currentIndex=this.parsedText.length;this.timer=1}},getState:function(){return[this.currentLine,this.currentIndex,this.currentCmd,this.currentSpeed]},setState:function(a){this.currentLine=a[0];this.currentIndex=a[1];this.currentCmd=
a[2];this.currentSpeed=a[3]},setSpeed:function(a){this.currentSpeed=this.speed=a},finish:function(){this.currentIndex=this.parsedText.length;this.timer=this.currentSpeed+0.001;this.currentLine=this.size.lines.length;if(this.onFinish)this.onFinish()},isFinished:function(){return this.currentIndex==this.parsedText.length&&this.timer>this.currentSpeed},_updateCommands:function(){for(;this.currentCmd<this.commands.length&&this.commands[this.currentCmd].index==this.currentIndex;++this.currentCmd){var a=
this.commands[this.currentCmd].command;if(a.brake)this.timer=this.timer-a.brake;if(a.speed!==void 0)this.currentSpeed=a.speed}},update:function(){if(!this.isFinished()){for(this.timer=this.timer+ig.system.actualTick;this.timer>this.currentSpeed&&this.currentIndex<this.parsedText.length;){this.currentIndex++;this.size.lineIdx[this.currentLine+1]==this.currentIndex&&this.currentLine++;this._updateCommands();this.timer=this.timer-this.currentSpeed}if(this.onFinish&&this.isFinished())this.onFinish()}},
draw:function(a,b){a=a||0;b=b||0;if(this.size.x)if(this.prerendered){var c=this.currentLine*(this.font.charHeight+this.linePadding);this.linePadding<0&&(c=c+-this.linePadding);this.currentLine&&this.buffer.draw(a,b,0,0,this.size.x,c);if(this.currentLine<this.size.lines.length){var d=this.font.getLineWidth(this.parsedText,this.size,this.currentIndex);this.align==ig.Font.ALIGN.CENTER?d=d+(this.size.x-this.size.lines[this.currentLine])/2:this.align==ig.Font.ALIGN.RIGHT&&(d=d+(this.size.x-this.size.lines[this.currentLine]));
if(d){var e=Math.max(this.font.charHeight,this.font.charHeight+this.linePadding);this.buffer.draw(a,b+c,0,c,d,e)}}}else{a=this.align==ig.Font.ALIGN.LEFT?a:this.align==ig.Font.ALIGN.CENTER?a+this.size.x/2:a+this.size.x;this.font.drawLines(this.parsedText.substr(0,this.currentIndex),a,b,this.align,this.commands,this.linePadding)}},onIconChange:function(){this.buffer&&this.buffer.invalidate()}});ig.TextParser={bakeVars:function(a){return this.parse(a,null,null,true)},parse:function(a,c,d,e){for(var f=
"",g=0,h=-1;(h=a.indexOf("\\",g))!=-1;){var f=f+a.substring(g,h),g=h+1,i=a.indexOf("[",h),j=a.indexOf("]",h),m=null,n=null;if(i!=-1){m=a.substring(h+1,i);n=b[m]}if(!n){m=a.charAt(h+1);n=b[m]}e&&n!=b.v&&(n=null);if(n)if(n.character){f=f+n.character;g=g+m[1]}else{if(n.argument){if(i!=h+m.length+1||j==-1){f=f+a.charAt(h);ig.warn("Invalid Text command argument format for commant '"+m+"'");continue}h=a.substring(i+1,j);g=j+1;j=n.apply(h,f.length,c,d)}else{g=g+m.length;j=n.apply(f.length,c,d)}j!==void 0&&
j!==null&&(f=f+this.parse(""+j,c,d,e))}else f=f+a.charAt(h)}return f=f+a.substring(g)}};ig.TextBlock.SPEED={SLOWEST:0.1,SLOWER:0.05,SLOW:0.03,NORMAL:0.02,FAST:0.015,FASTER:0.01,FASTEST:0.0075,IMMEDIATE:0};var d=[ig.TextBlock.SPEED.IMMEDIATE,ig.TextBlock.SPEED.FASTEST,ig.TextBlock.SPEED.FASTER,ig.TextBlock.SPEED.FAST,ig.TextBlock.SPEED.NORMAL,ig.TextBlock.SPEED.SLOW,ig.TextBlock.SPEED.SLOWER,ig.TextBlock.SPEED.SLOWEST]});ig.baked=!0;ig.module("impact.base.system.web-audio").requires("impact.base.loader").defines(function(){ig.WebAudio=
ig.Class.extend({context:null,timeOffset:0,init:function(){this.context=this._createContext()},getDestination:function(){return this.context.destination},getSampleRate:function(){return this.context.sampleRate},decodeAudioData:function(a,b,c){this.context.decodeAudioData(a,b,c)},getCurrentTime:function(){return this.context.currentTime+this.timeOffset},getCurrentTimeRaw:function(){return this.context.currentTime},createGain:function(){if(this.context.createGainNode)return this.context.createGainNode();
if(this.context.createGain)return this.context.createGain()},createDynamicCompressor:function(){return!this.context.createDynamicsCompressor?null:this.context.createDynamicsCompressor()},createPanner:function(){if(this.context.createPanner)return this.context.createPanner()},createBufferGain:function(a,b,c){return new ig.WebAudioBufferGain(this.context,a,b,c)},_createContext:function(){return new (window.AudioContext||window.webkitAudioContext)}});ig.WebAudio.isSupported=function(){return!!window.AudioContext||
!!window.webkitAudioContext};ig.WebAudioBufferGain=function(a,b,c,d){this.context=a;this.bufferNode=this.context.createBufferSource();this.bufferNode.buffer=b;this.bufferNode.playbackRate.value=d||1;this.gainNode=this.context.createGain();c!==void 0&&this.setVolume(c);this.bufferNode.connect(this.gainNode)};var a=ig.WebAudioBufferGain.prototype;a.connect=function(a){this.gainNode.connect(a)};a.disconnect=function(a){this.gainNode.disconnect(a)};a.setLoop=function(a){this.bufferNode.loop=a};a.setVolume=
function(a){this.gainNode.gain.value=a};a.play=function(a,b){var c=this.bufferNode;if(!c.playbackState){b<0&&(b=0);c.start?c.start(a||0,b||0):c.noteOn(a||0,b||0)}};a.stop=function(a){var b=this.bufferNode;b.playbackState&&(b.stop?b.stop(a):b.noteOff(a))}});ig.baked=!0;ig.module("impact.base.sound").requires("impact.base.loader","impact.base.system.web-audio").defines(function(){function a(b){b=ig.root+b.match(/^(.*)\.[^\.]+$/)[1]+"."+ig.soundManager.format.ext+ig.getCacheSuffix();return ig.getFilePath(b)}
var b=0,c=2/60,d=e.create(),f=g.create(),h={};ig.GlobalVolume={set:function(a,b){var c=ig.root+a.match(/^(.*)\.[^\.]+$/)[1];h[c]=b},get:function(a){a=ig.root+a.match(/^(.*)\.[^\.]+$/)[1];return h[a]!==void 0?h[a]:1}};ig.SOUND_VOLUME_MAP={};ig.MUSIC_VOLUME_MAP={};ig.SOUND_ENABLE_LOG=false;ig.SOUND_RANGE_TYPE={CIRULAR:1,HORIZONTAL:2,VERTICAL:3};ig.SoundManager=ig.Class.extend({clips:{},volume:1,format:null,context:null,buffers:{},volumes:{master:null,music:null,sound:null},namedSounds:{},soundHandles:[],
soundStack:[[]],soundGroups:{},requestedGroups:[],tracksToUpdate:[],hasWebAudio:false,init:function(){if(!ig.Sound.enabled||!window.Audio)ig.Sound.enabled=false;else{if(window.IG_SOUND_VOLUME!=void 0)this.volume=window.IG_SOUND_VOLUME;for(var a=new window.Audio,b=0;b<ig.Sound.use.length;b++){var c=ig.Sound.use[b];if(a.canPlayType(c.mime)){this.format=c;break}}if(!this.format)ig.Sound.enabled=false;if(ig.Sound.enabled&&ig.WebAudio.isSupported()){this._createWebAudioContext();window.IG_WEB_AUDIO_BGM?
ig.debug("WebAudio detected. Using full WebAudio Implementation."):window.IG_WEB_AUDIO_BGM||ig.debug("WebAudio (No BGM) detected. Using sound-only WebAudio Implementation.")}else ig.debug("No WebAudio. Using default Audio Implementation");setInterval(this._updateTracks.bind(this),16)}},reset:function(){for(var a=this.soundHandles.length;a--;)this.soundHandles[a].stop();this.soundStack.length=1;this.soundStack[0].length=0},update:function(){this.context&&this.context.context.state=="suspended"&&this.context.context.resume();
for(var a=this.requestedGroups.length;a--;)this._solveGroupRequests(this.requestedGroups[a])&&this.requestedGroups.splice(a,1);for(var a=this.soundHandles.length,b=null;a--;)(b=this.soundHandles[a])&&b.update()&&this.soundHandles.splice(a,1)},playSoundHandle:function(a,b){a.group=b;b.playing.push(a);a.stack=this.soundStack.last();a.stack.push(a);ig.soundManager.soundHandles.push(a);a.play()},stopSoundHandle:function(a){this.soundStack.last().erase(a);if(a.group){a.group.playing.erase(a);a.group=null}if(a.stack){a.stack.erase(a);
a.stack=null}},pushPaused:function(a){for(var b=this.soundStack.last(),c=b.length;c--;){var d=b[c];d.pause(a);d.group&&d.group.playing.erase(d);a&&this.soundHandles.erase(d)}this.soundStack.push([])},popPaused:function(){if(this.soundStack.length!=1){for(var a=this.soundStack.pop(),b=this.soundStack.last(),c=b.length;c--;){var d=b[c];d.play();d.group&&d.group.playing.push(d);this.soundHandles.indexOf(d)==-1&&this.soundHandles.push(d)}for(c=a.length;c--;){d=a[c];d.stack=b;b.push(d)}a.length=0}},_getGroup:function(a){var b=
this.soundGroups[a];b||(this.soundGroups[a]=b={requests:[],playing:[]});return b},_solveGroupRequests:function(a){if(a.playing.length>0&&a.playing[a.playing.length-1].getPlayTime()<c)return false;for(var b=a.requests,f=b.length;f--;)if(b[f].isLooping()){this.playSoundHandle(b[f],a);b.splice(f,1)}for(var g,f=b.length,h=-1;f--;){var i;i=b[f];if(i.pos){e.assign(d,i.pos.point);e.sub(d,ig.game.soundPos);i=e.length(d)}else i=0;if(h==-1||i<h){h=i;g=b[f]}}for(f=a.playing.length;f--;)a.playing[f].isLooping()||
a.playing[f].stop();g&&this.playSoundHandle(g,a);b.length=0;return true},requestPlaySoundHandle:function(a,b){var c=this._getGroup(a);c.requests.push(b);this.requestedGroups.indexOf(c)==-1&&this.requestedGroups.push(c)},getSampleRate:function(){return this.context&&this.context.getSampleRate()||0},_createWebAudioContext:function(){this.hasWebAudio=true;this.context=new ig.WebAudio;var a=this.context.createGain(),b=this.context.createGain(),c=this.context.createGain(),d=a,e=this.context.createDynamicCompressor();
if(e){e.threshold.value=-6;e.knee.value=0;e.ratio.value=20;e.attack.value=0;e.release.value=0.2;d=this.context.createGain();d.gain.value=0.8;d.connect(a);e.connect(d);d=e}b.connect(a);c.connect(d);a.connect(this.context.getDestination());this.volumes.sound=c;this.volumes.music=b;this.volumes.master=a},connectSound:function(a){a&&a.connect(this.volumes.sound)},disconnectSound:function(a){a&&a.disconnect(this.volumes.sound)},connectMusic:function(a){a&&a.connect(this.volumes.music)},disconnectMusic:function(a){a&&
a.disconnect(this.volumes.music)},setSoundVolume:function(a){a&&this.hasWebAudio&&(this.volumes.sound.gain.value=a)},setMusicVolume:function(a){a&&this.hasWebAudio&&(this.volumes.music.gain.value=a)},setMasterVolume:function(a){a&&this.hasWebAudio&&(this.volumes.master.gain.value=a)},onWindowFocusLost:function(){this.pushPaused(true)},onWindowFocusGained:function(){this.popPaused()},addNamedSound:function(a,b){this.namedSounds[a]||(this.namedSounds[a]=[]);this.namedSounds[a].push(b)},getNamedSounds:function(a){return this.namedSounds[a]},
stopNamedSounds:function(a){var b=this.getNamedSounds(a);if(b){for(var c=b.length;c--;)b[c].stop();delete this.namedSounds[a]}},getBuffer:function(a){return this.buffers[a]},loadWebAudio:function(c,d){var e=a(c);ig.SOUND_ENABLE_LOG&&ig.log("%cREQUEST%c: "+e,"color:#FF0080","");if(this.buffers[c]){d&&d(c,true);return this.buffers[c]}var f=new XMLHttpRequest;f.open("GET",e,true);f.responseType="arraybuffer";f.onload=function(){ig.SOUND_ENABLE_LOG&&ig.log("%cLOADED%c:  "+e,"color:#C60063","");ig.soundManager.context.decodeAudioData(f.response,
function(a){ig.SOUND_ENABLE_LOG&&ig.log("%cDECODED%c: "+e,"color:#800080","");if(a){b++;ig.soundManager.buffers[c]=a;d&&d(c,true)}else ig.system.error(Error("Web Audio Load Error: Decoded but NULL "+c))},function(){ig.system.error(Error("Web Audio Load Error: Could not DECODE: "+c))})};f.onerror=function(){ig.system.error(Error("Web Audio Load Error: Could not LOAD: "+c))};f.send()},registerTrack:function(a){a&&this.tracksToUpdate.indexOf(a)==-1&&this.tracksToUpdate.push(a)},unregisterTrack:function(a){a&&
this.tracksToUpdate.erase(a)},_updateTracks:function(){for(var a=this.tracksToUpdate.length;a--;)this.tracksToUpdate[a].checkForEndCallback()},load:function(c,d,e){var f=a(c);if(this.clips[c]){this._increaseChannels(c,f,d,false);e&&e(c,d,true)}else{var g,h=false;b++;if(ig.system.limitSoundUse&&b>25){g=new Audio;h=true;e&&e(c,d,true)}else g=new window.Audio(f);if(e){var i=function(a){this.removeEventListener("canplaythrough",i,false);e(c,d,true,a)};g.addEventListener("canplaythrough",i,false);g.addEventListener("error",
function(a){e(c,d,true,a)},false)}g.load();this.clips[c]=[g];this._increaseChannels(c,f,d,h)}},_increaseChannels:function(a,b,c,d){for(var e=this.clips[a];e.length<c;){var f=d?new Audio:new Audio(b);f.load();this.clips[a].push(f)}},get:function(a){for(var a=this.clips[a],b=0,c;c=a[b++];)if(c.paused||c.ended){if(c.ended)c.currentTime=0;return c}if(!isNaN(a[0].duration)){a[0].pause();a[0].currentTime=0;return a[0]}},getChannel:function(a,b){return this.clips[a][b]},freeMultiAudio:function(a){delete this.clips[a]},
freeWebAudioBuffer:function(a){delete this.buffers[a]}});ig.MultiAudio=ig.Loadable.extend({cacheType:"MultiAudio",channelCount:0,init:function(a,b){this.channelCount=b;this.parent(a,b)},get:function(){return ig.soundManager.get(this.path)},getChannel:function(a){return ig.soundManager.getChannel(this.path,a)},onCacheCleared:function(){ig.soundManager.freeMultiAudio(this.path)},loadInternal:function(){ig.soundManager.load(this.path,this.channelCount,this.onload.bind(this))},onload:function(a,b,c){this.loadingFinished(c)}});
ig.WebAudioBuffer=ig.Loadable.extend({cacheType:"WebAudioBuffer",init:function(a){this.parent(a)},get:function(){return ig.soundManager.getBuffer(this.path)},onCacheCleared:function(){ig.soundManager.freeWebAudioBuffer(this.path)},loadInternal:function(){ig.soundManager.loadWebAudio(this.path,this.onload.bind(this))},onload:function(a,b){this.loadingFinished(b)}});ig.Music=ig.Class.extend({inBetweenTrack:null,currentTrack:null,trackStack:[],paused:false,_volume:1,_interval:0,_timer:null,_fadeInTime:0,
_nextTrackReset:false,_transitionType:0,init:function(){if(window.IG_MUSIC_VOLUME!=void 0)this._volume=window.IG_MUSIC_VOLUME;if(Object.defineProperty)Object.defineProperty(this,"volume",{get:this.getVolume.bind(this),set:this.setVolume.bind(this)});else if(this.__defineGetter__){this.__defineGetter__("volume",this.getVolume.bind(this));this.__defineSetter__("volume",this.setVolume.bind(this))}},play:function(a,b,c,d,e){if(this.trackStack.length==0)this.push(a,b,c,d,e);else{this.trackStack.pop();
this._pushNextTrack(a,e,d);a=this._checkCurrentTrackEquality();d=this.paused;this.paused=false;if(!a){this._fadeInTime=c||0;this._nextTrackReset=true;this._setFadeOut(b,d)}}},push:function(a,b,c,d,e){this._pushNextTrack(a,e,d);a=this._checkCurrentTrackEquality();d=this.paused;this.paused=false;if(!a){this._fadeInTime=c||0;this._nextTrackReset=true;this._setFadeOut(b,d)}},pop:function(a,b){if(this.trackStack.length!=0){this.trackStack.pop();var c=this._checkCurrentTrackEquality(),d=this.paused;this.paused=
false;if(!c){this._fadeInTime=b||0;this._nextTrackReset=false;this._setFadeOut(a,d)}}},inbetween:function(a,b,c,d){if(this.inBetweenTrack&&this.inBetweenTrack.track){this.inBetweenTrack.track.pause();this.inBetweenTrack.track.endCallback=null}this.inBetweenTrack={track:a,fadeInTime:c};this._fadeInTime=c;this._nextTrackReset=false;a.loop=false;a.setVolume(this._volume*(d||1));a.reset();a.play();a.endCallback=this._trackEnded.bind(this);this._setFadeOut(b)},pause:function(a){this.paused=true;this._setFadeOut(a)},
resume:function(a){this._nextTrackReset=this.paused=false;this._fadeInTime=a;this._playTopSong()},getStackSize:function(){return this.trackStack.length},isTrackPlaying:function(a,b){var c=this._getTopTrack();return!this.paused&&c&&c.track==a&&(b===void 0||c.volume==b)},getVolume:function(){return this._volume},setVolume:function(a){this._volume=a.limit(0,1);this._transitionType==0&&this.currentTrack&&this.currentTrack.track&&this.currentTrack.track.setVolume(this._volume*this.currentTrack.volume);
this.inBetweenTrack&&this.inBetweenTrack.track&&this.inBetweenTrack.track.setVolume(this._volume*this.currentTrack.volume)},_checkCurrentTrackEquality:function(){var a=this._getTopTrack();if(!this.paused&&a&&a.track&&this.currentTrack&&this.currentTrack.track==a.track){if(this._transitionType==0){a.track.setVolume(this._volume*a.volume);this._endFadeIn()}else if(this._transitionType==1)this._timer.set(0.5,true);else if(this._transitionType==2){this._timer.set(0.5,true);this._timer.reverseRelativeDelta();
this.currentTrack.track.play();this._transitionType=1}this.currentTrack=a;return true}return false},_getTopTrack:function(){return this.trackStack.length?this.trackStack[this.trackStack.length-1]:null},_pushNextTrack:function(a,b,c){this.trackStack.push({track:a,stopOnEnd:b||false,timeOnPush:0,volume:c||1})},_setFadeOut:function(a,b){if(b)this._transitionType==2?this._timer.set(a,true):this._playTopSong();else if(a&&this.currentTrack&&this.currentTrack.track)if(this._transitionType==2)this._timer.set(a,
true);else if(this._transitionType==1){this._timer.set(a,true);this._timer.reverseRelativeDelta();this._transitionType=2}else{this._transitionType=2;this._timer=new ig.Timer(a);this._startInterval()}else this._playTopSong()},_startInterval:function(){if(!this._interval)this._interval=setInterval(this._intervalStep.bind(this),16)},_intervalStep:function(){if(!ig.system.windowFocusLost){var a=!this._timer?1:this._timer.delta().map(-this._timer.target,0,0,1).limit(0,1),b=this.currentTrack;if(b&&b.track){var c=
this._transitionType==1?a:a.map(1,0,0,1);b.track.setVolume(c*this._volume*b.volume)}a>=1&&(this._transitionType==1?this._endFadeIn():this._transitionType==2&&this._playTopSong())}},_playTopSong:function(){this.currentTrack&&this.currentTrack.track&&this.currentTrack.track.pause();if(this.inBetweenTrack||this.paused)this._endFadeIn();else if((this.currentTrack=this._getTopTrack())&&this.currentTrack.track){this._transitionType=1;this.currentTrack.track.loop=!this.currentTrack.stopOnEnd;this._fadeInTime?
this.currentTrack.track.setVolume(0):this.currentTrack.track.setVolume(this._volume*this.currentTrack.volume);this._nextTrackReset&&this.currentTrack.track.reset();this.currentTrack.track.play();this._timer=new ig.Timer(this._fadeInTime);this._startInterval()}else this._endFadeIn()},_endFadeIn:function(){clearInterval(this._interval);this._interval=null;this._transitionType=0},_trackEnded:function(){if(this.inBetweenTrack){this.inBetweenTrack=this.inBetweenTrack.track.endCallback=null;this._playTopSong()}},
onWindowFocusLost:function(){this.inBetweenTrack&&this.inBetweenTrack.track&&this.inBetweenTrack.track.pause();this.currentTrack&&this.currentTrack.track&&this.currentTrack.track.pause()},onWindowFocusGained:function(){this.inBetweenTrack&&this.inBetweenTrack.track&&this.inBetweenTrack.track.play();!this.inBetweenTrack&&(this.currentTrack&&this.currentTrack.track&&!this.paused)&&this.currentTrack.track.play()}});ig.TrackDefault=ig.Cacheable.extend({cacheType:"TrackDefault",multiAudio:null,introMultiAudio:null,
loopEnd:0,introEnd:0,endCallback:null,baseVolume:1,sound:null,swapSound:null,introSound:null,introPlayed:false,loop:true,init:function(a,b,c,d,e){this.parent();this.multiAudio=new ig.MultiAudio(a,2);this.introMultiAudio=c?new ig.MultiAudio(c,1):null;this.loopEnd=b;this.introEnd=d||0;this.introPlayed=this.introEnd==0;if(e!=void 0)this.baseVolume=e},getCacheKey:function(a,b,c,d){return Array.prototype.join.call(arguments,"|")},onCacheCleared:function(){this.multiAudio.decreaseRef();this.introMultiAudio&&
this.introMultiAudio.decreaseRef()},setVolume:function(a){this._initSounds();a=a*a*this.baseVolume;this.sound.volume=a;this.swapSound.volume=a;this.introSound&&(this.introSound.volume=a)},getVolume:function(){this._initSounds();return this.sound.volume},reset:function(){this._initSounds();try{this.introPlayed=this.introEnd==0;this.sound.currentTime=0;this.swapSound.currentTime=0;this.swapSound.pause();this.sound.pause();this.introSound&&(this.introSound.currentTime=0)}catch(a){}},play:function(){this._initSounds();
this.introPlayed?this.sound.play():this.introSound.play()},pause:function(){this._initSounds();this.introPlayed?this.sound.pause():this.introSound.pause()},_initSounds:function(){if(!this.sound){this.sound=this.multiAudio.getChannel(0);this._initSound(this.sound);this.swapSound=this.multiAudio.getChannel(1);this._initSound(this.swapSound);if(this.introMultiAudio){this.introSound=this.introMultiAudio.getChannel(0);this._initSound(this.introSound)}}},_initSound:function(a){a.loop=false;a.addEventListener("timeupdate",
this._timeUpdateCallback.bind(this),false);a.addEventListener("ended",this._endedCallback.bind(this),false)},_endedCallback:function(a){a.target==this.sound?this._loopTrack():a.target==this.introSound&&this._endIntro()},_timeUpdateCallback:function(a){a.target==this.sound&&this.sound.currentTime>=this.loopEnd-0.2?this._loopTrack():a.target==this.introSound&&this.introSound.currentTime>=this.introEnd-0.2&&this._endIntro()},_loopTrack:function(){if(this.loop){var a=this.sound;this.sound=this.swapSound;
this.swapSound=a;this.sound.currentTime=0;this.sound.play()}else this.endCallback&&this.endCallback(this)},_endIntro:function(){if(!this.introPlayed){this.sound.currentTime=0;this.sound.play();this.introPlayed=true}}});ig.TrackWebAudio=ig.Cacheable.extend({cacheType:"TrackWebAudio",bufferHandle:null,introBufferHandle:null,loopEnd:0,introEnd:0,endCallback:null,baseVolume:1,loop:true,playing:false,soundBuffer:null,introBuffer:null,currentNode:null,nextNode:null,introNode:null,_context:null,_volume:1,
_startTime:0,_pauseTime:-1,_loopCount:0,_nextOffset:0,_introBufferDuration:0,init:function(a,b,c,d,e){this.parent();this.bufferHandle=new ig.WebAudioBuffer(a);this.introBufferHandle=c?new ig.WebAudioBuffer(c):null;this.loopEnd=b;this.introEnd=d||0;if(e!=void 0)this.baseVolume=e},getCacheKey:function(a,b,c,d){return Array.prototype.join.call(arguments,"|")},onCacheCleared:function(){this.bufferHandle.decreaseRef();this.introBufferHandle&&this.introBufferHandle.decreaseRef();this.introBuffer=this.soundBuffer=
this.introBufferHandle=this.bufferHandle=null},_initAudioBuffers:function(){if(!this.soundBuffer){this._context=ig.soundManager.context;this.soundBuffer=this.bufferHandle.get();if(this.introBufferHandle){this.introBuffer=this.introBufferHandle.get();this._introBufferDuration=this.introBuffer.duration}this._nextOffset=Math.max(0,this.soundBuffer.duration-this.loopEnd)}},checkForEndCallback:function(){if(this.bufferHandle){this._initAudioBuffers();this._context.getCurrentTime()>this._startTime+this.introEnd+
(this._loopCount+1)*this.loopEnd&&this.endCallback&&this.endCallback(this);if(this._context.getCurrentTime()>this._startTime+this.introEnd+(this._loopCount+1)*this.loopEnd+this._nextOffset){if(!this.loop){this._clearNodes();ig.soundManager.unregisterTrack(this);return}var a=this._context.createBufferGain(this.soundBuffer,this._volume);this.currentNode.stop(0);ig.soundManager.disconnectMusic(this.currentNode);delete this.currentNode;this.currentNode=this.nextNode;this.nextNode=a;this._loopCount++;
a=this._startTime+this.introEnd+(this._loopCount+1)*this.loopEnd;ig.soundManager.connectMusic(this.nextNode);this.nextNode.play(a)}if(this.introNode&&this._context.getCurrentTime()>this._startTime+this._introBufferDuration){this.introNode.stop(0);ig.soundManager.disconnectMusic(this.introNode);delete this.introNode}}},setVolume:function(a){this._volume=a*a*this.baseVolume;this.currentNode&&this.currentNode.setVolume(this._volume);this.nextNode&&this.nextNode.setVolume(this._volume);this.introNode&&
this.introNode.setVolume(this._volume)},getVolume:function(){return this._volume},reset:function(){this._clearNodes();this.playing=false;this._startTime=0;this._pauseTime=-1;this._loopCount=0;ig.soundManager.unregisterTrack(this)},_recreateNodes:function(){if(this.bufferHandle){this._initAudioBuffers();this.currentNode&&ig.soundManager.disconnectMusic(this.currentNode);this.introNode&&ig.soundManager.disconnectMusic(this.introNode);this.nextNode&&ig.soundManager.disconnectMusic(this.nextNode);this.nextNode=
this.introNode=this.currentNode=null;if(this.introBufferHandle)this.introNode=this._context.createBufferGain(this.introBuffer,this._volume);this.currentNode=this._context.createBufferGain(this.soundBuffer,this._volume);if(this.loop)this.nextNode=this._context.createBufferGain(this.soundBuffer,this._volume);ig.soundManager.connectMusic(this.introNode);ig.soundManager.connectMusic(this.currentNode);ig.soundManager.connectMusic(this.nextNode)}},_clearNodes:function(){if(this.introNode){this.introNode.stop(0);
ig.soundManager.disconnectMusic(this.introNode);delete this.introNode}if(this.currentNode){this.currentNode.stop(0);ig.soundManager.disconnectMusic(this.currentNode);delete this.currentNode}if(this.nextNode){this.nextNode.stop(0);ig.soundManager.disconnectMusic(this.nextNode);delete this.nextNode}},play:function(){if(this.bufferHandle&&!this.playing&&this.bufferHandle.loaded){this.playing=true;this._recreateNodes();if(this._pauseTime<0){this._startTime=this._context.getCurrentTime();if(this._introBufferDuration){this.introNode.play(0);
this.currentNode.play(this._startTime+this.introEnd);this.loop&&this.nextNode.play(this._startTime+this.loopEnd+this.introEnd)}else{this.currentNode.play(0);this.loop&&this.nextNode.play(this._startTime+this.loopEnd)}}else{var a=this._context.getCurrentTime();this._startTime=this._startTime+(a-this._pauseTime);a=Math.max(a-this._startTime,0);if(a<this._introBufferDuration){this.introNode.play(0,a);a<this.introEnd?this.currentNode.play(this._startTime+this.introEnd):this.currentNode.play(0,a-this.introEnd);
this.loop&&this.nextNode.play(this._startTime+this.loopEnd+this.introEnd)}else{for(a=a-this.introEnd;a>this.loopEnd+this._nextOffset;)a=a-this.loopEnd;this.currentNode.play(0,a);if(this.loop)if(a>this.loopEnd){a=a-this.loopEnd;this.nextNode.play(0,a)}else this.nextNode.play(this._startTime+this.loopEnd*(this._loopCount+1)+this.introEnd)}}ig.soundManager.registerTrack(this)}},pause:function(){if(this.bufferHandle&&this.playing){this._clearNodes();this._pauseTime=this._context.getCurrentTime();this.playing=
false;ig.soundManager.unregisterTrack(this)}}});ig.SoundDefault=ig.Class.extend({group:null,multiAudio:null,volume:1,currentClip:null,multiChannel:true,init:function(a,b,c,d){this.multiAudio=new ig.MultiAudio(a,ig.Sound.channels);this.volume=b||1;this.group=d||a},clone:function(){return new ig.SoundDefault(this.multiAudio.path,this.volume,0,this.group)},clearCached:function(){this.multiAudio.decreaseRef()},play:function(a){if(!ig.Sound.enabled)return null;this.currentClip=this.multiAudio.get();if(!isNaN(this.currentClip.duration)){var b=
ig.soundManager.volume*this.volume*ig.GlobalVolume.get(this.multiAudio.path),a=new ig.SoundHandle(this.currentClip,0,0,a,b);ig.soundManager.requestPlaySoundHandle(this.group,a);return a}return null},stop:function(){ig.warn("Called stop on Default Sound.")}});ig.SoundWebAudio=ig.Class.extend({group:null,webAudioBuffer:null,volume:1,variance:0,init:function(a,b,c,d){this.webAudioBuffer=new ig.WebAudioBuffer(a);this.volume=b||1;this.variance=c||0;this.group=d||a},clone:function(){return new ig.SoundWebAudio(this.webAudioBuffer.path,
this.volume,this.variance,this.group)},clearCached:function(){this.webAudioBuffer.decreaseRef()},play:function(a,b){var c=0,d=0,e=1,f=0;if(b){c=b.offset||0;d=b.startTime||0;e=b.speed||1;f=b.fadeDuration}this.variance&&(e=e*(1+(Math.random()-0.5)*2*this.variance));if(!ig.Sound.enabled)return null;var g=this.webAudioBuffer.get();if(!isNaN(g.duration)){var h=ig.soundManager.volume*this.volume*ig.GlobalVolume.get(this.webAudioBuffer.path),c=new ig.SoundHandle(g,c,d,a,h,e,f);ig.soundManager.requestPlaySoundHandle(this.group,
c);return c}return null},stop:function(){ig.warn("Called stop on WebAudio Sound.")}});ig.SoundHandleBase=ig.Class.extend({pos:null,setFixPosition:function(a,b,c){this.pos={point:e.createC(a.x,a.y-(a.z||0)),entity:null,align:null,offset:null,range:b||1600,rangeType:c||ig.SOUND_RANGE_TYPE.CIRCULAR}},setEntityPosition:function(a,b,c,d,f){this.pos={point:e.createC(0,0),entity:a,align:b,offset:c,range:d||1600,rangeType:f||ig.SOUND_RANGE_TYPE.CIRCULAR};this._updateEntityPos(true)},_updateEntityPos:function(a){if(this.pos&&
this.pos.entity)if(a||!this.pos.entity._killed){a=this.pos.entity.getAlignedPos(this.pos.align,f);this.offset&&g.add(a,this.offset);this.pos.point.x=a.x;this.pos.point.y=a.y-a.z}else this.pos.entity=null}});ig.SoundHandleDefault=ig.SoundHandleBase.extend({group:null,position:null,_time:0,_duration:0,_offset:0,_startTime:0,_clip:null,init:function(a,b,c,d,e){this._offset=b||0;this._startTime=c||0;this._duration=a.duration;a.volume=(e*e).limit(0,1);a.loop=d||false;this._clip=a},update:function(){if(this._clip.loop)return false;
this._time=this._time+ig.system.actualTick;if(this._time>=this._duration){ig.soundManager.stopSoundHandle(this);return true}return false},setSize:function(){},play:function(){this._clip.play()},stop:function(){ig.soundManager.stopSoundHandle(this);try{this._clip.volume=0;this._clip.loop=false;if(this._duration-this._clip.currentTime>0.8)this._clip.currentTime=this._duration}catch(a){}this._time=this._duration},isLooping:function(){return this._clip.loop},getPlayTime:function(){return this._clip.currentTime},
pause:function(){this._clip.pause()},onActionEndDetach:function(){this.stop()},onEntityKillDetach:function(){this.stop()}});var i=e.createC(0,0);ig.SoundHandleWebAudio=ig.SoundHandleBase.extend({group:null,_buffer:null,_volume:0,_speed:0,_time:0,_duration:0,_offset:0,_startTime:0,_nodeSource:null,_nodePosition:null,_loop:false,_width:0,_height:0,_playing:false,_fadeTimer:0,_fadeIn:false,_fadeDuration:0,_contextTimeOnStart:0,_contextTimeOnPause:-1,init:function(a,b,c,d,e,f,g){this._offset=b||0;this._startTime=
c||0;this._duration=a.duration/f;this._loop=d||false;this._buffer=a;this._volume=e;this._speed=f;this._fadeDuration=g||0.1;this._doPanning=this._duration>=1||this._loop},update:function(){this._doPanning&&this._setPosition();if(!this._loop&&this._contextTimeOnPause==-1&&ig.soundManager.context.getCurrentTime()-this._contextTimeOnStart>=this._duration){ig.soundManager.stopSoundHandle(this);this._buffer=null;this._disconnect();return true}if(this._fadeTimer){this._fadeTimer=this._fadeTimer-ig.system.rawTick;
if(this._fadeTimer<=0){this._fadeTimer=0;if(!this._fadeIn){this._disconnect();return true}}if(this._nodeSource){var a=this._fadeTimer/this._fadeDuration;this._fadeIn&&(a=1-a);this._nodeSource.setVolume(this._volume*this._volume*a*a)}}return false},isLooping:function(){return this._loop},setSize:function(a,b){this._width=a||0;this._height=b||0},play:function(){if(!this._playing&&this._buffer){var a=ig.soundManager.context;if(this.pos&&!this._nodePosition){this._nodePosition=a.createPanner();this._nodePosition.panningModel=
"equalpower";this._nodePosition.distanceModel="linear";this._nodePosition.refDistance=0.1*this.pos.range;this._nodePosition.maxDistance=this.pos.range;this._setPosition()}if(this._nodeSource){this._fadeTimer=this._fadeDuration-this._fadeTimer;this._fadeIn=true}else{var b=0;if(this._contextTimeOnPause==-1){this._contextTimeOnStart=a.getCurrentTime();this._fadeIn=false}else{var b=(this._contextTimeOnPause-this._contextTimeOnStart)*this._speed%this._duration,c=a.getCurrentTime();this._contextTimeOnStart=
this._contextTimeOnStart+(c-this._contextTimeOnPause);this._contextTimeOnPause=-1;this._fadeIn=true;this._fadeTimer=this._fadeDuration}this._nodeSource=a.createBufferGain(this._buffer,this._fadeIn?0:this._volume*this._volume,this._speed);this._nodeSource.setLoop(this._loop);if(this._nodePosition){this._nodeSource.connect(this._nodePosition);ig.soundManager.connectSound(this._nodePosition)}else ig.soundManager.connectSound(this._nodeSource);this._nodeSource.play(a.getCurrentTimeRaw()+this._startTime,
this._offset+b)}this._playing=true}},stop:function(){this.pause();this._buffer=null;ig.soundManager.stopSoundHandle(this)},_disconnect:function(){if(this._nodeSource){this._nodeSource.stop(0);if(this._nodePosition){this._nodeSource.disconnect(this._nodePosition);ig.soundManager.disconnectSound(this._nodePosition)}else ig.soundManager.disconnectSound(this._nodeSource);this._nodeSource=null}},getPlayTime:function(){return ig.soundManager.context.getCurrentTime()-this._contextTimeOnStart},pause:function(a){if(this._playing){this._contextTimeOnPause=
ig.soundManager.context.getCurrentTime();this._playing=false;if(a){this._disconnect();this._fadeTimer=0}else this._fadeTimer=this._fadeDuration;this._fadeIn=false}},_setPosition:function(){if(this.pos){this._updateEntityPos();if(this._nodePosition){var a=this.pos.range*0.1,b=this.pos.range*0.9;i.x=this.pos.point.x-ig.game.soundPos.x;i.y=this.pos.point.y-ig.game.soundPos.y;if(ig.SOUND_RANGE_TYPE[this.pos.rangeType]==ig.SOUND_RANGE_TYPE.HORIZONTAL)i.x=0;else if(ig.SOUND_RANGE_TYPE[this.pos.rangeType]==
ig.SOUND_RANGE_TYPE.VERTICAL)i.y=0;var c=e.length(i),c=c<a?0:KEY_SPLINES.EASE_SOUND.get(((c-a)/b).limit(0,1))*this.pos.range;e.length(i,c);this._nodePosition.setPosition(i.x,i.y,-0.1*this.pos.range)}}},onActionEndDetach:function(){this.stop()},onEntityKillDetach:function(){this.stop()}});var j=e.create();ig.SoundHelper={playAtEntity:function(a,b,c,d,f,g){if(a){var h=b.coll;e.assignC(j,h.pos.x+h.size.x/2,h.pos.y+h.size.y/2-(h.pos.z+h.size.z/2));(a=a.play(c,d))&&a.setEntityPosition(b,ig.ENTITY_ALIGN.CENTER,
null,f,g);return a}}};var m=localStorage.getItem("options.useWebAudio")!="false",m=ig.WebAudio.isSupported()&&!window.IG_FORCE_HTML5_AUDIO&&m;ig.nwjsVersion&&ig.nwjsVersion[1]>=3E3&&(m=true);if(m){ig.Sound=ig.SoundWebAudio;ig.SoundHandle=ig.SoundHandleWebAudio;ig.webAudioActive=true;ig.Track=(ig.platform==ig.PLATFORM_TYPES.BROWSER||window.IG_GAME_DEBUG)&&!window.IG_WEB_AUDIO_BGM?ig.TrackDefault:ig.TrackWebAudio}else{ig.webAudioActive=false;ig.Sound=ig.SoundDefault;ig.SoundHandle=ig.SoundHandleDefault;
ig.Track=ig.TrackDefault;ig.log("SET DEFAULT TRACK!")}ig.Sound.FORMAT={MP3:{ext:"mp3",mime:"audio/mpeg"},M4A:{ext:"m4a",mime:"audio/mp4; codecs=mp4a"},OGG:{ext:"ogg",mime:"audio/ogg; codecs=vorbis"},WEBM:{ext:"webm",mime:"audio/webm; codecs=vorbis"},CAF:{ext:"caf",mime:"audio/x-caf"}};ig.Sound.use=[ig.Sound.FORMAT.OGG,ig.Sound.FORMAT.MP3];ig.Sound.channels=4;ig.Sound.enabled=true});ig.baked=!0;ig.module("impact.base.timer").defines(function(){ig.Timer=ig.Class.extend({target:0,base:0,last:0,stopped:false,
init:function(a){this.last=this.base=ig.Timer.time;this.target=a||0},set:function(a,b){if(b&&this.target>0){var c=1+Math.min(0,this.delta()/this.target);this.base=ig.Timer.time-a*c}else this.base=ig.Timer.time;this.target=a||0},reverseRelativeDelta:function(){var a=Math.min(1,-this.delta()/this.target);this.base=ig.Timer.time-this.target*a},stop:function(){if(!this.stopped){this.stopped=true;this.last=ig.Timer.time}},resume:function(){if(this.stopped){this.stopped=false;this.base=ig.Timer.time-(this.last-
this.base);this.last=ig.Timer.time}},reset:function(){this.base=ig.Timer.time;this.stopped=false},tick:function(){if(this.stopped)return 0;var a=ig.Timer.time-this.last;this.last=ig.Timer.time;return a},weight:function(){return Math.max(0,(this.target-((this.stopped?this.last:ig.Timer.time)-this.base))/this.target)},delta:function(){return(this.stopped?this.last:ig.Timer.time)-this.base-this.target}});ig.Timer._last=0;ig.Timer.time=0;ig.Timer.timeScale=1;ig.Timer.maxStep=1/30;ig.Timer.step=function(){var a=
Date.now();ig.Timer.time=ig.Timer.time+Math.min((a-ig.Timer._last)/1E3,ig.Timer.maxStep)*ig.Timer.timeScale;ig.Timer._last=a};ig.TIMER_MODE={ONCE:0,REPEAT:1,BLINK:2,SINUS:3,SINUS_RND:4};ig.WeightTimer=ig.Class.extend({duration:0,timer:0,actualTick:false,mode:ig.TIMER_MODE.ONCE,repeatCount:0,_rndBool:false,init:function(a,b,c){this.actualTick=a||false;this.set(b,c)},set:function(a,b){this.duration=a;this.mode=b||ig.TIMER_MODE.ONCE;this.repeatCount=this.timer=0;if(this.mode==ig.TIMER_MODE.SINUS_RND)this._rndBool=
Math.random()>=0.5},getRemainingTime:function(){return this.duration-this.timer},setRemainingTime:function(a){this.timer=this.duration-a;if(this.timer<0)this.timer=0},tick:function(){if(this.duration){this.timer=this.timer+(this.actualTick?ig.system.actualTick:ig.system.tick);if(this.timer>=this.duration){this.timer=this.mode?this.timer%this.duration:this.duration;this.mode?this.repeatCount++:this.repeatCount=1}}},done:function(){return!this.duration||!this.mode&&this.timer>=this.duration},getTimePassed:function(){return this.timer},
get:function(){if(this.duration){var a=this.timer/this.duration;this.mode==ig.TIMER_MODE.BLINK&&(a=(a<0.5?a:1-a)*2);this.mode==ig.TIMER_MODE.SINUS&&(a=Math.sin(Math.PI*2*a));this.mode==ig.TIMER_MODE.SINUS_RND&&(a=Math.sin(Math.PI*2*a)*(this._rndBool?-1:1));return a}return 1},getTotalWeight:function(){return this.timer/this.duration},hasRepeated:function(){return this.mode&&this.repeatCount},getRepeatCount:function(){return this.repeatCount},onBlinkDecline:function(){return this.timer/this.duration>=
0.5}})});ig.baked=!0;ig.module("impact.base.vars").defines(function(){var a={},b=/(\][^.\][])/,c=["map","maps","tmp","call","session"];ig.VarPathResolver={path:null,index:0,resolve:function(a){if(!a)return null;this.path=a.trim();this.index=0;return this._recResolve(true)},_recResolve:function(a){var c=this.path.indexOf("[",this.index);if(c==-1&&!this.index)return this.path;if(this.path.match(b)){ig.warn("Invalid bracket use in condition '"+this.path+"'.\nAfter a closing bracket ']' has to be '.', ']' or '['");
return null}for(var d=this.path.indexOf("]",this.index),e="";c!=-1&&c<d;){e=e+this.path.substring(this.index,c);e.length>0&&(e=e+".");this.index=c+1;c=this._recResolve(false);(c=c.match(f)?c:ig.vars._get(c))||(c="null");e=e+c;d=this.path.indexOf("]",this.index);c=this.path.indexOf("[",this.index)}if(c!=-1&&d==-1||d==-1!=a){ig.warn("Invalid bracket combination in var accessor '"+this.path+"'");return null}if(d!=-1){d>this.index&&(e=e+this.path.substring(this.index,d));this.index=d+1}else e=e+this.path.substring(this.index);
return e}};ig.Vars=ig.Class.extend({currentLevelName:null,varAccessors:[],entityAccessors:[],storage:{map:{},maps:{},tmp:{},call:{},session:{map:{},maps:{}}},init:function(){},get:function(a){a=ig.VarPathResolver.resolve(a);return this._get(a)},_get:function(a){if(!a)return null;var b=this.getVarAccessor(a);if(b){var c=a.split(".");return b.onVarAccess(a,c)}a=this._getVariable(a,false);return!a?null:a.obj[a.key]==void 0?null:a.obj[a.key]},_getAccessObject:function(a){a=ig.VarPathResolver.resolve(a);
if(!a)return null;var b=this._getVariable(a,true);if(b.obj==this.storage&&c.indexOf(b.key)!=-1){ig.warn("Tried to access key that is not supported: "+a);return null}return b},set:function(a,b){var c=this._getAccessObject(a);if(!c)return null;if(c.obj[c.key]!=b){c.obj[c.key]=b;ig.game.varsChangedDeferred()}},setDefault:function(a,b){this.get(a)==null&&this.set(a,b)},add:function(a,b){var c=this._getAccessObject(a);if(!c)return null;c.obj[c.key]=(c.obj[c.key]||0)+b;ig.game.varsChangedDeferred()},sub:function(a,
b){var c=this._getAccessObject(a);if(!c)return null;c.obj[c.key]=(c.obj[c.key]||0)-b;ig.game.varsChangedDeferred()},mul:function(a,b){var c=this._getAccessObject(a);if(!c)return null;c.obj[c.key]=(c.obj[c.key]||0)*b;ig.game.varsChangedDeferred()},div:function(a,b){var c=this._getAccessObject(a);if(!c)return null;c.obj[c.key]=Math.floor((c.obj[c.key]||0)/b);ig.game.varsChangedDeferred()},mod:function(a,b){var c=this._getAccessObject(a);if(!c)return null;c.obj[c.key]=(c.obj[c.key]||0)%b;ig.game.varsChangedDeferred()},
and:function(a,b){var c=this._getAccessObject(a);if(!c)return null;c.obj[c.key]=c.obj[c.key]&&b;ig.game.varsChangedDeferred()},or:function(a,b){var c=this._getAccessObject(a);if(!c)return null;c.obj[c.key]=c.obj[c.key]||b;ig.game.varsChangedDeferred()},xor:function(a,b){var c=this._getAccessObject(a);if(!c)return null;var d=c.obj[c.key];c.obj[c.key]=(d||b)&&!(d&&b);ig.game.varsChangedDeferred()},append:function(a,b){var c=this._getAccessObject(a);if(!c)return null;c.obj[c.key]=(c.obj[c.key]||"")+
b;ig.game.varsChangedDeferred()},prepend:function(a,b){var c=this._getAccessObject(a);if(!c)return null;c.obj[c.key]=b+(c.obj[c.key]||"");ig.game.varsChangedDeferred()},setupCallScope:function(a){this.storage.call=a},clear:function(){this.storage={map:{},maps:{},tmp:{},call:{},session:{map:{},maps:{}}}},getVarAccessor:function(a){var b=this.entityAccessors.last();if(b&&a.indexOf("entity.")==0)return b;for(b=this.varAccessors.length;b--;)if(a.indexOf(this.varAccessors[b].domain)==0)return this.varAccessors[b].accessor;
return null},forwardEntityVarAccess:function(a,b,c){if(!a)return null;if(b.length<=c)return a;if(a.onVarAccess){for(var d="entity",e=["entity"];c<b.length;++c){d=d+("."+b[c]);e.push(b[c])}return a.onVarAccess(d,e)}return null},resolveObjectAccess:function(a,b,c){for(;a&&c<b.length;){var d=b[c],a=a[d]!==void 0?a[d]:null;c++}return a},registerVarAccessor:function(a,b,c){this.varAccessors.push({domain:a+".",accessor:b,editor:c||null})},pushEntityAccessor:function(a){a.onVarAccess&&this.entityAccessors.push(a)},
popEntityAccessor:function(a){if(a.onVarAccess){var b=this.entityAccessors.pop();if(a!=b)throw Error("Removed unmatching accessor! Something went wrong");}},_getVariable:function(b,c){for(var d=b.split("."),e=this.storage,f=0;f<d.length-1;f++){if(!d[f])throw Error("VarPath '"+b+"' contains empty token.");if(!e[d[f]]||typeof e[d[f]]!="object")if(c)e[d[f]]={};else return null;e=e[d[f]]}a.obj=e;a.key=d[f];return a},onLevelChange:function(a){this.currentLevelName=a=a.toCamel();this.storage.maps[a]||(this.storage.maps[a]=
{});this.storage.map=this.storage.maps[a];this.storage.session.maps[a]||(this.storage.session.maps[a]={});this.storage.tmp={};this.storage.session.map=this.storage.session.maps[a]},getJson:function(){var a=ig.copy(this.storage);delete a.map;delete a.session;return{levelName:this.currentLevelName,storage:a}},clearTemp:function(){this.storage.tmp={};ig.game.varsChangedDeferred()},restoreFromJson:function(a){this.currentLevelName=a.levelName;this.storage=ig.copy(a.storage);this.storage.map=this.storage.maps[this.currentLevelName];
this.storage.session={map:{},maps:{}}}});var d=ig.Vars.prototype;d.get=d.get;d.set=d.set;d.add=d.add;d.sub=d.sub;d.mul=d.mul;d.div=d.div;d.mod=d.mod;d.and=d.and;d.or=d.or;d.xor=d.xor;d.append=d.append;var e=/^(!=|==|<=|>=|<|>|=|\+|-|%|\/|\*|AND|OR|&&|\|\|)/,f=/^-?\d+([.][\d]+)?/,g=/^(true|false|null)/,h=/^(\"(\\.|[^"])*\"|\'(\\.|[^'])*\')/,i=/^([\w/.-]|\[|\])+/,j={source:null,vars:null,index:0,searchedIndex:0,tokenType:0,tokenValue:null,parse:function(a,b){this.source=a;this.vars=b;this.index=0;return this._parseExpression()},
_parseExpression:function(){var a=this._parseTerminalExpression();this._checkToken();if(this.tokenType==0||this.tokenType==2)return a;if(this.tokenType==8){this._stepToken();return a+" "+this.tokenValue+" "+this._parseExpression()}throw Error("Unexpected token '"+this.tokenValue+"' when parsing expression");},_parseTerminalExpression:function(){this._checkToken(true);this._stepToken();if(this.tokenType==1){var a=this._parseExpression();this._checkToken();if(this.tokenType!=2)throw Error("Didn't close an open paranthesis! Bad!!");
this._stepToken();return"("+a+")"}if(this.tokenType==7)return"!"+this._parseTerminalExpression();if(this.tokenType==4||this.tokenType==6||this.tokenType==5)return this.tokenValue;if(this.tokenType==3){this.vars.push(this.tokenValue);return"ig.vars.get('"+this.tokenValue+"')"}throw Error("Unsupported Token: '"+this.tokenValue+"' during terminal expression parsing");},_checkToken:function(a){for(var b=this.index,c=this.source;c[b]==" ";)b++;if(b>=c.length){this.tokenType=0;this.tokenValue=null}else if(c[b]==
"("){this.tokenType=1;this.tokenValue="(";b++}else if(c[b]==")"){this.tokenType=2;this.tokenValue=")";b++}else if(c[b]=="!"&&c[b+1]!="="){this.tokenType=7;this.tokenValue="!";b++}else{var c=c.substr(b),d;if(!a&&(d=c.match(e))){d=d[0];b=b+d.length;this.tokenType=8;d=="AND"?d="&&":d=="OR"?d="||":d=="="&&(d="==");this.tokenValue=d}else if(d=c.match(f)){d=d[0];this.tokenType=4;this.tokenValue=d;b=b+d.length}else if(d=c.match(h)){d=d[0];this.tokenType=6;this.tokenValue=d;b=b+d.length}else if(d=c.match(g)){d=
d[0];this.tokenType=5;this.tokenValue=d;b=b+d.length}else if(d=c.match(i)){d=d[0];this.tokenType=3;this.tokenValue=d;b=b+d.length}else throw Error("Could not parse next token of '"+c+"'");}this.searchedIndex=b},_stepToken:function(){this.index=this.searchedIndex}};ig.VarCondition=ig.Class.extend({condition:null,code:"",pretty:"",vars:[],init:function(a){this.setCondition(a)},setCondition:function(a){if(!a||a.trim().length==0)this.code=this.pretty="true";else try{this.pretty=a=a.replace(/(?:\r\n|\r|\n)/g,
"");this.code=j.parse(a,this.vars)}catch(b){ig.log("CONDITION PARSING ERROR: "+b);this.pretty="ERROR: "+b;this.code="false";this.vars=[]}this.condition=new Function(" return "+this.code)},evaluate:function(){try{return!!this.condition.call()}catch(a){ig.log("Condition evaluation failed: "+this.condition);return false}},toString:function(){return this.pretty}})});ig.baked=!0;ig.module("impact.base.system").requires("impact.base.timer","impact.base.image","impact.base.vars").defines(function(){function a(){b=
b+1;if(b%ig.system.frameSkip==0){ig.Timer.step();ig.system.rawTick=ig.system.actualTick=Math.min(ig.Timer.maxStep,ig.system.clock.tick())*ig.system.totalTimeFactor;if(ig.system.hasFocusLost())ig.system.actualTick=0;ig.system.tick=ig.system.actualTick*ig.system.timeFactor;var d=ig.soundManager.context.getCurrentTimeRaw();ig.soundManager.context.timeOffset=d==c?ig.soundManager.context.timeOffset+ig.system.rawTick:0;c=d;if(ig.system.skipMode){ig.system.tick=ig.system.tick*8;ig.system.actualTick=ig.system.actualTick*
8}ig.system.delegate.run();if(ig.system.newGameClass){ig.system.setGameNow(ig.system.newGameClass);ig.system.newGameClass=null}}ig.system.fps>=60&&window.requestAnimationFrame&&window.requestAnimationFrame(ig.system.run.bind(ig.system),ig.system.canvas)}var b=0;ig.System=ig.Class.extend({fps:60,frameSkip:1,width:320,height:240,contextWidth:320,contextHeight:240,realWidth:320,realHeight:240,screenWidth:320,screenHeight:240,zoomFocus:{x:0,y:0},zoom:1,scale:1,contextScale:1,systemFontScale:2,focusLost:false,
focusListeners:[],windowFocusLost:false,imageSmoothingKey:null,imageSmoothingDisabled:false,crashed:false,cursorType:null,skipMode:false,timeFactor:1,totalTimeFactor:1,rawTick:0,tick:0,actualTick:0,ingameTick:0,intervalId:0,newGameClass:null,running:false,delegate:null,clock:null,inputDom:null,canvas:null,context:null,smoothPositioning:true,init:function(a,b,c,d,e,f){this.fps=c;this.clock=new ig.Timer;this.canvas=ig.$(a);this.context=this.canvas.getContext("2d");if(this.context.imageSmoothingEnabled)this.imageSmoothingKey=
"imageSmoothingEnabled";else if(this.context.webkitImageSmoothingEnabled)this.imageSmoothingKey="webkitImageSmoothingEnabled";else if(this.context.mozImageSmoothingEnabled)this.imageSmoothingKey="mozImageSmoothingEnabled";this.imageSmoothingDisabled=!!this.imageSmoothingKey;this.inputDom=b?ig.$(b):document;this.resize(d,e,f);this.limitSoundUse=ig.browser=="Chrome"&&ig.browserVersion*1<=25;if(!ig.vars)ig.vars=ig.vars=new ig.Vars;ig.vars.registerVarAccessor("system",this,"SystemVarEditor");ig.vars.registerVarAccessor("extension",
this,"VarExtensionEditor")},onVarAccess:function(a,b){if(b[0]=="system"){if(b[1]=="debug")return!!window.IG_GAME_DEBUG;if(b[1]=="lang")return ig.currentLang}else if(b[0]=="extension"){var c=b[1];if(b[2]=="active")return ig.extensions.hasExtension(c)}},resize:function(a,b,c){c=c||1;this.width=a;this.height=b;if(this.imageSmoothingDisabled){this.scale=1;this.contextScale=c||1}else{this.scale=c;this.contextScale=1}this.contextWidth=this.width*this.scale;this.contextHeight=this.height*this.scale;this.realWidth=
this.width*c;this.realHeight=this.height*c;this.canvas.width=this.width*c;this.canvas.height=this.height*c;this.zoomFocus.x=window.wm&&wm.mapConfig&&wm.mapConfig.settingsWidth?(a-wm.mapConfig.settingsWidth)/2:a/2;this.zoomFocus.y=b/2;this.screenWidth=this.canvas.style.width.replace("px","")*1||this.canvas.width;this.screenHeight=this.canvas.style.height.replace("px","")*1||this.canvas.height;this.imageSmoothingDisabled&&(this.context[this.imageSmoothingKey]=false);this.contextScale!=1&&this.context.scale(this.contextScale,
this.contextScale);this.updateCursorClass()},setGame:function(a){this.running?this.newGameClass=a:this.setGameNow(a)},setGameNow:function(a){ig.game=new a},setDelegate:function(a){if(typeof a.run=="function"){this.delegate=a;if(this.delegate.onGameLoopStart)this.delegate.onGameLoopStart();this.startRunLoop()}else ig.system.error(Error("System.setDelegate: No run() function in object"))},setZoom:function(a){this.zoom=a},setZoomFocus:function(a,b){this.zoomFocus.x=Math.round(a.limit(0,this.width));
this.zoomFocus.y=Math.round(b.limit(0,this.height))},stopRunLoop:function(){clearInterval(this.intervalId);this.running=false},startRunLoop:function(){this.stopRunLoop();window.requestAnimationFrame=window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.msRequestAnimationFrame;this.fps>=60&&window.requestAnimationFrame?window.requestAnimationFrame(this.run.bind(this),this.canvas):this.intervalId=setInterval(this.run.bind(this),1E3/this.fps);this.running=
true},getZoomMinOffset:function(a){if(this.zoom==1)a.x=a.y=0;else{a.x=(this.width-this.width/this.zoom)*(this.zoomFocus.x/this.width);a.y=(this.height-this.height/this.zoom)*(this.zoomFocus.y/this.height)}return a},getScreenFromMapPos:function(a,b,c){a.x=(b-ig.game.screen.x-this.zoomFocus.x)*this.zoom+this.zoomFocus.x;a.y=(c-ig.game.screen.y-this.zoomFocus.y)*this.zoom+this.zoomFocus.y;return a},getMapFromScreenPos:function(a,b,c){a.x=(b-this.zoomFocus.x)/this.zoom+this.zoomFocus.x+ig.game.screen.x;
a.y=(c-this.zoomFocus.y)/this.zoom+this.zoomFocus.y+ig.game.screen.y;return a},getMapFromScrollPos:function(a,b,c,d){a.x=(b-this.zoomFocus.x)/this.zoom+this.zoomFocus.x+d.x;a.y=(c-this.zoomFocus.y)/this.zoom+this.zoomFocus.y+d.y;return a},clear:function(a){this.context.fillStyle=a;this.context.fillRect(0,0,this.contextWidth,this.contextHeight)},startZoomedDraw:function(){if(this.zoom!=1){this.context.save();this.context.translate(this.zoomFocus.x,this.zoomFocus.y);this.context.scale(this.zoom,this.zoom);
this.context.translate(-this.zoomFocus.x,-this.zoomFocus.y);this.smoothPositioning=false}},endZoomedDraw:function(){if(this.zoom!=1){this.context.restore();this.smoothPositioning=true}},setTimeFactor:function(a){this.timeFactor=a;this.ingameTick=this.tick=this.actualTick*this.timeFactor},run:function(){if(window.IG_GAME_DEBUG)a();else try{a()}catch(b){ig.system.error(b)}},getBufferContext:function(a){a=a.getContext("2d");this.imageSmoothingDisabled&&(a[this.imageSmoothingKey]=false);return a},error:function(a){this.crashed=
true;var b={};if(ig.game){b.map=ig.game.mapName||"NO MAP";b.version=ig.game.getVersion()}else{b.map="GAME INIT";b.version="---"}b.platform=ig.getPlatformName(ig.platform);b.OS=ig.OS;b.browser=ig.browser;b.browserVersion=ig.browserVersion;b.nwjsVersion=ig.nwjsVersion&&ig.nwjsVersion[0];b["64bit"]=ig.nwjs64;b.webAudio=ig.webAudioActive;b.sampleRate=ig.soundManager.getSampleRate();var c={};ig.game&&ig.game.getErrorData(c);window.GAME_ERROR_CALLBACK&&window.GAME_ERROR_CALLBACK(a,b,c);throw a;},hasFocusLost:function(){return this.focusLost||
this.windowFocusLost},getDrawPos:function(a){return this.smoothPositioning?Math.round(a*this.scale*this.contextScale)/this.contextScale:Math.round(a)*this.scale},createImageBuffer:function(a,b,c){var d=ig.$new("canvas");d.width=a*ig.system.scale;d.height=b*ig.system.scale;a=this.context;this.context=this.getBufferContext(d);c();this.context=a;return d},setWindowFocus:function(a){this.windowFocusLost=a;if(ig.music){if(a){ig.music.onWindowFocusLost();ig.soundManager.onWindowFocusLost()}else{ig.music.onWindowFocusGained();
ig.soundManager.onWindowFocusGained()}ig.game&&ig.game.setWindowFocus&&ig.game.setWindowFocus(this.windowFocusLost)}},callFocusListeners:function(){for(var a=0;a<this.focusListeners.length;++a)this.focusListeners[a](this.focusLost)},clearCursorType:function(){this.cursorType=null;this.updateCursorClass()},setCursorType:function(a){if(a!=this.cursorType){this.cursorType=a;this.updateCursorClass()}},updateCursorClass:function(){if(this.cursorType){var a="cursorSize"+Math.round(this.screenWidth/this.width).limit(1,
8),a=a+(" "+this.cursorType);this.inputDom.className=a}else this.inputDom.className=""},setCanvasSize:function(a,b,c){this.canvas.style.width=a+"px";this.canvas.style.height=b+"px";this.canvas.className=c?"borderHidden":"";this.screenWidth=a;this.screenHeight=b;this.updateCursorClass()},setFocusLost:function(){this.focusLost=true},regainFocus:function(){this.focusLost=false;this.callFocusListeners()},addFocusListener:function(a){this.focusListeners.push(a)},removeFocusListener:function(a){this.focusListeners.erase(a)},
setMasterVolume:function(a){ig.soundManager.setMasterVolume(a)},setSoundVolume:function(a){ig.soundManager.volume=a;ig.soundManager.setSoundVolume(a)},setMusicVolume:function(a){ig.music.volume=a;ig.soundManager.setMusicVolume(a)}});var c=0});ig.baked=!0;ig.module("impact.base.input").defines(function(){ig.KEY={MOUSE1:-1,MOUSE2:-3,MWHEEL_UP:-4,MWHEEL_DOWN:-5,BACKSPACE:8,TAB:9,ENTER:13,PAUSE:19,CAPS:20,ESC:27,SPACE:32,PAGE_UP:33,PAGE_DOWN:34,END:35,HOME:36,LEFT_ARROW:37,UP_ARROW:38,RIGHT_ARROW:39,
DOWN_ARROW:40,INSERT:45,DELETE:46,_0:48,_1:49,_2:50,_3:51,_4:52,_5:53,_6:54,_7:55,_8:56,_9:57,A:65,B:66,C:67,D:68,E:69,F:70,G:71,H:72,I:73,J:74,K:75,L:76,M:77,N:78,O:79,P:80,Q:81,R:82,S:83,T:84,U:85,V:86,W:87,X:88,Y:89,Z:90,NUMPAD_0:96,NUMPAD_1:97,NUMPAD_2:98,NUMPAD_3:99,NUMPAD_4:100,NUMPAD_5:101,NUMPAD_6:102,NUMPAD_7:103,NUMPAD_8:104,NUMPAD_9:105,MULTIPLY:106,ADD:107,SUBSTRACT:109,DECIMAL:110,DIVIDE:111,F1:112,F2:113,F3:114,F4:115,F5:116,F6:117,F7:118,F8:119,F9:120,F10:121,F11:122,F12:123,SHIFT:16,
CTRL:17,ALT:18,EQUAL:187,PLUS:187,COMMA:188,MINUS:189,PERIOD:190,SEMICOLON:186,UE:186,GRAVE_ACCENT:192,OE:192,SLASH:191,HASH:191,BRACKET_OPEN:219,SZ:219,BACKSLASH:220,BRACKET_CLOSE:221,SINGLE_QUOTE:222,AE:222};ig.INPUT_DEVICES={KEYBOARD_AND_MOUSE:1,GAMEPAD:2};ig.Input=ig.Class.extend({bindings:{},actions:{},presses:{},keyups:{},locks:{},delayedKeyup:[],currentDevice:null,isUsingMouse:false,isUsingKeyboard:false,isUsingAccelerometer:false,mouse:{x:0,y:0},accel:{x:0,y:0,z:0},mouseGuiActive:true,lastMousePos:{x:0,
y:0},ignoreKeyboard:false,init:function(){},initMouse:function(){if(!this.isUsingMouse){this.isUsingMouse=true;window.addEventListener("DOMMouseScroll",this.mousewheel.bind(this),false);window.addEventListener("mousewheel",this.mousewheel.bind(this),false);ig.system.inputDom.addEventListener("contextmenu",this.contextmenu.bind(this),false);ig.system.inputDom.addEventListener("mousedown",this.keydown.bind(this),false);window.addEventListener("mouseup",this.keyup.bind(this),false);document.addEventListener("mousemove",
this.mousemove.bind(this),false);document.addEventListener("mouseout",this.mouseout.bind(this),false);window.addEventListener("blur",this.blur.bind(this),false);window.addEventListener("focus",this.focus.bind(this),false);document.addEventListener("drop",function(a){a.preventDefault();return false},false);document.addEventListener("dragover",function(a){a.preventDefault();return false},false);ig.system.inputDom.addEventListener("touchstart",this.keydown.bind(this),false);ig.system.inputDom.addEventListener("touchend",
this.keyup.bind(this),false);ig.system.inputDom.addEventListener("touchmove",this.mousemove.bind(this),false);ig.vars.set("mouse.active",true)}},initKeyboard:function(){if(!this.isUsingKeyboard){this.isUsingKeyboard=true;window.addEventListener("keydown",this.keydown.bind(this),false);window.addEventListener("keyup",this.keyup.bind(this),false)}},initAccelerometer:function(){this.isUsingAccelerometer||window.addEventListener("devicemotion",this.devicemotion.bind(this),false)},mousewheel:function(a){if(!ig.system.crashed&&
!ig.system.focusLost){var b=this.bindings[(a.wheelDelta?a.wheelDelta/60:-a.detail/2)>0?ig.KEY.MWHEEL_UP:ig.KEY.MWHEEL_DOWN];if(b){this.actions[b]=true;this.presses[b]=true;this.keyups[b]=true;if(this.isInIframe()){a.stopPropagation();a.preventDefault()}this.delayedKeyup.push(b)}this.currentDevice=ig.INPUT_DEVICES.KEYBOARD_AND_MOUSE}},mousemove:function(a){this.mouseIsOut=false;ig.Input.getMouseCoords(this.mouse,a,ig.system.canvas);this.mouse.x=this.mouse.x*(ig.system.width/ig.system.screenWidth);
this.mouse.y=this.mouse.y*(ig.system.height/ig.system.screenHeight);if(!this.mouseGuiActive&&!e.equal(this.lastMousePos,this.mouse)){this.mouseGuiActive=true;e.assign(this.lastMousePos,this.mouse)}},mouseout:function(){this.mouseIsOut=true},mouseOutOfScreen:function(){return this.mouseIsOut},contextmenu:function(a){if(this.bindings[ig.KEY.MOUSE2]){a.stopPropagation();a.preventDefault()}},isInIframe:function(){return window.parent!=window},isInIframeAndUnfocused:function(){return this.isInIframe()&&
!document.hasFocus()},keydown:function(a){if(!ig.system.crashed&&!this.isInIframeAndUnfocused()&&!(this.ignoreKeyboard&&a.type!="mousedown"))if(ig.system.hasFocusLost())a.type=="mousedown"&&ig.system.regainFocus();else{if(a.type=="mousedown")this.mouseGuiActive=true;this.currentDevice=ig.INPUT_DEVICES.KEYBOARD_AND_MOUSE;if(a.target.type!="text"){var b=a.type=="keydown"?a.keyCode:a.button==2?ig.KEY.MOUSE2:ig.KEY.MOUSE1;(a.type=="touchstart"||a.type=="mousedown")&&this.mousemove(a);if(b=this.bindings[b]){this.actions[b]=
true;if(!this.locks[b]){this.presses[b]=true;this.locks[b]=true}a.stopPropagation();a.preventDefault()}}}},keyup:function(a){if(!ig.system.crashed&&!this.isInIframeAndUnfocused()&&!(this.ignoreKeyboard&&a.type!="mouseup")&&a.target.type!="text"&&!(ig.system.hasFocusLost()&&a.type=="mouseup")){this.currentDevice=ig.INPUT_DEVICES.KEYBOARD_AND_MOUSE;var b=this.bindings[a.type=="keyup"?a.keyCode:a.button==2?ig.KEY.MOUSE2:ig.KEY.MOUSE1];if(b){this.keyups[b]=true;this.delayedKeyup.push(b);a.stopPropagation();
a.preventDefault()}}},blur:function(a){window.IG_KEEP_WINDOW_FOCUS||ig.system.setWindowFocus(true);for(var b in this.actions)if(this.actions[b]==true){this.keyups[b]=true;this.delayedKeyup.push(b);a.stopPropagation();a.preventDefault()}},focus:function(){window.IG_KEEP_WINDOW_FOCUS||ig.system.setWindowFocus(false)},devicemotion:function(a){this.accel=a.accelerationIncludingGravity},bind:function(a,b){a<0?this.initMouse():a>0&&this.initKeyboard();this.bindings[a]=b},bindTouch:function(a,b){var c=ig.$(a),
d=this;c.addEventListener("touchstart",function(a){d.touchStart(a,b)},false);c.addEventListener("touchend",function(a){d.touchEnd(a,b)},false)},unbind:function(a){this.bindings[a]=null},unbindAll:function(){this.bindings=[]},state:function(a){return this.actions[a]},pressed:function(a){return ig.game.firstUpdateLoop?this.presses[a]:false},keyupd:function(a){return ig.game.firstUpdateLoop?this.keyups[a]:false},clearPressed:function(){for(var a=0;a<this.delayedKeyup.length;a++){var b=this.delayedKeyup[a];
this.actions[b]=false;this.locks[b]=false}this.delayedKeyup=[];this.presses={};this.keyups={}},touchStart:function(a,b){this.actions[b]=true;this.presses[b]=true;a.stopPropagation();a.preventDefault();return false},touchEnd:function(a,b){this.delayedKeyup.push(b);a.stopPropagation();a.preventDefault();return false}});ig.Input.getMouseCoords=function(a,b,c){for(var d=c,e=c=0;d!=null;){c=c+d.offsetLeft;e=e+d.offsetTop;d=d.offsetParent}var d=b.pageX,f=b.pageY;if(b.touches){d=b.touches[0].clientX;f=b.touches[0].clientY}a.x=
d-c;a.y=f-e}});ig.baked=!0;ig.module("impact.base.lang").requires("impact.base.loader").defines(function(){function a(b){if(!b)return b;if(b instanceof Array){for(var c=[],d=b.length;d--;)c[d]=a(b[d]);return c}if(typeof b=="object"&&!b.indexOf){c={};for(d in b)c[d]=a(b[d]);return c}c=b.indexOf("<<C<<");if(c!=-1)return b.substr(0,c);c=b.indexOf("<<A<<");return c!=-1?b.substr(0,c):b}ig.Lang=ig.SingleLoadable.extend({cacheType:"Lang",labels:{},_responseCount:0,init:function(){this.parent()},get:function(b){for(var b=
b.split("."),c=this.labels,d=0;d<b.length;++d){c=c[b[d]];if(c===void 0)return"UNKNOWN LABEL"}return c=a(c)},loadInternal:function(){for(var a=0;a<ig.langFileList.length;++a){var b=ig.root+ig.langFileList[a].toPath("data/lang/","."+ig.currentLang+".json");$.ajax({dataType:"json",url:b+ig.getCacheSuffix(),context:this,success:this.onload.bind(this),error:this.onerror.bind(this)})}this._doCallback()},onerror:function(){this._responseCount++;ig.system.error(Error("Loading of a language file failed."));
this._doCallback()},onload:function(a){this._responseCount++;this._doCallback();if(a.DOCTYPE!="STATIC-LANG-FILE")ig.system.error(Error("Language File has wrong format."));else{for(var b=a.feature.split("."),c=this.labels,d=0;d<b.length;++d){var e=b[d];c[e]||(c[e]={});c=c[e]}for(var f in c){ig.warn("Language File adds labels to already existing name space: "+a.feature);break}for(d in a.labels)c[d]=a.labels[d]}},grammarReplace:function(a,b,d){var b=b.toString(),d=d||b,e;c[ig.currentLang]&&(e=c[ig.currentLang](a,
b,d));e||(e=a.replace(/\[!\]/,d));return e},_doCallback:function(){this._responseCount==ig.langFileList.length&&this.loadingFinished(true)}});var b=[50,52,53,57],c={ko_KR:function(a,c,d){var e=c.charCodeAt(c.length-1),f=/\[!\]\[(.+)\/(.+)\]/.exec(a);if(f){var g=f[2].length+f[1].length+6,c=a.substr(0,f.index),a=a.substr(f.index+g),e=(e-44032)%28==0||b.indexOf(e)!=-1?f[2]:f[1];return c+d+e+a}return null}};ig.LangLabel=ig.Class.extend({value:null,data:null,langUid:null,originFile:null,init:function(a){this.data=
a;this.langUid=a.langUid||1;this.value=ig.LangLabel.getText(this.data);this.originFile=d||null},getSaveData:function(){return this.data},toString:function(){return this.value}});var d=null;ig.LangLabel.setOriginFile=function(a){d=a};ig.LangLabel.getOriginFile=function(){return d};ig.LangLabel.getText=function(b,c){if(b&&typeof b=="object"){var d=a(b[ig.currentLang]);if((c?d!=void 0:d)&&d!=ig.currentLang)return d;d=a(b.en_US);return(c?d!=void 0:d)&&d!="en_US"?d:"MISSING LABEL"}return a(b)||"MISSING LABEL"};
ig.LangLabel.bakeVars=function(b){if(typeof b=="string")return ig.TextParser.bakeVars(b);if(b instanceof ig.LangLabel){var b=b.data,c={},d;for(d in b)d!="langUid"&&(c[d]=ig.TextParser.bakeVars(a(b[d])));return new ig.LangLabel(c)}return b}});ig.baked=!0;ig.module("impact.base.impact").requires("dom.ready","impact.base.image","impact.base.font","impact.base.sound","impact.base.loader","impact.base.system","impact.base.input","impact.base.sound","impact.base.vars","impact.base.lang").defines(function(){ig.mainLoader=
null;ig.main=function(a,b,c,d,e,f,g,h){if(ig.FORCE_LANG){ig.currentLang=ig.FORCE_LANG;ig.log("%cFORCE LANG: "+ig.currentLang,"color:#FF4A4A")}else if(window.IG_LANG){ig.currentLang=window.IG_LANG;ig.log("%cWINDOW LANG: "+ig.currentLang,"color:#FF4A4A")}else{var i=localStorage.getItem("IG_LANG");if(i){ig.currentLang=i;ig.log("%cSTORED LANG: "+ig.currentLang,"color:#FF4A4A")}else{var i="en_US",j;for(j in ig.LANG_DETAILS)ig.LANG_DETAILS[j].useFor&&navigator.language.startsWith(ig.LANG_DETAILS[j].useFor)&&
(i=j);ig.currentLang=i;localStorage.setItem("IG_LANG",ig.currentLang);ig.log("%cAUTO LANG: "+ig.currentLang,"color:#FF4A4A")}}if(!ig.LANG_DETAILS[ig.currentLang]){ig.currentLang="en_US";localStorage.setItem("IG_LANG",ig.currentLang);ig.log("%cFALLBACK LANG: "+ig.currentLang,"color:#FF4A4A")}if((j=ig.LANG_DETAILS[ig.currentLang])&&j.systemFont){ig.Font.systemFont=j.systemFont;ig.imageAtlas.scale=2;$("#game").css("font-family",j.systemFont+", sans-serif")}if(j&&j.metrics)ig.SYSTEM_FONT_METRICS=j.metrics;
ig.system=ig.system=new ig.System(a,b,d,e,f,g||1);ig.lang=new ig.Lang;ig.input=new ig.Input;ig.soundManager=new ig.SoundManager;ig.music=new ig.Music;ig.ready=true;a=new (h||ig.Loader)(c);a.load();ig.mainLoader=a}})})();window.Vec2=window.Vec2;window.Vec3=window.Vec3;window.Line2=window.Line2;window.KeySpline=window.KeySpline;window.KEY_SPLINES=window.KEY_SPLINES;window.assert=window.assert;window.assertContent=window.assertContent;window.sc||(window.sc={},window.sc=window.sc);ig.baked=!0;
ig.module("impact.base.sprite-fx").requires("impact.base.image").defines(function(){ig.SpriteEffectBase=ig.Class.extend({delay:0,duration:0,init:function(b){this.delay=b.delay||0;this.duration=b.duration||0},updateSprite:function(b,a,d){a<this.delay||this.apply(b,(a-this.delay)/(this.duration||d))},apply:function(){}});ig.SPRITE_FX={};ig.SPRITE_FX.SLIDE=ig.SpriteEffectBase.extend({dir:null,start:0,end:0,keySpline:null,init:function(b){this.parent(b);this.dir=ig.ActorEntity.FACE4[b.dir];if(this.dir==
void 0)this.dir=ig.ActorEntity.FACE4.EAST;this.start=b.start||0;this.end=b.end||0;this.keySpline=KEY_SPLINES[b.keySpline]||KEY_SPLINES.EASE_IN_OUT},apply:function(b,a){var a=Math.min(a,1),a=this.keySpline.get(a),d=(1-a)*this.start+a*this.end;if(this.dir==ig.ActorEntity.FACE4.EAST){d=Math.round(b.size.x*d);b.size.x=b.size.x-d;b.pos.x=b.pos.x+d}else if(this.dir==ig.ActorEntity.FACE4.WEST){d=Math.round(b.size.x*d);b.size.x=b.size.x-d;b.src.x=b.src.x+d}else if(this.dir==ig.ActorEntity.FACE4.SOUTH){d=
Math.round((b.size.y+b.size.z)*d);if(b.size.y>=d){b.size.y=b.size.y-d;b.pos.y=b.pos.y+d}else{d=d-b.size.y;b.pos.y=b.pos.y-b.size.y;b.size.y=0;b.size.z=b.size.z-d}}else if(this.dir==ig.ActorEntity.FACE4.NORTH){d=Math.round((b.size.y+b.size.z)*d);b.src.y=b.src.y+d;if(b.size.y>=d)b.size.y=b.size.y-d;else{d=d-b.size.y;b.size.y=0;b.size.z=b.size.z-d;b.pos.z=b.pos.z+d}}}});ig.SPRITE_FX.MOVE_XYZ=ig.SpriteEffectBase.extend({offset:null,start:0,end:0,keySpline:null,init:function(b){this.parent(b);this.offset=
b.offset;this.start=b.start||0;this.end=b.end||0;this.keySpline=KEY_SPLINES[b.keySpline]||KEY_SPLINES.EASE_IN_OUT},apply:function(b,a){a=Math.min(a,1);a=this.keySpline.get(a);Vec3.addMulF(b.pos,this.offset,(1-a)*this.start+a*this.end)}})});ig.baked=!0;
ig.module("impact.base.animation").requires("impact.base.loader","impact.base.timer","impact.base.image","impact.base.sprite-fx").defines(function(){function b(a,b,c){c=c*(1-a.colorAlpha);a.colorAlpha=a.colorAlpha+c;a.color.addColor(b,c/a.colorAlpha)}function a(a,b){if(b.namedSheets)for(var c in b.namedSheets){var d=b.namedSheets[c];if(!(d instanceof ig.TileSheet)){d=ig.TileSheet.createFromJson(b.namedSheets[c]);a.createdSheets.push(d)}a.namedSheets[c]=d}}function d(a,b,c,e){var e=e||{},f=b.sheet,
e=ig.merge({},e,true);ig.merge(e,b,true);if(e.sheet&&typeof e.sheet=="object"&&!(e.sheet instanceof ig.TileSheet)){f=ig.TileSheet.createFromJson(e.sheet);a.createdSheets.push(f);e.sheet=f}if(b.name)if(f=a._getSheet(e.sheet)){f=c(a._getSheet(e.sheet),e);a.addAnimationSet(b.name,f)}if(b.SUB){b=b.SUB;for(f=0;f<b.length;++f)d(a,b[f],c,e)}}function c(a,b){return new ig.SingleDirAnimationSet(new ig.Animation(a,b))}function e(a,b){var c=new ig.MultiDirAnimationSet(b);if(b.frames)c.setAnimations(a,b);else if(b.dirFrames)for(var d=
0;d<b.dirFrames.length;d++){var e=ig.merge({},b,true);e.frames=b.dirFrames[d];e.flipX=b.flipX&&b.flipX[d]||false;c.addAnimation(new ig.Animation(a,e))}return c}ig.TileSheet=ig.Class.extend({width:8,height:8,offX:0,offY:0,xCount:0,image:null,init:function(a,b,c,d,e,f){this.width=b;this.height=c;this.offX=d||0;this.offY=e||0;this.xCount=f||0;this.image=new ig.Image(a)},generateHit:function(){this.image.addFiltered("damage","MONOCHROME",{factorRed:1,factorGreen:1.2,factorBlue:2,colorAdd:64})},getTileSrc:function(a,
b){return this.image.getTileSrc(a,b,this.width,this.height,this.offX,this.offY,this.xCount)},clearCached:function(){this.image.decreaseRef()}});ig.TileSheet.createFromJson=function(a){return new ig.TileSheet(a.src,a.width,a.height,a.offX,a.offY,a.xCount)};ig.ANIM_SHAPE_TYPE={NO_EXPAND:1,Y_EXPAND:2,Z_EXPAND:3,YZ_EXPAND:4,Y_FLAT:5,Z_FLAT:6};var f=Vec3.create();ig.Animation=ig.Class.extend({sheet:null,shapeType:ig.ANIM_SHAPE_TYPE.NO_EXPAND,frameTime:0,stop:false,flip:{x:false,y:false},pivot:{x:0,y:0},
centerPivot:false,wallY:0,aboveZ:0,sequence:[],sequenceSpriteOff:null,framesGfxOffset:null,framesAlpha:null,framesAngle:null,framesFlipX:null,angle:0,offset:null,gfxOffset:null,size:null,renderMode:null,guiSprites:false,globalTiming:false,fx:null,init:function(a,b){if(!a instanceof ig.TileSheet)throw Error("Tried to initiale Animation without ig.TileSheet object");this.sheet=a;if(b.shapeType)this.shapeType=ig.ANIM_SHAPE_TYPE[b.shapeType];this.pivot=b.pivot?{x:b.pivot.x,y:b.pivot.y}:{x:this.sheet.width/
2,y:this.sheet.height/2};this.flip.x=b.flipX||false;this.flip.y=b.flipY||false;this.offset=b.offset||null;this.angle=b.angle||0;this.size=b.size||null;this.gfxOffset=b.gfxOffset||null;this.centerPivot=b.centerPivot||false;this.guiSprites=b.guiSprites||false;this.wallY=b.wallY||0;if(b.aboveZ)this.aboveZ=b.aboveZ;this.renderMode=b.renderMode||null;this.globalTiming=b.globalTiming||false;this.faceRotate=b.faceRotate||false;this.frameTime=b.time||0.1;this.sequence=ig.copy(b.frames);if(b.tileOffset)for(var c=
0;c<this.sequence.length;c++)this.sequence[c]=this.sequence[c]==-1?-1:this.sequence[c]+b.tileOffset;if(b.fx){var d=b.fx;this.fx=[];for(c=0;c<d.length;++c){var e=d[c];this.fx.push(new ig.SPRITE_FX[e.type](e))}}this.sequenceSpriteOff=b.framesSpriteOffset||null;this.framesGfxOffset=b.framesGfxOffset||null;this.framesAlpha=b.framesAlpha||null;this.framesAngle=b.framesAngle||null;this.framesFlipX=b.framesFlipX||null;this.stop=!b.repeat},getDuration:function(){return this.frameTime*this.sequence.length},
getFrameCount:function(){return this.sequence.length},onAnimationStart:null,onUpdate:null,updateSprite:function(a,b,c,d){var e=this.globalTiming?ig.game.backgroundAnimTimer:c.timer,g=this.sequence.length;if(g){var h=Math.floor(e/this.frameTime),g=this.stop?Math.min(h,g-1):h%g,h=this.sheet,j=this.sheet.image,k;this.size?b.setSize(this.size.x,this.size.y,this.size.z,this.size.y*(this.wallY||0)):b.setSizeFromEntity(a,h.width,h.height,this.shapeType,this.wallY);Vec3.assignC(f,0,0,0);this.offset&&Vec3.add(f,
this.offset);var l;if(l=this.sequenceSpriteOff){k=g*3;Vec3.addC(f,(c.flipX?-1:1)*l[k],l[k+1],l[k+2])}b.setPosFromEntity(a,f,this.shapeType,this.wallY);l=this.sequence[g];if(l==-1)b.setInvisible();else{for(k=c.animMods.length;k--;){var u=c.animMods[k];u.spriteIdx==d&&(l=l+u.tileOffset)}k=h.getTileSrc(i,l);b.setImageSrcFromEntity(a,h.width,h.height,j,k.x,k.y);d==0?b.setShadowFromEntity(a):b.setShadow(0,0,0,0);h=d=0;if(this.gfxOffset){d=(c.flipX?-1:1)*this.gfxOffset.x;h=this.gfxOffset.y}if(this.framesGfxOffset){k=
g*2;d=d+(c.flipX?-1:1)*(this.framesGfxOffset[k]||0);h=h+(this.framesGfxOffset[k+1]||0)}j=c.alpha;this.framesAlpha&&(j=j*this.framesAlpha[g]);k=c.angle+this.angle*Math.PI*2/360;this.faceRotate&&a.face&&(k=k+Vec2.clockangle(a.face));this.framesAngle&&(k=k+(c.flipX?-1:1)*this.framesAngle[g]*Math.PI*2/360);l=c.flipX?!this.flip.x:this.flip.x;this.framesFlipX&&this.framesFlipX[g]&&(l=!l);b.setAlpha(j);b.setTransform(c.scaleX,c.scaleY,k);b.aboveZ=this.aboveZ;b.setGfxOffset(d,h);b.setFlip(l,this.flip.y);
b.setPivot(this.pivot.x,this.pivot.y);this.centerPivot&&b.centerPivot(a);b.renderMode=this.renderMode;if(this.fx){a=this.frameTime*this.sequence.length;for(k=0;k<this.fx.length;++k)this.fx[k].updateSprite(b,e,a)}}}else b.setInvisible()}});ig.MultiEntityAnimationPart=ig.Class.extend({name:null,group:null,persistAnim:null,collType:0,heightShape:0,padding:Vec2.create(),size:{x:0,y:0,z:0},pos:{x:0,y:0,z:0},animSheet:null,synced:false,init:function(a,b,c){this.name=a;this.group=c.group;this.persistAnim=
c.persistAnim;this.collType=ig.COLLTYPE[c.collType||"BLOCK"];this.heightShape=ig.COLL_HEIGHT_SHAPE[c.heightShape||"NONE"];Vec3.assign(this.size,c.size);c.padding&&Vec2.assign(this.padding,c.padding);Vec3.assign(this.pos,c.pos);a=c.anims;a.namedSheets=b;this.animSheet=new ig.AnimationSheet(a)},createSubEntity:function(a,b){var c=a.getCenter(g);c.z=a.coll.pos.z;c.x=c.x-b.x/2;c.y=c.y-b.y/2;Vec3.add(c,this.pos);var d=a.getAnimPartyEntityClass?a.getAnimPartyEntityClass():ig.AnimationPartEntity;return ig.game.spawnEntity(d,
c.x,c.y,c.z,{owner:a,size:this.size,padding:this.padding,partName:this.name,group:this.group,persistAnim:this.persistAnim,animSheet:this.animSheet,collType:this.collType,heightShape:this.heightShape})}});var g=Vec3.create(),h=Vec3.create();ig.MULTI_ANIM_FLIP={NONE:0,LEFT:1,RIGHT:2};ig.MultiEntityAnimation=ig.Class.extend({parts:null,baseSize:Vec3.create(),anchor:null,frameTime:0,frameCount:0,stop:false,flipDir:false,partAnims:{},init:function(a,b,c){Vec3.assign(this.baseSize,a);this.parts=b;this.frameTime=
c.time;this.frameCount=c.frameCount;this.stop=!c.repeat;this.anchor=c.anchor||null;this.flipDir=ig.MULTI_ANIM_FLIP[c.flipDir]||ig.MULTI_ANIM_FLIP.NONE;var a=c.partAnims,d;for(d in a)this.partAnims[d]={anim:a[d].anim,posFrames:a[d].posFrames,reset:a[d].reset,collType:ig.COLLTYPE[a[d].collType]||null}},getAnchorOffset:function(a){if(!this.anchor)return null;var b=Vec3.create(this.anchor);if(this.flipDir&&(this.flipDir==ig.MULTI_ANIM_FLIP.LEFT&&a<0||this.flipDir==ig.MULTI_ANIM_FLIP.RIGHT&&a>=0))b.x=
-b.x;return b},getDuration:function(){return this.frameTime*this.frameCount},getFrameCount:function(){return this.frameCount},onAnimationStart:function(a){var b=a.coll;b.subColls.length==0&&ig.MultiEntityAnimation.initSubEntities(a,this.parts,this.baseSize);a.animState.rewind();for(var a=b.subColls,c=a.length,a=b.subColls,c=a.length;c--;){var b=a[c].entity,d=this.partAnims[b.partName];if(d){if(b._hidden){b.show(true);b.justAdded=true}b.coll.setType(d.collType||b.defaultCollType);if(!b.persistAnim||
window.wm){b.setCurrentAnim(d.anim,d.reset);d.reset&&b.animState.rewind();b.synced=d.reset;b.updateAnim()}}else b._hidden||b.hide()}},onUpdate:function(a,b){var c=a.coll;c.subColls.length==0&&this.initSubEntities(a);var d=c.getCenter(g);d.z=c.pos.z;d.x=d.x-this.baseSize.x/2;d.y=d.y-this.baseSize.y/2;var e=false;if(this.flipDir&&a.face&&(this.flipDir==ig.MULTI_ANIM_FLIP.LEFT&&a.face.x<0||this.flipDir==ig.MULTI_ANIM_FLIP.RIGHT&&a.face.x>=0))e=true;for(var f=this.frameCount,i=Math.floor(b.timer/this.frameTime),
f=(this.stop?Math.min(i,f-1):i%f)*3,c=c.subColls,i=c.length;i--;){var j=c[i],k=j.entity,l=this.partAnims[k.partName],u=this.parts[k.partName];if(l){var z=k.animState;if(k.synced)z.timer=b.timer-ig.system.tick;z.flipX=e;z.alpha=b.alpha;z.scaleX=b.scaleX;z.scaleY=b.scaleY;l=l.posFrames;u=Vec3.assign(h,u.pos);Vec3.addC(u,l[f],l[f+1],l[f+2]);if(e)u.x=this.baseSize.x-u.x-j.size.x;Vec3.add(u,d);j.setPos(u.x,u.y,u.z,!k.justAdded);k.justAdded=false}}},updateSprite:function(a,b,c){b.setImageSrc(null);b.setSize(this.baseSize.x,
this.baseSize.y,0);b.setPosFromEntity(a);b.setShadowFromEntity(a);b.setAlpha(c.alpha)}});ig.MultiEntityAnimation.initSubEntities=function(a,b,c){var d=a.coll;d.setSize(c.x,c.y,c.z);d.type=ig.COLLTYPE.IGNORE;d.setSize(c.x,c.y,c.z);for(var e in b){var f=b[e].createSubEntity(a,c);f.animState.alpha=a.animState.alpha;d.addSubCollEntry(f.coll);f.initAnimations()}};var i={};ig.AnimationState=ig.Class.extend({animations:null,followUp:null,timer:0,loopCount:0,alpha:1,angle:0,scaleX:1,scaleY:1,flipX:false,
colorOverlays:[],animMods:[],init:function(){this.timer=0},reset:function(){this.timer=0;var a=this.constructor.prototype;this.animations=a.animations;this.followUp=a.followUp;this.loopCount=a.loopCount;this.alpha=a.alpha;this.angle=a.angle;this.scaleX=a.scaleX;this.scaleY=a.scaleY;this.colorOverlays.length=0},shuffleTime:function(){var a=this.animations[0];if(a)this.timer=a.getDuration()*Math.random()},hasAnimations:function(){return!!this.animations},setAnimation:function(a,b){if(b&&this.animations!=
b){this.animations=b;for(var c=this.animations.length;c--;){var d=b[c];window.wm||d.onAnimationStart&&d.onAnimationStart(a)}}},addColorOverlay:function(a){this.colorOverlays.push(a)},getFrame:function(){if(!this.animations)return 0;var a=this.animations[0];if(!a)return 0;var b=a.getFrameCount(),c=Math.floor(this.timer/a.frameTime);return a.stop?Math.min(c,b-1):c%b},isStatic:function(){if(!this.animations)return true;for(var a=this.animations.length;a--;)if(this.animations[a].getFrameCount()>1)return false;
return true},isRepeat:function(){return!this.animations?false:!this.animations[0].stop},hasStopped:function(){if(!this.animations)return false;var a=this.animations[0],b=Math.floor(this.timer/a.frameTime);return a.stop&&b>=a.getFrameCount()},rewind:function(){this.loopCount=this.timer=0;return this},update:function(a,b){this.timer=this.timer+ig.system.tick*b;var c=this.animations.length;for(this.loopCount=-1;c--;){var d=this.animations[c],e=Math.floor(this.timer/d.getDuration());this.loopCount=this.loopCount==
-1?e:Math.min(this.loopCount,e);d.onUpdate&&d.onUpdate(a,this,b)}},updateSprite:function(a){if(this.animations){a.setSpriteCount(this.animations.length,this.animations.length>0&&this.animations[0].guiSprites);for(var b=this.animations.length;b--;){var c=this.animations[b],d=a.sprites[b];!c||c.sheet&&!c.sheet.image.loaded?d.setInvisible():c.updateSprite(a,d,this,b)}this.updateSpriteColor(a)}else a.setSpriteCount(0)},updateSpriteColor:function(a){var c=j,d=k;c.color=null;c.colorAlpha=0;d.color=null;
d.colorAlpha=0;for(var e=this.colorOverlays.length,f=null;e--;){var g=this.colorOverlays[e],h=g.lighter?d:c;if(g.color){if(g.spriteFilter!==null){f||(f=[]);f[g.spriteFilter]||(f[g.spriteFilter]={normal:{color:null,colorAlpha:0},lighter:{color:null,colorAlpha:0}});h=g.lighter?f[g.spriteFilter].lighter:f[g.spriteFilter].normal}if(h.color)b(h,g.color,g.alpha);else{h.color=new ig.RGBColor(g.color);h.colorAlpha=g.alpha}}else this.colorOverlays.splice(e,1)}for(e=a.sprites.length;e--;){if((g=f&&f[e])&&g.normal.color){c.color&&
b(g.normal,c.color,c.colorAlpha);a.sprites[e].setOverlayColor(g.normal.color.toRGB(),g.normal.colorAlpha)}else a.sprites[e].setOverlayColor(c.color?c.color.toRGB():null,c.colorAlpha);if(g&&g.lighter.color){d.color&&b(g.lighter,d.color,d.colorAlpha);a.sprites[e].setLighterOverlayColor(g.lighter.color.toRGB(),g.lighter.colorAlpha)}else a.sprites[e].setLighterOverlayColor(d.color?d.color.toRGB():null,d.colorAlpha)}}});ig.AnimModification=ig.Class.extend({entity:null,name:null,spriteIdx:0,tileOffset:0,
init:function(a,b,c){this.entity=a;this.spriteIdx=b;(this.name=c)&&ig.AnimModification.removeMods(a,c);a.animState.animMods.push(this)},remove:function(){this.entity.animState.animMods.erase(this)},onActionEndDetach:function(){this.remove()}});ig.AnimModification.removeMods=function(a,b){for(var c=a.animState.animMods.length;c--;)(!b||a.animState.animMods[c].name==b)&&a.animState.animMods[c].remove()};var j={},k={};ig.ColorOverlay=ig.Class.extend({color:null,alpha:null,spriteFilter:null,lighter:false,
init:function(a,b,c,d){this.color=new ig.RGBColor(a);this.alpha=b;if(c!==void 0)this.spriteFilter=c;this.lighter=d},clear:function(){this.color=null}});ig.SingleDirAnimationSet=ig.Class.extend({animations:[],init:function(a){this.animations.push(a)},getAnimations:function(){return this.animations},getAnchorOffset:function(a,b){var c=this.animations[0];return c&&c.getAnchorOffset?c.getAnchorOffset(a,b):null},getDuration:function(){for(var a=0,b=this.animations.length;b--;)a=Math.max(this.animations[b].getDuration(),
a);return a},merge:function(a){this.animations.push.apply(this.animations,a.animations)}});ig.MultiDirAnimationSet=ig.Class.extend({numDirs:0,animations:[],anchorOffsetX:null,anchorOffsetY:null,anchorOffsetZ:null,init:function(a){this.numDirs=a.dirs*1;this.anchorOffsetX=a.anchorOffsetX;this.anchorOffsetY=a.anchorOffsetY;this.anchorOffsetZ=a.anchorOffsetZ},setAnimations:function(a,b){var c=b.tileOffsets,d=b.flipX,e=b.offset,f=b.dirOffsets,g=b.dirAngles,h=b.allDirFlipX||false;b.angle=0;this.numDirs=
b.tileOffsets.length;this.animations=[];for(var i=0;i<this.numDirs;i++){var j=h?(this.numDirs-i)%this.numDirs:i;b.tileOffset=c[j];b.flipX=d&&d[j]||0;h&&(b.flipX=!b.flipX);if(f){var k=Vec3.create();e&&Vec3.add(k,e);k.x=k.x+(f[j]&&f[j][0]||0)*(h?-1:1);k.y=k.y+(f[j]&&f[j][1]||0);k.z=k.z+(f[j]&&f[j][2]||0);b.offset=k}g&&(b.angle=g[j]);this.animations[i]=[new ig.Animation(a,b)]}},addAnimation:function(a){this.animations.push([a])},merge:function(a){if(this.numDirs!=a.numDirs)throw Error("Tried to merge Multi Dir Anims with different number of directions. Not supported.");
for(var b=0;b<this.numDirs;++b){var c=this.animations[b];c.push.apply(c,a.animations[b])}},getAnchorOffset:function(a,b){if(!this.anchorOffsetX&&!this.anchorOffsetY&&!this.anchorOffsetZ)return null;var c=ig.getDirectionIndex(a,b,this.numDirs);return{x:this.anchorOffsetX&&(this.anchorOffsetX.length?this.anchorOffsetX[c]:this.anchorOffsetX)||0,y:this.anchorOffsetY&&(this.anchorOffsetY.length?this.anchorOffsetY[c]:this.anchorOffsetY)||0,z:this.anchorOffsetZ&&(this.anchorOffsetZ.length?this.anchorOffsetZ[c]:
this.anchorOffsetZ)||0}},getAnimations:function(a){a=ig.getDirectionIndex(a.face.x,a.face.y,this.numDirs);return this.animations[a]},getDuration:function(){for(var a=0,b=this.animations[0],c=b.length;c--;)a=Math.max(b[c].getDuration(),a);return a}});ig.getDirectionIndex=function(a,b,c){switch(c){case 1:return 0;case 2:return a>=0?0:1;case 4:return Math.abs(b)>Math.abs(a)?b<0?0:2:a>0?1:3;case 6:return a>=0?b<=0?0+(57*a>-100*b):1+(57*a<100*b):b<=0?4+(-57*a<-100*b):3+(-57*a>100*b);case 8:return Math.abs(b)>
2.414*Math.abs(a)?b<0?0:4:Math.abs(a)>2.414*Math.abs(b)?a>0?2:6:a>0?b<0?1:3:b>0?5:7;case 16:var c=Math.abs(a),d=Math.abs(b);return d>5.0273*c?b<0?0:8:d<0.1989*c?a>0?4:12:d>1.4966*c?a>0?b<0?1:7:b>0?9:15:d>0.6682*c?a>0?b<0?2:6:b>0?10:14:a>0?b<0?3:5:b>0?11:13}};ig.getDirectionVel=function(a,b,c){c=c||Vec2.create();switch(b){case 1:Vec2.assignC(c,0,1);break;case 2:switch(a){case 0:Vec2.assignC(c,1,0);break;case 1:Vec2.assignC(c,-1,0)}break;case 4:switch(a){case 0:Vec2.assignC(c,0,-1);break;case 1:Vec2.assignC(c,
1,0);break;case 2:Vec2.assignC(c,0,1);break;case 3:Vec2.assignC(c,-1,0)}break;case 6:switch(a){case 0:Vec2.assignC(c,0.5,-0.866);break;case 1:Vec2.assignC(c,1,0);break;case 2:Vec2.assignC(c,0.5,0.866);break;case 3:Vec2.assignC(c,-0.5,0.866);break;case 4:Vec2.assignC(c,-1,0);break;case 5:Vec2.assignC(c,-0.5,-0.866)}break;case 8:switch(a){case 0:Vec2.assignC(c,0,-1);break;case 1:Vec2.assignC(c,1,-1);break;case 2:Vec2.assignC(c,1,0);break;case 3:Vec2.assignC(c,1,1);break;case 4:Vec2.assignC(c,0,1);break;
case 5:Vec2.assignC(c,-1,1);break;case 6:Vec2.assignC(c,-1,0);break;case 7:Vec2.assignC(c,-1,-1)}break;case 16:switch(a){case 0:Vec2.assignC(c,0,-1);break;case 1:Vec2.assignC(c,0.38268,-0.92387);break;case 2:Vec2.assignC(c,1,-1);break;case 3:Vec2.assignC(c,0.92387,-0.38268);break;case 4:Vec2.assignC(c,1,0);break;case 5:Vec2.assignC(c,0.92387,0.38268);break;case 6:Vec2.assignC(c,1,1);break;case 7:Vec2.assignC(c,0.38268,0.92387);break;case 8:Vec2.assignC(c,0,1);break;case 9:Vec2.assignC(c,-0.38268,
0.92387);break;case 10:Vec2.assignC(c,-1,1);break;case 11:Vec2.assignC(c,-0.92387,0.38268);break;case 12:Vec2.assignC(c,-1,0);break;case 13:Vec2.assignC(c,-0.92387,-0.38268);break;case 14:Vec2.assignC(c,-1,-1);break;case 15:Vec2.assignC(c,-0.38268,-0.92387)}break;default:throw Error("Does not support Direction Vel for numDirs: "+b);}return c};ig.getRoundedFaceDir=function(a,b,c,d){a=ig.getDirectionIndex(a,b,c);return ig.getDirectionVel(a,c,d)};var l=Vec2.create();ig.isFaceLeftHalf=function(a,b){return ig.getRoundedFaceDir(a.face.x,
a.face.y,b,l).x<0};ig.AnimationSheet=ig.JsonLoadable.extend({cacheType:"AnimationSheet",namedSheets:{},createdSheets:[],anims:{},sharedAnimData:null,replaceAnimationSet:function(a,b){this.anims[a]=b},removeAnimSet:function(a){delete this.anims[a]},hasAnimation:function(a){return!!this.anims[a]},addAnimationSet:function(a,b){this.anims[a]?this.anims[a].merge(b):this.anims[a]=b},clearCached:function(){for(var a=0;a<this.createdSheets.length;++a)this.createdSheets[a].clearCached()},getJsonPath:function(){return ig.root+
this.path.toPath("data/animations/",".json")+ig.getCacheSuffix()},onload:function(b){if(b)if(b.DOCTYPE=="MULTI_DIR_ANIMATION"){a(this,b);d(this,b,e)}else if(b.DOCTYPE=="MULTI_ENTITY_ANIMATION"){a(this,b);var f={},g;for(g in b.parts)f[g]=new ig.MultiEntityAnimationPart(g,this.namedSheets,b.parts[g]);var h=b.baseSize;this.sharedAnimData={baseSize:h,parts:f};for(g in b.anims){var i=new ig.MultiEntityAnimation(h,f,b.anims[g]);this.addAnimationSet(g,new ig.SingleDirAnimationSet(i))}}else{a(this,b);d(this,
b,c)}},_getSheet:function(a){var b;(b=typeof a=="string"?this.namedSheets[a]:a)||ig.warn("Sheet '"+a+"' not found in AnimationSheet: "+this.path);return b}})});ig.baked=!0;
ig.module("impact.base.coll-entry").defines(function(){ig.COLL_UPDATE_TYPE={STATIC:0,ON_SCREEN:1,DYNAMIC:2};ig.COLL_HEIGHT_SHAPE={NONE:0,NORTH_UP:1,EAST_UP:2,WEST_UP:3,SOUTH_UP:4};ig.COLL_SHADOW_TYPE={DEFAULT:0,STATIC_SIZE:1,RECTANGULAR:2};ig.COLL_GROUND_CONNECT={LOOSE:0,FIXED:1,IN_EARTH:2,STRONG_FLIGHT:3};var b={};ig.CollEntry=ig.Class.extend({entity:null,_active:false,_inCollisionMap:false,_killed:false,type:0,updateType:ig.COLL_UPDATE_TYPE.DYNAMIC,shape:1,heightShape:ig.COLL_HEIGHT_SHAPE.NONE,
size:{x:0,y:0,z:0},alwaysRender:false,padding:{x:0,y:0},ignoreCollision:false,groundConnect:ig.COLL_GROUND_CONNECT.LOOSE,groundSlip:false,edgeSlipInward:false,weight:-1,friction:{ground:1,air:1,terrain:1,ignoreTerrain:false},accelSpeed:1,maxVel:100,maxZVel:1E3,relativeVel:1,bounciness:0,zBounciness:0.2,minBounceVelocity:40,zGravityFactor:0,"float":{height:0,variance:1,maxSpeed:300,accel:1},time:{factor:1,logicFactor:1,moveXYFactor:1,globalStatic:false,animStatic:false,parent:null,parentAnimToGlobal:false},
pos:Vec3.create(),level:0,baseZPos:0,shadow:{type:ig.COLL_SHADOW_TYPE.DEFAULT,size:0,scaleY:1,offset:Vec2.create()},vel:Vec3.create(),pushVel:Vec2.create(),accelDir:Vec2.create(),parentColl:null,parentGroup:null,subColls:[],totalBlockTimer:0,partlyBlockTimer:0,updated:0,_collData:null,_collisionList:[],_collisionListData:[],init:function(a){this.entity=a;this.reset()},initCollData:function(){if(this._collData)return false;this._collData={collided:false,frameVel:Vec3.create(),blockDir:Vec2.create(),
slipped:false,zBaseUncertain:true,zPush:false,skipPhysics:false,forceMoveFrameVel:false,pushColl:null,groundEntry:null,groundEntryOffset:Vec2.create(),overlapEntry:null,ceilingEntry:null,overlapEntryFactor:1,noSlipping:false,holeInfo:{mapRes:0,mapDir:Vec2.create(),entryDir:Vec2.create(),entryZ:0,entryDist:0,entryDanger:false}};return true},reset:function(){var a=this.constructor.prototype;this._active=a.active;this._inCollisionMap=a._inCollisionMap;this._killed=a._killed;this.time.globalStatic=a.time.globalStatic;
this.time.animStatic=a.time.animStatic;this.time.factor=a.time.factor;this.time.logicFactor=a.time.logicFactor;this.type=a.type;this.updateType=a.updateType;this.shape=a.shape;this.heightShape=a.heightShape;Vec3.assign(this.size,a.size);Vec2.assign(this.padding,a.padding);this.ignoreCollision=a.ignoreCollision;this.groundConnect=a.groundConnect;this.groundSlip=a.groundSlip;this.weight=a.weight;this.friction.ground=a.friction.ground;this.friction.terrain=a.friction.terrain;this.friction.air=a.friction.air;
this.friction.ignoreTerrain=a.friction.ignoreTerrain;this.accelSpeed=a.accelSpeed;this.maxVel=a.maxVel;this.noSlipping=a.noSlipping;this.relativeVel=a.relativeVel;this.bounciness=a.bounciness;this.zBounciness=a.zBounciness;this.minBounceVelocity=a.minBounceVelocity;this.zGravityFactor=a.zGravityFactor;this.float.height=a.float.height;this.float.variance=a.float.variance;this.float.maxSpeed=a.float.maxSpeed;this.float.accel=a.float.accel;Vec3.assign(this.pos,a.pos);this.level=a.level;this.baseZPos=
a.baseZPos;this.shadow.size=a.shadow.size;this.shadow.scaleY=a.shadow.scaleY;this.shadow.type=a.shadow.type;this.shadow.offset.x=a.shadow.offset.x;this.shadow.offset.y=a.shadow.offset.y;Vec3.assign(this.vel,a.vel);Vec2.assign(this.pushVel,a.pushVel);Vec3.assign(this.accelDir,a.accelDir);this.parentColl=a.parentColl;this.parentGroup=a.parentGroup;this.subColls.length=0;this.totalBlockTimer=a.totalBlockTimer;this.partlyBlockTimer=a.partlyBlockTimer;this.updated=a.updated;this._collData=a._collData;
this._collisionList.length=0;this._collisionListData.length=0;this.alwaysRender=a.alwaysRender;this.edgeSlipInward=a.edgeSlipInward},setPos:function(a,b,d,g){var h=0,i=0,j=0,k=!isNaN(a)||!isNaN(b);if(k&&g&&this._collData){this._collData.frameVel.x=a-this.pos.x;this._collData.frameVel.y=b-this.pos.y;this._collData.frameVel.z=d-this.pos.z;this._collData.forceMoveFrameVel=true}else{(g=k&&this._inCollisionMap)&&ig.game.physics.removeFromCollMap(this);if(!isNaN(a)){h=a-this.pos.x;this.pos.x=a}if(!isNaN(b)){i=
b-this.pos.y;this.pos.y=b}g&&ig.game.physics.addToCollMap(this);if(!isNaN(d)){j=d-this.pos.z;this.pos.z=d;this.level=ig.game.getLevelIdx(this.pos.z);this.baseZPos=Math.min(this.baseZPos,this.pos.z);this._collData&&(this._collData.zBaseUncertain=true)}if(this._collData){if(!this._collData.skipPhysics){this._collData.skipPhysics=true;this._collData.frameVel.x=this._collData.frameVel.y=this._collData.frameVel.z=0}this._collData.frameVel.x=this._collData.frameVel.x+h;this._collData.frameVel.y=this._collData.frameVel.y+
i;this._collData.frameVel.z=j;if(this._collData.groundEntry){this._collData.groundEntryOffset.x=this._collData.groundEntryOffset.x+h;this._collData.groundEntryOffset.y=this._collData.groundEntryOffset.y+i}}if(isNaN(this.pos.x)||isNaN(this.pos.y)||isNaN(this.pos.z))throw Error("Position update leads to NaN coordinate!");}},setType:function(a){var b=a!=ig.COLLTYPE.PASSIVE&&a!=ig.COLLTYPE.NONE;this.type=a;ig.game.physics&&!this.entity._hidden&&(this._inCollisionMap&&!b?ig.game.physics.removeFromCollMap(this):
!this._inCollisionMap&&b&&ig.game.physics.addToCollMap(this))},setUpdateType:function(a){if(this.updateType!=a){var b=this.updateType;this.updateType=a;this._active&&b==ig.COLL_UPDATE_TYPE.STATIC&&ig.game.physics.addToUpdateList(this)}},setSize:function(a,d,f,g,h){if(!(a==this.size.x&&d==this.size.y&&f==this.size.z)){var i=this._inCollisionMap;i&&ig.game.physics.removeFromCollMap(this);if(g){var g=(a-this.size.x)/2,j=(d-this.size.y)/2;if(h){var k=h=0,l=null;if(g>0){l=ig.game.physics.initTraceResult(b);
ig.game.traceEntity(l,this.entity,g,0,0,0,0)&&(h=-Math.ceil((1-l.dist)*g));l=ig.game.physics.initTraceResult(b);ig.game.traceEntity(l,this.entity,-g,0,0,0,0)&&(h=h?0:Math.ceil((1-l.dist)*g))}if(j>0){l=ig.game.physics.initTraceResult(b);ig.game.traceEntity(l,this.entity,0,j,0,0,0)&&(k=-Math.ceil((1-l.dist)*j));l=ig.game.physics.initTraceResult(b);ig.game.traceEntity(l,this.entity,0,-j,0,0,0)&&(k=k?0:Math.ceil((1-l.dist)*j))}g=g-h;j=j-k}this.pos.x=this.pos.x-g;this.pos.y=this.pos.y-j;if(this._collData&&
this._collData.groundEntry){this._collData.groundEntryOffset.x=this._collData.groundEntryOffset.x-g;this._collData.groundEntryOffset.y=this._collData.groundEntryOffset.y-j}}this.size.x=a;this.size.y=d;this.size.z=f;i&&ig.game.physics.addToCollMap(this)}},setPadding:function(a,b){var d=this._inCollisionMap;d&&ig.game.physics.removeFromCollMap(this);this.padding.x=a;this.padding.y=b;d&&ig.game.physics.addToCollMap(this)},getCenter:function(a){a=a||Vec2.create();Vec2.assignC(a,this.pos.x+this.size.x/
2,this.pos.y+this.size.y/2);return a},addSubCollEntry:function(a){this.subColls.push(a);a.parentColl=this},getTick:function(a,b){if(this.time.parent)return this.time.parent.getTick(this.time.parentAnimToGlobal||a,b);var d=this.time.globalStatic;!d&&(a&&this.time.animStatic)&&(d=true);d=d?ig.system.actualTick:ig.system.ingameTick;d=d*this.time.factor;b||(d=d*this.time.logicFactor);return d},update:function(){var b=this.friction.ignoreTerrain?1:this.friction.terrain,e=this.pos.z>this.baseZPos||this.vel.z>
0?this.friction.air:this.friction.ground*b;if(Math.abs(this.vel.x)<2&&this.accelDir.x==0)this.vel.x=0;if(Math.abs(this.vel.y)<2&&this.accelDir.y==0)this.vel.y=0;var b=this.maxVel*this.relativeVel*this.time.moveXYFactor,f=Vec2.mulF(this.vel,e*12*ig.system.tick,d);if(this.accelDir.x||this.accelDir.y){Vec2.normalize(this.accelDir);var g=Vec2.length(this.vel);if(g<=b+ig.COLLISION.EPS){var g=b,h=Vec2.dot(this.accelDir,f);h>=0&&Vec2.sub(f,Vec2.mulF(this.accelDir,h,a))}e=Vec2.mulF(this.accelDir,b*10*e*this.accelSpeed,
a);this.vel.x=this.vel.x+e.x*ig.system.tick;this.vel.y=this.vel.y+e.y*ig.system.tick;Vec2.limit(this.vel,0,Math.max(g,b))}this.vel.x=this.vel.x-f.x;this.vel.y=this.vel.y-f.y},contains:function(a,b,d){return!(this.pos.x>a||this.pos.x+this.size.x<a||this.pos.y-this.pos.z-(d?this.size.z:0)>b||this.pos.y-this.pos.z+this.size.y<b)},intersectsWith:function(a,b,d,g,h,i,j,k,l){if((j=(j||!this.ignoreCollision)&&!(this.pos.x-this.padding.x>=a+g||this.pos.x+this.padding.x+this.size.x<=a||this.pos.y-this.padding.y>=
b+h||this.pos.y+this.padding.y+this.size.y<=b||this.pos.z>d+i||d>this.pos.z+this.size.z))&&l&&(this.pos.z>=d+i||d>=this.pos.z+this.size.z))return false;if(j&&k&&k!=ig.COLLSHAPE.RECTANGLE){var o,a=a+g/2,b=b+h/2;switch(k){case ig.COLLSHAPE.SLOPE_NE:o=this.pos.x-a-(this.pos.y+this.size.y-b);break;case ig.COLLSHAPE.SLOPE_SE:o=this.pos.x-a+(this.pos.y-b);break;case ig.COLLSHAPE.SLOPE_SW:o=-(this.pos.x+this.size.x-a)+(this.pos.y-b);break;case ig.COLLSHAPE.SLOPE_NW:o=-(this.pos.x+this.size.x-a)-(this.pos.y+
this.size.y-b)}o>=-ig.COLLISION.EPS&&(j=false)}return j},trace:function(b,d,f,g,h,i,j,k,l,o){if(this.ignoreCollision)return false;var m=d+(h<0?h:0)>=this.pos.x+this.size.x,n=d+j+(h>0?h:0)<=this.pos.x,p=f+(i<0?i:0)>=this.pos.y+this.size.y,r=f+k+(i>0?i:0)<=this.pos.y,l=g+l<=this.pos.z,g=this.pos.z+this.getOverlapHeight(d,f,j,k,true)<=g+(o?ig.COLLISION.HEIGHT_TOLERATE:0);if(m||n||p||r||l||g)return false;if(this.heightShape&&!(d>=this.pos.x+this.size.x||d+j<=this.pos.x||f>=this.pos.y+this.size.y||f+k<=
this.pos.y)){Vec2.assignC(a,0,0);switch(this.heightShape){case ig.COLL_HEIGHT_SHAPE.NORTH_UP:a.y=-1;break;case ig.COLL_HEIGHT_SHAPE.EAST_UP:a.x=1;break;case ig.COLL_HEIGHT_SHAPE.SOUTH_UP:a.y=1;break;case ig.COLL_HEIGHT_SHAPE.WEST_UP:a.x=-1}if(a.x*h+a.y*i>0){b.dist=0;b.dir.x=a.x;b.dir.y=a.y;return true}}if(h!=0&&i!=0){m=d+h+(h<0?j:0)-(this.pos.x+(h>0?this.size.x:0));n=f+i+(i>0?k:0)-(this.pos.y+(i<0?this.size.y:0));if(m*h>=0&&n*i>=0&&Math.abs(m)<Math.abs(h)&&Math.abs(n)<Math.abs(i)&&Math.abs(m/n)>Math.abs(h/
i))return false;n=f+i+(i<0?k:0)-(this.pos.y+(i>0?this.size.y:0));m=d+h+(h>0?j:0)-(this.pos.x+(h<0?this.size.x:0));if(m*h>=0&&n*i>=0&&Math.abs(m)<Math.abs(h)&&Math.abs(n)<Math.abs(i)&&Math.abs(n/m)>Math.abs(i/h))return false}return this.shape==ig.COLLSHAPE.RECTANGLE?ig.MAP.Collision.solveBlockCollision(b,d,f,h,i,j,k,this.pos.x,this.pos.y,this.size.x,this.size.y):ig.MAP.Collision.solveBlockCollision(b,d,f,h,i,j,k,this.pos.x,this.pos.y,this.size.x,this.size.y,this.shape-2)},getOverlapCenterCoords:function(a,
b){var d=b||{};d.x=(Math.max(this.pos.x,a.pos.x)+Math.min(this.pos.x+this.size.x,a.pos.x+a.size.x))/2;d.y=(Math.max(this.pos.y,a.pos.y)+Math.min(this.pos.y+this.size.y,a.pos.y+a.size.y))/2;d.z=(Math.max(this.pos.z,a.pos.z)+Math.min(this.pos.z+this.size.z,a.pos.z+a.size.z))/2;d.x=d.x.limit(this.pos.x,this.pos.x+this.size.x);d.y=d.y.limit(this.pos.y,this.pos.y+this.size.y);return d},setGroundEntry:function(a){if(this._collData){var b=a!=this._collData.groundEntry;if(b&&this._collData.groundEntry&&this._collData.groundEntry.entity.onGroundRemove)this._collData.groundEntry.entity.onGroundRemove(this.entity);
if(this._collData.groundEntry=a){this._collData.groundEntryOffset.x=this.pos.x-a.pos.x;this._collData.groundEntryOffset.y=this.pos.y-a.pos.y;if(b&&a.entity.onGroundAdd)a.entity.onGroundAdd(this.entity)}}},getOverlapHeight:function(a,b,d,g,h){switch(this.heightShape){case ig.COLL_HEIGHT_SHAPE.NONE:return this.size.z;case ig.COLL_HEIGHT_SHAPE.NORTH_UP:return h&&this.size.z/this.size.y>4?this.size.z:(-(b-this.pos.y-this.size.y)/this.size.y).limit(0,1)*this.size.z;case ig.COLL_HEIGHT_SHAPE.EAST_UP:return h&&
this.size.z/this.size.x>4?this.size.z:((a+d-this.pos.x)/this.size.x).limit(0,1)*this.size.z;case ig.COLL_HEIGHT_SHAPE.SOUTH_UP:return h&&this.size.z/this.size.y>4?this.size.z:((b+g-this.pos.y)/this.size.y).limit(0,1)*this.size.z;case ig.COLL_HEIGHT_SHAPE.WEST_UP:return h&&this.size.z/this.size.x>4?this.size.z:(-(a-this.pos.x-this.size.x)/this.size.x).limit(0,1)*this.size.z}},handleMovementTrace:function(a){if(a.collided)if(this.bounciness>0&&Math.abs(this.vel.y)+Math.abs(this.vel.x)>this.minBounceVelocity){var b=
this.vel.x*a.blockDir.x+this.vel.y*a.blockDir.y;this.vel.x=this.vel.x-2*b*a.blockDir.x;this.vel.y=this.vel.y-2*b*a.blockDir.y;this.vel.x=this.vel.x*this.bounciness;this.vel.y=this.vel.y*this.bounciness}else if(!a.slipped){if(a.frameVel.x==0&&a.blockDir.x*this.vel.x>=0)this.vel.x=0;if(a.frameVel.y==0&&a.blockDir.y*this.vel.y>=0)this.vel.y=0}}});ig.CollTools={getNamedSubCollEntity:function(a,b){for(var d=a.subColls,g=d.length;g--;)if(d[g].entity.partName==b)return d[g].entity},isInScreen:function(a,
b,d){b===void 0&&(b=0);d===void 0&&(d=b);return a.pos.x+a.size.x+b<ig.game.screen.x||a.pos.x-b>ig.game.screen.x+ig.system.width||a.pos.y-a.pos.z+a.size.y+d<ig.game.screen.y||a.pos.y-a.pos.z-a.size.z-d>ig.game.screen.y+ig.system.height?false:true},getDistVec2:function(a,b,d){d.x=b.pos.x+b.size.x/2-(a.pos.x+a.size.x/2);d.y=b.pos.y+b.size.y/2-(a.pos.y+a.size.y/2);return d},getDistVec3:function(a,b,d){d.x=b.pos.x+b.size.x/2-(a.pos.x+a.size.x/2);d.y=b.pos.y+b.size.y/2-(a.pos.y+a.size.y/2);d.z=b.pos.z-
a.pos.z;return d},getGroundDistance:function(a,b){var d=a.pos.x+a.size.x/2-(b.pos.x+b.size.x/2),g=a.pos.y+a.size.y/2-(b.pos.y+b.size.y/2);return Math.sqrt(d*d+g*g)},getScreenDistance:function(a,b){var d=a.pos.x+a.size.x/2-(b.pos.x+b.size.x/2),g=a.pos.y-a.pos.z+a.size.y/2-a.size.z/2-(b.pos.y-b.pos.z+b.size.y/2- -b.size.z/2);return Math.sqrt(d*d+g*g)},getAngle:function(a,b){return Math.atan2(b.pos.y+b.size.y/2-(a.pos.y+a.size.y/2),b.pos.x+b.size.x/2-(a.pos.x+a.size.x/2))},isCloseToEdge:function(a){a=
a._collData;return!a?false:a.holeInfo.mapRes!=0||a.groundEntry&&!a.groundEntry.entity.respawnOkay||a.overlapEntry},intersect:function(a,b,d){return!d&&a.pos.z>=b.pos.z+b.size.z||b.pos.z>=a.pos.z+a.size.z||a.pos.x>=b.pos.x+b.size.x||b.pos.x>=a.pos.x+a.size.x||a.pos.y>=b.pos.y+b.size.y||b.pos.y>=a.pos.y+a.size.y?false:true},getCenterXYAlignedPos:function(a,b,d,g){var h=d.pos,i=b.size,d=d.size;Vec3.assignC(a,h.x+d.x/2-i.x/2+(g&&g.x||0),h.y+d.y/2-i.y/2+(g&&g.y||0),b.pos.z+(g&&g.z||0));return a},getOverlapArea:function(a,
b,d,g,h){return(Math.max(a.pos.x,b)-Math.min(a.pos.x+a.size.x,b+g))*(Math.max(a.pos.y,d)-Math.min(a.pos.y+a.size.y,d+h))},isMinOverlap:function(a,b,d,g){return a.pos.x+a.size.x-b.pos.x<d||b.pos.x+b.size.x-a.pos.x<d||a.pos.y+a.size.y-b.pos.y<g||b.pos.y+b.size.y-a.pos.y<g?false:true},isPostMoveOverHole:function(b,d){var f=Vec2.assign(a,b.accelDir);Vec2.length(f,Math.max(ig.system.tick*3*Vec2.length(b.vel),b.size.x*0.75));return ig.game.isOverHole(b.pos.x+f.x,b.pos.y+f.y,b.pos.z,b.size.x,b.size.y,d,
true)},getJumpDuration:function(a,b,d){var g=a.vel.z,h=a.zGravityFactor*-ig.game.gravity,a=a.pos.z;d!==void 0&&(g=d);if(h==0)return(b-a)/g;b=g*g-2*h*(a-b);if(b<0)return-1;b=Math.sqrt(b);return Math.max((-g-b)/h,(-g+b)/h)},getJumpSpeedForDuration:function(a,b,d){var g=a.zGravityFactor*-ig.game.gravity;return g==0?1:(b-a.pos.z)/d-g*d/2},getJumpZenitDuration:function(a){return-a.vel.z/(a.zGravityFactor*-ig.game.gravity)},getJumpSpeedToHeight:function(a,b){return a.pos.z<b?Math.sqrt((a.pos.z-b)*2*a.zGravityFactor*
-ig.game.gravity):0},getMaxDistMoveFactor:function(b,e,f){var e=this.getDistVec2(e,b,a),g=Vec2.assign(d,b.accelDir);Vec2.length(g,b.maxVel*b.relativeVel*ig.system.tick);b=Vec2.dot(g,g);g=Vec2.dot(e,g);f=Vec2.dot(e,e)-f*f;f=g*g-b*f;if(f<0)return-1;f=Math.sqrt(f);return(-g+f)/b},hasWallCollide:function(a,b){return!(a.totalBlockTimer>0||a.partlyBlockTimer>0)?false:!b?true:Vec2.angle(a.vel,a._collData.blockDir)<Math.PI*2*b}};var a=Vec2.create(),d=Vec2.create()});ig.baked=!0;
ig.module("impact.base.entity").requires("impact.base.animation","impact.base.coll-entry","impact.base.impact").defines(function(){function b(a,d){if(!a.animState)return false;a.animState.addColorOverlay(d);for(var f=a.coll,g=f.subColls.length;g--;)b(f.subColls[g].entity,d);return true}function a(b,d,f){if(!d._hidden){for(var g=d.sprites,h=g.length;h--;){var i=b,j=g[h];if(j.size.x&&(j.size.y||j.size.z)&&j.image){var k=j.pos.x+j.size.x,l=j.pos.y-j.pos.z-j.size.z,o=j.pos.y-j.pos.z+j.size.y,m=f.coll,
n=m.pos.x,m=m.pos.y-m.pos.z;i.left=Math.max(i.left,n-j.pos.x);i.right=Math.max(i.right,k-n);i.top=Math.max(i.top,m-l);i.bottom=Math.max(i.bottom,o-m)}}d=d.coll.subColls;if(d.length>0)for(h=d.length;h--;)a(b,d[h].entity,f)}}ig.ENTITY_SPRITE_MODE={FLAT:1,CUBE:2};ig.ENTITY_ALIGN={BOTTOM:1,CENTER:2,TOP:3,FACE:4,BASE:5,WALL_HIT:6,FACE_BASE:7};var d=Vec2.create();ig.ENTITY_KILL_CALL=false;ig.Entity=ig.Class.extend({id:0,uid:0,mapId:0,settings:{},name:null,coll:null,sprites:[],entityAttached:[],_hidden:true,
_hideRequest:true,_killed:false,_wm:new ig.Config({}),init:function(a,b,d,g){this.uid=++ig.Entity._lastId;this.coll=new ig.CollEntry(this);this.coll.setPos(a,b,d);if(g.size)ig.merge(this.coll.size,g.size);else if(window.wm){if(this._wm.scalableX)this.coll.size.x=32;if(this._wm.scalableY)this.coll.size.y=32}if(g.mapId)this.mapId=g.mapId;this.name=g.name||this.name},reset:function(a,b,d,g){this.uid=++ig.Entity._lastId;this.coll.reset();this.coll.setPos(a,b,d);this._killed=false;this._hidden=true;if(g.size)ig.merge(this.coll.size,
g.size);else if(window.wm){if(this._wm.scalableX)this.coll.size.x=32;if(this._wm.scalableY)this.coll.size.y=32}if(g.mapId)this.mapId=g.mapId;this.name=g.name||this.name},initSprites:function(){},setPos:function(a,b,d,g){this.coll.setPos(a,b,d,g)},setZPos:function(a){this.setPos(void 0,void 0,a)},setSize:function(a,b,d){this.coll.setSize(a,b,d)},getCenter:function(a){return this.coll.getCenter(a)},getAlignedPos:function(a,b){var b=b||Vec3.create(),d=this.getCenter(b);d.z=this.coll.pos.z;switch(a){case ig.ENTITY_ALIGN.TOP:d.z=
d.z+this.coll.size.z;break;case ig.ENTITY_ALIGN.CENTER:d.z=d.z+this.coll.size.z/2;break;case ig.ENTITY_ALIGN.FACE:case ig.ENTITY_ALIGN.FACE_BASE:var g;if(this.getFaceOffset&&(g=this.getFaceOffset())){d.y=d.y+this.coll.size.y/2;d.x=d.x+(g&&g.x||0);d.y=d.y+(g&&g.y||0);d.z=d.z+(g&&g.z||0)}if(a==ig.ENTITY_ALIGN.FACE_BASE)d.z=this.coll.baseZPos;break;case ig.ENTITY_ALIGN.BASE:d.z=this.coll.baseZPos;break;case ig.ENTITY_ALIGN.WALL_HIT:if(g=this.coll._collData&&this.coll._collData.blockDir){if(g.x>0)d.x=
d.x+this.coll.size.x/2;else if(g.x<0)d.x=d.x-this.coll.size.x/2;if(g.y>0)d.y=d.y+this.coll.size.y/2;else if(g.y<0)d.y=d.y-this.coll.size.y/2}}return d},getOverlapCenterCoords:function(a,b){return this.coll.getOverlapCenterCoords(a.coll,b)},getHitDir:function(a,b){b=b||Vec2.create();a.getCenter(b);Vec2.sub(b,this.getCenter(d));return b},getCollideSide:function(a){Vec2.assign(d,this.coll.vel);Vec2.sub(d,a.coll.vel);Vec2.mulF(d,ig.system.tick);var b=-1,f=-1;d.x&&(b=d.x>0?(this.coll.pos.x+this.coll.size.x-
a.coll.pos.x)/d.x:(a.coll.pos.x+a.coll.size.x-this.coll.pos.x)/-d.x);d.y&&(f=d.y>0?(this.coll.pos.y+this.coll.size.y-a.coll.pos.y)/d.y:(a.coll.pos.y+a.coll.size.y-this.coll.pos.y)/-d.y);return b<0||b>1?ig.ActorEntity.FACE4[d.y>0?"NORTH":"SOUTH"]:f<0||f>1?ig.ActorEntity.FACE4[d.x>0?"WEST":"EAST"]:b<f?ig.ActorEntity.FACE4[d.x>0?"WEST":"EAST"]:ig.ActorEntity.FACE4[d.y>0?"NORTH":"SOUTH"]},update:function(){this.coll.update()},handleMovementTrace:function(a){this.coll.handleMovementTrace(a)},setSpriteCount:function(a,
b){var d=this.sprites.length-a;if(d<0)for(;d++;)this.sprites.push(ig.spritePool.get(b||false));else if(d>0)for(;d--;)this.sprites.pop().kill()},updateSprites:function(){},addEntityAttached:function(a){a&&a.onEntityKillDetach&&this.entityAttached.push(a)},removeEntityAttached:function(a){this.entityAttached.erase(a)},clearEntityAttached:function(a){for(var b=this.entityAttached.length;b--;)if(!a||a(this.entityAttached[b])){var d=this.entityAttached[b];this.entityAttached.splice(b,1);if(d)d.onEntityKillDetach()}},
show:function(){ig.game.showEntity(this)},hide:function(){ig.game.hideEntity(this)},onHideRequest:null,kill:function(a){if(!this._killed){ig.ENTITY_KILL_CALL++;this.onKill(a);if(!this._killed)throw Error("Killed Entity actually not killed",this);this.clearEntityAttached();for(var b=0;b<this.sprites.length;++b)this.sprites[b].kill();this.sprites=[];ig.game.removeEntity(this);for(var d=this.coll.subColls,b=d.length;b--;)d[b].entity.kill(a)}},onKill:function(){if(!ig.ENTITY_KILL_CALL)throw Error("Called Entity .onKill() outside of ig.game.kill()");
ig.ENTITY_KILL_CALL--;this._killed=true;this.coll._killed=true},erase:function(){},getOverlappingEntities:function(a){return ig.game.getEntitiesInRectangle(this.coll.pos.x,this.coll.pos.y,this.coll.pos.z,this.coll.size.x,this.coll.size.y,this.coll.size.z,this,null,a)},setSlipThrough:function(a){this.coll.ignoreCollision=a},distanceTo:function(a){return ig.CollTools.getGroundDistance(this.coll,a.coll)},onVarAccess:function(a,b){if(b[1]=="name")return this.name;if(b[1]=="id")return this.id;if(b[1]==
"accel")return ig.vars.resolveObjectAccess(this.coll.accelDir,b,2);if(b[1]=="pos")return ig.vars.resolveObjectAccess(this.coll.pos,b,2);if(b[1]=="onGround")return this.coll.pos.z==this.coll.baseZPos;if(b[1]=="vel")return ig.vars.resolveObjectAccess(this.coll.vel,b,2);if(b[1]=="collWall"){var d=this.coll._collData&&this.coll._collData.blockDir;if(d)return ig.vars.resolveObjectAccess(d,b,2)}return null},check:function(){},collideWith:function(){},animationEnded:function(){},onFallFromEdge:null,onTouchGround:null});
ig.WIPE_DIRECTION={NORTH:1,SOUTH:3};ig.EntityTools={getSpriteBounds:function(b,d){d&&d.updateSprites();b.left=b.right=b.top=b.bottom=-1E4;a(b,d,d)},hasGroundEntity:function(a){a=a.coll;return a._collData&&a._collData.groundEntry},getGroundEntity:function(a){a=a.coll;if(!a._collData)return null;return(a=a._collData.groundEntry)&&a.entity},getCeilingEntity:function(a){a=a.coll;if(!a._collData)return null;return(a=a._collData.ceilingEntry)&&a.entity},isInScreen:function(a,b,d){return ig.CollTools.isInScreen(a.coll,
b,d)},addEntityColorOverlay:function(a,d,f){if(b(a,d)){a=a.coll;if(a.parentColl&&a.parentGroup&&!f)for(var f=a.parentColl.subColls,g=f.length;g--;){var h=f[g];h!=a&&h.parentGroup==a.parentGroup&&b(h.entity,d)}}},clearEntitySpriteCut:function(a,b){for(var d=a.sprites,g=d.length;g--;){var h=d[g],i=0,j=0;if(b){if(b!=ig.WIPE_DIRECTION.NORTH)i=h.gfxCut.top;if(b!=ig.WIPE_DIRECTION.SOUTH)j=h.gfxCut.bottom}h.setGfxCut(i,j)}d=a.coll.subColls;if(d.length>0)for(g=d.length;g--;)this.clearEntitySpriteCut(d[g].entity,
b)},clearEntitySpriteOffset:function(a){for(var b=a.sprites,d=b.length;d--;)Vec3.assignC(b[d].tmpOffset,0,0,0);a=a.coll.subColls;if(a.length>0)for(d=a.length;d--;)this.clearEntitySpriteOffset(a[d].entity)}};ig.Entity._lastId=0;ig.COLLTYPE={NONE:0,IGNORE:1,PROJECTILE:2,VIRTUAL:3,PBLOCK:4,NPBLOCK:5,BLOCK:6,TRIGGER:7,PASSIVE:8,SEMI_IGNORE:9,FENCE:10,NPFENCE:11};ig.Entity.COLLISION_MAP={};ig.Entity.COLLISION_MAP[ig.COLLTYPE.NONE]={};ig.Entity.COLLISION_MAP[ig.COLLTYPE.IGNORE]={};ig.Entity.COLLISION_MAP[ig.COLLTYPE.IGNORE][ig.COLLTYPE.BLOCK]=
true;ig.Entity.COLLISION_MAP[ig.COLLTYPE.IGNORE][ig.COLLTYPE.FENCE]=true;ig.Entity.COLLISION_MAP[ig.COLLTYPE.IGNORE][ig.COLLTYPE.NPBLOCK]=true;ig.Entity.COLLISION_MAP[ig.COLLTYPE.IGNORE][ig.COLLTYPE.NPFENCE]=true;ig.Entity.COLLISION_MAP[ig.COLLTYPE.PROJECTILE]={};ig.Entity.COLLISION_MAP[ig.COLLTYPE.PROJECTILE][ig.COLLTYPE.BLOCK]=true;ig.Entity.COLLISION_MAP[ig.COLLTYPE.PROJECTILE][ig.COLLTYPE.FENCE]=true;ig.Entity.COLLISION_MAP[ig.COLLTYPE.PROJECTILE][ig.COLLTYPE.PBLOCK]=true;ig.Entity.COLLISION_MAP[ig.COLLTYPE.VIRTUAL]=
{};ig.Entity.COLLISION_MAP[ig.COLLTYPE.VIRTUAL][ig.COLLTYPE.VIRTUAL]=true;ig.Entity.COLLISION_MAP[ig.COLLTYPE.VIRTUAL][ig.COLLTYPE.BLOCK]=true;ig.Entity.COLLISION_MAP[ig.COLLTYPE.VIRTUAL][ig.COLLTYPE.FENCE]=true;ig.Entity.COLLISION_MAP[ig.COLLTYPE.VIRTUAL][ig.COLLTYPE.NPBLOCK]=true;ig.Entity.COLLISION_MAP[ig.COLLTYPE.VIRTUAL][ig.COLLTYPE.NPFENCE]=true;ig.Entity.COLLISION_MAP[ig.COLLTYPE.PBLOCK]={};ig.Entity.COLLISION_MAP[ig.COLLTYPE.PBLOCK][ig.COLLTYPE.PROJECTILE]=true;ig.Entity.COLLISION_MAP[ig.COLLTYPE.PBLOCK][ig.COLLTYPE.PBLOCK]=
true;ig.Entity.COLLISION_MAP[ig.COLLTYPE.PBLOCK][ig.COLLTYPE.BLOCK]=true;ig.Entity.COLLISION_MAP[ig.COLLTYPE.PBLOCK][ig.COLLTYPE.FENCE]=true;ig.Entity.COLLISION_MAP[ig.COLLTYPE.NPBLOCK]={};ig.Entity.COLLISION_MAP[ig.COLLTYPE.NPBLOCK][ig.COLLTYPE.IGNORE]=true;ig.Entity.COLLISION_MAP[ig.COLLTYPE.NPBLOCK][ig.COLLTYPE.VIRTUAL]=true;ig.Entity.COLLISION_MAP[ig.COLLTYPE.NPBLOCK][ig.COLLTYPE.BLOCK]=true;ig.Entity.COLLISION_MAP[ig.COLLTYPE.NPBLOCK][ig.COLLTYPE.FENCE]=true;ig.Entity.COLLISION_MAP[ig.COLLTYPE.NPBLOCK][ig.COLLTYPE.NPFENCE]=
true;ig.Entity.COLLISION_MAP[ig.COLLTYPE.BLOCK]={};ig.Entity.COLLISION_MAP[ig.COLLTYPE.BLOCK][ig.COLLTYPE.IGNORE]=true;ig.Entity.COLLISION_MAP[ig.COLLTYPE.BLOCK][ig.COLLTYPE.PROJECTILE]=true;ig.Entity.COLLISION_MAP[ig.COLLTYPE.BLOCK][ig.COLLTYPE.VIRTUAL]=true;ig.Entity.COLLISION_MAP[ig.COLLTYPE.BLOCK][ig.COLLTYPE.PBLOCK]=true;ig.Entity.COLLISION_MAP[ig.COLLTYPE.BLOCK][ig.COLLTYPE.BLOCK]=true;ig.Entity.COLLISION_MAP[ig.COLLTYPE.BLOCK][ig.COLLTYPE.NPBLOCK]=true;ig.Entity.COLLISION_MAP[ig.COLLTYPE.BLOCK][ig.COLLTYPE.SEMI_IGNORE]=
true;ig.Entity.COLLISION_MAP[ig.COLLTYPE.BLOCK][ig.COLLTYPE.FENCE]=true;ig.Entity.COLLISION_MAP[ig.COLLTYPE.BLOCK][ig.COLLTYPE.NPFENCE]=true;ig.Entity.COLLISION_MAP[ig.COLLTYPE.FENCE]={};ig.Entity.COLLISION_MAP[ig.COLLTYPE.FENCE][ig.COLLTYPE.FENCE]=true;ig.Entity.COLLISION_MAP[ig.COLLTYPE.FENCE][ig.COLLTYPE.IGNORE]=true;ig.Entity.COLLISION_MAP[ig.COLLTYPE.FENCE][ig.COLLTYPE.PROJECTILE]=true;ig.Entity.COLLISION_MAP[ig.COLLTYPE.FENCE][ig.COLLTYPE.VIRTUAL]=true;ig.Entity.COLLISION_MAP[ig.COLLTYPE.FENCE][ig.COLLTYPE.PBLOCK]=
true;ig.Entity.COLLISION_MAP[ig.COLLTYPE.FENCE][ig.COLLTYPE.BLOCK]=true;ig.Entity.COLLISION_MAP[ig.COLLTYPE.FENCE][ig.COLLTYPE.NPBLOCK]=true;ig.Entity.COLLISION_MAP[ig.COLLTYPE.FENCE][ig.COLLTYPE.SEMI_IGNORE]=true;ig.Entity.COLLISION_MAP[ig.COLLTYPE.FENCE][ig.COLLTYPE.BLOCK]=true;ig.Entity.COLLISION_MAP[ig.COLLTYPE.FENCE][ig.COLLTYPE.NPFENCE]=true;ig.Entity.COLLISION_MAP[ig.COLLTYPE.NPFENCE]={};ig.Entity.COLLISION_MAP[ig.COLLTYPE.NPFENCE][ig.COLLTYPE.FENCE]=true;ig.Entity.COLLISION_MAP[ig.COLLTYPE.NPFENCE][ig.COLLTYPE.IGNORE]=
true;ig.Entity.COLLISION_MAP[ig.COLLTYPE.NPFENCE][ig.COLLTYPE.VIRTUAL]=true;ig.Entity.COLLISION_MAP[ig.COLLTYPE.NPFENCE][ig.COLLTYPE.PBLOCK]=true;ig.Entity.COLLISION_MAP[ig.COLLTYPE.NPFENCE][ig.COLLTYPE.BLOCK]=true;ig.Entity.COLLISION_MAP[ig.COLLTYPE.NPFENCE][ig.COLLTYPE.NPBLOCK]=true;ig.Entity.COLLISION_MAP[ig.COLLTYPE.NPFENCE][ig.COLLTYPE.SEMI_IGNORE]=true;ig.Entity.COLLISION_MAP[ig.COLLTYPE.NPFENCE][ig.COLLTYPE.BLOCK]=true;ig.Entity.COLLISION_MAP[ig.COLLTYPE.NPFENCE][ig.COLLTYPE.NPFENCE]=true;
ig.Entity.COLLISION_MAP[ig.COLLTYPE.SEMI_IGNORE]={};ig.Entity.COLLISION_MAP[ig.COLLTYPE.SEMI_IGNORE][ig.COLLTYPE.BLOCK]=true;ig.Entity.COLLISION_MAP[ig.COLLTYPE.SEMI_IGNORE][ig.COLLTYPE.FENCE]=true;ig.Entity.COLLISION_MAP[ig.COLLTYPE.SEMI_IGNORE][ig.COLLTYPE.NPBLOCK]=true;ig.Entity.COLLISION_MAP[ig.COLLTYPE.SEMI_IGNORE][ig.COLLTYPE.NPFENCE]=true;ig.Entity.COLLISION_MAP[ig.COLLTYPE.TRIGGER]={};ig.Entity.COLLISION_MAP[ig.COLLTYPE.PASSIVE]={};ig.Entity.COLLISION_MAP[ig.COLLTYPE.PASSIVE][ig.COLLTYPE.BLOCK]=
true;ig.COLLSHAPE={RECTANGLE:1,SLOPE_NE:2,SLOPE_SE:3,SLOPE_SW:4,SLOPE_NW:5};ig.AnimatedEntity=ig.Entity.extend({animSheet:null,animState:null,animSpeedFactor:1,currentAnim:null,followUpAnim:null,callbackOnFinish:false,_createdAnimSheet:false,init:function(a,b,d,g){this.parent(a,b,d,g);this.animState=new ig.AnimationState},reset:function(a,b,d,g){this.parent(a,b,d,g);this.animState.reset();this.animSpeedFactor=1;this.followUpAnim=this.currentAnim=null;this._createdAnimSheet=this.callbackOnFinish=false},
onKill:function(a){this.parent(a);this._createdAnimSheet&&this.animSheet.clearCached()},initSprites:function(){this.setSpriteCount(0)},initAnimations:function(a){if(a)if(a instanceof ig.AnimationSheet)this.animSheet=a;else{this._createdAnimSheet=true;this.animSheet=new ig.AnimationSheet(a)}if(!this.animState.hasAnimations()){for(var b in this.animSheet.anims)break;if(b){this.setCurrentAnim(b);this.animState.setAnimation(this,this.animSheet.anims[b].getAnimations(this))}}},getCurrentAnimFaceCount:function(){return!this.animSheet.anims[this.currentAnim]?
1:this.animSheet.anims[this.currentAnim].numDirs||1},rewindAnim:function(){this.animState.rewind();for(var a=this.coll.subColls,b=a.length;b--;){var d=a[b].entity;d.persistAnim||d.rewindAnim()}},setCurrentAnim:function(a,b,d,g,h){d=d||null;if(g||(d||a)!=(this.followUpAnim||this.currentAnim)){this.callbackOnFinish=h;this.currentAnim=a;b&&this.rewindAnim();this.followUpAnim=d;this.updateAnim()}},updateAnim:function(){if(this.animSheet){if(this.animState.loopCount>0&&this.callbackOnFinish){this.callbackOnFinish=
false;this.animationEnded(this.currentAnim)}if(this.followUpAnim&&this.animState.loopCount>0){this.rewindAnim();this.currentAnim=this.followUpAnim;this.followUpAnim=null}var a=this.currentAnim;typeof a=="string"&&(a=this.animSheet.anims[this.currentAnim]);if(a){a=a.getAnimations(this);this.animState.setAnimation(this,a)}}},update:function(){this.updateAnim();this.parent()},updateSprites:function(){this.animSheet&&this.animState.updateSprite(this,this.animSpeedFactor)}});ig.AnimationPartEntity=ig.AnimatedEntity.extend({partName:null,
owner:null,persistAnim:null,init:function(a,b,d,g){this.parent(a,b,d,g);this.coll.type=g.collType;this.coll.weight=-1;this.coll.heightShape=g.heightShape;this.coll.parentGroup=g.group;this.coll.alwaysRender=true;this.owner=g.owner;this.partName=g.partName;this.animSheet=g.animSheet;this.persistAnim=g.persistAnim;this.defaultCollType=g.collType;(a=g.padding)&&this.coll.setPadding(a.x,a.y)}})});ig.baked=!0;
ig.module("impact.base.steps").defines(function(){function b(a,d,c,e){for(var f=null,g=[],h=0;h<a.length;h++){var i=a[h].type,j=d[i];if(j){j=new j(a[h]);if(i=="LABEL"){if(c[j.name]&&!window.wm)throw Error("Step Collection includes label '"+j.name+"' twice");c[j.name]=j}for(i=0;i<g.length;++i)g[i]._nextStep=j;var g=[],k=j.getBranchNames&&j.getBranchNames();if(k){if(!j.branches)j.branches={};for(i=0;i<k.length;++i){var l=k[i],o=a[h][l];o||(o=[]);o=b(o,d,c,g);j.branches[l]=o}}g.push(j);f||(f=j)}}for(i=
0;i<g.length;++i)e.push(g[i]);return f}ig.StepHelpers={constructSteps:function(a,d,c){return b(a,d,c,[])},clearStepsCache:function(a){if(a&&!a._cacheIsCleared){a.clearCached&&a.clearCached();a._cacheIsCleared=true;a._nextStep&&this.clearStepsCache(a._nextStep);if(a.branches)for(var b in a.branches)a.branches[b]&&this.clearStepsCache(a.branches[b])}}};ig.StepBase=ig.Class.extend({_nextStep:null,_cacheIsCleared:false,branches:void 0,init:function(){},start:function(){},run:function(){return true},getNext:function(){return this._nextStep},
getJumpLabelName:null})});ig.baked=!0;
ig.module("impact.base.event").requires("impact.base.steps").defines(function(){ig.EventRunType={INTERRUPTABLE:0,PARALLEL:1,BLOCKING:2};ig.EventManager=ig.Class.extend({runningEventCalls:[],blockingEventCall:null,blockedEventCallQueue:[],init:function(){},callEvent:function(b,a,d,c,e,f,g){b=new ig.EventCall(b,e,a,d,c,f,g);if(!this.blockingEventCall||a!=ig.EventRunType.BLOCKING)this._startEventCall(b);else{b.blocked=true;this.blockedEventCallQueue.push(b)}return b},getBlockingEventCall:function(){return this.blockingEventCall},
hasBlockingEventCallHint:function(b){return this.blockingEventCall&&this.blockingEventCall.hasHint(b)},isInterruptible:function(){for(var b=this.runningEventCalls.length;b--;)if(this.runningEventCalls[b].runType!=ig.EventRunType.INTERRUPTABLE)return false;return true},update:function(){for(var b=0;b<this.runningEventCalls.length;){var a=this.runningEventCalls[b];if(ig.game.paused&&!a.pauseParallel)++b;else if(a.update()){this.runningEventCalls.splice(b,1);this._endEventCall(a)}else++b}},clearQueue:function(){this.blockedEventCallQueue.length=
0},clear:function(){for(var b=this.runningEventCalls.length;b--;)this.runningEventCalls.splice(b,1);this.blockingEventCall=null;this.blockedEventCallQueue=[]},_startEventCall:function(b){b.blocked=false;this.runningEventCalls.push(b);if(b.runType==ig.EventRunType.BLOCKING)this.blockingEventCall=b;if(b.onStart)b.onStart(b)},_endEventCall:function(b){b.setDone();if(b.runType==ig.EventRunType.BLOCKING)this.blockedEventCallQueue.length?this._startEventCall(this.blockedEventCallQueue.shift()):this.blockingEventCall=
null}});ig.EventCall=ig.Class.extend({runType:0,done:false,blocked:false,stack:[],eventAttached:[],pauseParallel:false,onStart:null,onEnd:null,callEntity:null,data:null,init:function(b,a,d,c,e,f,g){this.runType=d||0;this.onStart=c||null;this.onEnd=e||null;this.callEntity=f;this.data=g||null;b&&this.callInlineEvent(b,a)},hasHint:function(b){return this.stack[0]&&this.stack[0].event.hasHint(b)},callInlineEvent:function(b,a){var d=b.setupInput(a);this.stack.push({event:b,currentStep:null,stepData:{},
vars:d});return this.stack[this.stack.length-1]},addEventAttached:function(b){this.eventAttached.push(b)},setDone:function(){this.done=true;for(var b=0;b<this.eventAttached.length;++b)this.eventAttached[b].onEventEndDetach(this);this.eventAttached=[];if(this.onEnd)this.onEnd(this)},isBlocked:function(){return this.blocked},isRunning:function(){return!this.done},performStep:function(b){do{if(!b.currentStep)b.currentStep=b.event.rootStep;var a=b.currentStep;if(!a)break;a.start&&a.start(b.stepData,this);
if(a.getInlineEvent){b=a.getInlineEvent();a=this.callInlineEvent(b,a.getInlineEventInput());ig.vars.setupCallScope(a.vars);b=a}}while(!b.currentStep);return b},update:function(){var b=this.stack[this.stack.length-1];ig.vars.setupCallScope(b.vars);for(b.currentStep||(b=this.performStep(b));b.currentStep&&b.currentStep.run(b.stepData);){var a=null;if(b.currentStep.getJumpLabelName){var d=b.currentStep.getJumpLabelName(b.stepData);if(d){a=b.event.labeledSteps[d];if(!a)throw Error("Label '"+d+"' not found.");
}}a||(a=b.currentStep.getNext(b.stepData));b.currentStep=a;if(b.currentStep)b=this.performStep(b);else{this.stack.pop();if(d=this.stack[this.stack.length-1]){b=d;ig.vars.setupCallScope(b.vars);b.currentStep=b.currentStep.getNext(b.stepData);b.currentStep&&(b=this.performStep(b))}}}ig.vars.setupCallScope(null);return!b||!b.currentStep}});ig.EventStepBase=ig.StepBase;ig.EVENT_STEP={};ig.Event=ig.Class.extend({name:null,rootStep:null,labeledSteps:{},hints:[],init:function(b){this.name=b.name||"[UNNAMED]";
this.inputSignature=b.input||{};this.rootStep=ig.StepHelpers.constructSteps(b.steps,ig.EVENT_STEP,this.labeledSteps)},addHint:function(b){this.hints.push(b)},hasHint:function(b){return this.hints.indexOf(b)!==-1},clearCached:function(){ig.StepHelpers.clearStepsCache(this.rootStep)},setupInput:function(b){var a={},d;for(d in this.inputSignature)switch(this.inputSignature[d]._type){case "StringExpression":case "String":case "BooleanExpression":case "Boolean":case "NumberExpression":case "Number":a[d]=
ig.Event.getExpressionValue(b[d]);break;case "Vec2":a[d]=ig.Event.getVec2(b[d],Vec2.create());break;case "Vec3":a[d]=ig.Event.getVec3(b[d],Vec3.create());break;case "VarName":a[d]=ig.Event.getVarName(b[d]);break;case "Entity":a[d]=b[d];break;case "LangLabel":a[d]=ig.LangLabel.getText(b[d]);break;default:throw Error("Event: could not initialize input of type '"+this.inputSignature[d]._type+"'");}return a}});ig.Event.getNumberVary=function(b){return b&&b.base?b.base+(Math.random()-0.5)*2*(b.vary||0):
b};ig.Event.getEntity=function(b,a){if(!b)return null;if(b instanceof ig.Entity)return b;if(b.player)return ig.game.playerEntity;if(b.self)return a&&a.callEntity||null;if(b.name)return ig.game.getEntityByName(b.name);for(var d=ig.ENTITY_FETCH_KEYS.length;d--;){var c=ig.ENTITY_FETCH_KEYS[d];if(b[c])return ig.ENTITY_FETCH_MAP[c].fetch(b[c])}return null};ig.ENTITY_FETCH_MAP={};ig.ENTITY_FETCH_KEYS=[];ig.Event.registerEntityFetchType=function(b,a,d){ig.ENTITY_FETCH_MAP[b]={fetch:a,editor:d};ig.ENTITY_FETCH_KEYS.push(b)};
ig.Event.registerEntityFetchType("varName",function(b){b=ig.Event.getVarName(b);b=ig.vars.get(b);return ig.game.namedEntities[b]},{_type:"VarName",_info:"Variable from which to fetch entity name"});ig.Event.getVec2=function(b,a){var d=ig.Event.getExpressionValue(b);return Vec2.assign(a,d)};ig.Event.getVec3=function(b,a){var d=ig.Event.getExpressionValue(b),c=d.x,e=d.y,d=d.lvl?ig.game.getHeightFromLevelOffset(d.lvl):d.z||0;return Vec3.assignC(a,c,e,d)};ig.Event.getVarName=function(b){b&&b.indirect&&
(b=ig.vars.get(b.indirect));return typeof b=="string"?b:null};ig.Event.getExpressionValue=function(b){if(b&&b.indirect){b=ig.vars.get(b.indirect);return ig.vars.get(b)}return b&&b.varName?ig.vars.get(b.varName):b}});ig.baked=!0;
ig.module("impact.base.sprite").requires("impact.base.image").defines(function(){ig.CubeSprite=ig.Class.extend({pos:{x:0,y:0,z:0},size:{x:0,y:0,z:0},shadow:{x:0,y:0,z:0,diameter:0,scaleY:1},gfxOffset:{x:0,y:0},gfxCut:{top:0,bottom:0,left:0,right:0},tmpOffset:{x:0,y:0,z:0},wallY:0,image:null,src:{x:0,y:0},alpha:1,flip:{x:false,y:false},scale:{x:1,y:1},rotate:0,pivot:{x:0,y:0},overlay:{color:null,alpha:0},lighterOverlay:{color:null,alpha:0},aboveZ:0,mergeTop:false,renderData:{},gui:false,renderMode:null,
alwaysRender:false,noOverlapSolving:false,init:function(b){this.gui=b},clear:function(b){this.gui=b;this.image=null;this.shadow.x=this.shadow.y=this.shadow.z=this.shadow.diameter=0;this.shadow.type=ig.COLL_SHADOW_TYPE.DEFAULT;this.gfxOffset.x=this.gfxOffset.y=0;this.wallY=this.tmpOffset.x=this.tmpOffset.y=this.tmpOffset.z=0;this.src.x=this.src.y=0;this.alpha=1;this.flip.x=this.flip.y=false;this.scale.x=this.scale.y=1;this.rotate=0;this.pivot.x=this.pivot.y=0;this.overlay.color=null;this.overlay.alpha=
0;this.lighterOverlay.color=null;this.lighterOverlay.alpha=0;this.renderMode=null;this.mergeTop=false;this.gfxCut.top=this.gfxCut.bottom=0;this.gfxCut.left=this.gfxCut.right=0;this.noOverlapSolving=this.alwaysRender=false},kill:function(){this.renderData={};ig.spritePool.sprites.push(this)},setPos:function(b,a,d){this.pos.x=b;this.pos.y=a;this.pos.z=d},setGfxOffset:function(b,a){this.gfxOffset.x=b;this.gfxOffset.y=a},setGfxCut:function(b,a,d,c){this.gfxCut.top=b||0;this.gfxCut.bottom=a||0;this.gfxCut.left=
d||0;this.gfxCut.right=c||0},setShadow:function(b,a,d,c,e,f){this.shadow.x=b;this.shadow.y=a;this.shadow.z=d;this.shadow.scaleY=f||1;this.shadow.diameter=c;this.shadow.type=e||ig.COLL_SHADOW_TYPE.DEFAULT},setSize:function(b,a,d,c){this.size.x=b;this.size.y=a;this.size.z=d;this.wallY=c||0},setImageSrc:function(b,a,d){this.image=b;this.src.x=a||0;this.src.y=d||0},setFlip:function(b,a){this.flip.x=b||false;this.flip.y=a||false},setPivot:function(b,a){this.pivot.x=b;this.pivot.y=a},setTransform:function(b,
a,d){this.scale.x=b;this.scale.y=a;this.rotate=d},setAlpha:function(b){this.alpha=b},setOverlayColor:function(b,a){this.overlay.color=b;this.overlay.alpha=a},setLighterOverlayColor:function(b,a){this.lighterOverlay.color=b;this.lighterOverlay.alpha=a},setInvisible:function(){this.image=null;this.setShadow(0,0,0,0)},setSizeFromEntity:function(b,a,d,c,e){var f=b.coll,b=f.size.y,f=f.size.z;this.mergeTop=false;if(c==ig.ANIM_SHAPE_TYPE.Y_FLAT){d<f&&(f=d);b=d-f;this.mergeTop=true}else if(c==ig.ANIM_SHAPE_TYPE.Z_FLAT){b=
d;f=0}else{d=d-b-f;if(d>0)switch(c){case ig.ANIM_SHAPE_TYPE.Z_EXPAND:f=f+d;break;case ig.ANIM_SHAPE_TYPE.Y_EXPAND:b=b+d;break;case ig.ANIM_SHAPE_TYPE.YZ_EXPAND:b=b+Math.floor(d/2);f=f+Math.ceil(d/2)}else if(d<0)if(b+d>=0)b=b+d;else{f=f+(d+b);b=0}}this.setSize(a,b,f,Math.round((e||0)*b))},setImageSrcFromEntity:function(b,a,d,c,e,f){this.size.y+this.size.z<d&&(f=f+(d-this.size.y-this.size.z));this.setImageSrc(c,e,f)},setShadowFromEntity:function(b){b=b.coll;this.setShadow(b.pos.x+b.size.x/2,b.pos.y+
b.size.y/2,b.baseZPos,b.shadow.size,b.shadow.type,b.shadow.scaleY)},setPosFromEntity:function(b,a,d,c){var b=b.coll,d=b.pos.x-(this.size.x-b.size.x)/2,e=b.pos.y,f=b.pos.z;this.size.y<b.size.y?e=e+(b.size.y-this.size.y):this.size.y>b.size.y&&(e=e-Math.round((1-(c||0))*(this.size.y-b.size.y)));if(a){d=d+a.x;e=e+a.y;f=f+a.z}this.setPos(d,e,f)},centerPivot:function(b){var a=this.pos.y-this.size.z+this.pivot.y-b.coll.pos.y;this.gfxOffset.x=this.gfxOffset.x-(this.pos.x+this.pivot.x-b.coll.pos.x);this.gfxOffset.y=
this.gfxOffset.y-a},setEntityDefault:function(b,a,d,c,e,f,g,h,i){c=c||ig.ANIM_SHAPE_TYPE.NO_EXPAND;this.setSizeFromEntity(b,a,d,c,e);this.setImageSrcFromEntity(b,a,d,g,h,i);this.setShadowFromEntity(b);this.setPosFromEntity(b,f,c,e)},assign:function(b){Vec3.assign(this.pos,b.pos);Vec3.assign(this.size,b.size);this.image=b.image;Vec3.assign(this.shadow,b.shadow);this.shadow.diameter=b.shadow.diameter;this.shadow.yScale=b.shadow.yScale;Vec2.assign(this.gfxOffset,b.gfxOffset);Vec3.assign(this.tmpOffset,
b.tmpOffset);this.wallY=b.wallY;Vec2.assign(this.src,b.src);this.alpha=b.alpha;Vec2.assign(this.flip,b.flip);Vec2.assign(this.scale,b.scale);this.rotate=b.rotate;Vec2.assign(this.pivot,b.pivot);this.overlay.color=b.overlay.color;this.overlay.alpha=b.overlay.alpha;this.lighterOverlay.color=b.lighterOverlay.color;this.lighterOverlay.alpha=b.lighterOverlay.alpha;this.renderMode=b.renderMode;this.gfxCut.top=b.gfxCut.top;this.gfxCut.bottom=b.gfxCut.bottom;this.gfxCut.left=b.gfxCut.left;this.gfxCut.right=
b.gfxCut.right;this.mergeTop=b.mergeTop}});ig.SpritePool=ig.Class.extend({sprites:[],get:function(b){if(this.sprites.length){var a=this.sprites.pop();a.clear(b);return a}return new ig.CubeSprite(b)}});ig.spritePool=new ig.SpritePool});ig.baked=!0;
ig.module("impact.base.renderer").requires("impact.base.image","impact.base.sprite").defines(function(){function b(a,b){for(var c=0;c<a.levels[b].maps.length;c++){var d=a.levels[b].maps[c];if(d.enabled){d.drawAnimated&&d.drawAnimated();d.draw()}}}function a(a,b,c){if(ig.perf.spriteShadow&&a.drawShadow){var d=ig.game,a=a.cubeSprite;if(d.shadowImage&&a.shadow.diameter&&a.shadow.z>=b&&a.shadow.z<c){if(ig.system.context.globalCompositeOperation!="source-over")ig.system.context.globalCompositeOperation=
"source-over";b=a.pos.z+a.tmpOffset.z-a.shadow.z;a.shadow.type==ig.COLL_SHADOW_TYPE.STATIC_SIZE&&(b=0);var e=a.shadow.diameter-b/8,c=Math.round(a.shadow.x)-ig.game.screen.x,f=Math.round(a.shadow.y-a.shadow.z)-ig.game.screen.y;if(e>0&&c-e/2<=ig.system.width||f-e/2<=ig.system.height||c+e/2>=0||f+e/2>=0){b=ig.system.context.globalAlpha;ig.system.context.globalAlpha=ig.system.context.globalAlpha*0.5*a.alpha;if(e<=32){a=(8-Math.floor(e/4)).limit(0,7);d.shadowImage.drawTile(c-16,f-16,a,32,32,0,0)}else{ig.system.context.save();
ig.system.context.translate(ig.system.getDrawPos(c),ig.system.getDrawPos(f));c=Math.floor(e/4)*4/224;ig.system.context.scale(c,c*(a.shadow.scaleY||1));d.shadowImage.draw(-112,-112,0,32,224,224);ig.system.context.restore()}ig.system.context.globalAlpha=b}}}}function d(a,b,c,d,e){b?a.renderData[c]?a.renderData[c].spriteIdx=e:a.renderData[c]=new ig.Renderer2d.SpriteDrawSlot(a,d,e):a.renderData[c]&&(a.renderData[c]=null)}var c={};ig.Renderer2d=ig.Class.extend({spriteSlots:[],guiSpriteSlots:[],init:function(){},
prepareDraw:function(a,b){ig.ImageModFragment.clear();var c=ig.system.getZoomMinOffset(e);f=c.x+ig.game.screen.x;g=c.y+ig.game.screen.y;h=f+ig.system.width/ig.system.zoom;i=g+ig.system.height/ig.system.zoom;if(b||!ig.game.mapRenderingBlocked){c=0;this.spriteSlots.length=0;for(var o=this.guiSpriteSlots.length=0;o<a.length;o++){var m=a[o];if(m&&(m.coll.alwaysRender||!(m.coll.pos.x+m.coll.size.x+48<f||m.coll.pos.x-48>h||m.coll.pos.y-m.coll.baseZPos+m.coll.size.y+32<g||m.coll.pos.y-m.coll.pos.z-m.coll.size.z-
32>i))){m.updateSprites();for(var n=0;n<m.sprites.length;n++){c++;var p=m.sprites[n],r=c,t=p.gui?this.guiSpriteSlots:this.spriteSlots;d(p,p.mergeTop||p.size.z>0||p.wallY>0,"wall",false,r);d(p,!p.mergeTop&&p.size.y>0&&p.wallY<p.size.y,"ground",true,r);var r=p.renderData.wall,q=p.renderData.ground,s=r&&!q;r&&r.update(s);q&&q.update(!s);if(!ig.perf.spriteFilter||(!p.image&&!p.shadow.diameter?0:p.alwaysRender||(p.scale.x>1||p.scale.y>1||p.rotate)||!(p.pos.x+p.tmpOffset.x+p.gfxOffset.x+p.size.x<f||p.pos.x+
p.tmpOffset.x+p.gfxOffset.x>h||p.pos.y+p.tmpOffset.y+p.gfxOffset.y-(p.pos.z+p.tmpOffset.z)-p.size.z>i||p.pos.y+p.tmpOffset.y+p.gfxOffset.y+p.size.y-(p.shadow.diameter?p.shadow.z:p.pos.z+p.tmpOffset.z)<g))){r&&t.push(r);q&&t.push(q);p.renderData.fragment=p.overlay.color?new ig.ImageModFragment(p.image,p.src.x,p.src.y,p.size.x,p.size.y+p.size.z,p.overlay.color):null;p.renderData.lighterFragment=p.lighterOverlay.color?new ig.ImageModFragment(p.image,p.src.x,p.src.y,p.size.x,p.size.y+p.size.z,p.lighterOverlay.color):
null}}}}}ig.ImageModFragment.prepare();if(b||!ig.game.mapRenderingBlocked){this.spriteSlots.sort(function(a,b){return a.yIndex-b.yIndex||a.spriteIdx-b.spriteIdx});this.guiSpriteSlots.sort(function(a,b){return a.yIndex-b.yIndex})}ig.imageAtlas.fillFragments()},drawLayers:function(a,c){var d=ig.game;if(!c){ig.system.context.fillStyle="black";d.clearColor&&ig.system.clear(d.clearColor)}if((a||!ig.game.mapRenderingBlocked)&&!ig.loading&&d.maxLevel>0){b(d,"first");for(var e=-1;e<d.maxLevel;++e){e>=0&&
b(d,e);this.drawEntities(e)}b(d,"last")}},drawLight:function(){var a=ig.game;!ig.loading&&a.maxLevel>0&&b(a,"light")},drawPostLayerSprites:function(){var a=ig.game;if(!(ig.loading||a.maxLevel<=0)){b(a,"postlight");for(var c=0;c<this.guiSpriteSlots.length;++c)this.guiSpriteSlots[c].draw();if(this.guiSpriteSlots.length>0)ig.system.context.globalCompositeOperation="source-over";if(window.IG_GAME_DEBUG)for(var d in a.levels)for(var e in a.levels[d]){c=a.levels[d][e];c instanceof ig.Map&&(c.debugDraw&&
c.draw)&&c.draw(a.levels[d].height)}}},drawEntities:function(b){if(ig.perf.drawSprites){for(var c=ig.game,d=b==-1?-9999999:c.levels[b].height,b=b+1<c.maxLevel?c.levels[b+1].height:99999999,c=0;c<this.spriteSlots.length;++c){var e=this.spriteSlots[c];if(e.ground&&e.zMin==d){a(e,d,b);e.draw(d,b);e._isDrawn=true}else e._isDrawn=false}for(var f=[],c=0;c<this.spriteSlots.length+1;++c)if(c==this.spriteSlots.length)for(;f.length>0;){var g=f.length-1,h=f[g];h.spriteSlot.draw(d,b);f.splice(g,1);if(h.idx!=
-1){c=h.idx-1;break}}else{var e=this.spriteSlots[c],i=e.cubeSprite;if(!e._isDrawn){var t=e.zMin>=b||e.zMax<=d;if(!t||i.shadow.diameter&&!(i.shadow.z>=b||i.shadow.z<d)){for(var q=false,g=f.length;g--;){var h=f[g],s=i.pos.x+i.tmpOffset.x+i.size.x<=h.xMin||i.pos.x+i.tmpOffset.x>=h.xMax;if(e.yIndex>h.yMax){h.spriteSlot.draw(d,b);f.splice(g,1);if(h.idx!=-1){c=h.idx-1;q=true;break}}else if(!s&&i.pos.z+i.tmpOffset.z+i.size.z*i.aboveZ>=h.zMax){q=true;h.idx=h.idx==-1?c:Math.min(c,h.idx)}else if(!s&&e.ground)h.yMax=
Math.max(h.yMax,i.pos.y+i.tmpOffset.y+i.size.y-ig.COLLISION.EPS)}if(!q){e._isDrawn=true;if(e.ground){a(e,d,b);t||(!ig.perf.spriteOverlapSolver||i.noOverlapSolving||i.size.y<i.size.z?e.draw(d,b):f.push({xMin:i.pos.x+i.tmpOffset.x+ig.COLLISION.EPS,xMax:i.pos.x+i.tmpOffset.x+i.size.x-ig.COLLISION.EPS,yMax:i.pos.y+i.tmpOffset.y+i.size.y-i.wallY-ig.COLLISION.EPS,zMax:i.pos.z+i.tmpOffset.z+i.size.z-ig.COLLISION.EPS,idx:-1,spriteSlot:e}))}else{a(e,d,b);e.zMin>=b||e.zMax<=d||e.draw(d,b)}}}}}ig.system.context.globalCompositeOperation=
"source-over"}},drawAnimation:function(a,b,d,e,f,g,h,i){var t=a.sequence.length,e=Math.floor(e/a.frameTime),q=a.stop?Math.min(e,t-1):e%t,t=a.sheet,e=a.sheet.image,s=t.getTileSrc(c,a.sequence[q]),v=ig.system.context;a.framesAlpha&&(f=f*a.framesAlpha[q]);h==void 0&&(h=1);i==void 0&&(i=1);if(q=g||h!=1||i!=1){ig.system.context.save();ig.system.context.translate(ig.system.getDrawPos(b+a.pivot.x),ig.system.getDrawPos(d+a.pivot.y));ig.system.context.rotate(g);(h!=1||i!=1)&&ig.system.context.scale(h,i);b=
-a.pivot.x;d=-a.pivot.y}g=a.renderMode||"source-over";if(g!=v.globalCompositeOperation)v.globalCompositeOperation=g;var y;if(f!=1){y=v.globalAlpha;v.globalAlpha=v.globalAlpha*f}e.draw(b,d,s.x,s.y,t.width,t.height,a.flip.x,a.flip.y);if(f!=1)v.globalAlpha=y;q&&ig.system.context.restore()},mapCleared:function(){this.spriteSlots=[];this.guiSpriteSlots=[]}});var e=Vec2.create(),f=0,g=0,h=0,i=0;ig.Renderer2d.SpriteDrawSlot=ig.Class.extend({cubeSprite:null,ground:false,yIndex:0,zMin:0,zMax:0,spriteIdx:0,
drawShadow:false,init:function(a,b,c){this.cubeSprite=a;this.ground=b;this.spriteIdx=c},update:function(a){this.drawShadow=a;a=this.cubeSprite;if(a.gui)this.yIndex=a.pos.z+a.tmpOffset.z;else if(this.ground){this.yIndex=a.pos.y+a.tmpOffset.y+ig.COLLISION.EPS;this.zMax=this.zMin=a.pos.z+a.tmpOffset.z+a.size.z}else{this.yIndex=a.pos.y+a.tmpOffset.y+a.size.y-a.wallY;this.zMax=a.pos.z+a.tmpOffset.z+(a.size.z||1);this.zMin=a.pos.z+a.tmpOffset.z}},draw:function(a,b){var c=this.cubeSprite;if(c.renderMode)ig.system.context.globalCompositeOperation=
c.renderMode;else if(ig.system.context.globalCompositeOperation!="source-over")ig.system.context.globalCompositeOperation="source-over";if(c.image){var d=c.pos.x+c.tmpOffset.x+c.gfxOffset.x,e=c.pos.y+c.tmpOffset.y-(c.pos.z+c.tmpOffset.z)-c.size.z+c.gfxOffset.y,f=0,g=0,h=0,i=c.size.x,q=c.size.y+c.size.z,g=0,s=c.src.x,v=c.src.y;c.wallY<c.size.y&&!this.ground?f=f+(c.size.y-c.wallY):c.wallY<c.size.y&&this.ground&&(g=q-(c.size.y-c.wallY));if(!this.ground&&a!==void 0){if(c.pos.z+c.tmpOffset.z+c.size.z>
b){h=Math.round(c.pos.z+c.tmpOffset.z+c.size.z-b);c.rotate&&(h=h-1);f=f+h}else c.mergeTop&&(f=0);c.pos.z+c.tmpOffset.z<a&&(g=g+(q-Math.round(q-(a-(c.pos.z+c.tmpOffset.z)+c.wallY))))}c.gfxCut.top&&(f=Math.max(c.gfxCut.top,f));c.gfxCut.bottom&&(g=Math.max(g,c.gfxCut.bottom));q=q-(g+f);if(c.flip.x){g=c.gfxCut.left;h=c.gfxCut.right}else g=h=c.gfxCut.left;i=i-(c.gfxCut.left+c.gfxCut.right);if(!(i<=0||q<=0||c.scale.x==0||c.scale.y==0||c.alpha<=0)){var d=Math.round(d)-ig.game.screen.x,e=Math.round(e)-ig.game.screen.y,
y=ig.system.context.globalAlpha,u=y*c.alpha,z=false;if(c.alpha!=1){z=true;ig.system.context.globalAlpha=u}var D=c.rotate!=0||c.scale.x!=1||c.scale.y!=1;if(D){ig.system.context.save();ig.system.context.translate(ig.system.getDrawPos(d+c.pivot.x),ig.system.getDrawPos(e+c.pivot.y));ig.system.context.rotate(c.rotate);ig.system.context.scale(c.scale.x,c.scale.y);d=-c.pivot.x;e=-c.pivot.y}if(!(c.renderData.fragment&&c.overlay.alpha==1))if(c.image instanceof ig.Image||c.image instanceof ig.ImageCanvasWrapper)c.image.draw(d+
g,e+f,s+h,v+f,i,q,c.flip.x,c.flip.y);else if(c.image instanceof ig.ImagePattern)c.image.draw(d+g,e+f,s+h,v+f,i,q);else if(c.image instanceof ig.SimpleColor||c.image instanceof ig.SimpleCircle||c.image instanceof ig.ComplexLineCircleBox||c.image instanceof ig.TransitionColor||c.image instanceof ig.DoubleColor){s=c.image;s instanceof ig.DoubleColor&&(s=this.ground?s.color1:s.color2);s.draw(d+g,e+f,i,q)}if(c.renderData.fragment){if(c.overlay.alpha!=1){ig.system.context.globalAlpha=u*c.overlay.alpha;
z=true}c.renderData.fragment.draw(d+g,e+f,h,f,i,q,c.flip.x,c.flip.y)}if(c.renderData.lighterFragment){s=ig.system.context.globalCompositeOperation;ig.system.context.globalCompositeOperation="lighter";if(c.lighterOverlay.alpha!=1){ig.system.context.globalAlpha=u*c.lighterOverlay.alpha;z=true}c.renderData.lighterFragment.draw(d+g,e+f,h,f,i,q,c.flip.x,c.flip.y);ig.system.context.globalCompositeOperation=s}D&&ig.system.context.restore();if(z)ig.system.context.globalAlpha=y}}}})});ig.baked=!0;
ig.module("impact.base.physics").requires("impact.base.entity","impact.base.coll-entry").defines(function(){function b(a,b){a.pos.z=b;a.level=ig.game.getLevelIdx(a.pos.z)}var a=Vec2.create(),d=Vec2.create(),c=Vec2.create(),e={},f={},g=[],h=[];Vec2.create();var i=Vec2.create();ig.Physics=ig.Class.extend({cellSize:64,collUpdateList:[],collOutOfScreenList:[],collEntryMap:[],_updateCount:0,_trackEntityTouch:false,mapCleared:function(){this.collEntryMap.length=0;this.collUpdateList.length=0},mapLoaded:function(){var a=
ig.game.size.y;this.collEntryMap.width=Math.ceil(ig.game.size.x/this.cellSize);this.collEntryMap.height=Math.ceil(a/this.cellSize)+16;for(a=0;a<this.collEntryMap.width;++a){this.collEntryMap[a]=[];for(var b=0;b<this.collEntryMap.height;++b)this.collEntryMap[a][b]=[]}this.collUpdateList.length=0},update:function(){this._updateCount=this._updateCount%100;this._updateCount++;for(var a=[],b=this.collOutOfScreenList.length;b--;){var c=this.collOutOfScreenList[b];if(c.updateType==ig.COLL_UPDATE_TYPE.STATIC)this.collOutOfScreenList.splice(b,
1);else if(c.updateType==ig.COLL_UPDATE_TYPE.DYNAMIC||c.updateType==ig.COLL_UPDATE_TYPE.ON_SCREEN&&ig.CollTools.isInScreen(c,16)){this.collOutOfScreenList.splice(b,1);this.collUpdateList.push(c)}}for(b=this.collUpdateList.length;b--;){c=this.collUpdateList[b];this.updateCollEntry(c,a);if(c.updateType==ig.COLL_UPDATE_TYPE.STATIC)this.collUpdateList.splice(b,1);else if(c.updateType==ig.COLL_UPDATE_TYPE.ON_SCREEN&&!ig.CollTools.isInScreen(c,16)){this.collUpdateList.splice(b,1);this.collOutOfScreenList.push(c)}}for(b=
a.length;b--;){for(var c=a[b],d=c._collisionList.length;d--;){var e=c._collisionList[d],f=c._collisionListData[d];if(!c._killed&&!e._killed){if(c.weight>=0&&f&&f.dot){var g=e.weight==-1||c.weight==0?1:Math.min(1,e.weight/c.weight*0.5);c.pushVel.x=f.x*f.dot/ig.system.actualTick*g;c.pushVel.y=f.y*f.dot/ig.system.actualTick*g;e._collData.pushColl=c}c.entity.collideWith(e.entity,f||null)}}c._collisionList.length=0;c._collisionListData.length=0}ig.system.ingameTick=ig.system.tick;a=this.collUpdateList;
for(b=0;b<a.length;b++){d=a[b];if(c=d.entity)if(d=d._collData){ig.system.tick=c.coll.getTick(false);c.handleMovementTrace(d)}}ig.system.tick=ig.system.ingameTick},updateCollEntry:function(a,b){if(a._active&&a.updated!=this._updateCount){a.updated=this._updateCount;ig.profile.updateEntity++;if(!a._killed){ig.vars.pushEntityAccessor(a.entity);a.parentColl&&this.updateCollEntry(a.parentColl,b);a._collData&&a._collData.groundEntry&&this.updateCollEntry(a._collData.groundEntry,b);if(a._collData&&a._collData.pushColl){this.updateCollEntry(a._collData.pushColl,
b);a._collData.pushColl=null}ig.system.ingameTick=ig.system.tick;var c=a.getTick(false),d=a.getTick(false,true),e=a.entity,f=0;e.animState&&e.animState.hasAnimations()&&(f=a.getTick(true));if(c||d||f){ig.system.tick=c;e.update();ig.system.tick=d;this.moveEntity(a,b)}if(f){ig.system.tick=f;e.animState.update(e,e.animSpeedFactor)}ig.system.tick=ig.system.ingameTick;ig.vars.popEntityAccessor(a.entity)}}},getEntitiesInRectangle:function(a,b,c,d,e,f,g,h,i){var q=Math.floor(a/this.cellSize).limit(0,this.collEntryMap.width),
s=Math.floor(b/this.cellSize).limit(0,this.collEntryMap.height),v=(Math.floor((a+d)/this.cellSize)+1).limit(0,this.collEntryMap.width),y=(Math.floor((b+e)/this.cellSize)+1).limit(0,this.collEntryMap.height),u=[];if(!this.collEntryMap.length)return u;for(;q<v;q++)for(var z=s;z<y;z++)for(var D=this.collEntryMap[q][z],C=D.length;C--;){var A=D[C],B=A.entity;if(!(A.subColls.length>0)){var w=A.parentColl&&A.parentColl.entity;B&&(!g||B!=g)&&(!h||h.indexOf(B)==-1)&&(!w||(!w||w!=g)&&(!h||h.indexOf(w)==-1))&&
u.indexOf(B)==-1&&A.intersectsWith(a,b,c,d,e,f,false,null,i)&&u.push(B)}}return u},getEntitiesInCircle:function(a,b,d,f,g,h,i,r,t,q,s){Vec2.assign(c,a);for(var r=this.getEntitiesInRectangle(a.x-b,a.y-d*b,a.z,b*2,d*b*2,f,r,t),t=[],v=a.z,f=a.z+f,y=r.length;y--;){var u=r[y],z=u.coll;if(!(z.pos.z>=f||z.pos.z+z.size.z<=v)){Vec2.assign(c,z.pos);c.x=c.x-z.padding.x<=a.x&&c.x+z.padding.x+z.size.x>=a.x?a.x:c.x+z.padding.x+z.size.x<a.x?c.x+(z.size.x+z.padding.x):c.x-z.padding.x;if(c.y-z.padding.y<=a.y&&c.y+
z.padding.y+z.size.y>=a.y)c.y=a.y;else if(c.y+z.padding.y+z.size.y<a.y)c.y=c.y+(z.padding.y+z.size.y);Vec2.sub(c,a);c.y=c.y/d;var D=Vec2.length(c);if(q||!(D>b)){c.y=c.y*d;if(!g||Vec2.isAngleInRange(c,g,h,i)){if(s){var C=ig.game.physics.initTraceResult(e);if(z.padding.x||z.padding.y){if(c.x)c.x=c.x+(c.x>0?1:-1)*z.padding.x;if(c.y)c.y=c.y+(c.y>0?1:-1)*z.padding.y;D=Vec2.length(c)}this.trace(C,a.x-1,a.y-1,Math.max(a.z,z.pos.z),c.x,c.y,2,2,2,ig.COLLTYPE.IGNORE,z);if(D*(1-C.dist)>8)continue}t.push(u)}}}}return t},
initTraceResult:function(a){if(!a.dir)a.dir=Vec2.create();Vec2.assignC(a.dir,0,0);a.dist=1;a.levelUp=false;a.forcePushEntries=null;a.forcePushDirs=null;return a},trace:function(a,b,c,d,e,f,g,h,i,q,s,v,y){for(var u=ig.game,z=u.maxLevel-1;z&&u.levels[z].height>d;)--z;for(var D=z+1<u.maxLevel&&d+i>u.levels[z+1].height,C=s&&s._collData&&s._collData.forceMoveFrameVel,A=Math.max(1,Math.ceil(Math.max(Math.abs(e),Math.abs(f))/16)),B=s&&s.type==ig.COLLTYPE.TRIGGER,w=A,e=e/A,f=f/A,x=false,E=y&&D&&u.levels[z+
1].height-d<=ig.COLLISION.HEIGHT_TOLERATE,w=0;w<A;w++){var G=-1;if(!C&&!B){if(!a.levelUp)if((x=u.levels[z].collision.trace(a,b,c-u.levels[z].height,e,f,g,h,true))&&E){x=false;G=a.dist;a.dist=1}D&&(x=u.levels[z+1].collision.trace(a,b,c-u.levels[z+1].height,e,f,g,h,true,G==-1)||x)}x=this.traceOnEntryMap(a,b,c,d,e,f,g,h,i,q,s,v,y)||x;if(G!=-1)a.levelUp=a.levelUp||a.dist>G;if(x){a.dist=(w+a.dist)/A;return true}a.dist=1;b=b+e;c=c+f}a.dist=1;return false},addCollEntry:function(a){a._active=true;this.addToUpdateList(a);
this.addToCollMap(a)},removeCollEntry:function(a){a._active=false;this.removeFromUpdateList(a);this.removeFromCollMap(a)},addToUpdateList:function(a){this.collUpdateList.push(a)},removeFromUpdateList:function(a){this.collUpdateList.erase(a)},addToCollMap:function(a){if(!a._inCollisionMap&&!(a.type==ig.COLLTYPE.NONE||a.type==ig.COLLTYPE.PASSIVE)){a._inCollisionMap=true;for(var b=Math.max(0,Math.floor((a.pos.x-a.padding.x*2)/this.cellSize)),c=Math.max(0,Math.floor((a.pos.y-a.padding.y*2)/this.cellSize)),
d=Math.min(this.collEntryMap.width,Math.floor((a.pos.x+a.size.x+a.padding.x*2)/this.cellSize)+1),e=Math.min(this.collEntryMap.height,Math.floor((a.pos.y+a.size.y+a.padding.y*2)/this.cellSize)+1);d-- >b;)for(var f=e;f-- >c;)this.collEntryMap[d][f].indexOf(a)==-1&&this.collEntryMap[d][f].push(a)}},removeFromCollMap:function(a){if(a._inCollisionMap){a._inCollisionMap=false;for(var b=Math.max(0,Math.floor((a.pos.x-a.padding.x*2)/this.cellSize)),c=Math.max(0,Math.floor((a.pos.y-a.padding.y*2)/this.cellSize)),
d=Math.min(this.collEntryMap.width,Math.floor((a.pos.x+a.size.x+a.padding.x*2)/this.cellSize)+1),e=Math.min(this.collEntryMap.height,Math.floor((a.pos.y+a.size.y+a.padding.y*2)/this.cellSize)+1);d-- >b;)for(var f=e;f-- >c;){var g=this.collEntryMap[d][f].indexOf(a);g!=-1&&this.collEntryMap[d][f].splice(g,1)}}},moveEntity:function(c,f){var l=!c.type&&!c.shadow&&!c.zGravityFactor;ig.profile.moveEntity++;var o=c.initCollData(),m=c._collData;m.collided=false;m.slipped=false;if(m.skipPhysics){m.skipPhysics=
false;Vec2.assignC(i,0,0);o=Math.abs(c.pos.z-c.baseZPos)<ig.COLLISION.EPS;this.updateGroundEntity(c,i,o,0,false);m.forceMoveFrameVel=false}else{if(ig.game.firstUpdateLoop)m.zPush=false;if(!m.forceMoveFrameVel){m.frameVel.x=0;m.frameVel.y=0;m.frameVel.z=0}var n=c.pos.x,p=c.pos.y,r;r=m.forceMoveFrameVel?Vec2.assign(i,m.frameVel):Vec2.mulF(Vec2.add(c.vel,c.pushVel,i),ig.system.tick);var t=r.x!=0||r.y!=0;if(isNaN(r.x)||isNaN(r.y))throw Error("NaN!");if(!o&&!m.forceMoveFrameVel&&r.x==0&&r.y==0&&c.vel.z==
0&&c.zGravityFactor==0&&c.shadow==0)m.forceMoveFrameVel=false;else{c.pushVel.x=0;c.pushVel.y=0;if(m.groundEntry){var q=m.groundEntry;if(q.heightShape&&q.pos.z+q.size.z>=c.pos.z&&c.vel.z<=0)if(q.heightShape==ig.COLL_HEIGHT_SHAPE.EAST_UP||q.heightShape==ig.COLL_HEIGHT_SHAPE.WEST_UP){r.x=r.x/(1+q.size.z/q.size.x/2);if(q.size.z/q.size.x>4)c.pushVel.x=c.pushVel.x+200*(q.heightShape==ig.COLL_HEIGHT_SHAPE.EAST_UP?-1:1)}else if(q.heightShape==ig.COLL_HEIGHT_SHAPE.NORTH_UP||q.heightShape==ig.COLL_HEIGHT_SHAPE.SOUTH_UP){r.y=
r.y/(1+q.size.z/q.size.y/2);if(q.size.z/q.size.y>4)c.pushVel.y=c.pushVel.y+200*(q.heightShape==ig.COLL_HEIGHT_SHAPE.SOUTH_UP?-1:1)}if(!c.groundSlip&&!c.float.height){if(!t){m.groundEntryOffset.x=Math.round(m.groundEntryOffset.x);m.groundEntryOffset.y=Math.round(m.groundEntryOffset.y)}r.x=r.x+(q.pos.x+m.groundEntryOffset.x-n);r.y=r.y+(q.pos.y+m.groundEntryOffset.y-p)}if(q._collData){c.baseZPos=c.baseZPos+q._collData.frameVel.z;n=c.pos.z+q._collData.frameVel.z;if(q._collData.frameVel.z<0&&m.holeInfo.mapRes!=
2&&c.level>=0){p=ig.game.levels[c.level].height;if(n<p){n=p;c.baseZPos=p}}m.frameVel.z=n-c.pos.z;b(c,n);m.holeInfo.entryZ=m.holeInfo.entryZ+q._collData.frameVel.z}}if((q=m.overlapEntry)&&c.weight!=-1&&q.pos.z+q.size.z>c.pos.z){if(q.parentColl)q=q.parentColl;if(!q.ignoreCollision){n=ig.CollTools.getDistVec2(q,c,d);p=null;if(!Vec2.isZero(q.accelDir)&&Vec2.isZero(c.accelDir)){p=Vec2.assign(a,q.accelDir);Vec2.rotate90CW(p);Vec2.dot(n,p)<0&&Vec2.flip(p)}if((n.x>0?q.pos.x+q.size.x-c.pos.x:c.pos.x+c.size.x-
q.pos.x)>(n.y>0?q.pos.y+q.size.y-c.pos.y:c.pos.y+c.size.y-q.pos.y)){n.x=0;if(!n.y)n.y=1}else{n.y=0;if(!n.x)n.x=1}if(q.type==ig.COLLTYPE.BLOCK)r.x=r.y=0;var s=Vec2.length(n)-q.size.y/2,s=s<=0?1:Math.max(0.1,1-0.9*s/c.size.y),s=s*m.overlapEntryFactor;p&&(n=p);Vec2.length(n,ig.system.tick*128*s);if(!Vec2.isZero(q.accelDir)||Vec2.dot(c.accelDir,n)>=0||q.type==ig.COLLTYPE.BLOCK){t=true;Vec2.add(r,n)}}}if(!m.skipXYPhysics&&!m.forceMoveFrameVel&&!o&&r.x==0&&r.y==0&&!c.vel.z&&(l||c.pos.z==c.baseZPos&&!m.zBaseUncertain&&
!m.groundEntry&&!m.holeInfo.mapRes&&!c.float.height&&!m.overlapEntry)){c.totalBlockTimer=0;c.partlyBlockTimer=0}else{q=c.vel.z;o=Math.abs(c.pos.z-c.baseZPos)<ig.COLLISION.EPS;t=this.moveEntityZ(c,r,o)||t;l=this.initTraceResult(e);l.forcePushEntries=g;l.forcePushEntries.length=0;l.forcePushDirs=h;l.forcePushDirs.length=0;m.skipXYPhysics?m.skipXYPhysics=false:this.moveEntityXY(l,c,r,f);this.updateGroundEntity(c,r,o,q,t);this.addToCollMap(c);if(l.forcePushEntries.length>0)for(r=l.forcePushEntries.length;r--;)this.forcePushEntry(l.forcePushEntries[r],
c,l.forcePushDirs[r]);m.forceMoveFrameVel=false}}}},moveEntityXY:function(a,c,e,f,g){var h=c._collData;if(e.x==0&&e.y==0){c.totalBlockTimer=0;c.partlyBlockTimer=0;if(!g){h.frameVel.x=0;h.frameVel.y=0}return false}var i=c.pos.x,r=c.pos.y,t=Math.sqrt(e.x*e.x+e.y*e.y);this.removeFromCollMap(c);var q=c.pos.z-c.baseZPos<ig.COLLISION.EPS;if(c.type){var s=false,v=c.bounciness?1:3,y=true;do{v--;if(!c.ignoreCollision&&(!c.parentColl||!c.parentColl.ignoreCollision)){this._trackEntityTouch=true;s=this.trace(a,
i,r,c.pos.z,e.x,e.y,c.size.x,c.size.y,c.size.z,c.type,c,f,q);this._trackEntityTouch=false;if(!s&&y){c.totalBlockTimer=0;c.partlyBlockTimer=0}y=false}else{c.totalBlockTimer=0;c.partlyBlockTimer=0}if(a.dist>0&&Math.abs(c.accelDir.x*a.dir.x+c.accelDir.y*a.dir.y)<0.8)c.totalBlockTimer=0;if(a.levelUp){b(c,ig.game.levels[c.level+1].height);a.levelUp=false}if(s&&v){if(!g)h.collided=h.collided||s;var u=a.dir.y*e.x-a.dir.x*e.y,i=i+a.dist*e.x,r=r+a.dist*e.y,t=t*(1-a.dist);e.x=(1-a.dist)*a.dir.y*u;e.y=(1-a.dist)*
-a.dir.x*u;a.dist=1;if(a.slipX||a.slipY){u=Vec2.assignC(d,a.slipX,a.slipY);if(Vec2.isZero(c.accelDir)||Vec2.angle(c.accelDir,u)<=Math.PI*0.6){Vec2.length(u,t-Math.sqrt(e.x*e.x+e.y*e.y));e.x=e.x+u.x;e.y=e.y+u.y;u=1;a.slipX>0&&e.x>a.slipX?u=Math.min(u,a.slipX/e.x):a.slipX<0&&e.x<a.slipX&&(u=Math.min(u,a.slipX/e.x));a.slipY>0&&e.y>a.slipY?u=Math.min(u,a.slipY/e.y):a.slipY<0&&e.y<a.slipY&&(u=Math.min(u,a.slipY/e.y));if(u<1){e.x=e.x*u;e.y=e.y*u}if(!g)h.slipped=true}}delete a.slipX;delete a.slipY}}while(s&&
v&&(e.x!=0||e.y!=0));if(!g){h.collided=h.collided||s;h.blockDir.x=a.dir.x;h.blockDir.y=a.dir.y}}else{c.totalBlockTimer=0;c.partlyBlockTimer=0}if(c.partlyBlockTimer<0)c.partlyBlockTimer=0;window.checkPlayerPos("");i=i+a.dist*e.x;r=r+a.dist*e.y;i=Math.round(i*100)/100;r=Math.round(r*100)/100;if(!g){h.frameVel.x=i-c.pos.x;h.frameVel.y=r-c.pos.y}if(isNaN(i)||isNaN(r))throw Error("NaN!");c.pos.x=i;c.pos.y=r;return s},isGroundDanger:function(a){return this.groundDangerCallback?this.groundDangerCallback(a):
false},isGroundEntityDanger:function(a){return this.groundEntityDangerCallback?this.groundEntityDangerCallback(a):false},groundDangerCallback:null,groundEntityDangerCallback:null,moveEntityZ:function(d,e,f){var g=false,h=d.pos.x,i=d.pos.y,p=d._collData,r=ig.game.levels[d.level]||ig.game.levels[0];if(f&&(d.zGravityFactor>0&&!d.noSlipping&&!p.forceMoveFrameVel)&&(p.holeInfo.mapRes==1||p.groundEntry)){var f=Vec2.assignC(a,0,0),t=h+d.size.x*0.9/2,q=i+d.size.y*0.9/2,s=d.size.x*0.1,v=d.size.y*0.1,y=d.pos.z-
r.height,u=1E3;p.holeInfo.mapRes==2&&(y=y+16);this.isGroundDanger(d)&&(y=y+16);if(p.holeInfo.mapRes==1&&r.collision.isOverHole(t,q-r.height,s,v)){r=Vec2.assign(c,p.holeInfo.mapDir);d.edgeSlipInward&&Vec2.flip(r);Vec2.dot(d.accelDir,r)>=0&&Vec2.add(f,r);if(p.groundEntry||!this.getGroundEntry(t,q,s,v,d.size.z,d.pos.z,d.pos.z-ig.COLLISION.HEIGHT_TOLERATE,d))y=y+16}if(p.groundEntry){var r=p.groundEntry.heightShape?p.groundEntry.pos.z:d.pos.z,z=p.groundEntry.pos.x+p.groundEntryOffset.x-h,D=p.groundEntry.pos.y+
p.groundEntryOffset.y-i;if(!p.groundEntry.heightShape&&!this.getGroundEntry(t+z,q+D,s,v,d.size.z,d.pos.z,r-ig.COLLISION.HEIGHT_TOLERATE,d)){r=Vec2.assign(c,p.holeInfo.entryDir);d.edgeSlipInward&&Vec2.flip(r);Vec2.dot(d.accelDir,r)>=0&&Vec2.add(f,r);u=Math.min(u,p.holeInfo.entryDist)}else y=0}if((f.x!=0||f.y!=0)&&!p.overlapEntry&&y>ig.COLLISION.HEIGHT_TOLERATE&&Vec2.dot(d.accelDir,f)>=0){if(d.onFallFromEdge)d.onFallFromEdge(f);if(d.vel.z<=0){Vec2.length(f,Math.min(u,32*ig.system.tick));g=true;e.x=
e.x+f.x;e.y=e.y+f.y;if(Math.sqrt(e.x*e.x+e.y*e.y)>u&&d.accelDir.x==0&&d.accelDir.y==0){e.x=f.x;e.y=f.y}}}}t=-ig.game.gravity*d.zGravityFactor;e=d.maxZVel;f=-d.maxZVel;if(d.float.height){q=ig.game.gravity/5*d.float.accel;s=ig.game.gravity*4*d.float.accel;e=Math.max(d.vel.z,d.float.maxSpeed);f=Math.min(d.vel.z,-d.float.maxSpeed);y=d.float.variance;v=d.float.height+d.baseZPos-d.pos.z;Math.abs(v)<=y*2&&(q=q/6);u=d.vel.z*d.vel.z;if(y==0&&Math.abs(v)<1&&Math.abs(d.vel.z)<50){t=0;d.vel.z=0}else if(!(v-y<
0&&d.vel.z<0)&&(v>=0||v+y>0&&d.vel.z>0)){t=0.5*u/(v+y);t=d.vel.z>0&&(t>=q||v<=0)?-t.limit(q/4,s):q}else if(v<0||v-y<0&&d.vel.z<0){t=0.5*u/(-v+y);t=d.vel.z<0&&(t>=q||v>=0)?t.limit(q/4,s):-q}}if(!p.zBaseUncertain&&(p.forceMoveFrameVel||d.pos.z>d.baseZPos||d.vel.z!=0||t>0)){q=p.forceMoveFrameVel?d.pos.z+p.frameVel.z:d.pos.z+d.vel.z*ig.system.tick+t*ig.system.tick*ig.system.tick*0.5;if(!p.forceMoveFrameVel&&d.vel.z>0&&!d.ignoreCollision){if(d.level+1<ig.game.maxLevel&&q+d.size.z>ig.game.levels[d.level+
1].height-1&&!ig.game.levels[d.level+1].collision.isOverHole(h,i-ig.game.levels[d.level+1].height,d.size.x,d.size.y)){q=ig.game.levels[d.level+1].height-1-d.size.z;d.vel.z=0}if(p.ceilingEntry&&q+d.size.z>p.ceilingEntry.pos.z){q=p.ceilingEntry.pos.z-d.size.z;d.vel.z=0}}if(!p.forceMoveFrameVel&&q<=d.baseZPos){d.vel.z=d.pos.z>d.baseZPos&&-d.vel.z>d.minBounceVelocity?d.vel.z*-d.zBounciness:0;q=d.baseZPos}if(!p.forceMoveFrameVel)p.frameVel.z=p.frameVel.z+(q-d.pos.z);b(d,q);d.vel.z=d.vel.z+t*ig.system.tick;
if(d.vel.z>e)d.vel.z=e;if(d.vel.z<f)d.vel.z=f}if(d.accelDir.x||d.accelDir.y){d.totalBlockTimer=d.totalBlockTimer+ig.system.tick;d.partlyBlockTimer=d.partlyBlockTimer+ig.system.tick}else{d.totalBlockTimer=0;d.partlyBlockTimer=0}return g},forcePushEntry:function(a,b,c,d){var e=Vec2.assignC(i,0,0);if(c.x>0)e.x=Math.max(0,b.pos.x+b.size.x-a.pos.x);else if(c.x<0)e.x=Math.min(0,b.pos.x-a.pos.x-a.size.x);if(c.y>0)e.y=Math.max(0,b.pos.y+b.size.y-a.pos.y);else if(c.y<0)e.y=Math.min(0,b.pos.y-a.pos.y-a.size.y);
if(!(e.x==0&&e.y==0)){a.initCollData();if(!a._collData.groundEntry||!(a._collData.groundEntry.parentColl&&a._collData.groundEntry.parentColl==b.parentColl)){var g=this.initTraceResult(f),c=a.totalBlockTimer,h=a.partlyBlockTimer,d=this.moveEntityXY(g,a,e,d,true);a.totalBlockTimer=c;a.partlyBlockTimer=h;c=Math.abs(a.pos.z-a.baseZPos)<ig.COLLISION.EPS;this.updateGroundEntity(a,e,c,a.vel.z,true);this.addToCollMap(a);if(d&&a.entity.onPhysicsSquish)a.entity.onPhysicsSquish(b.entity)}}},updateGroundEntity:function(a,
c,d,e,f){var g=a._collData,h=a.baseZPos,i=!d&&a.pos.z==a.baseZPos,t=this.updateBaseZPos(a,a.pos.x,a.pos.y,g);if(a.zGravityFactor&&a.pos.z<a.baseZPos){g.frameVel.z=g.frameVel.z+(a.baseZPos-a.pos.z);b(a,a.baseZPos);g.zPush=true}var q=t||g.groundEntry,c=q&&q.heightShape?Math.max(Math.abs(c.x),Math.abs(c.y))+2:ig.COLLISION.HEIGHT_TOLERATE;if(!g.forceMoveFrameVel&&a.zGravityFactor){q=a.pos.z-a.baseZPos<ig.COLLISION.EPS;if(!q&&i&&a.pos.z-a.baseZPos<c){q=true;b(a,a.baseZPos)}if(d&&a.vel.z<=0)if(q){if(g.holeInfo.entryDanger&&
a.entity.onFallFromEdge)a.entity.onFallFromEdge()}else if(a.pos.z-a.baseZPos>c||this.isGroundDanger(a)){if(a.entity.onFallFromEdge)a.entity.onFallFromEdge()}else{b(a,a.baseZPos);g.zPush=true}else if(a.float.height&&h-a.baseZPos>ig.COLLISION.HEIGHT_TOLERATE&&a.pos.z-h<a.float.height+a.float.variance){if(a.entity.onFallFromEdge)a.entity.onFallFromEdge()}else if(!d&&q&&a.entity.onTouchGround)a.entity.onTouchGround(e)}else t=null;(g.groundEntry!=t||f||g.collided)&&a.setGroundEntry(t)},updateBaseZPos:function(a,
b,c,d){var e=ig.game.levels[a.level]||ig.game.levels[0];a.baseZPos=a.level>=0?e.height:-1E3;Vec2.assignC(d.holeInfo.mapDir,0,0);d.holeInfo.mapRes=e.collision.isOverHole(b,c-e.height,a.size.x,a.size.y,d.holeInfo.mapDir);e=a.level;if(e>=0&&d.holeInfo.mapRes==2)for(--e;e>=0&&ig.game.levels[e].collision.isOverHole(b,c-ig.game.levels[e].height,a.size.x,a.size.y);)--e;a.baseZPos=e>=0?ig.game.levels[e].height:-1E3;d.zBaseUncertain=false;Vec2.assignC(d.holeInfo.entryDir,0,0);d.holeInfo.entryZ=0;d.holeInfo.entryDist=
1E4;d.overlapEntry=null;d.ceilingEntry=null;d.holeInfo.entryDanger=false;if(b=this.getGroundEntry(b,c,a.size.x,a.size.y,a.size.z,a.pos.z,a.baseZPos,a,d)){c=b.heightShape?32:ig.COLLISION.HEIGHT_TOLERATE;e=this.isGroundEntityDanger(b);if(a.baseZPos==a.pos.z&&a.baseZPos==d.holeInfo.entryZ&&e)b=null;else{if(a.baseZPos<d.holeInfo.entryZ)a.baseZPos=d.holeInfo.entryZ;a.zGravityFactor&&a.pos.z-a.baseZPos<=c?d.holeInfo.entryDanger=e:a.float.height||(b=null)}}return b},getBaseZPos:function(a,b,c,d,e){for(var f=
ig.game.getLevelIdx(c);f>=0&&ig.game.levels[f].collision.isOverHole(a,b-ig.game.levels[f].height,d,e);)--f;f=f>=0?ig.game.levels[f].height:-1E3;return(a=this.getGroundEntry(a,b,d,e,8,c,f))?a.pos.z+a.size.z:f},traceOnEntryMap:function(a,b,c,d,e,f,g,h,i,q,s,v,y){for(var u=[],z=[],D=false,C=Math.max(0,Math.floor((b+(e<0?e:0))/this.cellSize)),A=Math.max(0,Math.floor((c+(f<0?f:0))/this.cellSize)),B=Math.min(this.collEntryMap.width,Math.floor((b+(e>0?e:0)+g)/this.cellSize)+1),w=Math.min(this.collEntryMap.height,
Math.floor((c+(f>0?f:0)+h)/this.cellSize)+1),x=[],E=[],G=1,D=false,J=s&&s._collData&&s._collData.forceMoveFrameVel,I=J||s&&(q==ig.COLLTYPE.BLOCK||q==ig.COLLTYPE.FENCE)&&s.weight==-1,K=s&&s.parentColl?s.parentColl:s,H=s&&s.shape!=ig.COLLSHAPE.RECTANGLE,M=C;M<B;M++)for(var L=A;L<w;L++)for(var N=this.collEntryMap[M][L],C=N.length;C--;){var F=N[C];if(F._inCollisionMap){if(u.indexOf(F)==-1&&F!=K&&(!F.parentColl||F.parentColl!=K)){u.push(F);if(F.ignoreCollision||F.parentColl&&F.parentColl.ignoreCollision||
!ig.Entity.COLLISION_MAP[q][F.type])z.push(F);else{var O=a.dist,P;if(H)(P=s.trace(a,F.pos.x,F.pos.y,F.pos.z,-e,-f,F.size.x,F.size.y,F.size.z,y))&&Vec2.flip(a.dir);else P=F.trace(a,b,c,d,e,f,g,h,i,y);if(P){if(a.forcePushEntries&&I&&F.type!=ig.COLLTYPE.BLOCK&&(F.weight!=-1||F.type==ig.COLLTYPE.PROJECTILE)){a.dist=O;a.forcePushEntries.push(F);a.forcePushDirs.push(ig.copy(a.dir))}else if(J)a.dist=O;else{if(G>a.dist){G=a.dist;x=[];E=[]}D=true}x.push(F);E.push({x:a.dir.x,y:a.dir.y})}else if(F.intersectsWith(b,
c,d,g,h,i)){x.push(F);E.push({x:0,y:0})}}}}else N.splice(C,1)}if(v){a=false;for(C=x.length;C--;){F=x[C];q=E[C];v.indexOf(F)==-1&&v.push(F);if(s&&this._trackEntityTouch){a=true;u=F._collisionList.indexOf(s);if(u==-1){u=F._collisionList.length;F._collisionList.push(s)}if(!F._collisionListData[u]){q.dot=q.x*e+q.y*f;F._collisionListData[u]=q}s._collisionList.indexOf(F)==-1&&s._collisionList.push(F)}}if(this._trackEntityTouch){x={dist:1,dir:{x:0,y:0}};for(C=z.length;C--;){F=z[C];x.dist=G;if(F.trace(x,
b,c,d,e,f,g,h,i,y)||F.intersectsWith(b,c,d,g,h,i)){v.indexOf(F)==-1&&v.push(F);if(s){a=true;F._collisionList.indexOf(s)==-1&&F._collisionList.push(s);s._collisionList.indexOf(F)==-1&&s._collisionList.push(F)}}}s&&(a&&v.indexOf(s)==-1)&&v.push(s)}}return D},getGroundEntry:function(a,b,c,d,e,f,g,h,i){for(var q=i&&i.holeInfo,s=false,v=0,y=Math.max(0,Math.floor(a/this.cellSize)),u=Math.max(0,Math.floor(b/this.cellSize)),z=Math.min(this.collEntryMap.width,Math.floor((a+c)/this.cellSize)+1),D=Math.min(this.collEntryMap.height,
Math.floor((b+d)/this.cellSize)+1),C=h&&h.type==ig.COLLTYPE.SEMI_IGNORE;y<z;y++)for(var A=u;A<D;A++)for(var B=this.collEntryMap[y][A].length;B--;){var w=this.collEntryMap[y][A][B],x=w.parentColl||w;if(w!=h&&!x.ignoreCollision&&(!h||w.parentColl!=h)&&(w.type==ig.COLLTYPE.NPBLOCK||w.type==ig.COLLTYPE.BLOCK||w.type==ig.COLLTYPE.FENCE||w.type==ig.COLLTYPE.NPFENCE||!C&&w.type==ig.COLLTYPE.VIRTUAL||C&&w.type==ig.COLLTYPE.SEMI_IGNORE)){var x=w.pos.x+w.size.x-a,E=a+c-w.pos.x,G=w.pos.y+w.size.y-b,J=b+d-w.pos.y,
I=Math.min(Math.min(x,E),Math.min(J,G)),K=1;if(I>0){var H=w.pos.z+w.getOverlapHeight(a,b,c,d);if(f+e-ig.COLLISION.EPS>w.pos.z&&H>=g){if(C&&w.type==ig.COLLTYPE.SEMI_IGNORE)if(I<h.size.x/4)continue;else K=0.2;var M=w._collData;if(!w.heightShape&&H-ig.COLLISION.EPS>f+ig.COLLISION.HEIGHT_TOLERATE){if((w.shape==ig.COLLSHAPE.RECTANGLE||ig.CollMapTools.isTriangleOverlap(w.pos.x+w.size.x/2,w.pos.y+w.size.y/2,w.shape,a,b,c,d))&&(q&&h&&!h.heightShape&&h.shape==ig.COLLSHAPE.RECTANGLE&&!h.ignoreCollision&&!w.ignoreCollision&&
(h.type==ig.COLLTYPE.BLOCK||h.type==ig.COLLTYPE.NPBLOCK||h.type==ig.COLLTYPE.VIRTUAL||C))&&!(M&&M.groundEntry==h)){if(!i.overlapEntry||i.overlapEntry.size.x<w.size.x){i.overlapEntryFactor=K;i.overlapEntry=w}if(M&&(!M.overlapEntry||M.overlapEntry.size.x<h.size.x)){M.overlapEntry=h;M.overlapEntryFactor=K}}}else if(w.type==ig.COLLTYPE.BLOCK||w.type==ig.COLLTYPE.NPBLOCK){var L=0,N=K=0,F=I;if(w.shape!=ig.COLLSHAPE.RECTANGLE){var O=w.pos.x+w.size.x/2,P=w.pos.y+w.size.y/2;switch(w.shape){case ig.COLLSHAPE.SLOPE_NE:L=
a-O-(b+d-P);K=1;N=-1;break;case ig.COLLSHAPE.SLOPE_SE:L=a-O+(b-P);N=K=1;break;case ig.COLLSHAPE.SLOPE_SW:L=-(a+c-O)+(b-P);K=-1;N=1;break;case ig.COLLSHAPE.SLOPE_NW:L=-(a+c-O)-(b+d-P);N=K=-1}if(L>=-ig.COLLISION.EPS)continue;L=L*-Math.SQRT1_2;F=Math.min(F,L)}if(q){L=ig.CollTools.getOverlapArea(w,a,b,c,d);if(H>g){g=H;q.entryDir.x=0;q.entryDir.y=0;q.entryDist=1E5}else if(s&&L<v)continue;v=L;if(I==F)if(I==G){K=0;N=1}else if(I==J){K=0;N=-1}else if(I==x){K=1;N=0}else if(I==E){K=-1;N=0}if(F<q.entryDist)if(q.entryDir.x*
K+q.entryDir.y*N<0){q.entryDir.x=0;q.entryDir.y=0;q.entryDist=0}else{q.entryDir.x=K;q.entryDir.y=N;q.entryDist=F}q.entryZ=H;s=w}else return w}}else if(f+e<=w.pos.z&&(w.type==ig.COLLTYPE.BLOCK||w.type==ig.COLLTYPE.NPBLOCK))if(i&&M&&M.groundEntry!=h&&(!i.ceilingEntry||i.ceilingEntry.pos.z<w.pos.z))i.ceilingEntry=w}}}return s}})});ig.baked=!0;
ig.module("impact.base.game-state").defines(function(){ig.GameState=ig.Class.extend({game:{screen:{x:0,y:0},size:{x:0,y:0},paused:false,entities:[],mapEntities:[],shownEntities:[],freeEntityIds:[],namedEntities:{},_deferredDetach:[],conditionalEntities:[],maps:[],levels:{},maxLevel:0,minLevelZ:0,masterLevel:0},system:{zoomFocus:{x:0,y:0},zoom:1},physics:{collUpdateList:[],collOutOfScreenList:[],collEntryMap:[]},physicsInitialized:false,renderer:{spriteSlots:[],guiSpriteSlots:[]},init:function(){},
clear:function(){ig.game.pushState(this);for(var b=this.game.entities,a=b.length;a--;){b[a]&&b[a].kill(true);if(b[a]&&!b[a]._killed)throw Error("Entity of id "+this.entities[a].id+" was not properly killed");}ig.game.deferredMapEntityUpdate();ig.game.popState()},initEmpty:function(b,a){this.game.size.x=b;this.game.size.y=a;this.game.maxLevel=1;this.game.masterLevel=0;this.game.levels.first={maps:[]};this.game.levels.last={maps:[]};this.game.levels.light={maps:[]};this.game.levels.postlight={maps:[]};
this.game.levels.object1={maps:[]};this.game.levels.object2={maps:[]};this.game.levels.object3={maps:[]};this.game.levels["0"]={height:0,collision:ig.MAP.Collision.staticNoCollision,maps:[]}},initFromGame:function(b){this.onEnd(b);this.physicsInitialized=true},forceUpdate:function(){ig.system.ingameTick=ig.system.tick;ig.system.tick=ig.system.actualTick;var b=ig.game;ig.game.pushState(this);b.physics.update();b.deferredMapEntityUpdate();ig.game.popState();ig.system.tick=ig.system.ingameTick},forceDraw:function(b,
a){var d=ig.game;this.game.screen.x=this.game.screen.x-b;this.game.screen.y=this.game.screen.y-a;ig.game.pushState(this);d.renderer.prepareDraw(d.shownEntities,true);d.renderer.drawLayers(true,true);d.renderer.drawPostLayerSprites(true);ig.game.popState();this.game.screen.x=this.game.screen.x+b;this.game.screen.y=this.game.screen.y+a},onEnd:function(b){for(var a in this.game)this.game[a]=b[a];for(a in this.system)this.system[a]=ig.system[a];for(a in this.physics)this.physics[a]=b.physics[a];for(a in this.renderer)this.renderer[a]=
b.renderer[a]},onStart:function(b){for(var a in this.game)b[a]=this.game[a];for(a in this.system)ig.system[a]=this.system[a];for(a in this.physics)b.physics[a]=this.physics[a];for(a in this.renderer)b.renderer[a]=this.renderer[a];if(!this.physicsInitialized){b.physics.mapLoaded();this.physicsInitialized=true}}})});ig.baked=!0;
ig.module("impact.base.map").defines(function(){var b=Vec2.create();ig.Map=ig.Class.extend({tilesize:8,width:1,height:1,data:[[]],zHeight:0,zTileOff:0,moveSpeed:{x:0,y:0},init:function(a,b){this.tilesize=a.tilesize;var c=a.data;this.height=(this.data=c)&&c.length;this.width=c&&c[0].length;this.repeat=a.repeat;this.distance=a.distance;this.yDistance=a.yDistance||0;this.zHeight=b;this.zTileOff=this.zHeight/this.tilesize;this.moveSpeed=a&&a.moveSpeed||this.moveSpeed},copy:function(a){this.tilesize=a.tilesize;
this.data=[];for(var b=0;b<a.data.length;++b)this.data.push(a.data[b].slice());this.height=a.height;this.width=a.width;this.repeat=a.repeat;this.distance=a.distance;this.yDistance=a.yDistance||0;this.zHeight=a.zHeight;this.zTileOff=a.zTileOff},clear:function(){this.data.length=0},getTile:function(a,b){var c=Math.floor(a/this.tilesize),e=Math.floor(b/this.tilesize);return c>=0&&c<this.width&&e>=0&&e<this.height?this.data[e][c]:0},getGridTile:function(a,b){return this.data[b]&&this.data[b][a]||0},setTile:function(a,
b,c){return this.setGridTile(Math.floor(a/this.tilesize),Math.floor(b/this.tilesize),c)},setGridTile:function(a,b,c){if(a>=0&&a<this.width&&b>=0&&b<this.height){if(this.data[b][a]==c)return false;this.data[b][a]=c;return true}return false}});ig.ChunkedMap=ig.Map.extend({scroll:{x:0,y:0},distance:1,yDistance:0,repeat:false,enabled:true,preRender:true,screenRender:false,screenBuffer:false,preRenderedChunks:null,chunkSizeX:512,chunkSizeY:512,debugDraw:false,lighter:false,merged:false,init:function(a,
b){this.parent(a,b)},clear:function(){this.parent();if(this.screenBuffer){this.screenBuffer.clearCached();this.screenBuffer=null}this.clearPreRenderedChunks()},clearPreRenderedChunks:function(){if(this.preRenderedChunks){for(var a=0;a<this.preRenderedChunks.length;++a){for(var b=0;b<this.preRenderedChunks[a].length;++b){var c=this.preRenderedChunks[a][b];c.width=0;c.height=0}this.preRenderedChunks[a].length=0}this.preRenderedChunks.length=0;this.preRenderedChunks=null}},setScreenPos:function(a,d){var c=
0,e=0,f=this.yDistance||this.distance;if(this.distance){e=ig.system.getMapFromScreenPos(b,ig.system.width/2,ig.system.height/2);c=ig.game.screen.x+ig.system.width/2-e.x;e=ig.game.screen.y+ig.system.height/2-e.y}this.scroll.x=(a-c)/this.distance+c;this.scroll.y=(d-e)/f+e;if(this.distance&&this.distance<1)this.scroll.x=this.scroll.x+16;if(f&&f<1)this.scroll.y=this.scroll.y+16;this.screenBuffer&&this.screenBuffer.update(this)},setGridTile:function(a,b,c){var e=this.parent(a,b,c);e&&this.preRenderedChunks&&
this.redrawChunkTile(this.preRenderedChunks[Math.floor(this.tilesize*b*ig.system.scale/this.chunkSizeY)][Math.floor(this.tilesize*a*ig.system.scale/this.chunkSizeX)],this.tilesize*a*ig.system.scale%this.chunkSizeX,this.tilesize*b*ig.system.scale%this.chunkSizeY,c);e&&this.screenBuffer&&this.screenBuffer.setGridTile(a,b,c,this)},preRenderMapToChunks:function(a){var b=this.width*this.tilesize*ig.system.scale,c=this.height*this.tilesize*ig.system.scale,e=Math.ceil(b/this.chunkSizeX),f=Math.ceil(c/this.chunkSizeY);
this.preRenderedChunks=[];for(var g=0;g<f;g++){this.preRenderedChunks[g]=[];for(var h=0;h<e;h++){var i=h==e-1?b-h*this.chunkSizeX:this.chunkSizeX,j=g==f-1?c-g*this.chunkSizeY:this.chunkSizeY,k=null;if(a){k=a[g][h];this.preRenderChunk(h,g,i,j,k,true)}else{k=ig.$new("canvas");k.width=i;k.height=j;this.preRenderedChunks[g][h]=k;ig.system.getBufferContext(k).clearRect(0,0,i,j);this.preRenderChunk(h,g,i,j,k,false)}}}if(a)this.merged=true;return a||this.preRenderedChunks},readyToDraw:function(){return false},
preRenderChunk:function(){return null},preRenderScreen:function(){},redrawChunkTile:function(){},_draw:function(a,d,c,e){if(!this.merged&&!(this.screenBuffer&&this.screenBuffer.ownerMap!=this)){var f=ig.system.getZoomMinOffset(b),a=a==void 0?this.scroll.x+f.x-1:a,d=d==void 0?this.scroll.y+f.y-1:d,c=c==void 0?Math.ceil(ig.system.width/ig.system.zoom)+2:c,e=e==void 0?Math.ceil(ig.system.height/ig.system.zoom)+2:e;this.enabled&&(this.screenBuffer?this.drawFromScreenBuffer(a,d,c,e):this.preRender?this.drawPreRendered(a,
d,c,e):this.drawTiled(a,d,c,e))}},draw:function(a,b,c,e){this._draw(a,b,c,e)},drawAnimated:null,drawFromScreenBuffer:function(a,b,c,e){if(this.screenBuffer.redrawFull){if(!this.readyToDraw())return;this.screenBuffer.update()}var a=ig.system.getDrawPos(a),b=ig.system.getDrawPos(b),f=a-this.scroll.x*ig.system.scale,g=b-this.scroll.y*ig.system.scale;if(!ig.perf.smoothMapRendering||!this.distance||this.distance==1){f=Math.round(f*ig.system.scale)/ig.system.scale;g=Math.round(g*ig.system.scale)/ig.system.scale}c=
c*ig.system.scale;e=e*ig.system.scale;this.screenBuffer.draw(f,g,a,b,c,e)},drawPreRendered:function(a,b,c,e){if(!this.preRenderedChunks){if(!this.readyToDraw())return;this.preRenderMapToChunks()}if(this.lighter)ig.system.context.globalCompositeOperation="lighter";var a=ig.system.getDrawPos(a),f=ig.system.getDrawPos(b),b=a-this.scroll.x*ig.system.scale,g=f-this.scroll.y*ig.system.scale;if(!ig.perf.smoothMapRendering||!this.distance||this.distance==1){b=Math.round(b*ig.system.scale)/ig.system.scale;
g=Math.round(g*ig.system.scale)/ig.system.scale}var c=c*ig.system.scale,e=e*ig.system.scale,h=this.width*this.tilesize*ig.system.scale,i=this.height*this.tilesize*ig.system.scale;if(this.repeat){a=(a%h+h)%h;f=(f%i+i)%i}else{a+c>h&&(c=h-a);f+e>i&&(e=i-f)}for(var h=Math.max(Math.floor(a/this.chunkSizeX),0),j=Math.max(Math.floor(f/this.chunkSizeY),0),i=this.preRenderedChunks[0].length,k=this.preRenderedChunks.length,f=f-j*this.chunkSizeY,l=0,o,m;l<e;){for(var n=0,p=a-h*this.chunkSizeX,r=h;n<c;){var t=
this.preRenderedChunks[j][r],q=b+n,s=g+l;o=Math.min(t.width-p,c-n);m=Math.min(t.height-f,e-l);if(o&&m){ig.system.context.drawImage(t,p,f,o,m,q,s,o,m);ig.Image.drawCount++}if(this.debugDraw){ig.system.context.strokeStyle="#f0f";ig.system.context.strokeRect(q,s,o,m)}p=0;n=n+o;r=(r+1)%i}f=0;l=l+m;j=(j+1)%k}if(this.lighter)ig.system.context.globalCompositeOperation="source-over"},drawTiled:function(){}});ig.MAP={}});ig.baked=!0;
ig.module("game.config").defines(function(){ig.SUPPORTED_LANG=["en_US","de_DE","fr_FR","zh_CN","zh_TW","ja_JP","ko_KR"];ig.VISIBLE_LANG=["en_US"];ig.LANG_DETAILS={en_US:{},de_DE:{useFor:"de",commaDigits:true},zh_TW:{systemFont:"CrossCode",newlineAnywhere:true,newlineException:["\u3001","\u3002","\uff0c","\uff1f","\uff01"],useFor:"zh-TW"},zh_CN:{systemFont:"CrossCode",newlineAnywhere:true,newlineException:["\u3001","\u3002","\uff0c","\uff1f","\uff01"],useFor:"zh"},ja_JP:{systemFont:"CrossCodeJP",metrics:{size:[10,
7,6],baseLine:[12,10,6]},fixedMsgWidth:true,newlineAnywhere:true,newlineException:["\u3001","\u3002","\u2026","\uff01","\uff1f"],useFor:"ja"},ko_KR:{systemFont:"CrossCodeKR",newlineAnywhere:false,newlineAfter:["\u3001","\u3002","\u2026","\uff01","\uff1f"],useFor:"ko"}};ig.SYSTEM_FONT_METRICS={size:[12,10,7],baseLine:[13,10,6]};ig.FORCE_LANG=null;ig.CONFIG={DEFAULT_TILE_SIZE:16,DISABLE_LAYER_SIZE:true,DISABLE_LAYER_DISTANCE:false,DISABLE_LAYER_REPEAT:true,COLLISION_TILESET:"media/map/collisiontiles-16x16.png"};
ig.JSON_LOG=false;ig.TILEINFO_FILE="data/tile-infos.json";ig.TERRAIN={NORMAL:1,METAL:2,CARDBOARD:3,EARTH:4,GRASS:5,WATER:6,WOOD:7,STONE:8,METALSOLID:9,SNOW:10,ICE:11,NOTHING:12,QUICKSAND:13,SHALLOW_WATER:14,SAND:15,COAL:16,HOLE:17,LASER:18,METAL_HOLLOW:19,SPIDERWEB:20,HIGHWAY:21,CRYSTAL:22,BEACH_WATER:23,BEACH_SAND:24};ig.DANGER_TERRAIN={HOLE:"HOLE",WATER:"WATER",COAL:"COAL",HIGHWAY:"HIGHWAY"};ig.TERRAIN_FILE="data/terrain.json";ig.TERRAIN_DEFAULT=ig.TERRAIN.NORMAL;ig.DATABASE={ACHIEVEMENTS:1};ig.DATABASE_FILE=
"data/database.json";ig.NPC_NAMES="data/npc-names.json";ig.ITEM_DATABASE="data/item-database.json";ig.SKILL_TREE="data/skilltree.json";ig.CHANGE_LOG="data/changelog.json";ig.ACHIEVEMENTS="data/achievements.json"});ig.baked=!0;
ig.module("impact.base.collision-map").requires("impact.base.map","game.config").defines(function(){function b(a){return a<4?a%3:a-12>>2}function a(a){return a<4?a==3?0:1:2+a%4}ig.MAP.Collision=ig.Map.extend({_wm:new ig.Config({_label:"Collision",_fixSize:ig.CONFIG.DISABLE_LAYER_SIZE,_noRepeat:true,_noMoveSpeed:true,_noDistance:ig.CONFIG.DISABLE_LAYER_DISTANCE,_fixTilesize:ig.CONFIG.DEFAULT_TILE_SIZE,_fixTileset:ig.CONFIG.COLLISION_TILESET,_noFirstLastLayer:true,_icon:"weltmeister/lib/map/img/layer-collision-icon.png",
_alphaActive:0.6,_alphaInactive:0,_alphaEntities:0}),init:function(a,b){this.parent(a,b)},prepare:function(a,b){for(var e=0;e<this.height;e++)for(var f=0;f<this.width;f++){var g;a&&(g=a.data[e+b]?a.data[e+b][f]%32:2);this.data[e][f]=ig.CollMapTools.prepareSingleTile(f,e,this.data[e][f],g,b)}},isTileGround:function(a,b){var e=this.getTile(a,b);return ig.CollMapTools.isTileFullGround(e)},isTileAreaBlocked:function(b,c,e,f){for(var g=Math.floor(b/this.tilesize),h=Math.floor(Math.ceil(b+e-1)/this.tilesize),
i=Math.floor(c/this.tilesize),j=Math.floor(Math.ceil(c+f-1)/this.tilesize),i=Math.max(i,0),j=Math.min(j,this.height-1),g=Math.max(g,0),h=Math.min(h,this.width-1),j=j+1;j-- >i;)for(var k=h+1;k-- >g;){var l=this.getGridTile(k,j);if(ig.CollMapTools.isTileBlocked(l)){l=a(l);if(l==1||l>=2&&ig.CollMapTools.isTriangleOverlap((k+0.5)*this.tilesize,(j+0.5)*this.tilesize,l,b,c,e,f))return true}}return false},isGridHole:function(d,c){var e=this.getGridTile(d,c),f=b(e),e=a(e);return f==3||f==1&&e==1},isOverHole:function(d,
c,e,f,g){for(var h=Math.floor(d/this.tilesize),i=Math.floor(Math.ceil(d+e-1)/this.tilesize),j=Math.floor(c/this.tilesize),k=Math.floor(Math.ceil(c+f-1)/this.tilesize),j=Math.max(j,0),k=Math.min(k,this.height-1),h=Math.max(h,0),i=Math.min(i,this.width-1),l=0,o=0,m=k+1;m-- >j;)for(var n=i+1;n-- >h;){++o;var p=this.data[m]&&this.data[m][n],p=p%32,r=a(p),t=b(p),p=0;if(t==3)p=1;else if(t==1)if(r==1)p=1;else if(r>1){var t=(n+0.5)*this.tilesize,q=(m+0.5)*this.tilesize;r==2&&n==i&&m==j?d+e-t-(c-q)<=0.01&&
(p=1):r==2&&n==h&&m==k?-(d-t)+(c+f-q)>0.01&&(p=0.5):r==3&&n==i&&m==k?d+e-t+(c+f-q)<=0.01&&(p=1):r==3&&n==h&&m==j?-(d-t)-(c-q)>0.01&&(p=0.5):r==4&&n==h&&m==k?-(d-t)+(c+f-q)<=0.01&&(p=1):r==4&&n==i&&m==j?d+e-t-(c-q)>0.01&&(p=0.5):r==5&&n==h&&m==j?-(d-t)-(c-q)<=0.01&&(p=1):r==5&&n==i&&m==k?d+e-t+(c+f-q)>0.01&&(p=0.5):p=0.5}if(p!=1&&!g)return 0;if(p!=0&&g){g.x=g.x+(n==h?-1:n==i?1:0);g.y=g.y+(m==j?-1:m==k?1:0)}l=l+p}return l==o?2:l>0?1:0},trace:function(d,c,e,f,g,h,i,j,k){var l=Math.floor((c+(f<0?f:0))/
this.tilesize),o=Math.floor(Math.ceil(c+h-1+(f>0?f:0))/this.tilesize),m=Math.floor((e+(g<0?g:0))/this.tilesize),n=Math.floor(Math.ceil(e+i-1+(g>0?g:0))/this.tilesize),p,r,t,q;if(f!=0&&g!=0){var s;s=c+f+(f<0?h:0)-(f<0?o:l+1)*this.tilesize;var v=e+g+(g>0?i:0)-(g>0?n:m+1)*this.tilesize;if(v&&v*g>=0&&s*f>=0&&Math.abs(s)<Math.abs(f)&&Math.abs(v)<Math.abs(g)&&Math.abs(f/g)<Math.abs(s/v)){p=f<0?o:l;r=g>0?n:m}v=e+g+(g<0?i:0)-(g<0?n:m+1)*this.tilesize;if((s=c+f+(f>0?h:0)-(f>0?o:l+1)*this.tilesize)&&v*g>=0&&
s*f>=0&&Math.abs(s)<Math.abs(f)&&Math.abs(v)<Math.abs(g)&&Math.abs(g/f)<Math.abs(v/s)){t=f>0?o:l;q=g<0?n:m}}s=false;m=Math.max(m,0);n=Math.min(n,this.height-1);l=Math.max(l,0);o=Math.min(o,this.width-1);for(n=n+1;n-- >m;)for(v=o+1;v-- >l;)if((v!=p||n!=r)&&(v!=t||n!=q)){var y=this.data[n]&&this.data[n][v],y=y%32,u=a(y),y=b(y);if(k)y==1?u=u>1?u%4+2:u?0:1:y!=3&&(u=1);else{if(j&&y==1)continue;!j&&y==3&&(u=1)}u>1?s=ig.MAP.Collision.solveBlockCollision(d,c,e,f,g,h,i,v*this.tilesize,n*this.tilesize,this.tilesize,
this.tilesize,(u-2)%4)||s:u&&(s=ig.MAP.Collision.solveBlockCollision(d,c,e,f,g,h,i,v*this.tilesize,n*this.tilesize,this.tilesize,this.tilesize)||s)}return s}});ig.MAP.Collision.levelKey="collision";ig.CollMapTools={isTileBlocked:function(a){a=b(a);return a==2||a==3},isTileFullGround:function(d){var c=b(d),d=a(d);return c!=1&&c!=3&&d==0},isTilePartlyGround:function(d){var c=b(d),d=a(d);return c==3||c==2||c==1&&d==1?false:true},getRealCollValue:function(a,b,e,f,g,h){var i=e>h?1:-1,j=g[e].height,k=j-
g[h].height,l;for(l=f[h]?this.prepareSingleTile(a,b,f[h].getTile(a,b+k)):3;h!=e;){h=h+i;k=j-g[h].height;l=f[h]?this.prepareSingleTile(a,b,f[h].getTile(a,b+k),l,i):3}return l},prepareSingleTile:function(d,c,e,f,g){c=d=e;d=d%32;c=c-d;if(d>0&&d<4||d>=16)return e;if(f===void 0)c=d==0||d>=12?c+3:c+(d+12);else{var e=a(f),h=b(f);if(g>0)if(d==0)c=h==2||h==3?c+(e==1?3:e%4+16):c+1;else{f=2+d%4;c=e!=f&&(h==2||h==3)?c+(d>=12?3:d+12):c+(d>=12?f%4+16:d>=8?d+16:1)}else if(d==0)c=h==1?c+(e==1?3:e%4+20):h==3?c+(f-
4):c+2;else{f=2+d%4;h==3&&(e=2+e%4);c=e!=f&&(h==1||h==3)?c+(d>=12?3:d+12):c+(d>=12?f%4+20:d>=8?2:f%4+24)}}return c},isTriangleOverlap:function(a,b,e,f,g,h,i){Math.abs(h/i);var j,k;if(e==2){j=1;k=-1}else if(e==3)k=j=1;else if(e==4){j=-1;k=1}else if(e==5)k=j=-1;return j*((j>0?f:f+h)-a)+k*((k>0?g:g+i)-b)<0}};ig.MAP.Collision.staticNoCollision={isOverHole:function(){return 0},isTileGround:function(){return false},isTileAreaBlocked:function(){return false},trace:function(){return false},prepare:function(){}};
ig.COLLISION={};ig.COLLISION.EPS=1E-5;ig.COLLISION.SLIP_PIXELS=8;ig.COLLISION.HEIGHT_TOLERATE=4;ig.MAP.Collision.solveBlockCollision=function(a,b,e,f,g,h,i,j,k,l,o,m){var n=false;if(m!=void 0){var p=0,r=0,t=j+l/2,q=k+o/2;switch(m){case 0:p=-t+q-(-b+e+i);r=-f+g;break;case 1:p=-t-q-(-b-e);r=-f-g;break;case 2:p=t-q-(b+h-e);r=f-g;break;case 3:p=t+q-(b+h+e+i);r=f+g}if((n=p+0.1>=0)&&r>0){p=Math.max(0,p/r-ig.COLLISION.EPS);if(p-ig.COLLISION.EPS<a.dist){n=0;switch(m){case 0:n=b+p*f-t+(e+p*g+i-q);break;case 1:n=
b+p*f-t-(e+p*g-q);break;case 2:n=b+p*f+h-t+(e+p*g-q);break;case 3:n=b+p*f+h-t-(e+p*g+i-q)}if(Math.abs(n)>l+0.1)n=false;else{g=f=0;a.dist=p;a.dir.x=(m<2?-1:1)*Math.SQRT1_2;a.dir.y=(m==0||m==3?1:-1)*Math.SQRT1_2;return true}}}}if(!n){m=f==0?-1:(j+(f>0?-h:l)-b)/f;t=g==0?-1:(k+(g>0?-i:o)-e)/g;q=Math.min(m,t);p=Math.max(m,t);if(q+ig.COLLISION.EPS>=0&&p<1){if(p<a.dist){if(a.slipX!=void 0)a.slipX=a.dir.x?f>0?1E3:-1E3:0;if(a.slipY!=void 0)a.slipY=a.dir.y?g>0?1E3:-1E3:0;a.dist=p;a.dir.x=p==m?f>0?1:-1:0;a.dir.y=
p==t?g>0?1:-1:0;if(p==m&&p==t){a.dir.x=a.dir.x*Math.SQRT1_2;a.dir.y=a.dir.y*Math.SQRT1_2}return true}}else{if(m+ig.COLLISION.EPS>=0&&m-ig.COLLISION.EPS<=a.dist){g=e+i-ig.COLLISION.SLIP_PIXELS<k||e+ig.COLLISION.SLIP_PIXELS>k+o?k-e>e+i-k-o?k-e-i:k+o-e:0;a.slipY=a.slipY!=void 0&&m+ig.COLLISION.EPS>=a.dist?a.slipY*g<=0?0:a.slipY:g;a.dist=Math.max(0,m-ig.COLLISION.EPS);a.dir.x=f>0?1:-1;a.dir.y=0;return true}if(t+ig.COLLISION.EPS>=0&&t-ig.COLLISION.EPS<=a.dist){f=b+h-ig.COLLISION.SLIP_PIXELS<j||b+ig.COLLISION.SLIP_PIXELS>
j+l?j-b>b+h-j-l?j-b-h:j+l-b:0;a.slipX=a.slipX!=void 0&&t+ig.COLLISION.EPS>=a.dist?a.slipX*f<=0?0:a.slipX:f;a.dist=Math.max(0,t-ig.COLLISION.EPS);a.dir.x=0;a.dir.y=g>0?1:-1;return true}}}return false}});ig.baked=!0;
ig.module("impact.base.tile-info").defines(function(){ig.TileInfoList=ig.SingleLoadable.extend({tiledata:null,init:function(){this.parent()},loadInternal:function(){$.ajax({dataType:"json",url:ig.root+ig.TILEINFO_FILE+ig.getCacheSuffix(),context:this,success:this.onload.bind(this),error:this.onerror.bind(this)})},onerror:function(){this.tiledata={};this.loadingFinished(true)},onload:function(b){this.tiledata=b;this.loadingFinished(true)}});ig.tileInfoList=new ig.TileInfoList;ig.TileInfo=ig.Class.extend({animatedTiles:{},
animSpeed:0.2,init:function(b){if(ig.tileInfoList.tiledata[b]){for(var b=ig.tileInfoList.tiledata[b],a=b.animations.length;a--;)for(var d=b.animations[a],c=d.length;c--;)this.animatedTiles[d[c]]=d;if(b.settings)this.animSpeed=b.settings.tileAnimSpeed||0.2}},getAnimTiles:function(b){return this.animatedTiles[b]||null}})});ig.baked=!0;
ig.module("impact.base.background-map").requires("impact.base.map","impact.base.image","impact.base.tile-info","game.config").defines(function(){var b=Vec2.create();ig.MAP.Background=ig.ChunkedMap.extend({tiles:null,tilesetName:"",tileInfo:null,hasAnimatedTiles:false,screenRender:true,lighter:false,_wm:new ig.Config({_label:"Background",_fixSize:ig.CONFIG.DISABLE_LAYER_SIZE,_noRepeat:true,_noDistance:ig.CONFIG.DISABLE_LAYER_DISTANCE,_fixTilesize:ig.CONFIG.DEFAULT_TILE_SIZE,_noMoveSpeed:true,_objectLayerSupport:true,
_lighter:true,_icon:"weltmeister/lib/map/img/layer-background-icon.png"}),init:function(a,b){this.parent(a,b);this.setTileset(a.tilesetName);this.lighter=a.lighter||false;this.checkAnimatedTiles()},clearCached:function(){this.tiles&&this.tiles.decreaseRef()},readyToDraw:function(){return this.tiles.loaded},checkAnimatedTiles:function(){this.hasAnimatedTiles=false;for(var a=0;a<this.width;a++)for(var b=0;b<this.height;b++)if(this.tileInfo.getAnimTiles(this.data[b][a])){this.hasAnimatedTiles=true;return}},
setTileset:function(a){this.tilesetName=a instanceof ig.Image?a.path:a;this.tileInfo=new ig.TileInfo(this.tilesetName);this.tiles=new ig.Image(this.tilesetName);this.preRenderedChunks=null},preRenderChunk:function(a,b,c,e,f){var c=c/this.tilesize/ig.system.scale+1,e=e/this.tilesize/ig.system.scale+1,g=a*this.chunkSizeX/ig.system.scale%this.tilesize,h=b*this.chunkSizeY/ig.system.scale%this.tilesize,a=Math.floor(a*this.chunkSizeX/this.tilesize/ig.system.scale),b=Math.floor(b*this.chunkSizeY/this.tilesize/
ig.system.scale),i=ig.system.context;ig.system.context=ig.system.getBufferContext(f);if(this.lighter)ig.system.context.globalCompositeOperation="lighter";for(var j=0;j<c;j++)for(var k=0;k<e;k++)if(j+a<this.width&&k+b<this.height){var l=this.data[k+b][j+a];l&&this.tiles.drawTile(j*this.tilesize-g,k*this.tilesize-h,l-1,this.tilesize)}if(this.lighter)ig.system.context.globalCompositeOperation="source-over";ig.system.context=i;return f},preRenderScreen:function(a,b,c,e,f,g,h){var i=this.tilesize,j=ig.system.context;
ig.system.context=a;if(this.lighter)ig.system.context.globalCompositeOperation="lighter";a=e/i;f=f/i;g=g/i;h=h/i;for(e=0;e<g;++e)for(var k=0;k<h;++k){var l=a+e,o=f+k;if(o>=this.height||o<0){if(!this.repeat)continue;o=o>0?o%this.height:(o+1)%this.height+this.height-1}if(l>=this.width||l<0){if(!this.repeat)continue;l=l>0?l%this.width:(l+1)%this.width+this.width-1}if(l=this.data[o][l]){o=this.tileInfo.getAnimTiles(l);(window.wm||!o)&&this.tiles.drawTile(e*i+b,k*i+c,l-1,i)}}if(this.lighter)ig.system.context.globalCompositeOperation=
"source-over";ig.system.context=j},drawAnimated:function(a,d,c,e){if(this.hasAnimatedTiles)for(var f=ig.system.getZoomMinOffset(b),a=a==void 0?this.scroll.x+f.x:a,d=d==void 0?this.scroll.y+f.y:d,c=c==void 0?ig.system.width/ig.system.zoom:c,e=e==void 0?ig.system.height/ig.system.zoom:e,f=Math.floor(ig.game.backgroundAnimTimer/this.tileInfo.animSpeed)%4,g=Math.floor(a/this.tilesize),h=Math.floor(d/this.tilesize),a=Math.ceil((a+c)/this.tilesize),d=Math.ceil((d+e)/this.tilesize),e=ig.perf.smoothMapRendering&&
this.distance&&this.distance!=1;h<d;++h)for(c=g;c<a;++c){var i=this.getGridTile(c,h);(i=this.tileInfo.getAnimTiles(i))&&this.tiles.drawTile(c*this.tilesize-this.scroll.x,h*this.tilesize-this.scroll.y,i[f]-1,this.tilesize,this.tilesize,false,false,null,null,null,e)}},redrawChunkTile:function(a,b,c,e){var f=ig.system.context;ig.system.context=ig.system.getBufferContext(a);a=ig.system.scale;ig.system.context.clearRect(b,c,this.tilesize*a,this.tilesize*a);e&&this.tiles.drawTile(b/a,c/a,e-1,this.tilesize);
ig.system.context=f},drawTiled:function(a,b,c,e){for(var f=0,g=(a/this.tilesize).toInt(),h=(b/this.tilesize).toInt(),a=a%this.tilesize,i=b%this.tilesize,b=-a-this.tilesize,f=-i-this.tilesize,c=c+this.tilesize-a,e=e+this.tilesize-i,a=this.tiles.getMaxTileIdx(this.tilesize),i=-1,j=f;j<e;i++,j=j+this.tilesize){var k=i+h;if(k>=this.height||k<0){if(!this.repeat)continue;k=k>0?k%this.height:(k+1)%this.height+this.height-1}for(var l=-1,o=b;o<c;l++,o=o+this.tilesize){f=l+g;if(f>=this.width||f<0){if(!this.repeat)continue;
f=f>0?f%this.width:(f+1)%this.width+this.width-1}if(f=this.data[k][f])if(f-1<a)this.tiles.drawTile(o,j,f-1,this.tilesize);else{ig.system.context.fillStyle="pink";ig.system.context.fillRect(ig.system.getDrawPos(o),ig.system.getDrawPos(j),ig.system.scale*this.tilesize,ig.system.scale*this.tilesize)}}}}});ig.MAP.MovingParallax=ig.MAP.Background.extend({_wm:new ig.Config({_label:"MovingParallax",_fixSize:false,_noRepeat:true,_noMoveSpeed:false,_noDistance:false,_fixTilesize:ig.CONFIG.DEFAULT_TILE_SIZE,
_objectLayerSupport:false,_lighter:true,_icon:"weltmeister/lib/map/img/layer-background-icon.png"}),moveTimer:0,stopped:false,init:function(a,b){this.parent(a,b);this.repeat=true},setStopped:function(a){this.stopped=a},update:function(){if(!this.stopped)this.moveTimer=this.moveTimer+ig.system.tick},setScreenPos:function(a,b){a=a-this.moveTimer*this.moveSpeed.x;b=b-this.moveTimer*this.moveSpeed.y;this.parent(a,b)}})});ig.baked=!0;
ig.module("impact.base.global-settings").requires("impact.base.loader").defines(function(){Vec2.create();ig.GlobalSettings=ig.SingleLoadable.extend({cacheType:"GlobalSettings",data:{},modified:false,init:function(){this.parent()},getGlobalSettingOptions:function(b,a){var d=this.data[b];return!d?null:d[a]||null},getGlobalSetting:function(b,a,d){b=this.getGlobalSettingOptions(b,a);return!b?null:b[d]||null},storeGlobalSetting:function(b,a,d,c){this.data[b]||(this.data[b]={});this.data[b][a]||(this.data[b][a]=
{});this.data[b][a][d]=c;this.modified=true},resolveEntitySettings:function(b,a){if(!a.__GLOBAL__)return a;var d=this.getGlobalSetting("ENTITY",b,a.__GLOBAL__),c={};ig.merge(c,d);c.name=a.name;c.mapId=a.mapId;c._globalSettingKey=a.__GLOBAL__;return c},loadInternal:function(){$.ajax({dataType:"json",url:ig.root+"data/global-settings.json"+ig.getCacheSuffix(),context:this,success:this.onload.bind(this),error:this.onerror.bind(this)})},onerror:function(){this.data={};this.loadingFinished(true)},onload:function(b){this.data=
b;this.loadingFinished(true)}});ig.globalSettings=new ig.GlobalSettings});ig.baked=!0;
ig.module("impact.base.extension").defines(function(){ig.ExtensionManager=ig.Class.extend({enabled:{},list:null,listeners:{},init:function(){},addListener:function(a,b){this.listeners[b]=a},load:function(){this.list=new ig.ExtensionList},getExtensionList:function(){var a=[],b;for(b in this.list.extensions)this.enabled[b]&&a.push(b);return a},getExtension:function(a){return!this.enabled[a]?null:this.list.get(a)},hasExtension:function(a){if(!this.enabled[a])return false;if(this.list.get(a))return true},
setExtensionEnabled:function(a,b){this.enabled[a]=b},onExtensionLoaded:function(a){var b=a.path;this.enabled[b]||(this.enabled[b]=window.IG_GAME_DEBUG?false:true);window.IG_GAME_DEBUG&&a.checkFileList();if(this.enabled[b]){window.IG_GAME_DEBUG||a.addFileForwarding();for(var b=a.entries,c=0;c<b.length;++c){var e=b[c],f=e.type;if(this.listeners[f])this.listeners[f].onExtensionLoaded(e.data,a)}}else window.IG_GAME_DEBUG&&a.addFileForwarding(true)}});ig.extensions=new ig.ExtensionManager;ig.ExtensionList=
ig.SingleLoadable.extend({extensions:{},get:function(a){return this.extensions[a]},loadInternal:function(){ig.platform==ig.PLATFORM_TYPES.DESKTOP?this.loadExtensionsNWJS():this.loadExtensionsPHP()},loadExtensionsPHP:function(){$.ajax({dataType:"json",url:ig.root+"page/api/get-extension-list.php?debug="+(window.IG_GAME_DEBUG?1:0),context:this,success:this.onExtensionListLoaded.bind(this),error:this.onExtensionListLoaded.bind(this)})},_getExtensionFolder:function(){return ig.root+(window.IG_GAME_DEBUG?
"data/extension/":"assets/extension/")},loadExtensionsNWJS:function(){var a=window.require("fs"),b=this._getExtensionFolder();a.readdir(b,this.onDirRead.bind(this))},onDirRead:function(a,b){var c=this._getExtensionFolder(),e=window.require("fs"),f=[];if(!a)for(var g=0;g<b.length;++g){var h=b[g];if(h[0]!=".")if(window.IG_GAME_DEBUG){var i=h.indexOf(".json");i!==-1&&f.push(h.substr(0,i))}else e.lstatSync(c+h).isDirectory()&&e.existsSync(c+h+"/"+h+".json")&&f.push(h)}this.onExtensionListLoaded(f)},onExtensionListLoaded:function(a){console.log("%cEXTENSIONS:%c",
"color:#339966","",a);for(var b=0;b<a.length;++b){var c=a[b];c[0]!="-"&&(this.extensions[c]=new ig.Extension(c))}this.loadingFinished(true)}});var b={};ig.Extension=ig.JsonLoadable.extend({cacheType:"Extension",files:null,entries:null,name:null,description:null,getJsonPath:function(){return window.IG_GAME_DEBUG?ig.root+"data/extension/"+this.path+".json":ig.root+"extension/"+this.path+"/"+this.path+".json"},onload:function(a){this.files=a.files||[];this.entries=a.entries||[];this.name=new ig.LangLabel(a.name);
this.description=new ig.LangLabel(a.description);ig.extensions.onExtensionLoaded(this)},checkFileList:function(){for(var a=this.files.length;a--;){var d=ig.root+this.files[a];if(b[d])throw Error("DOUBLE REFERENCE '"+d+"' referred by extensions '"+b[d]+'" & "'+this.path+"'");b[d]=this.path;$.ajax({url:d,type:"HEAD",context:{path:d,extension:this.path},success:function(){},error:function(){throw Error("WRONG REFERENCE '"+this.path+"' of extension '"+this.extension+"'");}})}},addFileForwarding:function(a){for(var b=
this.files.length;b--;){var c=this.files[b],e=ig.root+c,f=ig.root+"extension/"+this.path+"/"+c;a&&(f=ig.root+"missing-extension/"+c);ig.fileForwarding[e]=f}}})});ig.baked=!0;
ig.module("impact.base.utils").defines(function(){var b={aliceblue:"f0f8ff",antiquewhite:"faebd7",aqua:"00ffff",aquamarine:"7fffd4",azure:"f0ffff",beige:"f5f5dc",bisque:"ffe4c4",black:"000000",blanchedalmond:"ffebcd",blue:"0000ff",blueviolet:"8a2be2",brown:"a52a2a",burlywood:"deb887",cadetblue:"5f9ea0",chartreuse:"7fff00",chocolate:"d2691e",coral:"ff7f50",cornflowerblue:"6495ed",cornsilk:"fff8dc",crimson:"dc143c",cyan:"00ffff",darkblue:"00008b",darkcyan:"008b8b",darkgoldenrod:"b8860b",darkgray:"a9a9a9",
darkgreen:"006400",darkkhaki:"bdb76b",darkmagenta:"8b008b",darkolivegreen:"556b2f",darkorange:"ff8c00",darkorchid:"9932cc",darkred:"8b0000",darksalmon:"e9967a",darkseagreen:"8fbc8f",darkslateblue:"483d8b",darkslategray:"2f4f4f",darkturquoise:"00ced1",darkviolet:"9400d3",deeppink:"ff1493",deepskyblue:"00bfff",dimgray:"696969",dodgerblue:"1e90ff",feldspar:"d19275",firebrick:"b22222",floralwhite:"fffaf0",forestgreen:"228b22",fuchsia:"ff00ff",gainsboro:"dcdcdc",ghostwhite:"f8f8ff",gold:"ffd700",goldenrod:"daa520",
gray:"808080",green:"008000",greenyellow:"adff2f",honeydew:"f0fff0",hotpink:"ff69b4",indianred:"cd5c5c",indigo:"4b0082",ivory:"fffff0",khaki:"f0e68c",lavender:"e6e6fa",lavenderblush:"fff0f5",lawngreen:"7cfc00",lemonchiffon:"fffacd",lightblue:"add8e6",lightcoral:"f08080",lightcyan:"e0ffff",lightgoldenrodyellow:"fafad2",lightgrey:"d3d3d3",lightgreen:"90ee90",lightpink:"ffb6c1",lightsalmon:"ffa07a",lightseagreen:"20b2aa",lightskyblue:"87cefa",lightslateblue:"8470ff",lightslategray:"778899",lightsteelblue:"b0c4de",
lightyellow:"ffffe0",lime:"00ff00",limegreen:"32cd32",linen:"faf0e6",magenta:"ff00ff",maroon:"800000",mediumaquamarine:"66cdaa",mediumblue:"0000cd",mediumorchid:"ba55d3",mediumpurple:"9370d8",mediumseagreen:"3cb371",mediumslateblue:"7b68ee",mediumspringgreen:"00fa9a",mediumturquoise:"48d1cc",mediumvioletred:"c71585",midnightblue:"191970",mintcream:"f5fffa",mistyrose:"ffe4e1",moccasin:"ffe4b5",navajowhite:"ffdead",navy:"000080",oldlace:"fdf5e6",olive:"808000",olivedrab:"6b8e23",orange:"ffa500",orangered:"ff4500",
orchid:"da70d6",palegoldenrod:"eee8aa",palegreen:"98fb98",paleturquoise:"afeeee",palevioletred:"d87093",papayawhip:"ffefd5",peachpuff:"ffdab9",peru:"cd853f",pink:"ffc0cb",plum:"dda0dd",powderblue:"b0e0e6",purple:"800080",red:"ff0000",rosybrown:"bc8f8f",royalblue:"4169e1",saddlebrown:"8b4513",salmon:"fa8072",sandybrown:"f4a460",seagreen:"2e8b57",seashell:"fff5ee",sienna:"a0522d",silver:"c0c0c0",skyblue:"87ceeb",slateblue:"6a5acd",slategray:"708090",snow:"fffafa",springgreen:"00ff7f",steelblue:"4682b4",
tan:"d2b48c",teal:"008080",thistle:"d8bfd8",tomato:"ff6347",turquoise:"40e0d0",violet:"ee82ee",violetred:"d02090",wheat:"f5deb3",white:"ffffff",whitesmoke:"f5f5f5",yellow:"ffff00",yellowgreen:"9acd32"},a=[{re:/^rgb\((\d{1,3}),\s*(\d{1,3}),\s*(\d{1,3})\)$/,example:["rgb(123, 234, 45)","rgb(255,234,245)"],process:function(a){return[parseInt(a[1]),parseInt(a[2]),parseInt(a[3])]}},{re:/^(\w{2})(\w{2})(\w{2})$/,example:["#00ff00","336699"],process:function(a){return[parseInt(a[1],16),parseInt(a[2],16),
parseInt(a[3],16)]}},{re:/^(\w{1})(\w{1})(\w{1})$/,example:["#fb0","f0f"],process:function(a){return[parseInt(a[1]+a[1],16),parseInt(a[2]+a[2],16),parseInt(a[3]+a[3],16)]}}];ig.RGBColor=function(d){this.ok=false;if(d)if(d instanceof ig.RGBColor){this.r=d.r;this.g=d.g;this.b=d.b;this.ok=true}else{d.charAt(0)=="#"&&(d=d.substr(1,6));var d=d.replace(/ /g,""),d=d.toLowerCase(),c;for(c in b)d==c&&(d=b[c]);for(c=0;c<a.length;c++){var e=a[c].process,f=a[c].re.exec(d);if(f){e=e(f);this.r=e[0];this.g=e[1];
this.b=e[2];this.ok=true}}this.r=this.r<0||isNaN(this.r)?0:this.r>255?255:this.r;this.g=this.g<0||isNaN(this.g)?0:this.g>255?255:this.g;this.b=this.b<0||isNaN(this.b)?0:this.b>255?255:this.b}else{this.r=this.g=this.b=0;this.ok=true}};ig.RGBColor.prototype.toRGB=function(){return"rgb("+this.r+", "+this.g+", "+this.b+")"};ig.RGBColor.prototype.toHex=function(){var a=this.r.toString(16),b=this.g.toString(16),e=this.b.toString(16);a.length==1&&(a="0"+a);b.length==1&&(b="0"+b);e.length==1&&(e="0"+e);return"#"+
a+b+e};ig.RGBColor.prototype.assign=function(a){this.r=a.r;this.g=a.g;this.b=a.b;this.ok=true};ig.RGBColor.prototype.addColor=function(a,b){this.r=Math.round(Math.min(255,this.r*(1-b)+a.r*b));this.g=Math.round(Math.min(255,this.g*(1-b)+a.g*b));this.b=Math.round(Math.min(255,this.b*(1-b)+a.b*b))};ig.RGBColor.interpolate=function(a,b,e,f){f.r=Math.round(Math.min(255,a.r*(1-e)+b.r*e));f.g=Math.round(Math.min(255,a.g*(1-e)+b.g*e));f.b=Math.round(Math.min(255,a.b*(1-e)+b.b*e))};ig.UniformRNG=ig.Class.extend({lastIndex:0,
values:[],init:function(a,b){for(var e=b?a-1:a,f=0;f<a;++f)this.values.push(f/e);this.values.sort(function(){return Math.random()-0.5})},get:function(){var a=this.values.length,b=this.values[this.lastIndex],e=this.lastIndex-Math.floor(Math.random()*a*0.2);e<0&&(e=e+a);this.values[this.lastIndex]=this.values[e];this.values[e]=b;this.lastIndex=(this.lastIndex+1)%a;return b}})});ig.baked=!0;
ig.module("impact.base.dom").defines(function(){var b=new DOMParser;ig.dom={create:function(a,b,c){a=document.createElement(a);if(b)for(var e in b)a.setAttribute(e,b[e]);if(c||c===0)if(c instanceof Array)for(b=0;b<c.length;++b)a.appendChild(c[b][0]);else c instanceof jQuery?a.appendChild(c[0]):a.textContent=c.toString();return $(a)},html:function(a){var d=b.parseFromString(a,"text/html");return!d?$(a):$(d.body.firstChild)},append:function(a,b){a[0].appendChild(b[0])},prepend:function(a,b){a[0].insertBefore(b[0],
a[0].firstChild)},before:function(a,b){a[0].parentElement.insertBefore(b[0],a[0])},bind:function(a,b,c){if(a&&a.length)return a[0].addEventListener(b,c)}};ig.dom=ig.dom;ig.dom.create=ig.dom.create;ig.dom.html=ig.dom.html;ig.dom.append=ig.dom.append;ig.dom.prepend=ig.dom.prepend;ig.dom.before=ig.dom.before;ig.dom.bind=ig.dom.bind});ig.baked=!0;
ig.module("impact.base.game").requires("impact.base.impact","impact.base.entity","impact.base.event","impact.base.renderer","impact.base.physics","impact.base.game-state","impact.base.collision-map","impact.base.background-map","impact.base.global-settings","impact.base.extension","impact.base.utils","impact.base.dom").defines(function(){Vec2.create();Vec2.create();Vec2.create();window.IG_ENTITY_KILL_CALL=false;ig.Game=ig.Class.extend({clearColor:"#000008",gravity:0,screen:{x:0,y:0},soundPos:{x:0,
y:0},size:{x:0,y:0},paused:false,mapRenderingBlocked:false,isReset:false,shadowImage:null,previousMap:null,mapName:null,currentLoadingResource:"",entities:[],mapEntities:[],shownEntities:[],freeEntityIds:[],namedEntities:{},conditionalEntities:[],maps:[],levels:{},maxLevel:0,minLevelZ:0,masterLevel:0,backgroundAnims:{},backgroundAnimTimer:0,cellSize:64,events:new ig.EventManager,renderer:new ig.Renderer2d,physics:new ig.Physics,_deferredDetach:[],_levelToLoad:null,playerEntity:null,marker:"",postPlacementAction:null,
teleporting:{active:false,timer:0,position:null,clearCache:false,reloadCache:false,levelData:null},addons:{all:[],levelLoadStart:[],levelLoaded:[],teleport:[],preUpdate:[],postUpdate:[],deferredUpdate:[],preDraw:[],midDraw:[],postDraw:[],varsChanged:[],reset:[],windowFocusChanged:[]},states:[],staticInstantiate:function(){ig.game=this;return null},init:function(){this.addons.all=ig.initGameAddons();for(var b=0;b<this.addons.all.length;++b){var a=this.addons.all[b];a.onLevelLoadStart&&this.addons.levelLoadStart.push(a);
a.onLevelLoaded&&this.addons.levelLoaded.push(a);a.onTeleport&&this.addons.teleport.push(a);a.onPreUpdate&&this.addons.preUpdate.push(a);a.onPostUpdate&&this.addons.postUpdate.push(a);a.onDeferredUpdate&&this.addons.deferredUpdate.push(a);a.onPreDraw&&this.addons.preDraw.push(a);a.onMidDraw&&this.addons.midDraw.push(a);a.onPostDraw&&this.addons.postDraw.push(a);a.onVarsChanged&&this.addons.varsChanged.push(a);a.onReset&&this.addons.reset.push(a);a.onWindowFocusChanged&&this.addons.windowFocusChanged.push(a)}this.addons.levelLoadStart.sort(function(a,
b){return a.levelLoadStartOrder-b.levelLoadStartOrder});this.addons.levelLoaded.sort(function(a,b){return a.levelLoadedOrder-b.levelLoadedOrder});this.addons.teleport.sort(function(a,b){return a.teleportOrder-b.teleportOrder});this.addons.preUpdate.sort(function(a,b){return a.preUpdateOrder-b.preUpdateOrder});this.addons.postUpdate.sort(function(a,b){return a.postUpdateOrder-b.postUpdateOrder});this.addons.deferredUpdate.sort(function(a,b){return a.deferredUpdateOrder-b.deferredUpdateOrder});this.addons.preDraw.sort(function(a,
b){return a.preDrawOrder-b.preDrawOrder});this.addons.midDraw.sort(function(a,b){return a.midDrawOrder-b.midDrawOrder});this.addons.postDraw.sort(function(a,b){return a.postDrawOrder-b.postDrawOrder});this.addons.varsChanged.sort(function(a,b){return a.varsChangedOrder-b.varsChangedOrder});this.addons.reset.sort(function(a,b){return a.resetOrder-b.resetOrder});this.addons.windowFocusChanged.sort(function(a,b){return a.windowFocusOrder-b.windowFocusOrder});b=new ig.GameState;b.initFromGame(this);this.states.push(b);
ig.extensions.load();ig.vars&&ig.vars.registerVarAccessor("game",this)},pushState:function(b){this.states.last().onEnd(this);this.states.push(b);b.onStart(this)},popState:function(){if(!(this.states.length<=1)){this.states.pop().onEnd(this);this.states.last().onStart(this)}},printGameAddonsString:function(){console.groupCollapsed("GameAddons: ");for(var b in this.addons)if(this.addons[b]&&this.addons[b]!=this.addons.all){var a=b.charAt(0).toUpperCase()+b.substring(1);console.groupCollapsed(a+"Order: ");
this.printGameAddonsStringFromArray(this.addons[b],b+"Order");console.groupEnd()}console.groupEnd()},printGameAddonsStringFromArray:function(b,a){for(var d=0;d<b.length;d++)console.log(b[d].name+": %c"+b[d].__proto__[a],"color:#149AEB")},getLevelIdx:function(b){for(var a=ig.game.maxLevel;a--&&ig.game.levels[a].height>b;);a<0&&(a=-1);return a},getLevelHeight:function(b){return b==-1?this.levels[0].height-1:this.levels[b].height},getHeightFromLevelOffset:function(b){return this.getLevelHeight(b.offset?
b.level:b)+(b.offset||0)},getEntityByName:function(b){return this.namedEntities[b]},getEntityByMapId:function(b){return this.mapEntities[b]},swapNamedEntities:function(b,a){var d=b.name,c=a.name;a.name=d;b.name=c;d&&(this.namedEntities[d]=a);c&&(this.namedEntities[c]=b)},getEntityCount:function(){return this.shownEntities.length-this.freeEntityIds.length-1},getObjectMaps:function(b){return[this.levels[b].maps[0]]},isMapTileEmpty:function(b,a){for(var d=ig.game.maxLevel;d--;)for(var c=this.levels[d].maps,
e=c.length;e--;){var f=c[e];if(f instanceof ig.MAP.Background){var g=f.getTile(b,a);if(g)return ig.terrain.getTerrainOfMapTile(f,g)==ig.TERRAIN.NOTHING}}return true},getEntitiesInRectangle:function(b,a,d,c,e,f,g,h){return this.physics.getEntitiesInRectangle(b,a,d,c,e,f,g,h)},getOverlapEntities:function(b){var a=b.coll;return this.physics.getEntitiesInRectangle(a.pos.x,a.pos.y,a.pos.z,a.size.x,a.size.y,a.size.z,b)},getEntitiesInCircle:function(b,a,d,c,e,f,g,h,i,j,k){return this.physics.getEntitiesInCircle(b,
a,d,c,e,f,g,h,i,j,k)},getEntitiesByType:function(b){for(var b=typeof b==="string"?ig.ENTITY[b]:b,a=[],d=0;d<this.shownEntities.length;d++){var c=this.shownEntities[d];c instanceof b&&!c._killed&&a.push(c)}return a},getEntitiesOnTop:function(b){for(var a=[],d=0;d<this.shownEntities.length;++d){var c=this.shownEntities[d];c&&(c.coll._collData&&c.coll._collData.groundEntry==b.coll)&&a.push(c)}return a},isInterruptible:function(){return this.events.isInterruptible()&&this.isEventStartReady()},isEventStartReady:function(){return true},
isPlayerTouch:function(b,a,d){if(a!=this.playerEntity||this.events.getBlockingEventCall()||!d)return false;b=a.coll;return Math.abs(d.x)>Math.abs(d.y)?d.x>0&&b.accelDir.x>0||d.x<0&&b.accelDir.x<0:d.y>0&&b.accelDir.y>0||d.y<0&&b.accelDir.y<0},isControlBlocked:function(){var b=this.events.getBlockingEventCall();return this.teleporting.active||(b?b.runType==ig.EventRunType.BLOCKING:false)},getErrorData:function(){},onExternalMessageReceived:function(b,a){for(var a=a&&JSON.parse(a),d=this.entities.length;d--;){var c=
this.entities[d];if(c&&c.onExternalMessage)c.onExternalMessage(b,a)}},sendExternalMessage:function(b,a){a=JSON.stringify(a);window.parent&&window.parent.EXTERNAL_IG_MESSAGE&&window.parent.EXTERNAL_IG_MESSAGE(b,a)},setWindowFocus:function(b){for(var a=0;a<this.addons.windowFocusChanged.length;++a)this.addons.windowFocusChanged[a].onWindowFocusChanged(b)},setPaused:function(b){if(this.paused!=b)(this.paused=b)?ig.soundManager.pushPaused():ig.soundManager.popPaused()},spawnEntity:function(b,a,d,c,e,
f){var g;if(typeof b==="string"){g=ig.ENTITY[b];e=ig.globalSettings.resolveEntitySettings(b,e)}else g=b;if(!g)throw Error("Can't spawn entity of type "+b);g=new g(a,d,c,e||{});if(g._killed)return null;g.initSprites();g.name&&(this.namedEntities[g.name]=g);this.entities.push(g);g.mapId&&(this.mapEntities[g.mapId]=g);if(e&&e.spawnCondition){var h=new ig.VarCondition(e.spawnCondition);this.conditionalEntities.push({condition:h,type:b,x:a,y:d,z:c,settings:e,entity:g});if(!h.evaluate())return null}g.show(!f);
return g},showEntity:function(b){b._hideRequest=false;if(b._hidden){var a=this._deferredDetach.indexOf(b);if(a!=-1)this._deferredDetach.splice(a,1);else{a=0;if(this.freeEntityIds.length>0){a=this.freeEntityIds.pop();if(this.shownEntities[a])throw Error("Overriding Entity that is already set!");this.shownEntities[a]=b}else{a=this.shownEntities.length;this.shownEntities.push(b)}b.id=a}b._hidden=false;this.physics.addCollEntry(b.coll)}},hideEntity:function(b){if(!b._hidden){b._hidden=true;this.detachEntity(b)}},
requestEntityHide:function(b){b._hideRequest=true;if(b.onHideRequest)b.onHideRequest();else b.hide()},removeEntity:function(b){b.name&&delete this.namedEntities[b.name];b._killed=b.coll._killed=true;this.detachEntity(b)},detachEntity:function(b){if(!b._killed&&!b._hidden)throw Error("Tried to remove entity that is not hidden or killed");(b._killed||b.id!=0)&&this._deferredDetach.push(b)},onVarAccess:function(b,a){if(a[1]=="marker")return this.marker},reset:function(){this.isReset=true;this.clearMap();
ig.vars.clear();ig.soundManager.reset();for(var b=0;b<this.addons.reset.length;++b)this.addons.reset[b].onReset();this.isReset=false},teleport:function(b,a,d,c,e){this.previousMap=this.mapName;this.mapName=b;this.marker=a?a.marker:null;this.teleporting.position=a;this.teleporting.active=true;this.teleporting.timer=this.onTeleportStart(b,a,d);this.teleporting.clearCache=c||false;this.teleporting.reloadCache=e||false;this.events.clearQueue();for(c=0;c<this.addons.teleport.length;++c)this.addons.teleport[c].onTeleport(b,
a,d);this.preloadLevel(b)},isTeleporting:function(){return this.teleporting.active},onTeleportStart:function(){return 0},onTeleportEnd:function(){},createPlayer:function(){},getVersion:function(){return"???"},preloadLevel:function(b){this.teleporting.levelData=null;this.currentLoadingResource="LOADING MAP: "+b;window.IS_IT_CUBAUM=Math.random()<(sc.gameCode.isEnabled("regularTrees")?1:1E-4);var a=b.toPath(ig.root+"data/maps/",".json")+ig.getCacheSuffix();$.ajax({dataType:"json",url:ig.getFilePath(a),
context:this,success:function(a){this.teleporting.levelData=a},error:function(b,c,e){ig.system.error(Error("Loading of Map '"+a+"' failed: "+b+" / "+c+" / "+e))}})},clearMap:function(b){this.screen={x:0,y:0};for(var a=this.entities.length;a--;){this.entities[a]&&this.entities[a].kill(true);if(this.entities[a]&&!this.entities[a]._killed)throw Error("Entity of id "+this.entities[a].id+" was not properly killed");}for(a=0;a<this.maps.length;++a){this.maps[a].clear();this.maps[a].clearCached&&this.maps[a].clearCached()}this.maps.length=
0;this.levels={};this.minLevelZ=this.maxLevel=0;this.events.clear();this.entities.length=0;this.mapEntities.length=0;this.shownEntities=[null];this._deferredDetach.length=0;this.freeEntityIds.length=0;this.conditionalEntities.length=0;this.renderer.mapCleared();this.physics.mapCleared();this.namedEntities={};if(window.nwf){window.nwf.system.Memory.forceGC();ig.log("Force GC!")}b&&ig.cleanCache(true)},loadLevel:function(b,a,d){this.currentLoadingResource="CREATING MAP:  "+b.name;this.clearMap(a);ig.imageAtlas.defragment();
ig.ready=false;d&&ig.reloadCache(true);ig.vars.onLevelChange(b.name);for(a=0;a<this.addons.levelLoadStart.length;++a)this.addons.levelLoadStart[a].onLevelLoadStart(b);this.levels={};this.minLevelZ=1E5;this.maxLevel=b.levels.length;this.levels.first={maps:[]};for(a=0;a<b.levels.length;a++){this.minLevelZ=Math.min(this.minLevelZ,b.levels[a].height);this.levels[""+a]={height:b.levels[a].height,collision:ig.MAP.Collision.staticNoCollision,maps:[]};d=b.levels}this.levels.last={maps:[]};this.levels.light=
{maps:[]};this.levels.postlight={maps:[]};this.levels.object1={maps:[]};this.levels.object2={maps:[]};this.levels.object3={maps:[]};this.masterLevel=b.masterLevel?b.masterLevel.limit(0,this.maxLevel-1):0;for(var c=0,e=0,a=0;a<b.layer.length;a++){var f=b.layer[a],d=f.level||0;if(!f.distance||f.distance==1){c=Math.max(c,f.tilesize*f.width);e=Math.max(e,f.tilesize*f.height)}var g=new ig.MAP[f.type](f,this.levels[d].height);this.maps.push(g);ig.MAP[f.type].levelKey?this.levels[d][ig.MAP[f.type].levelKey]=
g:this.levels[d].maps.push(g)}this.size.x=c;this.size.y=e;this.physics.mapLoaded();for(a=0;a<b.entities.length;a++){d=b.entities[a];c=this.getHeightFromLevelOffset(d.level);this.spawnEntity(d.type,d.x,d.y,c,d.settings)}this.createPlayer();a=this.teleporting.position;c=b=null;if(this.playerEntity)if(!a||a.marker){if(ig.ENTITY.Marker){for(a=0;a<this.shownEntities.length;++a)if((d=this.shownEntities[a])&&d.applyMarkerPosition){if(d.name==this.marker){b=d;break}c||(c=d)}b||(b=c)}if(b&&this.playerEntity){this.marker=
b.name;b.applyMarkerPosition(this.playerEntity)}}else{this.marker=null;this.playerEntity.coll.level=a.level;this.playerEntity.coll.baseZPos=a.baseZPos;this.playerEntity.coll.pos.z=a.pos.z;this.playerEntity.face.x=a.face.x;this.playerEntity.face.y=a.face.y;this.playerEntity.setPos(a.pos.x+a.size.x/2-this.playerEntity.coll.size.x/2,a.pos.y+a.size.y/2-this.playerEntity.coll.size.y/2)}ig.ready=true;b=new (this.mapLoader||ig.Loader);b.load();this.currentLoadingResource=b},loadingComplete:function(){this.teleporting.active=
false;this.playerEntity&&this.playerEntity.onPlayerPlaced&&this.playerEntity.onPlayerPlaced();if(this.postPlacementAction){this.postPlacementAction.onPostPlacementAction(this.playerEntity);this.postPlacementAction=null}this.preDrawMaps();var b=null;if(this.levels[this.masterLevel].collision){this.levels[this.masterLevel].collision.prepare(null);b=this.levels[this.masterLevel].collision}for(var a=this.masterLevel+1;a<this.maxLevel;++a){var d=this.levels[a];if(d.collision.prepare){d.collision.prepare(b,
b?(d.height-this.levels[a-1].height)/16:0);b=d.collision}else b=null}b=this.levels[this.masterLevel].collision?this.levels[this.masterLevel].collision:null;for(a=this.masterLevel-1;a>=0;--a){d=this.levels[a];if(d.collision.prepare){d.collision.prepare(b,b?(d.height-this.levels[a+1].height)/16:0);b=d.collision}else b=null}for(b=0;b<this.addons.levelLoaded.length;++b)this.addons.levelLoaded[b].onLevelLoaded(this);ig.cleanCache();if(window.nwf){window.nwf.system.Memory.requestGC();window.nwf.system.Memory.forceGC();
window.nwf.system.Memory.clearCaches();ig.log("Image Buffer Count: "+window.nwf.system.Stats.imageBufferCount);window.nwf.system.Stats.getMemoryStats(true)}},hasLightLayer:function(){return this.levels.light&&this.levels.light.maps.length>0},preDrawMaps:function(){for(var b=0;b<this.maxLevel;++b)this.preDrawLevel(b);this.preDrawLevel("first");this.preDrawLevel("last");this.preDrawLevel("light");this.preDrawLevel("postlight");this.preDrawLevel("object1",true);this.preDrawLevel("object2",true);this.preDrawLevel("object3",
true)},preDrawLevel:function(b,a){for(var d=null,c=null,e=this.levels[b],f=0;f<e.maps.length;++f){var g=e.maps[f];if(g.preRender){var h=e.maps[f-1];if(!h||g.noMerge||g.width!=h.width||g.height!=h.height||g.moveSpeed.x!=h.moveSpeed.x||g.moveSpeed.y!=h.moveSpeed.y)c=d=null;if(g.screenRender&&!a){c||(c=new ig.ScreenBuffer(g));g.screenBuffer=c}else d=g.preRenderMapToChunks(d);if(g.noMerge)c=d=null}else c=d=null}ig.ScreenBufferPool.reduceFreeBuffers(1)},run:function(){if(ig.system.hasFocusLost()&&this.fullyStopped)ig.soundManager.update();
else{this.fullyStopped=false;var b=ig.system.context;ig.system.context=null;if(ig.perf.update){var a=ig.system.actualTick,d=a;for(this.firstUpdateLoop=true;d>0;){ig.system.actualTick=Math.min(0.05,d);ig.system.tick=ig.system.actualTick*ig.system.timeFactor;this.update();this.firstUpdateLoop=false;d=d-ig.system.actualTick}ig.system.actualTick=a;ig.system.tick=ig.system.actualTick*ig.system.timeFactor}this.firstUpdateLoop=true;ig.perf.deferredUpdate&&this.deferredUpdate();ig.input.clearPressed();ig.soundManager.update();
ig.system.context=b;if(ig.perf.draw){this.draw();this.finalDraw()}}},update:function(){for(var b=0;b<this.addons.preUpdate.length;++b)this.addons.preUpdate[b].onPreUpdate();if(!this.paused&&!ig.loading){if(this.teleporting.timer>0){this.teleporting.timer=this.teleporting.timer-ig.system.actualTick;if(this.teleporting.timer<=0)this.onTeleportEnd()}if(this.teleporting.timer<=0&&this.teleporting.levelData){this.loadLevel(this.teleporting.levelData,this.teleporting.clearCache,this.teleporting.reloadCache);
this.teleporting.levelData=null;this.teleporting.clearCache=false;if(ig.loading)return}}if(this._deferredVarChanged){this.varsChanged();this._deferredVarChanged=false}if(!this.paused&&!ig.loading){this.physics.update();this.backgroundAnimTimer=this.backgroundAnimTimer+ig.system.tick;for(var a in this.backgroundAnims){var b=this.backgroundAnims[a],d;for(d in b)b[d].update()}}ig.loading||this.events.update();for(b=0;b<this.addons.postUpdate.length;++b)this.addons.postUpdate[b].onPostUpdate()},deferredUpdate:function(){this.deferredMapEntityUpdate();
for(var b=0;b<this.addons.deferredUpdate.length;++b)this.addons.deferredUpdate[b].onDeferredUpdate()},deferredMapEntityUpdate:function(){ig.system.ingameTick=ig.system.tick;if(!this.paused&&!ig.loading){for(var b=this.physics.collUpdateList,a=0;a<b.length;a++){var d=b[a].entity;if(d&&!d._killed){ig.system.tick=d.coll.getTick(false);if(d.deferredUpdate){ig.vars.pushEntityAccessor(d);d.deferredUpdate();ig.vars.popEntityAccessor(d)}ig.system.tick=ig.system.ingameTick}}for(var c in this.levels)for(a=
0;a<this.levels[c].maps.length;a++){d=this.levels[c].maps[a];d.update&&d.update()}}for(a=0;a<this._deferredDetach.length;a++)if(d=this._deferredDetach[a]){if(!d._hidden&&!d._killed)throw Error("Detaching an Entity that is neither killed nor hidden! Entity Name: "+d.name);if(d.id){this.physics.removeCollEntry(d.coll);this.shownEntities[d.id]=null;this.freeEntityIds.push(d.id);d.id=0}if(d._killed){c=this.entities.indexOf(d);if(c!=-1){this.entities.splice(c,1);d.erase()}}}this._deferredDetach.length=
0},draw:function(){for(var b in this.levels)for(var a=0;a<this.levels[b].maps.length;a++)this.levels[b].maps[a].setScreenPos(this.screen.x,this.screen.y);for(b=0;b<this.addons.preDraw.length;++b)this.addons.preDraw[b].onPreDraw();ig.system.startZoomedDraw();this.renderer.prepareDraw(this.shownEntities);this.renderer.drawLayers();for(b=0;b<this.addons.midDraw.length;++b)this.addons.midDraw[b].onMidDraw();this.renderer.drawPostLayerSprites();ig.system.endZoomedDraw();for(b=0;b<this.addons.postDraw.length;++b)this.addons.postDraw[b].onPostDraw()},
finalDraw:function(){if(ig.system.hasFocusLost()){ig.system.clear("rgba(0,0,0,0.6)");this.fullyStopped=true}},varsChanged:function(){for(var b=this.conditionalEntities.length;b--;){var a=this.conditionalEntities[b];if(a._killed)this.conditionalEntities.splice(b,1);else{var d=a.condition.evaluate();a.entity._hideRequest&&d?a.entity.show():!a.entity._hideRequest&&!d&&ig.game.requestEntityHide(a.entity)}}for(b=0;b<this.entities.length;b++)this.entities[b]&&this.entities[b].varsChanged&&this.entities[b].varsChanged();
for(b=0;b<this.addons.varsChanged.length;++b)this.addons.varsChanged[b].onVarsChanged()},varsChangedDeferred:function(){this._deferredVarChanged=true},isAreaBlocked:function(b,a,d,c,e,f,g){var h=ig.game.getLevelIdx(d),h=ig.game.levels[h];if(!h||!h.collision)return false;if(h.collision.isTileAreaBlocked(b,a-h.height,c,e))return true;if(g){d=this.physics.getEntitiesInRectangle(b,a,d,c,e,f,void 0,void 0,true);for(f=d.length;f--;){g=d[f].coll;if(g.type==ig.COLLTYPE.BLOCK||g.type==ig.COLLTYPE.FENCE)if(g.shape==
ig.COLLSHAPE.RECTANGLE||ig.CollMapTools.isTriangleOverlap(g.pos.x+g.size.x/2,g.pos.y+g.size.y/2,g.shape,b,a,c,e))return true}}return false},isOverHole:function(b,a,d,c,e,f,g){var h=ig.game.getLevelIdx(d),h=ig.game.levels[h];if(!h||!h.collision||(!g||d-h.height<=ig.COLLISION.HEIGHT_TOLERATE)&&!h.collision.isOverHole(b,a-h.height,c,e))return false;if(f){f=this.physics.getEntitiesInRectangle(b,a,d-4,c,e,4);for(g=f.length;g--;){h=f[g].coll;if((h.type==ig.COLLTYPE.BLOCK||h.type==ig.COLLTYPE.FENCE)&&!(h.pos.z+
h.size.z>d+ig.COLLISION.HEIGHT_TOLERATE))if(h.shape==ig.COLLSHAPE.RECTANGLE||ig.CollMapTools.isTriangleOverlap(h.pos.x+h.size.x/2,h.pos.y+h.size.y/2,h.shape,b,a,c,e))return false}}return true},traceEntity:function(b,a,d,c,e,f,g,h,i,j,k){j===void 0&&(j=a);return this.trace(b,a.coll.pos.x+(e||0),a.coll.pos.y+(f||0),a.coll.pos.z+(g||0),d,c,a.coll.size.x,a.coll.size.y,a.coll.size.z-(k||0),h||a.coll.type,j,i||null)},trace:function(b,a,d,c,e,f,g,h,i,j,k,l,o){return this.physics.trace(b,a,d,c,e,f,g,h,i,
j,k&&k.coll,l,o)}});ig.GameAddon=ig.Class.extend({levelLoadStartOrder:0,levelLoadedOrder:0,teleportOrder:0,preUpdateOrder:0,postUpdateOrder:0,deferredUpdateOrder:0,preDrawOrder:0,midDrawOrder:0,postDrawOrder:0,resetOrder:0,varsChangedOrder:0,windowFocusOrder:0,name:"game_addon",onLevelLoadStart:null,onLevelLoaded:null,onTeleport:null,onPreUpdate:null,onPostUpdate:null,onDeferredUpdate:null,onPreDraw:null,onMidDraw:null,onPostDraw:null,onReset:null,onVarsChanged:null,onWindowFocusChanged:null,init:function(b){this.name=
b!=void 0?b:"game_addon"}});ig.TeleportPosition=ig.Class.extend({pos:null,face:null,marker:null,level:0,baseZPos:0,size:{x:0,y:0},init:function(b){this.marker=b||null},setFromData:function(b,a,d,c,e,f){this.marker=b||null;this.pos=a||null;this.face=d||null;this.level=c||0;this.baseZPos=e||0;this.size=f},setFromJson:function(b){this.setFromData(b.marker,b.pos,b.face,b.level,b.baseZPos,b.size)},getJson:function(){return{marker:this.marker,pos:ig.copy(this.pos),face:this.face,level:this.level,baseZPos:this.baseZPos,
size:ig.copy(this.size)}}});ig.TeleportPosition.createFromJson=function(b){if(!b||!b.marker&&(!b.pos||!b.size||!b.face))return null;var a=new ig.TeleportPosition;a.setFromJson(b);return a}});window.sc||(window.sc={},window.sc=window.sc);ig.baked=!0;
ig.module("game.loader").requires("impact.base.timer","impact.base.loader").defines(function(){sc.StartLoader=ig.Loader.extend({timer:new ig.Timer,endTimer:0,draw:function(){this._drawStatus=this._drawStatus+(this.status-this._drawStatus)/5;var b=ig.system.width*0.6,a=ig.system.height*0.5-4,d=ig.system.width*0.5-b/2;ig.system.context.fillStyle="#000";ig.system.context.fillRect(0,0,ig.system.contextWidth,ig.system.contextHeight);this._drawBar(d,a,b,8,this._drawStatus,this.prevResourcesCnt);if(window.IG_GAME_DEBUG){ig.system.context.fillStyle=
"#fff";ig.system.context.fillText(this.lastPath,ig.system.width/2-ig.system.context.measureText(this.lastPath).width/2,a+20)}ig.Timer.step();b=this.timer.tick();if(this.endTimer>0){this.endTimer=this.endTimer-b;ig.system.context.fillStyle="#000";ig.system.context.globalAlpha=Math.min(1,1-this.endTimer/0.3);ig.system.context.fillRect(0,0,ig.system.contextWidth,ig.system.contextHeight);ig.system.context.globalAlpha=1;this.endTimer<=0&&this.finalize()}},_drawBar:function(b,a,d,c,e,f){var g=ig.system.scale;
ig.system.context.fillStyle="#56607b";ig.system.context.fillRect(b*g,a*g,d*g,c*g);ig.system.context.fillStyle="#000";ig.system.context.fillRect(b*g+g,a*g+g,d*g-g-g,c*g-g-g);ig.system.context.fillStyle="#aaf";if(f){ig.system.context.fillRect((b+2)*g,(a+2)*g,(d-4)*g,(c-4)*g);ig.system.context.fillStyle="#fff"}ig.system.context.fillRect((b+2)*g,(a+2)*g,(d-4)*g*e,(c-4)*g)},onEnd:function(){this.gameObjectCreated?this.endTimer=0.3:this.finalize()}})});ig.baked=!0;
ig.module("game.constants").defines(function(){window.Constants=window.Constants={BALL_HEIGHT:12,BALL_SIZE:8,BALL_Z_HEIGHT:8}});ig.baked=!0;
ig.module("impact.feature.database.database").requires("impact.base.loader","game.config").defines(function(){ig.Database=ig.SingleLoadable.extend({cacheType:"Database",data:null,entries:{},init:function(){if(!ig.TERRAIN)return ig.warn("No DATABASE specified. Please create ig.DATABASE in game.config");if(!ig.TERRAIN_FILE)return ig.warn("Can't initialize database because no ig.DATABASE_FILE was provided");this.parent()},register:function(b,a,d,c){this.entries[b]={editor:a,displayName:d||b};if(c)this.entries[b].external=
{path:c.path||null,data:c.data}},get:function(b){return this.data[b]},loadInternal:function(){$.ajax({dataType:"json",url:ig.root+ig.DATABASE_FILE+ig.getCacheSuffix(),context:this,success:this.onload.bind(this),error:this.onerror.bind(this)})},onerror:function(b){this.data={error:b};this.loadingFinished(true)},onload:function(b){this.data=b;this.loadingFinished(true);ig.JSON_LOG&&ig.log("%cLOADABLE: %cLoaded Database: \n%O","color:#149AEB","",b)}});ig.database=new ig.Database});ig.baked=!0;ig.module("impact.feature.database.plug-in").requires("impact.feature.database.database").defines(function(){});
ig.baked=!0;
ig.module("impact.feature.gamepad.gamepad").requires("impact.base.game","impact.base.vars").defines(function(){ig.GamepadPlatform={NWF:"nwf",WEBKIT:"webkit",unsupported:"nope"};ig.GamepadType={NWF:"nwf",XBOX:"xbox",UNSUPPORTED:"nope"};ig.BUTTONS={FACE0:0,FACE1:1,FACE2:2,FACE3:3,LEFT_SHOULDER:4,RIGHT_SHOULDER:5,LEFT_TRIGGER:6,RIGHT_TRIGGER:7,SELECT:8,START:9,LEFT_STICK:10,RIGHT_STICK:11,DPAD_UP:12,DPAD_DOWN:13,DPAD_LEFT:14,DPAD_RIGHT:15};ig.AXES={LEFT_STICK_X:0,LEFT_STICK_Y:1,RIGHT_STICK_X:2,RIGHT_STICK_Y:3};
ig.GamepadManager=ig.GameAddon.extend({gamepads:{},activeGamepads:[],handlers:[],init:function(){this.parent("Gamepads");for(var a=0;a<b.length;++a){var d=b[a]();d&&this.handlers.push(d)}},preUpdateOrder:0,onPreUpdate:function(){if(!this.isSupported()||!this.handlers.length)return false;this.activeGamepads=[];for(var a=this.handlers.length;a--;)this.handlers[a].update(this.gamepads);for(var b in this.gamepads)this.activeGamepads.push(this.gamepads[b]);if(this.isLeftStickDown()||this.isRightStickDown()){ig.input.mouseGuiActive=
false;ig.input.currentDevice=ig.INPUT_DEVICES.GAMEPAD}ig.vars.set("gamepad.active",ig.input.currentDevice==ig.INPUT_DEVICES.GAMEPAD)},deferredUpdateOrder:9001,onDeferredUpdate:function(){this.isSupported()},isButtonPressed:function(a){if(!ig.game.firstUpdateLoop)return false;for(var b=this.activeGamepads.length;b--;)if(this.activeGamepads[b].pressedStates[a])return true;return false},isButtonReleased:function(a){if(!ig.game.firstUpdateLoop)return false;for(var b=this.activeGamepads.length;b--;)if(this.activeGamepads[b].releasedStates[a])return true;
return false},isButtonDown:function(a){for(var b=this.activeGamepads.length;b--;){var c=this.activeGamepads[b];if(c.buttonStates[a]>(c.buttonDeadzones[a]||0.5))return true}return false},getButtonValue:function(a){for(var b=this.activeGamepads.length;b--;){var c=this.activeGamepads[b].buttonStates[a];if(c)return c}return 0},getAxesValue:function(a,b){for(var c=this.activeGamepads.length,e=0;c--;){var f=this.activeGamepads[c],g=f.axesStates[a];if(g){if(b){f=f.axesDeadzones[a]||0.1;if(Math.abs(g)<=f)continue}Math.abs(e)<
Math.abs(g)&&(e=g)}}return e},isAxesDown:function(a){for(var b=this.activeGamepads.length;b--;){var c=this.activeGamepads[b],e=c.axesDeadzones[a]||0.1;if(Math.abs(c.axesStates[a])>e)return true}return false},isLeftStickDown:function(){return this.isAxesDown(ig.AXES.LEFT_STICK_X)||this.isAxesDown(ig.AXES.LEFT_STICK_Y)},isRightStickDown:function(){return this.isAxesDown(ig.AXES.RIGHT_STICK_X)||this.isAxesDown(ig.AXES.RIGHT_STICK_Y)},isSupported:function(){return this.handlers.length>0}});var b=[];ig.GamepadManager.addHandlerCheck=
function(a){b.push(a)};ig.Gamepad=ig.Class.extend({buttonDeadzones:[],axesDeadzones:[],buttonStates:[],axesStates:[],pressedStates:[],releasedStates:[],init:function(){},updateButton:function(a,b){var c=this.buttonDeadzones[a]||0.5,e=this.buttonStates[a]>c,c=b>c;this.pressedStates[a]=this.releasedStates[a]=false;!e&&c?this.pressedStates[a]=true:e&&!c&&(this.releasedStates[a]=true);this.buttonStates[a]=b;if(c){ig.input.mouseGuiActive=false;ig.input.currentDevice=ig.INPUT_DEVICES.GAMEPAD}},updateAxes:function(a,
b){this.axesStates[a]=b}});ig.addGameAddon(function(){return ig.gamepad=new ig.GamepadManager})});ig.baked=!0;
ig.module("impact.feature.gamepad.html5-gamepad").requires("impact.feature.gamepad.gamepad").defines(function(){ig.Html5GamepadHandler=ig.Class.extend({init:function(){},update:function(d){var c=navigator.getGamepads&&navigator.getGamepads()||navigator.webkitGetGamepads&&navigator.webkitGetGamepads()||navigator.webkitGamepads;if(c)for(var e=0;e<c.length;e++){var f;c[e]&&(f=c[e]);var g="html5Pad"+e;if(f){if(!d[g]){var h=d,i=g,j=new ig.Gamepad;j.buttonDeadzones[ig.BUTTONS.LEFT_TRIGGER]=30/255;j.buttonDeadzones[ig.BUTTONS.RIGHT_TRIGGER]=
30/255;j.axesDeadzones[ig.AXES.LEFT_STICK_X]=7849/32767;j.axesDeadzones[ig.AXES.LEFT_STICK_Y]=7849/32767;j.axesDeadzones[ig.AXES.RIGHT_STICK_X]=8689/32767;j.axesDeadzones[ig.AXES.RIGHT_STICK_Y]=8689/32767;h[i]=j}g=d[g];h=f;j=void 0;for(j in b){i=h.buttons[b[j]];i instanceof Object?g.updateButton(j,i.value):g.updateButton(j,i)}j=void 0;for(j in a){i=h.axes[a[j]];g.updateAxes(j,i)}}else delete d[g]}}});var b={},a={};b[ig.BUTTONS.FACE0]=0;b[ig.BUTTONS.FACE1]=1;b[ig.BUTTONS.FACE2]=2;b[ig.BUTTONS.FACE3]=
3;b[ig.BUTTONS.LEFT_SHOULDER]=4;b[ig.BUTTONS.RIGHT_SHOULDER]=5;b[ig.BUTTONS.LEFT_TRIGGER]=6;b[ig.BUTTONS.RIGHT_TRIGGER]=7;b[ig.BUTTONS.SELECT]=8;b[ig.BUTTONS.START]=9;b[ig.BUTTONS.LEFT_STICK]=10;b[ig.BUTTONS.RIGHT_STICK]=11;b[ig.BUTTONS.DPAD_UP]=12;b[ig.BUTTONS.DPAD_DOWN]=13;b[ig.BUTTONS.DPAD_LEFT]=14;b[ig.BUTTONS.DPAD_RIGHT]=15;a[ig.AXES.LEFT_STICK_X]=0;a[ig.AXES.LEFT_STICK_Y]=1;a[ig.AXES.RIGHT_STICK_X]=2;a[ig.AXES.RIGHT_STICK_Y]=3;ig.GamepadManager.addHandlerCheck(function(){if(typeof navigator.webkitGamepads!=
"undefined"||typeof navigator.webkitGetGamepads!="undefined"||typeof navigator.getGamepads!="undefined")return new ig.Html5GamepadHandler})});ig.baked=!0;
ig.module("impact.feature.gamepad.nwf-gamepad").requires("impact.feature.gamepad.gamepad").defines(function(){ig.NWFGamepadHandler=ig.Class.extend({mainGamepad:null,init:function(){this.mainGamepad=window.nwf.input.WiiUGamePad.getController();var a=window.nwf.input.ControllerButton;b[ig.BUTTONS.FACE0]=a.GAMEPAD_B;b[ig.BUTTONS.FACE1]=a.GAMEPAD_A;b[ig.BUTTONS.FACE2]=a.GAMEPAD_Y;b[ig.BUTTONS.FACE3]=a.GAMEPAD_X;b[ig.BUTTONS.LEFT_SHOULDER]=a.GAMEPAD_L;b[ig.BUTTONS.RIGHT_SHOULDER]=a.GAMEPAD_R;b[ig.BUTTONS.LEFT_TRIGGER]=
a.GAMEPAD_ZL;b[ig.BUTTONS.RIGHT_TRIGGER]=a.GAMEPAD_ZR;b[ig.BUTTONS.SELECT]=a.GAMEPAD_MINUS;b[ig.BUTTONS.START]=a.GAMEPAD_PLUS;b[ig.BUTTONS.LEFT_STICK]=a.GAMEPAD_L_STICK;b[ig.BUTTONS.RIGHT_STICK]=a.GAMEPAD_R_STICK;b[ig.BUTTONS.DPAD_UP]=a.GAMEPAD_UP;b[ig.BUTTONS.DPAD_DOWN]=a.GAMEPAD_DOWN;b[ig.BUTTONS.DPAD_LEFT]=a.GAMEPAD_LEFT;b[ig.BUTTONS.DPAD_RIGHT]=a.GAMEPAD_RIGHT},update:function(a){if(!a.wiiUMain){var d=new ig.Gamepad;d.buttonDeadzones[ig.BUTTONS.LEFT_TRIGGER]=30/255;d.buttonDeadzones[ig.BUTTONS.RIGHT_TRIGGER]=
30/255;d.axesDeadzones[ig.AXES.LEFT_STICK_X]=7849/32767;d.axesDeadzones[ig.AXES.LEFT_STICK_Y]=7849/32767;d.axesDeadzones[ig.AXES.RIGHT_STICK_X]=8689/32767;d.axesDeadzones[ig.AXES.RIGHT_STICK_Y]=8689/32767;a.wiiUMain=d}var a=a.wiiUMain,d=this.mainGamepad,c=d.buttons,e;for(e in b){var f=c.isButtonPressed(b[e]);a.updateButton(e,f)}e=d.leftStick;a.updateAxes(ig.AXES.LEFT_STICK_X,e.movementX);a.updateAxes(ig.AXES.LEFT_STICK_Y,e.movementY);e=d.rightStick;a.updateAxes(ig.AXES.RIGHT_STICK_X,e.movementX);
a.updateAxes(ig.AXES.RIGHT_STICK_Y,e.movementY)}});var b={};ig.GamepadManager.addHandlerCheck(function(){if(window.nwf)return new ig.NWFGamepadHandler})});ig.baked=!0;ig.module("impact.feature.gamepad.plug-in").requires("impact.feature.gamepad.gamepad","impact.feature.gamepad.html5-gamepad","impact.feature.gamepad.nwf-gamepad").defines(function(){});ig.baked=!0;
ig.module("impact.base.action").requires("impact.base.steps").defines(function(){ig.ACTION_STEP={};ig.ActionStepBase=ig.StepBase;ig.Action=ig.Class.extend({name:"",rootStep:null,labeledSteps:{},eventAction:false,parallelMove:false,repeating:false,hint:null,init:function(b,a,d,c){this.name=b;this.parallelMove=d||false;this.repeating=c||false;this.rootStep=ig.StepHelpers.constructSteps(a,ig.ACTION_STEP,this.labeledSteps)},clearCached:function(){ig.StepHelpers.clearStepsCache(this.rootStep)},inlineStart:function(b,
a){if(b.stepTimer>0)b.stepTimer=0;var d=b.currentAction;a.start(b);if(d==b.currentAction)b.currentActionStep=a},run:function(b){this.parallelMove||Vec2.assignC(b.coll.accelDir,0,0);var a=b.currentActionStep;if(!a){a=this.rootStep;if(!a)return true;if(b.stepTimer>0)b.stepTimer=0;var d=b.currentAction;a.start(b);if(d!=b.currentAction)return false;b.currentActionStep=a}for(var d=b.currentAction,c=1E4;a&&a.run(b);){if(b.stepTimer>0)b.stepTimer=0;if(!b.currentAction){a=null;break}if(d!=b.currentAction||
a!=b.currentActionStep)return false;var e=null;if(a.getJumpLabelName){var f=a.getJumpLabelName(b);if(f){e=this.labeledSteps[f];if(!e)throw Error("Label '"+f+"' not found.");}}e||(e=a.getNext(b));c--;if(c<=0)throw Error("Ridiculous number of steps execute in one action tick!! Infinite Loop? Action Name: "+this.name+", Entity Group: "+b.group+", Entity Name: "+b.name+", Enemy Name: "+b.enemyName);a=e;(b.currentActionStep=a)&&a.start(b);if(d!=b.currentAction||a!=b.currentActionStep)return false}b.currentActionStep=
a;b.stepTimer=b.stepTimer<0?0:b.stepTimer-b.coll.getTick(true);(a=!a&&!this.repeating)&&!this.parallelMove&&Vec2.assignC(b.coll.accelDir,0,0);return a}});ig.Action.getVarName=function(b,a){return b&&b.actorAttrib?a.getAttribString(b.actorAttrib):ig.Event.getVarName(b)};ig.Action.getVec2=function(b,a,d){return b&&b.actorAttrib?Vec2.assign(d,a.getAttribVec2(b.actorAttrib)):ig.Event.getVec2(b,d)};ig.Action.getVec3=function(b,a,d){return b&&b.actorAttrib?Vec3.assign(d,a.getAttribVec3(b.actorAttrib)):
ig.Event.getVec3(b,d)};ig.Action.getFace=function(b,a,d){return b&&b.actorAttrib?Vec2.assign(d,a.getAttribVec2(b.actorAttrib)):ig.ActorEntity.getFaceVec(ig.ActorEntity.FACE8[b]||0,d)}});ig.baked=!0;
ig.module("impact.base.actor-entity").requires("impact.base.entity","impact.base.action").defines(function(){var b=ig.ACTOR_RUN_THRESHOLD=0.75;ig.ActorConfig=ig.Class.extend({empty:true,data:{},original:null,init:function(a,b){a&&this.loadFromData(a,b||null)},get:function(a){return this.data[a]},overwrite:function(a,b){if(!this.original){this.original=this.data;this.data=ig.copy(this.original)}this.data[a]=b},clearOverwrite:function(){if(this.original){this.data=this.original;this.original=null}},
loadFromConfig:function(a){this.empty=false;for(var b in ig.ACTOR_CONFIGS)for(var d in ig.ACTOR_CONFIGS[b].KEYS)this.data[d]=a.data[d]},loadFromData:function(a,b){this.empty=false;for(var d in ig.ACTOR_CONFIGS)for(var g in ig.ACTOR_CONFIGS[d].KEYS)this.data[g]=a[g]!=void 0?a[g]:b&&b.data[g]!=void 0?b.data[g]:ig.ACTOR_CONFIGS[d].KEYS[g];for(d in ig.ACTOR_CONFIGS)ig.ACTOR_CONFIGS[d].fromDataFix&&ig.ACTOR_CONFIGS[d].fromDataFix.call(this.data)},loadFromEntity:function(a){this.empty=false;for(var b in ig.ACTOR_CONFIGS)a instanceof
ig.ACTOR_CONFIGS[b].classType&&ig.ACTOR_CONFIGS[b].load.call(this.data,a)},apply:function(a){if(!this.empty)for(var b in ig.ACTOR_CONFIGS)a instanceof ig.ACTOR_CONFIGS[b].classType&&ig.ACTOR_CONFIGS[b].apply.call(this.data,a)}});ig.ACTOR_CONFIGS={};var a=Vec2.create(),d={};ig.ActorEntity=ig.AnimatedEntity.extend({animSheet:{anims:{}},face:Vec2.createC(0,1),currentAnim:null,followUpAnim:null,faceDirFixed:false,forceFaceDirFixed:false,animationFixed:false,floatHeightOnMove:0,fly:{height:0,minHeight:0,
lastZ:0,keepHeight:false,blocked:false},walkAnimsName:null,walkAnims:{idle:null,preMove:null,move:null,moveRev:null,moveLeft:null,run:null,runRev:null,runLeft:null,brake:null,preIdle:null,jump:null,fall:null,hover:null,preHoverMove:null,hoverMove:null,hoverMoveRev:null,land:null},storedWalkAnims:{none:{}},currentAction:null,currentActionStep:null,stepTimer:0,stepSync:0,stepData:{},keepStateAfterAction:false,inlineActionStack:[],stashed:{action:null,step:0,timer:0,data:null},defaultConfig:new ig.ActorConfig,
jumpingEnabled:true,jumping:false,floatJump:0,preJumpStats:{maxVel:0,accelSpeed:0,zGravityFactor:0},actionAttached:[],attributes:{},faceToTarget:{active:false,offset:0,speed:2},init:function(a,b,d,g){this.parent(a,b,d,g);this.coll.type=ig.COLLTYPE.VIRTUAL;this.coll.zGravityFactor=1;this.initAnimations()},onKill:function(a){this.clearActionAttached();this.currentActionStep=this.currentAction=null;this.parent(a)},initAnimations:function(a){if(a||!this.animState.hasAnimations()){a="";if(this.walkAnims&&
this.walkAnims.idle)a=this.walkAnims.idle;else for(a in this.animSheet.anims)break;this.currentAnim=a;(a=this.animSheet.anims[this.currentAnim])&&this.animState.setAnimation(this,a.getAnimations(this))}},hasAction:function(){return this.currentAction!=null},setDefaultConfig:function(a){this.defaultConfig=a;this.jumping&&this._savePreJumpStats();this.currentAction||this.defaultConfig&&this.defaultConfig.apply(this);if(this.jumping){this._loadPreJumpStats();this.preJumpStats.accelSpeed=this.defaultConfig.get("accelSpeed");
this.preJumpStats.maxVel=this.defaultConfig.get("maxVel");this.preJumpStats.zGravityFactor=this.defaultConfig.get("zGravityFactor");this.preJumpStats.floatHeight=this.defaultConfig.get("floatHeight")}},setAttribute:function(a,b){this.attributes[a]=b},getAttribute:function(a){return this.attributes[a]},getAttribVec2:function(a){return!this.attributes[a]||this.attributes[a].x===void 0?null:this.attributes[a]},getAttribVec3:function(a){return!this.attributes[a]||this.attributes[a].x===void 0?null:this.attributes[a]},
getAttribString:function(a){return!this.attributes[a]||typeof this.attributes[a]!="string"?null:this.attributes[a]},getAttribCondition:function(a){return!this.attributes[a]||!this.attributes[a]instanceof ig.VarCondition?null:this.attributes[a]},setFace:function(a){ig.ActorEntity.getFaceVec(a,this.face)},getTarget:function(){return this.target},getFaceOffset:function(){var a=typeof this.currentAnim=="string"?this.animSheet.anims[this.currentAnim]:this.currentAnim;return a&&a.getAnchorOffset?a.getAnchorOffset(this.face.x,
this.face.y):null},setAction:function(a,b,d){this.cancelJump();this.cancelAction(d);this.currentAction=a;this.keepStateAfterAction=b||false;this.currentActionStep=null},forceExecuteAction:function(){if(this.currentAction){ig.vars.pushEntityAccessor(this);var a;do{a=this.currentAction;if(this.currentAction.run(this))this.inlineActionStack.length?this.popInlineAction():this.currentAction=null}while(this.currentAction&&a!=this.currentAction);ig.vars.popEntityAccessor(this)}},cancelAction:function(a){if(this.currentAction){this.cancelJump();
if(!a){this.clearActionAttached();this.keepStateAfterAction||this.defaultConfig.apply(this)}this.inlineActionStack.length=0;this.currentActionStep=this.currentAction=null}},pushInlineAction:function(a,b,d){var g=this.currentActionStep||this.currentAction.rootStep,h=g;b||(h=g&&g.getNext(this));h&&this.inlineActionStack.push({action:this.currentAction,step:h,reset:d});this.currentAction=a;this.currentActionStep=null},popInlineAction:function(){var a=this.inlineActionStack.pop();if(a){this.currentAction=
a.action;this.currentAction.inlineStart(this,a.step);if(a.reset){this.clearActionAttached();this.defaultConfig.apply(this)}}},stashAction:function(a){if(this.currentAction){this.stashed.action=this.currentAction;this.stashed.step=this.currentActionStep;this.stashed.timer=this.stepTimer;this.stashed.data=ig.copy(this.stepData);if(this.inlineActionStack.length>0)this.stashed.inlineStack=ig.copy(this.inlineActionStack);this.cancelAction(a)}},hasStashedAction:function(){return!!this.stashed.action},clearStashedAction:function(){this.stashed.action=
null;this.stashed.inlineStack=null},resumeStashedAction:function(a){if(this.stashed.action){this.setAction(this.stashed.action,false,a);this.currentActionStep=this.stashed.step;this.stepTimer=this.stashed.timer;this.stepData=this.stashed.data;this.stashed.action=null;this.inlineActionStack.length=0;this.stashed.inlineStack&&this.inlineActionStack.push.apply(this.inlineActionStack,this.stashed.inlineStack);this.stashed.inlineStack=null}},cancelJump:function(){if(this.jumping||this.floatJump){if(this.floatJump)this.floatJump=
0;this._loadPreJumpStats();this.coll.totalBlockTimer=0;this.jumping=false}},addActionAttached:function(a){a&&this.actionAttached.push(a)},removeActionAttached:function(a){a=this.actionAttached.indexOf(a);if(a!=-1){this.actionAttached.splice(a,1);return true}return false},clearActionAttached:function(a,b){for(var d=this.actionAttached.length;d--;)if(!a||a(this.actionAttached[d],b)){this.actionAttached[d].onActionEndDetach(this);a&&this.actionAttached.splice(d,1)}if(!a)this.actionAttached=[]},setWalkAnims:function(a){if(typeof a==
"string"){if(this.storedWalkAnims[a]){this.walkAnimsName=a;this.walkAnims=this.storedWalkAnims[a]}}else{this.walkAnimsName=null;this.walkAnims=a}},storeWalkAnims:function(a,b){this.storedWalkAnims[a]=b},update:function(){var a=this.getTarget();if(this.faceToTarget.active&&a){this.forceFaceDirFixed=true;var d=Vec2.sub(a.getCenter(),this.getCenter());Vec2.isZero(d)&&Vec2.assignC(d,0,1);this.faceToTarget.offset&&Vec2.rotate(d,this.faceToTarget.offset*2*Math.PI);Vec2.rotateToward(this.face,d,this.faceToTarget.speed*
Math.PI*2*ig.system.tick)}else this.forceFaceDirFixed=false;d=this.coll;if(this.floatJump){this.jumping=this.jumping-ig.system.tick;d.vel.z=this.floatJump;this.jumping<0&&this.cancelJump()}if(this.jumpingEnabled&&d.totalBlockTimer>0.05&&(d.accelDir.x||d.accelDir.y)&&(d.pos.z==this.coll.baseZPos||d.float.height)&&!this.jumping){var f=ig.EntityTools.getGroundEntity(this);if(f&&f.onTopEntityJump)f.onTopEntityJump(this);else if(this._checkForUpwardJump())this.secondJumpCheck?d.float.height?this.doFloatJump(80,
0.3,100):this.doJump(185,16,100):this.secondJumpCheck=true;else{this.secondJumpCheck=false;d.totalBlockTimer=0}}else this.secondJumpCheck=false;var f=false,a=0,g=!!this.currentAction;do{a++;if(this.currentAction){var h;do{h=this.currentAction;if(this.currentAction.run(this))if(this.inlineActionStack.length)this.popInlineAction();else{this.cancelAction();f=true}}while(this.currentAction&&h!=this.currentAction)}if(this.postActionUpdate){this.postActionUpdate();f=f||!g&&this.currentAction}}while(f&&
this.currentAction&&a==1);f=d.pos.z>this.coll.baseZPos+ig.COLLISION.EPS;if(this.jumping&&d.vel.z<=0&&!f)this.onTouchGround(0);if(this.fly.height&&!this.fly.blocked){a=this.getTarget();g=d.baseZPos;h=this.fly.lastZ;if(!this.fly.keepHeight&&a&&!a.jumping)h=a.coll.pos.z;this.fly.minHeight&&(h=Math.max(h,this.fly.minHeight));d.float.height=Math.max(8,h-g+this.fly.height);this.fly.lastZ=g+d.float.height-this.fly.height}if(this.fly.blocked>0){this.fly.blocked=this.fly.blocked-ig.system.tick;if(this.fly.blocked<=
0)this.fly.blocked=0}if(this.walkAnims.idle&&(!this.currentAnim||this.currentAnim!=this.walkAnims.land)){a=!d.float.height&&(this.jumping||d.vel.z>0||d.pos.z>d.baseZPos+ig.COLLISION.HEIGHT_TOLERATE);g=Vec2.length(d.vel);if(a)this.animationFixed||(d.vel.z>=0?this.setCurrentAnim(this.walkAnims.jump||this.walkAnims.hover||this.walkAnims.idle,true):this.setCurrentAnim(this.walkAnims.fall||this.walkAnims.jump||this.walkAnims.hover||this.walkAnims.idle,true));else if(d.accelDir.x==0&&d.accelDir.y==0){if(!this.fly.height&&
this.floatHeightOnMove)d.float.height=Math.max(0,d.float.height-this.floatHeightOnMove*4*ig.system.tick);this.animationFixed||(this.walkAnims.hover&&f?this.setCurrentAnim(this.walkAnims.hover):!this.walkAnims.brake||g<8||d.friction.terrain<0.8&&g<d.maxVel/2||this.currentAnim==this.walkAnims.move||this.currentAnim==this.walkAnims.moveLeft||this.currentAnim==this.walkAnims.moveRev?this.walkAnims.preIdle&&this.walkAnims.brake&&this.currentAnim==this.walkAnims.brake?this.setCurrentAnim(this.walkAnims.preIdle,
true,this.walkAnims.idle):this.setCurrentAnim(this.walkAnims.idle):this.currentAnim!=this.walkAnims.idle&&this.setCurrentAnim(this.walkAnims.brake,true))}else{if(!this.fly.height&&this.floatHeightOnMove)d.float.height=this.floatHeightOnMove;if(!this.faceDirFixed&&!this.forceFaceDirFixed){this.face.x=d.accelDir.x;this.face.y=d.accelDir.y}if(!this.animationFixed){f=d.float.height&&this.walkAnims.preHoverMove?this.walkAnims.preHoverMove:this.walkAnims.preMove;if(d.float.height&&this.walkAnims.hoverMove){d=
this.walkAnims.hoverMoveRev&&Vec2.dot(d.accelDir,this.face)<0?true:false;f?this.setCurrentAnim(f,true,d?this.walkAnims.hoverMoveRev:this.walkAnims.hoverMove):this.setCurrentAnim(d?this.walkAnims.hoverMoveRev:this.walkAnims.hoverMove,true)}else{h=b;if(this.currentAnim==this.walkAnims.run||this.currentAnim==this.walkAnims.runRev)h=h-0.2;a=d.relativeVel<h?this.walkAnims.move:this.walkAnims.run||this.walkAnims.move;g=d.relativeVel<h?this.walkAnims.moveRev:this.walkAnims.runRev||this.walkAnims.moveRev;
h=d.relativeVel<h?this.walkAnims.moveLeft:this.walkAnims.runLeft||this.walkAnims.moveLeft;g&&Vec2.dot(d.accelDir,this.face);a=g&&Vec2.dot(d.accelDir,this.face)<0?g:d.accelDir.x<0?h||a:a;f&&d.relativeVel>=b?this.setCurrentAnim(f,true,a||this.walkAnims.idle):this.setCurrentAnim(a||this.walkAnims.idle,true)}}}}this.parent()},_checkForUpwardJump:function(){var b=this.coll,b=ig.getDirectionIndex(b.accelDir.x,b.accelDir.y,8),b=ig.getDirectionVel(b,8,a),e=ig.game.physics.initTraceResult(d);if(!ig.game.traceEntity(e,
this,b.x,b.y,0,0,0,ig.COLLTYPE.IGNORE))return false;e=ig.game.physics.initTraceResult(d);return ig.game.traceEntity(e,this,b.x,b.y,0,0,19)?false:true},onTouchGround:function(){this.cancelJump();if(this.walkAnims.land&&!this.animationFixed){this.setCurrentAnim(this.walkAnims.land,true,this.walkAnims.idle,true);this.updateAnim()}},_savePreJumpStats:function(){this.preJumpStats.maxVel=this.coll.maxVel;this.preJumpStats.accelSpeed=this.coll.accelSpeed;this.preJumpStats.zGravityFactor=this.coll.zGravityFactor;
this.preJumpStats.floatHeight=this.coll.float.height;this.preJumpStats.airFriction=this.coll.friction.air},_loadPreJumpStats:function(){this.coll.maxVel=this.preJumpStats.maxVel;this.coll.accelSpeed=this.preJumpStats.accelSpeed;this.coll.zGravityFactor=this.preJumpStats.zGravityFactor;this.coll.float.height=this.preJumpStats.floatHeight;this.coll.friction.air=this.preJumpStats.airFriction},doJump:function(a,b,d,g,h){this.cancelJump();this._savePreJumpStats();this.coll.vel.z=a;this.jumping=true;if(d)this.coll.maxVel=
d;if(g!==void 0&&g!==null)this.coll.accelSpeed=g;this.onJump(b,h)},doFloatJump:function(a,b,d){if(!this.fly.height){this.cancelJump();this._savePreJumpStats();this.floatJump=a||10;this.coll.float.height=0;this.coll.zGravityFactor=0;this.jumping=b;if(d)this.coll.maxVel=d}},onFallFromEdge:function(a){var b=this.coll;if(this.jumpingEnabled&&(b.accelDir.x||b.accelDir.y)&&Vec2.length(b.vel)/b.maxVel>0.5&&(!a||Vec2.dot(a,b.accelDir)/Vec2.length(a)/Vec2.length(b.accelDir)>0.5)){var a=false,d=ig.EntityTools.getGroundEntity(this);
d&&d.onTopEntityJumpFar&&(a=d.onTopEntityJumpFar(this));a||(b.float.height?this.doFloatJump(10,0.3):this.doJump(155,0,null,this.isPlayer?0.1:1))}},onVarAccess:function(a,b){return b[1]=="attrib"?ig.vars.resolveObjectAccess(this.attributes,b,2):b[1]=="face"?ig.vars.resolveObjectAccess(this.face,b,2):this.parent(a,b)},onJump:function(){}});ig.ActorEntity.FACE4={NORTH:0,EAST:1,SOUTH:2,WEST:3};ig.ActorEntity.FACE8={NORTH:0,EAST:1,SOUTH:2,WEST:3,NORTH_EAST:4,SOUTH_EAST:5,SOUTH_WEST:6,NORTH_WEST:7};ig.ActorEntity.getFaceVec=
function(a,b){var d=b||Vec2.create();switch(a){case 0:Vec2.assignC(d,0,-1);break;case 1:Vec2.assignC(d,1,0);break;case 2:Vec2.assignC(d,0,1);break;case 3:Vec2.assignC(d,-1,0);break;case 4:Vec2.assignC(d,1,-1);break;case 5:Vec2.assignC(d,1,1);break;case 6:Vec2.assignC(d,-1,1);break;case 7:Vec2.assignC(d,-1,-1)}return d};ig.ACTOR_ATTRIB_CONNECTION={};ig.ACTOR_CONFIGS.ACTOR={classType:ig.ActorEntity,KEYS:{walkAnims:null,currentAnim:null,followUpAnim:null,accelSpeed:1,ignoreCollision:false,groundConnect:"LOOSE",
staticTime:false,friction:1,airFriction:0.7,terrainFrictionIgnore:false,weight:50,maxVel:100,maxZVel:1E3,zGravityFactor:1,relativeVel:1,faceDirFixed:false,jumpingEnabled:false,collType:ig.COLLTYPE.VIRTUAL,collShape:ig.COLLSHAPE.RECTANGLE,animationFixed:false,bounciness:0,zBounciness:0,floatHeight:0,shadow:0,shadowScaleY:1,shadowType:ig.COLL_SHADOW_TYPE.DEFAULT,floatVariance:3,floatAccel:1,floatMaxSpeed:300,floatHeightOnMove:0,flyHeight:0,flyKeepHeight:false,faceToTarget:false,faceToTargetOffset:0,
faceToTargetSpeed:2},fromDataFix:function(){typeof this.collType=="string"&&(this.collType=ig.COLLTYPE[this.collType]);typeof this.collShape=="string"&&(this.collShape=ig.COLLSHAPE[this.collShape]);typeof this.shadowType=="string"&&(this.shadowType=ig.COLL_SHADOW_TYPE[this.shadowType]);typeof this.groundConnect=="string"&&(this.groundConnect=ig.COLL_GROUND_CONNECT[this.groundConnect])},apply:function(a){a.setWalkAnims(this.walkAnims);if(this.currentAnim)a.currentAnim=this.currentAnim;if(this.followUpAnim)a.followUpAnim=
this.followUpAnim;a.coll.accelSpeed=this.accelSpeed;a.coll.ignoreCollision=this.ignoreCollision;a.coll.groundConnect=this.groundConnect;a.coll.friction.ground=this.friction;a.coll.friction.air=this.airFriction;a.coll.friction.ignoreTerrain=this.terrainFrictionIgnore;a.coll.weight=this.weight;a.coll.maxVel=this.maxVel;a.coll.maxZVel=this.maxZVel;a.coll.relativeVel=this.relativeVel;a.coll.shadow.size=this.shadow;a.coll.shadow.type=this.shadowType;a.coll.shadow.scaleY=this.shadowScaleY||1;a.faceDirFixed=
this.faceDirFixed;a.jumpingEnabled=this.jumpingEnabled;a.coll.setType(this.collType);a.coll.shape=this.collShape;a.animationFixed=this.animationFixed;a.coll.bounciness=this.bounciness;a.coll.zBounciness=this.zBounciness;a.coll.zGravityFactor=this.zGravityFactor;a.coll.time.animStatic=this.staticTime;a.floatHeightOnMove=0;a.fly.height=0;this.flyHeight?a.fly.height=this.flyHeight:this.floatHeightOnMove?a.floatHeightOnMove=this.floatHeightOnMove:a.coll.float.height=this.floatHeight;a.fly.keepHeight=
this.flyKeepHeight;a.coll.float.variance=this.floatVariance;a.coll.float.accel=this.floatAccel;a.coll.float.maxSpeed=this.floatMaxSpeed;a.faceToTarget.active=this.faceToTarget;a.faceToTarget.offset=this.faceToTargetOffset;a.faceToTarget.speed=this.faceToTargetSpeed},load:function(a){this.walkAnims=a.walkAnimsName;this.currentAnim=a.currentAnim;this.followUpAnim=a.followUpAnim;this.accelSpeed=a.coll.accelSpeed;this.ignoreCollision=a.coll.ignoreCollision;this.groundConnect=a.coll.groundConnect;this.friction=
a.coll.friction.ground;this.airFriction=a.coll.friction.air;this.terrainFrictionIgnore=a.coll.friction.ignoreTerrain;this.weight=a.coll.weight;this.maxVel=a.coll.maxVel;this.maxZVel=a.coll.maxZVel;this.relativeVel=a.coll.relativeVel;this.faceDirFixed=a.faceDirFixed;this.jumpingEnabled=a.jumpingEnabled;this.shadow=a.coll.shadow.size;this.shadowScaleY=a.coll.shadow.scaleY;this.shadowType=a.coll.shadow.type;this.collType=a.coll.type;this.collShape=a.coll.shape;this.animationFixed=a.animationFixed;this.bounciness=
a.coll.bounciness;this.zBounciness=a.coll.zBounciness;this.zGravityFactor=a.coll.zGravityFactor;this.staticTime=a.coll.time.animStatic;this.flyHeight=this.floatHeightOnMove=0;a.fly.height?this.flyHeight=a.fly.height:a.floatHeightOnMove?this.floatHeightOnMove=a.floatHeightOnMove:this.floatHeight=a.coll.float.height;this.flyKeepHeight=a.fly.keepHeight;this.floatVariance=a.coll.float.variance;this.floatAccel=a.coll.float.accel;this.floatMaxSpeed=a.coll.float.maxSpeed;this.faceToTarget=a.faceToTarget.active;
this.faceToTargetOffset=a.faceToTarget.offset;this.faceToTargetSpeed=a.faceToTarget.speed}}});ig.baked=!0;
ig.module("impact.feature.base.action-steps").requires("impact.base.action","impact.base.actor-entity").defines(function(){function b(a){return a instanceof ig.SoundHandle}var a=Vec2.create(),d=Vec2.create(),c=Vec2.create();ig.ACTION_STEP.LABEL=ig.ActionStepBase.extend({name:null,_wm:new ig.Config({attributes:{name:{_type:"String",_info:"Name of the label"}},label:function(){return"<b>LABEL</b> <i>"+this.name+"</i>"}}),init:function(a){assertContent(a,"name");this.name=a.name}});ig.ACTION_STEP.GOTO_LABEL=
ig.ActionStepBase.extend({name:null,_wm:new ig.Config({attributes:{name:{_type:"String",_info:"Label to move to."}},label:function(){return"<b>GOTO_LABEL</b> <i>"+this.name+"</i>"}}),init:function(a){assertContent(a,"name");this.name=a.name},getJumpLabelName:function(){return this.name}});var e=/^(\d+)_(\d+)$/;ig.ACTION_STEP.SELECT_RANDOM=ig.ActionStepBase.extend({options:[],branches:{},_wm:new ig.Config({attributes:{options:{_type:"RandomDistribution",_info:"RandomDistribution",_noLabel:true}},branchLabel:function(a){if(a==
"_end")return"END_SELECT_RANDOM";var b=e.exec(a);if(b){var a=b[1],b=b[2],c="";this.options[a].activeCondition&&(c=c+("("+this.options[a].activeCondition+")"));return"Entry "+a+" #"+b+" "+c+" weight "+this.options[a].weight}return"???"}}),init:function(a){for(var a=a.options||[],b=0;b<a.length;++b){var c={count:a[b].count,weight:a[b].weight,activeCondition:new ig.VarCondition(a[b].activeCondition)};c.prob=c.count*c.weight;this.options[b]=c}},getBranchNames:function(){for(var a=[],b=0;b<this.options.length;++b)for(var c=
this.options[b],d=0;d<c.count;++d)a.push(b+"_"+d);return a},getNext:function(){for(var a=0,b=this.options.length;b--;)this.options[b].activeCondition.evaluate()&&(a=a+this.options[b].prob);a=Math.random()*a;for(b=this.options.length;b--;)if(this.options[b].activeCondition.evaluate())if(a>=this.options[b].prob)a=a-this.options[b].prob;else break;a=this.options[b];if(!a)return this._nextStep;a=Math.floor(a.count*Math.random());return this.branches[b+"_"+a]||this._nextStep}});ig.ACTION_STEP.SELECT_FIRST=
ig.ActionStepBase.extend({options:[],branches:{},_wm:new ig.Config({attributes:{options:{_type:"Array",_info:"Face direction options",_sub:{_type:"VarCondition",_popup:true}}},width:600,branchLabel:function(a){if(a=="_end")return"END_SELECT_RANDOM";var b;b=""+("("+this.options[a]+")");return"Entry "+a+" "+b}}),init:function(a){for(var a=a.options||[],b=0;b<a.length;++b){var c=new ig.VarCondition(a[b]);this.options[b]=c}},getBranchNames:function(){for(var a=[],b=0;b<this.options.length;++b)a.push(b);
return a},getNext:function(){for(var a=0;a<this.options.length;++a)if(this.options[a].evaluate())return this.branches[a];return this._nextStep}});ig.ACTION_STEP.RESET_ACTOR=ig.ActionStepBase.extend({_wm:new ig.Config({attributes:{}}),init:function(){},start:function(a){a.defaultConfig.apply(a)}});var f={INCREASE:1,INCREASE_AND_CLEAR:2};ig.ACTION_STEP.WAIT=ig.ActionStepBase.extend({time:0,aggroTime:0,_wm:new ig.Config({attributes:{time:{_type:"NumberExpression",_info:"Time to wait. -1 = Wait forever (use WISELY)"},
aggroTime:{_type:"NumberExpression",_info:"Only works when 'harder nemeies' new game option is selected",_optional:true},assistSlow:{_type:"Boolean",_info:"If true: Slow down in Assist Mode",_optional:true},guardTrap:{_type:"String",_info:"Select how guard trap time should be modified ",_optional:true,_select:f}}}),init:function(a){assertContent(a,"time");this.time=a.time;this.aggroTime=a.aggroTime||0;this.assistSlow=a.assistSlow||false;this.guardTrap=f[a.guardTrap]||0},start:function(a){a.stepData.time=
ig.Event.getExpressionValue(sc.newgame.hasHarderEnemies()&&this.aggroTime?this.aggroTime:this.time);if(this.assistSlow)a.stepData.time=a.stepData.time/sc.options.get("assist-attack-frequency");a.stepTimer=a.stepTimer+(a.stepData.time||0)},run:function(a){if(this.guardTrap)a.combo.guardTrapTime=a.combo.guardTrapTime+ig.system.tick;if(a.stepData.time>=0&&a.stepTimer<=0){if(this.guardTrap==f.INCREASE_AND_CLEAR)a.combo.guardTrapTime=0;return true}}});ig.ACTION_STEP.WAIT_UNTIL=ig.ActionStepBase.extend({condition:null,
_wm:new ig.Config({attributes:{condition:{_type:"VarCondition",_info:"Condition that must be true before continued"},maxTime:{_type:"NumberExpression",_info:"If defined: maximal wait this time",_optional:true}}}),init:function(a){this.condition=new ig.VarCondition(a.condition);this.maxTime=a.maxTime},start:function(a){if(this.maxTime)a.stepTimer=a.stepTimer+ig.Event.getExpressionValue(this.maxTime)},run:function(a){return this.maxTime&&a.stepTimer<=0?true:this.condition.evaluate()}});ig.ACTION_STEP.WAIT_RANDOM=
ig.ActionStepBase.extend({maxTime:0,minTime:0,_wm:new ig.Config({attributes:{minTime:{_type:"Number",_info:"Minimum time to wait"},maxTime:{_type:"Number",_info:"Maximum time to wait"}}}),init:function(a){assertContent(a,"minTime","maxTime");this.minTime=a.minTime;this.maxTime=a.maxTime},start:function(a){a.stepTimer=a.stepTimer+(this.minTime+Math.random()*(this.maxTime-this.minTime))},run:function(a){return a.stepTimer<=0}});ig.ACTION_STEP.IF=ig.ActionStepBase.extend({condition:null,withElse:false,
branches:{},_wm:new ig.Config({attributes:{condition:{_type:"VarCondition",_info:"Condition for IF statement"},withElse:{_type:"Boolean",_info:"With else case.",_noLabel:true}},branchLabel:function(a){switch(a){case "thenStep":return null;case "elseStep":return"else";case "_end":return"endif"}return"???"}}),init:function(a){this.condition=new ig.VarCondition(a.condition);this.withElse=a.withElse},getBranchNames:function(){return this.withElse?["thenStep","elseStep"]:["thenStep"]},getNext:function(){return this.condition.evaluate()?
this.branches.thenStep?this.branches.thenStep:this._nextStep:this.branches.elseStep?this.branches.elseStep:this._nextStep}});ig.ACTION_STEP.WAIT_UNTIL_ON_GROUND=ig.ActionStepBase.extend({_wm:new ig.Config({attributes:{maxTime:{_type:"Number",_info:"If defined: maximal wait this time",_optional:true},alsoBelowTarget:{_type:"Boolean",_info:"If true also cancel if below target",_optional:true}}}),init:function(a){this.maxTime=a.maxTime||0;this.alsoBelowTarget=a.alsoBelowTarget||false},start:function(a){a.stepTimer=
a.stepTimer+this.maxTime},run:function(a){if(this.maxTime&&a.stepTimer<=0||a.coll.vel.z>=0&&!a.coll.zGravityFactor)return true;if(this.alsoBelowTarget){var b=a.getTarget();if(b&&b.coll.pos.z>a.coll.pos.z)return true}return a.coll.pos.z==a.coll.baseZPos}});ig.ACTION_STEP.WAIT_UNTIL_PLAYER_ON_TOP=ig.ActionStepBase.extend({_wm:new ig.Config({attributes:{not:{_type:"Boolean",_info:"If true, wait until player is NOT on top anymore"},maxTime:{_type:"Number",_info:"If defined: maximal wait this time",_optional:true}}}),
init:function(a){this.maxTime=a.maxTime||0;this.not=a.not||false},start:function(a){a.stepTimer=a.stepTimer+this.maxTime},run:function(a){if(this.maxTime&&a.stepTimer<=0)return true;for(var a=ig.game.getEntitiesOnTop(a),b=a.length;b--;)if(a[b].isPlayer)return!this.not;return this.not}});ig.ACTION_STEP.MOVE_FORWARD=ig.ActionStepBase.extend({target:Vec2.create(),_wm:new ig.Config({attributes:{time:{_type:"Number",_info:"Time to move forward"},collideCancel:{_type:"Number",_info:"If defined: if angle to collided wall is lower than this value, cancel step",
_optional:true},stopBeforeEdge:{_type:"Boolean",_info:"If true: Stop before falling down from edge when further moving forward"},waitUntil:{_type:"VarCondition",_info:"If defined: continue moving forward until condition evaluates to true. Duration is minimum wait",_optional:true},maxTargetDistance:{_type:"Number",_info:"If defined, make sure to not move further than this distance to target",_optional:true}}}),init:function(a){assertContent(a,"time");this.time=a.time;this.collideCancel=a.collideCancel;
this.stopBeforeEdge=a.stopBeforeEdge;if(a.waitUntil)this.waitUntil=new ig.VarCondition(a.waitUntil);this.maxTargetDistance=a.maxTargetDistance||0},start:function(a){a.stepTimer=a.stepTimer+this.time;if(this.maxTargetDistance)a.stepData.startRelativeVel=a.coll.relativeVel},run:function(a){Vec2.assign(a.coll.accelDir,a.face);if(this.collideCancel&&ig.CollTools.hasWallCollide(a.coll,this.collideCancel))a.stepTimer=0;if(this.stopBeforeEdge&&ig.CollTools.isPostMoveOverHole(a.coll,true)){Vec2.assignC(a.coll.accelDir,
0,0);Vec2.assignC(a.coll.vel,0,0);if(this.collideCancel)a.stepTimer=0}if(this.maxTargetDistance){var b=a.getTarget();if(b){b=ig.CollTools.getMaxDistMoveFactor(a.coll,b.coll,this.maxTargetDistance);if(b<=0){Vec2.assignC(a.coll.accelDir,0,0);Vec2.assignC(a.coll.vel,0,0)}else if(b<1){a.coll.relativeVel=a.coll.relativeVel*b;Vec2.length(a.coll.vel,a.coll.maxVel*a.coll.relativeVel*b)}}}if((!this.waitUntil||this.waitUntil.evaluate())&&a.stepTimer<=0){if(this.maxTargetDistance)a.coll.relativeVel=a.stepData.startRelativeVel;
return true}return false}});ig.ACTION_STEP.SLIDE_OUT=ig.ActionStepBase.extend({target:Vec2.create(),_wm:new ig.Config({attributes:{time:{_type:"Number",_info:"Maximum Time to slide out"},stopBeforeEdge:{_type:"Boolean",_info:"If true: Stop before falling down from edge when further moving forward"}}}),init:function(a){this.time=a.time;this.stopBeforeEdge=a.stopBeforeEdge},start:function(a){a.stepTimer=a.stepTimer+this.time},run:function(a){Vec2.assign(a.coll.accelDir,0,0);if(this.stopBeforeEdge&&
ig.CollTools.isPostMoveOverHole(a.coll,true)){Vec2.assignC(a.coll.accelDir,0,0);Vec2.assignC(a.coll.vel,0,0)}return a.stepTimer<=0}});ig.ACTION_STEP.MOVE_BACKWARD=ig.ActionStepBase.extend({target:Vec2.create(),_wm:new ig.Config({attributes:{time:{_type:"Number",_info:"Time to move backward"},stopBeforeEdge:{_type:"Boolean",_info:"If true: Stop before falling down from edge when further moving backward"}}}),init:function(a){assertContent(a,"time");this.time=a.time;this.stopBeforeEdge=a.stopBeforeEdge},
start:function(a){a.stepTimer=+this.time;a.stepData.prevFaceFix=a.faceDirFixed;a.faceDirFixed=true},run:function(a){Vec2.assign(a.coll.accelDir,a.face);Vec2.flip(a.coll.accelDir);if(a.stepTimer<=0){Vec2.assignC(a.coll.accelDir,0,0);a.faceDirFixed=a.stepData.prevFaceFix;return true}if(this.stopBeforeEdge&&ig.CollTools.isPostMoveOverHole(a.coll,true)){Vec2.assignC(a.coll.accelDir,0,0);Vec2.assignC(a.coll.vel,0,0)}return false}});var g=Vec2.create(),h=Vec2.create();ig.ACTION_STEP.MOVE_TO_ENTITY_DISTANCE=
ig.ActionStepBase.extend({entity:0,min:0,max:0,maxTime:0,subRadius:false,_wm:new ig.Config({attributes:{entity:{_type:"Entity",_info:"Entity to move to"},min:{_type:"Number",_info:"Minimum distance"},max:{_type:"Number",_info:"Maximum distance"},maxTime:{_type:"Number",_info:"Maximum time to move"},subRadius:{_type:"Boolean",_info:"If true, substract radius of entity bounds from distance to be evaluated."}}}),init:function(a){this.entity=a.entity;this.min=a.min;this.max=a.max;this.maxTime=a.maxTime;
this.subRadius=a.subRadius},start:function(a){a.stepTimer=a.stepTimer+this.maxTime},run:function(a){var b=ig.Event.getEntity(this.entity);if(!b)return true;var c=Vec2.sub(b.getCenter(g),a.getCenter(h)),d=Vec2.length(c);this.subRadius&&(d=d-(a.coll.size.x/2+b.coll.size.x/2));d<this.min&&Vec2.mulC(c,-1);Vec2.assign(a.coll.accelDir,c);(b=this.min<=d&&d<=this.max)&&Vec2.assignC(a.coll.accelDir,0,0);return a.stepTimer<=0||b}});ig.ACTION_STEP.MOVE_TO_ENTITY_CLOSEST_OFFSET=ig.ActionStepBase.extend({entity:0,
min:0,max:0,maxTime:0,subRadius:false,_wm:new ig.Config({attributes:{entity:{_type:"Entity",_info:"Entity to move to"},offsets:{_type:"Array",_info:"Minimum distance",_sub:{_type:"Vec2"}},maxTime:{_type:"Number",_info:"Maximum time to move"},forceTime:{_type:"Boolean",_info:"If true: wait at point until maxTime has been reached"}}}),init:function(a){this.entity=a.entity;this.offsets=a.offsets;this.maxTime=a.maxTime;this.forceTime=a.forceTime||false},start:function(a){a.stepTimer=a.stepTimer+this.maxTime;
var b=ig.Event.getEntity(this.entity);if(b){for(var b=ig.CollTools.getDistVec2(a.coll,b.coll,g),c=this.offsets.length,d=0,e=1E6;c--;){var f=this.offsets[c];Vec2.add(b,f);var h=Vec2.length(b);Vec2.sub(b,f);if(h<e){e=h;d=c}}a.offsetI=d}},run:function(a){var b=ig.Event.getEntity(this.entity);if(!b)return true;var c=ig.CollTools.getDistVec2(a.coll,b.coll,g);Vec2.add(c,this.offsets[a.offsetI]);Vec2.assign(a.coll.accelDir,c);var d=Vec2.length(c);if(a.coll.maxVel*a.coll.relativeVel>d*10)a.coll.relativeVel=
d/a.coll.maxVel*10;c=false;if(d<1){b=b.getCenter(g);Vec2.add(b,this.offsets[a.offsetI]);a.setPos(b.x-a.coll.size.x/2,b.y-a.coll.size.y/2,a.coll.pos.z);this.forceTime&&this.maxTime?Vec2.assignC(a.coll.accelDir,0,0):c=true}this.maxTime&&a.stepTimer<=0&&(c=true);if(c)a.coll.relativeVel=a.stepData.startRelativeVel;return c}});ig.ACTION_STEP.MOVE_TO_POINT=ig.ActionStepBase.extend({target:Vec3.create(),precise:false,_wm:new ig.Config({attributes:{target:{_type:"Vec3",_info:"Point to go to",_actorOption:true,
_visualize:true,_pointSelect:true},precise:{_type:"Boolean",_info:"Reach the target precisely, slowing down accordingly"},maxTime:{_type:"Number",_info:"If defined: move at most this amount of seconds towards point",_optional:true},forceTime:{_type:"Boolean",_info:"If true: wait at point until maxTime has been reached"}}}),init:function(a){assertContent(a,"target");this.target=a.target;this.precise=a.precise||false;this.maxTime=a.maxTime||0;this.forceTime=a.forceTime||false},start:function(a){if(this.precise)a.stepData.startRelativeVel=
a.coll.relativeVel;a.stepTimer=a.stepTimer+this.maxTime},run:function(a){var b=ig.Action.getVec3(this.target,a,d);if(b){b=Vec2.sub(b,a.getCenter());Vec2.assign(a.coll.accelDir,b);b=Vec2.length(b);if(this.precise&&a.coll.maxVel*a.coll.relativeVel>b*10)a.coll.relativeVel=b/a.coll.maxVel*10;var c=false;if(b<(this.precise?2:8))this.forceTime&&this.maxTime?Vec2.assignC(a.coll.accelDir,0,0):c=true;this.maxTime&&a.stepTimer<=0&&(c=true);if(c&&this.precise)a.coll.relativeVel=a.stepData.startRelativeVel;return c}return true}});
ig.ACTION_STEP.SYNC_ACTION_WITH_ENTITY=ig.ActionStepBase.extend({entity:null,_wm:new ig.Config({attributes:{entity:{_type:"Entity",_info:"Other entity to sync action with"}}}),init:function(a){this.entity=a.entity},start:function(a){a.stepSync++},run:function(a){var b=ig.Event.getEntity(this.entity);return!b?null:b.stepSync>=a.stepSync}});ig.ACTION_STEP.SET_Z_VEL=ig.ActionStepBase.extend({value:null,_wm:new ig.Config({attributes:{value:{_type:"Number",_info:"New Z Vel value. Positive for up movement"}}}),
init:function(a){this.value=a.value},run:function(a){a.coll.vel.z=this.value;return true}});ig.ACTION_STEP.SCALE_VEL=ig.ActionStepBase.extend({value:Vec2.create(),_wm:new ig.Config({attributes:{value:{_type:"Vec2",_info:"Values multiplied with velocity",_actorOption:true}}}),init:function(a){this.value=a.value},start:function(b){Vec2.assignC(b.coll.accelDir,0,0);var c=ig.Action.getVec2(this.value,b,a);c&&Vec2.mul(b.coll.vel,c)}});ig.ACTION_STEP.SET_FLOAT_HEIGHT=ig.ActionStepBase.extend({value:null,
_wm:new ig.Config({attributes:{value:{_type:"Number",_info:"New float height"}}}),init:function(a){this.value=a.value},run:function(a){a.coll.float.height=this.value;return true}});ig.ACTION_STEP.SET_FLOAT_PARAMS=ig.ActionStepBase.extend({speed:null,accel:null,variance:null,_wm:new ig.Config({attributes:{variance:{_type:"Number",_info:"New float variance (specifies how muchy entitie moves up and down during floating)",_default:4,_optional:true},accel:{_type:"Number",_info:"New float acceleration",
_default:1,_optional:true},speed:{_type:"Number",_info:"New float speed",_default:300,_optional:true}}}),init:function(a){if(a.speed!==void 0)this.speed=a.speed;if(a.accel!==void 0)this.accel=a.accel;if(a.variance!==void 0)this.variance=a.variance},run:function(a){if(this.speed!==null)a.coll.float.maxSpeed=this.speed;if(this.accel!==null)a.coll.float.accel=this.accel;if(this.variance!==null)a.coll.float.variance=this.variance;return true}});ig.ACTION_STEP.SET_FLY_HEIGHT=ig.ActionStepBase.extend({value:null,
_wm:new ig.Config({attributes:{value:{_type:"Number",_info:"New float height"}}}),init:function(a){this.value=a.value},run:function(a){a.fly.height=this.value;if(this.value==0)a.coll.float.height=0;return true}});ig.ACTION_STEP.SET_FLY_KEEP_HEIGHT=ig.ActionStepBase.extend({value:null,_wm:new ig.Config({attributes:{value:{_type:"Boolean",_info:"If true: Entity will keep flight height and not adjust with target"}}}),init:function(a){this.value=a.value},run:function(a){a.fly.keepHeight=this.value;return true}});
ig.ACTION_STEP.FORCE_FLY_HEIGHT=ig.ActionStepBase.extend({value:null,_wm:new ig.Config({attributes:{}}),init:function(){},run:function(a){var b=a.getTarget();if(b){var c=0,c=a.fly.keepHeight?a.fly.lastZ+a.fly.height:b.coll.pos.z+a.fly.height;a.setZPos(c)}return true}});ig.ACTION_STEP.WAIT_UNTIL_Z_DISTANCE=ig.ActionStepBase.extend({distance:0,_wm:new ig.Config({attributes:{distance:{_type:"Number",_info:"Wait until z distance to target is below this value"},fixEntityZ:{_type:"Boolean",_info:"If true, make entity stay fixed at the destination height, no zVel or gravity"}}}),
init:function(a){this.distance=a.distance||0;this.fixEntityZ=a.fixEntityZ||false},start:function(a){var b=a.getTarget();if(b)a.stepData.zDelta=a.coll.pos.z-b.coll.pos.z},run:function(a){var b=a.getTarget();if(!b||a.coll.pos.z==a.coll.baseZPos)return true;var c=a.coll.pos.z-b.coll.pos.z;if(a.stepData.zDelta>0?c<=this.distance:c>=this.distance){if(this.fixEntityZ){a.coll.pos.z=b.coll.pos.z+this.distance;a.coll.vel.z=0;a.coll.zGravityFactor=0}return true}return false}});ig.ACTION_STEP.WAIT_UNTIL_Z_ZENITH=
ig.ActionStepBase.extend({minWait:0,_wm:new ig.Config({attributes:{minWait:{_type:"Number",_info:"Minimum Time to wait"}}}),init:function(a){this.minWait=a.minWait||0},start:function(a){a.stepTimer=a.stepTimer+this.minWait},run:function(a){return a.coll.vel.z<=0?a.stepTimer<=0:false}});ig.ACTION_STEP.STOP_Z_ZENITH=ig.ActionStepBase.extend({minWait:0,_wm:new ig.Config({attributes:{minWait:{_type:"Number",_info:"Minimum Time to wait"}}}),init:function(a){this.minWait=a.minWait||0},start:function(a){a.stepTimer=
a.stepTimer+this.minWait},run:function(a){if(a.coll.vel.z<=0){a.coll.vel.z=0;a.coll.zGravityFactor=0;return a.stepTimer<=0}return false}});ig.ACTION_STEP.FLY_TO_POINT=ig.ActionStepBase.extend({target:Vec2.create(),precise:false,maxFlySpeed:0,flyVariance:0,keepFloating:false,_wm:new ig.Config({attributes:{target:{_type:"Vec3",_info:"Point to go to",_actorOption:true,_visualize:true,_pointSelect:true},maxFlySpeed:{_type:"Number",_info:"Max flight speed"},flyVariance:{_type:"Number",_info:"How much the entity will vary around flight height."},
precise:{_type:"Boolean",_info:"Reach the target precisely, slowing down accordingly"},keepFloating:{_type:"Boolean",_info:"Keep floating in the air after step is over"}}}),init:function(a){assertContent(a,"target");this.target=a.target;this.precise=a.precise||false;this.maxFlySpeed=a.maxFlySpeed||0;this.flyVariance=a.flyVariance||0;this.keepFloating=a.keepFloating||false},start:function(a){a.stepData.floatHeight=a.coll.float.height;a.stepData.floatVariance=a.coll.float.variance;a.stepData.floatMaxSpeed=
a.coll.float.maxSpeed;a.stepData.floatHeightOnMove=a.floatHeightOnMove;a.stepData.jumpinEnabled=a.jumpingEnabled;a.stepData.prevDist=-1;if(this.precise)a.stepData.startRelativeVel=a.coll.relativeVel;a.jumpingEnabled=false;a.floatHeightOnMove=false},run:function(a){var b=ig.Action.getVec3(this.target,a,d);if(b){var c=a.coll,e=Vec2.sub(b,a.getCenter()),f=Vec2.length(e);if(this.precise&&f<2){Vec2.assign(c.accelDir,0,0);Vec2.assign(c.vel,0,0)}else{if(this.precise&&c.maxVel*c.relativeVel>f*10)c.relativeVel=
f/c.maxVel*10;f>=(this.precise?2:8)&&Vec2.assign(c.accelDir,e)}if(a.stepData.prevDist)a.stepData.prevDist=a.stepData.prevDist!=-1&&f>a.stepData.prevDist?0:f;if(!a.stepData.prevDist){console.log("PREV DIST CANCEL!");f=0;Vec2.assign(c.accelDir,0,0);Vec2.assign(c.vel,0,0)}a.coll.float.height=b.z-c.baseZPos;a.coll.float.variance=this.flyVariance;a.coll.float.maxSpeed=this.maxFlySpeed;if(f<(this.precise?2:8)&&Math.abs(b.z-c.pos.z)<8){if(!this.keepFloating){a.coll.float.height=a.stepData.floatHeight;a.coll.float.variance=
a.stepData.floatVariance;a.coll.float.maxSpeed=a.stepData.maxSpeed;a.floatHeightOnMove=a.stepData.floatHeightOnMove}a.jumpingEnabled=a.stepData.jumpingEnabled;if(this.precise)c.relativeVel=a.stepData.startRelativeVel;return true}return false}return true}});ig.ACTION_STEP.MOVE_TO_DIR=ig.ActionStepBase.extend({dir:Vec2.create(),time:0,_wm:new ig.Config({attributes:{dir:{_type:"Vec2",_info:"Direction to go to",_actorOption:true},time:{_type:"Number",_info:"Amount of time to move along this point"},stopBeforeEdge:{_type:"Boolean",
_info:"If true: Stop before falling down from edge when further moving forward"}}}),init:function(a){assertContent(a,"dir","time");this.dir=a.dir;this.time=a.time;this.stopBeforeEdge=a.stopBeforeEdge},start:function(a){a.stepTimer=a.stepTimer+this.time},run:function(b){var c=ig.Action.getVec2(this.dir,b,a);c&&Vec2.assign(b.coll.accelDir,c);if(this.stopBeforeEdge&&ig.CollTools.isPostMoveOverHole(b.coll,true)){Vec2.assignC(b.coll.accelDir,0,0);Vec2.assignC(b.coll.vel,0,0)}return b.stepTimer<=0}});ig.ACTION_STEP.MOVE_TO_LINE=
ig.ActionStepBase.extend({target1:Vec2.create(),target2:Vec2.create(),_wm:new ig.Config({attributes:{target1:{_type:"Vec2",_info:"First Point of line",_visualize:true,_pointSelect:true},target2:{_type:"Vec2",_info:"Second Point of line",_visualize:true,_pointSelect:true}}}),init:function(a){assertContent(a,"target1","target2");this.target1=a.target1;this.target2=a.target2},start:function(a){var b=ig.Action.getVec2(this.target1,a,d),e=ig.Action.getVec2(this.target2,a,c);if(b&&e){var f=Math.random();
a.stepData.dest=Vec2.lerp(b,e,f,Vec2.create())}else a.stepData.dest=null},run:function(b){if(b.stepData.dest){var c=Vec2.sub(b.stepData.dest,b.getCenter(),a);Vec2.assign(b.coll.accelDir,c);return Vec2.length(c)<4}return true}});ig.ACTION_STEP.MOVE_RANDOM=ig.ActionStepBase.extend({minTime:0,maxTime:10,dirChanges:1,_wm:new ig.Config({attributes:{minTime:{_type:"Number",_info:"Minimum time to move"},maxTime:{_type:"Number",_info:"Maximum time to move"},dirChanges:{_type:"Number",_info:"How often to change direction while moving. Minimum is 1"},
stopBeforeEdge:{_type:"Boolean",_info:"If true: Stop before falling down from edge when further moving forward"}}}),init:function(a){assertContent(a,"minTime","maxTime");this.minTime=a.minTime;this.maxTime=a.maxTime;this.dirChanges=a.dirChanges||1;this.stopBeforeEdge=a.stopBeforeEdge},start:function(a){a.stepData.maxTime=this.minTime+Math.random()*(this.maxTime-this.minTime);a.stepTimer=a.stepTimer+a.stepData.maxTime;a.stepData.dirChangeTimer=0},run:function(a){if(a.stepTimer<=0)return true;if(a.coll.partlyBlockTimer>
0.2||a.stepData.dirChangeTimer<=0){a.coll.partlyBlockTimer=0;a.stepData.dirChangeTimer=a.stepData.dirChangeTimer+a.stepData.maxTime/this.dirChanges;var b=0;do b=Vec2.normalize(Vec2.createC(Math.random()-0.5,Math.random()-0.5));while(a.stepData.dir&&Vec2.dot(a.stepData.dir,b)>0.5);a.stepData.dir=b}a.stepData.dirChangeTimer=a.stepData.dirChangeTimer-ig.system.tick;Vec2.assign(a.coll.accelDir,a.stepData.dir);if(this.stopBeforeEdge&&ig.CollTools.isPostMoveOverHole(a.coll,true)){Vec2.assignC(a.coll.accelDir,
0,0);Vec2.assignC(a.coll.vel,0,0)}return false}});ig.ACTION_STEP.SET_WALK_ANIMS=ig.ActionStepBase.extend({config:null,_wm:new ig.Config({attributes:{config:{_type:"WalkAnimConfig",_info:"Name of walk anim config"}}}),init:function(a){assertContent(a,"config");this.config=a.config},run:function(a){a.setWalkAnims(this.config);return true}});ig.ACTION_STEP.SET_TARGET_WALK_ANIMS=ig.ActionStepBase.extend({config:null,_wm:new ig.Config({attributes:{config:{_type:"WalkAnimConfig",_info:"Name of walk anim config"}}}),
init:function(a){this.config=a.config},run:function(a){(a=a.getTarget())&&a.setWalkAnims(this.config);return true}});var i={S:100,M:150,L:180,XL:220,XXL:270};ig.ACTION_STEP.STOP_XY=ig.ActionStepBase.extend({_wm:new ig.Config({attributes:{}}),init:function(){},run:function(a){Vec2.assignC(a.coll.vel,0,0);Vec2.assignC(a.coll.accelDir,0,0);return true}});ig.ACTION_STEP.JUMP=ig.ActionStepBase.extend({jumpSpeed:null,wait:false,ignoreSound:false,_wm:new ig.Config({attributes:{jumpHeight:{_type:"String",
_info:"Height of jump",_select:i},wait:{_type:"Boolean",_info:"Wait until entity landed on ground"},ignoreSounds:{_type:"Boolean",_info:"If true, don't play any sound when jumping up"}}}),init:function(a){assertContent(a,"jumpHeight");this.jumpSpeed=i[a.jumpHeight];this.wait=a.wait||false;this.ignoreSounds=a.ignoreSounds||false},start:function(a){if(!a.coll.groundConnect){a.doJump(this.jumpSpeed,null,null,null,this.ignoreSounds);if(!this.wait)a.jumping=false}},run:function(a){return a.coll.groundConnect?
true:this.wait?a.coll.vel.z<=0&&a.coll.pos.z-a.coll.baseZPos<=ig.COLLISION.EPS:true}});ig.ACTION_STEP.JUMP_TO_POINT=ig.ActionStepBase.extend({adjustAbove:0,offset:null,_wm:new ig.Config({attributes:{target:{_type:"Vec3",_info:"Point to jump to",_actorOption:true,_visualize:true,_pointSelect:true},forceDuration:{_type:"Number",_info:"If defined: force a specific jump duration, setting speed and velocity accordingly. Otherwise, jump height will adapted so point will be reached with current velocity",
_optional:true},forceHeight:{_type:"Number",_info:"If defined: force a minimum height for jump",_optional:true},ignoreSounds:{_type:"Boolean",_info:"If true, don't play any sound when jumping up"}}}),init:function(a){this.target=a.target;this.forceDuration=a.forceDuration||0;this.forceHeight=a.forceHeight||0;this.ignoreSounds=a.ignoreSounds||false},start:function(b){var e=ig.Action.getVec3(this.target,b,d),f=b.getAlignedPos(ig.ENTITY_ALIGN.BOTTOM,c),f=Vec2.sub(e,f,a),g=Vec2.length(f),h=b.coll.maxVel*
b.coll.relativeVel,i,j;if(this.forceHeight){j=ig.CollTools.getJumpSpeedToHeight(b.coll,b.coll.pos.z+this.forceHeight);i=ig.CollTools.getJumpDuration(b.coll,e.z,j);h=g/i}else{if(this.forceDuration){i=this.forceDuration;h=g/i}else i=g/h;j=ig.CollTools.getJumpSpeedForDuration(b.coll,e.z,i)}b.doJump(j,null,null,null,this.ignoreSounds);b.coll.friction.air=0;Vec2.assign(b.coll.vel,f);Vec2.length(b.coll.vel,h);b.stepData.jumpSpeed=h;b.faceDirFixed||Vec2.assign(b.face,f)},run:function(b){var c=ig.Action.getVec3(this.target,
b,d);if(c){var c=Vec2.sub(c,b.getCenter(a)),e=Vec2.length(c),f=b.stepData.jumpSpeed;b.stepData.jumpSpeed*ig.system.tick>e&&(f=e*ig.system.tick);if(e<2)Vec2.assign(b.coll.vel,0,0);else{Vec2.length(c,f);Vec2.assign(b.coll.vel,c)}}else return true;if(b.coll.vel.z<=0&&b.coll.pos.z==b.coll.baseZPos){Vec2.assignC(b.coll.vel,0,0);return true}return false}});ig.ACTION_STEP.SET_GROUND_CONNECTED=ig.ActionStepBase.extend({value:false,_wm:new ig.Config({attributes:{value:{_type:"String",_info:"Type of Ground connected",
_select:ig.COLL_GROUND_CONNECT}}}),init:function(a){assertContent(a,"value");this.value=ig.COLL_GROUND_CONNECT[a.value]},run:function(a){a.coll.groundConnect=this.value;return true}});ig.ACTION_STEP.SET_JUMPING=ig.ActionStepBase.extend({value:false,_wm:new ig.Config({attributes:{value:{_type:"Boolean",_info:"true if jumping is enabled"}}}),init:function(a){assertContent(a,"value");this.value=a.value},run:function(a){a.jumpingEnabled=this.value;return true}});ig.ACTION_STEP.SET_Z_GRAVITY_FACTOR=ig.ActionStepBase.extend({value:0,
_wm:new ig.Config({attributes:{value:{_type:"Number",_info:"The new z gravity factor"}}}),init:function(a){assertContent(a,"value");this.value=a.value},run:function(a){a.coll.zGravityFactor=this.value;return true}});ig.ACTION_STEP.SET_SIZE=ig.ActionStepBase.extend({value:0,_wm:new ig.Config({attributes:{size:{_type:"Offset",_info:"Set new size of entity, keeping XY center alignment. WARNING: MIGHT RESULT IN PHYSICS ISSUES! ONLY USE WHEN NO OVERLAPPING WITH SURROUNDING IS GUARANTEED!"},shiftOnCollision:{_type:"Boolean",
_info:"If true: shift entity when colliding with walls on expansion. NOTE: MIGHT NOT ALWAYS WORK"}}}),init:function(a){this.size=a.size;this.shiftOnCollision=a.shiftOnCollision||false},run:function(a){a.coll.setSize(this.size.x,this.size.y,this.size.z,true,this.shiftOnCollision);return true}});ig.ACTION_STEP.SET_SPEED=ig.ActionStepBase.extend({value:0,_wm:new ig.Config({attributes:{value:{_type:"NumberExpression",_info:"New speed value"}}}),init:function(a){assertContent(a,"value");this.value=a.value},
run:function(a){a.coll.maxVel=ig.Event.getExpressionValue(this.value);return true}});ig.ACTION_STEP.SET_MAX_ZVEL=ig.ActionStepBase.extend({value:0,_wm:new ig.Config({attributes:{value:{_type:"NumberExpression",_info:"New speed value"}}}),init:function(a){assertContent(a,"value");this.value=a.value},run:function(a){a.coll.maxZVel=ig.Event.getExpressionValue(this.value);return true}});ig.ACTION_STEP.SET_RELATIVE_SPEED=ig.ActionStepBase.extend({value:0,_wm:new ig.Config({attributes:{value:{_type:"NumberExpression",
_info:"Relative Speed value between 0 and 1"}}}),init:function(a){assertContent(a,"value");this.value=a.value},run:function(a){a.coll.relativeVel=ig.Event.getExpressionValue(this.value);return true}});ig.ACTION_STEP.SET_ACCEL_SPEED=ig.ActionStepBase.extend({value:0,_wm:new ig.Config({attributes:{value:{_type:"Number",_info:"New accel speed value. Something between 1 = fast acceleration. 0 = basically no acceleration"}}}),init:function(a){assertContent(a,"value");this.value=a.value},run:function(a){a.coll.accelSpeed=
this.value;return true}});ig.ACTION_STEP.SET_STATIC_TIME=ig.ActionStepBase.extend({value:0,_wm:new ig.Config({attributes:{value:{_type:"Boolean",_info:"Value of static time"}}}),init:function(a){this.value=a.value},run:function(a){a.coll.time.animStatic=this.value;return true}});ig.ACTION_STEP.DETACH_TIME_PARENT=ig.ActionStepBase.extend({_wm:new ig.Config({attributes:{}}),init:function(){},run:function(a){a.coll.time.parent=null;return true}});ig.ACTION_STEP.SET_WEIGHT=ig.ActionStepBase.extend({value:0,
_wm:new ig.Config({attributes:{value:{_type:"Number",_info:"New weight value"}}}),init:function(a){assertContent(a,"value");this.value=a.value},run:function(a){a.coll.weight=this.value;return true}});ig.ACTION_STEP.SET_FRICTION=ig.ActionStepBase.extend({value:0,_wm:new ig.Config({attributes:{value:{_type:"Number",_info:"Friction. Value between 0 (slide) and 1 (brake fast)"}}}),init:function(a){assertContent(a,"value");this.value=a.value},run:function(a){a.coll.friction.ground=this.value;return true}});
ig.ACTION_STEP.SET_AIR_FRICTION=ig.ActionStepBase.extend({value:0,_wm:new ig.Config({attributes:{value:{_type:"Number",_info:"Air Friction. Value between 0 (slide) and 1 (brake fast)"}}}),init:function(a){assertContent(a,"value");this.value=a.value},run:function(a){a.coll.friction.air=this.value;return true}});ig.ACTION_STEP.SET_TERRAIN_FRICTION_IGNORE=ig.ActionStepBase.extend({_wm:new ig.Config({attributes:{value:{_type:"Boolean",_info:"If true: ignore terrain friction."}}}),init:function(a){this.value=
a.value},run:function(a){a.coll.friction.ignoreTerrain=this.value;return true}});ig.ACTION_STEP.SET_SHADOW=ig.ActionStepBase.extend({size:0,_wm:new ig.Config({attributes:{size:{_type:"Number",_info:"Size of shadow (in pixel diameter)"},shadowType:{_type:"String",_info:"Set size of shadow",_select:ig.COLL_SHADOW_TYPE,_optional:true},shadowScaleY:{_type:"Number",_info:"Y scaling for Shadow",_default:1,_optional:true}}}),init:function(a){this.size=a.size;this.shadowType=a.shadowType;this.shadowScaleY=
a.shadowScaleY},run:function(a){a.coll.shadow.size=this.size;if(this.shadowType)a.coll.shadow.type=ig.COLL_SHADOW_TYPE[this.shadowType];if(this.shadowScaleY!==void 0)a.coll.shadow.scaleY=this.shadowScaleY;return true}});ig.ACTION_STEP.SET_Z_BOUNCINESS=ig.ActionStepBase.extend({value:0,_wm:new ig.Config({attributes:{value:{_type:"Number",_info:"Z Bounciness. Value between 0 (none) and 1 (full Speed up again)"}}}),init:function(a){assertContent(a,"value");this.value=a.value},run:function(a){a.coll.zBounciness=
this.value;return true}});ig.ACTION_STEP.SET_BOUNCINESS=ig.ActionStepBase.extend({value:0,_wm:new ig.Config({attributes:{value:{_type:"Number",_info:"Bounciness. Value between 0 (none) and 1 (full Speed up again)"}}}),init:function(a){this.value=a.value},run:function(a){a.coll.bounciness=this.value;return true}});ig.ACTION_STEP.SET_FACE_FIX=ig.ActionStepBase.extend({value:false,_wm:new ig.Config({attributes:{value:{_type:"Boolean",_info:"Wether face direction is fixed or not"}}}),init:function(a){assertContent(a,
"value");this.value=a.value},run:function(a){a.faceDirFixed=this.value;return true}});ig.ACTION_STEP.SET_FACE=ig.ActionStepBase.extend({face:null,rotate:false,rotateSpeed:3,_wm:new ig.Config({attributes:{face:{_type:"Face",_info:"Direction to face",_actorOption:true},rotate:{_type:"Boolean",_info:"Rotate entity toward direction",_default:true},rotateSpeed:{_type:"Number",_info:"Speed of rotation. Full circles per second",_default:3}}}),init:function(a){assertContent(a,"face");this.face=a.face;this.rotate=
a.rotate||false;this.rotateSpeed=a.rotateSpeed||3},start:function(){},run:function(b){Vec2.assignC(b.coll.accelDir,0,0);var c=ig.Action.getFace(this.face,b,a);if(this.rotate)return Vec2.rotateToward(b.face,c,Math.PI*2*ig.system.tick*this.rotateSpeed);Vec2.assign(b.face,c);return true}});var j={OWN_FACE:function(a){return a.face},ENEMY_DIR:function(a){var b=a.getTarget();return!b?null:ig.CollTools.getDistVec2(a.coll,b.coll,d)}};ig.ACTION_STEP.SET_CLOSEST_FACE=ig.ActionStepBase.extend({face:null,rotate:false,
rotateSpeed:3,_wm:new ig.Config({attributes:{searchType:{_type:"String",_info:"How to determine best face direction",_select:j},faces:{_type:"Array",_info:"Face direction options",_sub:{_type:"Face",_select:ig.ActorEntity.FACE8}},rotate:{_type:"Boolean",_info:"Rotate entity toward direction",_default:true},rotateSpeed:{_type:"Number",_info:"Speed of rotation. Full circles per second",_default:3}}}),init:function(a){this.faces=a.faces;this.rotate=a.rotate||false;this.rotateSpeed=a.rotateSpeed||3;this.searchType=
j[a.searchType]||j.OWN_FACE},start:function(b){var c=null,d=-1;b.getTarget();var e=this.searchType(b);if(e)for(var f=this.faces.length;f--;){var g=ig.Action.getFace(this.faces[f],b,a),g=Vec2.angle(g,e);if(d==-1||g<d){d=g;c=this.faces[f]}}b.stepData.bestFace=c},run:function(b){Vec2.assignC(b.coll.accelDir,0,0);if(!b.stepData.bestFace)return true;var c=ig.Action.getFace(b.stepData.bestFace,b,a);if(this.rotate)return Vec2.rotateToward(b.face,c,Math.PI*2*ig.system.tick*this.rotateSpeed);Vec2.assign(b.face,
c);return true}});ig.ACTION_STEP.SET_FACE_TO_VEL=ig.ActionStepBase.extend({_wm:new ig.Config({attributes:{}}),init:function(){},start:function(a){Vec2.assign(a.face,a.coll.vel)}});ig.ACTION_STEP.ROTATE_FACE=ig.ActionStepBase.extend({time:0,turn:0,_wm:new ig.Config({attributes:{time:{_type:"Number",_info:"Amount of time to rotate Face"},turn:{_type:"Number",_info:"The amount to rotate the face clockwise. 1.0 = full rotation"},random:{_type:"Number",_info:"If defined, rotate face randomly. 1=100% random. 0.5= at least 50%, rest random"},
towardTarget:{_type:"Boolean",_info:"If true: always rotate face to end up closer towards target direction if rotation is positive. If negative: will always rotate away!",_optional:true},notPastTarget:{_type:"Boolean",_info:"If true: do not rotate past the target",_optional:true}}}),init:function(a){this.time=a.time;this.turn=a.turn;this.random=a.random||0;this.towardTarget=a.towardTarget||false;this.notPastTarget=a.notPastTarget||false},start:function(b){b.stepTimer=this.time;b.stepData.turn=this.turn*
(1-Math.random()*this.random);if(this.towardTarget){var c=b.getTarget();if(c){c=ig.CollTools.getDistVec2(b.coll,c.coll,a);if(Vec2.areClockwise(b.face,c))b.stepData.turn=-b.stepData.turn;if(this.notPastTarget){var c=Vec2.angle(b.face,c)/(Math.PI*2),d=Math.abs(b.stepData.turn);if(c<d)b.stepData.turn=b.stepData.turn*(c/d)}}}},run:function(a){if(a.stepData.turn){Vec2.assignC(a.coll.accelDir,0,0);var b=ig.system.tick;if(b>a.stepTimer)b=a.stepTimer;b<0&&(b=0);Vec2.rotate(a.face,(this.time?a.stepData.turn*
b/this.time:a.stepData.turn)*Math.PI*2)}return a.stepTimer<=0}});ig.ACTION_STEP.SET_FACE_TO_DIR=ig.ActionStepBase.extend({dir:Vec2.create(),_wm:new ig.Config({attributes:{dir:{_type:"Vec2",_info:"Direction to go to",_actorOption:true}}}),init:function(a){this.dir=a.dir},start:function(b){Vec2.assignC(b.coll.accelDir,0,0);var c=ig.Action.getVec2(this.dir,b,a);c&&Vec2.assign(b.face,c)}});ig.ACTION_STEP.SET_FACE_TO_ENTITY=ig.ActionStepBase.extend({entity:null,rotate:false,rotateSpeed:3,_wm:new ig.Config({attributes:{entity:{_type:"Entity",
_info:"Entity to look at"},rotate:{_type:"Boolean",_info:"Rotate entity toward direction",_default:true},rotateSpeed:{_type:"Number",_info:"Speed of rotation. Full circles per second",_default:3}}}),init:function(a){assertContent(a,"entity");this.entity=a.entity;this.rotate=a.rotate||false;this.rotateSpeed=a.rotateSpeed||3},run:function(a){Vec2.assignC(a.coll.accelDir,0,0);var b=ig.Event.getEntity(this.entity);if(!b)return true;b=Vec2.sub(b.getCenter(),a.getCenter());if(this.rotate)return Vec2.rotateToward(a.face,
b,Math.PI*2*ig.system.tick*this.rotateSpeed);Vec2.assign(a.face,b);return true}});ig.ACTION_STEP.SET_COLL_TYPE=ig.ActionStepBase.extend({value:0,_wm:new ig.Config({attributes:{value:{_type:"String",_info:"New collision type of entity",_select:ig.COLLTYPE}}}),init:function(a){assertContent(a,"value");assert(ig.COLLTYPE[a.value]!=void 0,"Coll Type '"+a.value+"' unknown!");this.value=ig.COLLTYPE[a.value]},run:function(a){a.coll.setType(this.value);return true}});ig.ACTION_STEP.SET_COLL_SHAPE=ig.ActionStepBase.extend({value:0,
_wm:new ig.Config({attributes:{value:{_type:"String",_info:"New collision shape of entity",_select:ig.COLLSHAPE}}}),init:function(a){this.value=ig.COLLSHAPE[a.value]},run:function(a){a.coll.shape=this.value;return true}});ig.ACTION_STEP.SET_SLIP_THROUGH=ig.ActionStepBase.extend({value:false,_wm:new ig.Config({attributes:{value:{_type:"Boolean",_info:"true if slip through is active (ignoring any kind of collision)"}}}),init:function(a){assertContent(a,"value");this.value=a.value},run:function(a){a.setSlipThrough(this.value);
return true}});ig.ACTION_STEP.SHOW_ANIMATION=ig.ActionStepBase.extend({anim:null,followUp:null,wait:null,viaWalkConfig:false,_wm:new ig.Config({attributes:{anim:{_type:"EntityAnim",_info:"Animation to play"},followUp:{_type:"EntityAnim",_info:"Animation to play after this animation",_optional:true},wait:{_type:"Boolean",_info:"Wait for animation to be finished"},viaWalkConfig:{_type:"Boolean",_info:"if true, fetch the animations via the entities walk config"}}}),init:function(a){assertContent(a,"anim");
this.anim=a.anim;this.followUp=a.followUp||null;this.wait=a.wait||false;this.viaWalkConfig=a.viaWalkConfig||false},start:function(a){this.viaWalkConfig?a.setCurrentAnim(a.walkAnims[this.anim],true,this.followUp?a.walkAnims[this.followUp]:null,true):a.setCurrentAnim(this.anim,true,this.followUp,true);a.animationFixed=true},run:function(a){if(!this.wait)return true;if(a.animState.loopCount>=1){a.animationFixed=false;return true}return false}});ig.ACTION_STEP.WAIT_UNTIL_ANIM_LOOP_END=ig.ActionStepBase.extend({_wm:new ig.Config({attributes:{}}),
init:function(){},start:function(){},run:function(a){return a.animState.getFrame()==0||a.animState.hasStopped()}});ig.ACTION_STEP.SHOW_PART_ANIMATION=ig.ActionStepBase.extend({anim:null,followUp:null,wait:null,_wm:new ig.Config({attributes:{partName:{_type:"String",_info:"Name of part to change animation from"},anim:{_type:"String",_info:"Animation to play"},followUp:{_type:"String",_info:"Animation to play after this animation",_optional:true}}}),init:function(a){assertContent(a,"anim");this.partName=
a.partName;this.anim=a.anim;this.followUp=a.followUp||null},start:function(a){for(var b=null,a=a.coll.subColls,c=a.length;c--;)if(a[c].entity.partName==this.partName){b=a[c].entity;break}if(b){b.setCurrentAnim(this.anim,true,this.followUp,true);b.animationFixed=true}}});ig.ACTION_STEP.SHOW_RANDOM_ANIMATION=ig.ActionStepBase.extend({randAnims:null,_wm:new ig.Config({attributes:{randAnims:{_type:"EntityAnimArray",_info:"A list of animations. One of them will be shown randomly"}}}),init:function(a){this.randAnims=
a.randAnims},start:function(a){var b=this.randAnims[Math.floor(Math.random()*this.randAnims.length)];a.setCurrentAnim(b,true,null,true);a.animationFixed=true}});ig.ACTION_STEP.SHOW_EXTERN_ANIM=ig.ActionStepBase.extend({animSheet:null,animName:null,followUpSheet:null,followUpName:null,wait:null,_wm:new ig.Config({attributes:{anim:{_type:"Animation",_info:"Animation to play"},followUp:{_type:"Animation",_info:"Animation to play after this animation",_optional:true},wait:{_type:"Boolean",_info:"Wait for animation to be finished"}}}),
init:function(a){assertContent(a,"anim");this.animSheet=new ig.AnimationSheet(a.anim.sheet);this.animName=a.anim.name;if(a.followUp){this.followUpSheet=new ig.AnimationSheet(a.followUp.sheet);this.followUpName=a.followUp.name}this.wait=a.wait||false},clearCached:function(){this.animSheet.decreaseRef();this.followUpSheet&&this.followUpSheet.decreaseRef()},start:function(a){var b=sc.playerSkins.replaceAnim(this.animSheet),c=sc.playerSkins.replaceAnim(this.followUpSheet);a.setCurrentAnim(b.anims[this.animName],
true,c&&c.anims[this.followUpName],true);a.animationFixed=true},run:function(a){if(!this.wait)return true;if(a.animState.loopCount>=1){a.animationFixed=false;return true}return false}});ig.ACTION_STEP.CLEAR_ANIMATION=ig.ActionStepBase.extend({_wm:new ig.Config({attributes:{}}),init:function(){},run:function(a){a.animationFixed=false;return true}});ig.ACTION_STEP.SET_COLL_SIZE=ig.ActionStepBase.extend({_wm:new ig.Config({attributes:{size:{_type:"Offset",_info:"New size of coll entry"}}}),init:function(a){this.size=
a.size},start:function(a){a.coll.setSize(this.size.x,this.size.y,this.size.z,true)}});ig.ACTION_STEP.CHANGE_VAR_NUMBER=ig.ActionStepBase.extend({varName:null,changeType:null,value:0,_wm:new ig.Config({attributes:{varName:{_type:"VarName",_info:"Variable to change",_withActor:true},changeType:{_type:"String",_info:"Type of modification",_select:{set:1,add:1,sub:1,mul:1,div:1,mod:1}},value:{_type:"NumberExpression",_info:"Value to modify with"}},label:function(){return wm.printVarChange(this,"CHANGE_VAR_NUMBER",
"NumberExpression")}}),init:function(a){assertContent(a,"varName","changeType","value");this.varName=a.varName;this.changeType=a.changeType;this.value=a.value},run:function(a){var a=ig.Action.getVarName(this.varName,a),b=ig.Event.getExpressionValue(this.value);if(a){b=b*1;if(isNaN(b))ig.log("CHANGE_VAR_NUMBER: (Actor) Invalid value!");else{if(ig.vars[this.changeType]){ig.vars[this.changeType](a,b);return true}ig.log("CHANGE_VAR_NUMBER: (Actor) Invalid change type")}}else ig.log("CHANGE_VAR_NUMBER: (Actor) Variable Name is not a String!")}});
ig.ACTION_STEP.SET_RANDOM_VAR_NUMBER=ig.ActionStepBase.extend({varName:null,min:0,max:0,_wm:new ig.Config({attributes:{varName:{_type:"VarName",_info:"Variable to change",_withActor:true},min:{_type:"Integer",_info:"Start value"},max:{_type:"Integer",_info:"End value"}},label:function(){return"<b>RANDOM_NUMBER</b> <code>"+wmPrint("VarName",this.varName)+" ["+wmPrint("Integer",this.min)+", "+wmPrint("Integer",this.max)+"]</code>"}}),init:function(a){assertContent(a,"varName","min","max");this.varName=
a.varName;this.min=a.min;this.max=a.max},run:function(){var a=ig.Event.getVarName(this.varName);if(a){ig.vars.set(a,~~(Math.random()*this.max)+this.min);return true}ig.log("CHANGE_VAR_NUMBER: (Actor) Variable Name is not a String!")}});ig.ACTION_STEP.CHANGE_VAR_BOOL=ig.ActionStepBase.extend({varName:null,changeType:null,value:0,_wm:new ig.Config({attributes:{varName:{_type:"VarName",_info:"Variable to change",_withActor:true},changeType:{_type:"String",_info:"Type of modification",_select:{set:1,
and:1,or:1,xor:1}},value:{_type:"BooleanExpression",_info:"Value to modify with"}},label:function(){return wm.printVarChange(this,"CHANGE_VAR_BOOL","BooleanExpression")}}),init:function(a){assertContent(a,"varName","changeType","value");this.varName=a.varName;this.changeType=a.changeType;this.value=a.value},run:function(a){var a=ig.Action.getVarName(this.varName,a),b=ig.Event.getExpressionValue(this.value);if(a){b=!!b;if(ig.vars[this.changeType]){ig.vars[this.changeType](a,b);return true}ig.log("CHANGE_VAR_BOOL: Invalid change type")}else ig.log("CHANGE_VAR_BOOL: Variable Name is not a String!")}});
ig.ACTION_STEP.CHANGE_VAR_STRING=ig.ActionStepBase.extend({varName:null,changeType:null,value:0,_wm:new ig.Config({attributes:{varName:{_type:"VarName",_info:"Variable to change",_withActor:true},changeType:{_type:"String",_info:"Type of modification",_select:{set:1,append:1,prepend:2}},value:{_type:"StringExpression",_info:"Value to modify with"}},label:function(){return wm.printVarChange(this,"CHANGE_VAR_STRING","StringExpression")}}),init:function(a){assertContent(a,"varName","changeType","value");
this.varName=a.varName;this.changeType=a.changeType;this.value=a.value},run:function(a){var a=ig.Action.getVarName(this.varName,a),b=ig.Event.getExpressionValue(this.value);if(a){b=""+b;if(ig.vars[this.changeType]){ig.vars[this.changeType](a,b);return true}ig.log("CHANGE_VAR_STRING: Invalid change type")}else ig.log("CHANGE_VAR_STRING: Variable Name is not a String!")}});ig.ACTION_STEP.CHANGE_VAR_LANG=ig.ActionStepBase.extend({varName:null,changeType:null,value:0,_wm:new ig.Config({attributes:{varName:{_type:"VarName",
_info:"Variable to change",_withActor:true},changeType:{_type:"String",_info:"Type of modification",_select:{set:1,append:1,prepend:2}},value:{_type:"LangLabel",_info:"Value to modify with"}},label:function(){return wm.printVarChange(this,"CHANGE_VAR_LANG","LangLabel")}}),init:function(a){assertContent(a,"varName","changeType","value");this.varName=a.varName;this.changeType=a.changeType;this.value=new ig.LangLabel(a.value)},run:function(a){var a=ig.Action.getVarName(this.varName,a),b=this.value.toString();
if(a){b=""+b;if(ig.vars[this.changeType]){ig.vars[this.changeType](a,b);return true}ig.log("CHANGE_VAR_LANG: Invalid change type")}else ig.log("CHANGE_VAR_LANG: Variable Name is not a String!")}});ig.ACTION_STEP.SET_ATTRIB_VEC2=ig.ActionStepBase.extend({name:null,value:null,_wm:new ig.Config({attributes:{name:{_type:"StringExpression",_info:"Name of actor attribute to set"},value:{_type:"Vec2Expression",_info:"Vec2 value to be set",_visualize:true,_pointSelect:true},changeConnected:{_type:"String",
_info:"Change attribute to an entity connected to this one",_select:ig.ACTOR_ATTRIB_CONNECTION,_optional:true}}}),init:function(a){assertContent(a,"name","value");this.name=a.name;this.value=a.value;if(a.changeConnected)this.changeConnected=ig.ACTOR_ATTRIB_CONNECTION[a.changeConnected]},run:function(a){var b=ig.Event.getExpressionValue(this.name),a=this.changeConnected&&this.changeConnected(a)||a,c=ig.Event.getExpressionValue(this.value);a.setAttribute(b,c);return true}});ig.ACTION_STEP.SET_ATTRIB_BOOL=
ig.ActionStepBase.extend({name:null,value:null,_wm:new ig.Config({attributes:{name:{_type:"StringExpression",_info:"Name of actor attribute to set"},value:{_type:"BooleanExpression",_info:"Bool value to be set"},changeConnected:{_type:"String",_info:"Change attribute to an entity connected to this one",_select:ig.ACTOR_ATTRIB_CONNECTION,_optional:true}}}),init:ig.ACTION_STEP.SET_ATTRIB_VEC2.prototype.init,run:ig.ACTION_STEP.SET_ATTRIB_VEC2.prototype.run});var k={set:function(a,b){return b},append:function(a,
b){return a+b},prepend:function(a,b){return b+a}};ig.ACTION_STEP.SET_ATTRIB_STRING=ig.ActionStepBase.extend({name:null,value:null,_wm:new ig.Config({attributes:{name:{_type:"StringExpression",_info:"Name of actor attribute to set"},value:{_type:"StringExpression",_info:"String value to be set"},changeType:{_type:"String",_info:"Type of modification",_select:k,_optional:true},changeConnected:{_type:"String",_info:"Change attribute to an entity connected to this one",_select:ig.ACTOR_ATTRIB_CONNECTION,
_optional:true}}}),init:function(a){this.name=a.name;this.value=a.value;this.changeType=k[a.changeType]||k.set;if(a.changeConnected)this.changeConnected=ig.ACTOR_ATTRIB_CONNECTION[a.changeConnected]},run:function(a){var b=ig.Event.getExpressionValue(this.name),a=this.changeConnected&&this.changeConnected(a)||a,c=ig.Event.getExpressionValue(this.value),d=a.getAttribute(b)||"",c=this.changeType(d,c);a.setAttribute(b,c);return true}});var l={set:function(a,b){return b},add:function(a,b){return a+b},
sub:function(a,b){return a-b},mul:function(a,b){return a*b},div:function(a,b){return a/b},mod:function(a,b){return a%b}};ig.ACTION_STEP.SET_ATTRIB_NUMBER=ig.ActionStepBase.extend({attribName:null,changeOperator:null,value:0,_wm:new ig.Config({attributes:{attribName:{_type:"StringExpression",_info:"Name of Var"},changeType:{_type:"String",_info:"Type of modification",_select:l},value:{_type:"NumberExpression",_info:"Value to modify with"},changeConnected:{_type:"String",_info:"Change attribute to an entity connected to this one",
_select:ig.ACTOR_ATTRIB_CONNECTION,_optional:true}}}),init:function(a){this.attribName=a.attribName;this.changeOperator=l[a.changeType]||l.set;this.value=a.value||0;if(a.changeConnected)this.changeConnected=ig.ACTOR_ATTRIB_CONNECTION[a.changeConnected]},run:function(a){var b=ig.Event.getExpressionValue(this.attribName),a=this.changeConnected&&this.changeConnected(a)||a,c=a.getAttribute(b)||0,d=ig.Event.getExpressionValue(this.value),c=this.changeOperator(c,d*1);a.setAttribute(b,c);return true}});
ig.ACTION_STEP.SET_ATTRIB_NUMBER_RANDOM=ig.ActionStepBase.extend({attribName:null,_wm:new ig.Config({attributes:{attribName:{_type:"String",_info:"Name of Var"},changeType:{_type:"String",_info:"Type of modification",_select:l},minValue:{_type:"NumberExpression",_info:"Value to modify with"},maxValue:{_type:"NumberExpression",_info:"Value to modify with"},changeConnected:{_type:"String",_info:"Change attribute to an entity connected to this one",_select:ig.ACTOR_ATTRIB_CONNECTION,_optional:true}}}),
init:function(a){this.attribName=a.attribName;this.changeOperator=l[a.changeType]||l.set;this.minValue=a.minValue||0;this.maxValue=a.maxValue||0;if(a.changeConnected)this.changeConnected=ig.ACTOR_ATTRIB_CONNECTION[a.changeConnected]},run:function(a){var a=this.changeConnected&&this.changeConnected(a)||a,b=a.getAttribute(this.attribName)||0,c=ig.Event.getExpressionValue(this.minValue),d=ig.Event.getExpressionValue(this.maxValue),c=c*1,d=d*1,c=c+Math.floor(Math.random()*(d-c+1)),b=this.changeOperator(b,
c);a.setAttribute(this.attribName,b);return true}});var o={TARGET:function(a){return a.getTarget()},SELF:function(a){return a}};ig.ACTION_STEP.SET_ATTRIB_FACE=ig.ActionStepBase.extend({name:null,_wm:new ig.Config({attributes:{name:{_type:"String",_info:"Name of actor attribute to set"},target:{_type:"String",_info:"From what kind of entity to select",_select:o}}}),init:function(a){this.name=a.name;this.target=o[a.target]||o.TARGET},start:function(a){var b=this.target(a);b&&a.setAttribute(this.name,
Vec2.create(b.face))},run:function(){return true}});ig.ACTION_STEP.SET_ATTRIB_POS=ig.ActionStepBase.extend({name:null,value:null,_wm:new ig.Config({attributes:{name:{_type:"String",_info:"Name of actor attribute to set"},target:{_type:"String",_info:"From what kind of entity to select",_select:o},align:{_type:"String",_info:"Alignment on how to set pos from target",_select:ig.ENTITY_ALIGN},offset:{_type:"Offset",_info:"Offset to position",_optional:true},faceDistance:{_type:"Number",_info:"Distance applied along face direction of target"},
faceRound:{_type:"Integer",_info:"If defined: round face direction to fixed number of directions",_optional:true},selfFaceDistance:{_type:"Number",_info:"Distance applied along face direction of entity"},checkCollision:{_type:"Boolean",_info:"If true: Check navmap collision and only set if correct",_optional:true}}}),init:function(a){this.name=a.name;this.target=o[a.target]||o.TARGET;this.align=ig.ENTITY_ALIGN[a.align]||ig.ENTITY_ALIGN.BOTTOM;this.offset=a.offset;this.faceDistance=a.faceDistance||
0;this.faceRound=a.faceRound||0;this.selfFaceDistance=a.selfFaceDistance||0;this.checkCollision=a.checkCollision||false},start:function(a){var b=this.target(a);if(b){var c=b.getAlignedPos(this.align,Vec3.create());this.offset&&Vec3.add(c,this.offset);if(this.faceDistance){var d=Vec2.assign(g,b.face);this.faceRound&&ig.getRoundedFaceDir(d.x,d.y,this.faceRound,d);Vec2.length(d,this.faceDistance);Vec2.add(c,d)}if(this.selfFaceDistance){d=Vec2.assign(g,a.face);Vec2.length(d,this.selfFaceDistance);Vec2.add(c,
d)}this.checkCollision&&!ig.navigation.isPositionFree(c,a,b,true)?a.setAttribute(this.name,null):a.setAttribute(this.name,c)}},run:function(){ig.Event.getExpressionValue(this.value);return true}});ig.ACTION_STEP.PLAY_SOUND=ig.ActionStepBase.extend({sound:null,global:false,loop:false,settings:null,_wm:new ig.Config({attributes:{sound:{_type:"SoundT",_info:"URL of sound."},volume:{_type:"Number",_info:"The volume. Value between 0 and 1.",_default:1},variance:{_type:"Number",_info:"Variance of sound source",
_optional:true},global:{_type:"Boolean",_info:"Play sound globally without 3D sound."},loop:{_type:"Boolean",_info:"Loop sound if true"},speed:{_type:"Number",_info:"Playback speed. 1=default speed. 0.5=half speed.",_optional:true},fadeDuration:{_type:"Number",_info:"Fade duration of sound when canceled. Increase in case of sound artifacts",_optional:true},radius:{_type:"Number",_info:"Radius up to which you can hear the sound",_optional:true},speedVar:{_type:"VarName",_info:"Variable which value with increase the speed",
_optional:true},speedVarFactor:{_type:"Number",_info:"Factor multiplied with variable before being added to speed",_optional:true}}}),init:function(a){assertContent(a,"sound");this.sound=new ig.Sound(a.sound,a.volume||1,a.variance||0);this.global=a.global||false;this.loop=a.loop||false;this.radius=a.radius||0;this.speedVar=a.speedVar;this.speedVarFactor=a.speedVarFactor||1;this.settings={speed:a.speed||1,fadeDuration:a.fadeDuration||0}},clearCached:function(){this.sound.clearCached()},run:function(a){var b=
this.settings;if(this.speedVar){var b=ig.copy(this.settings),c=(ig.vars.get(this.speedVar)||0)*this.speedVarFactor;b.speed=b.speed+c}b=this.global?this.sound.play(this.loop,b):ig.SoundHelper.playAtEntity(this.sound,a,this.loop,b,this.radius);this.loop&&a.addActionAttached(b);return true}});ig.ACTION_STEP.STOP_SOUNDS=ig.ActionStepBase.extend({_wm:new ig.Config({attributes:{}}),init:function(){},run:function(a){a.clearActionAttached(b);return true}});ig.ACTION_STEP.PLAY_RANDOM_SOUND=ig.ActionStepBase.extend({sounds:[],
global:false,loop:false,settings:null,_wm:new ig.Config({attributes:{sounds:{_type:"Array",_info:"Sound to be played random",_sub:{_type:"SoundConfig"}},global:{_type:"Boolean",_info:"Play sound globally without 3D sound."},loop:{_type:"Boolean",_info:"Loop sound if true"},speed:{_type:"Number",_info:"Playback speed. 1=default speed. 0.5=half speed.",_optional:true}}}),init:function(a){for(var b=0;b<a.sounds.length;++b){var c=a.sounds[b];this.sounds.push(new ig.Sound(c.sound,c.volume||1,c.variance||
0))}this.global=a.global||false;this.loop=a.loop||false;this.settings={speed:a.speed||1}},clearCached:function(){for(var a=this.sounds.length;a--;)this.sounds[a].clearCached()},run:function(a){var b;b=this.sounds.random();b=this.global?b.play(this.loop,this.settings):ig.SoundHelper.playAtEntity(b,a,this.loop,this.settings);this.loop&&a.addActionAttached(b);return true}});ig.ACTION_STEP.HIDE=ig.ActionStepBase.extend({_wm:new ig.Config({attributes:{}}),init:function(){},run:function(a){a.hide();return true}});
ig.ACTION_STEP.HIDE_OTHER=ig.ActionStepBase.extend({entity:null,_wm:new ig.Config({attributes:{entity:{_type:"Entity",_info:"Other entity to hide"}}}),init:function(a){this.entity=a.entity},run:function(){var a=ig.Event.getEntity(this.entity);a&&a.hide();return true}});ig.ACTION_STEP.SET_POS=ig.ActionStepBase.extend({newPos:null,_wm:new ig.Config({attributes:{newPos:{_type:"Vec3",_info:"Position to move to.",_pointSelect:true,_visualize:true,_actorOption:true}}}),init:function(a){this.newPos=a.newPos},
start:function(a){var b=ig.Action.getVec3(this.newPos,a,m),c=a.coll;a.setPos(b.x-c.size.x/2,b.y-c.size.y/2,b.z)}});ig.ACTION_STEP.ROUND_POSITION=ig.ActionStepBase.extend({_wm:new ig.Config({attributes:{}}),init:function(){},start:function(a){var b=a.coll;a.setPos(Math.round(b.pos.x),Math.round(b.pos.y),b.pos.z)}});ig.ACTION_STEP.ADD_Z_POS_DELTA=ig.ActionStepBase.extend({zDelta:null,_wm:new ig.Config({attributes:{zDelta:{_type:"NumberVary",_info:"Delta to add to z pos instantly"},zMultiply:{_type:"Number",
_info:"Factor by which current z value is multiplied",_optional:true}}}),init:function(a){this.zDelta=a.zDelta;this.zMultiply=a.zMultiply||0},start:function(a){var b=ig.Event.getNumberVary(this.zDelta),c=a.coll.pos.z;this.zMultiply&&(c=c*this.zMultiply);a.setPos(void 0,void 0,c+b)}});ig.ACTION_STEP.TELEPORT_TO_ATTRIB_POS=ig.ActionStepBase.extend({newPos:null,_wm:new ig.Config({attributes:{attrib:{_type:"String",_info:"Name of attribute containing position to teleport to"}}}),init:function(a){this.attrib=
a.attrib},start:function(a){var b=a.getAttribVec3(this.attrib);if(b){b=Vec3.assign(m,b);b.x=b.x-a.coll.size.x/2;b.y=b.y-a.coll.size.y/2;a.setPos(b.x,b.y,b.z)}}});var m=Vec3.createC(0,0,0);ig.ACTION_STEP.INTERPOLATE_POSITION=ig.ActionStepBase.extend({newPos:null,duration:0,keySpline:null,timePerTile:false,_wm:new ig.Config({attributes:{newPos:{_type:"Vec3",_info:"Position to move to.",_pointSelect:true,_visualize:true,_actorOption:true},duration:{_type:"Number",_info:"Time the movement should take."},
keySpline:{_type:"String",_info:"The KEYSPLINE to use.",_select:KEY_SPLINES},timePerTile:{_type:"Boolean",_info:"If true, then time is for movement over one tile, scaled by total distance",_default:false}}}),init:function(a){this.newPos=a.newPos;this.duration=a.duration||0;this.keySpline=KEY_SPLINES[a.keySpline||"LINEAR"];this.timePerTile=a.timePerTile||false},start:function(a){a.stepData.startPos=a.getAlignedPos(ig.ENTITY_ALIGN.BOTTOM);if(this.timePerTile){var b=ig.Action.getVec3(this.newPos,a,d);
Vec3.sub(b,a.stepData.startPos);b=Vec3.length(b);a.stepData.duration=b/16*this.duration}else a.stepData.duration=this.duration;a.stepTimer=a.stepData.duration},run:function(a){var b=1-(a.stepTimer/a.stepData.duration).limit(0,1),b=this.keySpline.get(b),c=ig.Action.getVec3(this.newPos,a,d);Vec3.lerp(a.stepData.startPos,c,b,m);a.setPos(m.x-a.coll.size.x/2,m.y-a.coll.size.y/2,m.z,true);return b>=1}});ig.ACTION_STEP.INTERPOLATE_RELATIVE=ig.ActionStepBase.extend({delta:null,duration:0,keySpline:null,timePerTile:false,
_wm:new ig.Config({attributes:{delta:{_type:"Offset",_info:"Delta applied on current position",_actorOption:true},duration:{_type:"NumberVary",_info:"Time the movement should take."},keySpline:{_type:"String",_info:"The KEYSPLINE to use.",_select:KEY_SPLINES}}}),init:function(a){this.delta=a.delta;this.duration=a.duration||0;this.keySpline=KEY_SPLINES[a.keySpline||"LINEAR"]},start:function(a){a.stepData.startPos=a.getAlignedPos(ig.ENTITY_ALIGN.BOTTOM);a.stepData.duration=ig.Event.getNumberVary(this.duration);
a.stepTimer=a.stepData.duration},run:function(a){var b=1-(a.stepTimer/a.stepData.duration).limit(0,1),c=this.keySpline.get(b),c=Vec3.addMulF(a.stepData.startPos,this.delta,c,d);a.setPos(c.x-a.coll.size.x/2,c.y-a.coll.size.y/2,c.z,true);return b>=1}});ig.ACTION_STEP.Z_INTERPOLATE=ig.ActionStepBase.extend({newZPos:0,duration:0,keySpline:null,_wm:new ig.Config({attributes:{newZPos:{_type:"Number",_info:"New z post to move to."},duration:{_type:"Number",_info:"Time the movement should take."},keySpline:{_type:"String",
_info:"The KEYSPLINE to use.",_select:KEY_SPLINES}}}),init:function(a){this.newZPos=a.newZPos||0;this.duration=a.duration||0;this.keySpline=KEY_SPLINES[a.keySpline||"LINEAR"]},start:function(a){a.stepTimer=this.duration;a.stepData.zStartPos=a.coll.pos.z},run:function(a){var b=1-(a.stepTimer/this.duration).limit(0,1),b=this.keySpline.get(b);a.setZPos(a.stepData.zStartPos*(1-b)+this.newZPos*b);return b>=1}});ig.ACTION_STEP.DO_ATTRIB_ACTION=ig.ActionStepBase.extend({_wm:new ig.Config({attributes:{attrib:{_type:"String",
_info:"Name of attribute that stores action"},noStateReset:{_type:"Boolean",_info:"If true, do not reset state before switching to action. Also keeps actionAttached!"},resumeStashed:{_type:"Boolean",_info:"If true, resume stashed action if available"}}}),init:function(a){this.attrib=a.attrib;this.noStateReset=a.noStateReset||false;this.resumeStashed=a.resumeStashed||false},start:function(a){var b=a.getAttribute(this.attrib);this.resumeStashed&&a.stashed.action==b?a.resumeStashedAction(this.noStateReset):
a.setAction(b,false,this.noStateReset)}});ig.ACTION_STEP.ADD_ANIM_MOD=ig.ActionStepBase.extend({_wm:new ig.Config({attributes:{name:{_type:"String",_info:"Name under which to access anim mod. Anim mods of same name will be removed."},spriteIdx:{_type:"Integer",_info:"Sprite filter for animation modification"},tileOffset:{_type:"NumberExpression",_info:"The KEYSPLINE to use.",_optional:true}}}),init:function(a){this.name=a.name;this.spriteIdx=a.spriteIdx||0;this.tileOffset=a.tileOffset||0},start:function(a){(new ig.AnimModification(a,
this.spriteIdx,this.name)).tileOffset=ig.Event.getExpressionValue(this.tileOffset)}});ig.ACTION_STEP.REMOVE_ANIM_MOD=ig.ActionStepBase.extend({_wm:new ig.Config({attributes:{name:{_type:"String",_info:"If defined, only remove mod with given name",_optional:true}}}),init:function(a){this.name=a.name},start:function(a){ig.AnimModification.removeMods(a,this.name)}})});ig.baked=!0;
ig.module("impact.feature.base.event-steps").requires("impact.base.utils","impact.base.event","impact.base.action").defines(function(){function b(a,b){if(!a)return false;if(!b&&a instanceof ig.ENTITY.Player)return true;if(!(a instanceof ig.ENTITY.NPC))return false;if(a.characterName.startsWith("cross-worlds"))return true;if(b)return false;if(a.characterName.startsWith("main")||a.characterName.startsWith("antagonists"))return true}function a(a){switch(a){case "set":return"=";case "add":return"+=";
case "sub":return"-=";case "mul":return"*=";case "div":return"/=";case "mod":return"%=";case "and":return"&=";case "or":return"|=";case "xor":return"XOR";case "append":return"+=";case "prepend":return"+="}return"???"}var d=/^(\d+)_(\d+)$/;ig.EVENT_STEP.SELECT_RANDOM=ig.EventStepBase.extend({options:[],branches:{},_wm:new ig.Config({attributes:{options:{_type:"RandomDistribution",_info:"RandomDistribution",_noLabel:true}},branchLabel:function(a){if(a=="_end")return"END_SELECT_RANDOM";var b=d.exec(a);
if(b){var a=b[1],b=b[2],c="";this.options[a].activeCondition&&(c=c+("("+this.options[a].activeCondition+")"));return"Entry "+a+" #"+b+" "+c+" weight "+this.options[a].weight}return"???"}}),init:function(a){for(var a=a.options||[],b=0;b<a.length;++b){var c={count:a[b].count,weight:a[b].weight,activeCondition:new ig.VarCondition(a[b].activeCondition)};c.prob=c.count*c.weight;this.options[b]=c}},getBranchNames:function(){for(var a=[],b=0;b<this.options.length;++b)for(var c=this.options[b],d=0;d<c.count;++d)a.push(b+
"_"+d);return a},getNext:function(){for(var a=0,b=this.options.length;b--;)this.options[b].activeCondition.evaluate()&&(a=a+this.options[b].prob);a=Math.random()*a;for(b=this.options.length;b--;)if(this.options[b].activeCondition.evaluate())if(a>=this.options[b].prob)a=a-this.options[b].prob;else break;a=this.options[b];if(!a)return this._nextStep;a=Math.floor(a.count*Math.random());return this.branches[b+"_"+a]||this._nextStep}});ig.EVENT_STEP.SELECT_FIRST=ig.EventStepBase.extend({options:[],branches:{},
_wm:new ig.Config({attributes:{options:{_type:"Array",_info:"Face direction options",_sub:{_type:"VarCondition",_popup:true}}},width:600,branchLabel:function(a){if(a=="_end")return"END_SELECT_RANDOM";var b;b=""+("("+this.options[a]+")");return"Entry "+a+" "+b}}),init:function(a){for(var a=a.options||[],b=0;b<a.length;++b){var c=new ig.VarCondition(a[b]);this.options[b]=c}},getBranchNames:function(){for(var a=[],b=0;b<this.options.length;++b)a.push(b);return a},getNext:function(){for(var a=0;a<this.options.length;++a)if(this.options[a].evaluate())return this.branches[a];
return this._nextStep}});ig.EVENT_STEP.LABEL=ig.EventStepBase.extend({name:null,_wm:new ig.Config({attributes:{name:{_type:"String",_info:"Name of the label"}},label:function(){return"<b>LABEL</b> <i>"+this.name+"</i>"}}),init:function(a){assertContent(a,"name");this.name=a.name}});ig.EVENT_STEP.GOTO_LABEL=ig.EventStepBase.extend({name:null,_wm:new ig.Config({attributes:{name:{_type:"String",_info:"Label to move to."}},label:function(){return"<b>GOTO_LABEL</b> <i>"+this.name+"</i>"}}),init:function(a){assertContent(a,
"name");this.name=a.name},getJumpLabelName:function(){return this.name}});ig.EVENT_STEP.GOTO_LABEL_WHILE=ig.EventStepBase.extend({name:null,condition:null,_wm:new ig.Config({attributes:{name:{_type:"String",_info:"Label to move to."},condition:{_type:"VarCondition",_info:"Condition to jump to the label"}},label:function(){return"<b>GOTO_LABEL</b> <i>"+this.name+"</i> <b>WHILE</b> <i>"+this.condition+"</i>"}}),init:function(a){assertContent(a,"name");this.name=a.name;this.condition=new ig.VarCondition(a.condition)},
getJumpLabelName:function(){return this.condition.evaluate()?this.name:null}});ig.EVENT_STEP.WAIT=ig.EventStepBase.extend({time:0,_timer:0,ignoreSlowDown:false,_wm:new ig.Config({attributes:{time:{_type:"NumberExpression",_info:"Time to wait in seconds"},ignoreSlowDown:{_type:"Boolean",_info:"Ignore slow down rate on wait"}}}),init:function(a){assertContent(a,"time");this.time=a.time;this.ignoreSlowDown=a.ignoreSlowDown||false},start:function(a){a._timer=ig.Event.getExpressionValue(this.time)},run:function(a){a._timer=
a._timer-(this.ignoreSlowDown?ig.system.actualTick:ig.system.tick);return a._timer<=0}});ig.EVENT_STEP.WAIT_RANDOM=ig.EventStepBase.extend({maxTime:0,minTime:0,_wm:new ig.Config({attributes:{minTime:{_type:"NumberExpression",_info:"Minimum time to wait"},maxTime:{_type:"NumberExpression",_info:"Maximum time to wait"},ignoreSlowDown:{_type:"Boolean",_info:"Ignore slow down rate on wait"}}}),init:function(a){this.minTime=a.minTime;this.maxTime=a.maxTime;this.ignoreSlowDown=a.ignoreSlowDown||false},
start:function(a){var b=ig.Event.getExpressionValue(this.maxTime),c=ig.Event.getExpressionValue(this.minTime);a._timer=c+Math.random()*(b-c)},run:function(a){a._timer=a._timer-(this.ignoreSlowDown?ig.system.actualTick:ig.system.tick);return a._timer<=0}});ig.EVENT_STEP.WAIT_UNTIL_TRUE=ig.EventStepBase.extend({condition:null,_timer:0,ignoreSlowDown:false,_wm:new ig.Config({attributes:{condition:{_type:"VarCondition",_info:"Condition to evaluate to true to continue"},maxTime:{_type:"NumberExpression",
_info:"If defined: maximal wait this time",_optional:true}}}),init:function(a){assertContent(a,"condition");this.condition=new ig.VarCondition(a.condition);this.maxTime=a.maxTime},start:function(a){var b=ig.Event.getExpressionValue(this.maxTime);a._timer=b},run:function(a){if(a._timer){a._timer=a._timer-ig.system.tick;if(a._timer<=0)return true}return this.condition.evaluate()}});ig.EVENT_STEP.WAIT_UNTIL_ACTION_DONE=ig.EventStepBase.extend({entity:0,_wm:new ig.Config({attributes:{entity:{_type:"Entity",
_info:"Entity to move",_visualize:true,_context:"Entity"}}}),init:function(a){assertContent(a,"entity");this.entity=a.entity},start:function(a,b){var c=ig.Event.getEntity(this.entity,b);if(c){a._actionEntity=c;a._currentAction=c.currentAction}},run:function(a){return!a._actionEntity?true:a._currentAction&&a._actionEntity.currentAction==a._currentAction||a._actionEntity.respawn&&a._actionEntity.respawn.timer?false:true}});ig.EVENT_STEP.STOP_SKIP_MODE=ig.EventStepBase.extend({_wm:new ig.Config({attributes:{}}),
init:function(){},start:function(){ig.system.skipMode=false}});ig.EVENT_STEP.SET_ENTITY_STATIC_TIME=ig.EventStepBase.extend({entity:null,value:true,global:false,_wm:new ig.Config({attributes:{entity:{_type:"Entity",_info:"Entity to be changed"},value:{_type:"Boolean",_info:"true: Entity ignores world speed slow down. false: entity is slowed down."},global:{_type:"Boolean",_info:"If true, set static time globally"}}}),init:function(a){assertContent(a,"entity","value");this.entity=a.entity;this.value=
a.value;this.global=a.global},start:function(a,b){var c=ig.Event.getEntity(this.entity,b);this.global?c.coll.time.globalStatic=this.value:c.coll.time.animStatic=this.value}});ig.EVENT_STEP.SET_ENTITY_POS=ig.EventStepBase.extend({entity:null,position:null,_wm:new ig.Config({attributes:{entity:{_type:"Entity",_info:"Entity to be changed"},position:{_type:"Vec3",_info:"New position of entity",_pointSelect:true}}}),init:function(a){assertContent(a,"entity","position");this.entity=a.entity;this.position=
a.position},start:function(a,b){var d=ig.Event.getEntity(this.entity,b);if(d){var e=ig.Event.getVec3(this.position,c),f=d.coll;d.setPos(e.x-f.size.x/2,e.y-f.size.y/2,e.z)}}});ig.EVENT_STEP.SET_ENTITY_POS_TO_ENTITY=ig.EventStepBase.extend({entity:null,position:null,_wm:new ig.Config({attributes:{entity:{_type:"Entity",_info:"Entity to be placed"},refEntity:{_type:"Entity",_info:"Entity used to determine position"},offset:{_type:"Offset",_info:"Offset to entity position"}}}),init:function(a){this.entity=
a.entity;this.refEntity=a.refEntity;this.offset=a.offset},start:function(a,b){var d=ig.Event.getEntity(this.entity,b),e=ig.Event.getEntity(this.refEntity,b);if(d&&e){e=e.getAlignedPos(ig.ENTITY_ALIGN.BOTTOM,c);this.offset&&Vec3.add(e,this.offset);var f=d.coll;d.setPos(e.x-f.size.x/2,e.y-f.size.y/2,e.z)}}});ig.EVENT_STEP.SET_ENTITY_ON_TOP_OTHER=ig.EventStepBase.extend({entity:null,groundEntity:null,_wm:new ig.Config({attributes:{entity:{_type:"Entity",_info:"Entity to be changed"},groundEntity:{_type:"Entity",
_info:"Entity the first entity should stand on"}}}),init:function(a){assertContent(a,"entity","groundEntity");this.entity=a.entity;this.groundEntity=a.groundEntity},start:function(a,b){var c=ig.Event.getEntity(this.entity,b),d=ig.Event.getEntity(this.groundEntity,b);c.setZPos(d.coll.pos.z+d.coll.size.z);c.coll.setGroundEntry(d.coll);c.coll.vel.z=0}});var c=Vec3.create(),e=Vec2.create(),f=Vec2.create();Vec2.create();Vec2.create();ig.EVENT_STEP.ADJUST_ENTITY_POS=ig.EventStepBase.extend({entity:null,
offset:null,_wm:new ig.Config({attributes:{entity:{_type:"Entity",_info:"Entity to be changed"},offset:{_type:"Vec3",_info:"Offset applied to entity position ",_rawZValue:true}}}),init:function(a){assertContent(a,"entity","offset");this.entity=a.entity;this.offset=a.offset},start:function(a,b){var d=ig.Event.getEntity(this.entity,b),e=ig.Event.getVec3(this.offset,c);d.setPos(d.coll.pos.x+e.x,d.coll.pos.y+e.y,d.coll.pos.z+e.z)}});ig.EVENT_STEP.HIDE_ENTITY=ig.EventStepBase.extend({entity:null,_wm:new ig.Config({attributes:{entity:{_type:"Entity",
_info:"Entity to be hidden"},skipEffects:{_type:"Boolean",_info:"If true: Skip effects when showing entity"}}}),init:function(a){assertContent(a,"entity");this.entity=a.entity;this.skipEffects=a.skipEffects},start:function(a,b){var c=ig.Event.getEntity(this.entity,b);c&&!c._hidden&&(this.skipEffects?c.hide():ig.game.requestEntityHide(c))}});ig.EVENT_STEP.SHOW_ENTITY=ig.EventStepBase.extend({entity:null,_wm:new ig.Config({attributes:{entity:{_type:"Entity",_info:"Entity to be shown"},skipEffects:{_type:"Boolean",
_info:"If true: Skip effects when showing entity"}}}),init:function(a){assertContent(a,"entity");this.entity=a.entity;this.skipEffects=a.skipEffects},start:function(a,b){var c=ig.Event.getEntity(this.entity,b);c&&c._hidden&&c.show(this.skipEffects)}});ig.EVENT_STEP.SHOW_ANIMATION=ig.EventStepBase.extend({entity:null,anim:null,reset:false,followUp:null,_wm:new ig.Config({attributes:{entity:{_type:"Entity",_info:"Entity to be changed",_context:"Entity"},anim:{_type:"EntityAnim",_info:"Name of the new animation"},
reset:{_type:"Boolean",_info:"Reset current animation state"},followUp:{_type:"EntityAnim",_info:"Animation that follows the set animation",_optional:true}}}),init:function(a){assertContent(a,"entity","anim");this.entity=a.entity;this.anim=a.anim;this.reset=a.reset||false;this.followUp=a.followUp||null},start:function(a,b){ig.Event.getEntity(this.entity,b).setCurrentAnim(this.anim,this.reset,this.followUp,true)}});ig.EVENT_STEP.SHOW_EXTERN_ANIM=ig.EventStepBase.extend({entity:null,animSheet:null,
animName:null,followUpSheet:null,followUpName:null,_wm:new ig.Config({attributes:{entity:{_type:"Entity",_info:"Entity to be changed"},anim:{_type:"Animation",_info:"Animation to play"},followUp:{_type:"Animation",_info:"Animation to play after this animation",_optional:true}}}),init:function(a){assertContent(a,"entity","anim");this.entity=a.entity;this.animSheet=new ig.AnimationSheet(a.anim.sheet);this.animName=a.anim.name;if(a.followUp){this.followUpSheet=new ig.AnimationSheet(a.followUp.sheet);
this.followUpName=a.followUp.name}},clearCached:function(){this.animSheet.decreaseRef();this.followUpSheet&&this.followUpSheet.decreaseRef()},start:function(a,b){var c=ig.Event.getEntity(this.entity,b);if(c){var d=sc.playerSkins.replaceAnim(this.animSheet),e=sc.playerSkins.replaceAnim(this.followUpSheet);c.setCurrentAnim(d.anims[this.animName],true,e&&e.anims[this.followUpName],true);c.animationFixed=true}}});ig.EVENT_STEP.CLEAR_ANIMATION=ig.EventStepBase.extend({_wm:new ig.Config({attributes:{entity:{_type:"Entity",
_info:"Entity to be changed"}}}),init:function(a){this.entity=a.entity},start:function(a,b){var c=ig.Event.getEntity(this.entity,b);if(c)c.animationFixed=false}});ig.EVENT_STEP.DO_ACTION=ig.EventStepBase.extend({entity:0,action:null,wait:false,keepState:false,_actionEntity:null,_wm:new ig.Config({attributes:{entity:{_type:"Entity",_info:"Entity to move",_visualize:true,_context:"Entity"},action:{_type:"Action",_info:"The action to perform",_rec_visualize:ig.ACTION_STEP},repeating:{_type:"Boolean",
_info:"Repeat Action"},wait:{_type:"Boolean",_info:"Wait until action is finished"},keepState:{_type:"Boolean",_info:"Don't reset entity state after action"},immediately:{_type:"Boolean",_info:"If true: execute action immediately not interrupting currently running action. Will only execute steps without wait duration."}},width:500}),init:function(a){assertContent(a,"entity","action");this.entity=a.entity;this.action=new ig.Action("[GENERIC]",a.action,false,a.repeating);this.action.eventAction=true;
this.wait=a.wait||false;this.keepState=a.keepState||false;this.immediately=a.immediately||false},clearCached:function(){this.action&&this.action.clearCached()},start:function(a,b){var c=ig.Event.getEntity(this.entity,b);a._actionEntity=c;if(this.immediately){c.stashAction(true);c.setAction(this.action);c.forceExecuteAction();c.resumeStashedAction(true)}else c&&c.setAction(this.action,this.keepState)},run:function(a){return this.immediately||!a._actionEntity||!this.wait?true:a._actionEntity.currentAction==
this.action||a._actionEntity.respawn&&a._actionEntity.respawn.timer?false:true}});ig.EVENT_STEP.WAIT_UNTIL_ON_GROUND=ig.EventStepBase.extend({_wm:new ig.Config({attributes:{entity:{_type:"Entity",_info:"Entity to move",_visualize:true,_context:"Entity"}}}),init:function(a){this.entity=a.entity},start:function(a,b){var c=ig.Event.getEntity(this.entity,b);if(c)a._actionEntity=c},run:function(a){if(!a._actionEntity)return true;a=a._actionEntity;return a.coll.vel.z>=0&&!a.coll.zGravityFactor?true:a.coll.pos.z==
a.coll.baseZPos}});ig.EVENT_STEP.GROUP_FACE_TO_ENTITY=ig.EventStepBase.extend({entity:0,action:null,wait:false,keepState:false,_actionEntity:null,_wm:new ig.Config({attributes:{group:{_type:"Array",_info:"Entities to move face of",_sub:{_type:"Entity"}},entity:{_type:"Entity",_info:"Entity to face",_visualize:true},wait:{_type:"Number",_info:"Maximum time to wait before rotating face"},minWait:{_type:"Number",_info:"Minimum time to wait",_optional:true},repeating:{_type:"Boolean",_info:"If true: execute repeating actions to constantly look at entity",
_optional:true}},width:500}),init:function(a){this.entity=a.entity;this.action=new ig.Action("[GENERIC]",[{type:"WAIT_RANDOM",minTime:a.minWait||0,maxTime:a.wait||0},{type:"SET_FACE_TO_ENTITY",entity:this.entity,rotate:true}],false,a.repeating||false);this.action.eventAction=true;this.group=a.group},clearCached:function(){this.action&&this.action.clearCached()},start:function(a,b){for(var c=this.group.length;c--;){var d=ig.Event.getEntity(this.group[c],b);d&&d.setAction(this.action,false)}},run:function(){return true}});
ig.EVENT_STEP.MASS_AVATAR_MOVE=ig.EventStepBase.extend({pointA:null,pointB:null,relativeSpeed:1,postFace:null,forwardTime:0,waitPerDistance:0,_wm:new ig.Config({attributes:{pointA:{_type:"Vec3",_info:"point A to move to.",_pointSelect:true},pointB:{_type:"Vec3",_info:"point B to move to. Will use closest point between A and B",_pointSelect:true},relativeSpeed:{_type:"Number",_info:"Relative Speed of entities"},postFace:{_type:"Face",_info:"Direction to face after point is reached"},forwardTime:{_type:"Number",
_info:"Time to move forward after point has been reached"},waitPerDistance:{_type:"Number",_info:"Seconds to wait per 100 pixel distance"}},width:500}),init:function(a){this.pointA=a.pointA;this.pointB=a.pointB;this.relativeSpeed=a.relativeSpeed;this.postFace=a.postFace;this.forwardTime=a.forwardTime;this.waitPerDistance=a.waitPerDistance},clearCached:function(){this.action&&this.action.clearCached()},start:function(){for(var a=ig.Event.getVec3(this.pointA,c),d=ig.Event.getVec3(this.pointB,e),i=ig.game.shownEntities,
j=1E3,k=-1E3,l=-1E3,o=0;o<i.length;++o){var m=i[o];if(b(m))var n=m.getCenter(f),p=Line2.pointOnLineWeight(a,d,n,true),j=Math.min(j,p),k=Math.max(k,p),l=Math.max(l,Line2.distanceLineToPoint(a,d,n))}for(o=0;o<i.length;++o){m=i[o];if(b(m)){l=Vec3.create();n=m.getCenter(f);Line2.distanceLineToPoint(a,d,n);p=Line2.pointOnLineWeight(a,d,n,true);p=((p-j)/(k-j)).limit(0,1);Line2.getWeightPoint(l,a,d,p);n=Vec2.distance(l,n);l.z=a.z;n=new ig.Action("[GENERIC]",[{type:"SET_COLL_TYPE",value:"NONE"},{type:"WAIT",
time:n/100*this.waitPerDistance},{type:"SET_RELATIVE_SPEED",value:this.relativeSpeed},{type:"MOVE_TO_POINT",target:l,precise:false},{type:"SET_FACE",face:this.postFace,rotate:false},{type:"MOVE_FORWARD",time:this.forwardTime},{type:"HIDE"}],false,false);n.eventAction=true;m.setAction(n,false)}}},run:function(){return true}});ig.EVENT_STEP.MASS_AVATAR_FACE=ig.EventStepBase.extend({action:null,jumpDensity:1,_wm:new ig.Config({attributes:{entity:{_type:"Entity",_info:"Entity to face",_visualize:true},
minWait:{_type:"Number",_info:"Minimum time to wait."},maxWait:{_type:"Number",_info:"Maximum time to wait."}},width:500}),init:function(a){this.action=new ig.Action("[GENERIC]",[{type:"WAIT_RANDOM",minTime:a.minWait||0,maxTime:a.maxWait||0},{type:"SET_FACE_TO_ENTITY",entity:a.entity,rotate:true}],false,false);this.action.eventAction=true},clearCached:function(){this.action&&this.action.clearCached()},start:function(){for(var a=ig.game.shownEntities,c=0;c<a.length;++c){var d=a[c];b(d,true)&&d.setAction(this.action,
false)}},run:function(){return true}});ig.EVENT_STEP.MASS_AVATAR_JUMP=ig.EventStepBase.extend({action:null,jumpDensity:1,_wm:new ig.Config({attributes:{jumpHeight:{_type:"String",_info:"Height of jump",_select:{S:100,M:150,L:180,XL:220,XXL:270}},minWait:{_type:"Number",_info:"Minimum time to wait."},maxWait:{_type:"Number",_info:"Maximum time to wait."},jumpDensity:{_type:"Number",_info:"Number between 0-1: What percentage of avatars should do the jump - will be randomly selected"}},width:500}),init:function(a){this.action=
new ig.Action("[GENERIC]",[{type:"WAIT_RANDOM",minTime:a.minWait||0,maxTime:a.maxWait||0},{type:"SET_SLIP_THROUGH",value:true},{type:"SET_SOUNDTYPE",value:"none"},{type:"JUMP",jumpHeight:a.jumpHeight,wait:true,ignoreSounds:true}],false,a.repeating||false);this.action.eventAction=true;this.jumpDensity=a.jumpDensity||1},clearCached:function(){this.action&&this.action.clearCached()},start:function(){for(var a=ig.game.shownEntities,c=[],d=0;d<a.length;++d){var e=a[d];b(e,true)&&c.push(e)}for(a=Math.floor(c.length*
this.jumpDensity);a--;){d=Math.floor(Math.random()*c.length);e=c[d];c.splice(d,1);e.setAction(this.action,false)}},run:function(){return true}});ig.EVENT_STEP.TELEPORT=ig.EventStepBase.extend({map:"",marker:"",_wm:new ig.Config({attributes:{map:{_type:"Maps",_info:"Map to be teleported to",_context:"Map"},marker:{_type:"Marker",_info:"Marker on Map to be teleported to"}}}),init:function(a){assertContent(a,"map");this.map=a.map;this.marker=a.marker},start:function(){ig.game.teleport(this.map,this.marker?
new ig.TeleportPosition(this.marker):null)}});ig.EVENT_STEP.IF=ig.EventStepBase.extend({condition:null,withElse:false,branches:{},_wm:new ig.Config({attributes:{condition:{_type:"VarCondition",_info:"Condition for IF statement"},withElse:{_type:"Boolean",_info:"With else case.",_noLabel:true}},branchLabel:function(a){switch(a){case "thenStep":return null;case "elseStep":return"else";case "_end":return"endif"}return"???"}}),init:function(a){this.condition=new ig.VarCondition(a.condition);this.withElse=
a.withElse},getBranchNames:function(){return this.withElse?["thenStep","elseStep"]:["thenStep"]},getNext:function(){return this.condition.evaluate()?this.branches.thenStep?this.branches.thenStep:this._nextStep:this.branches.elseStep?this.branches.elseStep:this._nextStep}});ig.EVENT_STEP.FORK_CONDITION=ig.EVENT_STEP.IF;ig.EVENT_STEP.CHANGE_VAR_NUMBER=ig.EventStepBase.extend({varName:null,changeType:null,value:0,_wm:new ig.Config({attributes:{varName:{_type:"VarName",_info:"Variable to change"},changeType:{_type:"String",
_info:"Type of modification",_select:{set:1,add:1,sub:1,mul:1,div:1,mod:1}},value:{_type:"NumberExpression",_info:"Value to modify with"},map:{_type:"Maps",_info:"Change Var from within this map. Will replace map. prefix",_context:"Map",_optional:true}},label:function(){return"<b>VAR_NUMBER</b> <code>"+wmPrint("VarName",this.varName)+" "+a(this.changeType)+" "+wmPrint("NumberExpression",this.value)+"</code>"+(this.map?" ("+this.map+")":"")}}),init:function(a){assertContent(a,"varName","changeType",
"value");this.varName=a.varName;this.changeType=a.changeType;this.value=a.value;this.map=a.map},start:function(){var a=ig.Event.getVarName(this.varName);if(this.map){a.startsWith("map.")&&(a=a.substr(4));a="maps."+this.map.toPath("","").toCamel()+"."+a}var b=ig.Event.getExpressionValue(this.value);if(a){b=b*1;if(isNaN(b))ig.log("CHANGE_VAR_NUMBER: Invalid value!");else if(ig.vars[this.changeType])ig.vars[this.changeType](a,b);else ig.log("CHANGE_VAR_NUMBER: Invalid change type")}else ig.log("CHANGE_VAR_NUMBER: Variable Name is not a String!")}});
ig.EVENT_STEP.SET_RANDOM_VAR_NUMBER=ig.EventStepBase.extend({varName:null,min:0,max:0,_wm:new ig.Config({attributes:{varName:{_type:"VarName",_info:"Variable to change",_withActor:true},min:{_type:"Integer",_info:"Start value"},max:{_type:"Integer",_info:"End value"}},label:function(){return"<b>RANDOM_NUMBER</b> <code>"+wmPrint("VarName",this.varName)+" ["+wmPrint("Integer",this.min)+", "+wmPrint("Integer",this.max)+"]</code>"}}),init:function(a){assertContent(a,"varName","min","max");this.varName=
a.varName;this.min=a.min;this.max=a.max},start:function(){var a=ig.Event.getVarName(this.varName);a?ig.vars.set(a,~~(Math.random()*(this.max-this.min+1))+this.min):ig.log("CHANGE_VAR_NUMBER: (Actor) Variable Name is not a String!")}});ig.EVENT_STEP.ROUND_VAR_NUMBER=ig.EventStepBase.extend({varName:null,_wm:new ig.Config({attributes:{varName:{_type:"VarName",_info:"Variable to round",_withActor:true},roundType:{_type:"String",_info:"Type of round",_select:{round:1,floor:1,ceil:1}},digits:{_type:"Integer",
_info:"Number of decimals to round to, 0 for whole number"}},label:function(){return"<b>ROUND_NUMBER</b> <code>"+wmPrint("VarName",this.varName)+"</code>  ; "+this.roundType+" ; "+this.digits+" digits"}}),init:function(a){assertContent(a,"varName");this.varName=a.varName;this.roundType=a.roundType;this.digits=a.digits||0},start:function(){var a=ig.Event.getVarName(this.varName);a?this.roundType==="round"?this.digits==0?ig.vars.set(a,Math.round(ig.vars.get(a))):ig.vars.set(a,Math.round(ig.vars.get(a)*
Math.pow(10,this.digits))/Math.pow(10,this.digits)):this.roundType==="floor"?this.digits==0?ig.vars.set(a,Math.floor(ig.vars.get(a))):ig.vars.set(a,Math.floor(ig.vars.get(a)*Math.pow(10,this.digits))/Math.pow(10,this.digits)):this.roundType==="ceil"&&(this.digits==0?ig.vars.set(a,Math.ceil(ig.vars.get(a))):ig.vars.set(a,Math.ceil(ig.vars.get(a)*Math.pow(10,this.digits))/Math.pow(10,this.digits))):ig.log("CHANGE_VAR_NUMBER: (Actor) Variable Name is not a String!")}});ig.EVENT_STEP.SET_VAR_TIME=ig.EventStepBase.extend({varName:null,
changeType:null,value:0,_wm:new ig.Config({attributes:{varName:{_type:"VarName",_info:"Variable to store current timestamp in milliseconds"}}}),init:function(a){this.varName=a.varName},start:function(){var a=ig.Event.getVarName(this.varName);if(a){var b=Date.now();ig.vars.set(a,b)}else ig.log("SET_VAR_TIME: Variable Name is not a String!")}});ig.EVENT_STEP.CHANGE_VAR_VEC2=ig.EventStepBase.extend({varName:null,changeType:null,value:0,_wm:new ig.Config({attributes:{varName:{_type:"VarName",_info:"Variable to change"},
changeType:{_type:"String",_info:"Type of modification",_select:{set:1,add:1,sub:1,mul:1,div:1}},value:{_type:"Vec2Expression",_info:"Value to modify with"},map:{_type:"Maps",_info:"Change Var from within this map. Will replace map. prefix",_context:"Map",_optional:true}},label:function(){return"<b>VAR_VEC2</b> <i>"+wmPrint("VarName",this.varName)+" "+a(this.changeType)+" "+wmPrint("Vec2Expression",this.value)+"</i>"+(this.map?" ("+this.map+")":"")}}),init:function(a){assertContent(a,"varName","changeType",
"value");this.varName=a.varName;this.changeType=a.changeType;this.value=a.value;this.map=a.map},start:function(){var a=ig.Event.getVarName(this.varName);if(this.map){a.startsWith("map.")&&(a=a.substr(4));a="maps."+this.map.toPath("","").toCamel()+"."+a}var b=ig.Event.getExpressionValue(this.value);if(a)if(!b||b.y===void 0)ig.log("CHANGE_VAR_VEC2: value is not a Vec2!");else if(this.changeType=="set")ig.vars.set(a,b);else{var c=ig.vars.get(a);if(!c||c.y===void 0)ig.log("CHANGE_VAR_VEC2: dest is not a Vec2!");
else{switch(this.changeType){case "add":Vec2.add(c,b);break;case "sub":Vec2.sub(c,b);break;case "mul":Vec2.mul(c,b);break;case "div":Vec2.div(c,b)}ig.vars.set(a,c)}}else ig.log("CHANGE_VAR_VEC2: Variable Name is not a String!")}});ig.EVENT_STEP.CHANGE_VAR_VEC3=ig.EventStepBase.extend({varName:null,changeType:null,value:0,_wm:new ig.Config({attributes:{varName:{_type:"VarName",_info:"Variable to change"},changeType:{_type:"String",_info:"Type of modification",_select:{set:1,add:1,sub:1,mul:1,div:1}},
value:{_type:"Vec3Expression",_info:"Value to modify with"},map:{_type:"Maps",_info:"Change Var from within this map. Will replace map. prefix",_context:"Map",_optional:true}},label:function(){return"<b>VAR_VEC3</b> <i>"+wmPrint("VarName",this.varName)+" "+a(this.changeType)+" "+wmPrint("Vec3Expression",this.value)+"</i>"+(this.map?" ("+this.map+")":"")}}),init:function(a){assertContent(a,"varName","changeType","value");this.varName=a.varName;this.changeType=a.changeType;this.value=a.value;this.map=
a.map},start:function(){var a=ig.Event.getVarName(this.varName);if(this.map){a.startsWith("map.")&&(a=a.substr(4));a="maps."+this.map.toPath("","").toCamel()+"."+a}var b=ig.Event.getExpressionValue(this.value);if(a)if(!b||b.z===void 0)ig.log("CHANGE_VAR_VEC3: value is not a Vec3!");else if(this.changeType=="set")ig.vars.set(a,b);else{var c=ig.vars.get(a);if(!c||c.z===void 0)ig.log("CHANGE_VAR_VEC3: dest is not a Vec3!");else{switch(this.changeType){case "add":Vec3.add(c,b);break;case "sub":Vec3.sub(c,
b);break;case "mul":Vec3.mul(c,b);break;case "div":Vec3.div(c,b)}ig.vars.set(a,c)}}else ig.log("CHANGE_VAR_VEC3: Variable Name is not a String!")}});ig.EVENT_STEP.CHANGE_VAR_BOOL=ig.EventStepBase.extend({varName:null,changeType:null,value:0,_wm:new ig.Config({attributes:{varName:{_type:"VarName",_info:"Variable to change"},changeType:{_type:"String",_info:"Type of modification",_select:{set:1,and:1,or:1,xor:1}},value:{_type:"BooleanExpression",_info:"Value to modify with"},map:{_type:"Maps",_info:"Change Var from within this map. Will replace map. prefix",
_context:"Map",_optional:true}},label:function(){return"<b>VAR_BOOL</b> <code>"+wmPrint("VarName",this.varName)+" "+a(this.changeType)+" "+wmPrint("BooleanExpression",this.value)+"</code>"+(this.map?" ("+this.map+")":"")}}),init:function(a){assertContent(a,"varName","changeType","value");this.varName=a.varName;this.changeType=a.changeType;this.value=a.value;this.map=a.map},start:function(){var a=ig.Event.getVarName(this.varName);if(this.map){a.startsWith("map.")&&(a=a.substr(4));a="maps."+this.map.toPath("",
"").toCamel()+"."+a}var b=ig.Event.getExpressionValue(this.value);if(a){b=!!b;if(ig.vars[this.changeType])ig.vars[this.changeType](a,b);else ig.log("CHANGE_VAR_BOOL: Invalid change type")}else ig.log("CHANGE_VAR_BOOL: Variable Name is not a String!")}});ig.EVENT_STEP.CLEAR_TEMP_STORAGE=ig.EventStepBase.extend({_wm:new ig.Config({attributes:{},label:function(){return"<b>VAR CLEAR TEMP</b>"}}),init:function(){},start:function(){ig.vars.clearTemp()}});ig.EVENT_STEP.CHANGE_VAR_STRING=ig.EventStepBase.extend({varName:null,
changeType:null,value:0,_wm:new ig.Config({attributes:{varName:{_type:"VarName",_info:"Variable to change"},changeType:{_type:"String",_info:"Type of modification",_select:{set:1,append:1,prepend:2}},value:{_type:"StringExpression",_info:"Value to modify with"},map:{_type:"Maps",_info:"Change Var from within this map. Will replace map. prefix",_context:"Map",_optional:true}},label:function(){var b,c;if(this.changeType=="prepend"){b=wmPrint("StringExpression",this.value);c=wmPrint("VarName",this.varName)}else{b=
wmPrint("VarName",this.varName);c=wmPrint("StringExpression",this.value)}return"<b>VAR_STRING</b> <i>"+b+" "+a(this.changeType)+" "+c+"</i>"+(this.map?" ("+this.map+")":"")}}),init:function(a){assertContent(a,"varName","changeType","value");this.varName=a.varName;this.changeType=a.changeType;this.value=a.value;this.map=a.map},start:function(){var a=ig.Event.getVarName(this.varName);if(this.map){a.startsWith("map.")&&(a=a.substr(4));a="maps."+this.map.toPath("","").toCamel()+"."+a}var b=ig.Event.getExpressionValue(this.value);
if(a){b=""+b;if(ig.vars[this.changeType])ig.vars[this.changeType](a,b);else ig.log("CHANGE_VAR_STRING: Invalid change type")}else ig.log("CHANGE_VAR_STRING: Variable Name is not a String!")}});ig.EVENT_STEP.CHANGE_VAR_LANG=ig.EventStepBase.extend({varName:null,changeType:null,value:0,_wm:new ig.Config({attributes:{varName:{_type:"VarName",_info:"Variable to change"},changeType:{_type:"String",_info:"Type of modification",_select:{set:1,append:1}},value:{_type:"LangLabel",_info:"Value to modify with"},
map:{_type:"Maps",_info:"Change Var from within this map. Will replace map. prefix",_context:"Map",_optional:true}},label:function(){return"<b>VAR_LANG</b> <i>"+wmPrint("VarName",this.varName)+" "+a(this.changeType)+" "+wmPrint("LangLabel",this.value)+"</i>"+(this.map?" ("+this.map+")":"")}}),init:function(a){assertContent(a,"varName","changeType","value");this.varName=a.varName;this.changeType=a.changeType;this.value=new ig.LangLabel(a.value);this.map=a.map},start:function(){var a=ig.Event.getVarName(this.varName);
if(this.map){a.startsWith("map.")&&(a=a.substr(4));a="maps."+this.map.toPath("","").toCamel()+"."+a}var b=this.value.toString();if(a){b=""+b;if(ig.vars[this.changeType])ig.vars[this.changeType](a,b);else ig.log("CHANGE_VAR_STRING: Invalid change type")}else ig.log("CHANGE_VAR_STRING: Variable Name is not a String!")}});ig.EVENT_STEP.SET_ATTRIB_VEC2=ig.EventStepBase.extend({actor:0,name:null,value:null,_wm:new ig.Config({attributes:{actor:{_type:"Actor",_info:"Actor to change"},name:{_type:"String",
_info:"Name of enemy attribute to set"},value:{_type:"Vec2Expression",_info:"Vec2 value to be set",_pointSelect:true}}}),init:function(a){assertContent(a,"actor","name","value");this.actor=a.actor;this.name=a.name;this.value=a.value},start:function(a,b){var c=ig.Event.getEntity(this.actor,b);if(c){var d=ig.Event.getExpressionValue(this.value);c.setAttribute(this.name,d)}}});ig.EVENT_STEP.SET_ATTRIB_VEC3=ig.EventStepBase.extend({actor:0,name:null,value:null,_wm:new ig.Config({attributes:{actor:{_type:"Actor",
_info:"Actor to change"},name:{_type:"String",_info:"Name of actor attribute to set"},value:{_type:"Vec3Expression",_info:"Vec3 value to be set",_pointSelect:true}}}),init:ig.EVENT_STEP.SET_ATTRIB_VEC2.prototype.init,start:ig.EVENT_STEP.SET_ATTRIB_VEC2.prototype.start});ig.EVENT_STEP.SET_ATTRIB_STRING=ig.EventStepBase.extend({actor:0,name:null,value:null,_wm:new ig.Config({attributes:{actor:{_type:"Actor",_info:"Actor to change"},name:{_type:"String",_info:"Name of enemy attribute to set"},value:{_type:"StringExpression",
_info:"String value to be set"}}}),init:ig.EVENT_STEP.SET_ATTRIB_VEC2.prototype.init,start:ig.EVENT_STEP.SET_ATTRIB_VEC2.prototype.start});ig.EVENT_STEP.PLAY_SOUND=ig.EventStepBase.extend({sound:null,position:{x:0,y:0},loop:false,settings:null,name:null,speed:null,_wm:new ig.Config({attributes:{sound:{_type:"SoundT",_info:"URL of sound."},volume:{_type:"Number",_info:"The volume. Value between 0 and 1.",_default:1},variance:{_type:"Number",_info:"Variance of sound source",_optional:true},position:{_type:"Vec2",
_info:"The position to play the sound at.",_pointSelect:true,_optional:true},name:{_type:"String",_info:"A name for the sound, is only valid if loop is true."},loop:{_type:"Boolean",_info:"True if the sound should loop. <i>EXPERIMENTAL!</i>"},offset:{_type:"Number",_info:"Offset to start the sound at. <i>EXPERIMENTAL!</i>"},startTime:{_type:"Number",_info:"Time to wait before playing the sound. <i>EXPERIMENTAL!</i>"},speed:{_type:"Number",_info:"Playback speed. 1=default speed. 0.5=half speed.",_optional:true}}}),
init:function(a){assertContent(a,"sound");this.sound=new ig.Sound(a.sound,a.volume||1,a.variance||0);this.position=a.position||null;this.settings={offset:a.offset||0,startTime:a.startTime||0,speed:a.speed||1};this.loop=a.loop||false;this.name=a.name||null},clearCached:function(){this.sound.clearCached()},start:function(){var a;if(this.name&&this.loop){a=this.sound.play(this.loop,this.settings);ig.soundManager.addNamedSound(this.name,a)}else a=this.sound.play(false,this.settings);a&&this.position&&
a.setFixPosition(this.position,null)}});ig.EVENT_STEP.STOP_SOUND=ig.EventStepBase.extend({name:null,_wm:new ig.Config({attributes:{name:{_type:"String",_info:"The of the sound to stop"}}}),init:function(a){this.name=a.name||null},start:function(){this.name&&ig.soundManager.stopNamedSounds(this.name)}});ig.EVENT_STEP.SET_MOVING_LAYER_STOP=ig.EventStepBase.extend({_wm:new ig.Config({attributes:{stopped:{_type:"Boolean",_info:"If true: stop moving layers"}}}),init:function(a){this.stopped=a.stopped||
false},start:function(){for(var a=ig.game.maps,b=a.length;b--;)a[b]instanceof ig.MAP.MovingParallax&&a[b].setStopped(this.stopped)}});ig.ConsoleType={LOG:function(a){ig.log(a)},WARN:function(a){ig.warn(a)},DEBUG:function(a){ig.debug(a)}};ig.EVENT_STEP.CONSOLE_LOG=ig.EventStepBase.extend({text:null,consoleType:ig.ConsoleType.LOG,_wm:new ig.Config({attributes:{text:{_type:"String",_info:"The text to display on the console. "},consoleType:{_type:"String",_info:"The type of the console log.",_select:ig.ConsoleType}}}),
init:function(a){this.text=a.text||null;this.consoleType=a.consoleType||ig.ConsoleType.LOG},start:function(){if(this.text)ig.ConsoleType[this.consoleType](this.text)}})});ig.baked=!0;
ig.module("impact.feature.base.entities.marker").requires("impact.base.actor-entity").defines(function(){ig.ENTITY.Marker=ig.Entity.extend({name:"",dir:null,face:Vec2.create(),_wm:new ig.Config({spawnable:true,attributes:{name:{_type:"String",_info:"Name of Marker. This will be referred in teleport commands."},dir:{_type:"String",_info:"Direction player is facing when teleported to this spot.",_select:ig.ActorEntity.FACE4},spawnCondition:{_type:"VarCondition",_info:"Condition for Enemy to spawn",
_popup:true,_optional:true}},label:function(){return"(face: "+this.dir+")"},drawBox:true,boxColor:"rgba(255,255,0, 0.5)"}),init:function(b,a,d,c){this.parent(b,a,d,c);this.coll.type=ig.COLLTYPE.NONE;this.coll.setSize(32,32,0);this.dir=c.dir;ig.ActorEntity.getFaceVec(ig.ActorEntity.FACE8[c.dir]||0,this.face)},update:function(){},applyMarkerPosition:function(b){b.coll.level=this.coll.level;b.coll.baseZPos=this.coll.baseZPos;b.coll.pos.z=this.coll.pos.z;b.face.x=this.face.x;b.face.y=this.face.y;b.setPos(this.coll.pos.x+
this.coll.size.x/2-b.coll.size.x/2,this.coll.pos.y+this.coll.size.y/2-b.coll.size.y/2)}})});ig.baked=!0;
ig.module("impact.feature.base.entities.object-layer-view").requires("impact.base.actor-entity").defines(function(){var b=Vec2.create(),a=Vec2.create();ig.ObjectLayerTools={getSpriteCount:function(a,b,e,f){for(var a=a.coll,e=e||a.pos,f=f||a.size,g=a=0;g<b.length;++g){var h=b[g],i=h.chunkSizeX/ig.system.scale,h=h.chunkSizeY/ig.system.scale,j=1;Math.floor(e.x/i)!=Math.floor((e.x+f.x)/i)&&(j=j*2);Math.floor((e.y-e.z-f.z)/h)!=Math.floor((e.y-e.z+f.y)/h)&&(j=j*2);a=a+j}return a},updateSprites:function(d,
c,e,f,g,h){if(!c.length)return true;for(var i=c.length;i--;)if(!c[i].preRenderedChunks)return false;var i=d.coll,g=g||i.pos,h=h||i.size,j=Vec2.assignC(b,g.x,g.y-g.z-h.z),k=Vec2.assignC(a,g.x+h.x,g.y-g.z+h.y);if(f){Vec2.subC(j,f.x,f.y-f.z||0);Vec2.subC(k,f.x,f.y-f.z||0);j.x=Math.round(j.x);j.y=Math.round(j.y);k.x=Math.round(k.x);k.y=Math.round(k.y)}for(i=f=0;i<c.length;++i){for(var l=c[i],o=l.chunkSizeX/ig.system.scale,m=l.chunkSizeY/ig.system.scale,n=Math.floor(j.x/o),p=Math.floor(k.x/o),r=Math.floor(j.y/
m),t=Math.floor(k.y/m),q=j.x%o,s=j.y%m;q<0;)q=q+o;for(;s<0;)s=s+m;for(var o=o-q,m=m-s,v=Math.round(h.y*e),v=h.y-v,y=r;y<=t;++y)for(var u=n;u<=p;++u){var z=g.x,D=g.y,C=g.z,A=h.x,B=h.y,w=h.z,x=l.preRenderedChunks[y]&&l.preRenderedChunks[y][u],E=Math.round(e*B);if(x){if(u<p)A=o;else if(u>n){A=A-o;z=z+o}if(y<t)if(m>=v){E=v+w-m;if(E>=0){w=w-E;C=C+E;B=v;E=0}else{B=v-E;E=-E}}else{C=C+w;B=m;E=w=0}else if(y>r)if(m>=v){E=v+w-m;if(E>=0){D=D+v;w=w-(m-v);E=B=B-v}else{w=0;D=D+(v-E);B=B-(v-E);E=0}}else{D=D+m;B=
B-m}var G=u>n?0:q,J=y>r?0:s;if(d.sprites[f]){d.sprites[f].setPos(z,D,C);d.sprites[f].setSize(A,B,w,E);d.sprites[f].aboveZ=1;d.sprites[f].setImageSrc(new ig.ImageCanvasWrapper(x),G,J)}f++}}}return true}};ig.EntityHideManager=ig.Class.extend({hideCondition:null,hideTimer:0,hidden:false,efficientMode:false,init:function(a){this.hideCondition=new ig.VarCondition(a)},update:function(a){this.efficientMode||this.varsChanged(a);this.hideTimer=Math.max(0,this.hideTimer-ig.system.actualTick);var b=this.hideTimer/
0.2,b=this.hidden?b:1-b,b=0.1*(1-b)+1*b;if(a.animState)a.animState.alpha=b;else for(var e=a.sprites.length;e--;)a.sprites[e].setAlpha(b);this.efficientMode&&!this.hideTimer&&a.coll.setUpdateType(ig.COLL_UPDATE_TYPE.STATIC)},isBusy:function(){return this.hideTimer},varsChanged:function(a){var b=this.hideCondition.evaluate();if(b!=this.hidden){this.hideTimer=0.2-this.hideTimer;this.hidden=b;this.efficientMode&&a.coll.setUpdateType(ig.COLL_UPDATE_TYPE.DYNAMIC)}}});ig.ENTITY.ObjectLayerView=ig.AnimatedEntity.extend({maps:null,
spritesInitialized:false,hideManager:null,wallY:0,fx:{show:null,hide:null,handle:null,isHiding:false},_wm:new ig.Config({spawnable:true,scalableX:true,scalableY:true,scalableStep:4,attributes:{layer:{_type:"String",_info:"Object Layer from which to display graphic.",_select:{object1:1,object2:1,object3:1}},collType:{_type:"String",_info:"CollisionType",_select:ig.COLLTYPE},zHeight:{_type:"Number",_info:"Z height of displayed object"},spawnCondition:{_type:"VarCondition",_info:"Condition for prop to appear",
_popup:true},hideCondition:{_type:"VarCondition",_info:"Condition for entity to become transparent",_popup:true},wallY:{_type:"Number",_info:"Wall Y Value"},terrain:{_type:"String",_info:"Terrain of prop",_select:ig.TERRAIN,_withNull:true},heightShape:{_type:"String",_info:"Height shape (for stairs or other slopes)",_select:ig.COLL_HEIGHT_SHAPE},shape:{_type:"String",_info:"Height-Shape of Block Entity",_select:ig.COLLSHAPE,_optional:true},blockNavMap:{_type:"Boolean",__info:"If true, block path map and update when destroyed"},
showEffect:{_type:"Effect",_info:"Effect to show when showing entity",_optional:true},hideEffect:{_type:"Effect",_info:"Effect to show when hiding entity",_optional:true},guiSprites:{_type:"Boolean",_info:"If true: display as gui sprites",_optional:true}},drawBox:false,boxColor:"rgba(120,255,120, 0.5)",frontColor:"rgba(80,244,80, 0.5)",alwaysRecreate:true}),init:function(a,b,e,f){this.parent(a,b,e,f);this.coll.type=ig.COLLTYPE[f.collType||"BLOCK"];this.coll.size.z=f.zHeight||0;this.coll.heightShape=
ig.COLL_HEIGHT_SHAPE[f.heightShape]||ig.COLL_HEIGHT_SHAPE.NONE;this.coll.shape=ig.COLLSHAPE[f.shape||"RECTANGLE"];this.maps=ig.game.getObjectMaps(f.layer);this.wallY=(f.wallY||0).limit(0,1);this.terrain=ig.TERRAIN[f.terrain]||null;this.fx.show=f.showEffect?new ig.EffectHandle(f.showEffect):null;this.fx.hide=f.hideEffect?new ig.EffectHandle(f.hideEffect):null;this.blockNavMap=f.blockNavMap;this.guiSprites=f.guiSprites||false;f.hideCondition?this.hideManager=new ig.EntityHideManager(f.hideCondition):
this.coll.setUpdateType(ig.COLL_UPDATE_TYPE.STATIC)},onKill:function(a){this.parent(a);this.fx.show&&this.fx.show.clearCached();this.fx.hide&&this.fx.hide.clearCached()},show:function(a){this.parent(a);this.fx.handle&&this.fx.handle.stop();if(!a&&this.fx.show){this.animState.alpha=0;this.fx.isHiding=false;this.fx.handle=this.fx.show.spawnOnTarget(this,{callback:this})}if(this.blockNavMap)this.navBlocker=ig.navigation.getNavBlock(this)},onHideRequest:function(){this.navBlocker&&this.navBlocker.remove();
this.navBlocker=null;if(this.fx.hide){this.fx.isHiding=true;this.fx.handle=this.fx.hide.spawnOnTarget(this,{callback:this})}else this.hide()},onEffectEvent:function(){if(this.fx.handle&&this.fx.handle.isDone()){this.fx.handle=null;this.fx.isHiding&&this.hide()}},initSprites:function(){var a=ig.ObjectLayerTools.getSpriteCount(this,this.maps);this.setSpriteCount(a,this.guiSprites)},update:function(){this.hideManager&&this.hideManager.update(this)},updateSprites:function(){if(!this.spritesInitialized&&
ig.ObjectLayerTools.updateSprites(this,this.maps,this.wallY))this.spritesInitialized=true;for(var a=this.sprites.length;a--;)this.sprites[a].setAlpha(this.animState.alpha);this.animState.updateSpriteColor(this)}});ig.ENTITY.ObjectLayerView.staticNavBlock=true});ig.baked=!0;
ig.module("impact.feature.base.entities.touch-trigger").requires("impact.base.actor-entity").defines(function(){ig.TOUCH_TRIGGER_TYPE={SET_TRUE:{},SET_FALSE:{setFalse:true},WHILE_TOUCH_TRUE:{keepTrack:true},WHILE_TOUCH_ADD_1:{keepTrack:true,add:true}};ig.ENTITY.TouchTrigger=ig.Entity.extend({name:"",face:Vec2.create(),touchType:0,touchedCnt:0,startCondition:null,isOn:false,_wm:new ig.Config({spawnable:true,attributes:{startCondition:{_type:"VarCondition",_info:"Condition for the touch trigger to react",
_popup:true},variable:{_type:"VarName",_info:"Variable to be changed"},type:{_type:"String",_info:"Type of change",_select:ig.TOUCH_TRIGGER_TYPE,_default:"SET_TRUE"},zHeight:{_type:"Integer",_info:"Height of trigger",_default:64},shape:{_type:"String",_info:"Shape of Block Entity",_select:ig.COLLSHAPE,_optional:true},reactToParty:{_type:"Boolean",_info:"If true: also react to party members"}},scalableX:true,scalableY:true,label:function(){return"["+this.variable+"]"},drawBox:true,boxColor:"rgba(255,0,255, 0.25)",
frontColor:"rgba(120,0,120, 0.25)"}),init:function(b,a,d,c){this.parent(b,a,d,c);this.coll.type=ig.COLLTYPE.NONE;this.variable=c.variable;this.touchType=ig.TOUCH_TRIGGER_TYPE[c.type||"SET_TRUE"];this.shape=ig.COLLSHAPE[c.shape]||ig.COLLSHAPE.RECTANGLE;this.coll.size.z=c.zHeight*1;this.startCondition=new ig.VarCondition(c.startCondition||"true");this.reactToParty=c.reactToParty||false;this.isOn=false;this.touchType.keepTrack&&(this.touchType.add?ig.vars.add(this.variable,0):ig.vars.set(this.variable,
false))},update:function(){if(this.startCondition.evaluate()){var b=this.coll,a=ig.game.playerEntity;if(a){a=a.coll.intersectsWith(b.pos.x,b.pos.y,b.pos.z,b.size.x,b.size.y,b.size.z,true,this.shape);if(this.reactToParty)for(var d=sc.party.getPartySize();!a&&d--;){var c=sc.party.getPartyMemberEntityByIndex(d);c&&(a=c.coll.intersectsWith(b.pos.x,b.pos.y,b.pos.z,b.size.x,b.size.y,b.size.z,true,this.shape))}a?this.setOn():this.touchType.keepTrack&&this.setOff()}}else this.touchType.keepTrack&&this.setOff()},
setOn:function(){if(!this.touchType.keepTrack||!this.isOn){this.touchType.setFalse?ig.vars.set(this.variable,false):this.touchType.add?ig.vars.add(this.variable,1):ig.vars.set(this.variable,true);this.isOn=true}},setOff:function(){if(!this.touchType.keepTrack||this.isOn){this.touchType.setFalse?ig.vars.set(this.variable,true):this.touchType.add?ig.vars.sub(this.variable,1):ig.vars.set(this.variable,false);this.isOn=false}}})});ig.baked=!0;
ig.module("impact.feature.base.entities.sound-entities").requires("impact.base.entity","impact.base.actor-entity").defines(function(){ig.ENTITY.SoundSource=ig.Entity.extend({sound:null,soundHandle:null,radius:20,rangeType:ig.SOUND_RANGE_TYPE.CIRCULAR,_wm:new ig.Config({spawnable:true,attributes:{sound:{_type:"SoundT",_info:"URL of sound."},volume:{_type:"Number",_info:"The volume. Value between 0 and 1.",_default:1},speed:{_type:"Number",_info:"Playback speed. 1=default speed. 0.5=half speed.",_optional:true},
fadeDuration:{_type:"Number",_info:"Duration in seconds the sound is faded out with",_optional:true},radius:{_type:"Number",_info:"The radius of the sound range. In Pixels.",_default:800},rangeType:{_type:"Number",_select:ig.SOUND_RANGE_TYPE,_info:"Determines in which direction the sound range goes",_default:ig.SOUND_RANGE_TYPE.CIRCULAR},spawnCondition:{_type:"VarCondition",_info:"Condition for Enemy to spawn",_popup:true}},label:function(){return"Sound Source"},drawCircle:function(b){return(b.radius||
0)/3},boxColor:"rgba(200,200,200, 0.5)",borderColor:"rgba(10, 10, 223, 0.5)",circleColor:"rgba(200, 200, 200, 1)"}),init:function(b,a,d,c){this.parent(b,a,d,c);if(c.sound)this.sound=new ig.Sound(c.sound,c.volume||1);this.coll.type=ig.COLLTYPE.NONE;this.coll.setSize(16,16,0);this.radius=c.radius||0;this.rangeType=c.rangeType||ig.SOUND_RANGE_TYPE.CIRCULAR;this.settings={speed:c.speed||1,fadeDuration:c.fadeDuration||0}},show:function(b){this.parent(b)},stop:function(){if(this.soundHandle){this.soundHandle.stop();
this.soundHandle=null}},update:function(){if(!this.soundHandle&&!this._hidden){this.soundHandle=this.sound.play(true,this.settings);this.soundHandle.setEntityPosition(this,ig.ENTITY_ALIGN.center,null,this.radius,this.rangeType)}this.parent()},hide:function(){this.parent();this.stop()},onKill:function(b){this.parent(b);this.stop();this.sound&&this.sound.clearCached()}})});ig.baked=!0;
ig.module("impact.feature.base.plug-in").requires("impact.feature.base.action-steps","impact.feature.base.event-steps","impact.feature.base.entities.marker","impact.feature.base.entities.object-layer-view","impact.feature.base.entities.touch-trigger","impact.feature.base.entities.sound-entities").defines(function(){if(window.wm){wm.addStepColorRule(/ACTION/,"green");wm.addStepColorRule(/ANIM/,"green");wm.addStepColorRule(/WAIT/,"gray");wm.addStepColorRule(/VAR/,"violet");wm.addStepColorRule(/LABEL/,
"extremeRed")}window.wm&&wm.postLoadModules.push("impact.feature.base.editors.base-editor")});ig.baked=!0;
ig.module("impact.feature.storage.storage").requires("impact.base.game").defines(function(){ig.SAVE_MODE={ENABLED:1,DISABLED:0};ig.SaveSlot=ig.Class.extend({src:null,data:null,init:function(a){if(ig.StorageTools.isEncrypted(a)){this.src=a;this.data=ig.StorageTools.decryptSlotData(this.src)}else{this.data=a;this.src=ig.StorageTools.encryptSlotData(this.data)}},getData:function(){return this.data},getSrc:function(){return this.src},mergeData:function(a){ig.merge(this.data,a);this.src=ig.StorageTools.encryptSlotData(this.data)}});
var b={},a={rename:true,from:".backup",to:".backup2"},d={rename:true,from:"",to:".backup"},c={save:true};ig.StorageData=ig.Class.extend({loaded:false,data:null,saveDataStack:[],path:null,cacheType:"STORAGE",ioState:null,loadPathStack:null,init:function(a){this.path=a;window.wm||ig.addResource(this)},load:function(a){this._loadCallback=a;if(ig.platform==ig.PLATFORM_TYPES.DESKTOP){this.ioState=b;this.loadPathStack=this._getSaveFilePathList();this._loadFromList()}else this._loadStorageFromData(localStorage.getItem(this.path))},
_loadFromList:function(){var a=this.loadPathStack.shift();window.require("fs").readFile(a,this._loadResponse.bind(this))},_loadResponse:function(a,b){window.require("fs");if(a||!this._loadStorageFromData(b)){ig.debug("FAILED TO LOAD FILE");this.loadPathStack.length>0?this._loadFromList():this._loadStorageFromData(localStorage.getItem(this.path))}},save:function(a){if(ig.platform==ig.PLATFORM_TYPES.DESKTOP){this.saveDataStack.push(a);this.ioState||this._saveToFile()}else localStorage.setItem(this.path,
a)},_saveToFile:function(){this._doIoStep(a)},_doIoStep:function(a){this.ioState=a;if(this.ioState.rename){var a=window.require("fs"),b=this._getSaveFilePathList()[0];a.rename(b+this.ioState.from,b+this.ioState.to,this._saveResponse.bind(this))}else if(this.ioState.save){a=window.require("fs");b=this._getSaveFilePathList()[0];this.ioState=c;a.writeFile(b,this.saveDataStack[0],this._saveResponse.bind(this))}},_saveResponse:function(b){if(this.ioState.rename)this.ioState==a?this._doIoStep(d):this._doIoStep(c);
else{b&&localStorage.setItem(this.path,this.saveDataStack[0]);this._resolveSave()}},_resolveSave:function(){if(this.saveDataStack.length>1){for(;this.saveDataStack.length>1;)this.saveDataStack.shift();this._saveToFile()}else{this.ioState=null;this.saveDataStack.length=0}},_getSaveFilePathList:function(){var a=[],b=window.require("nw.gui").App.dataPath,c=b.indexOf("\\User Data\\Default");if(c!=-1){c=b.substr(0,c);a.push(c+"/"+this.path);a.push(c+"/"+this.path+".backup");a.push(c+"/"+this.path+".backup2")}a.push(b+
"/"+this.path);a.push(b+"/"+this.path+".backup");a.push(b+"/"+this.path+".backup2");return a},_loadStorageFromData:function(a){if(a){var b;try{ig.StorageTools.isEncrypted(a)&&(a=ig.StorageTools.decrypt(a));b=JSON.parse(a)}catch(c){return false}this.data=b}this._loadCallback(this.cacheType,this.path,true);this.loaded=true;this.ioState=this.loadPathStack=null;return true},getData:function(){return this.data}});ig.Storage=ig.GameAddon.extend({mapSaveEnabled:true,resetAfterTeleport:false,slot:0,slots:[],
autoSlot:null,lastUsedSlot:-2,listeners:[],saveObject:{},globalData:{},checkPointSave:{},data:new ig.StorageData(window.IG_GAME_DEBUG?"cc.save.dev":"cc.save"),currentLoadFile:null,checkpointCondCallback:null,autoSaveCondCallback:null,loadHint:null,init:function(){this.parent("Storage");var a=this.data.getData();if(a){if(a.lastSlot!==void 0)this.lastUsedSlot=a.lastSlot;for(var b=a.slots,c=0;c<b.length;++c)try{this.slots.push(new ig.SaveSlot(b[c]))}catch(d){console.log("Error Loading Slot "+c)}if(a.autoSlot)try{this.autoSlot=
new ig.SaveSlot(a.autoSlot)}catch(i){console.log("Error Loading Autoslot")}a=a.globals;if(ig.StorageTools.isEncrypted(a)){a=ig.StorageTools.decrypt(a);a=JSON.parse(a)}this.globalData=a}},setAutoSaveCondCallback:function(a){this.autoSaveCondCallback=a},setCheckpointCondCallback:function(a){this.checkpointCondCallback=a},register:function(a){a&&this.listeners.push(a)},saveCheckpoint:function(a,b,c){this.checkPointSave={};this._saveState(this.checkPointSave,a,b&&b.getJson());(!this.autoSaveCondCallback||
this.autoSaveCondCallback(c))&&this.saveAutoSlot(this.checkPointSave)},getLastSlotData:function(a){return this.getSlotData(this.lastUsedSlot==-2?0:this.lastUsedSlot,a)},getAutoSlotData:function(a){return this.getSlotData(-1,a)},hasSaves:function(){return this.slots.length>0||this.autoSlot},getSlotData:function(a,b){var c;if(a==-1){if(!this.autoSlot)return"";c=ig.copy(this.autoSlot.getData())}else{if(!this.slots[a])return"";c=ig.copy(this.slots[a].getData())}b&&ig.merge(c,b);return this._encrypt(JSON.stringify(c))},
pushSlotData:function(a){this.slots.push(new ig.SaveSlot(a));this._saveToStorage()},saveAutoSlot:function(a){this.autoSlot=new ig.SaveSlot(a);this.lastUsedSlot=-1;this._saveToStorage()},save:function(a){var a=a||0,b={};this._saveState(b,null,ig.copy(this.checkPointSave.position));this.checkPointSave=b;var c=new ig.SaveSlot(b);this.slots[a]&&this.slots.splice(a,1);this.slots.unshift(c);this.lastUsedSlot=0;this._saveToStorage();ig.debug("Saved Game: %O",b)},_saveToStorage:function(){for(var a={},b=
0;b<this.listeners.length;b++)if(this.listeners[b].onStorageGlobalSave)this.listeners[b].onStorageGlobalSave(a);for(var c={},d=[],b=0;b<this.slots.length;++b)d[b]=this.slots[b].getSrc();c.slots=d;c.autoSlot=this.autoSlot&&this.autoSlot.getSrc();c.globals=this._encrypt(JSON.stringify(a));c.lastSlot=this.lastUsedSlot;this.data.save(JSON.stringify(c));return c},_saveState:function(a,b,c){for(var d=0;d<ig.game.entities.length;d++){var i=ig.game.entities[d];if(i&&i.onSave)i.onSave()}a.map=b||ig.game.mapName;
a.vars=ig.vars.getJson();a.position=c?c:this._createCopyTeleportPosition(ig.game.playerEntity);for(d=0;d<this.listeners.length;d++)if(this.listeners[d].onStorageSave)this.listeners[d].onStorageSave(a)},saveGlobals:function(){var a=this._saveToStorage();ig.debug("Saved Globals: %O",a)},loadSlot:function(a,b){var a=a||0,b=b==void 0?true:b,c;if(typeof a=="number"){c=this.getSlot(a);this.lastUsedSlot=a}else c=a;if((c=c.getData())&&c.vars){this.currentLoadFile=ig.copy(c);this.checkPointSave=ig.copy(c);
this.resetAfterTeleport=false;var d=ig.TeleportPosition.createFromJson(c.position);b&&ig.game.teleport(c.map,d,"LOAD");ig.debug("Load Game: %O",c)}else ig.debug("Loading Game failed, Slot "+a+" does not have a save file")},deleteSlot:function(a){if(!(a==void 0||a<0||a>=this.slots.length||!this.slots[a])){this.slots.splice(a,1);this.lastUsedSlot=Math.min(a,this.slots.length-1);this._saveToStorage()}},loadCheckpoint:function(){this.resetAfterTeleport=true;this.currentLoadFile=ig.copy(this.checkPointSave);
var a=ig.TeleportPosition.createFromJson(this.checkPointSave.position);ig.game.teleport(this.checkPointSave.map,a)},loadAutosave:function(){this.loadSlot(-1);this.resetAfterTeleport=true},_isEncrypted:function(a){return typeof a=="string"&&a.indexOf("[-!_0_!-]")==0},_encrypt:function(a,b){var c=75*b+"",d=ig.blog("Getting key from Server...");if(b=c+(d^NaN))b=":_."+b;d=window.CryptoJS.AES.encrypt(a,b).toString();return"[-!_0_!-]"+d},_decrypt:function(a,b){var c=75*b+"",d=ig.blog("Getting key from Server...");
if(b=c+(d^NaN))b=":_."+b;c=window.CryptoJS;a=a.substr(9,a.length);return c.AES.decrypt(a,b).toString(c.enc.Utf8)},_createCopyTeleportPosition:function(a){if(!a)return null;var b=new ig.TeleportPosition;b.setFromData(null,ig.copy(a.coll.pos),a.face,a.coll.level,a.coll.baseZPos,a.coll.size);return b.getJson()},onLevelLoadStart:function(a){if(this.currentLoadFile){ig.vars.restoreFromJson(this.currentLoadFile.vars);ig.vars.onLevelChange(a.name,true);for(var b=0;b<this.listeners.length;b++)if(this.listeners[b].onStoragePreLoad)this.listeners[b].onStoragePreLoad(this.currentLoadFile)}if(a.attributes)this.mapSaveEnabled=
ig.SAVE_MODE[a.attributes.saveMode]==ig.SAVE_MODE.ENABLED?true:false},levelLoadedOrder:-100,onLevelLoaded:function(){if(this.currentLoadFile){for(var a=0;a<this.listeners.length;a++)if(this.listeners[a].onStoragePostLoad)this.listeners[a].onStoragePostLoad(this.currentLoadFile);this.currentLoadFile=null}else if(!this.checkpointCondCallback||this.checkpointCondCallback()){this.saveCheckpoint(ig.game.mapName,ig.game.teleporting.position,this.loadHint);if(ig.game.marker&&this.checkPointSave.position)this.checkPointSave.position.marker=
ig.game.marker}},onTeleport:function(a,b,c){this.loadHint=c},getSlot:function(a){return a==-1?this.autoSlot:this.slots[a]},hasSaveSlotData:function(a){return this.slots[a||0]?true:false},hasSlots:function(){return this.slots.length>0}});ig.StorageTools={isEncrypted:function(a){return typeof a=="string"&&a.indexOf("[-!_0_!-]")==0},encrypt:function(a,b){var c=75*b+"",d=ig.blog("Getting key from Server...");if(b=c+(d^NaN))b=":_."+b;d=window.CryptoJS.AES.encrypt(a,b).toString();return"[-!_0_!-]"+d},decrypt:function(a,
b){var c=75*b+"",d=ig.blog("Getting key from Server...");if(b=c+(d^NaN))b=":_."+b;c=window.CryptoJS;a=a.substr(9,a.length);return c.AES.decrypt(a,b).toString(c.enc.Utf8)},decryptSlotData:function(a){return JSON.parse(this.decrypt(a))},encryptSlotData:function(a){return this.encrypt(JSON.stringify(a))}};ig.addGameAddon(function(){return ig.storage=new ig.Storage})});ig.baked=!0;
ig.module("impact.feature.bgm.bgm").requires("impact.base.event","impact.base.game","impact.base.sound","impact.feature.storage.storage").defines(function(){ig.BGM_SWITCH_MODE={IMMEDIATELY:{fadeOut:0,fadeIn:0},FAST_OUT:{fadeOut:0.5,fadeIn:0},MEDIUM_OUT:{fadeOut:1,fadeIn:0},SLOW_OUT:{fadeOut:2,fadeIn:0},VERY_SLOW_OUT:{fadeOut:5,fadeIn:0},FAST:{fadeOut:0.5,fadeIn:0.5},MEDIUM:{fadeOut:1,fadeIn:1},SLOW:{fadeOut:2,fadeIn:2},VERY_SLOW:{fadeOut:5,fadeIn:5}};ig.BGM_TRACK_LIST={};ig.BGM_DEFAULT_TRACKS={};
ig.BgmTrack=ig.Class.extend({name:null,track:null,init:function(a){this.name=a;if(a=ig.BGM_TRACK_LIST[a])this.track=new ig.Track(a.path,a.loopEnd,a.introPath,a.introEnd,a.volume)},get:function(){return this.track},clearCached:function(){this.track&&this.track.decreaseRef()},copy:function(){return new ig.BgmTrack(this.name)}});ig.BgmTrackSet=ig.Class.extend({name:null,entries:null,init:function(a){var b={},c=ig.BGM_DEFAULT_TRACKS[a],e;for(e in c)b[e]={track:ig.bgm.loadTrack(c[e].track),volume:c[e].volume};
this.name=a;this.entries=b},get:function(a){return this.entries[a]},clearCached:function(){for(var a in this.entries)this.entries[a].track.clearCached()},copy:function(){return new ig.BgmTrackSet(this.name)}});var b=[];ig.Bgm=ig.GameAddon.extend({defaultTrackSet:null,defaultTrackTypeStack:["field"],trackStack:[],overloadDefault:false,defaultMode:"SLOW_OUT",mapDefaultTrackSet:null,delayedResume:0,pauseAutoResumeBlock:false,resumeOnChange:null,init:function(){this.parent("BGM");ig.storage.register(this)},
loadTrack:function(a){if(ig.music)return new ig.BgmTrack(a)},loadTrackSet:function(a){return new ig.BgmTrackSet(a)},setDefault:function(a,b,c){this.clearResumeOnChange();this.defaultTrackSet&&this.defaultTrackSet.clearCached();this.defaultTrackSet=a.copy();!c&&!this.overloadDefault&&this.resumeDefault(b)},isPlayingDefault:function(){return!this.overloadDefault},getDefaultTrackTypeCount:function(){return this.defaultTrackTypeStack.length},hasDefaultTrackType:function(a){return!(!this.defaultTrackSet||
!this.defaultTrackSet.get(a))},pushDefaultTrackType:function(a,b){this.clearResumeOnChange();this.defaultTrackTypeStack.push(a);this.overloadDefault||this.resumeDefault(b)},popDefaultTrackType:function(a){this.clearResumeOnChange();this.defaultTrackTypeStack.pop();this.overloadDefault||this.resumeDefault(a)},setResumeOnChange:function(a){this.resumeOnChange=a},clearResumeOnChange:function(){this.resumeOnChange&&this.resumeDefault(this.resumeOnChange)},resumeDefault:function(a){this.resumeOnChange=
null;for(var b=this.defaultTrackTypeStack.length;this.trackStack.length>b;)this.pop(a);var c=this._getDefaultTrackEntry();if(c){this.trackStack.length<b&&this.push(c.track,c.volume,a);ig.music.isTrackPlaying(c.track.track,c.volume)||this.play(c.track,c.volume,a)}this.overloadDefault=false},play:function(a,b,c){this.clearResumeOnChange();this.overloadDefault=true;c=this._getModeData(c);ig.music.play(a.get(),c.fadeOut,c.fadeIn,b);(c=this.trackStack.pop())&&c.track.clearCached();this.trackStack.push({track:a.copy(),
volume:b})},push:function(a,b,c){this.clearResumeOnChange();this.overloadDefault=true;c=this._getModeData(c);ig.music.push(a.get(),c.fadeOut,c.fadeIn,b);this.trackStack.push({track:a.copy(),volume:b})},pop:function(a){this.clearResumeOnChange();a=this._getModeData(a);ig.music.pop(a.fadeOut,a.fadeIn);(a=this.trackStack.pop())&&a.track.clearCached();a=this._getDefaultTrackEntry();if(this.trackStack.length==this.defaultTrackTypeStack.length&&a&&ig.music.isTrackPlaying(a.track.get(),a.volume))this.overloadDefault=
false},clear:function(a){for(this.resumeOnChange=null;this.defaultTrackTypeStack.length>1;)this.popDefaultTrackType(a);for(this.overloadDefault=false;this.trackStack.length>0;)this.pop(a);this.defaultTrackSet&&this.defaultTrackSet.clearCached();this.defaultTrackSet=null},inbetween:function(a,b,c){c=this._getModeData(c);ig.music.inbetween(a.get(),c.fadeIn,c.fadeOut,b)},pause:function(a){a=this._getModeData(a);ig.music.pause(a.fadeOut);this.pauseAutoResumeBlock=true},resume:function(a){a=this._getModeData(a);
ig.music.resume(a.fadeIn)},onStorageSave:function(a){for(var b=[],c=0;c<this.trackStack.length;++c)b.push({track:this.trackStack[c].track.name,volume:this.trackStack[c].volume});a.bgm={defaultTrackSet:this.defaultTrackSet?this.defaultTrackSet.name:null,defaultTrackTypeStack:this.defaultTrackTypeStack,trackStack:b,overloadDefault:this.overloadDefault,paused:ig.music.paused,resumeOnChange:this.resumeOnChange}},onStoragePreLoad:function(a){a=a.bgm;this.clear();if(a){this.defaultTrackSet=this.loadTrackSet(a.defaultTrackSet);
for(var a=a.trackStack,d=0;d<a.length;++d)b.push(this.loadTrack(a[d].track))}},onStoragePostLoad:function(a){if(a=a.bgm){this.defaultTrackTypeStack=a.defaultTrackTypeStack;for(var d=a.trackStack,c=0;c<d.length;++c){var e=b[c];this.push(e,d[c].volume,"IMMEDIATELY");e.clearCached()}this.overloadDefault=a.overloadDefault;this.resumeOnChange=a.resumeOnChange||null;b.length=0;a.paused&&this.pause("IMMEDIATELY")}},levelLoadStartOrder:100,onLevelLoadStart:function(a){this.clearResumeOnChange();if(a.attributes&&
a.attributes.bgm){this.mapDefaultTrackSet&&this.mapDefaultTrackSet.clearCached();this.mapDefaultTrackSet=this.loadTrackSet(a.attributes.bgm);this.setDefault(this.mapDefaultTrackSet,null,true)}},levelLoadedOrder:100,onLevelLoaded:function(){this.delayedResume=2;this.pauseAutoResumeBlock=false},onReset:function(){this.clear("MEDIUM")},onDeferredUpdate:function(){if(this.delayedResume){this.delayedResume--;this.delayedResume==0&&!this.overloadDefault&&!this.pauseAutoResumeBlock&&this.resumeDefault()}},
_getModeData:function(a){return ig.BGM_SWITCH_MODE[a]||ig.BGM_SWITCH_MODE[this.defaultMode]},_getDefaultTrackEntry:function(){var a=this.defaultTrackTypeStack[this.defaultTrackTypeStack.length-1];return this.defaultTrackSet&&this.defaultTrackSet.get(a)}});ig.addGameAddon(function(){return ig.bgm=new ig.Bgm});ig.Bgm.startTrack=null;ig.Bgm.preloadStartTrack=function(a){ig.Bgm.startTrack=new ig.BgmTrack(a)}});ig.baked=!0;
ig.module("impact.feature.bgm.bgm-steps").requires("impact.base.action","impact.base.event","impact.feature.bgm.bgm").defines(function(){ig.EVENT_STEP.PLAY_BGM=ig.EventStepBase.extend({track:null,volume:null,mode:null,_wm:new ig.Config({attributes:{bgm:{_type:"String",_info:"Background Music to play",_select:ig.BGM_TRACK_LIST},volume:{_type:"Number",_info:"Volume of music (0 = silent, 1 = max volume)"},mode:{_type:"String",_info:"Mode of transition",_select:ig.BGM_SWITCH_MODE}}}),init:function(b){this.track=
ig.bgm.loadTrack(b.bgm);this.volume=b.volume||1;this.mode=b.mode||0},clearCached:function(){this.track.clearCached()},run:function(){ig.bgm.play(this.track,this.volume,this.mode);return true}});ig.EVENT_STEP.PAUSE_BGM=ig.EventStepBase.extend({mode:null,_wm:new ig.Config({attributes:{mode:{_type:"String",_info:"Mode of transition",_select:ig.BGM_SWITCH_MODE}}}),init:function(b){this.mode=b.mode||0},run:function(){ig.bgm.pause(this.mode);return true}});ig.EVENT_STEP.RESUME_BGM=ig.EventStepBase.extend({mode:null,
_wm:new ig.Config({attributes:{mode:{_type:"String",_info:"Mode of transition",_select:ig.BGM_SWITCH_MODE}}}),init:function(b){this.mode=b.mode||0},run:function(){ig.bgm.resume(this.mode);return true}});ig.EVENT_STEP.PUSH_BGM=ig.EventStepBase.extend({track:null,volume:null,mode:null,_wm:new ig.Config({attributes:{bgm:{_type:"String",_info:"Background Music to play",_select:ig.BGM_TRACK_LIST},volume:{_type:"Number",_info:"Volume of music (0 = silent, 1 = max volume)"},mode:{_type:"String",_info:"Mode of transition",
_select:ig.BGM_SWITCH_MODE}}}),init:function(b){this.track=ig.bgm.loadTrack(b.bgm);this.volume=b.volume||1;this.mode=b.mode||0},clearCached:function(){this.track.clearCached()},run:function(){ig.bgm.push(this.track,this.volume,this.mode);return true}});ig.EVENT_STEP.POP_BGM=ig.EventStepBase.extend({_wm:new ig.Config({attributes:{mode:{_type:"String",_info:"Mode of transition",_select:ig.BGM_SWITCH_MODE}}}),init:function(b){this.mode=b.mode||0},run:function(){ig.bgm.pop(this.mode);return true}});ig.EVENT_STEP.PLAY_IN_BETWEEN_BGM=
ig.EventStepBase.extend({track:null,volume:null,mode:null,_wm:new ig.Config({attributes:{bgm:{_type:"String",_info:"Background Music to play only once",_select:ig.BGM_TRACK_LIST},volume:{_type:"Number",_info:"Volume of music (0 = silent, 1 = max volume)"},mode:{_type:"String",_info:"Mode of transition",_select:ig.BGM_SWITCH_MODE}}}),init:function(b){this.track=ig.bgm.loadTrack(b.bgm);this.volume=b.volume||1;this.mode=b.mode||0},clearCached:function(){this.track.clearCached()},run:function(){ig.bgm.inbetween(this.track,
this.volume,this.mode);return true}});ig.EVENT_STEP.SET_DEFAULT_BGM=ig.EventStepBase.extend({trackSet:null,mode:null,_wm:new ig.Config({attributes:{defaultBgm:{_type:"String",_info:"Default BGM",_select:ig.BGM_DEFAULT_TRACKS},mode:{_type:"String",_info:"Mode of transition",_select:ig.BGM_SWITCH_MODE}}}),init:function(b){this.trackSet=ig.bgm.loadTrackSet(b.defaultBgm);this.mode=b.mode||0},clearCached:function(){this.trackSet.clearCached()},run:function(){ig.bgm.setDefault(this.trackSet,this.mode);
return true}});ig.EVENT_STEP.RESUME_DEFAULT_BGM=ig.EventStepBase.extend({_wm:new ig.Config({attributes:{mode:{_type:"String",_info:"Mode of transition",_select:ig.BGM_SWITCH_MODE},delayed:{_type:"Boolean",_info:"Resume default BGM later when changing map or after anything changes about the music"}}}),init:function(b){this.mode=b.mode||0;this.delayed=b.delayed||false},run:function(){this.delayed?ig.bgm.setResumeOnChange(this.mode):ig.bgm.resumeDefault(this.mode);return true}})});ig.baked=!0;
ig.module("impact.feature.bgm.plug-in").requires("impact.feature.bgm.bgm","impact.feature.bgm.bgm-steps").defines(function(){window.wm&&wm.mapAttribs&&(wm.mapAttribs.bgm={_type:"String",_select:ig.BGM_DEFAULT_TRACKS,_info:"Music set to be played on this map.",_withNull:true})});ig.baked=!0;
ig.module("impact.feature.event-sheet.event-sheet").requires("impact.base.event").defines(function(){ig.EventSheet=ig.JsonLoadable.extend({cacheType:"EventSheet",events:{},onCacheCleared:function(){for(var b in this.events)this.events[b].clearCached()},getJsonPath:function(){return ig.root+this.path.toPath("data/events/",".json")+ig.getCacheSuffix()},onload:function(b){for(var a in b.events){var d=b.events[a];this.events[a]=new ig.Event({name:a,input:d.input,steps:d.steps})}},getEvent:function(b){return this.events[b]||
null}})});ig.baked=!0;
ig.module("impact.feature.event-sheet.event-sheet-steps").requires("impact.base.action","impact.base.event").defines(function(){ig.EVENT_STEP.CALL_EVENT_FROM_SHEET=ig.EventStepBase.extend({eventSheet:null,eventName:null,eventInput:null,_wm:new ig.Config({attributes:{eventCall:{_type:"EventSheetCall",_info:"The event to be called",_popup:true}},width:600}),init:function(b){assertContent(b,"eventCall");b=b.eventCall;this.eventSheet=new ig.EventSheet(b.path);this.eventName=b.name;this.eventInput=b.input},
clearCached:function(){this.eventSheet.decreaseRef()},getInlineEvent:function(){return this.eventSheet.getEvent(this.eventName)},getInlineEventInput:function(){return this.eventInput}})});ig.baked=!0;ig.module("impact.feature.event-sheet.plug-in").requires("impact.feature.event-sheet.event-sheet","impact.feature.event-sheet.event-sheet-steps").defines(function(){window.wm&&wm.postLoadModules.push("impact.feature.event-sheet.editors.event-sheet-editor")});ig.baked=!0;
ig.module("impact.feature.camera.camera").requires("impact.base.event","impact.base.game").defines(function(){function b(a,b,c){if(a._zSlow||b){a._zSlow=true;b=c-a._currentZ;if(Math.abs(b)<=1){a._zSlow=false;a._currentZ=c}else a._currentZ=a._currentZ+b*ig.system.actualTick*7}else a._currentZ=c}var a=Vec2.create(),d=Vec2.create(),c=Vec2.create();ig.Camera=ig.GameAddon.extend({targets:[],namedTargets:{},_currentPos:Vec2.create(),_currentZ:0,_currentZoom:1,_currentZoomPos:Vec2.create(),_zSlow:false,
_lastPos:Vec2.create(),_lastZoom:1,_lastZoomPos:Vec2.create(),_duration:0,_time:0,_transitionFunction:null,_cameraInBounds:false,init:function(){this.parent("Camera")},postUpdateOrder:100,onPostUpdate:function(){if(!ig.loading&&!ig.game.paused){for(var b=this.targets.length;b--;)this.targets[b].update();this._time=this._time+ig.system.actualTick;var f;if(this._time<this._duration){f=this._time/this._duration;f=this._transitionFunction.get(f)}this._currentZoom=this._getNewZoom();if(this._time<this._duration)this._currentZoom=
this._lastZoom+(this._currentZoom-this._lastZoom)*f;ig.system.setZoom(this._currentZoom);b=this._getNewPos(a,d,c);if(this._time>=this._duration){Vec2.assign(this._currentPos,b);Vec2.assign(this._currentZoomPos,c)}else{Vec2.lerp(this._lastPos,b,f,this._currentPos);Vec2.lerp(this._lastPos,d,f,d);Vec2.lerp(this._lastZoomPos,c,f,this._currentZoomPos);this._cameraInBounds&&this._limitPos(this._currentPos,this._currentZoomPos,true)}ig.game.screen.x=this._currentPos.x-ig.system.width/2;ig.game.screen.y=
this._currentPos.y-ig.system.height/2;ig.game.soundPos.x=d.x;ig.game.soundPos.y=d.y;ig.system.setZoomFocus(this._currentZoomPos.x-ig.game.screen.x,this._currentZoomPos.y-ig.game.screen.y)}},levelLoadStartOrder:100,onLevelLoadStart:function(a){this._cameraInBounds=a.attributes&&a.attributes.cameraInBounds;for(var b in this.namedTargets)this.removeTarget(this.namedTargets[b],0);this.namedTargets={}},pushTarget:function(a,b,c,d){if(d){this.namedTargets[d]&&this.removeTarget(this.namedTargets[d],"IMMEDIATELY");
this.namedTargets[d]=a}this._saveLastPos();this.targets.push(a);a.target.start();this._duration=this._getDuration(b);this._transitionFunction=c||KEY_SPLINES.EASE_IN_OUT;this._time=0;this._duration||this._applyFinalState()},removeNamedTarget:function(a,b,c){var d=this.namedTargets[a];if(d){delete this.namedTargets[a];this.removeTarget(d,b,c)}},removeTarget:function(a,b,c){a=this.targets.indexOf(a);a!=-1&&(a==this.targets.length-1?this.popTarget(b,c):this.targets.splice(a,1))},popTarget:function(a,
b){this._saveLastPos();this.targets.pop();this._duration=this._getDuration(a);this._transitionFunction=b||KEY_SPLINES.EASE_IN_OUT;this._time=0;this._duration||this._applyFinalState()},replaceTarget:function(a,b,c,d){a=this.targets.indexOf(a);if(a==-1)return this.pushTarget(b,c,d);this.targets.splice(a,1,b);this.isActiveTarget(b)&&this.retarget(c,d)},getTargetCount:function(){return this.targets.length},isTargetReached:function(){return this._time>=this._duration},retarget:function(a,b){this._saveLastPos();
this._duration=this._getDuration(a);this._transitionFunction=b||KEY_SPLINES.EASE_IN_OUT;this._time=0},isActiveTarget:function(a){return this.targets[this.targets.length-1]==a},getTimeUntilTargetReached:function(){return this._time>=this._duration?0:this._duration-this._time},_limitPos:function(a,b,c){var d=ig.system.width,i=ig.system.height,j=a.x.limit(ig.system.width/2,ig.game.size.x-ig.system.width/2),k=a.y.limit(ig.system.height/2,ig.game.size.y-ig.system.height/2);if(c){var c=(b.x-(j-d/2))/d,
l=(b.y-(k-i/2))/i,d=d-d/ig.system.zoom,i=i-i/ig.system.zoom,o=0,m=0;if(j>a.x)var n=j-a.x-d*(0.5-c),o=-Math.min(d*c,n);else if(j<a.x){n=a.x-j-d*(c-0.5);o=Math.min(d*(1-c),n)}if(k>a.y){n=k-a.y-i*(0.5-l);m=-Math.min(i*l,n)}else if(k<a.y){n=a.y-k-i*(l-0.5);m=Math.min(i*(1-l),n)}a.y=k+m;a.x=j+o;b.x=b.x+o;b.y=b.y+m}else{a.x=j;a.y=k}},_applyFinalState:function(){this._currentZoom=this._getNewZoom();ig.system.setZoom(this._currentZoom);var b=this._getNewPos(a,null,c);Vec2.assign(this._currentPos,b);Vec2.assign(this._currentZoomPos,
c)},_saveLastPos:function(){this._lastZoom=this._currentZoom;Vec2.assign(this._lastPos,this._currentPos);Vec2.assign(this._lastZoomPos,this._currentZoomPos);this._resetLastZoomPos=true},_getNewZoom:function(){return this.targets.length>0?this.targets[this.targets.length-1].getZoom():1},_getNewPos:function(a,b,c){var d=false;if(this.targets.length>0){d=this.targets[this.targets.length-1];d.target.getPos(a);if(c){c.x=a.x+Math.round(d._currentZoomOffset.x);c.y=a.y+Math.round(d._currentZoomOffset.y)}a.x=
a.x+Math.round(d._currentOffset.x);a.y=a.y+Math.round(d._currentOffset.y);d=d.keepZoomFocusAligned||false}if(b){b.x=a.x;b.y=a.y}if(this._cameraInBounds){b=d?1:ig.system.zoom;a.x=a.x.limit(ig.system.width/2/b,ig.game.size.x-ig.system.width/2/b);a.y=a.y.limit(ig.system.height/2/b,ig.game.size.y-ig.system.height/2/b)}!d&&c&&Vec2.assign(c,a);return a},_getDuration:function(b){if(typeof b=="string"){var f=Vec2.length(Vec2.sub(this._getNewPos(a,d,c),this._lastPos))+32,f=Math.sqrt(f);if(ig.Camera.SPEED_OPTIONS[b])f=
f*ig.Camera.SPEED_OPTIONS[b];else throw Error("Unknown Camera Speed Type: "+b);return f}return b||0}});ig.addGameAddon(function(){return ig.camera=new ig.Camera});ig.Camera.SPEED_OPTIONS={NORMAL:0.1,FAST:0.05,FASTER:0.0375,FASTEST:0.025,FASTESTEST:0.0175,SLOW:0.15,SLOWER:0.2,SLOWEST:0.3,SLOWESTEST:0.5,SLOWEST_DREAM:1,IMMEDIATELY:1E-6};ig.Camera.PosTarget=ig.Class.extend({pos:null,init:function(a){this.pos=a},start:function(){},getPos:function(a){Vec2.assign(a,this.pos)}});ig.Camera.EntityTarget=ig.Class.extend({entity:null,
_zSlow:false,_currentZ:0,_lockZ:false,init:function(a,b){this.entity=a;this._lockZ=b||false},start:function(){this._currentZ=this.entity.coll.pos.z},getPos:function(a){this._lockZ||b(this,this.entity&&(this.entity.jumping||this.entity.coll._collData&&this.entity.coll._collData.zPush),this.entity.coll.pos.z+(this.entity.cameraZFocus||0));a.x=Math.round(this.entity.coll.pos.x)+this.entity.coll.size.x/2;a.y=Math.round(this.entity.coll.pos.y-this._currentZ)+this.entity.coll.size.y/2-Constants.BALL_HEIGHT}});
ig.Camera.MultiEntityTarget=ig.Class.extend({entities:null,_zSlow:false,_prevFloat:false,_currentZ:0,keepFirstTarget:false,init:function(a,b){this.entities=a;this.keepFirstTarget=b||false},start:function(){this._currentZ=this._getEntitiesZ()},_getEntitiesZ:function(){return this.entities[0].coll.pos.z+(this.entities[0].cameraZFocus||0)},getPos:function(a){for(var c=this.entities,d=c.length,h=false,i=0,j=0,k=this._getEntitiesZ(),l=0;d--;){var o=c[d],m=o.coll,h=h||o&&(o.jumping||o.coll._collData&&o.coll._collData.zPush),
i=i+(m.pos.x+m.size.x/2),j=j+(m.pos.y+m.size.y/2);if(m.float.height){h=true;l=l+(m.pos.z-k);this._prevFloat=true}}if(!h&&this._prevFloat){h=true;this._prevFloat=false}l=l/c.length;i=i/c.length;j=j/c.length;b(this,h,k+l);if(this.keepFirstTarget){d=c[0].coll;c=d.pos.x+d.size.x/2;d=d.pos.y+d.size.y/2;i<c-200?i=c-200:i>c+200&&(i=c+200);j<d-100?j=d-100:j>d+100&&(j=d+100)}j=j-this._currentZ;a.x=Math.round(i);a.y=Math.round(j)-Constants.BALL_HEIGHT}});ig.Camera.TargetHandle=ig.Class.extend({target:null,
offset:null,zoomOffset:null,keepZoomFocusAligned:false,_offsetDuration:0,_offsetTime:0,_currentOffset:Vec2.create(),_currentZoomOffset:Vec2.create(),_lastOffset:Vec2.create(),_lastZoomOffset:Vec2.create(),zoomTimer:null,oldZoom:1,targetZoom:1,keyspline:null,lockZ:false,init:function(a,b,c){this.target=a;this.offset=Vec2.createC(b,c);this.zoomOffset=Vec2.createC(b,c);this.zoomTimer=new ig.WeightTimer(true);Vec2.assign(this._currentOffset,this.offset);Vec2.assign(this._lastOffset,this.offset);Vec2.assign(this._currentZoomOffset,
this.zoomOffset);Vec2.assign(this._lastZoomOffset,this.zoomOffset)},setOffset:function(a,b,c,d,i,j){this.offset.x=a;this.offset.y=b;this.zoomOffset.x=d===void 0?a:d;this.zoomOffset.y=i===void 0?b:i;this._offsetDuration=c||0;this._offsetTime=0;if(this._offsetDuration){Vec2.assign(this._lastOffset,this._currentOffset);Vec2.assign(this._lastZoomOffset,this._currentZoomOffset)}if(j){Vec2.assign(this._currentOffset,this.offset);Vec2.assign(this._currentZoomOffset,this.zoomOffset)}},setZoomFocus:function(){},
setZoom:function(a,b,c){this.oldZoom=this.getZoom();this.targetZoom=a;this.keyspline=c||null;this.zoomTimer.set(b,ig.TIMER_MODE.ONCE)},update:function(){this.zoomTimer.tick();this._offsetTime=this._offsetTime+ig.system.actualTick;if(ig.game.firstUpdateLoop)if(this._offsetTime>=this._offsetDuration){Vec2.mulF(this._currentOffset,23);Vec2.add(this._currentOffset,this.offset);Vec2.mulF(this._currentOffset,1/24);Vec2.mulF(this._currentZoomOffset,23);Vec2.add(this._currentZoomOffset,this.zoomOffset);Vec2.mulF(this._currentZoomOffset,
1/24)}else{var a=Math.min(1,this._offsetTime/this._offsetDuration),a=KEY_SPLINES.EASE_IN_OUT.get(a);Vec2.lerp(this._lastOffset,this.offset,a,this._currentOffset);Vec2.lerp(this._lastZoomOffset,this.zoomOffset,a,this._currentZoomOffset)}},getZoom:function(){var a=this.zoomTimer.get();this.keyspline&&a<1&&(a=this.keyspline.get(a));return this.oldZoom+(this.targetZoom-this.oldZoom)*a},onEventEndDetach:function(){ig.camera.removeTarget(this,"FAST")},onActionEndDetach:function(){ig.camera.removeTarget(this,
"FAST")}})});ig.baked=!0;
ig.module("impact.feature.camera.camera-steps").requires("impact.base.action","impact.base.event","impact.feature.camera.camera").defines(function(){ig.EVENT_STEP.SET_CAMERA_TARGET=ig.EventStepBase.extend({entity:null,offsetX:0,offsetY:0,speed:0,transition:KEY_SPLINES.EASE_IN_OUT,wait:false,waitSkip:0,zoom:1,lockZ:false,_wm:new ig.Config({attributes:{entity:{_type:"Entity",_info:"Entity to focus camera on"},offsetX:{_type:"Number",_info:"x offset to target entity"},offsetY:{_type:"Number",_info:"y offset to target entity"},
speed:{_type:"String",_select:ig.Camera.SPEED_OPTIONS,_info:"Speed of camera movement"},transition:{_type:"String",_select:KEY_SPLINES,_info:"Transition type"},wait:{_type:"Boolean",_info:"Wait until camera movement is done"},waitSkip:{_type:"Number",_info:"The amount of seconds to skip waiting before target is reached."},zoom:{_type:"Number",_info:"Zoom Value. 1=default, 2=twice pixel size",_default:1},name:{_type:"String",_info:"If set, camera target will remain even after event is done and can only be removed explictly via its name.",
_optional:true},lockZ:{_type:"Boolean",_info:"if true, do not move change cam if entity moves along Z axis.",_optional:true}}}),init:function(a){assertContent(a,"entity");this.lockZ=a.lockZ||false;this.entity=a.entity;this.offsetX=a.offsetX||0;this.offsetY=a.offsetY||0;this.speed=a.speed||0;this.wait=a.wait||false;this.waitSkip=a.waitSkip||0;this.transition=typeof a.transition=="string"?KEY_SPLINES[a.transition]:a.transition;this.zoom=a.zoom||1;this.name=a.name||null},start:function(a,b){var e=ig.Event.getEntity(this.entity,
b),e=new ig.Camera.TargetHandle(new ig.Camera.EntityTarget(e,this.lockZ),this.offsetX,this.offsetY);e.setZoom(this.zoom);ig.camera.pushTarget(e,this.speed,this.transition,this.name);this.name||b.addEventAttached(e)},run:function(){return this.wait?ig.camera.getTimeUntilTargetReached()<=this.waitSkip:true}});ig.EVENT_STEP.SET_CAMERA_POS=ig.EventStepBase.extend({pos:null,speed:0,transition:KEY_SPLINES.EASE_IN_OUT,wait:false,waitSkip:0,zoom:1,_wm:new ig.Config({attributes:{pos:{_type:"Vec2",_info:"Position to focus camera on",
_visualize:true,_pointSelect:true},speed:{_type:"String",_select:ig.Camera.SPEED_OPTIONS,_info:"Speed of camera movement"},transition:{_type:"String",_select:KEY_SPLINES,_info:"Transition type"},wait:{_type:"Boolean",_info:"Wait until camera movement is done"},waitSkip:{_type:"Number",_info:"The amount of seconds to skip waiting before target is reached."},zoom:{_type:"Number",_info:"Zoom Value. 1=default, 2=twice pixel size",_default:1},name:{_type:"String",_info:"If set, camera target will remain even after event is done and can only be removed explictly via its name.",
_optional:true}}}),init:function(a){assertContent(a,"pos");this.pos=a.pos;this.speed=a.speed||0;this.wait=a.wait||false;this.waitSkip=a.waitSkip||0;this.transition=typeof a.transition=="string"?KEY_SPLINES[a.transition]:a.transition;this.zoom=a.zoom||1;this.name=a.name||null},start:function(a,b){var e=new ig.Camera.TargetHandle(new ig.Camera.PosTarget(ig.Event.getVec2(this.pos,Vec2.create())),0,0);e.setZoom(this.zoom);ig.camera.pushTarget(e,this.speed,this.transition,this.name);this.name||b.addEventAttached(e)},
run:function(){return this.wait?ig.camera.getTimeUntilTargetReached()<=this.waitSkip:true}});Vec3.create();ig.EVENT_STEP.SET_CAMERA_BETWEEN=ig.EventStepBase.extend({entity1:null,entity2:null,speed:0,transition:KEY_SPLINES.EASE_IN_OUT,wait:false,waitSkip:0,zoom:1,_wm:new ig.Config({attributes:{entity1:{_type:"Entity",_info:"First entity"},entity2:{_type:"Entity",_info:"Second entity"},speed:{_type:"String",_select:ig.Camera.SPEED_OPTIONS,_info:"Speed of camera movement"},transition:{_type:"String",
_select:KEY_SPLINES,_info:"Transition type"},wait:{_type:"Boolean",_info:"Wait until camera movement is done"},waitSkip:{_type:"Number",_info:"The amount of seconds to skip waiting before target is reached."},zoom:{_type:"Number",_info:"Zoom Value. 1=default, 2=twice pixel size",_default:1},name:{_type:"String",_info:"If set, camera target will remain even after event is done and can only be removed explictly via its name.",_optional:true}}}),init:function(a){this.entity1=a.entity1;this.entity2=a.entity2;
this.speed=a.speed||0;this.wait=a.wait||false;this.waitSkip=a.waitSkip||0;this.transition=typeof a.transition=="string"?KEY_SPLINES[a.transition]:a.transition;this.zoom=a.zoom||1;this.name=a.name||null},start:function(a,b){var e=ig.Event.getEntity(this.entity1,b),f=ig.Event.getEntity(this.entity2,b),e=new ig.Camera.TargetHandle(new ig.Camera.MultiEntityTarget([e,f]),0,0);e.setZoom(this.zoom);ig.camera.pushTarget(e,this.speed,this.transition,this.name);this.name||b.addEventAttached(e)},run:function(){return this.wait?
ig.camera.getTimeUntilTargetReached()<=this.waitSkip:true}});ig.EVENT_STEP.RESET_CAMERA=ig.EventStepBase.extend({speed:0,transition:KEY_SPLINES.EASE_IN_OUT,wait:false,waitSkip:0,name:null,_wm:new ig.Config({attributes:{speed:{_type:"String",_select:ig.Camera.SPEED_OPTIONS,_info:"Speed of camera movement"},transition:{_type:"String",_select:KEY_SPLINES,_info:"Transition type"},wait:{_type:"Boolean",_info:"Wait until camera movement is done"},waitSkip:{_type:"Number",_info:"The amount of seconds to skip waiting before target is reached."},
name:{_type:"String",_info:"If defined: only remove camera target of given name",_optional:true}}}),init:function(a){this.speed=a.speed||0;this.transition=typeof a.transition=="string"?KEY_SPLINES[a.transition]:a.transition;this.wait=a.wait||false;this.waitSkip=a.waitSkip||0;this.name=a.name||null},start:function(a,b){if(this.name)ig.camera.removeNamedTarget(this.name,this.speed,this.transition);else for(var e=b.eventAttached,f=e.length;f--;)if(e[f]instanceof ig.Camera.TargetHandle){ig.camera.removeTarget(e[f],
this.speed,this.transition);e.splice(f,1)}},run:function(){return this.wait?ig.camera.getTimeUntilTargetReached()<=this.waitSkip:true}});ig.EVENT_STEP.UNDO_CAMERA=ig.EventStepBase.extend({speed:0,transition:KEY_SPLINES.EASE_IN_OUT,wait:false,waitSkip:0,_wm:new ig.Config({attributes:{speed:{_type:"String",_select:ig.Camera.SPEED_OPTIONS,_info:"Speed of camera movement"},transition:{_type:"String",_select:KEY_SPLINES,_info:"Transition type"},wait:{_type:"Boolean",_info:"Wait until camera movement is done"},
waitSkip:{_type:"Number",_info:"The amount of seconds to skip waiting before target is reached."}}}),init:function(a){this.speed=a.speed||0;this.transition=typeof a.transition=="string"?KEY_SPLINES[a.transition]:a.transition;this.wait=a.wait||false;this.waitSkip=a.waitSkip||0},start:function(a,b){for(var e=b.eventAttached,f=e.length;f--;)if(e[f]instanceof ig.Camera.TargetHandle){ig.camera.removeTarget(e[f],this.speed,this.transition);e.splice(f,1);break}},run:function(){return this.wait?ig.camera.getTimeUntilTargetReached()<=
this.waitSkip:true}});ig.EVENT_STEP.SET_CAMERA_ZOOM=ig.EventStepBase.extend({duration:0,transition:KEY_SPLINES.EASE_IN_OUT,wait:false,waitSkip:0,_wm:new ig.Config({attributes:{zoom:{_type:"Number",_info:"Zoom Value. 1=default, 2=twice pixel size",_default:1},duration:{_type:"Number",_info:"Duration of zoom transition"},transition:{_type:"String",_select:KEY_SPLINES,_info:"Transition type"}}}),init:function(a){this.zoom=a.zoom||1;this.duration=a.duration||0;this.transition=typeof a.transition=="string"?
KEY_SPLINES[a.transition]:a.transition},start:function(a,b){for(var e=b.eventAttached,f=e.length;f--;)if(e[f]instanceof ig.Camera.TargetHandle){e[f].setZoom(this.zoom,this.duration,this.transition);break}},run:function(){return true}});var b={SELF:function(a){return a},TARGET:function(a){return a.getTarget(true)}},a={SELF:0,BETWEEN_TARGET:1,KEEP_TARGET_IN_SCREEN:2};ig.ACTION_STEP.FOCUS_CAMERA=ig.EventStepBase.extend({offsetX:0,offsetY:0,speed:0,transition:KEY_SPLINES.EASE_IN_OUT,wait:false,waitSkip:0,
zoom:1,_wm:new ig.Config({attributes:{offsetX:{_type:"Number",_info:"x offset to target entity"},offsetY:{_type:"Number",_info:"y offset to target entity"},speed:{_type:"String",_select:ig.Camera.SPEED_OPTIONS,_info:"Speed of camera movement"},transition:{_type:"String",_select:KEY_SPLINES,_info:"Transition type"},wait:{_type:"Boolean",_info:"Wait until camera movement is done"},waitSkip:{_type:"Number",_info:"The amount of seconds to skip waiting before target is reached."},zoom:{_type:"Number",
_info:"Zoom Value. 1=default, 2=twice pixel size",_default:1},target:{_type:"String",_info:"Which target to focus with the camera",_select:b,_optional:true},focusType:{_type:"String",_info:"How camera is focused exactly",_select:a},keepPlayerOffset:{_type:"Number",_info:"If defined: Keep offset of Player Camera multiplied with given weight. ",_optional:true}}}),init:function(d){this.offsetX=d.offsetX||0;this.offsetY=d.offsetY||0;this.speed=d.speed||0;this.wait=d.wait||false;this.waitSkip=d.waitSkip||
0;this.transition=typeof d.transition=="string"?KEY_SPLINES[d.transition]:d.transition;this.zoom=d.zoom||1;this.target=b[d.target]||b.SELF;this.focusType=a[d.focusType]||a.SELF;this.keepPlayerOffset=d.keepPlayerOffset||0},start:function(b){var c;if(this.focusType&&b.getTarget(true)){c=b.getTarget(true);if(b.party==sc.COMBATANT_PARTY.ENEMY&&c instanceof sc.PartyMemberEntity)c=ig.game.playerEntity;c=this.focusType==a.BETWEEN_TARGET?new ig.Camera.MultiEntityTarget([b,c]):new ig.Camera.MultiEntityTarget([c,
b],true);c=new ig.Camera.TargetHandle(c,this.offsetX,this.offsetY)}else{c=this.target(b)||b;c=new ig.Camera.TargetHandle(new ig.Camera.EntityTarget(c),this.offsetX,this.offsetY)}c.setZoom(this.zoom);if(this.keepPlayerOffset&&b.isPlayer){var e=b.cameraHandle;c.setOffset(e.offset.x*this.keepPlayerOffset,e.offset.y*this.keepPlayerOffset,0,e.zoomOffset.x*this.keepPlayerOffset,e.zoomOffset.y*this.keepPlayerOffset,true);c.keepZoomFocusAligned=true}ig.camera.pushTarget(c,this.speed,this.transition);b.addActionAttached(c)},
run:function(){return this.wait?ig.camera.getTimeUntilTargetReached()<=this.waitSkip:true}});ig.ACTION_STEP.RESET_CAMERA=ig.EventStepBase.extend({speed:0,transition:KEY_SPLINES.EASE_IN_OUT,wait:false,waitSkip:0,_wm:new ig.Config({attributes:{speed:{_type:"String",_select:ig.Camera.SPEED_OPTIONS,_info:"Speed of camera movement"},transition:{_type:"String",_select:KEY_SPLINES,_info:"Transition type"},wait:{_type:"Boolean",_info:"Wait until camera movement is done"},waitSkip:{_type:"Number",_info:"The amount of seconds to skip waiting before target is reached."}}}),
init:function(a){this.speed=a.speed||0;this.wait=a.wait||false;this.waitSkip=a.waitSkip||0;this.transition=typeof a.transition=="string"?KEY_SPLINES[a.transition]:a.transition},start:function(a){for(var a=a.actionAttached,b=a.length;b--;)if(a[b]instanceof ig.Camera.TargetHandle){ig.camera.removeTarget(a[b],this.speed,this.transition);a.splice(b,1)}},run:function(){return this.wait?ig.camera.getTimeUntilTargetReached()<=this.waitSkip:true}});ig.ACTION_STEP.SET_CAMERA_ZOOM=ig.EventStepBase.extend({duration:0,
transition:KEY_SPLINES.EASE_IN_OUT,wait:false,waitSkip:0,_wm:new ig.Config({attributes:{zoom:{_type:"Number",_info:"Zoom Value. 1=default, 2=twice pixel size",_default:1},duration:{_type:"Number",_info:"Duration of zoom transition"},transition:{_type:"String",_select:KEY_SPLINES,_info:"Transition type"}}}),init:function(a){this.zoom=a.zoom||1;this.duration=a.duration||0;this.transition=typeof a.transition=="string"?KEY_SPLINES[a.transition]:a.transition},start:function(a){for(var a=a.actionAttached,
b=a.length;b--;)if(a[b]instanceof ig.Camera.TargetHandle){a[b].setZoom(this.zoom,this.duration,this.transition);break}},run:function(){return true}})});ig.baked=!0;ig.module("impact.feature.camera.plug-in").requires("impact.feature.camera.camera","impact.feature.camera.camera-steps").defines(function(){if(window.wm){wm.addStepColorRule(/CAMERA/,"yellow");wm.mapAttribs&&(wm.mapAttribs.cameraInBounds={_type:"Boolean",_info:"Set true to not move camera outside of map bounds"})}});ig.baked=!0;
ig.module("impact.feature.rumble.rumble").requires("impact.base.event","impact.base.game").defines(function(){ig.Rumble=ig.GameAddon.extend({rumbles:[],namedRumbles:{},offset:Vec2.createC(0,0),init:function(){this.parent("Rumble")},postUpdateOrder:110,onPostUpdate:function(){if(!ig.game.paused){var b=null;this.offset.x=0;for(var a=this.offset.y=0,d=this.rumbles.length;d--;)if(b=this.rumbles[d]){b.update();if(b.isDone()){b.name&&delete this.namedRumbles[b.name];this.rumbles.splice(d,1)}else{this.offset.x=
this.offset.x+b.offset.x;this.offset.y=this.offset.y+b.offset.y;a=Math.max(a,b.power)}}Vec2.length(this.offset,Math.min(Vec2.length(this.offset),a));ig.game.screen.x=ig.game.screen.x+this.offset.x;ig.game.screen.y=ig.game.screen.y+this.offset.y}},onReset:function(){this.rumbles.length=0;this.namedRumbles={}},addRumble:function(b){if(this.rumbles.indexOf(b)==-1){b.name&&(this.namedRumbles[b.name]=b);this.rumbles.push(b)}},removeRumble:function(b){b.name&&delete this.namedRumbles[b.name];this.rumbles.erase(b)},
getRumble:function(b){return this.namedRumbles[b]}});ig.addGameAddon(function(){return ig.rumble=new ig.Rumble});ig.RUMBLE_TYPE={RANDOM:0,HORIZONTAL:1,VERTICAL:2};ig.Rumble.RumbleHandle=ig.Class.extend({type:0,name:null,power:0,shakeDuration:0,time:0,fade:false,offset:null,_target:null,_start:null,_temp:null,_timer:0,_duration:0,_shakeTimer:0,ignoreSlowDown:false,init:function(b,a,d,c,e,f){this.type=ig.RUMBLE_TYPE[b]||ig.RUMBLE_TYPE.RANDOM;this.name=f||null;this.offset=Vec2.createC(0,0);this._start=
Vec2.createC(0,0);this._target=Vec2.createC(0,0);this._temp=Vec2.createC(0,0);this.set(a,d,c,e)},onEntityKillDetach:function(){this._duration==-1&&this.stop()},update:function(){if(this._timer<=this._duration||this._duration==-1){var b=0,b=this.fade&&this._duration!=-1?this.power*((this._duration-this._timer)/this._duration):this.power;this._updatePosition(b);this._timer=this._timer+ig.system.actualTick}else this.stop()},_updatePosition:function(b){this._shakeTimer=this._shakeTimer+ig.system.actualTick;
var a=Math.min(1,this._shakeTimer/this.shakeDuration),a=KEY_SPLINES.EASE_IN_OUT.get(a);this.offset.x=this._lerp(this._target.x,this._start.x,a);this.offset.y=this._lerp(this._target.y,this._start.y,a);if(this._shakeTimer>=this.shakeDuration){this._shakeTimer=0;Vec2.assign(this._start,this._target);this.type==ig.RUMBLE_TYPE.RANDOM?Vec2.rotate(this._target,Math.PI/2+Math.random()*Math.PI):Vec2.flip(this._target);Vec2.length(this._target,b)}},_lerp:function(b,a,d){return b*d+(1-d)*a},stop:function(){this.time=
this._duration;this.offset.x=0;this.offset.y=0},isDone:function(){return this.time==this._duration},set:function(b,a,d,c){this.shakeDuration=ig.Rumble.SHAKE_DURATION[a];var b=ig.Rumble.SHAKE_POWER[b],e=this.shakeDuration,a=1;e>=ig.Rumble.SHAKE_DURATION.SLOW?a=0:e==ig.Rumble.SHAKE_DURATION.NORMAL&&(a=0.5);e=1;switch(sc.options.get("rumble-strength")){case sc.RUMBLE_STRENGTH.STRONG:e=1;break;case sc.RUMBLE_STRENGTH.NORMAL:e=0.75;break;case sc.RUMBLE_STRENGTH.WEAK:e=0.5;break;case sc.RUMBLE_STRENGTH.OFF:e=
0}this.power=b*(1-(1-e)*a);this._duration=d;this.fade=c;this._timer=0;this.offset.x=0;this.offset.y=0;Vec2.assign(this._start,this.offset);this._target.x=this._target.y=0;this.type==ig.RUMBLE_TYPE.HORIZONTAL?this._target.x=this.power:this._target.y=this.power;this._shakeTimer=0}});ig.Rumble.SHAKE_POWER={WEAKESTEST:0.5,WEAKEST:1,WEAKER:2,WEAK:3,MEDIUM:4,STRONG:5,STRONGER:7,STRONGEST:10,MEGA:15};ig.Rumble.SHAKE_DURATION={SLOWEST:2,SLOWER:1,SLOW:0.5,NORMAL:0.2,FAST:0.075,FASTER:0.04,FASTEST:0.02}});
ig.baked=!0;
ig.module("impact.base.entity-pool").requires("impact.base.game").defines(function(){ig.EntityPool={pools:{},mixin:{staticInstantiate:function(b,a,d,c){return ig.EntityPool.getFromPool(this.constructor.classId,b,a,d,c)},erase:function(){ig.EntityPool.putInPool(this)}},enableFor:function(b){b.inject(this.mixin)},getFromPool:function(b,a,d,c,e){b=this.pools[b];if(!b||!b.length)return null;b=b.pop();b.reset(a,d,c,e);return b},putInPool:function(b){this.pools[b.classId]?this.pools[b.classId].push(b):this.pools[b.classId]=
[b]},drainPool:function(b){delete this.pools[b]},drainAllPools:function(){this.pools={}}};ig.Game.inject({loadLevel:function(b,a,d){ig.EntityPool.drainAllPools();this.parent(b,a,d)}})});ig.baked=!0;
ig.module("impact.feature.effect.entities.effect").requires("impact.base.entity","impact.base.entity-pool").defines(function(){var b=Vec3.create(),a=Vec2.create();ig.EFFECT_STATE={RUNNING:0,POST_LOOP:1,ENDED:2};ig.ENTITY.Effect=ig.Entity.extend({offset:{x:0,y:0,z:0},rotOffset:null,angle:0,flipX:false,duration:0,state:ig.EFFECT_STATE.RUNNING,effect:null,target:null,spriteFilter:null,timelineIndex:0,timer:0,looped:false,particles:[],runners:[],align:ig.ENTITY_ALIGN.BOTTOM,target2:{point:null,entity:null,
align:null,offset:Vec3.create()},attachGroup:null,callback:null,rotateFace:0,flipLeftFace:false,init:function(a,b,e,f){this.parent(a,b,e,f);this._initEffect(f)},reset:function(a,b,e,f){this.parent(a,b,e,f);this._initEffect(f)},_initEffect:function(b){this.coll.type=ig.COLLTYPE.NONE;this.coll.setSize(0,0,0);this.state=ig.EFFECT_STATE.RUNNING;this.effect=b.effect;this.target=b.target||null;this.target2.point=b.target2Point||null;this.target2.entity=b.target2||null;this.target2.align=b.target2Align||
null;this.noMultiGroup=b.noMultiGroup||false;b.target2Offset?Vec3.assign(this.target2.offset,b.target2Offset):Vec3.assignC(this.target2.offset,0,0,0);this.spriteFilter=b.spriteFilter===void 0?null:b.spriteFilter;this.angle=b.angle||0;this.flipX=b.flipX||false;this.duration=b.duration||this.effect.loopEndTime;b.offset?Vec3.assign(this.offset,b.offset):Vec3.assignC(this.offset,0,0,0);Vec3.add(this.coll.pos,this.offset);if(this.rotOffset=b.rotOffset||null){var c=Vec2.rotate(this.rotOffset,-this.angle,
a);Vec2.add(this.coll.pos,c)}this.rotateFace=b.rotateFace;this.flipLeftFace=b.flipLeftFace;this.attachGroup=b.group||null;this.align=(typeof b.align=="string"?ig.ENTITY_ALIGN[b.align]:b.align)||0;this.timer=this.timelineIndex=0;this.looped=false;this.particles.length=0;this.runners.length=0;this.callback=b.callback;this.coll.time.parent=null;this.coll.time.parentAnimToGlobal=false;if(this.target){this.target.addEntityAttached(this);this.target.coll.parentColl&&this.target.coll.parentColl.entity.addEntityAttached(this);
this.coll.time.parent=this.target.coll;this.coll.time.parentAnimToGlobal=true}if(this.target2&&this.target2.entity&&this.target2.entity!=this.target){this.target2.entity.addEntityAttached(this);this.target2.entity.coll.parentColl&&this.target2.entity.coll.parentColl.entity.addEntityAttached(this)}this.actionTarget=null},attachToAction:function(a){this.actionTarget=a;a.addActionAttached(this);this.actionTarget!=this.target&&this.actionTarget!=this.target2&&a.addEntityAttached(this)},setTimeEntity:function(a){this.coll.time.parent=
a&&a.coll||null},setIgnoreSlowdown:function(){this.coll.time.parent=null;this.coll.time.globalStatic=true},getTarget2Pos:function(a){this.target2.point?Vec3.assign(a,this.target2.point):this.target2.entity&&this.target2.entity.getAlignedPos(this.target2.align,a);this.target2.offset&&Vec3.add(a,this.target2.offset);return a},stop:function(){this.duration=0},isDone:function(){return this.state==ig.EFFECT_STATE.ENDED},getRemainingTime:function(){return this.effect.getRemainingTime(this)},setCallback:function(a){this.callback=
a},onActionEndDetach:function(){this.stop()},onEntityKillDetach:function(){this.stop()},spawnParticle:function(a,b,e,f){if(this._killed)throw Error("Spawned Particle after effects has been killed!");var g=f&&this.target?this.target.coll:this.coll,f=g.pos.x+(b&&b.x||0),h=g.pos.y+(b&&b.y||0),b=g.pos.z+(b&&b.z||0);e.ownerEffect=this;a=ig.game.spawnEntity(a,f,h,b,e);a.coll.time.parent=this.coll;if(a.face&&this.target.face){Vec2.assign(a.face,this.target.face);a.updateAnim()}if(!a.handle)throw Error("Particle has no handle!");
this.particles.push(a.handle)},update:function(){},deferredUpdate:function(){var d=this.coll;if(this.target&&this.target.face&&this.rotateFace){var c;c=this.rotateFace>0?ig.getRoundedFaceDir(this.target.face.x,this.target.face.y,this.rotateFace,a):this.target.face;this.angle=Vec2.clockangle(c);if(this.flipLeftFace&&this.angle>Math.PI)this.flipX=true}var e=c=0,f=0;if(this.target&&this.align){f=this.target.getAlignedPos(this.align,b);Vec3.add(f,this.offset);if(this.rotOffset){c=Vec2.rotate(this.rotOffset,
-this.angle,a);Vec2.add(f,c)}c=f.x-d.pos.x;e=f.y-d.pos.y;f=f.z-d.pos.z;d.pos.x=d.pos.x+c;d.pos.y=d.pos.y+e;d.pos.z=d.pos.z+f}for(var g=this.effect.isEnding(this),h=this.particles.length;h--;){var i=this.particles[h],j=i.entity.coll,k=i.moveWithTarget&&(i.maxTime<0||i.moveWithTarget>=i.timer/i.maxTime);if(g&&(i.maxTime<0||k&&i.cancelable)){i.cancelable=false;i.cancel()}if(i.maxTime>=0&&i.timer>=i.maxTime){i.entity.kill();this.particles.splice(h,1)}else if(this.target){if(k&&!i.entity.autoTargetStuck){j.pos.x=
j.pos.x+c;j.pos.y=j.pos.y+e;j.pos.z=j.pos.z+f}else if(d.time.parent&&d.time.parent.time.factor<1)j.time.parent=null;this.target.face&&i.syncFace&&Vec2.assign(i.entity.face,this.target.face)}}this.effect.update(this);this.effect.isDone(this)&&(this.particles.length==0&&this.runners.length==0)&&this.kill()},updateRunners:function(){for(var a=this.runners.length;a--;)this.runners[a].update(this)&&this.runners.splice(a,1)},cancelRunners:function(a){for(var b=this.runners.length;b--;)this.runners[b].cancel(this,
a)&&this.runners.splice(b,1)},onKill:function(a){if(this.target){this.target.removeEntityAttached(this);this.target.removeActionAttached&&this.target.removeActionAttached(this);if(this.target.coll.parentColl){var b=this.target.coll.parentColl.entity;b.removeEntityAttached(this);b.removeActionAttached&&b.removeActionAttached(this)}}if(this.target2.entity&&this.target2.entity!=this.target){this.target2.entity.removeEntityAttached(this);if(this.target2.entity.coll.parentColl){b=this.target2.entity.coll.parentColl.entity;
b.removeEntityAttached(this)}}if(this.actionTarget){this.actionTarget.removeActionAttached(this);this.actionTarget!=this.target&&this.actionTarget!=this.target2&&this.actionTarget.removeEntityAttached(this)}this.parent(a)}});ig.EntityPool.enableFor(ig.ENTITY.Effect);ig.EffectTools={};ig.EffectTools.clearEffects=function(a,b){a.clearEntityAttached(function(a){return a instanceof ig.ENTITY.Effect&&(!b||b==a.attachGroup)})};ig.EffectTools.getFirstEffect=function(a,b){for(var e=a.entityAttached,f=e.length;f--;){var g=
e[f];if(g instanceof ig.ENTITY.Effect&&b==g.attachGroup)return g}return null}});ig.baked=!0;
ig.module("impact.feature.effect.entities.effect-particle").requires("impact.base.entity","impact.base.entity-pool").defines(function(){ig.ParticleHandle=ig.Class.extend({entity:null,syncFace:false,timer:0,maxTime:0,postAnimTime:0,pData:null,particleState:null,startAngle:0,angleSync:null,flipX:0,moveWithTarget:0,cancelable:false,init:function(a,b){this.entity=a;this.syncFace=b},cancel:function(){if(this.maxTime<0){this.maxTime=100;this.timer=this.maxTime-this.particleState.getMaxEndTime(this.postAnimTime)}else this.timer=
Math.max(this.timer,this.maxTime-this.particleState.getMaxEndTime(this.postAnimTime))},setData:function(a){var b=a.data;this.pData=b;this.particleState=b.state;this.maxTime=b.particleDuration;if(this.maxTime==-2)this.maxTime=a.ownerEffect.duration;if(!this.maxTime)this.maxTime=b.anim&&b.anim.getDuration()||0;if(b.particleDurVariance)this.maxTime=this.maxTime+(Math.random()*2-1)*b.particleDurVariance;this.postAnimTime=b.postAnim&&b.postAnim.getDuration()||0;this.timer=0;this.moveWithTarget=b.moveWithTarget;
this.cancelable=b.cancelable;this.flipX=a.flipX||false;this.startAngle=a.angle||0;if(b.angleVary)this.startAngle=this.startAngle+(Math.random()-0.5)*b.angleVary*Math.PI*2;if(b.randFlip&&Math.random()<0.5)this.flipX=!this.flipX;this.angleSync=a.angleSync||null;if(b.light){var a=-1,c=0.05;if(this.maxTime>0)c=a=this.maxTime/2;this.lightHandle=new ig.LightHandle(this.entity,b.light,0,c,a,1,false);ig.light.addLightHandle(this.lightHandle)}},onUpdate:function(){if(this.angleSync)this.startAngle=this.angleSync.angle;
this.timer=this.timer+ig.system.tick;this.postAnimTime&&(this.maxTime>0&&this.maxTime-this.timer<this.postAnimTime)&&this.entity.setCurrentAnim("post",true)},initSprite:function(a){this.particleState.initSprite(a,this.startAngle,this.flipX)},updateSprite:function(a){this.particleState.updateSprite(a,this.timer,this.maxTime,this.postAnimTime,this.startAngle,this.flipX,this.angleSync)},initAnimState:function(a){this.particleState.initAnimState(a,this.startAngle,this.flipX)},updateAnimState:function(a){this.particleState.updateAnimState(a,
this.timer,this.maxTime,this.postAnimTime,this.startAngle,this.flipX,this.angleSync)},initAnimations:function(a){var b=this.pData;a.replaceAnimationSet("default",b.anim);if(b.followUpAnim){a.replaceAnimationSet("followUp",b.followUpAnim);this.entity.setCurrentAnim("default",true,"followUp",true)}else{a.removeAnimSet("followUp");this.entity.setCurrentAnim("default",true,null,true)}b.postAnim?a.replaceAnimationSet("post",b.postAnim):a.removeAnimSet("post")}});ig.ENTITY.Particle=ig.AnimatedEntity.extend({handle:null,
init:function(a,b,c,d){this.parent(a,b,c,d);this.animSheet=new ig.AnimationSheet;this.handle=new ig.ParticleHandle(this);this._initParticle(d)},reset:function(a,b,c,d){this.parent(a,b,c,d);this._initParticle(d)},_initParticle:function(a){this.handle.setData(a);this.coll.type=a.collision?ig.COLLTYPE.PASSIVE:ig.COLLTYPE.NONE;this.coll.setSize(0,0,0);this.coll.alwaysRender=true;a.vel&&Vec2.assign(this.coll.vel,a.vel);this.coll.friction.ground=a.friction||0;this.coll.friction.air=this.coll.friction.ground;
this.handle.initAnimations(this.animSheet);this.handle.initAnimState(this.animState)},update:function(){this.handle.onUpdate();this.handle.updateAnimState(this.animState);this.parent()}});ig.EntityPool.enableFor(ig.ENTITY.Particle);ig.ENTITY.FaceParticle=ig.AnimatedEntity.extend({handle:null,face:{x:0,y:0},init:function(a,b,c,d){this.parent(a,b,c,d);this.animSheet=new ig.AnimationSheet;this.handle=new ig.ParticleHandle(this,true);this._initFaceParticle(d)},reset:function(a,b,c,d){this.parent(a,b,
c,d);this.face.x=this.face.y=0;this._initFaceParticle(d)},_initFaceParticle:function(a){this.handle.setData(a);this.handle.moveWithTarget=1;this.coll.type=ig.COLLTYPE.NONE;if(a.size){a=a.size;this.coll.setSize(a.x,a.y,a.z)}else this.coll.setSize(0,0,0);this.handle.initAnimations(this.animSheet);this.handle.initAnimState(this.animState)},update:function(){this.handle.onUpdate();this.handle.updateAnimState(this.animState);this.parent()}});ig.EntityPool.enableFor(ig.ENTITY.FaceParticle);ig.ENTITY.CopyParticle=
ig.Entity.extend({handle:null,color:null,colorAlpha:null,noLighter:false,oldPos:Vec3.create(),init:function(a,b,c,d){this.parent(a,b,c,d);this.handle=new ig.ParticleHandle(this);this._initCopyParticle(d)},reset:function(a,b,c,d){this.parent(a,b,c,d);this._initCopyParticle(d)},_initCopyParticle:function(a){this.handle.setData(a);this.coll.type=ig.COLLTYPE.NONE;this.coll.friction.ground=0;this.color=a.color||null;this.fadeColor=a.fadeColor||null;this.colorAlpha=a.colorAlpha||1;this.noLighter=a.noLighter||
false;for(var b=a.spriteFilter,c=a.entity,d=c.sprites.length&&c.sprites[0].gui||false,e=0,k=c.sprites.length;k--;)if(!b||b.indexOf(k)!=-1){this.setSpriteCount(e+1,d);var l=this.sprites[e];l.assign(c.sprites[k]);l.setShadow(0,0,0,0);l.pos.y=l.pos.y-1;l.gfxOffset.y=l.gfxOffset.y+1;a.offset&&Vec3.add(l.pos,a.offset);this.handle.initSprite(l);e++}Vec3.assign(this.oldPos,this.coll.pos)},initSprites:function(){},update:function(){this.handle.onUpdate();this.parent()},updateSprites:function(){var a=Vec3.sub(this.coll.pos,
this.oldPos,d);Vec3.assign(this.oldPos,this.coll.pos);var b=this.color;if(this.fadeColor){var b=this.handle.timer/this.handle.maxTime,c=new ig.RGBColor(this.color),e=new ig.RGBColor(this.fadeColor);ig.RGBColor.interpolate(c,e,b,c);b=c.toRGB()}for(c=this.sprites.length;c--;){Vec3.add(this.sprites[c].pos,a);this.noLighter?this.sprites[c].setOverlayColor(b,this.colorAlpha):this.sprites[c].setLighterOverlayColor(b,this.colorAlpha);this.handle.updateSprite(this.sprites[c])}}});ig.EntityPool.enableFor(ig.ENTITY.CopyParticle);
ig.ENTITY.DebrisParticle=ig.AnimatedEntity.extend({handle:null,minZVel:8,init:function(a,b,c,d){this.parent(a,b,c,d);this.animSheet=new ig.AnimationSheet;this.handle=new ig.ParticleHandle(this);this._initDeprisParticle(d)},reset:function(a,b,c,d){this.parent(a,b,c,d);this._initDeprisParticle(d)},_initDeprisParticle:function(a){this.handle.setData(a);this.coll.type=ig.COLLTYPE.PASSIVE;var b=a.debrisSize;b?this.coll.setSize(b.x,b.y,b.z):this.coll.setSize(8,8,8);this.coll.zGravityFactor=a.zGravityFactor==
void 0?1:a.zGravityFactor;this.coll.zBounciness=a.zBounciness==void 0?0.9:a.zBounciness;this.coll.bounciness=1;this.coll.friction.ground=1;this.coll.friction.air=0;this.coll.shadow.size=a.shadowSize;b=this.coll;b.setPos(b.pos.x-b.size.x/2,b.pos.y-b.size.y/2,b.pos.z);a.vel&&Vec2.assign(this.coll.vel,a.vel);this.coll.vel.z=a.zVel||0;this.minZVel=a.minZVel||0;this.handle.initAnimations(this.animSheet);this.handle.initAnimState(this.animState)},update:function(){this.handle.onUpdate();this.handle.updateAnimState(this.animState);
this.parent()},onTouchGround:function(){if(this.minZVel&&this.coll.vel.z<this.minZVel)this.coll.vel.z=this.minZVel}});ig.EntityPool.enableFor(ig.ENTITY.DebrisParticle);var b=Vec2.create(),a=Vec2.create();ig.ENTITY.OffsetParticle=ig.ENTITY.Particle.extend({startFactor:0,moveOffset:Vec2.createC(0,0),alongZ:false,keySpline:null,inverse:false,moveRotate:0,rotateWithTime:false,rotateGfx:false,normalMoveDist:0,moveDuration:0,prevWeight:0,moveTimer:0,init:function(a,b,c,d){this.parent(a,b,c,d);this._initOffsetParticle(d)},
reset:function(a,b,c,d){this.parent(a,b,c,d);this._initOffsetParticle(d)},_initOffsetParticle:function(a){this.coll.type=ig.COLLTYPE.NONE;this.startFactor=a.startFactor||0;Vec2.assign(this.moveOffset,a.moveOffset);this.alongZ=a.alongZ||false;this.keySpline=a.keySpline||KEY_SPLINES.LINEAR;this.inverse=a.inverse||false;this.moveDuration=a.moveDuration||0;this.moveRotate=a.moveRotate||0;this.rotateWithTime=a.rotateWithTime||false;this.rotateGfx=a.rotateGfx||false;this.normalMoveDist=a.normalMoveDist||
0;this.moveTimer=0;this.prevWeight=-1;this._updatePos()},_updatePos:function(){var c=this.prevWeight==-1?0:this.startFactor+this.prevWeight*(1-this.startFactor);if(this.prevWeight==-1)this.prevWeight=0;Vec2.mulF(this.moveOffset,c,b);c=this.moveDuration||this.handle.maxTime;this.moveTimer=this.moveTimer+ig.system.tick;if(this.moveTimer>c)this.moveTimer=c;var d=this.moveTimer/c,d=this.keySpline.get(d);this.inverse&&(d=1-d);var e=this.startFactor+d*(1-this.startFactor);if(this.moveRotate){var i=(this.rotateWithTime?
ig.system.tick/c:d-this.prevWeight)*this.moveRotate*Math.PI*2;this.inverse&&(i=-i);Vec2.rotate(this.moveOffset,this.alongZ?i:-i);if(this.rotateGfx)this.animState.angle=this.animState.angle+i}i=0;this.normalMoveDist&&(i=this.normalMoveDist*(ig.system.tick/c));Vec2.mulF(this.moveOffset,e,a);Vec2.sub(a,b);this.setPos(this.coll.pos.x+a.x,this.coll.pos.y+(this.alongZ?i:a.y),this.coll.pos.z+(this.alongZ?a.y:i));this.prevWeight=d},update:function(){this.parent();this._updatePos()}});ig.EntityPool.enableFor(ig.ENTITY.OffsetParticle);
ig.ENTITY.RhombusParticle=ig.ENTITY.Particle.extend({startFactor:0,moveFactor:0,radius:100,alongZ:false,keySpline:null,prevWeight:0,init:function(a,b,c,d){this.parent(a,b,c,d);this._initOffsetParticle(d)},reset:function(a,b,c,d){this.parent(a,b,c,d);this._initOffsetParticle(d)},_initOffsetParticle:function(a){this.coll.type=ig.COLLTYPE.NONE;this.startFactor=a.startFactor||0;this.moveFactor=a.moveFactor||0;this.radius=a.radius||0;this.alongZ=a.alongZ||false;this.keySpline=a.keySpline||KEY_SPLINES.LINEAR;
this.prevWeight=this.startFactor;a=this._getRhombusOffset(b,this.startFactor,this.radius);this.setPos(this.coll.pos.x+a.x,this.coll.pos.y+(this.alongZ?0:a.y),this.coll.pos.z+(this.alongZ?a.y:0))},_updatePos:function(){var c=this._getRhombusOffset(b,this.prevWeight,this.radius);this.prevWeight=this.startFactor+this.handle.timer/this.handle.maxTime*this.moveFactor;var d=this._getRhombusOffset(a,this.prevWeight,this.radius),c=Vec2.sub(d,c);this.setPos(this.coll.pos.x+c.x,this.coll.pos.y+(this.alongZ?
0:c.y),this.coll.pos.z+(this.alongZ?c.y:0))},_getRhombusOffset:function(a,b,c){b=(b%1+1)%1;a.x=c*(Math.abs(Math.abs(3-4*b)-2)-1);a.y=c*(2*Math.abs(1-2*b)-1);return a},update:function(){this.parent();this._updatePos()}});ig.EntityPool.enableFor(ig.ENTITY.RhombusParticle);var d=Vec3.create(),c=Vec3.create(),e=Vec3.create();ig.FX_HOMING_FLY_TYPE={FLY_ARC:[{dist:function(a){return a},normal:function(a){return 1-(2*a-1)*(2*a-1)}}],EXPAND_DASH:[{dist:function(){return 0},normal:function(a){return KEY_SPLINES.EASE_OUT.get(a)}},
{dist:function(a){return a},normal:function(a){return 1-a}}]};ig.ENTITY.HomingParticle=ig.ENTITY.Particle.extend({inverse:false,flyType:null,ownerEffect:0,normalXY:0,normalZ:0,moveTimer:0,phaseDurations:null,autoTargetStuck:true,init:function(a,b,c,d){this.parent(a,b,c,d);this._initOffsetParticle(d)},reset:function(a,b,c,d){this.parent(a,b,c,d);this._initOffsetParticle(d)},_initOffsetParticle:function(a){this.coll.type=ig.COLLTYPE.NONE;this.flyType=ig.FX_HOMING_FLY_TYPE[a.flyType]||ig.FX_HOMING_FLY_TYPE.FLY_ARC;
this.inverse=a.inverse||false;this.ownerEffect=a.ownerEffect;this.normalXY=a.normalXY;this.normalZ=a.normalZ;this.phaseDurations=a.phaseDurations||[];this.rotateMoveDir=a.rotateMoveDir||false;this.autoTargetStuck=true;var b=Math.random();if(a.target1Vary){this.target1Vary=Vec2.createC(0,a.target1Vary*Math.sqrt(Math.random()));Vec2.rotate(this.target1Vary,b*2*Math.PI)}else this.target1Vary=null;if(a.target2Vary){this.target2Vary=Vec2.createC(0,a.target2Vary*Math.sqrt(Math.random()));Vec2.rotate(this.target2Vary,
b*2*Math.PI)}else this.target2Vary=null;this.moveTimer=0;this._updatePos(true)},_updatePos:function(a){if(this.moveTimer>this.handle.maxTime)this.moveTimer=this.handle.maxTime;var g=this.moveTimer/this.handle.maxTime;g>1&&(g=1);for(var h=0,i=1;h<this.flyType.length-1&&(this.phaseDurations[h]||0)<=g;){var j=this.phaseDurations[h]||0,g=g-j,i=i-j;h++}var j=this.flyType[h],g=g/(h==this.flyType.length-1?i:this.phaseDurations[h]||0),h=j.dist(g),i=j.normal(g),k=Vec3.assign(e,this.ownerEffect.coll.pos),j=
this.ownerEffect.getTarget2Pos(d);this.target1Vary&&Vec2.add(k,this.target1Vary);this.target2Vary&&Vec2.add(j,this.target2Vary);g=this.inverse?Vec3.lerp(k,j,h,c):Vec3.lerp(j,k,h,c);if(i&&this.normalXY){h=Vec2.sub(j,k,b);this.normalXY<0?Vec2.rotate90CCW(h):Vec2.rotate90CW(h);Vec2.length(h,Math.abs(this.normalXY)*i);Vec2.add(g,h)}g.z=g.z+this.normalZ*i;if(this.rotateMoveDir){a=a||this.rotateMoveDir==sc.HOMING_ROTATE_TYPE.AT_TARGET?Vec3.sub(j,g,d):Vec3.sub(g,this.coll.pos,d);a.y=a.y-a.z;a=Vec2.clockangle(a);
this.animState.angle=a}this.setPos(g.x,g.y,g.z)},update:function(){this.parent();this.moveTimer=this.moveTimer+ig.system.tick;this._updatePos()}});ig.EntityPool.enableFor(ig.ENTITY.HomingParticle);ig.ENTITY.LaserParticle=ig.Entity.extend({handle:null,init:function(a,b,c,d){this.parent(a,b,c,d);this.handle=new ig.ParticleHandle(this);this._initLaserParticle(d)},reset:function(a,b,c,d){this.parent(a,b,c,d);this._initLaserParticle(d)},_initLaserParticle:function(a){this.handle.setData(a);this.coll.type=
ig.COLLTYPE.NONE;this.coll.setSize(0,0,0);this.coll.alwaysRender=true;this.ownerEffect=a.ownerEffect;this.patternSheet=a.patternSheet;this.animFrames=a.animFrames;this.frameTime=a.frameTime||0.1;this.shiftSpeed=a.shiftSpeed||0;this.animTimer=0;this.offset=a.offset||null;this.guiSprites=a.guiSprites||false;this.renderMode=a.renderMode},initSprites:function(){this.setSpriteCount(1,this.guiSprites);this.handle.initSprite(this.sprites[0])},update:function(){this.handle.onUpdate();this.animTimer=this.animTimer+
ig.system.tick;this.parent()},updateSprites:function(){var a=this.sprites[0],e=Vec3.assign(c,this.ownerEffect.coll.pos),h=this.ownerEffect.getTarget2Pos(d);this.offset&&Vec3.add(e,this.offset);h=Vec2.assignC(b,h.x,h.y-h.z);Vec2.subC(h,e.x,e.y-e.z);var i=this.patternSheet.patternTileWidth,j=Vec2.length(h),j=Math.round(j);a.setSize(i,j,0,0);a.setPos(e.x-i/2,e.y-j,e.z);a.setPivot(i/2,j);if(this.renderMode)a.renderMode=this.renderMode;e=Math.round(-this.shiftSpeed*this.animTimer);i=this.patternSheet.getPattern(this.animFrames[Math.floor(this.animTimer/
this.frameTime)%this.animFrames.length]);a.setImageSrc(i,0,e);this.handle.updateSprite(a);a.rotate=Vec2.clockangle(h);a.alwaysRender=true}});ig.EntityPool.enableFor(ig.ENTITY.LaserParticle)});ig.baked=!0;
ig.module("impact.feature.effect.effect-sheet").requires("impact.base.loader","impact.base.animation","impact.feature.effect.entities.effect","impact.feature.effect.entities.effect-particle").defines(function(){var b={anim:{_type:"EffectAnim",_info:"Animation of particle"},followUpAnim:{_type:"EffectAnim",_info:"Animation of particle to be played before anim",_optional:true},postAnim:{_type:"EffectAnim",_info:"Animation of particle to be played when particle disappears",_optional:true}},a={pAlpha:{_type:"ParticleState",
_info:"Alpha state of particle",_subType:"Number",_subDefault:1,_optional:true},pScale:{_type:"ParticleState",_info:"Alpha state of particle",_subType:"Vec2",_subDefault:{x:1,y:1},_optional:true},pRotate:{_type:"ParticleState",_info:"Alpha state of particle",_subType:"Number",_subDefault:0,_optional:true},angleVary:{_type:"Number",_info:"If defined, randomly vary angle centered around start angle with given circular angle range",_optional:true},randFlip:{_type:"Boolean",_info:"If true: randomly flip particule horizontally",
_optional:true},moveWithTarget:{_type:"Number",_info:"Whether particle should move with target. 0=not at all. 0.5=over half the time, 1=entirely",_optional:true},pLight:{_type:"String",_info:"If defined: emit light of given size for each particle",_select:ig.LIGHT_SIZE,_optional:true},particleDuration:{_type:"Number",_info:"Duration of particle. 0=animation length. -1=forever. -2=length of effect. Does NOT include time of post animation / transitions",_optional:true},particleDurVariance:{_type:"Number",
_info:"Variance to duration. Value will be added or subtracted from duration",_optional:true},cancelable:{_type:"Boolean",_info:"If true, then particle is killed when effect is stopped.",_optional:true}};ig.EffectConfig=ig.Config.extend({init:function(c){var d={attributes:{}};c.particleType&&(c.particleType!="CopyParticle"&&c.particleType!="LaserParticle")&&ig.merge(d.attributes,b);ig.merge(d.attributes,c.attributes);c.particleType&&ig.merge(d.attributes,a);this.parent(d)}});ig.EffectConfig.loadParticleData=
function(a,b,d){var h={};h.anim=a&&b.anim&&a.anims[b.anim]||null;h.followUpAnim=a&&b.followUpAnim&&a.anims[b.followUpAnim]||null;h.postAnim=a&&b.postAnim&&a.anims[b.postAnim]||null;h.state=new ig.ParticleState(b);h.moveWithTarget=b.moveWithTarget||0;h.particleDuration=b.particleDuration||0;h.particleDurVariance=b.particleDurVariance||0;h.angleVary=b.angleVary||0;h.randFlip=b.randFlip||false;h.cancelable=b.cancelable||false;h.light=ig.LIGHT_SIZE[b.pLight]||0;a&&!h.anim&&ig.log("EFFECT ERROR - No Animation of name '"+
b.anim+"' in '"+d+"' available. Used by '"+c+"'");return h};ig.EffectConfig.getParticleBlockTime=function(a){return a.cancelable?(a.particleDuration||a.anim.getDuration())*a.moveWithTarget:0};ig.EffectConfig.getParticleDuration=function(a){return a.particleDuration||a.anim.getDuration()};var d=Vec2.create();ig.ParticleState=ig.Class.extend({alpha:null,scale:null,rotate:null,init:function(a){if(a.pAlpha)this.alpha=this._convertEntry(a.pAlpha);if(a.pScale)this.scale=this._convertEntry(a.pScale);if(a.pRotate)this.rotate=
this._convertEntry(a.pRotate,2*Math.PI)},_convertEntry:function(a,b){var c={start:ig.copy(a.start),end:ig.copy(a.end),valStart:a.init,valMiddle:a.start?a.start.value:a.init,valEnd:a.end?a.end.value:a.start?a.start.value:a.init};if(b){c.valStart=c.valStart*b;c.valMiddle=c.valMiddle*b;c.valEnd=c.valEnd*b}c.start&&(c.start.spline=KEY_SPLINES[c.start.spline]||null);c.end&&(c.end.spline=KEY_SPLINES[c.end.spline]||null);return c},getMaxEndTime:function(a){a=a||0;this.alpha&&this.alpha.end&&(a=Math.max(a,
this.alpha.end.time||0));this.scale&&this.scale.end&&(a=Math.max(a,this.scale.end.time||0));this.rotate&&this.rotate.end&&(a=Math.max(a,this.rotate.end.time||0));return a},getAlpha:function(a,b,c){if(this.alpha){a=this._getEntryWeight(this.alpha,a,b,c);if(a==0)return this.alpha.valMiddle;if(a<0){b=this.alpha.valStart;c=this.alpha.valMiddle;a=a+100}else{b=this.alpha.valMiddle;c=this.alpha.valEnd}return b+a*(c-b)}return false},getScale:function(a,b,c,d,i){if(this.scale){b=this._getEntryWeight(this.scale,
b,c,d);if(b==0){a.x=this.scale.valMiddle.x;a.y=this.scale.valMiddle.y}else{if(b<0){c=this.scale.valStart;d=this.scale.valMiddle;b=b+100}else{c=this.scale.valMiddle;d=this.scale.valEnd}a.x=c.x+b*(d.x-c.x);a.y=c.y+b*(d.y-c.y)}if(i)a.x=-a.x}},getRotate:function(a,b,c,d,i){if(this.rotate){a=this._getEntryWeight(this.rotate,a,b,c);b=0;if(a==0)b=this.rotate.valMiddle;else{if(a<0){b=this.rotate.valStart;c=this.rotate.valMiddle;a=a+100}else{b=this.rotate.valMiddle;c=this.rotate.valEnd}b=b+a*(c-b)}i&&(b=-b);
return d+b}},initAnimState:function(a,b,c){a.alpha=this.alpha?this.alpha.valStart:1;a.angle=b+(this.rotate?c?-this.rotate.valStart:this.rotate.valStart:0);a.scaleX=this.scale?this.scale.valStart.x:1;a.scaleY=this.scale?this.scale.valStart.y:1;if(c)a.scaleX=-a.scaleX},updateAnimState:function(a,b,c,h,i,j,k){if(this.alpha)a.alpha=this.getAlpha(b,c,h);if(this.scale){this.getScale(d,b,c,h,j);a.scaleX=d.x;a.scaleY=d.y}if(this.rotate&&(this.rotate.start||this.rotate.end))a.angle=this.getRotate(b,c,h,i,
j);else if(k)a.angle=this.rotate?i+(j?-this.rotate.valStart:this.rotate.valStart):i},initSprite:function(a,b,c){a.setAlpha(this.alpha?this.alpha.valStart:1);if(this.scale){a.scale.x=this.scale?this.scale.valStart.x:1;a.scale.y=this.scale?this.scale.valStart.y:1}if(c)a.scale.y=-a.scale.y;if(this.rotate)a.rotate=b+(this.rotate?c?-this.rotate.valStart:this.rotate.valStart:0)},updateSprite:function(a,b,c,d,i,j,k){this.alpha&&a.setAlpha(this.getAlpha(b,c,d));this.scale&&this.getScale(a.scale,b,c,d,j);
if(this.rotate&&(this.rotate.start||this.rotate.end))a.rotate=this.getRotate(b,c,d,i,j);else if(k)a.rotate=this.rotate?i+(j?-this.rotate.valStart:this.rotate.valStart):i},_getEntryWeight:function(a,b,c,d){var d=a.end?a.end.time||d:0,i=a.start?a.start.time||c-d:0,j=0;if(b<i){j=(b/i).limit(0,1);a.start.spline&&(j=a.start.spline.get(j));j=j-100}else if(c>0&&a.end&&c-b<d){j=(1-(c-b)/d).limit(0,1);a.end.spline&&(j=a.end.spline.get(j))}return j}});ig.EffectSheet=ig.JsonLoadable.extend({cacheType:"EffectSheet",
animSheet:null,faceAnimSheet:null,effects:{},debugReload:true,onCacheCleared:function(){this.animSheet&&this.animSheet.clearCached();this.faceAnimSheet&&this.faceAnimSheet.clearCached();for(var a in this.effects)this.effects[a].clearCached()},getJsonPath:function(){return ig.root+this.path.toPath("data/effects/",".json")+ig.getCacheSuffix()},onload:function(a){this.name=a.name;if(a.ANIMS){a.ANIMS.shapeType||(a.ANIMS.shapeType="YZ_EXPAND");a.ANIMS.wallY==void 0&&(a.ANIMS.wallY=1);a.ANIMS.centerPivot==
void 0&&(a.ANIMS.centerPivot=true);this.animSheet=new ig.AnimationSheet(a.ANIMS)}if(a.FACEANIMS){a.FACEANIMS.DOCTYPE||(a.FACEANIMS.DOCTYPE="MULTI_DIR_ANIMATION");this.faceAnimSheet=new ig.AnimationSheet(a.FACEANIMS)}for(var b in a.EFFECTS)this.effects[b]=new ig.Effect(this,b,a.EFFECTS[b])},hasEffect:function(a){return!!this.effects[a]},spawnOnTarget:function(a,b,c){if(!this.loaded)return null;if(!this.effects[a]){ig.warn("Could not span effect '"+a+"' of sheet '"+this.path+"'");return null}if(!b)return null;
var c=c||{},d=b.getCenter();return ig.game.spawnEntity(ig.ENTITY.Effect,d.x,d.y,b.coll.pos.z,{effect:this.effects[a],target:b,target2:c.target2,target2Point:c.target2Point,target2Align:c.target2Align,target2Offset:c.target2Offset,noMultiGroup:c.noMultiGroup,spriteFilter:c.spriteFilter,offset:c.offset,rotOffset:c.rotOffset,align:c.align||ig.ENTITY_ALIGN.BOTTOM,angle:c.angle||0,flipX:c.flipX||false,rotateFace:c.rotateFace||0,flipLeftFace:c.flipLeftFace||false,duration:c.duration||0,group:c.group||null,
callback:c.callback})},spawnFixed:function(a,b,c,d,i,j){if(!this.loaded)return null;if(!this.effects[a]){ig.warn("Could not span effect '"+a+"' of sheet '"+this.path+"'");return null}j=j||{};return ig.game.spawnEntity(ig.ENTITY.Effect,b,c,d,{effect:this.effects[a],target:i,target2:j.target2,target2Point:j.target2Point,target2Align:j.target2Align,target2Offset:j.target2Offset,noMultiGroup:j.noMultiGroup,spriteFilter:j.spriteFilter,align:0,flipX:j.flipX||false,rotateFace:j.rotateFace||0,flipLeftFace:j.flipLeftFace||
false,angle:j.angle||0,duration:j.duration||0,group:j.group||null,callback:j.callback})}});ig.FX_RUNNER_CANCEL={NONE:0,ALL:1,ONLY_PERMA:2};var c=null;ig.Effect=ig.Class.extend({id:null,steps:[],loopStartIdx:0,loopStartTime:0,loopEndIdx:-1,loopEndTime:-1,maxTime:0,init:function(a,b,d){this.id=a.path+"/"+b;var h=0;c=b;for(b=0;b<d.length;++b){var i=d[b],j=i.type;if(j=="WAIT"){h=h+i.time;this.maxTime=Math.max(this.maxTime,h);i=new ig.EffectStepBase}else if(j=="LOOP_START"){this.loopStartIdx=this.steps.length;
this.loopStartTime=h;i=new ig.EffectStepBase}else if(j=="LOOP_END"){this.loopEndIdx=this.steps.length;this.loopEndTime=h;i=new ig.EffectStepBase;this.maxTime=this.loopEndTime}else i=new ig.EFFECT_ENTRY[i.type](a,i);i.time=h;this.steps.push(i);i=i.getDuration?i.getDuration():0;if(!i||i<0)i=0;this.maxTime=Math.max(this.maxTime,h+i)}if(this.loopEndIdx==-1){this.loopEndIdx=this.steps.length;this.loopEndTime=this.maxTime}if(this.loopEndTime-this.loopStartTime==0&&this.loopEndIdx>=this.steps.length-1){this.loopEndTime=
this.loopEndTime+0.1;this.maxTime=Math.max(this.maxTime,this.loopEndTime)}},clearCached:function(){for(var a=0;a<this.steps.length;++a)this.steps[a].clearCached&&this.steps[a].clearCached()},update:function(a){a.timer=a.timer+ig.system.tick;var b=a.duration==0;if(a.duration>0){a.duration=a.duration-ig.system.tick;if(a.duration<=ig.COLLISION.EPS)a.duration=0}a.updateRunners();var c=this.steps,d=ig.FX_RUNNER_CANCEL.NONE;if(a.timelineIndex<this.loopEndIdx&&!a.duration){a.timer=this.loopEndTime;if(b||
a.looped)a.timelineIndex=this.loopEndIdx}if(!a.duration){if(a.state==ig.EFFECT_STATE.RUNNING&&a.timer>=this.loopEndTime){d=ig.FX_RUNNER_CANCEL.ALL;a.state=ig.EFFECT_STATE.POST_LOOP;if(a.callback)a.callback.onEffectEvent(a)}if(a.state==ig.EFFECT_STATE.POST_LOOP&&a.timer>=this.maxTime){d=d||ig.FX_RUNNER_CANCEL.ONLY_PERMA;a.state=ig.EFFECT_STATE.ENDED;if(a.callback)a.callback.onEffectEvent(a)}}if(a.timelineIndex>=this.loopEndIdx&&d){a.cancelRunners(d==ig.FX_RUNNER_CANCEL.ONLY_PERMA);d=null}for(var i;a.timelineIndex<
c.length&&(i=c[a.timelineIndex]).time<=a.timer;){if(b=i.start(a)){b=b.particles?new ig.EffectParticleRunner(i,b):new ig.EffectTimeRunner(i,b);b.update(a)||a.runners.push(b)}a.timelineIndex++;if(a.timelineIndex==this.loopEndIdx){if(d){a.cancelRunners(d==ig.FX_RUNNER_CANCEL.ONLY_PERMA);d=0}b=this.loopEndTime-this.loopStartTime;if(b<=0||!a.duration)break;a.looped=true;a.timer=a.timer-b;a.timelineIndex=this.loopStartIdx}}},isEnding:function(a){return a.timer>=this.loopEndTime},isDone:function(a){return a.timer>=
this.maxTime},getRemainingTime:function(a){return a.duration>=0?a.duration+(this.maxTime-this.loopEndTime):this.maxTime}});ig.EffectStepBase=ig.Class.extend({time:0,start:function(){},getDuration:function(){return 0}});ig.EffectHandle=ig.Class.extend({effectSheet:null,name:null,externalSheet:false,init:function(a){if(a.sheet instanceof ig.EffectSheet){this.effectSheet=a.sheet;this.externalSheet=true}else this.effectSheet=new ig.EffectSheet(a.sheet);this.name=a.name},clearCached:function(){!this.externalSheet&&
this.effectSheet&&this.effectSheet.decreaseRef()},spawnOnTarget:function(a,b){return this.effectSheet.spawnOnTarget(this.name,a,b)},spawnFixed:function(a,b,c,d,i){return this.effectSheet.spawnFixed(this.name,a,b,c,d,i)}});ig.EffectTimeRunner=ig.Class.extend({step:null,data:null,duration:0,_timer:0,init:function(a,b){this.step=a;this.data=b;this.duration=b.duration},update:function(a){this._timer=this._timer+ig.system.tick;this.step.update(a,this._timer,this.duration,this.data);var b=this.duration>=
0&&this._timer>this.duration;b&&this.step.finish&&this.step.finish(a,this.data);return b},cancel:function(a,b){if(b&&this.duration>=0)return false;var c=0;this.duration<0&&(c=this.step.cancel&&this.step.cancel(a,this._timer,this.data));if(c>0)this.duration=c;else{this.step.finish&&this.step.finish(a,this.data);return true}return false}});ig.EffectParticleRunner=ig.Class.extend({step:null,data:null,totalParticles:0,currentParticle:0,duration:0,_timer:0,init:function(a,b){this.step=a;this.data=b;this.totalParticles=
b.particles;this.keySpline=b.keySpline;this.duration=b.duration},update:function(a){var b=this.currentParticle;this._timer=this._timer+ig.system.tick;var c=Math.min(1,this._timer/this.duration);this.keySpline&&(c=this.keySpline.get(c));c=Math.ceil(c*this.totalParticles);this.currentParticle=Math.min(c,this.totalParticles);this.step.update(a,b,this.currentParticle,this.data);return this.currentParticle==this.totalParticles},cancel:function(a){this.step.finish&&this.step.finish(a,this.data);return true}});
ig.EFFECT_ENTRY={}});ig.baked=!0;
ig.module("impact.feature.rumble.rumble-steps").requires("impact.base.action","impact.base.event","impact.feature.effect.effect-sheet","impact.feature.rumble.rumble").defines(function(){function b(a){return a instanceof ig.Rumble.RumbleHandle}ig.EVENT_STEP.RUMBLE_SCREEN=ig.EventStepBase.extend({rumbleType:null,name:null,duration:0,power:0,speed:0,fade:false,_wm:new ig.Config({attributes:{rumbleType:{_type:"String",_info:"Type of rumble",_select:ig.RUMBLE_TYPE},name:{_type:"String",_info:"Name of the rumble. Can be ignored for anonymous rumble effects."},
duration:{_type:"Number",_info:"The time the rumble will take. -1 for continues effect"},power:{_type:"String",_select:ig.Rumble.SHAKE_POWER,_info:"Power of the rumble."},speed:{_type:"String",_select:ig.Rumble.SHAKE_DURATION,_info:"Speed of a single rumble."},fade:{_type:"Boolean",_info:"Rumble effect gets weaker towards the passed time."}}}),init:function(a){this.rumbleType=a.rumbleType||null;this.name=a.name||null;this.power=a.power||"WEAKEST";this.speed=a.speed||"SLOWEST";this.duration=a.duration||
0;this.fade=a.fade||false},start:function(){if(ig.rumble.getRumble(this.name))ig.rumble.getRumble(this.name).set(this.power,this.speed,this.duration,this.fade);else{var a=new ig.Rumble.RumbleHandle(this.rumbleType,this.power,this.speed,this.duration,this.fade,this.name);ig.rumble.addRumble(a)}}});ig.EVENT_STEP.RUMBLE_STOP_CONTINUES=ig.EventStepBase.extend({name:null,_wm:new ig.Config({attributes:{name:{_type:"String",_info:"Name of the rumble to stop. Must be given!"}}}),init:function(a){this.name=
a.name||null},start:function(){var a=ig.rumble.getRumble(this.name);a&&a.stop()}});ig.ACTION_STEP.RUMBLE_SCREEN=ig.ActionStepBase.extend({rumbleType:null,name:null,duration:0,power:0,speed:0,fade:false,_wm:new ig.Config({attributes:{rumbleType:{_type:"String",_info:"Type of rumble",_select:ig.RUMBLE_TYPE},name:{_type:"String",_info:"Name of the rumble. Can be ignored for anonymous rumble effects."},duration:{_type:"Number",_info:"The time the rumble will take. -1 for continues effect"},power:{_type:"String",
_select:ig.Rumble.SHAKE_POWER,_info:"Power of the rumble."},speed:{_type:"String",_select:ig.Rumble.SHAKE_DURATION,_info:"Speed of a single rumble."},fade:{_type:"Boolean",_info:"Rumble effect gets weaker towards the passed time."}}}),init:function(a){this.rumbleType=a.rumbleType||null;this.name=a.name||null;this.power=a.power||"WEAKEST";this.speed=a.speed||"SLOWEST";this.duration=a.duration||0;this.fade=a.fade||false},run:function(){if(ig.rumble.getRumble(this.name))ig.rumble.getRumble(this.name).set(this.power,
this.speed,this.duration,this.fade);else{var a=new ig.Rumble.RumbleHandle(this.rumbleType,this.power,this.speed,this.duration,this.fade,this.name);ig.rumble.addRumble(a)}return true}});ig.EFFECT_ENTRY.RUMBLE=ig.Class.extend({rumbleType:null,duration:0,power:0,speed:0,fade:false,_wm:new ig.Config({attributes:{rumbleType:{_type:"String",_info:"Type of Rumble effect",_select:ig.RUMBLE_TYPE},power:{_type:"String",_info:"Power of rumble effect",_select:ig.Rumble.SHAKE_POWER},speed:{_type:"String",_info:"Speed of rumble effect",
_select:ig.Rumble.SHAKE_DURATION},duration:{_type:"Number",_info:"Duration of rumble effect"},fade:{_type:"Boolean",_info:"True if rumble effect should fade towards the end."}}}),init:function(a,b){this.rumbleType=b.rumbleType||null;this.power=b.power||"WEAKEST";this.speed=b.speed||"SLOWEST";this.duration=b.duration||0;this.fade=b.fade||false},start:function(a){var b=new ig.Rumble.RumbleHandle(this.rumbleType,this.power,this.speed,this.duration,this.fade,null);a.addEntityAttached(b);ig.rumble.addRumble(b)}});
ig.EFFECT_ENTRY.CLEAR_RUMBLE=ig.Class.extend({rumbleType:null,duration:0,power:0,speed:0,fade:false,_wm:new ig.Config({attributes:{}}),init:function(){},start:function(a){a.clearEntityAttached(b)}})});ig.baked=!0;ig.module("impact.feature.rumble.plug-in").requires("impact.feature.rumble.rumble","impact.feature.rumble.rumble-steps").defines(function(){});ig.baked=!0;
ig.module("impact.feature.slow-motion.slow-motion").requires("impact.base.event","impact.base.game").defines(function(){ig.SlowMotion=ig.GameAddon.extend({slowMotions:[],namedSlowMotions:{},init:function(){this.parent("SlowMotion")},forceUpdate:function(){this.update();ig.system.tick=ig.system.actualTick*ig.system.timeFactor},update:function(){for(var b=1,a=this.slowMotions.length;a--;){var d=this.slowMotions[a];if(d.update()){d.name&&delete this.namedSlowMotions[d.name];this.slowMotions.splice(a,
1)}else b=Math.min(b,this.slowMotions[a].getFactor())}ig.system.setTimeFactor(b)},hasSlowMotion:function(b){return!!this.namedSlowMotions[b]},getNonInvertSlowDown:function(){for(var b=1,a=1,d=this.slowMotions.length;d--;){var c=this.slowMotions[d],e=c.getFactor(),a=Math.min(a,e);c.inverers.length>0&&(b=Math.max(b,1/e))}return a*b},postUpdateOrder:100,onPostUpdate:function(){this.update()},onLevelLoadStart:function(){this.onReset()},onReset:function(){this.slowMotions.length=0;this.namedSlowMotions=
{}},add:function(b,a,d){b=new ig.SlowMotionHandle(b,a,d);this.slowMotions.push(b);if(d){if(this.namedSlowMotions[d]){this.namedSlowMotions[d].clear();this.namedSlowMotions[d].name=null}this.namedSlowMotions[d]=b}return b},clearNamed:function(b,a){this.namedSlowMotions[b]&&this.namedSlowMotions[b].clear(a)}});ig.addGameAddon(function(){return ig.slowMotion=new ig.SlowMotion});ig.SlowMotionHandle=ig.Class.extend({factor:1,transitionTime:0,name:null,timer:0,cleared:false,inverers:[],init:function(b,
a,d){this.factor=b;this.timer=this.transitionTime=a;this.name=d||null},clear:function(b){this.cleared=true;this.timer=this.transitionTime=b||0},update:function(){if(this.timer>0){this.timer=this.timer-ig.system.actualTick;if(this.timer<0)this.timer=0}for(var b=this.inverers.length;b--;){this.inverers[b].influenceEntry.slowmoScale=1/this.getFactor();this.inverers[b].updateImmediately()}if(!this.timer&&this.cleared){for(b=this.inverers.length;b--;)this.inverers[b].clear();this.inverers.length=0;return true}return false},
addInverseEntity:function(b){var a=new ig.InfluenceEntry,b=new ig.InfluenceConnection(b.influencer,a);this.inverers.push(b)},getFactor:function(){var b=this.transitionTime?this.timer/this.transitionTime:0;this.cleared||(b=1-b);return(1-b)*1+b*this.factor},onActionEndDetach:function(){this.clear(0.2)}})});ig.baked=!0;
ig.module("impact.feature.slow-motion.slow-motion-steps").requires("impact.feature.slow-motion.slow-motion","impact.base.action","impact.base.event").defines(function(){ig.EVENT_STEP.ADD_SLOW_MOTION=ig.EventStepBase.extend({name:null,factor:0,time:0,_wm:new ig.Config({attributes:{name:{_type:"String",_info:"Name of the slow motion effect. Used this to remove the effect later on"},factor:{_type:"Number",_info:"How much to slow down the time. 0.5 = half the speed"},time:{_type:"Number",_info:"Transition time for slow motion"}}}),
init:function(b){this.name=b.name;this.factor=b.factor;this.time=b.time},start:function(){ig.slowMotion.add(this.factor,this.time,this.name)}});ig.EVENT_STEP.CLEAR_SLOW_MOTION=ig.EventStepBase.extend({name:null,time:0,_wm:new ig.Config({attributes:{name:{_type:"String",_info:"Name of slow motion to be removed"},time:{_type:"Number",_info:"Transition time for slow motion removal"}}}),init:function(b){this.name=b.name;this.time=b.time},start:function(){ig.slowMotion.clearNamed(this.name,this.time)}});
ig.ACTION_STEP.ADD_SLOW_MOTION=ig.ActionStepBase.extend({factor:0,time:0,_wm:new ig.Config({attributes:{factor:{_type:"Number",_info:"How much to slow down the time. 0.5 = half the speed"},time:{_type:"Number",_info:"Transition time for slow motion"},keepEntityStatic:{_type:"Boolean",_info:"If true, set entity to be in animation static time"},inversAccelerate:{_type:"Boolean",_info:"If true, inverse accelerate actor"}}}),init:function(b){this.factor=b.factor;this.time=b.time;this.keepEntityStatic=
b.keepEntityStatic;this.inversAccelerate=b.inversAccelerate},start:function(b){var a=ig.slowMotion.add(this.factor,this.time,null);b.addActionAttached(a);if(this.keepEntityStatic)b.coll.time.animStatic=true;if(this.inversAccelerate){for(b=b.coll;b.time.parent;)b=b.time.parent;a.addInverseEntity(b.entity)}}});ig.ACTION_STEP.CLEAR_SLOW_MOTION=ig.ActionStepBase.extend({time:0,_wm:new ig.Config({attributes:{time:{_type:"Number",_info:"Transition time for slow motion removal"},removeEntityStatic:{_type:"Boolean",
_info:"If true, remove entity from static time"}}}),init:function(b){this.time=b.time;this.removeEntityStatic=b.removeEntityStatic},start:function(b){for(var a=b.actionAttached,d=a.length;d--;)if(a[d]instanceof ig.SlowMotionHandle){a[d].clear(this.time);a.splice(d,1)}if(this.removeEntityStatic)b.coll.time.animStatic=false}})});ig.baked=!0;ig.module("impact.feature.slow-motion.plug-in").requires("impact.feature.slow-motion.slow-motion","impact.feature.slow-motion.slow-motion-steps").defines(function(){});
ig.baked=!0;
ig.module("impact.feature.effect.entities.effect-previewer").requires("impact.base.actor-entity").defines(function(){Vec3.create();ig.ENTITY.EffectPreviewer=ig.ActorEntity.extend({cameraHandle:null,currentEffectSheet:null,newEffectData:null,currentEffectHandle:null,spawnData:null,resetTimer:0,_wm:new ig.Config({spawnable:true,attributes:{},label:function(){return""},drawBox:true,boxColor:"rgba(255,0,0, 0.5)"}),init:function(b,a,d,c){this.parent(b,a,d,c);this.coll.setSize(24,24,24);this.animSheet=new ig.AnimationSheet("player");
this.initAnimations()},update:function(){if(this.resetTimer>0){this.resetTimer=this.resetTimer-ig.system.tick;this.resetTimer<0&&this.resetEntity()}if(!this.cameraHandle){this.cameraHandle=new ig.Camera.TargetHandle(new ig.Camera.EntityTarget(this),0,0);ig.camera.pushTarget(this.cameraHandle);this.cameraHandle.setZoom(2,0.2);ig.game.sendExternalMessage("READY",null)}if(!this.currentEffectHandle||this.currentEffectHandle.isDone()){if(this.currentEffectHandle){this.resetTimer=1;this.currentEffectHandle=
null}if(this.newEffectData){this.currentEffectSheet&&this.currentEffectSheet.decreaseRef();this.currentEffectSheet=null;try{this.currentEffectSheet=new ig.EffectSheet(this.newEffectData);this.newEffectData=null}catch(b){console.log("EFFECT SHEET ERROR: ",b)}}if(this.spawnData&&this.currentEffectSheet){this.currentEffectHandle=this.currentEffectSheet.spawnOnTarget(this.spawnData.name,this,this.spawnData.settings);this.spawnData=null}}this.parent()},stopCurrentEffect:function(){if(this.currentEffectHandle){this.currentEffectHandle.stop();
this.currentEffectHandle=null;this.resetTimer=1}},resetEntity:function(){this.resetTimer=0;this.animState.alpha=1;this.animState.angle=0;this.animState.scaleX=1;this.animState.scaleY=1;ig.EntityTools.clearEntitySpriteCut(this);ig.EntityTools.clearEntitySpriteOffset(this)},onExternalMessage:function(b,a){if(b=="EFFECT_PREVIEWER_APPEARANCE"){this.setSize(a.size.x,a.size.y,a.size.z);this.animSheet=new ig.AnimationSheet(a.animSheet);this.animSheet.addLoadListener(this);this.cameraHandle.setZoom(a.zoom||
1,0.2,KEY_SPLINES.EASE_IN_OUT);ig.system.totalTimeFactor=a.timeFactor||1}else if(b=="UPDATE_EFFECT_SHEET")this.newEffectData=a;else if(b=="PLAY_EFFECT"){this.stopCurrentEffect();this.resetEntity();this.spawnData=a;this.spawnData.settings.target2=ig.game.namedEntities.target2;this.spawnData.settings.target2Align=ig.ENTITY_ALIGN.CENTER}else if(b=="STOP_EFFECT"){this.stopCurrentEffect();this.spawnRepeat=false}else b=="RELOAD_IMAGE"&&ig.Image.reloadCache()},onLoadableComplete:function(b,a){if(a==this.animSheet){for(var d in this.animSheet.anims)break;
this.setCurrentAnim(d);this.animationFixed=true}}})});ig.baked=!0;
ig.module("impact.feature.effect.effect-steps").requires("impact.base.action","impact.base.event","impact.base.entity").defines(function(){var b=Vec3.create(),a=function(a){if(a.isDone())this.effect=null};ig.FX_FIRST_TARGET_OPTION={};ig.FX_FIRST_TARGET_OPTION.SELF=function(a){return a};ig.FX_FIRST_TARGET_OPTION.TARGET=function(a){return a.getTarget()};ig.FX_SECOND_TARGET_OPTION={};ig.FX_SECOND_TARGET_OPTION.SELF=function(a,b){a.target2=b};ig.FX_SECOND_TARGET_OPTION.ATTRIB_ENTITY=function(a,b,e){a.target2=
b.getAttribute(e)};ig.FX_SECOND_TARGET_OPTION.ATTRIB_POINT=function(a,b,e){a.target2Point=b.getAttribVec3(e)};ig.FX_SECOND_TARGET_OPTION.TARGET=function(a,b){a.target2=b.getTarget()};ig.ACTION_STEP.SHOW_EFFECT=ig.ActionStepBase.extend({effect:null,duration:0,offset:null,align:0,rotateFace:0,wait:false,waitSkip:0,group:null,partName:null,_wm:new ig.Config({attributes:{effect:{_type:"Effect",_info:"Effect to play"},duration:{_type:"Number",_info:"Amount of time to play animation.<br /> 0 = actual lenght of animation, -1 = forever until stopped."},
offset:{_type:"Offset",_info:"Offset to entity position"},rotOffset:{_type:"Vec2",_info:"X and Y offset that is rotated with face direction. Specified is vector for NORTH viewing direction",_optional:true},target:{_type:"String",_info:"If not defined: use same target",_optional:true,_select:ig.FX_FIRST_TARGET_OPTION},align:{_type:"String",_info:"Alignment of Animation relative to target",_select:ig.ENTITY_ALIGN},rotateFace:{_type:"Number",_info:"If number is provided: rotate effect to match entity face, number matching possible face directions. -1 = take precise face rotation"},
flipLeftFace:{_type:"Boolean",_info:"Flip the animation if rotation is negative."},wait:{_type:"Boolean",_info:"Wait until effect is over"},waitSkip:{_type:"Number",_info:"The amount of seconds to skip waiting before effect is over"},actionDetached:{_type:"Boolean",_info:"If true, keep Effect even after action is finished or canceled"},group:{_type:"String",_info:"A string identifying the effect. Optional. Name can be used with CLEAR_EFFECT to clear only certain effects",_optional:true},partName:{_type:"String",
_info:"Entity part on which to show animation",_optional:true},target2:{_type:"String",_info:"Secondary effect target options.",_optional:true,_select:ig.FX_SECOND_TARGET_OPTION},target2Key:{_type:"String",_info:"Additional key value to determine second target (e.g. for attribute name)",_optional:true},target2Offset:{_type:"Offset",_info:"Offset to entity position",_optional:true},target2Align:{_type:"String",_info:"Alignment of Animation relative to target",_select:ig.ENTITY_ALIGN,_optional:true},
noMultiGroup:{_type:"Boolean",_info:"If true: Do not transfer effect to all parts of the same group.",_optional:true},fixPos:{_type:"Boolean",_info:"If true: show effect fixed at current entity pos"},spriteFilter:{_type:"Array",_info:"Only apply filter on list of sprites (by index)",_sub:{_type:"Integer"},_optional:true},ignoreSlowMo:{_type:"Boolean",_info:"If true: ignore slow motion for this effect",_optional:true}}}),init:function(a){assertContent(a,"effect");this.effect=new ig.EffectHandle(a.effect);
this.duration=a.duration||0;this.offset=a.offset||0;this.rotOffset=a.rotOffset;this.align=ig.ENTITY_ALIGN[a.align]||ig.ENTITY_ALIGN.BOTTOM;this.wait=a.wait||false;this.waitSkip=a.waitSkip||0;this.actionDetached=a.actionDetached||false;this.rotateFace=a.rotateFace||0;this.group=a.group||false;this.flipLeftFace=a.flipLeftFace||false;this.partName=a.partName||null;this.target=ig.FX_FIRST_TARGET_OPTION[a.target]||null;this.target2=ig.FX_SECOND_TARGET_OPTION[a.target2]||null;this.target2Align=ig.ENTITY_ALIGN[a.target2Align]||
ig.ENTITY_ALIGN.BOTTOM;this.noMultiGroup=a.noMultiGroup||false;this.target2Offset=a.target2Offset;this.target2Key=a.target2Key||null;this.fixPos=a.fixPos||false;this.spriteFilter=a.spriteFilter||null;this.ignoreSlowMo=a.ignoreSlowMo||false},clearCached:function(){this.effect.clearCached()},start:function(d){var c={duration:this.duration,offset:this.offset,rotOffset:this.rotOffset,align:this.align,group:this.group,rotateFace:this.rotateFace,flipLeftFace:this.flipLeftFace,callback:null,target2:null,
target2Point:null,target2Align:this.target2Align,target2Offset:this.target2Offset,noMultiGroup:this.noMultiGroup,spriteFilter:this.spriteFilter};this.target2&&this.target2(c,d,this.target2Key);if(this.wait){d.stepData.onEffectEvent=a;c.callback=d.stepData}var e=d;this.target&&(e=this.target(d)||d);if(this.partName){for(var e=e.coll.subColls,f=e.length,g=null;f--;)if(e[f].entity.partName==this.partName){g=e[f].entity;break}e=g}if(this.fixPos){e=e.getAlignedPos(this.align,b);c.offset&&Vec3.add(e,c.offset);
c=this.effect.spawnFixed(e.x,e.y,e.z,d,c)}else c=this.effect.spawnOnTarget(e,c);if(c){c.setTimeEntity(d);this.actionDetached||c.attachToAction(d);this.ignoreSlowMo&&c.setIgnoreSlowdown();if(this.wait)d.stepData.effect=c}},run:function(a){return!this.wait||!a.stepData.effect||a.stepData.effect.getRemainingTime()<=this.waitSkip}});ig.ACTION_STEP.CLEAR_EFFECTS=ig.ActionStepBase.extend({entity:null,group:null,_wm:new ig.Config({attributes:{entity:{_type:"String",_info:"Secondary effect target.",_optional:true,
_select:ig.FX_SECOND_TARGET_OPTION},group:{_type:"String",_info:"If provided: only clear effects attached under specified group",_optional:true}}}),init:function(a){this.entity=ig.FX_SECOND_TARGET_OPTION[a.entity]||null;this.group=a.group||null},entityAttachedCondition:function(a){return a instanceof ig.ENTITY.Effect&&(!this.group||this.group==a.attachGroup)},actionAttachedCondition:function(a){return a instanceof ig.ENTITY.Effect},run:function(a){if(this.entity){var b={};this.entity(b,a);a=b.target2;
a.clearEntityAttached(this.entityAttachedCondition.bind(this))}else this.group?a.clearEntityAttached(this.entityAttachedCondition.bind(this)):a.clearActionAttached(this.actionAttachedCondition.bind(this));return true}});ig.EVENT_STEP.SHOW_EFFECT=ig.EventStepBase.extend({entity:null,effect:null,duration:0,offset:null,group:null,wait:false,waitSkip:0,target2:null,target2Offset:null,target2Align:null,_wm:new ig.Config({attributes:{entity:{_type:"Entity",_info:"Entity to apply effect on"},effect:{_type:"Effect",
_info:"Effect to play"},duration:{_type:"Number",_info:"Amount of time to play animation.<br /> 0 = actual lenght of animation, -1 = forever until stopped."},offset:{_type:"Offset",_info:"Offset to entity position"},align:{_type:"String",_info:"Alignment of Animation relative to target",_select:ig.ENTITY_ALIGN},group:{_type:"String",_info:"A string identifying the effect. Optional. Name can be used with CLEAR_EFFECT to clear only certain effects"},wait:{_type:"Boolean",_info:"Wait until effect is over"},
waitSkip:{_type:"Number",_info:"The amount of seconds to skip waiting before effect is over"},target2:{_type:"Entity",_info:"Alternative target for homing particles",_optional:true},target2Offset:{_type:"Offset",_info:"Offset to entity position",_optional:true},target2Align:{_type:"String",_info:"Alignment of Animation relative to target",_select:ig.ENTITY_ALIGN,_optional:true},ignoreSlowMo:{_type:"Boolean",_info:"If true: ignore slow motion for this effect",_optional:true}}}),init:function(a){assertContent(a,
"effect");this.entity=a.entity;this.effect=new ig.EffectHandle(a.effect);this.duration=a.duration||0;this.offset=a.offset||null;this.align=ig.ENTITY_ALIGN[a.align]||ig.ENTITY_ALIGN.BOTTOM;this.group=a.group||null;this.wait=a.wait||false;this.waitSkip=a.waitSkip||0;this.target2=a.target2;this.target2Align=ig.ENTITY_ALIGN[a.target2Align]||ig.ENTITY_ALIGN.BOTTOM;this.target2Offset=a.target2Offset;this.ignoreSlowMo=a.ignoreSlowMo||false},clearCached:function(){this.effect.clearCached()},start:function(b,
c){var e=ig.Event.getEntity(this.entity,c),f;this.target2&&(f=ig.Event.getEntity(this.target2,c));f={duration:this.duration,offset:this.offset,align:this.align,group:this.group,target2:f,target2Align:this.target2Align,target2Offset:this.target2Offset};if(this.wait){f.callback=b;b.onEffectEvent=a}b.effect=this.effect.spawnOnTarget(e,f);this.ignoreSlowMo&&b.effect.setIgnoreSlowdown()},run:function(a){if(!this.wait||!a.effect||a.effect.getRemainingTime()<=this.waitSkip){a.effect=null;return true}return false}});
ig.EVENT_STEP.CLEAR_EFFECTS=ig.EventStepBase.extend({entity:null,group:null,_wm:new ig.Config({attributes:{entity:{_type:"Entity",_info:"Entity to clear effects from"},group:{_type:"String",_info:"if provided: only clear effects attached under specified group",_optional:true}}}),init:function(a){this.entity=a.entity;this.group=a.group||null},entityAttachedCondition:function(a){return a instanceof ig.ENTITY.Effect&&(!this.group||this.group==a.attachGroup)},start:function(a,b){var e=ig.Event.getEntity(this.entity,
b);e&&e.clearEntityAttached(this.entityAttachedCondition.bind(this))}})});ig.baked=!0;
ig.module("impact.feature.effect.fx.fx-basic").requires("impact.feature.effect.effect-sheet").defines(function(){ig.EFFECT_ENTRY.WAIT=ig.EffectStepBase.extend({_wm:new ig.Config({attributes:{time:{_type:"Number",_info:"Time to wait"}}})});ig.EFFECT_ENTRY.LOOP_START=ig.EffectStepBase.extend({_wm:new ig.Config({attributes:{}})});ig.EFFECT_ENTRY.LOOP_END=ig.EffectStepBase.extend({_wm:new ig.Config({attributes:{}})});var b=Vec3.create();ig.EFFECT_ENTRY.PLAY_ANIM=ig.EffectStepBase.extend({_wm:new ig.EffectConfig({particleType:"Particle",
attributes:{useTargetAngle:{_type:"Boolean",_info:"Align animation with effect rotation"},keepAngleSync:{_type:"Boolean",_info:"If true: Keep target angle synchronized while particle is visible"},offset:{_type:"Offset",_info:"Offset to effect center",_optional:true},rotOffset:{_type:"Offset",_info:"Offset rotated with effect direction",_optional:true}}}),particleData:null,offset:{x:0,y:0,z:0},rotOffset:null,useTargetAngle:false,init:function(a,b){this.particleData=ig.EffectConfig.loadParticleData(a.animSheet,
b,a&&a.cacheKey);if(b.offset)this.offset=b.offset;this.rotOffset=b.rotOffset||null;this.useTargetAngle=b.useTargetAngle||false;this.keepAngleSync=b.keepAngleSync||false},start:function(a){var c=a.angle,d=null;this.useTargetAngle&&(a.target&&a.target.animState)&&(c=c+a.target.animState.angle);this.keepAngleSync&&(d=a);var e=Vec3.assignC(b,0,0,0);if(this.rotOffset){Vec3.add(e,this.rotOffset);Vec2.rotate(e,-a.angle)}Vec3.add(e,this.offset);a.spawnParticle(ig.ENTITY.Particle,e,{data:this.particleData,
angle:c,flipX:a.flipX,angleSync:d})},getDuration:function(){return ig.EffectConfig.getParticleBlockTime(this.particleData)}});ig.EFFECT_ENTRY.PLAY_FACE_ANIM=ig.EffectStepBase.extend({particleData:null,offset:{x:0,y:0,z:0},_wm:new ig.EffectConfig({particleType:"FaceParticle",attributes:{offset:{_type:"Offset",_info:"Offset to effect center",_optional:true}}}),init:function(a,b){this.particleData=ig.EffectConfig.loadParticleData(a.faceAnimSheet,b,a&&a.cacheKey);if(b.offset)this.offset=b.offset},start:function(a){var c=
Vec3.assign(b,this.offset);if(a.target){c.x=c.x-a.target.coll.size.x/2;c.y=c.y-a.target.coll.size.y/2}a.spawnParticle(ig.ENTITY.FaceParticle,c,{data:this.particleData,size:a.target&&a.target.coll.size})},getDuration:function(){return ig.EffectConfig.getParticleBlockTime(this.particleData)}});var a=Vec2.create();ig.EFFECT_ENTRY.PLAY_ANIM_RANGE=ig.EffectStepBase.extend({particleData:null,offset:{x:0,y:0,z:0},radius:0,duration:0,numParticles:2,useTargetAngle:false,_wm:new ig.EffectConfig({particleType:"Particle",
attributes:{radius:{_type:"Number",_info:"Radius in which animation is played"},useTargetAngle:{_type:"Boolean",_info:"Align animation with effect rotation"},numParticles:{_type:"Number",_info:"Amount of particles",_default:1},duration:{_type:"Number",_info:"Duration in which to spawn particles"},offset:{_type:"Offset",_info:"Offset to effect center",_optional:true},alongY:{_type:"Boolean",_info:"If true: distribute animation along Y coordinate instead of Z"},moveZDist:{_type:"Number",_info:"Distance that entities should move upward (or downward if negative",
_optional:true},keySpline:{_type:"String",_info:"Keyspline of particle z movement",_select:KEY_SPLINES,_optional:true}}}),init:function(a,b){this.particleData=ig.EffectConfig.loadParticleData(a.animSheet,b,a&&a.cacheKey);if(b.offset)this.offset=b.offset;this.radius=b.radius||0;this.duration=b.duration||0;this.numParticles=b.numParticles||1;this.useTargetAngle=b.useTargetAngle||false;this.alongY=b.alongY||false;this.moveZDist=b.moveZDist||0;this.keySpline=KEY_SPLINES[b.keySpline]||null},getDuration:function(){return this.duration},
start:function(){return{duration:this.duration,particles:this.numParticles}},update:function(b,c,d){var e=b.angle;this.useTargetAngle&&(b.target&&b.target.animState)&&(e=e+b.target.animState.angle);e={data:this.particleData,angle:e};if(this.moveZDist){e.moveOffset=Vec2.createC(0,this.moveZDist);e.alongZ=true;e.keySpline=this.keySpline}for(;c<d;++c){var f=ig.copy(this.offset),g=this.radius*Math.sqrt(Math.random()),h=Vec2.assignC(a,Math.random()-0.5,Math.random()-0.5);Vec2.length(h,g);f.x=(f.x||0)+
h.x;this.alongY?f.y=(f.y||0)+h.y:f.z=(f.z||0)+h.y;b.spawnParticle(ig.ENTITY[this.moveZDist?"OffsetParticle":"Particle"],f,e)}}});var d={},c={},e=Vec3.create();ig.EFFECT_ENTRY.PLAY_ANIMS_OVER_ENTITY=ig.EffectStepBase.extend({particleData:null,duration:0,xScale:1,yScale:1,circular:false,offset:{x:0,y:0,z:0},numParticles:0,keySpline:0,moveZDist:0,_wm:new ig.EffectConfig({particleType:"Particle",attributes:{numParticles:{_type:"Integer",_info:"Amount of particles to spawn",_default:1},duration:{_type:"Number",
_info:"Duration in which to spawn particles"},circular:{_type:"Boolean",_info:"True if particles should be spawned circular (instead of rectangular)."},xScale:{_type:"Number",_info:"How much of the x dimension should be covered. 1=full",_optional:true},yScale:{_type:"Number",_info:"How much of the y dimension should be covered. 1=full",_optional:true},moveZDist:{_type:"Number",_info:"Distance that entities should move upward (or downward if negative",_optional:true},keySpline:{_type:"String",_info:"Keyspline of particle z movement",
_select:KEY_SPLINES,_optional:true},offset:{_type:"Offset",_info:"Offset to effect center",_optional:true}}}),init:function(a,b){this.particleData=ig.EffectConfig.loadParticleData(a.animSheet,b,a&&a.cacheKey);this.duration=b.duration||0;this.xScale=b.xScale||1;this.yScale=b.yScale||1;this.circular=b.circular||false;this.moveZDist=b.moveZDist||0;this.keySpline=KEY_SPLINES[b.keySpline]||null;b.offset&&Vec3.assign(this.offset,b.offset);this.numParticles=b.numParticles||2},start:function(a){if(a.target){ig.EntityTools.getSpriteBounds(d,
a.target);var a=d.left+d.right,b=d.top+d.bottom;if(!(a<0||b<0))return{duration:this.duration,particles:this.numParticles*a/32*b/32*this.xScale*this.yScale*this.duration,offX:(-d.left+d.right)/2,offY:d.bottom,offZ:b/2,radius:a/2,aspectRatio:b/a}}},getDuration:function(){return this.duration+ig.EffectConfig.getParticleBlockTime(this.particleData)},update:function(b,d,f,g){c.data=this.particleData;if(this.moveZDist){c.moveOffset=Vec2.createC(0,this.moveZDist);c.alongZ=true;c.keySpline=this.keySpline}for(;d<
f;++d){var h=Vec3.assignC(e,0,0,0),i=Vec2.assignC(a,Math.random()-0.5,Math.random()-0.5);if(this.circular){var p=g.radius*Math.sqrt(Math.random());Vec2.length(i,p)}else{i.x=i.x*g.radius*2;i.y=i.y*g.radius*2}h.x=g.offX+i.x*this.xScale+this.offset.x;h.y=g.offY+this.offset.y;h.z=g.offZ+i.y*this.yScale*g.aspectRatio+this.offset.z;b.spawnParticle(ig.ENTITY[this.moveZDist?"OffsetParticle":"Particle"],h,c,true)}}});var f=Vec2.create(),g=Vec2.create(),h={};ig.EFFECT_ENTRY.DEBRIS_OVER_ENTITY=ig.EffectStepBase.extend({particleData:null,
xScale:1,yScale:1,circular:false,offset:{x:0,y:0,z:0},numParticles:0,debrisSize:0,_wm:new ig.EffectConfig({particleType:"DeprisParticle",attributes:{numParticles:{_type:"Integer",_info:"Amount of particles per tile",_default:1},circular:{_type:"Boolean",_info:"True if particles should be spawned circular (instead of rectangular)."},xScale:{_type:"Number",_info:"How much of the x dimension should be covered. 1=full",_optional:true},yScale:{_type:"Number",_info:"How much of the y dimension should be covered. 1=full",
_optional:true},minSpeed:{_type:"Number",_info:"Minimum amount of speed",_optional:true},maxSpeed:{_type:"Number",_info:"Maximum amount of speed",_optional:true},minZSpeed:{_type:"Number",_info:"Minimum amount of z speed"},maxZSpeed:{_type:"Number",_info:"Maximum amount of z speed"},debrisSize:{_type:"Offset",_info:"Collision size of debris",_optional:true},zGravityFactor:{_type:"Number",_info:"Gravity factor of debris",_optional:true},zBounciness:{_type:"Number",_info:"Z bounciness of debris",_optional:true},
minZVel:{_type:"Number",_info:"mininum zVel when bouncing on Ground",_optional:true},offset:{_type:"Offset",_info:"Offset to effect center",_optional:true}}}),init:function(a,b){this.particleData=ig.EffectConfig.loadParticleData(a.animSheet,b,a&&a.cacheKey);this.xScale=b.xScale||1;this.yScale=b.yScale||1;this.circular=b.circular||false;b.offset&&Vec3.assign(this.offset,b.offset);this.minSpeed=b.minSpeed||0;this.maxSpeed=b.maxSpeed||0;this.minZSpeed=b.minZSpeed||0;this.maxZSpeed=b.maxZSpeed||0;this.zGravityFactor=
b.zGravityFactor||null;if(b.zBounciness!=void 0)this.zBounciness=b.zBounciness;this.debrisSize=b.debrisSize||void 0;this.numParticles=b.numParticles||2},start:function(a){if(a.target){ig.EntityTools.getSpriteBounds(d,a.target);var b=d.left+d.right,c=d.top+d.bottom,i=Math.round(b*this.xScale),m=Math.round(c*this.yScale),b=-d.left+(b-i)/2,c=-d.top+(c-m)/2,n=Math.round(this.numParticles*i/16),p=Math.round(this.numParticles*m/16);h.data=this.particleData;h.zGravityFactor=this.zGravityFactor;h.zBounciness=
this.zBounciness;h.debrisSize=this.debrisSize;for(var r=0;r<n;++r)for(var t=0;t<p;++t){var q=i*r/(n-1),s=m*t/(p-1),v=Vec2.assignC(f,q-i/2,s-m/2),s=Vec2.assignC(g,b+q,c+s);if(this.circular){v.x=v.x*(m/i);if(Vec2.length(v)>m/2)continue;v.x=v.x*(i/m)}q=Vec3.assignC(e,0,0,0);q.x=this.offset.x+s.x;q.y=this.offset.y+s.y;q.z=this.offset.z+s.z;s=Math.random();h.zVel=this.minZSpeed*s+this.maxZSpeed*(1-s);h.vel=Vec2.length(v,this.minSpeed+Math.random()*(this.maxSpeed-this.minSpeed));a.spawnParticle(ig.ENTITY.DebrisParticle,
q,h,true)}}},getDuration:function(){return ig.EffectConfig.getParticleBlockTime(this.particleData)}});ig.EFFECT_ENTRY.PLAY_SOUND=ig.EffectStepBase.extend({sound:null,global:false,loop:false,attachHandle:false,settings:null,_wm:new ig.Config({attributes:{sound:{_type:"SoundT",_info:"URL of sound."},group:{_type:"String",_info:"Group of sounds. Sounds of same group will interrupt each other",_optional:true},volume:{_type:"Number",_info:"Volume of sound",_default:1},global:{_type:"Boolean",_info:"Play sound globally if true"},
loop:{_type:"Boolean",_info:"Loop sound if true"},variance:{_type:"Number",_info:"Speed playback variance.",_optional:true},speed:{_type:"Number",_info:"Playback speed. 1=default speed. 0.5=half speed.",_optional:true},fadeDuration:{_type:"Number",_info:"Fade duration of sound when canceled. Increase in case of sound artifacts",_optional:true},radius:{_type:"Number",_info:"Radius up to which you can hear the sound",_optional:true},attachHandle:{_type:"Boolean",_info:"Attach the sound handle so even non-looped sounds can be stopped.",
_optional:true}}}),init:function(a,b){if(b.sound)this.sound=new ig.Sound(b.sound,b.volume||1,b.variance||0,b.group);this.global=b.global||false;this.loop=b.loop||false;this.radius=b.radius||0;this.attachHandle=b.attachHandle||false;this.settings={speed:b.speed||1,fadeDuration:b.fadeDuration||0}},clearCached:function(){this.sound&&this.sound.clearCached()},start:function(a){if(this.sound){var b;b=this.global?this.sound.play(this.loop,this.settings):ig.SoundHelper.playAtEntity(this.sound,a,this.loop,
this.settings,this.radius);this.loop?a.addEntityAttached(b):this.attachHandle&&a.addEntityAttached(b)}}});ig.EFFECT_ENTRY.PLAY_RANDOM_SOUND=ig.EffectStepBase.extend({sounds:[],global:false,loop:false,settings:null,_wm:new ig.Config({attributes:{sounds:{_type:"Array",_info:"Sound to be played random",_sub:{_type:"SoundConfig"}},global:{_type:"Boolean",_info:"Play sound globally if true"},loop:{_type:"Boolean",_info:"Loop sound if true"},speed:{_type:"Number",_info:"Playback speed. 1=default speed. 0.5=half speed.",
_optional:true},fadeDuration:{_type:"Number",_info:"Fade duration of sound when canceled. Increase in case of sound artifacts",_optional:true},radius:{_type:"Number",_info:"Radius up to which you can hear the sound",_optional:true}}}),init:function(a,b){for(var c=0;c<b.sounds.length;++c){var d=b.sounds[c];this.sounds.push(new ig.Sound(d.sound,d.volume||1,d.variance||0))}this.global=b.global||false;this.loop=b.loop||false;this.radius=b.radius||0;this.settings={speed:b.speed||1,fadeDuration:b.fadeDuration||
0}},clearCached:function(){for(var a=this.sounds.length;a--;)this.sounds[a].clearCached()},start:function(a){var b;b=this.sounds.random();b=this.global?b.play(this.loop,this.settings):ig.SoundHelper.playAtEntity(b,a,this.loop,this.settings,this.radius);this.loop&&a.addEntityAttached(b)}});var i=function(a){return a instanceof ig.SoundHandle};ig.EFFECT_ENTRY.STOP_SOUNDS=ig.EffectStepBase.extend({_wm:new ig.Config({attributes:{}}),init:function(){},start:function(a){a.clearEntityAttached(i)}})});
ig.baked=!0;
ig.module("impact.feature.effect.fx.fx-box").requires("impact.feature.effect.effect-sheet").defines(function(){var b=Vec2.create();Vec2.create();var a=Vec3.create(),d=Vec2.create(),c=Vec2.create(),e={};ig.BOX_PARTICLE_SIDE={ALL:15,NORTH:1,EAST:2,SOUTH:4,WEST:8,NO_NORTH:14,NO_EAST:13,NO_SOUTH:11,NO_WEST:7};var f=[{x:0,y:0,w:1,h:0,flag:1},{x:1,y:0,w:0,h:1,flag:2},{x:0,y:1,w:1,h:0,flag:4},{x:0,y:0,w:0,h:1,flag:8}];ig.EFFECT_ENTRY.PARTICLE_BOX=ig.EffectStepBase.extend({particleData:null,padding:{x:0,y:0},
boxSide:0,numParticles:4,flipRightParticles:false,minSpeed:50,maxSpeed:100,collision:false,random:0,moveZ:0,moveZVariance:0,_wm:new ig.EffectConfig({particleType:"OffsetParticle",attributes:{boxSide:{_type:"String",_info:"Which side of the box to spawn particles on",_select:ig.BOX_PARTICLE_SIDE},padding:{_type:"Vec2",_info:"Padding around target bounds. Can also be negative"},collision:{_type:"Boolean",_info:"Whether particles should collide."},numParticles:{_type:"Integer",_info:"Amount of particles",
_default:1},random:{_type:"Number",_info:"Randomness of particle spawning from 0 to 1",_optional:true},flipRightParticles:{_type:"Boolean",_info:"Flip particles spawned on the right side",_optional:true},minSpeed:{_type:"Number",_info:"Minimum Speed of particles",_optional:true},maxSpeed:{_type:"Number",_info:"Maximum Speed of particles",_optional:true},moveZ:{_type:"Number",_info:"Move particles upwards by given pixels. (won't move away in this case)",_optional:true},moveZVariance:{_type:"Number",
_info:"Z Distance Variance.",_optional:true}}}),init:function(a,b){this.particleData=ig.EffectConfig.loadParticleData(a.animSheet,b,a&&a.cacheKey);b.padding&&Vec2.assign(this.padding,b.padding);this.boxSide=ig.BOX_PARTICLE_SIDE[b.boxSide||"ALL"];this.numParticles=b.numParticles;this.flipRightParticles=b.flipRightParticles||false;this.minSpeed=b.minSpeed||0;this.maxSpeed=b.maxSpeed||0;this.collision=b.collision||false;this.random=b.random||0;this.moveZ=b.moveZ||0;this.moveZVariance=b.moveZVariance||
0},getDuration:function(){return ig.EffectConfig.getParticleBlockTime(this.particleData)},start:function(a){if(a.target)for(var b=a.target.coll,c=f.length;c--;)this.boxSide&f[c].flag&&this.spawnBoxLine(a,b,f[c])},spawnBoxLine:function(f,h,i){var j=i.x?h.size.x+this.padding.x:-this.padding.x,k=i.y?h.size.y+this.padding.y:-this.padding.y,l=i.w?h.size.x+this.padding.x*2:0,o=i.h?h.size.y+this.padding.y*2:0,i=Vec2.assignC(b,0,0);Vec2.addC(i,j,k);j=Math.max(1,this.numParticles*(l+o)/32|0);l=l/j;o=o/j;e.data=
this.particleData;e.friction=0.8;e.collision=this.collision;for(k=0;k<j;k++){var m=Vec3.assignC(a,i.x,i.y,0);m.x=m.x+(0.5+k+(Math.random()-0.5)*this.random)*l;m.y=m.y+(0.5+k+(Math.random()-0.5)*this.random)*o;var n=Vec2.assignC(c,m.x,m.y);Vec2.subC(n,h.size.x/2,h.size.y/2);e.flipX=this.flipRightParticles&&n.x<0;if(this.moveZ){n=this.moveZ+(Math.random()-0.5)*2*this.moveZVariance;e.alongZ=true;e.moveOffset=Vec2.assignC(d,0,n);e.keySpline=KEY_SPLINES.EASE_OUT;f.spawnParticle(ig.ENTITY.OffsetParticle,
m,e,true)}else{Vec2.length(n,this.minSpeed+Math.random()*(this.maxSpeed-this.minSpeed));e.vel=n;f.spawnParticle(ig.ENTITY.Particle,m,e,true)}}}})});ig.baked=!0;
ig.module("impact.feature.effect.fx.fx-color").requires("impact.feature.effect.effect-sheet").defines(function(){ig.EFFECT_ENTRY.FLASH_COLOR=ig.EffectStepBase.extend({color:null,alpha:1,keepDuration:0,duration:1,_wm:new ig.Config({attributes:{color:{_type:"String",_info:"Color to flash in"},alpha:{_type:"Number",_info:"Maximum alpha of color flash"},duration:{_type:"Number",_info:"Duration of color flash"},keepDuration:{_type:"Number",_info:"Duration of showing maximum flash intensity at beginnging."},
noLighter:{_type:"Boolean",_info:"If true, don't apply lighter color but regular color overlay"}}}),init:function(b,a){this.color=a.color||"white";this.alpha=a.alpha||1;this.duration=a.duration||1;this.keepDuration=a.keepDuration||0;this.lighter=!a.noLighter;assert(this.duration>=0)},start:function(b){var a=new ig.ColorOverlay(this.color,0,b.spriteFilter?b.spriteFilter[0]:null,this.lighter);b.target&&b.target.animState&&ig.EntityTools.addEntityColorOverlay(b.target,a);return{duration:this.duration+
this.keepDuration,overlay:a}},getDuration:function(){return this.duration+this.keepDuration},update:function(b,a,d,c){b=0;b=a<this.keepDuration?1:Math.max(0,1-(a-this.keepDuration)/this.duration);c.overlay.alpha=b*this.alpha},finish:function(b,a){a.overlay.clear()}});ig.EFFECT_ENTRY.BLINK_COLOR=ig.EffectStepBase.extend({color:null,maxAlpha:1,minAlpha:0,blinkDuration:0.5,blinkCount:1,_wm:new ig.Config({attributes:{color:{_type:"String",_info:"Color to blink in"},maxAlpha:{_type:"Number",_info:"Maximum alpha intensity"},
minAlpha:{_type:"Number",_info:"Minimum alpha intensity"},blinkDuration:{_type:"Number",_info:"Duration of one time flashing back and force between min and max alpha"},blinkCount:{_type:"Integer",_info:"Number of blinks. -1 if unlimited"},noLighter:{_type:"Boolean",_info:"If true, don't apply lighter color but regular color overlay"}}}),init:function(b,a){this.color=a.color||"white";this.maxAlpha=a.maxAlpha||1;this.minAlpha=a.minAlpha||0;this.blinkDuration=a.blinkDuration||0;this.blinkCount=a.blinkCount||
1;this.lighter=!a.noLighter},start:function(b){var a=new ig.ColorOverlay(this.color,0,b.spriteFilter?b.spriteFilter[0]:null,this.lighter);b.target&&b.target.animState&&ig.EntityTools.addEntityColorOverlay(b.target,a);return{duration:this.getDuration(),overlay:a}},getDuration:function(){return this.blinkCount<0?-1:this.blinkCount*this.blinkDuration},update:function(b,a,d,c){b=this.minAlpha;if(a<this.blinkDuration/2||d>0&&d-a<this.blinkDuration/2)b=0;a=a%this.blinkDuration/this.blinkDuration;a=(a>0.5?
1-a:a)*2;c.overlay.alpha=b*(1-a)+this.maxAlpha*a},cancel:function(b,a){return Math.ceil(a/this.blinkDuration)*this.blinkDuration},finish:function(b,a){a.overlay.clear()}});ig.EFFECT_ENTRY.FADE_COLOR=ig.EffectStepBase.extend({color:null,alpha:1,fadeIn:0,fadeOut:0,duration:0,_wm:new ig.Config({attributes:{color:{_type:"String",_info:"Color to blink in"},alpha:{_type:"Number",_info:"Maximum alpha intensity"},fadeIn:{_type:"Number",_info:"Fade in duration of color"},fadeOut:{_type:"Number",_info:"Fade out duration of color"},
duration:{_type:"Number",_info:"Duration of color display. -1 = forever"},noLighter:{_type:"Boolean",_info:"If true, don't apply lighter color but regular color overlay"}}}),init:function(b,a){this.color=a.color||"white";this.alpha=a.alpha||1;this.fadeIn=a.fadeIn||0;this.fadeOut=a.fadeOut||0;this.duration=a.duration||0;this.lighter=!a.noLighter},start:function(b){var a=new ig.ColorOverlay(this.color,0,b.spriteFilter?b.spriteFilter[0]:null,this.lighter);b.target&&b.target.animState&&ig.EntityTools.addEntityColorOverlay(b.target,
a,b.noMultiGroup);return{duration:this.getDuration(),overlay:a}},getDuration:function(){return this.duration<0?-1:this.fadeIn+this.duration+this.fadeOut},update:function(b,a,d,c){b=1;d>0&&d-a<this.fadeOut?b=(d-a)/this.fadeOut:a<this.fadeIn&&(b=a/this.fadeIn);c.overlay.alpha=this.alpha*b},cancel:function(b,a){return a+this.fadeOut},finish:function(b,a){a.overlay.clear()}});ig.EFFECT_ENTRY.CHANGE_ALPHA=ig.EffectStepBase.extend({alpha:0,duration:0,_wm:new ig.Config({attributes:{alpha:{_type:"Number",
_info:"Target alpha value"},duration:{_type:"Number",_info:"Transition time to target alpha value"}}}),init:function(b,a){this.alpha=a.alpha||0;this.duration=a.duration||0},getDuration:function(){return this.duration},start:function(b){if(b.target&&b.target.animState)if(this.duration==0)b.target.animState.alpha=this.alpha;else return{duration:this.duration,startAlpha:b.target.animState.alpha}},update:function(b,a,d,c){if(b.target&&b.target.animState){a=Math.min(1,a/d);b.target.animState.alpha=c.startAlpha*
(1-a)+this.alpha*a}},finish:function(b){if(b.target&&b.target.animState)b.target.animState.alpha=this.alpha}});ig.EFFECT_ENTRY.CHANGE_SCALE=ig.EffectStepBase.extend({scaleX:0,scaleY:0,duration:0,spline:null,_wm:new ig.Config({attributes:{scaleX:{_type:"Number",_info:"Target scale X value",_default:1},scaleY:{_type:"Number",_info:"Target scale Y value",_default:1},duration:{_type:"Number",_info:"Transition time to target scale value"},spline:{_type:"String",_info:"Spline for transition",_optional:true,
_select:KEY_SPLINES}}}),init:function(b,a){this.scaleX=a.scaleX||0;this.scaleY=a.scaleY||0;this.duration=a.duration||0;this.spline=KEY_SPLINES[a.spline||"LINEAR"]},getDuration:function(){return this.duration},start:function(b){if(b.target&&b.target.animState)if(this.duration==0){b.target.animState.scaleX=this.scaleX;b.target.animState.scaleY=this.scaleY}else return{duration:this.duration,startScaleX:b.target.animState.scaleX,startScaleY:b.target.animState.scaleY}},update:function(b,a,d,c){if(b.target&&
b.target.animState){a=Math.min(1,a/d);a=this.spline.get(a);b.target.animState.scaleX=c.startScaleX*(1-a)+this.scaleX*a;b.target.animState.scaleY=c.startScaleY*(1-a)+this.scaleY*a}},finish:function(b){if(b.target&&b.target.animState){b.target.animState.scaleX=this.scaleX;b.target.animState.scaleY=this.scaleY}}})});ig.baked=!0;
ig.module("impact.feature.effect.fx.fx-circle").requires("impact.feature.effect.effect-sheet").defines(function(){var b=Vec2.create(),a=Vec2.create(),d=Vec3.create(),c={},e=ig.EffectStepBase.extend({particleData:null,offset:{x:0,y:0,z:0},duration:0,clockwise:false,rotOffset:null,numParticles:16,centralAngle:0,startAngle:0,random:false,uniformRandom:0,startDist:0,particleRotate:false,flipRightParticles:false,collision:false,alongZ:false,useTargetAngle:false,init:function(a,b){this.particleData=ig.EffectConfig.loadParticleData(a.animSheet,
b,a&&a.cacheKey);if(b.offset)this.offset=b.offset;this.rotOffset=b.rotOffset||null;this.numParticles=b.numParticles;this.random=b.random||false;this.uniformRandom=b.uniformRandom||0;this.centralAngle=b.centralAngle*Math.PI*2||Math.PI*2;this.startAngle=b.startAngle!==void 0?b.startAngle*Math.PI*2:-this.centralAngle/2;this.startDist=b.startDist||0;this.particleRotate=b.particleRotate||false;this.flipRightParticles=b.flipRightParticles||false;this.collision=b.collision||false;this.alongZ=b.alongZ||false;
this.duration=b.duration||0;this.clockwise=b.clockwise||false;this.useTargetAngle=b.useTargetAngle||false;this.circleSpline=KEY_SPLINES[b.circleSpline]||null},start:function(a){if(this.duration)return{duration:this.duration,particles:this.numParticles,keySpline:this.circleSpline};this._spawnParticles(a,0,this.numParticles)},_spawnParticles:function(e,g,h){var i=Vec2.assignC(b,0,-1),j=this.centralAngle==Math.PI*2?this.numParticles:this.numParticles-1;c.data=this.particleData;c.friction=0.8;c.collision=
this.collision;for(c.alongZ=this.alongZ;g<h;g++){var k=j?g/j:0.5;j&&this.uniformRandom?k=k+1/j*(Math.random()-0.5)*this.uniformRandom:this.random&&(k=Math.random());k=this.startAngle+k*this.centralAngle;this.clockwise||(k=-k);e.flipX&&(k=-k);k=k+e.angle;this.useTargetAngle&&(k=k+e.target.animState.angle);var l=Vec3.assignC(d,0,0,0);if(this.rotOffset){Vec3.add(l,this.rotOffset);Vec2.rotate(l,-e.angle)}this.offset&&Vec3.add(l,this.offset);var o=Vec2.rotate(i,-k,a),m=this.flipRightParticles&&o.x<0;e.flipX&&
(m=!m);c.angle=this.particleRotate?k:0;c.flipX=m;if(this.alongZ)o.y=o.y*-1;this.spawn(e,l,c,o)}},update:function(a,b,c){this._spawnParticles(a,b,c)},getDuration:function(){return this.duration+ig.EffectConfig.getParticleBlockTime(this.particleData)},spawn:function(){}});ig.EFFECT_ENTRY.OFFSET_PARTICLE_CIRCLE=e.extend({moveDist:0,moveVariance:0,keySpline:null,moveRotate:0,rotateWithTime:false,inverse:false,normalMoveDist:0,_wm:new ig.EffectConfig({particleType:"OffsetParticle",attributes:{numParticles:{_type:"Integer",
_info:"Number of particles to be spawned"},duration:{_type:"Number",_info:"Duration of particle spawning"},clockwise:{_type:"Boolean",_info:"true if particles are to move clockwise",_optional:true},centralAngle:{_type:"Number",_info:"Circle range to spawn. 1=full circle",_default:1},startAngle:{_type:"Number",_info:"Turn angle from which to start relative to view direciton. 0.25=quarter turn",_optional:true},startDist:{_type:"Number",_info:"Start distance away from center"},random:{_type:"Boolean",
_info:"If true, spawn particles randomly along circle",_optional:true},uniformRandom:{_type:"Number",_info:"Only vary slightly along circle. Set intensity between 0-1",_optional:true},particleRotate:{_type:"Boolean",_info:"If true, rotate particle with movement orientation",_optional:true},flipRightParticles:{_type:"Boolean",_info:"If true, flip particles on the right side",_optional:true},alongZ:{_type:"Boolean",_info:"If true, move particales along z instead of y",_optional:true},offset:{_type:"Offset",
_info:"Offset to effect center",_optional:true},rotOffset:{_type:"Offset",_info:"Offset rotated with effect direction",_optional:true},useTargetAngle:{_type:"Boolean",_info:"Align spawning with rotation of target",_optional:true},circleSpline:{_type:"String",_info:"Keyspline used for circle spawning speed",_select:KEY_SPLINES,_optional:true},moveDist:{_type:"Number",_info:"Fixed move distance in pixels away from circle (or towards circle if inverse=true)"},moveVariance:{_type:"Number",_info:"Move distance variation in pixels",
_optional:true},moveDuration:{_type:"Number",_info:"Duration of particle motion. If not defined, will use particleDuration",_optional:true},keySpline:{_type:"String",_info:"Keyspline of particle movement",_select:KEY_SPLINES},moveRotate:{_type:"Number",_info:"Particles should rotate while moving away/torwards circle. 1=full circle rotation",_optional:true},rotateWithTime:{_type:"Boolean",_info:"Set to true if particles should rotate with time rather than move distance",_optional:true},inverse:{_type:"Boolean",
_info:"Set to true if particles should move towards center instead of away.",_optional:true},normalMoveDist:{_type:"Number",_info:"Distance to be moved in orthogonal direction of circle",_optional:true},collision:{_type:"Boolean",_info:"Set to true if particles should collide with environment"}}}),init:function(a,b){this.parent(a,b);this.moveDist=b.moveDist||0;this.moveVariance=b.moveVariance||0;this.moveDuration=b.moveDuration||0;this.keySpline=KEY_SPLINES[b.keySpline]||null;this.moveRotate=b.moveRotate||
0;this.rotateWithTime=b.rotateWithTime||false;this.inverse=b.inverse||false;this.normalMoveDist=b.normalMoveDist||0},spawn:function(a,b,c,d){var e=this.startDist+this.moveDist+(2*Math.random()-1)*this.moveVariance;Vec2.length(d,e);c.startFactor=this.startDist/e;c.moveOffset=d;c.moveDuration=this.moveDuration;c.keySpline=this.keySpline;c.moveRotate=a.flipX?-this.moveRotate:this.moveRotate;c.rotateWithTime=this.rotateWithTime;c.rotateGfx=this.particleRotate;c.inverse=this.inverse;c.normalMoveDist=this.normalMoveDist;
a.spawnParticle(ig.ENTITY.OffsetParticle,b,c);delete c.normalMoveDist;delete c.moveOffset;delete c.moveDuration;delete c.keySpline;delete c.moveRotate;delete c.rotateWithTime;delete c.inverse}});e=e.extend({spawn:function(a,b,c,d){b.x=b.x+d.x*this.startDist;this.alongZ?b.z=b.z+d.z*this.startDist:b.y=b.y+d.y*this.startDist;c.vel=Vec2.length(d,this.minSpeed+Math.random()*(this.maxSpeed-this.minSpeed));this.spawnVel(a,b,c);delete c.vel},spawnVel:function(){}});ig.EFFECT_ENTRY.PARTICLE_CIRCLE=e.extend({minSpeed:50,
maxSpeed:100,_wm:new ig.EffectConfig({particleType:"Particle",attributes:{numParticles:{_type:"Integer",_info:"Number of particles to be spawned"},duration:{_type:"Number",_info:"Duration of particle spawning"},clockwise:{_type:"Boolean",_info:"true if particles are to move clockwise",_optional:true},centralAngle:{_type:"Number",_info:"Circle range to spawn. 1=full circle",_default:1},startAngle:{_type:"Number",_info:"Turn angle from which to start relative to view direciton. 0.25=quarter turn",_optional:true},
startDist:{_type:"Number",_info:"Start distance away from center"},random:{_type:"Boolean",_info:"If true, spawn particles randomly along circle",_optional:true},uniformRandom:{_type:"Number",_info:"Only vary slightly along circle. Set intensity between 0-1",_optional:true},particleRotate:{_type:"Boolean",_info:"If true, rotate particle with movement orientation",_optional:true},flipRightParticles:{_type:"Boolean",_info:"If true, flip particles on the right side",_optional:true},alongZ:{_type:"Boolean",
_info:"If true, move particles along z instead of y",_optional:true},offset:{_type:"Offset",_info:"Offset to effect center",_optional:true},rotOffset:{_type:"Offset",_info:"Offset rotated with effect direction",_optional:true},useTargetAngle:{_type:"Boolean",_info:"Align spawning with rotation of target",_optional:true},minSpeed:{_type:"Number",_info:"Minimum amount of speed",_optional:true},maxSpeed:{_type:"Number",_info:"Maximum amount of speed",_optional:true},collision:{_type:"Boolean",_info:"Set to true if particles should not collide with environment",
_optional:true}}}),init:function(a,b){this.parent(a,b);this.minSpeed=b.minSpeed||0;this.maxSpeed=b.maxSpeed||0},spawnVel:function(a,b,c){a.spawnParticle(ig.ENTITY.Particle,b,c)}});ig.EFFECT_ENTRY.DEBRIS_CIRCLE=e.extend({minSpeed:50,maxSpeed:100,minZSpeed:50,maxZSpeed:100,zGravityFactor:0,zBounciness:void 0,_wm:new ig.EffectConfig({particleType:"DeprisParticle",attributes:{numParticles:{_type:"Integer",_info:"Number of particles to be spawned"},duration:{_type:"Number",_info:"Duration of particle spawning"},
clockwise:{_type:"Boolean",_info:"true if particles are to move clockwise",_optional:true},centralAngle:{_type:"Number",_info:"Circle range to spawn. 1=full circle",_default:1},startAngle:{_type:"Number",_info:"Turn angle from which to start relative to view direciton. 0.25=quarter turn",_optional:true},startDist:{_type:"Number",_info:"Start distance away from center"},random:{_type:"Boolean",_info:"If true, spawn particles randomly along circle",_optional:true},uniformRandom:{_type:"Number",_info:"Only vary slightly along circle. Set intensity between 0-1",
_optional:true},particleRotate:{_type:"Boolean",_info:"If true, rotate particle with movement orientation",_optional:true},flipRightParticles:{_type:"Boolean",_info:"If true, flip particles on the right side",_optional:true},alongZ:{_type:"Boolean",_info:"If true, move particales along z instead of y",_optional:true},offset:{_type:"Offset",_info:"Offset to effect center",_optional:true},rotOffset:{_type:"Offset",_info:"Offset rotated with effect direction",_optional:true},useTargetAngle:{_type:"Boolean",
_info:"Align spawning with rotation of target",_optional:true},shadowSize:{_type:"Number",_info:"Size of Shadow",_optional:true},minSpeed:{_type:"Number",_info:"Minimum amount of speed",_optional:true},maxSpeed:{_type:"Number",_info:"Maximum amount of speed",_optional:true},minZSpeed:{_type:"Number",_info:"Minimum amount of z speed",_optional:true},maxZSpeed:{_type:"Number",_info:"Maximum amount of z speed",_optional:true},zGravityFactor:{_type:"Number",_info:"Gravity factor of debris",_optional:true},
zBounciness:{_type:"Number",_info:"Z bounciness of debris",_optional:true},minZVel:{_type:"Number",_info:"mininum zVel when bouncing on Ground",_optional:true},collision:{_type:"Boolean",_info:"Set to true if particles should not collide with environment"}}}),init:function(a,b){this.parent(a,b);this.minSpeed=b.minSpeed||0;this.maxSpeed=b.maxSpeed||0;this.minZSpeed=b.minZSpeed||0;this.maxZSpeed=b.maxZSpeed||0;this.zGravityFactor=b.zGravityFactor||null;if(b.zBounciness!=void 0)this.zBounciness=b.zBounciness;
this.shadowSize=b.shadowSize===void 0?4:b.shadowSize},spawnVel:function(a,b,c){var d=Math.random();c.zVel=this.minZSpeed*d+this.maxZSpeed*(1-d);c.zGravityFactor=this.zGravityFactor;c.zBounciness=this.zBounciness;c.shadowSize=this.shadowSize;a.spawnParticle(ig.ENTITY.DebrisParticle,b,c);delete c.zVel;delete c.zGravityFactor}})});ig.baked=!0;
ig.module("impact.feature.effect.fx.fx-homing").requires("impact.feature.effect.effect-sheet","impact.feature.effect.entities.effect-particle").defines(function(){var b=Vec2.create();sc.HOMING_ROTATE_TYPE={NONE:0,MOVE_DIR:1,AT_TARGET:2};ig.EFFECT_ENTRY.SHOOT_HOMING_PARTICLE=ig.EffectStepBase.extend({_wm:new ig.EffectConfig({particleType:"Particle",attributes:{duration:{_type:"Number",_info:"Time over which to spawn particles"},numParticles:{_type:"Number",_info:"How many homing particles to spawn"},
flyType:{_type:"String",_info:"How particle should fly between targets",_select:ig.FX_HOMING_FLY_TYPE},inverse:{_type:"Boolean",_info:"If true, fly target1->target2. Otherwise fly ftarget2->target1"},offsetRadius:{_type:"NumberVary",_info:"How far particle should fly in normal xy direction"},offRadiusZScale:{_type:"Number",_info:"How to scale radius along Z direction. 1=normal length",_default:1},offsetAngle:{_type:"NumberVary",_info:"Angle variance relative to radius pointing upwards. 1= offset radius will be along half circle"},
target1Vary:{_type:"Number",_info:"Random radial offset from target1 pos in x/y coords",_optional:true},target2Vary:{_type:"Number",_info:"Random radial offset from target1 pos in x/y coords",_optional:true},phaseDurations:{_type:"NumberArray",_info:"Relative duration for each phase of the fly type. Values must add to 1"},rotateMoveDir:{_type:"String",_info:"How particles should be rotated",_select:sc.HOMING_ROTATE_TYPE}}}),particleData:null,init:function(a,b){this.duration=b.duration||0;this.particleData=
ig.EffectConfig.loadParticleData(a.animSheet,b,a&&a.cacheKey);this.numParticles=b.numParticles||1;this.flyType=b.flyType;this.inverse=b.inverse||false;this.offsetRadius=b.offsetRadius||0;this.offRadiusZScale=b.offRadiusZScale||0;this.offsetAngle=b.offsetAngle||0;this.phaseDurations=b.phaseDurations;this.rotateMoveDir=sc.HOMING_ROTATE_TYPE[b.rotateMoveDir]||sc.HOMING_ROTATE_TYPE.NONE;this.target1Vary=b.target1Vary;this.target2Vary=b.target2Vary},start:function(a){if(this.duration)return{duration:this.duration,
particles:this.numParticles};this._spawnParticles(a,0,this.numParticles)},_spawnParticles:function(a,d,c){for(var e={data:this.particleData,ownerEffect:a,normalXY:0,normalZ:0,phaseDurations:this.phaseDurations,flyType:this.flyType,inverse:this.inverse,rotateMoveDir:this.rotateMoveDir,target1Vary:this.target1Vary,target2Vary:this.target2Vary};d<c;d++){var f=Vec2.assignC(b,0,1);Vec2.rotate(f,(Math.random()-0.5)*Math.PI*this.offsetAngle);e.normalXY=ig.Event.getNumberVary(this.offsetRadius)*f.x;e.normalZ=
ig.Event.getNumberVary(this.offsetRadius)*f.y*this.offRadiusZScale;a.spawnParticle(ig.ENTITY.HomingParticle,null,e)}},update:function(a,b,c){this._spawnParticles(a,b,c)},getDuration:function(){return this.duration+ig.EffectConfig.getParticleBlockTime(this.particleData)}})});ig.baked=!0;
ig.module("impact.feature.effect.fx.fx-light").requires("impact.feature.effect.effect-sheet").defines(function(){function b(a){return a instanceof ig.LightHandle}function a(a){return a instanceof ig.DarknessHandle}function d(a){return a instanceof ig.ScreenFlashHandle}ig.EFFECT_ENTRY.LIGHT=ig.EffectStepBase.extend({size:null,fadeIn:0,fadeOut:0,duration:0,maxAlpha:1,glow:void 0,_wm:new ig.Config({attributes:{size:{_type:"String",_info:"Size of emitting light",_select:ig.LIGHT_SIZE},fadeIn:{_type:"Number",
_info:"Fade in time of light"},fadeOut:{_type:"Number",_info:"Fade out time of light"},duration:{_type:"Number",_info:"Duration of light source. -1=forever"},maxAlpha:{_type:"Number",_info:"Max alpha intensity of light",_optional:true},glow:{_type:"Boolean",_info:"True if light should additionally glow (lighter rendering addition)"},offset:{_type:"Offset",_info:"Offset for light position",_optional:true}}}),init:function(a,b){this.size=ig.LIGHT_SIZE[b.size||"XS"];this.fadeIn=b.fadeIn||0;this.fadeOut=
b.fadeOut||0;this.duration=b.duration||0;this.maxAlpha=b.maxAlpha||1;this.offset=b.offset||null;this.glow=b.glow},start:function(a){a=new ig.LightHandle(a,this.size,this.fadeIn,this.fadeOut,this.duration,this.maxAlpha,this.glow);this.offset&&a.setOffset(this.offset.x,this.offset.y,this.offset.z);ig.light.addLightHandle(a)},getDuration:function(){return this.duration>=0?this.duration+this.fadeIn+this.fadeOut:0}});ig.EFFECT_ENTRY.CLEAR_LIGHT=ig.EffectStepBase.extend({_wm:new ig.Config({attributes:{}}),
init:function(){},start:function(a){a.clearEntityAttached(b)},getDuration:function(){return 0}});ig.EFFECT_ENTRY.DARKNESS=ig.EffectStepBase.extend({fadeIn:0,fadeOut:0,duration:0,intensity:1,_wm:new ig.Config({attributes:{fadeIn:{_type:"Number",_info:"Fade in time of darkness"},fadeOut:{_type:"Number",_info:"Fade out time of darkness"},duration:{_type:"Number",_info:"Duration of darkness. -1=forever"},intensity:{_type:"Number",_info:"Intensity of darkness"}}}),init:function(a,b){this.fadeIn=b.fadeIn||
0;this.fadeOut=b.fadeOut||0;this.duration=b.duration||0;this.intensity=b.intensity||1},start:function(a){var b=new ig.DarknessHandle;b.setTemporary(a,this.intensity,this.duration,this.fadeIn,this.fadeOut);ig.light.addDarknessHandle(b)},getDuration:function(){return this.duration>=0?this.duration+this.fadeIn+this.fadeOut:0}});ig.EFFECT_ENTRY.CLEAR_DARKNESS=ig.EffectStepBase.extend({_wm:new ig.Config({attributes:{}}),init:function(){},start:function(b){b.clearEntityAttached(a)},getDuration:function(){return 0}});
ig.EFFECT_ENTRY.SCREEN_FLASH=ig.EffectStepBase.extend({color:null,fadeIn:0,fadeOut:0,duration:0,intensity:1,_wm:new ig.Config({attributes:{color:{_type:"String",_info:"Color of screenflash"},fadeIn:{_type:"Number",_info:"Fade in time of darkness"},fadeOut:{_type:"Number",_info:"Fade out time of darkness"},duration:{_type:"Number",_info:"Duration of darkness. -1=forever"}}}),init:function(a,b){this.color=b.color||null;this.fadeIn=b.fadeIn||0;this.fadeOut=b.fadeOut||0;this.duration=b.duration||0},start:function(a){a=
new ig.ScreenFlashHandle(a,this.color,this.fadeIn,this.fadeOut,this.duration);ig.light.addScreenFlashHandle(a)},getDuration:function(){return this.duration>=0?this.duration+this.fadeIn+this.fadeOut:0}});ig.EFFECT_ENTRY.CLEAR_SCREEN_FLASH=ig.EffectStepBase.extend({_wm:new ig.Config({attributes:{}}),init:function(){},start:function(a){a.clearEntityAttached(d)},getDuration:function(){return 0}})});ig.baked=!0;
ig.module("impact.feature.effect.fx.fx-line").requires("impact.feature.effect.effect-sheet").defines(function(){ig.EFFECT_ENTRY.COPY_SPRITE=ig.EffectStepBase.extend({particleData:null,color:null,colorAlpha:1,offset:{x:0,y:0,z:0},_wm:new ig.EffectConfig({particleType:"CopyParticle",attributes:{color:{_type:"String",_info:"Color to combine with sprite copy.",_optional:true},colorAlpha:{_type:"String",_info:"Alpha of pverlay color",_optional:true},fadeColor:{_type:"String",_info:"Sprite color will fade to this color towards end of display",
_optional:true},offset:{_type:"Offset",_info:"offset of particle to target",_optional:true},noLighter:{_type:"Boolean",_info:"If true, don't apply lighter color but regular color overlay"}}}),init:function(b,a){this.particleData=ig.EffectConfig.loadParticleData(null,a,b&&b.cacheKey);this.particleData.particleDuration=this.particleData.particleDuration||1;this.color=a.color||null;this.colorAlpha=a.colorAlpha||1;this.fadeColor=a.fadeColor||null;this.offset=a.offset||this.offset;this.noLighter=a.noLighter||
false},start:function(b){b.spawnParticle(ig.ENTITY.CopyParticle,null,{entity:b.target,color:this.color,fadeColor:this.fadeColor,colorAlpha:this.colorAlpha,data:this.particleData,offset:this.offset,spriteFilter:b.spriteFilter,noLighter:this.noLighter})}});ig.EFFECT_ENTRY.LASER_SPRITE=ig.EffectStepBase.extend({particleData:null,_wm:new ig.EffectConfig({particleType:"LaserParticle",attributes:{pattern:{_type:"TileSheet",_info:"Pattern to be used for animation. Will be repeated in y direction",_popup:true},
patternYCount:{_type:"Integer",_info:"How many tiles in y dimension",_default:1},animFrames:{_type:"AnimFrames",_info:"Frames of sheet animation",_optional:true},frameTime:{_type:"Number",_info:"Time per frame (in seconds)"},shiftSpeed:{_type:"Number",_info:"Speed by which gfx will be shifted along laser direction (pixels per second)"},offset:{_type:"Offset",_info:"offset of particle to target",_optional:true},guiSprites:{_type:"Boolean",_info:"If true, display laser as gui sprite"},renderMode:{_type:"String",
_info:"Render mode of Sprite",_optional:true,_select:["source-over","lighter"],optional:true}}}),init:function(b,a){this.particleData=ig.EffectConfig.loadParticleData(null,a,b&&b.cacheKey);this.particleData.particleDuration=this.particleData.particleDuration||1;this.patternSheet=new ig.ImagePatternSheet(a.pattern.src,ig.ImagePattern.OPT.REPEAT_Y,a.pattern.width,a.pattern.height,a.pattern.offX,a.pattern.offY,a.pattern.xCount||1,a.patternYCount||1);this.animFrames=a.animFrames||[0];this.frameTime=a.frameTime||
0.1;this.shiftSpeed=a.shiftSpeed||0;this.offset=a.offset||null;this.guiSprites=a.guiSprites;this.renderMode=a.renderMode},clearCached:function(){this.patternSheet&&this.patternSheet.decreaseRef()},start:function(b){b.spawnParticle(ig.ENTITY.LaserParticle,null,{data:this.particleData,ownerEffect:b,patternSheet:this.patternSheet,animFrames:this.animFrames,frameTime:this.frameTime,shiftSpeed:this.shiftSpeed,offset:this.offset,guiSprites:this.guiSprites,renderMode:this.renderMode})}})});ig.baked=!0;
ig.module("impact.feature.effect.fx.fx-rhombus").requires("impact.feature.effect.effect-sheet").defines(function(){var b=Vec3.create(),a={};ig.EFFECT_ENTRY.PARTICLE_RHOMBUS=ig.EffectStepBase.extend({particleData:null,duration:0,numParticles:0,scale:0,radiusSub:0,offset:{x:0,y:0,z:0},moveDistance:0,moveVariance:0,randomDirFlip:false,keySpline:null,alongZ:null,zRange:0,_wm:new ig.EffectConfig({particleType:"RhombusParticle",attributes:{numParticles:{_type:"Number",_info:"Amount of particles to spawn per 32 pixel line length and second",
_default:1},duration:{_type:"Number",_info:"Duration in which to spawn particles"},scale:{_type:"Number",_info:"How much of the entity bounds should be covered. 0.5= half of the bounds are covered. 1.0=all the bounds",_optional:true},radiusSub:{_type:"Number",_info:"Number of pixel substracted from radius",_optional:true},moveDistance:{_type:"Number",_info:"Move distance of particles in pixels"},moveVariance:{_type:"Number",_info:"Move variance in pixels. Added +- to distance",_optional:true},randomDirFlip:{_type:"Boolean",
_info:"If true, randomly flip direction of particle",_optional:true},zRange:{_type:"Number",_info:"zRange randomly added to zPos when spawing",_optional:true},keySpline:{_type:"String",_info:"Keyspline of particle movement",_select:KEY_SPLINES},alongZ:{_type:"Boolean",_info:"If true, move particles along z instead of y",_optional:true},offset:{_type:"Offset",_info:"Offset to effect center",_optional:true}}}),init:function(a,b){this.particleData=ig.EffectConfig.loadParticleData(a.animSheet,b,a&&a.cacheKey);
this.duration=b.duration||0;this.scale=b.scale||0;this.radiusSub=b.radiusSub||0;b.offset&&Vec3.assign(this.offset,b.offset);this.numParticles=b.numParticles||2;this.moveDistance=b.moveDistance||1;this.moveVariance=b.moveVariance||0;this.keySpline=KEY_SPLINES[b.keySpline]||null;this.alongZ=b.Boolean||false;this.randomDirFlip=b.randomDirFlip||false;this.zRange=b.zRange||0},start:function(a){if(a.target){a=a.target.coll.size.x;if(!(a<0)){var a=a/2*this.scale-this.radiusSub,b=4*Math.sqrt(a*a+a*a);return{duration:this.duration,
particles:Math.round(this.numParticles*b/32*this.duration),radius:a,rhombusLength:b}}}},getDuration:function(){return this.duration+ig.EffectConfig.getParticleBlockTime(this.particleData)},update:function(d,c,e,f){a.data=this.particleData;a.radius=f.radius;a.alongZ=this.alongZ;for(a.keySpline=this.keySpline;c<e;++c){var g=Vec3.assign(b,this.offset);g.z=g.z+Math.floor(this.zRange*Math.random());a.startFactor=Math.random();a.moveFactor=(this.moveDistance+(2*Math.random()-1)*this.moveVariance)/f.rhombusLength;
this.randomDirFlip&&Math.random()>=0.5&&(a.moveFactor=-a.moveFactor);d.spawnParticle(ig.ENTITY.RhombusParticle,g,a)}}})});ig.baked=!0;
ig.module("impact.feature.effect.fx.fx-wipe").requires("impact.feature.effect.effect-sheet").defines(function(){var b=Vec3.create();ig.EFFECT_ENTRY.MOVE_OFFSET=ig.EffectStepBase.extend({_wm:new ig.Config({attributes:{start:{_type:"Offset",_info:"Offset at start"},end:{_type:"Offset",_info:"Offset at end"},relative:{_type:"Boolean",_info:"If true, multiply each offset with size of entity"},duration:{_type:"Number",_info:"Duration of wipe."},keySpline:{_type:"String",_info:"Keyspline of movement",_select:KEY_SPLINES}}}),
init:function(a,b){this.startValue=b.start;this.endValue=b.end;this.relative=b.relative||false;this.duration=b.duration||0;this.keySpline=KEY_SPLINES[b.keySpline]||KEY_SPLINES.EASE_IN_OUT},getDuration:function(){return this.duration},start:function(a){if(a.target){a={duration:0};a.duration=this.duration;return a}},update:function(a,d,f){if(a.target){d=this.keySpline.get(Math.min(1,d/f));d=Vec3.lerp(this.startValue,this.endValue,d,b);this.relative&&Vec3.mul(d,a.target.coll.size);this.setEntityOffset(a.target,
d,a.spriteFilter)}},finish:function(){},setEntityOffset:function(a,b,d){for(var g=a.sprites,h=g.length;h--;){var i=g[h];d!==null&&d.indexOf(h)==-1||Vec3.assign(i.tmpOffset,b)}a=a.coll.subColls;if(a.length>0)for(h=a.length;h--;)this.setEntityOffset(a[h].entity,b,d)}});ig.EFFECT_ENTRY.WIPE=ig.EffectStepBase.extend({dir:0,startValue:0,endValue:0,duration:0,_wm:new ig.Config({attributes:{dir:{_type:"String",_info:"Wipe direction",_select:ig.WIPE_DIRECTION},startValue:{_type:"Number",_info:"Start wipe position (0-1). 1=all wiped away."},
endValue:{_type:"Number",_info:"End wipe position (0-1). 1=all wiped away."},duration:{_type:"Number",_info:"Duration of wipe."},setOnlyOneSide:{_type:"Boolean",_info:"If true, do not set clipping for any other side. This allows running wipes in parallel."}}}),init:function(a,b){this.dir=ig.WIPE_DIRECTION[b.dir]||ig.WIPE_DIRECTION.NORTH;this.startValue=b.startValue||0;this.endValue=b.endValue||0;this.duration=b.duration||0;this.setOnlyOneSide=b.setOnlyOneSide||0},getDuration:function(){return this.duration},
start:function(a){if(a.target){var b={duration:0,left:-1E3,right:-1E3,top:-1E3,bottom:-1E3};ig.EntityTools.getSpriteBounds(b,a.target);b.duration=this.duration;return b}},update:function(a,b,d,g){if(a.target){var h=a.target.coll,i=h.pos.x-g.left,j=h.pos.x+g.right,k=h.pos.y-h.pos.z-g.top,g=h.pos.y-h.pos.z+g.bottom,b=Math.min(1,b/d),b=this.startValue+b*(this.endValue-this.startValue);switch(this.dir){case ig.WIPE_DIRECTION.NORTH:k=k+b*(g-k);break;case ig.WIPE_DIRECTION.SOUTH:g=g-b*(g-k)}this.setEntityClipping(a.target,
i,j,k,g,a.spriteFilter,this.setOnlyOneSide?this.dir:null)}},finish:function(a){this.endValue==0&&ig.EntityTools.clearEntitySpriteCut(a.target,this.setOnlyOneSide?this.dir:null)},setEntityClipping:function(a,b,d,g,h,i,j){for(var k=a.sprites,l=k.length;l--;){var o=k[l];if(!(i!==null&&i.indexOf(l)==-1)){var m=Math.round(Math.max(0,g-(o.pos.y-o.pos.z-o.size.z))),n=Math.round(Math.max(0,o.pos.y-o.pos.z+o.size.y-h));if(j){if(j!=ig.WIPE_DIRECTION.NORTH)m=o.gfxCut.top;if(j!=ig.WIPE_DIRECTION.SOUTH)n=o.gfxCut.bottom}o.setGfxCut(m,
n)}}a=a.coll.subColls;if(a.length>0)for(l=a.length;l--;)this.setEntityClipping(a[l].entity,b,d,g,h,i,j)}});var a={},d={},b=Vec3.create();ig.EFFECT_ENTRY.WIPE_PARTICLES=ig.EffectStepBase.extend({particleData:null,dir:0,startValue:0,endValue:0,duration:0,numParticles:0,moveOffset:Vec2.create(),keySpline:null,inverse:false,_wm:new ig.EffectConfig({particleType:"OffsetParticle",attributes:{dir:{_type:"String",_info:"Wipe direction",_select:ig.WIPE_DIRECTION},startValue:{_type:"Number",_info:"Start wipe position (0-1). 1=all wiped away."},
endValue:{_type:"Number",_info:"End wipe position (0-1). 1=all wiped away."},duration:{_type:"Number",_info:"Duration of wipe."},numParticles:{_type:"Integer",_info:"Number of particles to spawned per second and 32 pixel target width"},moveOffset:{_type:"Vec2",_info:"Move offset of individual particles",_optional:true},inverse:{_type:"Boolean",_info:"True if particle should move in reverse",_optional:true},xScale:{_type:"Number",_info:"How much of the x dimension should be covered. 1=full",_optional:true},
keySpline:{_type:"String",_info:"KeySpline for moveOffset movement.",_select:KEY_SPLINES,_optional:true},offset:{_type:"Offset",_info:"Offset to position",_optional:true}}}),init:function(a,b){this.particleData=ig.EffectConfig.loadParticleData(a.animSheet,b,a&&a.cacheKey);this.dir=ig.WIPE_DIRECTION[b.dir]||ig.WIPE_DIRECTION.NORTH;this.startValue=b.startValue||0;this.endValue=b.endValue||0;this.duration=b.duration||0;this.xScale=b.xScale;if(this.xScale===void 0)this.xScale=0.8;this.offset=b.offset;
this.numParticles=b.numParticles||2;b.moveOffset&&Vec2.assign(this.moveOffset,b.moveOffset);this.keySpline=KEY_SPLINES[b.keySpline]||null;this.inverse=b.inverse||false},start:function(b){if(b.target){ig.EntityTools.getSpriteBounds(a,b.target);b=a.left+a.right;return{duration:this.duration,particles:this.numParticles*b/32*this.duration,offX:-a.left,offY:a.bottom,width:b,height:a.top+a.bottom}}},getDuration:function(){return this.duration+ig.EffectConfig.getParticleBlockTime(this.particleData)},update:function(a,
e,f,g){d.data=this.particleData;d.keySpline=this.keySpline;d.inverse=this.inverse;d.alongZ=true;for(d.moveOffset=this.moveOffset;e<f;++e){var h=g.particles>1?e/(g.particles-1):0,h=this.startValue+h*(this.endValue-this.startValue);this.dir==ig.WIPE_DIRECTION.NORTH&&(h=1-h);var i=Vec3.assignC(b,0,0,0);if(this.inverse){var j=ig.EffectConfig.getParticleDuration(this.particleData);i.z=i.z+g.height*j/this.duration}i.x=i.x+(g.offX+g.width*(0.5-this.xScale/2)+Math.random()*g.width*this.xScale);i.y=i.y+g.offY;
i.z=i.z+h*g.height;this.offset&&Vec3.add(i,this.offset);a.spawnParticle(ig.ENTITY.OffsetParticle,i,d,true)}}})});ig.baked=!0;
ig.module("impact.feature.effect.plug-in").requires("impact.feature.effect.entities.effect-previewer","impact.feature.effect.effect-sheet","impact.feature.effect.effect-steps","impact.feature.effect.fx.fx-basic","impact.feature.effect.fx.fx-box","impact.feature.effect.fx.fx-color","impact.feature.effect.fx.fx-circle","impact.feature.effect.fx.fx-homing","impact.feature.effect.fx.fx-light","impact.feature.effect.fx.fx-line","impact.feature.effect.fx.fx-rhombus","impact.feature.effect.fx.fx-wipe").defines(function(){window.wm&&
wm.postLoadModules.push("impact.feature.effect.editors.effect-editor")});ig.baked=!0;
ig.module("impact.feature.gui.gui").requires("impact.base.image","impact.base.game","impact.feature.storage.storage").defines(function(){function b(a,b){return a.zIndex-b.zIndex}function a(a,b){switch(a.align.x){case ig.GUI_ALIGN.X_LEFT:return a.pos.x;case ig.GUI_ALIGN.X_RIGHT:return b-a.size.x-a.pos.x;case ig.GUI_ALIGN.X_CENTER:return Math.floor(b/2-a.size.x/2+a.pos.x)}return 0}function d(a,b){switch(a.align.y){case ig.GUI_ALIGN.Y_TOP:return a.pos.y;case ig.GUI_ALIGN.Y_BOTTOM:return b-a.size.y-a.pos.y;
case ig.GUI_ALIGN.Y_CENTER:return Math.floor(b/2-a.size.y/2+a.pos.y)}return 0}function c(a){for(var b=0;b<a.length;++b){a[b].gui.varsChanged&&a[b].gui.varsChanged();c(a[b].children)}}function e(a,b){if(b!=a._visible){a._visible=b;if(a.gui.onVisibilityChange)a.gui.onVisibilityChange(b)}}function f(b,c){var e=c.parentHook,g;if(e instanceof ig.Gui){b.active=c.pauseGui||!ig.game.paused;g=ig.system.width;e=ig.system.height}else{f(b,e);b.x=b.x+e.scroll.x;b.y=b.y+e.scroll.y;g=e.size.x;e=e.size.y}b.x=b.x+
a(c,g);b.y=b.y+d(c,e)}ig.perf.gui=true;var g=[],h=[],i=ig.Class.extend({drawSteps:[],addGfx:function(a,b,c,d,e,f,g,h,i){return this.addDraw().setGfx(a,b,c,d,e,f,g,h,i)},addGfxTile:function(a,b,c,d,e,f,g,h){return this.addDraw().setGfxTile(a,b,c,d,e,f,g,h)},addVideo:function(a,b,c,d,e){return this.addDraw().setVideo(a,b,c,d,e)},addGameStateDraw:function(a,b,c){return this.addDraw().setGameStateDraw(a,b,c)},addColor:function(a,b,c,d,e){return this.addDraw().setColor(a,b,c,d,e)},addPattern:function(a,
b,c,d,e,f,g){return this.addDraw().setPattern(a,b,c,d,e,f,g)},addText:function(a,b,c){return this.addDraw().setText(a,b,c)},clearDrawSteps:function(){for(;this.drawSteps.length;){var a=this.drawSteps.pop();a&&a.kill()}},addDraw:function(){var a=k.get(ig.GuiDrawable);this.drawSteps.push(a);return a},addTransform:function(){var a=k.get(ig.GuiTransform);this.drawSteps.push(a);return a},undoTransform:function(){this.drawSteps.push(null)},draw:function(){for(var a=ig.system,b=a.context,c=a.scale,d=0,e=
0,f=this.drawSteps,g=f.length,i=0;i<g;++i){var j=f[i];if(j)if(j.draw)j.draw(d,e);else{if(j.transform){h.push(j);if(j.isComplex()){j.transform(d,e);d=e=0}else{d=d+a.getDrawPos(j.translate.x)/c;e=e+a.getDrawPos(j.translate.y)/c}if(j.alpha!=1){j.preAlpha=b.globalAlpha;b.globalAlpha=b.globalAlpha*j.alpha}}}else{j=h.pop();if(!j)throw Error("Gui Draw: tried to undo non existing transform. Too many undos?");if(j.isComplex()){b.restore();d=j.prePos.x;e=j.prePos.y}else{d=d-a.getDrawPos(j.translate.x)/c;e=
e-a.getDrawPos(j.translate.y)/c}if(j.alpha!=1)b.globalAlpha=j.preAlpha}}if(h.length>0)throw Error("Exited gui draw with transform remaining. Forgot to undo transform");}}),j=0;ig.Gui=ig.GameAddon.extend({guiHooks:[],namedGuiElements:{},screenBlocked:false,renderer:new i,mouseListenerHooks:[],controlModule:null,init:function(){this.parent("GUI");ig.storage.register(this)},setControlModule:function(a){this.controlModule=a},onStorageSave:function(a){var b={},c;for(c in this.namedGuiElements){var d=this.namedGuiElements[c].hook.mapGuiInfo;
b[c]={settings:d.settings,type:d.type}}a.gui=b},onStoragePreLoad:function(a){this.onReset();var a=a.gui,b;for(b in a){var c=a[b];if(!ig.GUI[c.type]||!ig.GUI[c.type]._noGuiSave){c=this.createEventGui(b,c.type,c.settings,true);this.spawnEventGui(c)}}},deferredUpdateOrder:500,onDeferredUpdate:function(){this.screenBlocked=false;this.renderer.clearDrawSteps();this._updateGuiMouse();j=0;this._updateRecursive(0,0,ig.system.width,ig.system.height,g,true,this.guiHooks,0,0,1,true);ig.game.mapRenderingBlocked=
this.screenBlocked},postDrawOrder:500,onPostDraw:function(){ig.perf.gui&&this.renderer.draw()},onVarsChanged:function(){c(this.guiHooks)},clearNamedGuiElements:function(){for(var a in this.namedGuiElements)this.namedGuiElements[a].remove();this.namedGuiElements={}},onReset:function(){this.clearNamedGuiElements();for(var a=this.guiHooks.length;a--;)if(this.guiHooks[a].temporary){this.guiHooks[a].onDetach();this.guiHooks.splice(a,1)}},logGUIArray:function(){console.groupCollapsed("GUI Array Elements:");
for(var a in ig.GUI)ig.GUI[a]&&console.log(a);console.groupEnd()},createEventGui:function(a,b,c,d){var e=ig.GUI[b];if(!e)return null;e=new e(c);e.hook.mapGuiInfo={name:a,type:b,settings:c,free:d||false};return e},spawnEventGui:function(a){var b=a.hook.mapGuiInfo,c=ig.GUI[b.type];b.name&&(this.namedGuiElements[b.name]=a);if(c.spawnHandler){a.hook.removeAfterTransition=false;c.spawnHandler(a)}else this.addGuiElement(a)},freeEventGui:function(a){if(a)a.hook.parentHook?a.hook.mapGuiInfo.free=true:a.clearCached&&
a.clearCached()},addGuiElement:function(a){a=a.hook;a.removeAfterTransition=false;if(this.guiHooks.indexOf(a)==-1){this.guiHooks.push(a);this.guiHooks.sort(b);a.onAttach(this)}},sortGui:function(){this.guiHooks.sort(b)},removeGuiElement:function(a){this.guiHooks.erase(a.hook)},_updateGuiMouse:function(){var a,b;if(this.controlModule){a=this.controlModule.getMouseX();b=this.controlModule.getMouseY()}else{a=ig.input.mouse.x;b=ig.input.mouse.y}for(var c=null,d=this.controlModule&&this.controlModule.getGuiClick(),
e=0;e<this.mouseListenerHooks.length;++e){var g=this.mouseListenerHooks[e];if(g._visible){if(!g.screenCoords){g.screenCoords={x:0,y:0,w:g.size.x,h:g.size.y,active:false,zIndex:0};f(g.screenCoords,g)}var h=g.screenCoords;if(h.active){var i=false;if(i=g.gui.isMouseOver?g.gui.isMouseOver():h.x<=a&&h.x+h.w>a&&h.y<=b&&h.y+h.h>b)if(c)if(c.screenCoords.zIndex<g.screenCoords.zIndex){c.mouseOver=false;c.gui.onMouseInteract&&c.gui.onMouseInteract(false,false);c=g}else i=false;else c=g;if(!i){g.mouseOver=i;
g.gui.onMouseInteract&&g.gui.onMouseInteract(false,false)}}}}if(c){c.mouseOver=true;c.gui.onMouseInteract&&c.gui.onMouseInteract(true,d)}},_updateRecursive:function(b,c,f,g,h,i,k,q,s,v,y){for(var u=h.length>0,z=false,D=0;D<k.length;++D){var C,A,B,w;if(u){C=h[h.length-4];A=h[h.length-3];B=h[h.length-2];w=h[h.length-1]}var x=k[D],E=y&&(k!=this.guiHooks||x.pauseGui||!ig.game.paused);if(E&&x.updateState()){x.onDetach();k.splice(D,1);D--;if(x.mapGuiInfo){var G=x.mapGuiInfo.name;G&&this.namedGuiElements[G]==
x.gui&&delete this.namedGuiElements[x.mapGuiInfo.name];x.mapGuiInfo.free&&x.gui.clearCached&&x.gui.clearCached()}}else{var J=E;if(E&&(x._visible||x.invisibleUpdate)){J=false;x.gui.update()}var I=x.size.x,K=x.size.y,H=b,M=c,L=q,N=s,H=H+a(x,f),M=M+d(x,g),F=x.currentState,O=v*F.alpha;if(F.alpha==1&&x.screenBlocking)ig.gui.screenBlocked=true;H=H+(x.align.x==ig.GUI_ALIGN.X_RIGHT?-F.offsetX:F.offsetX);M=M+(x.align.y==ig.GUI_ALIGN.Y_BOTTOM?-F.offsetY:F.offsetY);L=L+H;N=N+M;if((G=i&&O>0.01&&F.scaleX!=0&&
F.scaleY!=0)&&u){C=C-H;A=A-M;if(F.scaleX!=1||F.scaleY!=1||F.angle!=0){C=C-x.pivot.x;A=A-x.pivot.y;C=C/Math.abs(F.scaleX);A=A/Math.abs(F.scaleY);C=C+x.pivot.x;A=A+x.pivot.y;B=B/Math.abs(F.scaleX);w=w/Math.abs(F.scaleY)}G=!(0>=C+B||0>=A+w||I<=C||K<=A)}if(x.screenCoords){j++;x.screenCoords.x=L;x.screenCoords.y=N;x.screenCoords.w=x.size.x;x.screenCoords.h=x.size.y;x.screenCoords.active=E;x.screenCoords.zIndex=j;if(u){if(C>0){x.screenCoords.x=x.screenCoords.x+C;x.screenCoords.w=x.screenCoords.w-C}if(A>
0){x.screenCoords.y=x.screenCoords.y+A;x.screenCoords.h=x.screenCoords.h-A}x.screenCoords.w=Math.min(x.screenCoords.w,B+(C<0?C:0));x.screenCoords.h=Math.min(x.screenCoords.h,w+(A<0?A:0))}}J&&G&&x.gui.update();if(x._subState.subtreeTransition||G||x._visible||x.invisibleUpdate){J=this.renderer.addTransform();J.setTranslate(H,M);J.setScale(F.scaleX,F.scaleY);J.setPivot(x.pivot.x,x.pivot.y);J.setRotate(F.angle);J.setAlpha(O);x.clip&&J.setClip(x.size.x,x.size.y);H=x.clip;if(G&&(u||H))if(H)if(u){var M=
Math.max(C,0),F=Math.max(A,0),J=Math.min(C+B,I),P=Math.min(A+w,K);h.push(M,F,J-M,P-F)}else h.push(0,0,I,K);else h.push(C,A,B,w);e(x,G);if(G&&x.localAlpha>0){x.localAlpha!=1&&this.renderer.addTransform().setAlpha(x.localAlpha);x.gui.updateDrawables(this.renderer);x.localAlpha!=1&&this.renderer.undoTransform()}E=this._updateRecursive(x.scroll.x,x.scroll.y,I,K,h,G,x.children,L,N,O,E);x._subState.subtreeTransition=x.hasTransition()||E;z=z||x._subState.subtreeTransition;if(G&&(u||H))h.length=h.length-
4;this.renderer.undoTransform()}}}return z},_drawRecursive:function(a,b,c,d,e){for(var f=ig.system.context,g=0;g<e.length;++g){var h=e[g],i=a,j=b;switch(h.align.x){case ig.GUI_ALIGN.X_LEFT:i=i+h.pos.x;break;case ig.GUI_ALIGN.X_RIGHT:i=i+(c-h.size.x-h.pos.x);break;case ig.GUI_ALIGN.X_CENTER:i=i+Math.floor(c/2-h.size.x/2+h.pos.x)}switch(h.align.y){case ig.GUI_ALIGN.Y_TOP:j=j+h.pos.y;break;case ig.GUI_ALIGN.Y_BOTTOM:j=j+(d-h.size.y-h.pos.y);break;case ig.GUI_ALIGN.Y_CENTER:j=j+Math.floor(d/2-h.size.y/
2+h.pos.y)}var k=h.currentState;if(h._visible){var i=i+(h.align.x==ig.GUI_ALIGN.X_RIGHT?-k.offsetX:k.offsetX),j=j+(h.align.y==ig.GUI_ALIGN.Y_BOTTOM?-k.offsetY:k.offsetY),u=f.globalAlpha,z=u*k.alpha,D=z*h.localAlpha,C=false;if(h.clip||k.scaleX!=1||k.scaleY!=1||k.angle!=0){C=true;f.save();f.translate(ig.system.getDrawPos(i),ig.system.getDrawPos(j));i=j=0;if(h.clip){f.beginPath();f.rect(0,0,h.size.x,h.size.y);f.clip()}if(k.scaleX!=1||k.scaleY!=1||k.angle!=0){f.translate(ig.system.getDrawPos(h.pivot.x),
ig.system.getDrawPos(h.pivot.y));f.rotate(k.angle);f.scale(k.scaleX,k.scaleY);f.translate(-ig.system.getDrawPos(h.pivot.x),-ig.system.getDrawPos(h.pivot.y))}}k=h.drawables;if(D>0&&k.length>0){if(u!=D)f.globalAlpha=D;for(var A=0;A<k.length;++A)k[A].draw(i,j);if(D!=z)f.globalAlpha=z}else if(u!=z)f.globalAlpha=z;this._drawRecursive(h.scroll.x+i,h.scroll.y+j,h.size.x,h.size.y,h.children);if(u!=z)f.globalAlpha=u;C&&ig.system.context.restore()}}},_addMouseListenerHook:function(a){this.mouseListenerHooks.push(a)},
_removeMouseListenerHook:function(a){this.mouseListenerHooks.erase(a)}});ig.addGameAddon(function(){return ig.gui=new ig.Gui});ig.GUI={};ig.GUI_ALIGN={};ig.GUI_ALIGN.Y_TOP=1;ig.GUI_ALIGN.Y_CENTER=2;ig.GUI_ALIGN.Y_BOTTOM=3;ig.GUI_ALIGN.X_LEFT=4;ig.GUI_ALIGN.X_CENTER=5;ig.GUI_ALIGN.X_RIGHT=6;ig.GUI_ALIGN_X={LEFT:ig.GUI_ALIGN.X_LEFT,RIGHT:ig.GUI_ALIGN.X_RIGHT,CENTER:ig.GUI_ALIGN.X_CENTER};ig.GUI_ALIGN_Y={TOP:ig.GUI_ALIGN.Y_TOP,BOTTOM:ig.GUI_ALIGN.Y_BOTTOM,CENTER:ig.GUI_ALIGN.Y_CENTER};ig.GuiHook=ig.Class.extend({pos:Vec2.create(),
size:{x:1,y:1},pivot:{x:0,y:0},scroll:{x:0,y:0},align:{x:ig.GUI_ALIGN.X_LEFT,y:ig.GUI_ALIGN.Y_TOP},parentHook:null,children:[],mouseRecord:false,screenCoords:null,mouseOver:false,localAlpha:1,zIndex:0,pauseGui:false,invisibleUpdate:false,screenBlocking:false,stateCallback:null,clip:false,temporary:false,transitions:{DEFAULT:{state:{},time:0.5,timeFunction:KEY_SPLINES.EASE}},gui:null,currentState:{offsetX:0,offsetY:0,alpha:1,scaleX:1,scaleY:1,angle:0},currentStateName:"",anim:{targetState:null,initState:null,
timer:0,maxTime:0,timeFunction:null},removeAfterTransition:false,posTransition:null,scrollTransition:null,_visible:false,_subState:{subtreeTransition:false},mapGuiInfo:null,drawSteps:[],init:function(a){this.gui=a;if(a.transitions){this.transitions=a.transitions;this.doStateTransition("DEFAULT",true)}},setMouseRecord:function(a){if(this.mouseRecord!=a){this.mouseRecord=a;this.parentHook&&(a?ig.gui._addMouseListenerHook(this):ig.gui._removeMouseListenerHook(this))}},onAttach:function(a){if(this.parentHook!=
a){this.parentHook=a;e(this,a instanceof ig.Gui?true:a._visible);this.mouseRecord&&ig.gui._addMouseListenerHook(this);this.gui.onAttach&&this.gui.onAttach();for(a=this.children.length;a--;)this.children[a].onAttach(this)}},onDetach:function(){if(this.parentHook){if(this.mouseRecord){this.screenCoords=null;ig.gui._removeMouseListenerHook(this)}for(var a=this.children.length;a--;)this.children[a].onDetach();this.gui.onDetach&&this.gui.onDetach();this.parentHook=null}},getChildGuiIndex:function(a){return this.children.indexOf(a)},
getChildGuiByIndex:function(a){return this.children[a]},addChildHook:function(a){a.removeAfterTransition=false;this.children.erase(a);a.onDetach();this.children.push(a);this.parentHook&&a.onAttach(this)},insertChildHook:function(a,b){a.removeAfterTransition=false;this.children.erase(a);a.onDetach();this.children.splice(b,0,a);this.parentHook&&a.onAttach(this)},removeChildHook:function(a){a.removeAfterTransition=false;this.children.erase(a);a.onDetach()},removeChildHookByIndex:function(a){a=this.children.splice(a,
1)[0];a.removeAfterTransition=false;a.onDetach();return a},removeAllChildren:function(){for(var a=this.children.length;a--;){this.children[a].onDetach();this.children[a].removeAfterTransition=false}this.children.length=0},doStateTransition:function(a,b,c,d,e){var f=this.transitions[a];if(!f)throw Error("No Transition found with name: "+a);if(!this.removeAfterTransition){this.removeAfterTransition=c||false;this.stateCallback=null;if(!b)for(var g=this.parentHook;g&&g!=ig.gui;){g._subState.subtreeTransition=
true;g=g.parentHook}if(this.currentStateName==a){if(d)this.stateCallback=d;this.anim.timer=Math.max(this.anim.timer,b?f.time:0-(e||0))}else{this.currentStateName=a;this._setStateData(f.state,f.time,f.timeFunction,b,c,d,e)}}},getStateTransitionProgress:function(){return!this.anim.maxTime?1:Math.min(1,this.anim.timer/this.anim.maxTime)},doTempStateTransition:function(a,b,c,d,e,f,g){if(!this.removeAfterTransition){this.removeAfterTransition=e||false;this.currentStateName=null;this._setStateData(a,b,
c,d,e,f,g)}},setScale:function(a,b){this.currentState.scaleX=a;this.currentState.scaleY=b},_setStateData:function(a,b,c,d,e,f,g){if(f)this.stateCallback=f;this.anim.initState=ig.copy(this.currentState);var e={offsetX:0,offsetY:0,alpha:1,scaleX:1,scaleY:1,angle:0},h;for(h in a)e[h]=a[h];this.anim.targetState=e;this.anim.maxTime=b;this.anim.timer=d?b:0-(g||0);this.anim.timeFunction=c;if(d)this.currentState=ig.copy(e)},doPosTranstition:function(a,b,c,d,e,f,g){f&&(c=Math.max(c,this.posTransition?this.posTransition.time-
this.posTransition.timer:0));if(!c||c<=0){this.pos.x=a;this.pos.y=b;this.posTransition=null}else this.posTransition={startX:this.pos.x,startY:this.pos.y,x:a,y:b,time:c,timeFunction:d||KEY_SPLINES.EASE_IN_OUT,timer:0-(e||0),endCallback:g}},getPosTransitionProgress:function(){return!this.posTransition?1:this.posTransition.timeFunction.get(this.posTransition.timer/this.posTransition.time)},doScrollTransition:function(a,b,c,d,e){if(!c||c<=0||Math.abs(a-this.scroll.x)<ig.COLLISION.EPS&&Math.abs(b-this.scroll.y)<
ig.COLLISION.EPS){this.scroll.x=a;this.scroll.y=b;this.scrollTransition=null}else this.scrollTransition={startX:this.scroll.x,startY:this.scroll.y,x:a,y:b,time:c,timeFunction:d||KEY_SPLINES.EASE_IN_OUT,timer:0,endCallback:e||null}},hasTransition:function(){return!!this.anim.targetState},getTransitionFactor:function(){return(this.anim.timer/this.anim.maxTime).limit(0,1)},setStateValue:function(a,b,c){this.transitions[a]&&(this.transitions[a].state[b]=c)},updateState:function(){if(this.posTransition){this.posTransition.timer=
this.posTransition.timer+ig.system.actualTick;var a=Math.min(1,Math.max(0,this.posTransition.timer)/this.posTransition.time),a=this.posTransition.timeFunction.get(a);this.pos.x=this.posTransition.startX*(1-a)+this.posTransition.x*a;this.pos.y=this.posTransition.startY*(1-a)+this.posTransition.y*a;if(a==1){this.posTransition.endCallback&&this.posTransition.endCallback();this.posTransition=null}}if(this.scrollTransition){this.scrollTransition.timer=this.scrollTransition.timer+ig.system.actualTick;a=
Math.min(1,this.scrollTransition.timer/this.scrollTransition.time);a=this.scrollTransition.timeFunction.get(a);this.scroll.x=this.scrollTransition.startX*(1-a)+this.scrollTransition.x*a;this.scroll.y=this.scrollTransition.startY*(1-a)+this.scrollTransition.y*a;if(a==1){a=this.scrollTransition.endCallback;this.scrollTransition=null;a&&a()}}if(this.anim.targetState){this.anim.timer=this.anim.timer+ig.system.actualTick;var a=(this.anim.timer/this.anim.maxTime).limit(0,1),a=this.anim.timeFunction.get(a),
b;for(b in this.anim.targetState)this.currentState[b]=(1-a)*this.anim.initState[b]+a*this.anim.targetState[b];if(a==1){this.anim.targetState=null;if(this.stateCallback){a=this.stateCallback;this.stateCallback=null;a()}}else return false}return this.removeAfterTransition}});ig.GuiDrawable=ig.Class.extend({pos:{x:0,y:0},size:{x:0,y:0},src:{x:0,y:0},gfxSource:null,gfxType:0,flip:{x:false,y:false},alpha:1,compositionMode:"source-over",setPos:function(a,b){this.pos.x=a;this.pos.y=b;return this},setSize:function(a,
b){this.size.x=a;this.size.y=b;return this},setSrc:function(a,b){this.src.x=a;this.src.y=b;return this},setAlpha:function(a){this.alpha=a;return this},setColor:function(a,b,c,d,e){this.gfxSource=a;this.gfxType=3;this.setPos(b,c);this.setSize(d,e);return this},setCompositionMode:function(a){this.compositionMode=a||"source-over";return this},setGfx:function(a,b,c,d,e,f,g,h,i){if(window.IG_GAME_DEBUG&&!(a instanceof ig.Image||a instanceof ig.ImageAtlasFragment))throw Error("Invalid setGfx Call. gfx is not instance of ig.Image");
this.gfxSource=a;this.gfxType=1;this.setPos(b,c);this.setSrc(d,e);this.setSize(f,g);this.flip.x=h||false;this.flip.y=i||false;return this},setGfxTile:function(a,b,c,d,e,f,g,h){if(window.IG_GAME_DEBUG&&!(a instanceof ig.Image))throw Error("Invalid setGfxTile Call. gfx is not instance of ig.Image");f=f?f:e;this.setGfx(a,b,c,Math.floor(d*e)%a.width,Math.floor(d*e/a.width)*f,e,f,g,h);return this},setVideo:function(a,b,c,d,e){if(window.IG_GAME_DEBUG&&!(a instanceof ig.Video))throw Error("Invalid setVideo Call. video is not instance of ig.Video");
this.gfxSource=a;this.gfxType=5;this.setPos(b,c);this.setSize(d,e);return this},setGameStateDraw:function(a,b,c){if(window.IG_GAME_DEBUG&&!(a instanceof ig.GameState))throw Error("Invalid setGameStateDraw Call. gamestate is not instance of ig.GameState");this.gfxSource=a;this.gfxType=6;this.setPos(b,c);return this},setPattern:function(a,b,c,d,e,f,g){if(window.IG_GAME_DEBUG&&!(a instanceof ig.ImagePattern))throw Error("Invalid setPattern Call. gfx is not instance of ig.ImagePattern");this.gfxSource=
a;this.gfxType=2;this.color=this.gfx=null;this.setPos(b,c);this.setSrc(d,e);this.setSize(f,g);return this},setText:function(a,b,c){if(window.IG_GAME_DEBUG&&!(a instanceof ig.TextBlock))throw Error("Invalid setText Call. gfx is not instance of ig.TextBlock");this.gfxSource=a;this.gfxType=4;this.setPos(b,c);return this},draw:function(a,b){var c=ig.system,d=c.context,e=c.scale,f=a+this.pos.x,g=b+this.pos.y,h,i;if(this.alpha!=1){h=d.globalAlpha;d.globalAlpha=d.globalAlpha*this.alpha}if(this.compositionMode!=
"source-over"){i=d.globalCompositeOperation;d.globalCompositeOperation=this.compositionMode}if(this.gfxType==3){d.fillStyle=this.gfxSource;d.fillRect(c.getDrawPos(f),c.getDrawPos(g),this.size.x*e,this.size.y*e)}else this.gfxType==1?this.gfxSource.draw(f,g,this.src.x,this.src.y,this.size.x,this.size.y,this.flip.x,this.flip.y):this.gfxType==5?this.gfxSource.draw(f,g,this.size.x,this.size.y):this.gfxType==6?this.gfxSource.forceDraw(f,g):this.gfxType==2?this.gfxSource.draw(f,g,this.src.x,this.src.y,this.size.x,
this.size.y):this.gfxType==4&&this.gfxSource.draw(f,g);if(d.globalCompositeOperation!="source-over")d.globalCompositeOperation=i;if(this.alpha!=1)d.globalAlpha=h},kill:function(){this.gfxSource=null;this.gfxType=0;k.free(this)},clear:function(){this.alpha=1;this.src.x=this.src.y=this.size.x=this.size.y=void 0;this.flip.x=this.flip.y=false;this.compositionMode="source-over"}});ig.GuiTransform=ig.Class.extend({translate:{x:0,y:0},scale:{x:1,y:1},rotate:0,pivot:{x:0,y:0},alpha:1,clip:{x:0,y:0},prePos:{x:0,
y:0},preAlpha:0,setAlpha:function(a){this.alpha=a;return this},setClip:function(a,b){this.clip.x=a;this.clip.y=b;return this},setTranslate:function(a,b){this.translate.x=a;this.translate.y=b;return this},setScale:function(a,b){this.scale.x=a;this.scale.y=b;return this},setRotate:function(a){this.rotate=a;return this},setPivot:function(a,b){this.pivot.x=a;this.pivot.y=b;return this},isComplex:function(){return this.scale.x!=1||this.scale.y!=1||this.rotate||this.clip.x!=0},transform:function(a,b){var c=
ig.system,d=c.context,c=c.scale;d.save();this.prePos.x=a;this.prePos.y=b;d.translate(ig.system.getDrawPos(a+this.translate.x),ig.system.getDrawPos(b+this.translate.y));if(this.clip.x!=0){d.beginPath();d.rect(0,0,this.clip.x*c,this.clip.y*c);d.clip()}if(this.scale.x!=1||this.scale.y!=1||this.rotate!=0){d.translate(ig.system.getDrawPos(this.pivot.x),ig.system.getDrawPos(this.pivot.y));d.rotate(this.rotate);d.scale(this.scale.x||1E-4,this.scale.y||1E-4);d.translate(-ig.system.getDrawPos(this.pivot.x),
-ig.system.getDrawPos(this.pivot.y))}},kill:function(){k.free(this)},clear:function(){this.translate.x=this.translate.y=0;this.scale.x=this.scale.y=1;this.rotate=0;this.pivot.x=this.pivot.y=0;this.alpha=1;this.clip.x=this.clip.y=0}});ig.GuiStepPool=ig.Class.extend({get:function(a){if(!a.poolEntries)a.poolEntries=[];if(a.poolEntries.length){a=a.poolEntries.pop();a.clear();return a}return new a},free:function(a){var b=a.constructor;if(!b.poolEntries)b.poolEntries=[];b.poolEntries.push(a)}});var k=new ig.GuiStepPool;
ig.GuiElementBase=ig.Class.extend({hook:null,init:function(){this.hook=new ig.GuiHook(this)},setPos:function(a,b){var c=this.hook;c.pos.x=a||0;c.pos.y=b||0;c.posTransition=null},getDestPos:function(){var a=this.hook;return a.posTransition||a.pos},setScroll:function(a,b){var c=this.hook;c.scroll.x=a;c.scroll.y=b;c.scrollTransition=null},getDestScroll:function(){var a=this.hook;return a.scrollTransition||a.scroll},setSize:function(a,b){var c=this.hook;c.size.x=a;c.size.y=b},setPivot:function(a,b){var c=
this.hook;c.pivot.x=a;c.pivot.y=b},setAlign:function(a,b){var c=this.hook;c.align.x=a;c.align.y=b},isVisible:function(){return this.hook._visible},getChildGuiIndex:function(a){return this.hook.getChildGuiIndex(a.hook)},getChildGuiByIndex:function(a){return this.hook.getChildGuiByIndex(a)},addChildGui:function(a){this.hook.addChildHook(a.hook)},insertChildGui:function(a,b){this.hook.insertChildHook(a.hook,b)},removeChildGui:function(a){this.hook.removeChildHook(a.hook)},removeChildGuiByIndex:function(a){return this.hook.removeChildHookByIndex(a).gui},
removeAllChildren:function(){this.hook.removeAllChildren()},update:function(){},updateDrawables:function(){},remove:function(a){if(a){this.hook.onDetach();this.hook.removeAfterTransition=false}else this.hook.removeAfterTransition=true},onAttach:null,onDetach:null,onVisibilityChange:null,isMouseOver:null,hide:function(){},show:function(){},doStateTransition:function(a,b,c,d,e){this.hook.doStateTransition(a,b,c,d,e)},doTempStateTransition:function(a,b,c,d,e,f,g){this.hook.doTempStateTransition(a,b,
c,d,e,f,g)},doPosTranstition:function(a,b,c,d,e,f,g){this.hook.doPosTranstition(a,b,c,d,e,f,g)},doScrollTransition:function(a,b,c,d,e){this.hook.doScrollTransition(a,b,c,d,e)},hasTransition:function(){return this.hook.hasTransition()},getTransitionFactor:function(){return this.hook.getTransitionFactor()},setStateValue:function(a,b,c){this.hook.setStateValue(a,b,c)}})});ig.baked=!0;
ig.module("impact.feature.gui.gui-images").requires("impact.base.image","impact.base.game","impact.feature.gui.gui","impact.feature.storage.storage").defines(function(){ig.GuiImageContainer=ig.GuiElementBase.extend({init:function(b){this.parent();this.hook.zIndex=b;this.setSize(ig.system.width,ig.system.height)}});ig.GuiImage=ig.GameAddon.extend({guiImages:{},containerBelowGui:null,containerOverGui:null,init:function(){this.parent("GUI");ig.storage.register(this);this.containerBelowGui=new ig.GuiImageContainer(-30);
ig.gui.addGuiElement(this.containerBelowGui);this.containerOverGui=new ig.GuiImageContainer(51);ig.gui.addGuiElement(this.containerOverGui)},showImage:function(b,a,d,c,e,f,g){this.removeImage(b);a=new ig.ImageGui(a.image,a.offX,a.offY,a.width,a.height);a.setAlign(ig.GUI_ALIGN_X[c],ig.GUI_ALIGN_Y[e]);a.renderMode=f||null;a.doTempStateTransition(this._createGuiState(d),0,KEY_SPLINES.LINEAR,true);d={gui:a,data:{alignX:c,alignY:e,state:d}};g?this.containerOverGui.addChildGui(a):this.containerBelowGui.addChildGui(a);
this.guiImages[b]=d},moveImage:function(b,a,d,c,e){var f=this.guiImages[b];if(f){f.data.state=a;f.gui.doTempStateTransition(this._createGuiState(a),d,c,false,e);e&&delete this.guiImages[b]}},removeImage:function(b){var a=this.guiImages[b];if(a){a.gui.remove();delete this.guiImages[b]}},_createGuiState:function(b){return{alpha:b.alpha,offsetX:b.offsetX,offsetY:b.offsetY,scaleX:b.scaleX,scaleY:b.scaleY,angle:b.angle}},onStorageSave:function(){},onStoragePreLoad:function(){},onReset:function(){for(var b in this.guiImages)this.removeImage(b)}});
ig.addGameAddon(function(){return ig.guiImage=new ig.GuiImage})});ig.baked=!0;
ig.module("impact.feature.gui.gui-steps").requires("impact.base.action","impact.base.event","impact.feature.gui.gui").defines(function(){ig.EVENT_STEP.ADD_GUI=ig.EventStepBase.extend({name:null,guiInfo:null,guiElement:null,_wm:new ig.Config({attributes:{name:{_type:"String",_info:"Name to identify GUI for subsequent modifications (e.g. removal)",_optional:true},guiInfo:{_type:"GUI",_info:"Type and Settings of GUI to spawn",_popup:true}}}),init:function(b){this.name=b.name;this.guiInfo=b.guiInfo;if(!window.wm)this.guiElement=
ig.gui.createEventGui(this.name,this.guiInfo.type,this.guiInfo.settings)},start:function(){if(this.name){var b=ig.gui.namedGuiElements[this.name];b&&b.remove()}ig.gui.spawnEventGui(this.guiElement)},clearCached:function(){ig.gui.freeEventGui(this.guiElement)}});ig.EVENT_STEP.REMOVE_GUI=ig.EventStepBase.extend({name:null,guiInfo:null,_wm:new ig.Config({attributes:{name:{_type:"String",_info:"Name of GUI to be removed"}}}),init:function(b){assertContent(b,"name");this.name=b.name},start:function(){var b=
ig.gui.namedGuiElements[this.name];b&&b.remove()}});ig.EVENT_STEP.CHANGE_GUI_STATE=ig.EventStepBase.extend({name:null,guiState:null,immediate:false,remove:false,_wm:new ig.Config({attributes:{name:{_type:"String",_info:"Name to identify GUI for subsequent modifications (e.g. removal)"},guiState:{_type:"GUIState",_info:"Transition to change to"},immediate:{_type:"Boolean",_info:"If true: skip transition"},remove:{_type:"Boolean",_info:"Remove GUI after transition"}}}),init:function(b){assertContent(b,
"name","guiState");this.name=b.name;this.guiState=b.guiState;this.immediate=b.immediate||false;this.remove=b.remove||false},start:function(){var b=ig.gui.namedGuiElements[this.name];if(b){if(!(b instanceof ig.GUI[this.guiState.type]))throw Error("Gui State transition with invalid GUI type!");b.doStateTransition(this.guiState.state,this.immediate,this.remove)}}});ig.EVENT_STEP.SHOW_IMAGE=ig.EventStepBase.extend({name:null,image:null,guiState:null,alignX:null,alignY:null,renderMode:null,overGui:false,
_wm:new ig.Config({attributes:{name:{_type:"String",_info:"Name of image"},image:{_type:"TileSheet",_info:"Image to be displayed",_popup:true},guiState:{_type:"GuiState",_info:"Initial State of image",_popup:true},alignX:{_type:"String",_info:"X alignment",_select:ig.GUI_ALIGN_X},alignY:{_type:"String",_info:"Y alignment",_select:ig.GUI_ALIGN_Y},renderMode:{_type:"String",_info:"Render Mode if Image",_select:["source-over","lighter"],_optional:true},overGui:{_type:"Boolean",_info:"If true, display image above game hud (e.g. cut scene bars, portraits)"}}}),
init:function(b){this.name=b.name;this.image=new ig.TileSheet.createFromJson(b.image);this.guiState=b.guiState;this.alignX=b.alignX;this.alignY=b.alignY;this.renderMode=b.renderMode;this.overGui=b.overGui||false},start:function(){ig.guiImage.showImage(this.name,this.image,this.guiState,this.alignX,this.alignY,this.renderMode,this.overGui)},clearCached:function(){this.image.clearCached()}});ig.EVENT_STEP.MOVE_IMAGE=ig.EventStepBase.extend({name:null,guiState:null,time:null,keySpline:null,removeAfterwards:false,
_wm:new ig.Config({attributes:{name:{_type:"String",_info:"Name of image"},guiState:{_type:"GuiState",_info:"Initial State of image",_popup:true},time:{_type:"Number",_info:"Transition time"},keySpline:{_type:"String",_info:"Key spline for transition",_select:KEY_SPLINES},removeAfterwards:{_type:"Boolean",_info:"True if image should be removed after transition"}}}),init:function(b){this.name=b.name;this.guiState=b.guiState;this.time=b.time||0.1;this.keySpline=KEY_SPLINES[b.keySpline]||KEY_SPLINES.LINEAR;
this.removeAfterwards=b.removeAfterwards||false},start:function(){ig.guiImage.moveImage(this.name,this.guiState,this.time,this.keySpline,this.removeAfterwards)}});ig.EVENT_STEP.REMOVE_IMAGE=ig.EventStepBase.extend({name:null,_wm:new ig.Config({attributes:{name:{_type:"String",_info:"Name of image to be removed"}}}),init:function(b){this.name=b.name},start:function(){ig.guiImage.removeImage(this.name)}})});ig.baked=!0;
ig.module("impact.feature.gui.base.box").requires("impact.feature.gui.gui").defines(function(){ig.NinePatch=ig.Class.extend({tile:{width:0,height:0,top:0,bottom:0,left:0,right:0,offsets:{"default":{x:0,y:0}}},skipTile:{},pattern:{},gfx:null,init:function(b,a){this.tile=a;this.gfx=new ig.Image(b);this.gfx.loaded?this.initPattern():this.gfx.addCallback(this.initPattern.bind(this))},initPattern:function(){var b=this.tile;b.top==0&&(this.skipTile[0]=this.skipTile[1]=this.skipTile[2]=1);b.bottom==0&&(this.skipTile[6]=
this.skipTile[7]=this.skipTile[8]=1);b.left==0&&(this.skipTile[0]=this.skipTile[3]=this.skipTile[6]=1);b.right==0&&(this.skipTile[2]=this.skipTile[5]=this.skipTile[8]=1);b.width==0&&(this.skipTile[1]=this.skipTile[4]=this.skipTile[7]=1);b.height==0&&(this.skipTile[3]=this.skipTile[4]=this.skipTile[5]=1);for(var a in this.tile.offsets){this.pattern[a]={};var d=this.tile.offsets[a].x,c=this.tile.offsets[a].y;if(b.top>0&&b.width>0)this.pattern[a].top=this.gfx.createPattern(d+b.left,c,b.width,b.top,ig.ImagePattern.OPT.REPEAT_X);
if(b.bottom>0&&b.width>0)this.pattern[a].bottom=this.gfx.createPattern(d+b.left,c+b.top+b.height,b.width,b.bottom,ig.ImagePattern.OPT.REPEAT_X);if(b.left>0&&b.height>0)this.pattern[a].left=this.gfx.createPattern(d,c+b.top,b.left,b.height,ig.ImagePattern.OPT.REPEAT_Y);if(b.right>0&&b.height>0)this.pattern[a].right=this.gfx.createPattern(d+b.left+b.width,c+b.top,b.right,b.height,ig.ImagePattern.OPT.REPEAT_Y);if(b.width>0&&b.height>0)this.pattern[a].center=this.gfx.createPattern(d+b.left,c+b.top,b.width,
b.height,ig.ImagePattern.OPT.REPEAT_X_AND_Y)}},draw:function(b,a,d,c,e,f){var g=this.tile,h=g.offsets[c].x,i=g.offsets[c].y,c=this.pattern[c],j=Math.min(g.top,d-g.bottom),e=e||0,f=f||0;this.skipTile[0]||b.addGfx(this.gfx,e,f,h,i,g.left,j);this.skipTile[2]||b.addGfx(this.gfx,e+a-g.right,f,h+g.left+g.width,i,g.right,j);this.skipTile[6]||b.addGfx(this.gfx,e,f+d-g.bottom,h,i+g.top+g.height,g.left,g.bottom);this.skipTile[8]||b.addGfx(this.gfx,e+a-g.right,f+d-g.bottom,h+g.left+g.width,i+g.top+g.height,
g.right,g.bottom);this.skipTile[1]||b.addPattern(c.top,e+g.left,f,0,0,a-g.left-g.right,j);this.skipTile[7]||b.addPattern(c.bottom,e+g.left,f+d-g.bottom,0,0,a-g.left-g.right,g.bottom);this.skipTile[3]||b.addPattern(c.left,e,f+j,0,0,g.left,d-j-g.bottom);this.skipTile[5]||b.addPattern(c.right,e+a-g.right,f+j,0,0,g.right,d-j-g.bottom);this.skipTile[4]||b.addPattern(c.center,e+g.left,f+j,0,0,a-g.left-g.right,d-j-g.bottom)},drawComposite:function(b,a,d,c,e,f,g){var h=this.tile,i=h.offsets[c].x,j=h.offsets[c].y,
c=this.pattern[c],k=Math.min(h.top,d-h.bottom),f=f||0,g=g||0,e=e||"source-over";this.skipTile[0]||b.addGfx(this.gfx,f,g,i,j,h.left,k).setCompositionMode(e);this.skipTile[2]||b.addGfx(this.gfx,f+a-h.right,g,i+h.left+h.width,j,h.right,k).setCompositionMode(e);this.skipTile[6]||b.addGfx(this.gfx,f,g+d-h.bottom,i,j+h.top+h.height,h.left,h.bottom).setCompositionMode(e);this.skipTile[8]||b.addGfx(this.gfx,f+a-h.right,g+d-h.bottom,i+h.left+h.width,j+h.top+h.height,h.right,h.bottom).setCompositionMode(e);
this.skipTile[1]||b.addPattern(c.top,f+h.left,g,0,0,a-h.left-h.right,k).setCompositionMode(e);this.skipTile[7]||b.addPattern(c.bottom,f+h.left,g+d-h.bottom,0,0,a-h.left-h.right,h.bottom).setCompositionMode(e);this.skipTile[3]||b.addPattern(c.left,f,g+k,0,0,h.left,d-k-h.bottom).setCompositionMode(e);this.skipTile[5]||b.addPattern(c.right,f+a-h.right,g+k,0,0,h.right,d-k-h.bottom).setCompositionMode(e);this.skipTile[4]||b.addPattern(c.center,f+h.left,g+k,0,0,a-h.left-h.right,d-k-h.bottom).setCompositionMode(e)}});
ig.BoxGui=ig.GuiElementBase.extend({gfx:{},ninepatch:null,currentTileOffset:"",skipTile:{},flipped:false,flippedY:false,init:function(b,a,d,c){this.parent();this.setSize(b,a);this.flipped=d||false;if(c)this.ninepatch=c;for(var e in this.ninepatch.tile.offsets){this.currentTileOffset=e;break}},setSize:function(b,a){this.hook.size.x=b;this.hook.size.y=a;this.hook.pivot.x=this.hook.size.x/2;this.hook.pivot.y=this.hook.size.y/2},updateDrawables:function(b){this.flipped?b.addTransform().setScale(-1,1).setTranslate(this.hook.size.x,
0):this.flippedY&&b.addTransform().setScale(1,-1).setTranslate(0,this.hook.size.y);this.ninepatch.draw(b,this.hook.size.x,this.hook.size.y,this.currentTileOffset);this.flipped?b.undoTransform():this.flippedY&&b.undoTransform()}})});ig.baked=!0;
ig.module("impact.feature.gui.plug-in").requires("impact.feature.gui.gui","impact.feature.gui.gui-images","impact.feature.gui.gui-steps","impact.feature.gui.base.box").defines(function(){if(window.wm){wm.postLoadModules.push("impact.feature.gui.editors.gui-editor");wm.addStepColorRule(/GUI/,"orange")}});ig.baked=!0;
ig.module("impact.feature.light.light").requires("impact.base.game","game.config").defines(function(){ig.LIGHT_SIZE={XXXXL:1,XXXL:2,XXL:3,XL:4,L:5,M:6,S:7,XS:8,NONE:9};var b={};b[ig.LIGHT_SIZE.XXXXL]={x:0,y:0,w:384,h:384};b[ig.LIGHT_SIZE.XXXL]={x:384,y:0,w:256,h:256};b[ig.LIGHT_SIZE.XXL]={x:448,y:256,w:192,h:192};b[ig.LIGHT_SIZE.XL]={x:0,y:384,w:128,h:128};b[ig.LIGHT_SIZE.L]={x:128,y:448,w:64,h:64};b[ig.LIGHT_SIZE.M]={x:192,y:464,w:48,h:48};b[ig.LIGHT_SIZE.S]={x:240,y:480,w:32,h:32};b[ig.LIGHT_SIZE.XS]=
{x:272,y:480,w:32,h:32};b[ig.LIGHT_SIZE.NONE]={x:272,y:480,w:32,h:32};ig.LIGHT_METRIC=b;Vec3.create();ig.perf.lighting=true;ig.LightHandle=ig.Class.extend({targetEntity:null,lastPos:Vec3.create(),size:null,fadeIn:0,fadeOut:0,duration:0,maxAlpha:0,glow:true,timer:0,offset:null,init:function(a,b,c,e,f,g,h){this.targetEntity=a;this.targetEntity.addEntityAttached(this);this.size=b||ig.LIGHT_SIZE.XS;this.fadeIn=c||0;this.fadeOut=e||0;this.duration=f||0;this.maxAlpha=g||1;this.glow=h!==void 0?h:true;this.timer=
this.fadeIn||this.duration||this.fadeOut},setOffset:function(a,b,c){if(!this.offset)this.offset=Vec3.create();Vec3.assignC(this.offset,a,b,c)},onActionEndDetach:function(){this.stop()},onEntityKillDetach:function(){(this.fadeIn||this.duration)&&this.stop();this.targetEntity&&this.targetEntity.removeEntityAttached(this);this.targetEntity=null},stop:function(){this.timer=this.fadeOut;this.duration=this.fadeIn=0},update:function(){var a=this.targetEntity?this.targetEntity.coll.getTick(true):ig.system.tick;
this.timer=this.timer-a;if(this.timer<=0)if(this.fadeIn){this.fadeIn=0;this.timer=this.duration||this.fadeOut}else if(this.duration){if(this.duration>0){this.duration=0;this.timer=this.fadeOut}}else{this.fadeOut=0;this.targetEntity&&this.targetEntity.removeEntityAttached(this);return true}return false},draw:function(a,d){a=a||1;d=d||0;this.targetEntity&&this.targetEntity.getAlignedPos(ig.ENTITY_ALIGN.CENTER,this.lastPos);var c=this.lastPos,e=c.x-ig.game.screen.x,c=c.y-c.z-ig.game.screen.y;if(this.offset){e=
e+this.offset.x;c=c+(this.offset.y-this.offset.z)}var f=b[this.size+d];if(f){var g=f.x,h=f.y,i=f.w,f=f.h;if(!(e+i/2<0||c+f/2<0||e-i/2>ig.system.width||c-f/2>ig.system.height)){var j=0;this.fadeIn?j=this.maxAlpha*(1-this.timer/this.fadeIn):this.duration?j=this.maxAlpha:this.fadeOut&&(j=this.maxAlpha*(this.timer/this.fadeOut));ig.system.context.globalAlpha=j*a;ig.light.lightmapGfx.draw(e-i/2,c-f/2,g,h,i,f)}}}});ig.DarknessHandle=ig.Class.extend({useActualTick:false,timer:0,temporary:false,entity:null,
duration:0,fadeIn:0,fadeOut:0,oldIntensity:0,targetIntensity:0,init:function(a){this.useActualTick=a||false},setIntensity:function(a,b){this.oldIntensity=this.getIntensity();this.targetIntensity=a;this.timer=this.duration=b;this.temporary=false},setTemporary:function(a,b,c,e,f){this.oldIntensity=this.getIntensity();this.targetIntensity=b;this.temporary=true;(this.entity=a)&&this.entity.addEntityAttached(this);this.duration=c||0;this.fadeIn=e||0;this.fadeOut=f||0;this.timer=this.fadeIn||this.duration||
this.fadeOut},onActionEndDetach:function(){this.stop()},onEntityKillDetach:function(){this.temporary&&(this.fadeIn||this.duration)&&this.stop();this.entity&&this.entity.removeEntityAttached(this);this.entity=null},stop:function(){this.oldIntensity=this.getIntensity();this.timer=this.fadeOut;this.targetIntensity=this.duration=this.fadeIn=0},update:function(){this.timer=this.useActualTick?this.timer-ig.system.actualTick:this.timer-(this.entity?this.entity.coll.getTick(true):ig.system.tick);if(this.timer<=
0&&this.temporary)if(this.fadeIn){this.fadeIn=0;this.timer=this.duration||this.fadeOut}else if(this.duration){if(this.duration>0){this.oldIntensity=this.getIntensity();this.duration=0;this.timer=this.fadeOut;this.targetIntensity=0}}else{this.fadeOut=0;this.entity&&this.entity.removeEntityAttached(this);return true}return false},getIntensity:function(){return this.oldIntensity+(this.targetIntensity-this.oldIntensity)*(this.temporary?this.fadeIn?1-this.timer/this.fadeIn:this.duration?1:1-this.timer/
this.fadeOut:this.timer>0?1-this.timer/this.duration:1)}});ig.ScreenFlashHandle=ig.Class.extend({targetEntity:null,fadeIn:0,fadeOut:0,duration:0,color:null,timer:0,init:function(a,b,c,e,f){this.targetEntity=a;this.targetEntity.addEntityAttached(this);this.color=b||"white";this.fadeIn=c||0;this.fadeOut=e||0;this.duration=f||0;this.timer=this.fadeIn||this.duration||this.fadeOut},onActionEndDetach:function(){this.stop()},onEntityKillDetach:function(){(this.fadeIn||this.duration)&&this.stop();this.targetEntity&&
this.targetEntity.removeEntityAttached(this);this.targetEntity=null},stop:function(){this.timer=this.fadeOut;this.duration=this.fadeIn=0},update:function(){this.timer=this.timer-ig.system.actualTick;if(this.timer<=0)if(this.fadeIn){this.fadeIn=0;this.timer=this.duration||this.fadeOut}else if(this.duration){if(this.duration>0){this.duration=0;this.timer=this.fadeOut}}else{this.fadeOut=0;this.targetEntity&&this.targetEntity.removeEntityAttached(this);return true}return false},draw:function(){var a=
0;this.fadeIn?a=1-this.timer/this.fadeIn:this.duration?a=1:this.fadeOut&&(a=this.timer/this.fadeOut);ig.system.context.globalAlpha=a;ig.system.context.fillStyle=this.color;ig.system.context.fillRect(0,0,ig.system.width,ig.system.height)}});ig.GlowColor=ig.Cacheable.extend({cacheType:"GLOW_COLOR",canvas:null,gfx:null,init:function(a){this.parent(a);var b=ig.$new("canvas"),c=ig.light.lightmapGfx;b.width=c.width*ig.system.scale;b.height=c.height*ig.system.scale;var e=ig.system.getBufferContext(b);e.globalCompositeOperation=
"source-over";e.fillStyle=a;e.fillRect(0,0,b.width,b.height);e.globalCompositeOperation="destination-in";e.drawImage(c.data,0,0);this.canvas=b;this.gfx=new ig.ImageCanvasWrapper(b)},getCacheKey:function(a){return a},onCacheCleared:function(){this.canvas.width=this.canvas.height=0;this.gfx=this.canvas=null}});ig.CondLights=ig.Class.extend({condition:null,lights:[],hasLight:false,hasGlow:false,isOn:false,timer:0,init:function(a){this.condition=a;this.isOn=this.condition.evaluate()},addLight:function(a,
b,c,e){if(c&&!e)e=ig.light.mainGlowColor;this.lights.push({pos:a,lightSize:b,glowSize:c,glowColor:e});if(c)this.hasGlow=true;if(b)this.hasLight=true},update:function(){var a=this.condition.evaluate();if(a!=this.isOn){this.isOn=a;this.timer=0.2-this.timer}if(this.timer){this.timer=this.timer-ig.system.actualTick;if(this.timer<=0)this.timer=0}},getAlpha:function(){var a=this.timer/0.2;return this.isOn?1-a:a},drawGlow:function(){this.hasGlow&&this._draw(true)},drawLight:function(){this.hasLight&&this._draw(false)},
_draw:function(a){var d=this.getAlpha();if(d){var c=ig.system.context.globalAlpha;ig.system.context.globalAlpha=d;for(d=this.lights.length;d--;){var e=this.lights[d],f=e.pos.x-ig.game.screen.x,g=e.pos.y-ig.game.screen.y,h=a?e.glowSize:e.lightSize;if(h){var i=b[h];if(i){var h=i.x,j=i.y,k=i.w,i=i.h;f+k/2<0||(g+i/2<0||f-k/2>ig.system.width||g-i/2>ig.system.height)||(a?e.glowColor.gfx:ig.light.lightmapGfx).draw(f-k/2,g-i/2,h,j,k,i)}}}ig.system.context.globalAlpha=c}}});ig.Light=ig.GameAddon.extend({lightCanvas:null,
lightContext:null,shadowProviders:[],lightHandles:[],darknessHandles:[],screenFlashHandles:[],hasShadow:false,lightMapDarkness:0.6,lightMapBrightness:1,lightmapGfx:new ig.Image("media/map/lightmap.png"),mainGlowColor:false,condLights:{},condLightList:[],init:function(){this.parent("Light");this.lightCanvas=ig.$new("canvas");this.lightCanvas.width=ig.system.contextWidth+1;this.lightCanvas.height=ig.system.contextHeight+1;this.lightContext=ig.system.getBufferContext(this.lightCanvas)},setMainGlowColor:function(a){this.mainGlowColor&&
this.mainGlowColor.decreaseRef();this.mainGlowColor=null;if(a)this.mainGlowColor=new ig.GlowColor(a)},getMainGlowGfx:function(){return this.mainGlowColor&&this.mainGlowColor.gfx},addDarknessHandle:function(a){this.darknessHandles.push(a)},removeDarknessHandle:function(a){this.darknessHandles.erase(a)},addScreenFlashHandle:function(a){this.screenFlashHandles.push(a)},removeScreenFlashHandle:function(a){this.screenFlashHandles.erase(a)},addCondLight:function(a,b,c,e,f){var g=a.toString(),h=this.condLights[g];
if(!h){h=new ig.CondLights(a);this.condLightList.push(h);this.condLights[g]=h}h.addLight(b,c,e,f)},addLightHandle:function(a){this.lightHandles.push(a)},addShadowProvider:function(a){if(this.shadowProviders.indexOf(a)==-1){this.shadowProviders.push(a);this.shadowProviders.sort(function(a,b){return a.shadowOrder-b.shadowOrder})}},removeShadowProvider:function(a){this.shadowProviders.erase(a)},levelLoadStartOrder:0,onLevelLoadStart:function(){this.condLightList.length=0;this.condLights={}},onDeferredUpdate:function(){for(var a=
this.lightHandles.length;a--;)this.lightHandles[a].update()&&this.lightHandles.splice(a,1);for(a=this.darknessHandles.length;a--;)this.darknessHandles[a].update()&&this.darknessHandles.splice(a,1);for(a=this.screenFlashHandles.length;a--;)this.screenFlashHandles[a].update()&&this.screenFlashHandles.splice(a,1);for(a=this.condLightList.length;a--;)this.condLightList[a].update()},preDrawOrder:0,onPreDraw:function(){this.hasShadow=false;if(ig.perf.lighting&&sc.options.get("lighting")){for(var a=1,b=
this.darknessHandles.length;b--;)a=Math.min(a,1-this.darknessHandles[b].getIntensity());if(ig.game.hasLightLayer()||!(this.shadowProviders.length==0&&a==1)){if(ig.system.zoom!=1)ig.system.smoothPositioning=false;var c=ig.system.context;ig.system.context=this.lightContext;this.lightContext.globalAlpha=1;ig.system.context.globalCompositeOperation="source-over";this.lightContext.clearRect(0,0,ig.system.realWidth,ig.system.realHeight);for(b=0;b<this.shadowProviders.length;++b)this.shadowProviders[b].drawShadows();
ig.system.context.globalCompositeOperation="destination-out";for(b=this.condLightList.length;b--;)this.condLightList[b].drawLight();this.lightContext.globalCompositeOperation="source-over";ig.game.renderer.drawLight();if(a<1){this.lightContext.globalAlpha=1-a;this.lightContext.fillStyle="#000008";this.lightContext.fillRect(0,0,ig.system.realWidth,ig.system.realHeight);this.lightContext.globalAlpha=1}this.lightContext.globalCompositeOperation="destination-out";for(b=this.lightHandles.length;b--;)this.lightHandles[b].draw();
if(ig.system.zoom!=1)ig.system.smoothPositioning=true;ig.system.context=c;this.hasShadow=true}}},midDrawOrder:0,onMidDraw:function(){if(ig.perf.lighting&&sc.options.get("lighting")){ig.system.context.globalCompositeOperation="lighter";ig.system.context.globalAlpha=1;for(var a=0;a<this.shadowProviders.length;++a){var b=this.shadowProviders[a];b.drawGlow&&b.drawGlow()}for(a=this.condLightList.length;a--;)this.condLightList[a].drawGlow();if(this.hasShadow){ig.system.context.globalCompositeOperation=
"source-over";ig.system.context.globalAlpha=1;var b=a=0,c=ig.system.contextScale;if(ig.system.smoothPositioning){a=Math.round(ig.game.screen.x*c)/c%1;b=Math.round(ig.game.screen.y*c)/c%1}ig.system.context.drawImage(this.lightCanvas,-a,-b);ig.system.context.globalCompositeOperation="lighter"}if(this.lightHandles.length>0)for(a=this.lightHandles.length;a--;)this.lightHandles[a].glow&&this.lightHandles[a].draw(0.2,1);if(this.screenFlashHandles.length>0)for(a=this.screenFlashHandles.length;a--;)this.screenFlashHandles[a].draw();
ig.system.context.globalCompositeOperation="source-over";ig.system.context.globalAlpha=1}}});ig.addGameAddon(function(){return ig.light=new ig.Light})});ig.baked=!0;
ig.module("impact.feature.light.light-steps").requires("impact.base.action","impact.base.event").defines(function(){Vec3.create();ig.ACTION_STEP.ADD_DARKNESS=ig.EventStepBase.extend({intensity:0,duration:0,fadeIn:0,fadeOut:0,_wm:new ig.Config({attributes:{intensity:{_type:"Number",_info:"Intensity of darkness"},duration:{_type:"Number",_info:"Duration of darkness effect. -1 for continuous effect"},fadeIn:{_type:"Number",_info:"fadeIn duration"},fadeOut:{_type:"Number",_info:"fadeOut duration"}}}),
init:function(b){this.intensity=b.intensity||0;this.duration=b.duration||0;this.fadeIn=b.fadeIn||0;this.fadeOut=b.fadeOut||0},start:function(b){var a=new ig.DarknessHandle;a.setTemporary(b,this.intensity,this.duration,this.fadeIn,this.fadeOut);ig.light.addDarknessHandle(a);b.addActionAttached(a)}});ig.ACTION_STEP.CLEAR_DARKNESS=ig.EventStepBase.extend({_wm:new ig.Config({attributes:{}}),init:function(){},start:function(b){for(var b=b.actionAttached,a=b.length;a--;)if(b[a]instanceof ig.DarknessHandle){b[a].stop();
b.splice(a,1);break}}})});ig.baked=!0;
ig.module("impact.feature.light.light-map").requires("impact.feature.light.light","impact.base.map","impact.base.game","impact.base.image","game.config").defines(function(){ig.MAP.Light=ig.ChunkedMap.extend({lightmapGfx:new ig.Image("media/map/lightmap.png"),_wm:new ig.Config({_label:"Light",_fixSize:ig.CONFIG.DISABLE_LAYER_SIZE,_noRepeat:true,_noMoveSpeed:true,_noDistance:ig.CONFIG.DISABLE_LAYER_DISTANCE,_fixTilesize:ig.CONFIG.DEFAULT_TILE_SIZE,_fixTileset:"media/map/lightmap-tiles.png",_fixLevel:"last",
_icon:"impact/feature/light/editors/layer-icon.png",_alphaActive:1,_alphaInactive:0.4,_alphaEntities:0.5}),lightSources:[],glowSources:[],noMerge:true,lightCanvas:null,shadowOrder:3,init:function(b,a){this.parent(b,a);for(var d=0;d<this.height;++d)for(var c=0;c<this.width;++c)if(this.data[d][c]){var e=0,f=0,g=this.data[d][c],h=(g-1)%32%5+1,i=Math.floor((g-1)%32/5);switch(Math.floor((g-1)/32)){case 1:f=-8;break;case 2:e=8;break;case 3:f=8;break;case 4:e=-8;break;case 5:e=8;f=-8}if(i!=4){var g=ig.LIGHT_METRIC[h],
j=(c+0.5)*this.tilesize+e-g.w/2,k=(d+0.5)*this.tilesize+f-g.h/2;this.lightSources.push({x:j,y:k,tX:g.x,tY:g.y,width:g.w,height:g.h})}if(i>0){g=ig.LIGHT_METRIC[i==4?h:h+i-1];j=(c+0.5)*this.tilesize+e-g.w/2;k=(d+0.5)*this.tilesize+f-g.h/2;this.glowSources.push({x:j,y:k,tX:g.x,tY:g.y,width:g.w,height:g.h})}}ig.light.addShadowProvider(this)},clear:function(){ig.light.removeShadowProvider(this);this.parent()},preRenderChunk:function(b,a,d,c,e){var b=Math.floor(b*this.chunkSizeX/this.tilesize/ig.system.scale),
a=Math.floor(a*this.chunkSizeY/this.tilesize/ig.system.scale),f=ig.system.context;(ig.system.context=ig.system.getBufferContext(e)).globalAlpha=1;b=b*this.tilesize;a=a*this.tilesize;for(e=0;e<this.lightSources.length;e++){var g=this.lightSources[e];g.x>b+d/ig.system.scale||(g.x+g.width<b||g.y>a+c/ig.system.scale||g.y+g.height<a)||this.lightmapGfx.draw(g.x-b,g.y-a,g.tX,g.tY,g.width,g.height)}ig.system.context=f},drawShadows:function(){if(this.preRenderedChunks&&this.preRenderedChunks.length){var b=
ig.system.context,a=ig.light.lightMapDarkness;if(a>0){b.globalAlpha=a;b.globalCompositeOperation="source-over";b.fillStyle=ig.game.clearColor;b.fillRect(0,0,ig.system.realWidth,ig.system.realHeight)}b.globalCompositeOperation="destination-out";b.globalAlpha=ig.light.lightMapBrightness;this._draw()}},drawGlow:function(){var b=ig.system.context,a=this.glowSources.length,d=ig.light.getMainGlowGfx();if(d)for(;a--;){var c=this.glowSources[a],e=c.x-ig.game.screen.x,f=c.y-ig.game.screen.y;if(!(e+c.width<
0||f+c.height<0||e>ig.system.width||f>ig.system.height)){b.globalCompositeOperation="lighter";d.draw(e,f,c.tX,c.tY,c.width,c.height)}}},draw:function(){},drawTiled:function(){}})});ig.baked=!0;
ig.module("impact.feature.weather.clouds").requires("impact.base.game").defines(function(){ig.Clouds=ig.Class.extend({gfx:new ig.Image("media/map/cloud.png"),currentClouds:[],density:0,vel:Vec2.create(),cloudRange:Vec2.create(),timer:0,maxTime:0,alpha:0,shadowOrder:0,init:function(){},clearClouds:function(b){if(b){this.currentClouds=[];ig.light.removeShadowProvider(this)}else for(b=this.currentClouds.length;b--;)this.currentClouds[b].timer=-2;this.density=0},setClouds:function(b,a,d,c){this.clearClouds(c);
this.density=b;Vec2.assign(this.vel,a);this.alpha=d||0.7;this.cloudRange.x=Math.floor(this.gfx.width/Math.sqrt(b));this.cloudRange.y=Math.floor(this.gfx.height/Math.sqrt(b));this.maxTime=(a=Math.abs(this.vel.x)>Math.abs(this.vel.y))?this.cloudRange.x/Math.abs(this.vel.x):this.cloudRange.y/Math.abs(this.vel.y);b=c?0:this.currentClouds.length;for(a=(a?Math.ceil(ig.game.size.x/this.cloudRange.x):Math.ceil(ig.game.size.y/this.cloudRange.y))+1;a--;){d=Math.max(Math.abs(this.vel.x),Math.abs(this.vel.y));
this.moveClouds(this.cloudRange.x*this.vel.x/d,this.cloudRange.y*this.vel.y/d,b,!c);this.spawnCloudLine(c)}ig.light.addShadowProvider(this)},spawnCloudLine:function(b){var a,d,c,e,f,g=Math.abs(this.vel.x)>Math.abs(this.vel.y);if(g){c=this.vel.x;a=ig.game.size.x;e=this.vel.y;d=ig.game.size.y;f=this.cloudRange.y}else{c=this.vel.y;a=ig.game.size.y;e=this.vel.x;d=ig.game.size.x;f=this.cloudRange.x}for(a=-a*Math.abs(e)/Math.abs(c);a<d;a=a+f)this.addCloud(g?-this.cloudRange.x:a,g?a:-this.cloudRange.y,b)},
addCloud:function(b,a,d){b=this.vel.x>0?b:ig.game.size.x-b-this.cloudRange.x;a=this.vel.y>0?a:ig.game.size.y-a-this.cloudRange.y;d={x:0,y:0,flipx:Math.random()>0.5,flipY:Math.random()>0.5,timer:d?0:2};d.x=b+Math.random()*(this.cloudRange.x-this.gfx.width);d.y=a+Math.random()*(this.cloudRange.y-this.gfx.height);this.currentClouds.push(d)},moveClouds:function(b,a,d,c){for(var e=this.currentClouds.length;e--;){if(d&&e<d)break;var f=this.currentClouds[e];f.x=f.x+b;f.y=f.y+a;if(!c)if(f.timer>0){f.timer=
f.timer-ig.system.tick;if(f.timer<0)f.timer=0}else if(f.timer<0){f.timer=f.timer+ig.system.tick;if(f.timer>=0){this.currentClouds.splice(e,1);continue}}(this.vel.x<=0&&f.x>ig.game.size.x||this.vel.x<=0&&f.x<this.gfx.width||this.vel.y>=0&&f.y>ig.game.size.y||this.vel.y<=0&&f.y<this.gfx.height)&&this.currentClouds.splice(e,1)}this.currentClouds.length==0&&ig.light.removeShadowProvider(this)},update:function(){if(this.currentClouds.length!=0){this.moveClouds(this.vel.x*ig.system.tick,this.vel.y*ig.system.tick);
if(this.density>0){this.timer=this.timer+ig.system.tick;if(this.timer>=this.maxTime){this.spawnCloudLine();this.timer=this.timer-this.maxTime}}}},drawShadows:function(){if(this.currentClouds.length!=0){var b=ig.system.context.globalAlpha,a=b*this.alpha;ig.system.context.globalAlpha=a;for(var d=this.currentClouds.length,c=ig.game.screen.x,e=ig.game.screen.y,f=ig.system.width,g=ig.system.height,h=this.gfx.width,i=this.gfx.height;d--;){var j=this.currentClouds[d];if(!(j.x>c+f||j.x+h<c||j.y>e+g||j.y+
i<e)){if(j.timer)ig.system.context.globalAlpha=ig.system.context.globalAlpha*(j.timer>0?1-j.timer/2:-j.timer/2);this.gfx.draw(j.x-c,j.y-e,0,0,void 0,void 0,j.flipX,j.flipY);if(j.timer)ig.system.context.globalAlpha=a}}ig.system.context.globalAlpha=b}}})});ig.baked=!0;
ig.module("impact.feature.weather.fog").requires("impact.base.game").defines(function(){var b=Vec2.create();ig.Fog=ig.Class.extend({patterns:new ig.ImagePatternSheet("media/map/fog2.png",ig.ImagePattern.OPT.REPEAT_X_AND_Y,512,512,0,0,1,1),vel:Vec2.create(),scroll:Vec2.create(),alpha:0,prevAlpha:0,timer:0,shadowOrder:1,zoom:0,init:function(){this.zoom=1.4},clearFog:function(a){this.setFog(0,null,this.zoom,a)},setFog:function(a,b,c,e){c=c||1.4;if(c!=this.zoom){this.scroll.x=this.scroll.x+ig.game.screen.x*
this.zoom-ig.game.screen.x*c;this.scroll.y=this.scroll.y+ig.game.screen.y*this.zoom-ig.game.screen.y*c;this.zoom=c}if(e){this.alpha=a;this.timer=0;a==0?ig.light.removeShadowProvider(this):ig.light.addShadowProvider(this)}else if(this.alpha!=a){this.prevAlpha=this.alpha;this.alpha=a;this.timer=2;a>0&&ig.light.addShadowProvider(this)}b&&Vec2.assign(this.vel,b)},update:function(){if(this.timer>0){this.timer=this.timer-ig.system.tick;if(this.timer<=0){this.timer=0;this.alpha==0&&ig.light.removeShadowProvider(this)}}Vec2.addMulF(this.scroll,
this.vel,ig.system.tick)},drawShadows:function(){var a=this.alpha;this.timer>0&&(a=this.alpha+(this.prevAlpha-this.alpha)*(this.timer/2));var d=ig.system.context.globalAlpha;ig.system.context.globalAlpha=a;var a=this.patterns.getPattern(0),c=0,e=0,f=0,g=0;if(this.zoom!=1){e=ig.system.getMapFromScreenPos(b,ig.system.width/2,ig.system.height/2);c=ig.game.screen.x+ig.system.width/2-e.x;e=ig.game.screen.y+ig.system.height/2-e.y}f=(ig.game.screen.x-c)*this.zoom+c;g=(ig.game.screen.y-e)*this.zoom+e;a.draw(0,
0,Math.round(-this.scroll.x+f),Math.round(-this.scroll.y+g),ig.system.width,ig.system.height);ig.system.context.globalAlpha=d}})});ig.baked=!0;
ig.module("impact.feature.weather.rain").requires("impact.base.game","impact.base.entity-pool").defines(function(){ig.RAIN_STRENGTH={NONE:null,DRIZZLE:{pattern:0,move:{x:80,y:320},duration:0.62,wait:0.25,dropsPerSecond:5,fade:0.3,sound:new ig.Sound("media/sound/background/rain.ogg",0.7)},WEAK:{pattern:0,move:{x:80,y:320},duration:0.35,wait:0.15,dropsPerSecond:15,sound:new ig.Sound("media/sound/background/rain.ogg",0.7)},MEDIUM:{pattern:1,move:{x:80,y:320},duration:0.35,wait:0.15,dropsPerSecond:30,
sound:new ig.Sound("media/sound/background/rain.ogg",0.7)},STRONG:{pattern:2,move:{x:80,y:320},duration:0.35,wait:0.15,dropsPerSecond:45,sound:new ig.Sound("media/sound/background/rain-strong.ogg",0.7)},SNOW_WEAK:{pattern:4,move:{x:30,y:75},duration:0.5,wait:0.2,dropsPerSecond:0,sound:null,alpha:0.8,fade:0.1},SNOW_MEDIUM:{pattern:5,move:{x:30,y:75},duration:0.5,wait:0.2,dropsPerSecond:0,sound:null,alpha:0.8,fade:0.1},SANDSTORM_WEAK:{pattern:3,move:{x:320,y:80},duration:0.5,wait:0.2,dropsPerSecond:0,
sound:new ig.Sound("media/sound/background/desert/sandstorm-ambient.ogg",0.6),fade:0.2},SANDSTORM_NERD:{pattern:3,move:{x:256,y:64},duration:0.5,wait:0.2,dropsPerSecond:0,sound:new ig.Sound("media/sound/background/desert/sandstorm-ambient.ogg",0.6),fade:0.2}};ig.RainDropEntity=ig.AnimatedEntity.extend({animSheet:new ig.AnimationSheet({sheet:{src:"media/map/rain-drop.png",width:8,height:8},renderMode:"lighter",SUB:[{name:"default",time:0.05,frames:[0,1,2,3],repeat:false}]}),init:function(a,b,e,f){this.parent(a,
b,e,f);this._initRainDrop(f)},reset:function(a,b,e,f){this.parent(a,b,e,f);this._initRainDrop(f)},_initRainDrop:function(){this.coll.setSize(8,8,0);this.coll.type=ig.COLLTYPE.NONE;this.animState.alpha=0.6;this.initAnimations();this.setCurrentAnim("default",true,null,true,true)},animationEnded:function(){this.kill()}});ig.EntityPool.enableFor(ig.RainDropEntity);var b=0,a=0;ig.Rain=ig.Class.extend({gfx:new ig.ImagePatternSheet("media/map/rain.png",ig.ImagePattern.OPT.REPEAT_X_AND_Y,128,128),strength:ig.RAIN_STRENGTH.NONE,
entries:[],timer:0,dropTimer:0,updateSound:0,currentSound:null,soundHandle:null,init:function(){},setRain:function(a,b){if((this.currentSound&&this.currentSound.group)!=(a&&a.sound&&a.sound.group))this.updateSound=3;this.strength=a;if(b)this.entries.length=0},clearRain:function(a){this.setRain(ig.RAIN_STRENGTH.NONE,a);this.updateSound=3},onReset:function(){this.updateSound=0;this.soundHandle&&this.soundHandle.stop();this.currentSound=this.soundHandle=null},update:function(){if(sc.options.get("weather")){if(ig.ready&&
this.updateSound){this.updateSound--;if(!this.updateSound){this.soundHandle&&this.soundHandle.stop();this.soundHandle=(this.currentSound=this.strength&&this.strength.sound)&&this.currentSound.play(true)}}if(this.strength){for(this.timer=this.timer+ig.system.tick;this.timer>this.strength.wait;){this.spawnRain();this.timer=this.timer-this.strength.wait}if(this.strength.dropsPerSecond){this.dropTimer=this.dropTimer+ig.system.tick;for(var a=1/this.strength.dropsPerSecond;this.dropTimer>a;){this.dropTimer=
this.dropTimer-a;this.spawnRainDrop()}}}this.moveRain()}else if(this.currentSound){this.currentSound=null;this.soundHandle&&this.soundHandle.stop();this.updateSound=1}},spawnRain:function(){var d=Math.random()*0.75+0.25;b=b+d*128;a=a+(1-d)*128;this.entries.push({timer:this.strength.duration,maxTime:this.strength.duration,pos:{x:b,y:a},move:this.strength.move,alpha:this.strength.alpha||0.2,fade:this.strength.fade||0.025,pattern:this.strength.pattern})},spawnRainDrop:function(){if(ig.perf.weather&&
sc.options.get("weather")){var a=10;do{for(var b=ig.game.screen.x+Math.random()*ig.system.width,e=ig.game.screen.y+Math.random()*ig.system.height,f=ig.game.maxLevel;f--;){var g=ig.game.levels[f];if(g.collision&&g.collision.isTileGround(b,e)){a=g.height;g=g.collision.tilesize;b=b+(-(b%g)+Math.random()*(g-8));e=e+(-(e%g)+Math.random()*(g-8));e=e+a;ig.game.spawnEntity(ig.RainDropEntity,b,e,a,{});return}}a--}while(a)}},moveRain:function(){for(var a=this.entries.length;a--;){var b=this.entries[a];b.timer=
b.timer-ig.system.tick;b.timer<=0?this.entries.splice(a,1):Vec2.addMulF(b.pos,b.move,ig.system.tick)}},draw:function(){if(ig.perf.weather&&sc.options.get("weather")){var a=ig.system.context.globalAlpha;ig.system.context.globalCompositeOperation="lighter";for(var b=this.entries.length;b--;){var e=this.entries[b],f=this.gfx.getPattern(e.pattern),g=1;e.timer<e.fade?g=e.timer/e.fade:e.timer>e.maxTime-e.fade&&(g=(e.maxTime-e.timer)/e.fade);g=g*e.alpha;ig.system.context.globalAlpha=a*g;f.draw(0,0,-e.pos.x+
ig.game.screen.x,-e.pos.y+ig.game.screen.y,ig.system.width,ig.system.height)}ig.system.context.globalAlpha=a;ig.system.context.globalCompositeOperation="source-over"}}})});ig.baked=!0;
ig.module("impact.feature.weather.weather").requires("impact.base.game","impact.feature.weather.clouds","impact.feature.weather.fog","impact.feature.weather.rain").defines(function(){ig.perf.weather=true;ig.WEATHER_TYPES={NONE:{lightMapDarkness:0.6},CARGO_HOLD:{particles:[{type:"DARK_DUST",quantity:10}]},DUSTY:{lightMapDarkness:0.6,particles:[{type:"DARK_DUST",quantity:10}],glowColor:"#0f0f0f"},CLOUDY:{blackCorners:{alpha:0.5,time:2,blinkAlpha:0.7},clouds:{density:0.5,vel:{x:60,y:24},alpha:0.4}},
BEFORE_RAIN:{blackCorners:{alpha:0.2,time:2,blinkAlpha:0.3},fog:{alpha:0.3,vel:{x:100,y:40}}},RAINY_WEAK:{whiteCorners:{alpha:0.2,time:2,blinkAlpha:0.3},rain:ig.RAIN_STRENGTH.WEAK,fog:{alpha:0.3,vel:{x:100,y:40}}},RAINY_MEDIUM:{whiteCorners:{alpha:0.25,time:2,blinkAlpha:0.35},rain:ig.RAIN_STRENGTH.MEDIUM,fog:{alpha:0.4,vel:{x:150,y:60}}},RAINY_STRONG:{whiteCorners:{alpha:0.5,time:2,blinkAlpha:0.7},rain:ig.RAIN_STRENGTH.STRONG,fog:{alpha:0.5,vel:{x:225,y:90}}},ROOKIE_HARBOR:{blackCorners:{alpha:0.3,
time:2,blinkAlpha:0.5},clouds:{density:0.3,vel:{x:90,y:36},alpha:0.24},particles:[]},ROOKIE_HARBOR_INNER:{lightMapDarkness:0.6,particles:[{type:"DARK_DUST",quantity:3}],glowColor:"#0f0f0f"},EVO_VILLAGE_INNER:{lightMapDarkness:0.6,particles:[{type:"DARK_DUST",quantity:3}],glowColor:"#1b1c19"},EXPO_SPACE:{blackCorners:{alpha:1,time:2,blinkAlpha:1},lightMapDarkness:0.2,particles:[{type:"BLUE_SQUARES",quantity:15}]},AUTUMN:{blackCorners:{alpha:0.3,time:2,blinkAlpha:0.5},clouds:{density:0.3,vel:{x:90,
y:36},alpha:0.24},particles:[{type:"LEAVES",quantity:6}]},AUTUMN_RAIN_WEAK:{blackCorners:{alpha:0.3,time:2,blinkAlpha:0.5},clouds:{density:0.3,vel:{x:90,y:36},alpha:0.24},rain:ig.RAIN_STRENGTH.WEAK,fog:{alpha:0.3,vel:{x:100,y:40}},particles:[{type:"LEAVES",quantity:8}]},AUTUMN_RAIN_MEDIUM:{blackCorners:{alpha:0.3,time:2,blinkAlpha:0.5},clouds:{density:0.3,vel:{x:90,y:36},alpha:0.24},rain:ig.RAIN_STRENGTH.MEDIUM,fog:{alpha:0.4,vel:{x:150,y:60}},particles:[{type:"LEAVES",quantity:12}]},OLD_HIDEOUT_OUTSIDE:{whiteCorners:{alpha:0.5,
time:2,blinkAlpha:0.7},fog:{alpha:0.7,vel:{x:30,y:10}},lightMapDarkness:0.2,particles:[{type:"WHITE_DUST",quantity:10}],glowColor:"#000b2c"},OLD_HIDEOUT_OUTSIDE_ALT:{whiteCorners:{alpha:0.2,time:2,blinkAlpha:0.3},fog:{alpha:0.8,vel:{x:30,y:10}},lightMapDarkness:0.6,particles:[{type:"WHITE_DUST",quantity:10}],glowColor:"#331251"},OLD_HIDEOUT_INNER:{fog:{alpha:0.7,vel:{x:30,y:10}},lightMapDarkness:0.8,particles:[{type:"DARK_DUST",quantity:10}],glowColor:"#302313"},OLD_HIDEOUT_OFFICE:{fog:{alpha:0.7,
vel:{x:30,y:10}},lightMapDarkness:0.8,particles:[{type:"DARK_DUST",quantity:10}],glowColor:"#302313"},RHOMBUS_DNG_TOP:{blackCorners:{alpha:0.5,time:2,blinkAlpha:0.7},particles:[{type:"BLUE_SQUARES",quantity:10}]},RHOMBUS_DUNGEON:{blackCorners:{alpha:0.3,time:2,blinkAlpha:0.5},particles:[{type:"BLUE_SQUARES",quantity:10}],glowColor:"#101112"},CAVE:{fog:{alpha:0.7,vel:{x:30,y:10}},lightMapDarkness:0.8,particles:[{type:"DARK_DUST",quantity:10}]},CAVE_BERGEN:{fog:{alpha:0.7,vel:{x:30,y:10}},lightMapDarkness:0.8,
particles:[{type:"DARK_DUST",quantity:10}]},BERGEN_SUNNY:{blackCorners:{alpha:0.3,time:2,blinkAlpha:0.5},clouds:{density:0.3,vel:{x:90,y:36},alpha:0.24},particles:[{type:"GREEN_LEAVES",quantity:6}]},BERGEN_SNOW_START:{whiteCorners:{alpha:0.1,time:2,blinkAlpha:0.2},rain:ig.RAIN_STRENGTH.SNOW_WEAK,particles:[{type:"GREEN_LEAVES",quantity:2},{type:"SNOW_FLAKES",quantity:2}]},BERGEN_SNOW:{whiteCorners:{alpha:0.2,time:2,blinkAlpha:0.3},rain:ig.RAIN_STRENGTH.SNOW_MEDIUM,particles:[{type:"SNOW_FLAKES",quantity:6}]},
BERGEN_INNER:{lightMapDarkness:0.6,particles:[{type:"DARK_DUST",quantity:3}],glowColor:"#0f0f0f"},COLD_DUNGEON:{whiteCorners:{alpha:0.2,time:2,blinkAlpha:0.3},fog:{alpha:0.8,vel:{x:30,y:10}},lightMapDarkness:0.5,glowColor:"#021116",particles:[{type:"COLD_CRYSTALS",quantity:6},{type:"DARK_DUST",quantity:10}]},COLD_DUNGEON_DARK:{whiteCorners:{alpha:0.2,time:2,blinkAlpha:0.3},fog:{alpha:0.8,vel:{x:30,y:10}},lightMapDarkness:0.7,glowColor:"#021116",particles:[{type:"COLD_CRYSTALS",quantity:12},{type:"DARK_DUST",
quantity:6}]},COLD_DUNGEON_POST_BOSS:{whiteCorners:{alpha:0.2,time:2,blinkAlpha:0.3},fog:{alpha:0.8,vel:{x:30,y:10}},lightMapDarkness:0.9,glowColor:"#021116",particles:[{type:"COLD_CRYSTALS",quantity:6},{type:"DARK_DUST",quantity:10}]},HEAT_DUSTY:{blackCorners:{alpha:0.4,time:2,blinkAlpha:0.6},particles:[{type:"SAND_OUTSIDE",quantity:12}]},HEAT_PARALLAX:{blackCorners:{alpha:0.4,time:2,blinkAlpha:0.6},particles:[{type:"SAND_OUTSIDE",quantity:12}]},HEAT_SANDSTORM:{blackCorners:{alpha:0.8,time:2,blinkAlpha:0.9},
rain:ig.RAIN_STRENGTH.SANDSTORM_WEAK,fog:{alpha:0.3,vel:{x:240,y:60},zoom:1},particles:[{type:"SANDSTORM",quantity:12}]},HEAT_SANDSTORM_LIGHT:{blackCorners:{alpha:0.4,time:2,blinkAlpha:0.5},rain:ig.RAIN_STRENGTH.SANDSTORM_NERD,fog:{alpha:0.3,vel:{x:120,y:45},zoom:1},particles:[{type:"SAND_OUTSIDE",quantity:12}]},HEAT_GREEN:{blackCorners:{alpha:0.3,time:2,blinkAlpha:0.5},clouds:{density:0.2,vel:{x:90,y:36},alpha:0.24},particles:[{type:"GREEN_LEAVES",quantity:6}]},HEAT_VILLAGE_INNER:{lightMapDarkness:0.6,
particles:[{type:"DARK_DUST",quantity:3}],glowColor:"#0f0f0f"},HEAT_VILLAGE_INNER_DUSTY:{lightMapDarkness:0.6,particles:[{type:"DARK_DUST",quantity:10}],glowColor:"#0f0f0f"},HEAT_DUNGEON:{blackCorners:{alpha:0.3,time:2,blinkAlpha:0.5},fog:{alpha:0.8,vel:{x:5,y:-15}},lightMapDarkness:0.5,glowColor:"#140e08",particles:[{type:"SAND",quantity:16}]},HEAT_DUNGEON_MIDBOSS:{blackCorners:{alpha:0.3,time:2,blinkAlpha:0.5},rain:ig.RAIN_STRENGTH.SANDSTORM_NERD,fog:{alpha:0.8,vel:{x:120,y:45},zoom:1},lightMapDarkness:0.5,
glowColor:"#140e08",particles:[{type:"SANDSTORM",quantity:12}]},HEAT_DUNGEON_COAL:{blackCorners:{alpha:0.3,time:2,blinkAlpha:0.5},fog:{alpha:0.8,vel:{x:5,y:-15}},lightMapDarkness:0.5,glowColor:"#140e08",particles:[{type:"COAL_SPARKS",quantity:16}]},HEAT_DUNGEON_BOSS:{blackCorners:{alpha:0.2,time:1,blinkAlpha:0.7},fog:{alpha:0.8,vel:{x:5,y:-15}},lightMapDarkness:0.5,glowColor:"#140e08",particles:[{type:"COAL_SPARKS_FAST",quantity:30}]},DREAM:{whiteCorners:{alpha:1,time:1,blinkAlpha:0.8}},UNKNOWN_INNER:{blackCorners:{alpha:0.3,
time:2,blinkAlpha:0.5},fog:{alpha:0.8,vel:{x:5,y:-15}},lightMapDarkness:0.5,glowColor:"#4c1221"},OFFICE:{lightMapDarkness:0.6,particles:[],glowColor:"#0f0f0f"},LOBBY:{lightMapDarkness:0.8,glowColor:"#1e3036"},LOBBY_DARK:{lightMapDarkness:1,glowColor:"#1e3036"},FLAT:{lightMapDarkness:0.8,glowColor:"#43392c"},FLAT_DARK:{lightMapDarkness:1,glowColor:"#43392c"},JUNGLE_SUNNY:{blackCorners:{alpha:0.3,time:2,blinkAlpha:0.5},particles:[{type:"JUNGLE_LEAVES",quantity:10}],outside:true},JUNGLE_RAINY_LIGHT:{whiteCorners:{alpha:0.16,
time:2,blinkAlpha:0.25},rain:ig.RAIN_STRENGTH.DRIZZLE,fog:{alpha:0.2,vel:{x:85,y:30},zoom:1},glowColor:"#332a17"},JUNGLE_RAINY:{whiteCorners:{alpha:0.16,time:2,blinkAlpha:0.25},rain:ig.RAIN_STRENGTH.MEDIUM,fog:{alpha:0.2,vel:{x:85,y:30},zoom:1},glowColor:"#332a17"},JUNGLE_INFESTED_PRE:{blackCorners:{alpha:0.3,time:2,blinkAlpha:0.5},lightMapDarkness:0.5,glowColor:"#32133b"},JUNGLE_INFESTED:{fog:{alpha:0.6,vel:{x:85,y:30},zoom:1},lightMapDarkness:0.5,glowColor:"#32133b",particles:[{type:"INFESTED_DUST",
quantity:20}]},CAVE_INFESTED:{fog:{alpha:0.6,vel:{x:30,y:10}},lightMapDarkness:0.6,particles:[{type:"DARK_DUST",quantity:5},{type:"INFESTED_DUST",quantity:10}],glowColor:"#32133b"},JUNGLE_CITY_PRE:{whiteCorners:{alpha:0.16,time:2,blinkAlpha:0.25},rain:ig.RAIN_STRENGTH.DRIZZLE,lightMapDarkness:0.2,fog:{alpha:0.2,vel:{x:85,y:30},zoom:1},glowColor:"#332a17"},JUNGLE_CITY:{whiteCorners:{alpha:0.16,time:2,blinkAlpha:0.25},rain:ig.RAIN_STRENGTH.MEDIUM,fog:{alpha:0.4,vel:{x:85,y:30},zoom:1},glowColor:"#332a17"},
JUNGLE_CITY_INNER:{lightMapDarkness:0.6,particles:[{type:"DARK_DUST",quantity:3}],glowColor:"#2e271a"},JUNGLE_WAVE_TEMPLE:{whiteCorners:{alpha:0.16,time:2,blinkAlpha:0.25},rain:ig.RAIN_STRENGTH.MEDIUM,fog:{alpha:0.4,vel:{x:85,y:30},zoom:1},glowColor:"#173133"},WAVE_DNG_INNER:{blackCorners:{alpha:0.3,time:2,blinkAlpha:0.5},fog:{alpha:0.8,vel:{x:5,y:-15}},lightMapDarkness:0.5,glowColor:"#0a2f29",particles:[{type:"WAVE_DUST",quantity:20}]},WAVE_DNG_INNER_FISH:{blackCorners:{alpha:0.3,time:2,blinkAlpha:0.5},
fog:{alpha:0.8,vel:{x:5,y:-15}},lightMapDarkness:0.8,glowColor:"#0a2f29",particles:[{type:"WAVE_DUST",quantity:20}]},SHOCK_DNG_INNER:{blackCorners:{alpha:0.3,time:2,blinkAlpha:0.5},fog:{alpha:0.8,vel:{x:5,y:-15}},lightMapDarkness:0.5,glowColor:"#220b28",particles:[{type:"INFESTED_DUST",quantity:20}]},TREE_DNG_INNER:{blackCorners:{alpha:0.3,time:2,blinkAlpha:0.5},fog:{alpha:0.8,vel:{x:5,y:-15}},lightMapDarkness:0.5,glowColor:"#0a2f29",particles:[{type:"WAVE_DUST",quantity:20}]},TREE_INNER:{blackCorners:{alpha:0.3,
time:2,blinkAlpha:0.5},fog:{alpha:0.8,vel:{x:5,y:-15}},lightMapDarkness:0.5,glowColor:"#0a2f29",particles:[{type:"DARK_DUST",quantity:20}]},TREE_INNER_INFESTED:{blackCorners:{alpha:0.4,time:2,blinkAlpha:0.5},fog:{alpha:0.8,vel:{x:5,y:-15}},lightMapDarkness:0.5,glowColor:"#0a2f29",particles:[{type:"DARK_DUST",quantity:20},{type:"INFESTED_DUST",quantity:10},{type:"SPOOKY_DUST",quantity:5}]},TREE_DNG_INNER_WAVE:{blackCorners:{alpha:0.3,time:2,blinkAlpha:0.5},fog:{alpha:0.8,vel:{x:5,y:-15}},lightMapDarkness:0.5,
glowColor:"#0a2f29",particles:[{type:"WAVE_DUST",quantity:20}]},TREE_DNG_INNER_SHOCK:{blackCorners:{alpha:0.3,time:2,blinkAlpha:0.5},fog:{alpha:0.8,vel:{x:5,y:-15}},lightMapDarkness:0.5,glowColor:"#220b28",particles:[{type:"WAVE_DUST",quantity:20}]},SPOOKY_INNER:{fog:{alpha:1,vel:{x:20,y:-100},zoom:1},lightMapDarkness:0.7,lightMapBrightness:1,particles:[{type:"SPOOKY_DUST",quantity:20}],glowColor:"#211f1b"},CAVE_FOREST:{fog:{alpha:0.7,vel:{x:30,y:10}},lightMapDarkness:0.8,particles:[{type:"WHITE_DUST",
quantity:10}],glowColor:"#20134c"},CAVE_ARID:{fog:{alpha:0.7,vel:{x:30,y:10}},lightMapDarkness:0.8,particles:[{type:"WHITE_DUST",quantity:10}],glowColor:"#4c121d"},CAVE_ARID_CLOSER:{fog:{alpha:0.7,vel:{x:30,y:10}},lightMapDarkness:0.8,particles:[{type:"ARID_DUST_1",quantity:20}],glowColor:"#371008"},ARID_OUTSIDE:{fog:{alpha:0.6,vel:{x:85,y:30},zoom:1},lightMapDarkness:0.5,glowColor:"#4c121d",particles:[{type:"ARID_DUST_1",quantity:20}]},ARID_INSIDE:{blackCorners:{alpha:0.3,time:2,blinkAlpha:0.5},
fog:{alpha:0.8,vel:{x:5,y:-15}},lightMapDarkness:0.5,glowColor:"#4c1221",particles:[{type:"ARID_DUST_1",quantity:20}]},ARID_ELEVATOR_UP:{blackCorners:{alpha:0.3,time:2,blinkAlpha:0.5},fog:{alpha:0.8,vel:{x:5,y:-15}},lightMapDarkness:0.8,glowColor:"#4c1221",particles:[{type:"ARID_DUST_ELEVATOR_UP",quantity:20}]},ARID_ELEVATOR_DOWN:{blackCorners:{alpha:0.3,time:2,blinkAlpha:0.5},fog:{alpha:0.8,vel:{x:5,y:-15}},lightMapDarkness:0.8,glowColor:"#4c1221",particles:[{type:"ARID_DUST_ELEVATOR_DOWN",quantity:20}]},
ARID_BOSS:{blackCorners:{alpha:0.3,time:2,blinkAlpha:0.5},fog:{alpha:0.8,vel:{x:5,y:-15}},lightMapDarkness:0.8,glowColor:"#4c1221",particles:[{type:"ARID_DUST_FAST",quantity:20}],outside:true},ARID_END_SCENE:{blackCorners:{alpha:0.7,time:2,blinkAlpha:1},fog:{alpha:1,vel:{x:5,y:-15}},lightMapDarkness:0.8,glowColor:"#4c1221",particles:[{type:"ARID_DUST_1",quantity:30}]},ARID_BETWEEN:{blackCorners:{alpha:0.3,time:2,blinkAlpha:0.5},fog:{alpha:0.8,vel:{x:5,y:-15}},lightMapDarkness:0.5,glowColor:"#4c1221",
particles:[]},ARID_DNG_OUTSIDE:{blackCorners:{alpha:0.3,time:2,blinkAlpha:0.5},fog:{alpha:0.8,vel:{x:5,y:-15}},lightMapDarkness:0.5,glowColor:"#4d4032",particles:[]},SAPPHIRE_RIDGE:{whiteCorners:{alpha:0.2,time:2,blinkAlpha:0.3},fog:{alpha:0.8,vel:{x:30,y:10}},lightMapDarkness:0.6,particles:[{type:"WHITE_DUST",quantity:10}],glowColor:"#331251"},SAPPHIRE_RIDGE_BUILDING:{whiteCorners:{alpha:0.2,time:2,blinkAlpha:0.3},fog:{alpha:0.8,vel:{x:30,y:10}},lightMapDarkness:0.6,particles:[{type:"WHITE_DUST",
quantity:10}],glowColor:"#4c3127"},SAPPHIRE_RIDGE_INNER:{fog:{alpha:0.7,vel:{x:5,y:-30}},lightMapDarkness:0.65,particles:[{type:"DARK_DUST",quantity:6}],glowColor:"#302313"},FLASHBACK_OFFICE:{lightMapDarkness:1,particles:[],glowColor:"#0f0f0f",subOverlay:{brightColor:"#534500",darkColor:"rgba(49,0,83,0.4)"},blackCorners:{alpha:1,time:2,blinkAlpha:0.9}},FLASHBACK_HIDEOUT:{lightMapDarkness:1,particles:[{type:"WHITE_DUST",quantity:10}],glowColor:"#411e61",subOverlay:{brightColor:"#532500",darkColor:"rgba(31,0,81,0.4)"},
blackCorners:{alpha:1,time:2,blinkAlpha:0.9}},FLASHBACK_HIDEOUT_INNER:{lightMapDarkness:1,particles:[],glowColor:"#411e61",subOverlay:{brightColor:"#532500",darkColor:"rgba(31,0,81,0.4)"},blackCorners:{alpha:1,time:2,blinkAlpha:0.9}},FLASHBACK_ARID:{lightMapDarkness:1,particles:[{type:"ARID_DUST_1",quantity:20}],glowColor:"#4c121d",subOverlay:{brightColor:"#532500",darkColor:"rgba(31,0,81,0.4)"},blackCorners:{alpha:1,time:2,blinkAlpha:0.9}},FLASHBACK_DIAGRAM:{lightMapDarkness:1,particles:[],glowColor:"#4c121d",
subOverlay:{brightColor:"#251000",darkColor:"rgba(31,0,81,0.2)"},blackCorners:{alpha:1,time:2,blinkAlpha:0.9}},TREE_SPACE:{blackCorners:{alpha:0.4,time:2,blinkAlpha:0.8},lightMapDarkness:0.5,glowColor:"#4c1221",particles:[{type:"RHOMBUS",quantity:20}],outside:true},RHOMBUS_SQUARE:{blackCorners:{alpha:0.5,time:2,blinkAlpha:0.7},clouds:{density:0.3,vel:{x:90,y:36},alpha:0.24},particles:[{type:"BLUE_SQUARES",quantity:10}]},RHOMBUS_SQUARE_BEACH:{blackCorners:{alpha:0.1,time:4,blinkAlpha:0.2},clouds:{density:0.3,
vel:{x:90,y:36},alpha:0.1},particles:[{type:"BLUE_SQUARES",quantity:10}]},RHOMBUS_SQUARE_INNER:{lightMapDarkness:0.8,particles:[{type:"BLUE_SQUARES",quantity:5}],glowColor:"#161c24"},FINAL_BOSS:{blackCorners:{alpha:0.5,time:2,blinkAlpha:0.7},particles:[{type:"BLUE_SQUARES",quantity:10}],outside:true},GAUTHAM_ROOM:{lightMapDarkness:0.7,particles:[],fog:{alpha:0.9,vel:{x:5,y:-15}},glowColor:"#360e0f",subOverlay:{brightColor:"#560202",darkColor:"rgba(0,0,0,0.5)"},blackCorners:{alpha:1,time:2,blinkAlpha:1}},
LAB:{blackCorners:{alpha:0.3,time:2,blinkAlpha:0.5},fog:{alpha:0.8,vel:{x:5,y:-15}},lightMapDarkness:0.5,glowColor:"#623212",particles:[{type:"DARK_DUST",quantity:20}]},FINAL_DNG_OUTER:{whiteCorners:{alpha:0.45,time:2,blinkAlpha:0.5},fog:{alpha:0.6,vel:{x:0,y:-30},zoom:1},lightMapDarkness:0.5,glowColor:"#294058",particles:[{type:"FINAL_WHIRL",quantity:15},{type:"FINAL_GLOW",quantity:10}]},FINAL_DNG_OUTER_BATTLE:{whiteCorners:{alpha:0.45,time:2,blinkAlpha:0.5},fog:{alpha:0.6,vel:{x:0,y:-30},zoom:1},
lightMapDarkness:0.5,glowColor:"#294058",particles:[{type:"FINAL_WHIRL_FAST",quantity:25},{type:"FINAL_GLOW",quantity:10}]},FINAL_DNG_INNER:{blackCorners:{alpha:0.3,time:2,blinkAlpha:0.5},fog:{alpha:0.8,vel:{x:5,y:-15}},lightMapDarkness:0.5,glowColor:"#373632",particles:[{type:"FINAL_WHIRL",quantity:15}]},FINAL_DNG_INNER_TELEPORT:{whiteCorners:{alpha:0.45,time:2,blinkAlpha:0.5},fog:{alpha:0.6,vel:{x:0,y:-30},zoom:1},lightMapDarkness:0.5,glowColor:"#2c3737",particles:[{type:"FINAL_WHIRL",quantity:15},
{type:"FINAL_GLOW",quantity:10}]},FINAL_DNG_INNER_BATTLE:{blackCorners:{alpha:0.3,time:2,blinkAlpha:0.5},fog:{alpha:0.8,vel:{x:5,y:-15}},lightMapDarkness:0.5,glowColor:"#373632",particles:[{type:"FINAL_WHIRL_FAST",quantity:25}]},BEACH_DEFAULT:{clouds:{density:0.3,vel:{x:90,y:36},alpha:0.24},glowColor:"#e9d8a9",particles:[{type:"FINAL_WHIRL",quantity:10},{type:"BEACH_GLOW",quantity:7},{type:"BEACH_GLOW_BIG",quantity:3}]}};ig.WeatherInstance=ig.Cacheable.extend({cacheType:"Weather",name:null,config:null,
particleSpawners:[],init:function(b){this.parent();this.name=b;this.config=ig.WEATHER_TYPES[this.name];if(b=this.config.particles)for(var a=0;a<b.length;++a)this.particleSpawners.push(new ig.EnvParticleSpawner(b[a].type))},getCacheKey:function(b){return b},onCacheCleared:function(){for(var b=this.particleSpawners.length;b--;)this.particleSpawners[b].decreaseRef();this.particleSpawners.length=0}});ig.Weather=ig.GameAddon.extend({levelWeather:null,currentWeather:new ig.WeatherInstance("NONE"),clouds:new ig.Clouds,
fog:new ig.Fog,rain:new ig.Rain,darknessHandle:null,outside:false,lightMapDarkness:{last:0,target:0,timer:0},subOverlay:null,lightMapBrightness:{last:0,target:0,timer:0},extraParticles:[],init:function(){this.parent("Weather");this.darknessHandle=new ig.DarknessHandle;ig.light.addDarknessHandle(this.darknessHandle)},setWeather:function(b,a){this.currentWeather=b;this.updateWeather(a)},addExtraParticles:function(b,a){this.removeExtraParticles(b,true);this.extraParticles.push({spawner:b,count:a});ig.envParticles.addSpawner(b,
a)},removeExtraParticles:function(b,a){for(var d=this.extraParticles.length;d--;)this.extraParticles[d].spawner==b&&this.extraParticles.splice(d,1);a||ig.envParticles.addSpawner(b,0)},levelLoadStartOrder:100,onLevelLoadStart:function(b){this.levelWeather&&this.levelWeather.decreaseRef();this.levelWeather=b.attributes&&b.attributes.weather?new ig.WeatherInstance(b.attributes.weather||"NONE"):new ig.WeatherInstance("NONE");this.levelWeather.config.glowColor?ig.light.setMainGlowColor(this.levelWeather.config.glowColor):
ig.light.setMainGlowColor(null)},levelLoadedOrder:100,onLevelLoaded:function(){this.setWeather(this.levelWeather,true)},deferredUpdateOrder:0,onDeferredUpdate:function(){if(!ig.game.paused){if(this.lightMapDarkness.timer){this.lightMapDarkness.timer=this.lightMapDarkness.timer-ig.system.tick;if(this.lightMapDarkness.timer<0)this.lightMapDarkness.timer=0;var b=this.lightMapDarkness.timer/2,b=b*this.lightMapDarkness.last+(1-b)*this.lightMapDarkness.target;ig.light.lightMapDarkness=b}if(this.lightMapBrightness.timer){this.lightMapBrightness.timer=
this.lightMapBrightness.timer-ig.system.tick;if(this.lightMapBrightness.timer<0)this.lightMapBrightness.timer=0;b=this.lightMapBrightness.timer/2;b=b*this.lightMapBrightness.last+(1-b)*this.lightMapBrightness.target;ig.light.lightMapBrightness=b}this.clouds.update();this.fog.update();this.rain.update()}},midDrawOrder:100,onMidDraw:function(){this.rain.draw();if(ig.perf.weather&&this.subOverlay){var b=ig.system.context;b.globalCompositeOperation="lighter";b.fillStyle=this.subOverlay.brightColor;b.fillRect(0,
0,ig.system.realWidth,ig.system.realHeight);b.globalCompositeOperation="source-over";b.fillStyle=this.subOverlay.darkColor;b.fillRect(0,0,ig.system.realWidth,ig.system.realHeight)}},onReset:function(){this.rain.onReset()},updateWeather:function(b){var a=this.currentWeather.config;if(a.blackCorners){var d=a.blackCorners;ig.overlay.setCorner("BLACK",d.alpha,d.time,d.blinkAlpha)}else ig.overlay.setCorner("BLACK",0,b?0:2);if(a.whiteCorners){d=a.whiteCorners;ig.overlay.setCorner("WHITE",d.alpha,d.time,
d.blinkAlpha)}else ig.overlay.setCorner("WHITE",0,b?0:2);if(a.clouds){d=a.clouds;this.clouds.setClouds(d.density,d.vel,d.alpha,b)}else this.clouds.clearClouds(b);if(a.fog){d=a.fog;this.fog.setFog(d.alpha,d.vel,d.zoom,b)}else this.fog.clearFog(b);a.rain?this.rain.setRain(a.rain,b):this.rain.clearRain(b);a.darkness?this.darknessHandle.setIntensity(a.darkness,b?0:2):this.darknessHandle.setIntensity(0,b?0:2);this.outside=a.outside;var d=a.lightMapDarkness,c=a.lightMapBrightness;d==void 0&&(d=0.6);c==
void 0&&(c=1);if(b){ig.light.lightMapDarkness=d;ig.light.lightMapBrightness=c}else{this.lightMapDarkness.last=ig.light.lightMapDarkness;this.lightMapDarkness.target=d;this.lightMapDarkness.timer=2;this.lightMapBrightness.last=ig.light.lightMapBrightness;this.lightMapBrightness.target=c;this.lightMapBrightness.timer=2}this.subOverlay=a.subOverlay||null;this.restoreParticles(b)},restoreParticles:function(b){ig.envParticles.clear(b);for(var a=this.currentWeather.config,d=this.currentWeather.particleSpawners,
c=d.length;c--;)ig.envParticles.addSpawner(d[c],a.particles[c].quantity,b);for(c=this.extraParticles.length;c--;)ig.envParticles.addSpawner(this.extraParticles[c].spawner,this.extraParticles[c].count,b)}});ig.addGameAddon(function(){return ig.weather=new ig.Weather})});ig.baked=!0;
ig.module("impact.feature.light.entities.cond-light").requires("impact.base.actor-entity","impact.feature.weather.weather","impact.feature.light.light").defines(function(){ig.ENTITY.ConditionalLight=ig.Entity.extend({glowColor:null,_wm:new ig.Config({spawnable:true,attributes:{condition:{_type:"VarCondition",_info:"Condition for light to appear"},lightSize:{_type:"String",_info:"If defined: reduce shadow with provided size",_select:ig.LIGHT_SIZE,_withNull:true},glowSize:{_type:"String",_info:"If defined: glow with provided size",
_select:ig.LIGHT_SIZE,_withNull:true},weather:{_type:"String",_info:"If defined, take glow color from weather definition",_select:ig.WEATHER_TYPES,_withNull:true},glowColor:{_type:"String",_info:"Override glow color (ignores weather color)",_optional:true}},drawBox:true,boxColor:"rgba(255,255,125, 0.8)"}),init:function(b,a,d,c){this.parent(b,a,d,c);this.coll.type=ig.COLLTYPE.NONE;this.coll.setSize(8,8,0);this.coll.setUpdateType(ig.COLL_UPDATE_TYPE.STATIC);var b=new ig.VarCondition(c.condition),a=
Vec2.createC(this.coll.pos.x+this.coll.size.x/2,this.coll.pos.y-this.coll.pos.z+this.coll.size.y/2),d=ig.LIGHT_SIZE[c.lightSize]||null,e=ig.LIGHT_SIZE[c.glowSize]||null;if(c.glowColor)this.glowColor=new ig.GlowColor(c.glowColor);else if(c.weather)if(c=(c=ig.WEATHER_TYPES[c.weather])&&c.glowColor)this.glowColor=new ig.GlowColor(c);ig.light.addCondLight(b,a,d,e,this.glowColor)},onKill:function(b){this.glowColor&&this.glowColor.decreaseRef();this.parent(b)},update:function(){}})});ig.baked=!0;
ig.module("impact.feature.light.plug-in").requires("impact.feature.light.light","impact.feature.light.light-steps","impact.feature.light.light-map","impact.feature.light.entities.cond-light").defines(function(){});ig.baked=!0;
ig.module("impact.feature.height-map.height-map").requires("impact.base.map","impact.base.game","impact.base.image","game.config").defines(function(){ig.MAP.HeightMap=ig.Map.extend({_wm:new ig.Config({_label:"HeightMap",_fixSize:ig.CONFIG.DISABLE_LAYER_SIZE,_noRepeat:true,_noMoveSpeed:true,_noDistance:ig.CONFIG.DISABLE_LAYER_DISTANCE,_fixTilesize:ig.CONFIG.DEFAULT_TILE_SIZE,_fixTileset:"media/map/heightmap-tiles.png",_fixLevel:"postlight",_icon:"impact/feature/height-map/editors/layer-icon.png",_alphaActive:1,
_alphaInactive:0,_alphaEntities:0}),noMerge:true,init:function(a,b){this.parent(a,b)},draw:function(){},drawTiled:function(){}});ig.MAP.HeightMap.levelKey="heightMap";if(window.wm){wm.CHIPSET_CONFIG={};var b={FILL:"FILL",DIAGONAL_NE:"DIAGONAL_NE",DIAGONAL_SE:"DIAGONAL_SE",DIAGONAL_SW:"DIAGONAL_SW",DIAGONAL_NW:"DIAGONAL_NW",SQUARE_NE:"SQUARE_NE",SQUARE_SE:"SQUARE_SE",SQUARE_SW:"SQUARE_SW",SQUARE_NW:"SQUARE_NW",NORTH:"NORTH",EAST:"EAST",SOUTH:"SOUTH",WEST:"WEST",CORNER_NE:"CORNER_NE",CORNER_SE:"CORNER_SE",
CORNER_SW:"CORNER_SW",CORNER_NW:"CORNER_NW",WALL_SOUTH:"WALL_SOUTH",WALL_SOUTH_BASE:"WALL_SOUTH_BASE",WALL_SE:"WALL_SE",WALL_SE_BASE:"WALL_SE_BASE",WALL_SW:"WALL_SW",WALL_SW_BASE:"WALL_SW_BASE",WALL_SQR_SW:"WALL_SQR_SW",WALL_SQR_SW_BASE:"WALL_SQR_SW_BASE",WALL_SQR_SE:"WALL_SQR_SE",WALL_SQR_SE_BASE:"WALL_SQR_SE_BASE",WALL_END_WEST:"WALL_END_WEST",WALL_END_WEST_BASE:"WALL_END_WEST_BASE",WALL_END_EAST:"WALL_END_EAST",WALL_END_EAST_BASE:"WALL_END_EAST_BASE",INVISIBLE_WALL:"INVISIBLE_WALL"},a={};a[b.SOUTH]=
{wall:b.WALL_SOUTH,base:b.WALL_SOUTH_BASE};a[b.DIAGONAL_SW]={wall:b.WALL_SW,base:b.WALL_SW_BASE};a[b.DIAGONAL_SE]={wall:b.WALL_SE,base:b.WALL_SE_BASE};a[b.SQUARE_SW]={wall:b.WALL_SQR_SW,base:b.WALL_SQR_SW_BASE};a[b.SQUARE_SE]={wall:b.WALL_SQR_SE,base:b.WALL_SQR_SE_BASE};a[b.CORNER_SW]={shadowOnly:true,wall:b.WALL_END_WEST,base:b.WALL_END_WEST_BASE};a[b.CORNER_SE]={shadowOnly:true,wall:b.WALL_END_EAST,base:b.WALL_END_EAST_BASE};a[b.NORTH]={shadowOnly:true,toMaster:true,deltaY:-1,wall:b.WALL_SOUTH,
base:b.WALL_SOUTH_BASE};a[b.DIAGONAL_NE]={shadowOnly:true,toMaster:true,wall:b.WALL_SW,base:b.WALL_SW_BASE};a[b.DIAGONAL_NW]={shadowOnly:true,toMaster:true,wall:b.WALL_SE,base:b.WALL_SE_BASE};a[b.SQUARE_NE]={shadowOnly:true,toMaster:true,deltaY:-1,wall:b.WALL_SOUTH,base:b.WALL_SOUTH_BASE};a[b.SQUARE_NW]={shadowOnly:true,toMaster:true,deltaY:-1,wall:b.WALL_SOUTH,base:b.WALL_SOUTH_BASE};var d={};d[2]=b.DIAGONAL_NE;d[3]=b.DIAGONAL_SE;d[4]=b.DIAGONAL_SW;d[5]=b.DIAGONAL_NW;var c=[{dir1:"NORTH",dir2:"EAST",
gfx:b.SQUARE_NE},{dir1:"NORTH",dir2:"WEST",gfx:b.SQUARE_NW},{dir1:"SOUTH",dir2:"EAST",gfx:b.SQUARE_SE},{dir1:"SOUTH",dir2:"WEST",gfx:b.SQUARE_SW}],e={NORTH:{dx:0,dy:-1,blockType1:3,blockType2:4,gfx:b.NORTH,terrainBorder:[{dx:-1,dy:0},{dx:1,dy:0}]},EAST:{dx:1,dy:0,blockType1:4,blockType2:5,gfx:b.EAST,terrainBorder:[{dx:0,dy:-1},{dx:0,dy:1}]},SOUTH:{dx:0,dy:1,blockType1:2,blockType2:5,gfx:b.SOUTH,terrainBorder:[{dx:-1,dy:0},{dx:1,dy:0}]},WEST:{dx:-1,dy:0,blockType1:2,blockType2:3,gfx:b.WEST,terrainBorder:[{dx:0,
dy:-1},{dx:0,dy:1}]},NE:{dx:1,dy:-1,blockType1:4,blockType2:4,gfx:b.CORNER_NE},SE:{dx:1,dy:1,blockType1:5,blockType2:5,gfx:b.CORNER_SE},SW:{dx:-1,dy:1,blockType1:2,blockType2:2,gfx:b.CORNER_SW},NW:{dx:-1,dy:-1,blockType1:3,blockType2:3,gfx:b.CORNER_NW}},f=[],g;for(g in e)f.push(g);var h={};h[2]=[e.NORTH,e.EAST,e.NE];h[3]=[e.SOUTH,e.EAST,e.SE];h[4]=[e.SOUTH,e.WEST,e.SW];h[5]=[e.NORTH,e.WEST,e.NW];var i={};i[b.CORNER_NE]={test:b.EAST,set:b.FILL};i[b.CORNER_NW]={test:b.WEST,set:b.FILL};i[b.EAST]={test:b.DIAGONAL_NE,
set:b.CORNER_NE};i[b.WEST]={test:b.DIAGONAL_NW,set:b.CORNER_NW};var j={start:0,end:0};wm.HeightMapConverter={data:null,lastData:null,minLayer:0,maxLevel:0,width:0,height:0,onMapLoad:function(a){this._storeTileData(a.data);this._convertRoundTiles();this._setGfxType();this.lastData=this.data;this.data=null},apply:function(a,b){this._storeTileData(a.data);this._convertRoundTiles();this._setGfxType();this._applyOnLayers(b);this.lastData=this.data},_storeTileData:function(a){this.data=[];var b=a[0].length,
c=a.length;this.minLevel=1E3;this.maxLevel=0;this.width=b;this.height=c;for(var d=0;d<c;++d){this.data[d]=[];for(var e=0;e<b;++e){var f=a[d][e]-1;if(f==-1)this.data[d][e]=null;else{var g=Math.floor(f/128),f=f%128,f={level:Math.floor(f/8)||-1,fill:f%8,terrain:g,gfx:0,lowerLevel:0,lowerTerrain:0,upperLevel:0,terrainBorder:-1};this.minLevel=Math.min(f.level,this.minLevel);this.maxLevel=Math.max(f.level,this.maxLevel);this.data[d][e]=f}}}},_convertRoundTiles:function(){for(var a=this.maxLevel;a>=this.minLevel;a--)for(var b=
0;b<this.height;++b)for(var c=0;c<this.width;++c){var d=this.data[b][c];if(d&&d.level==a&&d.fill==0)d.fill=this._getRoundTileReplace(c,b,d.level)}},_setGfxType:function(){for(var a=0;a<this.height;++a)for(var b=0;b<this.width;++b){var c=this.data[a][b];c&&(c.fill==1?this._setSquareGfx(b,a,c):this._setDiagonalGfx(b,a,c))}},_applyOnLayers:function(a){var b=ig.editor.undo;b.beginMapDraw();for(var c=ig.editor.layers,d=c.length,e=-1,f=0;f<d;++f){var g=c[f];if(!(g.level=="first"||g.level=="last"||g.level==
"light"||g.level=="postlight"||g.level.indexOf("object")!=-1)&&g.distance==1)if(g.type=="Background"&&wm.CHIPSET_CONFIG[g.tilesetName]&&e!=g.level){e=g.level;this._applyOnBackground(g,a)}else g.type=="Collision"&&this._applyOnCollision(g,a)}b.endMapDraw()},_getLevelHeight:function(a,b){a<1&&(a=1);var c=ig.editor.levels,d=c[a-1];return d?d.height/b.tilesize:c[c.length-1].height/b.tilesize+(a-c.length)*2},_getLevelDistance:function(a,b,c){return this._getLevelHeight(b,c)-this._getLevelHeight(a,c)},
_applyOnBackground:function(c,d){var e=wm.CHIPSET_CONFIG[c.tilesetName];if(e){for(var e=new p(e),f=[],g=ig.editor.levels,h=g[c.level],k=g[c.level*1+1],m=g.length,g=(h.height-g[ig.editor.masterLevel].height)/c.tilesize,h=k?(k.height-h.height)/c.tilesize:0,k=c.level*1+1,n=ig.editor.masterLevel*1+1,o=0;o<this.height;++o)for(var A=0;A<this.width;++A){var B=this.data[o][A];if(B){var w=e.hasShadow()&&B.level>m&&B.lowerLevel<=m,x=a[B.gfx];if(x&&x.shadowOnly&&(!w||k<n))x=null;if(B.level==k){if(d||this._hasTileAreaChanged(A,
o)){var E=null;if(e.hasFloorChasm(B.terrain)&&(B.gfx==b.DIAGONAL_SE||B.gfx==b.DIAGONAL_SW)&&B.level==n&&B.lowerLevel==-1)E="CHASM_FLOOR";var G=e.getGfx(B.gfx,A,o-g,E,B.terrain,B.terrainBorder);this._setLayerTile(c,A,o-g,G,f)}}else if(x&&x.toMaster&&n<=k&&k<B.lowerLevel){var J=h,w=x.deltaY||0;if(d||this._hasTileLineChanged(A,o,J)){j.start=this._getLevelDistance(n,k,c);j.end=this._getLevelDistance(k,B.lowerLevel,c)-1;for(var I=0;I<J;++I){G=I==0&&n==k?x.base:x.wall;G=e.getGfx(G,A,o-g-I+w,"BACK_WALL",
B.lowerTerrain,-1,j);this._setLayerTile(c,A,o-g-I+w,G,f);j.start++;j.end--}if(w){G=e.getGfx(b.FILL,A,o-g,"SHADOW",B.lowerTerrain);this._setLayerTile(c,A,o-g,G,f)}}}else if(x&&!x.toMaster&&(B.lowerLevel<=k||w&&k==n)&&B.level>k){var K=!x.shadowOnly&&e.hasChasm()&&B.lowerLevel==-1&&k<n,J=h,H=0,M=false,L=e.getChasmHeight(B.terrain),I=e.getChasmTileAdd(B.terrain);if(K)H=this._getLevelDistance(k,n,c)-L-I;else if(w&&k==n){J=this._getLevelDistance(k,B.level,c);M=true;H=this._getLevelDistance(k,B.lowerLevel,
c)}if(d||this._hasTileLineChanged(A,o,J)){var N=B.lowerLevel==-1||e.isWallTerrainFromTop(B.lowerTerrain,B.terrain)?B.terrain:B.lowerTerrain;if(w&&k>n){G=e.getGfx(b.INVISIBLE_WALL,A,o-g,"SHADOW",N);this._setLayerTile(c,A,o-g,G,f)}else{j.start=this._getLevelDistance(B.lowerLevel,k,c);j.end=this._getLevelDistance(k,B.level,c)-1-H;if(K)j.start=Math.max(-H,0);if(H&&M)j.start=0;for(I=0;I<J;++I){E=null;if(I<H){G=0;w&&(G=e.getGfx(b.FILL,A,o-g,"SHADOW",B.lowerTerrain));this._setLayerTile(c,A,o-g-I,G,f)}else{if(I==
0&&B.lowerLevel==k)G=x.base;else if(M&&I==H)G=x.base;else if(I==0&&e.hasFloorChasm(N)&&B.lowerLevel==-1&&k==n){G=x.base;if(B.gfx==b.DIAGONAL_SE||B.gfx==b.DIAGONAL_SW)E="CHASM"}else{G=x.wall;M&&J-I==1&&(E="SHADOW")}x.shadowOnly&&(E="SHADOW");K&&I-H<L&&(E=e.hasFloorChasm(N)&&B.level==n?"CHASM_FLOOR":"CHASM");if(G){G=e.getGfx(G,A,o-g-I,E,N,-1,j);this._setLayerTile(c,A,o-g-I,G,f)}j.start++;j.end--}}if(x.wall&&M){G=e.getGfx(B.gfx,A,o-g-J,"SHADOW",N);this._setLayerTile(c,A,o-g-J,G,f)}}}}else if(B.lowerLevel==
k){if(d||this._hasTileChanged(A,o)){if(e.hasShadow())if(c.level>ig.editor.masterLevel)G=l[B.gfx]?e.getGfx(l[B.gfx],A,o-g,"BACK_WALL",B.lowerTerrain):e.getGfx(b.INVISIBLE_WALL,A,o-g,"SHADOW",B.lowerTerrain);else{G=e.getGfx(B.gfx,A,o-g,"SHADOW",B.lowerTerrain);if(!e.hasShadowSide(B.lowerTerrain)&&i[B.gfx])(x=this.data[o-1]&&this.data[o-1][A])&&i[B.gfx].test==x.gfx&&(G=e.getGfx(i[B.gfx].set,A,o-g,"SHADOW",B.lowerTerrain))}else G=e.getGfx(b.FILL,A,o-g,null,B.lowerTerrain);this._setLayerTile(c,A,o-g,G,
f)}}else if(d||this._hasTileLineShadowChanged(A,o,c)){G=0;e.hasShadow()&&(c.level==ig.editor.masterLevel&&B.level>k)&&(G=w&&B.lowerLevel&&B.lowerLevel<n?e.getGfx(B.gfx,A,o-g,"DARK_WALL",B.lowerTerrain):e.getGfx(b.FILL,A,o-g,"SHADOW",B.lowerTerrain));this._setLayerTile(c,A,o-g,G,f)}}}ig.game.autoTiles.resolveAutoTileList(f,c,ig.editor.undo)}},_applyOnCollision:function(a,b){for(var c=ig.editor.levels,c=(c[a.level].height-c[ig.editor.masterLevel].height)/a.tilesize,d=a.level*1+1,e=a.level<=ig.editor.masterLevel,
f=a.level<ig.editor.masterLevel,g=0;g<this.height;++g)for(var h=0;h<this.width;++h)if(b||this._hasTileChanged(h,g)){var i=this.data[g][h];if(i){var j=0;i.level<d?j=e?m[1]:0:i.fill==1?!f&&i.level>d&&(j=o[i.fill]):!f&&i.lowerLevel>d?j=o[1]:i.level>d?i.lowerLevel<d&&e?j=f?m[i.fill]:n[i.fill]:f||(j=o[i.fill]):i.level==d&&e&&(j=m[i.fill]);this._setLayerTile(a,h,g-c,j)}}},_hasTileAreaChanged:function(a,b){if(this._hasTileChanged(a,b))return true;for(var c=f.length;c--;){var d=e[f[c]];if(this._hasTileChanged(a+
d.dx,b+d.dy))return true}return false},_hasTileLineChanged:function(a,b,c){for(c=c+1;c--;)if(this._hasTileChanged(a,b-c))return true;return false},_hasTileLineShadowChanged:function(a,b,c){for(var d=11,e=ig.editor.levels;d--;)if(this._hasTileChanged(a,b+d)){if(!d)return true;var f=this.data[b+d][a];if(f.level>e.length){var g=this._getLevelDistance(ig.editor.masterLevel+1,e.length,c),g=g+(f.level-e.length)*2;if(d<=g)return true}}return false},_hasTileChanged:function(a,b){if(!this.lastData)return true;
var c=this.lastData[b]&&this.lastData[b][a],d=this.data[b]&&this.data[b][a];return!c&&d||c&&!d?true:!c&&!d?false:c.level!=d.level||c.fill!=d.fill||c.gfx!=d.gfx||c.lowerLevel!=d.lowerLevel||c.terrain!=d.terrain||c.lowerTerrain!=d.lowerTerrain||c.terrainBorder!=d.terrainBorder},_setLayerTile:function(a,b,c,d,e){if(!(c<0||c>=this.height)){e&&ig.game.autoTiles.addAutoTileList(e,a,b,c);var e=ig.editor.undo,d=ig.game.autoTiles.getActualTile(a,b,c,d),f=a.data[c][b];if(f!=d){e.pushMapDraw(a,b*a.tilesize,
c*a.tilesize,f,d);a.setGridTile(b,c,d)}}},_writeTilesBack:function(a){var b=ig.editor.undo;b.beginMapDraw();for(var c=0;c<this.height;++c)for(var d=0;d<this.width;++d){var e=this.data[c][d],e=(e.level-1)*8+e.fill+1;b.pushMapDraw(a,d*16,c*16,a.data[c][d],e);a.setGridTile(d,c,e)}b.endMapDraw()},_getRoundTileReplace:function(a,b,c){var d=this._getOtherLevel(a,b,c,e.NORTH),f=this._getOtherLevel(a,b,c,e.EAST),g=this._getOtherLevel(a,b,c,e.WEST),a=this._getOtherLevel(a,b,c,e.SOUTH);return d&&f&&(!a||a>=
d)&&(!g||g>=d)&&d==f?2:(!d||d>=f)&&f&&a&&(!g||g>=f)&&f==a?3:(!d||d>=g)&&(!f||f>=g)&&a&&g&&a==g?4:d&&(!f||f>=d)&&(!a||a>=d)&&g&&d==g?5:1},_setSquareGfx:function(a,d,g){var h=g.level;g.gfx=null;for(var i=0;i<c.length;++i){var j=c[i],k=e[j.dir1],m=e[j.dir2],l=this._getOtherLevel(a,d,h,k),m=this._getOtherLevel(a,d,h,m);if(l&&m&&l<h&&m<h){g.lowerLevel=l;g.lowerTerrain=this._getTerrain(a,d,k)||0;g.gfx=j.gfx;g.terrainBorder=-1;return}}for(i=0;i<f.length;++i){j=e[f[i]];if((k=this._getOtherLevel(a,d,h,j))&&
k<h){g.lowerLevel=k;g.lowerTerrain=this._getTerrain(a,d,j)||0;g.gfx=j.gfx;g.terrainBorder=this._getTerrainBorder(a,d,j,g.terrain,h);return}}if(!g.gfx)g.gfx=b.FILL},_setDiagonalGfx:function(a,b,c){for(var e=h[c.fill],f=e.length,g=[],i=[];f--;){var j=this._getOtherLevel(a,b,c.level,e[f]);g[f]=j;i[f]=this._getTerrain(a,b,e[f])||0}if(g[0]){a=g[0];i=i[0]}else if(g[1]){a=g[1];i=i[1]}else{a=g[2];i=i[2]}if(a>c.level){c.fill=c.fill>3?c.fill-2:c.fill+2;c.lowerLevel=c.level;c.lowerTerrain=c.terrain;c.level=
a;c.terrain=i}else{c.lowerLevel=a;c.lowerTerrain=i}c.gfx=d[c.fill]},_getOtherLevel:function(a,b,c,d){b=b+d.dy;a=a+d.dx;a=this.data[b]&&this.data[b][a];if(!a)return 0;d=a.fill==d.blockType1||a.fill==d.blockType2;return a.level==c?d?a.level:0:!d?a.level:0},_getTerrain:function(a,b,c){b=b+c.dy;a=a+c.dx;a=this.data[b]&&this.data[b][a];return!a?false:a.terrain},_getOtherTerrain:function(a,b,c,d){b=b+c.dy;a=a+c.dx;a=this.data[b]&&this.data[b][a];return!a||a.level!=d?false:a.terrain},_getTerrainBorder:function(a,
b,c,d,e){if(!d||!c.terrainBorder)return-1;for(var f=c.terrainBorder.length;f--;){var g=this._getOtherTerrain(a,b,c.terrainBorder[f],e);if(g!==false&&g<d)return f}return-1}};var k={TYPE1:{BASE:{},ALT:{},SHADOW:{},CHASM:{},DARK_WALL:{},CHASM_FLOOR:{},BACK_WALL:{},SUB:{BASE:{},SHADOW:{},BACK_WALL:{},BORDER:{}}}};g=k.TYPE1;g.hasShadowSide=true;g.chasmTileAdd=1;g.BASE[b.NORTH]=[[2,0],[3,0]];g.BASE[b.EAST]=[[3,1],[3,2]];g.BASE[b.SOUTH]=[[2,3],[3,3]];g.BASE[b.WEST]=[[2,1],[2,2]];g.BASE[b.DIAGONAL_NE]=[[4,
0],[5,1]];g.BASE[b.DIAGONAL_SE]=[[4,3],[5,2]];g.BASE[b.DIAGONAL_SW]=[[0,2],[1,3]];g.BASE[b.DIAGONAL_NW]=[[0,1],[1,0]];g.BASE[b.CORNER_NE]=[[4,1]];g.BASE[b.CORNER_SE]=[[4,2]];g.BASE[b.CORNER_SW]=[[1,2]];g.BASE[b.CORNER_NW]=[[1,1]];g.BASE[b.WALL_SOUTH]=[[3,4],[2,4]];g.BASE[b.WALL_SE]=[[5,3],[4,4]];g.BASE[b.WALL_SW]=[[1,4],[0,3]];g.BASE[b.WALL_SOUTH_BASE]=[[2,5],[3,5]];g.BASE[b.WALL_SE_BASE]=[[4,5],[5,4]];g.BASE[b.WALL_SW_BASE]=[[0,4],[1,5]];g.BASE[b.WALL_END_WEST]=[[0,6],[0,7]];g.BASE[b.WALL_END_WEST_BASE]=
[[0,6],[0,7]];g.BASE[b.WALL_END_EAST]=[[5,6],[5,7]];g.BASE[b.WALL_END_EAST_BASE]=[[5,6],[5,7]];g.ALT.offset={x:0,y:6};g.ALT[b.WALL_SOUTH]=[[3,0],[2,0]];g.ALT[b.WALL_SE]=[[5,0],[4,0]];g.ALT[b.WALL_SW]=[[1,0],[0,0]];g.SHADOW.offset={x:0,y:0};g.SHADOW[b.FILL]=[[0,0]];g.SHADOW[b.INVISIBLE_WALL]=[[5,0]];g.CHASM.offset={x:0,y:1};g.CHASM.wallYVariance={};g.CHASM.wallYVariance[b.WALL_SOUTH]={start:[1,0]};g.CHASM.wallYVariance[b.WALL_SE]={start:[1,0]};g.CHASM.wallYVariance[b.WALL_SW]={start:[1,0]};g.DARK_WALL.offset=
{x:0,y:7};g.BACK_WALL.offset={x:0,y:7};g.BACK_WALL[b.EAST]=[[3,3],[4,2]];g.BACK_WALL[b.WEST]=[[1,2],[2,3]];g.SUB.ignoreTerrain=[b.WALL_SOUTH,b.WALL_SE,b.WALL_SW];g.SUB.BASE[b.WALL_SOUTH_BASE]=[[2,4],[3,4]];g.SUB.BASE[b.WALL_SE_BASE]=[[4,4],[5,3]];g.SUB.BASE[b.WALL_SW_BASE]=[[0,3],[1,4]];g.SUB.SHADOW.offset={x:0,y:5};g.SUB.SHADOW[b.NORTH]=[[2,0],[3,0]];g.SUB.SHADOW[b.DIAGONAL_NW]=[[0,0],[1,0]];g.SUB.SHADOW[b.DIAGONAL_NE]=[[4,0],[5,0]];g.SUB.SHADOW[b.WEST]=[[0,1],[1,1]];g.SUB.SHADOW[b.EAST]=[[5,1],
[4,1]];g.SUB.BACK_WALL.offset={x:0,y:7};g.SUB.BACK_WALL[b.NORTH]=[[2,0],[3,0]];g.SUB.BACK_WALL[b.DIAGONAL_NW]=[[0,0],[1,0]];g.SUB.BACK_WALL[b.DIAGONAL_NE]=[[4,0],[5,0]];g.SUB.BACK_WALL[b.WEST]=[[0,1],[1,1]];g.SUB.BACK_WALL[b.EAST]=[[5,1],[4,1]];g.SUB.BORDER[b.NORTH]=[[[2,5]],[[3,5]]];g.SUB.BORDER[b.EAST]=[[[4,5]],[[4,6]]];g.SUB.BORDER[b.SOUTH]=[[[2,6]],[[3,6]]];g.SUB.BORDER[b.WEST]=[[[1,5]],[[1,6]]];k.TYPE2={BASE:{},ALT:{},SHADOW:{},CHASM:{},CHASM_FLOOR:{},DARK_WALL:{},BACK_WALL:{},SUB:{BASE:{},SHADOW:{},
CHASM_FLOOR:{},BACK_WALL:{},BORDER:{}}};g=k.TYPE2;g.hasShadowSide=false;g.chasmTileAdd=0;g.BASE[b.NORTH]=[[1,0]];g.BASE[b.EAST]=[[4,1]];g.BASE[b.SOUTH]=[[1,3]];g.BASE[b.WEST]=[[3,1]];g.BASE[b.DIAGONAL_NE]=[[2,0]];g.BASE[b.DIAGONAL_SE]=[[2,3]];g.BASE[b.DIAGONAL_SW]=[[0,3]];g.BASE[b.DIAGONAL_NW]=[[0,0]];g.BASE[b.SQUARE_NE]=[[4,0]];g.BASE[b.SQUARE_SE]=[[4,2]];g.BASE[b.SQUARE_SW]=[[3,2]];g.BASE[b.SQUARE_NW]=[[3,0]];g.BASE[b.CORNER_NE]=[[2,1]];g.BASE[b.CORNER_SE]=[[2,2]];g.BASE[b.CORNER_SW]=[[0,2]];g.BASE[b.CORNER_NW]=
[[0,1]];g.BASE[b.WALL_SOUTH]=[[1,4]];g.BASE[b.WALL_SOUTH_BASE]=[[1,7]];g.BASE[b.WALL_SE]=[[2,4]];g.BASE[b.WALL_SE_BASE]=[[2,7]];g.BASE[b.WALL_SW]=[[0,4]];g.BASE[b.WALL_SW_BASE]=[[0,7]];g.BASE[b.WALL_SQR_SE]=[[4,3]];g.BASE[b.WALL_SQR_SE_BASE]=[[4,6]];g.BASE[b.WALL_SQR_SW]=[[3,3]];g.BASE[b.WALL_SQR_SW_BASE]=[[3,6]];g.BASE[b.WALL_END_WEST]=[[3,0]];g.BASE[b.WALL_END_WEST_BASE]=[[3,1]];g.BASE[b.WALL_END_EAST]=[[4,0]];g.BASE[b.WALL_END_EAST_BASE]=[[4,1]];g.BASE.wallYVariance={};g.BASE.wallYVariance[b.WALL_SOUTH]=
{loop:[1,2],end:[0]};g.BASE.wallYVariance[b.WALL_SE]={loop:[1,2],end:[0]};g.BASE.wallYVariance[b.WALL_SW]={loop:[1,2],end:[0]};g.BASE.wallYVariance[b.WALL_SQR_SE]={loop:[1,2],end:[0]};g.BASE.wallYVariance[b.WALL_SQR_SW]={loop:[1,2],end:[0]};g.SHADOW.offset={x:0,y:0};g.SHADOW[b.FILL]=[[1,1]];g.SHADOW[b.INVISIBLE_WALL]=[[1,2]];g.SHADOW[b.EAST]=[[1,1]];g.SHADOW[b.WEST]=[[1,1]];g.SHADOW.wallYVariance={};g.CHASM.offset={x:0,y:8};g.CHASM[b.WALL_SE_BASE]=[[3,2]];g.CHASM[b.WALL_SW_BASE]=[[4,2]];g.CHASM[b.WALL_SOUTH]=
[[1,2]];g.CHASM[b.WALL_SQR_SW]=[[0,2]];g.CHASM[b.WALL_SQR_SE]=[[2,2]];g.CHASM[b.WALL_SE]=[[3,3]];g.CHASM[b.WALL_SW]=[[4,3]];g.CHASM.wallYVariance={};g.CHASM.wallYVariance[b.WALL_SOUTH]={start:[2,1,0]};g.CHASM.wallYVariance[b.WALL_SE]={start:[2,1,0]};g.CHASM.wallYVariance[b.WALL_SW]={start:[2,1,0]};g.CHASM.wallYVariance[b.WALL_SQR_SE]={start:[2,1,0]};g.CHASM.wallYVariance[b.WALL_SQR_SW]={start:[2,1,0]};g.CHASM_FLOOR.offset={x:0,y:8};g.CHASM_FLOOR[b.DIAGONAL_SE]=[[3,0]];g.CHASM_FLOOR[b.DIAGONAL_SW]=
[[4,0]];g.CHASM_FLOOR[b.WALL_SOUTH]=[[1,1]];g.CHASM_FLOOR[b.WALL_SQR_SW]=[[0,1]];g.CHASM_FLOOR[b.WALL_SQR_SE]=[[2,1]];g.CHASM_FLOOR[b.WALL_SE]=[[3,1]];g.CHASM_FLOOR[b.WALL_SW]=[[4,1]];g.CHASM_FLOOR.wallYVariance={};g.CHASM_FLOOR.wallYVariance[b.WALL_SOUTH]={start:[3,2,0]};g.CHASM_FLOOR.wallYVariance[b.WALL_SE]={start:[4,3,0]};g.CHASM_FLOOR.wallYVariance[b.WALL_SW]={start:[4,3,0]};g.CHASM_FLOOR.wallYVariance[b.WALL_SQR_SE]={start:[3,2,0]};g.CHASM_FLOOR.wallYVariance[b.WALL_SQR_SW]={start:[3,2,0]};
g.DARK_WALL.offset={x:0,y:13};g.DARK_WALL[b.NORTH]=[[3,1]];g.DARK_WALL[b.DIAGONAL_NE]=[[1,0]];g.DARK_WALL[b.DIAGONAL_NW]=[[0,0]];g.DARK_WALL[b.SQUARE_NW]=[[2,1]];g.DARK_WALL[b.SQUARE_NE]=[[4,1]];g.DARK_WALL[b.DIAGONAL_NW]=[[0,0]];g.DARK_WALL[b.CORNER_NE]=[[2,0]];g.DARK_WALL[b.CORNER_NW]=[[2,0]];g.DARK_WALL[b.WEST]=[[0,1]];g.DARK_WALL[b.EAST]=[[1,1]];g.BACK_WALL.offset={x:0,y:2};g.BACK_WALL[b.WALL_SOUTH_BASE]=[[1,6]];g.BACK_WALL[b.WALL_SE_BASE]=[[2,6]];g.BACK_WALL[b.WALL_SW_BASE]=[[0,6]];g.BACK_WALL[b.WALL_SQR_SE_BASE]=
[[4,5]];g.BACK_WALL[b.WALL_SQR_SW_BASE]=[[3,5]];g.BACK_WALL[b.EAST]=[[1,0]];g.BACK_WALL[b.WEST]=[[1,0]];g.BACK_WALL.wallYVariance={};g.BACK_WALL.wallYVariance[b.WALL_SOUTH]={loop:[1],end:[0]};g.BACK_WALL.wallYVariance[b.WALL_SE]={loop:[1],end:[0]};g.BACK_WALL.wallYVariance[b.WALL_SW]={loop:[1],end:[0]};g.BACK_WALL.wallYVariance[b.WALL_SQR_SE]={loop:[1],end:[0]};g.BACK_WALL.wallYVariance[b.WALL_SQR_SW]={loop:[1],end:[0]};g.SUB.ignoreTerrain=[b.WALL_SOUTH,b.WALL_SOUTH_BASE,b.WALL_SE,b.WALL_SW,b.WALL_SQR_SE,
b.WALL_SQR_SE_BASE,b.WALL_SQR_SW,b.WALL_SQR_SW_BASE];g.SUB.ignoreTerrainKeepWallBase=[b.WALL_SOUTH,b.WALL_SE,b.WALL_SW,b.WALL_SQR_SE,b.WALL_SQR_SW];g.SUB.BASE[b.WALL_SE_BASE]=[[2,4]];g.SUB.BASE[b.WALL_SW_BASE]=[[0,4]];g.SUB.BASE[b.WALL_SOUTH_BASE]=[[1,4]];g.SUB.BASE[b.WALL_SQR_SE_BASE]=[[1,2]];g.SUB.BASE[b.WALL_SQR_SW_BASE]=[[1,1]];g.SUB.SHADOW.offset={x:0,y:0};g.SUB.SHADOW[b.DIAGONAL_NW]=[[3,3]];g.SUB.SHADOW[b.DIAGONAL_NE]=[[4,3]];g.SUB.BACK_WALL.offset={x:0,y:0};g.SUB.BACK_WALL[b.DIAGONAL_SE]=[[3,
4]];g.SUB.BACK_WALL[b.DIAGONAL_SW]=[[4,4]];g.SUB.BORDER[b.NORTH]=[[[2,5]],[[3,5]]];g.SUB.BORDER[b.EAST]=[[[4,5]],[[4,6]]];g.SUB.BORDER[b.SOUTH]=[[[2,6]],[[3,6]]];g.SUB.BORDER[b.WEST]=[[[1,5]],[[1,6]]];g.SUB.CHASM_FLOOR[b.DIAGONAL_SE]=[[0,5]];g.SUB.CHASM_FLOOR[b.DIAGONAL_SW]=[[0,6]];var l={};l[b.WEST]=b.WEST;l[b.EAST]=b.EAST;l[b.DIAGONAL_NW]=b.DIAGONAL_SE;l[b.DIAGONAL_NE]=b.DIAGONAL_SW;var o={1:2,2:8,3:9,4:10,5:11},m={1:1,2:6,3:7,4:4,5:5},n={1:2,2:24,3:25,4:26,5:27},p=ig.Class.extend({tileCountX:0,
base:null,terrains:[],init:function(a){this.tileCountX=a.tileCountX;this.base=this._copySettings(a.base);if(a.terrains)for(var b=0;b<a.terrains.length;++b)this.terrains[b]=this._copySettings(a.terrains[b])},_copySettings:function(a){var c=ig.copy(a);c.mapping=k[a.mappingType]||null;if(a.blockTypes){c.blockedTypes=[];for(var d=a.blockedTypes.length;d--;)c.blockedTypes.push(b[a.blockedTypes[d]])}return c},_getMappingMain:function(a){if(a&&this.terrains[a-1]){a=this.terrains[a-1];if(a.mapping)return a;
if(a.baseTerrain)return this.terrains[a.baseTerrain-1]}return this.base},hasShadowSide:function(a){return this._getMappingMain(a).mapping.hasShadowSide},getChasmHeight:function(a){var a=this._getMappingMain(a),c=1;if(a.mapping.CHASM.wallYVariance)c=a.mapping.CHASM.wallYVariance[b.WALL_SOUTH].start.length;return c},getChasmTileAdd:function(a){return this._getMappingMain(a).mapping.chasmTileAdd||0},hasFloorChasm:function(a){return this.hasChasm()&&this.getChasmTileAdd(a)==0},hasShadow:function(){return this.base.shadow&&
!this.base.chasmOnly},hasChasm:function(){return this.base.shadow},isFill:function(a,c){return a==b.FILL||(c&&this.terrains[c-1].blockedTypes?this.terrains[c-1].blockedTypes.indexOf(a)!=-1:this.base.blockedTypes&&this.base.blockedTypes.indexOf(a)!=-1)},isWallTerrainFromTop:function(a,b){var c=a&&this.terrains[a-1]||this.base,d=b&&this.terrains[b-1]||this.base;return(d&&d.wallTerrainPrio||0)>(c&&c.wallTerrainPrio||0)},getGfx:function(a,b,c,d,e,f,g){e&&!this.terrains[e-1]&&(e=0);var h=this.base,i=null;
if(e&&this.terrains[e-1].mapping)h=this.terrains[e-1];else if(e)(i=this.terrains[e-1])&&i.baseTerrain&&(h=this.terrains[i.baseTerrain-1]);var j=null,k=h.mapping,m=k.BASE[a],w=h.ground,l=h.cliff,o=k.BASE.wallYVariance,n=i&&i.overrideWallBase?k.SUB.ignoreTerrainKeepWallBase:k.SUB.ignoreTerrain;i&&n.indexOf(a)!=-1&&(i=null);if(d){j=k[d].offset;m=k[d][a]||m;o=k[d].wallYVariance||o;w=null;l=h.shadow}else if(h.cliffAlt&&k.ALT[a]&&Math.random()<0.5){j=k.ALT.offset;m=k.ALT[a]}h=false;if(i)if((n=d&&k.SUB[d])&&
n[a]){l=i.cliff;j=n.offset;m=n[a]}else if(!d){w=i.ground;l=i.cliff;m=k.SUB.BASE[a]||m;h=i.border}d=j&&j.y||0;if(this.isFill(a))return w?this._getTile(w.x,w.y):m?this._getMappingTile(l,m,b,c,d):0;if(g&&o&&o[a]){w=o[a];w.end&&g.end<w.end.length?d=d+w.end[g.end]:w.start&&g.start<w.start.length?d=d+w.start[g.start]:w.loop&&(d=d+w.loop[g.start%w.loop.length])}h&&(e&&f!=-1&&k.SUB.BORDER[a])&&(m=k.SUB.BORDER[a][f]);return!m||m.length==0?0:this._getMappingTile(l,m,b,c,d)},_getMappingTile:function(a,b,c,d,
e){b=b.length>1&&this._getVariation(c,d)?b[1]:b[0];return this._getTile(a.x+b[0],a.y+b[1]+(e||0))},_getTile:function(a,b){return b*this.tileCountX+a+1},_getVariation:function(a,b){return(a+b)%2}})}});ig.baked=!0;
ig.module("impact.feature.height-map.height-map-config").requires("impact.feature.height-map.height-map").defines(function(){if(window.wm){wm.CHIPSET_CONFIG["media/map/autumn-outside.png"]={tileCountX:32,base:{mappingType:"TYPE1",ground:{x:0,y:0},cliff:{x:0,y:5},blockedTypes:["CORNER_SW","CORNER_SE"]},terrains:[{ground:{x:0,y:1},cliff:{x:0,y:5},border:true}]};wm.CHIPSET_CONFIG["media/map/evo-village.png"]={tileCountX:32,base:{mappingType:"TYPE1",ground:{x:0,y:0},cliff:{x:0,y:5},blockedTypes:[]},terrains:[{ground:{x:0,
y:1},cliff:{x:0,y:5},border:true},{ground:{x:0,y:13},cliff:{x:0,y:9},border:true},{blockedTypes:[],mappingType:"TYPE2",ground:{x:7,y:6},cliff:{x:6,y:5},wallTerrainPrio:1,border:true}]};wm.CHIPSET_CONFIG["media/map/final-dungeon-outer.png"]={tileCountX:32,base:{mappingType:"TYPE1",ground:{x:0,y:0},cliff:{x:0,y:4},blockedTypes:[]},terrains:[{ground:{x:1,y:0},cliff:{x:6,y:4},border:true},{ground:{x:12,y:8},cliff:{x:12,y:4},border:true},{blockedTypes:[],mappingType:"TYPE2",ground:{x:20,y:0},cliff:{x:0,
y:15},wallTerrainPrio:1,border:true},{ground:{x:20,y:4},cliff:{x:6,y:15},baseTerrain:3,wallTerrainPrio:1}]};wm.CHIPSET_CONFIG["media/map/final-dungeon-inner.png"]={tileCountX:32,base:{mappingType:"TYPE2",ground:{x:0,y:0},cliff:{x:0,y:4},shadow:{x:5,y:4}},terrains:[{ground:{x:1,y:0},cliff:{x:10,y:4},border:true},{ground:{x:9,y:0},cliff:{x:15,y:4},border:true},{ground:{x:20,y:4},cliff:{x:20,y:4},border:false,overrideWallBase:true},{mappingType:"TYPE1",ground:{x:25,y:0},cliff:{x:25,y:2},shadow:{x:24,
y:36}},{ground:{x:3,y:2},cliff:{x:10,y:4},border:true,baseTerrain:0},{ground:{x:18,y:43},cliff:{x:18,y:38},baseTerrain:4}]};wm.CHIPSET_CONFIG["media/map/old-hideout.png"]={tileCountX:32,base:{mappingType:"TYPE1",ground:{x:0,y:0},cliff:{x:0,y:5},cliffAlt:null,blockedTypes:["CORNER_SW","CORNER_SE"]}};wm.CHIPSET_CONFIG["media/map/bergen-trail.png"]={tileCountX:32,base:{mappingType:"TYPE1",ground:{x:0,y:0},cliff:{x:0,y:4},cliffAlt:{x:0,y:10},blockedTypes:[]},terrains:[{ground:{x:1,y:0},cliff:{x:6,y:4},
border:true},{ground:{x:1,y:2},cliff:{x:12,y:4},border:true},{ground:{x:12,y:12},cliff:{x:12,y:8},border:true}]};wm.CHIPSET_CONFIG["media/map/heat-area.png"]={tileCountX:32,base:{mappingType:"TYPE1",ground:{x:0,y:0},cliff:{x:0,y:4},cliffAlt:{x:0,y:10},shadow:{x:6,y:6},blockedTypes:[],chasmOnly:true},terrains:[{ground:{x:11,y:0},cliff:{x:6,y:4},border:true},{ground:{x:1,y:0},cliff:{x:12,y:4},border:true},{ground:{x:12,y:12},cliff:{x:12,y:8},border:true},{ground:{x:1,y:2},cliff:{x:18,y:4},border:true}]};
wm.CHIPSET_CONFIG["media/map/cave.png"]={tileCountX:32,base:{mappingType:"TYPE1",ground:{x:0,y:0},cliff:{x:0,y:4},cliffAlt:{x:0,y:10},shadow:{x:6,y:4}},terrains:[{ground:{x:2,y:0},cliff:{x:12,y:4},border:false,shadow:{x:12,y:9}},{ground:{x:8,y:0},cliff:{x:12,y:4},border:false,shadow:{x:12,y:9}},{ground:{x:8,y:1},cliff:{x:18,y:4},border:false,shadow:{x:18,y:9}},{ground:{x:24,y:8},cliff:{x:24,y:4},border:false,shadow:{x:24,y:9}}]};wm.CHIPSET_CONFIG["media/map/cold-dng.png"]={tileCountX:32,mappingType:"TYPE1",
base:{mappingType:"TYPE1",ground:{x:0,y:0},cliff:{x:0,y:4},cliffAlt:{x:0,y:10},shadow:{x:6,y:4}},terrains:[{mappingType:"TYPE2",ground:{x:12,y:0},cliff:{x:12,y:4},shadow:{x:17,y:4}},{baseTerrain:1,ground:{x:20,y:0},cliff:{x:22,y:4}}]};wm.CHIPSET_CONFIG["media/map/heat-dng.png"]={tileCountX:32,base:{mappingType:"TYPE2",ground:{x:0,y:0},cliff:{x:0,y:4},shadow:{x:5,y:4}},terrains:[{ground:{x:1,y:0},cliff:{x:10,y:4},border:true},{ground:{x:9,y:0},cliff:{x:15,y:4},border:true},{ground:{x:19,y:2},cliff:{x:20,
y:4},border:false},{ground:{x:26,y:7},cliff:{x:25,y:4},border:false,overrideWallBase:true}]};wm.CHIPSET_CONFIG["media/map/jungle.png"]={tileCountX:32,base:{mappingType:"TYPE1",ground:{x:0,y:0},cliff:{x:0,y:4},cliffAlt:{x:0,y:10},shadow:{x:6,y:6},blockedTypes:[],chasmOnly:true},terrains:[{ground:{x:0,y:1},cliff:{x:12,y:4},border:false},{ground:{x:6,y:0},cliff:{x:18,y:4},border:true},{ground:{x:12,y:12},cliff:{x:12,y:8},border:true},{mappingType:"TYPE1",ground:{x:7,y:10},cliff:{x:6,y:4}},{baseTerrain:4,
ground:{x:0,y:1},cliff:{x:24,y:4},border:false},{ground:{x:19,y:2},cliff:{x:24,y:2},border:false},{baseTerrain:4,ground:{x:19,y:2},cliff:{x:24,y:3},border:false}]};wm.CHIPSET_CONFIG["media/map/shockwave-dng.png"]={tileCountX:32,base:{mappingType:"TYPE2",ground:{x:0,y:0},cliff:{x:0,y:4},shadow:{x:5,y:4}},terrains:[{ground:{x:1,y:0},cliff:{x:10,y:4},border:true},{ground:{x:9,y:0},cliff:{x:15,y:4},border:true},{ground:{x:20,y:4},cliff:{x:20,y:4},border:false,overrideWallBase:true},{mappingType:"TYPE1",
ground:{x:25,y:0},cliff:{x:25,y:2},shadow:{x:24,y:36}},{ground:{x:3,y:2},cliff:{x:10,y:4},border:true,baseTerrain:0},{ground:{x:18,y:43},cliff:{x:18,y:38},baseTerrain:4}]};wm.CHIPSET_CONFIG["media/map/forest-dng.png"]={tileCountX:32,base:{mappingType:"TYPE2",ground:{x:0,y:0},cliff:{x:0,y:4},shadow:{x:5,y:4}},terrains:[{ground:{x:1,y:0},cliff:{x:10,y:4},border:true},{ground:{x:9,y:0},cliff:{x:15,y:4},border:true},{ground:{x:20,y:4},cliff:{x:20,y:4},border:false,overrideWallBase:true},{mappingType:"TYPE1",
ground:{x:25,y:0},cliff:{x:25,y:2},shadow:{x:24,y:36}},{ground:{x:3,y:2},cliff:{x:10,y:4},border:true,baseTerrain:0},{ground:{x:18,y:43},cliff:{x:18,y:38},baseTerrain:4}]};wm.CHIPSET_CONFIG["media/map/tree-inner.png"]={tileCountX:32,base:{mappingType:"TYPE2",ground:{x:0,y:0},cliff:{x:0,y:4},shadow:{x:5,y:4}},terrains:[{ground:{x:1,y:0},cliff:{x:10,y:4},border:true},{ground:{x:9,y:0},cliff:{x:15,y:4},border:true},{ground:{x:20,y:4},cliff:{x:20,y:4},border:false,overrideWallBase:true},{mappingType:"TYPE1",
ground:{x:25,y:0},cliff:{x:25,y:2},shadow:{x:24,y:36}},{ground:{x:3,y:2},cliff:{x:10,y:4},border:true,baseTerrain:0},{ground:{x:18,y:43},cliff:{x:18,y:38},baseTerrain:4}]};wm.CHIPSET_CONFIG["media/map/arid.png"]={tileCountX:32,base:{mappingType:"TYPE1",ground:{x:0,y:0},cliff:{x:0,y:4},cliffAlt:{x:0,y:10},blockedTypes:[]},terrains:[{ground:{x:1,y:0},cliff:{x:6,y:4},border:true},{ground:{x:3,y:2},cliff:{x:12,y:4},border:true},{ground:{x:12,y:12},cliff:{x:12,y:8},border:true},{mappingType:"TYPE2",ground:{x:11,
y:0},cliff:{x:0,y:12},wallTerrainPrio:1},{ground:{x:1,y:21},cliff:{x:0,y:20},baseTerrain:4,wallTerrainPrio:1}]};wm.CHIPSET_CONFIG["media/map/beach.png"]={tileCountX:32,base:{mappingType:"TYPE1",ground:{x:0,y:4},cliff:{x:0,y:4},cliffAlt:{x:0,y:10},blockedTypes:[]},terrains:[{ground:{x:12,y:0},cliff:{x:6,y:4},border:true},{ground:{x:10,y:2},cliff:{x:12,y:4},border:true},{ground:{x:0,y:0},cliff:{x:18,y:4},border:false,wallTerrainPrio:0.5},{ground:{x:18,y:4},cliff:{x:6,y:8},border:false},{mappingType:"TYPE1",
ground:{x:24,y:0},cliff:{x:24,y:0},border:true,wallTerrainPrio:1},{mappingType:"TYPE1",ground:{x:24,y:6},cliff:{x:24,y:6},border:true,wallTerrainPrio:1}]};wm.CHIPSET_CONFIG["media/map/arid-interior.png"]={tileCountX:32,base:{mappingType:"TYPE2",ground:{x:0,y:0},cliff:{x:0,y:4},shadow:{x:5,y:4}},terrains:[{ground:{x:0,y:1},cliff:{x:10,y:4},border:true},{mappingType:"TYPE2",ground:{x:1,y:0},cliff:{x:15,y:4},shadow:{x:20,y:4},border:false},{ground:{x:11,y:0},cliff:{x:25,y:4},border:true,baseTerrain:2}]};
wm.CHIPSET_CONFIG["media/map/forest.png"]={tileCountX:32,base:{mappingType:"TYPE1",ground:{x:0,y:0},cliff:{x:0,y:5},blockedTypes:[]},terrains:[{ground:{x:6,y:10},cliff:{x:6,y:6},border:true},{mappingType:"TYPE1",ground:{x:2,y:12},cliff:{x:0,y:11},blockedTypes:[],wallTerrainPrio:1}]};wm.CHIPSET_CONFIG["media/map/rhombus-outside.png"]={tileCountX:32,base:{mappingType:"TYPE2",ground:{x:1,y:5},cliff:{x:0,y:4},blockedTypes:[],wallTerrainPrio:1},terrains:[{ground:{x:1,y:5},cliff:{x:5,y:4},blockedTypes:[],
wallTerrainPrio:0.5},{ground:{x:11,y:20},cliff:{x:10,y:19},blockedTypes:[],wallTerrainPrio:0.5},{mappingType:"TYPE1",ground:{x:6,y:32},cliff:{x:0,y:32},blockedTypes:[]},{ground:{x:6,y:32},cliff:{x:8,y:21},blockedTypes:[],wallTerrainPrio:1,overrideWallBase:true},{ground:{x:6,y:35},cliff:{x:6,y:31},blockedTypes:[],baseTerrain:3}]};wm.CHIPSET_CONFIG["media/map/lab.png"]={tileCountX:32,mappingType:"TYPE1",base:{mappingType:"TYPE1",ground:{x:0,y:0},cliff:{x:0,y:4},cliffAlt:{x:0,y:10},shadow:{x:6,y:4}},
terrains:[{mappingType:"TYPE2",ground:{x:12,y:0},cliff:{x:12,y:4},shadow:{x:17,y:4}},{baseTerrain:1,ground:{x:20,y:0},cliff:{x:22,y:4}},{baseTerrain:0,ground:{x:18,y:20},cliff:{x:18,y:16},border:false,shadow:{x:18,y:21}},{baseTerrain:1,ground:{x:18,y:20},cliff:{x:15,y:32},border:false,overrideWallBase:true},{baseTerrain:0,ground:{x:13,y:48},cliff:{x:12,y:46},border:false,shadow:{x:12,y:51}},{baseTerrain:1,ground:{x:13,y:48},cliff:{x:20,y:47},border:false,overrideWallBase:true}]}}});ig.baked=!0;
ig.module("impact.feature.height-map.plug-in").requires("impact.feature.height-map.height-map","impact.feature.height-map.height-map-config").defines(function(){});ig.baked=!0;
ig.module("impact.feature.navigation.nav-map").requires("impact.base.map","impact.base.image","game.config").defines(function(){function b(a,b,c,d,e,f,g,h){var i=0,j=0;b.min.x-b.max.x?j=b.min.y*e+d<c.center.y?f:-f:i=b.min.x*e<c.center.x?f:-f;var f=b.min.x*e+i+Math.abs(j),k=b.min.y*e+j+Math.abs(i),l=b.max.x*e+i-Math.abs(j),n=b.max.y*e+j-Math.abs(i);ig.Debug.drawLine(a,f,k,l,n,h||2);b.block[0]&&ig.Debug.drawCircle("red",f,k,4);b.block[1]&&ig.Debug.drawCircle("red",l,n,4);if(g){b=Vec2.mulF(Vec2.lerp(b.min,
b.max,0.5,o),e);c=Vec2.lerp(b,c.center,0.75,m);ig.Debug.drawLine(a,b.x+i,b.y+j,c.x,c.y-d*0.75,h||2)}}function a(a,b,c,d){var e,g,h;if(d){e=d.minX;g=d.maxX+1;h=d.minY;d=d.maxY+1}else{e=0;g=a.width;h=0;d=a.height}for(;h<d;++h)for(var i=e;i<g;++i){var j=f(a,b,i,h);if(j&&j<u&&!a.getGridNodeId(i,h)){var j=a,k=j.nodes.length+1;j.freeNodeIds.length>0&&(k=j.freeNodeIds.pop());if(k>=2048)throw Error("Exceeded NavMap id range of 2048! Simplify Nav Map of height "+j.zHeight/16);j=k;k=new ig.PathNode(j,a,b,i,
h,c);a.nodes[j-1]=k}}}function d(a,b){if(a.tmpSearchId!=b){a.tmpSearchId=b;a.tmpCameFromNode=null;a.tmpCameFromNeighbour=null;a.tmpClosed=false;a.tmpGScore=-1;a.tmpFScore=-1}}function c(a,b){a.airConnected=false;for(var c=a.neighbours.length;c--;)if(a.neighbours[c].node==b){a.neighbours.splice(c,1);return}for(c=a.airNeighbours.length;c--;)if(a.airNeighbours[c].node==b){a.airNeighbours.splice(c,1);break}}function e(a,b,c,d,f){if(a.getGridNodeId(c,d)==b.id){a.setGridNodeId(c,d,0);a.clearGridBuildFlags(c,
d);f.minX=Math.min(f.minX,c);f.maxX=Math.max(f.maxX,c);f.minY=Math.min(f.minY,d);f.maxY=Math.max(f.maxY,d);for(var g=0;g<D.length;++g){var h=D[g];e(a,b,c+h.x,d+h.y,f)}}}function f(a,b,c,d){var e=a.getGridAreaFlag(c,d);if(e<u||e>z)if(ig.CollMapTools.isTileBlocked(b.getGridTile(c,d))||a.getEntityFlagValue(c,d,ig.NAV_ENTITY_FLAG.BLOCK))return 0;return e}function g(a,b,c,d){var e=f(a,b,c,d);e!=y.FENCE&&(!a.getGridForceGround(c,d)&&!a.getEntityFlagValue(c,d,ig.NAV_ENTITY_FLAG.GROUND)&&b&&b.isGridHole(c,
d))&&(e=e+v);return e}function h(a,b,c){a.block=[0,0];if(c)if(a.min.x!=a.max.x){if(!g(b,c,a.min.x-1,a.min.y-1)||!g(b,c,a.min.x-1,a.min.y))a.block[0]=1;if(!g(b,c,a.max.x,a.min.y-1)||!g(b,c,a.max.x,a.min.y))a.block[1]=1}else{if(!g(b,c,a.min.x-1,a.min.y-1)||!g(b,c,a.min.x,a.min.y-1))a.block[0]=1;if(!g(b,c,a.min.x-1,a.max.y)||!g(b,c,a.min.x,a.max.y))a.block[1]=1}}function i(a,b,c,d,e,f,g,i){for(var k=0;k<c.length;++k){var m=c[k],l=0,o=0,n=0,s=0,p=0;if(m.min.x-m.max.x){n=1;p=m.max.x-m.min.x;o=a.getGridNodeId(m.min.x,
m.min.y)==b.id?-1:0}else{s=1;p=m.max.y-m.min.y;l=a.getGridNodeId(m.min.x,m.min.y)==b.id?-1:0}for(var z=null,v=m.min.x,q=m.min.y,r=0,y=m.min.x,u=m.min.y;r<p;++r,y=y+n,u=u+s){for(var D=null,m=0;!D&&m<d.length;++m)D=d[m].getGridNode(y+l,u+o+e[m]);if(D!=z){if(z){m={min:{x:v,y:q},max:{x:y,y:u}};h(m,a);j(a,b,z,m,f,g,i)}z=D;v=y;q=u}}if(z){m={min:{x:v,y:q},max:{x:y,y:u}};h(m,a);j(a,b,z,m,f,g,i)}}}function j(a,b,c,d,e,f,g){if(g&&(c.edges.up.length>0||c.edges.upStairs.length>0))c.airConnected=false;for(g=b.neighbours.length;g--;){var h=
b.neighbours[g];if(h.node==c&&h.shared.type==e){h.shared.edges.push(d);f&&h.shared.reverse&&h.shared.reverse.edges.push(k(a,b,c,d));return}}e=new ig.PathNodeConnect(e);e.edges.push(d);b.neighbours.push({node:c,shared:e});c.airNeighbours.push({node:b,shared:e});if(f){f=new ig.PathNodeConnect(f);f.edges.push(k(a,b,c,d));e.reverse=f;c.neighbours.push({node:b,shared:f});b.airNeighbours.push({node:c,shared:f})}}function k(a,b,c,d){d=ig.copy(d);a=(c.height-b.height)/a.tilesize;d.min.y=d.min.y-a;d.max.y=
d.max.y-a;return d}var l=["red","blue","green","yellow","pink","orange","violet","brown"],o=Vec2.create(),m=Vec2.create(),n=Vec2.create(),p={bitOffset:0,map:31},r={bitOffset:5,map:1},t={bitOffset:8,map:15},q={bitOffset:12,map:2047};ig.NAV_ENTITY_FLAG={BLOCK:{bitOffset:23,map:7},GROUND:{bitOffset:26,map:7}};var s=[];ig.MAP.Navigation=ig.Map.extend({nodes:[],freeNodeIds:[],initialized:false,_wm:new ig.Config({_label:"Navigation",_fixSize:ig.CONFIG.DISABLE_LAYER_SIZE,_noRepeat:true,_noMoveSpeed:true,
_noDistance:ig.CONFIG.DISABLE_LAYER_DISTANCE,_fixTilesize:ig.CONFIG.DEFAULT_TILE_SIZE,_fixTileset:"media/map/pathmap-tiles.png",_icon:"impact/feature/navigation/editors/layer-icon.png",_alphaActive:0.6,_alphaInactive:0,_alphaEntities:0}),init:function(a,b){this.parent(a,b)},levelInit:function(b){a(this,ig.game.levels[b].collision,this.zHeight);this.initialized=true},reparse:function(b,c,d,e,f){if(this.initialized){for(var g={minX:c,maxX:d,minY:e,maxY:f},h=e-1;h<=f+1;++h)for(var i=c-1;i<=d+1;++i)if(!(i==
c-1||i==d+1)||!(h==e-1||h==f+1)){var j=this.getGridNode(i,h);if(j){j.erase(this,i,h,g);this.nodes[j.id-1]=null;this.freeNodeIds.push(j.id)}}a(this,ig.game.levels[b].collision,this.zHeight,g)}},connectAirNodes:function(a){for(var b=a,c=[],d=[],e=ig.game.levels[a].height;--b>=0;)if(ig.game.levels[b].navigation){c.push(ig.game.levels[b].navigation);d.push((e-ig.game.levels[b].height)/this.tilesize)}for(var f=a,a=[],b=[];++f<ig.game.maxLevel;)if(ig.game.levels[f].navigation){a.push(ig.game.levels[f].navigation);
b.push((e-ig.game.levels[f].height)/this.tilesize)}for(e=s.length=0;e<this.nodes.length;++e)if((f=this.nodes[e])&&!f.airNode&&!f.airConnected){f.airConnected=true;c.length&&i(this,f,f.edges.down,c,d,C.LOWER_LEVEL,C.UPPER_FLY,true);if(a.length){i(this,f,f.edges.up,a,b,C.UPPER_LEVEL);i(this,f,f.edges.upStairs,a,b,C.UPPER_STAIRS,C.LOWER_STAIRS)}for(var g=f,h=c,j=d,k=0;k<g.neighbours.length;++k){var m=g.neighbours[k],l=m.node;if(l.airNode&&m.shared.type==C.SAME_LEVEL){if(!l.airConnected){l.airConnected=
true;h.length&&i(this,l,l.edges.down,h,j,C.LOWER_LEVEL)}for(var l=m.node.neighbours,o=0;o<l.length;++o){var n=l[o],p=n.shared.type;if(!(p==C.UPPER_FLY||p==C.UPPER_LEVEL)&&n.node!=g&&!n.node.airNode){for(var p=g,z=p.neighbours,v=z.length,q=null;v--;)if(z[v].node==n.node){q=z[v];break}if(!(q&&q.shared.type!=C.SAME_LEVEL_JUMP)){for(var r=z=void 0,y=v=void 0,u=m.shared.edges,D=n.shared.edges,t=0;t<u.length;++t)for(var A=Vec2.distance(u[t].min,u[t].max),Q=0;Q<D.length;++Q){var R=Vec2.distance(D[Q].min,
D[Q].max),R=Math.min(R,A),U=Line2.distanceLineToLine(u[t].min,u[t].max,D[Q].min,D[Q].max);if(z==void 0||R>r||R==r&&U<z){z=U;r=R;v=u[t];y=D[Q]}}z=z*this.tilesize;if(q){if(q.shared.jumpInfo.jumpDist>z){q.shared.edges=[v];q.shared.jumpInfo.jumpDist=z}}else{q=new ig.PathNodeConnect(C.SAME_LEVEL_JUMP);q.edges.push(v);q.jumpInfo={jumpDist:z,destEdge:y};q={node:n.node,shared:q};p.neighbours.push(q)}}}}}}s.push(f);for(g=f.neighbours.length;g--;){h=f.neighbours[g].shared;j=h.waypointMin;k=h.waypointMax;m=
h.jumpInfo?[h.jumpInfo.destEdge]:h.edges;l=m.length;o=0;p=true;for(n=0;n<l;++n){o=Math.max(o,Vec2.distance(m[n].min,m[n].max)*this.tilesize);if(!m[n].block[0]||!m[n].block[1])o=Math.max(o,64);if(p){p=false;Vec2.assign(j,m[n].min);Vec2.assign(k,m[n].max)}else{Vec2.min(j,m[n].min);Vec2.max(k,m[n].max)}}Vec2.mulF(j,this.tilesize);Vec2.mulF(k,this.tilesize);h.maxEdgeLength=o;if(h.reverse){h.reverse.maxEdgeLength=o;Vec2.assign(h.reverse.waypointMin,j);Vec2.assign(h.reverse.waypointMax,k)}}}},draw:function(a){ig.system.context.font=
"bold 8px Arial, sans-serif";ig.system.context.globalAlpha=1;ig.system.context.save();for(var c=0;c<this.nodes.length;++c){var d=this.nodes[c];if(d){for(var e=l[d.id%8],f=0;f<d.neighbours.length;++f)if(!d.neighbours[f].node.airNode){for(var g=d.neighbours[f].shared.edges,h=0;h<g.length;++h)b(e,g[h],d,a,this.tilesize,1,false);g=Vec2.lerp(d.neighbours[f].shared.waypointMin,d.neighbours[f].shared.waypointMax,0.5,n);h=Vec2.lerp(g,d.center,0.75,o);ig.Debug.drawLine(e,g.x,g.y,h.x,h.y-a*0.75,1)}for(f=0;f<
d.edges.block.length;++f)b("red",d.edges.block[f],d,a,this.tilesize,-2,false,2);for(f=0;f<d.edges.airBlock.length;++f)b("blue",d.edges.airBlock[f],d,a,this.tilesize,-2,false,2);for(f=0;f<d.edges.down.length;++f)b("white",d.edges.down[f],d,a,this.tilesize,-2,false,2);for(f=0;f<d.edges.up.length;++f)b("white",d.edges.up[f],d,a,this.tilesize,-2,false,2);for(f=0;f<d.edges.upStairs.length;++f)b("yellow",d.edges.upStairs[f],d,a,this.tilesize,-2,false,2);ig.Debug.fillRect(d.airNode?"white":"black",d.center.x-
8,d.center.y-a-4,12,7);ig.Debug.drawText(c+1<10?"0"+(c+1):c+1,e,d.center.x-6,d.center.y-a+2)}}ig.system.context.restore()},_getGridValue:function(a,b,c){return this.getGridTile(a,b)>>c.bitOffset&c.map},_setGridValue:function(a,b,c,d){var c=(c&d.map)<<d.bitOffset,e=this.getGridTile(a,b);this.setGridTile(a,b,e&~(d.map<<d.bitOffset)|c)},_setGridFlag:function(a,b,c,d){c=c<<d.bitOffset;d=this.getGridTile(a,b);this.setGridTile(a,b,d|c)},_clearGridFlag:function(a,b,c,d){c=c<<d.bitOffset;d=this.getGridTile(a,
b);this.setGridTile(a,b,d&~c)},getEntityFlagValue:function(a,b,c){return this._getGridValue(a,b,c)},setEntityFlagValue:function(a,b,c,d){this._setGridValue(a,b,c,d)},increaseEntityFlagValue:function(a,b,c){var d=this.getEntityFlagValue(a,b,c);return this.setEntityFlagValue(a,b,d+1,c)},decreaseEntityFlagValue:function(a,b,c){var d=this.getEntityFlagValue(a,b,c);this.setEntityFlagValue(a,b,d-1,c)},getGridAreaFlag:function(a,b){return this._getGridValue(a,b,p)},getGridForceGround:function(a,b){return this._getGridValue(a,
b,r)},getGridNode:function(a,b){var c=this.getGridNodeId(a,b);return c&&this.nodes[c-1]},getGridNodeId:function(a,b){return this._getGridValue(a,b,q)},setGridNodeId:function(a,b,c){return this._setGridValue(a,b,c,q)},getGridBuildFlags:function(a,b){return this._getGridValue(a,b,t)},setGridBuildFlag:function(a,b,c){return this._setGridFlag(a,b,c,t)},clearGridBuildFlags:function(a,b){return this._setGridValue(a,b,0,t)},getNode:function(a,b){a=Math.floor(a/this.tilesize);b=Math.floor(b/this.tilesize);
return this.getGridNode(a,b)}});ig.MAP.Navigation.levelKey="navigation";var v=256,y={JUMP:9,JUMP_N:10,JUMP_E:11,JUMP_S:12,JUMP_W:13,STAIRS:14,STAIRS_N:15,STAIRS_E:16,STAIRS_S:17,STAIRS_W:18,FENCE:19},u=y.JUMP,z=y.FENCE;ig.PathNode=ig.Class.extend({id:0,height:0,min:Vec2.create(),max:Vec2.create(),center:Vec2.create(),neighbours:[],airNeighbours:[],airNode:false,airConnected:false,edges:{north:[],east:[],south:[],west:[],down:[],up:[],upStairs:[],block:[],airBlock:[]},tmpSearchId:0,tmpCameFromNode:null,
tmpCameFromPos:Vec2.create(),tmpCameFromNeighbour:null,tmpClosed:false,tmpGScore:0,tmpFScore:0,init:function(a,b,c,d,e,f){this.id=a;this.height=f;Vec2.assignC(this.min,d*b.tilesize,e*b.tilesize+f);Vec2.assignC(this.max,(d+1)*b.tilesize,(e+1)*b.tilesize+f);this.airNode=!b.getGridForceGround(d,e)&&!b.getEntityFlagValue(d,e,ig.NAV_ENTITY_FLAG.GROUND)&&c&&c.isGridHole(d,e);a=d;A.length=0;b.setGridNodeId(a,e,this.id);for(A.push({x:a,y:e});A.length>0;){e=A.pop();a=e.x;e=e.y;Vec2.minC(this.min,a*b.tilesize,
e*b.tilesize+f);Vec2.maxC(this.max,(a+1)*b.tilesize,(e+1)*b.tilesize+f);d=g(b,c,a,e);if(!d)throw Error("Tried to expand to field with 0 source value");for(var i,j=0;j<D.length;++j){var k=D[j];if(!(b.getGridBuildFlags(a,e)&k.flag)){var m=a+k.x,l=e+k.y;i=g(b,c,m,l);if(d==i){b.setGridBuildFlag(a,e,k.flag);if(!b.getGridNodeId(m,l)){b.setGridNodeId(m,l,this.id);A.push({x:m,y:l})}}else{var m=b,o=c,n=a,l=e,s=d,p=i,q=m.getGridNodeId(n+k.x,l+k.y);i=p&v;if(q)a:{for(var o=m.nodes[q-1],q=n+(k.x>0?1:0)+(k.y?0.5:
0),s=l+(k.y>0?1:0)+(k.x?0.5:0),r=o.edges[k.edgeSrc],t=r.length;t--;){p=r[t];if(s>=p.min.y&&s<=p.max.y&&q>=p.min.x&&q<=p.max.x){i&&!this.airNode&&this.edges.down.push(p);this.edges[k.edgeDest].push(p);if(k.x)for(i=p.min.y;i<p.max.y;++i)m.setGridBuildFlag(n,i,k.flag);else for(i=p.min.x;i<p.max.x;++i)m.setGridBuildFlag(i,l,k.flag);for(m=this.neighbours.length;m--;)if(this.neighbours[m].node==o){this.neighbours[m].shared.edges.push(p);break a}m=new ig.PathNodeConnect(C.SAME_LEVEL);m.edges.push(p);this.neighbours.push({node:o,
shared:m});o.neighbours.push({node:this,shared:m});break a}}throw Error("Didn't find any edge when something should have been found");}else{r=n;for(q=l;g(m,o,r,q)==s&&g(m,o,r+k.x,q+k.y)==p;){m.setGridBuildFlag(r,q,k.flag);r=r+k.y;q=q+k.x}r=r-k.y;q=q-k.x;n=n-k.y;for(l=l-k.x;g(m,o,n,l)==s&&g(m,o,n+k.x,l+k.y)==p;){m.setGridBuildFlag(n,l,k.flag);n=n-k.y;l=l-k.x}n=n+k.y;l=l+k.x;s=Math.min(r,n)+(k.x>0?1:0);t=Math.min(q,l)+(k.y>0?1:0);n=Math.max(r,n)+(k.x>0?1:0)+(k.y?1:0);l=Math.max(q,l)+(k.y>0?1:0)+(k.x?
1:0);l={min:{x:s,y:t},max:{x:n,y:l}};h(l,m,o);i&&this.edges.down.push(l);m=p%v;m==y.JUMP||m==k.upValue?this.airNode||this.edges.up.push(l):m==y.STAIRS||m==k.stairValue?this.airNode||this.edges.upStairs.push(l):!m||m>=u&&m<=z?i&&!this.airNode?this.edges.airBlock.push(l):this.edges.block.push(l):m&&this.edges[k.edgeDest].push(l)}}}}}Vec2.lerp(this.min,this.max,0.5,this.center)},erase:function(a,b,d,f){for(var g=this.neighbours.length;g--;)c(this.neighbours[g].node,this);for(g=this.airNeighbours.length;g--;)c(this.airNeighbours[g].node,
this);e(a,this,b,d,f)},isClosed:function(a){d(this,a);return this.tmpClosed},setClosed:function(a,b){d(this,a);this.tmpClosed=b},getCameFromNode:function(a){d(this,a);return this.tmpCameFromNode},getCameFromNeighbour:function(a){d(this,a);return this.tmpCameFromNeighbour},getCameFromPos:function(a){d(this,a);return this.tmpCameFromPos},setCameFrom:function(a,b,c,e){d(this,a);this.tmpCameFromNode=b;this.tmpCameFromNeighbour=c;Vec2.assign(this.tmpCameFromPos,e)},getGScore:function(a){d(this,a);return this.tmpGScore},
setGScore:function(a,b){d(this,a);this.tmpGScore=b},getFScore:function(a){d(this,a);return this.tmpFScore},setFScore:function(a,b){d(this,a);this.tmpFScore=b},hasGScore:function(){return this.getGScore()!=-1}});ig.PathNodeConnect=ig.Class.extend({edges:[],waypointMin:Vec2.create(),waypointMax:Vec2.create(),maxEdgeLength:0,type:0,jumpInfo:null,reverse:null,externalData:{},searchData:{idx:0,pos:Vec2.create(),fromEdge:null,fromNode:null,toNode:null,gScore:-1,fScore:-1,closed:false},init:function(a){this.type=
a},getSearchData:function(a){if(this.searchData.idx!=a){this.searchData.idx=a;Vec2.assignC(this.searchData.pos,0,0);this.searchData.fromNode=null;this.searchData.toNode=null;this.searchData.fromEdge=null;this.searchData.gScore=-1;this.searchData.fScore=-1;this.searchData.closed=false}return this.searchData},setExternalData:function(a,b){this.externalData[a]=b;ig.navigation.clearCachedFailures()}});var D=[{x:0,y:-1,flag:1,edgeDest:"north",edgeSrc:"south",upValue:y.JUMP_S,stairValue:y.STAIRS_S},{x:1,
y:0,flag:2,edgeDest:"east",edgeSrc:"west",upValue:y.JUMP_W,stairValue:y.STAIRS_W},{x:0,y:1,flag:4,edgeDest:"south",edgeSrc:"north",upValue:y.JUMP_N,stairValue:y.STAIRS_N},{x:-1,y:0,flag:8,edgeDest:"west",edgeSrc:"east",upValue:y.JUMP_E,stairValue:y.STAIRS_E}],C=ig.NAV_CONNECTION_TYPE={SAME_LEVEL:0,LOWER_LEVEL:1,UPPER_LEVEL:2,LOWER_STAIRS:3,UPPER_STAIRS:4,UPPER_FLY:5,SAME_LEVEL_JUMP:6};ig.NAV_CONNECTION_TYPE=C;var A=[];Vec2.create()});ig.baked=!0;
ig.module("impact.feature.navigation.navigation").requires("impact.base.game").defines(function(){function b(a,b,c,d,e,f){for(var g=false,h=ig.game.getLevelIdx(b+4);h>=0;--h){var i=ig.game.levels[h];if(i&&i.navigation&&!(i.height+16<a)){var j=Math.abs(i.height-b)<=4?ig.NAV_ENTITY_FLAG.GROUND:ig.NAV_ENTITY_FLAG.BLOCK;if(!(f&&j==ig.NAV_ENTITY_FLAG.GROUND)){for(var g=i.navigation,k=Math.floor(c.x/g.tilesize),m=Math.floor((c.x+d.x-1)/g.tilesize),w=Math.floor((c.y-i.height)/g.tilesize),i=Math.floor((c.y+
d.y-i.height-1)/g.tilesize),l=w;l<=i;l++)for(var n=k;n<=m;n++)switch(e){case r.INCREASE:g.increaseEntityFlagValue(n,l,j);break;case r.DECREASE:g.decreaseEntityFlagValue(n,l,j)}g.reparse(h,k,m,w,i);g=true}}}return g}function a(a,b){var c=ig.game.getLevelIdx((b!==void 0?b:a.z)||0),d=(c=f(c))&&c.zHeight;return c&&c.getNode(a.x,a.y-d)}function d(b,c,d,e){for(var g=ig.navigation.tilesize,h=(d-1)/2,i=null,j=0;j<d;++j)for(var k=0;k<d;++k){var m=Vec2.assign(B,b);m.z=c!==void 0?c:b.z;m.x=(Math.floor(m.x/g-
h+j)+0.5)*g;m.y=(Math.floor(m.y/g-h+k)+0.5)*g;if(e)a:{for(var w=ig.game.getLevelIdx(m.z||0);w>=0;){var l=f(w),n=l&&l.zHeight;if(l=l&&l.getNode(m.x,m.y-n)){m=l;break a}w--}m=null}else m=a(m);if(!m||m.airNode||i&&m.height!=i.height)return null;i=m}b.x=(Math.floor(b.x/g-h)+d/2)*g;b.y=(Math.floor(b.y/g-h)+d/2)*g;return i}function c(a){var b=a.jumping?a.coll.pos.z:a.coll.baseZPos,b=b+8,c=ig.game.getLevelIdx(b),d=f(c);if(!d){c=ig.game.getLevelIdx(b+16);d=f(c);if(!d)return null}a.getCenter(H);b=d.zHeight;
d=e(a,H,d,b);if(!d){var g=ig.game.levels[c+1]&&ig.game.levels[c+1].height;if(g&&g-a.coll.pos.z<a.coll.pos.z-b){c=c+1;d=f(c);if(!d)return null;b=ig.game.levels[c].height;d=e(a,H,d,b)}}return d}function e(a,b,c,d){var a=a.coll,e;if((e=c.getNode(b.x,b.y-d))&&!e.airNode||(e=c.getNode(a.pos.x,a.pos.y-d))&&!e.airNode||(e=c.getNode(a.pos.x+a.size.x,a.pos.y-d))&&!e.airNode||(e=c.getNode(a.pos.x,a.pos.y+a.size.y-d))&&!e.airNode||(e=c.getNode(a.pos.x+a.size.x,a.pos.y+a.size.y-d))&&!e.airNode||(e=c.getNode(a.pos.x-
8,b.y-d))&&!e.airNode||(e=c.getNode(a.pos.x+a.size.x+8,b.y-d))&&!e.airNode||(e=c.getNode(b.x,a.pos.y-8-d))&&!e.airNode)return e;return e=c.getNode(b.x,a.pos.y+a.size.y+8-d)}function f(a){for(;ig.game.levels[a]&&!ig.game.levels[a].navigation;)a--;return ig.game.levels[a]&&ig.game.levels[a].navigation}function g(a,b,c,d,e,f){if(!a||!b)return false;if(a==b)return true;if(a.height!=b.height||a.airNode||b.airNode)return false;var g=ig.CONFIG.DEFAULT_TILE_SIZE;Vec2.assign(t,c);t.y=t.y-a.height;Vec2.mulF(t,
1/g);Vec2.assign(q,d);q.y=q.y-a.height;Vec2.mulF(q,1/g);f=(f||4)/g;Vec2.assign(s,t);for(var c=a,h=[];c&&c!=b;){var i;a:{i=c;for(var j=t,k=q,m=s,w=h,l=f,n=i.neighbours.length,o=null;n--;){var x=i.neighbours[n];if(w.indexOf(x.node)==-1&&!(x.shared.type==ig.NAV_CONNECTION_TYPE.UPPER_LEVEL||x.shared.type==ig.NAV_CONNECTION_TYPE.UPPER_FLY||x.shared.type==ig.NAV_CONNECTION_TYPE.UPPER_STAIRS))for(var p=x.shared.edges,z=0;z<p.length;++z){var r=p[z];if(Line2.intersectMinRange(r.min,r.max,j,k,l,m,r.block))if(x.node.airNode||
x.shared.type==ig.NAV_CONNECTION_TYPE.LOWER_LEVEL)o=x;else{i=x;break a}}}i=o}if(!i||i.airNode||i.shared.type==ig.NAV_CONNECTION_TYPE.LOWER_LEVEL){if(!e)return false;Vec2.assign(v,s);Vec2.mulF(v,g);v.z=a.height;v.y=v.y+a.height;ig.game.physics.initTraceResult(y);return ig.game.trace(y,v.x-4,v.y-4,v.z+12,d.x-v.x,d.y-v.y,8,8,8,ig.COLLTYPE.PROJECTILE)?false:true}h.push(c);c=i.node}return c==b}function h(a,b,c,d,e){if(a==b)return true;if(a.height!=b.height)return false;for(var e=e||0,f=ig.CONFIG.DEFAULT_TILE_SIZE,
g=a.neighbours.length;g--;){var h=a.neighbours[g];if(h.node==b){b=h.shared.edges;for(g=0;g<b.length;++g){h=b[g];Vec2.assign(t,h.min);Vec2.mulF(t,f);t.y=t.y+a.height;Vec2.assign(q,h.max);Vec2.mulF(q,f);q.y=q.y+a.height;if(Line2.intersectMinRange(t,q,c,d,e,null,h.block))return true}break}}return false}function i(b,d,e,f){b.z=e.coll.pos.z;e.getCenter(b);var h=c(e);if(f.posOffset){f=f.posOffset;e=ig.CollTools.getDistVec2(d.coll,e.coll,w);d=Vec3.assign(x,b);if(Math.abs(e.x)>Math.abs(e.y)){d.y=d.y+f.x;
d.x=d.x+(e.x>0?f.y:-f.y)}else{d.x=d.x+f.x;d.y=d.y+(e.y>0?f.y:-f.y)}if((f=a(d))&&!f.airNode&&(!h||h.height==f.height)&&g(h,f,b,d,false)){Vec3.assign(b,d);h=f}}return h}function j(a,b,c,d,e){var f;f=I=I%1E7+1;var g=[];if(!b||b.airNode||!c)return{nodes:[]};if(b==c)return{nodes:[{node:b,connection:null}]};if(c.airNode)return null;var h=Math.max(a.coll.size.x,a.coll.size.y);do{var i=null,j,k,m;if(g.length==0){j=b;m=d;k=0}else{var i=g.pop(),w=i.getSearchData(f);m=w.pos;k=w.gScore;j=w.toNode;w.closed=true}if(j==
c){a=f;d=[{node:c,connection:null}];e=i;f=false;for(g=0;c!=b;){h=e.getSearchData(a);f=f||c.height!=b.height;c=h.fromNode;e.jumpInfo&&g++;d.push({node:c,connection:e});e=h.fromEdge}return{nodes:d,distance:i.getSearchData(a).fScore,multiLevel:f,jumpCount:g}}for(w=j.neighbours.length;w--;){var l=j.neighbours[w],n=l.node,l=l.shared;if(!(i&&l==i)){var o=l.getSearchData(f);if(!n.airNode&&!(l.type!=ig.NAV_CONNECTION_TYPE.SAME_LEVEL_JUMP&&l.maxEdgeLength<h)&&(!(l.type==ig.NAV_CONNECTION_TYPE.SAME_LEVEL_JUMP||
l.type==ig.NAV_CONNECTION_TYPE.UPPER_LEVEL)||a.jumpingEnabled))if(!a.coll.groundConnect||!(a.coll.groundConnect!=ig.COLL_GROUND_CONNECT.STRONG_FLIGHT&&l.type==ig.NAV_CONNECTION_TYPE.LOWER_LEVEL))if((a.fly.height||l.type!=ig.NAV_CONNECTION_TYPE.UPPER_FLY)&&!(l.type==ig.NAV_CONNECTION_TYPE.SAME_LEVEL_JUMP&&l.jumpInfo.jumpDist>1600)&&!ig.NavExternalBlockers.check(l,a)){var x=l.type==ig.NAV_CONNECTION_TYPE.SAME_LEVEL_JUMP?1.2:1,s=0;l.type==ig.NAV_CONNECTION_TYPE.UPPER_LEVEL&&(s=s+100);Line2.closestEntry(J,
l.waypointMin,l.waypointMax,j.height,1,m,e,0,0);var p=J,x=k+Vec2.distance(m,p)*x+(n.height>j.height?n.height-j.height:0)*2+s,s=o.gScore;if(!o.closed||!(x>=s||o.fromNode!=j))if(s==-1||x<s){s!=-1&&g.erase(l);o.fromNode=j;o.toNode=n;o.fromEdge=i;o.gScore=x;Vec2.assign(o.pos,p);n=x+Vec2.distance(p,e);o.fScore=n;for(o=g.length;o&&g[o-1].getSearchData(f).fScore<n;)o--;g.splice(o,0,l)}}}}}while(g.length>0);return null}function k(a,b,c,d,e,f,g,h){Line2.horizontal(c.min,c.max)?a.y=a.y+(c.min.y*e+d.height>
b.y?g*(f.coll.size.y+h):-g*(f.coll.size.y+h)):a.x=a.x+(c.min.x*e>b.x?g*(f.coll.size.x+h):-g*(f.coll.size.x+h))}var l=Vec2.create(),o=Vec2.create(),m=Vec2.create(),n=Vec2.create(),p=Vec2.create();ig.NAV_DODGE_TYPE={NEUTRAL:{deltas:[-1,-4,-1,-1,-4],start:0},PASSIVE:{deltas:[1,1,2,1,1,-3],start:0},GET_AWAY:{deltas:[-1,2,-3,4,-5,6],start:3},AGGRESSIVE:{deltas:[-2,3,-4,5,-6,7,-8,9,-10],start:-2}};ig.NAV_CLOSE_POINT_SEARCH={RANDOM:function(a){Vec2.rotate(a,Math.random()*Math.PI*2)},BEHIND:function(){},
FRONT:function(a){Vec2.flip(a)},BEHIND_FACE:function(a,b){if(b){Vec2.assign(a,b.face);Vec2.flip(a)}},FRONT_FACE:function(a,b){b&&Vec2.assign(a,b.face)}};ig.perf.navigationMarker=false;ig.Navigation=ig.GameAddon.extend({tilesize:ig.CONFIG.DEFAULT_TILE_SIZE,dodgeEntities:[],cachedFailure:{},mapVersion:0,empty:true,influencers:[],init:function(){this.parent("Navigation")},isTargetReachable:function(a,b,d,e){var f=a.getCenter(l),h=b.getCenter(o);if(Vec2.distance(f,h)>d)return false;if(this.empty)return true;
if(b.jumping)return false;a=c(a);b=c(b);return!a||!b?true:g(a,b,f,h,e,4)},isPathAvailable:function(a,b){var d=a.getCenter(l),e=b.getCenter(o),f=c(a),g=c(b);return(d=j(a,f,g,d,e))&&d.nodes.length>0?true:false},isSearcherOnNode:function(a){return!!c(a)},isEntityReached:function(a,b){var d=c(a),e=c(b);return h(d,e,a.getCenter(),b.getCenter())},isPointReached:function(b,d){var e=c(b),f=a(d);return h(e,f,b.getCenter(),d,b.coll.size.x)},isPositionFree:function(b,d,e,f){var h,i,j=0;h=e.getCenter(l);i=c(e);
j=e.coll.baseZPos;d=d.coll.size;e=a(b,j);return g(i,e,h,b,f,0)&&!ig.game.isAreaBlocked(b.x-d.x/2,b.y-d.y/2,j,d.x,d.y,d.z,true)?true:false},getClosePosition:function(b,d,e,f,h,i,j,k,m,w){var n,x=0,j=j||0.5,k=k||0;if(h){n=Vec2.assign(l,h);x=h.z;h=a(n,x)}else{n=f.getCenter(l);h=c(f);x=f.coll.baseZPos}for(var s=ig.navigation.tilesize,p=s*1.5;i>=0;){var z=Vec2.sub(n,d,C);m&&m(z,f);Vec2.rotate(z,k*Math.PI*2);Vec2.length(z,i);for(var v=Math.ceil(i*Math.PI*2*j/p),q=Math.PI*2*j/v,r=1,y=0;v--;){var u=Vec2.add(n,
z,o);u.x=(Math.floor(u.x/s)+0.5)*s;u.y=(Math.floor(u.y/s)+0.5)*s;var E=a(u,x);if(g(h,E,n,u,w,0))if(ig.game.isAreaBlocked(u.x-e.x/2,u.y-e.y/2,x,e.x,e.y,e.z,true))ig.perf.navigationMarker&&ig.debugView.addMapPoint(u.x,u.y,x,8,8,"violet",2);else{ig.perf.navigationMarker&&ig.debugView.addMapPoint(u.x,u.y,x,8,8,"blue",2);Vec3.assignC(b,u.x,u.y,x);return true}else ig.perf.navigationMarker&&ig.debugView.addMapPoint(u.x,u.y,x,8,8,"red",2);y=y+q;r=r*1;Vec2.rotate(z,y*r)}i=i-p}Vec3.assignC(b,n.x,n.y,x);return false},
getDodgePosition:function(a,b,e,f,h){var h=h||ig.NAV_DODGE_TYPE.NEUTRAL,i=b.coll.pos.z,j=b.coll.size.x+8,k=b.getCenter(l),w=e.getCenter(o),x=c(b),s=Vec2.sub(k,w,n),e=Vec2.assign(p,e.coll.vel);Vec2.isZero(e)&&Vec2.assign(e,s);var z=Math.PI*2/12;Vec2.rotate90CCW(e);if(Vec2.dot(s,e)<0){Vec2.flip(e);z=-z}h.start&&Vec2.rotate(e,z*h.start);s=ig.navigation.tilesize;b=Math.ceil(Math.max(b.coll.size.x,b.coll.size.y)/s);Vec2.length(e,f);f=h.deltas;for(h=0;h<f.length+1;++h){var v=Vec2.add(h>=6?w:k,e,m);v.x=
(Math.floor(v.x/s)+0.5)*s;v.y=(Math.floor(v.y/s)+0.5)*s;var q=d(v,i,b);ig.perf.navigationMarker&&ig.debugView.addMapPoint(v.x,v.y,i,8,8,"violet",2);if(g(x,q,k,v,false,j)){Vec3.assignC(a,v.x,v.y,i);return true}h<f.length&&Vec2.rotate(e,z*f[h])}return false},clearCachedFailures:function(){this.cachedFailure={}},addCachedFailure:function(a,b,c){a&&b&&(this.cachedFailure[this._getCacheKey(a,b,c)]=true)},isCachedFailure:function(a,b,c){return!a||!b?false:this.cachedFailure[this._getCacheKey(a,b,c)]},_getCacheKey:function(a,
b,c){a=a.id+"|"+a.height+">"+b.id+"|"+b.height;b=Math.max(c.coll.size.x,c.coll.size.y);return a=a+("["+b+"|"+c.jumpingEnabled+"|"+c.coll.groundConnect+"|"+!!c.fly.height+"]")},getNavPath:function(a){return new ig.NavPath(a)},onLevelLoadStart:function(){this.influencers.length=0},onLevelLoaded:function(){this.dodgeEntities=[];this.empty=true;for(var a in ig.game.levels){var b=ig.game.levels[a];if(b.navigation){b.navigation.levelInit(a);this.empty=false}}this.connectAirNodes()},connectAirNodes:function(){for(var a=
ig.game.maxLevel;a--;){var b=ig.game.levels[a];b.navigation&&b.navigation.connectAirNodes(a)}this.applyInfluencers();this.mapVersion++;this.clearCachedFailures()},getNavBlock:function(a){return new ig.NavBlocker(a)},registerInfluencer:function(a){this.influencers.indexOf(a)==-1&&this.influencers.push(a)},applyInfluencers:function(){for(var a=this.influencers.length;a--;)this.influencers[a].onNavMapInfluence()},getNodeConnection:function(b,c,d){b=a(b);if((c=a(c))&&c.airNode)for(f=c.neighbours.length;f--;){var e=
c.neighbours[f];if(e.node!=b&&!e.node.airNode){c=e.node;break}}if(b&&c)for(var f=b.neighbours.length;f--;){e=b.neighbours[f];if(!(d!==void 0&&e.shared.type!=d)&&e.node==c)return e.shared}}});ig.NAV_BLOCKER_TYPE={REGULAR:0,NO_BLOCK:1,NO_TOP:2};ig.NavBlocker=ig.Class.extend({entity:null,pos:Vec3.create(),size:Vec3.create(),blockType:0,init:function(a,b){this.entity=a;this.blockType=b||0;this.embedInNavMap()},update:function(a){this.removeFromNavMap();this.blockType=a||0;this.embedInNavMap()},embedInNavMap:function(){var a=
this.entity.coll;Vec3.assign(this.pos,a.pos);Vec3.assign(this.size,a.size);this.blockType!=ig.NAV_BLOCKER_TYPE.NO_BLOCK&&b(this.pos.z,this.pos.z+this.size.z,this.pos,this.size,r.INCREASE,this.blockType==ig.NAV_BLOCKER_TYPE.NO_TOP)&&ig.navigation.connectAirNodes()},removeFromNavMap:function(){this.blockType!=ig.NAV_BLOCKER_TYPE.NO_BLOCK&&b(this.pos.z,this.pos.z+this.size.z,this.pos,this.size,r.DECREASE,this.blockType==ig.NAV_BLOCKER_TYPE.NO_TOP)&&ig.navigation.connectAirNodes()},remove:function(){this.removeFromNavMap();
this.entity=null}});var r={INCREASE:0,DECREASE:1,SET:2};ig.addGameAddon(function(){return ig.navigation=new ig.Navigation});var t=Vec2.create(),q=Vec2.create(),s=Vec2.create(),v=Vec3.create(),y={},u=Vec2.create(),z=Vec2.create(),D=Vec2.create(),C=Vec2.create();Vec2.create();var A=Vec3.create(),B=Vec3.create();Vec3.create();ig.NavPath=ig.Class.extend({mapVersion:0,searcher:null,startRelativeVel:0,targetEntity:null,targetPos:Vec3.create(),retargetPos:Vec3.create(),retargetNode:null,maxDistance:0,precise:false,
options:null,path:null,pathIdx:-1,pathLength:0,nextNodeData:{startPos:Vec2.create(),endPos:Vec2.create(),jump:false,height:0},overNodePass:false,pathComplete:false,triedNodePassChange:false,triedRandom:-1,doBackUp:false,triedBackUp:-1,avoidTarget:Vec2.create(),avoidTarget2:Vec2.create(),firstMovement:false,targetDir:Vec2.create(),targetDist:0,failCount:0,wrongNodeTimer:0,lastSideWayDir:Vec2.create(),init:function(a){this.searcher=a},toEntity:function(a,b,c,d){this.targetEntity=a;a.getCenter(this.targetPos);
this.maxDistance=b||0;this.options=c||{};this.precise=d||false;this.firstMovement=!this.precise;this.startRelativeVel=this.searcher.coll.relativeVel;this.searcher.faceDirFixed=false;this.redoPath()},toPoint:function(a,b,c){this.targetEntity=null;Vec3.assign(this.targetPos,a);this.maxDistance=b||0;this.precise=c||false;this.startRelativeVel=this.searcher.coll.relativeVel;this.searcher.faceDirFixed=false;this.redoPath()},redoPathDeferred:function(){this.mapVersion=-1},sideways:function(a,b,d,e,f,g,
h,i){var j=c(a),k=this.searcher.getCenter(l),a=a.getCenter(o),m=Vec2.distance(k,a);g&&m<g&&(m=g);h&&m>h&&(m=h);this._moveCircle(j,k,a,m,e,b-d,b+d,f,i)},dodge:function(a,b,c){ig.navigation.getDodgePosition(A,this.searcher,a,b,c)?this.toPoint(A,0,false):this.runAway(a,b,false)},moveRange:function(a,b,e,f,h,i){var j=c(a);if(!j)return false;var k=this.searcher.getCenter(l),a=a.getCenter(o),m=Vec2.distance(k,a),w=h?j.height:this.searcher.coll.pos.z,n=ig.navigation.tilesize,n=Math.ceil(Math.max(this.searcher.coll.size.x,
this.searcher.coll.size.y)/n),x=b;if(i&&Math.abs(m-f)<b){x=Math.abs(m-f);x<e&&(x=e)}do{i=b=0;if(m+x<=f)b=0.5;else if(m-x<f){b=Math.pow(x,2)+Math.pow(m,2)-Math.pow(f,2);b=Math.acos(b/(2*x*m))/Math.PI/2;i=1}var s=Vec2.sub(a,k,C),p=0,z=32/(Math.PI*2*x),v=1,q=Math.ceil(0.75/z);if(Vec2.areClockwise(s,this.lastSideWayDir)){b=b*-1;v=v*-1}for(;q--;){s=Vec2.sub(a,k,C);Vec2.length(s,x);Vec2.rotate(s,b*Math.PI*2);s=Vec2.add(k,s,A);s.z=w;Math.abs(Vec2.distance(s,a)-f);var r=d(s,void 0,n,true);if(r&&(!h||g(r,
j,s,a,true))){s.z=r.height;this.toPoint(s,this.searcher.coll.size.x/2,false);if(this.path){Vec2.assign(this.lastSideWayDir,s);Vec2.sub(this.lastSideWayDir,k);ig.perf.navigationMarker&&ig.debugView.addMapPoint(s.x,s.y,s.z,8,8,"blue",2);return true}ig.perf.navigationMarker&&ig.debugView.addMapPoint(s.x,s.y,s.z,8,8,"green",2)}else ig.perf.navigationMarker&&ig.debugView.addMapPoint(s.x,s.y,s.z,8,8,r?"orange":"red",2);if(i){i=i===1?2:1;b=b*-1}if(i<2){do{p=p+z;v=v*-1;b=b+p*v}while(i&&(b<-z/2||b>0.5+z/2))
}}x=x>e?Math.max(e,x-32):-1}while(x>=e);return false},runAway:function(a,b,d){for(var e=c(a),f=this.searcher.getCenter(l),a=a.getCenter(o),g=b;g>0.5*b;){if(this._moveCircle(e,f,a,g,d))break;g=g-b/8}},runToFace:function(a,b,e,f,h){var i=c(a);this.searcher.getCenter(l);var j=a.getCenter(o),k=ig.navigation.tilesize,k=Math.ceil(Math.max(this.searcher.coll.size.x,this.searcher.coll.size.y)/k),a=Vec2.assign(C,a.face);Vec2.rotate(a,b*Math.PI*2);for(b=e;b<f;){Vec2.length(a,b);e=Vec2.add(j,a,A);e.z=this.searcher.coll.pos.z;
var m=d(e,void 0,k,true);if(m&&(!h||g(m,i,e,j,true))){e.z=m.height;this.toPoint(e,this.searcher.coll.size.x/2,false);if(this.path)return true}b=b+16}return false},_moveCircle:function(a,b,c,e,f,h,i,j,k){if(!a)return false;var m=f?a.height:this.searcher.coll.pos.z,w=ig.navigation.tilesize,l=Vec2.sub(b,c,C);Vec2.length(C,e);var n=Math.random()>0.5?1:-1,o=0,e=32/(Math.PI*2*e),s=Math.ceil(1/e),n=Vec2.areClockwise(l,this.lastSideWayDir)?1:-1;if(h){o=e*(h/32);Vec2.rotate(l,Math.PI*2*o*-n);o=j?e:o*2}w=Math.ceil(Math.max(this.searcher.coll.size.x,
this.searcher.coll.size.y)/w);if(i){s=Math.ceil((i-(h||0))/32*2).limit(1,s);j&&(s=Math.ceil(s/2))}for(h=null;s--;){i=Vec2.add(c,l,A);i.z=m;var x=d(i,void 0,w,true);if(x&&(!f||g(x,a,i,c,true))){h=i;h.z=x.height;this.toPoint(h,this.searcher.coll.size.x/2,k||false);if(this.path){ig.perf.navigationMarker&&ig.debugView.addMapPoint(i.x,i.y,i.z,8,8,"blue",2);Vec2.assign(this.lastSideWayDir,h);Vec2.sub(this.lastSideWayDir,b);return true}ig.perf.navigationMarker&&ig.debugView.addMapPoint(i.x,i.y,i.z,8,8,"green",
2)}else ig.perf.navigationMarker&&ig.debugView.addMapPoint(i.x,i.y,i.z,8,8,x?"orange":"red",2);if(!j){o=o+e;n=n*-1}Vec2.rotate(l,Math.PI*2*o*-n)}return false},getDistance:function(){return this.path&&this.path.distance||0},getJumpCount:function(){return this.path&&this.path.jumpCount||0},isDestReachable:function(){return!!this.path},redoPath:function(b,d){this.mapVersion=ig.navigation.mapVersion;this.retargetNode=null;var e=c(this.searcher),f,g;if(b){f=b;Vec3.assign(this.targetPos,d);g=false}else{f=
this.targetEntity?i(this.targetPos,this.searcher,this.targetEntity,this.options):a(this.targetPos);g=this.targetEntity&&this.targetEntity.jumping}this.pathIdx=-1;if(g||ig.navigation.isCachedFailure(e,f,this.searcher))this.path=null;else{this.searcher.getCenter(H);(this.path=j(this.searcher,e,f,H,this.targetPos))||ig.navigation.addCachedFailure(e,f,this.searcher)}this.path?this.failCount=0:this.failCount++;this.overNodePass=0;this.pathComplete=false;this.triedRandom=-1;this.nextNodeData.jump=false;
this.wrongNodeTimer=0;this.searcher.cancelJump();this.searcher.faceDirFixed=false;Vec2.assignC(this.avoidTarget,0,0);Vec2.assignC(this.avoidTarget2,0,0)},interrupt:function(){this.searcher.coll.relativeVel=this.startRelativeVel;this.searcher.fly.minHeight=0;this.searcher.faceDirFixed=false},isCurrentNodeInvalid:function(){var a=c(this.searcher);return a&&!a.airNode&&(!this.path.nodes[this.pathIdx]||a!=this.path.nodes[this.pathIdx].node)&&(!this.path.nodes[this.pathIdx-1]||a!=this.path.nodes[this.pathIdx-
1].node)&&(!this.path.nodes[this.pathIdx+1]||a!=this.path.nodes[this.pathIdx+1].node)?true:false},moveEntity:function(){var b=!this.searcher.jumping&&(this.searcher.coll.float.height||this.searcher.coll.pos.z==this.searcher.coll.baseZPos),d=this.mapVersion!=ig.navigation.mapVersion;if(!d&&b&&this.path&&this.pathIdx!=-1&&!this.pathComplete)if(this.isCurrentNodeInvalid()){this.wrongNodeTimer=this.wrongNodeTimer+ig.system.tick;this.wrongNodeTimer>=0.3&&(d=true)}else this.wrongNodeTimer=0;else this.wrongNodeTimer=
0;if(d&&!this.targetEntity){Vec3.assign(this.retargetPos,this.targetPos);this.retargetNode=a(this.targetPos)}if(this.targetEntity&&!this.targetEntity.jumping){var e=i(A,this.searcher,this.targetEntity,this.options);if(e&&!e.airNode){Vec3.assign(this.retargetPos,A);this.retargetNode=e}}if(this.retargetNode&&b){Vec3.assign(this.targetPos,this.retargetPos);(d||!this.path||this.path.nodes.length==0||this.path.nodes[0].node!=this.retargetNode)&&this.redoPath(this.retargetNode,this.retargetPos);this.retargetNode=
null}if(this.searcher.coll.partlyBlockTimer>0.5)if(this.overNodePass&&!this.triedNodePassChange){this.triedNodePassChange=true;this.overNodePass=0}else if(this.triedRandom==-1){Vec2.assignC(this.avoidTarget,0,0);Vec2.assignC(this.avoidTarget2,0,0);ig.navigation.dodgeEntities.erase(this.searcher);this.searcher.faceDirFixed=true;this.doBackUp=false;this.triedRandom=0.3;Vec2.rotate(this.targetDir,(Math.random()-0.5)*Math.PI);this.searcher.coll.partlyBlockTimer=0}else this.redoPath();if(this.triedRandom>
0){this.triedRandom=this.triedRandom-ig.system.tick;if(this.triedRandom<0){this.triedRandom=0;this.searcher.faceDirFixed=false}this.doBackUp&&this.triedRandom<0.5?Vec2.assignC(this.searcher.coll.accelDir,0,0):Vec2.assign(this.searcher.coll.accelDir,this.targetDir);return false}this.searcher.getCenter(H);if(Vec2.isZero(this.avoidTarget)){ig.navigation.dodgeEntities.erase(this.searcher);if(!this.path)return true;if(this.pathComplete&&this.targetEntity&&this.pathIdx==1&&c(this.searcher)==this.path.nodes[1].node&&
!h(this.path.nodes[1].node,this.path.nodes[0].node,H,this.targetPos,this.searcher.coll.size.x))this.pathComplete=false;this.pathComplete||this.runPath();if(this.pathComplete){Vec2.assign(this.targetDir,this.targetPos);Vec2.sub(this.targetDir,H);this.targetDist=Vec2.length(this.targetDir);if(this.targetDist<=Math.max(this.precise?2:8,this.maxDistance+(this.firstMovement?16:0))){Vec2.assignC(this.targetDir,0,0);this.searcher.jumping&&Vec2.assignC(this.searcher.coll.vel,0,0);Vec2.targetDist=0;this.searcher.coll.relativeVel=
this.startRelativeVel;this.searcher.fly.minHeight=0;Vec2.assignC(this.searcher.coll.accelDir,0,0);return!this.searcher.jumping}if(this.precise&&this.searcher.coll.maxVel*this.searcher.coll.relativeVel>this.targetDist*10)this.searcher.coll.relativeVel=this.targetDist/this.searcher.coll.maxVel*10}this.firstMovement=false;this.avoidEntities();Vec2.assign(this.searcher.coll.accelDir,this.targetDir);return false}Vec2.assign(this.searcher.coll.accelDir,this.avoidTarget);Vec2.sub(this.searcher.coll.accelDir,
H);if(Vec2.length(this.searcher.coll.accelDir)<4)if(Vec2.isZero(this.avoidTarget2)){Vec2.assignC(this.avoidTarget,0,0);this.redoPath()}else{Vec2.assign(this.avoidTarget,this.avoidTarget2);Vec2.assignC(this.avoidTarget2,0,0)}},avoidEntities:function(){if(!(this.searcher.coll.type==ig.COLLTYPE.IGNORE||this.searcher.coll.ignoreCollision||this.searcher.coll.type==ig.COLLTYPE.TRIGGER)){if(!this.targetEntity){ig.game.physics.initTraceResult(y);Vec2.assign(u,this.targetDir);this.targetDist>48&&Vec2.length(u,
48);var a=[],b=this.searcher.coll;if(ig.game.traceEntity(y,this.searcher,u.x,u.y,0,0,0,ig.COLLTYPE.BLOCK,a)){var c;Vec2.normalize(u);if(Math.abs(Vec2.dot(u,y.dir))<0.8||a.length==0)return;for(var d=a.length;d--;){var e=a[d].entity;if(e instanceof ig.ActorEntity&&ig.navigation.dodgeEntities.indexOf(e)==-1){if(Vec2.isZero(e.coll.accelDir)){c=e;break}Vec2.normalize(e.coll.accelDir,C)}}if(!c)return;a=c.coll;c.getCenter(z);this.searcher.getCenter(D);Vec2.sub(z,D,C);if(Vec2.dot(C,u)<=0)return;Vec2.sub(z,
this.targetPos,C);if(Math.abs(C.x)<a.size.x/2+b.size.x/2&&Math.abs(C.y)<a.size.y/2+b.size.y/2)return;c=(a.size.x+4)/2;b=(b.size.x+4)/2;a=Vec2.assign(L,u);Vec2.normalize(a);d=Vec2.assign(M,u);Vec2.rotate90CW(d);Vec2.length(d,c+b);e=Vec2.sub(z,D,C);Vec2.dot(d,e)>0&&Vec2.flip(d);Vec2.addMulF(z,a,-c-b);Vec2.add(z,d);Vec2.assign(D,z);Vec2.addMulF(D,d,-2);Vec2.assign(u,a);Vec2.length(u,c*2+b*2);Vec2.sub(z,H,C);ig.game.physics.initTraceResult(y);if(!ig.game.traceEntity(y,this.searcher,C.x,C.y,0,0,0,null)){Vec2.sub(this.targetPos,
z,L);Vec2.length(L)<Vec2.length(u)&&Vec2.assign(u,L);ig.game.physics.initTraceResult(y);if(!ig.game.traceEntity(y,this.searcher,u.x,u.y,C.x,C.y,0,null)){Vec2.assign(this.avoidTarget,z);Vec2.assign(this.avoidTarget2,z);Vec2.add(this.avoidTarget2,u)}}if(Vec2.isZero(this.avoidTarget)){Vec2.sub(D,H,C);y.dist=1;if(!ig.game.traceEntity(y,this.searcher,C.x,C.y,0,0,0,null)){Vec2.sub(this.targetPos,D,L);Vec2.length(L)<Vec2.length(u)&&Vec2.assign(u,L);y.dist=1;if(!ig.game.traceEntity(y,this.searcher,u.x,u.y,
C.x,C.y,0,null)){Vec2.assign(this.avoidTarget,D);Vec2.assign(this.avoidTarget2,D);Vec2.add(this.avoidTarget2,u)}}}}}Vec2.isZero(this.avoidTarget)||ig.navigation.dodgeEntities.push(this.searcher)}},runPath:function(){if(this.path.nodes.length<=1)this.pathComplete=true;else{if(this.pathIdx==-1){this.pathIdx=this.path.nodes.length-1;this.overNodePass=0;this.triedNodePassChange=false;this.triedRandom=-1;this.selectNextTargetPos()}if(!this.nextNodeData.jump&&this.pathIdx==1&&h(this.path.nodes[1].node,
this.path.nodes[0].node,H,this.targetPos,this.searcher.coll.size.x)){this.searcher.coll.relativeVel=this.startRelativeVel;this.pathComplete=true}else{Vec2.assign(this.targetDir,this.overNodePass?this.nextNodeData.endPos:this.nextNodeData.startPos);Vec2.sub(this.targetDir,H);this.targetDist=Vec2.length(this.targetDir);this.searcher.coll.relativeVel=this.nextNodeData.jump&&this.overNodePass?1:this.startRelativeVel;if(this.searcher.fly.height)this.searcher.fly.minHeight=this.nextNodeData.height;if(this.targetDist<
8)if(this.nextNodeData.jump&&!this.overNodePass&&this.searcher.jumping){Vec2.sub(this.targetDir,0,0);Vec2.assignC(this.searcher.coll.vel,0,0);this.targetDist=0}else{this.overNodePass=this.overNodePass?0:1;if(!this.overNodePass){this.pathIdx--;if(this.pathIdx==0){this.searcher.coll.relativeVel=this.startRelativeVel;this.pathComplete=true;this.nextNodeData.jump=false}else{this.triedNodePassChange=false;this.selectNextTargetPos()}}}else this.nextNodeData.jump&&(this.overNodePass&&!this.searcher.jumping&&
this.isCurrentNodeInvalid())&&this.redoPath()}}},selectNextTargetPos:function(){var a=this.nextNodeData,b=this.path.nodes,c=this.pathIdx,d=this.searcher,e=this.targetPos,f=b[c].node,g=b[c].connection,h=g.edges,i=ig.navigation.tilesize,j=d.coll.size.x/2;g.type==ig.NAV_CONNECTION_TYPE.SAME_LEVEL_JUMP&&(j=8);var m=j+F;d.getCenter(H);var w=e;a.height=f.height;if(c>1){w=b[c-1].connection;a.height=b[c-1].node.height;Line2.closestEntry(J,w.waypointMin,w.waypointMax,a.height,1,H,e,j,m);w=J}for(var l=h.length,
n=void 0,o,b=-1,c=null,s=false;l--;){var x=h[l],p=s||!x.block[0]&&!x.block[1]?4:j;o=Line2.closestEntry(K,x.min,x.max,f.height,i,H,w,p,m,N);if(o!==false&&(n===void 0||n>o)){n=o;c=x;b=o==0&&!N.closeToEdge?-1:N.finalWeight<0.5?0:1;k(K,f.center,x,f,i,d,-0.5,O*2);Vec2.assign(a.startPos,K);if(g.type!=ig.NAV_CONNECTION_TYPE.SAME_LEVEL_JUMP){a.jump=false;k(K,f.center,x,f,i,d,1,O*2+(g.type==ig.NAV_CONNECTION_TYPE.LOWER_LEVEL?16:0))}else{a.jump=true;o=g.jumpInfo.destEdge;Line2.closestEntry(K,o.min,o.max,f.height,
i,H,e,p,m);k(K,a.startPos,o,f,i,d,0.5,O*2)}Vec2.assign(a.endPos,K)}if(!l&&!c&&!s){s=true;l=h.length}}(e=g.type==ig.NAV_CONNECTION_TYPE.SAME_LEVEL||g.type==ig.NAV_CONNECTION_TYPE.LOWER_LEVEL||g.type==ig.NAV_CONNECTION_TYPE.LOWER_STAIRS)&&b!=-1&&c.block[b]&&(e=false);if(e){f=Vec2.lerp(a.startPos,a.endPos,0.5,M);w=Vec2.assign(L,w);Vec2.sub(w,f);f=Vec2.sub(f,H);Vec2.angle(f,w)>Math.PI*0.4&&(e=false)}!e&&!a.jump&&!d.jumping&&Vec2.distance(H,a.startPos)<4&&(e=true);if(e){this.overNodePass=2;Vec2.lerp(this.nextNodeData.endPos,
this.nextNodeData.startPos,0.5,this.nextNodeData.endPos);if(ig.perf.navigationMarker){a=this.nextNodeData.endPos;ig.debugView.addMapPoint(a.x,a.y,this.searcher.coll.pos.z,this.searcher.coll.size.x,this.searcher.coll.size.y,"green",2)}}else{if(!this.nextNodeData.jump||!this.searcher.jumping){Vec2.assign(E,this.nextNodeData.endPos);Vec2.sub(E,this.nextNodeData.startPos);Vec2.assign(G,this.nextNodeData.startPos);Vec2.sub(G,H);if(Vec2.dot(E,G)<=0){Vec2.assign(E,this.nextNodeData.endPos);Vec2.sub(E,this.nextNodeData.startPos);
Vec2.normalize(E);Vec2.assign(G,H);Vec2.sub(G,this.nextNodeData.startPos);Vec2.mulF(E,Vec2.dot(E,G));Vec2.sub(G,E);if(Vec2.length(G)<this.searcher.coll.size.x)this.overNodePass=1}}if(ig.perf.navigationMarker){a=this.nextNodeData.startPos;ig.debugView.addMapPoint(a.x,a.y,this.searcher.coll.pos.z,this.searcher.coll.size.x,this.searcher.coll.size.y,"yellow",2);a=this.nextNodeData.endPos;ig.debugView.addMapPoint(a.x,a.y,this.searcher.coll.pos.z,this.searcher.coll.size.x,this.searcher.coll.size.y,"yellow",
2)}}if(this.nextNodeData.jump&&ig.perf.navigationMarker){a=this.nextNodeData.startPos;ig.debugView.addMapPoint(a.x,a.y,this.searcher.coll.pos.z,this.searcher.coll.size.x,this.searcher.coll.size.y,"red",2);a=this.nextNodeData.endPos;ig.debugView.addMapPoint(a.x,a.y,this.searcher.coll.pos.z,this.searcher.coll.size.x,this.searcher.coll.size.y,"blue",2)}}});var w=Vec2.create(),x=Vec3.create(),E=Vec2.create(),G=Vec2.create(),J=Vec2.create(),I=0,K=Vec2.create(),H=Vec2.create(),M=Vec2.create(),L=Vec2.create(),
N={},F=0,O=4;ig.NavExternalBlockers={blockers:[],register:function(a){this.blockers.push(a)},check:function(a,b){for(var c=this.blockers.length;c--;)if(this.blockers[c](a,b))return true;return false}}});ig.baked=!0;
ig.module("impact.feature.navigation.navigation-steps").requires("impact.feature.navigation.navigation","impact.base.action","impact.base.event").defines(function(){function b(a,b,c){if(!c)return true;if(a.maxTime&&b.stepTimer<=0&&!b.jumping){c.interrupt();return true}return c.moveEntity()&&!a.forceTime}var a=Vec3.create(),d={ENEMY:function(a,b,c,d){if(b=b.getTarget()){a.toEntity(b,c,void 0,d);return true}},PROXY_OWNER:function(a,b,c,d){if(b.combatant){a.toEntity(b.combatant,c,void 0,d);return true}},
PROXY_SRC:function(a,b,c,d){if(b.sourceEntity){a.toEntity(b.sourceEntity,c,void 0,d);return true}},COLLAB_ENTITY:function(a,b,c,d){if(b.collabAttribs&&b.collabAttribs.entity){a.toEntity(b.collabAttribs.entity,c,void 0,d);return true}},COLLAB_POINT:function(a,b,c,d){if(b.collabAttribs&&b.collabAttribs.point){a.toPoint(b.collabAttribs.point,c,d);return true}}};ig.ACTION_STEP.NAVIGATE_TO_TARGET=ig.ActionStepBase.extend({maxTime:0,forceTime:false,distance:0,planOnly:false,targetType:0,_wm:new ig.Config({attributes:{maxTime:{_type:"Number",
_info:"Maximum time spent on navigation"},forceTime:{_type:"Boolean",_info:"Keep moving, never stop until maxTime has been reached"},distance:{_type:"Number",_info:"The maximum amount of distance to the target"},planOnly:{_type:"Boolean",_info:"If true, only plan navigation, but don't execute it"},targetType:{_type:"String",_info:"Type of target",_select:d},precise:{_type:"Boolean",_info:"Reach the target precisely, slowing down accordingly"}}}),init:function(a){this.maxTime=a.maxTime||0;this.distance=
a.distance||0;this.forceTime=a.forceTime||false;this.planOnly=a.planOnly||false;this.targetType=d[a.targetType]||d.ENEMY;this.precise=a.precise||false},start:function(a){a.stepData.path=null;var b=a.nav?a.nav.path:ig.navigation.getNavPath(a);if(this.targetType(b,a,this.distance,this.precise)){a.stepTimer=a.stepTimer+this.maxTime;a.stepData.path=b}},run:function(a){return this.planOnly?true:b(this,a,a.stepData.path)}});var c={ENEMY:function(a,b,c,d){if(b=b.getTarget()){a.runAway(b,c,d);return true}},
COLLAB_ENTITY:function(a,b,c,d){if(b.collabAttribs&&b.collabAttribs.entity){a.runAway(b.collabAttribs.entity,c,d);return true}}};ig.ACTION_STEP.NAVIGATE_ESCAPE_TARGET=ig.ActionStepBase.extend({maxTime:0,maxTimeAggro:0,distance:0,throwing:false,planOnly:false,targetType:0,_wm:new ig.Config({attributes:{maxTime:{_type:"Number",_info:"Maximum time spent on navigation"},maxTimeAggro:{_type:"Number",_info:"Maximum time spent on navigation, when harder enemies is true.",_optional:true},forceTime:{_type:"Boolean",
_info:"Keep moving, never stop until maxTime has been reached"},distance:{_type:"Number",_info:"The minimum amount of distance to the target"},throwing:{_type:"Boolean",_info:"True if after escape, entity should be able to throw at target"},planOnly:{_type:"Boolean",_info:"If true, only plan navigation, but don't execute it"},targetType:{_type:"String",_info:"Type of target",_select:c}}}),init:function(a){this.maxTime=a.maxTime||0;this.maxTimeAggro=a.maxTimeAggro||0;this.forceTime=a.forceTime||false;
this.distance=a.distance||0;this.throwing=a.throwing||false;this.planOnly=a.planOnly||false;this.targetType=c[a.targetType]||c.ENEMY},start:function(a){a.stepData.path=null;var b=a.nav?a.nav.path:ig.navigation.getNavPath(a);if(this.targetType(b,a,this.distance,this.throwing)){a.stepTimer=a.stepTimer+(sc.newgame.hasHarderEnemies()&&this.maxTimeAggro?this.maxTimeAggro:this.maxTime);a.stepData.path=b}},run:function(a){return this.planOnly?true:b(this,a,a.stepData.path)}});ig.ACTION_STEP.NAVIGATE_SIDEWAYS_TARGET=
ig.ActionStepBase.extend({maxTime:0,distance:0,distVariance:0,throwing:false,planOnly:false,_wm:new ig.Config({attributes:{maxTime:{_type:"Number",_info:"Maximum time spent on navigation"},maxTimeAggro:{_type:"Number",_info:"Maximum time spent on navigation, when harder enemies is true.",_optional:true},forceTime:{_type:"Boolean",_info:"Keep moving, never stop until maxTime has been reached"},distance:{_type:"Number",_info:"The minimum amount of distance to move"},distVariance:{_type:"Number",_info:"The maximum amount of distance to move"},
keepDirection:{_type:"Boolean",_info:"If true: always move close to face direction."},throwing:{_type:"Boolean",_info:"True if after sideway movement, entity should be able to throw at target"},planOnly:{_type:"Boolean",_info:"If true, only plan navigation, but don't execute it"},forceMinTargetDistance:{_type:"Number",_info:"If defined always force this minimum distance to the target",_optional:true},precise:{_type:"Boolean",_info:"Reach the target precisely, slowing down accordingly"}}}),init:function(a){this.maxTime=
a.maxTime||0;this.maxTimeAggro=a.maxTimeAggro||0;this.forceTime=a.forceTime||false;this.distance=a.distance||0;this.distVariance=a.distVariance||0;this.throwing=a.throwing||false;this.planOnly=a.planOnly||false;this.keepDirection=a.keepDirection||false;this.forceMinTargetDistance=a.forceMinTargetDistance||0;this.forceMaxTargetDistance=a.forceMaxTargetDistance||0;this.precise=a.precise||false},start:function(a){a.stepData.path=null;var b=a.getTarget();if(b){a.stepTimer=a.stepTimer+(sc.newgame.hasHarderEnemies()&&
this.maxTimeAggro?this.maxTimeAggro:this.maxTime);var c=a.nav?a.nav.path:ig.navigation.getNavPath(a),b=a.getTarget();c.sideways(b,this.distance,this.distVariance,this.throwing,this.keepDirection,this.forceMinTargetDistance,this.forceMaxTargetDistance,this.precise);a.stepData.path=c}},run:function(a){return this.planOnly?true:b(this,a,a.stepData.path)}});var e={KEEP:0,CLOCKWISE:1,COUNTERCLOCKWISE:2};ig.ACTION_STEP.NAVIGATE_RANGE_TARGET=ig.ActionStepBase.extend({maxTime:0,maxTimeAggro:0,distance:0,
throwing:false,planOnly:false,targetType:0,_wm:new ig.Config({attributes:{maxTime:{_type:"Number",_info:"Maximum time spent on navigation"},maxTimeAggro:{_type:"Number",_info:"Maximum time spent on navigation, when harder enemies is true.",_optional:true},forceTime:{_type:"Boolean",_info:"Keep moving, never stop until maxTime has been reached"},moveDist:{_type:"Number",_info:"The (maximum) movement dist"},minMoveDist:{_type:"Number",_info:"The minimum movement dist",_optional:true},targetDistGoal:{_type:"Number",
_info:"Preferred distance to target"},throwing:{_type:"Boolean",_info:"True if after escape, entity should be able to throw at target"},avoidSideway:{_type:"Boolean",_info:"If true: avoid sideway motion by reducing movement distance"},planOnly:{_type:"Boolean",_info:"If true, only plan navigation, but don't execute it"},direction:{_type:"String",_info:"Which direciton to go sideway in",_select:e,_withNull:true}}}),init:function(a){this.maxTime=a.maxTime||0;this.maxTimeAggro=a.maxTimeAggro||0;this.forceTime=
a.forceTime||false;this.moveDist=a.moveDist||0;this.minMoveDist=a.minMoveDist||0;this.targetDistGoal=a.targetDistGoal||0;this.throwing=a.throwing||false;this.avoidSideway=a.avoidSideway||false;this.planOnly=a.planOnly||false;this.targetType=c[a.targetType]||c.ENEMY;this.direction=e[a.direction]},start:function(a){a.stepData.path=null;var b=a.nav?a.nav.path:ig.navigation.getNavPath(a),c=a.getTarget();if(c){if(this.direction){ig.CollTools.getDistVec2(a.coll,c.coll,b.lastSideWayDir);this.direction==
e.COUNTERCLOCKWISE?Vec2.rotate90CCW(b.lastSideWayDir):Vec2.rotate90CW(b.lastSideWayDir)}b.moveRange(c,this.moveDist,this.minMoveDist,this.targetDistGoal,this.throwing,this.avoidSideway);a.stepTimer=a.stepTimer+(sc.newgame.hasHarderEnemies()&&this.maxTimeAggro?this.maxTimeAggro:this.maxTime);a.stepData.path=b}},run:function(a){return this.planOnly?true:b(this,a,a.stepData.path)}});ig.ACTION_STEP.NAVIGATE_TO_ENTITY=ig.ActionStepBase.extend({entity:null,maxTime:0,distance:0,ignoreBelow:0,planOnly:false,
_wm:new ig.Config({attributes:{entity:{_type:"Entity",_info:"Entity to move to"},maxTime:{_type:"Number",_info:"Maximum time spent on navigation"},forceTime:{_type:"Boolean",_info:"Keep moving, never stop until maxTime has been reached"},distance:{_type:"Number",_info:"The entity will move as close as to this distance "},ignoreBelow:{_type:"Number",_info:"The entity will not move if distance is below this value"},planOnly:{_type:"Boolean",_info:"If true, only plan navigation, but don't execute it"},
precise:{_type:"Boolean",_info:"Reach the target precisely, slowing down accordingly"},assistSlow:{_type:"Boolean",_info:"If true: Slow down in Assist Mode"}}}),init:function(a){this.entity=a.entity;this.maxTime=a.maxTime||0;this.forceTime=a.forceTime||false;this.distance=a.distance||0;this.ignoreBelow=a.ignoreBelow||0;this.planOnly=a.planOnly||false;this.precise=a.precise||false;this.assistSlow=a.assistSlow||false},start:function(a){var b=ig.Event.getEntity(this.entity);a.stepData.path=null;if(b&&
!(a.distanceTo(b)<this.ignoreBelow)){var c=this.maxTime;this.assistSlow&&(c=c/sc.options.get("assist-attack-frequency"));a.stepTimer=a.stepTimer+c;c=a.nav?a.nav.path:ig.navigation.getNavPath(a);c.toEntity(b,this.distance,void 0,this.precise);a.stepData.path=c}},run:function(a){return this.planOnly?true:b(this,a,a.stepData.path)}});ig.ACTION_STEP.NAVIGATE_ESCAPE_ENTITY=ig.ActionStepBase.extend({entity:null,maxTime:0,distance:0,throwing:false,planOnly:false,_wm:new ig.Config({attributes:{entity:{_type:"Entity",
_info:"Entity to escape from"},maxTime:{_type:"Number",_info:"Maximum time spent on navigation"},distance:{_type:"Number",_info:"The minimum amount of distance to the target"},throwing:{_type:"Boolean",_info:"True if after escape, entity should be able to throw at target"},planOnly:{_type:"Boolean",_info:"If true, only plan navigation, but don't execute it"}}}),init:function(a){this.entity=a.entity;this.maxTime=a.maxTime||0;this.distance=a.distance||0;this.throwing=a.throwing||false;this.planOnly=
a.planOnly||false},start:function(a){var b=ig.Event.getEntity(this.entity);a.stepData.path=null;if(b){a.stepTimer=a.stepTimer+this.maxTime;var c=a.nav?a.nav.path:ig.navigation.getNavPath(a);c.runAway(b,this.distance,this.throwing);a.stepData.path=c}},run:function(a){return this.planOnly?true:b(this,a,a.stepData.path)}});ig.ACTION_STEP.NAVIGATE_DODGE=ig.ActionStepBase.extend({maxTime:0,distance:0,planOnly:false,dodgeType:null,_wm:new ig.Config({attributes:{maxTime:{_type:"Number",_info:"Maximum time spent on navigation"},
distance:{_type:"Number",_info:"The minimum amount of distance to the target"},planOnly:{_type:"Boolean",_info:"If true, only plan navigation, but don't execute it"},dodgeType:{_type:"String",_info:"Type of dodging.",_select:ig.NAV_DODGE_TYPE}}}),init:function(a){this.maxTime=a.maxTime||0;this.distance=a.distance||0;this.planOnly=a.planOnly||false;this.dodgeType=ig.NAV_DODGE_TYPE[a.dodgeType]||ig.NAV_DODGE_TYPE[a.NEUTRAL]},start:function(a){var b=a.threat||a.getTarget();a.stepData.path=null;if(b){a.stepTimer=
a.stepTimer+this.maxTime;var c=a.nav?a.nav.path:ig.navigation.getNavPath(a);c.dodge(b,this.distance,this.dodgeType);a.stepData.path=c}},run:function(a){return this.planOnly?true:b(this,a,a.stepData.path)}});ig.ACTION_STEP.NAVIGATE_TO_POINT=ig.ActionStepBase.extend({target:true,maxTime:0,distance:0,precise:false,planOnly:false,_wm:new ig.Config({attributes:{target:{_type:"Vec3",_info:"Point to navigate to",_actorOption:true,_visualize:true,_pointSelect:true},maxTime:{_type:"Number",_info:"Maximum time spent on navigation. If 0=keep executing until done."},
distance:{_type:"Number",_info:"The maximum amount of distance to the target"},precise:{_type:"Boolean",_info:"Reach the target precisely, slowing down accordingly"},planOnly:{_type:"Boolean",_info:"If true, only plan navigation, but don't execute it"},teleportOnFail:{_type:"Boolean",_info:"If navigation fails, teleport entity to target pos"}}}),init:function(a){assertContent(a,"target");this.target=a.target;this.maxTime=a.maxTime||0;this.distance=a.distance||0;this.precise=a.precise||false;this.planOnly=
a.planOnly||false;this.teleportOnFail=a.teleportOnFail||false},start:function(b){b.stepTimer=b.stepTimer+this.maxTime;var c=ig.Action.getVec3(this.target,b,a);if(c){var d=b.nav?b.nav.path:ig.navigation.getNavPath(b);d.toPoint(c,this.distance,this.precise);b.stepData.path=d;b.setRespawnPoint&&b.setRespawnPoint(c)}else b.stepData.path=null},run:function(c){if(this.planOnly)return true;var d=b(this,c,c.stepData.path);if(this.teleportOnFail&&(c.nav.path.failCount>0||this.maxTime&&c.stepTimer<=0)&&c&&
c.doQuickRespawn&&c.setRespawnPoint){d=ig.Action.getVec3(this.target,c,a);c.setRespawnPoint(d);c.doQuickRespawn(0,true);return true}return d}});ig.ACTION_STEP.DO_NAVIGATION=ig.ActionStepBase.extend({maxTime:0,_wm:new ig.Config({attributes:{maxTime:{_type:"Number",_info:"Maximum time spent on navigation"}}}),init:function(a){this.maxTime=a.maxTime||0},start:function(a){a.stepTimer=a.stepTimer+this.maxTime},run:function(a){return!a.nav?true:b(this,a,a.nav.path)}});ig.ACTION_STEP.CANCEL_IF_NAVIGATION_FAILED=
ig.ActionStepBase.extend({time:0,_wm:new ig.Config({attributes:{time:{_type:"Number",_info:"Time to wait before canceling"}}}),init:function(a){this.time=a.time;if(this.time==void 0)this.time=0.5},start:function(a){a.stepTimer=a.stepTimer+this.time},run:function(a){if(!a.nav||a.nav.path.failCount==0)return true;if(a.stepTimer>0)return false;a.cancelAction();return true}});ig.ACTION_STEP.SET_ATTRIB_CLOSE_TARGET_POS=ig.ActionStepBase.extend({name:null,distance:0,searchType:null,_wm:new ig.Config({attributes:{name:{_type:"String",
_info:"Name of actor attribute to set"},searchType:{_type:"Number",_info:"Determines where position is searched relative to target",_select:ig.NAV_CLOSE_POINT_SEARCH},distance:{_type:"Number",_info:"Preferred distance to target. Might end up being smaller"},centralAngle:{_type:"Number",_info:"How much to circle around preferred position. 1 = full circle",_default:0.7},dirRotate:{_type:"Number",_info:"Additional rotation to preferred placement direction (relative to target)",_optional:true},throwing:{_type:"Boolean",
_info:"True entity should be able to throw at target from found position"},offset:{_type:"Offset",_info:"Offset to position",_optional:true}}}),init:function(a){this.name=a.name;this.searchType=ig.NAV_CLOSE_POINT_SEARCH[a.searchType]||ig.NAV_CLOSE_POINT_SEARCH.RANDOM;this.distance=a.distance||32;this.centralAngle=a.centralAngle||0.7;this.dirRotate=a.dirRotate||0;this.throwing=a.throwing||false;this.offset=a.offset||null},run:function(b){var c=Vec3.create(),d=b.getTarget();if(d){ig.navigation.getClosePosition(c,
b.getAlignedPos(ig.ENTITY_ALIGN.BOTTOM,a),b.coll.size,d,null,this.distance,this.centralAngle,this.dirRotate,this.searchType,this.throwing);this.offset&&Vec3.add(c,this.offset);b.setAttribute(this.name,c)}return true}});ig.ACTION_STEP.SET_ATTRIB_TARGET_DELTA_POS=ig.ActionStepBase.extend({name:null,distance:0,searchType:null,_wm:new ig.Config({attributes:{name:{_type:"String",_info:"Name of actor attribute to set"},searchType:{_type:"Number",_info:"Determines where position is searched relative to target",
_select:ig.NAV_CLOSE_POINT_SEARCH},distance:{_type:"Number",_info:"Preferred distance to target. Might end up being smaller"},centralAngle:{_type:"Number",_info:"How much to circle around preferred position. 1 = full circle",_default:0.7},dirRotate:{_type:"Number",_info:"Additional rotation to preferred placement direction (relative to target)",_optional:true},throwing:{_type:"Boolean",_info:"True entity should be able to throw at target from found position"},offset:{_type:"Offset",_info:"Offset to position",
_optional:true}}}),init:function(a){this.name=a.name;this.searchType=ig.NAV_CLOSE_POINT_SEARCH[a.searchType]||ig.NAV_CLOSE_POINT_SEARCH.RANDOM;this.distance=a.distance||32;this.centralAngle=a.centralAngle||0.7;this.dirRotate=a.dirRotate||0;this.throwing=a.throwing||false;this.offset=a.offset||null},run:function(b){var c=Vec3.create(),d=b.getTarget();if(d){ig.navigation.getClosePosition(c,b.getAlignedPos(ig.ENTITY_ALIGN.BOTTOM,a),b.coll.size,d,null,this.distance,this.centralAngle,this.dirRotate,this.searchType,
this.throwing);this.offset&&Vec3.add(c,this.offset);b.setAttribute(this.name,c)}return true}});ig.ACTION_STEP.SET_ATTRIB_NAV_TARGET_POS=ig.ActionStepBase.extend({name:null,distance:0,searchType:null,_wm:new ig.Config({attributes:{name:{_type:"String",_info:"Name of actor attribute to set"}}}),init:function(a){this.name=a.name},run:function(a){if(a.nav&&a.nav.path&&a.nav.path.targetPos){a.setAttribute(this.name,a.nav.path.targetPos);return true}}})});ig.baked=!0;
ig.module("impact.feature.navigation.plug-in").requires("impact.feature.navigation.nav-map","impact.feature.navigation.navigation","impact.feature.navigation.navigation-steps").defines(function(){});ig.baked=!0;
ig.module("impact.feature.map-content.map-style").requires("impact.base.game").defines(function(){ig.MAP_STYLES={};ig.MapStyle=ig.GameAddon.extend({currentStyle:null,_wmLoad:true,init:function(){this.parent("MapStyle")},get:function(b){if(ig.MAP_STYLES[this.currentStyle]&&ig.MAP_STYLES[this.currentStyle][b])return ig.MAP_STYLES[this.currentStyle][b];if(ig.MAP_STYLES["default"])return ig.MAP_STYLES["default"][b]},levelLoadStartOrder:100,onLevelLoadStart:function(b){this.currentStyle=b.attributes&&
b.attributes.mapStyle}});ig.MapStyle.registerStyle=function(b,a,d){ig.MAP_STYLES[b]||(ig.MAP_STYLES[b]={});ig.MAP_STYLES[b][a]=d};ig.addGameAddon(function(){return ig.mapStyle=new ig.MapStyle})});ig.baked=!0;
ig.module("impact.feature.map-content.entities.hidden-block").requires("impact.base.entity").defines(function(){ig.ENTITY.HiddenBlock=ig.Entity.extend({terrain:0,_wm:new ig.Config({spawnable:true,attributes:{shape:{_type:"String",_info:"Height-Shape of Block Entity",_select:ig.COLLSHAPE},heightShape:{_type:"String",_info:"Height-Shape of Block Entity",_select:ig.COLL_HEIGHT_SHAPE},zHeight:{_type:"Number"},terrain:{_type:"String",_info:"Terrain of prop",_select:ig.TERRAIN,_withNull:true},spawnCondition:{_type:"VarCondition",
_info:"Condition for prop to appear",_popup:true},collType:{_type:"String",_info:"Default is BLOCK",_optional:true,_select:ig.COLLTYPE},blockNavMap:{_type:"Boolean",__info:"If true, block path map and update when destroyed",_optional:true}},label:function(){return""},drawBox:true,scalableX:true,scalableY:true,boxColor:"rgba(0,255,255, 0.5)",frontColor:"rgba(0,120,120, 0.8)"}),init:function(b,a,d,c){this.parent(b,a,d,c);this.coll.type=ig.COLLTYPE[c.collType]||ig.COLLTYPE.BLOCK;c.size||this.coll.setSize(32,
32,0);this.coll.shape=ig.COLLSHAPE[c.shape||"RECTANGLE"];this.coll.heightShape=ig.COLL_HEIGHT_SHAPE[c.heightShape]||0;this.terrain=ig.TERRAIN[c.terrain]||null;this.coll.size.z=c.zHeight||0;this.blockNavMap=c.blockNavMap},show:function(b){this.parent(b);if(this.blockNavMap)this.navBlocker=ig.navigation.getNavBlock(this)},onHideRequest:function(){if(this.navBlocker){this.navBlocker.remove();this.navBlocker=null}this.hide()}});ig.ENTITY.HiddenSkyBlock=ig.Entity.extend({terrain:0,_wm:new ig.Config({spawnable:true,
attributes:{shape:{_type:"String",_info:"Height-Shape of Block Entity",_select:ig.COLLSHAPE},spawnCondition:{_type:"VarCondition",_info:"Condition for prop to appear",_popup:true},collType:{_type:"String",_info:"Default is BLOCK",_select:ig.COLLTYPE,_default:"NPBLOCK"}},label:function(){return""},drawBox:true,scalableX:true,scalableY:true,boxColor:"rgba(0,255,255, 0.9)",frontColor:"rgba(0,120,120, 0.8)"}),init:function(b,a,d,c){this.parent(b,a,d,c);this.coll.type=ig.COLLTYPE[c.collType]||ig.COLLTYPE.BLOCK;
this.coll.shape=ig.COLLSHAPE[c.shape||"RECTANGLE"];c.size||this.coll.setSize(32,32,0);if(!window.wm){this.coll.pos.z=this.coll.pos.z-1E3;this.coll.size.z=2E3}}})});ig.baked=!0;
ig.module("impact.feature.map-content.entities.door").requires("impact.base.entity","impact.base.actor-entity","impact.feature.map-content.entities.hidden-block","impact.feature.base.entities.object-layer-view","impact.feature.effect.effect-sheet").defines(function(){ig.DOOR_TYPE={};ig.DOOR_TYPE.DEFAULT={anims:null,preWait:0,size:{x:32,y:16,z:48}};var b={REGULAR:1,INTER_AREA:2};ig.DOOR_OPEN_SOUND={NORMAL:new ig.Sound("media/sound/puzzle/door-open.mp3"),STONE:new ig.Sound("media/sound/environment/stone-door-small.mp3"),
CLOTH:new ig.Sound("media/sound/environment/cloth-door.ogg",0.6),EVO:new ig.Sound("media/sound/environment/evo-village-door.ogg")};ig.ENTITY.Door=ig.AnimatedEntity.extend({doorType:null,condition:null,map:"",marker:"",dir:"SOUTH",doorMat:null,active:false,openTimer:0,hasDoorMat:false,hasDoorGlow:false,hideManager:null,blockEvent:null,blockEventCondition:null,openEffect:null,sounds:{activate:new ig.Sound("media/sound/puzzle/door-activate-2.mp3"),deactivate:new ig.Sound("media/sound/puzzle/door-deactivate.ogg")},
fx:{sheet:new ig.EffectSheet("map.door")},openSound:null,_wm:new ig.Config({spawnable:true,attributes:{doorType:{_type:"String",_info:"Type of door",_select:ig.DOOR_TYPE},condition:{_type:"VarCondition",_info:"Condition for the door to open",_popup:true},dir:{_type:"String",_info:"View direction of door.",_select:ig.ActorEntity.FACE4,_default:"SOUTH"},map:{_type:"Maps",_info:"Map to be loaded",_context:"Map"},marker:{_type:"Marker",_info:"Marker on map to teleport player to"},hideCondition:{_type:"VarCondition",
_info:"Condition for entity to become transparent",_popup:true},blockEvent:{_type:"Event",_info:"Event to be performed when entering the door",_popup:true,_optional:true},blockEventCondition:{_type:"VarCondition",_info:"Condition to show the block event when entering this door",_popup:true},variation:{_type:"DoorVariations",_info:"Variation of door"},transitionType:{_type:"String",_info:"Type of transition.",_select:b},narrow:{_type:"Boolean",_info:"If true: spawn player and party more narrow",_optional:true}},
label:function(){return"[ "+this.condition+" ]\n"+this.map+" > "+this.marker}}),init:function(a,d,c,e){this.parent(a,d,c,e);this.doorType=ig.DOOR_TYPE[e.doorType]||ig.DOOR_TYPE.DEFAULT;this.transitionType=b[e.transitionType]||b.REGULAR;this.coll.type=ig.COLLTYPE.BLOCK;this.coll.setSize(this.doorType.size.x,this.doorType.size.y,this.doorType.size.z);this.coll.time.globalStatic=true;this.narrow=e.narrow;if(this.doorType.openEffect){a=this.doorType.openEffect;if(this.transitionType==b.REGULAR&&this.doorType.openEffectFast)a=
this.doorType.openEffectFast;this.openEffect=new ig.EffectHandle(a)}this.map=e.map;this.marker=e.marker;this.dir=e.dir||"SOUTH";a=this.coll;if(this.doorType.anims){this.hasDoorMat=false;this.dir="SOUTH";this.initAnimations(this.doorType.anims)}else{var d=ig.mapStyle.get("map"),f=this.dir=="NORTH"?4:0,c=d.doorVariations&&d.doorVariations[e.variation],g=this.dir=="EAST"||this.dir=="WEST";this.hasDoorMat=d.hasDoorMat&&this.map;this.hasDoorGlow=!!d.doorGlow;this.openSound=ig.DOOR_OPEN_SOUND[d.doorSound]||
ig.DOOR_OPEN_SOUND.NORMAL;var h=0,i=0;if(c){h=c.x||0;i=c.y||0;this.hasDoorMat=(c.doorMat!=void 0?c.doorMat:this.hasDoorMat)&&this.map}if(g){f={shapeType:"Y_FLAT",offset:{x:this.dir=="WEST"?-8:8,y:0,z:0},namedSheets:{door:{src:d.sheet,width:16,height:96,offX:h+128,offY:i,xCount:1}},sheet:"door",tileOffset:f,flipX:this.dir=="EAST",SUB:[{name:"idle",time:1,frames:[0],repeat:false},{name:"open",time:1,frames:[0],repeat:false},{name:"close",time:1,frames:[0],repeat:false}]};if(d.doorGlow){f.namedSheets.glow=
{src:d.sheet,width:16,height:96,xCount:1,offX:d.doorGlow.sideX,offY:d.doorGlow.sideY};f.SUB.push({time:1,frames:[0],tileOffset:0,sheet:"glow",SUB:[{name:"idle"},{name:"open"},{name:"close"}]})}}else{f={shapeType:"Y_FLAT",offset:{x:0,y:this.dir=="NORTH"?-15:0,z:0},namedSheets:{door:{src:d.sheet,width:32,height:48,xCount:4,offX:h,offY:i}},sheet:"door",tileOffset:f,SUB:[{name:"idle",time:1,frames:[0],repeat:false},{name:"open",time:0.04,frames:[1,2,3],repeat:false},{name:"close",time:0.04,frames:[2,
1],repeat:false}]};if(d.doorGlow){g=d.doorGlow;if(c&&c.doorGlow)g=c.doorGlow;f.namedSheets.glow={src:d.sheet,width:32,height:48,xCount:g.xCount,offX:g.x,offY:g.y};f.SUB.push({name:"idle",time:1,frames:[this.dir=="NORTH"?1:0],tileOffset:0,sheet:"glow"})}}this.initAnimations(f);switch(this.dir){case "NORTH":this.animState.alpha=0.8;break;case "WEST":a.size.x=16;a.size.y=32;break;case "EAST":a.size.x=16;a.size.y=32}}this.condition=new ig.VarCondition(e.condition);this.active=this.condition.evaluate();
if(e.blockEvent){this.blockEvent=new ig.Event({name:"DOOR BLOCK EVENT",steps:e.blockEvent});this.blockEventCondition=new ig.VarCondition(e.blockEventCondition||"true")}this.setCurrentAnim("idle");if(e.hideCondition)this.hideManager=new ig.EntityHideManager(e.hideCondition)},onKill:function(a){this.parent(a);this.openEffect&&this.openEffect.clearCached()},show:function(a){this.parent(a);a=this.coll;if(this.hasDoorMat){var b=a.pos.x,c=a.pos.y;switch(this.dir){case "NORTH":c=c-a.size.y;break;case "WEST":b=
b-a.size.x}this.doorMat=ig.game.spawnEntity(ig.DoorMat,b,c,a.pos.z,{dir:this.dir,active:this.active})}if(!this.map)if(this.dir=="NORTH"||this.dir=="SOUTH"){ig.game.spawnEntity("HiddenBlock",a.pos.x,a.pos.y,a.pos.z,{size:{x:4,y:a.size.y},zHeight:a.size.z});ig.game.spawnEntity("HiddenBlock",a.pos.x+a.size.x-4,a.pos.y,a.pos.z,{size:{x:4,y:a.size.y},zHeight:a.size.z})}else{ig.game.spawnEntity("HiddenBlock",a.pos.x,a.pos.y,a.pos.z,{size:{x:a.size.x,y:4},zHeight:a.size.z});ig.game.spawnEntity("HiddenBlock",
a.pos.x,a.pos.y+a.size.y-4,a.pos.z,{size:{x:a.size.x,y:4},zHeight:a.size.z})}},update:function(){this.hideManager&&this.hideManager.update(this);if(this.hasDoorGlow&&this.sprites.length>1){var a=this.sprites[1];a.setGfxCut(!this.active?a.size.y+a.size.z:0,0)}if(this.openTimer){if(this.getOverlappingEntities(true).length>(this.map?0:2))this.openTimer=1;this.openTimer=this.openTimer-ig.system.tick;this.openTimer<=0&&this.close()}this.parent()},close:function(){this.openTimer=0;this.setCurrentAnim("close",
true,"idle");this.map||this.coll.setType(ig.COLLTYPE.BLOCK)},open:function(a,d){if(!this.openTimer){!this.openEffect&&this.openSound&&(a?this.openSound.play():ig.SoundHelper.playAtEntity(this.openSound,this));this.animSheet.hasAnimation("openFast")&&this.transitionType==b.REGULAR?this.setCurrentAnim("openFast",true):this.setCurrentAnim("open",true);this.map||this.coll.setType(ig.COLLTYPE.TRIGGER)}this.openTimer=d?d:1+this.doorType.preWait;this.openEffect&&this.openEffect.spawnOnTarget(this)},varsChanged:function(){var a=
this.condition.evaluate();if(this.active!=a){this.active=a;this.doorMat&&this.doorMat.setActive(this.active);if(this.hasDoorGlow&&this.active){this.fx.sheet.spawnOnTarget("doorActivateGlow",this,{spriteFilter:[1]});(a=this.sprites[1])&&a.setGfxCut(0,0)}if(this.active)this.sounds.activate.play();else{this.sounds.deactivate.play();this.openTimer&&this.close()}}},collideWith:function(a,d){var c=Vec2.sub(a.getCenter(),this.getCenter()),e=this.coll;if(this.dir=="SOUTH"&&Math.abs(c.x)<e.size.x/2||this.dir==
"NORTH"&&Math.abs(c.x)<e.size.x/2||this.dir=="EAST"&&Math.abs(c.y)<e.size.y/2||this.dir=="WEST"&&Math.abs(c.y)<e.size.y/2)if(this.active&&!this.map&&a instanceof ig.ActorEntity)this.open();else if(this.map&&ig.game.isPlayerTouch(this,a,d)&&ig.game.isInterruptible()&&!sc.model.isMapLeaveBlocked()&&a.coll.pos.z==this.coll.pos.z)if(this.blockEvent&&this.blockEventCondition.evaluate())sc.Cutscene.startCutscene(this.blockEvent);else if(this.active){if(this.transitionType==b.INTER_AREA){ig.game.setTeleportColor(255,
255,255,false);ig.game.setTeleportTime(1,1);sc.combat.forceEnd();ig.bgm.isPlayingDefault()&&ig.bgm.pause("SLOW")}this.coll.ignoreCollision=true;this.open(true);c=this.getEnterEventData(a);c.steps.push({type:"TELEPORT",map:this.map,marker:this.marker});c=new ig.Event(c);ig.game.events.callEvent(c,ig.EventRunType.BLOCKING)}},enterEntity:function(a){this.open();var b=this.getEnterActionData(a),b=new ig.Action("doorAction",b);a.setAction(b)},leaveEntity:function(){this.open()},getEnterActionData:function(a){var b=
[{type:"SET_TERRAIN_FRICTION_IGNORE",value:true},{type:"SET_SLIP_THROUGH",value:true},{type:"SET_FACE_FIX",value:false},{type:"SET_RELATIVE_SPEED",value:0.5},{type:"MOVE_TO_POINT",target:this.getStartPoint(a)},{type:"MOVE_TO_POINT",target:this.getEndPoint(a)},{type:"WAIT",time:1}];a instanceof ig.ENTITY.Combatant&&b.unshift({type:"SET_WALK_ANIMS",config:"normal"});return b},getEnterEventData:function(a){var d={steps:[{type:"DO_ACTION",entity:a,action:this.getEnterActionData(a)}]};if(this.doorType.preWait){d.steps.unshift({type:"WAIT",
time:!this.doorType.preWaitFast||this.transitionType==b.INTER_AREA?this.doorType.preWait:this.doorType.preWaitFast});var c=this.getCenter();c.y=c.y+(this.coll.size.y/2+a.coll.size.y/2+8);d.steps.unshift({type:"DO_ACTION",entity:a,action:[{type:"SET_TERRAIN_FRICTION_IGNORE",value:true},{type:"SET_SLIP_THROUGH",value:true},{type:"SET_WALK_ANIMS",config:"normal"},{type:"SET_FACE_TO_ENTITY",entity:this,rotate:true},{type:"SET_FACE_FIX",value:true},{type:"SET_RELATIVE_SPEED",value:0.5},{type:"MOVE_TO_POINT",
target:c,precise:true},{type:"SET_FACE",face:"NORTH",rotate:true}]})}return d},getStartPoint:function(a){var b=this.getCenter(),c=this.coll,a=a.coll;switch(this.dir){case "NORTH":b.y=b.y-(c.size.y/2-a.size.y/2);break;case "SOUTH":b.y=b.y+(c.size.y/2-a.size.y/2);break;case "EAST":b.x=b.x+(c.size.x/2-a.size.x/2);break;case "WEST":b.x=b.x-(c.size.x/2-a.size.x/2)}return b},getEndPoint:function(){var a=this.getCenter(),b=this.coll;switch(this.dir){case "NORTH":a.y=a.y+b.size.y/2;break;case "SOUTH":a.y=
a.y-b.size.y/2;break;case "EAST":a.x=a.x-b.size.x/2;break;case "WEST":a.x=a.x+b.size.x/2}return a},applyMarkerPosition:function(a){var b=this.coll;a.coll.level=b.level;a.coll.baseZPos=b.baseZPos;a.coll.pos.z=b.pos.z;ig.ActorEntity.getFaceVec(ig.ActorEntity.FACE8[this.dir]||0,a.face);var c=b.pos.x+b.size.x/2-a.coll.size.x/2,e=b.pos.y+b.size.y/2-a.coll.size.y/2,f=this.narrow?48:16;switch(this.dir){case "NORTH":e=e-(b.size.y/2+f);break;case "SOUTH":e=e+(b.size.y/2+f);break;case "WEST":c=c-(b.size.x/
2+f);break;case "EAST":c=c+(b.size.x/2+f)}a.setPos(c,e)}});ig.DoorMat=ig.AnimatedEntity.extend({dir:"SOUTH",isActive:false,init:function(a,b,c,e){this.parent(a,b,c,e);this.coll.type=ig.COLLTYPE.NONE;this.coll.setSize(32,32,0);this.coll.time.globalStatic=true;this.dir=e.dir;this.isActive=e.active||false;a=ig.mapStyle.get("map");this.initAnimations({sheet:{src:a.sheet,width:32,height:32,offY:96,xCount:5},tileOffset:this.dir=="EAST"||this.dir=="WEST"?0:5,flipX:this.dir=="EAST",flipY:this.dir=="NORTH",
SUB:[{name:"active",time:1,frames:[4],repeat:false},{name:"inactive",time:1,frames:[0],repeat:false},{name:"activate",time:0.06,frames:[1,2,3,3,3],repeat:false},{name:"deactivate",time:0.06,frames:[3,2,1],repeat:false}]});this.setCurrentAnim(this.isActive?"active":"inactive")},setActive:function(a){if(a!=this.isActive)(this.isActive=a)?this.setCurrentAnim("activate",true,"active"):this.setCurrentAnim("deactivate",true,"inactive")}})});ig.baked=!0;
ig.module("impact.feature.map-content.entities.stair-door").requires("impact.base.entity","impact.base.actor-entity","impact.feature.map-content.entities.hidden-block","impact.feature.base.entities.object-layer-view").defines(function(){var b={UPWARDS_EAST:{up:true,flip:false},UPWARDS_WEST:{up:true,flip:true},DOWNWARDS_EAST:{down:true,flip:false},DOWNWARDS_WEST:{down:true,flip:true}},a=Vec3.create(),d=Vec3.create(),c=Vec2.create(),e=Vec2.create(),f={REGULAR:1,INTER_AREA:2};ig.ENTITY.TeleportStairs=
ig.Entity.extend({gfx:null,map:"",marker:"",stairType:b.UPWARDS_EAST,blockEvent:null,blockEventCondition:null,spawnDistance:0,transitionType:0,npcRunnerProb:0,centerWalkThrough:false,objMaps:null,_wm:new ig.Config({spawnable:true,attributes:{stairType:{_type:"String",_info:"View direction of teleport ground.",_select:b},map:{_type:"Maps",_info:"Map to be loaded",_context:"Map"},marker:{_type:"Marker",_info:"Marker on map to teleport player to"},blockEvent:{_type:"Event",_info:"Event to be performed when entering the teleport ground",
_popup:true,_optional:true},blockEventCondition:{_type:"VarCondition",_info:"Condition to show the block event when entering this teleport ground"},npcRunnerProb:{_type:"Number",_info:"Probability that NPCs will enter and leave through this exit"},layer:{_type:"String",_info:"Object layer from which to display surrounding stuff",_select:{object1:1,object2:1,object3:1},_withNull:true},transitionType:{_type:"String",_info:"Type of transition.",_select:f}},label:function(){return this.map+" > "+this.marker+
"\n\n\n"},drawBox:true,boxColor:"rgba(255,255,0, 0.5)",frontColor:"rgba(120,120,0, 0.8)",alwaysRecreate:true}),init:function(a,c,d,e){this.parent(a,c,d,e);this.coll.type=ig.COLLTYPE.BLOCK;this.coll.setSize(32,16,48);this.transitionType=f[e.transitionType]||f.REGULAR;this.map=e.map;this.marker=e.marker;this.stairType=b[e.stairType]||b.UPWARDS_EAST;if(a=e.layer)this.objMaps=ig.game.getObjectMaps(a);if((a=ig.mapStyle.get("map"))&&a.stairDoor)this.gfx=new ig.Image(a.sheet);this.npcRunnerProb=e.npcRunnerProb||
0;if(e.blockEvent){this.blockEvent=new ig.Event({name:"DOOR BLOCK EVENT",steps:e.blockEvent});this.blockEventCondition=new ig.VarCondition(e.blockEventCondition||"true")}},onKill:function(a){this.parent(a);this.gfx&&this.gfx.decreaseRef()},initSprites:function(){var b=1;Vec3.assign(a,this.coll.pos);a.x=a.x-16;Vec3.assignC(d,64,16,64);this.objMaps&&(b=b+ig.ObjectLayerTools.getSpriteCount(this,this.objMaps,a,d));this.setSpriteCount(b)},updateSprites:function(){if(!this.spritesInitialized){Vec3.assign(a,
this.coll.pos);a.x=a.x-16;Vec3.assignC(d,64,16,64);if(!this.objMaps||ig.ObjectLayerTools.updateSprites(this,this.objMaps,0,null,a,d)){this.spritesInitialized=true;var b=ig.mapStyle.get("map");if(b&&b.stairDoor){var c=this.sprites.last();c.setEntityDefault(this,32,48,ig.ANIM_SHAPE_TYPE.Z_FLAT,0,null,this.gfx,b.stairDoor.x+(this.stairType.down?32:0),b.stairDoor.y);c.setFlip(this.stairType.flip,false)}}}},collideWith:function(a,b){if(this.map&&ig.game.isPlayerTouch(this,a,b)&&ig.game.isInterruptible()&&
a.coll.pos.z==this.coll.pos.z)if(this.blockEvent&&this.blockEventCondition.evaluate())sc.Cutscene.startCutscene(this.blockEvent);else{this.coll.ignoreCollision=true;if(this.transitionType==f.INTER_AREA){ig.game.setTeleportColor(255,255,255,false);ig.game.setTeleportTime(1,1);sc.combat.forceEnd();ig.bgm.isPlayingDefault()&&ig.bgm.pause("SLOW")}var c=this.getEnterActionData(a),c=new ig.Event({steps:[{type:"DO_ACTION",entity:a,action:c},{type:"WAIT",time:0.4},{type:"TELEPORT",map:this.map,marker:this.marker}]});
ig.game.events.callEvent(c,ig.EventRunType.BLOCKING)}},enterEntity:function(a){var b=this.getEnterActionData(a,true),b=new ig.Action("doorAction",b);a.setAction(b)},leaveEntity:function(){},getEnterActionData:function(a){var a=[{type:"SET_TERRAIN_FRICTION_IGNORE",value:true},{type:"SET_SLIP_THROUGH",value:true},{type:"SET_WALK_ANIMS",config:"normal"},{type:"SET_FACE_FIX",value:false},{type:"SET_RELATIVE_SPEED",value:0.5},{type:"MOVE_TO_POINT",target:this.getStartPoint(a)},{type:"SHOW_ANIMATION",anim:"move",
viaWalkConfig:true},{type:"SET_FACE",value:0.2,face:"NORTH"},{type:"SET_FACE_FIX",value:true}],b,d,f;if(this.stairType.up){c.y=-16;c.x=8;e.y=-40;e.x=24;b=this.stairType.flip?"NORTH_WEST":"NORTH_EAST";f=d=0.4}else{c.y=-8;c.x=8;e.y=-4;e.x=24;d=0.2;f=0.3;b=this.stairType.flip?"NORTH_WEST":"NORTH_EAST"}if(this.stairType.flip){c.x=-c.x;e.x=-e.x}var k=Vec2.add(this.getCenter(),c),l=Vec2.add(this.getCenter(),e);a.push.apply(a,[{type:"SET_RELATIVE_SPEED",value:d},{type:"MOVE_TO_POINT",target:k},{type:"SET_RELATIVE_SPEED",
value:f},{type:"SET_FACE",value:0.2,face:b},{type:"MOVE_TO_POINT",target:l},{type:"WAIT",time:1}]);return a},getStartPoint:function(a){var b=this.getCenter();b.y=b.y+(this.coll.size.y/2-a.coll.size.y/2+4);return b},applyMarkerPosition:function(a){var b=this.coll;a.coll.level=b.level;a.coll.baseZPos=b.baseZPos;a.coll.pos.z=b.pos.z;ig.ActorEntity.getFaceVec(ig.ActorEntity.FACE8[this.dir]||0,a.face);Vec2.flip(a.face);var c=b.pos.x+b.size.x/2-a.coll.size.x/2,d=b.pos.y+b.size.y/2-a.coll.size.y/2,d=d+(b.size.y/
2+16);a.setPos(c,d)},getRunnerDestination:function(){return!this.npcRunnerProb||!this.map?null:{entries:[{entity:this,dir:this.dir,type:sc.NPC_RUNNER_DEST_TYPE.ENTER_EXIT,posType:sc.NPC_RUNNER_DEST_POS_TYPE.SIDE}],enterProb:this.npcRunnerProb,exitProb:this.npcRunnerProb,map:this.map}}})});ig.baked=!0;
ig.module("game.feature.npc.entities.npc-waypoint").requires("impact.base.actor-entity").defines(function(){sc.WPConnection=ig.Class.extend({owner:null,connections:null,initialized:false,connectedWPs:[],middle:false,searchData:{idx:0,cameFrom:null,gScore:-1,fScore:-1,closed:null},init:function(b,a){this.owner=b;this.connections=a||[];this.middle=b instanceof ig.ENTITY.NPCWaypoint},_initWaypoints:function(){if(!this.initialized){this.initialized=true;for(var b=0;b<this.connections.length;++b){var a=
ig.Event.getEntity(this.connections[b]);a&&this.connectedWPs.push(a.getWPConnect())}for(b=this.connectedWPs.length;b--;)this.connectedWPs[b].addWayPoint(this)}},addWayPoint:function(b){this._initWaypoints();this.connectedWPs.indexOf(b)==-1&&this.connectedWPs.push(b)},getDistance:function(b){return ig.CollTools.getGroundDistance(this.owner.coll,b.owner.coll)},getWayPointConnections:function(){this._initWaypoints();return this.connectedWPs},getSearchData:function(b){if(b!=this.searchData.idx){this.searchData.idx=
b;this.searchData.cameFrom=null;this.searchData.gScore=-1;this.searchData.fScore=-1;this.searchData.closed=false}return this.searchData}});sc.NpcWayPointSearcher={searchIndex:0,resetIndex:function(){this.searchIndex=0},searchConnection:function(b,a){this.searchIndex++;var d=[b],c=b.getSearchData(this.searchIndex);c.gScore=0;for(c.fScore=b.getDistance(a);d.length>0;){var c=d.pop(),e=c.getSearchData(this.searchIndex);if(c==a)return this._reconstructPath(b,a);e.closed=true;for(var f=c.getWayPointConnections(),
g=f.length;g--;){var h=f[g],i=h.getSearchData(this.searchIndex),j=e.gScore+h.getDistance(c),k=i.gScore;if(h.middle||h==a)if(!(i.closed&&j>=k)&&(k==-1||j<k)){k!=-1&&d.erase(h);i.cameFrom=c;i.gScore=j;j=j+h.getDistance(a);i.fScore=j;for(i=d.length;i&&d[i-1].getSearchData(this.searchIndex).fScore<j;)i--;d.splice(i,0,h)}}}return null},_reconstructPath:function(b,a){for(var d=[],c=a;c!=b;){c!=a&&d.unshift(c.owner);c=c.getSearchData(this.searchIndex).cameFrom}return d}};ig.ENTITY.NPCWaypoint=ig.Entity.extend({name:"",
wpConnection:null,_wm:new ig.Config({spawnable:true,attributes:{connections:{_type:"Array",_info:"Connections to other stuff",_sub:{_type:"EntitySelect",_filter:function(b){return b.getWPConnect}}}},scalableX:true,scalableY:true,label:function(){return""},drawBox:true,boxColor:"rgba(120,120,255, 0.25)"}),init:function(b,a,d,c){this.parent(b,a,d,c);this.coll.type=ig.COLLTYPE.NONE;this.coll.setUpdateType(ig.COLL_UPDATE_TYPE.STATIC);this.wpConnection=new sc.WPConnection(this,c.connections)},initWayPoints:function(){this.wpConnection._initWaypoints()},
getWPConnect:function(){return this.wpConnection}})});ig.baked=!0;
ig.module("impact.feature.map-content.entities.teleport-ground").requires("impact.base.entity","impact.base.actor-entity","impact.feature.map-content.entities.hidden-block","impact.feature.base.entities.object-layer-view","game.feature.npc.entities.npc-waypoint").defines(function(){var b={REGULAR:1,INTER_AREA:2};ig.ENTITY.TeleportGround=ig.Entity.extend({map:"",marker:"",dir:"SOUTH",blockEvent:null,blockEventCondition:null,spawnDistance:0,transitionType:0,npcRunnerProb:0,centerWalkThrough:false,wpConnection:null,
_wm:new ig.Config({spawnable:true,attributes:{zHeight:{_type:"Number",_default:64},dir:{_type:"String",_info:"View direction of teleport ground.",_select:ig.ActorEntity.FACE4,_default:"SOUTH"},map:{_type:"Maps",_info:"Map to be loaded",_context:"Map"},marker:{_type:"Marker",_info:"Marker on map to teleport player to"},spawnDistance:{_type:"Number",_info:"Distance to place player away from teleportGround when spawning",_default:48},blockEvent:{_type:"Event",_info:"Event to be performed when entering the teleport ground",
_popup:true,_optional:true},blockEventCondition:{_type:"VarCondition",_info:"Condition to show the block event when entering this teleport ground",_popup:true},transitionType:{_type:"String",_info:"Type of transition.",_select:b},npcRunnerProb:{_type:"Number",_info:"Probability that NPCs will enter and leave through this exit"},centerWalkThrough:{_type:"Boolean",_info:"If entity should always walk through the center of this opening"},spawnCondition:{_type:"VarCondition",_info:"Condition for teleporter to appear",
_popup:true}},scalableX:true,scalableY:true,label:function(){return this.map+" > "+this.marker},drawBox:true,boxColor:"rgba(255,255,0, 0.5)",frontColor:"rgba(120,120,0, 0.8)"}),init:function(a,d,c,e){this.parent(a,d,c,e);this.coll.type=ig.COLLTYPE.BLOCK;e.size?this.coll.size.z=e.zHeight:this.coll.setSize(8,8,e.zHeight||64);this.map=e.map;this.marker=e.marker;this.dir=e.dir||"SOUTH";this.spawnDistance=e.spawnDistance||48;this.transitionType=b[e.transitionType]||b.REGULAR;this.centerWalkThrough=e.centerWalkThrough||
false;this.npcRunnerProb=e.npcRunnerProb||0;if(e.blockEvent){this.blockEvent=new ig.Event({name:"DOOR BLOCK EVENT",steps:e.blockEvent});this.blockEventCondition=new ig.VarCondition(e.blockEventCondition||"true")}this.wpConnection=new sc.WPConnection(this)},collideWith:function(a,d){if(this.map&&ig.game.isPlayerTouch(this,a,d)&&ig.game.isInterruptible()&&!sc.model.isMapLeaveBlocked()&&a.coll.pos.z==this.coll.pos.z)if(this.blockEvent&&this.blockEventCondition.evaluate())sc.Cutscene.startCutscene(this.blockEvent);
else{if(this.transitionType==b.INTER_AREA){ig.game.setTeleportColor(255,255,255,false);ig.game.setTeleportTime(1,1);sc.combat.forceEnd();ig.bgm.isPlayingDefault()&&ig.bgm.pause("SLOW")}this.coll.ignoreCollision=true;var c=this.getEnterActionData(a),c=new ig.Event({steps:[{type:"DO_ACTION",entity:a,action:c},{type:"TELEPORT",map:this.map,marker:this.marker}]});ig.game.events.callEvent(c,ig.EventRunType.BLOCKING)}},enterEntity:function(a){var b=this.getEnterActionData(a,true),b=new ig.Action("doorAction",
b);a.setAction(b)},leaveEntity:function(){},getEnterActionData:function(){var a=[{type:"SET_SLIP_THROUGH",value:true},{type:"SET_WALK_ANIMS",config:"normal"},{type:"SET_FACE_FIX",value:true},{type:"SET_FACE",face:this.dir},{type:"SET_Z_GRAVITY_FACTOR",value:0},{type:"SET_JUMPING",value:false},{type:"MOVE_FORWARD",time:2},{type:"WAIT",time:-1}];if(this.centerWalkThrough){a.splice(0,0,{type:"SET_RELATIVE_SPEED",value:0.5});a.splice(4,0,{type:"MOVE_TO_POINT",target:this.getCenter()})}return a},applyMarkerPosition:function(a){var b=
this.coll;a.coll.level=b.level;a.coll.baseZPos=b.baseZPos;a.coll.pos.z=b.pos.z;ig.ActorEntity.getFaceVec(ig.ActorEntity.FACE8[this.dir]||0,a.face);Vec2.flip(a.face);var c=b.pos.x+b.size.x/2-a.coll.size.x/2,e=b.pos.y+b.size.y/2-a.coll.size.y/2;switch(this.dir){case "NORTH":e=e+(b.size.y/2+this.spawnDistance);break;case "SOUTH":e=e-(b.size.y/2+this.spawnDistance);break;case "WEST":c=c+(b.size.x/2+this.spawnDistance);break;case "EAST":c=c-(b.size.x/2+this.spawnDistance)}a.setPos(c,e)},getRunnerDestination:function(){return!this.npcRunnerProb||
!this.map?null:{entries:[{entity:this,dir:this.dir,type:sc.NPC_RUNNER_DEST_TYPE.ENTER_EXIT,posType:sc.NPC_RUNNER_DEST_POS_TYPE.SIDE}],enterProb:this.npcRunnerProb,exitProb:this.npcRunnerProb,map:this.map}},getWPConnect:function(){return this.wpConnection}})});ig.baked=!0;
ig.module("impact.feature.map-content.entities.glowing-ground").requires("impact.base.entity").defines(function(){ig.ENTITY.GlowingGround=ig.Entity.extend({color1:"",color2:"",duration:1,timer:0,colorGfx:null,_wm:new ig.Config({spawnable:true,attributes:{color1:{_type:"String",_info:"First color of interpolation"},color2:{_type:"String",_info:"Second color of interpolation"},duration:{_type:"Number",_info:"Duration of color interpolation (back and forth)"}},scalableX:true,scalableY:true,label:function(){return""}}),
init:function(b,a,d,c){this.parent(b,a,d,c);this.coll.type=ig.COLLTYPE.NONE;c.size||this.coll.setSize(32,32,0);this.color1=c.color1;this.color2=c.color2;this.duration=c.duration?c.duration:1;this.colorGfx=new ig.TransitionColor(this.color1,this.color2)},initSprites:function(){this.setSpriteCount(1)},update:function(){this.timer=this.timer+ig.system.tick;this.timer=this.timer%this.duration},updateSprites:function(){var b=this.timer/this.duration;this.colorGfx.setColorBWeight(b<0.5?b*2:(1-b)*2);b=this.coll;
this.sprites[0].setPos(b.pos.x,b.pos.y,b.pos.z);this.sprites[0].setSize(b.size.x,b.size.y,b.size.z);this.sprites[0].setImageSrc(this.colorGfx,0,0)}})});ig.baked=!0;
ig.module("impact.feature.map-content.entities.prop").requires("impact.base.entity").defines(function(){ig.PropSheet=ig.JsonLoadable.extend({cacheType:"PropSheet",props:{},onCacheCleared:function(){},getJsonPath:function(){return ig.root+this.path.toPath("data/props/",".json")+ig.getCacheSuffix()},onload:function(b){if(b.DOCTYPE!="PROP_SHEET")throw Error("Invalid JSON Format for PropSheet");for(var b=b.props,a=0;a<b.length;++a)this.handlePropEntry(b[a])},handlePropEntry:function(b){if(b.name){var a=
b.name;delete b.name;this.props[a]=b}else if(b.sequence){var a=b.sequence,d=a.entries,c=a.sheet;delete b.sequence;for(var e=0;e<d.length;++e){var f=d[e],g={},a=f.name;delete f.name;ig.merge(g,b);ig.merge(g,f);g.fix={gfx:c.gfx,x:c.x+c.w*e,y:c.y,w:c.w,h:c.h,flipX:false};this.props[a]=g}}},getProp:function(b){return this.props[b]}});sc.PropCollideSounds={};sc.PropCollideSounds.PLANT=new ig.Sound("media/sound/environment/plant-shake.ogg",0.7,0.2);ig.PROP_INTERACT_CLASS=null;ig.LANG_CONTEXT.Prop=function(b){var a=
"PROP[";b.settings.propType&&(a=a+b.settings.propType.name);return a+"]"};ig.ENTITY.Prop=ig.AnimatedEntity.extend({terrain:0,face:Vec2.create(),propSet:null,propName:null,propAnim:null,nudging:{active:false,timer:0,variance:0.01,onFall:false},collideSound:null,condAnims:null,touchVar:null,_triggered:false,shuffleAnims:false,interact:null,currentInteract:null,ballKill:null,effects:{initPerma:false,sheet:null,show:null,hide:null,hideHandle:null,showOverload:null,hideOverload:null,permaEffect:null,permaHandle:null,
interactPermaHandle:null},_wm:new ig.Config({spawnable:true,attributes:{propType:{_type:"PropType",_info:"Type of prop"},propAnim:{_type:"EntityAnim",_info:"Animation of prop"},condAnims:{_type:"CondAnims",_info:"Animations shown by conditions"},spawnCondition:{_type:"VarCondition",_info:"Condition for prop to appear",_popup:true},touchVar:{_type:"VarName",_info:"Variable to be changed when prop is touched",_optional:true},interact:{_type:"PropInteract",_info:"Interaction for this property",_popup:true,
_optional:true},showEffect:{_type:"Effect",_info:"Effect to show when showing entity",_optional:true},hideEffect:{_type:"Effect",_info:"Effect to show when hiding entity",_optional:true},permaEffect:{_type:"Effect",_info:"Effect to be shown permanently",_optional:true},hideCondition:{_type:"VarCondition",_info:"Condition for entity to become transparent",_optional:true}},label:function(){return""},drawBox:true,boxColor:"rgba(255,255,0, 0.5)"}),init:function(b,a,d,c){this.parent(b,a,d,c);this.coll.type=
ig.COLLTYPE.NONE;this.coll.setSize(32,32,0);this.touchVar=c.touchVar||null;this.propAnim=c.propAnim||"default";b=c.condAnims;this.effects.showOverload=c.showEffect?new ig.EffectHandle(c.showEffect):null;this.effects.hideOverload=c.hideEffect?new ig.EffectHandle(c.hideEffect):null;this.effects.permaEffect=c.permaEffect?new ig.EffectHandle(c.permaEffect):null;if(c.hideCondition)this.hideManager=new ig.EntityHideManager(c.hideCondition);if(b&&b.length>0){this.condAnims=[];for(a=0;a<b.length;++a){d=null;
b[a].interact&&ig.PROP_INTERACT_CLASS&&(d=new ig.PROP_INTERACT_CLASS(this,b[a].interact));this.condAnims.push({condition:new ig.VarCondition(b[a].condition),anim:b[a].anim,interact:d})}}else if(!this.hideManager)this.varsChanged=null;if(c.interact&&ig.PROP_INTERACT_CLASS)this.interact=new ig.PROP_INTERACT_CLASS(this,c.interact);if(c.propType&&c.propType.name&&c.propType.sheet){this.propName=c.propType.name;if(window.IS_IT_CUBAUM&&c.propType.sheet=="autumn"&&this.propName.indexOf("tree")!=-1)this.propName=
"cubaum";this.propSheet=new ig.PropSheet(c.propType.sheet);this.propSheet.addLoadListener(this)}},show:function(b){this.parent(b);if(this.effects.hideHandle){this.effects.hideHandle.stop();this.effects.hideHandle=null}if(this.effects.permaEffect)this.effects.initPerma=true;if(this.currentInteract&&this.currentInteract.onShow())this.effects.initPerma=true;this.effects.initPerma&&this.coll.setUpdateType(ig.COLL_UPDATE_TYPE.DYNAMIC);this._triggered=false;if(!b&&(this.effects.sheet||this.effects.showOverload)){this.animState.alpha=
0;this.effects.showOverload?this.effects.showOverload.spawnOnTarget(this,{}):this.effects.sheet.spawnOnTarget(this.effects.show,this,{})}},initPermaEffects:function(){this.effects.initPerma=false;if(this.effects.permaEffect)this.effects.permaHandle=this.effects.permaEffect.spawnOnTarget(this,{duration:-1});this.currentInteract&&this.currentInteract.onPermaUpdate()},onHideRequest:function(){this.currentInteract&&this.currentInteract.onHide();this.effects.permaHandle&&this.effects.permaHandle.stop();
this.effects.permaHandle=null;if(this.effects.sheet||this.effects.hideOverload){this.effects.hideHandle=this.effects.hideOverload?this.effects.hideOverload.spawnOnTarget(this,{callback:this}):this.effects.sheet.spawnOnTarget(this.effects.hide,this,{callback:this});this.coll.setUpdateType(ig.COLL_UPDATE_TYPE.DYNAMIC)}else this.hide()},initSprites:function(){this.setSpriteCount(1)},onLoadableComplete:function(b){if(!b)throw Error("Loading Failed!");if(b=this.propSheet.getProp(this.propName)){if(window.wm){this._wm=
this._wm.copy();this._wm.drawBox=false}Vec3.assign(this.coll.size,b.size);this.coll.type=ig.COLLTYPE[b.collType]||this.coll.type;this.coll.shape=ig.COLLSHAPE[b.shapeType]||ig.COLLSHAPE.RECTANGLE;this.coll.shadow.size=b.shadow||0;this.shuffleAnims=b.shuffleAnims||false;if(b.ballKill)this.ballKill={fx:b.ballKill.fx?new ig.EffectHandle(b.ballKill.fx):null};if(b.nudging){this.nudging.active=true;this.nudging.variance=Math.PI*2*(b["nudge-variance"]?b["nudge-variance"]:0.015);this.nudging.timer=new ig.WeightTimer(false);
if(this.coll.type!=ig.COLLTYPE.BLOCK)this.coll.type=ig.COLLTYPE.TRIGGER;this.collideSound=b.collideSound||sc.PropCollideSounds.PLANT}if(b.floatHeight)this.coll.float.height=b.floatHeight;if(b.floatVariance)this.coll.float.height=b.floatVariance;if(b.effects){this.effects.sheet=new ig.EffectSheet(b.effects.sheet);this.effects.hide=b.effects.hide;this.effects.show=b.effects.show}this.terrain=ig.TERRAIN[b.terrain]||0;this.coll.zGravityFactor=b.zGravityFactor||0;if(b.anims)this.initAnimations(b.anims);
else{if(this.hideManager)this.hideManager.efficientMode=true;this.effects.initPerma||this.coll.setUpdateType(ig.COLL_UPDATE_TYPE.STATIC);this.fixDraw={image:new ig.Image(b.fix.gfx),x:b.fix.x,y:b.fix.y,w:b.fix.w,h:b.fix.h,flipX:b.fix.flipX,flipY:b.fix.flipY,wallY:b.fix.wallY,aboveZ:b.fix.aboveZ||0,shape:ig.ANIM_SHAPE_TYPE[b.fix.shape||"NO_EXPAND"],pivot:{x:b.fix.pivotX,y:b.fix.pivotY},offX:b.fix.offX||0,offY:b.fix.offY||0,renderMode:b.fix.renderMode||null};if(this.fixDraw.pivot.x===void 0)this.fixDraw.pivot.x=
this.fixDraw.w/2;if(this.fixDraw.pivot.y===void 0)this.fixDraw.pivot.y=this.fixDraw.h/2}this._updateAnimations()}},setCurrentAnim:function(b,a,d,c,e){this.fixDraw||this.coll.setUpdateType(ig.COLL_UPDATE_TYPE.DYNAMIC);ig.AnimatedEntity.prototype.setCurrentAnim.call(this,b,a,d,c,e)},onKill:function(b){this.parent(b);this.propSheet&&this.propSheet.decreaseRef();this.fixDraw&&this.fixDraw.image.decreaseRef();this.interact&&this.interact.onKill();this.effects.sheet&&this.effects.sheet.decreaseRef();this.effects.showOverload&&
this.effects.showOverload.clearCached();this.effects.hideOverload&&this.effects.hideOverload.clearCached();this.effects.permaEffect&&this.effects.permaEffect.clearCached();this.ballKill&&this.ballKill.fx&&this.ballKill.fx.clearCached();if(this.condAnims)for(b=this.condAnims.length;b--;)this.condAnims[b].interact&&this.condAnims[b].interact.onKill()},update:function(){if(this.effects.initPerma){this.initPermaEffects();this.fixDraw&&this.coll.setUpdateType(ig.COLL_UPDATE_TYPE.STATIC)}this.hideManager&&
this.hideManager.update(this);if(this.nudging.timer&&!this.nudging.timer.done()){this.nudging.timer.tick();if(this.nudging.timer.repeatCount>=1){this.nudging.timer.set(0);this.fixDraw&&this.coll.setUpdateType(ig.COLL_UPDATE_TYPE.STATIC)}}this.parent();if(!this.fixDraw&&!this.nudging.timer&&(!this.hideManager||!this.hideManager.isBusy())&&this.animState.isStatic()){if(this.hideManager)this.hideManager.efficientMode=true;this.coll.setUpdateType(ig.COLL_UPDATE_TYPE.STATIC)}},onEffectEvent:function(b){if(b==
this.effects.hideHandle&&b.isDone()){this.effects.hideHandle=null;this.hide()}},updateSprites:function(){var b=0,a=0;if(this.nudging.timer&&!this.nudging.timer.done()){b=this.nudging.timer.get();if(this.nudging.onFall){a=Math.sin(Math.PI*b)*2;b=this.nudging.variance*Math.sin(Math.PI*b)}else b=this.nudging.variance*b}if(this.animSheet){this.animState.angle=b;ig.AnimatedEntity.prototype.updateSprites.call(this)}else if(this.fixDraw){var d=this.sprites[0];d.setEntityDefault(this,this.fixDraw.w,this.fixDraw.h,
this.fixDraw.shape||"NO_EXPAND",this.fixDraw.wallY,null,this.fixDraw.image,this.fixDraw.x,this.fixDraw.y);d.aboveZ=this.fixDraw.aboveZ||0;d.setFlip(this.fixDraw.flipX,this.fixDraw.flipY);d.setPivot(this.fixDraw.pivot.x,this.fixDraw.pivot.y);if(this.fixDraw.renderMode)d.renderMode=this.fixDraw.renderMode;d.setTransform(this.animState.scaleX,this.animState.scaleY,b);d.setAlpha(this.animState.alpha);d.setGfxOffset(this.fixDraw.offX,this.fixDraw.offY+a);this.animState.updateSpriteColor(this)}else this.sprites[0].setInvisible()},
collideWith:function(b){if(this.touchVar&&b==ig.game.playerEntity&&!this._triggered){this._triggered=true;ig.vars.set(this.touchVar,true)}this.nudging&&(b.coll.type==ig.COLLTYPE.PROJECTILE||this.coll.type==ig.COLLTYPE.BLOCK||this.nudge(b==ig.game.playerEntity))},onGroundAdd:function(b){this.nudge(b==ig.game.playerEntity,true)},nudge:function(b,a){if(this.nudging.timer&&this.nudging.timer.done()){b&&this.collideSound&&ig.SoundHelper.playAtEntity(this.collideSound,this,false,{fadeDuration:0.25});this.coll.setUpdateType(ig.COLL_UPDATE_TYPE.DYNAMIC);
this.nudging.onFall=a||false;a?this.nudging.timer.set(0.15,ig.TIMER_MODE.ONCE):this.nudging.timer.set(0.3,ig.TIMER_MODE.SINUS_RND)}},untriggerProp:function(){this._triggered=false},varsChanged:function(){this.hideManager&&this.hideManager.varsChanged(this);this._updateAnimations()},changeInteract:function(b){if(this.currentInteract!=b){if(!this._hidden&&this.currentInteract)this.currentInteract.onHide();this.currentInteract=b;if(!this._hidden&&this.currentInteract&&this.currentInteract.onShow()){this.effects.initPerma=
true;this.coll.setUpdateType(ig.COLL_UPDATE_TYPE.DYNAMIC)}}},ballHit:function(b){if(!this.ballKill||!b.isBall)return false;this.ballKill.fx&&this.ballKill.fx.spawnOnTarget(this,{});var a=b.getHitCenter(this);sc.combat.showHitEffect(this,a,sc.ATTACK_TYPE.NONE,b.getElement(),false,false,false);return true},_updateAnimations:function(){if(this.condAnims)for(var b=this.condAnims.length;b--;){var a=this.condAnims[b];if(a.condition.evaluate()){if(!this.fixDraw){this.setCurrentAnim(a.anim,true,null,true);
this.coll.setUpdateType(ig.COLL_UPDATE_TYPE.DYNAMIC)}this.changeInteract(a.interact||this.interact);this.shuffleAnims&&this.animState.shuffleTime();return}}this.changeInteract(this.interact);if(!this.fixDraw){this.setCurrentAnim(this.propAnim);this.coll.setUpdateType(ig.COLL_UPDATE_TYPE.DYNAMIC)}this.shuffleAnims&&this.animState.shuffleTime()}});ig.ENTITY.Prop.staticNavBlock=true});ig.baked=!0;
ig.module("impact.feature.map-content.entities.scalable-prop").requires("impact.base.entity").defines(function(){ig.ScalePropSheet=ig.JsonLoadable.extend({cacheType:"ScalablePropSheet",entries:{},onCacheCleared:function(){},getJsonPath:function(){return ig.root+this.path.toPath("data/scale-props/",".json")+ig.getCacheSuffix()},onload:function(a){if(a.DOCTYPE!="SCALABLE_PROP_SHEET")throw Error("Invalid JSON Format for ScalablePropSheet");this.entries=a.entries},getScalableProp:function(a){return this.entries[a]}});
var b={west:{xAdd:true,wSub:true},east:{wSub:true,right:true},north:{yAdd:true,hSub:true,top:true},south:{hSub:true,bottom:true}};ig.ENTITY.ScalableProp=ig.AnimatedEntity.extend({terrain:0,propConfig:null,scalePropSheet:null,hasSize:false,gfx:null,patternSheet:null,patternOffset:{x:0,y:0},pivot:null,wallY:0,renderHeight:0,renderMode:null,gfxEnds:[],animFrames:null,animTime:null,timePadding:0,timer:0,touchVar:null,_triggered:false,effects:{sheet:null,show:null,hide:null,hideHandle:null},_wm:new ig.Config({spawnable:true,
attributes:{propConfig:{_type:"ScalablePropConfig",_info:"Type of Scalable Prop"},patternOffset:{_type:"Vec2",_info:"Start offset of the repeating pattern in pixels"},timeOffset:{_type:"Number",_info:"Time offset of the animation"},spawnCondition:{_type:"VarCondition",_info:"Condition for prop to appear",_popup:true},touchVar:{_type:"VarName",_info:"Variable to be changed when prop is touched",_optional:true},blockNavMap:{_type:"Boolean",__info:"If true, block path map and update when destroyed"},
hideCondition:{_type:"VarCondition",_info:"Condition for entity to become transparent",_optional:true}},label:function(){return""},drawBox:true,boxColor:"rgba(255,255,0, 0.5)"}),init:function(a,b,c,e){this.parent(a,b,c,e);this.coll.type=ig.COLLTYPE.NONE;this.touchVar=e.touchVar||null;e.size?this.hasSize=true:this.coll.setSize(32,32,0);e.patternOffset&&Vec2.assign(this.patternOffset,e.patternOffset);this.timer=e.timeOffset||0;this.blockNavMap=e.blockNavMap;e.hideCondition?this.hideManager=new ig.EntityHideManager(e.hideCondition):
this.varsChanged=null;if(e.propConfig&&e.propConfig.name&&e.propConfig.sheet){this.propConfig=e.propConfig;this.scalePropSheet=new ig.ScalePropSheet(e.propConfig.sheet);this.scalePropSheet.addLoadListener(this)}},show:function(a){this.parent(a);if(this.effects.hideHandle){this.effects.hideHandle.stop();this.effects.hideHandle=null}this._triggered=this.coll.ignoreCollision=false;if(!a&&this.effects.sheet){this.animState.alpha=0;this.effects.sheet.spawnOnTarget(this.effects.show,this,{})}if(this.blockNavMap)this.navBlocker=
ig.navigation.getNavBlock(this);this.skyBlock&&!this.skyBlockEntity&&this.createSkyBlock()},createSkyBlock:function(){var a=this.coll;this.skyBlockEntity=ig.game.spawnEntity(ig.ENTITY.HiddenSkyBlock,a.pos.x,a.pos.y,a.pos.z,{size:Vec2.create(this.coll.size)});this.skyBlockEntity.coll.setType(this.coll.type)},onHideRequest:function(){this.navBlocker&&this.navBlocker.remove();this.navBlocker=null;this.coll.ignoreCollision=true;if(this.skyBlockEntity){this.skyBlockEntity.kill();this.skyBlockEntity=null}if(this.effects.sheet){this.effects.hideHandle=
this.effects.sheet.spawnOnTarget(this.effects.hide,this,{callback:this});this.coll.setUpdateType(ig.COLL_UPDATE_TYPE.DYNAMIC)}else this.hide()},onLoadableComplete:function(a){if(!a)throw Error("Loading Failed!");var d=this.coll;if(a=this.scalePropSheet.getScalableProp(this.propConfig.name)){if(window.wm){this._wm=this._wm.copy();this._wm.drawBox=false;this._wm.scalableX=a.scalableX;this._wm.scalableY=a.scalableY;this._wm.scalableStep=a.scalableStep}if(this.hasSize){if(!a.scalableX&&d.size.x!=a.baseSize.x||
(d.size.x-a.baseSize.x)%a.scalableStep!=0){d.size.x=a.baseSize.x;d.size.y=a.baseSize.y}if(!a.scalableY&&d.size.y!=a.baseSize.y||(d.size.y-a.baseSize.y)%a.scalableStep!=0){d.size.x=a.baseSize.x;d.size.y=a.baseSize.y}}else Vec2.assign(d.size,a.baseSize);if(a.ballKill)this.ballKill={fx:a.ballKill.fx?new ig.EffectHandle(a.ballKill.fx):null};d.size.z=a.baseSize.z;this.coll.setType(ig.COLLTYPE[a.collType]||this.coll.type);this.wallY=a.wallY||0;this.terrain=ig.TERRAIN[a.terrain]||0;this.renderHeight=d.size.z;
if(a.renderHeight!=void 0)this.renderHeight=a.renderHeight;this.renderMode=a.renderMode;this.animFrames=a.animFrames||null;this.animTime=a.animTime||0.1;this.timePadding=a.timePadding||null;if(a.effects){this.effects.sheet=new ig.EffectSheet(a.effects.sheet);this.effects.hide=a.effects.hide;this.effects.show=a.effects.show}this.pivot=a.pivot||null;this.skyBlock=a.skyBlock;var c=a.patterns,d=a.gfxBaseX||0,e=a.gfxBaseY||0;this.patternSheet=new ig.ImagePatternSheet(a.gfx,a.scalableX?a.scalableY?ig.ImagePattern.OPT.REPEAT_X_AND_Y:
ig.ImagePattern.OPT.REPEAT_X:ig.ImagePattern.OPT.REPEAT_Y,c.w,c.h,d+(c.x||0),e+(c.y||0),c.xCount||1,c.yCount||1);this.gfx=new ig.Image(a.gfx);if(c=this.propConfig.ends)for(var f in a.gfxEnds){var g=a.gfxEnds[f][c[f]];if(g){g={x:g.x,y:g.y,w:g.w,h:g.h,zHeight:g.zHeight==void 0?this.renderHeight:g.zHeight,offX:g.offX,offY:g.offY,flipX:g.flipX||false,flipY:g.flipY||false,animFrames:g.animFrames||null,renderMode:g.renderMode||null,fullBack:g.fullBack||false};ig.merge(g,b[f]);g.x=g.x+d;g.y=g.y+e;this.gfxEnds.push(g)}}this.setSpriteCount(1+
this.gfxEnds.length);if(!this.animFrames&&!this.animTime&&!this.timePadding){if(this.hideManager)this.hideManager.efficientMode=true;this.coll.setUpdateType(ig.COLL_UPDATE_TYPE.STATIC)}}},initSprites:function(){this.setSpriteCount(1+this.gfxEnds.length)},onKill:function(a){this.navBlocker&&this.navBlocker.remove();this.parent(a);this.scalePropSheet&&this.scalePropSheet.decreaseRef();this.patternSheet&&this.patternSheet.decreaseRef();this.effects.sheet&&this.effects.sheet.decreaseRef();this.ballKill&&
this.ballKill.fx&&this.ballKill.fx.clearCached();this.gfx&&this.gfx.decreaseRef()},update:function(){this.skyBlock&&(!this.skyBlockEntity&&!this.effects.hideHandle)&&this.createSkyBlock();this.hideManager&&this.hideManager.update(this);this.parent();if(this.animFrames||this.timePadding)this.timer=this.timer+ig.system.tick},onEffectEvent:function(a){if(a==this.effects.hideHandle&&a.isDone()){this.effects.hideHandle=null;!this.animFrames&&(!this.animTime&&!this.timePadding)&&this.coll.setUpdateType(ig.COLL_UPDATE_TYPE.STATIC);
this.hide()}},updateSprites:function(){var a=this.coll;if(this.patternSheet){var b=0,c=0,e=0;if(this.animFrames)var f=this.animFrames.length*this.animTime,f=Math.floor(this.timer%f/this.animTime),b=this.animFrames[f];for(var g=a.pos.x,h=a.pos.y,i=0,j=0,k=a.size.x,l=a.size.y,o=false,m=0;m<this.gfxEnds.length;++m){var n=this.gfxEnds[m],p=a.pos.z,r=n.zHeight;if(n.top&&!n.fullBack){p=p+this.renderHeight;r=r-this.renderHeight}var t=n.h-r;this.sprites[m].setPos(a.pos.x+(n.right?a.size.x-n.w:0),a.pos.y+
(n.bottom?a.size.y-t:0),p);this.sprites[m].setSize(n.w,t,r,Math.round(this.wallY)*t);this.sprites[m].setPivot(n.w/2,(t+r)/2);p=n.x;r=n.y;f=b;if(n.animFrames){f=n.animFrames.length*this.animTime;f=Math.floor(this.timer%f/this.animTime);f=n.animFrames[f]}if(f)var q=n.xCount||100,p=p+f%q*n.w,r=r+Math.floor(f/q)*n.h;this.sprites[m].setImageSrc(this.gfx,p,r);this.sprites[m].setFlip(n.flipX,n.flipY);n.xAdd&&(i=i+n.w);n.yAdd&&(j=j+t);n.wSub&&(k=k-n.w);n.hSub&&(l=l-t);this.sprites[m].renderMode=n.renderMode||
this.renderMode;this.sprites[m].setAlpha(this.animState.alpha);this.sprites[m].setGfxOffset(n.offX||0,n.offY||0);this.sprites[m].setTransform(this.animState.scaleX,this.animState.scaleY,this.animState.angle);o=n.bottom||o}if(this.timePadding){c=Math.floor(this.timer*this.timePadding.x);e=Math.floor(this.timer*this.timePadding.y)}a=this.renderHeight;n=this.coll.pos.z;if(this.gfxEnds&&o){n=n+a;a=0}this.sprites[m].setPos(g+i,h+j,n);if(k>0&&l>0){this.sprites[m].setSize(k,l,a,Math.round(this.wallY)*l);
this.sprites[m].setPivot(k*(this.pivot?this.pivot.x:0.5),(l+a)*(this.pivot?this.pivot.y:0.5));this.sprites[m].setImageSrc(this.patternSheet.getPattern(b),this.patternOffset.x+c,this.patternOffset.y+e);this.sprites[m].renderMode=this.renderMode;this.sprites[m].setAlpha(this.animState.alpha);this.sprites[m].setTransform(this.animState.scaleX,this.animState.scaleY,this.animState.angle)}else this.sprites[m].setInvisible();this.animState.updateSpriteColor(this)}else for(m=0;m<this.sprites.length;++m)this.sprites[m].setInvisible()},
collideWith:function(a){if(this.touchVar&&a==ig.game.playerEntity&&!this._triggered){this._triggered=true;ig.vars.set(this.touchVar,true)}},varsChanged:function(){this.hideManager&&this.hideManager.varsChanged(this)},ballHit:function(a){if(!this.ballKill||!a.isBall)return false;this.ballKill.fx&&this.ballKill.fx.spawnOnTarget(this,{});var b=a.getHitCenter(this);sc.combat.showHitEffect(this,b,sc.ATTACK_TYPE.NONE,a.getElement(),false,false,false);return true}});ig.ENTITY.ScalableProp.staticNavBlock=
true});ig.baked=!0;
ig.module("impact.feature.map-content.entities.note").requires("impact.base.entity").defines(function(){ig.ENTITY.Note=ig.Entity.extend({text:"",_wm:new ig.Config({spawnable:true,attributes:{zHeight:{_type:"Number",_default:0},text:{_type:"String",_info:"Text to display in information.",_large:true}},scalableX:true,scalableY:true,drawBox:true,label:function(){return this.text},boxColor:"rgba(30, 30, 30, 1)",frontColor:"rgba(0, 0, 0, 1)"}),init:function(b,a,d,c){this.parent(b,a,d,c);this.coll.type=
ig.COLLTYPE.NONE;c.size?this.coll.size.z=c.zHeight||0:this.coll.setSize(32,32,c.zHeight||0);this.text="\n"+c.text||""}})});ig.baked=!0;
ig.module("impact.feature.map-content.map-content-steps").requires("impact.base.action","impact.base.event").defines(function(){ig.EVENT_STEP.NUDGE_PROP=ig.EventStepBase.extend({prop:null,playSound:false,_wm:new ig.Config({attributes:{prop:{_type:"Entity",_info:"Prop Entity",_filterClass:"Prop",_visualize:true},playSound:{_type:"Boolean",_info:"True if the nudge sound should be played"}}}),init:function(b){assertContent(b,"prop");this.prop=b.prop;this.playSound=b.playSound||false},start:function(b,
a){var d=ig.Event.getEntity(this.prop,a);d.nudge&&d.nudge(this.playSound)}});ig.EVENT_STEP.OPEN_DOOR=ig.EventStepBase.extend({door:null,_wm:new ig.Config({attributes:{door:{_type:"Entity",_info:"Door Entity to enter"},openTime:{_type:"Number",_info:"Time in seconds to leave the door open",_optional:true}}}),init:function(b){this.door=b.door;this.openTime=b.openTime},start:function(){var b=ig.Event.getEntity(this.door);b&&b.open&&b.open(false,this.openTime)}});ig.EVENT_STEP.CLOSE_DOOR=ig.EventStepBase.extend({door:null,
_wm:new ig.Config({attributes:{door:{_type:"Entity",_info:"Door Entity to close"}}}),init:function(b){this.door=b.door},start:function(){var b=ig.Event.getEntity(this.door);b&&b.close&&b.close()}});ig.ACTION_STEP.ENTER_DOOR=ig.ActionStepBase.extend({door:null,_wm:new ig.Config({attributes:{door:{_type:"Entity",_info:"Door Entity to enter"}}}),init:function(b){assertContent(b,"door");this.door=b.door},run:function(b){var a=ig.Event.getEntity(this.door);a&&a.enterEntity&&a.enterEntity(b);return true}})});
ig.baked=!0;
ig.module("impact.feature.map-content.plug-in").requires("impact.feature.map-content.map-style","impact.feature.map-content.entities.door","impact.feature.map-content.entities.stair-door","impact.feature.map-content.entities.teleport-ground","impact.feature.map-content.entities.glowing-ground","impact.feature.map-content.entities.prop","impact.feature.map-content.entities.scalable-prop","impact.feature.map-content.entities.hidden-block","impact.feature.map-content.entities.note","impact.feature.map-content.map-content-steps").defines(function(){if(window.wm){wm.postLoadModules.push("impact.feature.map-content.editors.map-content-editor");wm.mapAttribs&&
(wm.mapAttribs.mapStyle={_type:"String",_info:"Select style of map (influences appearance of several entities)",_select:ig.MAP_STYLES,_withNull:true})}});ig.baked=!0;
ig.module("impact.feature.map-image.map-image").requires("impact.base.game","game.config","impact.base.entity").defines(function(){ig.MapImageManager=ig.GameAddon.extend({images:{},init:function(){this.parent("MapImage")},showMapImage:function(a,b){this.removeMapImage(a);var c=ig.game.spawnEntity(ig.MapImageEntity,0,0,0,b);this.images[a]=c},removeMapImage:function(a){var b=this.images[a];delete this.images[a];b&&b.remove()}});ig.addGameAddon(function(){return ig.mapImage=new ig.MapImageManager});
var b=Vec3.create();ig.MapImageEntity=ig.AnimatedEntity.extend({img:null,_wm:new ig.Config({spawnable:false}),init:function(a,d,c,e){this.parent(a,d,c,e);this.coll.type=ig.COLLTYPE.NONE;this.tileSheet=e.tileSheet;this.guiSprite=e.guiSprite;this.wallY=0;e.size?this.coll.setSize(e.size.x,e.size.y,e.size.z):this.coll.setSize(this.tileSheet.width,0,this.tileSheet.height);a=ig.Event.getVec3(e.position,b);this.coll.setPos(a.x-this.coll.size.x/2,a.y-this.coll.size.y/2,a.z)},remove:function(){this.kill()},
initSprites:function(){this.setSpriteCount(1,this.guiSprite);this.sprites[0].setEntityDefault(this,this.tileSheet.width,this.tileSheet.height,"NO_EXPAND",this.wallY,null,this.tileSheet.image,this.tileSheet.offX,this.tileSheet.offY)},updateSprites:function(){this.sprites[0].setAlpha(this.animState.alpha);this.animState.updateSpriteColor(this)}})});ig.baked=!0;
ig.module("impact.feature.map-image.map-image-steps").requires("impact.base.action","impact.base.event").defines(function(){ig.EVENT_STEP.SHOW_MAP_IMAGE=ig.EventStepBase.extend({_wm:new ig.Config({attributes:{name:{_type:"String",_info:"Name of image"},tileSheet:{_type:"TileSheet",_info:"Image to be displayed",_popup:true},position:{_type:"Vec3",_info:"Point where to spawn image",_visualize:true,_pointSelect:true},guiSprite:{_type:"Boolean",_info:"If true: Show sprite as GUI Sprite"},size:{_type:"Offset",
_info:"Optional: Size of entity. If not specified will match image dimensions to x and z size, y always 0",_optional:true}}}),init:function(b){this.name=b.name;this.settings=ig.copy(b);delete this.settings.name;this.settings.tileSheet=new ig.TileSheet.createFromJson(b.tileSheet)},start:function(){ig.mapImage.showMapImage(this.name,this.settings)},clearCached:function(){this.settings.tileSheet.clearCached()}});ig.EVENT_STEP.REMOVE_MAP_IMAGE=ig.EventStepBase.extend({_wm:new ig.Config({attributes:{name:{_type:"String",
_info:"Name of image"}}}),init:function(b){this.name=b.name},start:function(){ig.mapImage.removeMapImage(this.name)}})});ig.baked=!0;ig.module("impact.feature.map-image.plug-in").requires("impact.feature.map-image.map-image","impact.feature.map-image.map-image-steps").defines(function(){});ig.baked=!0;
ig.module("impact.feature.overlay.overlay").requires("impact.base.event","impact.base.game","impact.feature.gui.gui").defines(function(){ig.perf.overlay=true;ig.OverlayGui=ig.GuiElementBase.extend({color:null,lighter:false,init:function(){this.parent();this.hook.zIndex=-10},updateDrawables:function(b){if(ig.perf.overlay&&this.color){var a=this.color;if(a.a>0.01){a="rgba("+Math.floor(a.r)+","+Math.floor(a.g)+","+Math.floor(a.b)+","+a.a+")";b=b.addColor(a,0,0,ig.system.width,ig.system.height);this.lighter&&
b.setCompositionMode("lighter")}}}});ig.AlphaTransitionHandler=ig.Class.extend({timer:null,startAlpha:0,targetAlpha:0,blinkAlpha:void 0,init:function(){this.timer=new ig.WeightTimer(true)},update:function(){if(!this.timer.done()){this.timer.tick();this.timer.get();if(this.blinkAlpha!==void 0&&this.timer.onBlinkDecline()){this.startAlpha=this.blinkAlpha;this.blinkAlpha=void 0}return false}return true},getAlpha:function(){var b=this.timer.get();return(1-b)*this.startAlpha+b*this.targetAlpha},set:function(b,
a,d){this.startAlpha=this.getAlpha();this.targetAlpha=b;this.blinkAlpha=d;this.timer.set(a,d!==void 0?ig.TIMER_MODE.BLINK:ig.TIMER_MODE.ONCE)}});ig.OverlayCornerGui=ig.GuiElementBase.extend({gfx:null,alphaHandler:null,init:function(b){this.parent();this.hook.localAlpha=0;this.hook.zIndex=-20;this.gfx=b;this.hook.size.x=ig.system.width;this.hook.size.y=ig.system.height;this.alphaHandler=new ig.AlphaTransitionHandler(true)},update:function(){if(!this.alphaHandler.update())this.hook.localAlpha=this.alphaHandler.getAlpha()},
updateDrawables:function(b){if(ig.perf.overlay){b.addGfx(this.gfx,0,0);b.addGfx(this.gfx,this.hook.size.x-this.gfx.width,0,0,0,void 0,void 0,true)}},setAlpha:function(b,a,d){if(!a)this.hook.localAlpha=b;this.alphaHandler.set(b,a,d)}});ig.OVERLAY_CORNER={WHITE:0,RED:1,BLACK:2};ig.Overlay=ig.GameAddon.extend({colorOld:{r:0,g:0,b:0,a:0},colorNew:{r:0,g:0,b:0,a:0},lighter:false,timer:0,max:0,gfx:{WHITE:new ig.Image("media/gui/env-white.png"),RED:new ig.Image("media/gui/env-red.png"),BLACK:new ig.Image("media/gui/env-black.png")},
colorGui:null,cornerGui:[],init:function(){this.parent("Overlay");this.colorGui=new ig.OverlayGui;ig.gui.addGuiElement(this.colorGui);for(var b in this.gfx){var a=new ig.OverlayCornerGui(this.gfx[b]);this.cornerGui[ig.OVERLAY_CORNER[b]]=a;ig.gui.addGuiElement(a)}},deferredUpdateOrder:400,onDeferredUpdate:function(){if(this.timer<this.max){this.timer=this.timer+ig.system.actualTick;if(this.timer>=this.max){this.timer=this.max;if(this.colorNew.a==0){this.colorNew.r=0;this.colorNew.g=0;this.colorNew.b=
0;this.lighter=false}}}var b=this._getCurrentColor();this.colorGui.color=b;this.colorGui.lighter=this.lighter},onReset:function(){this.setColor(0,0,0,0,0,false);for(var b in ig.OVERLAY_CORNER)this.setCorner(b,0,0,false)},setColor:function(b,a,d,c,e,f,g){this.colorOld=this._getCurrentColor();this.colorNew.r=b;this.colorNew.g=a;this.colorNew.b=d;this.colorNew.a=c;this.lighter=f||false;this.max=e;this.timer=0;b=g?1300:-10;if(b!=this.colorGui.hook.zIndex){this.colorGui.hook.zIndex=b;ig.gui.sortGui()}},
setAlpha:function(b,a){this.colorOld=this._getCurrentColor();this.colorNew.a=b;this.max=a;this.timer=0},setCorner:function(b,a,d,c){b=typeof b=="string"?ig.OVERLAY_CORNER[b]:b;this.cornerGui[b].setAlpha(a,d,c)},_getCurrentColor:function(){var b={},a=this.max?(this.timer/this.max).limit(0,1):1,d;for(d in this.colorOld)b[d]=this.colorOld[d]*(1-a)+this.colorNew[d]*a;return b}});ig.addGameAddon(function(){return ig.overlay=new ig.Overlay})});ig.baked=!0;
ig.module("impact.feature.overlay.overlay-steps").requires("impact.base.action","impact.base.event").defines(function(){ig.EVENT_STEP.SET_OVERLAY=ig.EventStepBase.extend({color:null,alpha:0,time:0,lighter:false,_wm:new ig.Config({attributes:{color:{_type:"Color",_info:"Color of overlay"},alpha:{_type:"Number",_info:"Alpha of overlay, range [0,1]. 0 = transparent"},time:{_type:"Number",_info:"Transition time to new overlay color and alpha"},lighter:{_type:"Boolean",_info:"Apply color in lighter mode"},
overMessage:{_type:"Boolean",_info:"If true: show overlay above messages",_optional:true}}}),init:function(b){assertContent(b,"alpha","time","color");this.alpha=b.alpha;this.time=b.time;this.color=new ig.RGBColor(b.color);this.lighter=b.lighter||false;this.overMessage=b.overMessage||false},start:function(){ig.overlay.setColor(this.color.r||0,this.color.g||0,this.color.b||0,this.alpha,this.time,this.lighter,this.overMessage)}});ig.EVENT_STEP.SET_OVERLAY_CORNER=ig.EventStepBase.extend({color:null,alpha:0,
time:0,blinkAlpha:null,_wm:new ig.Config({attributes:{color:{_type:"String",_info:"Color of corner",_select:ig.OVERLAY_CORNER},alpha:{_type:"Number",_info:"Alpha of corner, range [0,1]. 0 = transparent"},time:{_type:"Number",_info:"Transition time to new alpha value"},blinkAlpha:{_type:"Number",_info:"If specified: alterate between alpha and blinkAlpha",_optional:true}}}),init:function(b){assertContent(b,"alpha","time","color");this.alpha=b.alpha;this.time=b.time;this.color=b.color;this.blinkAlpha=
b.blinkAlpha},start:function(){ig.overlay.setCorner(this.color,this.alpha,this.time,this.blinkAlpha===null?void 0:this.blinkAlpha)}});ig.ACTION_STEP.SET_OVERLAY_CORNER=ig.EventStepBase.extend({color:null,alpha:0,time:0,blinkAlpha:null,_wm:new ig.Config({attributes:{color:{_type:"String",_info:"Color of corner",_select:ig.OVERLAY_CORNER},alpha:{_type:"Number",_info:"Alpha of corner, range [0,1]. 0 = transparent"},time:{_type:"Number",_info:"Transition time to new alpha value"},blinkAlpha:{_type:"Number",
_info:"If specified: alterate between alpha and blinkAlpha",_optional:true}}}),init:function(b){assertContent(b,"alpha","time","color");this.alpha=b.alpha;this.time=b.time;this.color=b.color;this.blinkAlpha=b.blinkAlpha},start:function(){ig.overlay.setCorner(this.color,this.alpha,this.time,this.blinkAlpha===null?void 0:this.blinkAlpha)}})});ig.baked=!0;
ig.module("impact.feature.overlay.plug-in").requires("impact.feature.overlay.overlay","impact.feature.overlay.overlay-steps").defines(function(){window.wm&&wm.addStepColorRule(/OVERLAY/,"yellow")});ig.baked=!0;
ig.module("impact.feature.dream-fx.dream-fx").requires("impact.base.event","impact.base.game","impact.feature.gui.gui","impact.base.utils").defines(function(){ig.perf.overlay=true;ig.DreamAssets=ig.Class.extend({shadowGfx:null,sideGfx:null,edgeGfx:null,dotGfx:null,init:function(){this.shadowGfx=new ig.Image("media/pics/dream/shadow-circle.png");this.sideGfx=new ig.Image("media/pics/dream/side-line.png");this.edgeGfx=new ig.Image("media/pics/dream/edge.png");this.dotGfx=new ig.Image("media/pics/dream/dot.png")},
clone:function(){return new ig.DreamAssets},clearCached:function(){this.shadowGfx.decreaseRef();this.sideGfx.decreaseRef();this.edgeGfx.decreaseRef();this.dotGfx.decreaseRef()}});var b=new ig.RGBColor;ig.DreamCircleShadowGui=ig.GuiElementBase.extend({assets:null,centerColor:{old:new ig.RGBColor,"new":new ig.RGBColor},borderColor:{old:new ig.RGBColor,"new":new ig.RGBColor},colorTimer:0,colorDuration:0,circleSize:{old:1,"new":1,timer:0,duration:0},wobbleTimer:0,transitions:{DEFAULT:{state:{},time:2,
timeFunction:KEY_SPLINES.LINEAR},HIDDEN:{state:{alpha:0},time:2,timeFunction:KEY_SPLINES.LINEAR}},init:function(){this.parent();this.hook.zIndex=-21;this.setSize(ig.system.width,ig.system.height)},setColors:function(a,b,c){this._getCurrentColor(this.centerColor.old,this.centerColor);this._getCurrentColor(this.borderColor.old,this.borderColor);this.centerColor.new.assign(a);this.borderColor.new.assign(b);this.colorDuration=c;this.colorTimer=0},_getCurrentColor:function(a,b){ig.RGBColor.interpolate(b.old,
b.new,this.colorDuration?this.colorTimer/this.colorDuration:1,a);return a},_getCurrentSize:function(){var a=this.circleSize.duration?this.circleSize.timer/this.circleSize.duration:1;a!=1&&(a=KEY_SPLINES.EASE_IN_OUT.get(a));return this.circleSize.old*(1-a)+this.circleSize.new*a},setCircleSize:function(a,b){this.circleSize.old=this._getCurrentSize();this.circleSize.new=a;this.circleSize.duration=b;this.circleSize.timer=0},update:function(){if(this.circleSize.duration){this.circleSize.timer=this.circleSize.timer+
ig.system.actualTick;if(this.circleSize.timer>=this.circleSize.duration)this.circleSize.duration=0}this.wobbleTimer=this.wobbleTimer+ig.system.actualTick;if(this.colorDuration){this.colorTimer=this.colorTimer+ig.system.actualTick;if(this.colorTimer>=this.colorDuration)this.colorDuration=0}},updateDrawables:function(a){if(this.assets){a.addColor("black",0,0,ig.system.width,ig.system.height).setAlpha(0.5);var d=this._getCurrentColor(b,this.centerColor).toRGB();a.addColor(d,0,0,ig.system.width,ig.system.height).setCompositionMode("lighter");
var d=this._getCurrentSize(),c=this.wobbleTimer*Math.PI*1,d=d+0.015*Math.sin(c);if(d=Math.max(0,d)){a.addTransform().setScale(d,d);var e=this.assets.shadowGfx,f=e.width,g=e.height,h=(ig.system.width/d-f)/2,i=(ig.system.height/d-g)/2;a.addGfx(e,h,i,0,0,f,g,false,false);a.undoTransform();h=h*d;f=f*d;i=i*d;g=g*d;if(i>=0){a.addColor("#161616",0,0,Math.ceil(ig.system.width),Math.ceil(i+2));a.addColor("#161616",0,Math.floor(i+g-2),Math.ceil(ig.system.width),Math.ceil(i+4))}if(h>=0){a.addColor("#161616",
0,Math.floor(i-2),Math.ceil(h+4),Math.ceil(g+4));a.addColor("#161616",Math.floor(h+f-2),Math.floor(i-4),Math.ceil(h+4),Math.ceil(g+4))}}else a.addColor("#161616",0,0,ig.system.width,ig.system.height);d=this._getCurrentColor(b,this.borderColor).toRGB();a.addColor(d,0,0,ig.system.width,ig.system.height).setCompositionMode("lighter");c=0.05*Math.sin(c*0.25);a.addTransform().setScale(1.1,1.1).setRotate(c).setPivot(ig.system.width/2,ig.system.height/2);c=this.assets.edgeGfx;d=c.width;a.addGfx(c,0,0,0,
0,d,this.hook.size.y,false,false).setCompositionMode("lighter");a.addGfx(c,this.hook.size.x-d,0,0,0,d,this.hook.size.y,true,false).setCompositionMode("lighter");a.undoTransform()}}});ig.DreamSideGui=ig.GuiElementBase.extend({assets:null,particles:[],spawnTimer:0,lastRight:false,rng:{left:new ig.UniformRNG(12,true),right:new ig.UniformRNG(12,true)},transitions:{DEFAULT:{state:{},time:2,timeFunction:KEY_SPLINES.LINEAR},HIDDEN:{state:{alpha:0},time:2,timeFunction:KEY_SPLINES.LINEAR}},init:function(){this.parent();
this.hook.zIndex=-15},update:function(){this.spawnTimer=this.spawnTimer-ig.system.actualTick;if(this.spawnTimer<=0){this.spawnTimer=this.spawnTimer+0.15;this.spawnParticle()}for(var a=this.particles.length;a--;){var b=this.particles[a];b.timer=b.timer+ig.system.actualTick;b.y=b.y+ig.system.actualTick*b.speedY;b.timer>=b.duration&&this.particles.splice(a,1)}},updateDrawables:function(a){if(this.assets)for(var b=this.assets.sideGfx,c=b.width,e=b.height,f=this.particles.length,g=ig.system.height/2;f--;){var h=
this.particles[f],i=1;h.timer<0.4?i=h.timer/0.4:h.timer>h.duration-0.4&&(i=(h.duration-h.timer)/0.4);var j=(g-(h.y-e/2))/g,j=(1-j*j)*64;a.addGfx(b,h.right?ig.system.width-c+j:-j,h.y-e/2,0,0,c,e,h.right,false).setAlpha(i).setCompositionMode("lighter")}},spawnParticle:function(){var a=(this.lastRight?this.rng.left.get():this.rng.right.get())*ig.system.height,b=(Math.random()-0.5)*12,a={duration:2.5,timer:0,right:this.lastRight,y:a,speedY:b};this.lastRight=!this.lastRight;this.particles.push(a)}});ig.DreamDotGui=
ig.GuiElementBase.extend({assets:null,particles:[],spawnTimer:0,rng:new ig.UniformRNG(36,false),rotate:0,transitions:{DEFAULT:{state:{},time:2,timeFunction:KEY_SPLINES.LINEAR},HIDDEN:{state:{alpha:0},time:2,timeFunction:KEY_SPLINES.LINEAR}},init:function(){this.parent();this.hook.zIndex=-14},update:function(){this.rotate=this.rotate+ig.system.actualTick*0.02;if(this.rotate>=1)this.rotate=this.rotate-1;this.spawnTimer=this.spawnTimer-ig.system.actualTick;if(this.spawnTimer<=0){this.spawnTimer=this.spawnTimer+
0.15;this.spawnParticle()}for(var a=this.particles.length;a--;){var b=this.particles[a];b.timer=b.timer+ig.system.actualTick;b.timer>=b.duration&&this.particles.splice(a,1)}},updateDrawables:function(a){if(this.assets){var b=this.assets.dotGfx,c=b.width,e=b.height,f=this.particles.length;a.addTransform().setRotate(this.rotate*Math.PI*2).setPivot(ig.system.width/2,ig.system.height/2);for(var g=ig.system.width/2-160,h=ig.system.height/2-160;f--;){var i=this.particles[f],j=Math.sin(Math.PI*i.timer/i.duration),
k=j,l=g+i.x,o=h+i.y,i=i.maxSize/2+i.maxSize/2*j;a.addTransform().setScale(i,i).setPivot(l,o);a.addGfx(b,l-c/2,o-e/2,0,0,c,e,false,false).setAlpha(k).setCompositionMode("lighter");a.undoTransform()}a.undoTransform()}},spawnParticle:function(){var a=Math.floor(this.rng.get()*36),b=Math.floor(a/6),c=320/6,a=(a%6+0.5)*c+(Math.random()-0.5)*c,b={duration:2.5,timer:0,y:(b+0.5)*c+(Math.random()-0.5)*c,x:a,maxSize:0.5+Math.random()*0.5};this.particles.push(b)}});ig.OVERLAY_CORNER={WHITE:0,RED:1,BLACK:2};
ig.DreamFx=ig.GameAddon.extend({assets:null,circleShadowGui:null,sideGui:null,dotGui:null,init:function(){this.parent("Overlay");this.circleShadowGui=new ig.DreamCircleShadowGui;this.sideGui=new ig.DreamSideGui;this.dotGui=new ig.DreamDotGui},onReset:function(){this.clear()},start:function(a,b){if(!this.assets){this.assets=a.clone();this.circleShadowGui.assets=a;this.sideGui.assets=a;this.dotGui.assets=a;ig.gui.addGuiElement(this.circleShadowGui);ig.gui.addGuiElement(this.sideGui);ig.gui.addGuiElement(this.dotGui);
sc.model.notifyDreamFxChange();if(b){this.circleShadowGui.doStateTransition("HIDDEN",true);this.circleShadowGui.doStateTransition("DEFAULT");this.sideGui.doStateTransition("HIDDEN",true);this.sideGui.doStateTransition("DEFAULT");this.dotGui.doStateTransition("HIDDEN",true);this.dotGui.doStateTransition("DEFAULT")}}},clear:function(){if(this.assets){this.assets.clearCached();this.assets=null;this.circleShadowGui.assets=null;this.sideGui.assets=null;this.dotGui.assets=null;ig.gui.removeGuiElement(this.circleShadowGui);
ig.gui.removeGuiElement(this.sideGui);ig.gui.removeGuiElement(this.dotGui);sc.model.notifyDreamFxChange()}},setColors:function(a,b,c){this.circleShadowGui.setColors(a,b,c)},setCircleSize:function(a,b){this.circleShadowGui.setCircleSize(a,b)},isActive:function(){return!!this.assets}});ig.addGameAddon(function(){return ig.dreamFx=new ig.DreamFx})});ig.baked=!0;
ig.module("impact.feature.dream-fx.dream-fx-steps").requires("impact.base.action","impact.base.event").defines(function(){ig.EVENT_STEP.START_DREAM_FX=ig.EventStepBase.extend({_wm:new ig.Config({attributes:{centerColor:{_type:"Color",_info:"Color of center"},borderColor:{_type:"Color",_info:"Color of border"},circleSize:{_type:"Number",_info:"Size of visible circle in center. 1=fullSize"},transition:{_type:"Boolean",_info:"If true, slowly fade in effects"}}}),init:function(b){this.assets=new ig.DreamAssets;
this.centerColor=new ig.RGBColor(b.centerColor);this.borderColor=new ig.RGBColor(b.borderColor);this.circleSize=b.circleSize||0;this.transition=b.transition||false},clearCached:function(){this.assets.clearCached()},start:function(){ig.dreamFx.start(this.assets,this.transition);ig.dreamFx.setColors(this.centerColor,this.borderColor,0);ig.dreamFx.setCircleSize(this.circleSize,0)}});ig.EVENT_STEP.CLEAR_DREAM_FX=ig.EventStepBase.extend({_wm:new ig.Config({attributes:{}}),init:function(){},start:function(){ig.dreamFx.clear()}});
ig.EVENT_STEP.SET_DREAM_FX_COLORS=ig.EventStepBase.extend({_wm:new ig.Config({attributes:{centerColor:{_type:"Color",_info:"Color of center"},borderColor:{_type:"Color",_info:"Color of border"},duration:{_type:"Number",_info:"Duration of transition"}}}),init:function(b){this.centerColor=new ig.RGBColor(b.centerColor);this.borderColor=new ig.RGBColor(b.borderColor);this.duration=b.duration||0},start:function(){ig.dreamFx.setColors(this.centerColor,this.borderColor,this.duration)}});ig.EVENT_STEP.SET_DREAM_FX_CIRCLE_SIZE=
ig.EventStepBase.extend({_wm:new ig.Config({attributes:{circleSize:{_type:"Number",_info:"Size of visible circle in center. 1=fullSize"},duration:{_type:"Number",_info:"Duration of transition"}}}),init:function(b){this.circleSize=b.circleSize||0;this.duration=b.duration||0},start:function(){ig.dreamFx.setCircleSize(this.circleSize,this.duration)}})});ig.baked=!0;
ig.module("impact.feature.dream-fx.plug-in").requires("impact.feature.dream-fx.dream-fx","impact.feature.dream-fx.dream-fx-steps").defines(function(){if(window.wm){wm.addStepColorRule(/DREAM_MSG/,"red");wm.addStepColorRule(/DREAM/,"yellow")}});ig.baked=!0;
ig.module("impact.feature.gui.base.basic-gui").requires("impact.feature.gui.gui").defines(function(){ig.ImageGui=ig.GuiElementBase.extend({image:null,offsetX:0,offsetY:0,renderMode:null,flipX:false,flipY:false,pivotOverride:false,frames:null,xCount:0,frameTime:0,timer:0,loop:false,stopped:true,init:function(b,a,d,c,e){this.parent();b&&this.setImage(b,a,d,c,e)},setImage:function(b,a,d,c,e){this.image=b;this.offsetX=a||0;this.offsetY=d||0;this.hook.size.x=c||0;this.hook.size.y=e||0;this.image.addLoadListener(this)},
setAnimation:function(b,a,d,c){this.loop=c!=void 0?c:true;this.stopped=false;this.frames=b;this.frameTime=a;this.xCount=d},restartAnimation:function(){this.timer=0;this.stopped=false},onLoadableComplete:function(){this.hook.size.x=this.hook.size.x||this.image.width;this.hook.size.y=this.hook.size.y||this.image.height;this.hook.size.x=Math.min(this.hook.size.x,this.image.width);this.hook.size.y=Math.min(this.hook.size.y,this.image.height);if(!this.pivotOverride){this.hook.pivot.x=this.hook.size.x/
2;this.hook.pivot.y=this.hook.size.y/2}},update:function(){if(this.frames&&!this.stopped)this.timer=this.timer+ig.system.actualTick},updateDrawables:function(b){var a=0,d=0;if(this.frames){d=Math.floor(this.timer/this.frameTime)%this.frames.length;if(d==this.frames.length-1&&!this.loop)this.stopped=true;a=d%this.xCount*this.hook.size.x;d=Math.floor(d/this.xCount)*this.hook.size.y}b.addGfx(this.image,0,0,this.offsetX+a,this.offsetY+d,this.hook.size.x,this.hook.size.y,this.flipX,this.flipY).setCompositionMode(this.renderMode)}});
ig.ColorGui=ig.GuiElementBase.extend({color:null,renderMode:null,init:function(b,a,d){this.parent();this.color=b;this.hook.size.x=a==void 0?ig.system.width:a;this.hook.size.y=d==void 0?ig.system.height:d;this.hook.pivot.x=this.hook.size.x/2;this.hook.pivot.y=this.hook.size.y/2},updateDrawables:function(b){this.hook.size.x!=0&&this.hook.size.y!=0&&b.addColor(this.color,0,0,this.hook.size.x,this.hook.size.y).setCompositionMode(this.renderMode)}});ig.SEQUENCE_MSG={LABEL_REACHED:1,ENDED:2};ig.SequenceGui=
ig.GuiElementBase.extend({timer:-1,timeLineIndex:0,gfx:null,gui:null,timeLine:null,reachedLabels:[],currentSkipLabel:null,init:function(b){this.parent();this.callback=b;this.timeLine&&this.initTimeLine(this.gfx,this.gui,this.timeLine)},initTimeLine:function(b,a,d){this.gfx=b;this.gui=a;this.timeLine=d;for(var c in this.gui){b=this.gui[c];if(b.gfx){this.gui[c]=b.src?new ig.ImageGui(this.gfx[b.gfx],b.src.x,b.src.y,b.src.w,b.src.h):new ig.ImageGui(this.gfx[b.gfx]);b.anim&&this.gui[c].setAnimation(b.anim.frames,
b.anim.time,b.anim.xCount);if(b.pos)this.gui[c].hook.pos=b.pos;if(b.align)this.gui[c].hook.align=b.align;if(b.renderMode)this.gui[c].renderMode=b.renderMode;if(b.pivot){this.gui[c].hook.pivot=b.pivot;this.gui[c].pivotOverride=true}if(b.sound)this.gui[c].sound=b.sound;this.gui[c].flipX=b.flipX||false;this.gui[c].flipY=b.flipY||false}else if(b.sound)continue;else this.gui[c]=new ig.ColorGui(b.color);this.gui[c].hook.transitions=b.transitions;this.gui[c].doStateTransition("HIDDEN",true);this.addChildGui(this.gui[c])}},
update:function(){if(this.timer>=0)for(this.timer=this.timer+ig.system.actualTick;this.timeLineIndex<this.timeLine.length&&this.timeLine[this.timeLineIndex].time<=this.timer;){var b=this.timeLine[this.timeLineIndex];if(b.gui){b.preState&&this.gui[b.gui].doStateTransition(b.preState,true);b.state&&this.gui[b.gui].doStateTransition(b.state);b.sound&&b.sound.play()}else if(b.sound)b.sound.sound.play(false,b.sound.sndSettings);else if(b.end){this.end();break}else if(b.goto)this.jumpTo(b.goto);else if(b.label)this._setLabelReached(b.label);
else if(b.skipLabel!==void 0)this.currentSkipLabel=b.skipLabel;this.timeLineIndex++}},_setLabelReached:function(b){if(this.reachedLabels.indexOf(b)==-1){this.reachedLabels.push(b);this.notifyCallback(ig.SEQUENCE_MSG.LABEL_REACHED,b)}},start:function(){for(var b in this.gui)this.gui[b].sound||this.gui[b].doStateTransition("HIDDEN",true);this.overlay={};this.reachedLabels.length=0;this.currentSkipLabel=null;this.timeLineIndex=this.timer=0},end:function(){this.timeLineIndex=0;this.timer=-1;this.notifyCallback(ig.SEQUENCE_MSG.ENDED)},
notifyCallback:function(b,a){this.callback&&this.callback(b,a||null)},skip:function(){this.currentSkipLabel&&this.jumpTo(this.currentSkipLabel)},jumpTo:function(b){for(var a=this.timeLine.length;a--;)if(this.timeLine[a].label==b){this.timer=this.timeLine[a].time;this.timeLineIndex=a;this._setLabelReached(b);break}},hasEnded:function(){return this.timer<0},isLabelReached:function(b){return this.reachedLabels.indexOf(b)!=-1}});ig.SimpleGui=ig.GuiElementBase.extend({hide:function(b,a){this.doStateTransition("HIDDEN",
b,false,null,a)},show:function(b,a){this.doStateTransition("DEFAULT",b,false,null,a)}})});ig.baked=!0;
ig.module("impact.feature.parallax.parallax").requires("impact.feature.gui.gui","impact.feature.gui.base.basic-gui","impact.base.image").defines(function(){ig.Parallax=ig.JsonLoadable.extend({cacheType:"Parallax",gfx:{},gui:{},timeLine:[],cancelSkip:false,skipBlock:false,init:function(b){this.parent(b)},onCacheCleared:function(){for(var b in this.gfx)this.gfx[b].decreaseRef();for(b in this.gui)this.gui[b].sound&&this.gui[b].sound.clearCached();delete this.gfx},getJsonPath:function(){return ig.root+
this.path.toPath("data/parallax/",".json")+ig.getCacheSuffix()},onload:function(b){if(b.cancelSkip)this.cancelSkip=true;if(b.blockSkip)this.skipBlock=true;this._convertEntries(b.entries,b.points);this._convertSequence(b.sequence)},_convertEntries:function(b,a){for(var d=0;d<b.length;++d){var c=b[d],e={};this.gfx[c.gfx]||(this.gfx[c.gfx]=new ig.Image(c.gfx));if(c.gfx)e.gfx=c.gfx;else if(c.color)e.color=c.color;e.align={x:ig.GUI_ALIGN.X_LEFT,y:ig.GUI_ALIGN.Y_TOP};if(c.align){if(c.align.x){var f=ig.GUI_ALIGN_X[c.align.x];
if(!f)throw Error("Unknown x align type '"+c.align.x+"'");e.align.x=f}if(c.align.y){f=ig.GUI_ALIGN_Y[c.align.y];if(!f)throw Error("Unknown y align type '"+c.align.y+"'");e.align.y=f}}e.transitions={HIDDEN:{state:{alpha:0},time:0,timeFunction:KEY_SPLINES.LINEAR}};if(c.pos)e.pos=Vec2.create(c.pos);if(c.src)e.src={x:c.src.x,y:c.src.y,w:c.src.w,h:c.src.h};if(c.sound){e.sound=new ig.Sound(c.sound,c.volume,c.variance);e.sndSettings={speed:c.speed||1}}if(c.anim)e.anim={frames:c.anim.frames,time:c.anim.time,
xCount:c.anim.xCount};if(c.pivot)if(f=a[c.pivot]){e.pivot=Vec2.create(f);e.pos&&Vec2.sub(e.pivot,e.pos)}e.renderMode=c.renderMode||null;e.flipX=c.flipX||false;e.flipY=c.flipY||false;this.gui[c.name]=e}},_convertSequence:function(b){for(var a=0,d=KEY_SPLINES.LINEAR,c=0;c<b.length;++c){var e=b[c];if(e.wait)a=a+e.wait*1;else if(e.keySpline)d=KEY_SPLINES[e.keySpline];else if(e["goto"])this.timeLine.push({time:a,"goto":e["goto"]});else if(e.label)this.timeLine.push({time:a,label:e.label});else if(e.skipLabel!==
void 0)this.timeLine.push({time:a,skipLabel:e.skipLabel});else if(e.sound)this.timeLine.push({time:a,sound:this.gui[e.sound]});else{var f=this.gui[e.entry],g={gui:e.entry};if(e.reset||!e.reset&&!e.move){var h="STEP"+c+"_PRE",i={};e.reset&&this._copyStateValues(i,e.reset);f.transitions[h]={state:i,time:0,timeFunction:d};g.preState=h}if(e.move){h="STEP"+c;i={};this._copyStateValues(i,e.move);f.transitions[h]={state:i,time:e.duration*1,timeFunction:d};g.state=h}g.time=a;this.timeLine.push(g)}}this.timeLine.push({time:a,
end:true})},_copyStateValues:function(b,a){b.offsetX=a.x||0;b.offsetY=a.y||0;if(a.alpha!=void 0)b.alpha=a.alpha;b.angle=(a.angle||0)*Math.PI*2;b.scaleX=1;b.scaleY=1;if(a.zoom!=void 0){b.scaleX=b.scaleX*a.zoom;b.scaleY=b.scaleY*a.zoom}if(a.scaleX!=void 0)b.scaleX=b.scaleX*a.scaleX;if(a.scaleY!=void 0)b.scaleY=b.scaleY*a.scaleY}});ig.GUI.Parallax=ig.ParallaxGui=ig.SequenceGui.extend({parallax:null,keepOnEnd:false,_wm:new ig.Config({attributes:{parallax:{_type:"String",_info:"Parallax to show",_select:"parallax"}}}),
transitions:{DEFAULT:{state:{},time:0,timeFunction:KEY_SPLINES.LINEAR},HIDDEN:{state:{alpha:0},time:0,timeFunction:KEY_SPLINES.LINEAR}},init:function(b,a){this.parent(a||null);this.hook.zIndex=0;this.hook.size.x=ig.system.width;this.hook.size.y=ig.system.height;this.parallax=new ig.Parallax(b.parallax);this.parallax.addLoadListener(this)},clearCached:function(){this.parallax&&this.parallax.decreaseRef()},onLoadableComplete:function(){this.initTimeLine(this.parallax.gfx,ig.copy(this.parallax.gui),
ig.copy(this.parallax.timeLine))},onAttach:function(){this.doStateTransition("HIDDEN",true);this.doStateTransition("DEFAULT")},start:function(b){this.parallax.cancelSkip&&sc.model.stopSkip();if(this.parallax.skipBlock)sc.model.skipBlock=true;this.parent();this.keepOnEnd=b||false;this.doStateTransition("HIDDEN",true);this.doStateTransition("DEFAULT")},end:function(){if(this.parallax.skipBlock)sc.model.skipBlock=false;this.parent();this.keepOnEnd||this.doStateTransition("HIDDEN",false,true)}})});
ig.baked=!0;
ig.module("impact.feature.parallax.parallax-steps").requires("impact.feature.parallax.parallax","impact.base.action","impact.base.event").defines(function(){ig.EVENT_STEP.SHOW_PARALLAX=ig.EventStepBase.extend({parallaxGui:null,_wm:new ig.Config({attributes:{parallax:{_type:"String",_info:"Parallax to show",_select:"parallax"}}}),init:function(b){if(!window.wm)this.parallaxGui=ig.gui.createEventGui("__parallaxGui__","Parallax",{parallax:b.parallax})},clearCached:function(){ig.gui.freeEventGui(this.parallaxGui)},start:function(){ig.gui.spawnEventGui(this.parallaxGui);
this.parallaxGui.start()},run:function(){return this.parallaxGui.hasEnded()}})});ig.baked=!0;ig.module("impact.feature.parallax.plug-in").requires("impact.feature.parallax.parallax","impact.feature.parallax.parallax-steps").defines(function(){});ig.baked=!0;
ig.module("impact.feature.screen-blur.screen-blur").requires("impact.base.game").defines(function(){ig.BLUR_ZOOM_CONFIG={LIGHTEST:{zoomAdd:0.02,duration:0.5,repeat:3,alphaStart:0.2},LIGHTER:{zoomAdd:0.025,duration:0.5,repeat:3,alphaStart:0.3},LIGHT:{zoomAdd:0.05,duration:0.5,repeat:3,alphaStart:0.5},MEDIUM:{zoomAdd:0.15,duration:0.1,repeat:5,alphaStart:0.3},SLOW_INTENSE:{zoomAdd:0.15,duration:0.5,repeat:5,alphaStart:0.3},STATIC_LIGHT:{zoomAdd:0.05,duration:0,repeat:3,alphaStart:0.5}};var b=Vec2.create(),
a=Vec3.create();ig.ScreenBlur=ig.GameAddon.extend({buffer:null,context:null,backBuffer:null,backContext:null,systemBuffer:null,systemContext:null,minAlpha:1,maxAlpha:1,repeatTimer:0,repeatCycle:0,firstDraw:false,timer:null,zooms:[],namedZooms:{},init:function(){this.parent("ScreenBlur");this.timer=new ig.WeightTimer(true,1,ig.TIMER_MODE.BLINK);var a=ig.$new("canvas");a.width=ig.system.realWidth;a.height=ig.system.realHeight;this.buffer=a;this.context=ig.system.getBufferContext(a);this.context.scale(ig.system.contextScale,
ig.system.contextScale);a=ig.$new("canvas");a.width=ig.system.realWidth;a.height=ig.system.realHeight;this.backBuffer=a;this.backContext=ig.system.getBufferContext(a);this.backContext.scale(ig.system.contextScale,ig.system.contextScale);this.firstDraw=true},setAlpha:function(a){this.maxAlpha=this.minAlpha=a;if(a==1)this.firstDraw=true},clear:function(){this.setAlpha(1)},clearZooms:function(){this.zooms.length=0;this.namedZooms={}},addZoom:function(a){if(a.name){this.namedZooms[a.name]&&this.zooms.erase(this.namedZooms[a.name]);
this.namedZooms[a.name]=a}this.zooms.push(a)},fadeOutZoom:function(a,b){var e=this.namedZooms[a];e&&e.setFadeOut(b)},onPostUpdate:function(){this.timer.tick();this.repeatTimer=this.repeatTimer-ig.system.tick;for(var a=this.zooms.length;a--;)if(this.zooms[a].update()){var b=this.zooms[a];b.name&&delete this.namedZooms[b.name];this.zooms.splice(a,1)}},preDrawOrder:1E3,onPreDraw:function(){if(this._getAlpha()<1||this.zooms.length){this.systemContext=ig.system.context;this.systemBuffer=ig.system.canvas;
ig.system.context=this.context}},postDrawOrder:200,onPostDraw:function(){var a=this._getAlpha();if(a<1||this.zooms.length){var b=false,e=ig.system.realWidth,f=ig.system.realHeight,g=ig.system.contextWidth,h=ig.system.contextHeight;if(a<1&&this.repeatTimer<=0){this.repeatTimer=this.repeatTimer+this.repeatCycle;this.backContext.globalAlpha=this.firstDraw?1:a;this.backContext.drawImage(this.buffer,0,0,e,f,0,0,g,h);this.backContext.globalAlpha=1;this.firstDraw=false;b=true}ig.system.context=this.systemContext;
ig.system.canvas=this.systemBuffer;a<1&&ig.system.context.drawImage(this.backBuffer,0,0,e,f,0,0,g,h);if(!b){ig.system.context.globalAlpha=a;ig.system.context.drawImage(this.buffer,0,0,e,f,0,0,g,h);ig.system.context.globalAlpha=1}for(a=0;a<this.zooms.length;++a)this.zooms[a].draw(this.buffer,e,f,g,h)}},onReset:function(){this.clear();this.clearZooms()},_getAlpha:function(){var a=this.timer.get();return this.minAlpha*a+this.maxAlpha*(1-a)}});ig.addGameAddon(function(){return ig.screenBlur=new ig.ScreenBlur});
ig.ZoomBlurHandle=ig.Class.extend({name:null,config:null,alphaStep:0,fullTimer:null,repeatTimer:null,fadeInTime:0,duration:0,fadeOutTime:0,target:null,align:0,offset:null,state:0,init:function(a,b,e,f,g,h,i,j){this.fullTimer=new ig.WeightTimer(true);this.repeatTimer=new ig.WeightTimer(true);this.config=ig.BLUR_ZOOM_CONFIG[a];this.alphaStep=this.config.alphaStart/(this.config.repeat-1);this.name=g||null;this.target=h||null;this.align=i||ig.ENTITY_ALIGN.CENTER;this.offset=j||null;this.duration=b;this.fadeInTime=
e;this.fadeOutTime=f;this.repeatTimer.set(this.config.duration,ig.TIMER_MODE.REPEAT);this.state=0;this.fullTimer.set(this.fadeInTime,ig.TIMER_MODE.ONCE)},update:function(){if(this.state==0&&(!this.fadeInTime||this.fullTimer.done())){this.state=1;this.fullTimer.set(this.duration,ig.TIMER_MODE.ONCE)}if(this.state==1&&this.duration!=-1&&this.fullTimer.done()){this.state=2;this.fullTimer.set(this.fadeOutTime,ig.TIMER_MODE.ONCE)}if(this.state==2&&(!this.fadeOutTime||this.fullTimer.done()))return true;
this.fullTimer.tick();this.repeatTimer.tick();return false},onActionEndDetach:function(){this.setFadeOut(this.fadeOutTime)},setFadeOut:function(a){this.fadeOutTime=a;this.state=2;this.fullTimer.set(a,ig.TIMER_MODE.ONCE)},draw:function(d,c,e,f,g){var h;switch(this.state){case 0:h=this.fullTimer.get();break;case 1:h=1;break;case 2:h=1-this.fullTimer.get()}var i=this.repeatTimer.get(),j=this.config,k=1+i*j.zoomAdd;ig.system.context.globalAlpha=h*i*j.alphaStart;for(var l=0;l<j.repeat;++l){var o=ig.system.context,
m=k,n=this.target,p=this.align,r=this.offset;o.save();var t=ig.system.contextWidth/2,q=ig.system.contextHeight/2;if(n){t=n.getAlignedPos(p,a);r&&Vec3.add(t,r);r=ig.system.getScreenFromMapPos(b,t.x,t.y-t.z);t=r.x.limit(0,ig.system.contextWidth);q=r.y.limit(0,ig.system.contextHeight)}o.translate(t,q);o.scale(m,m);o.translate(-t,-q);ig.system.context.drawImage(d,0,0,c,e,0,0,f,g);ig.system.context.restore();ig.system.context.globalAlpha=h*(j.alphaStart-this.alphaStep*(i+l));k=k+j.zoomAdd}ig.system.context.globalAlpha=
1}})});ig.baked=!0;
ig.module("impact.feature.screen-blur.screen-blur-steps").requires("impact.feature.screen-blur.screen-blur","impact.base.action","impact.base.event","impact.base.entity").defines(function(){ig.EVENT_STEP.SET_SCREEN_BLUR=ig.EventStepBase.extend({alpha:0,_wm:new ig.Config({attributes:{alpha:{_type:"Number",_info:"Alpha of Screen blur. The lower, the stronger the effect",_default:0.5}}}),init:function(b){this.alpha=b.alpha||0.5},start:function(){ig.screenBlur.setAlpha(this.alpha)}});ig.EVENT_STEP.CLEAR_SCREEN_BLUR=
ig.EventStepBase.extend({_wm:new ig.Config({attributes:{}}),init:function(){},start:function(){ig.screenBlur.clear()}});ig.EVENT_STEP.SET_ZOOM_BLUR=ig.EventStepBase.extend({zoomType:null,fadeIn:0,duration:0,fadeOut:0,name:null,_wm:new ig.Config({attributes:{zoomType:{_type:"String",_info:"Type of Zoom Blur effect",_select:ig.BLUR_ZOOM_CONFIG},fadeIn:{_type:"Number",_info:"Time in seconds for effect to fade in",_default:0.2},duration:{_type:"Number",_info:"Time of effect. -1 = run forever",_default:1},
fadeOut:{_type:"Number",_info:"Time in seconds for effect to fade out",_default:0.2},name:{_type:"String",_info:"Name of zoom blur. Can be used to fadeOut permanent zoom blurs",_optional:true},target:{_type:"Entity",_info:"Target on which to focus zoom blur",_optional:true},align:{_type:"String",_info:"Alignment on how to get pos from target",_select:ig.ENTITY_ALIGN,_optional:true},offset:{_type:"Offset",_info:"Offset to position",_optional:true}}}),init:function(b){this.zoomType=b.zoomType;this.fadeIn=
b.fadeIn;this.duration=b.duration;this.fadeOut=b.fadeOut;this.name=b.name;this.target=b.target;this.align=ig.ENTITY_ALIGN[b.align]||ig.ENTITY_ALIGN.CENTER;this.offset=b.offset},start:function(){var b=this.target?ig.Event.getEntity(this.target):null,b=new ig.ZoomBlurHandle(this.zoomType,this.duration,this.fadeIn,this.fadeOut,this.name,b,this.align,this.offset);ig.screenBlur.addZoom(b)}});ig.EVENT_STEP.FADE_OUT_ZOOM_BLUR=ig.EventStepBase.extend({name:null,fadeOut:0,_wm:new ig.Config({attributes:{name:{_type:"String",
_info:"Name of zoom blur to be faded out"},fadeOut:{_type:"Number",_info:"Time in seconds for effect to fade out",_default:0.2}}}),init:function(b){this.name=b.name;this.fadeOut=b.fadeOut||0},start:function(){ig.screenBlur.fadeOutZoom(this.name,this.fadeOut)}});ig.ACTION_STEP.SET_ZOOM_BLUR=ig.ActionStepBase.extend({zoomType:null,fadeIn:0,duration:0,fadeOut:0,name:null,_wm:new ig.Config({attributes:{zoomType:{_type:"String",_info:"Type of Zoom Blur effect",_select:ig.BLUR_ZOOM_CONFIG},fadeIn:{_type:"Number",
_info:"Time in seconds for effect to fade in",_default:0.2},duration:{_type:"Number",_info:"Time of effect. -1 = run forever",_default:1},fadeOut:{_type:"Number",_info:"Time in seconds for effect to fade out",_default:0.2},name:{_type:"String",_info:"Name of zoom blur. Can be used to fadeOut permanent zoom blurs",_optional:true},align:{_type:"String",_info:"Alignment on how to get pos from target",_select:ig.ENTITY_ALIGN,_optional:true},offset:{_type:"Offset",_info:"Offset to position",_optional:true}}}),
init:function(b){this.zoomType=b.zoomType;this.fadeIn=b.fadeIn;this.duration=b.duration;this.fadeOut=b.fadeOut;this.name=b.name;this.align=ig.ENTITY_ALIGN[b.align]||ig.ENTITY_ALIGN.CENTER;this.offset=b.offset},start:function(b){var a=new ig.ZoomBlurHandle(this.zoomType,this.duration,this.fadeIn,this.fadeOut,this.name,b,this.align,this.offset);ig.screenBlur.addZoom(a);this.duration==-1&&b.addActionAttached(a)}});ig.ACTION_STEP.FADE_OUT_ZOOM_BLUR=ig.ActionStepBase.extend({name:null,fadeOut:0,_wm:new ig.Config({attributes:{name:{_type:"String",
_info:"Name of zoom blur to be faded out"},fadeOut:{_type:"Number",_info:"Time in seconds for effect to fade out",_default:0.2}}}),init:function(b){this.name=b.name;this.fadeOut=b.fadeOut||0},start:function(){ig.screenBlur.fadeOutZoom(this.name,this.fadeOut)}})});ig.baked=!0;ig.module("impact.feature.screen-blur.plug-in").requires("impact.feature.screen-blur.screen-blur","impact.feature.screen-blur.screen-blur-steps").defines(function(){window.wm&&wm.addStepColorRule(/SCREEN_BLUR/,"yellow")});
ig.baked=!0;
ig.module("impact.feature.terrain.terrain").requires("impact.base.loader","game.config").defines(function(){var b=Vec2.create();ig.Terrain=ig.SingleLoadable.extend({cacheType:"Terrain",idToName:{},nameToId:{},tilesetIds:{},dangerTerrains:[],fallTerrain:[],init:function(){if(!ig.TERRAIN)return ig.warn("No TERRAIN specified. Please create ig.TERRAIN in game.config");if(!ig.TERRAIN_FILE)return ig.warn("Can't initialize terrain because no ig.TERRAIN_FILE was provided");ig.TERRAIN.undefined=0;this.nameToId=
ig.TERRAIN;for(var a in ig.TERRAIN)this.idToName[ig.TERRAIN[a]]=a;this.parent()},registerDangerTerrain:function(a,b){this.dangerTerrains.push(a);b&&this.fallTerrain.push(a)},isDangerTerrain:function(a){return this.dangerTerrains.indexOf(a)!=-1},isFallTerrain:function(a){return this.fallTerrain.indexOf(a)!=-1},getTerrain:function(a,d,c){if(!a)return 0;var e=a.getCenter(b);if(a._collData&&a._collData.groundEntry&&a._collData.groundEntry.entity.terrain)return a._collData.groundEntry.entity.terrain*1;
var f=0,g=a.level,h=ig.game.getLevelHeight(g);do{f=ig.game.getLevelHeight(g);f=this.getMapTerrain(e.x,e.y+f-h,g,d?a.size.x:0,d?a.size.y:0);g--}while(c&&!f&&g>=0);return f||ig.TERRAIN_DEFAULT},getPointTerrain:function(a,b,c,e,f){for(var g=ig.game.getLevelIdx(c),h=ig.game.getLevelHeight(g),i=ig.game.getEntitiesInRectangle(a-e/2,b-f/2,h,e,f,c-h),j=i.length,k=0;j--;){var l=i[j],o=l.coll,o=o.pos.z+o.size.z;if(l.terrain&&o<=c&&o>=h){k=l.terrain;h=o}}return k?k:this.getMapTerrain(a,b,g,e,f)},getMapTerrain:function(a,
b,c,e,f){if(!ig.game.levels[c])return 0;var b=b-ig.game.levels[c].height,c=ig.game.levels[c].maps,g;if(g=this._checkMaps(c,a,b))return g;if(e||f){if(g=this._checkMaps(c,a-e/2,b))return g;if(g=this._checkMaps(c,a+e/2,b))return g;if(g=this._checkMaps(c,a,b-f/2))return g;if(g=this._checkMaps(c,a,b+f/2))return g}return 0},_checkMaps:function(a,b,c){for(var e=a.length;e--;){var f=this.tilesetIds[a[e].tilesetName];if(a[e]instanceof ig.MAP.Background&&f){var g=a[e].getTile(b,c);if(g&&f[g-1])return f[g-1]*
1}}return 0},getTerrainOfMapTile:function(a,b){var c=this.tilesetIds[a.tilesetName];return!c?ig.TERRAIN_DEFAULT:c[b-1]},loadInternal:function(){$.ajax({dataType:"json",url:ig.root+ig.TERRAIN_FILE+ig.getCacheSuffix(),context:this,success:this.onload.bind(this),error:this.onerror.bind(this)})},onerror:function(){this.tilesetIds={};this.loadingFinished(true)},onload:function(a){this.tilesetIds=a;this.loadingFinished(true)}});ig.terrain=new ig.Terrain});ig.baked=!0;ig.module("impact.feature.terrain.plug-in").requires("impact.feature.terrain.terrain").defines(function(){});
ig.baked=!0;
ig.module("impact.feature.interact.interact").requires("impact.base.game").defines(function(){ig.InteractEntry=ig.Class.extend({isActive:function(){return ig.interact.entries[ig.interact.entries.length-1]==this},onConnect:function(){},onDisconnect:function(){},update:function(){}});ig.InteractManager=ig.GameAddon.extend({blockTimer:0,entries:[],init:function(){this.parent("Interact")},addEntry:function(b){if(this.entries.indexOf(b)==-1){this.entries.push(b);b.onConnect()}},removeEntry:function(b){var a=this.entries.indexOf(b);
if(a!=-1){this.entries.splice(a,1);b.onDisconnect()}},setBlockDelay:function(b){this.blockTimer=b===void 0?0.2:b},isBlocked:function(){return this.blockTimer>0},deferredUpdateOrder:0,onDeferredUpdate:function(){if(this.blockTimer>0){this.blockTimer=this.blockTimer-ig.system.actualTick;if(this.blockTimer<0)this.blockTimer=0;else return}this.entries.length>0&&this.entries[this.entries.length-1].update()}});ig.addGameAddon(function(){return ig.interact=new ig.InteractManager})});ig.baked=!0;
ig.module("impact.feature.interact.button-interact").requires("impact.feature.interact.interact").defines(function(){ig.BUTTON_GROUP_SELECT_TYPE={ALL:0,VERTICAL:1,HORIZONTAL:2};ig.ButtonGroup=ig.Class.extend({buttonInteract:null,elements:[],selectionCallbacks:[],pressCallbacks:[],mouseFocusLostCallback:null,backButton:null,current:{x:0,y:0},regain:{x:0,y:0},largestIndex:{x:0,y:0},loopButtons:true,soundsOnPressed:false,enableMultiPressed:false,ignoreActiveFocus:false,selectionType:ig.BUTTON_GROUP_SELECT_TYPE.ALL,
_lastInvokedPress:null,_isParallel:false,sounds:{focus:null},init:function(b,a,d){this.selectionType=b||ig.BUTTON_GROUP_SELECT_TYPE.ALL;this.loopButtons=a!=void 0?a:true;this.soundsOnPressed=d||false},addFocusGui:function(b,a,d,c){c&&this._setBackButton(b);this.elements[a]||(this.elements[a]=[]);this.elements[a][d]=b;b.buttonGroup=this;b.buttonInteract=null;this.largestIndex.x=Math.max(this.largestIndex.x,a);this.largestIndex.y=Math.max(this.largestIndex.y,d)},fillEmptySpace:function(){for(var b=
0;b<this.elements.length;b++)for(var a=0;a<this.largestIndex.y;a++){this.elements[b]||(this.elements[b]=[]);this.elements[b][a]||(this.elements[b][a]=null)}},insertFocusGui:function(b,a,d){this.elements[a]||(this.elements[a]=[]);this.unfocusCurrentButton();this.elements[a].splice(d,0,b);b.buttonGroup=this;b.buttonInteract=null},removeFocusGui:function(b,a){this.elements[b]||(this.elements[b]=[]);var d=this.elements[b].splice(a,1)[0];if(!d)return null;d.keepPressed&&d.setPressed(false);d.focusLost();
d.buttonGroup=null;d.buttonInteract=null;return d},addNull:function(b,a){this.elements[b]||(this.elements[b]=[]);this.elements[b][a]=null},makeEmptyGrid:function(b,a){for(var d=0;d<b;d++)for(var c=0;c<a;c++){this.elements[d]||(this.elements[d]=[]);this.elements[d][c]=null}},invokeCurrentButton:function(){if(this.elements[this.current.x]){var b=this.elements[this.current.x][this.current.y];if(b)if(b.active){if(b.keepPressed){if(!b.pressed){b.invokeButtonPress();b.setPressed(true)}}else b.invokeButtonPress();
this._invokePressCallbacks(b);this._lastInvokedPress&&(!this._lastInvokedPress.isSameAs(b)&&this._lastInvokedPress.keepPressed)&&this._lastInvokedPress.setPressed(false);if(!this.enableMultiPressed)this._lastInvokedPress=b}else b.blockedSound&&b.blockedSound.play()}},invokeBackButton:function(){this.backButton&&this.backButton.invokeButtonPress()},setMouseFocusLostCallback:function(b){if(b)this.mouseFocusLostCallback=b},addPressCallback:function(b){b&&this.pressCallbacks.push(b)},removePressCallback:function(b){b&&
this.pressCallbacks.remove(b)},addSelectionCallback:function(b){b&&this.selectionCallbacks.push(b)},removeSelectionCallback:function(b){b&&this.selectionCallbacks.remove(b)},clearSelectionCallbacks:function(){this.selectionCallbacks.length=0},stepRight:function(){if(this.selectionType!=ig.BUTTON_GROUP_SELECT_TYPE.VERTICAL&&!this.isEmpty()){var b=this.current.x;if(this.loopButtons)for(;!this.elements[++b%this.elements.length];);else{b++;if(b>=this.elements.length)b=this.elements.length-1;else for(var a=
b;a<this.elements.length;a++)if(this.elements[a]){b=a;break}}b=b%this.elements.length;if(this.elements[b][this.current.y])this.focusCurrentButtonX(b);else{for(var d=a=this.current.y,c=0,e=0;!this.elements[b][++a%this.elements[b].length];)c++;d--;for(d<0&&(d=this.elements[b].length-1);!this.elements[b][d];){d--;e++;d<0&&(d=this.elements[b].length-1)}c<e?this.focusCurrentButton(b,a):this.focusCurrentButton(b,d)}}},stepLeft:function(){if(this.selectionType!=ig.BUTTON_GROUP_SELECT_TYPE.VERTICAL&&!this.isEmpty()){var b=
this.current.x-1;if(this.loopButtons)for(b<0&&(b=this.elements.length-1);!this.elements[b];){b--;b<0&&(b=this.elements.length-1)}else if(b<0)b=0;else for(var a=b;a>=0;a--)if(this.elements[a]){b=a;break}if(this.elements[b][this.current.y])this.focusCurrentButtonX(b);else{for(var d=a=this.current.y,c=0,e=0;!this.elements[b][++a%this.elements[b].length];)c++;d--;for(d<0&&(d=this.elements[b].length-1);!this.elements[b][d];){d--;e++;d<0&&(d=this.elements[b].length-1)}c<e?this.focusCurrentButton(b,a):this.focusCurrentButton(b,
d)}}},stepDown:function(b){if(this.selectionType!=ig.BUTTON_GROUP_SELECT_TYPE.HORIZONTAL&&!this.isEmpty()){var a=this.current.y;if(this.elements[this.current.x]){if(b)a=b+a>=this.elements[this.current.x].length?this.elements[this.current.x].length-1:a+b;else if(this.loopButtons)for(;this.elements[this.current.x][++a%this.elements[this.current.x].length]===void 0;);else{a++;if(a>=this.elements[this.current.x].length)a=this.elements[this.current.x].length-1;else for(b=a;b<this.elements[this.current.x].length;b++)if(this.elements[this.current.x][b]!==
void 0){a=b;break}}a=a%this.elements[this.current.x].length;if(this.elements[this.current.x][a])this.focusCurrentButtonY(a);else{for(var d=b=this.current.x,c=0,e=0;!this.elements[++b%this.elements.length][a];)c++;d--;for(d<0&&(d=this.elements.length-1);!this.elements[d][a];){d--;e++;d<0&&(d=this.elements.length-1)}c<e?this.focusCurrentButton(b,a):this.focusCurrentButton(d,a)}}}},stepUp:function(b){if(this.selectionType!=ig.BUTTON_GROUP_SELECT_TYPE.HORIZONTAL&&!this.isEmpty()){var a=this.current.y-
1;if(this.elements[this.current.x]){if(b)a=a-b<0?0:a-b;else if(this.loopButtons)for(a<0&&(a=this.elements[this.current.x].length-1);this.elements[this.current.x][a]===void 0;){a--;a<0&&(a=this.elements[this.current.x].length-1)}else if(a<0)a=0;else for(b=a;b>=0;b--)if(this.elements[this.current.x][b]!==void 0){a=b;break}if(this.elements[this.current.x][a])this.focusCurrentButtonY(a);else{for(var d=b=this.current.x,c=0,e=0;!this.elements[++b%this.elements.length][a];)c++;for(;!this.elements[d][a];){d--;
e++;d<0&&(d=this.elements.length-1)}c<e?this.focusCurrentButton(b,a):this.focusCurrentButton(d,a)}}}},_activate:function(){if(!ig.input.mouseGuiActive&&!this.ignoreActiveFocus){var b=this.getCurrentElement();if(b){b.focusGained();this._invokeSelectionCallbacks(b)}}},_deactivate:function(){for(var b=0;b<this.elements.length;++b)if(this.elements[b])for(var a=0;a<this.elements[b].length;++a)this.elements[b][a]&&this.elements[b][a].focusLost();this._lastInvokedPress&&this._lastInvokedPress.setPressed(false);
this._lastInvokedPress=null},clear:function(){var b=this.elements[this.current.x]?this.elements[this.current.x][this.current.y]:null;if(b){b.keepPressed&&b.setPressed(false);b.focusLost()}this.current.x=0;this.current.y=0;this.elements=[];this.largestIndex.x=0;this.largestIndex.y=0;this._lastInvokedPress=null},doButtonTraversal:function(){},getCurrentElement:function(){return this.elements[this.current.x]&&this.elements[this.current.x][this.current.y]},getElementAt:function(b,a){return this.elements[b]&&
this.elements[b][a]},getYElementAt:function(b){return this.elements[this.current.x]&&this.elements[this.current.x][b]},isNonMouseMenuInput:function(){return false},isEmpty:function(){return this.elements.length==0},isPositionValid:function(b,a){return this.elements[b]&&this.elements[b][a]},isActive:function(){if(!this.buttonInteract||!this.buttonInteract.isActive())return false;if(this._isParallel)return true;var b=this.buttonInteract.buttonGroupStack;return b.length==0?false:this==b[b.length-1]},
setLastInvokedButton:function(b){this._lastInvokedPress=b},setMouseOverGui:function(){},setCurrentFocus:function(b,a){this.current.x=b;this.current.y=a},setRegainFocus:function(b,a){this.regain.x=b;this.regain.y=a},focusCurrentButtonX:function(b){if(this.current.x!=b){this.elements[this.current.x][this.current.y]&&this.elements[this.current.x][this.current.y].focusLost();this.current.x=b%this.elements.length;b=this.elements[this.current.x][this.current.y];b.keepPressed&&!this.soundsOnPressed?b.pressed||
this.sounds.focus&&this.sounds.focus.play():this.sounds.focus&&this.sounds.focus.play();b.focusGained();this._invokeSelectionCallbacks(b)}},focusCurrentButtonY:function(b){if(this.current.y!=b){this.elements[this.current.x][this.current.y]&&this.elements[this.current.x][this.current.y].focusLost();this.current.y=b%this.elements[this.current.x].length;b=this.elements[this.current.x][this.current.y];b.keepPressed&&!this.soundsOnPressed?b.pressed||this.sounds.focus&&this.sounds.focus.play():this.sounds.focus&&
this.sounds.focus.play();b.focusGained();this._invokeSelectionCallbacks(b)}},focusCurrentButton:function(b,a,d,c,e,f){if(!this.buttonInteract||!this.buttonInteract.mouseOverGui)if(f||this.getCurrentElement())if(!e||!(this.current.x==b&&this.current.y==a)){this.elements[this.current.x][this.current.y]&&this.elements[this.current.x][this.current.y].focusLost();this.current.x=b%this.elements.length;this.current.y=a%this.elements[this.current.x].length;c=c!=void 0?c:false;b=this.elements[this.current.x][this.current.y];
b.keepPressed&&!this.soundsOnPressed?b.pressed||!c&&this.sounds.focus&&this.sounds.focus.play():!c&&this.sounds.focus&&this.sounds.focus.play();b.focusGained();d||this._invokeSelectionCallbacks(b)}},regainFocusOnKeyboard:function(b){this.focusCurrentButton(this.current.x,this.current.y,b||false,true)},unfocusCurrentButton:function(){var b=this.elements[this.current.x][this.current.y];b&&b.focusLost()},getCurrentX:function(){return this.current.x},getCurrentY:function(){return this.current.y},setPressedFocusGui:function(b){this._lastInvokedPress&&
this._lastInvokedPress.setPressed(false);b.setPressed(true);if(!this.enableMultiPressed)this._lastInvokedPress=b},_setBackButton:function(b){this.backButton=b},_invokeSelectionCallbacks:function(b){for(var a=this.selectionCallbacks.length;a--;)this.selectionCallbacks[a](b)},_invokePressCallbacks:function(b,a){for(var d=this.pressCallbacks.length;d--;)this.pressCallbacks[d](b,a||false)}});ig.ButtonInteractEntry=ig.InteractEntry.extend({buttonGroupStack:[],parallelGroups:[],globalButtons:[],hotkeyCallbacks:[],
mouseOverGui:null,mouseOverGuiClickPre:false,mouseIsOver:false,pushButtonGroup:function(b){this.buttonGroupStack.push(b);b.buttonInteract=this;if(this.isActive()){b._activate();ig.input.mouseGuiActive&&(this.mouseIsOver&&this.mouseOverGui)&&b._invokeSelectionCallbacks(this.mouseOverGui)}},removeButtonGroup:function(b){this.buttonGroupStack.erase(b);b.buttonInteract=this;b._deactivate()},addGlobalButton:function(b,a,d){if(!(d&&this.globalButtons.indexOf(b)!=-1)){this.hotkeyCallbacks.push(a||null);
this.globalButtons.push(b);b.buttonInteract=this;b.buttonGroup=null}},removeGlobalButton:function(b){b.buttonInteract=null;var a=this.globalButtons.indexOf(b);if(a!=-1){this.globalButtons.splice(a,1);this.hotkeyCallbacks.splice(a,1);b.focusLost()}},addParallelGroup:function(b){if(b){b._isParallel=true;b.buttonInteract=this;this.parallelGroups.push(b)}},removeParallelGroup:function(b){if(b){b._isParallel=false;b.buttonInteract=null;this.parallelGroups.erase(b)}},clearAllButtons:function(){for(var b=
this.globalButtons.length,a=null;b--;){a=this.globalButtons[b];a.buttonInteract=null;a.focusLost()}this.globalButtons=[];this.hotkeyCallbacks=[]},pause:function(b){this.pauseTimer=b||BUTTON_GROUP_DEFAULT_PAUSE_TIME},onConnect:function(){var b=this.getTopButtonGroup();b&&b._activate()},onDisconnect:function(){var b=this.getTopButtonGroup();b&&b._deactivate();if(this.mouseOverGui){this.mouseOverGui.focusLost();this.mouseOverGui=null;this.mouseOverGuiClickPre=false}},clearMouseOverFocus:function(){if(this.mouseOverGui){this.mouseOverGui.focusLost();
this.mouseOverGui=null;this.mouseOverGuiClickPre=false}},update:function(){var b=this.getTopButtonGroup();if(b&&b.isNonMouseMenuInput())ig.input.mouseGuiActive=false;if(ig.input.mouseGuiActive){if(b&&!this.regainFocus){this.regainFocus=true;var a=b.getCurrentElement();if(a&&this.mouseOverGui!=a){a.focus&&!this.mouseOverGui&&this._invokeMouseFocusLostCallbacks();a.focusLost()}}if(this.mouseOverGui&&sc.control.getGuiClickPre())this.mouseOverGuiClickPre=true;if(this.mouseOverGuiClickPre&&this.mouseOverGui&&
sc.control.getGuiClick()&&!ig.interact.isBlocked()){b=this.mouseOverGui.buttonGroup;if(this.mouseOverGui.active){if(this.mouseOverGui.keepPressed){if(!this.mouseOverGui.pressed){this.mouseOverGui.invokeButtonPress();this.mouseOverGui.setPressed(true)}}else this.mouseOverGui.invokeButtonPress();b&&b._invokePressCallbacks(this.mouseOverGui,true);if(b){b._lastInvokedPress&&(!b._lastInvokedPress.isSameAs(this.mouseOverGui)&&b._lastInvokedPress.keepPressed)&&b._lastInvokedPress.setPressed(false);if(!b.enableMultiPressed)b._lastInvokedPress=
this.mouseOverGui}}else this.mouseOverGui.blockedSound&&this.mouseOverGui.blockedSound.play()}if(!this.mouseIsOver&&this.mouseOverGui&&this.mouseOverGui.canLeaveFocus()){this.mouseOverGui.focusLost();this.mouseOverGui=null;this.mouseOverGuiClickPre=false;this._invokeMouseFocusLostCallbacks()}this.mouseIsOver=false}else if(b){if(this.regainFocus){a=b.getCurrentElement();if(this.mouseOverGui==a)this.regainFocus=false;if(this.mouseOverGui){this.mouseOverGui.focusLost();this.mouseOverGui=null;this.mouseOverGuiClickPre=
false}if(a&&!b.ignoreActiveFocus){a.focusGained();b._invokeSelectionCallbacks(a)}}b.doButtonTraversal(this.regainFocus);this.regainFocus=false}for(b=this.globalButtons.length;b--;)if(this.hotkeyCallbacks[b]&&this.hotkeyCallbacks[b]()){if(!this.globalButtons[b].keepMouseFocus)ig.input.mouseGuiActive=false;this.globalButtons[b].active?this.globalButtons[b].invokeButtonPress(true):this.globalButtons[b].blockedSound&&this.globalButtons[b].blockedSound.play()}},setMouseOverGui:function(b){var a=b.buttonGroup||
this.getTopButtonGroup();if(a.isActive()&&ig.input.mouseGuiActive){if(this.mouseOverGui!=b&&(this.mouseOverGui?this.mouseOverGui.canLeaveFocus():1)){this.mouseOverGui&&this.mouseOverGui.focusLost();b.canPlayFocusSounds()&&(b.keepPressed?a.soundsOnPressed?a.sounds.focus&&a.sounds.focus.play():b.pressed||a.sounds.focus&&a.sounds.focus.play():a.sounds.focus&&a.sounds.focus.play());b.focusGained();this.mouseOverGui=b;this.mouseOverGuiClickPre=false;a._invokeSelectionCallbacks(this.mouseOverGui)}this.mouseIsOver=
true}},getTopButtonGroup:function(){return this.buttonGroupStack.length>0?this.buttonGroupStack[this.buttonGroupStack.length-1]:null},_invokeMouseFocusLostCallbacks:function(){var b=this.getTopButtonGroup();b&&b.mouseFocusLostCallback&&b.mouseFocusLostCallback();for(b=this.parallelGroups.length;b--;)this.parallelGroups[b].mouseFocusLostCallback&&this.parallelGroups[b].mouseFocusLostCallback()}})});ig.baked=!0;
ig.module("impact.feature.interact.press-repeater").defines(function(){ig.PressRepeater=ig.Class.extend({currentPressed:null,lastPressed:null,timer:0,firstDelay:0.3,repeatDelay:0.1,init:function(b,a){this.firstDelay=b||0.3;this.repeatDelay=a||0.1},setDown:function(b){this.currentPressed=b},getPressed:function(){var b=this.currentPressed;this.currentPressed=null;if(b!=this.lastPressed){this.timer=this.firstDelay;return this.lastPressed=b}if(b){this.timer=this.timer-ig.system.actualTick;if(this.timer<=
0){this.timer=this.repeatDelay;return b}}return null}})});ig.baked=!0;
ig.module("impact.feature.interact.gui.focus-gui").requires("impact.feature.gui.gui").defines(function(){ig.FocusGui=ig.GuiElementBase.extend({focus:false,buttonGroup:null,buttonInteract:null,active:true,keepPressed:false,pressed:false,keepMouseFocus:false,init:function(b,a){this.parent();this.hook.setMouseRecord(true);this.active=b==void 0?true:b;this.keepPressed=a==void 0?false:a},onMouseInteract:function(b){b&&(this.buttonGroup&&this.buttonGroup.buttonInteract?this.buttonGroup.buttonInteract.setMouseOverGui(this):
this.buttonInteract&&this.buttonInteract.setMouseOverGui(this))},focusGained:function(){this.focus=true},focusLost:function(){this.focus=false},invokeButtonPress:function(){this.onButtonPress()},onButtonPress:function(){},canPlayFocusSounds:function(){return true},canLeaveFocus:function(){return true},setPressed:function(b){this.pressed=b},setActive:function(b){this.active=b},isSameAs:function(b){return this==b}})});ig.baked=!0;
ig.module("impact.feature.interact.plug-in").requires("impact.feature.interact.interact","impact.feature.interact.button-interact","impact.feature.interact.press-repeater","impact.feature.interact.gui.focus-gui").defines(function(){});ig.baked=!0;
ig.module("impact.feature.env-particles.env-particles").requires("impact.base.game","impact.base.loader").defines(function(){ig.perf.envParticles=true;ig.ENV_PARTICLES={};ig.ENV_PARTICLES.WHITE_DUST={animSheet:{sheet:{src:"media/env/particle.png",width:8,height:8,offX:0},renderMode:"lighter",SUB:[{name:"small",frames:[0],time:0.1},{name:"medium",frames:[1],time:0.1},{name:"big",frames:[2],time:0.1}]},speed:30,speedVariance:5,dir:{x:1,y:0},randomFlip:{x:true,y:false},randomRotate:0.2,time:3,timeVariance:0.5,
fadeTime:0.5,levels:[{scale:1,anim:"small"},{scale:1.2,anim:"medium"},{scale:1.5,anim:"big"}]};ig.ENV_PARTICLES.DARK_DUST={animSheet:{sheet:{src:"media/env/particle.png",width:8,height:8,offY:8},renderMode:"lighter",SUB:[{name:"small",frames:[0],time:0.1},{name:"medium",frames:[1],time:0.1},{name:"big",frames:[2],time:0.1}]},speed:30,speedVariance:5,dir:{x:1,y:0},randomFlip:{x:true,y:false},randomRotate:0.2,time:3,timeVariance:0.5,fadeTime:0.5,levels:[{scale:1,anim:"small"},{scale:1.2,anim:"medium"},
{scale:1.5,anim:"big"}]};ig.ENV_PARTICLES.LEAVES={animSheet:{sheet:{src:"media/env/particle.png",width:8,height:8,offX:24},SUB:[{name:"small",frames:[0],time:0.1},{name:"medium",frames:[1],time:0.1},{name:"big",frames:[2],time:0.1}]},speed:90,speedVariance:20,dir:{x:1,y:0.8},randomFlip:{x:false,y:false},randomRotate:0.1,rotateToDir:0.375,sineRotate:0.1,sineRotateTime:1.3,time:5,timeVariance:0.5,fadeTime:0.5,levels:[{scale:1,anim:"small"},{scale:1.2,anim:"medium"},{scale:1.5,anim:"big"}]};ig.ENV_PARTICLES.GREEN_LEAVES=
{animSheet:{sheet:{src:"media/env/particle.png",width:8,height:8,offX:24,offY:8},SUB:[{name:"small",frames:[0],time:0.1},{name:"medium",frames:[1],time:0.1},{name:"big",frames:[2],time:0.1}]},speed:90,speedVariance:20,dir:{x:1,y:0.8},randomFlip:{x:false,y:false},randomRotate:0.1,rotateToDir:0.375,sineRotate:0.1,sineRotateTime:1.3,time:5,timeVariance:0.5,fadeTime:0.5,levels:[{scale:1,anim:"small"},{scale:1.2,anim:"medium"},{scale:1.5,anim:"big"}]};ig.ENV_PARTICLES.JUNGLE_LEAVES={animSheet:{sheet:{src:"media/env/particle.png",
width:8,height:8,offX:24,offY:32},SUB:[{name:"small",frames:[0],time:0.1},{name:"medium",frames:[1],time:0.1},{name:"big",frames:[2],time:0.1}]},speed:90,speedVariance:20,dir:{x:1,y:0.8},randomFlip:{x:false,y:false},randomRotate:0.1,rotateToDir:0.375,sineRotate:0.1,sineRotateTime:1.3,time:5,timeVariance:0.5,fadeTime:0.5,levels:[{scale:1,anim:"small"},{scale:1.2,anim:"medium"},{scale:1.5,anim:"big"}]};ig.ENV_PARTICLES.BLUE_SQUARES={animSheet:{sheet:{src:"media/env/particle.png",width:8,height:8,offX:48},
renderMode:"lighter",SUB:[{name:"small",frames:[0],time:0.1},{name:"medium",frames:[1],time:0.1},{name:"big",frames:[2],time:0.1}]},speed:30,speedVariance:10,dir:{x:0,y:-1},randomFlip:{x:false,y:false},time:2,timeVariance:0.5,fadeTime:0.5,levels:[{scale:1,anim:"small"},{scale:1.2,anim:"medium"},{scale:1.5,anim:"big"}]};ig.ENV_PARTICLES.RED_SQUARES={animSheet:{sheet:{src:"media/env/particle.png",width:8,height:8,offX:72},renderMode:"lighter",SUB:[{name:"small",frames:[0],time:0.1},{name:"medium",frames:[1],
time:0.1},{name:"big",frames:[2],time:0.1}]},speed:80,speedVariance:20,dir:{x:0,y:-1},randomFlip:{x:false,y:false},time:1.2,timeVariance:0.3,fadeTime:0.3,levels:[{scale:1,anim:"small"},{scale:1.2,anim:"medium"},{scale:1.5,anim:"big"}]};ig.ENV_PARTICLES.SNOW_FLAKES={animSheet:{sheet:{src:"media/env/particle.png",width:8,height:8,offX:96},renderMode:"lighter",SUB:[{name:"small",frames:[0],time:0.1},{name:"medium",frames:[1],time:0.1},{name:"big",frames:[2],time:0.1}]},speed:120,speedVariance:20,dir:{x:0.4,
y:1},randomFlip:{x:false,y:false},sineRotate:0.05,sineRotateTime:0.5,time:2.5,timeVariance:0.5,fadeTime:0.5,levels:[{scale:1,anim:"small"},{scale:1.2,anim:"medium"},{scale:1.5,anim:"big"}]};ig.ENV_PARTICLES.COLD_CRYSTALS={animSheet:{sheet:{src:"media/env/particle.png",width:8,height:8,offX:96,offY:8},renderMode:"lighter",SUB:[{name:"small",frames:[0],time:0.1},{name:"medium",frames:[1],time:0.1},{name:"big",frames:[2],time:0.1}]},speed:30,speedVariance:5,dir:{x:1,y:0},randomFlip:{x:true,y:false},
randomRotate:0.2,time:3,timeVariance:0.5,fadeTime:0.5,levels:[{scale:1,anim:"small"},{scale:1.2,anim:"medium"},{scale:1.5,anim:"big"}]};ig.ENV_PARTICLES.SAND_OUTSIDE={animSheet:{sheet:{src:"media/env/particle.png",width:8,height:8,offY:24},SUB:[{name:"small",frames:[0],time:0.1},{name:"medium",frames:[1],time:0.1},{name:"big",frames:[2],time:0.1}]},speed:160,speedVariance:20,dir:{x:1,y:0.2},randomFlip:{x:false,y:false},randomRotate:0.1,sineRotate:0.05,sineRotateTime:4,time:5,timeVariance:0.5,fadeTime:0.5,
levels:[{scale:1,anim:"small"},{scale:1.2,anim:"medium"},{scale:1.5,anim:"big"}]};ig.ENV_PARTICLES.SANDSTORM={animSheet:{sheet:{src:"media/env/particle.png",width:8,height:8,offY:24},SUB:[{name:"small",frames:[0],time:0.1},{name:"medium",frames:[1],time:0.1},{name:"big",frames:[2],time:0.1}]},speed:320,speedVariance:20,dir:{x:1,y:0.2},randomFlip:{x:false,y:false},randomRotate:0.1,sineRotate:0.05,sineRotateTime:4,time:2,timeVariance:0.5,fadeTime:0.2,levels:[{scale:1,anim:"small"},{scale:1.2,anim:"medium"},
{scale:1.5,anim:"big"}]};ig.ENV_PARTICLES.BEACH_GLOW={animSheet:{renderMode:"lighter",SUB:[{name:"big",frames:[0],time:0.2,sheet:{src:"media/env/particle.png",width:32,height:32,offX:24,offY:144}},{name:"medium",frames:[0],time:0.2,sheet:{src:"media/env/particle.png",width:24,height:24,offX:0,offY:144}},{name:"small",frames:[0],time:0.2,sheet:{src:"media/env/particle.png",width:16,height:16,offX:40,offY:128}},{name:"tiny",frames:[0],time:0.2,sheet:{src:"media/env/particle.png",width:16,height:16,
offX:24,offY:128}}]},speed:10,speedVariance:5,dir:{x:0,y:-1},rotateToDir:0.25,randomFlip:{x:false,y:false},randomRotate:1,timeRotate:0.07,time:3,timeVariance:2,fadeTime:0.5,levels:[{scale:1,anim:"tiny"},{scale:1.25,anim:"small"},{scale:1.5,anim:"medium"}]};ig.ENV_PARTICLES.BEACH_GLOW_BIG={animSheet:{renderMode:"lighter",SUB:[{name:"big",frames:[0],time:0.2,sheet:{src:"media/env/particle.png",width:32,height:32,offX:24,offY:144}},{name:"medium",frames:[0],time:0.2,sheet:{src:"media/env/particle.png",
width:24,height:24,offX:0,offY:144}},{name:"small",frames:[0],time:0.2,sheet:{src:"media/env/particle.png",width:16,height:16,offX:40,offY:128}},{name:"tiny",frames:[0],time:0.2,sheet:{src:"media/env/particle.png",width:16,height:16,offX:24,offY:128}}]},speed:10,speedVariance:5,dir:{x:0,y:-1},rotateToDir:0.25,randomFlip:{x:false,y:false},randomRotate:1,timeRotate:0.07,time:3,timeVariance:2,fadeTime:0.5,levels:[{scale:1.25,anim:"big"},{scale:1.5,anim:"big"}]};ig.ENV_PARTICLES.FINAL_GLOW={animSheet:{renderMode:"lighter",
SUB:[{name:"big",frames:[0],time:0.2,sheet:{src:"media/env/particle.png",width:32,height:32,offX:96,offY:56}},{name:"medium",frames:[0],time:0.2,sheet:{src:"media/env/particle.png",width:24,height:24,offX:72,offY:56}},{name:"small",frames:[0],time:0.2,sheet:{src:"media/env/particle.png",width:24,height:24,offX:112,offY:40}}]},speed:10,speedVariance:5,dir:{x:0,y:-1},rotateToDir:0.25,randomFlip:{x:true,y:false},randomRotate:1,timeRotate:0.25,time:3,timeVariance:0,fadeTime:0.5,levels:[{scale:1.25,anim:"medium"},
{scale:1.5,anim:"big"}]};ig.ENV_PARTICLES.FINAL_WHIRL={animSheet:{sheet:{src:"media/env/particle.png",width:8,height:8,offX:80,offY:88},renderMode:"lighter",SUB:[{name:"big",frames:[0,1,2,3,4,5],time:0.2},{name:"medium",frames:[0,1,2,3,4,5],time:0.2,tileOffset:6},{name:"small",frames:[0,1,2,3,4,5],time:0.2,tileOffset:12}]},speed:10,speedVariance:5,dir:{x:0,y:-1},rotateToDir:0.25,randomFlip:{x:true,y:false},randomRotate:0.1,time:1.2,timeVariance:0,fadeTime:0.1,levels:[{scale:1,anim:"small"},{scale:1.2,
anim:"medium"},{scale:1.5,anim:"big"}]};ig.ENV_PARTICLES.FINAL_WHIRL_FAST={animSheet:{sheet:{src:"media/env/particle.png",width:8,height:8,offX:80,offY:88},renderMode:"lighter",SUB:[{name:"big",frames:[0,1,2,3,4,5],time:0.1},{name:"medium",frames:[0,1,2,3,4,5],time:0.1,tileOffset:6},{name:"small",frames:[0,1,2,3,4,5],time:0.1,tileOffset:12}]},speed:80,speedVariance:5,dir:{x:0,y:-1},rotateToDir:0.25,randomFlip:{x:true,y:false},randomRotate:0.1,time:0.6,timeVariance:0,fadeTime:0.1,levels:[{scale:1,
anim:"small"},{scale:1.2,anim:"medium"},{scale:1.5,anim:"big"}]};ig.ENV_PARTICLES.COAL_SPARKS={animSheet:{sheet:{src:"media/env/particle.png",width:8,height:8,offY:16,offX:24},renderMode:"lighter",SUB:[{name:"small",frames:[0],time:0.1},{name:"medium",frames:[1],time:0.1},{name:"big",frames:[2],time:0.1}]},speed:120,speedVariance:20,dir:{x:0,y:-1},randomFlip:{x:false,y:false},randomRotate:0.1,sineRotate:0.05,sineRotateTime:4,time:3,timeVariance:0.5,fadeTime:0.5,levels:[{scale:1,anim:"small"},{scale:1.2,
anim:"medium"},{scale:1.5,anim:"big"}]};ig.ENV_PARTICLES.COAL_SPARKS_FAST={animSheet:{sheet:{src:"media/env/particle.png",width:8,height:8,offY:24,offX:24},renderMode:"lighter",SUB:[{name:"small",frames:[0],time:0.1},{name:"medium",frames:[1],time:0.1},{name:"big",frames:[2],time:0.1}]},speed:240,speedVariance:40,dir:{x:0,y:-1},randomFlip:{x:false,y:false},randomRotate:0.1,sineRotate:0.05,sineRotateTime:4,time:2,timeVariance:0.5,fadeTime:0.5,levels:[{scale:1,anim:"small"},{scale:1.2,anim:"medium"},
{scale:1.5,anim:"big"}]};ig.ENV_PARTICLES.INFESTED_DUST={animSheet:{sheet:{src:"media/env/particle.png",width:8,height:8,offY:16,offX:48},renderMode:"lighter",SUB:[{name:"small",frames:[0],time:0.1},{name:"medium",frames:[1],time:0.1},{name:"big",frames:[2],time:0.1}]},speed:20,speedVariance:5,dir:{x:0,y:1},randomFlip:{x:true,y:false},randomRotate:1,time:3,timeVariance:0.5,fadeTime:0.5,levels:[{scale:1,anim:"small"},{scale:1.2,anim:"medium"},{scale:1.5,anim:"big"}]};ig.ENV_PARTICLES.WAVE_DUST={animSheet:{sheet:{src:"media/env/particle.png",
width:8,height:8,offY:24,offX:48},renderMode:"lighter",SUB:[{name:"small",frames:[0],time:0.1},{name:"medium",frames:[1],time:0.1},{name:"big",frames:[2],time:0.1}]},speed:20,speedVariance:5,dir:{x:0,y:1},randomFlip:{x:true,y:false},randomRotate:1,time:3,timeVariance:0.5,fadeTime:0.5,levels:[{scale:1,anim:"small"},{scale:1.2,anim:"medium"},{scale:1.5,anim:"big"}]};ig.ENV_PARTICLES.SPOOKY_DUST={animSheet:{sheet:{src:"media/env/particle.png",width:8,height:8,offY:16,offX:72},renderMode:"lighter",SUB:[{name:"small",
frames:[0],time:0.1},{name:"medium",frames:[1],time:0.1},{name:"big",frames:[2],time:0.1}]},speed:20,speedVariance:5,dir:{x:0,y:1},randomFlip:{x:true,y:false},randomRotate:1,time:3,timeVariance:0.5,fadeTime:0.5,levels:[{scale:1,anim:"small"},{scale:1.2,anim:"medium"},{scale:1.5,anim:"big"}]};ig.ENV_PARTICLES.ARID_DUST_1={animSheet:{sheet:{src:"media/env/particle.png",width:8,height:8,offY:16,offX:96},renderMode:"lighter",repeat:true,SUB:[{name:"small",frames:[0,1,2,3],time:0.2},{name:"medium",frames:[4,
5,6,7],time:0.2},{name:"big",frames:[8,9,10,11],time:0.2}]},speed:10,speedVariance:2,dir:{x:0,y:-1},randomFlip:{x:false,y:false},randomRotate:0,sineRotate:0,sineRotateTime:2,time:5,timeVariance:0.5,fadeTime:0.5,levels:[{scale:1,anim:"small"},{scale:1.2,anim:"medium"},{scale:1.5,anim:"big"}]};ig.ENV_PARTICLES.ARID_DUST_FAST={animSheet:{sheet:{src:"media/env/particle.png",width:8,height:8,offY:16,offX:96},renderMode:"lighter",repeat:true,SUB:[{name:"small",frames:[0,1,2,3],time:0.2},{name:"medium",
frames:[4,5,6,7],time:0.2},{name:"big",frames:[8,9,10,11],time:0.2}]},speed:100,speedVariance:2,dir:{x:0,y:-1},randomFlip:{x:false,y:false},randomRotate:0,sineRotate:0,sineRotateTime:2,time:5,timeVariance:0.5,fadeTime:0.5,levels:[{scale:1,anim:"small"},{scale:1.2,anim:"medium"},{scale:1.5,anim:"big"}]};ig.ENV_PARTICLES.ARID_DUST_ELEVATOR_UP={animSheet:{sheet:{src:"media/env/particle.png",width:8,height:8,offY:16,offX:96},renderMode:"lighter",repeat:true,SUB:[{name:"small",frames:[0,1,2,3],time:0.2},
{name:"medium",frames:[4,5,6,7],time:0.2},{name:"big",frames:[8,9,10,11],time:0.2}]},speed:350,speedVariance:2,dir:{x:0,y:1},randomFlip:{x:false,y:false},randomRotate:0,sineRotate:0,sineRotateTime:2,time:0.5,timeVariance:0.2,fadeTime:0.2,levels:[{scale:1,anim:"small"},{scale:1.2,anim:"medium"},{scale:1.5,anim:"big"}]};ig.ENV_PARTICLES.ARID_DUST_ELEVATOR_DOWN={animSheet:{sheet:{src:"media/env/particle.png",width:8,height:8,offY:16,offX:96},renderMode:"lighter",repeat:true,SUB:[{name:"small",frames:[0,
1,2,3],time:0.2},{name:"medium",frames:[4,5,6,7],time:0.2},{name:"big",frames:[8,9,10,11],time:0.2}]},speed:-350,speedVariance:2,dir:{x:0,y:1},randomFlip:{x:false,y:false},randomRotate:0,sineRotate:0,sineRotateTime:2,time:0.5,timeVariance:0.2,fadeTime:0.2,levels:[{scale:1,anim:"small"},{scale:1.2,anim:"medium"},{scale:1.5,anim:"big"}]};ig.ENV_PARTICLES.RHOMBUS={animSheet:{sheet:{src:"media/env/particle.png",width:16,height:16,offY:40,offX:0},renderMode:"lighter",SUB:[{name:"small",frames:[0],time:0.1},
{name:"medium",frames:[1],time:0.1},{name:"big",frames:[2],time:0.1}]},speed:20,speedVariance:5,dir:{x:0,y:-1},randomFlip:{x:false,y:false},time:3,timeVariance:0.5,fadeTime:0.5,levels:[{scale:1,anim:"small"},{scale:1.2,anim:"medium"},{scale:1.5,anim:"big"}]};ig.ENV_PARTICLES.HACKING={animSheet:{sheet:{src:"media/env/particle.png",width:16,height:16,offY:40,offX:48},renderMode:"lighter",SUB:[{name:"small",frames:[0],time:0.1},{name:"medium",frames:[1],time:0.1},{name:"big",frames:[2],time:0.1}]},speed:120,
speedVariance:5,dir:{x:0,y:-1},randomFlip:{x:false,y:false},randomRotate:1,time:0.7,timeVariance:0.2,fadeTime:0.2,levels:[{scale:1,anim:"small"},{scale:1.2,anim:"medium"},{scale:1.5,anim:"big"}]};ig.ENV_PARTICLES.STARS={animSheet:{sheet:{src:"media/env/particle.png",width:24,height:24,offY:56,offX:0},renderMode:"lighter",SUB:[{name:"small",frames:[0],time:0.1},{name:"medium",frames:[1],time:0.1},{name:"big",frames:[2],time:0.1}]},speed:160,speedVariance:20,dir:{x:0.5,y:-1},randomFlip:{x:false,y:false},
randomRotate:0,timeRotate:0.5,time:2,timeVariance:0.2,fadeTime:0.5,levels:[{scale:1,anim:"small"},{scale:1.2,anim:"medium"},{scale:1.5,anim:"big"}]};ig.ENV_PARTICLES.SLOWDOWN={animSheet:{sheet:{src:"media/env/particle.png",width:29,height:29,offY:88,offX:0},renderMode:"lighter",SUB:[{name:"small",frames:[0],time:0.1},{name:"medium",frames:[1],time:0.1},{name:"big",frames:[0],time:0.1}]},speed:80,speedVariance:20,dir:{x:0,y:-1},randomFlip:{x:true,y:false},randomRotate:0,timeRotate:0.1,time:1,timeVariance:0.2,
fadeTime:0.5,levels:[{scale:1,anim:"small"},{scale:1,anim:"medium"}],ignoreSlowdown:true,renderInScreen:true};var b=Vec2.create();ig.EnvParticleSpawner=ig.Cacheable.extend({cacheType:"EnvParticleSpawner",name:null,animSheet:null,config:null,levels:[],init:function(a){this.parent();this.name=a;var b=ig.ENV_PARTICLES[a];b||ig.warn("Unknown environment particles '"+a+"'");if(this.config=b){this.animSheet=new ig.AnimationSheet(b.animSheet);this._initLevels()}},getCacheKey:function(a){return a},onCacheCleared:function(){this.animSheet&&
this.animSheet.clearCached()},_initLevels:function(){if(this.config)for(var a=this.config.levels,b=0;b<a.length;++b){var d=a[b];this.levels.push({scale:d.scale,anim:d.anim,spawnInterval:0,spawnTimer:0,particles:[]})}},setQuantity:function(a,b){if(this.config){for(var d=0,g=0;g<this.levels.length;++g)d=d+1/this.levels[g].scale;for(g=0;g<this.levels.length;++g){var h=this.levels[g],i=a*(1/h.scale)/d;h.spawnInterval=this.config.time/i;h.spawnTimer=Math.random()*h.spawnInterval;if(b)for(var j=h.particles.length=
0;j<i;++j){this.updateParticles(h,h.spawnInterval);this.spawnParticle(h)}}}},update:function(){if(this.config){for(var a=true,b=this.levels.length;b--;){var d=this.levels[b],g=this.getTick();this.updateParticles(d,g);if(d.spawnInterval){a=false;for(d.spawnTimer=d.spawnTimer+g;d.spawnTimer>=d.spawnInterval;){d.spawnTimer=d.spawnTimer-d.spawnInterval;this.spawnParticle(d)}}else d.particles.length>0&&(a=false)}return a}},getTick:function(){return this.config.ignoreSlowdown?ig.system.actualTick:ig.system.tick},
spawnParticle:function(a){if(this.config){var b=this.config.time+(Math.random()-0.5)*2*this.config.timeVariance,d=Vec2.createC(ig.envParticles.width,ig.envParticles.height);Vec2.mulC(d,Math.random(),Math.random());var g=Vec2.create(this.config.dir);if(this.config.randomFlip.x&&Math.random()>=0.5)g.x=g.x*-1;if(this.config.randomFlip.y&&Math.random()>=0.5)g.y=g.y*-1;if(this.config.randomRotate>0){var h=(Math.random()-0.5)*this.config.randomRotate*2*Math.PI;Vec2.rotate(g,h)}h=this.config.speed+(Math.random()-
0.5)*2*this.config.speedVariance*a.scale;Vec2.length(g,h);a.particles.push({duration:b,timer:0,hideTimer:0,pos:d,vel:g,roughDisplayPos:-1})}},updateParticles:function(b,d){for(var f=b.particles,g=f.length;g--;){var h=f[g];h.timer=h.timer+d;if(h.timer>=h.duration)f.splice(g,1);else{if(this.config.sineRotateTime){var i=Math.sin(Math.PI*2*h.timer/this.config.sineRotateTime+Math.PI*0.52)*this.config.sineRotate*this.getTick()*22/this.config.sineRotateTime,j=Vec2.assign(a,h.vel),k=Vec2.length(h.vel);Vec2.rotate90CW(j);
Vec2.mulF(j,i);Vec2.add(h.vel,j);Vec2.length(h.vel,k)}Vec2.addMulF(h.pos,h.vel,d)}}},draw:function(){if(this.config)for(var a=this.levels.length;a--;)this.drawLevel(this.levels[a])},drawLevel:function(a){var e=ig.game.renderer,f=this.animSheet.anims[a.anim].getAnimations(),g=a.particles,h=g.length,i=0,j=a.scale,a=(j-1)*(ig.system.zoom-1),k=0,l=0;if(j!=1)var o=ig.system.getMapFromScreenPos(b,ig.system.width/2,ig.system.height/2),k=ig.game.screen.x+ig.system.width/2-o.x,l=ig.game.screen.y+ig.system.height/
2-o.y;for(var o=ig.envParticles.width,m=ig.envParticles.height,k=(ig.game.screen.x-k)*j+k,j=(ig.game.screen.y-l)*j+l,l=this.config.fadeTime;h--;){var n=g[h],p=n.pos.x-(this.config.renderInScreen?0:k),r=n.pos.y-(this.config.renderInScreen?0:j),p=(p%o+o)%o,r=(r%m+m)%m,p=p-d,r=r-d,t=(p>o/2?1:0)+(r>m/2?2:0),q=t!=n.roughDisplayPos;n.roughDisplayPos=t;if(a){p=p+(p-o/2)*a;r=r+(r-m/2)*a}if(!ig.weather.outside&&ig.game.isMapTileEmpty(p+ig.game.screen.x,r+ig.game.screen.y))n.hideTimer=q?0.3:Math.min(0.3,n.hideTimer+
this.getTick());else if(n.hideTimer>0)n.hideTimer=q?0:Math.max(0,n.hideTimer-this.getTick());if(!(n.hideTimer>=0.3)){this.config.rotateToDir!=void 0&&(i=Vec2.clockangle(n.vel)-this.config.rotateToDir*2*Math.PI);this.config.timeRotate&&(i=this.config.timeRotate*n.timer*2*Math.PI);t=1-n.hideTimer/0.3;n.timer<l?t=t*(n.timer/l):n.timer>n.duration-l&&(t=t*((n.duration-n.timer)/l));for(q=f.length;q--;)e.drawAnimation(f[q],p,r,n.timer,t,i)}}}});var a=Vec2.create(),d=32;ig.EnvParticles=ig.GameAddon.extend({activeSpawners:[],
width:0,height:0,init:function(){this.parent("EnvParticles");this.width=ig.system.width+d*2;this.height=ig.system.height+d*2},addSpawner:function(a,b,d){this.activeSpawners.indexOf(a)==-1&&b>0&&this.activeSpawners.push(a);a.setQuantity(b,d)},clear:function(a){for(var b=this.activeSpawners.length;b--;)this.activeSpawners[b].setQuantity(0,a);if(a)this.activeSpawners.length=0},deferredUpdateOrder:0,onDeferredUpdate:function(){if(!ig.game.paused)for(var a=this.activeSpawners.length;a--;)this.activeSpawners[a].update()&&
this.activeSpawners.splice(a,1)},midDrawOrder:101,onMidDraw:function(){if(ig.perf.envParticles&&sc.options.get("env-particles")){for(var a=this.activeSpawners.length;a--;)this.activeSpawners[a].draw();ig.system.context.globalCompositeOperation="source-over"}}});ig.addGameAddon(function(){return ig.envParticles=new ig.EnvParticles})});ig.baked=!0;
ig.module("impact.feature.env-particles.env-particles-steps").requires("impact.feature.env-particles.env-particles","impact.base.action","impact.base.event").defines(function(){ig.EVENT_STEP.SET_ENV_PARTICLES=ig.EventStepBase.extend({spawner:0,quantity:0,_wm:new ig.Config({attributes:{particleType:{_type:"String",_info:"Type of Env Particles",_select:ig.ENV_PARTICLES},quantity:{_type:"NumberExpression",_info:"Quantity of particles (average number of visible particles)",_default:10},immediately:{_type:"Boolean",
_info:"If true: make change immediate",_optional:true}}}),init:function(b){this.spawner=new ig.EnvParticleSpawner(b.particleType);this.quantity=b.quantity;this.immediately=b.immediately||false},clearCached:function(){this.spawner.decreaseRef()},start:function(){var b=ig.Event.getExpressionValue(this.quantity)||0;ig.envParticles.addSpawner(this.spawner,b,this.immediately)}});ig.EVENT_STEP.CLEAR_ENV_PARTICLES=ig.EventStepBase.extend({spawner:0,_wm:new ig.Config({attributes:{particleType:{_type:"String",
_info:"Type of Env Particles",_select:ig.ENV_PARTICLES},immediately:{_type:"Boolean",_info:"If true: make change immediate",_optional:true}}}),init:function(b){this.spawner=new ig.EnvParticleSpawner(b.particleType);this.immediately=b.immediately||false},clearCached:function(){this.spawner.decreaseRef()},start:function(){ig.envParticles.addSpawner(this.spawner,0,this.immediately)}});ig.ACTION_STEP.SET_ENV_PARTICLES=ig.ActionStepBase.extend({spawner:0,quantity:0,_wm:new ig.Config({attributes:{particleType:{_type:"String",
_info:"Type of Env Particles",_select:ig.ENV_PARTICLES},quantity:{_type:"NumberExpression",_info:"Quantity of particles (average number of visible particles)",_default:10},immediately:{_type:"Boolean",_info:"If true: make change immediate",_optional:true}}}),init:function(b){this.spawner=new ig.EnvParticleSpawner(b.particleType);this.quantity=b.quantity;this.immediately=b.immediately||false},clearCached:function(){this.spawner.decreaseRef()},start:function(){var b=ig.Event.getExpressionValue(this.quantity)||
0;ig.envParticles.addSpawner(this.spawner,b,this.immediately)}});ig.ACTION_STEP.CLEAR_ENV_PARTICLES=ig.ActionStepBase.extend({spawner:0,_wm:new ig.Config({attributes:{particleType:{_type:"String",_info:"Type of Env Particles",_select:ig.ENV_PARTICLES},immediately:{_type:"Boolean",_info:"If true: make change immediate",_optional:true}}}),init:function(b){this.spawner=new ig.EnvParticleSpawner(b.particleType);this.immediately=b.immediately||false},clearCached:function(){this.spawner.decreaseRef()},
start:function(){ig.envParticles.addSpawner(this.spawner,0,this.immediately)}})});ig.baked=!0;ig.module("impact.feature.env-particles.plug-in").requires("impact.feature.env-particles.env-particles","impact.feature.env-particles.env-particles-steps").defines(function(){});ig.baked=!0;
ig.module("impact.feature.storage.plug-in").requires("impact.feature.storage.storage").defines(function(){window.wm&&wm.mapAttribs&&(wm.mapAttribs.saveMode={_type:"String",_select:ig.SAVE_MODE,_info:"Save Mode of the map (Enabled = can save at any time, disable = only on savepoints)",_withNull:true})});ig.baked=!0;
ig.module("impact.feature.weather.weather-steps").requires("impact.feature.weather.weather","impact.base.action","impact.base.event").defines(function(){ig.EVENT_STEP.SET_WEATHER=ig.EventStepBase.extend({weather:0,_wm:new ig.Config({attributes:{weather:{_type:"String",_info:"Type of Weather",_select:ig.WEATHER_TYPES},immediately:{_type:"Boolean",_info:"If true, change weather immediately with no transition"}}}),init:function(b){this.weather=new ig.WeatherInstance(b.weather||"NONE");this.immediately=
b.immediately},clearCached:function(){this.weather.decreaseRef()},start:function(){ig.weather.setWeather(this.weather,this.immediately)}});ig.EVENT_STEP.RESTORE_WEATHER_PARTICLES=ig.EventStepBase.extend({_wm:new ig.Config({attributes:{immediately:{_type:"Boolean",_info:"If true: make change immediate",_optional:true}}}),init:function(b){this.immediately=b.immediately||false},start:function(){ig.weather.restoreParticles(this.immediately)}})});ig.baked=!0;
ig.module("impact.feature.weather.plug-in").requires("impact.feature.weather.weather","impact.feature.weather.weather-steps").defines(function(){window.wm&&wm.mapAttribs&&(wm.mapAttribs.weather={_type:"String",_select:ig.WEATHER_TYPES,_info:"Weather to be displayed"})});ig.baked=!0;
ig.module("impact.feature.map-sounds.map-sounds").requires("impact.base.game").defines(function(){ig.MAP_SOUNDS={};ig.MAP_SOUNDS.CARGO_SHIP_OUTSIDE={loop:[{path:"media/sound/background/cargo/cargo-ambient-out.ogg",volume:1},{path:"media/sound/background/cargo/ocean-ambient.ogg",volume:0.5}],segments:[[{wait:1},{path:"media/sound/background/cargo/seagull-a.ogg",volume:0.8},{wait:10}],[{wait:2},{path:"media/sound/background/cargo/seagull-a.ogg",volume:0.4},{wait:8}],[{wait:2},{path:"media/sound/background/cargo/seagull-b.ogg",
volume:0.5},{wait:15}],[{wait:2},{path:"media/sound/background/cargo/seagull-b.ogg",volume:0.7},{wait:17}],[{wait:1},{path:"media/sound/background/cargo/seagull-c.ogg",volume:0.7},{wait:11}]]};ig.MAP_SOUNDS.CARGO_SHIP_OUTSIDE_RAIN={loop:[{path:"media/sound/background/cargo/cargo-ambient-out.ogg",volume:1},{path:"media/sound/background/cargo/ocean-ambient.ogg",volume:0.5}],segments:[]};ig.MAP_SOUNDS.CARGO_SHIP_INSIDE={loop:[{path:"media/sound/background/ship-outside.ogg",volume:1}],segments:[]};ig.MAP_SOUNDS.STRONG_RAIN=
{loop:[{path:"media/sound/background/rain.ogg",volume:0.7}],segments:[]};ig.MAP_SOUNDS.LIGHT_WIND={loop:[{path:"media/sound/background/wind.ogg",volume:0.8}],segments:[]};ig.MAP_SOUNDS.CARGO_SHIP_AMBIENT_A={loop:[{path:"media/sound/background/cargo/cargo-ambient-a.ogg",volume:0.2}],segments:[]};ig.MAP_SOUNDS.CARGO_SHIP_AMBIENT_B={loop:[{path:"media/sound/background/cargo/cargo-ambient-b.ogg",volume:0.6}],segments:[]};ig.MAP_SOUNDS.CARGO_SHIP_AMBIENT_C={loop:[{path:"media/sound/background/cargo/cargo-ambient-c.ogg",
volume:0.6}],segments:[]};ig.MAP_SOUNDS.CARGO_SHIP_AMBIENT_D={loop:[{path:"media/sound/background/cargo/cargo-ambient-d.ogg",volume:0.6}],segments:[]};ig.MAP_SOUNDS.CARGO_SHIP_AMBIENT_E={loop:[{path:"media/sound/background/cargo/cargo-ambient-e.ogg",volume:0.6}],segments:[]};ig.MAP_SOUNDS.CARGO_SHIP_AMBIENT_F={loop:[{path:"media/sound/background/cargo/cargo-ambient-f.ogg",volume:0.5}],segments:[]};ig.MAP_SOUNDS.CARGO_SHIP_AMBIENT_G={loop:[{path:"media/sound/background/cargo/cargo-ambient-g.ogg",volume:0.6}],
segments:[]};ig.MAP_SOUNDS.CARGO_SHIP_AMBIENT_H={loop:[{path:"media/sound/background/cargo/cargo-ambient-h.ogg",volume:0.6}],segments:[]};ig.MAP_SOUNDS.HIDEOUT_AMBIENT={loop:[{path:"media/sound/background/hideout/hideout-ambient.ogg",volume:0.8}],segments:[]};ig.MAP_SOUNDS.HIDEOUT_INNER_AMBIENT={loop:[{path:"media/sound/background/hideout/hideout-inner-ambient.ogg",volume:1}],segments:[]};ig.MAP_SOUNDS.SAPPHIRE_RIDGE_AMBIENT={loop:[{path:"media/sound/background/sapphire-ridge/sapphire-ridge-ambient.ogg",
volume:1}],segments:[]};ig.MAP_SOUNDS.HIDEOUT_OFFICE_AMBIENT={loop:[{path:"media/sound/background/hideout/hideout-office-ambient.ogg",volume:0.8}],segments:[]};ig.MAP_SOUNDS.CROSS_CENTRAL_INNER={loop:[{path:"media/sound/background/rhombus-square/cross-central-inner.ogg",volume:1}],segments:[]};ig.MAP_SOUNDS.NEWCOMERS_BRIDGE={loop:[{path:"media/sound/background/rhombus-square/bridge-wind-ambient.ogg",volume:0.7}],segments:[]};ig.MAP_SOUNDS.BERGEN_TRAIL_WIND={loop:[{path:"media/sound/background/bergen-trail/bergen-wind.ogg",
volume:1}],segments:[]};ig.MAP_SOUNDS.BERGEN_TRAIL_WIND_SUBTLE={loop:[{path:"media/sound/background/bergen-trail/bergen-wind-subtle.ogg",volume:1}],segments:[]};ig.MAP_SOUNDS.ROOKIE_HARBOR_TELEPORTER={loop:[{path:"media/sound/background/cargo/ocean-ambient.ogg",volume:0.5}],segments:[[{wait:1},{path:"media/sound/background/cargo/seagull-a.ogg",volume:0.8},{wait:10}],[{wait:2},{path:"media/sound/background/cargo/seagull-a.ogg",volume:0.4},{wait:8}],[{wait:2},{path:"media/sound/background/cargo/seagull-b.ogg",
volume:0.5},{wait:15}],[{wait:2},{path:"media/sound/background/cargo/seagull-b.ogg",volume:0.7},{wait:17}],[{wait:1},{path:"media/sound/background/cargo/seagull-c.ogg",volume:0.7},{wait:11}]]};ig.MAP_SOUNDS.ROOKIE_HARBOR_OCEAN={loop:[{path:"media/sound/background/cargo/ocean-ambient.ogg",volume:0.5}],segments:[]};ig.MAP_SOUNDS.CROWD={loop:[{path:"media/sound/background/crowd-ambient.ogg",volume:0.5}],segments:[]};ig.MAP_SOUNDS.ROOKIE_HARBOR_CROWD={loop:[{path:"media/sound/background/crowd-ambient.ogg",
volume:0.5}],segments:[]};ig.MAP_SOUNDS.HEAT_AREA_DESERT={loop:[{path:"media/sound/background/desert/desert-ambient.ogg",volume:0.5}],segments:[]};ig.MAP_SOUNDS.HEAT_AREA_WIND={loop:[{path:"media/sound/background/desert/sandstorm-ambient.ogg",volume:0.2}],segments:[]};ig.MAP_SOUNDS.HEAT_AREA_OASIS={loop:[{path:"media/sound/background/desert/oasis-ambient.ogg",volume:1}],segments:[]};ig.MAP_SOUNDS.CAVE={loop:[{path:"media/sound/background/cave-ambient.ogg",volume:0.8}],segments:[]};ig.MAP_SOUNDS.CAVE_WATER_DROPS=
{loop:[{path:"media/sound/background/cave-water-drops.ogg",volume:1}],segments:[]};ig.MAP_SOUNDS["BAKI-KUM"]={loop:[{path:"media/sound/background/baki-kum/baki-kum-ambient.ogg",volume:0.8}],segments:[]};ig.MAP_SOUNDS.HEAT_DUNGEON_OUTSIDE={loop:[{path:"media/sound/background/strong-wind.ogg",volume:0.5}],segments:[]};ig.MAP_SOUNDS.DREAM={loop:[{path:"media/sound/background/dreams/dream-atmo.ogg",volume:0.5}],segments:[]};ig.MAP_SOUNDS.JUNGLE={loop:[{path:"media/sound/background/jungle/jungle-atmo.ogg",
volume:0.5}],segments:[]};ig.MAP_SOUNDS.JUNGLE_INFESTED={loop:[{path:"media/sound/background/jungle/jungle-atmo-infested.ogg",volume:0.5}],segments:[]};ig.MAP_SOUNDS.JUNGLE_CITY_INNER={loop:[{path:"media/sound/background/rain-inside.ogg",volume:1}],segments:[]};ig.MAP_SOUNDS.JUNGLE_CITY_OUTER={loop:[{path:"media/sound/background/basin-keep/basin-keep-ambient.ogg",volume:0.5}],segments:[]};ig.MAP_SOUNDS.COLD_DUNGEON={loop:[{path:"media/sound/background/dungeons/cold-ambient.ogg",volume:1}],segments:[]};
ig.MAP_SOUNDS.HEAT_DUNGEON={loop:[{path:"media/sound/background/dungeons/heat-ambient.ogg",volume:1}],segments:[]};ig.MAP_SOUNDS.HEAT_DUNGEON_WATER={loop:[{path:"media/sound/background/dungeons/heat-ambient-water.ogg",volume:1}],segments:[]};ig.MAP_SOUNDS.SHOCK_DUNGEON={loop:[{path:"media/sound/background/dungeons/shock-ambient.ogg",volume:1}],segments:[]};ig.MAP_SOUNDS.WAVE_DUNGEON={loop:[{path:"media/sound/background/dungeons/wave-ambient.ogg",volume:1}],segments:[]};ig.MAP_SOUNDS.TREE_DUNGEON=
{loop:[{path:"media/sound/background/dungeons/tree-ambient.ogg",volume:0.65}],segments:[]};ig.MAP_SOUNDS.SPOOKY_INNER={loop:[{path:"media/sound/background/dreams/dream-atmo.ogg",volume:0.5},{path:"media/sound/scenes/halloween/spooky-ambience.ogg",volume:1}],segments:[]};ig.MAP_SOUNDS.ARID_OUTSIDE={loop:[{path:"media/sound/background/arid/arid-atmo.ogg",volume:1}],segments:[]};ig.MAP_SOUNDS.ARID_INSIDE={loop:[{path:"media/sound/background/arid/arid-atmo-inside.ogg",volume:1}],segments:[]};ig.MAP_SOUNDS.SERIOUS_AMBIENT=
{loop:[{path:"media/sound/background/serious-ambient.ogg",volume:0.7}],segments:[]};ig.MAP_SOUNDS.LAB={loop:[{path:"media/sound/background/lab/lab-ambient.ogg",volume:1}],segments:[]};ig.MAP_SOUNDS.EVO_VILLAGE={loop:[{path:"media/sound/background/evo-village/evo-village-outside.ogg",volume:1}],segments:[]};ig.MAP_SOUNDS.FINAL_DUNGEON_INSIDE={loop:[{path:"media/sound/background/final-dng/final-dng-inside.ogg",volume:0.7}],segments:[]};ig.MAP_SOUNDS.FINAL_DUNGEON_OUTSIDE={loop:[{path:"media/sound/background/final-dng/final-dng-outside.ogg",
volume:0.7}],segments:[]};ig.MAP_SOUNDS.FINAL_DUNGEON_OUTSIDE_WINDY={loop:[{path:"media/sound/background/final-dng/final-dng-outside-windy.ogg",volume:0.7}],segments:[]};ig.MAP_SOUNDS.BEACH_AMBIENCE={loop:[{path:"media/sound/background/beach/beach-ambience.ogg",volume:0.7}],segments:[]};ig.MAP_SOUNDS.ARENA_TOP={loop:[{path:"media/sound/arena/crowd-ambience.ogg",volume:0.8},{path:"media/sound/background/rhombus-square/bridge-wind-ambient.ogg",volume:0.6}],segments:[]};ig.MAP_SOUNDS.RAID_BOSS_AMBIENCE=
{loop:[{path:"media/sound/background/raid-boss-ambience.ogg",volume:0.8}],segments:[]};ig.MapSoundEntry=ig.Class.extend({name:null,loopSounds:[],segments:[],loopHandles:[],currentSegment:-1,currentEntry:0,timer:0,init:function(b){this.name=b;var a=ig.MAP_SOUNDS[b];if(!a)throw Error('Map Sounds of name "'+b+'" not found.');for(var d=a.loop,b=0;b<d.length;++b)this.loopSounds.push(new ig.Sound(d[b].path,d[b].volume));a=a.segments;for(b=0;b<a.length;++b)this.segments.push(this._createSegment(a[b]))},
clearCached:function(){for(var b=this.loopSounds.length;b--;)this.loopSounds[b].clearCached();for(b=this.segments.length;b--;)for(var a=this.segments[b].entries.length;a--;)this.segments[b].entries[a].sound.clearCached()},start:function(){for(var b=this.loopSounds.length;b--;)this.loopHandles.push(this.loopSounds[b].play(true));this.currentSegment=-1;this.timer=this.currentEntry=0},update:function(){if(this.segments.length&&ig.system.tick){this.currentSegment==-1&&this._selectSegment();var b=this.segments[this.currentSegment];
this.timer=this.timer+ig.system.actualTick;for(var a=b.entries;this.currentEntry<a.length&&a[this.currentEntry].time<=this.timer;){a[this.currentEntry].sound.play();this.currentEntry++}if(this.timer>=b.maxTime){this.timer=this.timer-b.maxTime;this._selectSegment()}}},stop:function(){for(var b=this.loopHandles.length;b--;)this.loopHandles[b].stop();this.loopHandles.length=0},_createSegment:function(b){for(var a={maxTime:0,entries:[]},d=0,c=0;c<b.length;++c){var e=b[c];e.wait?d=d+e.wait:a.entries.push({time:d,
sound:new ig.Sound(e.path,e.volume)})}a.maxTime=d;return a},_selectSegment:function(){this.currentSegment=Math.floor(Math.random()*this.segments.length);this.currentEntry=0}});ig.MapSounds=ig.GameAddon.extend({mapEntry:null,currentEntry:null,init:function(){this.parent("MapSounds")},setEntry:function(b){if(b!=this.currentEntry){this.currentEntry&&this.currentEntry.stop();(this.currentEntry=b)&&this.currentEntry.start()}},onReset:function(){this.setEntry(null)},levelLoadStartOrder:100,onLevelLoadStart:function(b){if(!this.mapEntry||
!(b.attributes&&this.mapEntry.name==b.attributes["map-sounds"])){this.mapEntry&&this.mapEntry.clearCached();this.mapEntry=b.attributes&&b.attributes["map-sounds"]?new ig.MapSoundEntry(b.attributes["map-sounds"]):null}},levelLoadedOrder:100,onLevelLoaded:function(){this.setEntry(this.mapEntry)},deferredUpdateOrder:0,onDeferredUpdate:function(){ig.game.paused||this.currentEntry&&this.currentEntry.update()}});ig.addGameAddon(function(){return ig.mapSounds=new ig.MapSounds})});ig.baked=!0;
ig.module("impact.feature.map-sounds.map-sounds-steps").requires("impact.feature.map-sounds.map-sounds","impact.base.action","impact.base.event").defines(function(){ig.EVENT_STEP.SET_MAP_SOUNDS=ig.EventStepBase.extend({soundEntry:null,_wm:new ig.Config({attributes:{mapSounds:{_type:"String",_info:"Type of Map Sounds",_select:ig.MAP_SOUNDS,_withNull:true}}}),init:function(b){if(b.mapSounds)this.soundEntry=new ig.MapSoundEntry(b.mapSounds)},clearCached:function(){this.soundEntry&&this.soundEntry.clearCached()},
start:function(){ig.mapSounds.setEntry(this.soundEntry)}})});ig.baked=!0;ig.module("impact.feature.map-sounds.plug-in").requires("impact.feature.map-sounds.map-sounds","impact.feature.map-sounds.map-sounds-steps").defines(function(){window.wm&&wm.mapAttribs&&(wm.mapAttribs["map-sounds"]={_type:"String",_select:ig.MAP_SOUNDS,_info:"Map sounds to be played in the background",_withNull:true})});ig.baked=!0;
ig.module("impact.feature.nwf.nwf-errors").defines(function(){function b(b){if(!(b.errorType===0||b.errorCode===0))switch(b.errorType){case nwf.system.SystemErrorType.FS:case nwf.system.SystemErrorType.SAVE:a(b.errorCode,b.callback);break;case nwf.system.SystemErrorType.AC:case nwf.system.SystemErrorType.ACT:h&&a(evt.errorCode,function(a){a.user_select!==e.USER_OK&&console.log("[NWF] Error ignored. WARNING: SAMPLE WILL NOT WORK PROPERLY")});break;case nwf.system.SystemErrorType.VPAD:switch(b.errorCode){case f.VPAD_READ_ERR_NO_CONTROLLER:var d=
nwf.input.WiiUGamePad.getController(0);if(!d.connected){d.addEventListener(nwf.events.ControllerEvent.CONTROLLER_CONNECTED,c);a(b.errorCode)}break;default:console.log("[NWF] Unhandled VPAD: "+b.errorText)}break;case nwf.system.SystemErrorType.CMN_MSG:switch(b.errorCode){case f.CMN_MSG_INTERNET_BROWSER_PROTECTED:a(b.errorCode,b.callback,e.DISPLAY_GAMEPAD_0);break;case f.CMN_MSG_TEXT_OVER_LIMIT:a(b.errorCode,b.callback,e.DISPLAY_GAMEPAD_0);break;case f.CMN_MSG_TEXT_NO_INPUT:a(b.errorCode,b.callback,
e.DISPLAY_GAMEPAD_0);break;default:console.log("[NWF] Unhandled CMN_MSG: "+b.errorText)}break;case nwf.system.SystemErrorType.NWF:var d="UNKNOWN",g;for(g in f)f[g]==b.errorCode&&(d=g);switch(b.errorCode){default:console.log("[NWF] Unhandled NWF ("+b.errorCode+" = "+d+"):"+b.errorText)}break;case 115:switch(b.errorCode){default:console.log("[NWF] MIIVERSE: "+b.errorText);a(b.errorCode,b.callback,e.DISPLAY_GAMEPAD_0)}break;default:ig.log("[NWF] Unhandled error: ("+b.errorCode+") "+b.errorText)}}function a(a,
b,c,d){typeof b!=="function"&&(b=i);if(typeof c==="undefined")c=e.DISPLAY_ALL;typeof d==="undefined"&&(d=false);return e.displaySystemError(b,a,c,d)}function d(){ig.log("******** [NWF] CRASH IMMINENT ********")}function c(){nwf.input.WiiUGamePad.getController(0).removeEventListener(nwf.events.ControllerEvent.CONTROLLER_CONNECTED,c);e.closeDialog()}if(window.nwf){var e=nwf.ui.Dialog,f=nwf.system.SystemErrorCode,g=nwf.events.SystemErrorEvent,h=false,i=function(){},j=nwf.system.WiiUSystem.getInstance();
j.addEventListener(g.ERROR,b);j.addEventListener(g.CRASH,d)}});ig.baked=!0;ig.module("impact.feature.nwf.plug-in").requires("impact.feature.nwf.nwf-errors").defines(function(){});ig.baked=!0;
ig.module("impact.feature.video.video").requires("impact.base.loader","game.config").defines(function(){var b=[{suffix:"webm",type:"video/webm"}];ig.Video=ig.Loadable.extend({cacheType:"Video",video:null,onEndCallback:null,_fadeTimer:0,_fadeMaxTime:0,_lastTime:0,_fadeHandle:null,init:function(a){this.parent(a)},loadInternal:function(){this.video=document.createElement("video");this.video.addEventListener("canplaythrough",this.onload.bind(this));this.video.addEventListener("error",this.onerror.bind(this));
this.video.addEventListener("ended",this._onVideoEnded.bind(this));console.log("LOAD VIDEO!");this.video.className="igVideo";this.video.preload=true;for(var a=ig.root+this.path.match(/^(.*)\.[^\.]+$/)[1],d=b.length;d--;){var c=b[d],e=document.createElement("source");e.type=c.type;e.src=a+"."+c.suffix+ig.getCacheSuffix();this.video.appendChild(e)}},onload:function(){console.log("LOADED!");this.loadingFinished(true)},onerror:function(a){console.log("NOPE!",a);this.loadingFinished(false)},play:function(a){this.onEndCallback=
a;this.video.currentTime=0;this.video.volume=1;this.video.play()},pause:function(){this.video.pause()},reset:function(){this.video.currentTime=0},fadeOutAudio:function(a){this._fadeTimer=this._fadeMaxTime=a;this._lastTime=Date.now();this._fadeHandle=window.setInterval(this._fadeAudioCallback.bind(this),10)},_fadeAudioCallback:function(){var a=Date.now(),b=(a-this._lastTime)/1E3;this._lastTime=a;this._fadeTimer=this._fadeTimer-b;if(this._fadeTimer<0)this._fadeTimer=0;this.video.volume=this._fadeTimer/
this._fadeMaxTime;this._fadeTimer==0&&window.clearInterval(this._fadeHandle)},draw:function(a,b,c,e){if(!this.video.paused){var f=ig.system.scale,a=ig.system.getDrawPos(a),b=ig.system.getDrawPos(b);ig.system.context.drawImage(this.video,a,b,c*f,e*f)}},_onVideoEnded:function(){this.onEndCallback&&this.onEndCallback()}})});ig.baked=!0;
ig.module("impact.feature.video.video-gui").requires("impact.feature.video.video","impact.feature.gui.gui").defines(function(){ig.VideoGui=ig.GuiElementBase.extend({video:null,playing:false,init:function(b,a,d){this.parent();this.video=b;this.hook.size.x=a||ig.system.width;this.hook.size.y=d||ig.system.height},play:function(b){this.playing=1;this.video.play(b)},pause:function(){this.playing=0;this.video.pause()},reset:function(){this.video.currentTime=0},updateDrawables:function(b){this.playing&&
this.playing<=4?this.playing++:this.playing==5&&b.addVideo(this.video,0,0,this.hook.size.x,this.hook.size.y)}});ig.VideoPlayerGui=ig.GuiElementBase.extend({videoGui:null,transitions:{DEFAULT:{state:{},time:1,timeFunction:KEY_SPLINES.LINEAR},HIDDEN:{state:{alpha:0},time:1,timeFunction:KEY_SPLINES.LINEAR}},onEndCallback:null,screenInteract:null,init:function(b,a,d){this.parent(b);this.videoGui=new ig.VideoGui(b,a,d);this.videoGui.hook.transitions.DEFAULT={state:{},time:0,timeFunction:KEY_SPLINES.LINEAR};
this.videoGui.hook.transitions.HIDDEN={state:{alpha:0},time:1,timeFunction:KEY_SPLINES.LINEAR};this.addChildGui(this.videoGui);this.doStateTransition("HIDDEN",true);this.screenInteract=new sc.ScreenInteractEntry(this,true);Vec2.assign(this.hook.size,this.videoGui.hook.size)},start:function(b){this.onEndCallback=b;this.doStateTransition("DEFAULT",false,false,this._startVideo.bind(this))},_startVideo:function(){this.videoGui.doStateTransition("DEFAULT");this.videoGui.play(this._stopVideo.bind(this));
ig.interact.addEntry(this.screenInteract)},_stopVideo:function(){this.videoGui.doStateTransition("HIDDEN",false,false,this._onEnd.bind(this));this.videoGui.video.fadeOutAudio(1);ig.interact.removeEntry(this.screenInteract)},onInteraction:function(){this._stopVideo()},_onEnd:function(){this.doStateTransition("HIDDEN");this.videoGui.reset();this.videoGui.pause();this.onEndCallback&&this.onEndCallback();this.onEndCallback=null},updateDrawables:function(b){b.addColor("black",0,0,this.hook.size.x,this.hook.size.y)}})});
ig.baked=!0;ig.module("impact.feature.video.plug-in").requires("impact.feature.video.video","impact.feature.video.video-gui").defines(function(){});ig.baked=!0;
ig.module("impact.feature.influencer.influencer").defines(function(){ig.InfluencerCallbacks={callbacks:[],addCallback:function(a){this.callbacks.push(a)},init:function(a){for(var b=0;b<this.callbacks.length;++b)a.callbacks[b]=new this.callbacks[b](a,a.entity)}};ig.Influencer=ig.Class.extend({entity:null,entries:[],callbacks:[],init:function(a){this.entity=a;ig.InfluencerCallbacks.init(this)},hasPush:function(){for(var a=this.entries.length;a--;)if(this.entries[a].push)return true},addInfluence:function(a){this.entries.indexOf(a)==
-1&&this.entries.push(a)},removeInfluence:function(a){this.entries.erase(a);if(a.updateInfluencer==this)a.updateInfluencer=null},removeActionInfluences:function(){for(var a=this.entries.length;a--;)this.entries[a].actionInfluence&&this.removeInfluence(this.entries[a])},updateCallbacks:function(){for(var a=0;a<this.callbacks.length;++a)this.callbacks[a].onUpdate(this,this.entity)},onUpdate:function(){this.updateCallbacks();this.updateInfluencerState(false)},updateInfluencerState:function(a){for(var e=
this.entity.coll,f=1,g=1,h=1,i=1,j=this.entries.length,k=0,l=d;j--;){var o=this.entries[j];if(!o.updateInfluencer)o.updateInfluencer=this;var m=1;if(o.state==b.REMOVED)this.entries.splice(j,1);else{if(o.updateInfluencer==this){if(!o.fadeTimer.done()){o.state=b.FADE_OUT;if(!a){o.fadeTimer.tick();if(o.fadeTimer.done()){this.entries.splice(j,1);o.state=b.REMOVED;continue}}m=o.getFactor()}}else o.state==b.FADE_OUT&&(m=o.getFactor());f=f*(1-m+m*o.timeScale);g=Math.max(g,1-m+m*o.slowmoScale);h=h*(1-m+m*
o.logicTimeScale);i=i*(1-m+m*o.moveXYScale);if(o.push)if(o=o.getPush(e,m)){k=Math.max(k,Vec2.length(o));Vec2.add(l,o)}}}e.time.factor=f*g;e.time.logicFactor=h;e.time.moveXYFactor=i;if(k){Vec2.length(l)>k&&Vec2.length(l,k);Vec2.add(e.pushVel,l)}},onPostSpriteUpdate:function(){for(var a=0,d=this.entries.length;d--;){var f=this.entries[d];f.state=b.NORMAL;var g=f.getFactor(),a=a+f.groundSinkZ*g}if(a=Math.round(a)){f=this.entity.sprites;for(d=f.length;d--;)f[d].pos.z=f[d].pos.z-a}}});var b={NORMAL:0,
FADE_OUT:1,REMOVED:2};sc.INFLUENCE_PUSH={PULL:function(a,b,d,g,h,i,j){b.getCenter(a);Vec2.sub(a,d);Vec2.flip(a);b=Vec2.length(a);d=1;g&&(b>g+h?d=0:b>=g&&(d=1-(b-g)/h));b<2&&(d=0);Vec2.length(a,d*j*i)},PUSH:function(a,b,d,g,h,i,j){b.getCenter(a);Vec2.sub(a,d);b=Vec2.length(a);d=1;g&&(b>g+h?d=0:b>=g&&(d=1-(b-g)/h));b<2&&(d=0);Vec2.length(a,d*j*i)},DIR:function(a,b,d,g,h,i,j){Vec2.sub(a,d);Vec2.length(i*j)}};var a=Vec2.create(),d=Vec2.create();ig.InfluenceEntry=ig.Class.extend({fadeTimer:null,timeScale:1,
slowmoScale:1,logicTimeScale:1,moveXYScale:1,groundSinkZ:0,updateInfluencer:null,state:b.NORMAL,push:null,init:function(){this.fadeTimer=new ig.WeightTimer(false)},setPushType:function(a,b,d,g){this.push={type:a,range:b,fadeRange:d,speed:g,vec:Vec2.create()}},setPushEntityCenter:function(a){this.push&&a.getCenter(this.push.vec)},setPushCenter:function(a){Vec2.assign(this.push.vec,a)},getPush:function(b,d){if(!this.push)return null;this.push.type(a,b,this.push.vec,this.push.range,this.push.fadeRange,
this.push.speed,d);return a},setFadeOut:function(a){this.fadeTimer.set(a,ig.TIMER_MODE.ONCE)},getFactor:function(){return this.fadeTimer.done()?1:1-this.fadeTimer.get()}});ig.InfluenceConnection=ig.Class.extend({init:function(a,b){this.influencer=a;this.influenceEntry=b;b.actionInfluence=true;this.influencer.addInfluence(this.influenceEntry)},updateImmediately:function(){this.influencer.updateInfluencerState(true)},clear:function(){this.influencer.removeInfluence(this.influenceEntry)},onActionEndDetach:function(){this.clear()}})});
ig.baked=!0;
ig.module("impact.feature.influencer.influencer-steps").requires("impact.base.action","impact.base.event","impact.base.entity","impact.feature.influencer.influencer").defines(function(){function b(a){return a instanceof ig.InfluenceConnection}var a={SELF:function(a){return a},TARGET:function(a){return a.getTarget()},OWNER:function(a){return a.getCombatantRoot()}};ig.ACTION_STEP.ADD_TEMP_INFLUENCE=ig.ActionStepBase.extend({_wm:new ig.Config({attributes:{target:{_type:"String",_info:"On what target to apply influence",_select:a},
timeScale:{_type:"Number",_info:"Scale general time of target",_default:1},logicTimeScale:{_type:"Number",_info:"Scale logic time of target (won't slow down physics)",_default:1},moveXYScale:{_type:"Number",_info:"Scale XY movement speed of target",_default:1}}}),init:function(b){this.target=a[b.target]||a.SELF;this.influenceEntry=new ig.InfluenceEntry;this.influenceEntry.timeScale=b.timeScale===void 0?1:b.timeScale;this.influenceEntry.logicTimeScale=b.logicTimeScale===void 0?1:b.logicTimeScale;this.influenceEntry.moveXYScale=
b.moveXYScale||0},start:function(a){var b=this.target(a);if(b&&b.influencer){b=new ig.InfluenceConnection(b.influencer,this.influenceEntry);a.addActionAttached(b)}}});ig.ACTION_STEP.CLEAR_TEMP_INFLUENCE=ig.ActionStepBase.extend({_wm:new ig.Config({attributes:{}}),init:function(){},start:function(a){a.clearActionAttached(b)}})});ig.baked=!0;ig.module("impact.feature.influencer.plug-in").requires("impact.feature.influencer.influencer","impact.feature.influencer.influencer-steps").defines(function(){});
ig.baked=!0;
ig.module("impact.feature.greenworks.greenworks").requires("impact.base.game","impact.base.vars").defines(function(){ig.Greenworks=ig.GameAddon.extend({greenworks:null,steps:[],init:function(){this.parent("Greenworks");if(ig.platform==ig.PLATFORM_TYPES.DESKTOP)try{if(ig.nwjsVersion[1]<1400){if(this.hasSteamStartArgument()){this.greenworks=require("./modules/greenworks-0.4.0/greenworks");this.steps.push("loaded");this.greenworks.initAPI()&&ig.log("%cGREENWORKS:%c Successfully initialized! [v0.4.0]","color:#339966",
"")}}else if(ig.nwjsVersion[1]<3E3){this.greenworks=require("./modules/greenworks-0.5.3/greenworks");this.steps.push("loaded");this.greenworks.init()&&ig.log("%cGREENWORKS:%c Successfully initialized!  [v0.5.3]","color:#339966","")}else if(ig.nwjsVersion[1]<3500){this.greenworks=require("./modules/greenworks-0.13.0/greenworks");this.steps.push("loaded");this.greenworks.init()&&ig.log("%cGREENWORKS:%c Successfully initialized!  [v0.13.0]","color:#339966","")}else{this.greenworks=require("./modules/greenworks-nw-0.35/greenworks");
this.steps.push("loaded");this.greenworks.init()&&ig.log("%cGREENWORKS:%c Successfully initialized!  [Compiled for NW.js 0.35.x]","color:#339966","")}}catch(b){ig.warn("Error Initializing Greenworks");this.steps.push("error");this.errorMsg=b.toString();this.greenworks=null}this.greenworks&&this.steps.push("initialized")},isActive:function(){return!!this.greenworks},hasSteamStartArgument:function(){for(var b=require("nw.gui").App.argv,a=0;a<b.length;a++)if(b[a]=="--startedFromSteam")return true;return false},
activateAchievement:function(b,a){this.greenworks&&this.greenworks.activateAchievement(b,function(){ig.greenworks.steps.push("activated");a&&ig.greenworks.clearAchievement(b)})},clearAchievement:function(b){this.greenworks&&this.greenworks.clearAchievement&&this.greenworks.clearAchievement(b,function(){ig.greenworks.steps.push("cleared")})}});ig.addGameAddon(function(){return ig.greenworks=new ig.Greenworks})});ig.baked=!0;ig.module("impact.feature.greenworks.plug-in").requires("impact.feature.greenworks.greenworks").defines(function(){});
ig.baked=!0;
ig.module("game.feature.version.version").requires("impact.base.game","impact.feature.storage.storage").defines(function(){sc.VerionChangeLog=ig.SingleLoadable.extend({major:1,minor:4,patch:2,hotfix:2,special:null,saveVersion:2,oldMajor:0,oldMinor:0,oldPatch:0,changelog:null,init:function(){if(ig.CHANGE_LOG){this.parent();var b=JSON.parse(localStorage.getItem("cc.version"));if(b){this.oldMajor=b.major||0;this.oldMinor=b.minor||0;this.oldPatch=b.patch||0}if(ig.platform!=ig.PLATFORM_TYPES.BROWSER)document.title=document.title+
" "+this.toString()}else ig.warn("Can't load changelog because no ig.CHANGE_LOG is given!")},saveCurrentVersion:function(){localStorage.setItem("cc.version",JSON.stringify(this._toObject()))},getLogsBetweenVersions:function(b){b=b?b:[];b.length=0;for(var a=this._getVersionString(this.oldMajor,this.oldMinor,this.oldPatch),d=0;d<this.changelog.length;d++)if(this.changelog[d].version==a)break;else b.push(this.changelog[d]);return b},toString:function(){var b=this.toOnlyNumberString();this.special&&(b=
b+(" "+this.special));return b},toOnlyNumberString:function(){return"v"+this.major+"."+this.minor+"."+this.patch+(this.hotfix>0?"-"+this.hotfix:"")},hasVersionChanged:function(){return this.major!=this.oldMajor||this.minor!=this.oldMinor||this.patch!=this.oldPatch},loadInternal:function(){$.ajax({dataType:"json",url:ig.root+ig.CHANGE_LOG+ig.getCacheSuffix(),context:this,success:this.onload.bind(this),error:this.onerror.bind(this)})},onerror:function(b){this.changelog=null;this.loadingFinished(true);
ig.error("Could not load Changelog json file! Event: %O",b)},onload:function(b){this.changelog=b.changelog;window.wm&&ig.database.register("changelog","ChangelogList","Changelog",{path:"data/changelog.json",data:this.changelog});var a=this._getVersionString(this.major,this.minor,this.patch);if(a!=this.changelog[0].version)throw Error("Version collision! Inlined: "+a+", Json: "+this.changelog[0].version+", missing entry?");this.loadingFinished(true);ig.JSON_LOG&&ig.log("%cLOADABLE: %cLoaded Changelog: \n%O",
"color:#149AEB","",b)},getLastSlotDataUpdated:function(){var b={version:this.toOnlyNumberString(),saveVersion:this.saveVersion};return ig.storage.getLastSlotData(b)},updateSaveSlotVersion:function(b){b.mergeData({version:this.toOnlyNumberString(),saveVersion:this.saveVersion})},_getVersionString:function(b,a,d){return b+"."+a+"."+d},_toObject:function(){var b={};b.major=this.major;b.minor=this.minor;b.patch=this.patch;return b}});sc.version=new sc.VerionChangeLog;sc.VersionTracker=ig.GameAddon.extend({loadedVersion:null,
loadedSaveVersion:null,init:function(){ig.storage.register(this);this.onReset()},onReset:function(){this.loadedVersion=sc.version.toOnlyNumberString();this.loadedSaveVersion=sc.version.saveVersion},onStorageSave:function(b){b.version=this.loadedVersion;b.saveVersion=this.loadedSaveVersion},onStoragePreLoad:function(b){this.loadedVersion=b.version;this.loadedSaveVersion=b.saveVersion||0;this.loadedSaveVersion<sc.version.saveVersion&&ig.game.addTeleportMessage(ig.lang.get("sc.gui.loading.versionOutdated"))}});
ig.addGameAddon(function(){return new sc.VersionTracker})});ig.baked=!0;
ig.module("game.feature.control.control").requires("impact.base.game","impact.feature.interact.press-repeater","impact.feature.gui.gui").defines(function(){function b(){var a=ig.game.playerEntity;if(!a||!sc.options.get("close-combat-input"))return 9999;a=a.coll;ig.system.getScreenFromMapPos(d,a.pos.x+a.size.x/2,a.pos.y+a.size.y/2-a.pos.z-Constants.BALL_HEIGHT-Constants.BALL_SIZE/2);return Vec2.distance(d,ig.input.mouse)/ig.system.zoom}var a=Vec2.create();ig.canLeavePauseMenu=true;sc.GlobalInput=ig.GameAddon.extend({init:function(){this.parent("GlobalInput");
ig.gui.setControlModule(sc.control)},preUpdateOrder:5,onPreUpdate:function(){var a=!ig.game.paused&&sc.model.isRunning()&&sc.model.isGame()&&ig.game.playerEntity&&!ig.game.playerEntity.isControlBlocked();if(ig.input.currentDevice==ig.INPUT_DEVICES.GAMEPAD)ig.system.setCursorType("none");else if(ig.input.mouseOutOfScreen())ig.system.clearCursorType();else if(a){var a=sc.model.player.getCore(sc.PLAYER_CORE.CLOSE_COMBAT),d=sc.model.player.getCore(sc.PLAYER_CORE.THROWING);!a&&!d?ig.system.setCursorType("pointer"):
d?a?b()<sc.ATTACK_INPUT_DISTANCE?ig.system.setCursorType("melee"):ig.system.setCursorType("throw"):ig.system.setCursorType("throw"):ig.system.setCursorType("melee")}else ig.system.setCursorType("pointer");sc.control.updateRepeater()},postUpdateOrder:8999,onPostUpdate:function(){if(!ig.loading){if((sc.control.pause()||sc.model.isPaused()&&sc.control.menuBack())&&ig.canLeavePauseMenu&&!sc.arena.isPauseBlocked())if(sc.model.isPaused()){sc.model.enterRunning();sc.BUTTON_SOUND.back.play()}else sc.model.enterPause()&&
sc.BUTTON_SOUND.submit.play();(sc.model.isCutscene()&&sc.model.isRunning()||sc.model.message.isMenuMode())&&!ig.system.skipMode&&ig.canLeavePauseMenu&&!sc.model.hasActiveChoice()&&!sc.arena.isPauseBlocked()&&!sc.model.skipBlock&&sc.control.skipCutscene()&&sc.model.skipCutscene();!sc.model.isCutscene()&&sc.control.skipCutscene()&&sc.skipInteract.triggerSkip();if(sc.control.menu()&&sc.model.player.getCore(sc.PLAYER_CORE.MENU))if(sc.model.isMenu()){if(sc.menu.isButtonInteractActive()){sc.model.enterRunning();
sc.BUTTON_SOUND.back.play()}}else sc.model.isRunning()&&(sc.model.isCombatCooldown()?sc.model.cancelCombatCooldown():sc.model.isCombatMode()?sc.BUTTON_SOUND.denied.play():sc.model.enterMenu()&&sc.BUTTON_SOUND.submit.play());sc.model.player.getCore(sc.PLAYER_CORE.QUEST_SWITCH)&&(sc.model.isRunning()&&sc.model.isGame())&&(sc.control.questCircleLeft()?sc.quests.cycleFavQuest(-1):sc.control.questCircleRight()&&sc.quests.cycleFavQuest(1));if(!ig.game.isControlBlocked()&&sc.model.isGame()&&(sc.model.isRunning()||
sc.model.isQuickMenuElementSwapEnabled())&&ig.game.playerEntity&&!ig.game.playerEntity.isElementChangeBlocked()&&!sc.model.player.hasOverload&&!sc.control.charge()){var a=sc.control.elementModeSwitch();if(a!==false){if(!a||a==sc.model.player.currentElementMode)a=sc.ELEMENT.NEUTRAL;a!=sc.model.player.currentElementMode&&sc.model.player.setElementMode(a)}(a=sc.control.elementModeScroll())&&sc.model.player.scrollElementMode(a)}if(sc.model.player.getCore(sc.PLAYER_CORE.QUICK_MENU)){a=sc.options.get("quick-menu-access");
if(a==sc.QUICK_MENU_ACCESS.HOLD)if(sc.control.quickmenu()){if(!sc.quickmodel.activeState&&sc.model.enterQuickMenu()){sc.quickmodel.activeState=true;sc.BUTTON_SOUND.quickAppear.play()}}else{if(sc.quickmodel.activeState){sc.quickmodel.activeState=false;if(sc.quickmodel.visible){sc.model.enterRunning();sc.BUTTON_SOUND.quickHide.play()}}}else if(a==sc.QUICK_MENU_ACCESS.PRESS&&sc.control.quickmenuPress())if(sc.model.isQuickMenu()){sc.model.enterRunning();sc.BUTTON_SOUND.quickHide.play()}else sc.model.enterQuickMenu()&&
sc.BUTTON_SOUND.quickAppear.play()}if(ig.platform==ig.PLATFORM_TYPES.DESKTOP&&ig.input.pressed("fullscreen")){sc.options.set("fullscreen",!sc.options.get("fullscreen"));sc.options.persistOptions()}if(ig.input.pressed("snapshot")){a=ig.system.canvas.toDataURL("image/png");if(ig.platform==ig.PLATFORM_TYPES.DESKTOP)if(ig.nwjsVersion&&ig.nwjsVersion[1]>=3E3){require("nw.gui").Window.open(a,{min_width:1136,min_height:640});nw.Clipboard.get().set(a,"png",false)}else window.open(a);else window.SHOW_SCREENSHOT(a)}}}});
sc.ATTACK_INPUT_DISTANCE=48;sc.Control=ig.Class.extend({repeater:new ig.PressRepeater,repeaterPressed:false,autoControl:null,_getAttackButton:function(){return sc.options.get("gamepad-attack")?ig.BUTTONS.RIGHT_TRIGGER:ig.BUTTONS.RIGHT_SHOULDER},_getSpecialButton:function(){return sc.options.get("gamepad-attack")?ig.BUTTONS.RIGHT_SHOULDER:ig.BUTTONS.RIGHT_TRIGGER},_getDashButton:function(){return sc.options.get("gamepad-dash")?ig.BUTTONS.LEFT_TRIGGER:ig.BUTTONS.LEFT_SHOULDER},_getQuickMenuButton:function(){return sc.options.get("gamepad-dash")?
ig.BUTTONS.LEFT_SHOULDER:ig.BUTTONS.LEFT_TRIGGER},_getMeleeButton:function(){return ig.BUTTONS.FACE2},setAutoControl:function(a){this.autoControl=a},getMouseX:function(){return this.autoControl?this.autoControl.get("mouseX"):ig.input.mouse.x},getMouseY:function(){return this.autoControl?this.autoControl.get("mouseY"):ig.input.mouse.y},getGuiClickPre:function(){return this.autoControl?true:ig.input.pressed("aim")},getGuiClick:function(){return this.autoControl?ig.input.currentDevice==ig.INPUT_DEVICES.KEYBOARD_AND_MOUSE&&
this.autoControl.get("menuConfirm"):ig.input.keyupd("aim")},getGuiPressed:function(){return this.autoControl?false:ig.input.pressed("aim")},getGuiHold:function(){return this.autoControl?false:ig.input.state("aim")},getAxesValue:function(a){if(this.autoControl){if(a==ig.AXES.LEFT_STICK_X)return this.autoControl.get("axisLeftX");if(a==ig.AXES.LEFT_STICK_Y)return this.autoControl.get("axisLeftY");if(a==ig.AXES.RIGHT_STICK_X)return this.autoControl.get("axisRightX");if(a==ig.AXES.RIGHT_STICK_Y)return this.autoControl.get("axisRightY");
throw Error("Unknown Axis: "+a);}return ig.gamepad.getAxesValue(a)},isLeftStickDown:function(){return this.autoControl?this.autoControl.get("leftStickDown"):ig.gamepad.isLeftStickDown()},isRightStickDown:function(){return this.autoControl?this.autoControl.get("rightStickDown"):ig.gamepad.isRightStickDown()},updateRepeater:function(){ig.gamepad.isButtonDown(ig.BUTTONS.LEFT_SHOULDER)?this.repeater.setDown("scrollUp"):ig.gamepad.isButtonDown(ig.BUTTONS.RIGHT_SHOULDER)&&this.repeater.setDown("scrollDown");
this.repeaterPressed=this.repeater.getPressed()},aimStart:function(){return this.autoControl?this.autoControl.get("aimStart"):ig.input.pressed("aim")||ig.gamepad.isRightStickDown()},aiming:function(){return this.autoControl?this.autoControl.get("aiming"):ig.input.state("aim")||ig.gamepad.isRightStickDown()},attacking:function(){return this.autoControl?this.autoControl.get("attacking"):ig.input.pressed("aim")&&b()<sc.ATTACK_INPUT_DISTANCE||!ig.gamepad.isRightStickDown()&&ig.gamepad.isButtonPressed(this._getAttackButton())},
fullScreenAttacking:function(){return this.autoControl?this.autoControl.get("attacking"):ig.input.pressed("aim")||ig.gamepad.isButtonPressed(this._getAttackButton())},chargeThrowSwap:function(){return this.autoControl?false:ig.input.state("aim")&&b()>=sc.ATTACK_INPUT_DISTANCE||ig.gamepad.isRightStickDown()},chargeAttackSwap:function(){return this.autoControl?false:ig.input.pressed("aim")&&b()<sc.ATTACK_INPUT_DISTANCE||ig.input.currentDevice==ig.INPUT_DEVICES.GAMEPAD&&!ig.gamepad.isRightStickDown()},
thrown:function(){return this.autoControl?this.autoControl.get("thrown"):ig.input.keyupd("aim")||ig.gamepad.isRightStickDown()&&ig.gamepad.isButtonPressed(this._getAttackButton())},melee:function(){return this.autoControl?this.autoControl.get("melee"):ig.input.pressed("melee")||ig.gamepad.isButtonPressed(this._getMeleeButton())},charge:function(){return this.autoControl?this.autoControl.get("charge"):ig.input.state("special")||ig.gamepad.isButtonDown(this._getSpecialButton())},autoThrown:function(){return this.autoControl?
false:ig.gamepad.isRightStickDown()&&ig.gamepad.isButtonDown(this._getAttackButton())},dashing:function(){return this.autoControl?this.autoControl.get("dashing"):ig.input.pressed("dash")||ig.input.pressed("dash2")||ig.gamepad.isButtonPressed(this._getDashButton())},dashHold:function(){return this.autoControl?this.autoControl.get("dashHold"):ig.input.state("dash")||ig.input.state("dash2")||ig.gamepad.isButtonDown(this._getDashButton())},guarding:function(){return this.autoControl?this.autoControl.get("guarding"):
(ig.input.state("dash")||ig.input.state("guard")||ig.gamepad.isButtonDown(ig.BUTTONS.FACE1)||ig.gamepad.isButtonDown(this._getDashButton()))&&!ig.interact.isBlocked()},moveDir:function(b,d,f){if(this.autoControl){b.x=this.autoControl.get("moveDirX");b.y=this.autoControl.get("moveDirY");return 1}if(ig.gamepad.isLeftStickDown()){b.x=ig.gamepad.getAxesValue(ig.AXES.LEFT_STICK_X,true);b.y=ig.gamepad.getAxesValue(ig.AXES.LEFT_STICK_Y,true);if(!f)if(Vec2.dot(b,a)>=0){var f=Vec2.length(b),g=f>0.8?1:f*f/
0.64;d>g&&(g=d*0.8+0.2*g)}else{Vec2.assignC(b,0,0);g=0}Vec2.assign(a,b);return g}b.x=b.y=0;if(ig.input.state("left"))b.x=-1;else if(ig.input.state("right"))b.x=1;if(ig.input.state("up"))b.y=-1;else if(ig.input.state("down"))b.y=1;return b.x||b.y?1:0},pause:function(){return this.autoControl?this.autoControl.get("pause"):ig.input.pressed("pause")||ig.gamepad.isButtonPressed(ig.BUTTONS.START)},menu:function(){return this.autoControl?this.autoControl.get("menu"):ig.input.pressed("menu")||ig.gamepad.isButtonPressed(ig.BUTTONS.SELECT)},
quickmenu:function(){return this.autoControl?this.autoControl.get("quickmenu"):ig.input.state("quick")||ig.gamepad.isButtonDown(this._getQuickMenuButton())},quickmenuPress:function(){return this.autoControl?this.autoControl.get("quickmenu"):ig.input.pressed("quick")||ig.gamepad.isButtonPressed(this._getQuickMenuButton())},skipCutscene:function(){return this.autoControl?this.autoControl.get("skipCutscene"):ig.input.pressed("skip-cutscene")||ig.gamepad.isButtonPressed(ig.BUTTONS.FACE3)},menuConfirm:function(){return this.autoControl?
ig.input.currentDevice==ig.INPUT_DEVICES.GAMEPAD&&this.autoControl.get("menuConfirm"):(ig.input.pressed("confirm")||ig.input.pressed("special")||ig.gamepad.isButtonPressed(ig.BUTTONS.FACE0))&&!ig.interact.isBlocked()},menuBack:function(){return this.autoControl?this.autoControl.get("menuBack"):ig.input.pressed("pause")||ig.input.pressed("back")||ig.input.pressed("dash")||ig.gamepad.isButtonPressed(ig.BUTTONS.FACE1)},menuHotkeyHelp:function(){return this.autoControl?this.autoControl.get("menuHotkeyHelp"):
ig.input.pressed("help")||ig.gamepad.isButtonPressed(ig.BUTTONS.START)},menuHotkeyHelp2:function(){return this.autoControl?this.autoControl.get("menuHotkeyHelp2"):ig.input.pressed("help2")||ig.gamepad.isButtonPressed(ig.BUTTONS.FACE2)},menuHotkeyHelp3:function(){return this.autoControl?this.autoControl.get("menuHotkeyHelp3"):ig.input.pressed("help3")||ig.gamepad.isButtonPressed(ig.BUTTONS.FACE3)},menuHotkeyHelp4:function(){return this.autoControl?this.autoControl.get("menuHotkeyHelp4"):ig.input.pressed("help4")||
ig.gamepad.isButtonPressed(ig.BUTTONS.RIGHT_STICK)},menuSkillLeft:function(a){if(this.autoControl)return this.autoControl.get("menuSkillLeft");a=a!=void 0?a:0.8;return ig.input.state("left")||ig.gamepad.getAxesValue(ig.AXES.RIGHT_STICK_X)<-a},menuSkillRight:function(a){if(this.autoControl)return this.autoControl.get("menuSkillRight");a=a!=void 0?a:0.8;return ig.input.state("right")||ig.gamepad.getAxesValue(ig.AXES.RIGHT_STICK_X)>a},menuSkillUp:function(a){if(this.autoControl)return this.autoControl.get("menuSkillUp");
a=a!=void 0?a:0.8;return ig.input.state("up")||ig.gamepad.getAxesValue(ig.AXES.RIGHT_STICK_Y)<-a},menuSkillDown:function(a){if(this.autoControl)return this.autoControl.get("menuSkillDown");a=a!=void 0?a:0.8;return ig.input.state("down")||ig.gamepad.getAxesValue(ig.AXES.RIGHT_STICK_Y)>a},menuCircleLeft:function(){return this.autoControl?this.autoControl.get("menuCircleLeft"):ig.input.pressed("circle-left")||ig.gamepad.isButtonPressed(ig.BUTTONS.LEFT_SHOULDER)},menuCircleRight:function(){return this.autoControl?
this.autoControl.get("menuCircleRight"):ig.input.pressed("circle-right")||ig.gamepad.isButtonPressed(ig.BUTTONS.RIGHT_SHOULDER)},menuListUp:function(){return this.autoControl?this.autoControl.get("menuListUp"):ig.input.pressed("left")||ig.gamepad.isButtonPressed(ig.BUTTONS.LEFT_TRIGGER)},menuListDown:function(){return this.autoControl?this.autoControl.get("menuListDown"):ig.input.pressed("right")||ig.gamepad.isButtonPressed(ig.BUTTONS.RIGHT_TRIGGER)},questCircleLeft:function(){return this.autoControl?
this.autoControl.get("questCircleLeft"):ig.input.pressed("circle-left")||ig.gamepad.isButtonPressed(ig.BUTTONS.LEFT_STICK)},questCircleRight:function(){return this.autoControl?this.autoControl.get("questCircleRight"):ig.input.pressed("circle-right")||ig.gamepad.isButtonPressed(ig.BUTTONS.RIGHT_STICK)},menuMapLeftDown:function(a){a=a!=void 0?a:0.8;return ig.input.state("left")||ig.gamepad.getAxesValue(ig.AXES.LEFT_STICK_X)<-a||ig.gamepad.getAxesValue(ig.AXES.RIGHT_STICK_X)<-a},menuMapRightDown:function(a){a=
a!=void 0?a:0.8;return ig.input.state("right")||ig.gamepad.getAxesValue(ig.AXES.LEFT_STICK_X)>a||ig.gamepad.getAxesValue(ig.AXES.RIGHT_STICK_X)>a},menuMapUpDown:function(a){a=a!=void 0?a:0.8;return ig.input.state("up")||ig.gamepad.getAxesValue(ig.AXES.LEFT_STICK_Y)<-a||ig.gamepad.getAxesValue(ig.AXES.RIGHT_STICK_Y)<-a},menuMapDownDown:function(a){a=a!=void 0?a:0.8;return ig.input.state("down")||ig.gamepad.getAxesValue(ig.AXES.LEFT_STICK_Y)>a||ig.gamepad.getAxesValue(ig.AXES.RIGHT_STICK_Y)>a},menuScrollUp:function(){return this.autoControl?
this.autoControl.get("menuScrollUp"):ig.input.pressed("scrollUp")},menuScrollDown:function(){return this.autoControl?this.autoControl.get("menuScrollDown"):ig.input.pressed("scrollDown")},arenaScrollUp:function(){return this.autoControl?this.autoControl.get("arenaScrollUp"):ig.gamepad.getAxesValue(ig.AXES.RIGHT_STICK_Y)<-0.8},arenaScrollDown:function(){return this.autoControl?this.autoControl.get("arenaScrollDown"):ig.gamepad.getAxesValue(ig.AXES.RIGHT_STICK_Y)>0.8},scrollUp:function(){return this.autoControl?
this.autoControl.get("scrollUp"):ig.input.pressed("scrollUp")||this.repeaterPressed=="scrollUp"},scrollDown:function(){return this.autoControl?this.autoControl.get("scrollDown"):ig.input.pressed("scrollDown")||this.repeaterPressed=="scrollDown"},interactPressed:function(a,b){return!b&&this.autoControl?this.autoControl.get("interactPressed"):ig.input.pressed("aim")||ig.gamepad.isButtonPressed(ig.BUTTONS.FACE0)||ig.input.pressed("confirm")||(a?this.menuBack():false)},interactDown:function(){return this.autoControl?
this.autoControl.get("interactDown"):ig.input.state("aim")||ig.gamepad.isButtonDown(ig.BUTTONS.FACE0)},leftPressed:function(){return this.autoControl?this.autoControl.get("leftPressed"):ig.input.pressed("left")||ig.gamepad.isButtonPressed(ig.BUTTONS.DPAD_LEFT)},rightPressed:function(){return this.autoControl?this.autoControl.get("rightPressed"):ig.input.pressed("right")||ig.gamepad.isButtonPressed(ig.BUTTONS.DPAD_RIGHT)},upPressed:function(){return this.autoControl?this.autoControl.get("upPressed"):
ig.input.pressed("up")||ig.gamepad.isButtonPressed(ig.BUTTONS.DPAD_UP)},downPressed:function(){return this.autoControl?this.autoControl.get("downPressed"):ig.input.pressed("down")||ig.gamepad.isButtonPressed(ig.BUTTONS.DPAD_DOWN)},leftPressedSticks:function(){return this.autoControl?this.autoControl.get("leftPressedSticks"):ig.input.pressed("left")||ig.gamepad.isButtonPressed(ig.BUTTONS.DPAD_LEFT)||ig.gamepad.getAxesValue(ig.AXES.LEFT_STICK_X)<-0.8||ig.gamepad.getAxesValue(ig.AXES.RIGHT_STICK_X)<
-0.8},rightPressedSticks:function(){return this.autoControl?this.autoControl.get("rightPressedSticks"):ig.input.pressed("right")||!sc.model.isQuickMenuElementSwapEnabled()&&ig.gamepad.isButtonPressed(ig.BUTTONS.DPAD_RIGHT)||ig.gamepad.getAxesValue(ig.AXES.LEFT_STICK_X)>0.8||ig.gamepad.getAxesValue(ig.AXES.RIGHT_STICK_X)>0.8},upPressedSticks:function(){return this.autoControl?this.autoControl.get("upPressedSticks"):ig.input.pressed("up")||!sc.model.isQuickMenuElementSwapEnabled()&&ig.gamepad.isButtonDown(ig.BUTTONS.DPAD_UP)||
ig.gamepad.getAxesValue(ig.AXES.LEFT_STICK_Y)<-0.8||ig.gamepad.getAxesValue(ig.AXES.RIGHT_STICK_Y)<-0.8},downPressedSticks:function(){return this.autoControl?this.autoControl.get("downPressedSticks"):ig.input.pressed("down")||!sc.model.isQuickMenuElementSwapEnabled()&&ig.gamepad.isButtonDown(ig.BUTTONS.DPAD_DOWN)||ig.gamepad.getAxesValue(ig.AXES.LEFT_STICK_Y)>0.8||ig.gamepad.getAxesValue(ig.AXES.RIGHT_STICK_Y)>0.8},leftDown:function(){return this.autoControl?this.autoControl.get("menuLeft"):ig.input.state("left")||
!sc.model.isQuickMenuElementSwapEnabled()&&ig.gamepad.isButtonDown(ig.BUTTONS.DPAD_LEFT)||ig.gamepad.getAxesValue(ig.AXES.LEFT_STICK_X)<-0.8},rightDown:function(){return this.autoControl?this.autoControl.get("menuRight"):ig.input.state("right")||!sc.model.isQuickMenuElementSwapEnabled()&&ig.gamepad.isButtonDown(ig.BUTTONS.DPAD_RIGHT)||ig.gamepad.getAxesValue(ig.AXES.LEFT_STICK_X)>0.8},upDown:function(){return this.autoControl?this.autoControl.get("menuUp"):ig.input.state("up")||!sc.model.isQuickMenuElementSwapEnabled()&&
ig.gamepad.isButtonDown(ig.BUTTONS.DPAD_UP)||ig.gamepad.getAxesValue(ig.AXES.LEFT_STICK_Y)<-0.8},downDown:function(){return this.autoControl?this.autoControl.get("menuDown"):ig.input.state("down")||!sc.model.isQuickMenuElementSwapEnabled()&&ig.gamepad.isButtonDown(ig.BUTTONS.DPAD_DOWN)||ig.gamepad.getAxesValue(ig.AXES.LEFT_STICK_Y)>0.8},loreDown:function(){return this.autoControl?this.autoControl.get("loreDown"):ig.input.state("right")||ig.gamepad.getAxesValue(ig.AXES.RIGHT_STICK_Y)>0.8||ig.gamepad.isButtonDown(ig.BUTTONS.DPAD_RIGHT)},
loreUp:function(){return this.autoControl?this.autoControl.get("loreDown"):ig.input.state("left")||ig.gamepad.getAxesValue(ig.AXES.RIGHT_STICK_Y)<-0.8||ig.gamepad.isButtonDown(ig.BUTTONS.DPAD_LEFT)},elementModeScroll:function(){if(this.autoControl||!sc.options.get("element-wheel"))return 0;if(ig.input.pressed("scrollUp"))return-1;if(ig.input.pressed("scrollDown"))return 1},elementModeSwitch:function(){return this.autoControl?this.autoControl.get("heatMode")?sc.ELEMENT.HEAT:this.autoControl.get("coldMode")?
sc.ELEMENT.COLD:this.autoControl.get("shockMode")?sc.ELEMENT.SHOCK:this.autoControl.get("waveMode")?sc.ELEMENT.WAVE:false:ig.input.pressed("neutral")?sc.ELEMENT.NEUTRAL:ig.input.pressed("heat")||ig.gamepad.isButtonPressed(ig.BUTTONS.DPAD_DOWN)?sc.ELEMENT.HEAT:ig.input.pressed("cold")||ig.gamepad.isButtonPressed(ig.BUTTONS.DPAD_UP)?sc.ELEMENT.COLD:ig.input.pressed("shock")||ig.gamepad.isButtonPressed(ig.BUTTONS.DPAD_RIGHT)?sc.ELEMENT.SHOCK:ig.input.pressed("wave")||ig.gamepad.isButtonPressed(ig.BUTTONS.DPAD_LEFT)?
sc.ELEMENT.WAVE:false}});var d=Vec2.create();sc.control=new sc.Control;ig.addGameAddon(function(){return sc.globalinput=new sc.GlobalInput})});ig.baked=!0;
ig.module("game.feature.combat.stat-change").requires("impact.base.game").defines(function(){window.FOR_THE_HACKERS="I see you are browsing through the code of our game! Hope you having a good time around here. I thought I adda little extra for you here, since you took the effort to check out the optimized/obfuscated code of CrossCode.If you happen to have a particular question about a feature, you can write us a mail and will be happy to answer it!Simply check out our homepage over at www.radicalfishgames.com! Also don't tell Lachsen you found this, or he will throw evil looks at me all day! - R.D.";sc.STAT_CHANGE_ICONS=
{"stat-default":[0,0],"stat-hp":[0,0],"stat-attack":[0,1],"stat-defense":[0,2],"stat-focus":[0,3],"stat-heat":[0,4],"stat-cold":[0,5],"stat-shock":[0,6],"stat-wave":[0,7],"stat-rank-1":[0,8],"stat-rank-2":[0,9],"stat-rank-3":[0,10],"stat-level-1":[0,11],"stat-level-2":[0,12],"stat-level-3":[0,13],"stat-regen":[0,14],"stat-overheat":[0,15],"stat-sp-regen":[0,16],"stat-cond-healing":[0,18],"stat-stun-threshold":[0,19],"stat-spike-dmg":[0,20],"stat-cross-counter":[0,21],"stat-break-dmg":[0,22],"stat-hack":[0,
23],"stat-rank-down-1":[0,24],"stat-rank-down-2":[0,25],"stat-rank-down-3":[0,26],"stat-rank-4":[0,27],insetArrow:[0,28],"stat-money":[0,29],"stat-dash":[0,30],"stat-melee":[0,31],"stat-ranged":[0,32]};sc.STAT_CHANGE_ICONS_LARGE={"stat-default":[4,0],"stat-hp":[4,0],"stat-attack":[4,1],"stat-defense":[4,2],"stat-focus":[4,3],"stat-heat":[4,4],"stat-cold":[4,5],"stat-shock":[4,6],"stat-wave":[4,7],"stat-rank-1":[4,8],"stat-rank-2":[4,9],"stat-rank-3":[4,10],"stat-level-1":[4,11],"stat-level-2":[4,
12],"stat-level-3":[4,13],"stat-regen":[4,14],"stat-overheat":[4,15],"stat-sp-regen":[4,16],"stat-cond-healing":[4,18],"stat-stun-threshold":[4,19],"stat-spike-dmg":[4,20],"stat-cross-counter":[4,21],"stat-break-dmg":[4,22],"stat-hack":[4,23],"stat-rank-down-1":[4,24],"stat-rank-down-2":[4,25],"stat-rank-down-3":[4,26],"stat-rank-4":[4,27],"stat-money":[4,28],"stat-dash":[4,29],"stat-melee":[4,30],"stat-ranged":[4,31]};var b=[0,0,0,0],a=["hp","attack","defense","focus"];sc.StatChange=ig.Class.extend({params:{hp:1,
attack:1,defense:1,focus:1,elemFactor:[1,1,1,1]},modifiers:{},iconString:"\\i[stat-default]",init:function(a){var b=a.length,e=null;for(this.iconString="";b--;)if((e=sc.STAT_CHANGE_SETTINGS[a[b]])&&e.change!=sc.STAT_CHANGE_TYPE.HEAL)if(e.change==sc.STAT_CHANGE_TYPE.STATS)e.type.key!="elemFactor"?this.params[e.type.key]=this.params[e.type.key]*(e.value||1):this.params.elemFactor[e.type.index]=this.params.elemFactor[e.type.index]*(e.value||1);else{this.modifiers[e.type.key]||(this.modifiers[e.type.key]=
0);this.modifiers[e.type.key]=this.modifiers[e.type.key]+e.value}this.iconString=sc.inventory.getBuffString(-1,true,a)},multiply:function(a,c){var e=this.params[c];if(e){if(a instanceof Array){for(var f=e.length;f--;)b[f]=a[f]*e[f];return b}return a*e}return a},add:function(a,b){return a+(this.modifiers[b]||0)},clear:function(){},getStatFactor:function(a){return this.params[a]},hasTimer:false,getTimeFactor:function(){return 0},intersectsWith:function(b){for(var c=a.length;c--;){var e=a[c];if(this.params[e]!=
1&&b.params[e]!=1)return true}for(c=4;c--;)if(this.params.elemFactor[c]!=1&&b.params.elemFactor[c]!=1)return true;for(e in this.modifiers)if(b.modifiers[e])return true;return false}});sc.ItemBuff=sc.StatChange.extend({timer:0,time:0,itemID:-1,init:function(a,b,e){this.parent(a);this.timer=this.time=b||0;this.itemID=e||-1},update:function(){if(this.timer>0){this.timer=this.timer-ig.system.actualTick;if(this.timer<=0){this.timer=0;return true}}return false},clear:function(){this.timer=0},reset:function(a){this.timer=
this.time=a+this.timer},hasTimer:true,getTimeFactor:function(){return this.time<=0?0:this.timer/this.time}});sc.ActionBuff=sc.StatChange.extend({active:true,name:null,hacked:false,init:function(a,b,e){this.parent(a);this.name=b;this.hacked=e||false},update:function(){return!this.active},onActionEndDetach:function(){this.active=false},onEntityKillDetach:function(){this.active=false},clear:function(){this.active=false},reset:function(a){this.timer=this.time=a+this.timer},hasTimer:false,getTimeFactor:function(){return this.active?
1:0}});sc.STAT_CHANGE_TYPE={};sc.STAT_CHANGE_TYPE.STATS=0;sc.STAT_CHANGE_TYPE.MODIFIER=1;sc.STAT_CHANGE_TYPE.HEAL=2;sc.STAT_PARAM_TYPE={};sc.STAT_PARAM_TYPE.HP_REGEN={key:"HP_REGEN"};sc.STAT_PARAM_TYPE.HP={key:"hp"};sc.STAT_PARAM_TYPE.HEAL={key:"heal"};sc.STAT_PARAM_TYPE.ATTACK={key:"attack"};sc.STAT_PARAM_TYPE.DEFENSE={key:"defense"};sc.STAT_PARAM_TYPE.FOCUS={key:"focus"};sc.STAT_PARAM_TYPE.HEAT={key:"elemFactor",index:0};sc.STAT_PARAM_TYPE.COLD={key:"elemFactor",index:1};sc.STAT_PARAM_TYPE.SHOCK=
{key:"elemFactor",index:2};sc.STAT_PARAM_TYPE.WAVE={key:"elemFactor",index:3};sc.STAT_PARAM_TYPE.OVERHEAT={key:"OVERHEAT_REDUCTION"};sc.STAT_PARAM_TYPE.SP_REGEN={key:"SP_REGEN"};sc.STAT_PARAM_TYPE.COND_HEALING={key:"COND_HEALING"};sc.STAT_PARAM_TYPE.STUN_THRESHOLD={key:"STUN_THRESHOLD"};sc.STAT_PARAM_TYPE.SPIKE_DMG={key:"SPIKE_DMG"};sc.STAT_PARAM_TYPE.CROSS_COUNTER={key:"CROSS_COUNTER"};sc.STAT_PARAM_TYPE.BREAK_DMG={key:"BREAK_DMG"};sc.STAT_PARAM_TYPE.MELEE_DMG={key:"MELEE_DMG"};sc.STAT_PARAM_TYPE.RANGED_DMG=
{key:"RANGED_DMG"};sc.STAT_PARAM_TYPE.MONEY_PLUS={key:"MONEY_PLUS"};sc.STAT_PARAM_TYPE.DASH_STEP={key:"DASH_STEP"};sc.STAT_USE_SPEED={};sc.STAT_USE_SPEED.NORMAL=1;sc.STAT_USE_SPEED.SLOW=2;sc.STAT_USE_SPEED.FAST=3;sc.STAT_CHANGE_SETTINGS={};sc.STAT_CHANGE_SETTINGS["HP-1"]={change:sc.STAT_CHANGE_TYPE.STATS,type:sc.STAT_PARAM_TYPE.HP,value:1.1,icon:"stat-hp",grade:"stat-rank-1"};sc.STAT_CHANGE_SETTINGS["HP-2"]={change:sc.STAT_CHANGE_TYPE.STATS,type:sc.STAT_PARAM_TYPE.HP,value:1.15,icon:"stat-hp",grade:"stat-rank-2"};
sc.STAT_CHANGE_SETTINGS["HP-3"]={change:sc.STAT_CHANGE_TYPE.STATS,type:sc.STAT_PARAM_TYPE.HP,value:1.2,icon:"stat-hp",grade:"stat-rank-3"};sc.STAT_CHANGE_SETTINGS["HP-MINUS-1"]={change:sc.STAT_CHANGE_TYPE.STATS,type:sc.STAT_PARAM_TYPE.HP,value:0.5,icon:"stat-hp",grade:"stat-rank-1"};sc.STAT_CHANGE_SETTINGS["ATTACK-1"]={change:sc.STAT_CHANGE_TYPE.STATS,type:sc.STAT_PARAM_TYPE.ATTACK,value:1.1,icon:"stat-attack",grade:"stat-rank-1"};sc.STAT_CHANGE_SETTINGS["ATTACK-2"]={change:sc.STAT_CHANGE_TYPE.STATS,
type:sc.STAT_PARAM_TYPE.ATTACK,value:1.15,icon:"stat-attack",grade:"stat-rank-2"};sc.STAT_CHANGE_SETTINGS["ATTACK-3"]={change:sc.STAT_CHANGE_TYPE.STATS,type:sc.STAT_PARAM_TYPE.ATTACK,value:1.2,icon:"stat-attack",grade:"stat-rank-3"};sc.STAT_CHANGE_SETTINGS.HACK={change:sc.STAT_CHANGE_TYPE.STATS,type:sc.STAT_PARAM_TYPE.ATTACK,value:1,icon:"stat-hack",grade:"stat-rank-3"};sc.STAT_CHANGE_SETTINGS["DEFENSE-1"]={change:sc.STAT_CHANGE_TYPE.STATS,type:sc.STAT_PARAM_TYPE.DEFENSE,value:1.1,icon:"stat-defense",
grade:"stat-rank-1"};sc.STAT_CHANGE_SETTINGS["DEFENSE-2"]={change:sc.STAT_CHANGE_TYPE.STATS,type:sc.STAT_PARAM_TYPE.DEFENSE,value:1.15,icon:"stat-defense",grade:"stat-rank-2"};sc.STAT_CHANGE_SETTINGS["DEFENSE-3"]={change:sc.STAT_CHANGE_TYPE.STATS,type:sc.STAT_PARAM_TYPE.DEFENSE,value:1.2,icon:"stat-defense",grade:"stat-rank-3"};sc.STAT_CHANGE_SETTINGS["FOCUS-1"]={change:sc.STAT_CHANGE_TYPE.STATS,type:sc.STAT_PARAM_TYPE.FOCUS,value:1.1,icon:"stat-focus",grade:"stat-rank-1"};sc.STAT_CHANGE_SETTINGS["FOCUS-2"]=
{change:sc.STAT_CHANGE_TYPE.STATS,type:sc.STAT_PARAM_TYPE.FOCUS,value:1.15,icon:"stat-focus",grade:"stat-rank-2"};sc.STAT_CHANGE_SETTINGS["FOCUS-3"]={change:sc.STAT_CHANGE_TYPE.STATS,type:sc.STAT_PARAM_TYPE.FOCUS,value:1.2,icon:"stat-focus",grade:"stat-rank-3"};sc.STAT_CHANGE_SETTINGS["ATTACK-4"]={change:sc.STAT_CHANGE_TYPE.STATS,type:sc.STAT_PARAM_TYPE.ATTACK,value:1.3,icon:"stat-attack",grade:"stat-rank-4"};sc.STAT_CHANGE_SETTINGS["FOCUS-4"]={change:sc.STAT_CHANGE_TYPE.STATS,type:sc.STAT_PARAM_TYPE.FOCUS,
value:1.3,icon:"stat-focus",grade:"stat-rank-4"};sc.STAT_CHANGE_SETTINGS["DEFENSE-MINUS-1"]={change:sc.STAT_CHANGE_TYPE.STATS,type:sc.STAT_PARAM_TYPE.DEFENSE,value:0.5,negative:true,icon:"stat-defense",grade:"stat-rank-down-3"};sc.STAT_CHANGE_SETTINGS["HEAT-RES-1"]={change:sc.STAT_CHANGE_TYPE.STATS,type:sc.STAT_PARAM_TYPE.HEAT,value:0.9,icon:"stat-heat",grade:"stat-rank-1"};sc.STAT_CHANGE_SETTINGS["HEAT-RES-2"]={change:sc.STAT_CHANGE_TYPE.STATS,type:sc.STAT_PARAM_TYPE.HEAT,value:0.8,icon:"stat-heat",
grade:"stat-rank-2"};sc.STAT_CHANGE_SETTINGS["HEAT-RES-3"]={change:sc.STAT_CHANGE_TYPE.STATS,type:sc.STAT_PARAM_TYPE.HEAT,value:0.7,icon:"stat-heat",grade:"stat-rank-3"};sc.STAT_CHANGE_SETTINGS["COLD-RES-1"]={change:sc.STAT_CHANGE_TYPE.STATS,type:sc.STAT_PARAM_TYPE.COLD,value:0.9,icon:"stat-cold",grade:"stat-rank-1"};sc.STAT_CHANGE_SETTINGS["COLD-RES-2"]={change:sc.STAT_CHANGE_TYPE.STATS,type:sc.STAT_PARAM_TYPE.COLD,value:0.8,icon:"stat-cold",grade:"stat-rank-2"};sc.STAT_CHANGE_SETTINGS["COLD-RES-3"]=
{change:sc.STAT_CHANGE_TYPE.STATS,type:sc.STAT_PARAM_TYPE.COLD,value:0.7,icon:"stat-cold",grade:"stat-rank-3"};sc.STAT_CHANGE_SETTINGS["SHOCK-RES-1"]={change:sc.STAT_CHANGE_TYPE.STATS,type:sc.STAT_PARAM_TYPE.SHOCK,value:0.9,icon:"stat-shock",grade:"stat-rank-1"};sc.STAT_CHANGE_SETTINGS["SHOCK-RES-2"]={change:sc.STAT_CHANGE_TYPE.STATS,type:sc.STAT_PARAM_TYPE.SHOCK,value:0.8,icon:"stat-shock",grade:"stat-rank-2"};sc.STAT_CHANGE_SETTINGS["SHOCK-RES-3"]={change:sc.STAT_CHANGE_TYPE.STATS,type:sc.STAT_PARAM_TYPE.SHOCK,
value:0.7,icon:"stat-shock",grade:"stat-rank-3"};sc.STAT_CHANGE_SETTINGS["WAVE-RES-1"]={change:sc.STAT_CHANGE_TYPE.STATS,type:sc.STAT_PARAM_TYPE.WAVE,value:0.9,icon:"stat-wave",grade:"stat-rank-1"};sc.STAT_CHANGE_SETTINGS["WAVE-RES-2"]={change:sc.STAT_CHANGE_TYPE.STATS,type:sc.STAT_PARAM_TYPE.WAVE,value:0.8,icon:"stat-wave",grade:"stat-rank-2"};sc.STAT_CHANGE_SETTINGS["WAVE-RES-3"]={change:sc.STAT_CHANGE_TYPE.STATS,type:sc.STAT_PARAM_TYPE.WAVE,value:0.7,icon:"stat-wave",grade:"stat-rank-3"};sc.STAT_CHANGE_SETTINGS["HEAL-1"]=
{change:sc.STAT_CHANGE_TYPE.HEAL,type:sc.STAT_PARAM_TYPE.HEAL,value:1.15,icon:"stat-default"};sc.STAT_CHANGE_SETTINGS["HEAL-2"]={change:sc.STAT_CHANGE_TYPE.HEAL,type:sc.STAT_PARAM_TYPE.HEAL,value:1.25,icon:"stat-default"};sc.STAT_CHANGE_SETTINGS["HEAL-3"]={change:sc.STAT_CHANGE_TYPE.HEAL,type:sc.STAT_PARAM_TYPE.HEAL,value:1.5,icon:"stat-default"};sc.STAT_CHANGE_SETTINGS["HEAL-4"]={change:sc.STAT_CHANGE_TYPE.HEAL,type:sc.STAT_PARAM_TYPE.HEAL,value:1.7,icon:"stat-default"};sc.STAT_CHANGE_SETTINGS["HEAL-5"]=
{change:sc.STAT_CHANGE_TYPE.HEAL,type:sc.STAT_PARAM_TYPE.HEAL,value:1.8,icon:"stat-default"};sc.STAT_CHANGE_SETTINGS["REGEN-1"]={change:sc.STAT_CHANGE_TYPE.MODIFIER,type:sc.STAT_PARAM_TYPE.HP_REGEN,value:0.5,icon:"stat-regen",grade:"stat-rank-1"};sc.STAT_CHANGE_SETTINGS["REGEN-2"]={change:sc.STAT_CHANGE_TYPE.MODIFIER,type:sc.STAT_PARAM_TYPE.HP_REGEN,value:0.8,icon:"stat-regen",grade:"stat-rank-2"};sc.STAT_CHANGE_SETTINGS["REGEN-3"]={change:sc.STAT_CHANGE_TYPE.MODIFIER,type:sc.STAT_PARAM_TYPE.HP_REGEN,
value:1,icon:"stat-regen",grade:"stat-rank-3"};sc.STAT_CHANGE_SETTINGS["REGEN-4"]={change:sc.STAT_CHANGE_TYPE.MODIFIER,type:sc.STAT_PARAM_TYPE.HP_REGEN,value:1.2,icon:"stat-regen",grade:"stat-rank-4"};sc.STAT_CHANGE_SETTINGS["OVERHEAT-1"]={change:sc.STAT_CHANGE_TYPE.MODIFIER,type:sc.STAT_PARAM_TYPE.OVERHEAT,value:0.3,icon:"stat-overheat",grade:"stat-rank-1"};sc.STAT_CHANGE_SETTINGS["OVERHEAT-2"]={change:sc.STAT_CHANGE_TYPE.MODIFIER,type:sc.STAT_PARAM_TYPE.OVERHEAT,value:0.4,icon:"stat-overheat",grade:"stat-rank-2"};
sc.STAT_CHANGE_SETTINGS["OVERHEAT-3"]={change:sc.STAT_CHANGE_TYPE.MODIFIER,type:sc.STAT_PARAM_TYPE.OVERHEAT,value:0.5,icon:"stat-overheat",grade:"stat-rank-3"};sc.STAT_CHANGE_SETTINGS["SP_REGEN-1"]={change:sc.STAT_CHANGE_TYPE.MODIFIER,type:sc.STAT_PARAM_TYPE.SP_REGEN,value:0.3,icon:"stat-sp-regen",grade:"stat-rank-1"};sc.STAT_CHANGE_SETTINGS["SP_REGEN-2"]={change:sc.STAT_CHANGE_TYPE.MODIFIER,type:sc.STAT_PARAM_TYPE.SP_REGEN,value:0.4,icon:"stat-sp-regen",grade:"stat-rank-2"};sc.STAT_CHANGE_SETTINGS["SP_REGEN-3"]=
{change:sc.STAT_CHANGE_TYPE.MODIFIER,type:sc.STAT_PARAM_TYPE.SP_REGEN,value:0.5,icon:"stat-sp-regen",grade:"stat-rank-3"};sc.STAT_CHANGE_SETTINGS["COND_HEALING-1"]={change:sc.STAT_CHANGE_TYPE.MODIFIER,type:sc.STAT_PARAM_TYPE.COND_HEALING,value:0.3,icon:"stat-cond-healing",grade:"stat-rank-1"};sc.STAT_CHANGE_SETTINGS["COND_HEALING-2"]={change:sc.STAT_CHANGE_TYPE.MODIFIER,type:sc.STAT_PARAM_TYPE.COND_HEALING,value:0.5,icon:"stat-cond-healing",grade:"stat-rank-2"};sc.STAT_CHANGE_SETTINGS["COND_HEALING-3"]=
{change:sc.STAT_CHANGE_TYPE.MODIFIER,type:sc.STAT_PARAM_TYPE.COND_HEALING,value:0.75,icon:"stat-cond-healing",grade:"stat-rank-3"};sc.STAT_CHANGE_SETTINGS["STUN_THRESHOLD-3"]={change:sc.STAT_CHANGE_TYPE.MODIFIER,type:sc.STAT_PARAM_TYPE.STUN_THRESHOLD,value:0.1,icon:"stat-stun-threshold",grade:"stat-rank-3"};sc.STAT_CHANGE_SETTINGS["SPIKE_DMG-3"]={change:sc.STAT_CHANGE_TYPE.MODIFIER,type:sc.STAT_PARAM_TYPE.SPIKE_DMG,value:0.5,icon:"stat-spike-dmg",grade:"stat-rank-3"};sc.STAT_CHANGE_SETTINGS["CROSS_COUNTER-1"]=
{change:sc.STAT_CHANGE_TYPE.MODIFIER,type:sc.STAT_PARAM_TYPE.CROSS_COUNTER,value:0.15,icon:"stat-cross-counter",grade:"stat-rank-1"};sc.STAT_CHANGE_SETTINGS["CROSS_COUNTER-2"]={change:sc.STAT_CHANGE_TYPE.MODIFIER,type:sc.STAT_PARAM_TYPE.CROSS_COUNTER,value:0.25,icon:"stat-cross-counter",grade:"stat-rank-2"};sc.STAT_CHANGE_SETTINGS["CROSS_COUNTER-3"]={change:sc.STAT_CHANGE_TYPE.MODIFIER,type:sc.STAT_PARAM_TYPE.CROSS_COUNTER,value:0.35,icon:"stat-cross-counter",grade:"stat-rank-3"};sc.STAT_CHANGE_SETTINGS["BREAK_DMG-3"]=
{change:sc.STAT_CHANGE_TYPE.MODIFIER,type:sc.STAT_PARAM_TYPE.BREAK_DMG,value:0.35,icon:"stat-break-dmg",grade:"stat-rank-3"};sc.STAT_CHANGE_SETTINGS["MELEE_DMG-1"]={change:sc.STAT_CHANGE_TYPE.MODIFIER,type:sc.STAT_PARAM_TYPE.MELEE_DMG,value:0.1,icon:"stat-melee",grade:"stat-rank-1"};sc.STAT_CHANGE_SETTINGS["MELEE_DMG-2"]={change:sc.STAT_CHANGE_TYPE.MODIFIER,type:sc.STAT_PARAM_TYPE.MELEE_DMG,value:0.2,icon:"stat-melee",grade:"stat-rank-2"};sc.STAT_CHANGE_SETTINGS["MELEE_DMG-3"]={change:sc.STAT_CHANGE_TYPE.MODIFIER,
type:sc.STAT_PARAM_TYPE.MELEE_DMG,value:0.3,icon:"stat-melee",grade:"stat-rank-3"};sc.STAT_CHANGE_SETTINGS["MELEE_DMG-4"]={change:sc.STAT_CHANGE_TYPE.MODIFIER,type:sc.STAT_PARAM_TYPE.MELEE_DMG,value:0.5,icon:"stat-melee",grade:"stat-rank-4"};sc.STAT_CHANGE_SETTINGS["RANGED_DMG-1"]={change:sc.STAT_CHANGE_TYPE.MODIFIER,type:sc.STAT_PARAM_TYPE.RANGED_DMG,value:0.1,icon:"stat-ranged",grade:"stat-rank-1"};sc.STAT_CHANGE_SETTINGS["RANGED_DMG-2"]={change:sc.STAT_CHANGE_TYPE.MODIFIER,type:sc.STAT_PARAM_TYPE.RANGED_DMG,
value:0.2,icon:"stat-ranged",grade:"stat-rank-2"};sc.STAT_CHANGE_SETTINGS["RANGED_DMG-3"]={change:sc.STAT_CHANGE_TYPE.MODIFIER,type:sc.STAT_PARAM_TYPE.RANGED_DMG,value:0.3,icon:"stat-ranged",grade:"stat-rank-3"};sc.STAT_CHANGE_SETTINGS["RANGED_DMG-4"]={change:sc.STAT_CHANGE_TYPE.MODIFIER,type:sc.STAT_PARAM_TYPE.RANGED_DMG,value:0.5,icon:"stat-ranged",grade:"stat-rank-4"};sc.STAT_CHANGE_SETTINGS["MONEY-MINUS-1"]={change:sc.STAT_CHANGE_TYPE.MODIFIER,type:sc.STAT_PARAM_TYPE.MONEY_PLUS,value:-2,negative:true,
icon:"stat-money",grade:"stat-rank-down-3"};sc.STAT_CHANGE_SETTINGS["DASH-STEP-1"]={change:sc.STAT_CHANGE_TYPE.MODIFIER,type:sc.STAT_PARAM_TYPE.DASH_STEP,value:1,icon:"stat-dash",grade:"stat-rank-1"}});ig.baked=!0;
ig.module("game.feature.font.font-system").requires("impact.base.font","impact.base.game","game.feature.combat.stat-change").defines(function(){sc.FONT_COLORS={RED:1,GREEN:2,PURPLE:3,GREY:4,ORANGE:5};var b={o:[0,0],x:[0,1],"<":[0,2],">":[0,3],tech:[0,4],general:[0,7],"interface":[0,8],video:[0,9],audio:[0,10],assists:[0,117],gamepad:[0,81],controls:[0,11],arena:[0,139],lea:[0,12],lea2:[0,15],li:[0,13],"item-news":[0,14],lea3:[0,16],quest:[0,17],"quest-solve":[0,18],"quest-fav":[0,19],"quest-all":[0,
20],"quest-elite":[0,78],"quest-elite-solve":[0,79],exp:[0,21],cp:[0,92],credit:[0,22],landmark:[0,23],lore:[0,24],loreNew:[0,25],"lore-story":[0,26],"lore-people":[0,27],"lore-cross-lore":[0,28],"lore-earth-lore":[0,29],"lore-memories":[0,30],"lore-others":[0,31],"enemy-mecha":[0,33],"enemy-avatars":[0,32],"enemy-animals":[0,34],"enemy-abstract":[0,35],"enemy-mecha-boss":[0,37],"enemy-avatars-boss":[0,36],"enemy-animals-boss":[0,38],"enemy-abstract-boss":[0,39],"enemy-boss":[0,40],"social-close":[0,
42],"social-contacts":[0,41],"social-3":[0,43],"stats-general":[0,44],"stats-combat":[0,45],"stats-items":[0,46],"stats-exploration":[0,47],"stats-arena":[0,139],"stats-misc":[0,48],"stats-quests":[0,49],"arrow-percent":[0,50],"element-neutral":[0,51],"element-heat":[0,52],"element-cold":[0,53],"element-shock":[0,54],"element-wave":[0,55],"element-all":[0,93],slash:[0,56],"slash-highlight":[0,57],"stats-log":[0,58],"logs-TROPHY":[0,59],"logs-LANDMARK":[0,60],"logs-LORE":[0,64],"logs-TRADER":[0,62],
"logs-QUEST":[0,61],"logs-DROP":[0,80],"area-rookie-harbor":[0,67],"area-autumn-area":[0,68],"area-autumn-fall":[0,69],"area-bergen":[0,71],"area-bergen-trails":[0,70],"area-heat-area":[0,72],"area-heat-village":[0,73],"area-rhombus-sqr":[0,74],"area-jungle":[0,76],"area-jungle-city":[0,77],"area-cold-dng":[0,94],"area-forest":[0,99],"area-arid":[0,100],"area-final-dng":[0,147],"area-beach":[0,148],"area-other":[0,31],"toggle-item-off":[0,101],"toggle-item-on":[0,102],"toggle-item-off-grey":[0,141],
"toggle-item-on-grey":[0,142],"toggle-item-off-radio":[0,114],"toggle-item-on-radio":[0,115],"toggle-item-off-radio-grey":[0,143],"toggle-item-on-radio-grey":[0,144],"save-star":[0,145],"trophies-GENERAL":[0,96],"trophies-COMBAT":[0,97],"trophies-EXPLORATION":[0,98],"party-TARGET-0":[0,82],"party-TARGET-1":[0,83],"party-TARGET-2":[0,84],"party-BEHAVIOUR-0":[0,85],"party-BEHAVIOUR-1":[0,86],"party-BEHAVIOUR-2":[0,87],"party-BEHAVIOUR-2-grey":[0,140],"party-ARTS-0":[0,88],"party-ARTS-1":[0,89],"party-ARTS-2":[0,
90],"questHub-open":[0,17],"questHub-active":[0,95],"questHub-finished":[0,18],"help-icon":[0,91],"status-stun-1":[0,107],"status-stun-2":[0,108],"status-cond-1":[0,103],"status-cond-2":[0,104],"status-cond-3":[0,105],"status-cond-4":[0,106],"ancient-code-1":[0,109],"ancient-code-2":[0,110],"ancient-code-3":[0,111],"ancient-code-4":[0,112],"ancient-code-5":[0,113],"arena-solo":[0,27],"arena-team":[0,41],"arena-medal-0":[0,118],"arena-medal-1":[0,119],"arena-medal-2":[0,120],"arena-medal-3":[0,121],
"arena-medal-4":[0,122],"arena-medal-x":[0,149],"arena-trophy-1":[0,123],"arena-trophy-2":[0,124],"arena-trophy-3":[0,125],"arena-trophy-4":[0,126],"arena-trophy-5":[0,138],"diff-0":[0,127],"diff-1":[0,128],"diff-2":[0,129],"diff-3":[0,130],"diff-4":[0,131],"diff-5":[0,132],"diff-6":[0,133],"arena-bolt-left":[0,135],"arena-bolt-right":[0,136],twitter:[0,116],ascended:[0,150]},a={"arrow-n":[0,0],"arrow-e":[0,1],"arrow-s":[0,2],"arrow-w":[0,3],"arrow-ne":[0,4],"arrow-se":[0,5],"arrow-sw":[0,6],"arrow-nw":[0,
7],"quest-no":[0,8],"quest-ok":[0,9],"quest-mini-no":[0,10],"quest-mini-ok":[0,11],"break":[0,12],"rank-up":[0,13],lore:[0,14],loreNew:[0,15],insetArrow:[0,16],burn:[0,17],chill:[0,18],jolt:[0,19],mark:[0,20],"stun-cancel":[0,21],"star-icon":[0,22],"diff-0":[0,23],"diff-1":[0,24],"diff-2":[0,25],"diff-3":[0,26],"diff-4":[0,27],"diff-5":[0,28],"diff-6":[0,29],slash:[0,30],"slash-highlight":[0,31],times:[0,32],timesRed:[0,33]},d={};d[ig.KEY.BACKSPACE]=4;d[ig.KEY.TAB]=93;d[ig.KEY.ESC]=10;d[ig.KEY.SPACE]=
16;d[ig.KEY.MINUS]=40;d[ig.KEY.ENTER]=41;d[ig.KEY.PAUSE]=42;d[ig.KEY.CAPS]=43;d[ig.KEY.SHIFT]=44;d[ig.KEY.PAGE_UP]=45;d[ig.KEY.PAGE_DOWN]=46;d[ig.KEY.END]=47;d[ig.KEY.HOME]=48;d[ig.KEY.ALT]=49;d[ig.KEY.PERIOD]=50;d[ig.KEY.DECIMAL]=51;d[ig.KEY.COMMA]=51;d[ig.KEY.DELETE]=65;d[ig.KEY.INSERT]=66;d[ig.KEY.CTRL]=81;d[ig.KEY.ADD]=82;d[ig.KEY.SUBSTRACT]=83;d[ig.KEY.DIVIDE]=84;d[ig.KEY.MULTIPLY]=85;d[ig.KEY.UP_ARROW]=77;d[ig.KEY.RIGHT_ARROW]=78;d[ig.KEY.LEFT_ARROW]=79;d[ig.KEY.DOWN_ARROW]=80;d[ig.KEY._0]=
55;d[ig.KEY._1]=56;d[ig.KEY._2]=57;d[ig.KEY._3]=58;d[ig.KEY._4]=59;d[ig.KEY._5]=60;d[ig.KEY._6]=61;d[ig.KEY._7]=62;d[ig.KEY._8]=63;d[ig.KEY._9]=64;d[ig.KEY.NUMPAD_0]=67;d[ig.KEY.NUMPAD_1]=68;d[ig.KEY.NUMPAD_2]=69;d[ig.KEY.NUMPAD_3]=70;d[ig.KEY.NUMPAD_4]=71;d[ig.KEY.NUMPAD_5]=72;d[ig.KEY.NUMPAD_6]=73;d[ig.KEY.NUMPAD_7]=74;d[ig.KEY.NUMPAD_8]=75;d[ig.KEY.NUMPAD_9]=76;d[ig.KEY.BRACKET_CLOSE]=87;d[ig.KEY.BACKSLASH]=88;d[ig.KEY.EQUAL]=89;d[ig.KEY.BRACKET_OPEN]=86;d[ig.KEY.SINGLE_QUOTE]=90;d[ig.KEY.SEMICOLON]=
52;d[ig.KEY.GRAVE_ACCENT]=91;d[ig.KEY.SLASH]=92;d[ig.KEY.A]=0;d[ig.KEY.B]=13;d[ig.KEY.C]=17;d[ig.KEY.D]=2;d[ig.KEY.E]=12;d[ig.KEY.F]=18;d[ig.KEY.G]=19;d[ig.KEY.H]=14;d[ig.KEY.I]=20;d[ig.KEY.J]=21;d[ig.KEY.K]=22;d[ig.KEY.L]=23;d[ig.KEY.M]=24;d[ig.KEY.N]=25;d[ig.KEY.O]=26;d[ig.KEY.P]=27;d[ig.KEY.Q]=11;d[ig.KEY.R]=28;d[ig.KEY.S]=1;d[ig.KEY.T]=29;d[ig.KEY.U]=30;d[ig.KEY.V]=31;d[ig.KEY.W]=3;d[ig.KEY.X]=32;d[ig.KEY.Y]=33;d[ig.KEY.Z]=34;var c={},e;for(e in d)c["keyCode-"+e]=[1,d[e]];var f={"key-left":[1,
0],"key-down":[1,1],"key-right":[1,2],"key-up":[1,3],"key-throw":[1,5],"key-dash":[1,6],mousewheel:[1,7],"key-menu":[1,9],"key-pause":[1,10],"key-melee":[1,31],"mouse-guard":[1,6]},g={left:[1,0],down:[1,1],right:[1,2],up:[1,3],aim:[1,5],"throw":[1,5],dash:[1,6],guard:[1,6],pause:[1,7],back:[1,4],special:[1,16],select:[0,0],help:[1,14],help2:[1,13],help3:[1,17],help4:[1,19],menu:[1,9],quick:[1,44],cold:[1,56],shock:[1,57],heat:[1,58],wave:[1,59],"arrow-left":[0,5],"arrow-right":[0,6],"arrow-left-off":[0,
65],"arrow-right-off":[0,66],"circle-left":[1,11],"circle-right":[1,12],"list-up":[1,0],"list-down":[1,2],"page-left":[1,0],"page-right":[1,2],"skip-cutscene":[1,19]},h={"left-stick":[2,0],"right-stick":[2,1],"gamepad-left":[2,8],"gamepad-down":[2,9],"gamepad-right":[2,10],"gamepad-up":[2,11],"gamepad-l1":[2,2],"gamepad-r1":[2,3],"gamepad-l2":[2,4],"gamepad-r2":[2,5],"gamepad-pause":[2,7],"gamepad-select":[2,6],"gamepad-a":[2,12],"gamepad-b":[2,13],"gamepad-x":[2,14],"gamepad-y":[2,15],"left-stick-left":[2,
16],"left-stick-right":[2,17],"left-stick-press":[2,18],"right-stick-press":[2,19],"gamepad-l1-off":[2,20],"gamepad-r1-off":[2,21]},i={"left-stick":[2,24],"right-stick":[2,25],"gamepad-left":[2,32],"gamepad-down":[2,33],"gamepad-right":[2,34],"gamepad-up":[2,35],"gamepad-l1":[2,26],"gamepad-r1":[2,27],"gamepad-l2":[2,28],"gamepad-r2":[2,29],"gamepad-pause":[2,31],"gamepad-select":[2,30],"gamepad-a":[2,36],"gamepad-b":[2,37],"gamepad-x":[2,38],"gamepad-y":[2,39],"left-stick-left":[2,40],"left-stick-right":[2,
41],"left-stick-press":[2,42],"right-stick-press":[2,43],"gamepad-l1-off":[2,44],"gamepad-r1-off":[2,45]},j={},k={left:"gamepad-left",down:"gamepad-down",right:"gamepad-right",up:"gamepad-up",aim:"right-stick","throw":"gamepad-r1",dash:"gamepad-l1",guard:"gamepad-l1",pause:"gamepad-pause",back:"gamepad-b",special:"gamepad-r2",help:"gamepad-pause",help2:"gamepad-x",help3:"gamepad-y",help4:"right-stick-press",menu:"gamepad-select",quick:"gamepad-l2",heat:"gamepad-down",shock:"gamepad-right",cold:"gamepad-up",
wave:"gamepad-left","arrow-left":"gamepad-l1","arrow-right":"gamepad-r1","arrow-left-off":"gamepad-l1-off","arrow-right-off":"gamepad-r1-off","circle-left":"gamepad-l1","circle-right":"gamepad-r1","page-left":"gamepad-left","page-right":"gamepad-right","list-up":"gamepad-l2","list-down":"gamepad-r2","skip-cutscene":"gamepad-y"},l={};sc.ITEMS_ICONS_MAPPING={"item-default":[3,0],"item-helm":[3,1],"item-sword":[3,2],"item-belt":[3,3],"item-shoe":[3,4],"item-items":[3,5],"item-key":[3,6],"item-trade":[3,
7],"item-toggle":[3,8]};sc.FEAT_ICONS_MAPPING={"feat-default":[3,0]};sc.ITEMS_ICONS_MAPPING_RARITY={};for(e=0;e<6;e++){var o=(e+1)*9,m="";switch(e){case 0:m="normal";break;case 1:m="rare";break;case 2:m="legend";break;case 3:m="unique";break;case 4:m="backer";break;case 5:m="scale"}sc.ITEMS_ICONS_MAPPING_RARITY["item-default-"+m]=[3,o++];sc.ITEMS_ICONS_MAPPING_RARITY["item-helm-"+m]=[3,o++];sc.ITEMS_ICONS_MAPPING_RARITY["item-sword-"+m]=[3,o++];sc.ITEMS_ICONS_MAPPING_RARITY["item-belt-"+m]=[3,o++];
sc.ITEMS_ICONS_MAPPING_RARITY["item-shoe-"+m]=[3,o++];sc.ITEMS_ICONS_MAPPING_RARITY["item-items-"+m]=[3,o++];sc.ITEMS_ICONS_MAPPING_RARITY["item-key-"+m]=[3,o++];sc.ITEMS_ICONS_MAPPING_RARITY["item-trade-"+m]=[3,o++];sc.ITEMS_ICONS_MAPPING_RARITY["item-toggle-"+m]=[3,o++]}sc.GAMEPAD_ICON_STYLE={XBOX:0,PS3:1};sc.LANGUAGE_ICON_MAPPING={"language-0":[5,1],"language-1":[5,0],"language-2":[5,3],"language-3":[5,2],"language-4":[5,4],"language-5":[5,5]};sc.FontSystem=ig.GameAddon.extend({gamepadIcons:false,
icons:{global:new ig.Font("media/font/icons.png",16,ig.MultiFont.ICON_START),globalSmall:new ig.Font("media/font/icons-small.png",14,ig.MultiFont.ICON_START),keyboard:new ig.Font("media/font/icons-keyboard.png",16,ig.MultiFont.ICON_START),gamepad:new ig.Font("media/font/icons-gamepad.png",16,ig.MultiFont.ICON_START),items:new ig.Font("media/font/icons-items.png",16,ig.MultiFont.ICON_START),stats:new ig.Font("media/font/icons-buff.png",8,ig.MultiFont.ICON_START),stats_large:new ig.Font("media/font/icons-buff-large.png",
16,ig.MultiFont.ICON_START),langs:new ig.Font("media/font/languages.png",16,ig.MultiFont.ICON_START)},colors:{red:new ig.Image("media/font/colors/hall-fetica-bold-red.png",16),green:new ig.Image("media/font/colors/hall-fetica-bold-green.png",16),purple:new ig.Image("media/font/colors/hall-fetica-bold-purple.png",16),grey:new ig.Image("media/font/colors/hall-fetica-bold-grey.png",16),orange_mid:new ig.Image("media/font/colors/hall-fetica-small-orange.png",13),orange_tiny:new ig.Image("media/font/colors/tiny-orange.png",
7),purple_mid:new ig.Image("media/font/colors/hall-fetica-small-purple.png",13),grey_mid:new ig.Image("media/font/colors/hall-fetica-small-grey.png",13),grey_tiny:new ig.Image("media/font/colors/tiny-grey.png",7),red_mid:new ig.Image("media/font/colors/hall-fetica-small-red.png",13),red_tiny:new ig.Image("media/font/colors/tiny-red.png",7),green_mid:new ig.Image("media/font/colors/hall-fetica-small-green.png",13),green_tiny:new ig.Image("media/font/colors/tiny-green.png",7)},font:new ig.MultiFont("media/font/hall-fetica-bold.png",
16,0),smallFont:new ig.MultiFont("media/font/hall-fetica-small.png",13,1),tinyFont:new ig.MultiFont("media/font/tiny.png",7,2,"#cccccc"),switchIndex:1,gamepadIconStyle:sc.GAMEPAD_ICON_STYLE.XBOX,init:function(){this.parent("FontSystem");this.font.pushIconSet(this.icons.global);this.font.pushIconSet(this.icons.keyboard);this.font.pushIconSet(this.icons.gamepad);this.font.pushIconSet(this.icons.items);this.font.pushIconSet(this.icons.stats_large);this.font.pushIconSet(this.icons.langs);this.tinyFont.pushIconSet(this.icons.stats);
this.smallFont.pushIconSet(this.icons.globalSmall);this.updateGamepadSwapMap();this.font.setMapping(b);this.font.setMapping(f);this.font.setMapping(j);this.font.setMapping(g);this.font.setMapping(c);this.font.setMapping(sc.ITEMS_ICONS_MAPPING);this.font.setMapping(sc.ITEMS_ICONS_MAPPING_RARITY);this.font.setMapping(sc.STAT_CHANGE_ICONS_LARGE);this.font.setMapping(sc.LANGUAGE_ICON_MAPPING);this.smallFont.setMapping(a);this.tinyFont.setMapping(sc.STAT_CHANGE_ICONS);this.font.pushColorSet(sc.FONT_COLORS.RED,
this.colors.red,"#ff6969");this.font.pushColorSet(sc.FONT_COLORS.GREEN,this.colors.green,"#65ff89");this.font.pushColorSet(sc.FONT_COLORS.PURPLE,this.colors.purple,"#ffe430");this.font.pushColorSet(sc.FONT_COLORS.GREY,this.colors.grey,"#808080");this.smallFont.pushColorSet(sc.FONT_COLORS.GREY,this.colors.grey_mid,"#808080");this.smallFont.pushColorSet(sc.FONT_COLORS.RED,this.colors.red_mid,"#ff6969");this.smallFont.pushColorSet(sc.FONT_COLORS.GREEN,this.colors.green_mid,"#65ff89");this.smallFont.pushColorSet(sc.FONT_COLORS.PURPLE,
this.colors.purple_mid,"#ffe430");this.smallFont.pushColorSet(sc.FONT_COLORS.ORANGE,this.colors.orange_mid,"#ff8932");this.tinyFont.pushColorSet(sc.FONT_COLORS.GREY,this.colors.grey_tiny,"#808080");this.tinyFont.pushColorSet(sc.FONT_COLORS.RED,this.colors.red_tiny,"#ff6969");this.tinyFont.pushColorSet(sc.FONT_COLORS.GREEN,this.colors.green_tiny,"#65ff89");this.tinyFont.pushColorSet(sc.FONT_COLORS.PURPLE,this.colors.orange_tiny,"#ffe430");this.gamepadIcons=false},changeKeyCodeIcon:function(a,b){var c=
f["key-"+a];c&&(c[1]=d[b]);(c=g[a])&&(c[1]=d[b]);this.font.setMapping(d);this.gamepadIcons||this.font.setMapping(g);this.font.callChangeListeners()},changeGamepadIcon:function(a,b){k[a]=b;this.updateGamepadSwapMap();this.font.setMapping(j);this.gamepadIcons&&this.font.setMapping(l);this.font.callChangeListeners()},setGamepadIconStyle:function(a){this.gamepadIconStyle=a;this.updateGamepadSwapMap()},updateGamepadSwapMap:function(){var a=this.gamepadIconStyle?i:h,b;for(b in a)j[b]=a[b];for(b in k)l[b]=
a[k[b]]},hasIcon:function(a){return b[a]},onVarsChanged:function(){var a=ig.input.currentDevice==ig.INPUT_DEVICES.GAMEPAD;if(this.gamepadIcons!=a)(this.gamepadIcons=a)?this.font.setMapping(l):this.font.setMapping(g)}});sc.fontsystem=new sc.FontSystem;ig.addGameAddon(function(){return sc.fontsystem})});ig.baked=!0;
ig.module("game.feature.gui.base.text").requires("impact.base.font","impact.feature.gui.gui","game.feature.font.font-system").defines(function(){sc.TextGui=ig.GuiElementBase.extend({font:null,text:"",textBlock:null,beepSound:null,bleepDelay:0,playSound:false,stopped:false,init:function(b,a){this.parent();var a=a||{},d=a.font;this.font=d?d:sc.fontsystem.font;this.text=b;this.textBlock=new ig.TextBlock(this.font,b,a);a.drawCallback&&this.textBlock.setDrawCallback(a.drawCallback);this.bleepDelay=0;this.hook.size.x=
this.textBlock.size.x;this.hook.size.y=this.textBlock.size.y;this.hook.pivot.x=Math.floor(this.hook.size.x/2);this.hook.pivot.y=Math.floor(this.hook.size.y/2)},onVisibilityChange:function(b){b?this.textBlock.prerender():this.textBlock.clearPrerendered()},setBeepSound:function(b){(this.beepSound=b)&&this.textBlock.isFinished()&&this.beepSound.play()},setMaxWidth:function(b){this.textBlock.maxWidth=b||0;this.setText(this.text)},setTextAlign:function(b){this.textBlock.align=b},setTextSpeed:function(b){this.textBlock.speed=
b},setFont:function(b,a){if(b&&b!=this.font){this.font=b;this.textBlock.font=b;if(a!=void 0)this.textBlock.linePadding=a||0;this.setText(this.text)}},setDrawCallback:function(b){this.textBlock.setDrawCallback(b)},setText:function(b){this.text=b;this.textBlock.setText(b);this.isVisible()&&this.textBlock.prerender();this.hook.size.x=this.textBlock.size.x;this.hook.size.y=this.textBlock.size.y;this.hook.pivot.x=Math.floor(this.hook.size.x/2);this.hook.pivot.y=Math.floor(this.hook.size.y/2);this.stopped=
false},clear:function(){this.textBlock.clearPrerendered()},finish:function(){this.textBlock.finish()},update:function(){if(!this.stopped){var b=Math.floor(this.textBlock.currentIndex/1);this.textBlock.update();if(Math.floor(this.textBlock.currentIndex/1)!=b)this.playSound=true;if(!sc.model.isTitle()&&this.beepSound&&this.playSound&&this.bleepDelay<=0){this.beepSound.play();this.playSound=false;this.bleepDelay=Math.ceil(this.textBlock.speed*120)/60-0.005}this.bleepDelay=this.bleepDelay-ig.system.actualTick}},
stop:function(){this.stopped=true},reset:function(){this.textBlock.reset()},resume:function(){this.stopped=false},getTextState:function(){return this.textBlock.getState()},setTextState:function(b){this.textBlock.setState(b)},updateDrawables:function(b){b.addDraw().setText(this.textBlock,0,0)},onAttach:function(){this.isVisible()&&this.textBlock.prerender()},onDetach:function(){this.textBlock.clearPrerendered()}})});ig.baked=!0;
ig.module("game.feature.interact.button-group").requires("impact.feature.interact.button-interact").defines(function(){sc.MouseButtonGroup=ig.ButtonGroup.extend({sounds:{focus:new ig.Sound("media/sound/menu/menu-hover.ogg",0.9)},_counter:0,init:function(){this.parent()},addFocusGui:function(b){this.parent(b,0,this._counter);b.focusCount=this._counter;this._counter++},clear:function(){this._counter=0;this.parent()},onButtonTraversal:null,doButtonTraversal:function(b){sc.control.menuBack()&&this.invokeBackButton();
this.onButtonTraversal&&this.onButtonTraversal(b)},isNonMouseMenuInput:function(){return false}});sc.ButtonGroup=ig.ButtonGroup.extend({sounds:{focus:new ig.Sound("media/sound/menu/menu-hover.ogg",0.9)},repeater:null,init:function(b,a,d){this.parent(a,d);if(b)this.sounds.focus=null;this.repeater=new ig.PressRepeater},setRegainFocus:function(){this.setCurrentFocus(this.current.x,this.current.y)},regainCurrentFocus:function(b,a,d){this.focusCurrentButton(this.current.x,this.current.y,b,a,d)},isNonMouseMenuInput:function(){return sc.control.menuConfirm()||
sc.control.rightDown()||sc.control.leftDown()||sc.control.downDown()||sc.control.upDown()},onButtonTraversal:null,doButtonTraversal:function(b){sc.control.menuBack()&&this.invokeBackButton();var a=this.getRepeaterValue();if(!b){sc.control.menuConfirm()&&this.invokeCurrentButton();switch(a){case "right":this.stepRight();break;case "left":this.stepLeft();break;case "up":this.stepUp();break;case "down":this.stepDown()}}if(this.onButtonTraversal)this.onButtonTraversal(b)},getRepeaterValue:function(){sc.control.rightDown()?
this.repeater.setDown("right"):sc.control.leftDown()?this.repeater.setDown("left"):sc.control.downDown()?this.repeater.setDown("down"):sc.control.upDown()&&this.repeater.setDown("up");return this.repeater.getPressed()},activate:function(){this.parent();this.getRepeaterValue()}});sc.RowButtonGroup=sc.ButtonGroup.extend({rowIndex:[],currentRow:-1,usePrevRowIndex:false,_lastRowIndex:0,leftRightCallback:null,init:function(){this.parent()},addFocusGui:function(b,a,d){if(!this.elements[d]){this.elements[d]=
[];this.rowIndex[d]=0}if(this.currentRow==-1){this.currentRow=d;this.current.x=d}this.elements[d][a]=b;b.buttonGroup=this;b.buttonInteract=null},addEmptyRow:function(b){if(!this.elements[b]){this.elements[b]=[];this.rowIndex[b]=0}},setLeftRightCallback:function(b){if(b)this.leftRightCallback=b},getCurrentCellIndex:function(){return this.rowIndex[this.currentRow]},regainCurrentFocus:function(b,a,d){this.focusCurrentButton(this.currentRow,this.rowIndex[this.currentRow],b,a,d)},setCurrentRowIndexes:function(b,
a,d,c,e,f){if(this.elements[b].length==0){for(var g=b;this.elements[g].length==0;)g=(g+1)%this.elements.length;this.currentRow=g=g%this.elements.length}else this.currentRow=b;this.rowIndex[b]=a;d&&this.focusCurrentButton(this.currentRow,this.rowIndex[this.currentRow],c,e,f)},isPositionValid:function(b,a){return this.elements[b]&&this.elements[b][a]!=void 0},clear:function(){this.parent();this.rowIndex.length=0;this.currentRow=-1},stepRight:function(){if(!(this.isEmpty()||this.currentRow==-1)){var b=
this.rowIndex[this.currentRow]+1;if(b>=this.elements[this.currentRow].length)b=this.elements[this.currentRow].length-1;else for(var a=b;a<this.elements[this.currentRow].length;a++)if(this.elements[this.currentRow][a]!==void 0){b=a;break}this._lastRowIndex=b=b%this.elements[this.currentRow].length;this.rowIndex[this.currentRow]=b;this.leftRightCallback&&this.leftRightCallback(true,this.currentRow)&&this.focusCurrentButton(this.currentRow,this.rowIndex[this.currentRow],false,false,true)}},stepLeft:function(){if(!(this.isEmpty()||
this.currentRow==-1)){var b=this.rowIndex[this.currentRow]-1;if(b<0)b=0;else for(var a=b;a>=0;a--)if(this.elements[this.currentRow][a]!==void 0){b=a;break}this._lastRowIndex=b=b%this.elements[this.currentRow].length;this.rowIndex[this.currentRow]=b;this.leftRightCallback&&this.leftRightCallback(false,this.currentRow)&&this.focusCurrentButton(this.currentRow,this.rowIndex[this.currentRow],false,false,true)}},stepDown:function(){if(!(this.isEmpty()||this.currentRow==-1)){var b=this.current.x+1;for(b>=
this.elements.length&&(b=0);!this.elements[b]||this.elements[b].length==0;){b++;b>=this.elements.length&&(b=0)}this.currentRow=b=b%this.elements.length;this.focusCurrentButton(this.currentRow,this.usePrevRowIndex?this._lastRowIndex:this.rowIndex[this.currentRow],false,false,true)}},stepUp:function(){if(!(this.isEmpty()||this.currentRow==-1)){var b=this.current.x-1;for(b<0&&(b=this.elements.length-1);!this.elements[b]||this.elements[b].length==0;){b--;b<0&&(b=this.elements.length-1)}this.currentRow=
b=b%this.elements.length;this.focusCurrentButton(this.currentRow,this.usePrevRowIndex?this._lastRowIndex:this.rowIndex[this.currentRow],false,false,true)}},getCurrentElement:function(){return this.elements[this.currentRow]&&this.elements[this.currentRow][this.rowIndex[this.currentRow]]},getCurrentX:function(){return this.rowIndex[this.currentRow]},getCurrentY:function(){return this.currentRow}})});ig.baked=!0;
ig.module("game.feature.gui.base.button").requires("impact.feature.gui.base.box","game.feature.gui.base.text","impact.feature.interact.gui.focus-gui","game.feature.interact.button-group").defines(function(){sc.BUTTON_DEFAULT_WIDTH=144;sc.BUTTON_MENU_WIDTH=128;sc.BUTTON_TOP_MENU_WIDTH=66;sc.BUTTON_TYPE={};sc.BUTTON_SOUND={submit:new ig.Sound("media/sound/menu/menu-submit.ogg"),back:new ig.Sound("media/sound/menu/menu-cancel.ogg"),equip:new ig.Sound("media/sound/menu/equip-sound.ogg",0.8),denied:new ig.Sound("media/sound/menu/menu-blocked.ogg",
0.9),quickAppear:new ig.Sound("media/sound/menu/quick-menu-appear.ogg",0.8),quickHide:new ig.Sound("media/sound/menu/quick-menu-hide.ogg",0.8),shop_up:new ig.Sound("media/sound/menu/shop/shop-menu-up.ogg",1),shop_down:new ig.Sound("media/sound/menu/shop/shop-menu-down.ogg",1),shop_cash:new ig.Sound("media/sound/menu/shop/shop-kashing.ogg",0.8),quest_accept:new ig.Sound("media/sound/menu/stamp-scifi.ogg",1),toggle_on:new ig.Sound("media/sound/menu/item-toggle-on.ogg",0.8),toggle_off:new ig.Sound("media/sound/menu/item-toggle-off.ogg",
0.8)};sc.ButtonBgGui=ig.BoxGui.extend({init:function(a,b){this.parent(a,b.height,false,b.ninepatch)}});sc.ButtonHighlightGui=ig.GuiElementBase.extend({focusWeight:null,gfx:null,pattern:null,flipped:false,highlight:null,init:function(a,b){this.parent();this.hook.size.x=a;this.hook.size.y=b.height;this.highlight=b.highlight;this.pattern=b.highlight.pattern;this.gfx=b.highlight.gfx},updateDrawables:function(a){if(this.focusWeight>0){this.flipped&&a.addTransform().setScale(-1,1).setTranslate(this.hook.size.x,
0);var b=this.highlight,c=this.highlight.offsetY,e=b.leftWidth,f=b.rightWidth;if(this.focusWeight>=1)a.addPattern(this.pattern,e,0,0,0,this.hook.size.x-f-e,this.hook.size.y);else{var g=Math.floor(this.focusWeight*this.hook.size.x/2),e=Math.min(e,g),f=Math.min(f,g);g>e&&a.addPattern(this.pattern,e,0,0,0,g-e,this.hook.size.y);g>f&&a.addPattern(this.pattern,this.hook.size.x-g,0,0,0,g-f,this.hook.size.y)}a.addGfx(this.gfx,0,0,b.startX,c,e,this.hook.size.y);a.addGfx(this.gfx,this.hook.size.x-f,0,b.endX-
f,c,f,this.hook.size.y);this.flipped&&a.undoTransform()}}});sc.ButtonGui=ig.FocusGui.extend({text:null,bgGui:null,highlightGui:null,gfx:new ig.Image("media/gui/buttons.png"),focusTimer:0,alphaTimer:0,buttonType:null,submitSound:null,blockedSound:null,data:null,noFocusOnPressed:false,animateOnPress:false,transitions:{DEFAULT:{state:{},time:0.3,timeFunction:KEY_SPLINES.EASE_OUT},HIDDEN:{state:{alpha:0,scaleX:0,scaleY:0},time:0.3,timeFunction:KEY_SPLINES.EASE_IN}},textChild:null,init:function(a,b,c,
e,f,g,h){this.parent(c,g);this.buttonType=e||sc.BUTTON_TYPE.DEFAULT;this.setSize(0,24);this.setPivot(72,14);this.hook.size.y=this.buttonType.height;this.text=a;this.submitSound=f||sc.BUTTON_SOUND.submit;this.blockedSound=h||sc.BUTTON_SOUND.denied;this.textChild=new sc.TextGui(this.getButtonText(),{speed:ig.TextBlock.SPEED.IMMEDIATE});this.textChild.setAlign(this.buttonType.alignX||ig.GUI_ALIGN.X_CENTER,ig.GUI_ALIGN.Y_CENTER);this.textChild.setPos(this.buttonType.alignXPadding||0,0);this.hook.size.x=
Math.ceil(b/2)*2||Math.ceil(this.textChild.hook.size.x/2+12)*2;this.bgGui=new sc.ButtonBgGui(this.hook.size.x,this.buttonType);this.addChildGui(this.bgGui);if(this.buttonType.highlight){this.highlightGui=new sc.ButtonHighlightGui(this.hook.size.x,this.buttonType);this.addChildGui(this.highlightGui)}this.addChildGui(this.textChild)},invokeButtonPress:function(a){this.submitSound&&this.submitSound.play();this.onButtonPress(a)},setData:function(a){if(a!=void 0)this.data=a},setWidth:function(a){this.hook.size.x=
a;this.hook.pivot.x=a/2;this.bgGui.hook.size.x=a;if(this.highlightGui)this.highlightGui.hook.size.x=a},setHeight:function(a){this.hook.size.y=a;this.hook.pivot.y=a/2;this.bgGui.hook.size.y=a;if(this.highlightGui)this.highlightGui.hook.size.y=a},setText:function(a,b){this.text=a;this.textChild.setText(a);if(!b){var c=Math.ceil(this.textChild.hook.size.x/2+12)*2;this.hook.size.x=c;this.hook.pivot.x=c/2;this.bgGui.hook.size.x=c;if(this.highlightGui)this.highlightGui.hook.size.x=c}},resetText:function(){this.textChild.setText(this.getButtonText());
var a=Math.ceil(this.textChild.hook.size.x/2+12)*2;this.hook.size.x=a;this.hook.pivot.x=a/2;this.bgGui.hook.size.x=a;if(this.highlightGui)this.highlightGui.hook.size.x=a},unsetFocus:function(){this.focus=false;if(this.highlightGui){this.highlightGui.hook.localAlpha=1;this.highlightGui.focusWeight=0}this.focusTimer=this.alphaTimer=0},update:function(){this.parent();if(this.keepPressed&&this.pressed&&this.animateOnPress)if(this.focus)this.alphaTimer=(this.alphaTimer+ig.system.actualTick)%1;else{this.alphaTimer=
0;this.focusTimer=0.1}else if(this.keepPressed&&this.pressed&&!this.noFocusOnPressed){this.focusTimer=this.focusTimer+ig.system.actualTick;if(this.focusTimer>0.1)this.focusTimer=0.1;this.alphaTimer=0}else if(this.focus&&this.focusTimer<0.1){this.focusTimer=this.focusTimer+ig.system.actualTick;this.alphaTimer=0}else if(!this.focus&&this.focusTimer>0){this.focusTimer=this.focusTimer-ig.system.actualTick;this.alphaTimer=0}else this.alphaTimer=(this.alphaTimer+ig.system.actualTick)%1;this.focusTimer.limit(0,
0.1);this.bgGui.currentTileOffset=this.keepPressed&&this.pressed?"pressed":this.focus?"focus":"default";if(this.highlightGui){this.highlightGui.focusWeight=this.focusTimer/0.1;var a=this.alphaTimer/1,a=KEY_SPLINES.EASE_IN_OUT.get(1-(a>0.5?1-(a-0.5)*2:a*2)),a=0.8*a+0.2;this.active||(a=a*0.5);this.highlightGui.hook.localAlpha=a}},getButtonText:function(){return this.active?"\\c[0]"+this.text:"\\c["+sc.FONT_COLORS.GREY+"]"+this.text},setActive:function(a){this.parent(a);this.textChild.setText(this.getButtonText())}});
var b={"default":{x:160,y:0},pressed:{x:180,y:0}};sc.CheckboxGui=sc.ButtonGui.extend({hookGui:null,init:function(a,d,c){this.parent("",d,c,sc.BUTTON_TYPE.OPTION,null,false);d=(a=a==void 0?false:a)?"pressed":"default";this.hookGui=new ig.ImageGui(this.gfx,b[d].x,b[d].y,20,18);this.hookGui.setAlign(ig.GUI_ALIGN.X_CENTER,ig.GUI_ALIGN.Y_CENTER);this.insertChildGui(this.hookGui,this.hook.children.length-2);this.setPressed(a)},setPressed:function(a){this.parent(a);a=a?"pressed":"default";this.hookGui.offsetX=
b[a].x;this.hookGui.offsetY=b[a].y},invokeButtonPress:function(){this.submitSound&&this.submitSound.play();this.setPressed(!this.pressed);this.onButtonPress()}});sc.BUTTON_TYPE.DEFAULT={height:24,ninepatch:new ig.NinePatch("media/gui/buttons.png",{width:16,height:0,left:8,top:24,right:8,bottom:0,offsets:{"default":{x:0,y:0},focus:{x:32,y:0},pressed:{x:32,y:0}}}),highlight:{startX:64,endX:96,leftWidth:9,rightWidth:8,offsetY:0,gfx:new ig.Image("media/gui/buttons.png"),pattern:new ig.ImagePattern("media/gui/buttons.png",
73,0,15,24,ig.ImagePattern.OPT.REPEAT_X)}};sc.BUTTON_TYPE.SMALL={height:21,ninepatch:new ig.NinePatch("media/gui/buttons.png",{width:16,height:0,left:8,top:21,right:8,bottom:0,offsets:{"default":{x:0,y:24},focus:{x:32,y:24},pressed:{x:32,y:24}}}),highlight:{startX:64,endX:96,leftWidth:9,rightWidth:8,offsetY:24,gfx:new ig.Image("media/gui/buttons.png"),pattern:new ig.ImagePattern("media/gui/buttons.png",73,24,15,21,ig.ImagePattern.OPT.REPEAT_X)}};sc.BUTTON_TYPE.EQUIP={height:39,ninepatch:new ig.NinePatch("media/gui/buttons.png",
{width:13,height:6,left:9,top:9,right:9,bottom:9,offsets:{"default":{x:0,y:65},focus:{x:32,y:65},pressed:{x:32,y:65}}}),highlight:null};sc.BUTTON_TYPE.ITEM={height:20,ninepatch:new ig.NinePatch("media/gui/buttons.png",{width:2,height:0,left:8,top:20,right:8,bottom:0,offsets:{"default":{x:0,y:45},focus:{x:44,y:45},pressed:{x:44,y:45}}}),highlight:null,alignX:ig.GUI_ALIGN.X_LEFT,alignXPadding:5};sc.BUTTON_TYPE.OPTION={height:21,ninepatch:new ig.NinePatch("media/gui/buttons.png",{width:16,height:0,left:8,
top:21,right:8,bottom:0,offsets:{"default":{x:96,y:0},focus:{x:96,y:0},pressed:{x:96,y:0}}}),highlight:{startX:128,endX:160,leftWidth:9,rightWidth:8,offsetY:0,gfx:new ig.Image("media/gui/buttons.png"),pattern:new ig.ImagePattern("media/gui/buttons.png",137,0,15,21,ig.ImagePattern.OPT.REPEAT_X)}};sc.BUTTON_TYPE.GROUP={height:21,ninepatch:new ig.NinePatch("media/gui/buttons.png",{width:8,height:0,left:4,top:21,right:4,bottom:0,offsets:{"default":{x:184,y:24},focus:{x:184,y:24},pressed:{x:168,y:24}}}),
highlight:{startX:200,endX:216,leftWidth:4,rightWidth:4,offsetY:24,gfx:new ig.Image("media/gui/buttons.png"),pattern:new ig.ImagePattern("media/gui/buttons.png",204,24,8,21,ig.ImagePattern.OPT.REPEAT_X)}};sc.BUTTON_TYPE.GROUP_LEFT={height:21,ninepatch:new ig.NinePatch("media/gui/buttons.png",{width:8,height:0,left:8,top:21,right:8,bottom:0,offsets:{"default":{x:120,y:24},focus:{x:120,y:24},pressed:{x:96,y:24}}}),highlight:{startX:144,endX:168,leftWidth:9,rightWidth:4,offsetY:24,gfx:new ig.Image("media/gui/buttons.png"),
pattern:new ig.ImagePattern("media/gui/buttons.png",153,24,11,21,ig.ImagePattern.OPT.REPEAT_X)}};sc.BUTTON_TYPE.GROUP_RIGHT={height:21,ninepatch:new ig.NinePatch("media/gui/buttons.png",{width:8,height:0,left:8,top:21,right:8,bottom:0,offsets:{"default":{x:120,y:48},focus:{x:120,y:48},pressed:{x:96,y:48}}}),highlight:{startX:144,endX:168,leftWidth:4,rightWidth:9,offsetY:48,gfx:new ig.Image("media/gui/buttons.png"),pattern:new ig.ImagePattern("media/gui/buttons.png",147,48,13,21,ig.ImagePattern.OPT.REPEAT_X)}};
sc.BUTTON_TYPE.START={height:115,ninepatch:new ig.NinePatch("media/gui/buttons.png",{width:8,height:4,left:4,top:8,right:4,bottom:9,offsets:{"default":{x:184,y:24},focus:{x:184,y:24},pressed:{x:168,y:24}}}),highlight:{startX:224,endX:240,leftWidth:4,rightWidth:4,offsetY:112,gfx:new ig.Image("media/gui/buttons.png"),pattern:new ig.ImagePattern("media/gui/buttons.png",228,112,8,115,ig.ImagePattern.OPT.REPEAT_X)}}});ig.baked=!0;
ig.module("game.feature.gui.base.boxes").requires("impact.feature.gui.base.box","impact.feature.gui.gui").defines(function(){sc.RegularBoxGui=ig.BoxGui.extend({ninepatch:new ig.NinePatch("media/gui/message.png",{width:16,height:16,left:8,top:16,right:8,bottom:8,offsets:{"default":{x:0,y:0}}}),PADDING_X:8,PADDING_Y:4,init:function(a){this.parent(0,0,a,this.ninepatch);this.hook.pivot.x=this.hook.size.x/2;this.hook.pivot.y=this.hook.size.y/2},setContent:function(a){this.setSize(a.hook.size.x+this.PADDING_X*
2,a.hook.size.y+this.PADDING_Y*2);this.addChildGui(a);a.setPos(this.PADDING_X,this.PADDING_Y)}});sc.WhiteLineBox=ig.BoxGui.extend({transitions:{DEFAULT:{state:{alpha:1},time:0.15,timeFunction:KEY_SPLINES.EASE_OUT},HIDDEN:{state:{alpha:0,scaleX:1.5,scaleY:1.5},time:0.15,timeFunction:KEY_SPLINES.EASE_IN}},ninepatch:new ig.NinePatch("media/gui/message.png",{width:14,height:14,left:1,top:1,right:1,bottom:1,offsets:{"default":{x:16,y:96}}}),init:function(a,b){this.parent(a,b,false,this.ninepatch);this.ninepatch.skipTile[0]=
this.ninepatch.skipTile[2]=1;this.ninepatch.skipTile[4]=1;this.ninepatch.skipTile[6]=this.ninepatch.skipTile[8]=1;this.hook.pivot.x=this.hook.size.x/2;this.hook.pivot.y=this.hook.size.y/2}});var b=[{x:8,y:4},{x:10,y:6}];sc.ArrowBoxGui=ig.BoxGui.extend({transitions:{DEFAULT:{state:{alpha:0.8},time:0,timeFunction:KEY_SPLINES.LINEAR}},gfx:new ig.Image("media/gui/message.png"),ninepatch:new ig.NinePatch("media/gui/message.png",{width:16,height:16,left:8,top:16,right:8,bottom:8,offsets:{"default":{x:0,
y:0},dream:{x:224,y:0}}}),PADDING_X:8,PADDING_Y:4,PADDING_POINTER:8,pointerType:0,init:function(a,d,f){var g=b[sc.options.get("message-padding")];this.PADDING_X=g.x;this.PADDING_Y=g.y;this.parent(a+this.PADDING_X*2,d+this.PADDING_Y*2,false,this.ninepatch);if(ig.dreamFx.isActive()){this.currentTileOffset="dream";this.hook.localAlpha=0.5}if(this.hook.size.x%2==1)this.hook.size.x=this.hook.size.x+1;this.pointerType=f||sc.ArrowBoxGui.POINTER.NONE;this.hook.pivot.x=this.pointerType>2?this.hook.size.x:
0;this.hook.pivot.y=this.hook.size.y},resize:function(a,b){this.setSize(a+this.PADDING_X*2,b+this.PADDING_Y*2)},setPointerDown:function(){if(this.pointerType==sc.ArrowBoxGui.POINTER.TOP_LEFT)this.pointerType=sc.ArrowBoxGui.POINTER.BOTTOM_LEFT;else if(this.pointerType==sc.ArrowBoxGui.POINTER.TOP_RIGHT)this.pointerType=sc.ArrowBoxGui.POINTER.BOTTOM_RIGHT},updateDrawables:function(a){this.ninepatch.skipTile[0]=this.pointerType;this.pointerType>2&&a.addTransform().setScale(-1,1).setTranslate(this.hook.size.x,
0);this.parent(a);if(this.pointerType){var b=ig.dreamFx.isActive()?224:0,d=Math.min(this.ninepatch.tile.top,this.hook.size.y-this.ninepatch.tile.bottom);a.addGfx(this.gfx,-8,0,b+(this.pointerType%2==0?16:0),40,16,d)}this.pointerType>2&&a.undoTransform()}});sc.ArrowBoxGui.POINTER={NONE:0,TOP_LEFT:1,BOTTOM_LEFT:2,TOP_RIGHT:3,BOTTOM_RIGHT:4};sc.PointingBoxGui=ig.BoxGui.extend({transitions:{HIDDEN:{state:{alpha:0,scaleX:0,scaleY:0},time:0,timeFunction:KEY_SPLINES.EASE_IN},DEFAULT:{state:{alpha:1},time:0,
timeFunction:KEY_SPLINES.EASE_OUT}},gfx:new ig.Image("media/gui/message.png"),ninepatch:new ig.NinePatch("media/gui/message.png",{width:16,height:16,left:8,top:16,right:8,bottom:8,offsets:{"default":{x:0,y:0}}}),direction:0,init:function(){this.parent(width+this.PADDING_X*2,height+this.PADDING_Y*2,false,this.ninepatch);if(this.hook.size.x%2==1)this.hook.size.x=this.hook.size.x+1;this.pointerType=pointerType||ig.BoxGui.POINTER.NONE;this.hook.pivot.x=this.pointerType>2?this.hook.size.x:0;this.hook.pivot.y=
this.hook.size.y},setPointerDown:function(){if(this.pointerType==sc.ArrowBoxGui.POINTER.TOP_LEFT)this.pointerType=sc.ArrowBoxGui.POINTER.BOTTOM_LEFT;else if(this.pointerType==sc.ArrowBoxGui.POINTER.TOP_RIGHT)this.pointerType=sc.ArrowBoxGui.POINTER.BOTTOM_RIGHT},updateDrawables:function(a){this.ninepatch.skipTile[0]=this.pointerType;this.pointerType>2&&a.addTransform().setScale(-1,1).setTranslate(this.hook.size.x,0);this.parent(a);if(this.pointerType){var b=Math.min(this.ninepatch.tile.top,this.hook.size.y-
this.ninepatch.tile.bottom);a.addGfx(this.gfx,-8,0,this.pointerType%2==0?16:0,40,16,b)}this.pointerType>2&&a.undoTransform()}});sc.LineGui=ig.BoxGui.extend({ninepatch:new ig.NinePatch("media/gui/message.png",{width:12,height:2,left:2,top:0,right:0,bottom:0,offsets:{"default":{x:0,y:80}}}),init:function(a){this.parent(a,2,false,this.ninepatch)}});sc.BlackGrayBox=ig.BoxGui.extend({text:null,ninepatch:new ig.NinePatch("media/gui/message.png",{width:16,height:16,left:8,top:16,right:8,bottom:8,offsets:{"default":{x:0,
y:0}}}),init:function(a,b,d){this.parent(a,b,d)}});sc.BlackWhiteBox=ig.BoxGui.extend({text:null,ninepatch:new ig.NinePatch("media/gui/message.png",{width:22,height:22,left:5,top:5,right:5,bottom:5,offsets:{"default":{x:48,y:0}}}),init:function(a,b,d){this.parent(a,b,d);this.hook.localAlpha=0.8}});sc.SideBorderBox=ig.BoxGui.extend({text:null,transitions:{DEFAULT:{state:{},time:0,timeFunction:KEY_SPLINES.LINEAR},FLIPPED:{state:{scaleX:-1,scaleY:-1},time:0,timeFunction:KEY_SPLINES.LINEAR}},ninepatch:new ig.NinePatch("media/gui/message.png",
{width:12,height:20,left:0,top:7,right:0,bottom:5,offsets:{"default":{x:32,y:0}}}),init:function(a,b){this.parent(12,a,false);b&&this.doStateTransition("FLIPPED",true)},setHeight:function(a){this.setSize(12,a)}});sc.SideBoxGui=ig.GuiElementBase.extend({transitions:{DEFAULT:{state:{},time:0.3,timeFunction:KEY_SPLINES.EASE_OUT},HIDDEN:{state:{},time:0.3,timeFunction:KEY_SPLINES.EASE_IN}},titleGui:null,contentEntries:[],right:false,init:function(a,b){this.parent();this.hook.localAlpha=1;this.right=a;
this.titleGui=new sc.SlickTitleGui(b,a,75);this.titleGui.hook.localAlpha=this.hook.localAlpha;this.titleGui.setAlign(this.right?ig.GUI_ALIGN.X_RIGHT:ig.GUI_ALIGN.X_LEFT,ig.GUI_ALIGN.Y_TOP);this.titleGui.doStateTransition("HIDDEN",true);this.addChildGui(this.titleGui);this.setSize(this.titleGui.hook.size.x,this.titleGui.hook.size.y)},pushContent:function(a,b,d,g){a=new sc.SlickBoxGui(a,this.right,d||8,g||2,80);this.right&&a.setAlign(ig.GUI_ALIGN.X_RIGHT,ig.GUI_ALIGN.Y_TOP);this.contentEntries.push(a);
a.doStateTransition("HIDDEN",true);b&&a.doStateTransition("DEFAULT");this.addChildGui(a);this.rearrangeContent(a)},replaceContent:function(a,b){this.contentEntries[a].setContent(b);this.rearrangeContent()},removeContent:function(a){a=this.contentEntries.splice(a,1)[0];a.doStateTransition("HIDDEN",false,true);this.rearrangeContent();return a},clearContent:function(){for(;this.contentEntries.length;)this.contentEntries.pop().doStateTransition("HIDDEN",false,true)},popContent:function(){this.contentEntries.pop().doStateTransition("HIDDEN",
false,true);this.rearrangeContent()},rearrangeContent:function(a){for(var b=this.titleGui.hook.size.x,d=this.titleGui.hook.size.y,g=0;g<this.contentEntries.length;++g){var h=this.contentEntries[g];g&&(d=d+1);h==a?h.setPos(0,d):h.doPosTranstition(0,d,0.3,KEY_SPLINES.EASE_OUT);d=d+h.hook.size.y;b=Math.max(b,h.hook.size.x)}this.setSize(b,d)},hide:function(a,b){if(!this.hook.removeAfterTransition){this.titleGui.doStateTransition("HIDDEN",a);for(var d=0;d<this.contentEntries.length;++d)this.contentEntries[d].doStateTransition("HIDDEN",
a);this.doStateTransition("HIDDEN",false,false,b)}},show:function(a,b){if(!this.hook.removeAfterTransition){this.titleGui.doStateTransition("DEFAULT",a,false,null,b||0);for(var d=0;d<this.contentEntries.length;++d)this.contentEntries[d].doStateTransition("DEFAULT",a,false,null,b||0);this.doStateTransition("DEFAULT")}},remove:function(){this.titleGui.doStateTransition("HIDDEN");for(var a=0;a<this.contentEntries.length;++a)this.contentEntries[a].doStateTransition("HIDDEN");this.doStateTransition("HIDDEN",
false,true)}});sc.CenterBoxGui=ig.GuiElementBase.extend({transitions:{DEFAULT:{state:{alpha:1},time:0.3,timeFunction:KEY_SPLINES.EASE_IN_OUT},HIDDEN:{state:{alpha:0.5,scaleX:1,scaleY:0},time:0.3,timeFunction:KEY_SPLINES.EASE_IN_OUT}},iconGfx:new ig.Image("media/gui/message.png"),msgContent:null,centerBox:null,borderLeftGui:null,borderRightGui:null,init:function(a,b){this.parent();this.msgContent=a;this.centerBox=new sc.BlackWhiteBox(a.hook.size.x+16,a.hook.size.y+10);this.addChildGui(this.centerBox);
this.centerBox.setPos(5,3);this.setSize(this.centerBox.hook.size.x+10,this.centerBox.hook.size.y+6);this.hook.pivot.x=this.hook.size.x/2;this.hook.pivot.y=this.hook.size.y/2;this.addChildGui(this.msgContent);this.msgContent.setPos(13,8);this.borderLeftGui=new sc.SideBorderBox(this.hook.size.y-1);this.borderLeftGui.setAlign(ig.GUI_ALIGN.X_LEFT,ig.GUI_ALIGN.Y_BOTTOM);this.addChildGui(this.borderLeftGui);this.borderRightGui=new sc.SideBorderBox(this.hook.size.y-1,true);this.borderRightGui.setAlign(ig.GUI_ALIGN.X_RIGHT,
ig.GUI_ALIGN.Y_TOP);this.addChildGui(this.borderRightGui);this.doStateTransition("HIDDEN",true);this.doStateTransition("DEFAULT",b)},remove:function(){this.doStateTransition("HIDDEN",false,true)},resize:function(){var a=this.msgContent;this.centerBox.setSize(a.hook.size.x+16,a.hook.size.y+10);this.setSize(this.centerBox.hook.size.x+10,this.centerBox.hook.size.y+6);this.hook.pivot.x=this.hook.size.x/2;this.hook.pivot.y=this.hook.size.y/2;this.borderLeftGui.setHeight(this.hook.size.y-1);this.borderRightGui.setHeight(this.hook.size.y-
1)}});var a=Vec2.create(),d=2/60;sc.SMALL_BOX_ALIGN={BOTTOM:function(a,b){a.x=b.size.x/2;a.y=b.size.y},CENTER:function(a,b){a.x=b.size.x/2;a.y=b.size.y/2-b.size.z/2},TOP:function(a,b){a.x=b.size.x/2;a.y=-b.size.z}};sc.SmallEntityBox=ig.GuiElementBase.extend({ninepatch:new ig.NinePatch("media/gui/message.png",{width:16,height:0,left:16,top:11,right:16,bottom:0,offsets:{"default":{x:96,y:64}}}),transitions:{DEFAULT:{state:{alpha:1},time:0.1,timeFunction:KEY_SPLINES.EASE_IN_OUT},START:{state:{alpha:0.5,
scaleX:0.8,scaleY:0},time:0.15,timeFunction:KEY_SPLINES.EASE_IN_OUT},HIDDEN:{state:{alpha:0.5,scaleX:2,scaleY:0},time:0.15,timeFunction:KEY_SPLINES.EASE_IN_OUT},HIDDEN_SMALL:{state:{alpha:0.5,scaleX:1,scaleY:0},time:0.15,timeFunction:KEY_SPLINES.EASE_IN_OUT}},entity:null,textGui:null,timer:0,rumbleTime:0,finished:false,entityOff:Vec2.create(),offY:0,fixedPos:null,hideSmall:false,init:function(a,b,d,g,h){this.parent();this.entity=a;this.textGui=new sc.TextGui(b,{font:sc.fontsystem.smallFont});this.textGui.setAlign(ig.GUI_ALIGN.X_CENTER,
ig.GUI_ALIGN.Y_CENTER);this.textGui.setPos(0,1);this.addChildGui(this.textGui);this.setSize(this.textGui.hook.size.x+16,11);this.hook.localAlpha=0.5;this.setPivot(this.hook.size.x/2,this.hook.size.y/2);this.doStateTransition("START",true);this.doStateTransition("DEFAULT");this.timer=d;this.rumbleTime=d/2;g=g||sc.SMALL_BOX_ALIGN.TOP;g(this.entityOff,a.coll);this.offY=h||0},setFixedPos:function(){this.fixedPos=Vec3.create();Vec3.assign(this.fixedPos,this.entity.coll.pos)},stopRumble:function(){this.rumbleTime=
this.timer},update:function(){this._updatePos();this.timer=this.timer-ig.system.actualTick;this.timer<=0&&this.remove()},updateDrawables:function(a){this.ninepatch.draw(a,this.hook.size.x,this.hook.size.y,"default")},_updatePos:function(){if(this.entity){var b=this.entity.coll,b=this.fixedPos||b.pos;ig.system.getScreenFromMapPos(a,Math.round(b.x+this.entityOff.x),Math.round(b.y-b.z+this.entityOff.y-this.offY));b=0;if(this.timer>this.rumbleTime){var e=Math.floor(this.timer/d);e%4==1&&(b=2);e%4==3&&
(b=-2)}this.hook.pos.x=a.x-this.hook.size.x/2+b;this.hook.pos.y=a.y-this.hook.size.y/2-4+0}},remove:function(){this.finished=true;this.doStateTransition(this.hideSmall?"HIDDEN_SMALL":"HIDDEN",false,true)},isFinished:function(){return this.finished}});sc.LineBoxGui=ig.GuiElementBase.extend({ninepatch:new ig.NinePatch("media/gui/message.png",{width:16,height:0,left:16,top:26,right:16,bottom:0,offsets:{"default":{x:48,y:32}}}),transitions:{DEFAULT:{state:{alpha:1},time:0.2,timeFunction:KEY_SPLINES.EASE_IN_OUT},
HIDDEN:{state:{alpha:0.5,scaleX:1,scaleY:0},time:0.2,timeFunction:KEY_SPLINES.EASE_IN_OUT}},content:null,paddingX:0,init:function(a,b){this.parent();this.content=a;this.paddingX=b||16;this.hook.localAlpha=0.8;this.addChildGui(this.content);this.content.setAlign(ig.GUI_ALIGN.X_CENTER,ig.GUI_ALIGN.Y_CENTER);this.setSize(ig.system.width,26);this.setPivot(this.hook.size.x/2,this.hook.size.y/2);this.doStateTransition("HIDDEN",true);this.doStateTransition("DEFAULT")},updateDrawables:function(a){var b=this.content.hook.size.x+
this.paddingX*2,d=ig.system.width/2-b/2;this.ninepatch.draw(a,b,this.hook.size.y,"default",d,0);a.addColor("black",0,12,d,2);a.addColor("black",d+b,12,d,2)}});sc.SmallBlackBoxGui=ig.BoxGui.extend({text:null,transitions:{DEFAULT:{state:{alpha:0.5},time:0.2,timeFunction:KEY_SPLINES.EASE_IN_OUT}},ninepatch:new ig.NinePatch("media/gui/message.png",{width:8,height:0,left:4,top:15,right:4,bottom:0,offsets:{"default":{x:24,y:80}}}),init:function(a){this.parent(a,15,false)}})});ig.baked=!0;
ig.module("game.feature.gui.base.numbers").requires("impact.feature.gui.gui").defines(function(){function b(a,b){for(a.digits=0;b;){a.digits++;b=Math.floor(b/10)}if(a.leadingZeros>a.digits)a.digits=a.leadingZeros;a.hook.size.x=(a.digits+(a.signed||a.showPlus))*a.metrics.width;if(a.dots)a.hook.size.x=a.hook.size.x+(Math.ceil(a.digits/3)-1)*a.metrics.dotX;a.hook.size.y=a.metrics.height;a.hook.pivot.x=Math.floor(a.hook.size.x/2)}sc.GUI_NUMBER_COLOR={WHITE:0,RED:1,GREEN:2,GREY:3,ORANGE:4,NO_SHADOW:5};
sc.NUMBER_SIZE={NORMAL:{x:0,y:0,width:8,height:8,dotX:3,commaOffset:2,dotSize:3},TINY:{x:136,y:0,width:6,height:6},LARGE:{x:0,y:40,width:12,height:14},TEXT:{x:160,y:32,width:8,height:10,dotX:3,commaOffset:2,dotSize:3},SMALL:{x:0,y:56,width:6,height:8,dotX:2,dotSize:2,commaOffset:1},CHAIN:{x:0,y:96,width:13,height:15}};var a=void 0;sc.NumberGui=ig.GuiElementBase.extend({gfx:new ig.Image("media/gui/basic.png"),maxNumber:9999,digits:0,realDigits:0,signed:false,showPlus:false,metrics:null,color:sc.GUI_NUMBER_COLOR.WHITE,
targetNumber:0,initNumber:0,numTransitionTime:0,numTransitionScale:0,timer:null,noZero:false,leadingZeros:0,showPlusOnZero:false,scramble:false,dots:false,zeroAsGrey:false,init:function(d,c){this.parent();this.setSize(0,7);this.setPivot(0,4);a===void 0&&(a=!(ig.LANG_DETAILS[ig.currentLang]&&ig.LANG_DETAILS[ig.currentLang].commaDigits));this.maxNumber=d;this.signed=c&&c.signed||false;this.numTransitionTime=c&&c.transitionTime||0;this.numTransitionScale=c&&c.transitionScale||0;this.color=c&&c.color||
this.color;this.showPlus=c&&c.showPlus||false;this.metrics=c&&c.size||sc.NUMBER_SIZE.NORMAL;this.noZero=c&&c.noZero||false;this.leadingZeros=c&&c.leadingZeros||0;this.scramble=c&&c.scramble||false;this.dots=c&&c.dots||false;this.zeroAsGrey=c&&c.zeroAsGrey||false;this.timer=new ig.WeightTimer(true);d&&b(this,d)},setSize:function(a){this.metrics=a||sc.NUMBER_SIZE.NORMAL;b(this,this.maxNumber)},setNumber:function(a,c){c=c!=void 0?c:false;a=a*1;isNaN(a)&&(a=0);this.maxNumber?a=a.limit(this.signed?-this.maxNumber:
0,this.maxNumber):b(this,a);if(this.targetNumber!=a){this.initNumber=c?a:this._getCurrentNumber();this.targetNumber=a;var e=c?0:this.numTransitionTime,f=Math.abs(this.initNumber-this.targetNumber);this.numTransitionScale?e=e*(f/this.numTransitionScale):e/f>0.066&&(e=f*0.066);this.timer.set(e)}if(this.zeroAsGrey)for(this.realDigits=a?-1:0;a&&this.realDigits<this.digits;){this.realDigits++;a=Math.floor(a/10)}},getNumber:function(){return this.targetNumber},setMaxNumber:function(a){this.maxNumber=a;
b(this,this.maxNumber)},setColor:function(a){this.color=a},update:function(){this.timer.tick()},updateDrawables:function(b){var c=this.metrics,e=c.x,f=c.y+this.color*c.height,g=c.width,h=c.height,i=this.hook.size.x,j=false,k=this._getCurrentNumber(),l=k,o=0;if(k<0){j=true;k=-k}else if(k==0&&this.noZero)return;var m=this.leadingZeros,n=0;do{var i=i-g,p=k%10;b.addGfx(this.gfx,i,0,e+(this.scramble?15:p)*g,this.zeroAsGrey&&p==0&&this.realDigits>=0&&n>this.realDigits?c.y+sc.GUI_NUMBER_COLOR.GREY*c.height:
f,g,h);n++;k=Math.floor(k/10);m--;if(this.dots&&k>0){o++;if(o>=3){o=0;i=i-this.metrics.dotX;b.addGfx(this.gfx,i,a?c.commaOffset||3:0,e+(a?16:14)*g,f,c.dotX||3,h)}}}while(this.leadingZeros?m>0||this.digits>=this.leadingZeros&&k:k);i=i-g;j?b.addGfx(this.gfx,i,0,e+10*g,f,g,h):this.showPlus&&(this.showPlusOnZero||l!=0)&&b.addGfx(this.gfx,i-1,0,e+11*g,f,g,h)},_getCurrentNumber:function(){if(this.timer.done())return this.targetNumber;var a=this.timer.get();return Math.floor((1-a)*this.initNumber+a*this.targetNumber)}});
sc.MaxNumberGui=ig.GuiElementBase.extend({gfx:new ig.Image("media/gui/basic.png"),currentNumberGui:null,maxNumberGui:null,init:function(a,b){this.parent();this.currentNumberGui=new sc.NumberGui(a,{transitionTime:b});this.maxNumberGui=new sc.NumberGui(a);this.maxNumberGui.setPos(this.currentNumberGui.hook.size.x+12,0);this.maxNumberGui.setNumber(a);this.addChildGui(this.currentNumberGui);this.addChildGui(this.maxNumberGui);this.setSize(this.currentNumberGui.hook.size.x+this.maxNumberGui.hook.size.x+
12,7)},getMaxNumber:function(){return this.maxNumberGui.getNumber()},setMaxNumber:function(a,b){this.currentNumberGui.setMaxNumber(a);this.maxNumberGui.setMaxNumber(a);this.maxNumberGui.setNumber(a,b);this.setSize(this.currentNumberGui.hook.size.x+this.maxNumberGui.hook.size.x+12,7);this.maxNumberGui.setPos(this.currentNumberGui.hook.size.x+12,0)},setNumber:function(a,b){this.currentNumberGui.setNumber(a,b)},updateDrawables:function(a){a.addGfxTile(this.gfx,this.currentNumberGui.hook.size.x+2,0,12,
8)}})});ig.baked=!0;
ig.module("game.feature.menu.gui.menu-misc").requires("impact.feature.gui.gui","impact.feature.gui.base.basic-gui","impact.feature.interact.gui.focus-gui","impact.feature.gui.base.box","impact.feature.gui.base.basic-gui","game.feature.gui.base.button","game.feature.combat.stat-change").defines(function(){sc.ScrollType={};sc.ScrollType.BOTH=0;sc.ScrollType.Y_ONLY=1;sc.ScrollType.X_ONLY=2;sc.MenuPanelType={};sc.MenuPanelType.TOP_LEFT_EDGE=0;sc.MenuPanelType.TOP_RIGHT_EDGE=1;sc.MenuPanelType.TOP_LEFT_EDGE_DARK=2;
sc.MenuPanelType.TOP_RIGHT_EDGE_DARK=3;sc.MenuPanelType.SQUARE=4;sc.MenuPanelType.BOTTOM_LEFT_EDGE=5;sc.MenuPanelType.TOP_RIGHT_EDGE_DARKER=6;sc.MenuPanelType.BOTTOM_RIGHT_EDGE=7;var b=KEY_SPLINES.EASE;sc.MODIFIER_ICON_DRAW={X:620,Y:219,SIZE:11,MAX_PER_ROW:5};var a=Vec2.createC(0,0);sc.PercentNumber=ig.GuiElementBase.extend({gfx:new ig.Image("media/gui/menu.png"),transitions:{DEFAULT:{state:{},time:0.2,timeFunction:KEY_SPLINES.LINEAR},HIDDEN:{state:{alpha:0},time:0.2,timeFunction:KEY_SPLINES.LINEAR}},
number:null,init:function(a,b){this.parent();this.number=new sc.NumberGui(a,b);this.addChildGui(this.number);this.setSize(this.number.hook.size.x+9,this.number.hook.size.y)},setNumber:function(a,b){a!=0&&this.doStateTransition("DEFAULT",true);this.number.setNumber(a,b);this.setSize(this.number.hook.size.x+9,this.number.hook.size.y)},setColor:function(a){this.number.setColor(a)},hide:function(){this.setNumber(0,true);this.doStateTransition("HIDDEN",true)},updateDrawables:function(a){a.addGfx(this.gfx,
this.hook.size.x-8,0,this.number.color*9,407,8,8)}});sc.NewUnlockButton=sc.ButtonGui.extend({gfx:new ig.Image("media/gui/menu.png"),overlay:null,init:function(a,b,c,d,i,j,k){this.parent(a,b,c,d,i,j,k);this.overlay=new sc.NewUnlockOverlay;this.overlay.setPos(4,4);this.addChildGui(this.overlay)},activateNewOverlay:function(a){this.overlay.activate(a)},deactivateNewOverlay:function(){this.overlay.deactivate()}});sc.NewUnlockOverlay=ig.ImageGui.extend({transitions:{DEFAULT:{state:{},time:0.1,timeFunction:KEY_SPLINES.LINEAR},
HIDDEN:{state:{alpha:0},time:0.1,timeFunction:KEY_SPLINES.LINEAR}},gfx:new ig.Image("media/gui/menu.png"),overlayActive:false,small:false,timer:0,alpha:1,init:function(){this.parent(this.gfx,464,488,11,11);this.setAlign(ig.GUI_ALIGN.X_RIGHT,ig.GUI_ALIGN.Y_TOP);this.setPivot(5.5,5.5)},update:function(){this.parent();if(this.overlayActive){this.timer=(this.timer+ig.system.actualTick)%1.6;var a=this.timer/1.6,a=KEY_SPLINES.EASE_IN_OUT.get(1-(a>0.5?1-(a-0.5)*2:a*2)),a=0.7*a+0.3;this.active||(a=a*0.7);
this.alpha=Math.min(1,a+0.3);this.hook.localAlpha=this.alpha}},updateDrawables:function(a){a.addTransform().setPivot(this.hook.pivot.x,this.hook.pivot.y).setScale(this.alpha,this.alpha);this.parent(a);a.undoTransform()},activate:function(){this.overlayActive=true;this.doStateTransition("DEFAULT",true)},deactivate:function(a,b){this.overlayActive=false;this.doStateTransition("HIDDEN",a?b||false:true,a)}});sc.BuffInfo=ig.GuiElementBase.extend({transitions:{DEFAULT:{state:{},time:0.2,timeFunction:KEY_SPLINES.EASE},
FADE_OUT:{state:{alpha:0},time:0.2,timeFunction:KEY_SPLINES.LINEAR},HIDDEN:{state:{},time:0.2,timeFunction:KEY_SPLINES.LINEAR}},ninepatch:new ig.NinePatch("media/gui/status-gui.png",{width:4,height:0,left:11,top:12,right:11,bottom:0,offsets:{"default":{x:216,y:144}}}),text:null,_width:0,init:function(){this.parent();this.hook.size.x=100;this.hook.size.y=21;this.setPos(2,0);this.text=new sc.TextGui("",{font:sc.fontsystem.tinyFont,speed:ig.TextBlock.SPEED.IMMEDIATE});this.text.setAlign(ig.GUI_ALIGN.X_LEFT,
ig.GUI_ALIGN.Y_CENTER);this.text.setPos(13,0);this.text.hook.transitions={DEFAULT:{state:{},time:0.2,timeFunction:KEY_SPLINES.EASE},FADE_OUT:{state:{alpha:0},time:0.2,timeFunction:KEY_SPLINES.LINEAR},HIDDEN:{state:{},time:0.2,timeFunction:KEY_SPLINES.LINEAR}};this.text.doStateTransition("DEFAULT",true);this.text.annotation={descType:"buff",size:{x:"dyn",y:16,offX:3},offset:{x:0,y:ig.system.height-25},content:{},index:{x:0,y:"last"}};this.text.isHelpVisible=function(){return sc.menu.buffID>=0};this.addChildGui(this.text);
this.doStateTransition("HIDDEN",true)},setText:function(a,b){b=b||0;if(b>0)this.doStateTransition("FADE_OUT",false,false,null,b);else{this.hook.currentStateName=="FADE_OUT"&&this.doStateTransition("DEFAULT",true);this.text.setText(a);a==""&&this.doStateTransition("FADE_OUT",true);this._width=a?this.text.hook.size.x+21:0}},updateDrawables:function(a){this._width&&this.ninepatch.draw(a,this._width,12,"default",2,4)}});sc.InfoBar=ig.GuiElementBase.extend({text:null,transitions:{DEFAULT:{state:{},time:0.2,
timeFunction:KEY_SPLINES.EASE},HIDDEN:{state:{offsetY:-21},time:0.2,timeFunction:KEY_SPLINES.LINEAR}},sizeTransition:null,skipRender:null,alpha:0.5,init:function(a,b,c){this.parent();this.hook.size.x=a||ig.system.width;this.hook.size.y=b||21;this.setStateValue("HIDDEN","offsetY",-this.hook.size.y);this.skipRender=c||false;this.text=new sc.TextGui("",{speed:ig.TextBlock.SPEED.IMMEDIATE});this.text.setAlign(ig.GUI_ALIGN.X_RIGHT,ig.GUI_ALIGN.Y_CENTER);this.text.setPos(8,0);this.text.hook.transitions=
{DEFAULT:{state:{},time:0.2,timeFunction:KEY_SPLINES.EASE},FADE_OUT:{state:{alpha:0},time:0.2,timeFunction:KEY_SPLINES.LINEAR},HIDDEN:{state:{},time:0.2,timeFunction:KEY_SPLINES.LINEAR}};this.text.doStateTransition("HIDDEN",true);this.addChildGui(this.text);this.doStateTransition("HIDDEN",true)},update:function(){if(this.sizeTransition){this.sizeTransition.timer=this.sizeTransition.timer+ig.system.actualTick;var a=Math.min(1,Math.max(0,this.sizeTransition.timer)/this.sizeTransition.time),a=this.sizeTransition.timeFunction.get(a);
this.hook.size.x=Math.round(this.sizeTransition.startWidth*(1-a)+this.sizeTransition.width*a);this.hook.size.y=Math.round(this.sizeTransition.startHeight*(1-a)+this.sizeTransition.height*a);if(a==1)this.sizeTransition=null}},updateDrawables:function(a){this.skipRender||a.addColor("#000000",0,0,this.hook.size.x,this.hook.size.y).setAlpha(this.alpha)},doSizeTransition:function(a,b,c,d,i){if(c)this.sizeTransition={startWidth:this.hook.size.x,width:a||0,startHeight:this.hook.size.y,height:b||0,time:c,
timeFunction:d||KEY_SPLINES.EASE,timer:0-(i||0)};else{this.hook.size.x=a;this.hook.size.y=b}},setText:function(a,b){b=b||0;if(b>0)this.text.doStateTransition("FADE_OUT",false,false,null,b);else{this.text.hook.currentStateName=="FADE_OUT"&&this.text.doStateTransition("DEFAULT",true);this.text.setText(a)}}});sc.DummyContainer=ig.GuiElementBase.extend({init:function(a){this.parent();this.setSize(ig.system.width,ig.system.height);this.setPivot(ig.system.width/2,ig.system.height/2);this.hook.clip=true;
this.addChildGui(a)}});sc.ListBoxButton=ig.FocusGui.extend({numberGfx:new ig.Image("media/gui/menu.png"),gfx:new ig.Image("media/gui/buttons.png"),button:null,data:null,_actualLineWidth:0,_width:0,blockedSound:sc.BUTTON_SOUND.denied,level:0,init:function(a,b,c,d,i,j,k,l){this.parent(true,false);b=b||1;c=c||1;i=i!=void 0?i:"";if(j){this._actualLineWidth=-1;b=b+c}else this._actualLineWidth=Math.max(0,c-22);this._width=b;this.setSize(b+c,sc.BUTTON_TYPE.ITEM.height);this.button=new sc.ButtonGui(a,b,true,
sc.BUTTON_TYPE.ITEM,l);this.button.hook.setMouseRecord(false);if(k){this.button.textChild.setAlign(ig.GUI_ALIGN.X_CENTER,ig.GUI_ALIGN.Y_CENTER);this.button.textChild.setPos(0,0)}i!=void 0&&this.setData({id:d,description:i});this.addChildGui(this.button);if(!this.constructor.PATTERN_FOCUS)this.constructor.PATTERN_FOCUS=this.gfx.createPattern(62,45,4,1,ig.ImagePattern.OPT.REPEAT_X);if(!this.constructor.PATTERN_UNFOCUS)this.constructor.PATTERN_UNFOCUS=this.gfx.createPattern(18,45,4,1,ig.ImagePattern.OPT.REPEAT_X)},
setButtonText:function(a){this.button.setText(a,true)},setLevel:function(a){this.level=a||0;this.level>0?this.setDrawCallback(function(a,b){sc.MenuHelper.drawLevel(this.level,a,b,this.numberGfx,sc.inventory.isScalable(this.data.id))}.bind(this)):this.setDrawCallback(null)},setWidth:function(a,b){a=a||1;b=b||1;this._actualLineWidth=Math.max(0,b-22);this._width=a;this.hook.size.x=a+b;this.button.hook.size.x=a},setData:function(a){if(a)this.data=a},setDrawCallback:function(a){this.button.textChild.setDrawCallback(a)},
updateDrawables:function(a){if(!(this._actualLineWidth<0)){var b=this.button.hook.size.x;if(this.focus||this.keepPressed&&this.pressed){a.addPattern(this.constructor.PATTERN_FOCUS,b,0,0,0,this._actualLineWidth,1);a.addGfx(this.gfx,b+this._actualLineWidth,0,66,45,22,1)}else{a.addPattern(this.constructor.PATTERN_UNFOCUS,b,0,0,0,this._actualLineWidth,1);a.addGfx(this.gfx,b+this._actualLineWidth,0,22,45,22,1)}}},focusGained:function(){this.focus=true;this.button.focus=true},setText:function(a){this.button.setText(a);
this.button.setWidth(this._width)},focusLost:function(){this.focus=false;this.button.focus=false},setActive:function(a){this.parent(a);this.button.setActive(a)},invokeButtonPress:function(){this.button.invokeButtonPress()}});sc.ItemBoxButton=sc.ListBoxButton.extend({amount:null,init:function(a,b,c,d,i,j,k,l,o,m,n){this.parent(a,b,c,i,j,k,l,o);if(d>=0){this.amount=new sc.NumberGui(m||99);this.amount.setNumber(d,true);this.amount.setAlign(ig.GUI_ALIGN.X_RIGHT,ig.GUI_ALIGN.Y_TOP);this.amount.setPos(5,
7);this.addChildGui(this.amount)}this.setLevel(n)}});sc.ToggleSet=ig.GuiElementBase.extend({header:null,background:null,buttons:[],set:null,init:function(a,b,c,d){this.parent();this.setSize(337,9);this.set=a;this.background=new ig.ColorGui(a.color||"darkblue");this.background.hook.localAlpha=0.2;this.background.setPos(-1,0);this.addChildGui(this.background);this.header=new sc.TextGui(ig.LangLabel.getText(a.name),{font:sc.fontsystem.tinyFont});this.header.setPos(0,1);this.addChildGui(this.header);
this.line=new ig.ColorGui("#545454",this.hook.size.x+2,1);this.line.setPos(-1,9);this.addChildGui(this.line);for(var i=a.items,j=0,k=0,b=b.buttonGroup(),l=sc.model.player,o=0,m=0;m<i.length;m++){var n=sc.inventory.getItem(i[m]);if(!(l.getItemAmount(i[m])<1)){var p=null,p=a.type==sc.TOGGLE_SET_TYPE.SINGLE?"\\i["+(l.getToggleItemState(i[m])?"toggle-item-on-radio":"toggle-item-off-radio")+"]":"\\i["+(l.getToggleItemState(i[m])?"toggle-item-on":"toggle-item-off")+"]",p=p+ig.LangLabel.getText(n.name),
n=ig.LangLabel.getText(n.description),p=new sc.ItemBoxButton(p,142,24,-1,i[m],n,true);p.set=a;p.setGui=this;p.updateToggleState=function(){var a=null,a=l.getToggleItemState(this.data.id),a=this.set.type==sc.TOGGLE_SET_TYPE.SINGLE?"\\i["+(a?"toggle-item-on-radio":"toggle-item-off-radio")+"]":"\\i["+(a?"toggle-item-on":"toggle-item-off")+"]",a=a+sc.inventory.getItemName(this.data.id);this.setText(a)};p.button.submitSound=null;p.setPos(j*168,k*20+11);this.addChildGui(p);this.buttons.push(p);b.addFocusGui(p,
j,k+c);j++;if(j>=2){j=0;k++}o++}}d.counter=o;this.hook.size.y=Math.ceil(o/2)*20+15;this.background.setSize(this.hook.size.x+2,Math.ceil(o/2)*20+15)},updateTogglesStates:function(a){for(var b=this.buttons.length;b--;)a!=this.buttons[b]&&this.buttons[b].updateToggleState();if(a){b=new sc.ItemMenuToggleAnimation(function(){a.updateToggleState()}.bind(this),a.set.type==sc.TOGGLE_SET_TYPE.SINGLE);a.addChildGui(b)}}});var d=[0,1,2,3,4],c=[5,6,7,8,9];sc.ItemMenuToggleAnimation=ig.GuiElementBase.extend({gfx:new ig.Image("media/gui/menu.png"),
timer:0,index:0,callback:null,radio:false,frames:null,init:function(a,b){this.parent();this.setPos(5,1);this.setSize(16,16);this.timer=0.02;this.callback=a;this.frames=(this.radio=b||false)?c:d},update:function(){this.timer=this.timer-ig.system.actualTick;if(this.timer<=0){this.timer=0.02;if(this.index==this.frames.length-1){this.callback&&this.callback();this.remove()}else this.index=(this.index+1)%this.frames.length}},updateDrawables:function(a){a.addGfx(this.gfx,0,0,656,352+this.frames[this.index]*
16,16,15)}});sc.SimpleStatusDisplay=ig.GuiElementBase.extend({gfx:new ig.Image("media/gui/menu.png"),name:"nope.",lineID:0,iconID:0,usePercent:false,iconIndex:Vec2.createC(0,0),currentValueGui:null,changeValueGui:null,nameGui:null,arrowGui:null,percentCurrentGui:null,percentChangeGui:null,simpleMode:false,noPercentMode:false,stayWhite:false,transitions:{DEFAULT:{state:{},time:0.2,timeFunction:KEY_SPLINES.LINEAR},HIDDEN:{state:{alpha:0},time:0.2,timeFunction:KEY_SPLINES.LINEAR}},width:0,init:function(a,
b,c,d,i,j,k,l){this.parent();this.setSize(k||169,11);this.width=this.hook.size.x;this.name=a||"nope.";this.lineID=b||0;this.iconID=c||0;this.usePercent=d||false;this.simpleMode=j||false;this.noPercentMode=l||false;this.iconIndex.x=this.iconID%sc.MODIFIER_ICON_DRAW.MAX_PER_ROW;this.iconIndex.y=Math.floor(this.iconID/sc.MODIFIER_ICON_DRAW.MAX_PER_ROW);this.nameGui=new sc.TextGui(a,{speed:ig.TextBlock.SPEED.IMMEDIATE,font:sc.fontsystem.tinyFont});this.nameGui.setPos(sc.MODIFIER_ICON_DRAW.SIZE+2,3);this.addChildGui(this.nameGui);
if(this.noPercentMode){this.changeValueGui=new ig.ImageGui(this.gfx,112,320,24,8);this.changeValueGui.setAlign(ig.GUI_ALIGN.X_RIGHT,ig.GUI_ALIGN.Y_TOP);this.changeValueGui.setPos(3,1);this.changeValueGui.hook.transitions={DEFAULT:{state:{},time:0.1,timeFunction:KEY_SPLINES.LINEAR},FADE:{state:{alpha:0},time:0.2,timeFunction:KEY_SPLINES.LINEAR},HIDDEN:{state:{alpha:0},time:0.2,timeFunction:KEY_SPLINES.LINEAR}};this.changeValueGui.doStateTransition("DEFAULT",true);this.addChildGui(this.changeValueGui)}else{if(!this.simpleMode){this.currentValueGui=
new sc.NumberGui(i,{signed:true,transitionTime:0.2});this.currentValueGui.setAlign(ig.GUI_ALIGN.X_RIGHT,ig.GUI_ALIGN.Y_TOP);this.currentValueGui.setPos(this.usePercent?63:54,4);this.addChildGui(this.currentValueGui);if(this.usePercent){this.percentCurrentGui=new sc.PercentChar;this.percentCurrentGui.setAlign(ig.GUI_ALIGN.X_RIGHT,ig.GUI_ALIGN.Y_TOP);this.percentCurrentGui.setPos(54,4);this.addChildGui(this.percentCurrentGui)}this.arrowGui=new ig.ImageGui(this.gfx,1,321,4,6);this.arrowGui.setAlign(ig.GUI_ALIGN.X_RIGHT,
ig.GUI_ALIGN.Y_TOP);this.arrowGui.setPos(47,5);this.arrowGui.hook.transitions={DEFAULT:{state:{},time:0.1,timeFunction:KEY_SPLINES.LINEAR},FADE:{state:{alpha:0},time:0.2,timeFunction:KEY_SPLINES.LINEAR},HIDDEN:{state:{alpha:0},time:0.2,timeFunction:KEY_SPLINES.LINEAR}};this.arrowGui.doStateTransition("HIDDEN",true);this.addChildGui(this.arrowGui)}this.changeValueGui=new sc.NumberGui(i,{signed:true,showPlus:true,transitionTime:0});this.changeValueGui.setAlign(ig.GUI_ALIGN.X_RIGHT,ig.GUI_ALIGN.Y_TOP);
this.changeValueGui.setPos(this.usePercent?12:3,4);this.changeValueGui.hook.transitions={DEFAULT:{state:{},time:0.1,timeFunction:KEY_SPLINES.LINEAR},FADE:{state:{alpha:0},time:0.2,timeFunction:KEY_SPLINES.LINEAR},HIDDEN:{state:{alpha:0},time:0.2,timeFunction:KEY_SPLINES.LINEAR}};this.changeValueGui.doStateTransition("HIDDEN",true);this.addChildGui(this.changeValueGui);if(this.usePercent){this.percentChangeGui=new sc.PercentChar;this.percentChangeGui.setAlign(ig.GUI_ALIGN.X_RIGHT,ig.GUI_ALIGN.Y_TOP);
this.percentChangeGui.setPos(3,4);this.addChildGui(this.percentChangeGui);this.percentChangeGui.doStateTransition("HIDDEN",true)}}},setCurrentValue:function(a,b){if(!this.noPercentMode&&!this.simpleMode){a=a||0;a=this.usePercent?Math.round(a*100)-100:a;this.currentValueGui.setNumber(a,b)}},setChangeValue:function(a,b,c){if(this.noPercentMode)this.changeValueGui.offsetY=a<=-1?312:a>=1?304:320;else if(a){a=a||0;a=this.usePercent?Math.round(a*100):a;c=0;this.stayWhite||(c=a>0?sc.GUI_NUMBER_COLOR.GREEN:
a<0?sc.GUI_NUMBER_COLOR.RED:sc.GUI_NUMBER_COLOR.WHITE);this.changeValueGui.setNumber(a,b);this.changeValueGui.setColor(c);this.changeValueGui.doStateTransition("DEFAULT",true);this.simpleMode||this.arrowGui.doStateTransition("DEFAULT",true);if(this.usePercent){this.percentChangeGui.state=c;this.percentChangeGui.doStateTransition("DEFAULT",true)}}else if(c){this.changeValueGui.doStateTransition("DEFAULT",true);this.changeValueGui.setNumber(0,b);this.changeValueGui.setColor(0);if(this.usePercent){this.percentChangeGui.state=
0;this.percentChangeGui.doStateTransition("DEFAULT",true)}}else{this.changeValueGui.doStateTransition("HIDDEN",true);this.simpleMode||this.arrowGui.doStateTransition("HIDDEN",true);this.usePercent&&this.percentChangeGui.doStateTransition("HIDDEN",true)}},fadeChangeValues:function(a){if(!this.noPercentMode){a=a||0;this.changeValueGui.doStateTransition("FADE",false,false,null,a);this.simpleMode||this.arrowGui.doStateTransition("FADE",false,false,null,a);this.usePercent&&this.percentChangeGui.doStateTransition("FADE",
false,false,null,a)}},updateDrawables:function(b){var c=0,d=this.lineID*12;if(this.noPercentMode){a.x=this.simpleMode?144:0;a.y=(this.simpleMode?408:329)+d;b.addGfx(this.gfx,0,0,a.x,a.y,72,11);b.addGfx(this.gfx,72,0,a.x+11,a.y,9,11);b.addGfx(this.gfx,81,10,a.x+81,a.y,this.simpleMode?46:89,11)}else b.addGfx(this.gfx,0,0,this.simpleMode?144:0,(this.simpleMode?408:329)+d,this.width,11);c=this.iconIndex.x*(sc.MODIFIER_ICON_DRAW.SIZE+1);d=this.iconIndex.y*(sc.MODIFIER_ICON_DRAW.SIZE+1);b.addGfx(this.gfx,
0,0,sc.MODIFIER_ICON_DRAW.X+c,sc.MODIFIER_ICON_DRAW.Y+d,sc.MODIFIER_ICON_DRAW.SIZE,sc.MODIFIER_ICON_DRAW.SIZE)}});sc.PercentChar=ig.GuiElementBase.extend({transitions:{DEFAULT:{state:{},time:0.1,timeFunction:KEY_SPLINES.LINEAR},FADE:{state:{alpha:0},time:0.2,timeFunction:KEY_SPLINES.LINEAR},HIDDEN:{state:{alpha:0},time:0.2,timeFunction:KEY_SPLINES.LINEAR}},gfx:new ig.Image("media/gui/menu.png"),state:0,init:function(){this.parent();this.setSize(8,8)},updateDrawables:function(a){a.addGfx(this.gfx,
0,0,this.state*9,407,8,8)}});sc.MenuPanel=ig.BoxGui.extend({ninepatch:new ig.NinePatch("media/gui/menu.png",{width:5,height:5,left:5,top:5,right:5,bottom:5,offsets:{"top-left":{x:100,y:425},"top-right":{x:116,y:425},"bottom-left":{x:544,y:465},"top-left-dark":{x:100,y:441},"top-right-dark":{x:116,y:441},"top-right-darker":{x:33,y:288},square:{x:88,y:496}}}),sizeTransition:null,init:function(a){this.parent();a=a||sc.MenuPanelType.TOP_LEFT_EDGE;switch(a){case sc.MenuPanelType.TOP_LEFT_EDGE:this.currentTileOffset=
"top-left";break;case sc.MenuPanelType.TOP_RIGHT_EDGE:this.currentTileOffset="top-right";break;case sc.MenuPanelType.TOP_LEFT_EDGE_DARK:this.currentTileOffset="top-left-dark";break;case sc.MenuPanelType.TOP_RIGHT_EDGE_DARK:this.currentTileOffset="top-right-dark";break;case sc.MenuPanelType.TOP_RIGHT_EDGE_DARKER:this.currentTileOffset="top-right-darker";break;case sc.MenuPanelType.BOTTOM_LEFT_EDGE:this.currentTileOffset="bottom-left";break;case sc.MenuPanelType.BOTTOM_RIGHT_EDGE:this.currentTileOffset=
"bottom-left";this.flipped=true;break;case sc.MenuPanelType.SQUARE:this.currentTileOffset="square"}},update:function(){if(this.sizeTransition){this.sizeTransition.timer=this.sizeTransition.timer+ig.system.actualTick;var a=Math.min(1,Math.max(0,this.sizeTransition.timer)/this.sizeTransition.time),a=this.sizeTransition.timeFunction.get(a);this.hook.size.x=Math.ceil(this.sizeTransition.startWidth*(1-a)+this.sizeTransition.width*a);this.hook.size.y=Math.ceil(this.sizeTransition.startHeight*(1-a)+this.sizeTransition.height*
a);if(a==1)this.sizeTransition=null}},doSizeTransition:function(a,b,c,d,i){this.sizeTransition={startWidth:this.hook.size.x,width:a||0,startHeight:this.hook.size.y,height:b||0,time:c,timeFunction:d||KEY_SPLINES.LINEAR,timer:0-(i||0)}}});sc.HeaderMenuPanel=sc.MenuPanel.extend({headerPatch:new ig.NinePatch("media/gui/menu.png",{width:2,height:0,left:1,top:9,right:5,bottom:0,offsets:{"default":{x:96,y:408}}}),header:null,title:"",init:function(a,b){this.parent(b);this.title=a||"";this.header=new sc.TextGui(this.title,
{font:sc.fontsystem.tinyFont,speed:ig.TextBlock.SPEED.IMMEDIATE});this.header.setPos(2,1);this.addChildGui(this.header)},updateDrawables:function(a){this.parent(a);this.headerPatch.draw(a,this.hook.size.x,9,"default")},removeAllChildren:function(){this.hook.removeAllChildren();this.addChildGui(this.header)}});sc.MenuScanLines=ig.GuiElementBase.extend({gfx:new ig.Image("media/gui/menu.png"),init:function(){this.parent();if(!this.constructor.PATTERN)this.constructor.PATTERN=this.gfx.createPattern(88,
475,16,16,ig.ImagePattern.OPT.REPEAT_Y)},updateDrawables:function(a){a.addDraw().setPattern(this.constructor.PATTERN,0,0,0,0,this.hook.size.x,this.hook.size.y)}});sc.ScrollPane=ig.GuiElementBase.extend({box:null,scrollType:sc.ScrollType.Y_ONLY,scrollbarV:null,scrollbarH:null,showTopBar:true,showBottomBar:true,init:function(a){this.parent();this.scrollType=a||sc.ScrollType.BOTH;this.box=new sc.ScrollPane.Container;this.box.setPos(0,1);this.addChildGui(this.box);if(this.scrollType!=sc.ScrollType.X_ONLY){this.scrollbarV=
new sc.Slider;this.scrollbarV.setAlign(ig.GUI_ALIGN.X_RIGHT,ig.GUI_ALIGN.Y_TOP);this.scrollbarV.setPos(1,2);this.scrollbarV.setSize(2,this.hook.size.y-4-(this.scrollType==sc.ScrollType.BOTH?3:0));this.addChildGui(this.scrollbarV)}if(this.scrollType!=sc.ScrollType.Y_ONLY){this.scrollbarH=new sc.Slider(false);this.scrollbarH.setAlign(ig.GUI_ALIGN.X_LEFT,ig.GUI_ALIGN.Y_BOTTOM);this.scrollbarH.setPos(1,2);this.scrollbarH.setSize(this.hook.size.x-(this.scrollType==sc.ScrollType.BOTH?5:0),2);this.addChildGui(this.scrollbarH)}},
setContent:function(a){this.box.removeAllChildren();this.box.addChildGui(a);this.recalculateScrollBars()},scrollX:function(a,c){if(this.scrollType!=sc.ScrollType.Y_ONLY){this.scrollbarH.addValue(a,c);this.box.doScrollTransition(-this.scrollbarH.value,this.scrollbarV?-this.scrollbarV.value:0,c?0:0.1,b)}},scrollY:function(a,c,d,h){if(this.scrollType!=sc.ScrollType.X_ONLY){this.scrollbarV.addValue(a,c);this.box.doScrollTransition(this.scrollbarH?-this.scrollbarH.value:0,-this.scrollbarV.value,c?0:d||
0.1,h||b)}},setScrollY:function(a,c,d,h){this.scrollbarV.setValue(a,c);this.box.doScrollTransition(this.scrollbarH?-this.scrollbarH.value:0,-this.scrollbarV.value,c?0:d||0.1,h||b)},recalculateScrollBars:function(a){if(!(this.box.hook.children.length<=0))if(this.scrollType==sc.ScrollType.BOTH){this.recalculateBar(this.box.hook.size.x,this.box.getContentWidth(),this.scrollbarH,a);this.recalculateBar(this.box.hook.size.y,this.box.getContentHeight(),this.scrollbarV,a)}else this.scrollType==sc.ScrollType.Y_ONLY?
this.recalculateBar(this.box.hook.size.y,this.box.getContentHeight(),this.scrollbarV,a):this.recalculateBar(this.box.hook.size.x,this.box.getContentWidth(),this.scrollbarH,a)},recalculateBar:function(a,b,c,d){c&&c.setMinMaxValue(0,Math.max(0,b-a),d)},updateDrawables:function(a){this.showTopBar&&a.addColor("#7E7E7E",0,0,this.hook.size.x*ig.system.scale,1);this.showBottomBar&&a.addColor("#7E7E7E",0,this.hook.size.y-1,this.hook.size.x*ig.system.scale,1)},setSize:function(a,b){this.parent(a,b);this.box.hook.size.x=
this.hook.size.x-(this.scrollType!=sc.ScrollType.X_ONLY?3:0);this.box.hook.size.y=this.hook.size.y-2-(this.scrollType!=sc.ScrollType.Y_ONLY?4:0);this.scrollbarV&&this.scrollbarV.setSize(2,this.hook.size.y-4-(this.scrollType==sc.ScrollType.BOTH?3:0));this.scrollbarH&&this.scrollbarH.setSize(this.hook.size.x-(this.scrollType==sc.ScrollType.BOTH?5:0),2);this.recalculateScrollBars()},getScrollY:function(){return-this.box.hook.scroll.y}});sc.Slider=ig.GuiElementBase.extend({offset:Vec2.createC(0,0),inset:{top:0,
right:0,bottom:0,left:0},minValue:0,maxValue:0,value:0,vertical:true,scaleThumb:true,prefWidth:0,prefHeight:0,thumb:null,init:function(a,b,c){this.parent();this.vertical=a!=void 0?a:true;this.thumb=b||new sc.Slider.Thumb;this.scaleThumb=c==void 0?true:c;this.addChildGui(this.thumb)},updateDrawables:function(a){a.addColor("#1A1A1A",0,0,this.hook.size.x*ig.system.scale,this.hook.size.y*ig.system.scale)},range:function(a){if(this.minValue<this.maxValue)if(a<this.minValue)a=this.minValue;else{if(a>this.maxValue)a=
this.maxValue}else if(a>this.minValue)a=this.minValue;else if(a<this.maxValue)a=this.maxValue;return a},calcThumbArea:function(){return this.vertical?Math.max(1,this.hook.size.y-(this.prefHeight||4)):Math.max(1,this.hook.size.x-(this.prefWidth||4))},setThumbPos:function(a){var c=this.maxValue-this.minValue,d=(this.vertical?this.prefHeight:this.prefWidth)||4;if(this.scaleThumb)var h=Math.max(1,this.vertical?this.getHeight():this.getWidth()),d=Math.floor(Math.max(d,h*(h/(h+c))));h=Math.max(1,(this.vertical?
this.getHeight():this.getWidth())-d);c=(c!=0?Math.floor((this.value-this.minValue)*h/c):0)+(this.vertical?this.inset.top:this.inset.left);if(this.vertical){this.thumb.setSize(this.prefWidth||this.hook.size.x,d);this.thumb.doPosTranstition(this.offset.x,c,a?0:0.1,b)}else{this.thumb.setSize(d,this.prefHeight||this.hook.size.y);this.thumb.doPosTranstition(c,this.offset.y,a?0:0.1,b)}},setPreferredThumbSize:function(a,b){this.prefWidth=a||4;this.prefHeight=b||4},addValue:function(a,b){this.setValue(this.value+
a,b)},setValue:function(a,b){a=this.range(a);if(this.value!=a||b){this.value=a;this.setThumbPos(b)}},setMinMaxValue:function(a,b,c){if(b<a)throw Error("max value can never less then min in ScrollBar!");this.minValue=a;this.maxValue=b;this.value=this.range(this.value);this.setThumbPos(c)},getRange:function(){return Math.abs(this.maxValue-this.minValue)},getWidth:function(){return this.hook.size.x-this.inset.right-this.inset.left},getHeight:function(){return this.hook.size.y-this.inset.bottom}});sc.Slider.Thumb=
ig.GuiElementBase.extend({updateDrawables:function(a){a.addColor("#7E7E7E",0,0,this.hook.size.x*ig.system.scale,this.hook.size.y*ig.system.scale)}});sc.ScrollPane.Container=ig.GuiElementBase.extend({scrollIndex:0,init:function(){this.parent();this.hook.clip=true},getContentWidth:function(){return this.hook.children.length<=0?0:this.hook.children[this.scrollIndex].size.x},getContentHeight:function(){return this.hook.children.length<=0?0:this.hook.children[this.scrollIndex].size.y}});sc.TimeAndMoneyGUI=
sc.MenuPanel.extend({gfx:new ig.Image("media/gui/message.png"),timeGfx:new ig.Image("media/gui/basic.png"),transitions:{DEFAULT:{state:{},time:0.2,timeFunction:KEY_SPLINES.EASE},DEFAULT_FAST:{state:{},time:0.1,timeFunction:KEY_SPLINES.EASE_OUT},HIDDEN:{state:{offsetX:-136},time:0.2,timeFunction:KEY_SPLINES.LINEAR},HIDDEN_FAST:{state:{offsetX:-136},time:0.1,timeFunction:KEY_SPLINES.EASE_OUT}},credit:null,timeSec:null,timeMin:null,timeHour:null,_lastSec:-1,_lastMin:-1,_lastHour:-1,init:function(){this.parent(sc.MenuPanelType.TOP_RIGHT_EDGE);
this.setSize(136,33);this.setAlign(ig.GUI_ALIGN.X_LEFT,ig.GUI_ALIGN.Y_BOTTOM);sc.Model.addObserver(sc.model.player,this);var a=new sc.TextGui(ig.lang.get("sc.gui.menu.credits"),{font:sc.fontsystem.tinyFont});a.setPos(5,8);this.addChildGui(a);a=new sc.TextGui(ig.lang.get("sc.gui.menu.playtime"),{font:sc.fontsystem.tinyFont});a.setPos(5,21);this.addChildGui(a);this.credit=new sc.NumberGui(9999999);this.credit.setNumber(sc.model.player.credit);this.credit.setAlign(ig.GUI_ALIGN.X_RIGHT,ig.GUI_ALIGN.Y_TOP);
this.credit.setPos(24,7);this.addChildGui(this.credit);this.timeSec=new sc.NumberGui(99,{leadingZeros:2});this.timeSec.setAlign(ig.GUI_ALIGN.X_RIGHT,ig.GUI_ALIGN.Y_TOP);this.timeSec.setPos(8,20);this.addChildGui(this.timeSec);this.timeMin=new sc.NumberGui(99,{leadingZeros:2});this.timeMin.setAlign(ig.GUI_ALIGN.X_RIGHT,ig.GUI_ALIGN.Y_TOP);this.timeMin.setPos(32,20);this.addChildGui(this.timeMin);this.timeHour=new sc.NumberGui(999,{leadingZeros:3});this.timeHour.setAlign(ig.GUI_ALIGN.X_RIGHT,ig.GUI_ALIGN.Y_TOP);
this.timeHour.setPos(56,20);this.addChildGui(this.timeHour);this.doStateTransition("HIDDEN",true)},updateCredit:function(){this.credit.setNumber(sc.model.player.credit)},update:function(){var a=sc.stats.getMap("player","playtime"),b=Math.floor(a)%60;if(b!=this._lastSec){this.timeSec.setNumber(b,true);this._lastSec=b}b=Math.floor(a/60)%60;if(b!=this._lastMin){this.timeMin.setNumber(b,true);this._lastMin=b}b=Math.floor(a/60/60);if(b!=this._lastHour){this.timeHour.setNumber(b,true);this._lastHour=b}},
updateDrawables:function(a){this.parent(a);a.addGfx(this.gfx,this.hook.size.x-10-8,7,0,88,10,8);a.addGfx(this.timeGfx,107,21,107,1,3,7);a.addGfx(this.timeGfx,82,21,107,1,3,7)},modelChanged:function(a,b){a==sc.model.player&&b==sc.PLAYER_MSG.CREDIT_CHANGE&&this.credit.setNumber(sc.model.player.credit)}})});ig.baked=!0;
ig.module("game.feature.version.gui.changelog-gui").requires("impact.base.image","impact.base.event","impact.feature.gui.gui","impact.feature.gui.base.basic-gui","impact.feature.interact.button-interact","game.feature.control.control","game.feature.gui.base.button","game.feature.gui.base.boxes","game.feature.gui.base.numbers","game.feature.menu.gui.menu-misc").defines(function(){function b(a){return a.indexOf("+")==0?0:a.indexOf("~")==0?3:a.indexOf("-")==0?6:9}sc.ChangeLogScrollContainer=ig.GuiElementBase.extend({scrollPane:null,
content:null,init:function(){this.parent();this.content=new ig.GuiElementBase;this.scrollPane=new sc.ScrollPane(sc.ScrollType.Y_ONLY);this.scrollPane.setContent(this.content);this.scrollPane.showTopBar=false;this.scrollPane.showBottomBar=false;this.addChildGui(this.scrollPane)},setElement:function(a){this.content.removeAllChildren();this.content.hook.size.y=0;this.scrollPane.box.doScrollTransition(0,0,0);this.scrollPane.recalculateScrollBars(true);this.content.addChildGui(a);this._updateContentHeight()},
scroll:function(a,b){this.scrollPane.scrollY(a,b,0.05)},getScrollY:function(){return this.scrollPane.getScrollY()},clear:function(){this.content.removeAllChildren();this.content.hook.size.y=0;this.scrollPane.box.doScrollTransition(0,0,0);this.scrollPane.recalculateScrollBars(true)},setSize:function(a,b){this.parent(a,b);this.scrollPane.setSize(a,b)},_updateContentHeight:function(){var a=this.content.hook.children,a=a[a.length-1];this.content.hook.size.y=a.pos.y+a.size.y;this.scrollPane.recalculateScrollBars()}});
sc.PrevNextText=ig.GuiElementBase.extend({transitions:{DEFAULT:{state:{alpha:1},time:0.2,timeFunction:KEY_SPLINES.LINEAR},HIDDEN:{state:{alpha:0},time:0.2,timeFunction:KEY_SPLINES.LINEAR}},icon:null,text:null,active:true,init:function(a,b,c){this.parent();this.icon=new sc.TextGui(b);this.text=new sc.TextGui(a,{font:sc.fontsystem.tinyFont});this.text.setAlign(ig.GUI_ALIGN.X_LEFT,ig.GUI_ALIGN.Y_BOTTOM);this.icon.setPos(c?this.text.hook.size.x+2:0,0);this.text.setPos(c?0:this.icon.hook.size.x,2);this.setSize(this.icon.hook.size.x+
this.text.hook.size.x+(c?2:0),17);this.addChildGui(this.icon);this.addChildGui(this.text)}});sc.ChangelogGui=ig.GuiElementBase.extend({transitions:{DEFAULT:{state:{alpha:1},time:0.2,timeFunction:KEY_SPLINES.EASE_OUT},HIDDEN:{state:{alpha:0},time:0.3,timeFunction:KEY_SPLINES.EASE_IN}},msgBox:null,content:null,back:null,browseLeft:null,browserRight:null,scrollContainer:null,header:null,compiledButton:null,buttonInteract:null,buttonGroup:null,compiledMode:false,compileList:[],compileEntry:null,logs:[],
currentIndex:null,init:function(){this.parent();this.hook.localAlpha=0.8;this.hook.size.x=ig.system.width;this.hook.size.y=ig.system.height;this.buttonInteract=new ig.ButtonInteractEntry;this.buttonGroup=new sc.ButtonGroup(false,ig.BUTTON_GROUP_SELECT_TYPE.HORIZONTAL);this.buttonInteract.pushButtonGroup(this.buttonGroup);this.content=new ig.GuiElementBase;this.content.setSize(300,240);this.createContent();this.msgBox=new sc.CenterBoxGui(this.content);this.msgBox.setAlign(ig.GUI_ALIGN.X_CENTER,ig.GUI_ALIGN.Y_CENTER);
this.msgBox.setPos(0,-10);this.addChildGui(this.msgBox);this.back=new sc.ButtonGui("\\i[back]Back",sc.BUTTON_DEFAULT_WIDTH);this.back.setAlign(ig.GUI_ALIGN.X_CENTER,ig.GUI_ALIGN.Y_CENTER);this.back.setPos(sc.BUTTON_DEFAULT_WIDTH/2+4,122+this.back.hook.size.y-10);this.back.submitSound=sc.BUTTON_SOUND.back;this.back.onButtonPress=function(){this.hideLog()}.bind(this);this.addChildGui(this.back);this.buttonInteract.addGlobalButton(this.back,this.onBackButtonCheck.bind(this));this.compiledButton=new sc.ButtonGui("\\i[help]Show Newest",
sc.BUTTON_DEFAULT_WIDTH);this.compiledButton.setAlign(ig.GUI_ALIGN.X_CENTER,ig.GUI_ALIGN.Y_CENTER);this.compiledButton.setPos(-sc.BUTTON_DEFAULT_WIDTH/2-4,122+this.back.hook.size.y-10);this.compiledButton.onButtonPress=function(){this.onToggleCompileMode()}.bind(this);this.addChildGui(this.compiledButton);this.buttonInteract.addGlobalButton(this.compiledButton,this.onCompileButtonCheck.bind(this));this.doStateTransition("HIDDEN",true)},showLog:function(){ig.interact.addEntry(this.buttonInteract);
ig.interact.setBlockDelay(0.2);this.compiledMode=false;this.createLogEntries();this.doStateTransition("DEFAULT")},hideLog:function(){ig.interact.removeEntry(this.buttonInteract);ig.interact.setBlockDelay(0.2);this.doStateTransition("HIDDEN")},clearLogs:function(){this.compileEntry=null;this.scrollContainer.clear()},setHeaderText:function(a,b){this.compiledMode?this.header.setText("Updates since last Login - "+b):this.header.setText("v"+b+" ["+a+"]")},update:function(){if(!ig.interact.isBlocked()){sc.control.menuScrollUp()?
this.scrollContainer.scroll(-20):sc.control.menuScrollDown()&&this.scrollContainer.scroll(20);sc.control.downDown()?this.scrollContainer.scroll(200*ig.system.tick):sc.control.upDown()&&this.scrollContainer.scroll(-200*ig.system.tick)}},updateDrawables:function(a){a.addColor("#000",0,0,this.hook.size.x,this.hook.size.y)},onBackButtonCheck:function(){return sc.control.menuBack()},onCompileButtonCheck:function(){return sc.control.menuHotkeyHelp()},onToggleCompileMode:function(){if(this.compiledMode){this.compiledMode=
false;this.compiledButton.textChild.setText("\\i[help]Show Newest");this.currentIndex=0;this.setLogEntry(this.logs[0])}else{this.compiledButton.textChild.setText("\\i[help]Show History");this.compiledMode=true;this.setCompiledList();this.browseLeft.doStateTransition("HIDDEN",true);this.browserRight.doStateTransition("HIDDEN",true)}},onLeftPressed:function(){var a=this.currentIndex;this.currentIndex++;if(this.currentIndex>=this.logs.length-1)this.currentIndex=this.logs.length-1;a!=this.currentIndex&&
this.setLogEntry(this.logs[this.currentIndex])},onRightPressed:function(){var a=this.currentIndex;this.currentIndex--;if(this.currentIndex<=0)this.currentIndex=0;a!=this.currentIndex&&this.setLogEntry(this.logs[this.currentIndex])},setCompiledList:function(){var a=sc.version.getLogsBetweenVersions(this.compileList);if(!this.compileEntry){var d={};if(a.length==0){a.push(sc.version.changelog[0]);d.version="[v"+a[0].version+"]"}else d.version=a.length==1?"[v"+a[0].version+"]":"[v"+a[a.length-1].version+
" - v"+a[0].version+"]";d.fixes=[];d.changes=[];for(var c=null,e=0,f=0,f=0;f<a.length;f++){if(c=a[f].fixes)for(e=0;e<c.length;e++)d.fixes.push(c[e]);if(c=a[f].changes)for(e=0;e<c.length;e++)d.changes.push(c[e])}d.changes.length==0?d.changes=null:d.changes.sort(function(a,c){return b(a)-b(c)}.bind(this));this.compileEntry=d}this.setLogEntry(this.compileEntry)},setLogEntry:function(a){if(a){var b=new ig.GuiElementBase;b.hook.size.x=296;var c=null,e=0,f=0;this.setHeaderText(a.name,a.version);if(a.fixes){e=
this.createHeaderEntry(b,e,"Bug Fixes",sc.FONT_COLORS.RED);c=a.fixes;for(f=0;f<c.length;f++)e=this.createTextEntry(b,e,c[f],true)}if(a.changes){e=this.createHeaderEntry(b,e,"Changes",sc.FONT_COLORS.PURPLE);c=a.changes;for(f=0;f<c.length;f++)e=this.createTextEntry(b,e,c[f])}b.hook.size.y=e;this.scrollContainer.setElement(b);this.currentIndex>=this.logs.length-1?this.browseLeft.doStateTransition("HIDDEN",true):this.browseLeft.doStateTransition("DEFAULT",true);this.currentIndex==0?this.browserRight.doStateTransition("HIDDEN",
true):this.browserRight.doStateTransition("DEFAULT",true)}},createHeaderEntry:function(a,b,c,e,f){c=new sc.TextGui("\\c["+e+"]"+c+"\\c[0]");f&&c.setAlign(ig.GUI_ALIGN.X_CENTER,ig.GUI_ALIGN.Y_TOP);f=new ig.ColorGui("#7E7E7E",296,1);c.setPos(2,b);b=b+(c.hook.size.y+2-2);f.setPos(0,b);b=b+3;a.addChildGui(c);a.addChildGui(f);return b},createTextEntry:function(a,b,c,e){var f=0,g="+";if(e)g="~";else if(c.indexOf("+")==0)f=sc.FONT_COLORS.GREEN;else if(c.indexOf("~")==0){g="~";f=sc.FONT_COLORS.PURPLE}else if(c.indexOf("-")==
0){g="-";f=sc.FONT_COLORS.RED}else{e=true;g="~"}g=new sc.TextGui("\\c["+f+"]"+g+"\\c[0]");g.setPos(4,b);c=new sc.TextGui("\\c["+f+"]"+(e?c:c.substring(2))+"\\c[0]",{maxWidth:280});c.setPos(15,b);a.addChildGui(g);a.addChildGui(c);return b=b+c.hook.size.y},createLogEntries:function(){this.currentIndex=0;this.setLogEntry(this.logs[0])},createContent:function(){var a=2;this.logs=sc.version.changelog;this.header=new sc.TextGui("Changelog - "+sc.version.toString());this.header.setAlign(ig.GUI_ALIGN.X_CENTER,
ig.GUI_ALIGN.Y_TOP);this.header.setPos(0,a);this.content.addChildGui(this.header);var a=a+(this.header.hook.size.y+2),b=new sc.LineGui(300);b.setAlign(ig.GUI_ALIGN.X_CENTER,ig.GUI_ALIGN.Y_TOP);b.setPos(0,a);this.content.addChildGui(b);a=a+1;this.browseLeft=new sc.PrevNextText("Previous Log","\\i[circle-left]",false);this.browseLeft.setAlign(ig.GUI_ALIGN.X_LEFT,ig.GUI_ALIGN.Y_BOTTOM);this.browseLeft.setPos(-2,-2);this.browseLeft.doStateTransition("HIDDEN",true);this.browseLeft.invokeButtonPress=this.onLeftPressed.bind(this);
this.content.addChildGui(this.browseLeft);this.browserRight=new sc.PrevNextText("Next Log","\\i[circle-right]",true);this.browserRight.setAlign(ig.GUI_ALIGN.X_RIGHT,ig.GUI_ALIGN.Y_BOTTOM);this.browserRight.setPos(-4,-2);this.browserRight.doStateTransition("HIDDEN",true);this.browserRight.invokeButtonPress=this.onRightPressed.bind(this);this.content.addChildGui(this.browserRight);this.buttonInteract.addGlobalButton(this.browseLeft,function(){return sc.control.menuCircleLeft()});this.buttonInteract.addGlobalButton(this.browserRight,
function(){return sc.control.menuCircleRight()});this.scrollContainer=new sc.ChangeLogScrollContainer;this.scrollContainer.setPos(0,a);this.scrollContainer.setSize(301,202);a=a+this.scrollContainer.hook.size.y;b=new sc.LineGui(300);b.setAlign(ig.GUI_ALIGN.X_CENTER,ig.GUI_ALIGN.Y_TOP);b.setPos(0,a);this.content.addChildGui(b);this.content.addChildGui(this.scrollContainer)}})});ig.baked=!0;
ig.module("game.feature.version.gui.dlc-gui").requires("impact.base.image","impact.base.event","impact.feature.gui.gui","impact.feature.gui.base.basic-gui","impact.feature.interact.button-interact","game.feature.control.control","game.feature.gui.base.button","game.feature.gui.base.boxes","game.feature.gui.base.numbers","game.feature.menu.gui.menu-misc").defines(function(){sc.DLCScrollContainer=ig.GuiElementBase.extend({scrollPane:null,content:null,init:function(){this.parent();this.content=new ig.GuiElementBase;
this.scrollPane=new sc.ScrollPane(sc.ScrollType.Y_ONLY);this.scrollPane.setContent(this.content);this.scrollPane.showTopBar=false;this.scrollPane.showBottomBar=false;this.addChildGui(this.scrollPane)},setElement:function(b){this.content.removeAllChildren();this.content.hook.size.y=0;this.scrollPane.box.doScrollTransition(0,0,0);this.scrollPane.recalculateScrollBars(true);this.content.addChildGui(b);this._updateContentHeight()},scroll:function(b,a){this.scrollPane.scrollY(b,a,0.05)},getScrollY:function(){return this.scrollPane.getScrollY()},
clear:function(){this.content.removeAllChildren();this.content.hook.size.y=0;this.scrollPane.box.doScrollTransition(0,0,0);this.scrollPane.recalculateScrollBars(true)},setSize:function(b,a){this.parent(b,a);this.scrollPane.setSize(b,a)},_updateContentHeight:function(){var b=this.content.hook.children,b=b[b.length-1];this.content.hook.size.y=b.pos.y+b.size.y;this.scrollPane.recalculateScrollBars()}});sc.DLCGui=ig.GuiElementBase.extend({transitions:{DEFAULT:{state:{alpha:1},time:0.2,timeFunction:KEY_SPLINES.EASE_OUT},
HIDDEN:{state:{alpha:0},time:0.3,timeFunction:KEY_SPLINES.EASE_IN}},msgBox:null,content:null,back:null,browseLeft:null,browserRight:null,scrollContainer:null,header:null,compiledButton:null,buttonInteract:null,buttonGroup:null,compiledMode:false,compileList:[],compileEntry:null,logs:[],currentIndex:null,init:function(){this.parent();this.hook.localAlpha=0.8;this.hook.size.x=ig.system.width;this.hook.size.y=ig.system.height;this.buttonInteract=new ig.ButtonInteractEntry;this.buttonGroup=new sc.ButtonGroup(false,
ig.BUTTON_GROUP_SELECT_TYPE.HORIZONTAL);this.buttonInteract.pushButtonGroup(this.buttonGroup);this.content=new ig.GuiElementBase;this.content.setSize(300,240);this.createContent();this.msgBox=new sc.CenterBoxGui(this.content);this.msgBox.setAlign(ig.GUI_ALIGN.X_CENTER,ig.GUI_ALIGN.Y_CENTER);this.msgBox.setPos(0,-10);this.addChildGui(this.msgBox);this.back=new sc.ButtonGui("\\i[back]"+ig.lang.get("sc.gui.dlc-list.back"),sc.BUTTON_DEFAULT_WIDTH);this.back.setAlign(ig.GUI_ALIGN.X_CENTER,ig.GUI_ALIGN.Y_CENTER);
this.back.setPos(0,122+this.back.hook.size.y-10);this.back.submitSound=sc.BUTTON_SOUND.back;this.back.onButtonPress=function(){this.hide()}.bind(this);this.addChildGui(this.back);this.buttonInteract.addGlobalButton(this.back,this.onBackButtonCheck.bind(this));this.doStateTransition("HIDDEN",true)},show:function(){ig.interact.addEntry(this.buttonInteract);ig.interact.setBlockDelay(0.2);this.createDLCList();this.doStateTransition("DEFAULT")},hide:function(){ig.interact.removeEntry(this.buttonInteract);
ig.interact.setBlockDelay(0.2);this.doStateTransition("HIDDEN")},clearLogs:function(){this.compileEntry=null;this.scrollContainer.clear()},update:function(){if(!ig.interact.isBlocked()){sc.control.menuScrollUp()?this.scrollContainer.scroll(-20):sc.control.menuScrollDown()&&this.scrollContainer.scroll(20);sc.control.downDown()?this.scrollContainer.scroll(200*ig.system.tick):sc.control.upDown()&&this.scrollContainer.scroll(-200*ig.system.tick)}},updateDrawables:function(b){b.addColor("#000",0,0,this.hook.size.x,
this.hook.size.y)},onBackButtonCheck:function(){return sc.control.menuBack()},createDLCList:function(){var b=ig.extensions.getExtensionList(),a=new ig.GuiElementBase;a.hook.size.x=296;for(var d=0,c=0;c<b.length;++c){c>0&&(d=d+8);var e=ig.extensions.getExtension(b[c]),d=this.createHeaderEntry(a,d,e.name,sc.FONT_COLORS.GREEN),d=this.createTextEntry(a,d,e.description,true)}a.hook.size.y=d;this.scrollContainer.setElement(a)},createHeaderEntry:function(b,a,d,c,e){d=new sc.TextGui("\\c["+c+"]"+d+"\\c[0]");
e&&d.setAlign(ig.GUI_ALIGN.X_CENTER,ig.GUI_ALIGN.Y_TOP);e=new ig.ColorGui("#7E7E7E",296,1);d.setPos(2,a);a=a+(d.hook.size.y+2-2);e.setPos(0,a);a=a+3;b.addChildGui(d);b.addChildGui(e);return a},createTextEntry:function(b,a,d){d=new sc.TextGui("\\c[0]"+d+"\\c[0]",{maxWidth:280});d.setPos(15,a);b.addChildGui(d);return a=a+d.hook.size.y},createContent:function(){var b=2;this.logs=sc.version.changelog;this.header=new sc.TextGui(ig.lang.get("sc.gui.dlc-list.title"));this.header.setAlign(ig.GUI_ALIGN.X_CENTER,
ig.GUI_ALIGN.Y_TOP);this.header.setPos(0,b);this.content.addChildGui(this.header);var b=b+(this.header.hook.size.y+2),a=new sc.LineGui(300);a.setAlign(ig.GUI_ALIGN.X_CENTER,ig.GUI_ALIGN.Y_TOP);a.setPos(0,b);this.content.addChildGui(a);b=b+1;this.scrollContainer=new sc.DLCScrollContainer;this.scrollContainer.setPos(0,b);this.scrollContainer.setSize(301,202);b=b+this.scrollContainer.hook.size.y;a=new sc.LineGui(300);a.setAlign(ig.GUI_ALIGN.X_CENTER,ig.GUI_ALIGN.Y_TOP);a.setPos(0,b);this.content.addChildGui(a);
this.content.addChildGui(this.scrollContainer)}})});ig.baked=!0;ig.module("game.feature.version.plug-in").requires("game.feature.version.version","game.feature.version.gui.changelog-gui","game.feature.version.gui.dlc-gui").defines(function(){window.wm&&wm.postLoadModules.push("game.feature.version.editors.changelog-editor")});ig.baked=!0;
ig.module("game.feature.model.base-model").defines(function(){sc.Model={addObserver:function(b,a){if(!a)throw Error("Given Observer is null!");b.observers.indexOf(a)==-1&&b.observers.push(a)},removeObserver:function(b,a){b.observers.erase(a)},notifyObserver:function(b,a,d){for(var c=0;c<b.observers.length;++c)b.observers[c].modelChanged(b,a,d)},isObserver:function(b,a){return b.observers.indexOf(a)!=-1},getMessageName:function(b,a){for(var d in b)if(b[d]==a)return d;return"INVALID"}}});ig.baked=!0;
ig.module("game.feature.gui.hud.right-hud").requires("impact.feature.gui.gui","impact.feature.gui.base.basic-gui","impact.base.image","game.feature.gui.base.boxes").defines(function(){sc.RightHudGui=ig.GuiElementBase.extend({taskTitle:null,maxCount:0,currentCount:0,variable:null,transitions:{DEFAULT:{state:{},time:0.3,timeFunction:KEY_SPLINES.EASE_OUT},HIDDEN:{state:{},time:0.3,timeFunction:KEY_SPLINES.EASE_IN},HALF:{state:{scaleX:0.5,scaleY:0.5,offsetX:-1},time:0.3,timeFunction:KEY_SPLINES.EASE_OUT}},
boxes:[],doReorder:false,init:function(){this.parent();this.setAlign(ig.GUI_ALIGN.X_RIGHT,ig.GUI_ALIGN.Y_TOP);this.hook.zIndex=101;this.hook.pauseGui=true;sc.Model.addObserver(sc.model,this);sc.Model.addObserver(sc.options,this);this.updateSize()},update:function(){if(this.doReorder){this.doReorder=false;for(var b=4,a=0;a<this.boxes.length;++a){if(!this.boxes[a].hidden){this.boxes[a].justAdded?this.boxes[a].setPos(0,b):this.boxes[a].doPosTranstition(0,b,0.3,KEY_SPLINES.EASE_OUT);b=b+(this.boxes[a].hook.size.y+
8)}this.boxes[a].justAdded=false}}},addHudBox:function(b,a){b.parentPanel=this;b.justAdded=true;b.hook.align.x=ig.GUI_ALIGN.X_RIGHT;this.boxes.erase(b);if(a===void 0){this.boxes.push(b);this.addChildGui(b)}else{this.boxes.splice(a,0,b);this.insertChildGui(b,a)}this.reorder()},addHudBoxBefore:function(b,a){var d=this.getChildGuiIndex(a);this.addHudBox(b,d==-1?void 0:d)},removeHudBox:function(b){b.parentPanel=null;this.boxes.erase(b);this.reorder()},reorder:function(){this.doReorder=true},modelChanged:function(b,
a){if(b==sc.model){var d=sc.model.isCombatMode(),c=sc.model.isCutscene();this.doPosTranstition(0,c?21:d?16:0,0.2,KEY_SPLINES.EASE_IN_OUT,!d&&!c?0.5:0)}else b==sc.options&&a==sc.OPTIONS_EVENT.OPTION_CHANGED&&this.updateSize()},updateSize:function(){sc.options.get("pixel-size")==sc.PIXEL_SIZE.ONE?this.doStateTransition("DEFAULT",true):sc.options.get("min-sidebar")?this.doStateTransition("HALF",true):this.doStateTransition("DEFAULT",true)}});sc.RightHudBoxGui=sc.SideBoxGui.extend({hidden:true,justAdded:false,
parentPanel:null,init:function(b){this.parent(true,b);this.doStateTransition("HIDDEN",true)},show:function(b,a){this.parent(b,a);if(this.hidden)this.justAdded=true;this.hidden=false;this.parentPanel&&this.parentPanel.reorder()},hide:function(b,a){this.parent(b,a);this.hidden=true;this.parentPanel&&this.parentPanel.reorder()},remove:function(){this.parent();this.parentPanel&&this.parentPanel.removeHudBox(this)}})});ig.baked=!0;
ig.module("game.feature.timers.gui.timers-hud").requires("game.feature.gui.hud.right-hud").defines(function(){sc.TimersHudEntry=ig.GuiElementBase.extend({gfx:new ig.Image("media/gui/basic.png"),millis:null,seconds:null,minutes:null,hours:null,hourPoint:null,timer:null,init:function(b){this.parent();this.setSize(80,8);this.timer=b;var b=2,a=null;if(this.timer.millis){this.millis=new sc.NumberGui(99,{leadingZeros:2});this.millis.setAlign(ig.GUI_ALIGN.X_RIGHT,ig.GUI_ALIGN.Y_TOP);this.millis.hook.transitions=
{DEFAULT:{state:{},time:0.2,timeFunction:KEY_SPLINES.LINEAR},HIDDEN:{state:{alpha:0},time:0.2,timeFunction:KEY_SPLINES.LINEAR}};this.addChildGui(this.millis);this.millis.setPos(b,0);b=b+16;a=new ig.ImageGui(this.gfx,112,0,3,8);a.setAlign(ig.GUI_ALIGN.X_RIGHT,ig.GUI_ALIGN.Y_TOP);a.setPos(b,0);b=b+3;this.addChildGui(a)}this.seconds=new sc.NumberGui(99,{leadingZeros:2});this.seconds.setAlign(ig.GUI_ALIGN.X_RIGHT,ig.GUI_ALIGN.Y_TOP);this.seconds.setPos(b,0);b=b+17;this.addChildGui(this.seconds);a=new ig.ImageGui(this.gfx,
107,0,3,8);a.setAlign(ig.GUI_ALIGN.X_RIGHT,ig.GUI_ALIGN.Y_TOP);a.setPos(b,0);b=b+4;this.addChildGui(a);this.minutes=new sc.NumberGui(99,{leadingZeros:2});this.minutes.setAlign(ig.GUI_ALIGN.X_RIGHT,ig.GUI_ALIGN.Y_TOP);this.minutes.setPos(b,0);b=b+17;this.addChildGui(this.minutes);this.hourPoint=new ig.ImageGui(this.gfx,107,0,3,8);this.hourPoint.hook.transitions={DEFAULT:{state:{},time:0.2,timeFunction:KEY_SPLINES.LINEAR},HIDDEN:{state:{alpha:0},time:0.2,timeFunction:KEY_SPLINES.LINEAR}};this.hourPoint.setAlign(ig.GUI_ALIGN.X_RIGHT,
ig.GUI_ALIGN.Y_TOP);this.hourPoint.setPos(b,0);b=b+4;this.addChildGui(this.hourPoint);this.hours=new sc.NumberGui(999,{leadingZeros:2});this.hours.hook.transitions={DEFAULT:{state:{},time:0.2,timeFunction:KEY_SPLINES.LINEAR},HIDDEN:{state:{alpha:0},time:0.2,timeFunction:KEY_SPLINES.LINEAR}};this.hours.setAlign(ig.GUI_ALIGN.X_RIGHT,ig.GUI_ALIGN.Y_TOP);this.hours.setPos(b,0);b=b+18;this.addChildGui(this.hours);this.hook.size.x=b;this.updateTime()},update:function(){!sc.model.isPaused()&&(!sc.model.isMenu()&&
!this.hidden)&&this.updateTime()},updateTime:function(){var b=0,b=this.timer.mode==sc.TIMER_TYPES.COUNTDOWN?this.timer.getRemainingTime():this.timer.timer,a=Math.floor(b*100)%100,d=Math.floor(b%60),c=Math.floor(b/60)%60,b=Math.floor(b/60/60)%60;this.millis&&this.millis.setNumber(a);this.seconds.setNumber(d);this.minutes.setNumber(c);if(b>0){this.hours.setNumber(b);this.hours.doStateTransition("DEFAULT",true);this.hourPoint.doStateTransition("DEFAULT",true)}else{this.hours.doStateTransition("HIDDEN",
true);this.hourPoint.doStateTransition("HIDDEN",true)}}});sc.TimersHud=sc.RightHudBoxGui.extend({entry:null,_cutscene:false,init:function(b,a,d){var c="";if(a)c=a;else switch(b.mode){case sc.TIMER_TYPES.COUNTER:c=ig.lang.get("sc.gui.timer-hud.counter");break;case sc.TIMER_TYPES.COUNTDOWN:c=ig.lang.get("sc.gui.timer-hud.countdown")}this.parent(c);this._cutscene=d||false;this.entry=new sc.TimersHudEntry(b);this.pushContent(this.entry,!sc.model.isCutscene());sc.Model.addObserver(sc.model,this);sc.Model.addObserver(sc.timers,
this);this.hidden&&!sc.model.isCutscene()&&this.show()},update:function(){!this.hidden&&this.contentEntries.length==0&&this.hide()},delayedRemove:function(){sc.Model.removeObserver(sc.model,this);sc.Model.removeObserver(sc.timers,this);this.remove()},modelChanged:function(b,a,d){b==sc.model?b.isReset()?this.delayedRemove():b.isCutscene()||b.isQuickMenu()||sc.quests.hasQuestSolvedDialogs()?this._cutscene?this.show():this.hide():!b.isCutscene()&&(!b.isQuickMenu()&&this.contentEntries.length>0&&!sc.quests.hasQuestSolvedDialogs())&&
this.show():b==sc.timers&&(a==sc.TIMER_EVENT.DELETED?this.entry.timer.name==d&&this.delayedRemove():a==sc.TIMER_EVENT.COUNTDOWN_DONE&&this.entry.timer.name==d.name&&d.temp&&this.delayedRemove())}})});ig.baked=!0;
ig.module("game.feature.timers.timers-model").requires("impact.base.game","game.feature.model.base-model","game.feature.timers.gui.timers-hud").defines(function(){function b(a,b){var c="0000"+Math.floor(a);return c.length>=4+b?Math.floor(a):c.substr(c.length-b)}sc.TIMER_TYPES={COUNTER:0,COUNTDOWN:1};sc.TimersModel=ig.GameAddon.extend({observers:[],timers:{},init:function(){this.parent("Timers");ig.storage.register(this);ig.vars.registerVarAccessor("timers",this,"VarTimersEditor")},onPostUpdate:function(){if((sc.model.isGame()||
!sc.model.isCutscene())&&!sc.model.isPaused()&&!sc.model.isMenu()&&!sc.model.isQuickMenu()&&(sc.model.isRunning()||sc.model.isMenu()))for(var a in this.timers){var b=this.timers[a];if(b.mode==sc.TIMER_TYPES.COUNTDOWN&&b.done())break;b.tick();if(b.mode==sc.TIMER_TYPES.COUNTDOWN&&b.done()){ig.game.varsChangedDeferred();b.temp&&delete this.timers[a];sc.Model.notifyObserver(this,sc.TIMER_EVENT.COUNTDOWN_DONE,b)}}},onReset:function(){for(var a in this.timers)sc.Model.notifyObserver(this,sc.TIMER_EVENT.DELETED,
a);this.timers={}},onLevelLoadStart:function(){for(var a in this.timers){var b=this.timers[a];if(b.temp){delete this.timers[a];b.quest&&sc.quests.resetQuestTask(b.quest.quest,b.quest.index);sc.Model.notifyObserver(this,sc.TIMER_EVENT.DELETED,a);ig.game.varsChangedDeferred()}}},addTimer:function(a,b,c,e,f,g,h,i,j,k){if(this.timers[a])throw Error("Timer with name "+a+" is already in use!");b=new sc.TimerEntry(a,b,c,e,f,h,i);this.timers[a]=b;if(g){sc.gui.rightHudPanel.addHudBox(new sc.TimersHud(b,j,
k),1);sc.Model.notifyObserver(this,sc.TIMER_EVENT.ADD_GUI,b)}ig.game.varsChangedDeferred()},stopTimer:function(a){if(this.timers[a]){this.timers[a].stop();ig.game.varsChangedDeferred()}},resumeTimer:function(a){if(this.timers[a]){this.timers[a].resume();ig.game.varsChangedDeferred()}},resetTimer:function(a,b,c){if(this.timers[a]){this.timers[a].reset(b,c);ig.game.varsChangedDeferred()}},removeTimer:function(a){if(!this.timers[a])return null;var b=this.timers[a];delete this.timers[a];sc.Model.notifyObserver(this,
sc.TIMER_EVENT.DELETED,a);ig.game.varsChangedDeferred();return b},getRemainingTimerTime:function(a,b){return!this.timers[a]?b?0:null:this.timers[a].getRemainingTime()},getPassedTime:function(a){return!this.timers[a]?null:this.timers[a].timer},formatTime:function(a,d){var c=Math.floor(a*100)%100,e=Math.floor(a%60),f=Math.floor(a/60)%60,g=Math.floor(a/60/60)%60;return(g>0?b(g,2)+":":"")+b(f,2)+":"+b(e,2)+(d?"."+c:"")},onVarAccess:function(a,b){if(b[0]=="timers"&&b[1])switch(b[2]){case "time":return this.getPassedTime(b[1]);
case "remainingTime":return this.getRemainingTimerTime(b[1]);case "remainingTimeNotNull":return this.getRemainingTimerTime(b[1],true);case "formatTime":return!this.timers[b[1]]?"????":this.formatTime(this.getPassedTime(b[1]),this.timers[b[1]].millis);case "formatRemainingTime":return!this.timers[b[1]]?"????":this.formatTime(this.getRemainingTimerTime(b[1]),this.timers[b[1]].millis)}throw Error("Unsupported var access path: "+a);},onStorageSave:function(a){var b={},c;for(c in this.timers){var e=this.timers;
if(e.temp){e.quest&&sc.quests.resetQuestTask(e.quest.quest,e.quest.index);sc.Model.notifyObserver(this,sc.TIMER_EVENT.DELETED,c)}else b[c]=this.timers[c].getSaveData()}a.timers=b},onStoragePreLoad:function(a){this.onReset();var a=a.timers||{},b;for(b in a){var c=a[b];this.timers[b]=new sc.TimerEntry(c.name||null,c.mode||sc.TIMER_TYPES.COUNTER,c.duration||0,c.area||null,c.temp||false,c.millis||true,c.quest||null);this.timers[b].timer=c.timer||0;this.timers[b].stopped=c.stopped||false}}});sc.TimerEntry=
ig.Class.extend({name:null,mode:sc.TIMER_TYPES.COUNTER,timer:0,duration:0,temp:false,millis:true,area:null,quest:null,stopped:false,init:function(a,b,c,e,f,g,h){this.name=a||"";this.mode=b||0;this.duration=c||0;this.area=e||null;this.temp=f||false;this.millis=g;this.quest=h||null},tick:function(){if(!this.stopped&&!(this.area&&this.area!=sc.map.currentArea.path)){if(ig.game.firstUpdateLoop)this.timer=this.timer+ig.system.rawTick;if(this.duration&&this.timer>=this.duration){this.timer=this.duration;
this.stopped=true}}},stop:function(){this.stopped=true},resume:function(){this.stopped=false},reset:function(a,b){if(a!=void 0)this.mode=a;if(b!=void 0)this.duration=b;this.timer=0;this.stopped=false},getRemainingTime:function(){return!this.duration?0:Math.max(this.duration-this.timer,0)},done:function(){return!this.duration?false:this.timer>=this.duration},getSaveData:function(){var a={};a.name=this.name;a.mode=this.mode;a.timer=this.timer;a.duration=this.duration;a.millis=this.millis;a.temp=this.temp;
a.stopped=this.stopped;if(this.area)a.area=this.area;this.quest&&(a.quest={quest:this.quest.quest,index:this.quest.index});return a}});sc.TIMER_EVENT={};sc.TIMER_EVENT.COUNTDOWN_DONE=0;sc.TIMER_EVENT.DELETED=1;sc.TIMER_EVENT.ADD_GUI=2;ig.addGameAddon(function(){return sc.timers=new sc.TimersModel})});ig.baked=!0;
ig.module("game.feature.timers.timers-steps").requires("impact.base.action","impact.base.entity","impact.base.event","game.feature.timers.timers-model").defines(function(){ig.EVENT_STEP.ADD_TIMER=ig.EventStepBase.extend({name:null,mode:null,duration:0,area:null,temp:null,showGui:false,millis:true,quest:null,_wm:new ig.Config({attributes:{name:{_type:"Timer",_info:"Name of the timer to access it. Must be unique"},mode:{_type:"Select",_info:"Mode the timer should use",_select:sc.TIMER_TYPES},millis:{_type:"Boolean",
_info:"Set false if millis should be shown",_default:true},gui:{_type:"Boolean",_info:"True if a gui should be added to the top-right",_optional:true,_default:true},duration:{_type:"NumberExpression",_info:"Time in seconds the timer should update. Only applicable for COUNTDOWN mode.",_optional:true},area:{_type:"String",_info:"Only update timer when inside this area.",_select:"areas",_optional:true},temp:{_type:"Boolean",_info:"True if the timer should be deleted once a map has been switched",_optional:true,
_default:true},quest:{_type:"QuestResetSelect",_info:"If the timer hits the duration on COUNTDOWN mode or your leave the map and the temp property is set to true.",_optional:true},assist:{_type:"Boolean",_info:"If true: scale time with puzzle speed assist parameter",_optional:true}}}),init:function(b){this.name=b.name;this.mode=sc.TIMER_TYPES[b.mode]||0;this.duration=b.duration||0;this.area=b.area||null;this.temp=b.temp||null;this.showGui=b.gui||false;this.millis=b.millis!=void 0?b.millis:true;this.quest=
b.quest||null;this.assist=b.assist||false},start:function(){var b=ig.Event.getExpressionValue(this.duration);this.assist&&(b=b/(sc.options.get("assist-puzzle-speed")||1));sc.timers.addTimer(this.name,this.mode,b,this.area,this.temp,this.showGui,this.millis,this.quest)}});ig.EVENT_STEP.REMOVE_TIMER=ig.EventStepBase.extend({name:null,_wm:new ig.Config({attributes:{name:{_type:"Timer",_info:"Name of the timer to remove."}}}),init:function(b){this.name=b.name},start:function(){sc.timers.removeTimer(this.name)}});
ig.EVENT_STEP.RESET_TIMER=ig.EventStepBase.extend({name:null,mode:null,duration:null,_wm:new ig.Config({attributes:{name:{_type:"Timer",_info:"Name of the timer to access it. Must be unique"},mode:{_type:"Select",_info:"New timer mode",_optional:true},duration:{_type:"Number",_info:"New duration time if any. Only valid when timer is COUNTDOWN",_optional:true}}}),init:function(b){this.name=b.name;this.mode=b.mode?sc.TIMER_TYPES[b.mode]:void 0;this.duration=b.duration||void 0},start:function(){sc.timers.resetTimer(this.name,
this.mode,this.duration)}});ig.EVENT_STEP.PAUSE_TIMER=ig.EventStepBase.extend({name:null,_wm:new ig.Config({attributes:{name:{_type:"Timer",_info:"Name of the timer to pause."}}}),init:function(b){this.name=b.name},start:function(){sc.timers.stopTimer(this.name)}});ig.EVENT_STEP.RESUME_TIMER=ig.EventStepBase.extend({name:null,_wm:new ig.Config({attributes:{name:{_type:"Timer",_info:"Name of the timer to pause."}}}),init:function(b){this.name=b.name},start:function(){sc.timers.resumeTimer(this.name)}})});
ig.baked=!0;ig.module("game.feature.timers.plug-in").requires("game.feature.timers.timers-steps","game.feature.timers.gui.timers-hud","game.feature.timers.timers-model").defines(function(){if(window.wm){wm.postLoadModules.push("game.feature.timers.editors.timers-editors");wm.addStepColorRule(/TIMER/,"cyan")}});ig.baked=!0;
ig.module("game.feature.achievements.stats-model").requires("impact.base.game","impact.feature.storage.storage").defines(function(){sc.StatsModel=ig.GameAddon.extend({observers:[],values:{},_deferredCallbacks:[],_deferredTimer:0,statsEnabled:false,init:function(){this.parent("Stats");if(window.IG_GAME_DEBUG)this.statsEnabled=true;ig.storage.register(this);ig.vars.registerVarAccessor("stat",this,"VarStatEditor");this.updateBoots(true)},postUpdateOrder:-100,onPostUpdate:function(){if((sc.model.isGame()||
sc.model.isCutscene())&&(!sc.model.isPaused()&&(sc.model.isRunning()||sc.model.isMenu()))&&ig.game.firstUpdateLoop)if(this.statsEnabled)this.addMap("player","playtime",ig.system.rawTick);else{this.values.player||(this.values.player={});this.values.player.playtime||(this.values.player.playtime=0);this.values.player.playtime=this.values.player.playtime+ig.system.rawTick}if(this._deferredTimer>0){this._deferredTimer=this._deferredTimer-ig.system.actualTick;if(this._deferredTimer<=0){this._deferredTimer=
0;window.IG_GAME_DEBUG&&sc.Debug&&sc.Debug.addStats(this._deferredCallbacks);sc.Model.notifyObserver(this,sc.STATS_EVENT.DEFERRED_STAT_CHANGED,this._deferredCallbacks);this._deferredCallbacks.length=0}}},onReset:function(){this.values={};this._deferredTimer=this._deferredCallbacks.length=0;this.updateBoots(false)},onVarAccess:function(b,a){if(a[0]=="stat"){if(a[1]&&a[2]){for(var d=a[2],c=3;a[c];)d=d+("."+a[c++]);return this.getMap(a[1],d)}if(a[1])return this.get(a[1])}throw Error("Unsupported var access path: "+
b);},set:function(b,a){if(this.statsEnabled){this.values[b]=a;this._notify(b)}},setMax:function(b,a){if(this.statsEnabled){this.values[b]=Math.max(this.values[b],a);this._notify(b)}},setMin:function(b,a){if(this.statsEnabled){this.values[b]=Math.min(this.values[b],a);this._notify(b)}},add:function(b,a){if(this.statsEnabled){this.values[b]=this.values[b]?this.values[b]+a:a;this._notify(b)}},subtract:function(b,a){if(this.statsEnabled){this.values[b]=this.values[b]?this.values[b]-a:a;this._notify(b)}},
setMap:function(b,a,d){if(this.statsEnabled){this.values[b]||(this.values[b]={});this.values[b][a]=d;this._notify(b,a)}},addMap:function(b,a,d){if(this.statsEnabled){this.values[b]||(this.values[b]={});this.values[b][a]=this.values[b][a]?this.values[b][a]+d:d;this._notify(b,a)}},subMap:function(b,a,d){if(this.statsEnabled){this.values[b]||(this.values[b]={});this.values[b][a]=this.values[b][a]?this.values[b][a]-d:d;this._notify(b,a)}},setMapMin:function(b,a,d){if(this.statsEnabled){this.values[b]||
(this.values[b]={});this.setMap(b,a,this.values[b][a]==void 0?d:Math.min(this.values[b][a],d))}},setMapMax:function(b,a,d){if(this.statsEnabled){this.values[b]||(this.values[b]={});this.setMap(b,a,this.values[b][a]==void 0?d:Math.max(this.values[b][a],d));this._notify(b,a)}},get:function(b){return this.values[b]},getMap:function(b,a){this.values[b]||(this.values[b]={});return this.values[b][a]},printValues:function(){for(var b in this.values)if(this.values[b]=={})for(var a in b)console.log("  "+a+
": "+this.values[b][a]);else console.log(b+": "+this.values[b])},setActive:function(b){this.statsEnabled=b||false},updateBoots:function(b){var a=parseInt(localStorage.getItem("ccLocalStatBoots"))||0;b&&a++;localStorage.setItem("ccLocalStatBoots",a);this.values.gameBoots=a},onStorageSave:function(b){b.playtime=this.getMap("player","playtime");b.stats=ig.copy(this.values)},onStoragePreLoad:function(b){this.values=b.stats||{};this.statsEnabled=true;this.updateBoots(false);sc.trophies&&sc.trophies.updateAll()},
_notify:function(b,a){if(!this._checkDuplicates(b,a)){this._deferredCallbacks.push({key:b,mapKey:a});if(this._deferredTimer<=0)this._deferredTimer=1}},_checkDuplicates:function(b,a){for(var d=this._deferredCallbacks.length;d--;){var c=this._deferredCallbacks[d];if(c.key==b&&c.mapKey==a)return true}return false}});sc.STATS_EVENT={};sc.STATS_EVENT.STAT_CHANGED=0;sc.STATS_EVENT.DEFERRED_STAT_CHANGED=1;ig.addGameAddon(function(){return sc.stats=new sc.StatsModel})});ig.baked=!0;
ig.module("game.feature.achievements.achievements").requires("impact.base.game","impact.base.loader","impact.base.vars","impact.feature.database.database","impact.feature.greenworks.greenworks","game.config","game.feature.achievements.stats-model").defines(function(){var b=new ig.VarCondition("");sc.TROPHY_TYPES={GENERAL:"GENERAL",COMBAT:"COMBAT",EXPLORATION:"EXPLORATION"};sc.TROPHY_SECTIONS={GENERAL:{PROGRESS:"PROGRESS",PLAYER:"PLAYER",ITEMS:"ITEMS",SPECIAL:"SPECIAL"},COMBAT:{ACTIONS:"ACTIONS",ENEMIES:"ENEMIES",
CIRCUITS:"CIRCUITS",CUMULATIVE:"CUMULATIVE"},EXPLORATION:{DISCOVERY:"DISCOVERY",AREAS:"AREAS",CHESTS:"CHESTS",QUESTS:"QUESTS"}};sc.TROPHY_PROGESS_TYPE={VALUE:"VALUE",VALUE_HIDDEN:"VALUE_HIDDEN",PERCENT:"PERCENT",NONE:"NONE",TIME:"TIME",CONDITION:"CONDITION",ENEMY:"ENEMY"};sc.TROPHY_ICONS={DEFAULT:{index:1,cat:"GENERAL"},KILL:{index:2,cat:"COMBAT"},DAMAGE:{index:3,cat:"COMBAT"},STREAK:{index:4,cat:"COMBAT"},STREAK_KILL:{index:5,cat:"COMBAT"},HEAL:{index:6,cat:"COMBAT"},THROW:{index:7,cat:"COMBAT"},
MELEE:{index:8,cat:"COMBAT"},DASH:{index:9,cat:"COMBAT"},GUARD:{index:10,cat:"COMBAT"},CRITS:{index:11,cat:"COMBAT"},ARTS:{index:111,cat:"COMBAT"},BOSS_MISC:{index:13,cat:"COMBAT",hidden:true},QUESTS:{index:14,cat:"EXPLORATION"},QUEST_TASKS:{index:15,cat:"EXPLORATION"},TRADER:{index:16,cat:"EXPLORATION"},BOTANICS:{index:17,cat:"EXPLORATION"},DASH_PLUS:{index:18,cat:"COMBAT"},GUARD_PLUS:{index:19,cat:"COMBAT"},ENEMIES:{index:20,cat:"COMBAT"},ENEMIES_REPORTS:{index:21,cat:"COMBAT"},PLAY_TIME:{index:22,
cat:"GENERAL"},LEVEL:{index:23,cat:"GENERAL"},PLATIN_TROPHY:{index:66,cat:"GENERAL"},MONEY:{index:107,cat:"GENERAL"},STEPS:{index:108,cat:"GENERAL"},JUMPS:{index:62,cat:"GENERAL"},KEY:{index:63,cat:"GENERAL"},KEY_SILVER:{index:64,cat:"GENERAL"},KEY_GOLD:{index:65,cat:"GENERAL"},CHEST_PERCENT:{index:104,cat:"EXPLORATION"},CHESTS:{index:104,cat:"EXPLORATION"},CHESTS_AUTUMN:{index:67,cat:"EXPLORATION"},CHESTS_BERGEN:{index:68,cat:"EXPLORATION"},CHESTS_MAROON:{index:69,cat:"EXPLORATION"},CHESTS_JUNGLE:{index:70,
cat:"EXPLORATION"},CHESTS_RIDGE:{index:71,cat:"EXPLORATION"},CHESTS_SQUARE:{index:72,cat:"EXPLORATION"},CHESTS_COLD:{index:73,cat:"EXPLORATION"},CHESTS_HEAT:{index:74,cat:"EXPLORATION"},CHESTS_SHOCKWAVE:{index:75,cat:"EXPLORATION"},CHESTS_VERMILLION:{index:76,cat:"EXPLORATION"},LORE:{index:77,cat:"EXPLORATION"},LANDMARK_PERCENT:{index:78,cat:"EXPLORATION"},LANDMARK:{index:78,cat:"EXPLORATION"},LANDMARK_AUTUMN:{index:79,cat:"EXPLORATION"},LANDMARK_BERGEN:{index:80,cat:"EXPLORATION"},LANDMARK_MAROON:{index:81,
cat:"EXPLORATION"},LANDMARK_JUNGLE:{index:82,cat:"EXPLORATION"},LANDMARK_RIDGE:{index:83,cat:"EXPLORATION"},LANDMARK_RHOMBUS:{index:112,cat:"EXPLORATION"},CIRCUIT_COLD:{index:85,cat:"COMBAT"},CIRCUIT_HEAT:{index:84,cat:"COMBAT"},CIRCUIT_SHOCK:{index:86,cat:"COMBAT"},CIRCUIT_WAVE:{index:87,cat:"COMBAT"},CIRCUIT_LEVEL_3:{index:110,cat:"COMBAT"},GUARD_COUNTER:{index:92,cat:"COMBAT"},LOW_HEALTH_WINS:{index:93,cat:"COMBAT"},ENVIRONMENT_KILLS:{index:94,cat:"COMBAT"},APOLLO_PERFECT:{index:95,cat:"GENERAL"},
ONE_PUNCH:{index:96,cat:"COMBAT"},ONE_SHOT:{index:114,cat:"COMBAT"},STORY:{index:97,cat:"GENERAL"},ITEMS_USED:{index:98,cat:"GENERAL"},METAL_GEARS:{index:100,cat:"GENERAL"},OLD_DRILL:{index:101,cat:"GENERAL"},ITEMS_FOUND:{index:102,cat:"GENERAL"},ALL_IS_NORMAL:{index:103,cat:"GENERAL"},MONK_TRIALS:{index:105,cat:"GENERAL"},ITEM_EXPO:{index:106,cat:"GENERAL"},SPIDERS:{index:109,cat:"GENERAL"},EMILIE_RACES:{index:116,cat:"GENERAL"},UNIQUE_EQUIP:{index:117,cat:"GENERAL"},BOSS_CRAB:{index:24,cat:"COMBAT",
hidden:true},BOSS_TURRET:{index:25,cat:"COMBAT",hidden:true},BOSS_DRILLER:{index:26,cat:"COMBAT",hidden:true},BOSS_TIM:{index:27,cat:"COMBAT",hidden:true},BOSS_MOTH:{index:28,cat:"COMBAT",hidden:true},BOSS_FROBBIT:{index:29,cat:"COMBAT",hidden:true},BOSS_PHANTOM:{index:30,cat:"COMBAT",hidden:true},BOSS_BLOB:{index:31,cat:"COMBAT",hidden:true},BOSS_APE:{index:32,cat:"COMBAT",hidden:true},BOSS_APE_WHALE:{index:33,cat:"COMBAT",hidden:true},BOSS_SLOTH:{index:37,cat:"COMBAT",hidden:true},BOSS_SNAIL:{index:38,
cat:"COMBAT",hidden:true},BOSS_APOLLO:{index:34,cat:"COMBAT",hidden:true},BOSS_APOLLO_2:{index:35,cat:"COMBAT",hidden:true},BOSS_APOLLO_3:{index:36,cat:"COMBAT",hidden:true},BOSS_SAMURAI:{index:39,cat:"COMBAT",hidden:true},BOSS_SHIZUKA:{index:40,cat:"COMBAT",hidden:true},BOSS_DESIGNER:{index:41,cat:"COMBAT",hidden:true},BOSS_ELEPHANT:{index:42,cat:"COMBAT",hidden:true}};sc.TROPHY_SORT_TYPES={ORDER:0,UNLOCKED:1,NAME:2,POINTS:3};sc.TROPHY_STARS={1:1,2:2,3:3,4:4,5:5};sc.TrophyManager=ig.GameAddon.extend({observers:[],
trophies:null,totalPoints:0,version:4,subLists:null,latest:[],init:function(){this.parent("Achievements");sc.Model.addObserver(sc.stats,this);this._initSubLists();if(window.wm)ig.database.register("achievements","FeatEnumList","Achievements");else{ig.storage.register(this);this.onStorageGlobalLoad(ig.storage.globalData)}for(var a in sc.TROPHY_ICONS);ig.vars.registerVarAccessor("trophies",this,"VarTrophyEditor")},getTotalTrophiesUnlocked:function(a,b,c){var e=0,f=0,g;for(g in this.trophies){var h=
this.trophies[g];if(h.track&&!(b&&b!=h.category)&&!(c&&c!=h.section)){h.triggered&&e++;f++}}return a?e/f:e},getTotalTrophies:function(a,b,c){var e=0,f=0,g;for(g in this.trophies){var h=this.trophies[g];if(h.track&&!(a&&a!=h.category)&&!(b&&b!=h.section)){h.triggered&&e++;f++}}c||(c={count:0,total:0});c.count=e;c.total=f;return c},varsChangedOrder:1E4,onVarsChanged:function(){sc.model.currentState==sc.GAME_MODEL_STATE.TITLE||(sc.model.currentSubState==sc.GAME_MODEL_SUBSTATE.LOADGAME||sc.model.currentSubState==
sc.GAME_MODEL_SUBSTATE.LOADING)||this.subLists.varConditions&&this._updateSubList(this.subLists.varConditions)},onVarAccess:function(a,b){if(b[0]=="trophies")switch(b[1]){case "triggered":var c=this.getTrophy(b[2]);return!c?false:c.triggered||false;case "name":return this.getTrophyName(b[2]);case "version":return this.version+""}throw Error("Unsupported var access path: "+a);},updateAll:function(){if(!sc.newgame.get("no-trophies"))for(var a in this.subLists)this._updateSubList(this.subLists[a])},
triggerTrophy:function(a){if(!sc.newgame.get("no-trophies")&&this.trophies[a]&&!this.trophies[a].triggered){this.trophies[a].triggered=true;this.validateFeatPoints();this._notifyNewTrophy(a);ig.storage.saveGlobals()}},clearTrophies:function(){for(var a in this.trophies)this.trophies[a].triggered=false;sc.menu.clearNewUnlock(sc.MENU_SUBMENU.TROPHY);ig.storage.saveGlobals()},validateFeatPoints:function(){var a=this.totalPoints=0,b;for(b in this.trophies){var c=this.trophies[b];if(c.track&&c.triggered){this.totalPoints=
this.totalPoints+(c.points||0);a++}}sc.stats.setMap("player","trophies",a)},getTotalPoints:function(){this.validateFeatPoints();return this.totalPoints},getTrophy:function(a){return this.trophies[a]},getTrophyName:function(a){return!this.trophies[a]?"???":ig.LangLabel.getText(this.trophies[a].name)},isTrophyUnlocked:function(a){return this.trophies[a].triggered||false},_addToLatest:function(a){this.latest.push(a);this.latest.length>=3&&this.latest.shift()},_initSubLists:function(){this.subLists={};
this.trophies=ig.database.get("achievements");var a=null,b=null,c=0,e;for(e in this.trophies){a=this.trophies[e];a.key=e;if(!a.stats||a.stats.length==0){if(a.condition){this.subLists.varConditions||(this.subLists.varConditions=[]);this.subLists.varConditions.push(a)}}else for(c=a.stats.length;c--;){b=a.stats[c];this.subLists[b.key]||(this.subLists[b.key]=[]);this.subLists[b.key].push(a)}}ig.JSON_LOG&&ig.log("%cDATABASE: %cLoaded Achievements: \n%O","color:orange","",this.subLists)},_updateSubList:function(a){if(!sc.newgame.get("no-trophies")){for(var d=
a.length,c=0,e=sc.stats,f=null,g,h,i=false,j=false;d--;){f=a[d];if(!f.triggered&&f.track){c=f.stats.length;for(i=true;c--;){g=f.stats[c];h=g.mapKey?e.getMap(g.key,g.mapKey):e.get(g.key);var k=ig.Event.getExpressionValue(g.value);if(!this._compare(g.compare,h,k)){i=false;break}}if(f.condition&&i){b.setCondition(f.condition);i=b.evaluate()}if(i){j=f.triggered=true;this._notifyNewTrophy(f.key)}}}if(j){this.validateFeatPoints();ig.storage.saveGlobals()}}},_notifyNewTrophy:function(a){this._addToLatest(this.trophies[a]);
this.trophies[a].triggered=true;ig.greenworks.isActive()&&this.trophies[a].steamID&&ig.greenworks.activateAchievement(this.trophies[a].steamID);sc.Model.notifyObserver(this,sc.TROPHY_EVENTS.TRIGGERED,a);sc.menu.addLog({type:"TROPHY",trophy:a});sc.menu.addNewUnlock(sc.MENU_SUBMENU.TROPHY,a)},_compare:function(a,b,c){if(a=="min")return b>=c;if(a=="max")return b<=c;if(a=="equal")return b==c},onStorageGlobalSave:function(a){var b={},c;for(c in this.trophies)this.trophies[c].triggered&&(b[c]=true);a.featVersion=
this.version;a.feats=b},onStorageGlobalLoad:function(a){var a=a.feats,b;for(b in a)if(this.trophies[b]&&a[b]==true){this.trophies[b].triggered=true;ig.greenworks.isActive()&&this.trophies[b].steamID&&ig.greenworks.activateAchievement(this.trophies[b].steamID)}this.validateFeatPoints()},modelChanged:function(a,b,c){if(b==sc.STATS_EVENT.STAT_CHANGED)this.subLists[c.key]&&this._updateSubList(this.subLists[c.key]);else if(b==sc.STATS_EVENT.DEFERRED_STAT_CHANGED)for(a=c.length;a--;)this.subLists[c[a].key]&&
this._updateSubList(this.subLists[c[a].key])}});sc.TROPHY_EVENTS={};sc.TROPHY_EVENTS.TRIGGERED=0;ig.addGameAddon(function(){return sc.trophies=new sc.TrophyManager})});ig.baked=!0;
ig.module("game.feature.achievements.stat-steps").requires("impact.base.action","impact.base.entity").defines(function(){ig.EVENT_STEP.ENABLED_STATS=ig.EventStepBase.extend({_wm:new ig.Config({attributes:{},label:function(){return"<i style='color: orange'>ENABLED STATS</i>"}}),init:function(){},start:function(){sc.stats.setActive(true)}});ig.EVENT_STEP.DISABLE_STATS=ig.EventStepBase.extend({_wm:new ig.Config({attributes:{},label:function(){return"<i style='color: orange'>DISABLE STATS</i>"}}),init:function(){},
start:function(){sc.stats.setActive(false)}});ig.EVENT_STEP.UNLOCK_TROPHY=ig.EventStepBase.extend({trophy:null,_wm:new ig.Config({attributes:{trophy:{_type:"TrophySelect",_info:"The Trophy to unlock, if already unlocked, nothing will happen."}}}),init:function(b){this.trophy=b.trophy||null},start:function(){this.trophy&&sc.trophies.triggerTrophy(this.trophy)}});ig.EVENT_STEP.ADD_STAT_MAP_NUMBER=ig.EventStepBase.extend({map:null,stat:null,value:0,_wm:new ig.Config({attributes:{map:{_type:"String",
_info:"The map of the stat."},stat:{_type:"String",_info:"The stat name"},value:{_type:"Number",_info:"The number to add"}}}),init:function(b){this.map=b.map||null;this.stat=b.stat||null;this.value=b.value||0},start:function(){this.map&&this.stat&&sc.stats.addMap(this.map,this.stat,this.value)}});ig.EVENT_STEP.SET_STAT_MAP_NUMBER=ig.EventStepBase.extend({map:null,stat:null,value:0,_wm:new ig.Config({attributes:{map:{_type:"String",_info:"The map of the stat."},stat:{_type:"String",_info:"The stat name"},
value:{_type:"NumberExpression",_info:"The number to add"}}}),init:function(b){this.map=b.map||null;this.stat=b.stat||null;this.value=b.value||0},start:function(){this.map&&this.stat&&sc.stats.setMap(this.map,this.stat,ig.Event.getExpressionValue(this.value))}})});ig.baked=!0;
ig.module("game.feature.achievements.plug-in").requires("game.feature.achievements.achievements","game.feature.achievements.stats-model","game.feature.achievements.stat-steps").defines(function(){if(window.wm){wm.postLoadModules.push("game.feature.achievements.editors.feat-editors");wm.addStepColorRule(/STAT/,"orange");wm.addStepColorRule(/TROPHY/,"orange")}});ig.baked=!0;
ig.module("game.feature.auto-control.auto-control").requires("impact.base.game").defines(function(){sc.AUTO_CTRL_AXIS=["left","right"];sc.AUTO_INPUT_DEVICE={MOUSE:ig.INPUT_DEVICES.KEYBOARD_AND_MOUSE,GAMEPAD:ig.INPUT_DEVICES.GAMEPAD};sc.AUTO_CTRL_ACTION=["menu","quickmenu","menuConfirm","menuBack","menuDown","menuUp","menuLeft","menuRight","rightPressed","menuHotkeyHelp","menuHotkeyHelp2","menuHotkeyHelp3","menuCircleLeft","menuCircleRight","questCircleLeft","questCircleRight","heatMode","coldMode",
"shockMode","waveMode","moveDirX","moveDirY","aiming","thrown","charge","melee","dashing","guarding"];sc.AutoControl=ig.GameAddon.extend({mouse:{current:Vec2.create(),start:Vec2.create(),target:Vec2.create(),timer:0,duration:0},axis:{left:{x:0,y:0,timer:0},right:{x:0,y:0,timer:0}},actions:{},init:function(){this.parent("AutoControl")},get:function(b){return b=="mouseX"?this.mouse.current.x:b=="mouseY"?this.mouse.current.y:b=="axisLeftX"?this.axis.left.x:b=="axisLeftY"?this.axis.left.y:b=="axisRightX"?
this.axis.right.x:b=="axisRightY"?this.axis.right.y:b=="leftStickDown"?this.axis.left.x||this.axis.left.y:b=="rightStickDown"?this.axis.right.x||this.axis.right.y:!this.actions[b]?false:this.actions[b].value},isActive:function(){return this.active},setActive:function(b){if(this.active=b){sc.control.setAutoControl(this);sc.model.resetMenuState();Vec2.assign(this.mouse.current,ig.input.mouse)}else{sc.control.setAutoControl(null);this.actions={};this.setStick("left",0,0,0);this.setStick("right",0,0,
0)}},preUpdateOrder:0,onPreUpdate:function(){if(this.active){if(this.mouse.timer){this.mouse.timer=this.mouse.timer-ig.system.actualTick;if(this.mouse.timer<0)this.mouse.timer=0;var b=1-this.mouse.timer/this.mouse.duration,b=KEY_SPLINES.EASE_IN_OUT.get(b);Vec2.lerp(this.mouse.start,this.mouse.target,b,this.mouse.current)}for(var a in this.actions){b=this.actions[a];if(b.target){b.value=b.target;b.target=null}else b.hold||delete this.actions[a]}for(a in this.axis){b=this.axis[a];if(b.timer){b.timer=
b.timer-ig.system.actualTick;if(b.timer<=0){b.timer=0;b.x=b.y=0}}}}},setMouse:function(b,a,d){if(d){Vec2.assign(this.mouse.start,this.mouse.current);Vec2.assignC(this.mouse.target,b,a)}else Vec2.assignC(this.mouse.current,b,a);this.mouse.duration=d;this.mouse.timer=d},setStick:function(b,a,d,c){this.axis[b].x=a;this.axis[b].y=d;this.axis[b].timer=c},setAction:function(b,a,d){this.actions[b]={target:a,value:null,hold:d||false}},clearAction:function(b){delete this.actions[b]}});ig.addGameAddon(function(){return sc.autoControl=
new sc.AutoControl})});ig.baked=!0;
ig.module("game.feature.auto-control.auto-control-steps").requires("impact.base.event","game.feature.auto-control.auto-control").defines(function(){ig.EVENT_STEP.START_AUTO_CTRL=ig.EventStepBase.extend({_wm:new ig.Config({attributes:{}}),init:function(){},start:function(b,a){sc.model.enterGame();a.pauseParallel=true;a.runType=ig.EventRunType.PARALLEL;sc.autoControl.setActive(true)}});ig.EVENT_STEP.END_AUTO_CTRL=ig.EventStepBase.extend({_wm:new ig.Config({attributes:{}}),init:function(){},start:function(b,
a){a.pauseParallel=false;a.runType=ig.EventRunType.BLOCKING;sc.autoControl.setActive(false);sc.model.enterCutscene()}});ig.EVENT_STEP.SET_AUTO_CTRL_MOUSE=ig.EventStepBase.extend({pos:Vec2.create(),duration:0,_wm:new ig.Config({attributes:{pos:{_type:"Vec2",_info:"Position of mouse in screen pixels. 0,0 = top left"},duration:{_type:"Number",_info:"Duration to move mouse to this position"}}}),init:function(b){Vec2.assign(this.pos,b.pos);this.duration=b.duration||0},start:function(){if(!sc.autoControl.isActive())throw Error("Use Auto Ctrl Step outside of 'AUTO_CONTROL' event");
ig.input.currentDevice==ig.INPUT_DEVICES.KEYBOARD_AND_MOUSE&&sc.autoControl.setMouse(this.pos.x,this.pos.y,this.duration)}});ig.EVENT_STEP.SET_AUTO_CTRL_STICK=ig.EventStepBase.extend({stick:null,value:Vec2.create(),duration:0,_wm:new ig.Config({attributes:{stick:{_type:"String",_info:"Type of Stick",_select:sc.AUTO_CTRL_AXIS},value:{_type:"Vec2",_info:"Type of value for the axis"},duration:{_type:"Number",_info:"Time in seconds to hold the stick in that direction. If 0 = hold forever."}}}),init:function(b){this.stick=
b.stick||"left";Vec2.assign(this.value,b.value);this.duration=b.duration||0},start:function(){if(!sc.autoControl.isActive())throw Error("Use Auto Ctrl Step outside of 'AUTO_CONTROL' event");ig.input.currentDevice==ig.INPUT_DEVICES.GAMEPAD&&sc.autoControl.setStick(this.stick,this.value.x,this.value.y,this.duration)}});ig.EVENT_STEP.SET_AUTO_CTRL_ACTION=ig.EventStepBase.extend({action:null,value:null,hold:false,deviceFilter:null,_wm:new ig.Config({attributes:{action:{_type:"String",_info:"Kind of action",
_select:sc.AUTO_CTRL_ACTION},value:{_type:"Number",_info:"Value for action. 1 usually makes sense",_default:1},hold:{_type:"Boolean",_info:"True if action should be hold"},deviceFilter:{_type:"String",_info:"Only do action for a specific device",_select:sc.AUTO_INPUT_DEVICE,_withNull:true}}}),init:function(b){this.action=b.action||null;this.value=b.value||0;this.hold=b.hold||false;this.deviceFilter=sc.AUTO_INPUT_DEVICE[b.deviceFilter]||null},start:function(){if(!sc.autoControl.isActive())throw Error("Use Auto Ctrl Step outside of 'AUTO_CONTROL' event");
this.deviceFilter&&ig.input.currentDevice!=this.deviceFilter||sc.autoControl.setAction(this.action,this.value,this.hold)}});ig.EVENT_STEP.CLEAR_AUTO_CTRL_ACTION=ig.EventStepBase.extend({action:null,deviceFilter:null,_wm:new ig.Config({attributes:{action:{_type:"String",_info:"Kind of action",_select:sc.AUTO_CTRL_ACTION},deviceFilter:{_type:"String",_info:"Only do action for a specific device",_filter:sc.AUTO_INPUT_DEVICE,_withNull:true}}}),init:function(b){this.action=b.action||null;this.deviceFilter=
sc.AUTO_INPUT_DEVICE[b.deviceFilter]||null},start:function(){if(!sc.autoControl.isActive())throw Error("Use Auto ntrl Step outside of 'AUTO_CONTROL' event");this.deviceFilter&&ig.input.currentDevice!=this.deviceFilter||sc.autoControl.clearAction(this.action)}})});ig.baked=!0;ig.module("game.feature.auto-control.plug-in").requires("game.feature.auto-control.auto-control","game.feature.auto-control.auto-control-steps").defines(function(){});ig.baked=!0;
ig.module("game.feature.inventory.item-level-scaling").defines(function(){var b=[{level:1,base:20,hp:205},{level:6,base:23,hp:234},{level:11,base:26,hp:266},{level:16,base:30,hp:303},{level:21,base:34,hp:343},{level:26,base:38,hp:389},{level:31,base:43,hp:439},{level:36,base:49,hp:496},{level:41,base:56,hp:560},{level:46,base:63,hp:630},{level:51,base:71,hp:710},{level:56,base:79,hp:798},{level:61,base:89,hp:897},{level:66,base:100,hp:1008},{level:71,base:113,hp:1132},{level:76,base:127,hp:1270},
{level:81,base:142,hp:1425},{level:86,base:159,hp:1598},{level:91,base:179,hp:1792},{level:96,base:200,hp:2008},{level:99,base:215,hp:2150}];sc.ItemLevelScaling={adaptParams:function(a,b,c){var a=ig.copy(a),e=this.getFactor(b,c,"base"),b=this.getFactor(b,c,"hp");a.hp&&(a.hp=Math.max(1,Math.round(a.hp*b)));a.attack&&(a.attack=Math.round(a.attack*e).limit(0,999));a.defense&&(a.defense=Math.round(a.defense*e).limit(0,999));a.focus&&(a.focus=Math.round(a.focus*e).limit(0,999));return a},getFactor:function(a,
b,c){return this.getAverageStat(b,c)/this.getAverageStat(a,c)},getAverageStat:function(a,d){for(var a=a.limit(0,99),c=b.length;c--;){var e=b[c];if(e.level<=a){if(e.level==a)return e[d];c=b[c+1];return e[d]+(c[d]-e[d])*((a-e.level)/(c.level-e.level))}}return 1},getLevelForAverageStat:function(a){for(var d=b.length;d--;){var c=b[d];if(c.base<=a){d=b[d+1];return!d?99:Math.round(c.level+(d.level-c.level)*((a-c.base)/(d.base-c.base)))}}return 1}}});ig.baked=!0;
ig.module("game.feature.inventory.inventory").requires("impact.base.loader","game.config","game.feature.inventory.item-level-scaling").defines(function(){sc.ITEMS_TYPES={CONS:"CONS",EQUIP:"EQUIP",TRADE:"TRADE",KEY:"KEY",TOGGLE:"TOGGLE"};sc.ITEMS_EQUIP_TYPES={HEAD:"HEAD",ARM:"ARM",TORSO:"TORSO",FEET:"FEET"};sc.ITEMS_RARITY={LOW:0,NORMAL:1,RARE:2,LEGENDARY:3,UNIQUE:4,BACKER:5,SCALE:6};sc.SORT_TYPE={ORDER:0,NAME:1,AMOUNT:2,RARITY:3,HP:4,ATTACK:5,DEFENSE:6,FOCUS:7,LEVEL:8};sc.ITEM_TRADE_TYPE={ENEMY:{_type:"EnemySearch"},
PLANT:{_type:"DropSelect"},TRADER:{_type:"TraderSelect"},QUEST:{_type:"Quest"},CHEST:{_type:"Select",_select:"areas"},OTHER:{_type:"TradeCustomEditor"}};sc.Inventory=ig.SingleLoadable.extend({items:[],scalable:[],init:function(){if(!ig.ITEM_DATABASE)return ig.warn("Can't initialize item database because no ig.ITEM_DATABASE was provided!");this.parent()},updateScaledEquipment:function(b){for(var a=this.scalable.length;a--;){var d=this.getItem(this.scalable[a]),c=d.params,e=d.baseParams,f=d.baseLevel;
if(c){e=sc.ItemLevelScaling.adaptParams(e,f,b);e.hp&&(c.hp=e.hp);e.attack&&(c.attack=e.attack);e.defense&&(c.defense=e.defense);e.focus&&(c.focus=e.focus);d.level=b}}},isScalable:function(b){for(var a=this.scalable.length;a--;)if(this.scalable[a]==b)return true;return false},getItem:function(b){return b<0?null:this.items[b]},getItemName:function(b){b=this.getItem(b);return!b?null:ig.LangLabel.getText(b.name)},getItemByName:function(b){b=this.getItemID(b);return b==-1?null:this.items[b]},getItemLevel:function(b){return b<
0?0:this.items[b].level||0},getItemID:function(b){for(var b=b.trim().toLowerCase(),a=this.items.length;a--;)if(this.items[a].name.en_US.toLowerCase()==b)return a;return-1},getBuffString:function(b,a,d){if(d||this.isBuffID(b)){for(var d=d||this.items[b].stats,c=d.length,e=null,f="",g=this.areStatChangesRanksUniform(d);c--;)if((e=sc.STAT_CHANGE_SETTINGS[d[c]])&&e.change!=sc.STAT_CHANGE_TYPE.HEAL){f=f+("\\i["+(e.icon||"stat-default")+"]");g||(f=f+("\\i["+e.grade+"]"||""))}g&&(f=f+("\\i["+g+"]"||""));
return f+(a?"":" "+(this.items[b].time||0)*(sc.newgame.get("double-buff-time")?2:1)+"sec")}},areStatChangesRanksUniform:function(b){for(var a=b.length,d=sc.STAT_CHANGE_SETTINGS[b[a-1]],c=d.grade;a--;){d=sc.STAT_CHANGE_SETTINGS[b[a]];if(!d||d.change==sc.STAT_CHANGE_TYPE.HEAL||d.grade!=c)return;c=d.grade}return c},isBuffID:function(b){return this.items[b].isBuff},isEquipID:function(b){return this.items[b].type==sc.ITEMS_TYPES.EQUIP},getRaritySuffix:function(b){switch(b){case sc.ITEMS_RARITY.LOW:return"";
case sc.ITEMS_RARITY.NORMAL:return"-normal";case sc.ITEMS_RARITY.RARE:return"-rare";case sc.ITEMS_RARITY.LEGENDARY:return"-legend";case sc.ITEMS_RARITY.UNIQUE:return"-unique";case sc.ITEMS_RARITY.BACKER:return"-backer";case sc.ITEMS_RARITY.SCALE:return"-scale"}},getItemNameWithIcon:function(b){b=this.items[b];return!b?"":"\\i["+(b.icon+this.getRaritySuffix(b.rarity||0)||"item-default")+"]"+ig.LangLabel.getText(b.name)},getItemIcon:function(b){if(b<=0)return null;b=this.items[b];return!b?"item-default":
"\\i["+(b.icon+this.getRaritySuffix(b.rarity||0)||"item-default")+"]"},getItemDescription:function(b){return this.items[b]?ig.LangLabel.getText(this.items[b].description):""},getItemRarity:function(b){b=this.items[b];return!b?null:b.rarity},getItemSubType:function(b){b=this.items[b];return!b?null:b.equipType},isConsumable:function(b){b=this.items[b];return!b?false:b.type==sc.ITEMS_TYPES.CONS},getTotalItemsUnlocked:function(b,a,d,c){for(var e=this.items.length,f=sc.inventory,g=0,h=0,i=null;e--;){i=
f.getItem(e);if(!i.name.en_US.startsWith("-")&&!(i.type=="KEY"||i.type=="TOGGLE"||i.noTrack||i.noCount))if(a)if(d){i=f.getItem(e);if(i.type==a&&i.equipType==d){sc.stats.getMap("items",e)&&g++;h++}}else{if(f.getItem(e).type==a){sc.stats.getMap("items",e)&&g++;h++}}else{sc.stats.getMap("items",e)?g++:c&&console.log("ITEM MISSING",f.getItemName(e));h++}}return b?g/h:g},loadInternal:function(){$.ajax({dataType:"json",url:ig.root+ig.ITEM_DATABASE+ig.getCacheSuffix(),context:this,success:this.onload.bind(this),
error:this.onerror.bind(this)})},onerror:function(b){this.items={};this.loadingFinished(true);ig.error("Could not load Inventory json file! Event: %O",b)},onload:function(b){this.items=b.items;for(var a=this.items.length,d=null;a--;){d=this.items[a];d.effect&&(d.effect.sheet&&d.effect.name)&&(d.effect=new ig.EffectHandle(this.items[a].effect));this._isBuff(d)&&(d.isBuff=true);if(d.isScalable){this.scalable.push(a);d.baseParams=ig.copy(d.params);d.baseLevel=d.level}}this.loadingFinished(true);ig.JSON_LOG&&
ig.log("%cLOADABLE: %cLoaded Inventory: \n%O","color:#149AEB","",b)},_isBuff:function(b){if(b.stats)for(var a=b.stats.length;a--;)if(sc.STAT_CHANGE_SETTINGS[b.stats[a]].change!=sc.STAT_CHANGE_TYPE.HEAL)return true;return false}});sc.inventory=new sc.Inventory});ig.baked=!0;
ig.module("game.feature.combat.model.combat-params").requires("game.feature.model.base-model").defines(function(){sc.ELEMENT={NEUTRAL:0,HEAT:1,COLD:2,SHOCK:3,WAVE:4};sc.ELEMENT_MAX=4;sc.ELEMENT_COUNTER={};sc.ELEMENT_COUNTER[sc.ELEMENT.HEAT]=sc.ELEMENT.COLD;sc.ELEMENT_COUNTER[sc.ELEMENT.COLD]=sc.ELEMENT.HEAT;sc.ELEMENT_COUNTER[sc.ELEMENT.SHOCK]=sc.ELEMENT.WAVE;sc.ELEMENT_COUNTER[sc.ELEMENT.WAVE]=sc.ELEMENT.SHOCK;sc.SP_REGEN_SPEED={4:1,8:1.2,12:1.4,16:1.6};sc.SP_REGEN_FACTOR=0.25;sc.HP_LOW_WARNING=
0.33;var b={LINEAR:function(a,b){return a*2-b},PERCENTAGE:function(a,b){return a>b?a*(1+Math.pow(1-b/a,0.5)*0.2):a*Math.pow(a/b,1.5)}};ig.perf.skipDmgModifiers=false;sc.CombatParams=ig.Class.extend({combatant:null,observers:[],baseParams:{hp:100,attack:10,defense:5,focus:5,elemFactor:[1,1,1,1],statusInflict:[1,1,1,1],statusEffect:[1,1,1,1]},modifiers:null,buffs:[],currentHp:100,maxSp:12,currentSp:6,spHoldTimer:0,currentItemBuffs:0,tmpElemFactor:[1,1,1,1],tmpStatusInflict:[1,1,1,1],damageFactor:1,
ballFactor:1,defeated:false,statusStates:[],hpRegTime:5,hpHealTimer:0,criticalDmgFactor:1.5,lockedBy:[],stats:{},init:function(a){if(a)for(var b in this.baseParams)this.baseParams[b]=a[b]||this.baseParams[b];this.currentHp=this.getStat("hp");for(b=0;b<4;++b)this.statusStates[b]=new sc.COMBAT_STATUS[b]},setCombatStat:function(a,b){this.stats[a]=b||null},getCombatStat:function(a,b){return this.stats[a]||b},addCombatStat:function(a,b){this.stats[a]=this.stats[a]?this.stats[a]+b:b},healStatus:function(){for(var a=
0;a<4;++a)this.statusStates[a].clear(this.combatant)},revive:function(a){this.defeated=false;if(this.currentHp<0)this.currentHp=0;this.increaseHp(Math.round(this.getStat("hp")*(a||1)));this.healStatus()},setCombatant:function(a){this.combatant=a},initStatusFx:function(){if(this.combatant)for(var a=0;a<4;++a)this.statusStates[a].initEntity(this.combatant)},setModifiers:function(a){this.modifiers=a},startLock:function(a){if(a.currentAction&&a.actionAttached.indexOf(this)==-1){a.addActionAttached(this);
this.lockedBy.push(a)}},endLock:function(a){a.removeActionAttached(this)&&this._decreaseLock(a)},clearLock:function(){for(var a=this.lockedBy.length;a--;)this.lockedBy[a].actionAttached.erase(this);this.lockedBy.length=0},isLocked:function(){return this.lockedBy.length>0},isLockedBy:function(a){return this.lockedBy.indexOf(a)!=-1},onActionEndDetach:function(a){this._decreaseLock(a)},_decreaseLock:function(a){this.lockedBy.erase(a);if(this.lockedBy.length==0)this.combatant.onStunLockClear()},reset:function(a){this.currentItemBuffs=
this.buffs.length=0;this.currentHp=this.getStat("hp");this.spHoldTimer=0;this.defeated=false;this.damageFactor=1;this.maxSp=a||16;this.currentSp=this.maxSp*sc.SP_REGEN_FACTOR;this.resetStatusConditions();sc.Model.notifyObserver(this,sc.COMBAT_PARAM_MSG.RESET_STATS)},resetStatusConditions:function(){for(var a=this.statusStates.length;a--;)this.statusStates[a].clear()},resetSp:function(){this.currentSp=this.maxSp*sc.SP_REGEN_FACTOR;sc.Model.notifyObserver(this,sc.COMBAT_PARAM_MSG.SP_CHANGED)},setMaxSp:function(a){this.maxSp=
a||0;this.currentSp=this.maxSp*sc.SP_REGEN_FACTOR;sc.Model.notifyObserver(this,sc.COMBAT_PARAM_MSG.MAX_SP_CHANGED)},setBaseParams:function(a,b){var c=this.getStat("hp")-this.currentHp,d;for(d in this.baseParams)this.baseParams[d]=a[d]||this.baseParams[d];this.currentHp=this.getStat("hp")-c;sc.Model.notifyObserver(this,sc.COMBAT_PARAM_MSG.STATS_CHANGED,b)},getStat:function(a,b){for(var c=this.baseParams[a],d=this.buffs.length;d--;)if(!b||!this.buffs[d].hacked)c=this.buffs[d].multiply(c,a);typeof c==
"number"&&(c=Math.round(c));return c},getStatBuffFactor:function(a){for(var b=1,c=this.buffs.length;c--;)b=this.buffs[c].multiply(b,a);return b},getModifier:function(a){if(this.combatant&&this.combatant.isPlayer&&!sc.model.player.getCore(sc.PLAYER_CORE.MODIFIER)||sc.arena.isStatusModifierBlocked(a))return 0;for(var b=this.modifiers&&this.modifiers[a]||0,c=this.buffs.length;c--;)b=this.buffs[c].add(b,a);return b},getDamage:function(e,g,h,i,j){var k=e.damageFactor,l=e.noHack||false,o=h.getCombatantRoot(),
h=h.combo||o.combo;if(h.damageCeiling){var m=Math.max(1-(h.damageCeiling.sum[this.combatant.id]||0)/h.damageCeiling.max,0);m<0.5&&(k=Math.max(k*2*m,0.01))}h=k;if(!ig.perf.skipDmgModifiers){e.skillBonus&&(k=k*(1+e.attackerParams.getModifier(e.skillBonus)));var n=e.attackerParams.getModifier("BERSERK");n&&e.attackerParams.getHpFactor()<=sc.HP_LOW_WARNING&&(k=k*(1+n));(n=e.attackerParams.getModifier("MOMENTUM"))&&(o.isPlayer&&o.dashAttackCount)&&(k=k*(1+o.dashAttackCount*n));!ig.vars.get("g.newgame.ignoreSergeyHax")&&
(o.isPlayer&&!this.combatant.isPlayer&&sc.newgame.get("sergey-hax"))&&(k=k*4096)}var g=this.damageFactor*(g===void 0?1:g),n=1,p=e.attackerParams.getStat("focus",l)/this.getStat("focus",l),r=(Math.pow(p,0.35)-0.9)*e.critFactor,r=Math.random()<=r;if(!ig.perf.skipDmgModifiers){e.element&&(n=this.getStat("elemFactor")[e.element-1]*this.tmpElemFactor[e.element-1]);g=g*n;e.ballDamage&&(g=g*(this.ballFactor+this.statusStates[3].getValue(this)));(m=e.attackerParams.getModifier("CROSS_COUNTER"))&&sc.EnemyAnno.isCrossCounterEffective(this.combatant)&&
(g=g*(1+m));(m=e.attackerParams.getModifier("BREAK_DMG"))&&sc.EnemyAnno.isWeak(this.combatant)&&(g=g*(1+m));r&&(k=k*e.attackerParams.criticalDmgFactor)}o=sc.combat.getGlobalDmgFactor(o.party);m=0;if(e.element&&e.statusInflict&&g>0&&!j)var j=e.element-1,m=h*e.statusInflict,t=(Math.pow(1+(p>=1?p-1:1-p)*c,a)-1)*d,p=p>=1?1+t:Math.max(0,1-t),m=m*p*this.getStat("statusInflict")[j]*this.tmpStatusInflict[j]*n,m=this.statusStates[j].getInflictValue(m,this,e,i);i=e.attackerParams.getStat("attack",l);l=e.defenseFactor*
this.getStat("defense",l);l=Math.max(1,b.PERCENTAGE(i,l));l=l*g;i=b.PERCENTAGE(i,0)-l;l=l*k*o;i=i*k*o;if(!ig.perf.skipDmgModifiers){l=l*(0.95+Math.random()*0.1);i=i*(0.95+Math.random()*0.1)}if(e.limiter.noDmg)i=l=0;l=Math.round(l);return{damage:l,defReduced:i,offensiveFactor:k,baseOffensiveFactor:h,elementalDef:n,defensiveFactor:g,critical:r,status:m}},applyDamage:function(a,b,c){var d=c.getCombatantRoot(),c=c.combo||d.combo;if(c.damageCeiling){d=this.combatant.id;c.damageCeiling.sum[d]||(c.damageCeiling.sum[d]=
0);c.damageCeiling.sum[d]=c.damageCeiling.sum[d]+a.baseOffensiveFactor}a.status&&this.statusStates[b.element-1].inflict(a.status,this,b);this.reduceHp(a.damage)},getHealAmount:function(a){a=!a.absolute?this.getStat("hp")*a.value:a.value;a=a*(0.95+Math.random()*0.1);return a=Math.round(a)},reduceHp:function(a){if(a<0)return this.increaseHp(-a);if(a>0){if(!this.defeated&&this.currentHp<=a){var b=this.getModifier("ONCE_MORE");this.currentHp>0&&b?sc.combat.doDramaticEffect(this.combatant,this.combatant,
sc.DRAMATIC_EFFECT.ONCE_MORE):this.defeated=true}this.currentHp=Math.max(-this.getStat("hp"),this.currentHp-a)}if(this.combatant.party==sc.COMBATANT_PARTY.PLAYER)this.hpHealTimer=2;sc.Model.notifyObserver(this,sc.COMBAT_PARAM_MSG.HP_CHANGED)},setRelativeHp:function(a){this.currentHp=Math.round(this.getStat("hp")*a);sc.Model.notifyObserver(this,sc.COMBAT_PARAM_MSG.HP_CHANGED)},setCritical:function(){this.currentHp=0;sc.Model.notifyObserver(this,sc.COMBAT_PARAM_MSG.HP_CHANGED)},increaseHp:function(a){this.currentHp=
Math.min(this.getStat("hp"),this.currentHp+a);if(this.currentHp>0)this.defeated=false;sc.Model.notifyObserver(this,sc.COMBAT_PARAM_MSG.HP_CHANGED)},getHpFactor:function(){return this.currentHp/this.getStat("hp")},addSp:function(a,b){if(a>0)this.spHoldTimer=5;var b=b||(a>0?this.maxSp:0),c=(sc.SP_REGEN_SPEED[this.maxSp]||1)*(1+this.getModifier("SP_REGEN"));this.currentSp=this.currentSp+a*c;if(a>0&&this.currentSp>b)this.currentSp=b;if(a<0&&this.currentSp<b)this.currentSp=b;sc.Model.notifyObserver(this,
sc.COMBAT_PARAM_MSG.SP_CHANGED,true)},consumeSp:function(a){this.currentSp=this.currentSp-a;if(this.currentSp<0)this.currentSp=0;sc.Model.notifyObserver(this,sc.COMBAT_PARAM_MSG.SP_CHANGED)},setRelativeSp:function(a){this.spHoldTimer=5;this.currentSp=Math.round(this.maxSp*a);sc.Model.notifyObserver(this,sc.COMBAT_PARAM_MSG.SP_CHANGED)},getSp:function(){return Math.floor(this.currentSp)},getRelativeSp:function(){return Math.floor(this.currentSp)/this.maxSp},notifySpConsume:function(a){sc.Model.notifyObserver(this,
sc.COMBAT_PARAM_MSG.SP_CONSUME,a)},setDefeated:function(){this.currentHp=0;this.defeated=true;sc.Model.notifyObserver(this,sc.COMBAT_PARAM_MSG.HP_CHANGED)},isDefeated:function(){return this.defeated&&!this.isLocked()},addItemBuff:function(a,b,c){b=b*(1+this.getModifier("ITEM_BOOST"));a=new sc.ItemBuff(a,b,c);this.removeIntersectingItemBuff(a);for(b=this.getMaxBuffs();this.currentItemBuffs>=b;){for(b=0;!this.buffs[b].itemID;)b++;this.removeBuff(this.buffs[b]);b=this.getMaxBuffs()}this.currentItemBuffs++;
return this.addBuff(a)},removeIntersectingItemBuff:function(a){for(var b=this.buffs.length;b--;){var c=this.buffs[b];c.itemID&&c.intersectsWith(a)&&this.removeBuff(c)}},addBuff:function(a){var b=this.getStat("hp")-this.currentHp;this.buffs.push(a);this.currentHp=this.getStat("hp")-b;sc.Model.notifyObserver(this,sc.COMBAT_PARAM_MSG.BUFF_ADDED,a);sc.Model.notifyObserver(this,sc.COMBAT_PARAM_MSG.STATS_CHANGED);return true},modifyBuff:function(a,b,c){var d=this.currentHp/this.getStat("hp");a.params[b]=
c;this.currentHp=Math.round(this.getStat("hp")*d);sc.Model.notifyObserver(this,sc.COMBAT_PARAM_MSG.STATS_CHANGED);return true},removeBuff:function(a){var b=this.getStat("hp")-this.currentHp;this.buffs.erase(a);a.itemID&&this.currentItemBuffs--;this.currentHp=this.getStat("hp")-b;a.clear();sc.Model.notifyObserver(this,sc.COMBAT_PARAM_MSG.BUFF_REMOVED,a);sc.Model.notifyObserver(this,sc.COMBAT_PARAM_MSG.STATS_CHANGED)},removeAllBuffs:function(){for(var a=this.buffs.length;a--;){this.buffs[a].clear();
this.buffs[a].itemID&&this.currentItemBuffs--}this.buffs.length=0;this.currentHp=this.getStat("hp");sc.Model.notifyObserver(this,sc.COMBAT_PARAM_MSG.BUFFS_CLEARED);sc.Model.notifyObserver(this,sc.COMBAT_PARAM_MSG.STATS_CHANGED)},getMaxBuffs:function(){return 2+this.getModifier("APPETITE")},hasMaxBuffs:function(){return false},update:function(a){if(!this.defeated){var b=ig.system.ingameTick;if(this.combatant.isPlayer&&sc.newgame.get("infinite-sp"))this.currentSp!=this.maxSp&&this.setRelativeSp(1);
else{var c=this.maxSp*sc.SP_REGEN_FACTOR,d=a?0.05:0.25;if(sc.pvp.isActive()){d=d*3;c=this.maxSp}if(this.currentSp<c)this.addSp(b*d,c);else if(this.currentSp>c&&!a)this.spHoldTimer>0?this.spHoldTimer=this.spHoldTimer-b:this.addSp(b*-0.05,c)}if(!a&&this.getHpFactor()<1&&!sc.arena.active){if(!sc.newgame.get("waypoints-heals")||ig.game.playerEntity.atLandmarkHeal){if(this.hpHealTimer<=0){this.hpHealTimer=1;c=Math.round(this.getStat("hp")*1/this.hpRegTime);this.increaseHp(c)}this.hpHealTimer=this.hpHealTimer-
b}}else this.hpHealTimer=1;if(sc.model.isRunning()){for(b=this.statusStates.length;b--;)this.statusStates[b].update(this.combatant,this,a);if(!sc.model.isCutscene())for(b=this.buffs.length;b--;)this.buffs[b].update()&&this.removeBuff(this.buffs[b])}}}});var a=0.25,d=1.5,c=3;sc.COMBAT_PARAM_MSG={HP_CHANGED:1,SP_CHANGED:2,STATS_CHANGED:3,BUFF_ADDED:4,BUFF_REMOVED:5,RESET_STATS:6,MAX_SP_CHANGED:7,SP_CONSUME:8,BUFFS_CLEARED:9};sc.ATTACK_TYPE={NONE:0,LIGHT:1,MEDIUM:2,HEAVY:3,MASSIVE:4,BREAK:5};sc.ATTACK_SOUND_TYPE=
{BLUNT:0,SLASH:1};sc.GUARDABLE={AUTO:0,NEVER:1,FROM_ABOVE:2,ALWAYS:3};var e={};sc.ATTACK_LIMITER={NO_DAMAGE:{noDmg:true},ONLY_HIT_PROXY:{onlyHitProxy:true},SIGNAL:{noDmg:true,noAggro:true},NO_EFFECT:{noDmg:true,noAggro:true,noEffect:true},NO_HIT_PROXY:{noHitProxy:true}};sc.ATTACK_SKILL_BONUS={MELEE_DMG:1,RANGED_DMG:2};sc.AttackInfo=ig.Class.extend({type:sc.ATTACK_TYPE.LIGHT,visualType:null,soundType:sc.ATTACK_SOUND_TYPE.SLASH,attackerParams:null,reverse:true,ballDamage:false,hints:null,damageFactor:1,
defenseFactor:1,statusInflict:0,element:sc.ELEMENT.NEUTRAL,critFactor:1,spFactor:0,spRepeatFactor:1,fly:null,stunSteps:[],skillBonus:null,guardable:null,limiter:null,hitInvincible:false,noIronStance:false,noHack:false,init:function(a,b,c){this.attackerParams=a;if(b.type!=void 0)this.type=typeof b.type=="string"?sc.ATTACK_TYPE[b.type]:b.type;this.visualType=b.visualType?typeof b.visualType=="string"?sc.ATTACK_TYPE[b.visualType]:b.visualType:this.type;if(b.damageFactor!=void 0)this.damageFactor=b.damageFactor*
1;if(b.defenseFactor!=void 0)this.defenseFactor=b.defenseFactor*1;if(b.element)this.element=typeof b.element=="string"?sc.ELEMENT[b.element]:b.element;this.spFactor=b.spFactor||0;this.fly=b.fly||null;this.reverse=b.reverse||false;if(b.critFactor!=void 0)this.critFactor=b.critFactor;if(b.stunSteps)for(var a=b.stunSteps,d=a.length;d--;)this.stunSteps.push(new sc.COMBAT_STUN[a[d].type](a[d]));this.guardable=sc.GUARDABLE[b.guardable]||sc.GUARDABLE.AUTO;this.statusInflict=b.status||0;this.hints=b.hints||
null;this.skillBonus=b.skillBonus||null;this.limiter=sc.ATTACK_LIMITER[b.limiter]||e;this.hitInvincible=b.hitInvincible||false;this.noIronStance=b.noIronStance||false;this.noHack=b.noHack||false;if(this.skillBonus=="MELEE_DMG")this.ballDamage=false;else if(this.skillBonus=="RANGED_DMG"||c)this.ballDamage=true},hasHint:function(a){return this.hints&&this.hints.indexOf(a)!=-1},hasNoEffect:function(){return this.limiter.noEffect}});sc.HealInfo=ig.Class.extend({healerParams:null,value:0,absolute:false,
init:function(a,b){this.healerParams=a;this.value=b.value||0;this.absolute=b.absolute||false},clone:function(){return new sc.HealInfo(this.healerParams,{value:this.value,absolute:this.absolute})}})});ig.baked=!0;
ig.module("game.feature.combat.entities.projectile").requires("game.constants","impact.feature.effect.effect-sheet","impact.base.entity").defines(function(){ig.PROJECTILE_KILL_TYPE={WALL:1,AIR:2,OTHER:3};ig.ENTITY.Projectile=ig.AnimatedEntity.extend({speedVary:{_type:"Number",_info:"Speed variance. Value will be applied +- 50%"},combatant:null,hitProxy:null,remainingHits:3,maxHits:3,alreadyCollided:[],skipBounce:false,noMoveRotate:false,init:function(b,a,d,c){this.parent(b,a,d,c);this.coll.type=ig.COLLTYPE.PROJECTILE;
this.coll.bounciness=1;this.coll.accelSpeed=0;this.coll.friction.air=0;this.coll.friction.ground=0;this.coll.minBounceVelocity=0;this.coll.vel.x=c.vel.x;this.coll.vel.y=c.vel.y;this.combatant=c.combatant||null;this.animState.angle=Vec3.clockangle(this.coll.vel);this.hitProxy=this.combatant.combo.hitProxy},spawnHitProxy:function(b,a,d){this.hitProxy&&this.hitProxy.spawn(b,this.combatant,this.coll.vel,a,d)},update:function(){this.animState.angle=this.noMoveRotate?0:Vec3.clockangle(this.coll.vel);this.parent()},
handleMovementTrace:function(b){if(!this._killed){if(b.collided){this.alreadyCollided.length=0;var a=this.getCenter();a.x=a.x+b.blockDir.x*this.coll.size.x/2.05;a.y=a.y+b.blockDir.y*this.coll.size.y/2.05;if(!this.remainingHits){if(this.onProjectileKill)this.onProjectileKill(ig.PROJECTILE_KILL_TYPE.WALL,a,b);this.kill();return}this.remainingHits--;if(this.onBounce)this.onBounce(a,b)}this.skipBounce?this.skipBounce=false:this.parent(b)}},onKill:function(b){this.parent(b)},collideWith:function(b){if(!(b.coll.subColls.length>
0)){var a=b.coll.parentColl?b.coll.parentColl.entity:b;if(this.alreadyCollided.indexOf(a.id)==-1){var d=false;this.onProjectileHit&&(d=!this.onProjectileHit(b,this.coll._collData&&this.coll._collData.blockDir));d||this.alreadyCollided.push(a.id)}}},clearIgnored:function(){this.alreadyCollided.length=0},addIgnore:function(b){this.alreadyCollided.push(b.id)},getHitCenter:function(b,a){return this.getOverlapCenterCoords(b,a)},getHitVel:function(b,a){var d=a||{};Vec2.assign(d,this.coll.vel);return d},
getElement:function(){return sc.ELEMENT.NEUTRAL},getCombatant:function(){return this.combatant},getCombatantRoot:function(){return this.combatant.getCombatantRoot()},getAttackInfo:function(){return this.attackInfo}})});ig.baked=!0;
ig.module("game.feature.combat.model.ball-behavior").defines(function(){sc.BallBehavior=ig.Class.extend({onInit:function(){},onUpdate:function(){}});sc.BALL_BEHAVIOR={};var b=Vec2.create(),a=Vec2.create();sc.BALL_BEHAVIOR.FOLLOW_TARGET=sc.BallBehavior.extend({steerDegree:0,adjustTime:0,_wm:new ig.Config({attributes:{steerDegree:{_type:"Number",_info:"How much does the entity steer in per second? 0 = not at all, 1 = a full circle"},adjustTime:{_type:"Number",_info:"steerDegree is linearly scaled from 0 to max during adjustTime at beginning"}}}),
init:function(a){this.steerDegree=a.steerDegree||1;this.adjustTime=a.adjustTime||0},onUpdate:function(a){var b=a.getTarget();b&&sc.BallTools.adjustDirection(a,b,a.maxTime-a.timer,this.adjustTime,this.steerDegree)}});sc.BALL_BEHAVIOR.CLOSE_SELF_DESTRUCT=sc.BallBehavior.extend({distance:0,_wm:new ig.Config({attributes:{distance:{_type:"Number",_info:"Min Distance to target when to self destruct"}}}),init:function(a){this.distance=a.distance||1},onUpdate:function(a){var b=a.getTarget();b&&ig.CollTools.getGroundDistance(a.coll,
b.coll)<this.distance&&a.destroy()}});var d=Vec2.create();sc.BALL_BEHAVIOR.WIRL_SIDEWAYS=sc.BallBehavior.extend({relWirl:0.2,wirlTime:0.5,delay:0,_wm:new ig.Config({attributes:{relWirl:{_type:"Number",_info:"How much to wirl sideways",_default:0.2},wirlTime:{_type:"Number",_info:"How long one whirling takes",_default:0.5},delay:{_type:"Number",_info:"Delay before wirling starts",_default:0}}}),init:function(a){this.relWirl=a.relWirl||0.2;this.wirlTime=a.wirlTime||0.5;this.delay=a.delay||0},onUpdate:function(a){var b=
a.maxTime-a.timer;if(!(b<this.delay)){var b=b-this.delay,b=Math.sin(Math.PI*2*b/this.wirlTime+Math.PI*0.52)*this.relWirl*ig.system.tick*60,f=Vec2.assign(d,a.coll.vel);Vec2.rotate90CW(f);Vec2.mulF(f,b);Vec2.add(a.coll.vel,f)}}});sc.BALL_BEHAVIOR.SLOW_DOWN=sc.BallBehavior.extend({speedFactor:0,startWait:0,fadeOut:0,fadeOutVary:0,pause:0,fadeIn:0,_wm:new ig.Config({attributes:{speedFactor:{_type:"Number",_info:"How much to slowdown",_default:0.05},startWait:{_type:"Number",_info:"How long to wait at before slowdown",
_default:0},fadeOut:{_type:"Number",_info:"How quickly speed will be faded out.",_default:0},fadeOutVary:{_type:"Number",_info:"Variation added to fadeOut. Total = fadeOut +- fadeOutVary",_default:0},pause:{_type:"Number",_info:"How long slow down stays after fadeOut",_default:0},pauseVary:{_type:"Number",_info:"Variation to pause. Total = pause +- pauseVary",_default:0},fadeIn:{_type:"Number",_info:"fadeIn time after slowdown.",_default:0}}}),init:function(a){this.speedFactor=a.speedFactor||0.05;
this.startWait=a.startWait||0;this.fadeOut=a.fadeOut||0;this.fadeOutVary=a.fadeOutVary||0;this.pause=a.pause||0;this.pauseVary=a.pauseVary||0;this.fadeIn=a.fadeIn||0},onInit:function(a){var b=Math.random();a.behaviorData.fadeOutTime=this.fadeOut+(0.5-b)*2*this.fadeOutVary;a.behaviorData.pauseTime=this.pause+(0.5-b)*2*this.pauseVary},onUpdate:function(a){var b=a.behaviorData.fadeOutTime,d=a.behaviorData.pauseTime,g=a.maxTime-a.timer,g=g-this.startWait,h=1;g>=0&&(g<b?h=1-g/b:g<b+d?h=0:g<b+d+this.fadeIn&&
(h=h*((g-d-b)/this.fadeIn)));Vec2.length(a.coll.vel,a.speed*(h+(1-h)*this.speedFactor))}});sc.BallTools={};sc.BallTools.adjustDirection=function(c,d,f,g,h){f=f<g?h*f/g:h;d=d.getCenter(b);g=c.getCenter(a);d=Vec2.sub(d,g);g=Vec2.length(c.coll.vel);Vec2.rotateToward(c.coll.vel,d,Math.PI*2*f*ig.system.tick);Vec2.length(c.coll.vel,g)}});ig.baked=!0;
ig.module("game.feature.combat.model.proxy").defines(function(){sc.ProxySpawnerBase=ig.Class.extend({spawn:function(){}});sc.PROXY_TYPE={};sc.ProxyTools={prepareSrc:function(b){return typeof b=="object"?new sc.PROXY_TYPE[b.type](b):b},getProxy:function(b,a){if(typeof b=="object")return b;var d=a.getCombatantRoot();return d.proxies&&d.proxies[b]},getSize:function(b){Vec3.assignC(b,0,0,0);return b},releaseSrc:function(b){typeof b=="object"&&b.clearCached()}};sc.COMBAT_HIT_PROXY_POS={SELF:function(b,
a,d,c){a.getAlignedPos(c,b)},TARGET:function(b,a,d,c){return d.getAlignedPos(c,b)},HIT_POS:function(b,a,d,c,e){return Vec3.assign(b,e)}};sc.PROXY_BREAK_TYPE={NEVER:1,ACTION:2,COMBATANT:3,COLLABORATION:4};sc.HitProxyConnect=ig.Class.extend({proxy:null,pos:null,align:0,offset:Vec3.create(),init:function(b,a,d,c){this.proxy=b;this.pos=a||sc.COMBAT_HIT_PROXY_POS.SELF;this.align=d||ig.ENTITY_ALIGN.BOTTOM;c&&Vec3.assign(this.offset,c)},spawn:function(b,a,d,c,e){var f=Vec3.create();this.pos(f,a,b,this.align,
e);Vec3.add(f,this.offset);a=this.proxy.spawn(f.x,f.y,f.z,a,d);a.target=b;c&&a.setAttribute&&a.setAttribute("damage",c.damage)}})});ig.baked=!0;
ig.module("game.feature.combat.entities.ball").requires("game.feature.combat.entities.projectile","game.feature.combat.model.ball-behavior","game.feature.combat.model.proxy","game.constants","impact.feature.effect.effect-sheet","impact.base.entity","impact.feature.light.light").defines(function(){sc.BallInfo=sc.PROXY_TYPE.BALL=sc.ProxySpawnerBase.extend({data:null,_wm:new ig.Config({attributes:{animation:{_type:"AnimSheet",_info:"Animation sheet of ball. Needs one entry with name 'default'",_popup:true},
size:{_type:"Offset",_info:"Size of projectile",_optional:true},effects:{_type:"String",_info:"Effect sheet for effects",_select:"effects",_withNull:true},effectKeys:{_type:"EffectKets",_info:"What keys to use in the effect sheet",_optional:true},speed:{_type:"Number",_info:"Speed of ball",_default:300},maxBounce:{_type:"Integer",_info:"Number of times the ball can bounce on walls"},timer:{_type:"Number",_info:"The time until ball will disappear"},attack:{_type:"AttackInfo",_info:"How the ball will hit its target"},
timeBoni:{_type:"BallBoni",_info:"Damage boni depending on time the ball is alive"},behaviors:{_type:"BallBehaviors",_info:"Additional Behaviors of the ball"},trail:{_type:"Boolean",_info:"True if ball should show a trail"},multiHit:{_type:"Boolean",_info:"True if ball can hit multiple targets"},light:{_type:"String",_info:"Size of light shown for this ball",_optional:true,_select:ig.LIGHT_SIZE},noLightGlow:{_type:"Boolean",_info:"If true, don't make light glow for ball"},destroyProxy:{_type:"ProxyRef",
_info:"Proxy to be spawned when ball is destroyed",_optional:true},bounceProxy:{_type:"ProxyRef",_info:"Proxy to be spawned when ball bounces on wall",_optional:true},timeConnect:{_type:"Boolean",_info:"If true: connect proxy to time of owner.",_optional:true},hitSideways:{_type:"Boolean",_info:"If true: Make combatant fly sideways when hit",_optional:true},noMoveRotate:{_type:"Boolean",_info:"If true: Do not rotate sprite along movement direction",_optional:true},shadow:{_type:"Number",_info:"Size of shadow. Otherwise will be 4. Set 0 to hide shadow.",
_optional:true}}}),init:function(a){this.data=a;a.animation.shapeType||(a.animation.shapeType="YZ_EXPAND");a.animation.wallY=1;a.animation=new ig.AnimationSheet(a.animation);a.effects&&(a.effects=new ig.EffectSheet(a.effects));if(a.timeBoni)for(var b=a.timeBoni.length;b--;){var c=ig.copy(a.attack);ig.merge(c,a.timeBoni[b]);a.timeBoni[b]=c}if(a.behaviors)for(b=a.behaviors.length;b--;)a.behaviors[b]=new sc.BALL_BEHAVIOR[a.behaviors[b].type](a.behaviors[b])},getSize:function(a){this.data.size?Vec3.assign(a,
this.data.size):Vec3.assignC(a,8,8,8);return a},clearCached:function(){this.data.effects&&this.data.effects.decreaseRef();this.data.animation&&this.data.animation.clearCached()},spawn:function(a,b,c,d,i){i={dir:i,ballInfo:this.data,params:d.getCombatantRoot().params,party:d.party,combatant:d};d.getCombatantRoot().isPlayer&&sc.stats.addMap("player","throws",1);return ig.game.spawnEntity(ig.ENTITY.Ball,a,b,c,i)}});var b=Vec2.create(),a=Vec3.create(),d=Vec3.create();ig.ENTITY.Ball=ig.ENTITY.Projectile.extend({isBall:true,
party:0,target:null,params:null,attackInfo:null,multiHit:false,maxTime:0,timer:1.5,timeBoni:[],effects:null,effectKeys:null,speed:0,speedFactor:1,lightHandle:null,grab:null,destroyProxySrc:null,bounceProxySrc:null,behaviors:null,behaviorData:null,hitSideways:false,init:function(a,b,c,d){this.parent(a,b,c,{vel:d.dir,combatant:d.combatant});this.party=d.party;this.params=d.params;this.setBallInfo(d.ballInfo);this.remainingHits=this.maxHits;this.timer=this.maxTime;this.totalTimer=0},getTarget:function(){return this.target&&
this.target.replaceTargets?this.target.replaceTargets[0]:this.target},setBallInfo:function(b,c){var d=this.coll;this.speed=b.speed;Vec2.length(d.vel,this.speed);var h=b.size;this.hitSideways=b.hitSideways;var i=Vec3.assign(a,d.size);h?d.setSize(h.x,h.y,h.z):d.setSize(8,8,8);d.setPos(d.pos.x-(this.coll.size.x-i.x)/2,d.pos.y-(this.coll.size.y-i.y)/2,d.pos.z);this.coll.shadow.size=b.shadow!==void 0?b.shadow:4;this.coll.type=ig.COLLTYPE.PROJECTILE;if(this.combatant)this.target=this.combatant.getTarget(true);
this.behaviors=b.behaviors||null;this.animSheet=b.animation;this.initAnimations(b.animation);this.coll.maxVel=b.speed;this.effects=b.effects;this.effectKeys=b.effectKeys||null;this.multiHit=b.multiHit||false;this.maxHits=b.maxBounce;this.maxTime=b.timer;this.noMoveRotate=b.noMoveRotate||false;if(b.destroyProxy)this.destroyProxySrc=sc.ProxyTools.prepareSrc(b.destroyProxy);if(b.bounceProxy)this.bounceProxySrc=sc.ProxyTools.prepareSrc(b.bounceProxy);if(b.timeConnect)this.coll.time.parent=this.combatant.coll;
if(b.attack){d=new sc.AttackInfo(this.params,b.attack,true);if(c&&this.attackInfo){d.damageFactor=this.attackInfo.damageFactor;d.defenseFactor=this.attackInfo.defenseFactor;d.spFactor=this.attackInfo.spFactor}this.attackInfo=d}this.timeBoni.length=0;if(b.timeBoni)for(d=0;d<b.timeBoni.length;++d)this.timeBoni[d]={time:b.timeBoni[d].time,attackInfo:new sc.AttackInfo(this.params,b.timeBoni[d],true)};ig.EffectTools.clearEffects(this,"trail");b.trail&&this.effects.spawnOnTarget(this.effectKeys&&this.effectKeys.trail||
"ballTrail",this,{duration:-1,group:"trail"});this.lightHandle&&this.lightHandle.stop();d=ig.LIGHT_SIZE[b.light||"XS"];if(d!=ig.LIGHT_SIZE.NONE){this.lightHandle=new ig.LightHandle(this,d,0,0,-1,1,!b.noLightGlow);ig.light.addLightHandle(this.lightHandle)}if(this.behaviors){this.behaviorData={};for(d=this.behaviors.length;d--;)this.behaviors[d].onInit(this)}},grabPoint:function(a,b){this.grab&&Vec3.assign(this.coll.vel,this.grab.oldVel);var b=b||1,c=Vec3.sub(a,this.coll.pos,d),h=Vec3.length(c)/(this.speed*
b);this.grab={pos:Vec3.create(a),oldPos:Vec3.create(this.coll.pos),timer:new ig.WeightTimer(false,h,ig.TIMER_MODE.ONCE),oldVel:Vec3.create(this.coll.vel)};Vec3.assign(this.coll.vel,c);Vec3.length(this.coll.vel,5);return h},changeSpeed:function(a,b){this.speed=this.speed*a;this.coll.maxVel=this.speed;Vec2.length(this.coll.vel,this.speed);this.timer=this.timer/a;this.maxTime=this.maxTime/a;if(b)this.speedFactor=this.speedFactor*a},resetSpeed:function(){if(this.speedFactor!=1){this.changeSpeed(1/this.speedFactor);
this.speedFactor=1;return true}return false},changeDirection:function(a){Vec2.assign(this.coll.vel,a);Vec2.length(this.coll.vel,this.speed)},onBounce:function(a,b){if(this.bounceProxySrc)this._spawnBounceProxy(a,b);else if(this.effects){var c=this.effects.spawnFixed(this.effectKeys&&this.effectKeys.bounce||"ballBounce",a.x,a.y,this.coll.pos.z,null,{angle:Vec2.clockangle(b.blockDir)});c&&this.coll.time.parent&&c.setTimeEntity(this.coll.time.parent.entity)}},destroy:function(){this.onProjectileKill(ig.PROJECTILE_KILL_TYPE.OTHER);
this.kill()},_spawnBounceProxy:function(a,c){var d=this.getCombatant(),h=sc.ProxyTools.getProxy(this.bounceProxySrc,d);if(h){Vec2.assign(b,c.blockDir);Vec2.flip(b);h.spawn(a.x,a.y,this.coll.pos.z,d,b)}},onProjectileKill:function(a,b,c){if(this.destroyProxySrc){var h=this.getCombatant();if(b=sc.ProxyTools.getProxy(this.destroyProxySrc,h)){c=this.coll.vel;a=this.getAlignedPos(ig.ENTITY_ALIGN.CENTER,d);b.spawn(a.x,a.y,a.z,h,c)}}else if(b&&this.bounceProxySrc)this._spawnBounceProxy(b,c);else if(a!=ig.PROJECTILE_KILL_TYPE.OTHER&&
this.effects){if(a==ig.PROJECTILE_KILL_TYPE.WALL){a=this.effectKeys&&this.effectKeys.wall||"ballWallKill";this.effects.hasEffect(a)&&(h=this.effects.spawnFixed(a,b.x,b.y,this.coll.pos.z,null,{angle:Vec2.clockangle(c.blockDir)}))}else{b=this.getCenter();a=this.effectKeys&&this.effectKeys.air||"ballAirKill";this.effects.hasEffect(a)&&(h=this.effects.spawnFixed(a,b.x,b.y,this.coll.pos.z))}h&&this.coll.time.parent&&h.setTimeEntity(this.coll.time.parent.entity)}},onProjectileHit:function(a,b){var c=false;
if(!this.attackInfo||!this.attackInfo.hasNoEffect()){if(a.ballHit){var d=a.ballHit(this,b);(c=d)&&!this.multiHit&&this.destroy();if(a.coll.type==ig.COLLTYPE.IGNORE&&this.multiHit)this.skipBounce=true}if(this.attackInfo&&a.damage&&a.party!=this.party){d=this.attackInfo;this.party==sc.COMBATANT_PARTY.ENEMY&&(c=true);for(var i=0;i<this.timeBoni.length&&this.timeBoni[i].time>this.timer;)++i;if(i<this.timeBoni.length)d=this.timeBoni[i].attackInfo;if(a.damage(this,d)){c=true;this.multiHit||this.destroy()}}}c&&
this.combatant.getCombatantRoot().isPlayer&&sc.stats.addMap("player","throwHits",1);return c},update:function(){if(this.grab){this.grab.timer.tick();var a=this.grab.timer.get();Vec3.lerp(this.grab.oldPos,this.grab.pos,a,d);this.coll.setPos(d.x,d.y,d.z);if(this.grab.timer.done()){Vec3.assign(this.coll.vel,this.grab.oldVel);this.grab=null}}else if(this.behaviors)for(a=this.behaviors.length;a--;)this.behaviors[a].onUpdate(this);if(this.timer>0){this.timer=this.timer-ig.system.tick;if(this.timer<=0){this.onProjectileKill(ig.PROJECTILE_KILL_TYPE.AIR);
this.kill()}}this.totalTimer=this.totalTimer+ig.system.tick;this.parent()},getElement:function(){return this.attackInfo&&this.attackInfo.element||sc.ELEMENT.NEUTRAL},getHitVel:function(a,b){var d=b||{};this.grab?Vec2.assign(d,this.grab.oldVel):Vec2.assign(d,this.coll.vel);if(this.hitSideways){Vec2.rotate90CW(d);var h=ig.CollTools.getDistVec2(this.coll,a.coll,c);Vec2.addMulF(h,a.coll.vel,-ig.system.tick);Vec2.dot(h,d)<0&&Vec2.flip(d)}return d},resetBounceCount:function(){this.remainingHits=this.maxHits},
resetTime:function(a){this.timer=a||this.maxTime},cleanDirection:function(a){Vec2.round(this.coll.vel,Math.PI*2*a)}});var c=Vec2.create()});ig.baked=!0;
ig.module("game.feature.player.player-config").defines(function(){sc.PLAYER={};sc.PLAYER_CLASSES={SPHEROMANCER:0,TRIBLADER:1,QUADROGUARD:2,PENTAFIST:3,HEXACAST:4,UNKNOWN:5};sc.PLAYER_ACTION={AIM_START:1,THROW_NORMAL:2,THROW_NORMAL_REV:3,THROW_CHARGED:4,THROW_CHARGED_REV:5,ATTACK:6,ATTACK_REV:7,ATTACK_FINISHER:8,DASH:9,DASH_SLOW:10,CHARGING:11,GUARD:12,PERFECT_GUARD:13,THROW_SPECIAL1:21,THROW_SPECIAL2:22,THROW_SPECIAL3:23,ATTACK_SPECIAL1:24,ATTACK_SPECIAL2:25,ATTACK_SPECIAL3:26,DASH_SPECIAL1:27,DASH_SPECIAL2:28,
DASH_SPECIAL3:29,GUARD_SPECIAL1:30,GUARD_SPECIAL2:31,GUARD_SPECIAL3:32,DASH_LONG:33};var b={AIM_START:true,THROW_NORMAL:false,THROW_NORMAL_REV:false,THROW_CHARGED:false,THROW_CHARGED_REV:false,ATTACK:false,ATTACK_REV:false,ATTACK_FINISHER:false,DASH:false,DASH_SLOW:false,DASH_LONG:false,GUARD:true,CHARGING:false};sc.PLAYER_SP_COST=[1,3,6];sc.PlayerConfig=ig.JsonLoadable.extend({cacheType:"PlayerConfig",name:null,clazz:null,character:null,combatStyle:{comboCount:4,throwCount:4,throwProb:0.5,sidewaySpeed:1,
normDistance:120,meleeDistance:24,minDistance:48},animSheet:null,proxies:{},headIdx:0,stats:null,autoequip:null,baseConfig:[],elementConfigs:{},skillRanking:[],init:function(a){this.name=a;this.parent(a.toLowerCase())},getJsonPath:function(){return ig.root+this.path.toPath("data/players/",".json")+ig.getCacheSuffix()},onload:function(a){var b;b=ig.jsonTemplate.resolve(a);if(!b)throw Error("Can't find data of player '"+f+"'");for(var e in b.proxies){a=b.proxies[e];this.proxies[e]=new sc.PROXY_TYPE[a.type||
"BALL"](a)}this.clazz=b["class"];this.character=new sc.Character(b.character);this.animSheet=new ig.AnimationSheet(b.sheet);this.stats=b.stats;a=b.combatStyle||{};this.combatStyle.comboCount=a.comboCount||4;this.combatStyle.throwCount=a.throwCount||4;this.combatStyle.throwProb=a.throwProb||0;this.combatStyle.sidewaySpeed=a.sidewaySpeed||1;this.combatStyle.normDistance=a.normDistance||120;this.combatStyle.meleeDistance=a.meleeDistance||24;this.combatStyle.minDistance=a.minDistance||48;this.combatStyle.foodSprites=
a.foodSprites||null;this.combatStyle.foodOffset=a.foodOffset||null;this.combatStyle.foodBubbleOffset=a.foodBubbleOffset||null;this.walkAnims=b.walkAnims;if(this.autoequip=b.autoequip)for(a=0;a<this.autoequip.length;++a)this.autoequip[a].condition&&(this.autoequip[a].condition=new ig.VarCondition(this.autoequip[a].condition));this.headIdx=b.headIdx||0;this.baseConfig=new sc.PlayerSubConfig("BASE",b.actions.BASE);for(var f in sc.ELEMENT)this.elementConfigs[sc.ELEMENT[f]]=new sc.PlayerSubConfig(f,b.actions[f]);
if(b=b.skillRanking)for(a=0;a<b.length;++a)this.skillRanking.push(b[a].skill)},getCacheKey:function(a){return a},onCacheCleared:function(){this.character.decreaseRef();this.baseConfig.clearCached();for(var a in this.elementConfigs[a])this.elementConfigs[a].clearCached();for(var b in this.proxies)this.proxies[b].clearCached()}});sc.PlayerConfig.getElementBall=function(a,b,e){e=e?"charged":"default";b==sc.ELEMENT.NEUTRAL?e=e+"Neutral":b==sc.ELEMENT.HEAT?e=e+"Heat":b==sc.ELEMENT.COLD?e=e+"Cold":b==sc.ELEMENT.WAVE?
e=e+"Wave":b==sc.ELEMENT.SHOCK&&(e=e+"Shock");return a.proxies[e]};var a={NEUTRAL:{hp:1,attack:1,defense:1,focus:1,elemFactor:[1,1,1,1]},HEAT:{hp:1,attack:1,defense:1,focus:1,elemFactor:[1,1.5,1,1]},COLD:{hp:1,attack:1,defense:1,focus:1,elemFactor:[1.5,1,1,1]},SHOCK:{hp:1,attack:1,defense:1,focus:1,elemFactor:[1,1,1,1.5]},WAVE:{hp:1,attack:1,defense:1,focus:1,elemFactor:[1,1,1.5,1]}};sc.ACTION_DMG_TYPE={MELEE:1,RANGED:2,NONE:3,MIXED:4};sc.ACTION_STUN_TYPE={INTERRUPT:1,LOCK:2};sc.PlayerAction=ig.Class.extend({action:null,
key:null,name:null,description:null,dmgType:null,stunType:false,status:false,init:function(a,c,e){this.key=a;if(c&&c.steps){this.action=new ig.Action(a,c.steps,b[a]);this.name=c.name?new ig.LangLabel(c.name):null;this.description=c.description?new ig.LangLabel(c.description):null;this.dmgType=sc.ACTION_DMG_TYPE[c.dmgType]||null;this.stunType=sc.ACTION_STUN_TYPE[c.stunType]||false;this.status=c.status||false;this.icon=sc.getCombatArtIcon(e,this.key)}else this.action=new ig.Action(a,c,b[a])},clearCached:function(){this.action.clearCached()}});
sc.PlayerSubConfig=ig.Class.extend({paramFactors:null,skillFactors:{},actions:{},baseParams:{},modifiers:{},activeBalls:{},activeActions:{},init:function(b,c){this.paramFactors=a[b]||null;var e=b=="BASE"?-1:sc.ELEMENT[b],f;for(f in c)this.actions[f]=new sc.PlayerAction(f,c[f],e);this.preSkillInit()},clearCached:function(){for(var a in this.actions)this.actions[a].clearCached()},preSkillInit:function(){this.skillFactors.hp=0;this.skillFactors.attack=0;this.skillFactors.defense=0;this.skillFactors.focus=
0;this.skillFactors.elemFactor||(this.skillFactors.elemFactor=[]);this.skillFactors.elemFactor[sc.ELEMENT.HEAT-1]=0;this.skillFactors.elemFactor[sc.ELEMENT.COLD-1]=0;this.skillFactors.elemFactor[sc.ELEMENT.SHOCK-1]=0;this.skillFactors.elemFactor[sc.ELEMENT.WAVE-1]=0;for(var a in sc.MODIFIERS)this.skillFactors[a]=0;this.activeBalls={};for(var b in this.proxies)this.activeBalls[b]=this.proxies[b];this.activeActions={};for(var e in sc.PLAYER_ACTION)this.actions[e]&&(this.activeActions[sc.PLAYER_ACTION[e]]=
this.actions[e])},update:function(a,b){if(this.paramFactors){for(var e in a)this.baseParams[e]=Math.floor(a[e]*(this.paramFactors[e]+this.skillFactors[e]));this.baseParams.elemFactor=this.baseParams.elemFactor||[];var f=a.elemFactor;for(e=0;e<this.paramFactors.elemFactor.length;++e)this.baseParams.elemFactor[e]=(2-f[e])*(this.paramFactors.elemFactor[e]+this.skillFactors.elemFactor[e]);for(var g in sc.MODIFIERS){e=0;b&&b[g]!==void 0&&(e=b[g]-1);e=e+this.skillFactors[g];this.modifiers[g]=e}}},getParam:function(a){return this.baseParams[a]},
getParamFactor:function(a){return this.paramFactors[a]},getPlayerAction:function(a){return this.actions[a]},getActiveCombatArtName:function(a){return this.activeActions[a]&&this.activeActions[a].name},getAction:function(a){return this.activeActions[a]&&this.activeActions[a].action},getActionMaxLevel:function(a){for(var b=0;b<3;++b)if(!this.getAction(sc.PLAYER_ACTION[a+(b+1)]))break;return b},getBalls:function(){return this.activeBalls}})});ig.baked=!0;
ig.module("game.feature.player.player-level").defines(function(){function b(a,b){var c=b-a,e=1;switch(c){case -5:e=0.01;break;case -4:e=0.0625;break;case -3:e=0.125;break;case -2:e=0.25;break;case -1:e=0.5;break;case 0:e=1;break;case 1:e=1.1;break;case 2:e=1.3;break;case 3:e=1.5;break;case 4:e=1.7;break;case 5:e=1.9;break;case 6:e=2.1;break;case 7:e=2.3;break;case 8:e=2.5;break;default:e=c<0?0.01:2.5}return e}sc.LEVEL_CURVES={REGULAR:{getFactor:function(a,d){return b(a,d)*(100/(99+a))}},STATIC_REGULAR:{getFactor:function(a,
d){return b(a,d)},ignorePartyCount:true},QUEST:{getFactor:function(a,b){if(a<=b)return 1;switch(b-a){case -1:return 1;case -2:return 1;case -3:return 1;case -4:return 0.8;case -5:return 0.6;case -6:return 0.4;case -7:return 0.2;case -8:return 0.1;default:return 0.05}},ignorePartyCount:true}};sc.PlayerLevelTools={computeBaseParams:function(a,b,c){for(var e in b){var f=b[e].base,g=b[e].increase,h=Math.sin(Math.PI*2*(c/4+b[e].variance)),i,j;i=(Math.pow(1.25,c/10)-1)/(Math.pow(1.25,10)-1);j=Math.log(1.25)/
10*Math.pow(1.25,c/10)/(Math.pow(1.25,10)-1);j=j*g*0.5;a[e]=f+Math.floor(g*i+h*j)}},computeExp:function(a,b,c,e,f,g){g=g||sc.LEVEL_CURVES.REGULAR;b=g.getFactor(b,c);a=f?0:Math.max(1,Math.floor(a*b*(e!=void 0?e:1)));return a=a*sc.newgame.getEXPMultiplier()},updateEquipStats:function(a,b,c){for(var e in a)if(a[e]>=0){var f=sc.inventory.getItem(a[e]),g=f.params;b.hp=b.hp+Math.floor(g.hp||0);b.attack=b.attack+Math.floor(g.attack||0);b.defense=b.defense+Math.floor(g.defense||0);b.focus=b.focus+Math.floor(g.focus||
0);if(g.elemFactor)for(var h=4;h--;){var i=Math.round(b.elemFactor[h]*100)+Math.round((g.elemFactor[h]||1)*100-100);b.elemFactor[h]=Math.min(sc.MAX_MOD_VAL,i)/100}var f=f.properties,j;for(j in f)if(sc.MODIFIERS[j])if(c[j]){g=c[j];g=Math.round(g*100)+Math.round(f[j]*100-100);c[j]=Math.min(sc.MAX_MOD_VAL,g)/100}else c[j]=f[j]}},autoequip:function(a,b,c,e,f,g){if(b){for(var h=0,i=0;i<b.length;++i)if(b[i].level)if(b[i].level<=c)h=i;else break;for(i=h;i<b.length;++i){h=b[i];if(!g&&h.condition&&!h.condition.evaluate())break;
if(h.level&&h.level<=e){var c=h.level,j;for(j in sc.MENU_EQUIP_BODYPART){var k=sc.MENU_EQUIP_BODYPART[j],l=h[j];if(l){f&&a.addItem(l,1,true);a.setEquipment(k,l)}}}else if(h.level>e)break}return c}},equip:function(a,b,c){var e;switch(b){case sc.MENU_EQUIP_BODYPART.HEAD:e=a.head;a.head=c;break;case sc.MENU_EQUIP_BODYPART.LEFT_ARM:e=a.leftArm;a.leftArm=c;break;case sc.MENU_EQUIP_BODYPART.RIGHT_ARM:e=a.rightArm;a.rightArm=c;break;case sc.MENU_EQUIP_BODYPART.TORSO:e=a.torso;a.torso=c;break;case sc.MENU_EQUIP_BODYPART.FEET:e=
a.feet;a.feet=c}return e}}});ig.baked=!0;
ig.module("game.feature.player.player-model").requires("game.feature.model.base-model","game.feature.combat.model.combat-params","game.feature.combat.entities.ball","game.feature.player.player-config","game.feature.achievements.stats-model","game.feature.player.player-level","game.feature.inventory.inventory").defines(function(){var b={id:0,equipID:0,amount:0,skip:false,unequip:false},a=null,d=null,c,e,f=[0,2,3,1,4];sc.ITEM_USE_TIMER=10;sc.ITEM_MAX_FAVS=12;sc.PLAYER_MSG={ELEMENT_MODE_CHANGE:1,CREDIT_CHANGE:2,
EXP_CHANGE:3,LEVEL_CHANGE:4,EQUIP_CHANGE:5,CP_CHANGE:6,SKILL_CHANGED:7,SKILL_BRANCH_SWAP:8,RESET_PLAYER:9,ITEM_OBTAINED:10,SET_PARAMS:11,CONFIG_CHANGED:12,ITEM_USED:13,STATS_CHANGED:14,ITEM_REMOVED:15,ITEM_BLOCK_FINISH:16,ITEM_FAVORITES_CHANGED:17,ITEM_EQUIP_UPDATE:18,ITEM_CONSUME_START:19,ITEM_CONSUME_END:20,CORE_CHANGED:21,ITEM_TOGGLED:22};sc.PLAYER_CORE={MOVE:1,CHARGE:2,DASH:3,CLOSE_COMBAT:4,GUARD:5,CREDITS:6,MENU:7,ELEMENT_NEUTRAL:8,ELEMENT_HEAT:9,ELEMENT_COLD:10,ELEMENT_SHOCK:11,ELEMENT_WAVE:12,
QUICK_MENU:13,THROWING:14,ELEMENT_LOAD:15,ELEMENT_CHANGE:16,SPECIAL:17,COMBAT_RANK:18,QUEST_SWITCH:19,EXP:20,MENU_CIRCUIT:21,MENU_SYNOPSIS:22,MENU_SOCIAL:23,MENU_SOCIAL_INVITE:24,MENU_BOTANICS:25,ITEMS:26,MONEY:27,MODIFIER:28};sc.EXP_PER_LEVEL=1E3;sc.EXP_MAX_LEVEL=99;sc.MAX_SP=16;sc.SP_LEVEL=[0,4,8,12,16];var g=[];g[sc.PLAYER_ACTION.THROW_NORMAL]=1;g[sc.PLAYER_ACTION.THROW_NORMAL_REV]=1;g[sc.PLAYER_ACTION.THROW_NORMAL_CHARGED]=3;g[sc.PLAYER_ACTION.THROW_NORMAL_CHARGED_REV]=3;g[sc.PLAYER_ACTION.ATTACK]=
1;g[sc.PLAYER_ACTION.ATTACK_REV]=1;g[sc.PLAYER_ACTION.ATTACK_FINISHER]=2;g[sc.PLAYER_ACTION.THROW_SPECIAL1]=4;g[sc.PLAYER_ACTION.THROW_SPECIAL2]=6;g[sc.PLAYER_ACTION.THROW_SPECIAL3]=12;g[sc.PLAYER_ACTION.ATTACK_SPECIAL1]=4;g[sc.PLAYER_ACTION.ATTACK_SPECIAL2]=6;g[sc.PLAYER_ACTION.ATTACK_SPECIAL3]=12;sc.PlayerModel=ig.Class.extend({observers:[],core:{},config:null,loadedConfig:null,equip:{head:-1,leftArm:-1,rightArm:-1,torso:-1,feet:-1},items:[],itemFavs:[],itemNew:[],itemToggles:{},animSheet:null,
stats:null,baseParams:{elemFactor:[1,1,1,1]},equipParams:{},equipModifiers:{},params:null,name:null,character:null,credit:0,level:1,exp:0,skills:[],skillPoints:[],skillPointsExtra:[],chapter:0,spLevel:2,baseConfig:null,elementConfigs:{},elementScrollDelay:0,levelUpDelta:{level:0,cp:0,hp:0,attack:0,defense:0,focus:0},currentElementMode:0,elementLoad:0,elementLoadTimer:0,hasOverload:false,itemBlockTimer:0,chapters:null,toggleSets:null,init:function(){this.params=new sc.CombatParams;this.setSpLevel(2);
for(var a in sc.PLAYER_CORE)this.core[sc.PLAYER_CORE[a]]=true;for(var b in sc.ELEMENT){this.skillPoints[sc.ELEMENT[b]]=0;this.skillPointsExtra[sc.ELEMENT[b]]=0}if(window.wm){ig.database.register("chapters","ChapterList","Chapters");ig.database.register("toggle-sets","ToggleSetsList","Toggle Sets")}this.chapters=ig.database.get("chapters");this.toggleSets=ig.database.get("toggle-sets");ig.vars.registerVarAccessor("item",this,"VarItemEditor");ig.vars.registerVarAccessor("equip",this,"VarEquipEditor");
ig.vars.registerVarAccessor("player",this,"VarPlayerEditor");ig.vars.registerVarAccessor("chapter",this,"VarChapterEditor")},setConfig:function(a){this.config&&this.config.decreaseRef();this.config=a;this.config.increaseRef();this.name=a.name;this.character=a.character;this.defaultExpression&&this.defaultExpression.decreaseRef();this.defaultExpression=new sc.CharacterExpression(a.character.name,"DEFAULT");this.animSheet=a.animSheet;this.stats=a.stats;this.baseConfig=a.baseConfig;this.elementConfigs=
a.elementConfigs;this.updateStats();sc.Model.notifyObserver(this,sc.PLAYER_MSG.CONFIG_CHANGED)},updateChapter:function(a){for(var b=ig.vars.get("plot.line"),c=this.chapters.length;c--;)if(b>=this.chapters[c].plotline){this.chapter=c;break}b=sc.lore.getCategoryList(sc.LORE_CATERGORIES.STORY,sc.LORE_SORT_TYPE.ORDER);for(c=0;c<this.chapter+1;c++)a?sc.lore.unlockLore(b[c],false,true,!sc.lore.isLoreUnlocked(b[c])):sc.lore.isLoreUnlocked(b[c])||sc.lore.unlockLore(b[c],true)},reset:function(){for(var a in sc.PLAYER_CORE)this.core[sc.PLAYER_CORE[a]]=
true;for(var b in sc.ELEMENT){this.skillPoints[sc.ELEMENT[b]]=0;this.skillPointsExtra[sc.ELEMENT[b]]=0}this.level=1;this.exp=0;this.clearLevelUp();this.setSpLevel(1);this.params.reset(sc.SP_LEVEL[2]);this.spLevel=2;for(b in this.equip)this.equip[b]=-1;this.items.length=0;this.itemFavs.length=0;this.itemNew.length=0;this.elementLoad=this.currentElementMode=this.credit=this.skills.length=0;this.hasOverload=false;this.chapter=0;this.itemToggles={};sc.inventory.updateScaledEquipment(this.level);this.updateStats();
sc.Model.notifyObserver(this,sc.PLAYER_MSG.RESET_PLAYER)},updateLoop:function(a){this.elementLoadTimer=this.elementLoadTimer+ig.system.ingameTick;if(ig.game.firstUpdateLoop){sc.stats.addMap("element","time"+this.currentElementMode,ig.system.rawTick);sc.model.isAssistMode()&&sc.stats.addMap("player","assistTime",ig.system.rawTick)}if(this.elementScrollDelay){this.elementScrollDelay=this.elementScrollDelay-ig.system.actualTick;if(this.elementScrollDelay<0)this.elementScrollDelay=0}var b=0;this.elementLoadTimer>
1&&(b=1);a||(b=b*8);!this.hasOverload&&!this.currentElementMode&&(b=b*3);this.hasOverload&&(b=b*4);b&&this.elementLoad>0&&this.addElementLoad(-b*ig.system.ingameTick);if(this.itemBlockTimer>0){this.itemBlockTimer=sc.combat.isInCombat(ig.game.playerEntity)?this.itemBlockTimer-ig.system.ingameTick:this.itemBlockTimer-ig.system.ingameTick*10;if(this.itemBlockTimer<=0){this.itemBlockTimer=0;sc.Model.notifyObserver(this,sc.PLAYER_MSG.ITEM_BLOCK_FINISH)}}},addElementLoad:function(a){if(this.core[sc.PLAYER_CORE.ELEMENT_LOAD]&&
!(sc.newgame.get("overload-disable")&&a>=0)){var b=50*(1+this.params.getModifier("OVERHEAT_REDUCTION"));this.elementLoad=this.elementLoad+a/b;if(this.elementLoad<0){this.hasOverload=false;this.elementLoad=0}else if(this.elementLoad>=1){this.enterElementalOverload();this.elementLoad=1}}},setElementLoad:function(a){this.elementLoad=a;if(a<1&&this.hasOverload)this.hasOverload=false;else if(a>=1&&!this.hasOverload){this.enterElementalOverload();this.elementLoad=1}},enterElementalOverload:function(){if(!this.hasOverload){sc.stats.addMap("element",
"overload",1);sc.arena.onElementOverload();sc.combat.doDramaticEffect(ig.game.playerEntity,ig.game.playerEntity,sc.DRAMATIC_EFFECT.OVERLOAD);var a=ig.lang.get("sc.gui.combat.element-overload"),a=new sc.SmallEntityBox(ig.game.playerEntity,a,1);ig.gui.addGuiElement(a);this.hasOverload=true;this.setElementMode(sc.ELEMENT.NEUTRAL,true)}},onTargetHit:function(a,b,c){this.currentElementMode==sc.ELEMENT.NEUTRAL&&this.addElementLoad(-(c.offensiveFactor*c.defensiveFactor))},increaseActionHeat:function(a){if(this.currentElementMode!=
sc.ELEMENT.NEUTRAL)if(a=g[a]){this.addElementLoad(a);this.elementLoadTimer=0}},getCharacterName:function(){return this.character&&ig.LangLabel.getText(this.character.data.name)||"???"},switchBranch:function(a,b,c){for(var d=false,b=b?1:-1,e=3,c=c!=void 0?c:-1;e--;){if(c==a){this.learnSkill(c);d=true;break}if(this.skills[a+b]){this.skills[a+b]=null;this.skills[a]=sc.skilltree.skills[a];ig.debug("SWITCH SKILL: "+a);d=true}a=a+2}sc.stats.addMap("player","branches",1);this.updateStats();d&&sc.Model.notifyObserver(this,
sc.PLAYER_MSG.SKILL_BRANCH_SWAP)},learnSkill:function(a,b){if(!b){var c=sc.skilltree.getSkill(a);ig.debug("LEARN SKILL: "+a+" ["+c.skillKey+"]");window.IG_GAME_DEBUG&&sc.Debug.addLearnedSkill(a);var d=c.element,c=c.getCPCost();if(c!=void 0&&d!=void 0){this.skillPoints[d]=this.skillPoints[d]-c;sc.stats.addMap("player","skillPoints",c);sc.stats.addMap("player","skillPoints"+d,c);if(this.skillPoints[d]<0)throw Error("Skillpoints can never be below zero!");}}this.skills[a]=sc.skilltree.skills[a];sc.stats.addMap("player",
"skills",1);this.skills[a].skillType?sc.stats.addMap("player","skillsActive",1):sc.stats.addMap("player","skillsPassive",1);this.updateStats();sc.Model.notifyObserver(this,sc.PLAYER_MSG.SKILL_CHANGED,a)},unlearnSkill:function(a){a!=void 0&&(this.skills[a]=null);sc.Model.notifyObserver(this,sc.PLAYER_MSG.SKILL_CHANGED)},hasSkill:function(a){return this.skills[a]},hasSkillPoints:function(a){a=sc.skilltree.getSkill(a);return this.skillPoints[a.element]-a.getCPCost()>=0},hasSkillPointsByCp:function(a,
b){return this.skillPoints[b]-a>=0},addSkillPoints:function(a,b,c,d){if(c)for(b=this.skillPoints.length;b--;){this.skillPoints[b]=Math.min(this.skillPoints[b]+a,200);d&&(this.skillPointsExtra[b]=(this.skillPointsExtra[b]||0)+a)}else{this.skillPoints[b]=Math.min(this.skillPoints[b]+a,200);d&&(this.skillPointsExtra[b]=(this.skillPointsExtra[b]||0)+a)}sc.Model.notifyObserver(this,sc.PLAYER_MSG.CP_CHANGE)},resetSkillTree:function(a){if(!(a==void 0||a<0)){for(var b=null,c=this.skills.length;c--;)(b=this.skills[c])&&
b.element==a&&(this.skills[c]=null);this.skillPoints[a]=this.getMaxSkillPoints(a);this.updateStats();sc.Model.notifyObserver(this,sc.PLAYER_MSG.SKILL_CHANGED)}},setSpLevel:function(a){if(!(a<0||a>=sc.SP_LEVEL.length)){this.spLevel=a;this.params.setMaxSp(sc.SP_LEVEL[a])}},addItem:function(a,c,d,e){if(!(a<0)){this.items[a]=this.items[a]?Math.min(this.items[a]+(c|0),99):c|0;this._addNewItem(a);sc.stats.addMap("items","total",c);sc.stats.addMap("items",a,c);b.id=a;b.amount=c;b.skip=d;b.cutscene=e;sc.Model.notifyObserver(this,
sc.PLAYER_MSG.ITEM_OBTAINED,b)}},startItemConsume:function(){sc.Model.notifyObserver(this,sc.PLAYER_MSG.ITEM_CONSUME_START)},endItemConsume:function(a){sc.Model.notifyObserver(this,sc.PLAYER_MSG.ITEM_CONSUME_END,a)},useItem:function(a){if(!(a<0)){if(this.items[a]){this.itemBlockTimer=this.getItemBlockTime();this.items[a]=this.items[a]-1;if(this.items[a]<=0){this.isFavorite(a)&&this.updateFavorite(a);this._removeIDFromNewList(a)}sc.stats.addMap("items","used",1);sc.stats.addMap("items","used-"+a,1);
sc.stats.setMap("items","usedTotal",this.getTotalItemsUsed(true));sc.Model.notifyObserver(this,sc.PLAYER_MSG.ITEM_USED,a);return true}return false}},getItemBlockTime:function(){return sc.newgame.get("item-cd-zero")?0:sc.newgame.get("item-cd-half")?sc.ITEM_USE_TIMER/2:sc.newgame.get("item-cd-double")?sc.ITEM_USE_TIMER*2:sc.ITEM_USE_TIMER},getTotalItemsUsed:function(a){for(var b=sc.inventory.items.length,c=0,d=0;b--;){var e=sc.inventory.getItem(b);if(!e.noTrack&&!e.noCount&&e.type==sc.ITEMS_TYPES.CONS){sc.stats.getMap("items",
"used-"+b)>=1&&c++;d++}}return a?c/d:c},removeItem:function(a,c,d,e){if(!(a<0||c<=0)){if(e&&this.items[a]<c&&sc.inventory.getItem(a).type==sc.ITEMS_TYPES.EQUIP){if(c-this.items[a]>=2){a==this.equip.leftArm&&this.setEquipment(sc.MENU_EQUIP_BODYPART.RIGHT_ARM,-1E3);a==this.equip.rightArm&&this.setEquipment(sc.MENU_EQUIP_BODYPART.LEFT_ARM,-1E3)}else a==this.equip.rightArm?this.setEquipment(sc.MENU_EQUIP_BODYPART.RIGHT_ARM,-1E3):a==this.equip.leftArm&&this.setEquipment(sc.MENU_EQUIP_BODYPART.LEFT_ARM,
-1E3);a==this.equip.head&&this.setEquipment(sc.MENU_EQUIP_BODYPART.HEAD,-1E3);a==this.equip.torso&&this.setEquipment(sc.MENU_EQUIP_BODYPART.TORSO,-1E3);a==this.equip.feet&&this.setEquipment(sc.MENU_EQUIP_BODYPART.FEET,-1E3)}if(this.items[a]){c=Math.min(this.items[a],c);this.items[a]=this.items[a]-c;if(this.items[a]<=0){this._removeIDFromNewList(a);this.isFavorite(a)&&this.updateFavorite(a);if(this.itemToggles[a]&&this.itemToggles[a].state){this.itemToggles[a].state=false;sc.Model.notifyObserver(this,
sc.PLAYER_MSG.ITEM_TOGGLED)}}b.id=a;b.amount=c;d||sc.Model.notifyObserver(this,sc.PLAYER_MSG.ITEM_REMOVED,b);return true}return false}},getItemAmount:function(a){if(!(a<0))return this.items[a]||0},hasItem:function(a){return this.getItemAmount(a)>0},getItemAmountWithEquip:function(a){if(!(a<0)){var b=this.items[a]||0,c=sc.inventory.getItem(a);if(c.type==sc.ITEMS_TYPES.EQUIP){var d=-1,e=-1;switch(c.equipType){case sc.ITEMS_EQUIP_TYPES.HEAD:d=this.equip.head;break;case sc.ITEMS_EQUIP_TYPES.ARM:d=this.equip.leftArm;
e=this.equip.rightArm;break;case sc.ITEMS_EQUIP_TYPES.TORSO:d=this.equip.torso;break;case sc.ITEMS_EQUIP_TYPES.FEET:d=this.equip.feet}d>=0&&d==a&&b++;e>=0&&e==a&&b++}return b}},toggleItem:function(a,b){var c=sc.inventory.getItem(a);if(c&&c.type==sc.ITEMS_TYPES.TOGGLE){this.itemToggles[a]||(this.itemToggles[a]={state:false});this.itemToggles[a].state=!this.itemToggles[a].state}if(b&&b.type==sc.TOGGLE_SET_TYPE.SINGLE)for(var c=b.items,d=c.length;d--;)c[d]!=a&&this.forceToggleState(c[d],false);sc.Model.notifyObserver(this,
sc.PLAYER_MSG.ITEM_TOGGLED);ig.game.varsChangedDeferred();return this.itemToggles[a].state},getToggleSet:function(a){for(var b in this.toggleSets){var c=this.toggleSets[b];if(c.items.indexOf(a)!=-1)return c}return null},forceToggleState:function(a,b){this.itemToggles[a]||(this.itemToggles[a]={state:false});this.itemToggles[a].state=b},getToggleItemState:function(a){var b=sc.inventory.getItem(a);if(b&&b.type==sc.ITEMS_TYPES.TOGGLE)return this.itemToggles[a]?this.itemToggles[a].state:false;throw Error("Item ist not toggle type: "+
a+" ( Type Found: "+b.type+")");},hasAnySetItem:function(a){for(var a=a.items,b=a.length;b--;)if(this.items[a[b]]>=1)return true;return false},hasToggleSetCompleted:function(a){for(var a=this.toggleSets[a].items,b=a.length;b--;)if(!this.hasItem(a[b]))return false;return true},hasAnyToggleItems:function(){for(var a=this.items.length;a--;)if(this.items[a]&&sc.inventory.getItem(a).type==sc.ITEMS_TYPES.TOGGLE)return true;return false},getItemSubList:function(a,b,c){if(!a)return[];for(var d=[],e=this.items.length,
f=null;e--;)if(this.items[e])(f=sc.inventory.getItem(e))&&f.type==a&&d.push(e);b!=void 0&&this.sortItemList(d,b,c);return d},getNewItemList:function(){return this.itemNew},getEquipSubList:function(a,b,c){if(!a)return[];var d=[],e=this.items.length,f=null,g=-10,n=-10;if(b)switch(a){case sc.ITEMS_EQUIP_TYPES.ARM:g=this.equip.leftArm;n=this.equip.rightArm;break;case sc.ITEMS_EQUIP_TYPES.HEAD:g=this.equip.head;break;case sc.ITEMS_EQUIP_TYPES.TORSO:g=this.equip.torso;break;case sc.ITEMS_EQUIP_TYPES.FEET:g=
this.equip.feet}for(;e--;){if(b){if(e!=g&&e!=n&&!this.items[e])continue}else if(!this.items[e])continue;(f=sc.inventory.getItem(e))&&(f.type==sc.ITEMS_TYPES.EQUIP&&f.equipType==a)&&d.push(e)}c!=void 0&&this.sortItemList(d,c);return d},sortItemList:function(a,b,c){switch(b){case sc.SORT_TYPE.ORDER:c?a.sort(this._sortOrderFavorite.bind(this)):a.sort(this._sortOrder.bind(this));break;case sc.SORT_TYPE.NAME:a.sort(this._sortName.bind(this));break;case sc.SORT_TYPE.AMOUNT:a.sort(this._sortAmount.bind(this));
break;case sc.SORT_TYPE.RARITY:a.sort(this._sortRarity.bind(this));break;case sc.SORT_TYPE.LEVEL:a.sort(this._sortLevel.bind(this));break;case sc.SORT_TYPE.HP:this._sortStat(a,"hp");break;case sc.SORT_TYPE.ATTACK:this._sortStat(a,"attack");break;case sc.SORT_TYPE.DEFENSE:this._sortStat(a,"defense");break;case sc.SORT_TYPE.FOCUS:this._sortStat(a,"focus")}},_addNewItem:function(a){for(var b=this.itemNew.length;b--;)if(this.itemNew[b]==a){this.itemNew.splice(b,1);break}this.itemNew.splice(0,0,a);if(this.itemNew.length>=
22)this.itemNew.length=22},_removeIDFromNewList:function(a){for(var b=this.itemNew.length;b--;)if(this.itemNew[b]==a){this.itemNew.splice(b,1);break}},_sortOrderFavorite:function(b,c){var e=sc.inventory;a=e.getItem(b).order||0;d=e.getItem(c).order||0;this.isFavorite(b)&&(a=a-1E6);this.isFavorite(c)&&(d=d-1E6);return a-d},_sortOrder:function(a,b){var c=sc.inventory;return(c.getItem(a).order||0)-(c.getItem(b).order||0)},_sortName:function(b,c){var e=sc.inventory;a=ig.LangLabel.getText(e.getItem(b).name);
d=ig.LangLabel.getText(e.getItem(c).name);return a<d?-1:a>d?1:0},_sortAmount:function(a,b){var c=sc.inventory;return this.items[a]==this.items[b]?(c.getItem(a).order||0)-(c.getItem(b).order||0):(this.items[a]||0)-(this.items[b]||0)},_sortRarity:function(b,c){var e=sc.inventory;a=e.getItem(b);d=e.getItem(c);return a.rarity==d.rarity?(a.order||0)-(d.order||0):(a.rarity||0)-(d.rarity||0)},_sortLevel:function(b,c){var e=sc.inventory;a=e.getItem(b);d=e.getItem(c);return a.level==d.level?(a.order||0)-(d.order||
0):(d.level||0)-(a.level||0)},_sortStat:function(b,f){b.sort(function(b,g){var h=sc.inventory;a=h.getItem(b);d=h.getItem(g);if(!a.params)return-1;if(!d.params)return 1;if(!d.params||!d.params)return 0;c=a.params||{};e=d.params||{};return e[f]==c[f]?(d.order||0)-(a.order||0):(e[f]||0)-(c[f]||0)}.bind(this))},canAddFavorite:function(){return this.itemFavs.length<12},isFavorite:function(a){for(var b=this.itemFavs.length;b--;)if(this.itemFavs[b]==a)return true;return false},updateFavorite:function(a){for(var b=
this.itemFavs.length;b--;)if(this.itemFavs[b]==a){this.itemFavs.splice(b,1);this.itemFavs.sort(this._sortOrder.bind(this));sc.Model.notifyObserver(this,sc.PLAYER_MSG.ITEM_FAVORITES_CHANGED);return false}this.itemFavs.push(a);this.itemFavs.sort(this._sortOrder.bind(this));sc.Model.notifyObserver(this,sc.PLAYER_MSG.ITEM_FAVORITES_CHANGED);return true},setEquipment:function(a,c){var d=sc.PlayerLevelTools.equip(this.equip,a,c);if(c==d)return false;this.updateStats();if(c>0){this.items[c]--;this.items[c]<
0&&(this.items[c]=null);b.id=c;b.amount=-1;sc.Model.notifyObserver(this,sc.PLAYER_MSG.ITEM_EQUIP_UPDATE,b)}if(d&&d>0){this.items[d]?this.items[d]++:this.items[d]=1;b.id=d;b.amount=1;sc.Model.notifyObserver(this,sc.PLAYER_MSG.ITEM_EQUIP_UPDATE,b)}b.unequip=c<0;b.equipID=c;sc.Model.notifyObserver(this,sc.PLAYER_MSG.EQUIP_CHANGE,b);return true},isEquipped:function(a){for(var b in this.equip)if(this.equip[b]!=-1&&this.equip[b]==a)return true;return false},getAvgEquipLevel:function(){var a=sc.inventory.getItemLevel(this.equip.head),
a=a+sc.inventory.getItemLevel(this.equip.leftArm),a=a+sc.inventory.getItemLevel(this.equip.rightArm),a=a+sc.inventory.getItemLevel(this.equip.torso),a=a+sc.inventory.getItemLevel(this.equip.feet);return a/5},setCore:function(a,b){this.core[a]=b;sc.Model.notifyObserver(this,sc.PLAYER_MSG.CORE_CHANGED)},setCoreAll:function(a){for(var b in sc.PLAYER_CORE)this.core[sc.PLAYER_CORE[b]]=a?true:false},getCore:function(a){return this.core[a]},getCombatCooldownTime:function(){return sc.model.isCombatRankActive()&&
!sc.model.isCutscene()?10:0},hasElement:function(a){switch(a){case sc.ELEMENT.NEUTRAL:return this.core[sc.PLAYER_CORE.ELEMENT_NEUTRAL];case sc.ELEMENT.HEAT:return this.core[sc.PLAYER_CORE.ELEMENT_HEAT];case sc.ELEMENT.COLD:return this.core[sc.PLAYER_CORE.ELEMENT_COLD];case sc.ELEMENT.SHOCK:return this.core[sc.PLAYER_CORE.ELEMENT_SHOCK];case sc.ELEMENT.WAVE:return this.core[sc.PLAYER_CORE.ELEMENT_WAVE]}return false},setLevel:function(a,b){this.level=a;sc.inventory.updateScaledEquipment(this.level);
this.updateStats();if(!b){this.resetSkillTree(sc.ELEMENT.NEUTRAL);this.resetSkillTree(sc.ELEMENT.HEAT);this.resetSkillTree(sc.ELEMENT.COLD);this.resetSkillTree(sc.ELEMENT.SHOCK);this.resetSkillTree(sc.ELEMENT.WAVE)}sc.Model.notifyObserver(this,sc.PLAYER_MSG.LEVEL_CHANGE,null)},addExperience:function(a,b,c,d,e){if(!this.getCore(sc.PLAYER_CORE.EXP)||sc.newgame.get("disable-exp"))return 0;var f=sc.party.addExperience(a,b,c,d,e);if(this.level>=99)return 0;var g=0,a=a*f,g=d?sc.PlayerLevelTools.computeExp(a,
this.level,b,void 0,void 0,e):sc.PlayerLevelTools.computeExp(a,this.level,b,1+this.params.getModifier("XP_PLUS"),this.params.getModifier("XP_ZERO"),e),g=g+(c||0);if(g==0)return 0;this.exp=this.exp+g;sc.stats.addMap("player","exp",g);if(this.exp>=1E3){a=Math.floor(this.exp/1E3);this.level=Math.min(99,this.level+a);sc.stats.setMap("player","level",this.level);this.addSkillPoints(a,null,true);this.exp=this.level>=99?0:this.exp%1E3;b=ig.copy(this.baseParams);sc.inventory.updateScaledEquipment(this.level);
this.updateStats();this.addElementLoad(-1E3);for(var n in b)b[n]=this.baseParams[n]-b[n];b.level=a;b.cp=a;for(n in b)this.levelUpDelta[n]=this.levelUpDelta[n]+b[n];sc.Model.notifyObserver(this,sc.PLAYER_MSG.LEVEL_CHANGE,b)}sc.Model.notifyObserver(this,sc.PLAYER_MSG.EXP_CHANGE,g);return g},addCredit:function(a,b,c){if(this.getCore(sc.PLAYER_CORE.CREDITS)&&!sc.newgame.get("disable-money")){c&&(a=Math.round(a*(1+this.params.getModifier("MONEY_PLUS"))));a=a*sc.newgame.getMoneyMultiplier();this.credit=
this.credit+a;if(this.credit>=9999999)this.credit=9999999;else if(this.credit<0)this.credit=0;sc.stats.addMap("player","money",Math.max(a,0));sc.stats.addMap("player","moneyHold",this.credit);sc.Model.notifyObserver(this,sc.PLAYER_MSG.CREDIT_CHANGE,a)}},removeCredit:function(a,b){this.credit=Math.max(this.credit-a,0);b||sc.Model.notifyObserver(this,sc.PLAYER_MSG.CREDIT_CHANGE,-a)},getRawExpGain:function(a,b,c){return sc.PlayerLevelTools.computeExp(a,this.level,b,void 0,void 0,c)},regenerate:function(){this.params.revive(1)},
setElementMode:function(a,b,c){if(!b&&!this.core[sc.PLAYER_CORE.ELEMENT_CHANGE]||!b&&!this.hasElement(a))return false;if(!c&&ig.game.playerEntity&&this.currentElementMode!=a)ig.game.playerEntity.switchedMode=true;this.currentElementMode=a;sc.stats.addMap("element","used"+a,1);this.params.setBaseParams(this.elementConfigs[a].baseParams);this.params.setModifiers(this.elementConfigs[this.currentElementMode].modifiers);sc.Model.notifyObserver(this,sc.PLAYER_MSG.ELEMENT_MODE_CHANGE);return true},scrollElementMode:function(a,
b,c){if(!b&&!this.core[sc.PLAYER_CORE.ELEMENT_CHANGE]||this.elementScrollDelay)return false;for(var d=f.indexOf(this.currentElementMode)+a;d>=0&&d<=f.length;){var e=f[d];if(this.hasElement(e)){this.elementScrollDelay=0;return this.setElementMode(e,b,c)}d=d+a}return false},getCurrentElementMode:function(){return this.elementConfigs[this.currentElementMode]},getCombatArt:function(a,b){return this.elementConfigs[a].getPlayerAction(b)},getCombatArtName:function(a){return this.elementConfigs[this.currentElementMode].getActiveCombatArtName(a)},
getActiveCombatArt:function(a,b){return this.elementConfigs[a].getAction(b)},getAction:function(a){return this.elementConfigs[this.currentElementMode].getAction(a)||this.baseConfig.getAction(a)},getActionByElement:function(a,b){return this.elementConfigs[a].getAction(b)||this.baseConfig.getAction(b)},getBalls:function(){return this.config.proxies},getOptionFace:function(){return"DEFAULT"},updateStats:function(){if(this.elementConfigs[sc.ELEMENT.NEUTRAL]){sc.PlayerLevelTools.computeBaseParams(this.baseParams,
this.stats,this.level);this.equipParams=ig.copy(this.baseParams);this.equipModifiers={};sc.PlayerLevelTools.updateEquipStats(this.equip,this.equipParams,this.equipModifiers);for(var a in sc.ELEMENT)this.elementConfigs[sc.ELEMENT[a]].preSkillInit();for(var b=0;b<this.skills.length;b++)this.skills[b]&&this.skills[b].applyOnConfigs(this.elementConfigs);this.baseConfig.update(this.equipParams,this.equipModifiers);for(a in sc.ELEMENT)this.elementConfigs[sc.ELEMENT[a]].update(this.equipParams,this.equipModifiers);
this.params.setBaseParams(this.elementConfigs[this.currentElementMode].baseParams);this.params.setModifiers(this.elementConfigs[this.currentElementMode].modifiers);sc.Model.notifyObserver(this,sc.PLAYER_MSG.STATS_CHANGED)}},getCombatArtLevel:function(a,b){for(var c=0,d=this.skills.length;d--;)this.skills[d]&&this.skills[d].getCombatArtLevel&&(c=Math.max(c,this.skills[d].getCombatArtLevel(a,b)));return c},getTopCombatArtElement:function(a){var b=void 0,c=0,d;for(d in sc.ELEMENT){var e=sc.ELEMENT[d],
f=this.getCombatArtLevel(a,e);if(f>c){c=f;b=e}}return b},hasLevelUp:function(){return this.levelUpDelta.level>0},clearLevelUp:function(){for(var a in this.levelUpDelta)this.levelUpDelta[a]=0},getParamAvg:function(){return(this.params.getStat("attack")+this.params.getStat("defense")+this.params.getStat("focus"))/3},getParamAvgLevel:function(a){return Math.min(99,sc.EnemyLevelScaling.getLevelForAverageStat(this.getParamAvg())+(a||0))},onVarAccess:function(a,b){if(b[0]=="item"){var c=b[1];if(b[2]=="amount")return this.items[c]||
0;if(b[2]=="name")return sc.inventory.getItemName(c);if(b[2]=="toggled")return this.getToggleItemState(c);if(b[2]=="amountEquipped")return this.getItemAmountWithEquip(c)}else if(b[0]=="equip")switch(b[1]){case "head":return this.equip.head;case "feet":return this.equip.feet;case "leftArm":return this.equip.leftArm;case "rightArm":return this.equip.rightArm;case "torso":return this.equip.torso}else if(b[0]=="player")switch(b[1]){case "money":return this.credit+"";case "level":return this.level+"";
case "hasLevelUp":return this.hasLevelUp();case "exp":return this.exp+"";case "element":return this.currentElementMode+"";case "hasElement":return this.hasElement(b[2]*1);case "elementLoad":return this.elementLoad+"";case "param":return this.params.getStat(b[2])+"";case "paramAvg":return this.getParamAvg();case "paramElementFactor":return this.params.getStat("elemFactor")[b[2]]+"";case "modifier":return this.params.getModifier(b[2])+"";case "hp":return this.params.currentHp+"";case "sp":return this.params.currentSp+
"";case "maxSp":return this.params.maxSp+"";case "core":return this.getCore(b[2]);case "artLevel":return this.getCombatArtLevel(b[2]=="ANY"?null:b[2]);case "itemsUsed":return this.getTotalItemsUsed(true);case "hasAnyToggleItems":return this.hasAnyToggleItems();case "hasToggleSetCompleted":return this.hasToggleSetCompleted(b[2]);case "entity":return ig.game.playerEntity&&ig.vars.forwardEntityVarAccess(ig.game.playerEntity,b,2)}else if(b[0]=="chapter")switch(b[1]){case "current":return this.chapter;
case "name":return this.chapters[b[2]]?ig.LangLabel.getText(this.chapters[b[2]].name):"No Title"}throw Error("Unsupported var access path: "+a);},usedSkillPoints:function(){for(var a=0;a<this.skillPoints.length;++a){var b=this.getMaxSkillPoints(a);if(this.skillPoints[a]<b)return true}return false},getMaxSkillPoints:function(a){var b=this.level-1;return b=b+(this.skillPointsExtra[a]||0)},getSaveData:function(){var a={};a.playerConfig=this.config.name;a.credit=this.credit;a.level=this.level;a.exp=this.exp;
a.currentElementMode=this.currentElementMode;a.elementLoad=this.elementLoad;a.hasOverload=this.hasOverload;a.hp=this.params.currentHp;a.core=ig.copy(this.core);a.skills=[];a.chapter=this.chapter||0;for(var b=0;b<this.skills.length;++b)this.skills[b]&&(a.skills[b]=true);a.skillPoints=ig.copy(this.skillPoints);a.skillPointsExtra=ig.copy(this.skillPointsExtra);a.items=ig.copy(this.items);a.equip={head:this.equip.head,leftArm:this.equip.leftArm,rightArm:this.equip.rightArm,torso:this.equip.torso,feet:this.equip.feet};
a.levelUpDelta=ig.copy(this.levelUpDelta);a.spLevel=this.spLevel;a.itemFavs=ig.copy(this.itemFavs);a.itemNew=ig.copy(this.itemNew);a.itemToggles=ig.copy(this.itemToggles);a.skillVersion=sc.skilltree.version;return a},preLoad:function(a){this.clearLevelUp();this.itemFavs=a.itemFavs||[];this.itemNew=a.itemNew||[];this.itemToggles=a.itemToggles||{};for(var b=this.itemFavs.length;b--;){var c=this.itemFavs[b];if(this.items[c]<=0||!sc.inventory.isConsumable(c)){this.itemFavs.length=0;break}}this.credit=
Math.round(a.credit||0);this.level=a.level||1;this.exp=a.exp||0;this.chapter=a.chapter||0;this.currentElementMode=a.currentElementMode||0;this.elementLoad=a.elementLoad||0;this.hasOverload=a.hasOverload||false;this.params.reset();this.core=a.core;if(this.itemBlockTimer){this.itemBlockTimer=0;sc.Model.notifyObserver(this,sc.PLAYER_MSG.ITEM_BLOCK_FINISH)}if(a.levelUpDelta)for(var d in this.levelUpDelta)this.levelUpDelta[d]=a.levelUpDelta[d]||0;for(var e in sc.PLAYER_CORE){d=sc.PLAYER_CORE[e];this.core[d]==
void 0&&(this.core[d]=true)}for(b=this.skills.length=0;b<a.skills.length;++b)a.skills[b]&&(this.skills[b]=sc.skilltree.skills[b]);this.skillPoints=ig.copy(a.skillPoints);this.skillPointsExtra=ig.copy(a.skillPointsExtra)||[0,0,0,0];this.items=ig.copy(a.items);if(a.equip.leftArm===void 0){ig.log("Apply fix for outdated equipment structure");for(d in a.equip)a.equip[d]!=-1&&a.equip[d]!==void 0&&this.items[a.equip[d]]++;this.equip.head=this.equip.feet=this.equip.leftArm=this.equip.rightArm=this.equip.torso=
-1}else{this.equip.head=a.equip.head;this.equip.feet=a.equip.feet;this.equip.leftArm=a.equip.leftArm;this.equip.rightArm=a.equip.rightArm;this.equip.torso=a.equip.torso}if(this.checkBodyPart(this.equip.head))this.equip.head=-1;if(this.checkBodyPart(this.equip.feet))this.equip.feet=-1;if(this.checkBodyPart(this.equip.leftArm))this.equip.leftArm=-1;if(this.checkBodyPart(this.equip.rightArm))this.equip.rightArm=-1;if(this.checkBodyPart(this.equip.torso))this.equip.torso=-1;this.setSpLevel(a.spLevel||
0);sc.inventory.updateScaledEquipment(this.level);this.updateStats();this.updateChapter(true);if(a.playerConfig)this.loadedConfig=new sc.PlayerConfig(a.playerConfig);this.params.currentHp=Math.min(a.hp||this.params.getStat("hp"),this.params.getStat("hp"));if(a.skillVersion!=sc.skilltree.version&&this.usedSkillPoints()){this.resetSkillTree(sc.ELEMENT.NEUTRAL);this.resetSkillTree(sc.ELEMENT.HEAT);this.resetSkillTree(sc.ELEMENT.COLD);this.resetSkillTree(sc.ELEMENT.SHOCK);this.resetSkillTree(sc.ELEMENT.WAVE);
ig.game.addTeleportMessage(ig.lang.get("sc.gui.loading.skillUpdate"))}for(b=this.itemNew.length;b--;)this.items[this.itemNew[b]]<=0&&!this.isEquipped(this.itemNew[b])&&this.itemNew.splice(b,1);sc.stats.setMap("items","usedTotal",this.getTotalItemsUsed(true));sc.Model.notifyObserver(this,sc.PLAYER_MSG.SET_PARAMS)},checkBodyPart:function(a){if(a<0)return false;if(sc.inventory.getItem(a).type!=sc.ITEMS_TYPES.EQUIP){this.items[a]++;return true}return false},postLoad:function(){if(this.loadedConfig){this.setConfig(this.loadedConfig);
this.loadedConfig.decreaseRef();this.loadedConfig=null}}})});ig.baked=!0;
ig.module("game.feature.msg.message-model").requires("impact.base.game","impact.feature.storage.storage","game.feature.model.base-model","impact.feature.interact.interact","impact.feature.interact.button-interact").defines(function(){var b=new ig.ButtonInteractEntry;sc.MessageModel=ig.GameAddon.extend({observers:[],sideMessages:[],sideMessageStack:[],sideMessageDelayedStack:[],sideMessageQueuing:false,displayedSideMessages:0,currentPeople:{},stashedPeople:[],blocking:false,currentChoiceOptions:null,
lastSelectedChoice:null,autoContinue:false,autoScript:false,autoScriptTimer:0,loaded:false,screenInteract:null,privateMode:0,boardVisible:false,boardSide:null,menuMode:false,bottomGap:0,init:function(){this.parent("MessageModel");ig.storage.register(this);this.screenInteract=new sc.ScreenInteractEntry(this);ig.vars.registerVarAccessor("msg",this,"VarMsgEditor")},isBlocking:function(){return this.blocking},clearBlocking:function(){ig.interact.removeEntry(this.screenInteract);this.blocking=false},clearDreamMessage:function(){sc.Model.notifyObserver(this,
sc.MESSAGE_EVENT.DREAM_MSG_CLOSE)},onSkipClearBlocking:function(){if(this.privateMode==1)this.privateMode=2;this.clearBlocking()},ringPrivateMessage:function(a){this.privateMode=1;if(!ig.system.skipMode){this.blocking=true;ig.interact.addEntry(this.screenInteract);ig.interact.setBlockDelay(0.1)}sc.Model.notifyObserver(this,sc.MESSAGE_EVENT.RING_PRIVATE,a)},isPrivateRing:function(){return this.privateMode==2||this.privateMode==1},isPrivateActive:function(){return this.privateMode==3},startPrivateMessage:function(){if(this.privateMode!=
3){this.clearAll();this.privateMode=3;this.blocking=true;sc.Model.notifyObserver(this,sc.MESSAGE_EVENT.START_PRIVATE)}},endPrivateMessage:function(a){if(this.privateMode!=0){var b=true;if(this.privateMode==3){b=false;this.clearAll();this.clearBoardMsg()}this.privateMode=0;this.blocking=true;sc.Model.notifyObserver(this,b?sc.MESSAGE_EVENT.DROP_PRIVATE:sc.MESSAGE_EVENT.END_PRIVATE,a)}},setMenuMode:function(a){if(this.menuMode!=a){(this.menuMode=a)?ig.interact.addEntry(b):ig.interact.removeEntry(b);
sc.Model.notifyObserver(this,sc.MESSAGE_EVENT.MENU_MODE_CHANGE,this.menuMode);sc.model.stopSkip()}},setBottomGap:function(a){if(a!=this.bottomGap){this.bottomGap=a;sc.Model.notifyObserver(this,sc.MESSAGE_EVENT.BOTTOM_GAP_CHANGE,a)}},isMenuMode:function(){return this.menuMode},showMessage:function(a,b,c){this.boardSide||this.clearBoardMsg();this._checkActivePerson(a);this.blocking=true;if(this.autoScript&&!c){this.autoScriptTimer=this.getMessageTime(b);this.autoContinue=false}else this.autoContinue=
c;ig.interact.addEntry(this.screenInteract);ig.interact.setBlockDelay(0.1);sc.Model.notifyObserver(this,sc.MESSAGE_EVENT.NEW_MESSAGE,{name:a,text:b});if(a=this.currentPeople[a]){sc.voiceActing.play(a.charExpression,b);this.showSideMessage(a.charExpression,b,true)}},getMessageTime:function(a){a=ig.TextParser.parse(a.toString(),[]);return Math.max(0.8,a.length/20*0.9+0.65)},showOffScreenMessage:function(a,b,c){this.boardSide||this.clearBoardMsg();this.blocking=true;this.autoContinue=c;ig.interact.addEntry(this.screenInteract);
ig.interact.setBlockDelay(0.1);sc.Model.notifyObserver(this,sc.MESSAGE_EVENT.NEW_MESSAGE,{name:null,text:b,left:a})},showBoardMessage:function(a,b,c,e){sc.model.clearTopMessage();!this.boardVisible&&!c&&this.stashPersons();this.blocking=true;ig.interact.addEntry(this.screenInteract);ig.interact.setBlockDelay(0.1);this.boardVisible=true;this.boardSide=c;this.autoContinue=e;sc.Model.notifyObserver(this,sc.MESSAGE_EVENT.NEW_BOARD_MESSAGE,{text:a,center:b,side:c})},hasBoardMessage:function(){return this.boardVisible},
showChoice:function(a,b,c,e){this.boardSide||this.clearBoardMsg();if(ig.langEdit)for(var f=b.length;f--;)ig.langEdit.submitRecent("Choice "+f,b[f].label);this._checkActivePerson(a);this.blocking=true;this.currentChoiceOptions=b;sc.model.stopSkip();sc.Model.notifyObserver(this,sc.MESSAGE_EVENT.SHOW_CHOICE,{name:a,options:b,columns:c,forceWidth:e})},_isSideMessageDelayed:function(){return sc.model.isLevelUp()||sc.quests.hasQuestSolvedDialogs()||!sc.model.isCombatActive()&&!sc.model.isCombatCooldown()&&
!sc.model.isCutscene()&&(sc.model.player.hasLevelUp()||sc.quests.hasSolvedQuestsStacked())},showSideMessage:function(a,b,c){a={charExpression:a.clone(),message:ig.LangLabel.bakeVars(b),main:c||false};!c&&this._isSideMessageDelayed()?this.sideMessageDelayedStack.push(a):this._showSideMessage(a)},_showSideMessage:function(a){this.sideMessageQueuing||this.clearSideMessages();this.sideMessageQueuing=true;this.sideMessageStack.push(a);a.main?this.getNextSideMessage():sc.Model.notifyObserver(this,sc.MESSAGE_EVENT.NEW_SIDE_MESSAGE)},
selectChoice:function(a){this.lastSelectedChoice=a;this.currentChoiceOptions=null;this.clearBlocking()},clearSideMessages:function(){for(this.recentlyClearedSideMsg=this.sideMessageStack.length;this.sideMessageStack.length>0;){var a=this.sideMessageStack.shift();this.sideMessages.push(a)}for(;this.sideMessages.length>50;)this.sideMessages.shift().charExpression.decreaseRef();sc.Model.notifyObserver(this,sc.MESSAGE_EVENT.CLEARED_SIDE_MESSAGE)},addPerson:function(a,b,c,e){this.boardSide||this.clearBoardMsg();
var f=a.character.name;if(this.currentPeople[f]){this.currentPeople[f].side=b;this.currentPeople[f].order=c;this.currentPeople[f].charExpression=a;this.currentPeople[f].displayName=e||null;sc.Model.notifyObserver(this,sc.MESSAGE_EVENT.PERSON_CHANGED,f)}else{this.currentPeople[f]={charExpression:a,side:b,order:c,displayName:e||null};sc.Model.notifyObserver(this,sc.MESSAGE_EVENT.PERSON_ADDED,f)}},setExpression:function(a,b){if(this.currentPeople[a]){this.currentPeople[a].charExpression=b;sc.Model.notifyObserver(this,
sc.MESSAGE_EVENT.EXPRESSION_CHANGED,a)}},removePerson:function(a){this.boardSide||this.clearBoardMsg();if(this.currentPeople[a]){delete this.currentPeople[a];sc.Model.notifyObserver(this,sc.MESSAGE_EVENT.PERSON_REMOVED,a)}},clearSide:function(a){for(var b in this.currentPeople)(!a||this.currentPeople[b].side==a)&&delete this.currentPeople[b];a==sc.MESSAGE_SIDES_OR_ALL.ALL&&this.clearBoardMsg();sc.Model.notifyObserver(this,sc.MESSAGE_EVENT.CLEARED,a)},clearAll:function(){this.clearSide(sc.MESSAGE_SIDES_OR_ALL.ALL)},
clearBoardMsg:function(){if(this.boardVisible){this.boardVisible=false;this.boardSide=null;sc.Model.notifyObserver(this,sc.MESSAGE_EVENT.CLEAR_BOARD_MESSAGE,null);this.showStashedPersons()}},onSceneEnd:function(a){this.clearAll();this.clearBoardMsg();ig.interact.setBlockDelay(0.3);this.privateMode&&this.endPrivateMessage(a)},stashPersons:function(){this.stashedPeople.length=0;for(var a in this.currentPeople){var b=this.currentPeople[a];this.stashedPeople.push({charExpression:b.charExpression,side:b.side,
order:b.order,displayName:b.displayName})}this.clearAll()},showStashedPersons:function(){if(this.stashedPeople.length!=0){this.clearAll();for(var a=0;a<this.stashedPeople.length;++a){var b=this.stashedPeople[a];this.addPerson(b.charExpression,b.side,b.order,b.displayName)}this.stashedPeople.length=0}},hasPerson:function(){for(var a in this.currentPeople)return true;return false},clear:function(){this.onSceneEnd(true);for(var a=this.sideMessages.length;a--;)this.sideMessages[a].charExpression.decreaseRef();
this.sideMessages=[];this.clearSideMessages()},getCharExpression:function(a){return this.currentPeople[a]?this.currentPeople[a].charExpression:null},getCharacter:function(a){return this.currentPeople[a]?this.currentPeople[a].charExpression.character:null},getExpression:function(a){return this.currentPeople[a]?this.currentPeople[a].charExpression.expression:null},getSide:function(a){return this.currentPeople[a]?this.currentPeople[a].side:0},getOrder:function(a){return this.currentPeople[a]?this.currentPeople[a].order:
0},getDisplayName:function(a){return this.currentPeople[a]?this.currentPeople[a].displayName:null},getNextSideMessage:function(){var a=this.sideMessageStack.shift();this.sideMessages.push(a);this.sideMessages.length>50&&this.sideMessages.shift().charExpression.decreaseRef();return a},hasStackedSideMessages:function(){return this.sideMessageStack.length>0},isSideMessageVisible:function(){return this.displayedSideMessages>0},onInteraction:function(){if(this.privateMode==1){this.privateMode=2;this.clearBlocking()}else sc.Model.notifyObserver(this,
sc.MESSAGE_EVENT.MESSAGE_INTERACT,null)},onLevelLoadStart:function(){sc.model.message.clearSideMessages()},onLevelLoaded:function(){if(this.loaded){sc.Model.notifyObserver(this,sc.MESSAGE_EVENT.SIDE_MESSAGES_LOADED);this.loaded=false}},onReset:function(){this.currentChoiceOptions=null;this.autoScript=false;this.autoScriptTimer=0;this.clear();this.setBottomGap(0)},onPreUpdate:function(){if(this.sideMessageDelayedStack.length>0&&!this._isSideMessageDelayed())for(;this.sideMessageDelayedStack.length>
0;){var a=this.sideMessageDelayedStack.shift();this._showSideMessage(a)}if(this.autoScript&&this.autoScriptTimer&&!ig.game.paused){this.autoScriptTimer=this.autoScriptTimer-ig.system.actualTick;if(this.autoScriptTimer<=0){this.autoScriptTimer=0;this.clearBlocking()}}this.sideMessageQueuing=false},onStorageSave:function(a){var b={};b.autoScript=this.autoScript;b.sideMessages=this._convertSideMessagesToJson(this.sideMessages);b.sideMessageStack=this._convertSideMessagesToJson(this.sideMessageStack);
b.displayedSideMessages=this.displayedSideMessages;a.message=b},_convertSideMessagesToJson:function(a){for(var b=[],c=0;c<a.length;++c){var e=a[c];b.push({"char":e.charExpression.character.name,expression:e.charExpression.expression,message:e.message?e.message.data||e.message:"",main:e.main})}return b},onStoragePreLoad:function(a){this.loaded=true;a=a.message;this.sideMessages=this._convertJsonToSideMessage(a.sideMessages||[]);this.sideMessageStack=this._convertJsonToSideMessage(a.sideMessageStack||
[]);this.displayedSideMessages=a.displayedSideMessages;this.autoScript=a.autoScript||false},_convertJsonToSideMessage:function(a){for(var b=[],c=0;c<a.length;++c){var e=a[c];if(e["char"]){var f=e.message;f&&typeof f!=="string"&&(f=new ig.LangLabel(f));b.push({charExpression:new sc.CharacterExpression(e["char"],e.expression),message:f,main:e.main||false})}}return b},hasChoice:function(){return!!this.currentChoiceOptions},_checkActivePerson:function(a){if(!this.currentPeople[[a]])throw Error("Character of name '"+
a+'" is currently not in conversation!');},onVarAccess:function(a,b){if(b[0]=="msg"){var c=b[1];return c=="hasSideMsg"?this.hasStackedSideMessages():c=="isSideMsgVisible"?this.isSideMessageVisible():c=="stackCount"?this.sideMessageStack.length:c=="recentlyClearedSideMsg"?this.recentlyClearedSideMsg:null}}});sc.MESSAGE_EVENT={};sc.MESSAGE_EVENT.PERSON_ADDED=0;sc.MESSAGE_EVENT.PERSON_REMOVED=1;sc.MESSAGE_EVENT.PERSON_CHANGED=2;sc.MESSAGE_EVENT.EXPRESSION_CHANGED=3;sc.MESSAGE_EVENT.NEW_MESSAGE=4;sc.MESSAGE_EVENT.NEW_SIDE_MESSAGE=
5;sc.MESSAGE_EVENT.CLEARED=6;sc.MESSAGE_EVENT.CLEARED_SIDE_MESSAGE=7;sc.MESSAGE_EVENT.SHOW_CHOICE=8;sc.MESSAGE_EVENT.SIDE_MESSAGES_LOADED=9;sc.MESSAGE_EVENT.MESSAGE_INTERACT=10;sc.MESSAGE_EVENT.RING_PRIVATE=11;sc.MESSAGE_EVENT.START_PRIVATE=12;sc.MESSAGE_EVENT.END_PRIVATE=13;sc.MESSAGE_EVENT.DROP_PRIVATE=14;sc.MESSAGE_EVENT.NEW_BOARD_MESSAGE=15;sc.MESSAGE_EVENT.CLEAR_BOARD_MESSAGE=16;sc.MESSAGE_EVENT.MENU_MODE_CHANGE=17;sc.MESSAGE_EVENT.BOTTOM_GAP_CHANGE=18;sc.MESSAGE_EVENT.DREAM_MSG_CLOSE=19;sc.MESSAGE_SIDES=
{RIGHT:1,LEFT:2};sc.MESSAGE_SIDES_OR_ALL={RIGHT:1,LEFT:2,ALL:0};ig.addGameAddon(function(){return sc.message=new sc.MessageModel})});ig.baked=!0;
ig.module("game.feature.menu.area-loadable").requires("impact.base.game","impact.base.loader").defines(function(){function b(a,c,e,f,g){var h;h=f<0?false:e<0?false:f>=c.length?false:e>=c[0].length?false:c[f][e]==g;if(h){c[f][e]=c[f][e]+1E4;a.min.x=Math.min(a.min.x,e);a.min.y=Math.min(a.min.y,f);a.max.x=Math.max(a.max.x,e);a.max.y=Math.max(a.max.y,f);b(a,c,e-1,f,g);b(a,c,e+1,f,g);b(a,c,e,f-1,g);b(a,c,e,f+1,g)}}sc.AREA_ICON_TYPE={AREA:1,LARGE:2};sc.AREA_ICONS={arrow_up:{index:0,pivotY:6},arrow_down:{index:1,
pivotY:-5},floor_down:{index:4,pivotY:-5},arrow_left:{index:2,pivotY:-2},arrow_right:{index:3,pivotY:-2},shop:{index:14},trader:{index:15},pub:{index:3},weapons:{index:5},quest:{index:6},quest_hub:{index:16},entrance:{index:7},chest:{index:8},area_up:{index:10,pivotY:6,type:sc.AREA_ICON_TYPE.AREA,_wm:{area:{_type:"Select",_info:"Area this leads to",_select:"areas"},map:{_type:"Maps",_info:"The map this points to"},offset:{_type:"Vec2",_info:"optional offset",_optional:true},condition:{_type:"VarCondition",
_info:"condition fir the icon to show up",_optional:true}}},area_down:{index:11,pivotY:-6,type:sc.AREA_ICON_TYPE.AREA,_wm:{area:{_type:"Select",_info:"Area this leads to",_select:"areas"},map:{_type:"Maps",_info:"The map this points to"},offset:{_type:"Vec2",_info:"optional offset",_optional:true}}},area_left:{index:12,pivotX:6,type:sc.AREA_ICON_TYPE.AREA,_wm:{area:{_type:"Select",_info:"Area this leads to",_select:"areas"},map:{_type:"Maps",_info:"The map this points to"},offset:{_type:"Vec2",_info:"optional offset",
_optional:true}}},area_right:{index:13,pivotX:-6,type:sc.AREA_ICON_TYPE.AREA,_wm:{area:{_type:"Select",_info:"Area this leads to",_select:"areas"},map:{_type:"Maps",_info:"The map this points to"},offset:{_type:"Vec2",_info:"optional offset",_optional:true}}},ferro:{index:17},gate:{index:40,type:sc.AREA_ICON_TYPE.LARGE,width:80,height:56,sx:0,sy:48,pivotY:27}};sc.AREA_CONNECTIONS={VERTICAL:{first:{x:304,y:416,w:8,h:2,ox:0,oy:6,w2:4,h2:2},second:{x:304,y:418,w:8,h:3,ox:0,oy:8,w2:4,h2:3},step:{x:4,
y:0,x2:8,y2:0}},HORIZONTAL:{first:{x:296,y:416,w:3,h:8,ox:5,oy:0,w2:3,h2:4},second:{x:299,y:416,w:2,h:8,ox:8,oy:0,w2:2,h2:4},step:{x:0,y:4,x2:0,y2:8}}};sc.AreaRoomBounds=ig.Class.extend({zMin:0,zMax:0,min:{x:0,y:0},max:{x:0,y:0},offset:{x:0,y:0},name:"default_empty",text:"???",id:1,init:function(a,c,e,f,g){this.name=a.path||"default_empty";this.text=a.name?ig.LangLabel.getText(a.name)||"???":"???";this.id=c||1;this.offset.x=a.offset?a.offset.x:0;this.offset.y=a.offset?a.offset.y:0;this.min.x=this.max.x=
e||0;this.min.y=this.max.y=f||0;this.zMin=a.zMin;this.zMax=a.zMax;b(this,g,e,f,this.id);this.max.x++;this.max.y++}});var a=[];sc.AreaLoadable=ig.Loadable.extend({cacheType:"AreaMap",data:null,lowestFloor:0,init:function(a){this.parent(a)},loadInternal:function(a){$.ajax({dataType:"json",url:ig.getFilePath(ig.root+a.toPath("data/areas/",".json")+ig.getCacheSuffix()),context:this,success:this.onload.bind(this),error:this.onerror.bind(this)})},onerror:function(){this.data=null;this.loadingFinished(false)},
onload:function(a){this.data=a;this._createRooms();this.loadingFinished(true)},_createRooms:function(){for(var b=this.data.floors,c=null,e=null,f=[],g=b.length;g--;){e=b[g];if(e.level<this.lowestFloor)this.lowestFloor=e.level;a.length=0;f=[];if((c=e.tiles)&&c[0][0]!=void 0){for(var h=0;h<c.length;h++)for(var i=0;i<c[h].length;i++){c[h][i]>1E4&&(c[h][i]=c[h][i]-1E4);if(c[h][i]!=0&&!a[c[h][i]]){a[c[h][i]]=1;f.push(new sc.AreaRoomBounds(e.maps[c[h][i]-1],c[h][i],i,h,c));c[h][i]>1E4&&(c[h][i]=c[h][i]-
1E4)}}e.rooms=f}else console.error("Tiles must by a two dimensional Array! Tiles: %O",c)}}})});ig.baked=!0;
ig.module("game.feature.menu.gui.base-menu").requires("impact.feature.gui.gui").defines(function(){sc.BaseMenu=ig.GuiElementBase.extend({visible:false,transitions:{DEFAULT:{state:{},time:0.1,timeFunction:KEY_SPLINES.LINEAR},HIDDEN:{state:{alpha:0},time:0.1,timeFunction:KEY_SPLINES.LINEAR}},init:function(){this.parent();this.hook.pauseGui=true;this.doStateTransition("HIDDEN",true)},addObservers:function(){},removeObservers:function(){},showMenu:function(){},hideMenu:function(){},exitMenu:function(){}});
sc.ListInfoMenu=sc.BaseMenu.extend({hotkeyHelp:null,hotkeySort:null,helpGui:null,list:null,info:null,sortMenu:null,init:function(b,a,d){this.parent();this.hook.size.x=ig.system.width;this.hook.size.y=ig.system.height;if(b){this.list=b;this.list.setPos(8,29);this.addChildGui(this.list);this.list.doStateTransition("HIDDEN",true)}if(a){this.info=a;this.info.setPos(8,29);this.addChildGui(this.info);this.info.doStateTransition("HIDDEN",true)}this.hotkeyHelp=new sc.ButtonGui("\\i[help]"+ig.lang.get("sc.gui.menu.hotkeys.help"),
void 0,true,sc.BUTTON_TYPE.SMALL);this.hotkeyHelp.keepMouseFocus=true;this.hotkeyHelp.hook.transitions={DEFAULT:{state:{},time:0.2,timeFunction:KEY_SPLINES.EASE},HIDDEN:{state:{offsetY:-this.hotkeyHelp.hook.size.y},time:0.2,timeFunction:KEY_SPLINES.LINEAR}};this.hotkeyHelp.onButtonPress=this.onHelpButtonPressed.bind(this);if(!d){this.hotkeySort=new sc.ButtonGui("\\i[help3]"+ig.lang.get("sc.gui.menu.item.sort-title"),void 0,true,sc.BUTTON_TYPE.SMALL);this.hotkeySort.keepMouseFocus=true;this.hotkeySort.hook.transitions=
{DEFAULT:{state:{},time:0.2,timeFunction:KEY_SPLINES.EASE},HIDDEN:{state:{offsetY:-this.hotkeySort.hook.size.y},time:0.2,timeFunction:KEY_SPLINES.LINEAR}};this.hotkeySort.onButtonPress=this.onSortButtonPress.bind(this);this.sortMenu=new sc.SortMenu(this.onExecuteSort.bind(this))}this.doStateTransition("DEFAULT")},addObservers:function(){sc.Model.addObserver(sc.menu,this);this.list&&this.list.addObservers&&this.list.addObservers()},removeObservers:function(){sc.Model.removeObserver(sc.menu,this);this.list&&
this.list.removeObservers&&this.list.removeObservers()},showMenu:function(){this.addObservers();sc.menu.pushBackCallback(this.onBackButtonPress.bind(this));sc.menu.moveLeaSprite(0,0,sc.MENU_LEA_STATE.HIDDEN);ig.interact.setBlockDelay(0.2);this.list&&this.list.show();this.info&&this.info.show();this.onAddHotkeys()},hideMenu:function(){this.removeObservers();this.exitMenu()},exitMenu:function(){sc.menu.buttonInteract.removeGlobalButton(this.hotkeyHelp);this.sortMenu&&sc.menu.buttonInteract.removeGlobalButton(this.hotkeySort);
this.list&&this.list.hide();this.info&&this.info.hide();this.helpGui=null;this.sortMenu&&this.sortMenu.hideSortMenu()},updateSortMenuButton:function(b){if(this.sortMenu){var a="\\i[help3]"+ig.lang.get("sc.gui.menu.item.sort-title")+": ";this.hotkeySort.setText(a+("\\c[3]"+b+"\\c[0]"));sc.menu.updateHotkeys()}},onHotkeyHelpCheck:function(){return sc.control.menuHotkeyHelp()},onHelpButtonPressed:function(){sc.menu.removeHotkeys();this.createHelpGui();if(this.helpGui){ig.gui.addGuiElement(this.helpGui);
this.helpGui.openMenu&&this.helpGui.openMenu()}},onHotkeySortCheck:function(){return sc.control.menuHotkeyHelp3()},onSortButtonPress:function(){if(this.sortMenu.active)this.sortMenu.hideSortMenu();else{ig.gui.addGuiElement(this.sortMenu);this.sortMenu&&this.sortMenu.showSortMenu(this.hotkeySort)}},onExecuteSort:function(b){if(b.data){this.sortMenu&&this.sortMenu.hideSortMenu();sc.menu.sortList(b)}},createHelpGui:function(){},onAddHotkeys:function(b){sc.menu.buttonInteract.addGlobalButton(this.hotkeyHelp,
this.onHotkeyHelpCheck.bind(this));this.sortMenu&&sc.menu.buttonInteract.addGlobalButton(this.hotkeySort,this.onHotkeySortCheck.bind(this));this.commitHotKeysToTopBar(b)},commitHotKeysToTopBar:function(b){this.sortMenu&&sc.menu.addHotkey(function(){return this.hotkeySort}.bind(this));sc.menu.addHotkey(function(){return this.hotkeyHelp}.bind(this));sc.menu.commitHotkeys(b)},onBackButtonPress:function(){sc.menu.popBackCallback();sc.menu.popMenu()},modelChanged:function(){}})});ig.baked=!0;
ig.module("game.feature.menu.gui.list-boxes").requires("impact.feature.gui.gui","game.feature.menu.gui.menu-misc").defines(function(){sc.LIST_COLUMNS={ONE:1,TWO:2};sc.ButtonListBox=sc.ScrollPane.extend({buttonGroup:null,contentPane:null,paddingTop:0,paddingBetween:0,columnPadding:0,buttonWidth:0,useShoulderScroll:false,forceLastScroll:false,buttonInteract:null,pageSize:0,offsets:{x:0,y:0},columns:sc.LIST_COLUMNS.ONE,_prevIndex:0,_skipFirst:false,_prevScrollBarHeight:0,init:function(b,a,d,c,e,f,g){this.parent(sc.ScrollType.Y_ONLY);
this.buttonInteract=g||sc.menu.buttonInteract;this.contentPane=new ig.GuiElementBase;this.setContent(this.contentPane);this.paddingTop=b||0;this.paddingBetween=a||0;this.pageSize=d||0;this.columns=c||sc.LIST_COLUMNS.ONE;this.columnPadding=this.columns>1?e||0:0;this.buttonWidth=this.columns>1?f||0:0;this.buttonGroup=new sc.ButtonGroup(false,this.columns>1?ig.BUTTON_GROUP_SELECT_TYPE.ALL:ig.BUTTON_GROUP_SELECT_TYPE.VERTICAL);this.addSelectionCallback(this.onSelectionChange.bind(this))},setButtonGroup:function(b){if(b){if(this.buttonGroup.isActive()){sc.menu.buttonInteract.removeButtonGroup(this.buttonGroup);
this.buttonGroup.clear();this.buttonGroup.clearSelectionCallbacks()}this.buttonGroup=b;this.buttonGroup.addSelectionCallback(this.onSelectionChange.bind(this))}},activate:function(b){b?b.pushButtonGroup(this.buttonGroup):sc.menu.buttonInteract.pushButtonGroup(this.buttonGroup)},deactivate:function(b){b?b.removeButtonGroup(this.buttonGroup):sc.menu.buttonInteract.removeButtonGroup(this.buttonGroup)},addSelectionCallback:function(b){b&&this.buttonGroup.addSelectionCallback(b)},updateContentHeight:function(){this._setContentHeight(this._getContentHeight())},
addButton:function(b,a,d,c){var e=this.contentPane.hook.children.length,f=this._getContentHeight(e%this.columns!=0),g=e%this.columns,h=Math.floor(e/this.columns);b.setPos(e%this.columns*this.buttonWidth+this.columnPadding+(d||0),f+this.paddingBetween+(c||0));b.setAlign(ig.GUI_ALIGN.X_LEFT,ig.GUI_ALIGN.Y_TOP);a||this.buttonGroup.addFocusGui(b,g,h+this.offsets.y);this.contentPane.addChildGui(b);this._setContentHeight(this._getContentHeight())},addGui:function(b){var a=this._getContentHeight(this.contentPane.hook.children.length%
this.columns!=0)+this.paddingBetween;b.setPos(0,a)},insertButton:function(b,a,d,c,e,f){this.contentPane.insertChildGui(b,a);b.setAlign(ig.GUI_ALIGN.X_LEFT,ig.GUI_ALIGN.Y_TOP);var g=a%this.columns,a=Math.floor(a/this.columns);e||this.buttonGroup.insertFocusGui(b,g,a);this._repositionButtons(d,c,void 0,f)},removeButton:function(b,a,d,c,e){a?this.contentPane.getChildGuiByIndex(b).doStateTransition(a,false,true):this.contentPane.removeChildGuiByIndex(b);var a=b%this.columns,f=Math.floor(b/this.columns);
e||this.buttonGroup.removeFocusGui(a,f);this._repositionButtons(d,c,b)},moveButton:function(b,a,d,c,e,f){if(b!=a){var g=this.contentPane.hook.children,h=null,i=g[b],j=0;if(b>a)for(j=a;j<b;j++){h=g[j];h.doPosTranstition(i.pos.x,h.pos.y+i.size.y,d,c||KEY_SPLINES.EASE,0,true);f&&f(h.gui,1)}else if(b<a)for(j=b;j<a;j++){h=g[j];h.doPosTranstition(i.pos.x,h.pos.y-i.size.y,d,c||KEY_SPLINES.EASE,0,true);f&&f(h.gui,-1)}i.doPosTranstition(0,g[a].pos.y,d,c||KEY_SPLINES.EASE,0,true,function(){var c=this.contentPane.removeChildGuiByIndex(b);
this.contentPane.insertChildGui(c,a)}.bind(this));if(!e){d=b%this.columns;c=Math.floor(b/this.columns);e=this.buttonGroup.removeFocusGui(d,c);d=a%this.columns;c=Math.floor(a/this.columns);this.buttonGroup.insertFocusGui(e,d,c)}}},getIndex:function(b){if(!b)return-1;for(var a=this.contentPane.hook.children,d=a.length,b=b.hook;d--;)if(b==a[d])return d;return-1},getChildren:function(){return this.contentPane.hook.children},onGetHeightAtIndex:null,getHeightAtIndex:function(b,a){if(!a&&this.onGetHeightAtIndex)return this.onGetHeightAtIndex(this,
b);if(this.columns>=2){for(var d=this.contentPane.hook.children,c=Math.min(b+1,d.length),e=0;c--;)e=e+(d[c].size.y+this.paddingBetween);return e+this.paddingTop}d=this.contentPane.hook.children;c=d[b]?d[b].pos.y+d[b].size.y:this.paddingTop;this.forceLastScroll&&b==d.length-1&&(c=c+200);return c},getScrollYAtIndex:function(b){b=this.getHeightAtIndex(b);return Math.max(b-(this.box.hook.size.y+this.box.hook.scroll.y*-1),0)},setScrollAtCurrentYIndex:function(){var b=this.getHeightAtIndex(this.buttonGroup.current.y-
1)-this.paddingTop;this.setScrollY(b,true,true)},clear:function(b){this._prevIndex=0;this._skipFirst=b||false;this.contentPane.removeAllChildren();this.contentPane.hook.size.y=0;this.box.doScrollTransition(0,0,0);this.recalculateScrollBars()},scrollToY:function(b,a){this._skipFirst=false;this.box.doScrollTransition(0,0,0);this.scrollY(b,a)},setScrollY:function(b,a,d){this._skipFirst=false;d||this.box.doScrollTransition(0,0,0);this.parent(b,a)},update:function(){this.parent();this.buttonInteract.isActive()&&
this.buttonGroup.isActive()&&(sc.control.menuScrollUp()?this.scrollY(-this.pageSize):sc.control.menuScrollDown()&&this.scrollY(this.pageSize))},onSelectionChange:function(){var b=this.buttonGroup.getCurrentY();if(ig.input.mouseGuiActive)this._prevIndex=-1;else{var a=this._prevIndex;if(a<b){var a=this.getHeightAtIndex(b),d=this.box.hook.size.y+this.box.hook.scroll.y*-1,d=Math.max(a-d,0);if(d>0)this.scrollY(d,this._skipFirst);else{d=this.box.hook.scroll.y*-1;if(a<=d){a=this.getHeightAtIndex(b-1)-this.paddingTop;
this.scrollY(-(d-a),this._skipFirst)}}}else if(a>b){a=this.getHeightAtIndex(b-1)-this.paddingTop;d=this.box.hook.scroll.y*-1;d=Math.max(d-a,0);if(d>0)this.scrollY(-d,this._skipFirst);else{d=this.box.hook.size.y+this.box.hook.scroll.y*-1;a=this.getHeightAtIndex(b);d<=a&&this.scrollY(a-d,this._skipFirst)}}this._skipFirst=false;this._prevIndex=b}},_repositionButtons:function(b,a,d,c){for(var e=this.contentPane.hook.children,f=0,g=this.paddingTop,h=null,i=0;i<e.length;i++)if(!(d!=void 0&&d==i)){h=e[i];
f=i%this.columns*this.buttonWidth+this.columnPadding;if(b)h.doPosTranstition(f,g,b,a||KEY_SPLINES.EASE,0,true);else{if(!c)h.pos.x=f;h.pos.y=g}(i+1)%this.columns==0&&(g=g+(h.size.y+this.paddingBetween))}this._setContentHeight(g)},_getContentHeight:function(b){var a=this.contentPane.hook.children;if(this.columns>=2){var d=a.length;b&&(d=d-1);for(b=0;d--;){b=b+(a[d].size.y+this.paddingBetween);d=d-(this.columns-1);if(d<0)break}return b+this.paddingTop}if(a.length==0)return this.paddingTop;a=a[a.length-
1];return b=a.pos.y+a.size.y},_setContentHeight:function(b){this.contentPane.hook.size.y=b;this.recalculateScrollBars()}});sc.ItemListBox=ig.GuiElementBase.extend({list:null,select:null,quantity:null,bg:null,init:function(b,a,d){this.parent();this.bg=new sc.MenuScanLines;this.bg.setAlign(ig.GUI_ALIGN.X_LEFT,ig.GUI_ALIGN.Y_BOTTOM);this.bg.hook.size.x=this.hook.size.x;this.list=new sc.ButtonListBox(b,0,20,void 0,void 0,void 0,d);this.list.setAlign(ig.GUI_ALIGN.X_LEFT,ig.GUI_ALIGN.Y_BOTTOM);this.list.hook.size.x=
this.hook.size.x;this.addChildGui(this.bg);if(!a){this.quantity=new sc.TextGui(ig.lang.get("sc.gui.menu.quantity"),{speed:ig.TextBlock.SPEED.IMMEDIATE,font:sc.fontsystem.tinyFont});this.quantity.setAlign(ig.GUI_ALIGN.X_RIGHT,ig.GUI_ALIGN.Y_TOP);this.quantity.setPos(1,0);this.addChildGui(this.quantity)}this.addChildGui(this.list)},setSize:function(b,a){this.parent(b,a);this.bg.hook.size.x=this.hook.size.x;this.bg.hook.size.y=this.hook.size.y-7;this.list.setSize(this.hook.size.x,this.hook.size.y-7)},
clear:function(b){this.list.clear(b)},addButton:function(b){this.list.addButton(b)},getChildren:function(){return this.list.getChildren()}});sc.MultiColumnItemListBox=ig.GuiElementBase.extend({list:null,selects:[],quantities:[],bg:null,columns:sc.LIST_COLUMNS.ONE,init:function(b,a,d,c){this.parent();this.columns=d||sc.LIST_COLUMNS.ONE;this.bg=new sc.MenuScanLines;this.bg.setAlign(ig.GUI_ALIGN.X_LEFT,ig.GUI_ALIGN.Y_BOTTOM);this.bg.hook.size.x=this.hook.size.x;this.addChildGui(this.bg);for(var e,a=
a||0,c=c||0,f=a+c,g=0,h=0;h<this.columns;h++){e=new sc.TextGui(ig.lang.get("sc.gui.menu.select"),{speed:ig.TextBlock.SPEED.IMMEDIATE,font:sc.fontsystem.tinyFont});e.setPos(7+h*f,0);e.hook.transitions={DEFAULT:{state:{},time:0.2,timeFunction:KEY_SPLINES.LINEAR},HIDDEN:{state:{alpha:0},time:0.2,timeFunction:KEY_SPLINES.LINEAR}};this.selects[h]=e;this.addChildGui(e);g=this.columns*f-(h+1)*f;e=new sc.TextGui(ig.lang.get("sc.gui.menu.quantity"),{speed:ig.TextBlock.SPEED.IMMEDIATE,font:sc.fontsystem.tinyFont});
e.setAlign(ig.GUI_ALIGN.X_RIGHT,ig.GUI_ALIGN.Y_TOP);e.setPos(g+4,0);e.hook.transitions={DEFAULT:{state:{},time:0.1,timeFunction:KEY_SPLINES.LINEAR},HIDDEN:{state:{alpha:0,offsetX:4},time:0.1,timeFunction:KEY_SPLINES.LINEAR}};this.quantities[h]=e;this.addChildGui(e)}this.list=new sc.ButtonListBox(b,0,20,d,c,a);this.list.setAlign(ig.GUI_ALIGN.X_LEFT,ig.GUI_ALIGN.Y_BOTTOM);this.list.hook.size.x=this.hook.size.x;this.addChildGui(this.list)},addButton:function(b,a){this.list.addButton(b,a)},clear:function(b){this.list.clear(b)},
scrollToY:function(b,a){this.list.scrollY(b,a)},setSelectState:function(b,a){for(var d=this.selects.length;d--;)this.selects[d].doStateTransition(b,a)},setQuantityState:function(b,a){for(var d=this.quantities.length;d--;)this.quantities[d].doStateTransition(b,a)},buttonGroup:function(){return this.list.buttonGroup},activate:function(){sc.menu.buttonInteract.pushButtonGroup(this.list.buttonGroup)},deactivate:function(){sc.menu.buttonInteract.removeButtonGroup(this.list.buttonGroup)},setSize:function(b,
a){this.parent(b,a);this.bg.hook.size.x=this.hook.size.x;this.bg.hook.size.y=this.hook.size.y-7;this.list.setSize(this.hook.size.x,this.hook.size.y-7)}})});ig.baked=!0;
ig.module("game.feature.menu.gui.main-menu").requires("impact.feature.gui.gui","impact.feature.gui.base.basic-gui","game.feature.menu.gui.menu-misc","game.feature.menu.gui.list-boxes").defines(function(){sc.MainMenu=ig.GuiElementBase.extend({screenBlocking:true,gfx:new ig.Image("media/gui/menu.png"),transitions:{DEFAULT:{state:{},time:0.1,timeFunction:KEY_SPLINES.LINEAR},HIDDEN:{state:{alpha:0},time:0.2,timeFunction:KEY_SPLINES.LINEAR}},submenus:{},topBar:null,hotkeyBar:null,smallRhombus:null,lea:null,
sline:null,moneyTime:null,menuDisplay:null,backButton:null,info:null,buffInfo:null,subMenuInsertPos:0,init:function(){this.parent();this.hook.zIndex=1200;this.hook.pauseGui=true;this.hook.size.x=ig.system.width;this.hook.size.y=ig.system.height;this.hook.screenBlocking=true;sc.Model.addObserver(sc.model,this);sc.Model.addObserver(sc.model.menu,this);this.doStateTransition("HIDDEN",true);if(!this.constructor.PATTERN)this.constructor.PATTERN=this.gfx.createPattern(0,0,32,320,ig.ImagePattern.OPT.REPEAT_X);
this.submenus.start=new sc.StartMenu;var d=new sc.ButtonGui("\\i[back]"+ig.lang.get("sc.gui.menu.back"),sc.BUTTON_TOP_MENU_WIDTH,true,sc.BUTTON_TYPE.SMALL,sc.BUTTON_SOUND.back);d.keepMouseFocus=true;d.hook.transitions={DEFAULT:{state:{},time:0.2,timeFunction:KEY_SPLINES.EASE},HIDDEN:{state:{offsetX:-sc.BUTTON_TOP_MENU_WIDTH},time:0.2,timeFunction:KEY_SPLINES.LINEAR}};d.setAlign(ig.GUI_ALIGN.X_RIGHT,ig.GUI_ALIGN.Y_TOP);d.onButtonPress=function(){sc.menu.invokeTopBackButton()}.bind(this);d.setData(ig.lang.get("sc.gui.menu.description.back"));
this.backButton=d;d=new ig.ColorGui("#000000",this.hook.size.x,21);d.setAlign(ig.GUI_ALIGN.X_LEFT,ig.GUI_ALIGN.Y_TOP);d.hook.transitions={DEFAULT:{state:{alpha:0.5},time:0.2,timeFunction:KEY_SPLINES.EASE},HIDDEN:{state:{offsetY:-21,alpha:0.5},time:0.2,timeFunction:KEY_SPLINES.LINEAR}};d.doStateTransition("HIDDEN",true);this.topBar=d;d=new sc.MainMenu.TopBar(this.hook.size.x);d.doStateTransition("HIDDEN",true);this.hotkeyBar=d;d=new sc.MainMenu.SmallRhombus;d.setAlign(ig.GUI_ALIGN.X_LEFT,ig.GUI_ALIGN.Y_TOP);
this.smallRhombus=d;this.info=new sc.InfoBar(this.hook.size.x,21);this.info.setAlign(ig.GUI_ALIGN.X_RIGHT,ig.GUI_ALIGN.Y_BOTTOM);this.buffInfo=new sc.BuffInfo;this.moneyTime=new sc.TimeAndMoneyGUI;this.lea=new sc.MainMenu.Lea;this.lea.setAlign(ig.GUI_ALIGN.X_CENTER,ig.GUI_ALIGN.Y_CENTER);this.lea.setPos(0,101);this.sline=new sc.MainMenu.StatusLine;this.sline.setPos(b,a);this.menuDisplay=new sc.MainMenu.CurrentMenuDisplay;this.menuDisplay.setAlign(ig.GUI_ALIGN.X_LEFT,ig.GUI_ALIGN.Y_TOP);this.addChildGui(this.smallRhombus);
this.addChildGui(this.sline);this.addChildGui(this.lea);this.addChildGui(this.submenus.start);this.addChildGui(this.topBar);this.addChildGui(this.hotkeyBar);this.addChildGui(this.info);this.info.addChildGui(this.buffInfo);this.addChildGui(this.moneyTime);this.addChildGui(this.menuDisplay);this.addChildGui(this.backButton);sc.menu.guiReference=this},update:function(){this.parent()},updateDrawables:function(a){a.addPattern(this.constructor.PATTERN,0,0,0,0,this.hook.size.x,this.hook.size.y)},_checkBackButtonInput:function(){return sc.control.menuBack()},
_onBackButton:function(){sc.model.enterPrevSubState()},_enterMenu:function(){this._preCleanUp();sc.trophies.validateFeatPoints();this.hotkeyBar.enterMenu();if(sc.menu.directMode&&sc.menu.directMenu){this._switchMenus(sc.menu.directMenu,0);this._makeExtraTransitions(sc.menu.directMenu,null,true);this.menuDisplay.pushMenuDisplay(sc.menu.getMenuAsName(sc.menu.directMenu));sc.menu.currentMenu=sc.menu.directMenu}else{sc.menu.directMode=false;this.submenus.start.showMenu();this.menuDisplay.pushMenuDisplay(ig.lang.get("sc.gui.menu.menu-titles.start"));
this.lea.reset();this.lea.doStateTransition("DEFAULT");this.info.doSizeTransition(431,21);this.moneyTime.doStateTransition("DEFAULT");this.smallRhombus.doStateTransition("DEFAULT");this.sline.showLine()}sc.menu.enterMenu();sc.menu.buttonInteract.addGlobalButton(this.backButton,this._checkBackButtonInput.bind(this));sc.menu.pushBackCallback(this._onBackButton.bind(this));var a=this._getMenuFromID(sc.menu.currentMenu);a.onPostDirectEnter&&a.onPostDirectEnter();this.backButton.doStateTransition("DEFAULT");
this.topBar.doStateTransition("DEFAULT");this.info.doStateTransition("DEFAULT")},_exitMenu:function(){this._getMenuFromID(sc.menu.currentMenu).exitMenu();this.submenus.start.exitMenu();sc.menu.buttonInteract.clearAllButtons();sc.menu.exitMenu();ig.interact.setBlockDelay(0.2);this.backButton.doStateTransition("HIDDEN");this.topBar.doStateTransition("HIDDEN");this.hotkeyBar.exitMenu();this.smallRhombus.doStateTransition("HIDDEN");this.info.doStateTransition("HIDDEN");this.moneyTime.doStateTransition("HIDDEN");
this.sline.hideLine();this.lea.hideLea();this.menuDisplay.hideDisplay()},_preCleanUp:function(){this.buffInfo.setText("");this.info.setText("");this.menuDisplay.reset();this.moneyTime.updateCredit();this._postCleanUp()},_postCleanUp:function(){for(var a in this.submenus)if(a!="start"&&this.submenus[a]){this.removeChildGui(this.submenus[a]);this.submenus[a]&&this.submenus[a].removeObservers();this.submenus[a]=null}this.hotkeyBar.cleanChildren()},_switchMenus:function(a,b){this._createMenu(a);var e=
this._getMenuFromID(b),f=this._getMenuFromID(a);if(e!=null){e.hideMenu(f,a);f.showMenu(e,b)}},_createMenu:function(a){if(a!=sc.MENU_SUBMENU.START&&!this.submenus[sc.SUB_MENU_INFO[a].name]){this.submenus[sc.SUB_MENU_INFO[a].name]=new sc.SUB_MENU_INFO[a].Clazz;this.insertChildGui(this.submenus[sc.SUB_MENU_INFO[a].name],4)}},_getMenuFromID:function(a){return this.submenus[sc.SUB_MENU_INFO[a].name]},_makeExtraTransitions:function(a,b,e){switch(a){case sc.MENU_SUBMENU.START:this.smallRhombus.doStateTransition("DEFAULT",
e);this.sline.showLine(0.1);break;default:this.smallRhombus.doStateTransition("HIDDEN",e);this.sline.hideLineFade()}if(a==sc.MENU_SUBMENU.START||a==sc.MENU_SUBMENU.STATUS&&sc.menu.statusPage==0&&!sc.menu.helpMenuOpen){this.info.doSizeTransition(431,21,0.1,KEY_SPLINES.EASE_OUT);this.moneyTime.doStateTransition("DEFAULT_FAST")}else{this.info.doSizeTransition(ig.system.width,21,0.1,KEY_SPLINES.EASE_OUT);this.moneyTime.doStateTransition("HIDDEN_FAST")}},modelChanged:function(a,b,e){if(a==sc.model)if(b==
sc.GAME_MODEL_MSG.SUB_STATE_CHANGED){(a=sc.model.isMenu())?this.doStateTransition("DEFAULT",false,false,function(){sc.menu.fullyEntered()}.bind(this)):this.doStateTransition("HIDDEN",false,false,function(){this._postCleanUp();sc.menu.invokePostExit()}.bind(this));a?this._enterMenu():this._exitMenu()}else b==sc.GAME_MODEL_MSG.RESET_MENU_STATE&&this.submenus.start.resetButtonFocus();else if(a==sc.menu)if(b==sc.MENU_EVENT.INFO_TEXT_CHANGED)this.info.setText(sc.menu.infoText,e?0.5:0);else if(b==sc.MENU_EVENT.ENTER_MENU||
b==sc.MENU_EVENT.LEAVE_MENU){this.hotkeyBar.hideHotkeys();this._switchMenus(sc.menu.currentMenu,sc.menu.previousMenu);this._makeExtraTransitions(sc.menu.currentMenu,sc.menu.previousMenu)}else if(b==sc.MENU_EVENT.REMOVE_HOTKEYS)this.hotkeyBar.hideHotkeys();else if(b==sc.MENU_EVENT.TOP_BAR_CHANGED)this.hotkeyBar.addHotkeysToTopBar(e);else if(b==sc.MENU_EVENT.TOP_BAR_UPDATE)this.hotkeyBar.updateHotkeys(e);else if(b==sc.MENU_EVENT.SET_BUFF_INFO)this.buffInfo.setText(sc.menu.buffText,e?0.5:0);else if(b==
sc.MENU_EVENT.STATUS_SET_PAGE)if(sc.menu.statusPage==0&&!sc.menu.helpMenuOpen){this.info.doSizeTransition(431,21,0.1,KEY_SPLINES.EASE_OUT);this.moneyTime.doStateTransition("DEFAULT_FAST")}else{this.info.doSizeTransition(ig.system.width,21,0.1,KEY_SPLINES.EASE_OUT);this.moneyTime.doStateTransition("HIDDEN_FAST")}}});sc.MainMenu.TopBar=ig.GuiElementBase.extend({hotkeys:[],transitions:{DEFAULT:{state:{alpha:1},time:0.2,timeFunction:KEY_SPLINES.EASE},HIDDEN:{state:{offsetY:-21,alpha:0},time:0.2,timeFunction:KEY_SPLINES.LINEAR}},
_lateHotKeys:false,_hotkeyTimer:0.2,_hotkeyTime:0.2,init:function(a){this.parent();this.setSize(a,21)},update:function(){this.parent();if(this._hotkeyTimer<this._hotkeyTime){this._hotkeyTimer=this._hotkeyTimer+ig.system.actualTick;if(this._hotkeyTimer>=this._hotkeyTime){this._hotkeyTimer=this._hotkeyTime;this.hook.removeAllChildren();this._lateHotKeys&&this._addHotKeyButtons()}}},enterMenu:function(){this.hook.removeAllChildren();this._hotkeyTime=this._hotkeyTimer=0.2;this.doStateTransition("DEFAULT")},
exitMenu:function(){this.doStateTransition("HIDDEN",false,false,function(){this.hook.removeAllChildren()}.bind(this))},cleanChildren:function(){this.hook.removeAllChildren()},_addHotKeyButtons:function(){if(this.hook.children.length>0){ig.warn("At this point there should be no children, but there are: "+this.hook.children.length);this.hook.removeAllChildren()}this._positionHotKeys(true);for(var a=sc.menu.hotkeysCallbacks,b=66+(sc.options.hdMode?7:5),e=a.length;e--;){var f=a[e]();if(f){f.setAlign(ig.GUI_ALIGN.X_RIGHT,
ig.GUI_ALIGN.Y_TOP);f.hook.pos.x=b;b=b+(f.hook.size.x+(sc.options.hdMode?7:5));f.hook.doStateTransition("HIDDEN",true);f.startHidden||f.hook.doStateTransition("DEFAULT");this.hook.addChildHook(f.hook)}}},_positionHotKeys:function(a,b){for(var e=sc.menu.hotkeysCallbacks,f=66+(sc.options.hdMode?7:5),g=e.length;g--;){var h=e[g]();if(h){b&&h.resetText&&h.resetText();h.setAlign(ig.GUI_ALIGN.X_RIGHT,ig.GUI_ALIGN.Y_TOP);h.hook.pos.x=f;f=f+(h.hook.size.x+(sc.options.hdMode?7:5));if(a){h.hook.doStateTransition("HIDDEN",
true);h.startHidden||h.hook.doStateTransition("DEFAULT");this.hook.addChildHook(h.hook)}}}},hideHotkeys:function(){var a=this.hook.children;if(a.length>0){this._hotkeyTimer=0;this._hotkeyTime=0.2;for(var b=a.length;b--;)a[b].doStateTransition("HIDDEN")}},addHotkeysToTopBar:function(a){if(a){this._hotkeyTimer=0;this._hotkeyTime=0.2}this._hotkeyTimer<this._hotkeyTime?this._lateHotKeys=true:this._addHotKeyButtons()},updateHotkeys:function(a){this._positionHotKeys(false,a)}});sc.MainMenu.CurrentMenuDisplay=
ig.GuiElementBase.extend({boxes:[],init:function(){this.parent();this.setSize(120,21);sc.Model.addObserver(sc.model.menu,this)},reset:function(){this.boxes=[];this.removeAllChildren()},hideDisplay:function(){if(this.boxes.length>0){var a=this.boxes[this.boxes.length-1];a.hook.currentStateName!="HIDDEN_TOP"&&a.doStateTransition("HIDDEN")}},pushMenuDisplay:function(a){this.boxes.length>0&&this.boxes[this.boxes.length-1].doStateTransition("HIDDEN_TOP");a=new sc.MainMenu.SubMenuBox(a);this.boxes.push(a);
this.addChildGui(a);a.doStateTransition("DEFAULT")},popMenuDisplay:function(){if(this.boxes.length>1){var a=this.boxes[this.boxes.length-2];this.addChildGui(a);a.doStateTransition("DEFAULT");a=this.boxes[this.boxes.length-1];a.doStateTransition("HIDDEN",false,false,function(){}.bind(this));this.boxes.pop()}else if(this.boxes.length>0){a=this.boxes[this.boxes.length-1];a.doStateTransition("HIDDEN",false,false,function(){this.boxes.pop()}.bind(this))}},modelChanged:function(a,b){b==sc.MENU_EVENT.ENTER_MENU?
this.pushMenuDisplay(a.getCurrentMenuAsName()):b==sc.MENU_EVENT.LEAVE_MENU&&this.popMenuDisplay()}});sc.MainMenu.SubMenuBox=ig.BoxGui.extend({ninepatch:new ig.NinePatch("media/gui/menu.png",{width:2,height:21,left:2,top:0,right:7,bottom:0,offsets:{"default":{x:88,y:436}}}),transitions:{DEFAULT:{state:{},time:0.2,timeFunction:KEY_SPLINES.EASE},HIDDEN:{state:{alpha:0,offsetX:-120},time:0.2,timeFunction:KEY_SPLINES.LINEAR},HIDDEN_TOP:{state:{offsetY:-21},time:0.2,timeFunction:KEY_SPLINES.LINEAR}},text:null,
init:function(a){this.parent(120,21);this.setAlign(ig.GUI_ALIGN.X_CENTER,ig.GUI_ALIGN.Y_CENTER);this.text=new sc.TextGui(a,{speed:ig.TextBlock.SPEED.IMMEDIATE});this.text.setAlign(ig.GUI_ALIGN.X_CENTER,ig.GUI_ALIGN.Y_CENTER);this.addChildGui(this.text);this.doStateTransition("HIDDEN",true)}});var b=64,a=85;sc.MainMenu.StatusLine=ig.GuiElementBase.extend({slope:null,line:null,init:function(){this.parent();this.hook.size.x=200;this.hook.size.y=30;this.hook.clip=true;this.slope=new sc.SlopeLine(19);
this.slope.hide();this.line=new ig.ColorGui("white",sc.options.hdMode?176:128,1);this.line.setPos(19,19);this.line.setPivot(0,0);this.line.hook.transitions={DEFAULT:{state:{},time:0.2,timeFunction:KEY_SPLINES.LINEAR},HIDDEN:{state:{scaleX:0},time:0.1,timeFunction:KEY_SPLINES.LINEAR},HIDDEN_FADE:{state:{scaleX:0,alpha:0},time:0.1,timeFunction:KEY_SPLINES.LINEAR}};this.line.doStateTransition("HIDDEN",true);this.addChildGui(this.slope);this.addChildGui(this.line)},showLine:function(a){a=a!=void 0?a:
0;this.slope.doStateTransition("DEFAULT");this.slope.show(0.1,a);this.line.doStateTransition("DEFAULT",false,false,null,0.1+a)},hideLine:function(){this.line.doStateTransition("HIDDEN");this.slope.hide(0.1,0.11)},hideLineFade:function(){this.line.doStateTransition("HIDDEN_FADE");this.slope.doStateTransition("HIDDEN");this.slope.hide(0.1,0.11)}});sc.MainMenu.LeaLarge=ig.GuiElementBase.extend({gfx:new ig.Image("media/gui/menu.png"),skinGfx:null,bounds:null,transitions:{DEFAULT:{state:{},time:0.2,timeFunction:KEY_SPLINES.EASE},
FADE_TO_SMALL:{state:{scaleX:0.69,scaleY:0.69,alpha:1},time:0.2,timeFunction:KEY_SPLINES.EASE},FADE_IN_ALPHA:{state:{scaleX:0.69,scaleY:0.69,alpha:0},time:0.2,timeFunction:KEY_SPLINES.EASE},HIDDEN:{state:{alpha:0},time:0.2,timeFunction:KEY_SPLINES.LINEAR}},init:function(){this.parent();this.hook.size.x=138;this.hook.size.y=380;this.hook.pivot.x=this.hook.size.x/2;this.hook.pivot.y=this.hook.size.y/2;this.doStateTransition("DEFAULT")},setBounds:function(a){if(this.bounds=a){this.hook.size.x=a.w;this.hook.size.y=
a.h}else{this.hook.size.x=138;this.hook.size.y=380}this.hook.pivot.x=this.hook.size.x/2;this.hook.pivot.y=this.hook.size.y/2},updateDrawables:function(a){this.skinGfx?this.bounds?a.addDraw().setGfx(this.skinGfx,this.bounds.offX||0,this.bounds.offY||0,this.bounds.x||0,this.bounds.y||0,this.bounds.w||0,this.bounds.h||0):a.addDraw().setGfx(this.skinGfx,-6,-18,0,0,144,400):a.addDraw().setGfx(this.gfx,0,0,173,0,138,380)}});sc.MainMenu.LeaSmall=ig.GuiElementBase.extend({gfx:new ig.Image("media/gui/menu.png"),
skinGfx:null,bounds:null,transitions:{DEFAULT:{state:{},time:0.2,timeFunction:KEY_SPLINES.LINEAR},HIDDEN:{state:{alpha:0},time:0.2,timeFunction:KEY_SPLINES.LINEAR}},init:function(){this.parent();this.hook.size.x=97;this.hook.size.y=263;this.hook.pivot.x=this.hook.size.x/2;this.hook.pivot.y=this.hook.size.y/2;this.doStateTransition("DEFAULT")},setBounds:function(a){if(this.bounds=a){this.hook.size.x=a.w;this.hook.size.y=a.h}else{this.hook.size.x=97;this.hook.size.y=263}this.hook.pivot.x=this.hook.size.x/
2;this.hook.pivot.y=this.hook.size.y/2},updateDrawables:function(a){this.skinGfx?this.bounds?a.addDraw().setGfx(this.skinGfx,this.bounds.offX||0,this.bounds.offY||0,this.bounds.x||0,this.bounds.y||0,this.bounds.w||0,this.bounds.h||0):a.addDraw().setGfx(this.skinGfx,-8,-18,144,0,112,288):a.addGfx(this.gfx,0,0,311,0,97,263)}});sc.MainMenu.Lea=ig.GuiElementBase.extend({transitions:{DEFAULT:{state:{},time:0.2,timeFunction:KEY_SPLINES.EASE},HIDDEN:{state:{alpha:0,offsetY:20},time:0.2,timeFunction:KEY_SPLINES.LINEAR},
HIDDEN_NO_OFFSET:{state:{alpha:0},time:0.2,timeFunction:KEY_SPLINES.LINEAR}},large:null,small:null,init:function(){this.parent();this.hook.size.x=138;this.hook.size.y=380;this.large=new sc.MainMenu.LeaLarge;this.large.setAlign(ig.GUI_ALIGN.X_CENTER,ig.GUI_ALIGN.Y_CENTER);this.small=new sc.MainMenu.LeaSmall;this.small.setAlign(ig.GUI_ALIGN.X_CENTER,ig.GUI_ALIGN.Y_CENTER);this.small.setPos(1,0);this.addChildGui(this.large);this.addChildGui(this.small);this.doStateTransition("HIDDEN",true);this.reset();
sc.Model.addObserver(sc.model.menu,this);sc.Model.addObserver(sc.playerSkins,this)},moveLea:function(a,b,e,f){if(this.hook.currentStateName=="HIDDEN"||this.hook.currentStateName=="HIDDEN_NO_OFFSET"){f&&this.hook.doStateTransition("HIDDEN_NO_OFFSET",true);this.hook.doStateTransition("DEFAULT")}f?this.setPos(a,101+b):this.doPosTranstition(0+a,101+b,f?0:0.3,KEY_SPLINES.EASE);if(e&&!this.isSmall())if(f){this.large.doStateTransition("FADE_IN_ALPHA",true);this.small.doStateTransition("DEFAULT",true)}else this.fadeToSmall();
else!e&&this.isSmall()&&this.fadeToLarge()},hideLea:function(){this.isSmall()?this.doStateTransition("HIDDEN_NO_OFFSET",false,false,function(){this.reset();this.doStateTransition("HIDDEN",true)}.bind(this)):this.doStateTransition("HIDDEN",false,false,function(){this.reset()}.bind(this))},reset:function(){this.large.doStateTransition("DEFAULT",true);this.small.doStateTransition("HIDDEN",true);this.setPos(0,101)},fadeToSmall:function(){this.large.doStateTransition("FADE_TO_SMALL",false,false,function(){this.large.doStateTransition("FADE_IN_ALPHA")}.bind(this));
this.small.doStateTransition("DEFAULT",false,false,null,0.2)},fadeToLarge:function(){this.small.doStateTransition("HIDDEN");this.large.doStateTransition("FADE_TO_SMALL",false,false,function(){this.large.doStateTransition("DEFAULT")}.bind(this))},isSmall:function(){return this.small.hook.currentStateName=="DEFAULT"},modelChanged:function(a,b,e){if(a==sc.menu)b==sc.MENU_EVENT.LEA_STATE_CHANGED&&(sc.menu.leaState==sc.MENU_LEA_STATE.HIDDEN?this.hideLea():this.moveLea(e.x,e.y,sc.menu.leaState,e.skip));
else if(a==sc.playerSkins)if((a=sc.playerSkins.getCurrentSkin("Appearance"))&&a.loaded){this.large.setBounds(a.guiImageBounds?a.guiImageBounds.large:null);this.small.setBounds(a.guiImageBounds?a.guiImageBounds.small:null);this.small.skinGfx=a.guiImage;this.large.skinGfx=a.guiImage}else{this.small.skinGfx=null;this.large.skinGfx=null;this.large.setBounds();this.small.setBounds()}}});sc.MainMenu.SmallRhombus=ig.GuiElementBase.extend({gfx:new ig.Image("media/gui/menu.png"),transitions:{DEFAULT:{state:{alpha:0.5,
offsetY:21},time:0.2,timeFunction:KEY_SPLINES.EASE},HIDDEN:{state:{offsetX:-87,alpha:0.5},time:0.2,timeFunction:KEY_SPLINES.LINEAR}},init:function(){this.parent();this.hook.size.x=87;this.hook.size.y=87},updateDrawables:function(a){a.addGfx(this.gfx,0,0,0,425,87,87)}})});ig.baked=!0;
ig.module("game.feature.menu.gui.start-menu").requires("impact.feature.gui.gui","game.feature.menu.gui.base-menu","game.feature.menu.gui.main-menu","game.feature.menu.gui.menu-misc").defines(function(){var b=[{x:4,y:43},{x:12,y:73},{x:20,y:103},{x:28,y:133},{x:28,y:163},{x:20,y:193},{x:12,y:223},{x:4,y:253}];sc.StartMenu=sc.BaseMenu.extend({gfx:new ig.Image("media/gui/menu.png"),buttons:{quest:null,skills:null,equipment:null,items:null,status:null,social:null,synopsis:null,save:null},largeRhombus:null,
transitions:{DEFAULT:{state:{},time:0.1,timeFunction:KEY_SPLINES.LINEAR},HIDDEN:{state:{alpha:0},time:0.1,timeFunction:KEY_SPLINES.LINEAR}},buttonGroup:null,init:function(){this.parent();this.hook.size.x=ig.system.width;this.hook.size.y=ig.system.height;this.buttonGroup=new sc.ButtonGroup;this.buttons.quest=this._createButton("quests",0,function(){sc.menu.pushMenu(sc.MENU_SUBMENU.QUESTS)}.bind(this));this.buttons.skills=this._createButton("skills",1,function(){sc.menu.pushMenu(sc.MENU_SUBMENU.SKILLS)}.bind(this),
sc.model.player.getCore("MENU_CIRCUIT"));this.buttons.equipment=this._createButton("equipment",2,function(){sc.menu.pushMenu(sc.MENU_SUBMENU.EQUIPMENT)}.bind(this));this.buttons.items=this._createButton("items",3,function(){sc.menu.pushMenu(sc.MENU_SUBMENU.ITEMS)}.bind(this));this.buttons.social=this._createButton("social",4,function(){sc.menu.pushMenu(sc.MENU_SUBMENU.SOCIAL)}.bind(this),sc.model.player.getCore("MENU_SOCIAL"));this.buttons.status=this._createButton("status",5,function(){sc.menu.pushMenu(sc.MENU_SUBMENU.STATUS)}.bind(this));
this.buttons.synopsis=this._createButton("synopsis",6,function(){sc.menu.pushMenu(sc.MENU_SUBMENU.SYNOPSIS)}.bind(this),false,true);this.buttons.save=this._createButton("save",7,function(){sc.menu.pushMenu(sc.MENU_SUBMENU.SAVE)}.bind(this));this.buttons.social.setActive(false);var a=new sc.StartMenu.LargeRhombus;a.setAlign(ig.GUI_ALIGN.X_RIGHT,ig.GUI_ALIGN.Y_CENTER);this.largeRhombus=a;this.addChildGui(this.largeRhombus);for(var b in this.buttons)this.addChildGui(this.buttons[b]);this.buttonGroup.addFocusGui(this.buttons.quest,
0,0);this.buttonGroup.addFocusGui(this.buttons.skills,0,1);this.buttonGroup.addFocusGui(this.buttons.equipment,0,2);this.buttonGroup.addFocusGui(this.buttons.items,0,3);this.buttonGroup.addFocusGui(this.buttons.social,0,4);this.buttonGroup.addFocusGui(this.buttons.status,0,5);this.buttonGroup.addFocusGui(this.buttons.synopsis,0,6);this.buttonGroup.addFocusGui(this.buttons.save,0,7);this.buttonGroup.addSelectionCallback(function(a){a.active||a==this.buttons.save?sc.menu.setInfoText(a.data):sc.menu.setInfoText("???")}.bind(this));
this.buttonGroup.setMouseFocusLostCallback(function(){sc.menu.setInfoText("",true)});this.doStateTransition("DEFAULT")},showMenu:function(){if(sc.model.player.getCore(sc.PLAYER_CORE.MENU_SYNOPSIS)){this.buttons.synopsis.setText(ig.lang.get("sc.gui.menu.menu-titles.synopsis"),true);this.buttons.synopsis.setActive(true);(sc.menu.hasNewUnlock(sc.MENU_SUBMENU.LORE)||sc.menu.hasNewUnlock(sc.MENU_SUBMENU.TROPHY))&&sc.model.player.hasItem(135)?this.buttons.synopsis.activateNewOverlay():this.buttons.synopsis.deactivateNewOverlay()}else{this.buttons.synopsis.deactivateNewOverlay();
this.buttons.synopsis.setText("???",true);this.buttons.synopsis.setActive(false)}if(sc.model.player.getCore(sc.PLAYER_CORE.MENU_CIRCUIT)){this.buttons.skills.setText(ig.lang.get("sc.gui.menu.menu-titles.skills"),true);this.buttons.skills.setActive(true)}else{this.buttons.skills.setText("???",true);this.buttons.skills.setActive(false)}if(sc.model.player.getCore(sc.PLAYER_CORE.MENU_SOCIAL)){this.buttons.social.setText(ig.lang.get("sc.gui.menu.menu-titles.social"),true);this.buttons.social.setActive(true)}else{this.buttons.social.setText("???",
true);this.buttons.social.setActive(false)}if(!sc.model.isSaveAllowed()&&!sc.autoControl.isActive()){this.buttons.save.setActive(false);this.buttons.social.setActive(false)}else this.buttons.save.setActive(true);this.buttons.quest.doStateTransition("DEFAULT");this.buttons.skills.doStateTransition("DEFAULT",false,false,null,0.016);this.buttons.equipment.doStateTransition("DEFAULT",false,false,null,0.032);this.buttons.items.doStateTransition("DEFAULT",false,false,null,0.048);this.buttons.social.doStateTransition("DEFAULT",
false,false,null,0.048);this.buttons.status.doStateTransition("DEFAULT",false,false,null,0.032);this.buttons.synopsis.doStateTransition("DEFAULT",false,false,null,0.016);this.buttons.save.doStateTransition("DEFAULT");this.largeRhombus.doStateTransition("DEFAULT",false,false,null,0.016);sc.menu.buttonInteract.pushButtonGroup(this.buttonGroup)},hideMenu:function(){var a=null,b;for(b in this.buttons)(a=this.buttons[b])&&a.doStateTransition("HIDDEN");this.largeRhombus.doStateTransition("HIDDEN");sc.menu.buttonInteract.removeButtonGroup(this.buttonGroup)},
exitMenu:function(){this.hideMenu(null)},resetButtonFocus:function(){this.buttonGroup.setCurrentFocus(0,0)},_createButton:function(a,d,c,e,f){var g=null,g=f?new sc.NewUnlockButton(e?"???":ig.lang.get("sc.gui.menu.menu-titles."+a),sc.BUTTON_MENU_WIDTH):new sc.ButtonGui(e?"???":ig.lang.get("sc.gui.menu.menu-titles."+a),sc.BUTTON_MENU_WIDTH);g.setAlign(ig.GUI_ALIGN.X_RIGHT,ig.GUI_ALIGN.Y_TOP);g.setPos(b[d].x,b[d].y);g.hook.transitions={DEFAULT:{state:{},time:0.2,timeFunction:KEY_SPLINES.EASE},HIDDEN:{state:{offsetX:-(sc.BUTTON_MENU_WIDTH+
b[d].x)},time:0.2,timeFunction:KEY_SPLINES.LINEAR}};g.setData(ig.lang.get("sc.gui.menu.description."+a));g.onButtonPress=c;g.doStateTransition("HIDDEN",true);return g}});sc.StartMenu.LargeRhombus=ig.GuiElementBase.extend({gfx:new ig.Image("media/gui/menu.png"),transitions:{DEFAULT:{state:{alpha:0.5},time:0.2,timeFunction:KEY_SPLINES.EASE},HIDDEN:{state:{offsetX:-141,alpha:0.5},time:0.2,timeFunction:KEY_SPLINES.LINEAR}},init:function(){this.parent();this.hook.size.x=141;this.hook.size.y=279},updateDrawables:function(a){a.addGfx(this.gfx,
0,0,32,0,141,279)}})});ig.baked=!0;
ig.module("game.feature.gui.base.slick-box").requires("impact.feature.gui.base.box","impact.feature.gui.gui").defines(function(){sc.SlickTitleGui=ig.BoxGui.extend({text:null,transitions:{DEFAULT:{state:{},time:0.3,timeFunction:KEY_SPLINES.EASE_OUT},HIDDEN:{state:{alpha:0,scaleY:1,offsetX:-32},time:0.3,timeFunction:KEY_SPLINES.EASE_IN}},ninepatch:new ig.NinePatch("media/gui/message.png",{width:16,height:9,left:0,top:0,right:8,bottom:0,offsets:{"default":{x:0,y:64}}}),init:function(b,a,d){b=new sc.TextGui(b,
{font:sc.fontsystem.tinyFont});d=d||b.hook.size.x+this.tile.right+8;this.parent(d,9,a);this.hook.pivot.y=this.hook.size.y;b.setPos(!a?2:1,0);a&&b.setAlign(ig.GUI_ALIGN.X_RIGHT,ig.GUI_ALIGN.Y_TOP);this.addChildGui(b)}});sc.SlickBoxRawGui=ig.BoxGui.extend({ninepatch:new ig.NinePatch("media/gui/message.png",{width:12,height:12,left:0,top:4,right:4,bottom:0,offsets:{"default":{x:24,y:64}}}),transitions:{DEFAULT:{state:{},time:0.2,timeFunction:KEY_SPLINES.EASE_OUT},HIDDEN:{state:{alpha:0.5,scaleX:1,scaleY:0,
offsetX:0},time:0.2,timeFunction:KEY_SPLINES.EASE_IN}},init:function(b,a,d){this.parent(b,a,d);this.hook.localAlpha=0.5}});sc.SlickBoxGui=sc.SlickBoxRawGui.extend({paddingX:0,paddingY:0,minWidth:0,subGui:null,init:function(b,a,d,c,e){this.paddingX=d||0;this.paddingY=c||0;this.minWidth=e||0;this.parent(0,0,a);this.setContent(b)},setContent:function(b){this.subGui=b;b.hook.align.x=this.flipped?ig.GUI_ALIGN.X_RIGHT:ig.GUI_ALIGN.X_LEFT;b.setPos(2,this.paddingY);var a=b.hook.size.x+this.paddingX+2;if(this.minWidth&&
a<this.minWidth)a=this.minWidth;this.setSize(a,b.hook.size.y+this.paddingY*2);this.removeAllChildren();this.addChildGui(b)}});sc.SlickBigSideGui=ig.BoxGui.extend({ninepatch:new ig.NinePatch("media/gui/message.png",{width:16,height:16,left:0,top:16,right:0,bottom:16,offsets:{"default":{x:40,y:64}}}),init:function(b,a){this.parent(16,b,a);this.hook.localAlpha=0.5}});sc.SlickSmallSideGui=ig.BoxGui.extend({ninepatch:new ig.NinePatch("media/gui/message.png",{width:8,height:32,left:0,top:8,right:0,bottom:8,
offsets:{"default":{x:40,y:64}}}),init:function(b,a){this.parent(8,b,a);this.hook.localAlpha=0.5}})});ig.baked=!0;
ig.module("game.feature.gui.base.misc").requires("impact.feature.interact.gui.focus-gui","impact.feature.gui.gui").defines(function(){sc.DebugFocusGui=ig.FocusGui.extend({color:"#00FF00",overColor:"#FF0000",focusColor:"#0000FF",init:function(b,a){this.parent();this.hook.size.x=b||20;this.hook.size.y=a||20;this.hook.pivot.x=this.hook.size.x/2;this.hook.pivot.y=this.hook.size.y/2},updateDrawables:function(b){var a=null,a=this.focus?this.focusColor:this.hook.mouseOver?this.overColor:this.color;b.addColor(a,
0,0,this.hook.size.x,this.hook.size.y).setAlpha(0.5)}});sc.SlopeLine_Color={WHITE:{x:88,y:458},BLUE:{x:105,y:458},ORANGE:{x:122,y:458},GREY:{x:576,y:0},DARK_GREY:{x:592,y:0}};sc.SlopeLine=ig.GuiElementBase.extend({gfx:new ig.Image("media/gui/menu.png"),pixel:0,right:true,down:true,height:0,timer:0,time:0,visible:true,_tempPixel:0,_animating:0,transitions:{DEFAULT:{state:{},time:0.1,timeFunction:KEY_SPLINES.LINEAR},HIDDEN:{state:{alpha:0},time:0.1,timeFunction:KEY_SPLINES.LINEAR}},init:function(b,
a,d,c){this.parent();this.color=c||sc.SlopeLine_Color.WHITE;this._tempPixel=this.pixel=b;this.right=a!=void 0?a:true;this.down=d!=void 0?d:true},update:function(){if(this.timer<this.time){this.timer=this.timer+ig.system.actualTick;if(this.timer>=this.time){this.timer=this.time;if(this._animating==2)this.visible=false;this._animating=0}}if(this._animating==0)this._tempPixel=this.pixel;else if(this._animating==1)this._tempPixel=Math.ceil(Math.max(0,this.timer)/this.time*this.pixel);else if(this._animating==
2)this._tempPixel=Math.ceil((1-Math.max(0,this.timer)/this.time)*this.pixel)},updateDrawables:function(b){if(this.visible){var a=0,d=Math.ceil(Math.abs(this._tempPixel)/16),c=this._tempPixel,e=16;if(!this.right||!this.down)b.addTransform().setScale(this.right?1:-1,this.down?1:-1);for(;d--;){c<16&&(e=c);b.addGfx(this.gfx,a,a,this.color.x,this.color.y,e,e);a=a+16;c=Math.max(0,c-16)}(!this.right||!this.down)&&b.undoTransform()}},show:function(b,a){if(b){this.timer=0-(a||0);this.time=b||0.3}else this.time=
this.timer=0.1;this._animating=1;this.visible=true},hide:function(b,a){if(b){this.timer=0-(a||0);this.time=b||0.3;this._animating=2}else{this.timer=this.time=0;this.visible=false;this._animating=0}}});sc.LabeledNumberGuy=ig.GuiElementBase.extend({numberGui:null,init:function(b,a,d,c){this.parent();b=new sc.TextGui(b);this.addChildGui(b);this.numberGui=new sc.NumberGui(d,c);this.numberGui.setAlign(ig.GUI_ALIGN.X_RIGHT,ig.GUI_ALIGN.Y_BOTTOM);this.numberGui.setPos(0,3);this.addChildGui(this.numberGui);
this.setSize(a+this.numberGui.hook.size.x,Math.max(b.hook.size.y,this.numberGui.hook.size.y))},setNumber:function(b,a){this.numberGui.setNumber(b,a)}})});ig.baked=!0;
ig.module("game.feature.gui.base.compact-choice-box").requires("impact.feature.gui.base.box","impact.feature.gui.gui").defines(function(){sc.CompactChoiceBoxGui=ig.BoxGui.extend({transitions:{DEFAULT:{state:{},time:0.3,timeFunction:KEY_SPLINES.EASE_IN_OUT},HIDDEN:{state:{alpha:0,scaleY:0},time:0.3,timeFunction:KEY_SPLINES.EASE_IN_OUT}},ninepatch:new ig.NinePatch("media/gui/menu.png",{width:8,height:8,left:8,top:8,right:8,bottom:8,offsets:{"default":{x:480,y:304}}}),options:null,callback:null,init:function(b,
a,d){this.parent();this.options=b;this.callback=d;this.buttonInteract=new ig.ButtonInteractEntry;this.buttonGroup=new sc.ButtonGroup;this.buttonGroup.addPressCallback(this.onButtonPress.bind(this));this.buttonInteract.pushButtonGroup(this.buttonGroup);for(var d=a-6,c=3,e=0;e<b.length;++e){var f=b[e],g=new sc.ButtonGui(f.label,d,true,sc.BUTTON_TYPE.ITEM);g.textChild.setAlign(ig.GUI_ALIGN.X_CENTER,ig.GUI_ALIGN.Y_CENTER);g.textChild.setPos(0,0);g.setPos(3,c);g.setData(e);c=c+20;this.addChildGui(g);this.buttonGroup.addFocusGui(g,
0,e,f.backButton||false)}this.setSize(a,c+2);ig.interact.addEntry(this.buttonInteract);sc.model.stopSkip()},onDetach:function(){ig.interact.removeEntry(this.buttonInteract)},onButtonPress:function(b){b=this.options[b.data];this.callback&&this.callback(b.key)}})});ig.baked=!0;
ig.module("game.feature.gui.hud.combat-hud").requires("impact.feature.gui.gui","impact.feature.gui.base.box").defines(function(){sc.CombatHudGui=ig.GuiElementBase.extend({upperGui:null,lowerGui:null,skipGui:null,lineTimer:0,isCombat:false,isRanked:false,init:function(){this.parent();this.hook.zIndex=100;this.hook.pauseGui=true;this.setSize(ig.system.width,ig.system.height);this.upperGui=new sc.CombatUpperHud;this.addChildGui(this.upperGui);this.lowerGui=new sc.CombatLowerHud;this.addChildGui(this.lowerGui);
this.skipGui=new sc.CombatSkipGui;this.addChildGui(this.skipGui);sc.Model.addObserver(sc.model,this)},update:function(){if(sc.model.isCombatCooldown()&&sc.model.player.getCombatCooldownTime())this.lineTimer=0.7*sc.model.getCombatCooldownFactor();else if(this.lineTimer){this.lineTimer=this.lineTimer-ig.system.actualTick;if(this.lineTimer<=0){this.lineTimer=0;if(!this.isCombat){this.progress=0;this.upperGui.doStateTransition("HIDDEN");this.lowerGui.doStateTransition("HIDDEN")}}}},getLineWidth:function(){return this.isCombat?
1-this.lineTimer/0.7:this.lineTimer/0.7},modelChanged:function(a,b){if(b==sc.GAME_MODEL_MSG.COMBAT_MODE_CHANGED){var c=sc.model.isCombatActive();if(this.isCombat!=c){this.isCombat=c;this.isRanked=sc.model.isCombatRankActive();c=sc.pvp.isActive();this.lineTimer=0.7-this.lineTimer;this.upperGui.combatChanged(this.isCombat,this.isRanked,c);this.lowerGui.combatChanged(this.isCombat,this.isRanked,c)}if(sc.model.isCombatCooldown()){c=this.upperGui.getUpperRightWidth();this.skipGui.setPos(c,3);this.skipGui.show()}else this.skipGui.hide()}}});
sc.CombatSkipGui=ig.BoxGui.extend({transitions:{DEFAULT:{state:{alpha:1},time:0.2,timeFunction:KEY_SPLINES.EASE_OUT},HIDDEN:{state:{scaleY:0,alpha:0},time:0.2,timeFunction:KEY_SPLINES.EASE_OUT}},ninepatch:new ig.NinePatch("media/gui/message.png",{width:16,height:0,left:16,top:14,right:16,bottom:0,offsets:{"default":{x:48,y:38}}}),init:function(){var a="\\i[menu]"+ig.lang.get("sc.gui.combat-hud.skip"),a=new sc.TextGui(a);this.parent(a.hook.size.x+24,14);this.hook.localAlpha=0.5;a.setAlign(ig.GUI_ALIGN.X_CENTER,
ig.GUI_ALIGN.Y_CENTER);this.addChildGui(a);this.setAlign(ig.GUI_ALIGN.X_RIGHT,ig.GUI_ALIGN.Y_TOP);this.doStateTransition("HIDDEN",true)},show:function(){this.doStateTransition("DEFAULT")},hide:function(){this.doStateTransition("HIDDEN")}});sc.CombatUpperHud=ig.GuiElementBase.extend({transitions:{DEFAULT:{state:{},time:0.1,timeFunction:KEY_SPLINES.LINEAR},HIDDEN:{state:{alpha:0,offsetX:16},time:0.1,timeFunction:KEY_SPLINES.LINEAR}},gfx:new ig.Image("media/gui/status-gui.png"),ninepatch:new ig.NinePatch("media/gui/status-gui.png",
{width:16,height:0,left:16,top:14,right:0,bottom:0,offsets:{battle:{x:128,y:80},cooldown:{x:160,y:80}}}),sub:{},currentSub:null,init:function(){this.parent();this.setSize(ig.system.width,20);this.doStateTransition("HIDDEN",true);this.sub.empty=new b.EMPTY;this.sub.ranked=new b.RANKED;this.sub.pvp=new b.PVP},updateDrawables:function(a){var b=this.hook,c=b.parentHook.gui;if(this.currentSub){var e=this.currentSub.hook.size.x+13,c=Math.ceil(b.size.x*c.getLineWidth()),f=b.size.x-e,b=b.size.x-c,g=!sc.model.isCombatMode()||
sc.model.isCombatCooldown(),h=g?"#006d7d":"#b0001d";b<f-1&&a.addColor(h,b,0,f-1-b,2).setCompositionMode("lighter");b=Math.max(0,e+1-c);b<13&&a.addGfx(this.gfx,f-1+b,0,128+(g?16:0)+b,96,13-b,16).setCompositionMode("lighter");var i=e-13+1,b=Math.max(0,i-c);b<i&&a.addColor(h,f-1+13+b,13,i-b,2).setCompositionMode("lighter");a.addTransform().setAlpha(0.5);this.ninepatch.draw(a,e,16,g?"cooldown":"battle",f,0);a.undoTransform()}},updateSubGui:function(a,b){if(this.currentSub){this.currentSub.end();this.removeChildGui(this.currentSub)}this.currentSub=
b?this.sub.pvp:a?this.sub.ranked:this.sub.empty;this.addChildGui(this.currentSub);this.currentSub.setAlign(ig.GUI_ALIGN.X_RIGHT,ig.GUI_ALIGN.Y_TOP);this.currentSub.start()},combatChanged:function(a,b,c){if(a){this.doStateTransition("DEFAULT");this.updateSubGui(b,c)}},getUpperRightWidth:function(){return(this.currentSub&&this.currentSub.hook.size.x||0)+13}});var b={};sc.CombatLowerHud=ig.GuiElementBase.extend({transitions:{DEFAULT:{state:{},time:0.1,timeFunction:KEY_SPLINES.LINEAR},HIDDEN:{state:{alpha:0},
time:0.1,timeFunction:KEY_SPLINES.LINEAR}},init:function(){this.parent();this.setSize(ig.system.width,2);this.setAlign(ig.GUI_ALIGN.X_LEFT,ig.GUI_ALIGN.Y_BOTTOM);this.doStateTransition("HIDDEN",true)},updateDrawables:function(a){var b=this.hook,c=b.size.x,e=b.parentHook.gui.getLineWidth(),e=Math.ceil(c*(1-e)),f=!sc.model.isCombatMode()||sc.model.isCombatCooldown()?"#006d7d":"#b0001d";a.addColor(f,0,0,c-e,b.size.y).setCompositionMode("lighter")},combatChanged:function(a){a&&this.doStateTransition("DEFAULT")}});
b.EMPTY=ig.GuiElementBase.extend({gfx:new ig.Image("media/gui/status-gui.png"),init:function(){this.parent();this.setSize(17,20)},updateDrawables:function(a){var b=this.hook,c=!sc.model.isCombatMode()||sc.model.isCombatCooldown();a.addGfx(this.gfx,b.size.x-18,0,160+(c?16:0),96,13,13)},start:function(){},end:function(){}});b.RANKED=ig.GuiElementBase.extend({gfx:new ig.Image("media/gui/status-gui.png"),rankLabel:null,rankValue:null,progress:0,blinkTimer:0,init:function(){this.parent();this.setSize(49,
20);this.rankLabel=new sc.TextGui("Rank",{font:sc.fontsystem.tinyFont});this.rankLabel.setAlign(ig.GUI_ALIGN.X_RIGHT,ig.GUI_ALIGN.Y_TOP);this.rankLabel.setPos(28,1);this.rankValue=new sc.TextGui("A");this.rankValue.setAlign(ig.GUI_ALIGN.X_RIGHT,ig.GUI_ALIGN.Y_TOP);this.rankValue.setPos(18,-2);this.addChildGui(this.rankLabel);this.addChildGui(this.rankValue)},update:function(){var a=sc.model.getCombatRankProgress();if(this.progress!=a)if(sc.model.isSRank())this.progress=a;else{this.progress=0.2*a+
0.8*this.progress;if(Math.abs(this.progress-a)<0.05)this.progress=a}this.blinkTimer=sc.model.isSRank()?this.blinkTimer+ig.system.actualTick:0},updateDrawables:function(a){var b=this.hook,c=!sc.model.isCombatMode()||sc.model.isCombatCooldown();a.addGfx(this.gfx,b.size.x-18,0,160+(c?16:0),96,13,13);var e=this.progress==1?22:Math.floor(21*this.progress);a.addGfx(this.gfx,b.size.x-50,8,128,112,24,3);var f=1-Math.abs(Math.sin(this.blinkTimer/0.2*Math.PI));a.addTransform().setAlpha(f);e&&a.addGfx(this.gfx,
b.size.x-50,8,128,112+(c?8:4),1+e,3);a.undoTransform()},start:function(){sc.Model.addObserver(sc.model,this);this.rankValue.setText(sc.model.getCombatRankLabel());this.progress=0},end:function(){sc.Model.removeObserver(sc.model,this)},modelChanged:function(a,b){if(b==sc.GAME_MODEL_MSG.COMBAT_RANK_CHANGED){this.progress=1;this.rankValue.setText(sc.model.getCombatRankLabel())}}});b.PVP=ig.GuiElementBase.extend({gfx:new ig.Image("media/gui/status-gui.png"),heads:new ig.Image("media/gui/severed-heads.png"),
init:function(){this.parent();var a;a=110+sc.pvp.winPoints*10;a=a+(sc.party.getPartySize()+1)*16;a=a+sc.pvp.enemies.length*16;this.setSize(a,20)},updateDrawables:function(a){var b=this.hook.size.x/2;a.addGfx(this.gfx,b-8,0,136,160,16,16);var c=sc.pvp.winPoints;this._renderPoints(a,b-12-4,-1,c,sc.pvp.points[sc.COMBATANT_PARTY.PLAYER],0);this._renderPoints(a,b+12,1,c,sc.pvp.points[sc.COMBATANT_PARTY.ENEMY],8);for(var c=12+c*5,e=[0],f=0;f<sc.party.getPartySize();++f)e.push(sc.party.getPartyMemberModelByIndex(f).getHeadIdx());
this._renderHeads(a,b-c,true,e);e=[];for(f=0;f<sc.pvp.enemies.length;++f)e.push(sc.pvp.enemies[f].getHeadIdx());this._renderHeads(a,b+c,false,e)},_renderPoints:function(a,b,c,e,f,g){for(var h=0;h<e;++h){a.addGfx(this.gfx,b,2,(e-h>f?124:120)+g,160,4,12);b=b+5*c}},_renderHeads:function(a,b,c,e){c&&(b=b-24);for(var f=0;f<e.length;++f){a.addGfx(this.heads,b,-10,e[f]*24,0,24,24,c);b=b+(c?-16:16)}},start:function(){},end:function(){}})});ig.baked=!0;
ig.module("game.feature.model.options-model").requires("impact.base.game","impact.feature.storage.storage","impact.base.input","game.feature.model.base-model").defines(function(){function b(a){if(ig.platform==ig.PLATFORM_TYPES.DESKTOP){var b=window.require("nw.gui").Window.get();if(b.isFullscreen!=a){ig.log("%cChanging Fullscreen: "+a,"color:#FF4A4A");a?b.enterFullscreen():b.leaveFullscreen()}}}sc.KEY_BLACK_LIST={};sc.KEY_BLACK_LIST[ig.KEY.CTRL]=true;sc.KEY_BLACK_LIST[ig.KEY.F1]=true;sc.KEY_BLACK_LIST[ig.KEY.F2]=
true;sc.KEY_BLACK_LIST[ig.KEY.F3]=true;sc.KEY_BLACK_LIST[ig.KEY.F4]=true;sc.KEY_BLACK_LIST[ig.KEY.F5]=true;sc.KEY_BLACK_LIST[ig.KEY.F6]=true;sc.KEY_BLACK_LIST[ig.KEY.F7]=true;sc.KEY_BLACK_LIST[ig.KEY.F8]=true;sc.KEY_BLACK_LIST[ig.KEY.F9]=true;sc.KEY_BLACK_LIST[ig.KEY.F10]=true;sc.KEY_BLACK_LIST[ig.KEY.F11]=true;sc.KEY_BLACK_LIST[ig.KEY.F12]=true;sc.DIFFICULTY={CASUAL:0,NORMAL:1,HARD:2,CRUSHING:3};sc.CIRCUIT_MENU_TEXT_SIZE={SMALL:0,MEDIUM:1,LARGE:2};sc.CIRCUIT_MENU_DISPLAY_TIME={SHORT:0,LONG:1};sc.DISPLAY_TYPE=
{ORIGINAL:0,SCALE_X2:1,FIT:2,STRETCH:3};sc.PIXEL_SIZE={ONE:0,TWO:1,THREE:2,FOUR:3};sc.EFFECT_DETAILS={LOW:0,MEDIUM:1,HIGH:2};sc.RUMBLE_STRENGTH={OFF:0,WEAK:1,NORMAL:2,STRONG:3};sc.ASSIST_DAMAGE={LOW5:0.2,LOW4:0.3,LOW3:0.4,LOW2:0.6,LOW1:0.8,NORM:1};sc.ASSIST_ATTACK_FREQUENCY={LOW5:0.5,LOW4:0.6,LOW3:0.7,LOW2:0.8,LOW1:0.9,NORM:1};sc.ASSIST_PUZZLE_SPEED={LOW5:0.5,LOW4:0.6,LOW3:0.7,LOW2:0.8,LOW1:0.9,NORM:1};sc.QUICK_MENU_ACCESS={HOLD:0,PRESS:1};sc.LANGUAGE={ENGLISH:0,GERMAN:1,CHINESE:2,CHINESE_TRAD:5,
JAPANESE:3,KOREAN:4};sc.ITEM_HUD_SIZE={NORMAL:0,SMALL:1};sc.MESSAGE_PADDING={NORMAL:0,WIDE:1};sc.QUEST_SOLVED_STYLE={IMMEDIATE:0,PRESS:1};sc.UPDATE_QUEST_STYLE={LARGE:0,SMALL:1,NONE:2};sc.UPDATE_LANDMARK_STYLE={LARGE:0,SMALL:1,NONE:2};sc.UPDATE_LORE_STYLE={LARGE:0,SMALL:1,NONE:2};sc.UPDATE_TROPHY_STYLE={LARGE:0,SMALL:1,NONE:2};sc.UPDATE_DROP_STYLE={LARGE:0,SMALL:1,NONE:2};sc.HP_BARS={LEA:0,PARTY:1,NONE:2};sc.PARTY_COMBAT_ARTS={FULL:0,NO_NAME:1,NONE:2};sc.GAMEPAD_BUTTON_OPTION={BUMPER:0,TRIGGER:1};
sc.GAMEPAD_ICON_OPTION={XBOX:0,PS4:1};sc.QUICK_LOCATION_OPTION={QUICK:0,MAP:1,NONE:2};sc.LANGUAGE_MAP={};sc.LANGUAGE_MAP[sc.LANGUAGE.ENGLISH]="en_US";sc.LANGUAGE_MAP[sc.LANGUAGE.GERMAN]="de_DE";sc.LANGUAGE_MAP[sc.LANGUAGE.CHINESE]="zh_CN";sc.LANGUAGE_MAP[sc.LANGUAGE.CHINESE_TRAD]="zh_TW";sc.LANGUAGE_MAP[sc.LANGUAGE.JAPANESE]="ja_JP";sc.LANGUAGE_MAP[sc.LANGUAGE.KOREAN]="ko_KR";sc.OPTION_TYPES={BUTTON_GROUP:0,ARRAY_SLIDER:1,OBJECT_SLIDER:2,CHECKBOX:3,CONTROLS:4,LANGUAGE:5,INFO:6};sc.OPTION_CATEGORY=
{GENERAL:0,INTERFACE:1,VIDEO:2,AUDIO:3,GAMEPAD:4,CONTROLS:5,ASSISTS:6,ARENA:7};var a=window.IG_GAME_DEBUG||ig.platform!=ig.PLATFORM_TYPES.DESKTOP?false:true;sc.OPTIONS_DEFINITION={language:{type:"LANGUAGE",data:sc.LANGUAGE,init:sc.LANGUAGE.ENGLISH,cat:sc.OPTION_CATEGORY.GENERAL,restart:true},"pause-unfocused":{type:"CHECKBOX",init:true,cat:sc.OPTION_CATEGORY.GENERAL},"volume-music":{type:"ARRAY_SLIDER",data:[0,1],init:0.8,cat:sc.OPTION_CATEGORY.GENERAL,fill:true,hasDivider:true,header:"sound"},"volume-sound":{type:"ARRAY_SLIDER",
data:[0,1],init:1,cat:sc.OPTION_CATEGORY.GENERAL,fill:true},"web-audio":{type:"CHECKBOX",init:!window.IG_FORCE_HTML5_AUDIO||true,cat:sc.OPTION_CATEGORY.GENERAL,restart:true},"skip-tutorials":{type:"CHECKBOX",init:false,cat:sc.OPTION_CATEGORY.GENERAL,hasDivider:true,header:"cutscenes"},"skip-confirm":{type:"CHECKBOX",init:true,cat:sc.OPTION_CATEGORY.GENERAL},"text-speed":{type:"OBJECT_SLIDER",data:ig.TextBlock.SPEED,init:ig.TextBlock.SPEED.FAST,cat:sc.OPTION_CATEGORY.GENERAL,fill:true},"message-padding":{type:"BUTTON_GROUP",
data:sc.MESSAGE_PADDING,init:sc.MESSAGE_PADDING.NORMAL,cat:sc.OPTION_CATEGORY.GENERAL,fill:true},"game-sense":{type:"CHECKBOX",init:false,cat:sc.OPTION_CATEGORY.GENERAL},"circuit-text-size":{type:"BUTTON_GROUP",data:sc.CIRCUIT_MENU_TEXT_SIZE,init:sc.CIRCUIT_MENU_TEXT_SIZE.LARGE,cat:sc.OPTION_CATEGORY.INTERFACE,hasDivider:true,header:"main"},"circuit-display-time":{type:"BUTTON_GROUP",data:sc.CIRCUIT_MENU_DISPLAY_TIME,init:sc.CIRCUIT_MENU_DISPLAY_TIME.SHORT,cat:sc.OPTION_CATEGORY.INTERFACE},"equip-level-display":{type:"CHECKBOX",
init:true,cat:sc.OPTION_CATEGORY.INTERFACE},"level-letter-display":{type:"CHECKBOX",init:true,cat:sc.OPTION_CATEGORY.INTERFACE},"buff-help":{type:"CHECKBOX",init:true,cat:sc.OPTION_CATEGORY.INTERFACE},"update-trophy-style":{type:"BUTTON_GROUP",data:sc.UPDATE_TROPHY_STYLE,init:sc.UPDATE_TROPHY_STYLE.SMALL,cat:sc.OPTION_CATEGORY.INTERFACE,hasDivider:true,header:"updates"},"update-quest-style":{type:"BUTTON_GROUP",data:sc.UPDATE_QUEST_STYLE,init:sc.UPDATE_QUEST_STYLE.LARGE,cat:sc.OPTION_CATEGORY.INTERFACE},
"update-landmark-style":{type:"BUTTON_GROUP",data:sc.UPDATE_LANDMARK_STYLE,init:sc.UPDATE_LANDMARK_STYLE.LARGE,cat:sc.OPTION_CATEGORY.INTERFACE},"update-lore-style":{type:"BUTTON_GROUP",data:sc.UPDATE_LORE_STYLE,init:sc.UPDATE_LORE_STYLE.SMALL,cat:sc.OPTION_CATEGORY.INTERFACE},"update-drop-style":{type:"BUTTON_GROUP",data:sc.UPDATE_DROP_STYLE,init:sc.UPDATE_DROP_STYLE.LARGE,cat:sc.OPTION_CATEGORY.INTERFACE},"min-sidebar":{type:"CHECKBOX",init:false,cat:sc.OPTION_CATEGORY.INTERFACE},"item-hud-size":{type:"BUTTON_GROUP",
data:sc.ITEM_HUD_SIZE,init:sc.ITEM_HUD_SIZE.NORMAL,cat:sc.OPTION_CATEGORY.INTERFACE,hasDivider:true,header:"field"},"show-items":{type:"CHECKBOX",init:true,cat:sc.OPTION_CATEGORY.INTERFACE},"show-money":{type:"CHECKBOX",init:true,cat:sc.OPTION_CATEGORY.INTERFACE},"min-quest":{type:"CHECKBOX",init:false,cat:sc.OPTION_CATEGORY.INTERFACE},"quest-show-current":{type:"CHECKBOX",init:false,cat:sc.OPTION_CATEGORY.INTERFACE},"xeno-pointer":{type:"CHECKBOX",init:true,cat:sc.OPTION_CATEGORY.INTERFACE},"hud-display":{type:"CHECKBOX",
init:true,cat:sc.OPTION_CATEGORY.INTERFACE,hasDivider:true,header:"combat"},"close-combat-input":{type:"CHECKBOX",init:true,cat:sc.OPTION_CATEGORY.INTERFACE},"close-circle":{type:"CHECKBOX",init:true,cat:sc.OPTION_CATEGORY.INTERFACE},"sp-bar":{type:"CHECKBOX",init:true,cat:sc.OPTION_CATEGORY.INTERFACE},"element-overload":{type:"CHECKBOX",init:true,cat:sc.OPTION_CATEGORY.INTERFACE},"low-health-warning":{type:"CHECKBOX",init:true,cat:sc.OPTION_CATEGORY.INTERFACE},"combat-art-name":{type:"CHECKBOX",
init:false,cat:sc.OPTION_CATEGORY.INTERFACE},"damage-numbers":{type:"CHECKBOX",init:true,cat:sc.OPTION_CATEGORY.INTERFACE},"damage-numbers-crit":{type:"CHECKBOX",init:false,cat:sc.OPTION_CATEGORY.INTERFACE},"s-rank-effects":{type:"CHECKBOX",init:true,cat:sc.OPTION_CATEGORY.INTERFACE},"enemy-status-bars":{type:"CHECKBOX",init:true,cat:sc.OPTION_CATEGORY.INTERFACE},"hp-bars":{type:"BUTTON_GROUP",data:sc.HP_BARS,init:sc.HP_BARS.PARTY,cat:sc.OPTION_CATEGORY.INTERFACE,hasDivider:true,header:"party"},"party-combat-arts":{type:"BUTTON_GROUP",
data:sc.PARTY_COMBAT_ARTS,init:sc.PARTY_COMBAT_ARTS.FULL,cat:sc.OPTION_CATEGORY.INTERFACE},"quick-menu-access":{type:"BUTTON_GROUP",data:sc.QUICK_MENU_ACCESS,init:sc.QUICK_MENU_ACCESS.HOLD,cat:sc.OPTION_CATEGORY.INTERFACE,hasDivider:true,header:"quick"},"quick-location":{type:"BUTTON_GROUP",data:sc.QUICK_LOCATION_OPTION,init:sc.QUICK_LOCATION_OPTION.QUICK,cat:sc.OPTION_CATEGORY.INTERFACE},"quick-element":{type:"CHECKBOX",init:true,cat:sc.OPTION_CATEGORY.INTERFACE},"quick-cursor":{type:"CHECKBOX",
init:true,cat:sc.OPTION_CATEGORY.INTERFACE},"display-type":{type:"BUTTON_GROUP",data:sc.DISPLAY_TYPE,init:sc.DISPLAY_TYPE.FIT,cat:sc.OPTION_CATEGORY.VIDEO},fullscreen:{type:"CHECKBOX",init:a,cat:sc.OPTION_CATEGORY.VIDEO,noBrowser:true},"pixel-size":{type:"BUTTON_GROUP",data:sc.PIXEL_SIZE,init:sc.PIXEL_SIZE.TWO,cat:sc.OPTION_CATEGORY.VIDEO},"rumble-strength":{type:"BUTTON_GROUP",data:sc.RUMBLE_STRENGTH,init:sc.RUMBLE_STRENGTH.STRONG,cat:sc.OPTION_CATEGORY.VIDEO},speedlines:{type:"CHECKBOX",init:true,
cat:sc.OPTION_CATEGORY.VIDEO},"env-particles":{type:"CHECKBOX",init:true,cat:sc.OPTION_CATEGORY.VIDEO},weather:{type:"CHECKBOX",init:true,cat:sc.OPTION_CATEGORY.VIDEO},lighting:{type:"CHECKBOX",init:true,cat:sc.OPTION_CATEGORY.VIDEO},"gamepad-attack":{type:"BUTTON_GROUP",data:sc.GAMEPAD_BUTTON_OPTION,init:sc.GAMEPAD_BUTTON_OPTION.BUMPER,cat:sc.OPTION_CATEGORY.GAMEPAD,gamepadIconUpdate:true},"gamepad-dash":{type:"BUTTON_GROUP",data:sc.GAMEPAD_BUTTON_OPTION,init:sc.GAMEPAD_BUTTON_OPTION.BUMPER,cat:sc.OPTION_CATEGORY.GAMEPAD,
gamepadIconUpdate:true},"gamepad-icons":{type:"BUTTON_GROUP",data:sc.GAMEPAD_ICON_OPTION,init:sc.GAMEPAD_ICON_OPTION.XBOX,cat:sc.OPTION_CATEGORY.GAMEPAD,gamepadIconUpdate:true},"arena-cam-focus":{type:"CHECKBOX",init:true,cat:sc.OPTION_CATEGORY.ARENA},"arena-confirm":{type:"CHECKBOX",init:true,cat:sc.OPTION_CATEGORY.ARENA},"element-wheel":{type:"CHECKBOX",init:true,cat:sc.OPTION_CATEGORY.CONTROLS},"keys-confirm":{type:"CONTROLS",init:{key1:ig.KEY.ENTER,key2:void 0},cat:sc.OPTION_CATEGORY.CONTROLS,
hasDivider:true,header:"menu"},"keys-back":{type:"CONTROLS",init:{key1:ig.KEY.BACKSPACE,key2:void 0},cat:sc.OPTION_CATEGORY.CONTROLS},"keys-menu":{type:"CONTROLS",init:{key1:ig.KEY.TAB,key2:void 0},cat:sc.OPTION_CATEGORY.CONTROLS},"keys-pause":{type:"CONTROLS",init:{key1:ig.KEY.ESC,key2:void 0},cat:sc.OPTION_CATEGORY.CONTROLS},"keys-help":{type:"CONTROLS",init:{key1:ig.KEY.H,key2:void 0},cat:sc.OPTION_CATEGORY.CONTROLS},"keys-help2":{type:"CONTROLS",init:{key1:ig.KEY.B,key2:void 0},cat:sc.OPTION_CATEGORY.CONTROLS},
"keys-help3":{type:"CONTROLS",init:{key1:ig.KEY.N,key2:void 0},cat:sc.OPTION_CATEGORY.CONTROLS},"keys-skip-cutscene":{type:"CONTROLS",init:{key1:ig.KEY.G,key2:void 0},cat:sc.OPTION_CATEGORY.CONTROLS},"keys-help4":{type:"CONTROLS",init:{key1:ig.KEY.I,key2:void 0},cat:sc.OPTION_CATEGORY.CONTROLS},"keys-circle-left":{type:"CONTROLS",init:{key1:ig.KEY.Q,key2:void 0},cat:sc.OPTION_CATEGORY.CONTROLS},"keys-circle-right":{type:"CONTROLS",init:{key1:ig.KEY.E,key2:void 0},cat:sc.OPTION_CATEGORY.CONTROLS},
"keys-up":{type:"CONTROLS",init:{key1:ig.KEY.W,key2:ig.KEY.UP_ARROW},cat:sc.OPTION_CATEGORY.CONTROLS,hasDivider:true,header:"gameplay"},"keys-right":{type:"CONTROLS",init:{key1:ig.KEY.D,key2:ig.KEY.RIGHT_ARROW},cat:sc.OPTION_CATEGORY.CONTROLS},"keys-down":{type:"CONTROLS",init:{key1:ig.KEY.S,key2:ig.KEY.DOWN_ARROW},cat:sc.OPTION_CATEGORY.CONTROLS},"keys-left":{type:"CONTROLS",init:{key1:ig.KEY.A,key2:ig.KEY.LEFT_ARROW},cat:sc.OPTION_CATEGORY.CONTROLS},"keys-melee":{type:"CONTROLS",init:{key1:ig.KEY.V,
key2:void 0},cat:sc.OPTION_CATEGORY.CONTROLS},"keys-guard":{type:"CONTROLS",init:{key1:ig.KEY.C,key2:void 0},cat:sc.OPTION_CATEGORY.CONTROLS},"keys-quick":{type:"CONTROLS",init:{key1:ig.KEY.SHIFT,key2:void 0},cat:sc.OPTION_CATEGORY.CONTROLS},"keys-special":{type:"CONTROLS",init:{key1:ig.KEY.SPACE,key2:void 0},cat:sc.OPTION_CATEGORY.CONTROLS},"keys-dash2":{type:"CONTROLS",init:{key1:ig.KEY.ALT,key2:void 0},cat:sc.OPTION_CATEGORY.CONTROLS},"keys-cold":{type:"CONTROLS",init:{key1:ig.KEY._1,key2:void 0},
cat:sc.OPTION_CATEGORY.CONTROLS},"keys-shock":{type:"CONTROLS",init:{key1:ig.KEY._2,key2:void 0},cat:sc.OPTION_CATEGORY.CONTROLS},"keys-heat":{type:"CONTROLS",init:{key1:ig.KEY._3,key2:void 0},cat:sc.OPTION_CATEGORY.CONTROLS},"keys-wave":{type:"CONTROLS",init:{key1:ig.KEY._4,key2:void 0},cat:sc.OPTION_CATEGORY.CONTROLS},"keys-neutral":{type:"CONTROLS",init:{key1:ig.KEY.GRAVE_ACCENT,key2:ig.KEY._5},cat:sc.OPTION_CATEGORY.CONTROLS},"assists-description":{type:"INFO",data:"options.assists-description.description",
cat:sc.OPTION_CATEGORY.ASSISTS},"assist-damage":{type:"OBJECT_SLIDER",data:sc.ASSIST_DAMAGE,init:sc.ASSIST_DAMAGE.NORM,cat:sc.OPTION_CATEGORY.ASSISTS,fill:true,showPercentage:true,hasDivider:true,header:"combat"},"assist-attack-frequency":{type:"OBJECT_SLIDER",data:sc.ASSIST_ATTACK_FREQUENCY,init:sc.ASSIST_ATTACK_FREQUENCY.NORM,cat:sc.OPTION_CATEGORY.ASSISTS,fill:true,showPercentage:true},"assist-puzzle-speed":{type:"OBJECT_SLIDER",data:sc.ASSIST_PUZZLE_SPEED,init:sc.ASSIST_PUZZLE_SPEED.NORM,cat:sc.OPTION_CATEGORY.ASSISTS,
fill:true,showPercentage:true,hasDivider:true,header:"puzzle"}};ig.nwjsVersion&&ig.nwjsVersion[1]>=3E3&&delete sc.OPTIONS_DEFINITION["web-audio"];if(window.IG_GAME_DEBUG){sc.OPTIONS_DEFINITION["keys-jump"]={type:"CONTROLS",init:{key1:ig.KEY.Y,key2:void 0},cat:sc.OPTION_CATEGORY.CONTROLS,isDebug:true,hasDivider:true,header:"debug"};sc.OPTIONS_DEFINITION["keys-time"]={type:"CONTROLS",init:{key1:ig.KEY.T,key2:void 0},cat:sc.OPTION_CATEGORY.CONTROLS,isDebug:true};sc.OPTIONS_DEFINITION["keys-rumble"]=
{type:"CONTROLS",init:{key1:ig.KEY.R,key2:void 0},cat:sc.OPTION_CATEGORY.CONTROLS,isDebug:true};sc.OPTIONS_DEFINITION["keys-debug"]={type:"CONTROLS",init:{key1:ig.KEY._7,key2:void 0},cat:sc.OPTION_CATEGORY.CONTROLS,isDebug:true};sc.OPTIONS_DEFINITION["keys-debug2"]={type:"CONTROLS",init:{key1:ig.KEY._8,key2:void 0},cat:sc.OPTION_CATEGORY.CONTROLS,isDebug:true};sc.OPTIONS_DEFINITION["keys-addBuff"]={type:"CONTROLS",init:{key1:ig.KEY._0,key2:void 0},cat:sc.OPTION_CATEGORY.CONTROLS,isDebug:true};sc.OPTIONS_DEFINITION["keys-levelUp"]=
{type:"CONTROLS",init:{key1:ig.KEY.ADD,key2:void 0},cat:sc.OPTION_CATEGORY.CONTROLS,isDebug:true}}sc.KEY_OPTION_MAP={};for(var d in sc.OPTIONS_DEFINITION)sc.OPTIONS_DEFINITION[d].type=="CONTROLS"&&d.indexOf("keys")==0&&(sc.KEY_OPTION_MAP[d.substr(5)]=d);var c=a;if(localStorage.getItem("IG_FULLSCREEN")){c=localStorage.getItem("IG_FULLSCREEN")=="true";console.log("INIT FULLSCREEN VALUE",c);b(c)}sc.KeyBinder=ig.Class.extend({init:function(){},initBindings:function(){var a=sc.options.values,b;for(b in sc.KEY_OPTION_MAP){if(a[sc.KEY_OPTION_MAP[b]].key1!=
void 0){ig.input.bind(a[sc.KEY_OPTION_MAP[b]].key1,b);sc.fontsystem.changeKeyCodeIcon(b,a[sc.KEY_OPTION_MAP[b]].key1)}a[sc.KEY_OPTION_MAP[b]].key2!=void 0&&ig.input.bind(a[sc.KEY_OPTION_MAP[b]].key2,b)}this.updateGamepadIcons()},unbind:function(a,b){ig.input.bindings[b.init.key1!=void 0]&&ig.input.unbind(b.init.key1);ig.input.bindings[b.init.key2]!=void 0&&ig.input.unbind(b.init.key2)},updateGamepadIcons:function(){sc.fontsystem.setGamepadIconStyle(sc.options.get("gamepad-icons"));var a=sc.options.get("gamepad-attack")?
"gamepad-r2":"gamepad-r1",b=sc.options.get("gamepad-attack")?"gamepad-r1":"gamepad-r2";sc.fontsystem.changeGamepadIcon("throw",a);sc.fontsystem.changeGamepadIcon("special",b);a=sc.options.get("gamepad-dash")?"gamepad-l2":"gamepad-l1";b=sc.options.get("gamepad-dash")?"gamepad-l1":"gamepad-l2";sc.fontsystem.changeGamepadIcon("dash",a);sc.fontsystem.changeGamepadIcon("guard",a);sc.fontsystem.changeGamepadIcon("quick",b)},changeBinding:function(a,b,c,d){var i=sc.options.values;sc.options.hasChanged=true;
c?ig.input.bindings[i[a].key2]&&ig.input.unbind(i[a].key2):ig.input.unbind(i[a].key1);if(c&&d)i[a].key2=void 0;else{var j=a.substr(5),d=ig.input.bindings[b];ig.input.bind(b,j);sc.fontsystem.changeKeyCodeIcon(j,b);if(d){var k=i[sc.KEY_OPTION_MAP[d]],j=c?i[sc.KEY_OPTION_MAP[j]].key2:i[sc.KEY_OPTION_MAP[j]].key1;k.key2==b?k.key2=j:k.key1=j;ig.input.bind(j,d);sc.fontsystem.changeKeyCodeIcon(d,j);sc.options.dispatchKeySwappedEvent()}c?i[a].key2=b:i[a].key1=b}}});sc.OptionModel=ig.GameAddon.extend({observers:[],
hdMode:false,hasChanged:false,keyBinder:new sc.KeyBinder,values:{},_loaded:false,init:function(){this.parent("OptionsModel");ig.storage.register(this);if(ig.system.width>480)this.hdMode=true;if(!window.wm){var a=null,b;for(b in sc.OPTIONS_DEFINITION){a=sc.OPTIONS_DEFINITION[b];if(a.hasLocal){this.values[b+"-global"]=ig.copy(a.browser&&ig.platform==ig.PLATFORM_TYPES.BROWSER?a.browser:a.init);this.values[b+"-local"]=ig.copy(a.browser&&ig.platform==ig.PLATFORM_TYPES.BROWSER?a.browser:a.init)}else this.values[b]=
ig.copy(a.browser&&ig.platform==ig.PLATFORM_TYPES.BROWSER?a.browser:a.init);b=="fullscreen"&&(this.values[b]=c);if(b=="language")for(var d in sc.LANGUAGE_MAP)ig.currentLang==sc.LANGUAGE_MAP[d]&&(this.values[b]=d);this._checkSystemSettings(b)}this.onStorageGlobalLoad(ig.storage.globalData)}ig.vars.registerVarAccessor("option",this,"VarOptionEditor")},onVarAccess:function(a,b){if(b[0]=="option"){var c=b[1];if(sc.OPTIONS_DEFINITION[c]!==void 0)return this.values[c]}throw Error("Unsupported var access path: "+
a);},persistOptions:function(){if(this.hasChanged){this.hasChanged=false;ig.storage.saveGlobals()}},resetDefaultValues:function(a){this.hasChanged=true;for(var b in sc.OPTIONS_DEFINITION){var c=sc.OPTIONS_DEFINITION[b];c.hasLocal?a?this.values[b+"-local"]=ig.copy(c.browser&&ig.platform==ig.PLATFORM_TYPES.BROWSER?c.browser:c.init):this.values[b+"-global"]=ig.copy(c.browser&&ig.platform==ig.PLATFORM_TYPES.BROWSER?c.browser:c.init):this.values[b]=ig.copy(c.browser&&ig.platform==ig.PLATFORM_TYPES.BROWSER?
c.browser:c.init);c.type=="CONTROLS"&&this.keyBinder.unbind(b,c);this._checkSystemSettings(b)}this.keyBinder.initBindings();sc.Model.notifyObserver(this,sc.OPTIONS_EVENT.OPTION_CHANGED);sc.Model.notifyObserver(this,sc.OPTIONS_EVENT.OPTION_KEYS_SWAPPED)},dispatchKeySwappedEvent:function(){sc.Model.notifyObserver(this,sc.OPTIONS_EVENT.OPTION_KEYS_SWAPPED)},set:function(a,b,c){if(sc.OPTIONS_DEFINITION[a]){if(!this.hasChanged)this.hasChanged=true;sc.OPTIONS_DEFINITION[a].hasLocal?c?this.values[a+"-local"]=
b:this.values[a+"-global"]=b:this.values[a]=b;this._checkSystemSettings(a);sc.OPTIONS_DEFINITION[a].gamepadIconUpdate&&this.keyBinder.updateGamepadIcons();sc.Model.notifyObserver(this,sc.OPTIONS_EVENT.OPTION_CHANGED)}},get:function(a,b){return sc.OPTIONS_DEFINITION[a]?sc.OPTIONS_DEFINITION[a].hasLocal?b?this.values[a+"-local"]:this.values[a+"-global"]:this.values[a]:null},hasLocal:function(a){if(sc.OPTIONS_DEFINITION[a]){if(sc.OPTIONS_DEFINITION[a].hasLocal)return true}else ig.warn("Can't find option because of invalid key: "+
a);return false},_checkSystemSettings:function(a){if(!window.IG_IGNORE_OPTIONS)if(a=="fullscreen")this._setFullscreen();else if(a=="volume-master")ig.system.setMasterVolume(this.values[a]);else if(a=="language"){a=sc.LANGUAGE_MAP[this.values[a]];localStorage.setItem("IG_LANG",a);ig.log("%cOPTION SET LANG: "+a,"color:#FF4A4A")}else if(a=="volume-music"){window.IG_MUSIC_VOLUME=this.values[a];ig.system.setMusicVolume(this.values[a]);localStorage.setItem("options.musicVolume",this.values[a])}else if(a==
"volume-sound"){window.IG_SOUND_VOLUME=this.values[a];ig.system.setSoundVolume(this.values[a]);localStorage.setItem("options.soundVolume",this.values[a])}else if(a=="display-type"){this._setDisplaySize();localStorage.setItem("options.screenMode",window.IG_SCREEN_MODE)}else if(a=="web-audio"){window.IG_USE_WEBAUDIO=this.values[a];localStorage.setItem("options.useWebAudio",this.values[a])}else if(a=="pixel-size"){window.IG_GAME_SCALE=(this.values[a]||0)+1;localStorage.setItem("options.scale",window.IG_GAME_SCALE)}else if(a==
"double-pixels"){window.IG_GAME_SCALE=this.values[a]?2:1;localStorage.setItem("options.scale",window.IG_GAME_SCALE)}else a=="pause-unfocused"&&(window.IG_KEEP_WINDOW_FOCUS=!this.values[a])},_checkForKeyBindingFailure:function(){var a=false,b;for(b in sc.OPTIONS_DEFINITION){var c=sc.OPTIONS_DEFINITION[b];if(c.type=="CONTROLS"&&this.values[b].key1===void 0){a=true;break}}if(a){console.log("KEY BINDING FAILURE. RESET TO DEFAULT CONFIG");for(b in sc.OPTIONS_DEFINITION){c=sc.OPTIONS_DEFINITION[b];c.type==
"CONTROLS"&&(this.values[b]=ig.copy(c.init))}}},_setDisplaySize:function(){var a=0,b=0,c=window.IG_WIDTH,d=window.IG_HEIGHT,b=$(window).width(),i=$(window).height(),j=false,k=false;switch(this.values["display-type"]){case sc.DISPLAY_TYPE.ORIGINAL:a=c;b=d;break;case sc.DISPLAY_TYPE.SCALE_X2:a=c*2;b=d*2;break;case sc.DISPLAY_TYPE.FIT:k=true;if(b/i>c/d){b=i;a=c*i/d}else{a=b;b=d*b/c}j=true;break;case sc.DISPLAY_TYPE.STRETCH:k=true;a=b;b=i;j=true;break;default:a=c;b=d}if(k)for(i=1;i<4;++i)if(Math.abs(a-
c*i)<20){a=c*i;b=d*i}window.IG_SCREEN_MODE=this.values["display-type"];if(window.ig&&window.ig.system)ig.system.setCanvasSize(a,b,j);else{$("#canvas").width(a);$("#canvas").height(b);$("#canvas")[0].className=j?"borderHidden":""}},_setFullscreen:function(){if(ig.platform==ig.PLATFORM_TYPES.DESKTOP){var a=this.values.fullscreen;localStorage.setItem("IG_FULLSCREEN",a);b(a)}},onStorageSave:function(a){var b={},c=null,d;for(d in sc.OPTIONS_DEFINITION){c=sc.OPTIONS_DEFINITION[d];c.hasLocal&&(b[d]=this.values[d+
"-local"])}a.options=b},onStoragePreLoad:function(a){var a=a.options,b;for(b in a)if(sc.OPTIONS_DEFINITION[b]){this.values[b+"-local"]=a[b];this._checkSystemSettings(b)}sc.Model.notifyObserver(this,sc.OPTIONS_EVENT.OPTION_CHANGED)},onStorageGlobalSave:function(a){var b={},c=null,d;for(d in sc.OPTIONS_DEFINITION){c=sc.OPTIONS_DEFINITION[d];b[d]=c.hasLocal?this.values[d+"-global"]:this.values[d]}a.options=b},onStorageGlobalLoad:function(a){var a=a.options,b;for(b in a)if(sc.OPTIONS_DEFINITION[b]){sc.OPTIONS_DEFINITION[b].hasLocal?
this.values[b+"-global"]=a[b]:this.values[b]=a[b];this._checkSystemSettings(b)}this._checkForKeyBindingFailure();this._loaded=true;sc.Model.notifyObserver(this,sc.OPTIONS_EVENT.OPTION_CHANGED)}});sc.OPTIONS_EVENT={};sc.OPTIONS_EVENT.OPTION_CHANGED=0;sc.OPTIONS_EVENT.OPTION_KEYS_SWAPPED=1;ig.addGameAddon(function(){return sc.options=sc.options=new sc.OptionModel})});ig.baked=!0;
ig.module("game.feature.gui.hud.item-hud").requires("game.feature.gui.hud.right-hud","game.feature.model.options-model").defines(function(){sc.ItemContent=ig.GuiElementBase.extend({timer:0,id:-1,amount:0,textGui:null,amountGui:null,init:function(b,a){this.parent();this.id=b==void 0?-1:b;this.amount=a||1;this.timer=3;var d=sc.inventory.items[b],d="\\i["+((d.icon||"item-default")+sc.inventory.getRaritySuffix(d.rarity||0))+"]"+ig.LangLabel.getText(d.name)+" x",c=sc.options.get("item-hud-size")==sc.ITEM_HUD_SIZE.NORMAL;
this.textGui=new sc.TextGui(d,{speed:ig.TextBlock.SPEED.IMMEDIATE,font:c?sc.fontsystem.font:sc.fontsystem.smallFont});this.textGui.setAlign(ig.GUI_ALIGN.X_LEFT,ig.GUI_ALIGN.Y_CENTER);this.amountGui=new sc.NumberGui(99,{size:c?sc.NUMBER_SIZE.TEXT:sc.NUMBER_SIZE.SMALL});this.amountGui.setAlign(ig.GUI_ALIGN.X_RIGHT,ig.GUI_ALIGN.Y_CENTER);this.amountGui.setNumber(this.amount);this.addChildGui(this.textGui);this.addChildGui(this.amountGui);this.increaseNumber(0);this.setSize(this.textGui.hook.size.x+this.amountGui.hook.size.x+
4,c?18:8);this.hook.pivot.x=this.hook.size.x;this.hook.pivot.y=0},updateOption:function(b){if(b){if(this.textGui.font==sc.fontsystem.font)return;this.textGui.setFont(sc.fontsystem.font);this.amountGui.setSize(sc.NUMBER_SIZE.TEXT)}else{if(this.textGui.font==sc.fontsystem.smallFont)return;this.textGui.setFont(sc.fontsystem.smallFont);this.amountGui.setSize(sc.NUMBER_SIZE.SMALL)}this.setSize(this.textGui.hook.size.x+this.amountGui.hook.size.x+4,b?18:8)},updateTimer:function(){if(this.timer>0)this.timer=
this.timer-ig.system.tick},increaseNumber:function(b,a){this.amount=this.amount+(b||0);this.amountGui.setNumber(this.amount,a);this.timer=3}});sc.ItemHudBox=sc.RightHudBoxGui.extend({delayedStack:[],size:0,init:function(){this.parent(ig.lang.get("sc.gui.item-hud.title"));this.size=sc.options.get("item-hud-size");sc.Model.addObserver(sc.model.player,this);sc.Model.addObserver(sc.model,this);sc.Model.addObserver(sc.options,this)},addEntry:function(b,a){var d=null;if((d=this._isInEntries(b))!=null)d.increaseNumber(a,
this.contentEntries.length<=5);else{d=new sc.ItemContent(b,a);this.contentEntries.length>=5?this.delayedStack.push(d):this.pushContent(d,true);this.hidden&&this.show()}},update:function(){if(!sc.model.isPaused()&&!sc.model.isMenu()&&!this.hidden){for(var b=this.contentEntries.length,a=null;b--;){a=this.contentEntries[b].subGui;a.updateTimer();if(a.timer<=0){a=this.removeContent(b);if(b==0&&this.contentEntries.length==0)a.hook.pivot.y=a.hook.size.y/2;else{a.hook.pivot.y=0;a.hook.anim.timeFunction=
KEY_SPLINES.EASE_OUT}this._popDelayed()}}!this.hidden&&this.contentEntries.length==0&&this.hide()}},_isInEntries:function(b){for(var a=this.contentEntries.length;a--;)if(this.contentEntries[a].subGui.id==b)return this.contentEntries[a].subGui;for(a=this.delayedStack.length;a--;)if(this.delayedStack[a].id==b)return this.delayedStack[a];return null},_popDelayed:function(){if(this.delayedStack.length!=0){var b=this.delayedStack.splice(0,1)[0];this.pushContent(b,true)}},_updateSizes:function(b){for(var a=
this.contentEntries.length,d=null;a--;){d=this.contentEntries[a];d.subGui.updateOption(b);d.setContent(d.subGui)}this.rearrangeContent()},modelChanged:function(b,a,d){if(b==sc.model.player)a==sc.PLAYER_MSG.ITEM_OBTAINED&&sc.options.get("show-items")&&!d.skip&&this.addEntry(d.id,d.amount,d.cutscene);else if(b==sc.model)if(b.isReset()){this.clearContent();this.delayedStack.length=0;this.hide()}else b.isCutscene()||b.isHUDBlocked()||sc.quests.hasQuestSolvedDialogs()?this.hide():!b.isCutscene()&&(!b.isHUDBlocked()&&
this.contentEntries.length>0&&!sc.quests.hasQuestSolvedDialogs())&&this.show();else if(b==sc.options&&a==sc.OPTIONS_EVENT.OPTION_CHANGED){b=sc.options.get("item-hud-size");if(b!=this.size){this._updateSizes(b==sc.ITEM_HUD_SIZE.NORMAL);this.size=b}}}})});ig.baked=!0;
ig.module("game.feature.gui.hud.element-hud").requires("impact.feature.gui.gui","game.feature.combat.model.combat-params","game.feature.model.options-model").defines(function(){var b=[sc.ELEMENT.HEAT,sc.ELEMENT.COLD,sc.ELEMENT.SHOCK,sc.ELEMENT.WAVE],a=Vec2.createC(0,0);sc.ElementHudGui=ig.GuiElementBase.extend({transitions:{DEFAULT:{state:{},time:0.15,timeFunction:KEY_SPLINES.EASE_OUT},HIDDEN:{state:{alpha:0},time:0.15,timeFunction:KEY_SPLINES.EASE_IN}},timer:0,icons:[],init:function(){this.parent();
this.setSize(64,64);this.hook.zIndex=1181;this.hook.pauseGui=true;for(var a=0;a<b.length;++a){var c=new sc.ElementHudIconGui(f[b[a]]);this.icons.push(c);this.addChildGui(c)}this.doStateTransition("HIDDEN",true);sc.Model.addObserver(sc.model.player,this)},modelChanged:function(a,b){b==sc.PLAYER_MSG.ELEMENT_MODE_CHANGE&&sc.options.get("element-select")},showElement:function(a){for(var c=0;c<b.length;++c)this.icons[c].show(a,a==b[c]);this.timer=0.5;this.doStateTransition("DEFAULT")},hide:function(){for(var a=
0;a<b.length;++a)this.icons[a].hide();this.doStateTransition("HIDDEN")},update:function(){if(this.timer){this.timer=this.timer-ig.system.actualTick;this.timer<=0&&this.hide()}this._updatePos(true)},_updatePos:function(){var b=ig.game.playerEntity;if(b){b=b.coll;ig.system.getScreenFromMapPos(a,Math.round(b.pos.x+b.size.x/2),Math.round(b.pos.y-b.pos.z-b.size.z/2+b.size.y/2));this.hook.pos.x=a.x-this.hook.size.x/2;this.hook.pos.y=a.y-this.hook.size.y/2}}});var d={alignX:ig.GUI_ALIGN.X_CENTER,alignY:ig.GUI_ALIGN.Y_TOP,
tile:0,rotate:0,pShowX:16,pShowY:32,pHideX:16,pHideY:0},c={alignX:ig.GUI_ALIGN.X_RIGHT,alignY:ig.GUI_ALIGN.Y_CENTER,tile:1,rotate:0.25,pShowX:0,pShowY:16,pHideX:32,pHideY:16},e={alignX:ig.GUI_ALIGN.X_LEFT,alignY:ig.GUI_ALIGN.Y_CENTER,tile:3,rotate:0.75,pShowX:32,pShowY:16,pHideX:0,pHideY:16},f={};f[sc.ELEMENT.HEAT]={alignX:ig.GUI_ALIGN.X_CENTER,alignY:ig.GUI_ALIGN.Y_BOTTOM,tile:2,rotate:0.5,pShowX:16,pShowY:0,pHideX:16,pHideY:32};f[sc.ELEMENT.COLD]=d;f[sc.ELEMENT.SHOCK]=c;f[sc.ELEMENT.WAVE]=e;sc.ElementHudIconGui=
ig.GuiElementBase.extend({transitions:{DEFAULT:{state:{},time:0.15,timeFunction:KEY_SPLINES.EASE_OUT},HIDDEN:{state:{scaleX:0,scaleY:0},time:0.15,timeFunction:KEY_SPLINES.EASE_IN}},gfx:new ig.Image("media/gui/status-gui.png"),iconDir:null,currentElement:0,bigSize:false,init:function(a){this.parent();this.iconDir=a;this.setSize(32,32);this.setAlign(a.alignX,a.alignY);this.doStateTransition("HIDDEN",true)},show:function(a,b){this.currentElement=a;this.bigSize=b;a!=sc.ELEMENT.NEUTRAL?this.setPivot(this.iconDir.pShowX,
this.iconDir.pShowY):this.setPivot(this.iconDir.pHideX,this.iconDir.pHideY);this.doStateTransition("HIDDEN",true);this.doStateTransition("DEFAULT")},hide:function(){this.currentElement!=sc.ELEMENT.NEUTRAL?this.setPivot(this.iconDir.pHideX,this.iconDir.pHideY):this.setPivot(this.iconDir.pShowX,this.iconDir.pShowY);this.doStateTransition("HIDDEN")},updateDrawables:function(a){!this.bigSize&&this.iconDir.rotate&&a.addTransform().setPivot(16,16).setRotate(this.iconDir.rotate*2*Math.PI);var b=f[this.currentElement],
c,d=0,e;if(this.bigSize){b=128+b.tile*32;c=224;e=32}else{b=b?136+(1+b.tile)*24:136;c=200;e=24;d=4}a.addGfx(this.gfx,d,0,b,c,e,e);!this.bigSize&&this.iconDir.rotate&&a.undoTransform()}})});ig.baked=!0;
ig.module("game.feature.gui.hud.money-hud").requires("game.feature.gui.hud.right-hud").defines(function(){sc.MoneyTextGui=ig.GuiElementBase.extend({gfx:new ig.Image("media/gui/message.png"),number:null,transitions:{DEFAULT:{state:{},time:0.2,timeFunction:KEY_SPLINES.LINEAR},HIDDEN:{state:{scaleY:0},time:0.2,timeFunction:KEY_SPLINES.LINEAR}},noIcon:false,init:function(b,a){this.parent();this.noIcon=a||false;this.number=new sc.NumberGui(9999999,{showPlus:!b,signed:true,transitionTime:0.5});this.number.setPos(0,
2);this.addChildGui(this.number);this.hook.size.x=this.number.hook.size.x+(a?0:14);this.hook.size.y=this.number.hook.size.y+4;this.hook.pivot.x=this.hook.size.x;this.hook.pivot.y=b?this.hook.size.y:0},updateDrawables:function(b){this.noIcon||b.addGfx(this.gfx,this.hook.size.x-10,2,0,88,10,8)}});sc.MoneyContentGui=ig.GuiElementBase.extend({plusGui:null,sumGui:null,init:function(){this.parent();this.plusGui=new sc.MoneyTextGui(false);this.sumGui=new sc.MoneyTextGui(true);this.addChildGui(this.plusGui);
this.addChildGui(this.sumGui);this.hook.size.x=this.plusGui.hook.size.x;this.hook.size.y=this.plusGui.hook.size.y},showPlus:function(b){this.sumGui.doStateTransition("HIDDEN",true);this.plusGui.doStateTransition("DEFAULT",true);this.plusGui.number.setNumber(b)},showSum:function(b){this.plusGui.doStateTransition("HIDDEN");this.sumGui.doStateTransition("DEFAULT");this.sumGui.number.setNumber(b)},clear:function(){this.plusGui.number.setNumber(0,true)}});sc.MoneyHudBox=sc.RightHudBoxGui.extend({contentGui:null,
addedSum:0,timer:0,init:function(){this.parent(ig.lang.get("sc.gui.money-hud.title"));this.contentGui=new sc.MoneyContentGui;this.pushContent(this.contentGui);sc.Model.addObserver(sc.model.player,this);sc.Model.addObserver(sc.model,this)},update:function(){if(this.timer>0){var b=this.timer;this.timer=this.timer-ig.system.actualTick;if(this.timer<=0){this.addedSum=0;this.contentGui.clear();this.hide()}b>2&&this.timer<=2&&this.showSum()}},modelChanged:function(b,a,d){if(b==sc.model.player)a==sc.PLAYER_MSG.CREDIT_CHANGE&&
sc.options.get("show-money")&&this.addMoney(d);else if(b==sc.model){b.player.getCore(sc.PLAYER_CORE.CREDITS);if(a==sc.GAME_MODEL_MSG.SUB_STATE_CHANGED&&sc.model.prevSubState!=sc.GAME_MODEL_SUBSTATE.QUESTSOLVED){this.timer=this.addedSum=0;this.contentGui.clear();this.hide()}}},addMoney:function(b){this.addedSum=this.addedSum+b;this.contentGui.showPlus(this.addedSum);this.timer=5;this.show()},showSum:function(){this.contentGui.showSum(sc.model.player.credit)}})});ig.baked=!0;
ig.module("game.feature.gui.hud.task-hud").requires("game.feature.gui.hud.right-hud").defines(function(){sc.TaskHudBox=sc.RightHudBoxGui.extend({contentGui:null,addedSum:0,timer:0,init:function(){this.parent(ig.lang.get("sc.gui.task-hud.title"));this.contentGui=new sc.TextGui("",{bestRatio:12,maxWidth:240});this.pushContent(this.contentGui);sc.Model.addObserver(sc.model,this)},update:function(){if(!ig.game.paused&&!this.hidden&&!sc.model.keepTaskDisplayed&&this.timer>0){this.timer=this.timer-ig.system.actualTick;
this.timer<=0&&this.hide()}},modelChanged:function(b,a){if(b==sc.model){var d=b.currentTask||b.permaTask||"";if(a==sc.GAME_MODEL_MSG.TASK_CHANGED){b.currentTask&&!this.hidden&&this.hide(true);if(b.currentTask){this.contentGui.setText(d);this.replaceContent(0,this.contentGui);this.show();this.timer=b.taskTimer!=void 0&&b.taskTimer>=0?b.taskTimer:7;this.timer<=0&&this.hide()}else{this.timer=0;this.hide()}}else if(a==sc.GAME_MODEL_MSG.PERMA_TASK_CHANGED){this.contentGui.setText(d);this.replaceContent(0,
this.contentGui)}else if(a==sc.GAME_MODEL_MSG.SUB_STATE_CHANGED)if(b.isPaused()&&d){this.contentGui.setText(d);this.replaceContent(0,this.contentGui);this.show()}else if((b.isMenu()||b.isQuickMenu())&&d)this.hide();else if(!b.keepTaskDisplayed&&b.isCutscene())this.hide();else if(d&&(this.timer>0||b.keepTaskDisplayed)){this.contentGui.setText(d);this.replaceContent(0,this.contentGui);this.show()}else this.hide();else if(a==sc.GAME_MODEL_MSG.STATE_CHANGED&&b.isTitle())this.timer=0}}})});ig.baked=!0;
ig.module("game.feature.gui.hud.hp-hud").requires("impact.feature.gui.gui","game.feature.gui.base.numbers","game.feature.model.options-model").defines(function(){sc.HpHudGui=ig.GuiElementBase.extend({transitions:{DEFAULT:{state:{},time:0.3,timeFunction:KEY_SPLINES.LINEAR},HIDDEN:{state:{alpha:0},time:0.3,timeFunction:KEY_SPLINES.LINEAR}},gfx:new ig.Image("media/gui/status-gui.png"),criticalText:null,hpNumber:null,hpBar:null,critical:false,criticalTimer:0,init:function(b){this.parent();this.setSize(68,
16);this.setPivot(36,16);this.hpNumber=new sc.NumberGui(9999,{signed:true,transitionTime:0.5});this.hpNumber.setPos(12,1);this.addChildGui(this.hpNumber);this.criticalText=new sc.TextGui("\\c[1]CRITICAL",{font:sc.fontsystem.tinyFont});this.criticalText.setPos(20,0);this.addChildGui(this.criticalText);this.criticalText.hook.localAlpha=0;b=sc.model.player.params;this.hpBar=new sc.HpHudBarGui(b,48,3);this.hpBar.setPos(12,9);this.addChildGui(this.hpBar);sc.Model.addObserver(b,this);sc.Model.addObserver(sc.model.player,
this);sc.Model.addObserver(sc.options,this);this.hpNumber.setNumber(b.currentHp,true)},update:function(){if(this.critical){this.hpNumber.hook.localAlpha=0;this.criticalTimer=this.criticalTimer-ig.system.actualTick;if(this.criticalTimer<=0)this.criticalTimer=0.1;this.criticalText.hook.localAlpha=this.criticalTimer<0.05?0:1}else{this.hpNumber.hook.localAlpha=1;this.criticalTimer=this.criticalText.hook.localAlpha=0}var b=sc.model.player.hasLevelUp()?1:(sc.model.player.exp/sc.EXP_PER_LEVEL).limit(0,1);
this.hpBar.setExpRatio(b)},updateDrawables:function(b){b.addGfx(this.gfx,0,0,0,0,this.hook.size.x,this.hook.size.y)},modelChanged:function(b,a){if(b==sc.model.player.params){var d=Math.max(0,b.currentHp);a==sc.COMBAT_PARAM_MSG.HP_CHANGED?this.hpNumber.setNumber(d):a==sc.COMBAT_PARAM_MSG.STATS_CHANGED?this.hpNumber.setNumber(d,!this.hook._visible):a==sc.COMBAT_PARAM_MSG.RESET_STATS&&this.hpNumber.setNumber(d,true);if(a==sc.COMBAT_PARAM_MSG.HP_CHANGED||a==sc.COMBAT_PARAM_MSG.STATS_CHANGED)if(b.getHpFactor()<=
sc.HP_LOW_WARNING){this.hpNumber.setColor(sc.GUI_NUMBER_COLOR.RED);sc.options.get("low-health-warning")&&ig.overlay.setCorner("RED",1,0.4,0.5)}else{this.hpNumber.setColor(sc.GUI_NUMBER_COLOR.WHITE);sc.options.get("low-health-warning")&&ig.overlay.setCorner("RED",0,0.4)}this.critical=b.currentHp<=0&&!b.defeated}else if(b==sc.model.player){if(a==sc.PLAYER_MSG.SET_PARAMS||a==sc.PLAYER_MSG.CONFIG_CHANGED){d=sc.model.player.params;this.hpNumber.setNumber(Math.max(0,d.currentHp),true);this.hpBar.resetHp();
this.critical=d.currentHp<=0&&!d.defeated}}else b==sc.options&&a==sc.OPTIONS_EVENT.OPTION_CHANGED&&(this.targetHp/this.maxHp<=sc.HP_LOW_WARNING?sc.options.get("low-health-warning")?ig.overlay.setCorner("RED",1,0.4,0.5):ig.overlay.setCorner("RED",0,0.4):ig.overlay.setCorner("RED",0,0.4))}});sc.HpHudBarGui=ig.GuiElementBase.extend({gfx:new ig.Image("media/gui/status-gui.png"),maxHp:0,currentHp:0,targetHp:0,timer:0,expTimer:0,params:null,width:0,height:0,expRatio:0,init:function(b,a,d){this.parent();
this.params=b;this.width=a||48;this.height=d||3;this.maxHp=b.getStat("hp");this.currentHp=this.targetHp=b.currentHp},onAttach:function(){sc.Model.addObserver(this.params,this)},onDetach:function(){sc.Model.removeObserver(this.params,this)},update:function(){if(this.targetHp<0){this.currentHp=-1;this.timer=(this.timer+ig.system.actualTick)%0.2}else if(this.timer>0)this.timer=this.timer-ig.system.actualTick;else if(this.targetHp!=this.currentHp){var b=ig.system.actualTick*this.maxHp/2;if(this.currentHp>
this.targetHp)this.currentHp=Math.max(this.targetHp,this.currentHp-b);else if(this.currentHp<this.targetHp)this.currentHp=Math.min(this.targetHp,this.currentHp+b)}if(this.expRatio>=1)this.expTimer=(this.expTimer+ig.system.actualTick)%0.2},setExpRatio:function(b){this.expRatio=b},resetHp:function(){this.maxHp=this.params.getStat("hp");this.currentHp=this.targetHp=this.params.currentHp},updateDrawables:function(b){var a,d,c,e,f=1;if(this.targetHp>0){if(this.targetHp<this.currentHp){d=this.currentHp/
this.maxHp;a=this.targetHp/this.maxHp;e=49}else{d=this.targetHp/this.maxHp;a=this.currentHp/this.maxHp;e=51}c=a>sc.HP_LOW_WARNING?48:50}else{a=1;c=50;f=this.timer/0.2;f=(f<0.5?f:1-f)*2}for(var g=0;g<this.height;g++){d&&this.targetHp!=this.currentHp&&b.addGfx(this.gfx,g,g,0,e,d.limit(0,1)*this.width,1).setAlpha(f);a>0&&b.addGfx(this.gfx,g,g,0,c,a.limit(0,1)*this.width,1).setAlpha(f)}a=this.expTimer>0.1;d=this.expRatio;c=this.expRatio>=1;d&&b.addGfx(this.gfx,this.height+1,this.height+1,0,48+(c&&a?6:
4),d.limit(0,1)*this.width,1)},modelChanged:function(b,a){if(a==sc.COMBAT_PARAM_MSG.HP_CHANGED){this.timer=0.5;if((this.targetHp-this.currentHp)*(b.currentHp-this.targetHp)<0)this.currentHp=this.targetHp;this.targetHp=b.currentHp;this.maxHp=b.getStat("hp")}else if(a==sc.COMBAT_PARAM_MSG.STATS_CHANGED){this.maxHp=b.getStat("hp");this.targetHp=b.currentHp;this.currentHp=this.currentHp-(this.targetHp-b.currentHp)}else if(a==sc.COMBAT_PARAM_MSG.RESET_STATS){this.maxHp=b.getStat("hp");this.currentHp=this.targetHp=
b.currentHp}if(this.currentHp<-1)this.currentHp=-1}})});ig.baked=!0;
ig.module("game.feature.gui.hud.sp-hud").requires("impact.feature.gui.gui","game.feature.gui.base.numbers","game.feature.combat.model.combat-params").defines(function(){function b(a,b,c,g,h,m,l){var o=e,r=f;m||(r=r+n);l||(r=r+p);m=i*2+j*4;l=m-k;if(g!=void 0){o=o+(i+g*j);m=m-(i+g*j);l=m-k}if(h!=void 0)l=m=m-(i+(4-h)*j);a.addGfx(b,c.posX,0,o,r,m,d);c.posX=c.posX+l}function a(a,c,e,f,i,j,k){e.sp&&e.sp%4==0&&b(a,c,e,void 0,0,k!=r.REMOVED,f<=i);var D=f<=i,C=6,j=KEY_SPLINES.EASE_IN_OUT.get(j),C=Math.round(j*
C+(1-j)*3),A=Math.floor(C*(f-Math.floor(f))),j=1+A,A=1+C-A,B=l,w=o;if(k==r.ADDED){B=g;w=h}else if(k==r.REMOVED){B=g;w=h+8}else D||(w=w+p);a.addGfx(c,e.posX,0,B,w,j,d);k||(w=w+n);B=B+(m-A);a.addGfx(c,e.posX+j,0,B,w,A,d);e.posX=e.posX+(C+2);e.sp++;e.barFilled++;if(e.sp%4==0){b(a,c,e,4,void 0,k==r.ADDED,f<=i);e.barFilled=0;e.regenFilled=(i-e.sp).limit(0,4)}}var d=7,c={sp:0,posX:0,barFilled:0,regenFilled:0};sc.SpHudGui=ig.GuiElementBase.extend({barHideTimer:0,barShowTimer:0,hideBack:false,targetSp:0,
transitions:{DEFAULT:{state:{},time:0.1,timeFunction:KEY_SPLINES.LINEAR},HIDDEN:{state:{scaleY:0},time:0.1,timeFunction:KEY_SPLINES.LINEAR}},gfx:new ig.Image("media/gui/status-gui.png"),init:function(){this.parent();this.setSize(142,d);this.setPivot(71,3);var a=sc.model.player.params;sc.Model.addObserver(a,this);sc.Model.addObserver(sc.model.player,this);a.maxSp==0&&this.doStateTransition("HIDDEN",true)},update:function(){var a=sc.model.player.params.currentSp,b=this.targetSp!=Math.floor(this.targetSp);
if(a>this.targetSp){if(!this.hideBack&&!b){this.hideBack=false;this.barShowTimer=0.2}if(Math.floor(this.targetSp)<Math.floor(a)){this.hideBack=false;this.barHideTimer=0.2;if(Math.floor(a)<a)this.barShowTimer=0.2}}else if(a<this.targetSp){if(Math.floor(a)==a&&b){this.hideBack=true;this.barHideTimer=0.2}if(Math.floor(this.targetSp)>Math.floor(a)){this.hideBack=true;this.barShowTimer=0.2;if(b)this.barHideTimer=0.2}}this.targetSp=a;if(this.barShowTimer){this.barShowTimer=this.barShowTimer-ig.system.actualTick;
if(this.barShowTimer<0)this.barShowTimer=0}if(this.barHideTimer){this.barHideTimer=this.barHideTimer-ig.system.actualTick;if(this.barHideTimer<0)this.barHideTimer=0}},updateDrawables:function(e){var f=sc.model.player.params,g=f.maxSp||4,h=g*sc.SP_REGEN_FACTOR,f=f.currentSp,i=Math.floor(f);e.addGfx(this.gfx,0,0,0,16,19,d);this.barHideTimer&&!this.hideBack&&(i=Math.max(0,i-1));c.posX=19;c.sp=0;c.barFilled=Math.min(4,i);for(c.regenFilled=Math.min(4,h);c.sp+1<=i;){var j=c.sp?void 0:0;if(c.barFilled==
4&&(c.regenFilled==4||c.regenFilled==0))b(e,this.gfx,c,j,void 0,true,c.regenFilled==4);else if(c.regenFilled>0&&c.regenFilled<c.barFilled){var k=c.barFilled==4?void 0:c.barFilled;b(e,this.gfx,c,j,c.regenFilled,true,true);b(e,this.gfx,c,c.regenFilled,k,true,false)}else b(e,this.gfx,c,j,c.barFilled,true,c.regenFilled>0);c.sp=c.sp+c.barFilled;if(c.barFilled==4){c.barFilled=Math.min(4,i-c.sp);c.regenFilled=(h-c.sp).limit(0,4)}}if(this.barHideTimer&&!this.hideBack){j=this.barHideTimer/0.2;a(e,this.gfx,
c,c.sp-0.001,h,j,r.ADDED);i++}if(f-i>0){j=(0.2-this.barShowTimer)/0.2;a(e,this.gfx,c,f,h,j)}if(this.barHideTimer&&this.hideBack){j=this.barHideTimer/0.2;a(e,this.gfx,c,c.sp+1,h,j,r.REMOVED)}if(c.sp==0||c.sp%4!=0){if(c.regenFilled>c.barFilled&&c.regenFilled<4){b(e,this.gfx,c,c.barFilled,c.regenFilled,false,true);c.barFilled=c.regenFilled}b(e,this.gfx,c,c.barFilled,void 0,false,c.regenFilled==4);c.sp=c.sp==0?4:Math.ceil(c.sp/4)*4}for(;c.sp<g;){c.regenFilled=(h-c.sp).limit(0,4);if(c.regenFilled==4||
c.regenFilled==0)b(e,this.gfx,c,void 0,void 0,false,c.regenFilled==4);else{b(e,this.gfx,c,void 0,c.regenFilled,false,true);b(e,this.gfx,c,c.regenFilled,void 0,false,false)}c.sp=c.sp+4}},modelChanged:function(a,b){if(a==sc.model.player.params){if(b==sc.COMBAT_PARAM_MSG.MAX_SP_CHANGED)if(sc.model.player.params.maxSp==0){this.doStateTransition("HIDDEN");this.targetSp=0}else this.doStateTransition("DEFAULT")}else a==sc.model.player&&b==sc.PLAYER_MSG.CORE_CHANGED&&(sc.model.player.getCore(sc.PLAYER_CORE.SPECIAL)?
this.doStateTransition("DEFAULT"):this.doStateTransition("HIDDEN"))}});var e=96,f=0,g=40,h=16,i=8,j=5,k=6,l=68,o=0,m=26,n=16,p=8,r={NONE:0,ADDED:1,REMOVED:2}});ig.baked=!0;
ig.module("game.feature.gui.hud.param-hud").requires("impact.feature.gui.gui","impact.feature.gui.base.basic-gui","impact.feature.gui.base.box").defines(function(){sc.ParamHudGui=ig.GuiElementBase.extend({transitions:{DEFAULT:{state:{},time:0,timeFunction:KEY_SPLINES.LINEAR},HIDDEN:{state:{alpha:0},time:0,timeFunction:KEY_SPLINES.LINEAR}},level:null,hp:null,atk:null,def:null,foc:null,_isOut:false,init:function(){this.parent();this.level=new sc.ParamHudGui.Level;this.level.setAlign(ig.GUI_ALIGN.X_LEFT,
ig.GUI_ALIGN.Y_TOP);this.addChildGui(this.level);this.hp=new sc.ParamHudGui.Param("maxhp","hp",62,9999,0);this.hp.setAlign(ig.GUI_ALIGN.X_LEFT,ig.GUI_ALIGN.Y_TOP);this.hp.setPos(52,0);this.addChildGui(this.hp);this.atk=new sc.ParamHudGui.Param("atk","attack",54,999,1);this.atk.setAlign(ig.GUI_ALIGN.X_LEFT,ig.GUI_ALIGN.Y_TOP);this.atk.setPos(100,0);this.addChildGui(this.atk);this.def=new sc.ParamHudGui.Param("def","defense",54,999,2);this.def.setAlign(ig.GUI_ALIGN.X_LEFT,ig.GUI_ALIGN.Y_TOP);this.def.setPos(140,
0);this.addChildGui(this.def);this.foc=new sc.ParamHudGui.Param("foc","focus",54,999,3);this.foc.setAlign(ig.GUI_ALIGN.X_LEFT,ig.GUI_ALIGN.Y_TOP);this.foc.setPos(180,0);this.addChildGui(this.foc);this.hideParams(true);this.doStateTransition("DEFAULT")},showParams:function(b){b?this.hasTransition()||this._isOut?this.doPosTranstition(54,26,0.2,KEY_SPLINES.EASE):this.setPos(54,26):this.hasTransition()||this._isOut?this.doPosTranstition(52,5,0.2,KEY_SPLINES.LINEAR):this.setPos(52,5);this._isOut=true;
this.level.doStateTransition("DEFAULT",false,false,null,0.048);this.hp.doStateTransition("DEFAULT",false,false,null,0.048);this.atk.doStateTransition("DEFAULT",false,false,null,0.048);this.def.doStateTransition("DEFAULT",false,false,null,0.048);this.foc.doStateTransition("DEFAULT",false,false,null,0.048)},hideParams:function(b){b=b!=void 0?b:false;this.level.doStateTransition("HIDDEN",b);this.hp.doStateTransition("HIDDEN",b);this.atk.doStateTransition("HIDDEN",b);this.def.doStateTransition("HIDDEN",
b);this.foc.doStateTransition("HIDDEN",b);this._isOut=false}});sc.ParamHudGui.Pie=ig.GuiElementBase.extend({gfx:new ig.Image("media/gui/status-gui.png"),param:"",offsetX:0,offsetY:0,_timer:0,_targetValue:1,_startValue:1,init:function(b){this.parent();this.param=b;this.setSize(8,8);sc.Model.addObserver(sc.model.player,this);this._timer=0.2;this._calcOffset(1)},update:function(){if(this._timer<0.2){this._timer=this._timer+ig.system.actualTick;if(this._timer>=0.2)this._timer=0.2;this._calcOffset(this._getCurrentValue())}},
updateDrawables:function(b){b.addGfx(this.gfx,0,0,1+this.offsetX,146+this.offsetY,this.hook.size.x,this.hook.size.y)},_getCurrentValue:function(){if(this._timer>=0.2)return this._targetValue;var b=this._timer/0.2;return(1-b)*this._startValue+b*this._targetValue},_calcOffset:function(b){var a=b<1?(b-1)*-1+1:b,d=(Math.abs(a)-1)*10%6;this.offsetX=(b<1?Math.ceil(d):Math.floor(d))*9;this.offsetY=(b<1?18:0)+(Math.abs(a)-1>=0.6?9:0)},modelChanged:function(b,a){if(b==sc.model.player&&(a==sc.PLAYER_MSG.ELEMENT_MODE_CHANGE||
a==sc.PLAYER_MSG.LEVEL_CHANGE||a==sc.PLAYER_MSG.SKILL_CHANGED)){var d=sc.model.player.getCurrentElementMode().getParamFactor(this.param);if(this._targetValue!=d){this._timer=0;this._startValue=this._targetValue;this._targetValue=d}}}});sc.ParamHudGui.Param=ig.BoxGui.extend({ninepatch:new ig.NinePatch("media/gui/status-gui.png",{width:3,height:0,left:17,top:17,right:17,bottom:0,offsets:{"default":{x:0,y:128}}}),transitions:{DEFAULT:{state:{},time:0.2,timeFunction:KEY_SPLINES.EASE},HIDDEN:{state:{scaleY:0,
alpha:0,scaleX:0.8},time:0.2,timeFunction:KEY_SPLINES.LINEAR}},_pie:null,_text:null,_number:null,_param:"",init:function(b,a,d,c,e){this.parent(d,17);this.hook.pivot.x=0;this.hook.pivot.y=0;this._param=a;sc.Model.addObserver(sc.model.player,this);sc.Model.addObserver(sc.model.player.params,this);this._text=new sc.TextGui(ig.lang.get("sc.gui.status-hud."+b),{speed:ig.TextBlock.SPEED.IMMEDIATE,font:sc.fontsystem.tinyFont});this._text.setAlign(ig.GUI_ALIGN.X_LEFT,ig.GUI_ALIGN.Y_TOP);this._text.setPos(19,
0);this.addChildGui(this._text);this._pie=new ig.ImageGui(this.ninepatch.gfx,e*8,232,8,8);this._pie.setAlign(ig.GUI_ALIGN.X_LEFT,ig.GUI_ALIGN.Y_TOP);this._pie.setPos(9,0);this.addChildGui(this._pie);this._number=new sc.NumberGui(c,{signed:true,transitionTime:0.2});this._number.setAlign(ig.GUI_ALIGN.X_RIGHT,ig.GUI_ALIGN.Y_BOTTOM);this._number.setPos(10,1);this._setNumber(true);this.addChildGui(this._number);this.doStateTransition("HIDDEN",true)},_setNumber:function(b){var a=sc.model.player.params.getStat(this._param);
this._number.setNumber(a,b);b=sc.model.player.params.getStatBuffFactor(this._param);a=sc.GUI_NUMBER_COLOR.WHITE;if(b<1)a=sc.GUI_NUMBER_COLOR.RED;if(b>1)a=sc.GUI_NUMBER_COLOR.GREEN;this._number.setColor(a)},modelChanged:function(b,a){b==sc.model.player?a==sc.PLAYER_MSG.ELEMENT_MODE_CHANGE||a==sc.PLAYER_MSG.LEVEL_CHANGE?this._setNumber():(a==sc.PLAYER_MSG.EQUIP_CHANGE||a==sc.PLAYER_MSG.RESET_PLAYER||a==sc.PLAYER_MSG.CONFIG_CHANGED||a==sc.PLAYER_MSG.SET_PARAMS||a==sc.PLAYER_MSG.SKILL_CHANGED)&&this._setNumber(!this.isVisible()):
b==sc.model.player.params&&a==sc.COMBAT_PARAM_MSG.STATS_CHANGED&&this._setNumber(!this.isVisible())}});sc.ParamHudGui.Level=ig.BoxGui.extend({ninepatch:new ig.NinePatch("media/gui/status-gui.png",{width:3,height:0,left:17,top:17,right:17,bottom:0,offsets:{"default":{x:0,y:128}}}),transitions:{DEFAULT:{state:{},time:0.2,timeFunction:KEY_SPLINES.EASE},HIDDEN:{state:{scaleY:0,alpha:0,scaleX:0.8},time:0.2,timeFunction:KEY_SPLINES.LINEAR}},_text:null,_level:null,init:function(){this.parent(66,17);this.hook.pivot.x=
0;this.hook.pivot.y=0;sc.Model.addObserver(sc.model.player,this);this._text=new sc.TextGui(ig.lang.get("sc.gui.status-hud.lvl"),{speed:ig.TextBlock.SPEED.IMMEDIATE,font:sc.fontsystem.tinyFont});this._text.setAlign(ig.GUI_ALIGN.X_LEFT,ig.GUI_ALIGN.Y_TOP);this._text.setPos(10,1);this.addChildGui(this._text);this._level=new sc.NumberGui(99,{signed:true,transitionTime:0.2,size:sc.NUMBER_SIZE.LARGE});this._level.setAlign(ig.GUI_ALIGN.X_RIGHT,ig.GUI_ALIGN.Y_BOTTOM);this._level.setPos(17,1);this._level.setNumber(sc.model.player.level,
true);this.addChildGui(this._level);this.doStateTransition("HIDDEN",true)},modelChanged:function(b,a){b==sc.model.player&&(a==sc.PLAYER_MSG.LEVEL_CHANGE?this._level.setNumber(sc.model.player.level):a==sc.PLAYER_MSG.SET_PARAMS&&this._level.setNumber(sc.model.player.level,true))}})});ig.baked=!0;
ig.module("game.feature.gui.hud.buff-hud").requires("impact.feature.gui.gui","impact.feature.gui.base.box","impact.feature.gui.base.basic-gui").defines(function(){sc.BuffHudEntry=ig.BoxGui.extend({ninepatch:new ig.NinePatch("media/gui/status-gui.png",{width:2,height:0,left:2,top:10,right:2,bottom:0,offsets:{"default":{x:241,y:128}}}),transitions:{DEFAULT:{state:{},time:0.2,timeFunction:KEY_SPLINES.EASE},HIDDEN:{state:{alpha:0,offsetX:20},time:0.2,timeFunction:KEY_SPLINES.LINEAR},REMOVE:{state:{alpha:0},
time:0.2,timeFunction:KEY_SPLINES.LINEAR},SCALED:{state:{scaleX:0},time:0.2,timeFunction:KEY_SPLINES.EASE}},buff:null,id:0,init:function(b,a,d){this.parent(10,10);this.buff=b;this.id=a||0;b=new sc.TextGui(b.iconString,{font:sc.fontsystem.tinyFont,speed:ig.TextBlock.SPEED.IMMEDIATE});b.setAlign(ig.GUI_ALIGN.X_LEFT,ig.GUI_ALIGN.Y_TOP);b.setPos(1,1);this.addChildGui(b);this.setSize(b.hook.size.x+5+1,10);this.setPos(d,0);this.setPivot(0,this.hook.size.y/2);this.doStateTransition(a==0?"HIDDEN":"SCALED",
true)},updateDrawables:function(b){this.parent(b);if(this.buff.hasTimer){var a=Math.ceil(this.buff.getTimeFactor()*8);b.addGfx(this.ninepatch.gfx,this.hook.size.x-4,1,249,129,2,8);a>0&&b.addGfx(this.ninepatch.gfx,this.hook.size.x-4,this.hook.size.y-1-a,252,129+(8-a),2,a)}}});sc.BuffHudGui=ig.GuiElementBase.extend({gfx:new ig.Image("media/gui/status-gui.png"),startPiece:null,endPiece:null,buffSlots:[],init:function(){this.parent();sc.Model.addObserver(sc.model.player.params,this);this.startPiece=new ig.ImageGui(this.gfx,
216,128,10,10);this.startPiece.hook.transitions={DEFAULT:{state:{},time:0.2,timeFunction:KEY_SPLINES.EASE},HIDDEN:{state:{alpha:0,offsetX:20},time:0.2,timeFunction:KEY_SPLINES.LINEAR},REMOVE:{state:{alpha:0},time:0.2,timeFunction:KEY_SPLINES.LINEAR}};this.startPiece.doStateTransition("REMOVE",true);this.addChildGui(this.startPiece);this.endPiece=new ig.ImageGui(this.gfx,230,129,10,10);this.endPiece.hook.transitions={DEFAULT:{state:{},time:0.2,timeFunction:KEY_SPLINES.EASE},HIDDEN:{state:{alpha:0,
offsetX:20},time:0.2,timeFunction:KEY_SPLINES.LINEAR},REMOVE:{state:{alpha:0},time:0.2,timeFunction:KEY_SPLINES.LINEAR}};this.endPiece.doStateTransition("REMOVE",true);this.addChildGui(this.endPiece)},update:function(){for(var b=this.buffSlots.length,a=false;b--;)if(this.buffSlots[b]&&this.buffSlots[b].buff.getTimeFactor()<=0){b==0&&!this.buffSlots[b+1]?this.buffSlots[b].doStateTransition("REMOVE",false,true):this.buffSlots[b].doStateTransition("SCALED",false,true);this.buffSlots.splice(b,1);a=true}if(a&&
this.sortSlots()){this.startPiece.doStateTransition("REMOVE");this.endPiece.doStateTransition("REMOVE")}},sortSlots:function(){for(var b=10,a=true,d=null,c=0;c<this.buffSlots.length;c++)if(d=this.buffSlots[c]){a=false;d.doPosTranstition(b,0,0.2,KEY_SPLINES.EASE);d.id=c;b=b+d.hook.size.x}a||this.endPiece.doPosTranstition(b,0,0.2,KEY_SPLINES.EASE);return a},addBuff:function(b){for(var a=10,d=0,c=0;c<this.buffSlots.length;c++)if(this.buffSlots[c]){a=a+this.buffSlots[c].hook.size.x;d++}b=new sc.BuffHudEntry(b,
d,a);b.doStateTransition("DEFAULT");this.addChildGui(b);this.buffSlots[d]=b;if(d==0){this.startPiece.doStateTransition("HIDDEN",true);this.endPiece.doStateTransition("HIDDEN",true);this.endPiece.setPos(a+b.hook.size.x,0)}else this.endPiece.doPosTranstition(a+b.hook.size.x,0,0.2,KEY_SPLINES.EASE);this.startPiece.doStateTransition("DEFAULT");this.endPiece.doStateTransition("DEFAULT")},removeAll:function(){this.hook.removeAllChildren();for(var b=0;b<this.buffSlots.length;b++)this.buffSlots[b]&&this.buffSlots[b].doStateTransition("REMOVE",
true,true);this.buffSlots.length=0;this.startPiece.doStateTransition("REMOVE",true);this.endPiece.doStateTransition("REMOVE",true);this.addChildGui(this.startPiece);this.addChildGui(this.endPiece)},modelChanged:function(b,a,d){a==sc.COMBAT_PARAM_MSG.BUFF_ADDED?this.addBuff(d):(a==sc.COMBAT_PARAM_MSG.RESET_STATS||a==sc.COMBAT_PARAM_MSG.BUFFS_CLEARED)&&this.removeAll()}})});ig.baked=!0;
ig.module("game.feature.gui.hud.item-timer-hud").requires("impact.feature.gui.gui","impact.feature.gui.base.box").defines(function(){sc.ItemTimerHudGui=ig.GuiElementBase.extend({gfx:new ig.Image("media/gui/status-gui.png"),transitions:{DEFAULT:{state:{},time:0.2,timeFunction:KEY_SPLINES.EASE_OUT},HIDDEN:{state:{alpha:0,scaleX:0},time:0.2,timeFunction:KEY_SPLINES.EASE_IN}},numberGui:null,player:null,maxTime:null,init:function(){this.parent();this.setSize(44,10);this.setPivot(0,5);sc.Model.addObserver(sc.model.player,
this);this.player=sc.model.player;this.numberGui=new sc.NumberGui(60,{leadingZeros:2,size:sc.NUMBER_SIZE.TINY,color:sc.GUI_NUMBER_COLOR.WHITE});this.numberGui.setAlign(ig.GUI_ALIGN.X_LEFT,ig.GUI_ALIGN.Y_CENTER);this.numberGui.setNumber(0);this.numberGui.setPos(18,0);this.addChildGui(this.numberGui);this.doStateTransition("HIDDEN",true)},update:function(){this.isVisible()&&this.numberGui.setNumber(Math.ceil(this.player.itemBlockTimer))},updateDrawables:function(b){b.addGfx(this.gfx,0,0,216,160,this.hook.size.x,
this.hook.size.y);b.addColor("white",16,8,Math.ceil(this.player.itemBlockTimer/this.maxTime*13),1)},modelChanged:function(b,a){if(b==sc.model.player)if(a==sc.PLAYER_MSG.ITEM_USED)if(this.player.itemBlockTimer>0){this.maxTime=this.player.itemBlockTimer;this.numberGui.setNumber(this.player.itemBlockTimer);this.doStateTransition("DEFAULT")}else this.doStateTransition("HIDDEN");else a==sc.PLAYER_MSG.ITEM_BLOCK_FINISH?this.doStateTransition("HIDDEN"):a==sc.PLAYER_MSG.RESET_PLAYER&&this.doStateTransition("HIDDEN",
true)}})});ig.baked=!0;
ig.module("game.feature.quick-menu.quick-menu-model").requires("impact.base.game","impact.feature.interact.button-interact","impact.feature.database.database","game.feature.model.base-model").defines(function(){sc.QUICK_MENU_STATE={};sc.QUICK_MENU_STATE.NONE=0;sc.QUICK_MENU_STATE.ITEMS=1;sc.QUICK_MENU_STATE.CHECK=2;sc.QUICK_MENU_STATE.PARTY=3;sc.QUICK_MENU_STATE.MAP=4;sc.QuickMenuModel=ig.GameAddon.extend({observers:[],buttonInteract:null,activeState:false,currentState:sc.QUICK_MENU_STATE.NONE,previousState:sc.QUICK_MENU_STATE.NONE,
visible:false,cursorMoved:false,cursor:Vec2.createC(0,0),analFocus:null,itemIndex:0,infoText:null,buffText:null,buffID:null,skipActiveState:false,names:[],gamepadActive:false,lastDevice:0,itemsBlocked:false,init:function(){this.parent("QuickMenuModel");this.buttonInteract=new ig.ButtonInteractEntry;window.wm&&ig.database.register("names","NPCNamesList","NPC Names");this.names=ig.database.get("names")},enterQuickMenu:function(){ig.interact.addEntry(this.buttonInteract);this.visible=true},exitQuickMenu:function(){ig.interact.removeEntry(this.buttonInteract);
this.visible=false;this.previousState=this.currentState=sc.QUICK_MENU_STATE.NONE;this.itemIndex=0;this.cursorMoved=false;this.analFocus=null;this.cursor.x=0;this.cursor.y=0;this.skipActiveState?this.skipActiveState=false:this.activeState=false;sc.Model.notifyObserver(this,sc.QUICK_MODEL_EVENT.EXIT_MENU)},enterItems:function(){this._switchStates(sc.QUICK_MENU_STATE.ITEMS)},enterParty:function(){this._switchStates(sc.QUICK_MENU_STATE.PARTY)},enterCheck:function(){this._switchStates(sc.QUICK_MENU_STATE.CHECK)},
enterNone:function(){this._switchStates(sc.QUICK_MENU_STATE.NONE)},setInfoText:function(b,a){this.infoText=b;sc.Model.notifyObserver(this,sc.QUICK_MODEL_EVENT.INFO_TEXT_CHANGED,a)},setBuffText:function(b,a,d){this.buffText=b;this.buffID=d>=0?d:null;sc.Model.notifyObserver(this,sc.QUICK_MODEL_EVENT.BUFF_TEXT_CHANGED,a)},setItemBlock:function(b){this.itemsBlocked=b||false},toggleInputMode:function(){sc.Model.notifyObserver(this,sc.QUICK_MODEL_EVENT.INPUT_MODEL_TOGGLED)},resetCursor:function(){this.cursorMoved=
false;if(this.analFocus)this.analFocus.focus=false;this.analFocus=null},focusEntity:function(b,a,d,c){if(this.analFocus==d){if(ig.input.currentDevice==ig.INPUT_DEVICES.GAMEPAD){this.cursor.x=b;this.cursor.y=a;sc.Model.notifyObserver(this,sc.QUICK_MODEL_EVENT.ENSURE_FOCUS)}}else{this.cursor.x=b;this.cursor.y=a;this.analFocus&&this.analFocus.focus&&this.analFocus.focusLost();(this.analFocus=d)&&!this.analFocus.focus&&this.analFocus.focusGained();sc.Model.notifyObserver(this,sc.QUICK_MODEL_EVENT.FOCUS_NODE,
c)}},unfocusEntity:function(b){if(this.analFocus==b){this.analFocus&&this.analFocus.focusLost();this.analFocus=null;sc.Model.notifyObserver(this,sc.QUICK_MODEL_EVENT.UNFOCUS)}},isDeviceSynced:function(){return this.lastDevice==ig.input.currentDevice},_switchStates:function(b){if(this.currentState!=b){this.previousState=this.currentState;this.currentState=b;sc.Model.notifyObserver(this,sc.QUICK_MODEL_EVENT.SWITCH_STATE)}},isQuickNone:function(){return this.currentState==sc.QUICK_MENU_STATE.NONE},isQuickItems:function(){return this.currentState==
sc.QUICK_MENU_STATE.ITEMS},isQuickParty:function(){return this.currentState==sc.QUICK_MENU_STATE.PARTY},isQuickCheck:function(){return this.currentState==sc.QUICK_MENU_STATE.CHECK}});sc.QUICK_MODEL_EVENT={};sc.QUICK_MODEL_EVENT.EXIT_MENU=0;sc.QUICK_MODEL_EVENT.SWITCH_STATE=1;sc.QUICK_MODEL_EVENT.INFO_TEXT_CHANGED=2;sc.QUICK_MODEL_EVENT.BUFF_TEXT_CHANGED=3;sc.QUICK_MODEL_EVENT.INPUT_MODEL_TOGGLED=4;sc.QUICK_MODEL_EVENT.FOCUS_NODE=5;sc.QUICK_MODEL_EVENT.UNFOCUS=6;sc.QUICK_MODEL_EVENT.ENSURE_FOCUS=7;
ig.addGameAddon(function(){return sc.quickmodel=new sc.QuickMenuModel})});ig.baked=!0;
ig.module("game.feature.menu.map-model").requires("impact.base.game","impact.base.loader","impact.base.vars","impact.feature.database.database","game.config","game.feature.quick-menu.quick-menu-model","game.feature.model.options-model").defines(function(){var b={landmark:"",area:""};sc.LANDMARK_OPTIONS={DEFAULT:{icon:null,bounds:{x:0,y:0,w:8,h:8}}};sc.MAP_DUNGEON_OVERRIDE={DUNGEON:1,NO_DUNGEON:2};sc.AREA_TYPE={};sc.AREA_TYPE.TOWN=0;sc.AREA_TYPE.PATH=1;sc.AREA_TYPE.DUNGEON=2;sc.AREA_ITEM_TYPE={DUNGEON_KEY:{areaField:"keyItem"},
DUNGEON_MASTER_KEY:{areaField:"masterKeyItem"},BOOSTER:{areaField:"boosterItem"}};sc.MapModel=ig.GameAddon.extend({observers:[],activeLandmarks:{},areas:null,areasVisited:{},currentPlayerArea:null,currentArea:null,currentPlayerFloor:0,currentFloor:0,currentMap:null,unknownArea:null,teleportEvent:null,_usedNames:[],_oobSoundTerrain:null,init:function(){this.parent("MapModel");ig.storage.register(this);window.wm&&ig.database.register("areas","AreaList","Areas");this.initAreas();ig.vars.registerVarAccessor("area",
this,"VarAreaEditor");ig.vars.registerVarAccessor("location",this,"VarLocationEditor")},isValidArea:function(a){return this.areas[a].track&&!this.areas[a].isDLC},getTotalAreasFound:function(a){var b=0,c=0,e;for(e in this.areas)if(this.isValidArea(e)){this.areasVisited[e.toCamel()]&&b++;c++}return a?b/c:b},getTotalLandmarksFound:function(a){var b=0,c=0,e;for(e in this.areas)for(var f in this.areas[e].landmarks)if(!this.areas[e].landmarks[f].extension&&this.isValidArea(e)){this.activeLandmarks[e]&&
this.activeLandmarks[e][f]&&b++;c++}return a?b/c:b},getTotalChestsFound:function(a){var b=0,c=0,e;for(e in this.areas)if(this.isValidArea(e)){var f=sc.stats.getMap("chests",e)||0;f>this.areas[e].chests&&(f=this.areas[e].chests);b=b+f;c=c+(this.areas[e].chests||0)}return a?b/c:b},getTotalChests:function(){var a=0,b;for(b in this.areas)this.isValidArea(b)&&(a=a+(this.areas[b].chests||0));return a},hasAllAreasFound:function(){for(var a in this.areas)if(this.isValidArea(a)&&!this.areasVisited[a.toCamel()])return false;
return true},getTotalLandmarksFoundInArea:function(a){if(a=this.activeLandmarks[a]){var b=0,c;for(c in a)b++;return b||0}},levelLoadStartOrder:10,onLevelLoadStart:function(a){this.currentMap=a.name.toKey("","");var b=a.attributes&&a.attributes.area||"fallback";this.updateVisitedArea(b);this._oobSoundTerrain=a.attributes&&a.attributes.oobSound||"HOLE";a=false;this.currentPlayerArea&&this.currentPlayerArea.path!=b?a=true:this.currentPlayerArea||(a=true);if(a){this.currentPlayerArea=new sc.AreaLoadable(b);
this.currentPlayerArea.addLoadListener(this);this.currentArea=this.currentPlayerArea}else{this.currentArea=this.currentPlayerArea;this.onLoadableComplete()}},levelLoadedOrder:150,onLevelLoaded:function(){var a=ig.game.entities,b=a.length;Math.seedrandomSeed(ig.game.mapName);this._usedNames.length=0;for(var c=sc.quickmodel.names,e=0,f=sc.NPC_GENDER.BOTH;b--;){var g=a[b];if(g&&g instanceof ig.ENTITY.NPC&&!g.displayName&&!g.character.data.name){for(var f=sc.NPC_GENDER[g.character.data.gender]||sc.NPC_GENDER.BOTH,
h=Math.floor(Math.randomSeed()*c.length),e=0;!this.canUseGenderName(f,sc.NPC_GENDER[c[h].gender])||this._usedNames[h];){h=Math.floor(Math.randomSeed()*c.length);e++;if(e>=3)break}this._usedNames[h]=true;g.displayNameRandom=ig.LangLabel.getText(c[h].name)}}sc.Model.notifyObserver(sc.map,sc.MAP_EVENT.MAP_ENTERED)},canUseGenderName:function(a,b){switch(b||0){case sc.NPC_GENDER.BOTH:return a==sc.NPC_GENDER.MALE||a==sc.NPC_GENDER.FEMALE;case sc.NPC_GENDER.MALE:return a==sc.NPC_GENDER.MALE;case sc.NPC_GENDER.FEMALE:return a==
sc.NPC_GENDER.FEMALE}return false},onReset:function(){this.areasVisited={};this.activeLandmarks={}},onVarAccess:function(a,b){if(b[0]=="area"){var c=b[1];if(this.areas[c])switch(b[2]){case "name":return ig.LangLabel.getText(this.areas[c].name);case "isCurrent":return this.currentPlayerArea&&this.currentPlayerArea.path==c;case "isBoosted":return this.getAreaItemToggleState(sc.AREA_ITEM_TYPE.BOOSTER,c);case "chests":return(this.areas[c].chests||0)+"";case "landmark":switch(b[3]){case "name":return ig.LangLabel.getText(this.areas[c].landmarks[b[4]].name);
case "active":return this.activeLandmarks[b[1]][b[4]]?true:false}break;case "unlocked":return this.areasVisited[c.toCamel()]?true:false}}if(b[0]=="location")switch(b[1]){case "current":return this.currentPlayerArea&&this.currentPlayerArea.path;case "isMapDungeon":return this.isDungeon();case "isAreaDungon":return this.isDungeon(true)}throw Error("Unsupported var access path: "+a);},initAreas:function(){this.areas=ig.database.get("areas")},loadArea:function(a,b){if(a==this.currentPlayerArea.path){this.currentArea=
this.currentPlayerArea;b.onLoadableComplete(true,this.currentArea)}else{this.currentArea=new sc.AreaLoadable(a);this.currentArea.addLoadListener(b)}},unloadCurrentArea:function(){if(this.currentArea.path!=this.currentPlayerArea.path){this.currentArea.decreaseRef();this.currentArea=null}},updateVisitedArea:function(a){if(!this.areasVisited[a.toCamel()]){this.areas[a].track&&sc.stats.addMap("exploration","areas",1);this.areasVisited[a.toCamel()]={}}},undoVisitedArea:function(a,b){if(this.areasVisited[a.toCamel()]){this.areas[a].track&&
sc.stats.subMap("exploration","areas",1);delete this.areasVisited[a.toCamel()]}if(b)for(var c=b.data.floors,e=c.length;e--;)for(var f=c[e],g=f.maps.length;g--;)ig.vars.set("maps."+f.maps[g].path.toCamel().toPath("",""),null)},validateCurrentPlayerFloor:function(){var a=this.currentPlayerArea.data;if(a){var b=a.floors.length,c=0,e=null,f=null;this.currentPlayerFloor=this.currentFloor=0;for(var g=false;b--;){e=a.floors[b];for(c=e.maps.length;c--;){f=e.maps[c];g=f.path==this.currentMap;f.zMin&&(g=g&
ig.game.playerEntity.coll.level>=f.zMin);f.zMax&&(g=g&ig.game.playerEntity.coll.level<=f.zMax);if(g){this.currentFloor=this.currentPlayerFloor=e.level||0;return}}}}},validateCurrentFloor:function(){var a=this.currentArea.data,b=a.floors.length,c=0,e=null,f=null;this.currentFloor=0;for(var g=a.defaultFloor==void 0?void 0:a.defaultFloor,h=false;b--;){e=a.floors[b];for(c=e.maps.length;c--;){f=e.maps[c];h=ig.vars.get("maps."+f.path.toCamel().toPath("",""));f.zMin&&(h=h&ig.game.playerEntity.coll.level>=
f.zMin);f.zMax&&(h=h&ig.game.playerEntity.coll.level<=f.zMax);if(h){if(g==void 0){this.currentFloor=e.level||0;return}if(g==e.level){this.currentFloor=g;return}}else e.level==g&&(g=void 0)}}},restore:function(){this.currentFloor=this.currentPlayerFloor;this.currentArea&&this.currentPlayerArea&&this.currentArea.path!=this.currentPlayerArea.path&&this.currentArea.decreaseRef();this.currentArea=this.currentPlayerArea},addLandmark:function(a,d,c){if(!this.isLandmarkValid(a,d||this.currentPlayerArea.path))throw Error("invalid Landmark: "+
a+"! Maybe missing entry in database?");d=d||this.currentPlayerArea.path;this.activeLandmarks[d]||(this.activeLandmarks[d]={});if(!this.activeLandmarks[d][a]||!this.activeLandmarks[d][a].active){if(this.activeLandmarks[d][a])this.activeLandmarks[d][a].active=true;else{this.activeLandmarks[d][a]={active:true};sc.stats.addMap("exploration","landmarks",1);sc.stats.addMap("exploration",d+"-landmarks",1);sc.stats.setMap("exploration","landmarksTotalRate",this.getTotalLandmarksFound(true));sc.menu.addLog({type:"LANDMARK",
area:d,landmark:a})}b.landmark=a;b.area=d||this.currentPlayerArea.path;c&&sc.options.get("update-landmark-style")!=sc.UPDATE_LANDMARK_STYLE.NONE&&ig.game.events.callEvent(this.getLandmarkEvent(c),ig.EventRunType.INTERRUPTABLE);sc.quests.onLandmarkEvent(d);sc.Model.notifyObserver(this,sc.MAP_EVENT.LANDMARK_ADDED,b)}},startTeleport:function(a){this.teleportEvent=this.getTeleportEvent(a.path);sc.stats.addMap("player","teleports",1);sc.model.enterRunning();sc.Cutscene.startCutscene(this.teleportEvent)},
getAreaType:function(a){return sc.AREA_TYPE[this.areas[a].areaType]},isLandmarkValid:function(a,b){var c=this.areas[b].landmarks;return c?c[a]:false},getAreaItemId:function(a,b){if(!b){if(!this.currentPlayerArea)return-1;b=this.currentPlayerArea.path}var c=this.areas[b][a.areaField];return!c&&c!==0?-1:c},getAreaItemType:function(a,b){if(!b){if(!this.currentPlayerArea)return null;b=this.currentPlayerArea.path}var c=this.areas[b],e;for(e in sc.AREA_ITEM_TYPE)if(a==c[sc.AREA_ITEM_TYPE[e].areaField])return e},
getAreaItemAmount:function(a,b){var c=this.getAreaItemId(a,b);return c==-1?0:sc.model.player.getItemAmount(c)},getAreaItemToggleState:function(a,b){var c=this.getAreaItemId(a,b);return c==-1?false:sc.model.player.getItemAmount(c)>0&&sc.model.player.getToggleItemState(c)},isLandmarkActive:function(a,b,c){if(b=b||this.currentPlayerArea&&this.currentPlayerArea.path){this.activeLandmarks[b]||(this.activeLandmarks[b]={});return!this.activeLandmarks[b][a]?false:c?this.activeLandmarks[b][a].active||false:
this.activeLandmarks[b][a]||false}},setLandmarkActiveState:function(a,b,c){(c=c||this.currentPlayerArea&&this.currentPlayerArea.path)&&this.activeLandmarks[c]&&this.activeLandmarks[c][a]&&(this.activeLandmarks[c][a].active=b||false)},setAreaLandmarksActiveState:function(a,b){var c=this.activeLandmarks[a];if(c)for(var e in c)c[e].active=b},isDungeon:function(a){if(!this.currentPlayerArea)return false;if(!a)if(a=this.getMapDungeon(this.currentMap))return a==sc.MAP_DUNGEON_OVERRIDE.DUNGEON;a=this.areas[this.currentPlayerArea.path];
return sc.AREA_TYPE[a&&a.areaType]==sc.AREA_TYPE.DUNGEON},hasAnyAreaUnlocked:function(){for(var a in this.areas)if(this.areas[a]&&this.areas[a].track&&this.areasVisited[a.toCamel()])return true;return false},getUnlockedAreas:function(){var a=[],b;for(b in this.areas)this.areas[b]&&(this.areas[b].track&&this.areasVisited[b.toCamel()])&&a.push(b);return a},sortAreaList:function(a){if(a){a.sort(function(a,b){return(this.areas[a].order||0)-(this.areas[b].order||0)}.bind(this));return a}},getLandmarkName:function(a,
b){var c=(b=this.areas[b])&&b.landmarks&&b.landmarks[a]&&b.landmarks[a].name;return c?new ig.LangLabel(c):"???"},getLandmark:function(a,b){return this.areas[b].landmarks[a]},getCurrentAreaLandmark:function(a){return this.areas[this.currentArea.path].landmarks[a]},getCurrentPlayerAreaName:function(){return new ig.LangLabel(this.areas[this.currentPlayerArea.path].name)},getCurrentAreaName:function(){return new ig.LangLabel(this.areas[this.currentArea.path].name)},getAreaOrder:function(a){return this.areas[a]?
this.areas[a].order||0:0},getAreaName:function(a,b,c){if(!a)return"";if(a=this.areas[a]){b=new ig.LangLabel(b?a.shortName?a.shortName:a.name:a.name);c&&a.isDLC&&(b=b+(" \\c[2]["+ig.lang.get("sc.gui.dlc.abr")+"]\\c[0]"));return b}return null},getCurrentMapName:function(a){var b=this.getMapName(this.currentMap);return a&&b==this.currentMap?"???":b},getMapName:function(a){for(var b=this.currentArea.data.floors[this.getCurrentFloorIndex()].maps,c=b.length;c--;){var e=b[c];if(e.path==a&&e.name)return new ig.LangLabel(e.name)}return this.currentMap},
getMapDungeon:function(a){if(!this.currentArea||!this.currentArea.data)return null;var b=this.currentArea.data.floors[this.getCurrentFloorIndex()];if(!b)return null;for(var b=b.maps,c=b.length;c--;){var e=b[c];if(e.path==a)return sc.MAP_DUNGEON_OVERRIDE[e.dungeon]||null}return null},getCurrentFloorIndex:function(){return this.currentFloor-this.currentArea.lowestFloor},getCurrentArea:function(){return this.currentArea?this.currentArea.data:null},getLandmarkEvent:function(a){return new ig.Event({steps:[{type:"SET_CAMERA_BETWEEN",
entity1:a,entity2:ig.game.playerEntity,speed:"NORMAL",wait:true,transition:"EASE_OUT"},{type:"WAIT",time:1},{type:"RESET_CAMERA",speed:"NORMAL",transition:"EASE_IN_OUT"}]})},getTeleportEvent:function(a){var b=ig.game.playerEntity,c=[];c.push({type:"DO_ACTION",entity:ig.game.playerEntity,action:[{type:"SET_Z_GRAVITY_FACTOR",value:0},{type:"SET_Z_VEL",value:0},{type:"WAIT",time:5}]});c.push({time:0.2,ignoreSlowDown:false,type:"WAIT"});c.push({type:"SET_TELEPORT_COLOR",lighter:true,color:"white"});c.push({color:"white",
alpha:1,time:1,lighter:true,type:"SET_OVERLAY"});c.push({type:"SET_CAMERA_TARGET",entity:b,speed:"NORMAL",transition:"EASE_IN_OUT",zoom:1.5});c.push({time:0.2,ignoreSlowDown:false,type:"WAIT"});c.push({type:"SHOW_EFFECT",entity:b,effect:{sheet:"teleport",name:"hideMapTeleport"}});for(b=sc.party.getPartySize();b--;){var e=sc.party.getPartyMemberEntityByIndex(b);c.push({type:"SHOW_EFFECT",entity:e,effect:{sheet:"teleport",name:"hideFast"}})}c.push({time:1,ignoreSlowDown:false,type:"WAIT"});c.push({type:"TELEPORT",
map:a,marker:"landmark"});c.push({time:3,ignoreSlowDown:false,type:"WAIT"});a=new ig.Event({steps:c});a.addHint("SKIN_ALLOWED");return a},getVisitedArea:function(a){return this.areasVisited[a.toCamel()]},getTeleport:function(){return this.teleportEvent},getCurrentChestCount:function(){return this.areas[this.currentArea.path].chests||0},getChestCount:function(a){return this.areas[a].chests||0},onStorageSave:function(a){if(this.currentPlayerArea){a.area=this.areas[this.currentPlayerArea.path].name;
if(this.currentPlayerFloor!=void 0)for(var b=this.currentPlayerArea.data.floors,c=b.length;c--;){if(this.currentPlayerFloor==b[c].level){a.floor=b[c].name?ig.LangLabel.getText(b[c].name):"";b=b[c].maps;for(c=b.length;c--;)if(b[c].path==this.currentMap&&b[c].name){a.specialMap=ig.LangLabel.getText(b[c].name);a.specialMap=b[c].name}break}}else a.floor="???"}else{a.area="???";a.floor=""}a.visitedAreas=ig.copy(this.areasVisited);a.landmarks=ig.copy(this.activeLandmarks)},onStoragePreLoad:function(a){this.areasVisited=
a.visitedAreas||{};a=a.landmarks||{};this.activeLandmarks={};var b,c;for(c in a){b=0;for(var e in a[c]){this.activeLandmarks[c]||(this.activeLandmarks[c]={});var f=a[c][e];if(!f||f.active===void 0)f={active:true};this.activeLandmarks[c][e]=f;b++}sc.stats.setMap("exploration",c+"-landmarks",b)}sc.stats.setMap("exploration","landmarksTotalRate",this.getTotalLandmarksFound(true));sc.stats.setMap("chests","totalRate",sc.map.getTotalChestsFound(true))},onLoadableComplete:function(){this.validateCurrentPlayerFloor()}});
sc.MAP_EVENT={};sc.MAP_EVENT.LANDMARK_ADDED=1;sc.MAP_EVENT.PLAYER_AREA_CHANGED=2;sc.MAP_EVENT.MAP_ENTERED=3;ig.addGameAddon(function(){return sc.map=new sc.MapModel})});ig.baked=!0;
ig.module("game.feature.gui.hud.key-hud").requires("impact.feature.gui.gui","impact.feature.gui.base.basic-gui","impact.feature.gui.base.box","game.feature.menu.map-model").defines(function(){sc.KeyHudGui=ig.GuiElementBase.extend({gfx:new ig.Image("media/gui/status-gui.png"),ninepatch:new ig.NinePatch("media/gui/status-gui.png",{width:6,height:0,left:0,top:11,right:10,bottom:0,offsets:{"default":{x:128,y:128},master:{x:128,y:140}}}),transitions:{DEFAULT:{state:{},time:0,timeFunction:KEY_SPLINES.LINEAR},
HIDDEN:{state:{alpha:0,scaleY:0},time:0,timeFunction:KEY_SPLINES.LINEAR}},areaItemType:sc.AREA_ITEM_TYPE.DUNGEON_KEY,areaItemTypeMaster:sc.AREA_ITEM_TYPE.DUNGEON_MASTER_KEY,numberGui:null,hasMaster:false,init:function(){this.parent();this.numberGui=new sc.NumberGui(9,{});this.numberGui.setNumber(0);this.numberGui.setPos(11,2);this.addChildGui(this.numberGui);this.doStateTransition("HIDDEN");this.setSize(28,11);sc.Model.addObserver(sc.model.player,this);sc.Model.addObserver(sc.model,this);this.hook.localAlpha=
0.8},updateDrawables:function(b){this.ninepatch.draw(b,this.hook.size.x,this.hook.size.y,this.hasMaster?"master":"default");b.addGfx(this.gfx,1,0,144,this.hasMaster?140:128,8,11)},modelChanged:function(b,a){b==sc.model?a==sc.GAME_MODEL_MSG.SUB_STATE_CHANGED&&sc.model.isRunning()&&this.updateVisibility():b==sc.model.player&&(a==sc.PLAYER_MSG.ITEM_OBTAINED||a==sc.PLAYER_MSG.ITEM_REMOVED)&&this.updateItemCount()},updateVisibility:function(){var b=sc.map.getAreaItemId(this.areaItemType)!=-1;sc.map.isDungeon()||
(b=false);this.doStateTransition(b?"DEFAULT":"HIDDEN");this.updateItemCount()},updateItemCount:function(){var b=sc.map.getAreaItemAmount(this.areaItemType);this.hasMaster=sc.map.getAreaItemAmount(this.areaItemTypeMaster)>0;this.numberGui.setNumber(b+(this.hasMaster?1:0))}})});ig.baked=!0;
ig.module("game.feature.gui.hud.status-hud").requires("impact.feature.gui.gui","game.feature.gui.hud.hp-hud","game.feature.gui.hud.sp-hud","game.feature.gui.hud.param-hud","game.feature.gui.hud.buff-hud","game.feature.gui.hud.item-timer-hud","game.feature.model.options-model","game.feature.gui.hud.key-hud").defines(function(){var b=[{x:20,y:20},{x:20,y:44},{x:20,y:-4},{x:44,y:20},{x:-4,y:20}],a=[{x:[220,289],y:[11,34]},{x:[90,141],y:[19,42]},{x:[20,42],y:[36,83]}];sc.StatusHudGui=ig.GuiElementBase.extend({transitions:{DEFAULT:{state:{},
time:0.2,timeFunction:KEY_SPLINES.LINEAR},HIDDEN:{state:{alpha:0},time:0.2,timeFunction:KEY_SPLINES.LINEAR}},battleBgGui:null,battleSymbolGui:null,upperGui:null,lowerGui:null,elementBgGui:null,elementModeGui:null,paramGui:null,partyGui:null,keyHud:null,elementSwitchTimer:0,menuMode:false,init:function(){this.parent();this.hook.zIndex=1201;this.hook.pauseGui=true;this.elementBgGui=new sc.StatusElementBgGui;this.elementBgGui.setPos(3,3);this.addChildGui(this.elementBgGui);this.elementModeGui=new sc.StatusElementModeGui;
this.elementModeGui.setPos(0,0);this.addChildGui(this.elementModeGui);this.paramGui=new sc.ParamHudGui;this.paramGui.setPos(54,26);this.addChildGui(this.paramGui);this.lowerGui=new sc.StatusLowerGui;this.lowerGui.setPos(29,21);this.addChildGui(this.lowerGui);this.upperGui=new sc.StatusUpperGui;this.upperGui.setPos(24,3);this.addChildGui(this.upperGui);this.partyGui=new sc.PartyHudGui;this.partyGui.setPos(2,39);this.addChildGui(this.partyGui);this.keyHud=new sc.KeyHudGui;this.keyHud.setPos(0,53);this.addChildGui(this.keyHud);
sc.Model.addObserver(sc.model,this);sc.Model.addObserver(sc.model.player,this);sc.Model.addObserver(sc.model.menu,this);sc.Model.addObserver(sc.quickmodel,this);this.doStateTransition("HIDDEN",true)},update:function(){if(this.elementSwitchTimer>0&&!sc.model.isLevelUp()&&!sc.model.isQuickMenu()&&!sc.autoControl.isActive()){this.elementSwitchTimer=this.elementSwitchTimer-ig.system.actualTick;this.elementSwitchTimer<=0&&this._minimizeDisplay()}},modelChanged:function(a,b,c){if(a==sc.model){if(b==sc.GAME_MODEL_MSG.STATE_CHANGED||
b==sc.GAME_MODEL_MSG.SUB_STATE_CHANGED)if(sc.model.isLevelUp())this.elementSwitchDisplay();else if(sc.model.isQuickMenu())this._enterQuickMenuMode();else if(sc.model.isMenu()){this.menuMode=true;sc.menu.directMode&&sc.menu.directMenu?this._changeMenuModeVisibility(sc.menu.directMenu):this._changeMenuModeVisibility(sc.menu.currentMenu)}else{if(this.menuMode){this._minimizeDisplay();this.menuMode=false}this._updateVisibility()}}else if(a==sc.menu)(b==sc.MENU_EVENT.ENTER_MENU||b==sc.MENU_EVENT.LEAVE_MENU)&&
this._changeMenuModeVisibility(sc.menu.currentMenu);else if(a==sc.model.player)if(b==sc.PLAYER_MSG.ELEMENT_MODE_CHANGE)this.elementSwitchDisplay();else if(b==sc.PLAYER_MSG.ITEM_CONSUME_START)this.elementSwitchTimer=100;else{if(b==sc.PLAYER_MSG.ITEM_CONSUME_END)this.elementSwitchTimer=c?1.5:1E-4}else a==sc.quickmodel&&b==sc.QUICK_MODEL_EVENT.SWITCH_STATE&&(sc.quickmodel.isQuickCheck()?this.doStateTransition("HIDDEN"):this.doStateTransition("DEFAULT"))},varsChanged:function(){this._updateVisibility()},
_updateVisibility:function(){if(!sc.model.isQuickMenu()&&!sc.model.isMenu()&&!sc.model.isLevelUp()&&!sc.model.isQuickMenu()){var a=ig.vars.get("playerVar.statusHidden"),b=sc.options.get("hud-display"),a=!a&&sc.model.isGame()&&sc.model.isRunning()&&b;if(!a&&this.elementSwitchTimer>0){this.elementSwitchTimer=0;this._minimizeDisplay()}this.doStateTransition(a?"DEFAULT":"HIDDEN")}},_minimizeDisplay:function(){this.elementSwitchTimer=0;this.elementModeGui.doPosTranstition(0,0,0.3,KEY_SPLINES.EASE_IN_OUT);
this.elementModeGui.selectBg=false;this.elementBgGui.doStateTransition("HIDDEN");this.upperGui.doPosTranstition(24,3,0.3,KEY_SPLINES.EASE_IN_OUT);this.lowerGui.doPosTranstition(29,21,0.3,KEY_SPLINES.EASE_IN_OUT);this.partyGui.doPosTranstition(2,39,0.3,KEY_SPLINES.EASE_IN_OUT);this.keyHud.doPosTranstition(0,53,0.3,KEY_SPLINES.EASE_IN_OUT);this.paramGui.hideParams();this.doStateTransition("DEFAULT")},_minimizeDisplayFast:function(){this.elementSwitchTimer=0;this.elementModeGui.doPosTranstition(0,0,
0.2,KEY_SPLINES.EASE_IN_OUT);this.elementModeGui.selectBg=false;this.elementBgGui.doStateTransition("HIDDEN_MENU");this.upperGui.doPosTranstition(24,3,0.2,KEY_SPLINES.EASE_IN_OUT);this.lowerGui.doPosTranstition(29,21,0.2,KEY_SPLINES.EASE_IN_OUT);this.partyGui.doPosTranstition(2,39,0.2,KEY_SPLINES.EASE_IN_OUT);this.keyHud.doPosTranstition(0,53,0.2,KEY_SPLINES.EASE_IN_OUT);this.paramGui.hideParams();this.doStateTransition("DEFAULT");this._updateVisibility()},_enterQuickMenuMode:function(){this.elementSwitchTimer=
0.1;var a=sc.model.player.currentElementMode;this.elementBgGui.doStateTransition("QUICKMENU");a=b[a];this.elementModeGui.doPosTranstition(a.x+3,a.y+3,0.2,KEY_SPLINES.EASE);this.elementModeGui.doStateTransition("QUICKMENU");this.elementModeGui.selectBg=true;this.upperGui.doPosTranstition(73,26,0.2,KEY_SPLINES.EASE);this.lowerGui.doPosTranstition(78,44,0.2,KEY_SPLINES.EASE);this.partyGui.doPosTranstition(2,88,0.2,KEY_SPLINES.EASE);this.keyHud.doPosTranstition(0,80,0.2,KEY_SPLINES.EASE);this.paramGui.showParams(false);
this.doStateTransition("DEFAULT")},_enterMenuMode:function(){this.elementSwitchTimer=0;var a=sc.model.player.currentElementMode;this.elementBgGui.doStateTransition("MENU");a=b[a];this.elementModeGui.doPosTranstition(a.x+3+2,a.y+3+21,0.2,KEY_SPLINES.EASE);this.elementModeGui.doStateTransition("MENU");this.elementModeGui.selectBg=true;this.upperGui.doPosTranstition(75,47,0.2,KEY_SPLINES.EASE);this.lowerGui.doPosTranstition(80,65,0.2,KEY_SPLINES.EASE);this.partyGui.doPosTranstition(2,109,0.2,KEY_SPLINES.EASE);
this.keyHud.doPosTranstition(0,110,0.2,KEY_SPLINES.EASE);this.paramGui.showParams(true);this.doStateTransition("DEFAULT")},_changeMenuModeVisibility:function(a){switch(a){case sc.MENU_SUBMENU.START:this.doStateTransition("DEFAULT");this._enterMenuMode();break;default:this._minimizeDisplayFast();this.doStateTransition("HIDDEN")}},elementSwitchDisplay:function(){var a=sc.model.player.currentElementMode;this.elementSwitchTimer=sc.model.isLevelUp()||sc.model.isQuickMenu()?0.1:2;this.elementBgGui.doStateTransition("DEFAULT");
a=b[a];this.elementModeGui.setPos(a.x+3,a.y+3);this.elementModeGui.doStateTransition("ZOOM",true);this.elementModeGui.doStateTransition("DEFAULT");this.elementModeGui.selectBg=true;this.upperGui.doPosTranstition(73,26,0.1,KEY_SPLINES.LINEAR);this.lowerGui.doPosTranstition(78,44,0.1,KEY_SPLINES.LINEAR);this.partyGui.doPosTranstition(2,88,0.1,KEY_SPLINES.LINEAR);this.keyHud.doPosTranstition(0,80,0.1,KEY_SPLINES.LINEAR);this.paramGui.showParams(false)},getFreeScreenMinY:function(b){var c=this.elementBgGui.hook.getStateTransitionProgress();
this.elementBgGui.hook.currentStateName=="HIDDEN"&&(c=1-c);for(var d=a.length,h=0,i=0;d--;){var j=a[d],k=j.x[0]*(1-c)+j.x[1]*c,j=j.y[0]*(1-c)+j.y[1]*c;if(b<=k)return Math.max(j,h-(b-i));i=k;h=j}return Math.max(0,h-(b-i))}});sc.StatusUpperGui=ig.GuiElementBase.extend({init:function(){this.parent();var a=new sc.HpHudGui;this.addChildGui(a);a=new sc.SpHudGui;this.addChildGui(a);a.setPos(55,0);a=new sc.ExpHudGui;a.setPos(63,8);this.addChildGui(a)}});sc.StatusLowerGui=ig.GuiElementBase.extend({buffGui:null,
itemTimerGui:null,init:function(){this.parent();sc.Model.addObserver(sc.model.player,this);this.buffGui=new sc.BuffHudGui;this.addChildGui(this.buffGui);this.itemTimerGui=new sc.ItemTimerHudGui;this.itemTimerGui.setPos(0,0);this.addChildGui(this.itemTimerGui)},modelChanged:function(a,b){a==sc.model.player&&(b==sc.PLAYER_MSG.ITEM_USED?this.moveSubGui(true):b==sc.PLAYER_MSG.ITEM_BLOCK_FINISH?this.moveSubGui(false):b==sc.PLAYER_MSG.RESET_PLAYER&&this.moveSubGui(false))},moveSubGui:function(a){this.buffGui.doPosTranstition(a?
32:0,0,0.2,KEY_SPLINES.EASE_IN_OUT)}});var d=[{above:0,interval:0.5,minAlpha:0,maxAlpha:0},{above:0.25,interval:1,minAlpha:0.1,maxAlpha:0.2},{above:0.5,interval:0.5,minAlpha:0.2,maxAlpha:0.5},{above:0.75,interval:0.25,minAlpha:0,maxAlpha:1},{above:1,interval:0.125,minAlpha:0,maxAlpha:1}];sc.ElementalLoadOverlayGui=ig.GuiElementBase.extend({gfx:new ig.Image("media/gui/overload-overlay.png"),alphaHandler:null,currentWarnMode:-1,init:function(){this.parent();this.hook.zIndex=-40;this.setSize(ig.system.width,
ig.system.height);this.alphaHandler=new ig.AlphaTransitionHandler(true)},update:function(){var a=sc.model.player.elementLoad;sc.model.player.hasOverload&&(a=1);for(var b=d.length;b--;)if(a>=d[b].above)break;if(b!=this.currentWarnMode){this.currentWarnMode=b;a=d[b];this.alphaHandler.set(a.minAlpha,a.interval,a.maxAlpha)}if(!this.alphaHandler.update())this.hook.localAlpha=this.alphaHandler.getAlpha()},updateDrawables:function(a){if(sc.options.get("element-overload")){var b=sc.model.player.hasOverload||
sc.model.player.elementLoad<0.1?160:0;a.addGfx(this.gfx,0,0,b,0,160,160,false,false).setCompositionMode("lighter");a.addGfx(this.gfx,ig.system.width-160,0,b,0,160,160,true,false).setCompositionMode("lighter");a.addGfx(this.gfx,ig.system.width-160,ig.system.height-160,b,0,160,160,true,true).setCompositionMode("lighter");a.addGfx(this.gfx,0,ig.system.height-160,b,0,160,160,false,true).setCompositionMode("lighter")}}});sc.StatusElementModeGui=ig.GuiElementBase.extend({gfx:new ig.Image("media/gui/status-gui.png"),
timer:0,selectBg:false,transitions:{DEFAULT:{state:{},time:0.15,timeFunction:KEY_SPLINES.LINEAR},QUICKMENU:{state:{},time:0.2,timeFunction:KEY_SPLINES.EASE},MENU:{state:{},time:0.2,timeFunction:KEY_SPLINES.EASE},ZOOM:{state:{scaleX:0.25,scaleY:0.25},time:0.15,timeFunction:KEY_SPLINES.LINEAR}},init:function(){this.parent();this.setSize(40,40);this.setPivot(20,20)},update:function(){this.timer=(this.timer+ig.system.actualTick)%2},updateDrawables:function(a){var b=sc.model.player.currentElementMode,
c=sc.model.player.elementLoad,d=Math.ceil(c*(this.hook.size.y-7)),i=2;c>=0.9?i=0.25:c>=0.75?i=0.5:c>=0.5&&(i=1);c=this.timer%i/i;c=c<0.5?c*2:(1-c)*2;a.addGfx(this.gfx,0,0,64,32+this.hook.size.x*(this.selectBg?0:1),this.hook.size.x,this.hook.size.y);if(d&&c){d=d+4;a.addGfx(this.gfx,0,this.hook.size.x-d,64,32+this.hook.size.x*3-d,this.hook.size.x,d).setAlpha(c)}a.addGfx(this.gfx,8,8,104,32+b*24,24,24)}});var c=[{x:32,y:32},{x:32,y:56},{x:32,y:8},{x:56,y:32},{x:8,y:32}];sc.StatusElementBgGui=ig.GuiElementBase.extend({gfx:new ig.Image("media/gui/status-gui.png"),
transitions:{DEFAULT:{state:{},time:0.1,timeFunction:KEY_SPLINES.EASE_IN_OUT},QUICKMENU:{state:{},time:0.2,timeFunction:KEY_SPLINES.EASE},MENU:{state:{offsetY:21,offsetX:2},time:0.2,timeFunction:KEY_SPLINES.EASE},HIDDEN:{state:{alpha:0,scaleX:0,scaleY:0},time:0.3,timeFunction:KEY_SPLINES.EASE_IN_OUT},HIDDEN_MENU:{state:{alpha:0,scaleX:0,scaleY:0},time:0.2,timeFunction:KEY_SPLINES.EASE_IN_OUT}},init:function(){this.parent();this.setSize(80,80);this.setPivot(10,10);this.doStateTransition("HIDDEN",true)},
updateDrawables:function(a){a.addGfx(this.gfx,0,0,136,0,80,80);for(var b=sc.model.player.currentElementMode,d=0;d<c.length;++d)if(d!=b){var h=c[d],i=(d?d-1:b-1)*16,j=d?96:64;ig.input.currentDevice==ig.INPUT_DEVICES.KEYBOARD_AND_MOUSE&&(j=j+16);!sc.model.player.getCore(d+8)&&d&&(j=j-32);a.addGfx(this.gfx,h.x,h.y,i,j,16,16)}}});sc.BattleModeBgGui=ig.ImageGui.extend({bgImage:new ig.Image("media/gui/status-gui.png"),transitions:{DEFAULT:{state:{offsetX:-23,offsetY:-23,alpha:0.6},time:0.3,timeFunction:KEY_SPLINES.EASE_IN_OUT},
MAXIMIZED:{state:{alpha:0.6},time:0.1,timeFunction:KEY_SPLINES.EASE},HIDDEN:{state:{offsetX:-44,offsetY:-44,alpha:0},time:0.2,timeFunction:KEY_SPLINES.EASE_IN_OUT}},init:function(){this.parent(this.bgImage,128,80,88,88)}});sc.BattleModeSymbolGui=ig.ImageGui.extend({bgImage:new ig.Image("media/gui/status-gui.png"),transitions:{DEFAULT:{state:{offsetX:0,offsetY:0},time:0.3,timeFunction:KEY_SPLINES.EASE_IN_OUT},MAXIMIZED:{state:{offsetX:6,offsetY:6},time:0.1,timeFunction:KEY_SPLINES.EASE},HIDDEN:{state:{offsetX:-16,
offsetY:-16,alpha:0},time:0.2,timeFunction:KEY_SPLINES.EASE_IN_OUT}},init:function(){this.parent(this.bgImage,216,80,16,16)}})});ig.baked=!0;
ig.module("game.feature.gui.hud.exp-hud").requires("impact.feature.gui.gui","game.feature.gui.base.numbers").defines(function(){sc.ExpEntryGui=ig.GuiElementBase.extend({gfx:new ig.Image("media/gui/status-gui.png"),transitions:{DEFAULT:{state:{},time:0.2,timeFunction:KEY_SPLINES.EASE_IN_OUT},HIDDEN:{state:{alpha:0,offsetX:16},time:0.2,timeFunction:KEY_SPLINES.EASE_IN_OUT},MERGE:{state:{alpha:0,offsetX:-32},time:0.3,timeFunction:KEY_SPLINES.EASE_IN_OUT}},number:null,exp:0,withLabel:false,init:function(b,
a){this.parent();this.withLabel=b;this.number=new sc.NumberGui(0,{size:sc.NUMBER_SIZE.TINY,transitionTime:0.3});this.number.setPos(b?36:13,1);this.addChildGui(this.number);this.setExp(a||0);this.hook.size.y=7},setExp:function(b){this.number.setNumber(b);this.hook.size.x=this.number.hook.size.x+(this.withLabel?36:13)+6;this.exp=b},updateDrawables:function(b){var a=this.withLabel?36:13,d=this.hook.size.y;b.addGfx(this.gfx,0,0,this.withLabel?0:40,32,a,d);b.addColor("black",a,0,this.hook.size.x-6-a,d);
b.addGfx(this.gfx,this.hook.size.x-6,0,53,32,6,d)}});sc.ExpMenuGui=ig.GuiElementBase.extend({gfx:new ig.Image("media/gui/status-gui.png"),transitions:{DEFAULT:{state:{},time:0.2,timeFunction:KEY_SPLINES.EASE},HIDDEN:{state:{alpha:0},time:0.2,timeFunction:KEY_SPLINES.LINEAR}},_expNumber:null,init:function(){this.parent();this.hook.size.x=88;this.hook.size.y=7;sc.Model.addObserver(sc.model,this);sc.Model.addObserver(sc.model.player,this);sc.Model.addObserver(sc.model.menu,this);this._expNumber=new sc.NumberGui(1E3,
{signed:true,size:sc.NUMBER_SIZE.TINY});this._expNumber.setAlign(ig.GUI_ALIGN.X_RIGHT,ig.GUI_ALIGN.Y_TOP);this._expNumber.setPos(35,1);this._expNumber.setNumber(sc.model.player.exp,true);this.addChildGui(this._expNumber);this.doStateTransition("HIDDEN",true)},updateDrawables:function(b){b.addGfx(this.gfx,0,0,0,182,88,7)},modelChanged:function(b,a){if(b==sc.model){if(a==sc.GAME_MODEL_MSG.SUB_STATE_CHANGED){var d=b.isMenu();this._expNumber.setNumber(sc.model.player.exp);this.doStateTransition(d?"DEFAULT":
"HIDDEN")}}else if(b==sc.menu&&(a==sc.MENU_EVENT.ENTER_MENU||a==sc.MENU_EVENT.LEAVE_MENU))switch(b.currentMenu){case sc.MENU_SUBMENU.START:this.doStateTransition("DEFAULT");break;case sc.MENU_SUBMENU.EQUIPMENT:this.doStateTransition("HIDDEN")}}});sc.ExpHudGui=ig.GuiElementBase.extend({baseEntry:null,menuEntry:null,timer:0,expSum:0,expAddEntries:[],init:function(){this.parent();this.baseEntry=new sc.ExpEntryGui(true);this.baseEntry.doStateTransition("HIDDEN",true);this.addChildGui(this.baseEntry);
this.menuEntry=new sc.ExpMenuGui;this.addChildGui(this.menuEntry);sc.Model.addObserver(sc.model,this);sc.Model.addObserver(sc.model.player,this)},update:function(){if(this.timer>0){this.timer=this.timer-ig.system.actualTick;if(this.timer<=0)if(this.expAddEntries.length>0){this.mergeExpEntry();this.timer=this.expAddEntries.length?1:5}else{this.expSum=0;this.baseEntry.doStateTransition("HIDDEN")}}},addExp:function(b){if(this.expSum){b=new sc.ExpEntryGui(false,b);b.doStateTransition("HIDDEN",true);b.doStateTransition("DEFAULT");
this.expAddEntries.push(b);this.insertChildGui(b,Math.max(this.hook.children.length-2,0));this.timer=2}else{this.expSum=b;this.baseEntry.doStateTransition("DEFAULT");this.baseEntry.setExp(b);this.timer=5}this.expAddEntries.length>3?this.mergeExpEntry():this.reorder()},mergeExpEntry:function(){var b=this.expAddEntries.shift();this.expSum=this.expSum+b.exp;this.baseEntry.setExp(this.expSum);b.doStateTransition("MERGE",false,true);this.reorder()},mergeAllEntries:function(){for(;this.expAddEntries.length>
0;)this.mergeExpEntry()},reorder:function(){for(var b=this.baseEntry.hook.size.x,a=0;a<this.expAddEntries.length;++a){b=b+-3;this.expAddEntries[a].doPosTranstition(b,0,0.3,KEY_SPLINES.EASE_IN_OUT);b=b+this.expAddEntries[a].hook.size.x}},modelChanged:function(b,a,d){if(b==sc.model.player)if(a==sc.PLAYER_MSG.EXP_CHANGE)this.addExp(d);else{if(a==sc.PLAYER_MSG.RESET_PLAYER){this.mergeAllEntries();this.timer=this.expSum=0;this.baseEntry.setExp(0);this.menuEntry._expNumber.setNumber(0);this.baseEntry.doStateTransition("HIDDEN")}}else if(b==
sc.model&&a==sc.GAME_MODEL_MSG.SUB_STATE_CHANGED&&b.isMenu()){this.mergeAllEntries();this.expSum=0;this.baseEntry.doStateTransition("HIDDEN")}}})});ig.baked=!0;
ig.module("game.feature.menu.gui.quests.quest-entries").requires("impact.feature.gui.base.box","impact.feature.gui.gui").defines(function(){sc.SubTaskEntryBase=ig.BoxGui.extend({transitions:{DEFAULT:{state:{},time:0.2,timeFunction:KEY_SPLINES.EASE},HIDDEN:{state:{scaleY:0},time:0.2,timeFunction:KEY_SPLINES.LINEAR}},ninepatch:new ig.NinePatch("media/gui/menu.png",{width:2,height:0,left:4,top:13,right:4,bottom:0,offsets:{"default":{x:488,y:0}}}),quest:null,taskIndex:null,subTaskIndex:null,subTask:null,
textGui:null,done:false,init:function(b,a,d,c){this.parent(150,13);this.setPivot(75,6.5);this.quest=b||null;this.taskIndex=a||0;this.textGui=new sc.TextGui("",{font:sc.fontsystem.smallFont});this.textGui.setPos(6,-1);this.addChildGui(this.textGui);this.createUI&&this.createUI();this.setSubTask(d,c)},setSubTask:function(b,a){this.subTaskIndex=b;(this.subTask=a)&&this.onSubTaskChange&&this.onSubTaskChange()},getState:function(){return sc.quests.getSubTaskState(this.quest,this.taskIndex,this.subTaskIndex)}});
sc.SubTaskEntry={};sc.SubTaskEntry.COLLECT=sc.SubTaskEntryBase.extend({gfx:new ig.Image("media/gui/basic.png"),numberGui:null,maxNumberGui:null,_done:false,init:function(b,a,d,c){this.parent(b,a,d,c)},updateDrawables:function(b){this.parent(b);b.addGfx(this.gfx,this.hook.size.x-21,2,73,56,4,8)},onSubTaskChange:function(){var b=sc.model.player.getItemAmount(this.subTask.item),a=this.subTask.amount;this.done=sc.quests.isQuestSolved(this.quest.id)||sc.quests.isTaskDone(this.quest,this.taskIndex)||b>=
a;var d=sc.inventory.getItem(this.subTask.item||0),c=this.done?"\\i[quest-mini-ok]":"\\i[quest-mini-no]",c=this.subTask.hideName&&!this.done?b>=1?c+ig.LangLabel.getText(d.name):c+"???????????????":c+ig.LangLabel.getText(d.name);this.textGui.setText(c);this.numberGui.setNumber(this.done?a:Math.min(b,a));this.maxNumberGui.setNumber(a);if(this.subTask.hideMax&&!this.done){this.maxNumberGui.setNumber(99);this.maxNumberGui.scramble=true}else this.maxNumberGui.scramble=false},createUI:function(){this.numberGui=
new sc.NumberGui(99,{size:sc.NUMBER_SIZE.SMALL});this.numberGui.setAlign(ig.GUI_ALIGN.X_RIGHT,ig.GUI_ALIGN.Y_TOP);this.numberGui.setPos(22,2);this.addChildGui(this.numberGui);this.maxNumberGui=new sc.NumberGui(99,{size:sc.NUMBER_SIZE.SMALL});this.maxNumberGui.setAlign(ig.GUI_ALIGN.X_RIGHT,ig.GUI_ALIGN.Y_TOP);this.maxNumberGui.setPos(4,2);this.addChildGui(this.maxNumberGui)}});sc.SubTaskEntry.LANDMARK=sc.SubTaskEntryBase.extend({gfx:new ig.Image("media/gui/basic.png"),numberGui:null,maxNumberGui:null,
_done:false,init:function(b,a,d,c){this.parent(b,a,d,c)},updateDrawables:function(b){this.parent(b);b.addGfx(this.gfx,this.hook.size.x-21,2,73,56,4,8)},onSubTaskChange:function(){var b=sc.map.getTotalLandmarksFoundInArea(this.subTask.area),a=this.subTask.amount;this.done=sc.quests.isQuestSolved(this.quest.id)||sc.quests.isTaskDone(this.quest,this.taskIndex)||b>=a;var d=sc.map.getAreaName(this.subTask.area);this.textGui.setText((this.done?"\\i[quest-mini-ok]":"\\i[quest-mini-no]")+d);this.numberGui.setNumber(this.done?
a:Math.min(b,a));this.maxNumberGui.setNumber(a)},createUI:function(){this.numberGui=new sc.NumberGui(99,{size:sc.NUMBER_SIZE.SMALL});this.numberGui.setAlign(ig.GUI_ALIGN.X_RIGHT,ig.GUI_ALIGN.Y_TOP);this.numberGui.setPos(22,2);this.addChildGui(this.numberGui);this.maxNumberGui=new sc.NumberGui(99,{size:sc.NUMBER_SIZE.SMALL});this.maxNumberGui.setAlign(ig.GUI_ALIGN.X_RIGHT,ig.GUI_ALIGN.Y_TOP);this.maxNumberGui.setPos(4,2);this.addChildGui(this.maxNumberGui)}});sc.SubTaskEntry.KILL=sc.SubTaskEntryBase.extend({gfx:new ig.Image("media/gui/basic.png"),
numberGui:null,maxNumberGui:null,init:function(b,a,d,c){this.parent(b,a,d,c)},updateDrawables:function(b){this.parent(b);b.addGfx(this.gfx,this.hook.size.x-21,2,73,56,4,8)},onSubTaskChange:function(){var b=this.getState().killed,a=this.subTask.amount,d=this.subTask.enemy;this.done=sc.quests.isQuestSolved(this.quest.id)||sc.quests.isTaskDone(this.quest,this.taskIndex)||b>=a;this.textGui.setText((this.done?"\\i[quest-mini-ok]":"\\i[quest-mini-no]")+sc.combat.getEnemyName(d));this.numberGui.setNumber(this.done?
a:b);this.maxNumberGui.setNumber(a)},createUI:function(){this.numberGui=new sc.NumberGui(99,{size:sc.NUMBER_SIZE.SMALL});this.numberGui.setAlign(ig.GUI_ALIGN.X_RIGHT,ig.GUI_ALIGN.Y_TOP);this.numberGui.setPos(22,2);this.addChildGui(this.numberGui);this.maxNumberGui=new sc.NumberGui(99,{size:sc.NUMBER_SIZE.SMALL});this.maxNumberGui.setAlign(ig.GUI_ALIGN.X_RIGHT,ig.GUI_ALIGN.Y_TOP);this.maxNumberGui.setPos(4,2);this.addChildGui(this.maxNumberGui)}});sc.SubTaskEntry.CONDITION=sc.SubTaskEntryBase.extend({init:function(b,
a,d,c){this.parent(b,a,d,c)},onSubTaskChange:function(){var b=sc.quests.isQuestLabelSolved(this.quest,this.subTask.label);this.done=b;var a="",a=this.hook.size.x<240&&this.subTask.short?this.subTask.short:this.subTask.text;this.textGui.setText((b?"\\i[quest-mini-ok]":"\\i[quest-mini-no]")+a)}});sc.SubTaskEntry.QUEST=sc.SubTaskEntryBase.extend({init:function(b,a,d,c){this.parent(b,a,d,c)},onSubTaskChange:function(){var b=sc.quests.isQuestSolved(this.subTask.quest);this.done=b;var a="",a=this.hook.size.x<
240&&this.subTask.short?this.subTask.short:this.subTask.text;this.textGui.setText((b?"\\i[quest-mini-ok]":"\\i[quest-mini-no]")+a)}});sc.TaskEntry=ig.GuiElementBase.extend({transitions:{DEFAULT:{state:{},time:0.2,timeFunction:KEY_SPLINES.LINEAR},HIDDEN:{state:{alpha:0},time:0.2,timeFunction:KEY_SPLINES.LINEAR}},taskIndex:null,quest:null,taskText:null,taskDoneIcon:null,_subtasks:[],init:function(b,a,d,c){this.parent();this.taskDoneIcon=new sc.TextGui("",{font:sc.fontsystem.smallFont});this.taskText=
new sc.TextGui("",{font:sc.fontsystem.smallFont});this.taskText.setPos(17,0);this.setTask(b,a,d,c);this.doStateTransition("HIDDEN",true)},setTask:function(b,a,d,c,e){this.taskIndex=b!=void 0?b:void 0;this.quest=a||null;this.removeAllChildren();this._subtasks.length=0;if(b!=void 0){var f=this.quest.tasks[this.taskIndex];this.addChildGui(this.taskDoneIcon);this.addChildGui(this.taskText);if(f.subTasks.length!=0){if(e){this.taskText.setMaxWidth(260);for(var g=0,h=0,b=0;b<a.tasks.length;b++)for(var i=
0;i<a.tasks[b].subTasks.length;i++){sc.quests.isSubTaskDone(a,b,i)&&h++;g++}this.taskText.setText(a.name.toString()+" - "+Math.floor(h/g*100)+"%")}else{this.taskText.setMaxWidth(c?240:150);this.taskText.setText(f.task)}g=this.taskText.hook.size.y+1;h=null;f=f.subTasks;i=true;if(f.length==1&&f[0].type=="CONDITION")i=sc.quests.isQuestLabelSolved(a,f[0].label);else if(f.length==1&&f[0].type=="QUEST")i=sc.quests.isQuestSolved(f[0].quest);else for(b=0;b<f.length;b++){h=new sc.SubTaskEntry[f[b].type](a,
this.taskIndex,b);h.setPos(15,g);c&&h.setSize(240,13);h.setSubTask(b,f[b]);h.done||(i=false);d&&h.doStateTransition("HIDDEN",true);if(!e){g=g+14;this.addChildGui(h);this._subtasks.push(h)}}this.taskDoneIcon.setText(i?"\\i[quest-ok]":"\\i[quest-no]");this.setSize(c?260:165,g-13+15)}}},show:function(b,a){for(var d=a||0,c=0;c<this._subtasks.length;c++){this._subtasks[c].doStateTransition("DEFAULT",false,false,null,d);b&&(d=d+0.016)}},_addSubTaskTask:function(){}})});ig.baked=!0;
ig.module("game.feature.gui.hud.quest-hud").requires("game.feature.gui.hud.right-hud","game.feature.menu.gui.quests.quest-entries").defines(function(){var b=/\\c\[\d\]/g;sc.QuestUpdateEntry=ig.GuiElementBase.extend({timer:0,id:null,textGui:null,init:function(a,d){this.parent();this.id=a||null;this.timer=5;var c=d.task.toString().replace(b,""),e=null,e=sc.options.get("quest-show-current")?": \\c[3]"+c+"\\c[0]"+ig.lang.get("sc.gui.quest-hud.taskDone2")+"!":ig.lang.get("sc.gui.quest-hud.nextTask")+": \\c[3]"+
c+"\\c[0]";this.textGui=new sc.TextGui(e,{font:sc.fontsystem.tinyFont,maxWidth:150});this.addChildGui(this.textGui);this.setSize(this.textGui.hook.size.x,this.textGui.hook.size.y)},updateTimer:function(){if(this.timer>0)this.timer=this.timer-ig.system.tick}});sc.QuestUpdateHud=sc.RightHudBoxGui.extend({delayedStack:[],init:function(){this.parent(ig.lang.get("sc.gui.quest-hud.taskUpdated"));sc.Model.addObserver(sc.model,this);sc.Model.addObserver(sc.quests,this)},addEntry:function(a,b){var c=null;
if((c=this._isInEntries(b.id))!=null)c.timer=5;else{c=Math.max(0,a.currentTask-(sc.options.get("quest-show-current")?1:0));c=new sc.QuestUpdateEntry(b.id+c,b.tasks[c]);this.contentEntries.length>=3?this.delayedStack.push(c):this.pushContent(c,!sc.model.isCutscene());this.hidden&&!sc.model.isCutscene()&&this.show()}},_isInEntries:function(a){for(var b=this.contentEntries.length;b--;)if(this.contentEntries[b].subGui.id==a)return this.contentEntries[b].subGui;for(b=this.delayedStack.length;b--;)if(this.delayedStack[b].id==
a)return this.delayedStack[b];return null},_popDelayed:function(){if(this.delayedStack.length!=0){var a=this.delayedStack.splice(0,1)[0];this.pushContent(a,true)}},update:function(){if(!sc.model.isPaused()&&!sc.model.isMenu()&&!this.hidden){for(var a=this.contentEntries.length,b=null;a--;){b=this.contentEntries[a].subGui;b.updateTimer();if(b.timer<=0){b=this.removeContent(a);if(a==0&&this.contentEntries.length==0)b.hook.pivot.y=b.hook.size.y/2;else{b.hook.pivot.y=0;b.hook.anim.timeFunction=KEY_SPLINES.EASE_OUT}this._popDelayed()}}!this.hidden&&
this.contentEntries.length==0&&this.hide()}},modelChanged:function(a,b,c){if(a==sc.model)if(a.isReset()){this.clearContent();this.hide()}else a.isCutscene()||a.isMenu()||a.isHUDBlocked()||sc.quests.hasQuestSolvedDialogs()||a.isForceCombat()?this.hide():!a.isCutscene()&&(!a.isHUDBlocked()&&this.contentEntries.length>0&&!sc.quests.hasQuestSolvedDialogs())&&this.show();else a==sc.quests&&(b==sc.QUEST_MODEL_EVENT.TASK_DONE&&sc.options.get("update-quest-style")==sc.UPDATE_QUEST_STYLE.SMALL&&c&&c.state&&
!c.state.skipPreviousTask())&&this.addEntry(c.state,c.quest)}});sc.FavQuestHud=sc.RightHudBoxGui.extend({task:null,init:function(){this.parent(ig.lang.get("sc.gui.quest-hud.title"));this.task=new sc.TaskEntry;this.task.doStateTransition("DEFAULT",true);this.task.setPos(40,3);this.pushContent(this.task,false);sc.Model.addObserver(sc.model,this);sc.Model.addObserver(sc.quests,this);sc.Model.addObserver(sc.options,this)},setFavQuest:function(a){if(a==-1||sc.quests.isMarkedQuestDone())this.hide();else{a=
sc.options.get("min-quest");this.task.setTask(sc.quests.getCurrentMarkedQuestTaskIndex(),sc.quests.getMarkedQuest(),false,false,a);this.task.hook.align.x=a?ig.GUI_ALIGN.X_LEFT:ig.GUI_ALIGN.X_RIGHT;this.contentEntries[0].setSize(this.task.hook.size.x+4+(a?5:0),this.task.hook.size.y+1);this.rearrangeContent();this._isVisible()&&this.show(false,0)}},_isVisible:function(){return!sc.model.isCutscene()&&!sc.model.isHUDBlocked()&&!sc.model.isForceCombat()&&!sc.quests.hasQuestSolvedDialogs()},modelChanged:function(a,
b,c){if(a==sc.model){if((b==sc.GAME_MODEL_MSG.SUB_STATE_CHANGED||b==sc.GAME_MODEL_MSG.STATE_CHANGED)&&!a.isTeleport()&&!a.isLoading())if(a.isReset()){this.setFavQuest(-1);this.hide()}else!this._isVisible()||a.isMenu()?this.hide():sc.quests.focusQuest!=-1&&!sc.quests.isMarkedQuestDone()&&this.show(false,0.2)}else a==sc.quests?b==sc.QUEST_MODEL_EVENT.FAV_QUEST_CHANGED||b==sc.QUEST_MODEL_EVENT.FINISHED?c!=sc.quests.focusQuest&&this.setFavQuest(sc.quests.focusQuest):(b==sc.QUEST_MODEL_EVENT.UPDATE||b==
sc.QUEST_MODEL_EVENT.TASK_DONE||b==sc.QUEST_MODEL_EVENT.TASK_UNDONE)&&this.setFavQuest(sc.quests.focusQuest):a==sc.options&&b==sc.OPTIONS_EVENT.OPTION_CHANGED&&this.setFavQuest(sc.quests.focusQuest)}})});ig.baked=!0;
ig.module("game.feature.gui.hud.landmark-hud").requires("game.feature.gui.hud.right-hud","game.feature.menu.gui.quests.quest-entries","game.feature.model.options-model").defines(function(){sc.LandmarkEntry=ig.GuiElementBase.extend({timer:0,id:null,textGui:null,init:function(b,a){this.parent();this.id=b||null;this.timer=5;var d=ig.lang.get("sc.gui.landmark-hud.landmark")+" \\c[3]"+sc.map.getLandmarkName(b,a)+"\\c[0] "+ig.lang.get("sc.gui.landmark-hud.unlocked")+"!";this.textGui=new sc.TextGui(d,{font:sc.fontsystem.tinyFont,
maxWidth:180});this.addChildGui(this.textGui);this.setSize(this.textGui.hook.size.x,this.textGui.hook.size.y)},updateTimer:function(){if(this.timer>0)this.timer=this.timer-ig.system.tick}});sc.LandmarkHud=sc.RightHudBoxGui.extend({delayedStack:[],init:function(){this.parent(ig.lang.get("sc.gui.landmark-hud.title"));sc.Model.addObserver(sc.model,this);sc.Model.addObserver(sc.map,this)},addEntry:function(b,a){var d=null;if((d=this._isInEntries(b))!=null)d.timer=5;else{d=new sc.LandmarkEntry(b,a);this.contentEntries.length>=
3?this.delayedStack.push(d):this.pushContent(d,!sc.model.isCutscene());this.hidden&&!sc.model.isCutscene()&&this.show()}},_isInEntries:function(b){for(var a=this.contentEntries.length;a--;)if(this.contentEntries[a].subGui.id==b)return this.contentEntries[a].subGui;for(a=this.delayedStack.length;a--;)if(this.delayedStack[a].id==b)return this.delayedStack[a];return null},_popDelayed:function(){if(this.delayedStack.length!=0){var b=this.delayedStack.splice(0,1)[0];this.pushContent(b,true)}},update:function(){if(!sc.model.isPaused()&&
!sc.model.isMenu()&&!this.hidden){for(var b=this.contentEntries.length,a=null;b--;){a=this.contentEntries[b].subGui;a.updateTimer();if(a.timer<=0){a=this.removeContent(b);if(b==0&&this.contentEntries.length==0)a.hook.pivot.y=a.hook.size.y/2;else{a.hook.pivot.y=0;a.hook.anim.timeFunction=KEY_SPLINES.EASE_OUT}this._popDelayed()}}!this.hidden&&this.contentEntries.length==0&&this.hide()}},modelChanged:function(b,a,d){if(b==sc.model)if(b.isReset()){this.clearContent();this.hide()}else b.isCutscene()||
b.isHUDBlocked()||sc.quests.hasQuestSolvedDialogs()?this.hide():!b.isCutscene()&&(!b.isHUDBlocked()&&this.contentEntries.length>0&&!sc.quests.hasQuestSolvedDialogs())&&this.show();else b==sc.map&&a==sc.MAP_EVENT.LANDMARK_ADDED&&d&&d.landmark&&d.area&&sc.options.get("update-landmark-style")==sc.UPDATE_LANDMARK_STYLE.SMALL&&this.addEntry(d.landmark,d.area)}})});ig.baked=!0;
ig.module("game.feature.menu.lore-model").requires("impact.base.game","game.feature.model.base-model","impact.feature.storage.storage").defines(function(){sc.LORE_CATERGORIES={STORY:0,CHARACTERS:1,CROSS_LORE:2,EARTH_LORE:3};sc.LORE_SORT_TYPE={ORDER:0,NAME:1,UNLOCKED:2};sc.LORE_IMAGE_ALIGN={LEFT:0,CENTER:1,RIGHT:2};var b={lore:null,entry:null,updated:false};sc.LoreModel=ig.GameAddon.extend({observers:[],lories:null,unlockedLories:{},loaded:false,init:function(){this.parent("LoreModel");ig.storage.register(this);
window.wm&&ig.database.register("lore","LoreEnumEditor","Lore");ig.vars.registerVarAccessor("lore",this,"VarLoreEditor");this.lories=ig.database.get("lore")},onReset:function(){this.unlockedLories={};this.loaded=false},onVarAccess:function(a,b){if(b[0]=="lore")switch(b[1]){case "unlock":var c=this._createUnlockText(b[2],b[3]);b[3]?this.unlockLoreEntry(b[2],b[3],true):this.unlockLore(b[2],true);return c;case "title":return this.getLoreTitle(b[2]);case "unlocked":return b[3]?this.isLoreEntryUnlocked(b[2],
b[3]):this.isLoreUnlocked(b[2])}throw Error("Unsupported var access path: "+a);},_createUnlockText:function(a,b){return b?!this.isLoreEntryUnlocked(a,b)?"\\i[loreNew]":"\\i[lore]":!this.isLoreUnlocked(a)?"\\i[loreNew]":"\\i[lore]"},unlockLoreAll:function(){for(var a in this.lories)this.unlockLore(a,false,true)},unlockLore:function(a,d,c,e){e=e==void 0?true:e;if(this.lories[a]){if(!this.unlockedLories[a]||c){this.unlockedLories[a]={};b.entry=null;b.lore=a;b.updated=false;var f=this.lories[a].content,
g;for(g in f){this.unlockedLories[a][g]=true;!c&&e&&sc.stats.addMap("exploration","loreEntry",1)}!c&&e&&sc.menu.addNewUnlock(sc.MENU_SUBMENU.LORE,a);!c&&e&&sc.stats.addMap("exploration","lore",1);!c&&e&&sc.menu.addLog({type:"LORE",lore:a});sc.stats.setMap("exploration","loreTotalRate",this.getTotalLoreFound(true));d&&sc.model.player.hasItem(135)&&sc.Model.notifyObserver(this,sc.LORE_EVENT.UNLOCKED,b);ig.game.varsChangedDeferred()}}else ig.warn("LOCK NOT FOUND: "+a)},unlockLoreEntry:function(a,d,c){if(this.lories[a]){var e=
this.lories[a].content;if(!this.unlockedLories[a]||!this.unlockedLories[a][d]){b.lore=a;b.entry=d;b.updated=false;if(this.unlockedLories[a]){sc.menu.addLog({type:"LORE",lore:a,update:true});b.updated=true}else{this.unlockedLories[a]={};sc.stats.addMap("exploration","lore",1);sc.menu.addLog({type:"LORE",lore:a});b.updated=false}for(var f in e){if(!this.unlockedLories[a][f]){this.unlockedLories[a][f]=true;sc.stats.addMap("exploration","loreEntry",1)}if(f==d)break}sc.menu.addNewUnlock(sc.MENU_SUBMENU.LORE,
a);c&&sc.model.player.hasItem(135)&&sc.Model.notifyObserver(this,sc.LORE_EVENT.UNLOCKED,b);ig.game.varsChangedDeferred()}}else throw Error("No such lore found: "+a);},notifyFirstActivated:function(){sc.Model.notifyObserver(this,sc.LORE_EVENT.ACIVATED)},getLore:function(a){return this.lories[a]},getLoreTitle:function(a){return ig.LangLabel.getText(this.lories[a].title)},getLoreEntry:function(a,b){return this.lories[a]?this.lories[a].content[b]:null},isLoreUnlocked:function(a){if(!this.unlockedLories[a])return false;
var b=this.lories[a].content,c;for(c in b)if(!this.unlockedLories[a][c])return false;return true},hasAtLeastOneUnlocked:function(a){if(!this.unlockedLories[a])return false;var b=this.lories[a].content,c;for(c in b)if(this.unlockedLories[a][c])return true;return false},isLoreAvailable:function(a){return this.unlockedLories[a]?true:false},isLoreEntryUnlocked:function(a,b){return this.unlockedLories[a]&&this.unlockedLories[a][b]},getCategoryList:function(a,b){var c=[],e=null,f;for(f in this.lories){e=
this.lories[f];sc.LORE_CATERGORIES[e.category]==a&&c.push(f)}b!=void 0&&this.sortLoreList(c,b);return c},sortLoreList:function(a,b){switch(b){case sc.LORE_SORT_TYPE.ORDER:a.sort(function(a,b){return(this.lories[a].order||0)-(this.lories[b].order||0)}.bind(this));break;case sc.LORE_SORT_TYPE.NAME:a.sort(function(a,b){var d=ig.LangLabel.getText(this.lories[a].title),g=ig.LangLabel.getText(this.lories[b].title);return d.localeCompare(g)}.bind(this));break;case sc.LORE_SORT_TYPE.UNLOCKED:a.sort(function(a,
b){var d=this.isLoreAvailable(a),g=this.isLoreAvailable(b);return d==g?(this.lories[a].order||0)-(this.lories[b].order||0):d===g?0:d?-1:1}.bind(this))}},getCompletionPercent:function(a){if(!this.unlockedLories[a])return 0;var b=this.lories[a].content,c=0,e=0,f;for(f in b){this.unlockedLories[a][f]&&e++;c++}return!c&&!e?100:c?e/c:0},getTotalLoreFound:function(a,b){var c=0,e=0,f;for(f in this.lories)if(!this.lories[f].noTrack&&!this.lories[f].extension)if(b){if(b==this.lories[f].category){this.hasAtLeastOneUnlocked(f)&&
c++;e++}}else{this.hasAtLeastOneUnlocked(f)&&c++;e++}return a?c/e:c},getTotalLoreEntriesFound:function(a,b){return this.getTotalLoreFound(a,b)},onStorageSave:function(a){a.lories=ig.copy(this.unlockedLories)},onStoragePreLoad:function(a){this.unlockedLories=a.lories||{};for(var b in this.unlockedLories)this.lories[b]||delete this.unlockedLories[b];sc.stats.setMap("exploration","loreTotalRate",this.getTotalLoreFound(true));this.loaded=true}});sc.LORE_EVENT={};sc.LORE_EVENT.UNLOCKED=0;sc.LORE_EVENT.ACIVATED=
1;ig.addGameAddon(function(){return sc.lore=new sc.LoreModel})});ig.baked=!0;
ig.module("game.feature.gui.hud.lore-hud").requires("game.feature.gui.hud.right-hud","game.feature.menu.lore-model").defines(function(){sc.LoreUpdateEntry=ig.GuiElementBase.extend({timer:0,textGui:null,init:function(b){this.parent();this.timer=5;var a="\\c[3]"+sc.lore.getLoreTitle(b.lore)+"\\c[0] ",a=b.updated?a+ig.lang.get("sc.gui.lore-hud.updated"):a+ig.lang.get("sc.gui.lore-hud.unlocked");this.textGui=new sc.TextGui(a,{font:sc.fontsystem.tinyFont});this.addChildGui(this.textGui);this.setSize(this.textGui.hook.size.x,
this.textGui.hook.size.y)},updateTimer:function(){if(this.timer>0)this.timer=this.timer-ig.system.tick}});sc.LoreUpdateHud=sc.RightHudBoxGui.extend({delayedStack:[],init:function(){this.parent(ig.lang.get("sc.gui.lore-hud.title"));sc.Model.addObserver(sc.model,this);sc.Model.addObserver(sc.lore,this)},addEntry:function(b){b=new sc.LoreUpdateEntry(b);this.contentEntries.length>=3?this.delayedStack.push(b):this.pushContent(b,!sc.model.isCutscene());this.hidden&&!sc.model.isCutscene()&&this.show()},
_isInEntries:function(b){for(var a=this.contentEntries.length;a--;)if(this.contentEntries[a].subGui.id==b)return this.contentEntries[a].subGui;for(a=this.delayedStack.length;a--;)if(this.delayedStack[a].id==b)return this.delayedStack[a];return null},_popDelayed:function(){if(this.delayedStack.length!=0){var b=this.delayedStack.splice(0,1)[0];this.pushContent(b,true)}},update:function(){if(!sc.model.isPaused()&&!sc.model.isMenu()&&!this.hidden){for(var b=this.contentEntries.length,a=null;b--;){a=this.contentEntries[b].subGui;
a.updateTimer();if(a.timer<=0){a=this.removeContent(b);if(b==0&&this.contentEntries.length==0)a.hook.pivot.y=a.hook.size.y/2;else{a.hook.pivot.y=0;a.hook.anim.timeFunction=KEY_SPLINES.EASE_OUT}this._popDelayed()}}!this.hidden&&this.contentEntries.length==0&&this.hide()}},modelChanged:function(b,a,d){if(b==sc.model)if(b.isReset()){this.clearContent();this.hide()}else b.isCutscene()||b.isHUDBlocked()||sc.quests.hasQuestSolvedDialogs()?this.hide():!b.isCutscene()&&(!b.isHUDBlocked()&&this.contentEntries.length>
0&&!sc.quests.hasQuestSolvedDialogs())&&this.show();else b==sc.lore&&(a==sc.LORE_EVENT.UNLOCKED&&sc.options.get("update-lore-style")==sc.UPDATE_LORE_STYLE.SMALL&&d)&&this.addEntry(d)}})});ig.baked=!0;
ig.module("game.feature.gui.hud.drop-hud").requires("game.feature.gui.hud.right-hud").defines(function(){sc.DropUpdateEntry=ig.GuiElementBase.extend({timer:0,textGui:null,init:function(b){this.parent();this.timer=5;b="\\c[3]"+sc.menu.getDropName(b)+"\\c[0] ";b=b+ig.lang.get("sc.gui.drop-hud.completed");this.textGui=new sc.TextGui(b,{font:sc.fontsystem.tinyFont});this.addChildGui(this.textGui);this.setSize(this.textGui.hook.size.x,this.textGui.hook.size.y)},updateTimer:function(){if(this.timer>0)this.timer=
this.timer-ig.system.tick}});sc.DropUpdateHud=sc.RightHudBoxGui.extend({delayedStack:[],init:function(){this.parent(ig.lang.get("sc.gui.drop-hud.title"));sc.Model.addObserver(sc.model,this);sc.Model.addObserver(sc.menu,this)},addEntry:function(b){b=new sc.DropUpdateEntry(b);this.contentEntries.length>=3?this.delayedStack.push(b):this.pushContent(b,!sc.model.isCutscene());this.hidden&&!sc.model.isCutscene()&&this.show()},_isInEntries:function(b){for(var a=this.contentEntries.length;a--;)if(this.contentEntries[a].subGui.id==
b)return this.contentEntries[a].subGui;for(a=this.delayedStack.length;a--;)if(this.delayedStack[a].id==b)return this.delayedStack[a];return null},_popDelayed:function(){if(this.delayedStack.length!=0){var b=this.delayedStack.splice(0,1)[0];this.pushContent(b,true)}},update:function(){if(!sc.model.isPaused()&&!sc.model.isMenu()&&!this.hidden){for(var b=this.contentEntries.length,a=null;b--;){a=this.contentEntries[b].subGui;a.updateTimer();if(a.timer<=0){a=this.removeContent(b);if(b==0&&this.contentEntries.length==
0)a.hook.pivot.y=a.hook.size.y/2;else{a.hook.pivot.y=0;a.hook.anim.timeFunction=KEY_SPLINES.EASE_OUT}this._popDelayed()}}!this.hidden&&this.contentEntries.length==0&&this.hide()}},modelChanged:function(b,a,d){if(b==sc.model)if(b.isReset()){this.clearContent();this.hide()}else b.isCutscene()||b.isHUDBlocked()||sc.quests.hasQuestSolvedDialogs()?this.hide():!b.isCutscene()&&(!b.isHUDBlocked()&&this.contentEntries.length>0&&!sc.quests.hasQuestSolvedDialogs())&&this.show();else b==sc.menu&&(sc.model.player.getCore("MENU_BOTANICS")?
a==sc.MENU_EVENT.DROP_COMPLETED&&sc.options.get("update-drop-style")==sc.UPDATE_DROP_STYLE.SMALL&&d&&this.addEntry(d):this.hide())}})});ig.baked=!0;
ig.module("game.feature.gui.hud.member-hud").requires("impact.feature.gui.gui","impact.feature.gui.base.box").defines(function(){var b={};sc.PartyHudGui=ig.GuiElementBase.extend({model:null,memberGuis:[],transitions:{DEFAULT:{state:{},time:0.2,timeFunction:KEY_SPLINES.EASE_OUT},HIDDEN:{state:{alpha:0,offsetX:-32},time:0.2,timeFunction:KEY_SPLINES.EASE_IN}},init:function(){this.parent();sc.Model.addObserver(sc.party,this);sc.Model.addObserver(sc.model,this);this.updatePartySubGui()},modelChanged:function(a,
b){a==sc.party?b==sc.PARTY_MSG.PARTY_CHANGED?this.updatePartySubGui():b==sc.PARTY_MSG.DUNGEON_BLOCK_CHANGED&&this.updateVisibility():a==sc.model&&this.updateVisibility()},updateVisibility:function(){var a=!sc.model.isLevelUp()&&!sc.party.isDungeonBlocked();this.doStateTransition(a?"DEFAULT":"HIDDEN")},updatePartySubGui:function(){for(var a=this.memberGuis.length;a--;)this.memberGuis[a].remove(!this.hook._visible);this.memberGuis.length=0;for(var b=sc.party.getPartySize(),c=0,a=0;a<b;++a){var e=sc.party.getPartyMemberModelByIndex(a),
e=new sc.MemberHudGui(e);e.setPos(0,c);this.addChildGui(e);this.memberGuis.push(e);c=c+26}}});sc.MemberHudGui=ig.GuiElementBase.extend({gfx:new ig.Image("media/gui/status-gui.png"),heads:new ig.TileSheet("media/gui/severed-heads.png",24,24),transitions:{DEFAULT:{state:{},time:0.2,timeFunction:KEY_SPLINES.EASE_OUT},HIDDEN:{state:{alpha:0,offsetX:-32},time:0.2,timeFunction:KEY_SPLINES.EASE_IN}},model:null,hpExpSpGui:null,init:function(a){this.parent();this.setSize(25,25);this.setPivot(12,12);this.model=
a;this.hpExpSpGui=new sc.MemberHpExpSpGui(this.model);this.hpExpSpGui.setPos(16,2);this.addChildGui(this.hpExpSpGui);this.doStateTransition("HIDDEN",true);this.doStateTransition("DEFAULT")},update:function(){},updateDrawables:function(a){a.addGfx(this.gfx,0,0,231,175,this.hook.size.x,this.hook.size.y);this.heads.getTileSrc(b,this.model.getHeadIdx());a.addGfx(this.heads.image,0,-2,b.x,b.y,24,24,true)},modelChanged:function(){},remove:function(a){this.doStateTransition("HIDDEN",a,true)}});sc.MemberHpExpSpGui=
ig.GuiElementBase.extend({gfx:new ig.Image("media/gui/status-gui.png"),model:null,hpBar:null,spBar:null,init:function(a){this.parent();this.setSize(39,10);this.model=a;sc.Model.addObserver(this.model,this);this.hpBar=new sc.HpHudBarGui(a.params,26,2);this.hpBar.setPos(7,5);this.addChildGui(this.hpBar);this.hpBar.setExpRatio(this.model.exp/sc.EXP_PER_LEVEL);this.spBar=new sc.SpMiniHudGui(a.params);this.spBar.setPos(6,1);this.addChildGui(this.spBar)},onDetach:function(){sc.Model.removeObserver(this.model,
this)},updateDrawables:function(a){a.addGfx(this.gfx,0,0,64,160,this.hook.size.x,this.hook.size.y);this.model.temporary&&a.addGfx(this.gfx,0,this.hook.size.y,64,160+this.hook.size.y,this.hook.size.x,8)},modelChanged:function(a,b){b==sc.PARTY_MEMBER_MSG.EXP_CHANGE&&this.hpBar.setExpRatio(this.model.exp/sc.EXP_PER_LEVEL)}})});ig.baked=!0;
ig.module("game.feature.gui.hud.sp-change-hud").requires("impact.feature.gui.gui","game.feature.combat.model.combat-params","game.feature.model.options-model").defines(function(){var b=Vec2.createC(0,0),a={w:10,x:4,start:2,end:2},d={w:18,x:14,start:2,end:0};sc.SpChangeHudGui=ig.GuiElementBase.extend({transitions:{DEFAULT:{state:{},time:0.2,timeFunction:KEY_SPLINES.EASE_OUT},BIG:{state:{scaleY:2,scaleX:2},time:0.1,timeFunction:KEY_SPLINES.EASE_IN},HIDDEN:{state:{scaleY:0,scaleX:1.5},time:0.1,timeFunction:KEY_SPLINES.EASE_IN}},
gfx:new ig.Image("media/gui/status-gui.png"),currentSp:0,consumedSp:0,timer:0,init:function(){this.parent();this.setSize(100,7);this.setPivot(50,3.5);this.zIndex=10;this.doStateTransition("HIDDEN",true);sc.Model.addObserver(sc.model.player.params,this)},modelChanged:function(a,b,d){if(sc.model.isCutscene())this.hide();else if(sc.model.player.getCore(sc.PLAYER_CORE.SPECIAL)&&!ig.vars.get("playerVar.statusHidden")&&sc.options.get("sp-bar"))if(b==sc.COMBAT_PARAM_MSG.SP_CHANGED){a=sc.model.player.params.getSp();
if(d&&this.currentSp<a){this.timer=1;this._updatePos(true);this.doStateTransition("BIG",true);this.doStateTransition("DEFAULT")}this.currentSp=a}else if(b==sc.COMBAT_PARAM_MSG.SP_CONSUME)if(this.consumedSp=d){this.timer=-1;this._updatePos(true);this.doStateTransition("BIG",true);this.doStateTransition("DEFAULT")}else{this.timer=0;this.hide()}},hide:function(){this.doStateTransition("HIDDEN")},update:function(){if(this.timer>0){this.timer=this.timer-ig.system.actualTick;if(this.timer<=0){this.timer=
0;this.hide()}}this._updatePos(true)},updateDrawables:function(b){var e=sc.model.player.params,f=e.maxSp,e=e.getSp(),g=e-this.consumedSp,h=this.hook,f=Math.max(4,Math.ceil(e/4)*4),i=8+d.w;f>4&&(i=i+(Math.floor(f/4)-1)*a.w);i=Math.floor((h.size.x-i)/2);h=h.size.y;b.addGfx(this.gfx,i,0,152,128,4,h);for(var i=i+4,j=0;j<f;){var k=j<e&&e-j<=4;j==0&&e==0&&(k=true);var k=k?d:a,l=((g-j)/4).limit(0,1),o=((e-j)/4).limit(0,1),m=k.w-k.start-k.end,l=Math.floor(l*m),o=Math.floor(o*m)-l,m=m-l-o;l?l=l+k.start:o?
o=o+k.start:m=m+k.start;m?m=m+k.end:o?o=o+k.end:l=l+k.end;var n=0;if(l){b.addGfx(this.gfx,i,0,152+k.x+n,128,l,h);i=i+l;n=n+l}if(o){b.addGfx(this.gfx,i,0,152+k.x+n,136,o,h);i=i+o;n=n+o}if(m){b.addGfx(this.gfx,i,0,152+k.x+n,144,m,h);i=i+m}j=j+4}b.addGfx(this.gfx,i,0,184,128,4,h)},_updatePos:function(){var a=ig.game.playerEntity;if(a){var d=this.hook,f=a.getCenter(b);ig.system.getScreenFromMapPos(b,Math.round(f.x),Math.round(f.y-a.coll.pos.z+a.coll.size.y/2));this.hook.pos.x=b.x-d.size.x/2;this.hook.pos.y=
b.y-d.size.y/2}}})});ig.baked=!0;
ig.module("game.feature.gui.hud.sp-mini-hud").requires("impact.feature.gui.gui","game.feature.gui.base.numbers").defines(function(){sc.SpMiniHudGui=ig.GuiElementBase.extend({transitions:{DEFAULT:{state:{},time:0.1,timeFunction:KEY_SPLINES.LINEAR},HIDDEN:{state:{scaleY:0},time:0.1,timeFunction:KEY_SPLINES.LINEAR}},gfx:new ig.Image("media/gui/status-gui.png"),params:null,targetSp:0,init:function(b){this.parent();this.setSize(22,3);this.params=b;sc.Model.addObserver(b,this)},onDetach:function(){sc.Model.removeObserver(this.params,
this)},update:function(){this.targetSp=this.params.currentSp},updateDrawables:function(b){for(var a=this.params.maxSp,d=Math.floor(this.targetSp),c=a>8,e=0,f,g=0;g<a;g=g+4)if(c&&g+4<d){b.addGfx(this.gfx,e,0,104,164,4,3);e=e+5}else if(c&&g>=d){b.addGfx(this.gfx,e,0,104,160,4,3);e=e+5}else{var h=(d-g).limit(0,4);if(h){f=h*2;b.addGfx(this.gfx,e,0,108,164,f,3);e=e+f}if(h<4){f=(4-h)*2;b.addGfx(this.gfx,e,0,108,160,f,3);e=e+f}c||(e=e+1)}},modelChanged:function(b,a){if(a==sc.COMBAT_PARAM_MSG.MAX_SP_CHANGED&&
sc.model.player.params.maxSp==0)this.targetSp=0}})});ig.baked=!0;
ig.module("game.feature.gui.hud.top-msg-hud").requires("impact.feature.gui.gui","impact.feature.gui.base.basic-gui","impact.feature.gui.base.box","game.feature.model.options-model").defines(function(){var b={icon:0,bgm:"landmark"},a={icon:1,sound:new ig.Sound("media/sound/hud/quest-task-solved.ogg",0.5)},d={icon:2},c={icon:3},e={icon:4};sc.TopMsgHudGui=ig.GuiElementBase.extend({topGui:null,bottomGui:null,iconGui:null,visible:false,timer:0,maxTime:0,current:null,messages:[],bgm:{},init:function(){this.parent();
this.hook.zIndex=51;this.hook.pauseGui=true;this.setAlign(ig.GUI_ALIGN.X_CENTER,ig.GUI_ALIGN.Y_TOP);this.topGui=new sc.TopMsgTopGui;this.topGui.setAlign(ig.GUI_ALIGN.X_CENTER,ig.GUI_ALIGN.Y_TOP);this.addChildGui(this.topGui);this.bottomGui=new sc.TopMsgTitleGui;this.bottomGui.setAlign(ig.GUI_ALIGN.X_CENTER,ig.GUI_ALIGN.Y_TOP);this.bottomGui.setPos(0,14);this.addChildGui(this.bottomGui);this.iconGui=new sc.TopMsgIconGui;this.iconGui.setAlign(ig.GUI_ALIGN.X_CENTER,ig.GUI_ALIGN.Y_TOP);this.iconGui.setPos(0,
0);this.addChildGui(this.iconGui);this.bgm.landmark=ig.bgm.loadTrack("landmark");this.animationEndBinded=this.animationEnd.bind(this);sc.Model.addObserver(sc.model,this);sc.Model.addObserver(sc.map,this);sc.Model.addObserver(sc.quests,this);sc.Model.addObserver(sc.lore,this);sc.Model.addObserver(sc.menu,this);sc.Model.addObserver(sc.trophies,this);this.setSize(222,64)},setContent:function(a,b,c,d){this.bottomGui.setContent(b,c,d);this.iconGui.setIcon(a.icon);a.sound&&a.sound.play();a.bgm&&ig.bgm.inbetween(this.bgm[a.bgm],
1,"FAST")},showMessage:function(a,b,c,d,e){this.messages.push({icon:a,titleText:b,subText:c,subFontSize:d,id:e||null});this.visible?this.maxTime=3:this.popMessage()},popMessage:function(){var a=this.messages.pop();this.setContent(a.icon,a.titleText,a.subText,a.subFontSize);this.visible=true;this.topGui.doStateTransition("DEFAULT");this.iconGui.doStateTransition("DEFAULT");this.bottomGui.doStateTransition("DEFAULT",false,false,this.animationEndBinded);this.timer=0;this.maxTime=this.messages.length>
0?3:4;this.current=a},update:function(){if(!ig.game.paused&&this.maxTime>0){this.timer=this.timer+ig.system.actualTick;this.timer>=this.maxTime&&this.hide()}},clear:function(){this.messages.length=0;this.current=null;this.hide()},hide:function(){this.maxTimer=0;this.iconGui.doStateTransition("HIDDEN");if(this.messages.length>0)this.bottomGui.hide(this.animationEndBinded);else{this.current=null;this.visible=false;this.bottomGui.hide();this.topGui.doStateTransition("HIDDEN")}},animationEnd:function(){this.bottomGui.hook.currentStateName==
"DEFAULT"?this.bottomGui.showSubText():this.bottomGui.hook.currentStateName=="HIDDEN"&&this.messages.length>0&&this.popMessage()},checkDuplicates:function(a){if(this.current&&this.current.id==a)return true;for(var b=this.messages.length;b--;)if(this.messages.id==a)return true;return false},modelChanged:function(f,g,h){if(f==sc.model)g==sc.GAME_MODEL_MSG.SUB_STATE_CHANGED?f.isReset()&&this.clear():g==sc.GAME_MODEL_MSG.CLEAR_TOP_MESSAGE&&this.clear();else if(f==sc.map)g==sc.MAP_EVENT.LANDMARK_ADDED&&
h&&h.landmark&&h.area&&sc.options.get("update-landmark-style")==sc.UPDATE_LANDMARK_STYLE.LARGE&&this.showMessage(b,ig.lang.get("sc.gui.landmark-hud.title-new"),sc.map.getLandmarkName(h.landmark,h.area),sc.fontsystem.font);else if(f==sc.quests){if(g==sc.QUEST_MODEL_EVENT.TASK_DONE&&h&&h.state&&!h.state.skipPreviousTask()&&sc.options.get("update-quest-style")==sc.UPDATE_QUEST_STYLE.LARGE&&!this.checkDuplicates(h.quest.id)){f=sc.options.get("quest-show-current");g=Math.max(0,h.state.currentTask-(f?1:
0));g=h.quest.tasks[g];this.showMessage(a,ig.lang.get("sc.gui.quest-hud."+(f?"taskDoneCurrent":"taskDoneCenter")),g.task.toString(),sc.fontsystem.smallFont,h.quest.id)}}else if(f==sc.lore)if(g==sc.LORE_EVENT.UNLOCKED){if(h&&sc.options.get("update-lore-style")==sc.UPDATE_LORE_STYLE.LARGE){f="\\c[3]"+sc.lore.getLoreTitle(h.lore)+"\\c[0] ";f=f+(h.updated?ig.lang.get("sc.gui.lore-hud.updated"):ig.lang.get("sc.gui.lore-hud.unlocked"));this.showMessage(d,ig.lang.get("sc.gui.lore-hud.top-title"),f,sc.fontsystem.font)}}else g==
sc.LORE_EVENT.ACIVATED&&this.showMessage(d,ig.lang.get("sc.gui.lore-hud.top-first-title"),ig.lang.get("sc.gui.lore-hud.top-first"),sc.fontsystem.font);else if(f==sc.menu){if(g==sc.MENU_EVENT.DROP_COMPLETED&&h&&sc.options.get("update-drop-style")==sc.UPDATE_LORE_STYLE.LARGE){f="\\c[3]"+sc.menu.getDropName(h)+"\\c[0] ";f=f+ig.lang.get("sc.gui.drop-hud.completed");this.showMessage(c,ig.lang.get("sc.gui.drop-hud.title"),f,sc.fontsystem.smallFont)}}else if(f==sc.trophies&&(g==sc.TROPHY_EVENTS.TRIGGERED&&
h)&&sc.options.get("update-trophy-style")==sc.UPDATE_TROPHY_STYLE.LARGE){f=ig.lang.get("sc.gui.feats.unlocked")+" \\c[3]"+new ig.LangLabel(sc.trophies.getTrophyName(h))+"\\c[0]";this.showMessage(e,ig.lang.get("sc.gui.feats.hud-title"),f,sc.fontsystem.smallFont)}}});sc.TopMsgIconGui=ig.GuiElementBase.extend({transitions:{DEFAULT:{state:{},time:0.2,timeFunction:KEY_SPLINES.EASE_OUT},HIDDEN:{state:{alpha:0,scaleX:0,scaleY:0},time:0.2,timeFunction:KEY_SPLINES.EASE_IN}},gfx:new ig.Image("media/gui/message.png"),
icon:0,init:function(){this.parent();this.setSize(24,24);this.setPivot(12,12);this.doStateTransition("HIDDEN",true)},setIcon:function(a){this.icon=a},updateDrawables:function(a){a.addGfx(this.gfx,0,0,96+this.icon*24,128,24,24,false,false)}});sc.TopMsgTopGui=ig.ImageGui.extend({transitions:{DEFAULT:{state:{alpha:0},time:0.2,timeFunction:KEY_SPLINES.EASE_OUT},HIDDEN:{state:{alpha:0,scaleX:0,scaleY:0},time:0.2,timeFunction:KEY_SPLINES.EASE_IN}},gfx:new ig.Image("media/gui/message.png"),init:function(){this.parent(this.gfx,
48,148,32,12);this.setPivot(this.hook.size.x/2,0);this.doStateTransition("HIDDEN",true)}});sc.TopMsgTitleGui=ig.GuiElementBase.extend({transitions:{DEFAULT:{state:{},time:0.2,timeFunction:KEY_SPLINES.EASE_OUT},HIDDEN:{state:{alpha:0,scaleX:0,scaleY:0},time:0.2,timeFunction:KEY_SPLINES.EASE_IN}},titleTextGui:null,subTextGui:null,gfx:new ig.Image("media/gui/message.png"),ninePatches:{left:new ig.NinePatch("media/gui/message.png",{width:4,height:0,left:12,top:4,right:0,bottom:0,offsets:{"default":{x:0,
y:144}}}),leftInner:new ig.NinePatch("media/gui/message.png",{width:8,height:0,left:8,top:11,right:0,bottom:0,offsets:{"default":{x:16,y:136}}}),rightInner:new ig.NinePatch("media/gui/message.png",{width:8,height:0,left:0,top:11,right:8,bottom:0,offsets:{"default":{x:64,y:136}}}),right:new ig.NinePatch("media/gui/message.png",{width:4,height:0,left:0,top:4,right:12,bottom:0,offsets:{"default":{x:80,y:144}}})},init:function(){this.parent();this.titleTextGui=new sc.TextGui("",{font:sc.fontsystem.tinyFont});
this.titleTextGui.setAlign(ig.GUI_ALIGN.X_CENTER,ig.GUI_ALIGN.Y_TOP);this.titleTextGui.setPos(0,8);this.addChildGui(this.titleTextGui);this.subTextGui=new sc.TopMsgSubGui;this.subTextGui.setAlign(ig.GUI_ALIGN.X_CENTER,ig.GUI_ALIGN.Y_TOP);this.subTextGui.setPos(0,17);this.addChildGui(this.subTextGui);this.setSize(222,22);this.setPivot(111,9);this.doStateTransition("HIDDEN",true)},setContent:function(a,b,c){this.titleTextGui.setText(a);this.subTextGui.setContent(b,c)},showSubText:function(){this.subTextGui.doStateTransition("DEFAULT")},
hide:function(a){this.doStateTransition("HIDDEN",false,false,a);this.subTextGui.doStateTransition("HIDDEN")},updateDrawables:function(a){var b=this.hook.size.x,c=Math.max(64,this.titleTextGui.hook.size.x+20),c=Math.ceil(c/2)*2,b=(b-c)/2,c=(c-32)/2,d=0;this.ninePatches.left.draw(a,b,8,"default",d,14);d=d+b;this.ninePatches.leftInner.draw(a,c,11,"default",d,6);d=d+c;a.addGfx(this.gfx,d,0,32,130,32,17,false,false);d=d+32;this.ninePatches.rightInner.draw(a,c,11,"default",d,6);this.ninePatches.right.draw(a,
b,8,"default",d+c,14)}});sc.TopMsgSubGui=ig.BoxGui.extend({transitions:{DEFAULT:{state:{},time:0.2,timeFunction:KEY_SPLINES.EASE_OUT},HIDDEN:{state:{alpha:0,scaleY:0},time:0.1,timeFunction:KEY_SPLINES.LINEAR}},ninepatch:new ig.NinePatch("media/gui/message.png",{width:24,height:4,left:8,top:5,right:8,bottom:3,offsets:{"default":{x:8,y:148}}}),init:function(){this.parent();this.hook.localAlpha=0.7;this.subTextGui=new sc.TextGui("",{maxWidth:206,textAlign:ig.Font.ALIGN.CENTER,bestRatio:8});this.subTextGui.setAlign(ig.GUI_ALIGN.X_CENTER,
ig.GUI_ALIGN.Y_CENTER);this.subTextGui.setPos(0,0);this.addChildGui(this.subTextGui);this.setPivot(109,0);this.doStateTransition("HIDDEN",true)},setContent:function(a,b){this.subTextGui.setFont(b);this.subTextGui.setText(a);this.setSize(218,this.subTextGui.hook.size.y);this.setPivot(109,0)}})});ig.baked=!0;
ig.module("game.feature.gui.hud.feat-hud").requires("impact.feature.gui.gui","impact.feature.gui.base.basic-gui","impact.base.image","impact.base.lang","game.feature.gui.hud.right-hud","game.feature.achievements.achievements").defines(function(){sc.FeatHudEntry=ig.GuiElementBase.extend({timer:0,feat:null,textGui:null,init:function(b){this.parent();this.feat=b||null;this.timer=3;b=ig.lang.get("sc.gui.feats.unlocked")+" \\c[3]"+new ig.LangLabel(sc.trophies.getTrophyName(b))+"\\c[0]";this.textGui=new sc.TextGui(b,
{font:sc.fontsystem.tinyFont});this.addChildGui(this.textGui);this.setSize(this.textGui.hook.size.x,this.textGui.hook.size.y)},updateTimer:function(){if(this.timer>0)this.timer=this.timer-ig.system.tick}});sc.FeatHud=sc.RightHudBoxGui.extend({delayedStack:[],init:function(){this.parent(ig.lang.get("sc.gui.feats.hud-title"));sc.Model.addObserver(sc.trophies,this);sc.Model.addObserver(sc.model,this)},addEntry:function(b){b=new sc.FeatHudEntry(b);this.contentEntries.length>=3?this.delayedStack.push(b):
this.pushContent(b,!sc.model.isCutscene());this.hidden&&!sc.model.isCutscene()&&this.show()},update:function(){if(!sc.model.isPaused()&&!sc.model.isMenu()&&!this.hidden){for(var b=this.contentEntries.length,a=null;b--;){a=this.contentEntries[b].subGui;a.updateTimer();if(a.timer<=0){a=this.removeContent(b);if(b==0&&this.contentEntries.length==0)a.hook.pivot.y=a.hook.size.y/2;else{a.hook.pivot.y=0;a.hook.anim.timeFunction=KEY_SPLINES.EASE_OUT}this._popDelayed()}}!this.hidden&&this.contentEntries.length==
0&&this.hide()}},_isInEntries:function(b){for(var a=this.contentEntries.length;a--;)if(this.contentEntries[a].subGui.feat==b)return this.contentEntries[a].subGui;for(a=this.delayedStack.length;a--;)if(this.delayedStack[a].feat==b)return this.delayedStack[a];return null},_popDelayed:function(){if(this.delayedStack.length!=0){var b=this.delayedStack.splice(0,1)[0];this.pushContent(b,true)}},modelChanged:function(b,a,d){if(b==sc.model)if(b.isReset()){this.clearContent();this.hide()}else b.isCutscene()||
b.isHUDBlocked()||sc.quests.hasQuestSolvedDialogs()?this.hide():!b.isCutscene()&&(!b.isHUDBlocked()&&this.contentEntries.length>0&&!sc.quests.hasQuestSolvedDialogs())&&this.show();else b==sc.trophies&&a==sc.TROPHY_EVENTS.TRIGGERED&&sc.options.get("update-trophy-style")==sc.UPDATE_TROPHY_STYLE.SMALL&&this.addEntry(d)}})});ig.baked=!0;
ig.module("game.feature.gui.screen.loading-screen").requires("impact.feature.gui.gui","impact.base.image").defines(function(){sc.LoadingScreenGui=ig.GuiElementBase.extend({gfx:new ig.Image("media/gui/loading.png"),timer:0,transitions:{DEFAULT:{state:{},time:0.3,timeFunction:KEY_SPLINES.LINEAR},HIDDEN:{state:{alpha:0},time:0.3,timeFunction:KEY_SPLINES.LINEAR}},textBlock:null,init:function(){this.parent();this.hook.zIndex=2E3;this.hook.pauseGui=true;this.hook.size.x=ig.system.width;this.hook.size.y=
ig.system.height;this.textBlock=new ig.TextBlock(sc.fontsystem.font,"",{});sc.Model.addObserver(sc.model,this);this.doStateTransition("HIDDEN",true)},update:function(){ig.game.hasTeleportMessageShown&&this.doStateTransition("HIDDEN")},updateDrawables:function(b){this.timer=this.timer+ig.system.actualTick;b.addGfxTile(this.gfx,ig.system.width-56,ig.system.height-56,Math.floor(this.timer/0.05)%16,48);if(window.IG_GAME_DEBUG)if(ig.game.currentLoadingResource instanceof ig.game.mapLoader||ig.game.currentLoadingResource instanceof
ig.Loader){this.textBlock.setText("LOADING: "+ig.game.currentLoadingResource.lastPath);b.addText(this.textBlock,5,5)}else if(ig.game.currentLoadingResource!=""){this.textBlock.setText(ig.game.currentLoadingResource);b.addText(this.textBlock,5,5)}},modelChanged:function(b,a){if(a==sc.GAME_MODEL_MSG.SUB_STATE_CHANGED){var d=b.isLoading();this.doStateTransition(d?"DEFAULT":"HIDDEN")}}})});ig.baked=!0;
ig.module("game.feature.gui.screen.intro-screen").requires("impact.feature.gui.gui","impact.feature.gui.base.basic-gui","game.feature.gui.base.button","impact.base.image").defines(function(){ig.GUI.IntroScreen=ig.SequenceGui.extend({gfx:{rfgLogo:new ig.Image("media/gui/rfg-fish.png"),rfgText:new ig.Image("media/gui/rfg-text.png"),techBG:new ig.Image("media/gui/tech-intro-bg.png"),html5Logo:new ig.Image("media/gui/html5-logo.png"),impactLogo:new ig.Image("media/gui/impact-logo.png")},gui:{baseBG:{color:"black",
transitions:{DEFAULT:{state:{},time:0,timeFunction:KEY_SPLINES.LINEAR},HIDDEN:{state:{alpha:0},time:0,timeFunction:KEY_SPLINES.LINEAR}}},rfgLogo:{gfx:"rfgLogo",pos:{x:0,y:-32},align:{x:ig.GUI_ALIGN.X_CENTER,y:ig.GUI_ALIGN.Y_CENTER},transitions:{DEFAULT:{state:{},time:0.3,timeFunction:KEY_SPLINES.EASE_OUT},HIDDEN:{state:{alpha:0,offsetY:-16},time:0.3,timeFunction:KEY_SPLINES.EASE_IN}}},rfgText:{gfx:"rfgText",pos:{x:0,y:32},align:{x:ig.GUI_ALIGN.X_CENTER,y:ig.GUI_ALIGN.Y_CENTER},transitions:{DEFAULT:{state:{},
time:0.3,timeFunction:KEY_SPLINES.LINEAR},HIDDEN:{state:{alpha:0,scaleY:0},time:0.3,timeFunction:KEY_SPLINES.LINEAR}}},whiteBG:{color:"white",transitions:{DEFAULT:{state:{},time:0.3,timeFunction:KEY_SPLINES.LINEAR},HIDDEN:{state:{alpha:0},time:0.3,timeFunction:KEY_SPLINES.LINEAR}}},techBG:{gfx:"techBG",pos:{x:0,y:0},align:{x:ig.GUI_ALIGN.X_LEFT,y:ig.GUI_ALIGN.Y_TOP},transitions:{DEFAULT:{state:{},time:0.6,timeFunction:KEY_SPLINES.LINEAR},HIDDEN:{state:{alpha:0,offsetY:64,scaleY:2},time:0.3,timeFunction:KEY_SPLINES.LINEAR}}},
html5Logo:{gfx:"html5Logo",pos:{x:0,y:14},align:{x:ig.GUI_ALIGN.X_CENTER,y:ig.GUI_ALIGN.Y_TOP},transitions:{DEFAULT:{state:{},time:0.3,timeFunction:KEY_SPLINES.EASE_OUT},HIDDEN:{state:{alpha:0,offsetY:-16},time:0.3,timeFunction:KEY_SPLINES.LINEAR}}},impactLogo:{gfx:"impactLogo",pos:{x:0,y:25},align:{x:ig.GUI_ALIGN.X_CENTER,y:ig.GUI_ALIGN.Y_BOTTOM},transitions:{DEFAULT:{state:{},time:0.3,timeFunction:KEY_SPLINES.EASE_OUT},HIDDEN:{state:{alpha:0,offsetY:-16},time:0.1,timeFunction:KEY_SPLINES.LINEAR}}},
blackBG:{color:"black",transitions:{DEFAULT:{state:{},time:0.5,timeFunction:KEY_SPLINES.LINEAR},HIDDEN:{state:{alpha:0},time:0.5,timeFunction:KEY_SPLINES.LINEAR}}}},timeLine:[{time:0,gui:"baseBG",state:"DEFAULT"},{time:0,gui:"rfgLogo",state:"DEFAULT",sound:new ig.Sound("media/sound/menu/radicalfish-bubbles.ogg",1)},{time:0.3,gui:"rfgText",state:"DEFAULT"},{time:2,gui:"whiteBG",state:"DEFAULT"},{time:2.5,gui:"html5Logo",state:"DEFAULT"},{time:2.7,gui:"techBG",state:"DEFAULT"},{time:2.9,gui:"impactLogo",
state:"DEFAULT"},{time:4.5,gui:"blackBG",state:"DEFAULT"},{time:5,end:true}],transitions:{DEFAULT:{state:{},time:0,timeFunction:KEY_SPLINES.LINEAR},HIDDEN:{state:{alpha:0},time:0,timeFunction:KEY_SPLINES.LINEAR}},screenInteract:null,init:function(b){this.parent(b);this.hook.setMouseRecord(true);this.hook.zIndex=1E3;this.hook.size.x=ig.system.width;this.hook.size.y=ig.system.height;this.doStateTransition("HIDDEN",true);this.screenInteract=new sc.ScreenInteractEntry(this)},onInteraction:function(){if(this.timer<
2)this.timer=2;else if(this.timer<4.5)this.timer=4.5},updateDrawables:function(b){b.addColor("black",ig.system.contextWidth,ig.system.contextHeight)},start:function(){this.parent();this.doStateTransition("HIDDEN",true);this.doStateTransition("DEFAULT");ig.interact.addEntry(this.screenInteract)},end:function(){this.parent();this.doStateTransition("HIDDEN");ig.interact.removeEntry(this.screenInteract)}})});ig.baked=!0;
ig.module("game.feature.gui.screen.title-logo").requires("impact.feature.gui.gui","impact.feature.gui.base.basic-gui","game.feature.gui.base.button","impact.base.image").defines(function(){ig.GUI.TitleLogo=ig.SequenceGui.extend({gfx:{logo:new ig.Image("media/gui/title-logo.png")},gui:{logoBG:{gfx:"logo",src:{x:0,y:128,w:192,h:64},pos:{x:0,y:0},align:{x:ig.GUI_ALIGN.X_LEFT,y:ig.GUI_ALIGN.Y_TOP},transitions:{DEFAULT:{state:{},time:0.5,timeFunction:KEY_SPLINES.EASE_OUT},HIDDEN:{state:{alpha:0,scaleX:1.3,
scaleY:1.3},time:0.3,timeFunction:KEY_SPLINES.EASE_IN}}},logoC1:{gfx:"logo",src:{x:0,y:0,w:48,h:64},pos:{x:0,y:0},align:{x:ig.GUI_ALIGN.X_LEFT,y:ig.GUI_ALIGN.Y_TOP},transitions:{HIDDEN:{state:{alpha:0,offsetX:64},time:0.3,timeFunction:KEY_SPLINES.EASE_IN},STATE1:{state:{offsetX:64},time:0.2,timeFunction:KEY_SPLINES.EASE_IN},STATE2:{state:{},time:0.5,timeFunction:KEY_SPLINES.EASE_IN_OUT}}},logoC2:{gfx:"logo",src:{x:0,y:64,w:48,h:64},pos:{x:136,y:0},align:{x:ig.GUI_ALIGN.X_LEFT,y:ig.GUI_ALIGN.Y_TOP},
transitions:{HIDDEN:{state:{alpha:0,offsetX:-72},time:0.3,timeFunction:KEY_SPLINES.EASE_IN},STATE1:{state:{offsetX:-72},time:0.2,timeFunction:KEY_SPLINES.EASE_IN},STATE2:{state:{},time:0.5,timeFunction:KEY_SPLINES.EASE_IN_OUT}}},logoRoss:{gfx:"logo",src:{x:48,y:0,w:112,h:64},pos:{x:31,y:0},align:{x:ig.GUI_ALIGN.X_LEFT,y:ig.GUI_ALIGN.Y_TOP},transitions:{DEFAULT:{state:{},time:0.3,timeFunction:KEY_SPLINES.EASE_OUT},HIDDEN:{state:{alpha:0,scaleY:0},time:0.3,timeFunction:KEY_SPLINES.EASE_IN}}},logoOde:{gfx:"logo",
src:{x:48,y:64,w:96,h:64},pos:{x:173,y:0},align:{x:ig.GUI_ALIGN.X_LEFT,y:ig.GUI_ALIGN.Y_TOP},transitions:{DEFAULT:{state:{},time:0.3,timeFunction:KEY_SPLINES.EASE_OUT},HIDDEN:{state:{alpha:0,scaleY:0},time:0.3,timeFunction:KEY_SPLINES.EASE_IN}}},logoTechDemo:{gfx:"logo",src:{x:0,y:192,w:96,h:32},pos:{x:263,y:16},align:{x:ig.GUI_ALIGN.X_LEFT,y:ig.GUI_ALIGN.Y_TOP},transitions:{DEFAULT:{state:{},time:0.3,timeFunction:KEY_SPLINES.EASE_OUT},HIDDEN:{state:{alpha:0,scaleY:0},time:0.3,timeFunction:KEY_SPLINES.EASE_IN}}},
logoTechDemo2:{gfx:"logo",src:{x:0,y:224,w:108,h:58},pos:{x:420,y:30},align:{x:ig.GUI_ALIGN.X_LEFT,y:ig.GUI_ALIGN.Y_TOP},transitions:{DEFAULT:{state:{},time:0.3,timeFunction:KEY_SPLINES.EASE_OUT},HIDDEN:{state:{alpha:0,scaleY:0},time:0.3,timeFunction:KEY_SPLINES.EASE_IN}}}},timeLine:[{time:0,gui:"logoC1",state:"STATE1"},{time:0,gui:"logoC2",state:"STATE1"},{time:0.3,gui:"logoC1",state:"STATE2"},{time:0.3,gui:"logoC2",state:"STATE2"},{time:0.8,gui:"logoRoss",state:"DEFAULT"},{time:0.8,gui:"logoOde",
state:"DEFAULT"},{time:0.8,gui:"logoBG",state:"DEFAULT"},{time:0.8,gui:"logoTechDemo2",state:"DEFAULT"},{time:1.2,gui:"logoTechDemo",state:"DEFAULT"},{time:1.6,end:true}],init:function(b){this.parent(b);this.setSize(465,64);this.hook.zIndex=1E3}})});ig.baked=!0;
ig.module("game.feature.gui.screen.title-preset").requires("impact.feature.gui.gui","impact.feature.gui.base.basic-gui","game.feature.menu.gui.menu-misc").defines(function(){sc.TitlePresetMenu=sc.HeaderMenuPanel.extend({transitions:{DEFAULT:{state:{},time:0.2,timeFunction:KEY_SPLINES.EASE},HIDDEN:{state:{alpha:0.5,offsetX:-204},time:0.2,timeFunction:KEY_SPLINES.LINEAR}},buttonInteract:null,itemList:null,backButton:null,submitSound:null,slots:[],_loadCallback:null,_removeCallback:null,_doLoad:false,
_loadSlot:-1,_firstTime:false,init:function(b,a){this.parent(ig.lang.get("sc.gui.title-screen.preset-title"),sc.MenuPanelType.TOP_RIGHT_EDGE_DARK);this.setSize(204,257);this.hook.zIndex=2001;this.hook.pauseGui=true;this._loadCallback=b;this._removeCallback=a;this.submitSound=sc.BUTTON_SOUND.submit;this.buttonInteract=new ig.ButtonInteractEntry;this.backButton=new sc.ButtonGui("\\i[back]"+ig.lang.get("sc.gui.menu.back"),204,true,sc.BUTTON_TYPE.SMALL);this.backButton.setAlign(ig.GUI_ALIGN.X_LEFT,ig.GUI_ALIGN.Y_BOTTOM);
this.backButton.setPos(0,1);this.backButton.submitSound=sc.BUTTON_SOUND.back;this.backButton.onButtonPress=function(){this.deactivate()}.bind(this);this.addChildGui(this.backButton);this.itemList=new sc.ItemListBox(1,true,this.buttonInteract);this.itemList.list.showTopBar=false;this.itemList.setSize(204,231);this.itemList.setAlign(ig.GUI_ALIGN.X_LEFT,ig.GUI_ALIGN.Y_TOP);this.itemList.list.buttonGroup.addPressCallback(function(a){if(a.slot>=0){this.submitSound.play();this._doLoad=true;this._loadSlot=
a.slot}}.bind(this));this.itemList.setPos(0,2);this.addChildGui(this.itemList);this.buttonInteract.pushButtonGroup(this.itemList.list.buttonGroup);this.buttonInteract.addGlobalButton(this.backButton,function(){return sc.control.menuBack()}.bind(this));this.doStateTransition("HIDDEN",true)},update:function(){if(this.isVisible()&&(!ig.interact.isBlocked()&&!ig.canLeavePauseMenu)&&sc.control.menuBack()){sc.BUTTON_SOUND.back.play();this.deactivate()}if(this._doLoad){this._doLoad=false;this._loadCallback&&
this._loadCallback(this._loadSlot)}},setPos:function(b,a){this.parent(b,a);this.setStateValue("HIDDEN","offsetX",-(204+b));this.doStateTransition("DEFAULT",true);this.doStateTransition("HIDDEN",true)},activate:function(){ig.canLeavePauseMenu=false;ig.interact.addEntry(this.buttonInteract);this.createList();this.doStateTransition("DEFAULT")},deactivate:function(){this._removeCallback&&this._removeCallback();ig.canLeavePauseMenu=true;ig.interact.removeEntry(this.buttonInteract);this.doStateTransition("HIDDEN")},
createList:function(){var b=0,a=0,d=ig.input.mouseGuiActive,b=this.itemList.list.buttonGroup.current.y,a=-this.itemList.list.box.hook.scroll.y;this.itemList.list.buttonGroup.clear();this.itemList.list.clear(false);this.slots.length=0;for(var c=sc.savePreset.slots,e=null,e=null,f=0;f<c.length;f++)if(e=c[f]){e=new sc.TitlePresetMenu.SaLoButton(f,e);e.setSize(201,44);this.itemList.addButton(e);this.slots[f]=e}b=Math.max(0,Math.min(b,this.itemList.list.getChildren().length));this.itemList.list._prevIndex=
b;d?this.itemList.list.buttonGroup.setCurrentFocus(0,b):this.itemList.list.buttonGroup.focusCurrentButton(0,b,false,true);this.itemList.list.scrollToY(a,true)}});sc.TitlePresetMenu.SaLoButton=ig.FocusGui.extend({transitions:{DEFAULT:{state:{},time:0.1,timeFunction:KEY_SPLINES.LINEAR},HIDDEN:{state:{scaleY:0},time:0.1,timeFunction:KEY_SPLINES.LINEAR}},ninepatch:new ig.NinePatch("media/gui/buttons.png",{width:13,height:6,left:9,top:9,right:9,bottom:9,offsets:{"default":{x:0,y:65},focus:{x:32,y:65},
"delete":{x:64,y:65}}}),level:null,location:null,mainText:null,position:null,slot:-1,init:function(b,a){this.parent();this.slot=b;var d=a.saveSlot.getData();if(d){var c=new sc.NumberGui(99,{leadingZeros:2,size:sc.NUMBER_SIZE.TINY});c.setNumber(b);c.setPos(8,8);this.addChildGui(c);d=d.player;this.level=new sc.NumberGui(99,{size:sc.NUMBER_SIZE.TEXT});this.level.setNumber(d.level);this.level.setAlign(ig.GUI_ALIGN.X_RIGHT,ig.GUI_ALIGN.Y_TOP);this.level.setPos(8,8);this.addChildGui(this.level);d=new sc.TextGui("LV: ",
{speed:ig.TextBlock.SPEED.IMMEDIATE});d.setAlign(ig.GUI_ALIGN.X_RIGHT,ig.GUI_ALIGN.Y_TOP);d.setPos(26,4);this.addChildGui(d);this.location=new sc.TextGui(a.sub.toString(),{speed:ig.TextBlock.SPEED.IMMEDIATE,font:sc.fontsystem.tinyFont});this.location.setAlign(ig.GUI_ALIGN.X_LEFT,ig.GUI_ALIGN.Y_TOP);this.location.setPos(8,29);this.addChildGui(this.location);this.mainText=new sc.TextGui(a.title.toString(),{speed:ig.TextBlock.SPEED.IMMEDIATE,font:sc.fontsystem.smallFont});this.mainText.setAlign(ig.GUI_ALIGN.X_LEFT,
ig.GUI_ALIGN.Y_TOP);this.mainText.setPos(8,16);this.addChildGui(this.mainText)}},focusGained:function(){this.parent()},updateDrawables:function(b){this.ninepatch.draw(b,this.hook.size.x,this.hook.size.y,this.focus?"focus":"default")}})});ig.baked=!0;
ig.module("game.feature.gui.widget.modal-dialog").requires("impact.base.image","impact.feature.gui.gui","impact.feature.gui.base.basic-gui","impact.feature.interact.gui.focus-gui","game.feature.interact.button-group").defines(function(){sc.DIALOG_INFO_ICON={};sc.DIALOG_INFO_ICON.NONE=0;sc.DIALOG_INFO_ICON.INFO=1;sc.DIALOG_INFO_ICON.WARNING=2;sc.DIALOG_INFO_ICON.ERROR=3;sc.DIALOG_INFO_ICON.QUESTION=4;sc.ModalScreenInteract=ig.GuiElementBase.extend({gfx:new ig.Image("media/gui/menu.png"),transitions:{DEFAULT:{state:{alpha:1},
time:0.2,timeFunction:KEY_SPLINES.EASE_OUT},HIDDEN:{state:{alpha:0},time:0.3,timeFunction:KEY_SPLINES.EASE_IN}},msgBox:null,textGui:null,textDone:false,icon:0,screenInteract:null,callback:null,init:function(b,a,d,c){this.parent();this.hook.zIndex=9999999;this.hook.localAlpha=0.8;this.hook.temporary=true;this.hook.pauseGui=true;this.hook.size.x=ig.system.width;this.hook.size.y=ig.system.height;this.callback=c;this.icon=a||sc.DIALOG_INFO_ICON.NONE;this.textGui=new sc.TextGui(b,{maxWidth:300+(!d?15:
0)});b=new ig.GuiElementBase;b.addChildGui(this.textGui);if(d){a=Math.max(16,this.textGui.hook.size.y);if(this.icon){c=new ig.ImageGui(this.gfx,416+16*(this.icon-1),464,15,15);b.addChildGui(c);d=Math.max(16,this.textGui.hook.size.x+15+4);c.setPos(0,1);this.textGui.setPos(19,0)}else d=Math.max(16,this.textGui.hook.size.x)}else{d=Math.max(16,this.textGui.hook.size.x);if(this.icon){c=new ig.ImageGui(this.gfx,416+16*(this.icon-1),464,15,15);b.addChildGui(c);a=Math.max(16,this.textGui.hook.size.y+15+4);
c.setPos(d/2-7.5,2);this.textGui.setPos(0,19)}else a=Math.max(16,this.textGui.hook.size.y)}b.setSize(d,a);this.msgBox=new sc.CenterBoxGui(b);this.msgBox.setAlign(ig.GUI_ALIGN.X_CENTER,ig.GUI_ALIGN.Y_CENTER);this.addChildGui(this.msgBox);this.doStateTransition("HIDDEN",true);this.doStateTransition("DEFAULT");this.textGui.textBlock.onFinish=this._onTextFinish.bind(this);this.textDone=this.textGui.textBlock.isFinished();this.screenInteract=new sc.ScreenInteractEntry(this);ig.system.skipMode||ig.interact.addEntry(this.screenInteract)},
update:function(){!this.hook.removeAfterTransition&&(this.textDone&&ig.system.skipMode)&&this._close();this.parent()},updateDrawables:function(b){b.addColor("#000",0,0,this.hook.size.x,this.hook.size.y)},_onTextFinish:function(){this.textDone=true},_close:function(){this.msgBox.doStateTransition("HIDDEN");this.doStateTransition("HIDDEN",false,true);this.callback&&this.callback()},onInteraction:function(){if(this.textDone){ig.interact.removeEntry(this.screenInteract);this._close()}else this.textGui.finish()}});
sc.ModalButtonInteract=ig.GuiElementBase.extend({gfx:new ig.Image("media/gui/menu.png"),transitions:{DEFAULT:{state:{alpha:1},time:0.2,timeFunction:KEY_SPLINES.EASE_OUT},HIDDEN:{state:{alpha:0},time:0.2,timeFunction:KEY_SPLINES.EASE_IN}},msgBox:null,textGui:null,content:null,buttons:[],icon:0,buttonInteract:null,buttongroup:null,callback:null,back:null,keepOpen:false,init:function(b,a,d,c,e){this.parent();this.hook.zIndex=9999999;this.hook.localAlpha=0.8;this.hook.temporary=true;this.hook.pauseGui=
true;this.hook.size.x=ig.system.width;this.hook.size.y=ig.system.height;this.callback=c;this.buttonInteract=new ig.ButtonInteractEntry;this.buttongroup=new sc.ButtonGroup;this.buttonInteract.pushButtonGroup(this.buttongroup);this.buttongroup.addPressCallback(function(a){this.keepOpen||this.hide();this.callback&&a.data!=void 0&&this.callback(a,this)}.bind(this));this.back=new sc.ButtonGui("",sc.BUTTON_DEFAULT_WIDTH);this.back.data=-1;this.back.submitSound=sc.BUTTON_SOUND.back;this.back.onButtonPress=
function(){this.hide();this.callback&&this.callback(this.back)}.bind(this);this.buttonInteract.addGlobalButton(this.back,this.onBackButtonCheck.bind(this));this.icon=a||sc.DIALOG_INFO_ICON.NONE;this.textGui=new sc.TextGui(b,{maxWidth:315});this.content=new ig.GuiElementBase;this.content.addChildGui(this.textGui);a=b=0;c=null;if(d){var f=new ig.GuiElementBase;f.setAlign(ig.GUI_ALIGN.X_CENTER,ig.GUI_ALIGN.Y_BOTTOM);for(var g=d.length>=4,h=0;h<d.length;h++){c=new sc.ButtonGui(d[h],sc.BUTTON_TOP_MENU_WIDTH,
true,sc.BUTTON_TYPE.SMALL);if(e)c.submitSound=null;if(g){c.setPos(0,a);a=a+(sc.BUTTON_TYPE.SMALL+1);if(c.hook.size.x>b)b=c.hook.size.x;this.buttongroup.addFocusGui(c,0,h)}else{c.setPos(b,0);b=b+(c.hook.size.x+1);if(c.hook.size.y>a)a=c.hook.size.y;this.buttongroup.addFocusGui(c,h,0)}c.data=h;this.buttons.push(c);f.addChildGui(c)}f.setSize(b,a);this.content.addChildGui(f)}if(this.icon){e=new ig.ImageGui(this.gfx,416+16*(this.icon-1),464,15,15);this.content.addChildGui(e);d=Math.max(16,this.textGui.hook.size.x+
15+4);e.setPos(0,1);this.textGui.setPos(19,0)}else d=Math.max(16,this.textGui.hook.size.x);if(b>d){d=b;this.textGui.setAlign(ig.GUI_ALIGN.X_CENTER,ig.GUI_ALIGN.Y_TOP)}e=Math.max(16,this.textGui.hook.size.y+a+4);this.content.setSize(d,e);this.msgBox=new sc.CenterBoxGui(this.content);this.msgBox.setAlign(ig.GUI_ALIGN.X_CENTER,ig.GUI_ALIGN.Y_CENTER);this.addChildGui(this.msgBox);this.doStateTransition("HIDDEN",true)},updateDrawables:function(b){b.addColor("#000",0,0,this.hook.size.x,this.hook.size.y)},
show:function(){ig.interact.addEntry(this.buttonInteract);ig.interact.setBlockDelay(0.2);this.msgBox.doStateTransition("DEFAULT");this.doStateTransition("DEFAULT");this.buttons.length>1&&sc.model.addChoiceGui(this)},hide:function(){ig.interact.removeEntry(this.buttonInteract);ig.interact.setBlockDelay(0.2);this.msgBox.doStateTransition("HIDDEN");this.doStateTransition("HIDDEN",false,true);sc.model.removeChoiceGui(this)},onBackButtonCheck:function(){return sc.control.menuBack()},onDetach:function(){}});
sc.Dialogs={showDialog:function(b,a,d,c){b=new sc.ModalScreenInteract(b,a,d,c);ig.gui.addGuiElement(b)},showInfoDialog:function(b,a,d){this.showDialog(b,sc.DIALOG_INFO_ICON.INFO,a,d)},showWarningDialog:function(b,a,d){this.showDialog(b,sc.DIALOG_INFO_ICON.WARNING,a,d)},showErrorDialog:function(b,a,d){this.showDialog(b,sc.DIALOG_INFO_ICON.ERROR,a,d)},showQuestionDialog:function(b,a,d){this.showDialog(b,sc.DIALOG_INFO_ICON.QUESTION,a,d)},showChoiceDialog:function(b,a,d,c,e){if(!(d instanceof Array))throw Error("options must be an array!");
b=new sc.ModalButtonInteract(b,a,d,c,e);ig.gui.addGuiElement(b);b.show()},showConformationDialog:function(b,a,d,c){this.showChoiceDialog(b,a,[d],c)},showYesNoDialog:function(b,a,d,c){this.showChoiceDialog(b,a,[ig.lang.get("sc.gui.dialogs.yes"),ig.lang.get("sc.gui.dialogs.no")],d,c)}}});ig.baked=!0;
ig.module("game.feature.menu.gui.save.save-misc").requires("impact.feature.gui.gui","impact.feature.gui.base.basic-gui","game.feature.version.version","game.feature.gui.widget.modal-dialog","game.feature.menu.gui.menu-misc","impact.feature.interact.gui.focus-gui").defines(function(){sc.SaveSlotNewButton=ig.FocusGui.extend({transitions:{DEFAULT:{state:{},time:0.2,timeFunction:KEY_SPLINES.LINEAR},HIDDEN:{state:{alpha:0},time:0.2,timeFunction:KEY_SPLINES.LINEAR}},ninepatch:new ig.NinePatch("media/gui/buttons.png",
{width:28,height:0,left:8,top:40,right:8,bottom:0,offsets:{"default":{x:0,y:114},focus:{x:45,y:114}}}),slot:-1,slotOver:null,text:null,init:function(a){this.parent();this.setSize(448,40);this.slot=a==void 0?-1:a;this.text=new sc.TextGui(ig.lang.get("sc.gui.menu.save-menu.new-slot"));this.text.setAlign(ig.GUI_ALIGN.X_CENTER,ig.GUI_ALIGN.Y_CENTER);this.addChildGui(this.text);this.slotOver=new sc.SaveSlotButtonHighlight;this.addChildGui(this.slotOver);this.slotOver.setSlot(this.slot)},focusGained:function(){this.focus=
true;this.slotOver.focus=true},focusLost:function(){this.focus=false;this.slotOver.focus=false},updateDrawables:function(a){this.ninepatch.draw(a,this.hook.size.x,this.hook.size.y,this.focus?"focus":"default")}});sc.SaveSlotButton=ig.FocusGui.extend({transitions:{DEFAULT:{state:{},time:0.2,timeFunction:KEY_SPLINES.LINEAR},MOVE:{state:{},time:0.2,timeFunction:KEY_SPLINES.EASE},HIDDEN:{state:{alpha:0},time:0.2,timeFunction:KEY_SPLINES.LINEAR},DELETE:{state:{alpha:0.5,scaleY:0},time:0.2,timeFunction:KEY_SPLINES.EASE}},
gfx:new ig.Image("media/gui/menu.png"),ninepatch:new ig.NinePatch("media/gui/buttons.png",{width:28,height:0,left:8,top:40,right:8,bottom:0,offsets:{"default":{x:0,y:114},focus:{x:45,y:114}}}),slot:-1,slotOver:null,level:null,location:null,time:null,credit:null,chapter:null,party:null,elements:null,autoSlotMiss:null,wrapper:null,content:null,effect:null,init:function(a,b){this.parent();this.setSize(448,40);this.wrapper=new ig.GuiElementBase;this.wrapper.setSize(448,40);this.wrapper.hook.transitions=
{DEFAULT:{state:{},time:0.2,timeFunction:KEY_SPLINES.LINEAR},HIDDEN:{state:{alpha:0},time:0.2,timeFunction:KEY_SPLINES.LINEAR}};this.wrapper.doStateTransition("DEFAULT",true);this.content=new ig.GuiElementBase;this.content.setSize(448,40);this.content.hook.transitions={DEFAULT:{state:{},time:0.2,timeFunction:KEY_SPLINES.LINEAR},HIDDEN:{state:{alpha:0},time:0.2,timeFunction:KEY_SPLINES.LINEAR}};this.content.doStateTransition("DEFAULT",true);this.chapter=new sc.SaveSlotChapter;this.content.addChildGui(this.chapter);
var c=new sc.TextGui(ig.lang.get("sc.gui.menu.save-menu.level"),{font:sc.fontsystem.tinyFont});c.setPos(ig.currentLang=="ja_JP"?150:154,5);this.content.addChildGui(c);this.level=new sc.NumberGui(99,{size:sc.NUMBER_SIZE.LARGE});this.level.setPos(170,6);this.content.addChildGui(this.level);this.location=new sc.SaveSlotLocation;this.content.addChildGui(this.location);this.party=new sc.SaveSlotParty;this.content.addChildGui(this.party);this.elements=new sc.SaveSlotElements;this.content.addChildGui(this.elements);
var e=new ig.GuiElementBase;e.setPos(313,5);e.setSize(47,18);c=new sc.TextGui(ig.lang.get("sc.gui.menu.save-menu.playtime"),{font:sc.fontsystem.tinyFont});c.setAlign(ig.GUI_ALIGN.X_RIGHT,ig.GUI_ALIGN.Y_TOP);c.setPos(0,0);e.addChildGui(c);c=new sc.TextGui(ig.lang.get("sc.gui.menu.save-menu.credit"),{font:sc.fontsystem.tinyFont});c.setAlign(ig.GUI_ALIGN.X_RIGHT,ig.GUI_ALIGN.Y_TOP);c.setPos(0,11);e.addChildGui(c);this.content.addChildGui(e);this.time=new sc.SaveSlotPlayTime;this.content.addChildGui(this.time);
this.credit=new sc.NumberGui(9999999);this.credit.setPos(368,15);this.content.addChildGui(this.credit);this.wrapper.addChildGui(this.content);this.slotOver=new sc.SaveSlotButtonHighlight;this.wrapper.addChildGui(this.slotOver);this.autoSlotMiss=new sc.TextGui(ig.lang.get("sc.gui.menu.save-menu.noAuto"));this.autoSlotMiss.hook.transitions={DEFAULT:{state:{},time:0.2,timeFunction:KEY_SPLINES.LINEAR},HIDDEN:{state:{alpha:0},time:0.2,timeFunction:KEY_SPLINES.LINEAR}};this.autoSlotMiss.setAlign(ig.GUI_ALIGN.X_CENTER,
ig.GUI_ALIGN.Y_CENTER);this.addChildGui(this.autoSlotMiss);this.autoSlotMiss.doStateTransition("HIDDEN",true);this.addChildGui(this.wrapper);this.effect=new sc.SaveSlotUpdateEffect;this.addChildGui(this.effect);this.setSave(a,b)},setSave:function(a,b,c){c=c==void 0?true:c;this.slot=b==void 0?-1:b;this.slotOver.setSlot(this.slot);if(a){var b=a.vars&&a.vars.storage&&a.vars.storage.plot&&a.vars.storage.plot.metaSpace,e=a.vars&&a.vars.storage&&a.vars.storage.plot&&a.vars.storage.plot.line>=4E4;if(a.player){this.chapter.setChapter(a.player.chapter||
0,b,e);this.level.setNumber(a.player.level||0,c);this.credit.setNumber(a.player.credit||0,c);this.elements.setElements(a.player)}this.location.setLocation(a);this.party.setParty(a,c);this.time.setTime(a,c)}else{this.content.doStateTransition("HIDDEN",true);this.autoSlotMiss.doStateTransition("DEFAULT",true)}},doNewEffect:function(){this.wrapper.doStateTransition("HIDDEN",true);this.effect.playNew(function(){this.wrapper.doStateTransition("DEFAULT",true)}.bind(this))},doUpdateEffect:function(a,b){this.effect.playUpdate(b,
function(){this.setSave(a,this.slot,true)}.bind(this))},setSlot:function(a){this.slot=a==void 0?-1:a;this.slotOver.setSlot(this.slot)},setSlotOver:function(a){this.slotOver.setSlot(a)},focusGained:function(){this.focus=true;this.slotOver.focus=true},focusLost:function(){this.focus=false;this.slotOver.focus=false},updateDrawables:function(a){if(this.wrapper.hook.currentStateName!="HIDDEN"){this.ninepatch.draw(a,this.hook.size.x,this.hook.size.y,this.focus?"focus":"default");this.content.hook.currentStateName!=
"HIDDEN"&&a.addGfx(this.gfx,430,15,490,224,10,8)}}});sc.SaveSlotPlayTime=ig.GuiElementBase.extend({gfx:new ig.Image("media/gui/basic.png"),hour:null,minute:null,second:null,millis:null,color:0,hideHours:false,drawHourDots:true,init:function(a,b,c,e,f,g){this.parent();this.setAlign(ig.GUI_ALIGN.X_RIGHT,ig.GUI_ALIGN.Y_TOP);this.setSize(72,13);this.setPos(8,4);this.hideHours=g;e=e||0;this.hour=new sc.NumberGui(b||999,{leadingZeros:c||3,size:a||null,transitionTime:e,noZero:this.hideHours});this.hour.setAlign(ig.GUI_ALIGN.X_RIGHT,
ig.GUI_ALIGN.Y_TOP);this.hour.setPos(46,0);this.addChildGui(this.hour);this.minute=new sc.NumberGui(99,{leadingZeros:2,size:a||null,transitionTime:e});this.minute.setAlign(ig.GUI_ALIGN.X_RIGHT,ig.GUI_ALIGN.Y_TOP);this.minute.setPos(23,0);this.addChildGui(this.minute);this.second=new sc.NumberGui(99,{leadingZeros:2,size:a||null,transitionTime:e});this.second.setAlign(ig.GUI_ALIGN.X_RIGHT,ig.GUI_ALIGN.Y_TOP);this.second.setPos(0,0);this.addChildGui(this.second);if(f){this.millis=new sc.NumberGui(99,
{leadingZeros:2,size:a||null,transitionTime:e});this.millis.setAlign(ig.GUI_ALIGN.X_RIGHT,ig.GUI_ALIGN.Y_TOP);this.millis.setPos(0,0);this.addChildGui(this.millis);this.second.hook.pos.x=this.second.hook.pos.x+21;this.minute.hook.pos.x=this.minute.hook.pos.x+21;this.hour.hook.pos.x=this.hour.hook.pos.x+21;this.setSize(69+this.hour.hook.size.x,13)}else this.setSize(48+this.hour.hook.size.x,13)},setColor:function(a){this.color=a||sc.GUI_NUMBER_COLOR.WHITE;this.hour.setColor(this.color);this.minute.setColor(this.color);
this.second.setColor(this.color)},setTime:function(a,b){var c=a.playtime;this.millis&&this.millis.setNumber(Math.floor(c*100)%100,b);this.second.setNumber(Math.floor(c)%60,b);this.minute.setNumber(Math.floor(c/60)%60,b);this.hour.setNumber(Math.floor(c/60/60),b)},setTimeFromValue:function(a,b){this.millis&&this.millis.setNumber(Math.floor(a*100)%100,b);this.second.setNumber(Math.floor(a)%60,b);this.minute.setNumber(Math.floor(a/60)%60,b);var c=Math.floor(a/60/60);this.hour.setNumber(c,b);if(this.hideHours){this.drawHourDots=
c>0;this.hook.size.x=this.drawHourDots?(this.millis?69:48)+this.hour.hook.size.x:this.millis?61:40}},updateDrawables:function(a){if(this.millis){a.addGfx(this.gfx,this.hook.size.x-20,this.hour.metrics==sc.NUMBER_SIZE.TEXT?3:2,112,1+this.color*8,3,7);a.addGfx(this.gfx,this.hook.size.x-42,this.hour.metrics==sc.NUMBER_SIZE.TEXT?2:1,107,1+this.color*8,3,7);this.drawHourDots&&a.addGfx(this.gfx,this.hook.size.x-65,this.hour.metrics==sc.NUMBER_SIZE.TEXT?2:1,107,1+this.color*8,3,7)}else{a.addGfx(this.gfx,
this.hook.size.x-21,this.hour.metrics==sc.NUMBER_SIZE.TEXT?2:1,107,1+this.color*8,3,7);this.drawHourDots&&a.addGfx(this.gfx,this.hook.size.x-44,this.hour.metrics==sc.NUMBER_SIZE.TEXT?2:1,107,1+this.color*8,3,7)}}});sc.SaveSlotLocation=ig.BoxGui.extend({ninepatch:new ig.NinePatch("media/gui/menu.png",{width:4,height:4,left:13,top:13,right:4,bottom:0,offsets:{"default":{x:459,y:224}}}),location:null,version:null,init:function(){this.parent(305,13);this.setAlign(ig.GUI_ALIGN.X_RIGHT,ig.GUI_ALIGN.Y_BOTTOM);
this.setPos(3,3);this.location=new sc.TextGui("",{font:sc.fontsystem.smallFont});this.location.setPos(26,0);this.addChildGui(this.location);this.version=new sc.TextGui("",{font:sc.fontsystem.tinyFont});this.version.setAlign(ig.GUI_ALIGN.X_RIGHT,ig.GUI_ALIGN.Y_CENTER);this.version.setPos(5,1);this.newGamePlus=new ig.ImageGui(this.ninepatch.gfx,560,496,11,11);this.newGamePlus.hook.transitions={DEFAULT:{state:{},time:0.2,timeFunction:KEY_SPLINES.LINEAR},HIDDEN:{state:{alpha:0},time:0.2,timeFunction:KEY_SPLINES.LINEAR}};
this.newGamePlus.setAlign(ig.GUI_ALIGN.X_RIGHT,ig.GUI_ALIGN.Y_CENTER);this.newGamePlus.setPos(5,0);this.newGamePlus.doStateTransition("HIDDEN",true)},setLocation:function(a){var b="",b=a.area&&a.area.langUid?b+(a.area?ig.LangLabel.getText(a.area):"???"):b+(a.area?a.area:"???"),b=a.specialMap&&a.specialMap.langUid?b+(" - "+(a.specialMap?ig.LangLabel.getText(a.specialMap):a.map||"???")):b+(" - "+(a.specialMap?a.specialMap:a.map||"???"));this.location.setText(b);b=a.version||"V0.2.2";if((a.saveVersion||
0)<sc.version.saveVersion)b="\\c[1]"+b;this.newGamePlus.doStateTransition("HIDDEN",true);a.newGamePlus&&a.newGamePlus.active&&this.newGamePlus.doStateTransition("DEFAULT",true);this.version.setText(b)},updateDrawables:function(a){this.parent(a);a.addGfx(this.ninepatch.gfx,13,1,481,224,8,11)}});sc.SaveSlotParty=ig.BoxGui.extend({headsGfx:new ig.Image("media/gui/severed-heads.png"),ninepatch:new ig.NinePatch("media/gui/menu.png",{width:4,height:0,left:19,top:19,right:19,bottom:0,offsets:{"default":{x:416,
y:224}}}),party:[],init:function(){this.parent(94,19);this.setPos(215,4);this.party.push(0)},setParty:function(a){this.party.length=1;if(a.party)for(var a=a.party.currentParty,b=0;b<a.length;b++){var c=sc.party.models[a[b]];c&&this.party.push(c.getHeadIdx())}},updateDrawables:function(a){this.parent(a);for(var b=0;b<this.party.length;b++)a.addGfx(this.headsGfx,14+b*21,2,this.party[b]*24,8,24,16)}});sc.SaveSlotElements=ig.GuiElementBase.extend({ninepatch:new ig.NinePatch("media/gui/menu.png",{width:4,
height:0,left:19,top:19,right:19,bottom:0,offsets:{"default":{x:416,y:224}}}),elements:[],init:function(){this.parent();this.setSize(43,19);this.setPos(198,5)},setElements:function(a){if(a.core[sc.PLAYER_CORE.ELEMENT_CHANGE]){this.elements[sc.ELEMENT.HEAT]=a.core[sc.ELEMENT.HEAT+8];this.elements[sc.ELEMENT.COLD]=a.core[sc.ELEMENT.COLD+8];this.elements[sc.ELEMENT.SHOCK]=a.core[sc.ELEMENT.SHOCK+8];this.elements[sc.ELEMENT.WAVE]=a.core[sc.ELEMENT.WAVE+8]}else{this.elements[sc.ELEMENT.HEAT]=false;this.elements[sc.ELEMENT.COLD]=
false;this.elements[sc.ELEMENT.SHOCK]=false;this.elements[sc.ELEMENT.WAVE]=false}},updateDrawables:function(a){a.addGfx(this.ninepatch.gfx,-1,-1,656,0,18,18);this.elements[sc.ELEMENT.HEAT]&&a.addGfx(this.ninepatch.gfx,4,8,640,0,8,8);this.elements[sc.ELEMENT.COLD]&&a.addGfx(this.ninepatch.gfx,4,0,648,0,8,8);this.elements[sc.ELEMENT.SHOCK]&&a.addGfx(this.ninepatch.gfx,8,4,640,8,8,8);this.elements[sc.ELEMENT.WAVE]&&a.addGfx(this.ninepatch.gfx,0,4,648,8,8,8)}});sc.SaveSlotChapter=ig.GuiElementBase.extend({gfx:new ig.Image("media/gui/chapters.png"),
metaGfx:new ig.Image("media/gui/menu.png"),chapter:null,dlc:false,textGui:null,chapterGui:null,metaMarker:null,init:function(){this.parent();this.setSize(147,34);this.setPos(4,2);this.textGui=new sc.TextGui(ig.lang.get("sc.gui.menu.save-menu.chapter"),{font:sc.fontsystem.tinyFont});this.textGui.setAlign(ig.GUI_ALIGN.X_LEFT,ig.GUI_ALIGN.Y_BOTTOM);this.textGui.setPos(68,0);this.addChildGui(this.textGui);this.chapterGui=new sc.NumberGui(14,{leadingZeros:2});this.chapterGui.hook.transitions={DEFAULT:{state:{},
time:0.2,timeFunction:KEY_SPLINES.LINEAR},HIDDEN:{state:{alpha:0},time:0.2,timeFunction:KEY_SPLINES.LINEAR}};this.chapterGui.setPos(106,25);this.addChildGui(this.chapterGui);this.metaMarker=new ig.ImageGui(this.metaGfx,544,496,11,10);this.metaMarker.hook.transitions={DEFAULT:{state:{},time:0.2,timeFunction:KEY_SPLINES.LINEAR},HIDDEN:{state:{alpha:0},time:0.2,timeFunction:KEY_SPLINES.LINEAR}};this.metaMarker.setAlign(ig.GUI_ALIGN.X_RIGHT,ig.GUI_ALIGN.Y_BOTTOM);this.metaMarker.setPos(12,1);this.metaMarker.setPos(-15,
14);this.addChildGui(this.metaMarker)},setChapter:function(a,b,c){this.chapter=Math.min(sc.model.player.chapters.length,(a||0)+1);this.dlc=c;this.chapterGui.setNumber(this.chapter,true);if(this.chapter==0){this.textGui.setText(ig.lang.get("sc.gui.menu.save-menu.chapter0"));this.chapterGui.doStateTransition("HIDDEN",true)}else if(this.chapter==11&&!this.dlc){this.textGui.setText(ig.lang.get("sc.gui.menu.save-menu.chapterLast"));this.chapterGui.doStateTransition("HIDDEN",true)}else{this.textGui.setText(ig.lang.get("sc.gui.menu.save-menu.chapter"));
this.chapterGui.doStateTransition("DEFAULT",true)}b>=1?this.metaMarker.doStateTransition("DEFAULT",true):this.metaMarker.doStateTransition("HIDDEN",true)},updateDrawables:function(a){var b=this.chapter+(this.dlc?1:0);a.addGfx(this.gfx,0,0,b%2*147,Math.floor(b/2)*34,147,34)}});var b={"default":{top:"#525B68",bottom:"#2D343C"},newgame:{top:"#656852",bottom:"#3b3c2d"},focus:{top:"#faac49",bottom:"#c73a24"}};sc.SaveSlotButtonHighlight=ig.GuiElementBase.extend({ninepatch:new ig.NinePatch("media/gui/buttons.png",
{width:12,height:0,left:6,top:37,right:7,bottom:0,offsets:{"default":{x:91,y:115},focus:{x:134,y:115},newgame:{x:160,y:192}}}),gfx:new ig.Image("media/gui/menu.png"),slot:-1,focus:false,newgame:false,slotGui:null,init:function(){this.parent();this.setPos(2,1);this.setSize(446,38)},setSlot:function(a){if(this.slot!=a&&this.slotGui){this.slotGui.remove();this.slotGui=null}this.slot=a==void 0?-1:a;this.newgame=false;if(this.slot!=-1){this.newgame=false;a=ig.storage.getSlot(this.slot<=-2?-1:this.slot).data;
if(a.newGamePlus&&a.newGamePlus.active)this.newgame=true}if(this.slot<=-2){if(!this.slotGui){this.slotGui=new sc.TextGui("auto");this.slotGui.setPos(5,-2);this.addChildGui(this.slotGui)}}else{if(!this.slotGui){this.slotGui=new sc.NumberGui(99,{leadingZeros:2});this.slotGui.setPos(4,3);this.addChildGui(this.slotGui)}this.slotGui.setNumber(this.slot+1,true)}},updateDrawables:function(a){var d=(this.slot<=-2?37:25)+(this.newgame?this.slot<=-2?8:9:0),c=this.focus?"focus":"default";this.ninepatch.draw(a,
d,39,c);var e=this.hook.size.x-d-7;a.addColor(b[c].top,d,0,e,1);a.addColor(b[c].bottom,d,36,e,1);a.addGfx(this.ninepatch.gfx,this.hook.size.x-7,0,this.focus?169:126,115,5,37);this.newgame&&this.slotGui&&a.addGfx(this.gfx,this.slotGui.hook.pos.x+this.slotGui.hook.size.x+1,this.slot<=-2?2:1.5,560,496,10,10)},setSize:function(a){a=Math.max(a,50);this.parent(a,39)}});sc.SaveSlotUpdateEffect=ig.GuiElementBase.extend({ninepatch:new ig.NinePatch("media/gui/buttons.png",{width:28,height:0,left:8,top:40,right:8,
bottom:0,offsets:{"default":{x:175,y:114}}}),transitions:{DEFAULT:{state:{alpha:1},time:0.5,timeFunction:KEY_SPLINES.EASE},HIDDEN:{state:{alpha:0,scaleY:0},time:0.5,timeFunction:KEY_SPLINES.EASE},HIDDEN_UPDATE:{state:{alpha:0},time:0.3,timeFunction:KEY_SPLINES.EASE},DEFAULT_UPDATE:{state:{alpha:1},time:0.3,timeFunction:KEY_SPLINES.EASE},NEW_HIDDEN:{state:{alpha:0.5,scaleX:0},time:0.5,timeFunction:KEY_SPLINES.EASE},NEW_HIDDEN_END:{state:{alpha:0},time:0.3,timeFunction:KEY_SPLINES.EASE}},init:function(){this.parent();
this.setSize(448,40);this.setPivot(0,20);this.doStateTransition("HIDDEN",true)},playNew:function(a){this.doStateTransition("NEW_HIDDEN",true);this.setPivot(0,20);this.doStateTransition("DEFAULT",false,false,function(){this.setPivot(448,20);a&&a();this.doStateTransition("NEW_HIDDEN_END",false,false,null,0.05)}.bind(this),0.2)},playUpdate:function(a,b){this.doStateTransition("HIDDEN_UPDATE",true);this.setPivot(0,20);this.doStateTransition("DEFAULT_UPDATE",false,false,function(){this.setPivot(448,20);
b&&b();this.doStateTransition("HIDDEN_UPDATE",false,false,null,0.05)}.bind(this),a)},updateDrawables:function(a){this.ninepatch.drawComposite(a,this.hook.size.x,this.hook.size.y,"default","lighter")}})});ig.baked=!0;
ig.module("game.feature.menu.gui.save.save-list").requires("impact.feature.gui.gui","impact.feature.gui.base.basic-gui","impact.feature.gui.base.box","game.feature.gui.base.text","game.feature.menu.gui.menu-misc","game.feature.menu.gui.list-boxes","game.feature.menu.gui.save.save-misc").defines(function(){sc.SaveAutoSaveSlot=ig.BoxGui.extend({transitions:{DEFAULT:{state:{},time:0.2,timeFunction:KEY_SPLINES.LINEAR},HIDDEN:{state:{alpha:0},time:0.2,timeFunction:KEY_SPLINES.LINEAR}},ninepatch:new ig.NinePatch("media/gui/menu.png",
{width:10,height:7,left:8,top:8,right:8,bottom:8,offsets:{"default":{x:545,y:441}}}),button:null,init:function(){this.parent();var b=new sc.TextGui("- This is where you will find your auto save soon -",{font:sc.fontsystem.tinyFont});b.setAlign(ig.GUI_ALIGN.X_CENTER,ig.GUI_ALIGN.Y_CENTER);b.setPos(0,1);this.addChildGui(b)}});sc.SaveList=ig.GuiElementBase.extend({gfx:new ig.Image("media/gui/menu.png"),list:null,buttongroup:null,slots:[],submitSound:null,selectedSlot:null,autoSlot:null,init:function(){this.parent();
var b=sc.menu.loadMode;this.setSize(452,246);this.setAlign(ig.GUI_ALIGN.X_CENTER,ig.GUI_ALIGN.Y_CENTER);this.setPos(0,b?0:2);this.hook.transitions={DEFAULT:{state:{},time:0.2,timeFunction:KEY_SPLINES.LINEAR},HIDDEN:{state:{alpha:0,offsetX:226},time:0.2,timeFunction:KEY_SPLINES.LINEAR}};this.submitSound=sc.BUTTON_SOUND.submit;if(!b){this.autoSlot=new sc.SaveAutoSaveSlot;this.autoSlot.setAlign(ig.GUI_ALIGN.X_CENTER,ig.GUI_ALIGN.Y_TOP);this.autoSlot.setSize(448,41);this.autoSlot.setPos(0,-2);this.addChildGui(this.autoSlot);
var a=new sc.SaveSlotButton(ig.storage.autoSlot?ig.storage.autoSlot.getData():null,-2);a.setPos(0,1);this.autoSlot.addChildGui(a)}var a=203+(b?40:0),d=new sc.MenuScanLines;d.setSize(452,a);d.setPos(0,45-(b?40:0));this.addChildGui(d);this.list=new sc.ButtonListBox(1,0,40);this.list.setSize(452,a);this.list.setPos(0,45-(b?40:0));this.addChildGui(this.list);this.buttongroup=this.list.buttonGroup;this.buttongroup.addSelectionCallback(function(a){this.selectedSlot=a.slot!=void 0&&a.slot>=0?a:null;a.data&&
sc.menu.setInfoText(a.data)}.bind(this));this.buttongroup.setMouseFocusLostCallback(function(){this.selectedSlot=null;sc.menu.loadClearFilesOnly?sc.menu.setInfoText(ig.lang.get("sc.gui.menu.save-menu.description-newgame")):sc.menu.loadMode?sc.menu.setInfoText(ig.lang.get("sc.gui.menu.save-menu.description-load")):sc.menu.setInfoText(ig.lang.get("sc.gui.menu.save-menu.description-save"))}.bind(this));this.buttongroup.addPressCallback(function(a){if(a.slot!=void 0&&a.slot>=-2){this.submitSound.play();
if(a.slot==-1)if(ig.storage.slots.length>=99)sc.Dialogs.showErrorDialog(ig.lang.get("sc.gui.dialogs.slotsOverflow"),false);else this.onNewSlotPressed();else sc.menu.loadClearFilesOnly?sc.Dialogs.showYesNoDialog(ig.lang.get("sc.gui.dialogs.loadNewGameConfirm"),sc.DIALOG_INFO_ICON.QUESTION,function(b){if(b.data==0)this.onSlotNewGamePressed(a)}.bind(this)):sc.menu.loadMode?sc.Dialogs.showYesNoDialog(ig.lang.get("sc.gui.dialogs.loadConfirm"),null,function(b){if(b.data==0)this.onSlotLoadPressed(a)}.bind(this)):
sc.Dialogs.showYesNoDialog(ig.lang.get("sc.gui.dialogs.overrideConfirm"),null,function(b){if(b.data==0)this.onSlotPressed(a)}.bind(this))}}.bind(this));this.doStateTransition("HIDDEN",true)},addObservers:function(){sc.Model.addObserver(sc.menu,this)},removeObservers:function(){sc.Model.removeObserver(sc.menu,this)},showMenu:function(){this.loadSlots();this.list.activate();sc.menu.loadClearFilesOnly?sc.menu.setInfoText(ig.lang.get("sc.gui.menu.save-menu.description-newgame")):sc.menu.loadMode?sc.menu.setInfoText(ig.lang.get("sc.gui.menu.save-menu.description-load")):
sc.menu.setInfoText(ig.lang.get("sc.gui.menu.save-menu.description-save"));ig.input.mouseGuiActive?this.buttongroup.setCurrentFocus(0,this.buttongroup.current.y):this.buttongroup.focusCurrentButton(0,this.buttongroup.current.y,false,true);this.doStateTransition("DEFAULT")},exitMenu:function(){this.list.deactivate();sc.menu.setInfoText("",true);this.doStateTransition("HIDDEN")},onNewSlotPressed:function(){sc.Dialogs.showYesNoDialog(ig.lang.get("sc.gui.dialogs.newConfirm"),null,function(b){b.data==
0&&sc.menu.newSlot()})},onSlotPressed:function(b){sc.stats.addMap("player","saves",1);ig.storage.save(b.slot);this.slots.splice(b.slot,1);this.slots.unshift(b);if(b.slot!=0){b.setSlotOver(0);this.list.moveButton(b.slot+1,1,0.2,null,false,function(a,b){a.setSlot(a.slot+b)}.bind(this));b.setSlot(0);b.doUpdateEffect(ig.storage.getSlot(0).getData(),0.1)}else b.doUpdateEffect(ig.storage.getSlot(0).getData());this.list._prevIndex=1;if(ig.input.mouseGuiActive){if(this.buttongroup.buttonInteract.mouseOverGui){this.buttongroup.buttonInteract.mouseOverGui.focusLost();
this.buttongroup.buttonInteract.mouseOverGui=null}this.buttongroup.setCurrentFocus(0,1)}else this.buttongroup.focusCurrentButton(0,1,false,true);this.list.setScrollY(0,false,true);ig.interact.setBlockDelay(ig.input.mouseGuiActive?0.2:0.4)},onSlotLoadPressed:function(b){sc.menu.loadSlot(b.slot==-2?-1:b.slot);sc.model.enterPrevSubState()},onSlotNewGamePressed:function(b){sc.newgame.setActive(true);b=ig.storage.getSlot(b.slot).getData();sc.newgame.storeSaveData(b);sc.newgame.applyData(b);sc.model.enterPrevSubState()},
onDeleteSlot:function(){if(this.selectedSlot&&this.selectedSlot.slot>=0)sc.Dialogs.showYesNoDialog(ig.lang.get("sc.gui.dialogs.deleteConfirm"),null,function(a){if(a.data==0){sc.menu.deleteSlot(this.selectedSlot.slot);this.deleteSlot(this.selectedSlot)}}.bind(this));else{var b=ig.lang.get("sc.gui.menu.save-menu.delete-info-title")+"\n\n"+ig.lang.get("sc.gui.menu.save-menu.delete-info-content"),b=new sc.CenterMsgBoxGui(b,{maxWidth:300,speed:ig.TextBlock.SPEED.IMMEDIATE},"black",0.9);b.hook.zIndex=15E4;
b.hook.pauseGui=true;ig.gui.addGuiElement(b)}},loadSlots:function(b,a){var d=ig.input.mouseGuiActive,c=b?1:this.buttongroup.current.y||1,e=b?0:-this.list.box.hook.scroll.y||0;this.slots.length=0;this.buttongroup.clear();this.list.clear();var f=ig.storage.slots,g=null;if(sc.menu.loadMode){if(ig.storage.autoSlot&&!sc.menu.loadClearFilesOnly){g=new sc.SaveSlotButton(ig.storage.autoSlot.getData(),-2);this.list.addButton(g)}}else{g=new sc.SaveSlotNewButton(-1);this.list.addButton(g)}for(var h=0;h<f.length;h++){g=
f[h].getData();if(!sc.menu.loadClearFilesOnly||!g.vars||!g.vars.storage||!(g.vars.storage.plot&&(g.vars.storage.plot.metaSpace||0)<1)){g=new sc.SaveSlotButton(g,h);this.list.addButton(g,false);this.slots[h]=g}}c=Math.max(0,Math.min(c,this.list.getChildren().length));this.list._prevIndex=c;d?this.buttongroup.setCurrentFocus(0,c):this.buttongroup.focusCurrentButton(0,c,false,true);this.list.scrollToY(e,!a)},insertNewSlot:function(){var b=new sc.SaveSlotButton(ig.storage.slots[0].getData(),0);this.list.insertButton(b,
1,0.2);this.slots.splice(0,0,b);for(b=0;b<this.slots.length;b++)this.slots[b].setSlot(b);this.list._prevIndex=1;ig.input.mouseGuiActive?this.buttongroup.setCurrentFocus(0,1):this.buttongroup.focusCurrentButton(0,1,false,true);this.list.setScrollY(0,false);ig.interact.setBlockDelay(ig.input.mouseGuiActive?0.5:1)},deleteSlot:function(b,a){var d=this.buttongroup.current.y||0,c=-this.list.box.hook.scroll.y||0;this.list.removeButton(b.slot+1,a?"MOVE":"DELETE",0.2);this.slots.splice(b.slot,1);for(var e=
0;e<this.slots.length;e++)this.slots[e].setSlot(e);d=d+1>=this.list.getChildren().length?d-1:Math.max(0,Math.min(d,this.list.getChildren().length-1));this.list._prevIndex=d;if(b==this.selectedSlot)this.selectedSlot=null;ig.input.mouseGuiActive?this.buttongroup.setCurrentFocus(0,d):this.buttongroup.focusCurrentButton(0,d,false,true,false,true);d=this.list.getHeightAtIndex(d);-c!=d-1?this.list.setScrollY(c,false,true):this.list.setScrollY(d-1,false,true);ig.interact.setBlockDelay(0.2)},modelChanged:function(b,
a){if(b==sc.menu&&a==sc.MENU_EVENT.SAVE_NEW_SLOT){this.insertNewSlot();this.slots[0].doNewEffect()}}})});ig.baked=!0;
ig.module("game.feature.menu.gui.save.save-menu").requires("impact.feature.gui.gui","impact.feature.gui.base.basic-gui","game.feature.gui.widget.modal-dialog","game.feature.menu.gui.base-menu","game.feature.menu.gui.menu-misc","game.feature.control.control","game.feature.menu.gui.save.save-list").defines(function(){function b(a,b){var c="0000"+Math.floor(a);return c.length>=4+b?Math.floor(a):c.substr(c.length-b)}sc.SaveMenu=sc.BaseMenu.extend({hotkeyHelp:null,hotkeyDelete:null,hotkeyNew:null,helpGui:null,
list:null,init:function(){this.parent();this.hook.size.x=ig.system.width;this.hook.size.y=ig.system.height;this.list=new sc.SaveList;this.addChildGui(this.list);this.hotkeyHelp=new sc.ButtonGui("\\i[help]"+ig.lang.get("sc.gui.menu.hotkeys.help"),void 0,true,sc.BUTTON_TYPE.SMALL);this.hotkeyHelp.keepMouseFocus=true;this.hotkeyHelp.hook.transitions={DEFAULT:{state:{},time:0.2,timeFunction:KEY_SPLINES.EASE},HIDDEN:{state:{offsetY:-this.hotkeyHelp.hook.size.y},time:0.2,timeFunction:KEY_SPLINES.LINEAR}};
this.hotkeyHelp.onButtonPress=this.onHelpButtonPressed.bind(this);this.hotkeyDelete=new sc.ButtonGui("\\i[help2]"+ig.lang.get("sc.gui.menu.hotkeys.deleteSlot"),void 0,true,sc.BUTTON_TYPE.SMALL);this.hotkeyDelete.keepMouseFocus=true;this.hotkeyDelete.hook.transitions={DEFAULT:{state:{},time:0.2,timeFunction:KEY_SPLINES.EASE},HIDDEN:{state:{offsetY:-this.hotkeyDelete.hook.size.y},time:0.2,timeFunction:KEY_SPLINES.LINEAR}};this.hotkeyDelete.onButtonPress=this.onDeleteButtonPressed.bind(this);this.hotkeyNew=
new sc.ButtonGui("\\i[help3]"+ig.lang.get("sc.gui.menu.hotkeys.newSlot"),void 0,true,sc.BUTTON_TYPE.SMALL);this.hotkeyNew.keepMouseFocus=true;this.hotkeyNew.hook.transitions={DEFAULT:{state:{},time:0.2,timeFunction:KEY_SPLINES.EASE},HIDDEN:{state:{offsetY:-this.hotkeyNew.hook.size.y},time:0.2,timeFunction:KEY_SPLINES.LINEAR}};this.hotkeyNew.onButtonPress=this.onNewButtonPressed.bind(this);this.doStateTransition("DEFAULT")},addObservers:function(){sc.Model.addObserver(sc.menu,this);this.list.addObservers()},
removeObservers:function(){sc.Model.removeObserver(sc.menu,this);this.list.removeObservers()},showMenu:function(){this.addObservers();sc.menu.pushBackCallback(this.onBackButtonPress.bind(this));sc.menu.moveLeaSprite(0,0,sc.MENU_LEA_STATE.HIDDEN);ig.interact.setBlockDelay(0.2);this.list.showMenu();this.onAddHotkeys()},hideMenu:function(){this.removeObservers();sc.menu.moveLeaSprite(0,0,sc.MENU_LEA_STATE.LARGE);this.exitMenu()},exitMenu:function(){sc.menu.buttonInteract.removeGlobalButton(this.hotkeyHelp);
sc.menu.buttonInteract.removeGlobalButton(this.hotkeyDelete);sc.menu.buttonInteract.removeGlobalButton(this.hotkeyNew);this.list.exitMenu();this.helpGui=null},onHotkeyHelpCheck:function(){return sc.control.menuHotkeyHelp()},onHelpButtonPressed:function(){sc.menu.removeHotkeys();this.createHelpGui();ig.gui.addGuiElement(this.helpGui);this.helpGui.openMenu()},onHotkeyDeleteCheck:function(){return sc.control.menuHotkeyHelp2()},onDeleteButtonPressed:function(){this.list.onDeleteSlot()},onHotkeyNewCheck:function(){return sc.control.menuHotkeyHelp3()},
onNewButtonPressed:function(){ig.storage.slots.length>=100?sc.Dialogs.showErrorDialog(ig.lang.get("sc.gui.dialogs.slotsOverflow"),false):sc.Dialogs.showYesNoDialog(ig.lang.get("sc.gui.dialogs.newConfirm"),null,function(a){a.data==0&&sc.menu.newSlot()})},createHelpGui:function(){if(!this.helpGui){this.helpGui=sc.menu.loadMode?new sc.HelpScreen(this,ig.lang.get("sc.gui.menu.help-texts.load.title"),ig.lang.get("sc.gui.menu.help-texts.load.pages"),function(){this.commitHotKeysToTopBar(true)}.bind(this),
true):new sc.HelpScreen(this,ig.lang.get("sc.gui.menu.help-texts.save.title"),ig.lang.get("sc.gui.menu.help-texts.save.pages"),function(){this.commitHotKeysToTopBar(true)}.bind(this),true);this.helpGui.hook.zIndex=15E4;this.helpGui.hook.pauseGui=true}},onAddHotkeys:function(a){sc.menu.buttonInteract.addGlobalButton(this.hotkeyHelp,this.onHotkeyHelpCheck.bind(this));sc.menu.loadClearFilesOnly||sc.menu.buttonInteract.addGlobalButton(this.hotkeyDelete,this.onHotkeyDeleteCheck.bind(this));sc.menu.loadMode||
sc.menu.buttonInteract.addGlobalButton(this.hotkeyNew,this.onHotkeyNewCheck.bind(this));this.commitHotKeysToTopBar(a)},commitHotKeysToTopBar:function(a){sc.menu.loadMode||sc.menu.addHotkey(function(){return this.hotkeyNew}.bind(this));sc.menu.loadClearFilesOnly||sc.menu.addHotkey(function(){return this.hotkeyDelete}.bind(this));sc.menu.addHotkey(function(){return this.hotkeyHelp}.bind(this));sc.menu.commitHotkeys(a)},onBackButtonPress:function(){sc.menu.popBackCallback();sc.menu.popMenu()},modelChanged:function(){}});
sc.DebugSaveLoadPanel=sc.HeaderMenuPanel.extend({transitions:{DEFAULT:{state:{},time:0.2,timeFunction:KEY_SPLINES.EASE},HIDDEN:{state:{alpha:0.5,offsetX:-204},time:0.2,timeFunction:KEY_SPLINES.LINEAR}},buttonInteract:null,itemList:null,newButton:null,deleteButton:null,backButton:null,load:false,submitSound:null,slots:[],_redBackground:null,_deleteMode:false,_loadCallback:null,_removeCallback:null,_doLoad:false,_loadSlot:-1,_firstTime:false,init:function(a,b,c){this.parent(a?ig.lang.get("sc.gui.menu.save-menu.load"):
ig.lang.get("sc.gui.menu.save-menu.save"),sc.MenuPanelType.TOP_RIGHT_EDGE_DARK);this.setSize(204,283);this.hook.zIndex=2001;this.hook.pauseGui=true;this.load=a||false;this._loadCallback=b;this._removeCallback=c;this.submitSound=sc.BUTTON_SOUND.submit;this.buttonInteract=new ig.ButtonInteractEntry;this._redBackground=new ig.ColorGui("red",204,273);this._redBackground.setPos(0,9);this._redBackground.hook.transitions={DEFAULT:{state:{alpha:0.5},time:0.2,timeFunction:KEY_SPLINES.LINEAR},HIDDEN:{state:{alpha:0},
time:0.2,timeFunction:KEY_SPLINES.LINEAR}};this._redBackground.doStateTransition("HIDDEN",true);this.addChildGui(this._redBackground);this.deleteButton=new sc.ButtonGui("\\i[help]"+ig.lang.get("sc.gui.menu.save-menu.delete"),!a?101:204,true,sc.BUTTON_TYPE.SMALL);this.deleteButton.setAlign(ig.GUI_ALIGN.X_LEFT,ig.GUI_ALIGN.Y_TOP);this.deleteButton.setPos(!a?102:0,12);this.deleteButton.onButtonPress=function(){this.toggleDeleteMode()}.bind(this);this.addChildGui(this.deleteButton);this.backButton=new sc.ButtonGui("\\i[back]"+
ig.lang.get("sc.gui.menu.back"),204,true,sc.BUTTON_TYPE.SMALL);this.backButton.setAlign(ig.GUI_ALIGN.X_LEFT,ig.GUI_ALIGN.Y_BOTTOM);this.backButton.setPos(0,1);this.backButton.submitSound=sc.BUTTON_SOUND.back;this.backButton.onButtonPress=function(){this.deactivate()}.bind(this);this.addChildGui(this.backButton);if(!a){this.newButton=new sc.ButtonGui("\\i[help2]"+ig.lang.get("sc.gui.menu.save-menu.new-save"),101,true,sc.BUTTON_TYPE.SMALL);this.newButton.setAlign(ig.GUI_ALIGN.X_LEFT,ig.GUI_ALIGN.Y_TOP);
this.newButton.setPos(0,12);this.newButton.onButtonPress=function(){this._deleteMode&&this.toggleDeleteMode();ig.storage.save(ig.storage.slots.length);this.loadSlots(true,true)}.bind(this);this.addChildGui(this.newButton)}this.itemList=new sc.ItemListBox(1,true,this.buttonInteract);this.itemList.setSize(204,230);this.itemList.setAlign(ig.GUI_ALIGN.X_LEFT,ig.GUI_ALIGN.Y_TOP);this.itemList.list.buttonGroup.addPressCallback(function(a){if(a.slot!=void 0&&a.slot>=0){this.submitSound.play();if(this._deleteMode)sc.Dialogs.showYesNoDialog(ig.lang.get("sc.gui.dialogs.deleteConfirm"),
null,function(b){if(b.data==0){ig.storage.deleteSlot(a.slot);this.loadSlots(true,null,ig.input.mouseGuiActive)}}.bind(this));else if(this.load){this._doLoad=true;this._loadSlot=a.slot}else sc.Dialogs.showYesNoDialog(ig.lang.get("sc.gui.dialogs.overrideConfirm"),null,function(b){if(b.data==0){ig.storage.save(a.slot);a.saved();for(b=this.slots.length;b--;)a==this.slots[b]&&this.slots[b].updateInfo()}}.bind(this))}}.bind(this));this.itemList.setPos(0,28);this.addChildGui(this.itemList);this.buttonInteract.pushButtonGroup(this.itemList.list.buttonGroup);
a||this.buttonInteract.addGlobalButton(this.newButton,function(){return sc.control.menuHotkeyHelp2()}.bind(this));this.buttonInteract.addGlobalButton(this.deleteButton,function(){return sc.control.menuHotkeyHelp()}.bind(this));this.buttonInteract.addGlobalButton(this.backButton,function(){return sc.control.menuBack()}.bind(this));this.doStateTransition("HIDDEN",true)},update:function(){if(this.isVisible()&&(!ig.interact.isBlocked()&&!ig.canLeavePauseMenu)&&sc.control.menuBack()){sc.BUTTON_SOUND.back.play();
this.deactivate()}if(this._doLoad){this._doLoad=false;this._loadCallback&&this._loadCallback(this._loadSlot)}},setPos:function(a,b){this.parent(a,b);this.setStateValue("HIDDEN","offsetX",-(204+a));this.doStateTransition("DEFAULT",true);this.doStateTransition("HIDDEN",true)},toggleDeleteMode:function(){if(this._deleteMode=!this._deleteMode){this.deleteButton.textChild.setText("\\i[help]"+ig.lang.get("sc.gui.menu.save-menu.exit-del"));this._redBackground.doStateTransition("DEFAULT")}else{this.deleteButton.textChild.setText("\\i[help]"+
ig.lang.get("sc.gui.menu.save-menu.delete"));this._redBackground.doStateTransition("HIDDEN")}for(var a=this.slots.length;a--;)this.slots[a].deleteMode=this._deleteMode},activate:function(){ig.canLeavePauseMenu=false;ig.interact.addEntry(this.buttonInteract);this.deleteButton.textChild.setText("\\i[help]"+ig.lang.get("sc.gui.menu.save-menu.delete"));this.loadSlots(true,false,ig.input.mouseGuiActive);this.doStateTransition("DEFAULT")},deactivate:function(){this._removeCallback&&this._removeCallback();
ig.canLeavePauseMenu=true;ig.interact.removeEntry(this.buttonInteract);this._deleteMode=false;this._redBackground.doStateTransition("HIDDEN");this.doStateTransition("HIDDEN")},loadSlots:function(a,b,c){var e=0,f=0;if(a){e=this.itemList.list.buttonGroup.current.y;f=-this.itemList.list.box.hook.scroll.y}this.itemList.list.buttonGroup.clear();this.itemList.list.clear(false);this.slots.length=0;for(var g=ig.storage.slots,h=null,i=null,j=0;j<g.length;j++)if(i=g[j].getData()){h=new sc.DebugSaveLoadPanel.SaLoButton(j,
this._deleteMode);h.setSize(201,44);this.itemList.addButton(h);this.slots[j]=h}if(a){if(this._firstTime)e=Math.max(0,Math.min(e,this.itemList.list.getChildren().length));else{e=Math.max(0,Math.min(ig.storage.lastUsedSlot,this.itemList.list.getChildren().length));f=this.itemList.list.getScrollYAtIndex(e);this._firstTime=true}this.itemList.list._prevIndex=e;c?this.itemList.list.buttonGroup.setCurrentFocus(0,e):this.itemList.list.buttonGroup.focusCurrentButton(0,e,false,true);this.itemList.list.scrollToY(f,
true)}b&&h.saved()}});sc.DebugSaveLoadPanel.SaLoButton=ig.FocusGui.extend({transitions:{DEFAULT:{state:{},time:0.1,timeFunction:KEY_SPLINES.LINEAR},HIDDEN:{state:{scaleY:0},time:0.1,timeFunction:KEY_SPLINES.LINEAR}},ninepatch:new ig.NinePatch("media/gui/buttons.png",{width:13,height:6,left:9,top:9,right:9,bottom:9,offsets:{"default":{x:0,y:65},focus:{x:32,y:65},"delete":{x:64,y:65}}}),level:null,location:null,playtime:null,position:null,slot:-1,deleteMode:false,init:function(a,d){this.parent();this.slot=
a==void 0?-1:a;this.deleteMode=d||false;if(this.slot>=0){var c=ig.storage.getSlot(this.slot).getData();if(c){var e=new sc.NumberGui(99,{leadingZeros:2,size:sc.NUMBER_SIZE.TINY});e.setNumber(a);e.setPos(8,8);this.addChildGui(e);e=c.player;this.level=new sc.NumberGui(99,{size:sc.NUMBER_SIZE.TEXT});this.level.setNumber(e.level);this.level.setAlign(ig.GUI_ALIGN.X_RIGHT,ig.GUI_ALIGN.Y_TOP);this.level.setPos(8,8);this.addChildGui(this.level);e=new sc.TextGui("LV: ",{speed:ig.TextBlock.SPEED.IMMEDIATE});
e.setAlign(ig.GUI_ALIGN.X_RIGHT,ig.GUI_ALIGN.Y_TOP);e.setPos(26,4);this.addChildGui(e);e=null;e=c.specialMap?c.area+" - "+c.specialMap:c.area+(c.floor?" - "+c.floor:"");this.location=new sc.TextGui(e,{speed:ig.TextBlock.SPEED.IMMEDIATE,font:sc.fontsystem.tinyFont});this.location.setAlign(ig.GUI_ALIGN.X_LEFT,ig.GUI_ALIGN.Y_TOP);this.location.setPos(8,28);this.addChildGui(this.location);e=this._getVersionText(c);this.version=new sc.TextGui(e,{speed:ig.TextBlock.SPEED.IMMEDIATE,font:sc.fontsystem.tinyFont});
this.version.setAlign(ig.GUI_ALIGN.X_LEFT,ig.GUI_ALIGN.Y_TOP);this.version.setPos(28,7);this.addChildGui(this.version);c=c.playtime;e=ig.lang.get("sc.gui.menu.save-menu.time")+": "+b(c/60/60,3)+":"+b(Math.floor(c/60)%60,2)+":"+b(Math.floor(c)%60,2);this.playtime=new sc.TextGui(e,{speed:ig.TextBlock.SPEED.IMMEDIATE,font:sc.fontsystem.smallFont});this.playtime.setAlign(ig.GUI_ALIGN.X_LEFT,ig.GUI_ALIGN.Y_TOP);this.playtime.setPos(8,16);this.addChildGui(this.playtime);this.savedNote=new sc.TextGui(" - Saved!",
{speed:ig.TextBlock.SPEED.IMMEDIATE,font:sc.fontsystem.tinyFont});this.savedNote.setPos(76,7);this.savedNote.hook.transitions={DEFAULT:{state:{},time:0.2,timeFunction:KEY_SPLINES.LINEAR},HIDDEN:{state:{alpha:0},time:0.5,timeFunction:KEY_SPLINES.LINEAR}};this.savedNote.doStateTransition("HIDDEN",true);this.addChildGui(this.savedNote)}}},focusGained:function(){this.parent()},updateDrawables:function(a){this.ninepatch.draw(a,this.hook.size.x,this.hook.size.y,this.focus?this.deleteMode?"delete":"focus":
"default")},saved:function(){this.savedNote.doStateTransition("DEFAULT",true,false,function(){this.savedNote.doStateTransition("HIDDEN",false,false,null,0.1)}.bind(this))},updateInfo:function(){var a=ig.storage.getSlot(this.slot).getData();this.level.setNumber(a.player.level);var d=null,d=a.specialMap?a.area+" - "+a.specialMap:a.area+(a.floor?" - "+a.floor:"");this.location.setText(d);d=a.playtime;d=ig.lang.get("sc.gui.menu.save-menu.time")+": "+b(d/60/60,3)+":"+b(Math.floor(d/60)%60,2)+":"+b(Math.floor(d)%
60,2);this.playtime.setText(d);d=this._getVersionText(a);this.version.setText(d)},_getVersionText:function(a){var b=a.version||"V0.2.2";if((a.saveVersion||0)<sc.version.saveVersion)b="\\c[1]"+b;return b}})});ig.baked=!0;
ig.module("game.feature.menu.gui.new-game.new-game-dialogs").requires("impact.base.image","impact.feature.gui.gui","impact.feature.gui.base.basic-gui","impact.feature.gui.base.box","impact.feature.gui.base.basic-gui","impact.feature.interact.gui.focus-gui","game.feature.menu.gui.menu-misc").defines(function(){sc.NewGameModeSelectDialog=ig.GuiElementBase.extend({gfx:new ig.Image("media/gui/menu.png"),transitions:{DEFAULT:{state:{alpha:1},time:0.2,timeFunction:KEY_SPLINES.EASE_OUT},HIDDEN:{state:{alpha:0},
time:0.2,timeFunction:KEY_SPLINES.EASE_IN}},msgBox:null,normal:null,plus:null,header:null,content:null,info:null,buttons:[],buttonInteract:null,buttongroup:null,callback:null,init:function(b){this.parent();this.hook.zIndex=9999999;this.hook.localAlpha=0.8;this.hook.temporary=true;this.hook.pauseGui=true;this.hook.size.x=ig.system.width;this.hook.size.y=ig.system.height;this.callback=b||null;this.buttonInteract=new ig.ButtonInteractEntry;this.buttongroup=new sc.ButtonGroup;this.buttonInteract.pushButtonGroup(this.buttongroup);
this.buttongroup.addPressCallback(function(a){this.hide();this.callback&&a.data!=void 0&&this.callback(a,this)}.bind(this));this.buttongroup.addSelectionCallback(function(a){if(a.data!=void 0)if(a.data==0){this.info.doStateTransition("DEFAULT",true);this.info.setText(ig.lang.get("sc.gui.menu.new-game.dialogs.normalDescription"))}else if(a.data==1){this.info.doStateTransition("DEFAULT",true);this.info.setText(ig.lang.get("sc.gui.menu.new-game.dialogs.plusDescription"))}}.bind(this));this.buttongroup.setMouseFocusLostCallback(function(){this.info.doStateTransition("HIDDEN",
false,false,null,0.5)}.bind(this));this.back=new sc.ButtonGui("",sc.BUTTON_DEFAULT_WIDTH);this.back.data=-1;this.back.submitSound=sc.BUTTON_SOUND.back;this.back.onButtonPress=function(){this.hide();this.callback&&this.callback(this.back)}.bind(this);this.buttonInteract.addGlobalButton(this.back,this.onBackButtonCheck.bind(this));this.content=new ig.GuiElementBase;this.content.setSize(300,200);b=0;this.header=new sc.TextGui(ig.lang.get("sc.gui.menu.new-game.dialogs.modeSelect"),{maxWidth:300});this.header.setAlign(ig.GUI_ALIGN.X_CENTER,
ig.GUI_ALIGN.Y_TOP);this.content.addChildGui(this.header);var b=b+17,a=new sc.LineGui(300);a.setAlign(ig.GUI_ALIGN.X_CENTER,ig.GUI_ALIGN.Y_TOP);a.setPos(0,b);this.content.addChildGui(a);b=b+10;this.normal=new sc.NewGameModeDialogButton(ig.lang.get("sc.gui.menu.new-game.dialogs.normal"),0);this.normal.setPos(10,b);this.content.addChildGui(this.normal);this.buttongroup.addFocusGui(this.normal,0,0);this.plus=new sc.NewGameModeDialogButton(ig.lang.get("sc.gui.menu.new-game.dialogs.plus"),1);this.plus.setAlign(ig.GUI_ALIGN.X_RIGHT,
ig.GUI_ALIGN.Y_TOP);this.plus.setPos(10,b);this.content.addChildGui(this.plus);this.buttongroup.addFocusGui(this.plus,1,0);b=b+(this.normal.hook.size.y+7);a=new sc.LineGui(300);a.setAlign(ig.GUI_ALIGN.X_CENTER,ig.GUI_ALIGN.Y_TOP);a.setPos(0,b);this.content.addChildGui(a);b=b+4;this.info=new sc.TextGui("",{maxWidth:294,textAlign:ig.Font.ALIGN.CENTER});this.info.hook.transitions={DEFAULT:{state:{},time:0.2,timeFunction:KEY_SPLINES.LINEAR},HIDDEN:{state:{alpha:0},time:0.2,timeFunction:KEY_SPLINES.LINEAR}};
this.info.setAlign(ig.GUI_ALIGN.X_CENTER,ig.GUI_ALIGN.Y_TOP);this.info.setPos(0,b);this.content.addChildGui(this.info);this.content.hook.size.y=b+36;this.msgBox=new sc.CenterBoxGui(this.content);this.msgBox.setAlign(ig.GUI_ALIGN.X_CENTER,ig.GUI_ALIGN.Y_CENTER);this.addChildGui(this.msgBox);this.doStateTransition("HIDDEN",true)},updateDrawables:function(b){b.addColor("#000",0,0,this.hook.size.x,this.hook.size.y)},show:function(){ig.interact.addEntry(this.buttonInteract);ig.interact.setBlockDelay(0.2);
this.msgBox.doStateTransition("DEFAULT");this.doStateTransition("DEFAULT");this.buttons.length>1&&sc.model.addChoiceGui(this)},hide:function(){ig.interact.removeEntry(this.buttonInteract);ig.interact.setBlockDelay(0.2);this.msgBox.doStateTransition("HIDDEN");this.doStateTransition("HIDDEN",false,true);sc.model.removeChoiceGui(this)},onBackButtonCheck:function(){return sc.control.menuBack()}});sc.NewGameModeDialogButton=sc.ButtonGui.extend({framePatch:new ig.NinePatch("media/gui/menu.png",{width:8,
height:8,left:4,top:4,right:4,bottom:4,offsets:{"default":{x:440,y:200}}}),gfx:new ig.Image("media/gui/new-game.png"),frame:null,image:null,init:function(b,a){this.parent(b,121,true,sc.BUTTON_TYPE.START);this.setData(a);this.setWidth(121);this.textChild.setAlign(ig.GUI_ALIGN.X_CENTER,ig.GUI_ALIGN.Y_TOP);this.textChild.setPos(0,1);this.frame=new ig.BoxGui(114,94,false,this.framePatch);this.frame.setPos(3,17);this.addChildGui(this.frame);this.image=new ig.ImageGui(this.gfx,a*110,0,110,90);this.image.setPos(5,
19);this.addChildGui(this.image)}})});ig.baked=!0;
ig.module("game.feature.gui.screen.title-screen").requires("impact.feature.gui.gui","game.feature.gui.base.button","impact.feature.parallax.parallax","game.feature.gui.screen.intro-screen","game.feature.gui.screen.title-logo","impact.base.image","game.feature.gui.screen.title-preset","game.feature.menu.gui.save.save-menu","game.feature.version.version","game.feature.control.control","game.feature.menu.gui.new-game.new-game-dialogs").defines(function(){function b(){ig.bgm.play(ig.Bgm.startTrack,1,
"MEDIUM_OUT")}function a(){ig.bgm.clear("MEDIUM_OUT");c&&c.stop();c=null}sc.MasterOverlayGui=ig.GuiElementBase.extend({transitions:{DEFAULT:{state:{},time:0.5,timeFunction:KEY_SPLINES.LINEAR},HIDDEN:{state:{alpha:0},time:0.5,timeFunction:KEY_SPLINES.LINEAR}},init:function(){this.parent();this.hook.zIndex=900;this.hook.pauseGui=true;this.hook.size.x=ig.system.width;this.hook.size.y=ig.system.height;sc.Model.addObserver(sc.model,this);this.doStateTransition("HIDDEN",true)},updateDrawables:function(a){a.addColor("rgb("+
ig.game.currentTeleportColor.r+","+ig.game.currentTeleportColor.g+","+ig.game.currentTeleportColor.b+")",0,0,this.hook.size.x,this.hook.size.y)},modelChanged:function(a,b){if((b==sc.GAME_MODEL_MSG.STATE_CHANGED||b==sc.GAME_MODEL_MSG.SUB_STATE_CHANGED)&&!a.isPaused()&&!a.isMenu()&&!a.isLevelUp()&&!a.isQuickMenu()&&!a.isOnMapMenu()&&!a.isQuestSolved()){var c=a.isTitle()||!a.isRunning();this.doStateTransition(c?"DEFAULT":"HIDDEN")}}});var d=new ig.Sound("media/sound/background/title-ambient.ogg",0.6),
c=null;sc.TitleScreenGui=ig.GuiElementBase.extend({background:new ig.Image("media/gui/title-bg.png"),transitions:{DEFAULT:{state:{},time:0,timeFunction:KEY_SPLINES.LINEAR},HIDDEN:{state:{alpha:0},time:0,timeFunction:KEY_SPLINES.LINEAR}},parallax:new ig.Parallax("title"),bgGui:null,startGui:null,buttons:null,introGui:null,screenInteract:null,versionGui:null,isPostInit:false,init:function(){this.parent();this.hook.zIndex=1E3;this.hook.size.x=ig.system.width;this.hook.size.y=ig.system.height;this.screenInteract=
new sc.ScreenInteractEntry(this);this.bgGui=new ig.ParallaxGui({parallax:"title"},this._bgCallback.bind(this));this.addChildGui(this.bgGui);this.startGui=new sc.TitleScreenStartGui;this.addChildGui(this.startGui);this.buttons=new sc.TitleScreenButtonGui;this.addChildGui(this.buttons);this.versionGui=new sc.TextGui(sc.version.toString(),{font:sc.fontsystem.tinyFont});this.versionGui.setAlign(ig.GUI_ALIGN.X_RIGHT,ig.GUI_ALIGN.Y_BOTTOM);this.versionGui.setPos(2,0);this.versionGui.hook.transitions={DEFAULT:{state:{},
time:0.2,timeFunction:KEY_SPLINES.EASE},HIDDEN:{state:{alpha:0},time:0.2,timeFunction:KEY_SPLINES.LINEAR}};this.versionGui.doStateTransition("HIDDEN",true);this.addChildGui(this.versionGui);this.introGui=new ig.GUI.IntroScreen(this._introDone.bind(this));this.addChildGui(this.introGui);sc.Model.addObserver(sc.model,this);sc.Model.addObserver(sc.menu,this);this.doStateTransition("HIDDEN",true)},postInit:function(){this.buttons.postInit()},modelChanged:function(c,d){if(c==sc.model&&d==sc.GAME_MODEL_MSG.STATE_CHANGED){var e=
c.isTitle()?"DEFAULT":"HIDDEN";if(this.hook.currentStateName!=e)if(e=="DEFAULT"){if(!this.isPostInit){this.isPostInit=true;this.postInit()}this.buttons.hide(true);ig.bgm.clear("MEDIUM");if(window.IG_GAME_DEBUG){b();this.doStateTransition(e,true);this._startBg()}else{this.introGui.start();this.bgGui.doStateTransition("HIDDEN",true);this.doStateTransition(e,true)}}else{this.buttons.hide();this.versionGui.doStateTransition("HIDDEN");this.bgGui.hasEnded()?this.doStateTransition(e):sc.model.isLoadGame()?
this.bgGui.jumpTo("QUICK_END"):this.bgGui.jumpTo("SLOW_END")}}else if(c==sc.menu&&d==sc.MENU_EVENT.EXIT_MENU){sc.menu.setDirectMode(false);sc.menu.optionsLocalMode=true;sc.menu.loadMode=false;if(ig.input.mouseGuiActive){this.buttons.namedButtons.setOptions.unsetFocus();this.buttons.namedButtons.loadGame.unsetFocus()}}else if(c==sc.menu&&d==sc.MENU_EVENT.POST_EXIT&&sc.menu.loadSlotID>=-1){this.buttons.changelogGui.clearLogs();a();ig.interact.removeEntry(this.buttons.buttonInteract);ig.game.loadStart(sc.menu.loadSlotID);
sc.menu.loadSlotID=-2}},onInteraction:function(){if(this.bgGui.isLabelReached("IDLE")){sc.BUTTON_SOUND.submit.play();this.buttons.show();this.startGui.hide();ig.interact.removeEntry(this.screenInteract)}else this.bgGui.skip()},_startBg:function(){this.bgGui.start(true);ig.interact.addEntry(this.screenInteract)},_introDone:function(){b();this._startBg()},_bgCallback:function(a,b){if(a==ig.SEQUENCE_MSG.LABEL_REACHED){if(b=="IDLE"){this.startGui.show();this.versionGui.doStateTransition("DEFAULT")}if(b==
"SOUND_START"||b=="INTRO_SKIP")c||(c=d.play(true,{fadeDuration:1}))}else a==ig.SEQUENCE_MSG.ENDED&&this.doStateTransition("HIDDEN")}});var e={x:0,y:192,w:40,h:24},f={x:40,y:192,w:64,h:24};sc.TitleScreenStartGui=ig.GuiElementBase.extend({transitions:{DEFAULT:{state:{},time:0.2,timeFunction:KEY_SPLINES.EASE_OUT},HIDDEN:{state:{alpha:0,scaleY:0.5},time:0.2,timeFunction:KEY_SPLINES.EASE_IN}},gfx:new ig.Image("media/gui/buttons.png"),timer:null,init:function(){this.parent();this.setAlign(ig.GUI_ALIGN.X_CENTER,
ig.GUI_ALIGN.Y_CENTER);this.setPos(0,-8);var a=new sc.TextGui(ig.lang.get("sc.gui.title-screen.pressStart"),{font:sc.fontsystem.font});a.setAlign(ig.GUI_ALIGN.X_CENTER,ig.GUI_ALIGN.Y_CENTER);a.setPos(0,-a.hook.size.y/2);this.addChildGui(a);a=new sc.LineGui(176);a.setAlign(ig.GUI_ALIGN.X_CENTER,ig.GUI_ALIGN.Y_CENTER);a.setPos(0,a.hook.size.y/2);this.addChildGui(a);var a=0,b=e,c;if(ig.browser=="Chrome"){a=a-32;c=new ig.ImageGui(this.gfx,b.x,b.y,b.w,b.h);c.setAlign(ig.GUI_ALIGN.X_CENTER,ig.GUI_ALIGN.Y_CENTER);
c.setPos(a,b.h/2+1);this.addChildGui(c);a=a+64}b=f;c=new ig.ImageGui(this.gfx,b.x,b.y,b.w,b.h);c.setAlign(ig.GUI_ALIGN.X_CENTER,ig.GUI_ALIGN.Y_CENTER);c.setPos(a,b.h/2+1);this.addChildGui(c);this.timer=new ig.WeightTimer(true,3,ig.TIMER_MODE.SINUS);this.doStateTransition("HIDDEN",true)},show:function(){this.doStateTransition("DEFAULT")},hide:function(){this.doStateTransition("HIDDEN")},update:function(){this.timer.tick();for(var a=0.6+this.timer.get()*0.4,b=this.hook.children,c=b.length;c--;)b[c].localAlpha=
a}});sc.TitleScreenButtonGui=ig.GuiElementBase.extend({transitions:{DEFAULT:{state:{},time:0.3,timeFunction:KEY_SPLINES.LINEAR},HIDDEN:{state:{alpha:0},time:0.3,timeFunction:KEY_SPLINES.LINEAR}},buttonInteract:null,buttonGroup:null,gamepadGui:null,setOptions:null,namedButtons:{},presetMenu:null,story:null,gameplay:null,puzzle:null,closeButton:null,changelogButton:null,perfWarnButton:null,changelogGui:null,gameCodeButton:null,background:null,perfWarning:null,buttons:[],_rearrangeAnchor:0,_newGamePlus:false,
init:function(){this.parent();this.hook.size.x=ig.system.width;this.hook.size.y=ig.system.height;this.buttonInteract=new ig.ButtonInteractEntry;this.buttonGroup=new sc.ButtonGroup;this.buttonInteract.pushButtonGroup(this.buttonGroup);var b=12;ig.platform==ig.PLATFORM_TYPES.DESKTOP&&(b=b+this._createButton("close",b,5,function(){ig.interact.removeEntry(this.buttonInteract);window.setTimeout(function(){var a=window.require("nw.gui").Window.get();a.isFullscreen&&a.leaveFullscreen();a.close()},300);this.hide()}.bind(this),
"setOptions"));b=b+this._createButton("options",b,4,function(){this._enterOptionsMenu()}.bind(this),"setOptions");b=b+this._createButton("load",b,3,function(){this._enterLoadMenu()}.bind(this),"loadGame");this._rearrangeAnchor=b=b+12;var c=ig.storage.hasSaves()&&!window.IG_GAME_DEBUG;this._newGamePlus=window.IG_GAME_DEBUG?this.checkClearSaveFiles()&&(window.SHOW_NEW_GAME_PLUS||false):this.checkClearSaveFiles();b=b+this._createButton(this._newGamePlus?"startPlus":"start",b,c?1:0,function(){if(this._newGamePlus){var b=
new sc.NewGameModeSelectDialog(function(b){if(b.data>=0)if(b.data==0){this.changelogGui.clearLogs();a();ig.interact.removeEntry(this.buttonInteract);ig.game.start(sc.START_MODE.STORY,1)}else if(b.data==1){sc.menu.setDirectMode(true,sc.MENU_SUBMENU.NEW_GAME);sc.menu.exitCallback=function(){if(sc.newgame.active){this.changelogGui.clearLogs();a();ig.interact.removeEntry(this.buttonInteract);ig.game.start(sc.START_MODE.NEW_GAME_PLUS,1)}else sc.newgame.onReset()}.bind(this);sc.model.enterMenu(true)}}.bind(this));
ig.gui.addGuiElement(b);b.show()}else{this.changelogGui.clearLogs();a();ig.interact.removeEntry(this.buttonInteract);ig.game.start(sc.START_MODE.STORY,1)}}.bind(this),"start");c&&(b=b+this._createButton("continue",b,0,function(){this.changelogGui.clearLogs();a();ig.interact.removeEntry(this.buttonInteract);ig.game.loadStart(ig.storage.lastUsedSlot)}.bind(this),"continue"));this.gameCodeButton=new sc.ButtonGui(ig.lang.get("sc.gui.title-screen.gamecode"),sc.BUTTON_DEFAULT_WIDTH-8);this.gameCodeButton.setAlign(ig.GUI_ALIGN.X_CENTER,
ig.GUI_ALIGN.Y_BOTTOM);this.gameCodeButton.setPos(-20,12);this.gameCodeButton.onButtonPress=function(){window.SHOW_GAMECODE&&window.SHOW_GAMECODE()};this.gameCodeButton.hook.transitions={DEFAULT:{state:{},time:0.2,timeFunction:KEY_SPLINES.EASE},HIDDEN:{state:{offsetY:-40,alpha:0},time:0.2,timeFunction:KEY_SPLINES.LINEAR}};this.gameCodeButton.doStateTransition("HIDDEN",true);this.buttonGroup.addFocusGui(this.gameCodeButton,1,4);this.addChildGui(this.gameCodeButton);this.followButton=new sc.ButtonGui("\\i[twitter]",
32);this.followButton.textChild.hook.pos.y=this.followButton.textChild.hook.pos.y+1;this.followButton.setAlign(ig.GUI_ALIGN.X_CENTER,ig.GUI_ALIGN.Y_BOTTOM);this.followButton.setPos(sc.BUTTON_DEFAULT_WIDTH/2+12,12);this.followButton.onButtonPress=function(){window.SHOW_TWITTER&&window.SHOW_TWITTER()};this.followButton.hook.transitions={DEFAULT:{state:{},time:0.2,timeFunction:KEY_SPLINES.EASE},HIDDEN:{state:{offsetY:-40,alpha:0},time:0.2,timeFunction:KEY_SPLINES.LINEAR}};this.followButton.doStateTransition("HIDDEN",
true);this.buttonGroup.addFocusGui(this.followButton,2,4);this.addChildGui(this.followButton);this.checkPerformanceWarning();if(this.perfWarning){this.perfWarnButton=new sc.ButtonGui("\\i[help]"+ig.lang.get("sc.gui.title-screen.perform-warn"),null,true,sc.BUTTON_TYPE.EQUIP);this.perfWarnButton.hook.transitions={DEFAULT:{state:{},time:0.2,timeFunction:KEY_SPLINES.EASE},HIDDEN:{state:{offsetY:-30},time:0.2,timeFunction:KEY_SPLINES.LINEAR}};this.perfWarnButton.setAlign(ig.GUI_ALIGN.X_LEFT,ig.GUI_ALIGN.Y_TOP);
this.perfWarnButton.setHeight(26);this.perfWarnButton.textChild.setPos(0,-1);this.perfWarnButton.setPos(2,2);this.perfWarnButton.doStateTransition("HIDDEN",true);this.perfWarnButton.onButtonPress=function(){this.showPerformanceWarning()}.bind(this);this.addChildGui(this.perfWarnButton);this.buttonInteract.addGlobalButton(this.perfWarnButton,function(){return sc.control.menuHotkeyHelp()}.bind(this))}this.changelogButton=new sc.ButtonGui("\\i[menu]Changelog",null,true,sc.BUTTON_TYPE.EQUIP);this.changelogButton.hook.transitions=
{DEFAULT:{state:{},time:0.2,timeFunction:KEY_SPLINES.EASE},HIDDEN:{state:{offsetX:-(this.changelogButton.hook.size.x+2)},time:0.2,timeFunction:KEY_SPLINES.LINEAR}};this.changelogButton.setAlign(ig.GUI_ALIGN.X_RIGHT,ig.GUI_ALIGN.Y_TOP);this.changelogButton.setHeight(26);this.changelogButton.textChild.setPos(0,-1);this.changelogButton.setPos(2,2);this.changelogButton.doStateTransition("HIDDEN",true);this.changelogButton.onButtonPress=function(){this.changelogGui.showLog()}.bind(this);this.addChildGui(this.changelogButton);
this.buttonInteract.addGlobalButton(this.changelogButton,function(){return sc.control.menu()}.bind(this));this.doStateTransition("DEFAULT",true)},postInit:function(){if(ig.extensions.getExtensionList().length>0){this.dlcButton=new sc.ButtonGui("\\i[help2]"+ig.lang.get("sc.gui.dlc-list.button"),null,true,sc.BUTTON_TYPE.EQUIP);this.dlcButton.hook.transitions={DEFAULT:{state:{},time:0.2,timeFunction:KEY_SPLINES.EASE},HIDDEN:{state:{offsetY:-(this.changelogButton.hook.size.y+4)},time:0.2,timeFunction:KEY_SPLINES.LINEAR}};
this.dlcButton.setAlign(ig.GUI_ALIGN.X_RIGHT,ig.GUI_ALIGN.Y_TOP);this.dlcButton.setHeight(26);this.dlcButton.textChild.setPos(0,-1);this.dlcButton.setPos(this.changelogButton.hook.size.x+6,2);this.dlcButton.doStateTransition("HIDDEN",true);this.dlcButton.onButtonPress=function(){this.dlcGui.show()}.bind(this);this.buttonInteract.addGlobalButton(this.dlcButton,function(){return sc.control.menuHotkeyHelp2()}.bind(this));this.addChildGui(this.dlcButton)}this.changelogGui=new sc.ChangelogGui;this.addChildGui(this.changelogGui);
this.dlcGui=new sc.DLCGui;this.addChildGui(this.dlcGui);this.background=new ig.ColorGui("#000",ig.system.width,ig.system.height);this.background.hook.transitions={DEFAULT:{state:{alpha:0.8},time:0.2,timeFunction:KEY_SPLINES.LINEAR},HIDDEN:{state:{alpha:0},time:0.2,timeFunction:KEY_SPLINES.LINEAR}};this.background.doStateTransition("HIDDEN");this.addChildGui(this.background);this.presetMenu=new sc.TitlePresetMenu(function(b){this.presetMenu.deactivate();this.background.doStateTransition("HIDDEN");
this.changelogGui.clearLogs();a();ig.interact.removeEntry(this.buttonInteract);sc.savePreset.load(b)}.bind(this),function(){this.background.doStateTransition("HIDDEN")}.bind(this));this.presetMenu.setAlign(ig.GUI_ALIGN.X_RIGHT,ig.GUI_ALIGN.Y_BOTTOM);this.presetMenu.setPos(10,8);this.addChildGui(this.presetMenu)},show:function(){(this._newGamePlus=window.IG_GAME_DEBUG?this.checkClearSaveFiles()&&(window.SHOW_NEW_GAME_PLUS||false):this.checkClearSaveFiles())?this.namedButtons.start.setText(ig.lang.get("sc.gui.title-screen.startPlus"),
true):this.namedButtons.start.setText(ig.lang.get("sc.gui.title-screen.start"),true);this.background.doStateTransition("HIDDEN");this.doStateTransition("DEFAULT");for(var a=0,b=this.buttons.length;b--;){this.buttons[b].doStateTransition("DEFAULT",false,false,null,a);a=a+0.016}this.changelogButton.doStateTransition("DEFAULT");this.perfWarnButton&&this.perfWarnButton.doStateTransition("DEFAULT");this.dlcButton&&this.dlcButton.doStateTransition("DEFAULT");ig.interact.setBlockDelay(0.3);ig.interact.addEntry(this.buttonInteract);
ig.input.mouseGuiActive?this.buttonGroup.setCurrentFocus(0,0):this.buttonGroup.focusCurrentButton(0,0,false,true);this.gameCodeButton.doStateTransition("DEFAULT");this.followButton.doStateTransition("DEFAULT");this.perfWarning&&this.perfWarning!=localStorage.getItem("ccPerfWarning")&&this.showPerformanceWarning();localStorage.setItem("ccPerfWarning",this.perfWarning)},hide:function(a){this.background.doStateTransition("DEFAULT");this.presetMenu.deactivate();this.doStateTransition("DEFAULT",a);for(var b=
this.buttons.length;b--;)this.buttons[b].doStateTransition("HIDDEN",a);this.changelogButton.doStateTransition("HIDDEN");this.dlcButton&&this.dlcButton.doStateTransition("HIDDEN");this.perfWarnButton&&this.perfWarnButton.doStateTransition("HIDDEN");this.gameCodeButton.doStateTransition("HIDDEN",a);this.followButton.doStateTransition("HIDDEN",a)},checkPerformanceWarning:function(){var a=null;if(ig.soundManager.getSampleRate()>96E3){a=ig.lang.get("sc.gui.title-screen.perform-warn-text.sample-rate");
a=a.replace("[X]",ig.soundManager.getSampleRate())}else ig.nwjsVersion&&ig.nwjsVersion[1]<3E3&&(a=ig.lang.get("sc.gui.title-screen.perform-warn-text.old-nwjs"));this.perfWarning=a},showPerformanceWarning:function(a){if(this.perfWarning||a){a=new sc.CenterMsgBoxGui(a||this.perfWarning,{maxWidth:300,speed:ig.TextBlock.SPEED.IMMEDIATE,textAlign:ig.Font.ALIGN.CENTER},"black",0.9);a.hook.zIndex=1500;ig.gui.addGuiElement(a)}},checkClearSaveFiles:function(){for(var a=ig.storage.slots,b=a.length;b--;){var c=
a[b].getData();if(c.vars&&c.vars.storage&&c.vars.storage.plot&&c.vars.storage.plot.metaSpace>=1)return true}return false},_createButton:function(a,b,c,d,e){a=new sc.ButtonGui(ig.lang.get("sc.gui.title-screen."+a),sc.BUTTON_DEFAULT_WIDTH);a.setPos(12,b);a.setAlign(ig.GUI_ALIGN.X_LEFT,ig.GUI_ALIGN.Y_BOTTOM);a.hook.transitions={DEFAULT:{state:{},time:0.2,timeFunction:KEY_SPLINES.EASE},HIDDEN:{state:{offsetX:-(sc.BUTTON_DEFAULT_WIDTH+12)},time:0.2,timeFunction:KEY_SPLINES.LINEAR}};a.onButtonPress=d;a.doStateTransition("DEFAULT",
true);this.buttonGroup.addFocusGui(a,0,c);this.addChildGui(a);e&&(this.namedButtons[e]=a);this.buttons.push(a);return a.hook.size.y+4},_enterLoadMenu:function(){sc.menu.loadMode=true;sc.menu.setDirectMode(true,sc.MENU_SUBMENU.SAVE);sc.model.enterMenu(true)},_enterOptionsMenu:function(){sc.menu.setDirectMode(true,sc.MENU_SUBMENU.OPTIONS);sc.menu.optionsLocalMode=false;sc.model.enterMenu(true)}})});ig.baked=!0;
ig.module("game.feature.gui.screen.pause-screen").requires("impact.feature.gui.gui","impact.base.image","game.feature.gui.base.button","game.feature.menu.gui.save.save-menu","game.feature.gui.widget.modal-dialog").defines(function(){sc.PauseScreenGui=ig.GuiElementBase.extend({buttonInteract:null,buttonGroup:null,resumeButton:null,skipButton:null,cancelButton:null,toTitleButton:null,saveGameButton:null,optionsButton:null,versionGui:null,infoGui:null,gfx:new ig.Image("media/gui/scanlines.png"),transitions:{DEFAULT:{state:{},
time:0.2,timeFunction:KEY_SPLINES.LINEAR},HIDDEN:{state:{alpha:0},time:0.2,timeFunction:KEY_SPLINES.LINEAR}},_waitForMenu:false,init:function(){this.parent();this.hook.localAlpha=0.8;this.hook.zIndex=100;this.hook.pauseGui=true;this.hook.size.x=ig.system.width;this.hook.size.y=ig.system.height;this.buttonInteract=new ig.ButtonInteractEntry;this.buttonGroup=new sc.ButtonGroup;this.buttonInteract.pushButtonGroup(this.buttonGroup);this.toTitleButton=new sc.ButtonGui(ig.lang.get("sc.gui.pause-screen.to-title"),
sc.BUTTON_DEFAULT_WIDTH);this.toTitleButton.setAlign(ig.GUI_ALIGN.X_RIGHT,ig.GUI_ALIGN.Y_BOTTOM);this.toTitleButton.onButtonPress=function(){ig.canLeavePauseMenu=false;sc.Dialogs.showYesNoDialog(ig.lang.get("sc.gui.dialogs.titleConfirm"),sc.DIALOG_INFO_ICON.QUESTION,function(a){ig.canLeavePauseMenu=true;if(a.data==0){ig.interact.removeEntry(this.buttonInteract);ig.game.gotoTitle()}}.bind(this))}.bind(this);this.skipButton=new sc.ButtonGui(ig.lang.get("sc.gui.pause-screen.skip"),sc.BUTTON_DEFAULT_WIDTH);
this.skipButton.setAlign(ig.GUI_ALIGN.X_RIGHT,ig.GUI_ALIGN.Y_BOTTOM);this.skipButton.onButtonPress=function(){sc.model.startSkip();sc.model.enterRunning()}.bind(this);this.cancelButton=new sc.ButtonGui("CANCEL BUTTON",sc.BUTTON_DEFAULT_WIDTH);this.cancelButton.setAlign(ig.GUI_ALIGN.X_RIGHT,ig.GUI_ALIGN.Y_BOTTOM);this.cancelButton.onButtonPress=function(){ig.canLeavePauseMenu=false;sc.Dialogs.showYesNoDialog(ig.lang.get("sc.gui.dialogs.cancelConfirm"),sc.DIALOG_INFO_ICON.QUESTION,function(a){ig.canLeavePauseMenu=
true;if(a.data==0){ig.interact.removeEntry(this.buttonInteract);sc.model.enterRunning();ig.game.reloadAutosave()}}.bind(this))}.bind(this);this.resumeButton=new sc.ButtonGui(ig.lang.get("sc.gui.pause-screen.resume"),sc.BUTTON_DEFAULT_WIDTH,void 0,void 0,sc.BUTTON_SOUND.back);this.resumeButton.setAlign(ig.GUI_ALIGN.X_RIGHT,ig.GUI_ALIGN.Y_BOTTOM);this.resumeButton.onButtonPress=function(){sc.model.enterRunning()}.bind(this);this.toTitleButton.setPos(3,3);this.saveGameButton=new sc.ButtonGui(ig.lang.get("sc.gui.pause-screen.save-game"),
sc.BUTTON_DEFAULT_WIDTH);this.saveGameButton.setAlign(ig.GUI_ALIGN.X_RIGHT,ig.GUI_ALIGN.Y_BOTTOM);this.saveGameButton.onButtonPress=function(){sc.menu.setDirectMode(true,sc.MENU_SUBMENU.SAVE);sc.model.enterMenu(true)}.bind(this);this.optionsButton=new sc.ButtonGui(ig.lang.get("sc.gui.menu.menu-titles.options"),sc.BUTTON_DEFAULT_WIDTH);this.optionsButton.setAlign(ig.GUI_ALIGN.X_RIGHT,ig.GUI_ALIGN.Y_BOTTOM);this.optionsButton.onButtonPress=function(){sc.menu.setDirectMode(true,sc.MENU_SUBMENU.OPTIONS);
sc.model.enterMenu(true)}.bind(this);this.arenaRestart=new sc.ButtonGui("RESTART BUTTON",sc.BUTTON_DEFAULT_WIDTH);this.arenaRestart.setAlign(ig.GUI_ALIGN.X_RIGHT,ig.GUI_ALIGN.Y_BOTTOM);this.arenaRestart.onButtonPress=function(){ig.canLeavePauseMenu=false;sc.Dialogs.showYesNoDialog(ig.lang.get("sc.gui.arena.dialogs."+(sc.arena.runtime.rush?"restart":"repeat")),sc.DIALOG_INFO_ICON.QUESTION,function(a){ig.canLeavePauseMenu=true;if(a.data==0){sc.arena.setPauseAction(sc.ARENA_PAUSE_ACTIONS.RESTART);sc.model.enterRunning();
ig.bgm.pause("FAST_OUT");sc.arena.runtime.rush?sc.arena.restartCup():sc.arena.startNextRound(false);sc.commonEvents.startCallEvent("arena-teleport")}}.bind(this))}.bind(this);this.arenaLobby=new sc.ButtonGui("\\c[3]"+ig.lang.get("sc.gui.pause-screen.lobby"),sc.BUTTON_DEFAULT_WIDTH);this.arenaLobby.setAlign(ig.GUI_ALIGN.X_RIGHT,ig.GUI_ALIGN.Y_BOTTOM);this.arenaLobby.onButtonPress=function(){ig.canLeavePauseMenu=false;sc.Dialogs.showYesNoDialog(ig.lang.get("sc.gui.arena.dialogs.lobby"),sc.DIALOG_INFO_ICON.QUESTION,
function(a){ig.canLeavePauseMenu=true;if(a.data==0){sc.arena.setPauseAction(sc.ARENA_PAUSE_ACTIONS.LOBBY);sc.model.enterRunning();ig.bgm.pause("MEDIUM_OUT");sc.arena.prepareLobbyReturn();sc.commonEvents.startCallEvent("arena-end-cup")}}.bind(this))}.bind(this);this.versionGui=new sc.TextGui(sc.version.toString(),{font:sc.fontsystem.tinyFont});this.versionGui.setAlign(ig.GUI_ALIGN.X_CENTER,ig.GUI_ALIGN.Y_TOP);this.versionGui.setPos(0,1);this.versionGui.hook.transitions={DEFAULT:{state:{},time:0.2,
timeFunction:KEY_SPLINES.EASE},HIDDEN:{state:{alpha:0},time:0.2,timeFunction:KEY_SPLINES.LINEAR}};this.addChildGui(this.versionGui);var b=ig.lang.get("sc.gui.pause-screen.lang-fix");this.infoGui=new sc.TextGui(b,{font:sc.fontsystem.smallFont});this.infoGui.setAlign(ig.GUI_ALIGN.X_LEFT,ig.GUI_ALIGN.Y_TOP);this.infoGui.setPos(2,1);this.infoGui.hook.transitions={DEFAULT:{state:{},time:0.2,timeFunction:KEY_SPLINES.EASE},HIDDEN:{state:{alpha:0},time:0.2,timeFunction:KEY_SPLINES.LINEAR}};this.addChildGui(this.toTitleButton);
this.addChildGui(this.resumeButton);this.addChildGui(this.saveGameButton);this.addChildGui(this.optionsButton);sc.Model.addObserver(sc.model,this);sc.Model.addObserver(sc.menu,this);this.doStateTransition("HIDDEN",true);if(!this.constructor.PATTERN)this.constructor.PATTERN=this.gfx.createPattern(0,0,64,64,ig.ImagePattern.OPT.REPEAT_X_AND_Y)},updateDrawables:function(b){b.addPattern(this.constructor.PATTERN,0,0,0,0,this.hook.size.x,this.hook.size.y)},modelChanged:function(b,a){if(b==sc.model){if(a==
sc.GAME_MODEL_MSG.SUB_STATE_CHANGED&&!sc.model.isReset()&&sc.model.currentSubState!=sc.GAME_MODEL_SUBSTATE.MENU){var d=sc.menu.directMode?true:sc.model.isPaused();this.doStateTransition(d?"DEFAULT":"HIDDEN");if(d){this.updateButtons(sc.model.prevSubState==sc.GAME_MODEL_SUBSTATE.MENU);ig.interact.addEntry(this.buttonInteract);ig.interact.setBlockDelay(0.2)}else ig.interact.removeEntry(this.buttonInteract)}}else if(b==sc.menu&&a==sc.MENU_EVENT.FULL_MENU_ENTER)this.hook.invisibleUpdate=false},updateButtons:function(b){this.removeChildGui(this.skipButton);
this.removeChildGui(this.cancelButton);this.removeChildGui(this.resumeButton);this.removeChildGui(this.optionsButton);this.removeChildGui(this.saveGameButton);this.removeChildGui(this.toTitleButton);this.removeChildGui(this.arenaRestart);this.removeChildGui(this.arenaLobby);var a=this.buttonGroup.current.y,d=ig.input.mouseGuiActive,b=b?b:false;this.buttonGroup.clear();var c=sc.arena.runtime;if(sc.arena.active&&c&&c.roundStarted&&!c.roundFinished&&!c.roundEndPre&&sc.model.currentState!=sc.GAME_MODEL_STATE.CUTSCENE){this.addChildGui(this.resumeButton);
this.addChildGui(this.optionsButton);this.addChildGui(this.arenaRestart);this.addChildGui(this.arenaLobby);this.buttonGroup.addFocusGui(this.resumeButton,0,0,true);sc.arena.runtime.rush?this.arenaRestart.setText("\\c[3]"+ig.lang.get("sc.gui.pause-screen.restartCup"),true):this.arenaRestart.setText("\\c[3]"+ig.lang.get("sc.gui.pause-screen.restartRound"),true);this.buttonGroup.addFocusGui(this.optionsButton,0,1);this.buttonGroup.addFocusGui(this.arenaRestart,0,2);this.buttonGroup.addFocusGui(this.arenaLobby,
0,3);this.arenaLobby.setPos(3,3);c=this.arenaLobby.hook.size.y;this.resumeButton.setPos(3,c*3+15);this.optionsButton.setPos(3,c*2+11);this.arenaRestart.setPos(3,3+c+4)}else{this.addChildGui(this.toTitleButton);this.addChildGui(this.resumeButton);this.addChildGui(this.saveGameButton);this.addChildGui(this.optionsButton);this.buttonGroup.addFocusGui(this.resumeButton,0,0,true);this.buttonGroup.addFocusGui(this.optionsButton,0,1);this.buttonGroup.addFocusGui(this.saveGameButton,0,2);this.toTitleButton.setPos(3,
3);c=this.toTitleButton.hook.size.y;if(sc.model.currentState==sc.GAME_MODEL_STATE.CUTSCENE&&!sc.model.skipBlock){this.addChildGui(this.skipButton);this.buttonGroup.addFocusGui(this.skipButton,0,3);this.buttonGroup.addFocusGui(this.toTitleButton,0,4);this.skipButton.setPos(3,3+c+4);this.saveGameButton.setPos(3,c*2+11);this.optionsButton.setPos(3,c*3+15);this.resumeButton.setPos(3,c*4+19)}else if(sc.model.cancelButtonText){this.addChildGui(this.cancelButton);this.cancelButton.setText("\\c[1]"+sc.model.cancelButtonText.toString()+
"\\c[0]");this.cancelButton.setWidth(sc.BUTTON_DEFAULT_WIDTH);this.buttonGroup.addFocusGui(this.cancelButton,0,3);this.buttonGroup.addFocusGui(this.toTitleButton,0,4);this.cancelButton.setPos(3,3+c+4);this.saveGameButton.setPos(3,c*2+11);this.optionsButton.setPos(3,c*3+15);this.resumeButton.setPos(3,c*4+19)}else{this.buttonGroup.addFocusGui(this.toTitleButton,0,3);this.saveGameButton.setPos(3,3+c+4);this.optionsButton.setPos(3,c*2+11);this.resumeButton.setPos(3,c*3+15)}if(window.IG_GAME_DEBUG){c=
ig.lang.get("sc.gui.pause-screen.save-game");sc.model.isSaveAllowed()||(c="\\c[4]"+c);this.saveGameButton.setText(c);this.saveGameButton.setWidth(sc.BUTTON_DEFAULT_WIDTH)}else this.saveGameButton.setActive(sc.model.isSaveAllowed())}a>this.buttonGroup.elements[0].length&&(a=0);b||(a=0);if(d){this.buttonGroup.setCurrentFocus(0,a);this.buttonGroup.unfocusCurrentButton();this.optionsButton.unsetFocus()}else this.buttonGroup.focusCurrentButton(0,a,false,true)}});ig.GUI.PauseScreenLabel=ig.GuiElementBase.extend({timer:0,
timerTime:1,gfx:new ig.Image("media/gui/pause_word.png"),transitions:{DEFAULT:{state:{},time:0.5,timeFunction:KEY_SPLINES.LINEAR},HIDDEN:{state:{alpha:0},time:0.5,timeFunction:KEY_SPLINES.LINEAR}},init:function(){this.parent();this.hook.localAlpha=1;this.hook.zIndex=0;this.hook.size.x=this.gfx.width;this.hook.size.y=this.gfx.height},update:function(){this.timer=this.timer+ig.system.actualTick;if(this.timer>=this.timerTime)this.timer=this.timer-this.timerTime;var b=this.timer/this.timerTime;this.hook.localAlpha=
0.4+(b>0.5?1-b:b)*1.6;if(this.hook.localAlpha>1)this.hook.localAlpha=1},updateDrawables:function(b){b.addGfx(this.gfx,0,0,0,0,this.hook.size.x,this.hook.size.y)}})});ig.baked=!0;
ig.module("game.feature.gui.screen.credits-screen").requires("impact.feature.gui.gui").defines(function(){ig.GUI.CreditsScreen=ig.GuiElementBase.extend({_wm:new ig.Config({width:200,attributes:{variable:{_type:"VarName",_info:"Variable that will be set to true when the credits are finished"}},label:function(){return"<b>Credits</b> and set <b>"+this.variable+"</b> to true"}}),credits:{ideaConcept:{title:"sc.gui.credits.ideaConcept",names:["Felix 'Lachsen' Klein","Stefan 'R.D.' Lange"]},mainProgramming:{title:"sc.gui.credits.programming",
names:["Felix 'Lachsen' Klein","Stefan 'R.D.' Lange"]},graphics:{title:"sc.gui.credits.spriteart",names:["Felix 'Lachsen' Klein","Thomas 'T-Free' Fr\u00f6se","Martina Brodehl","Daniel 'The_question' Tillmann"]},conceptart:{title:"sc.gui.credits.conceptart",names:["Fabrice 'Frece' Magdanz","Solacy","Felix 'Lachsen' Klein","Stefan 'R.D.' Lange"]},leveldesign:{title:"sc.gui.credits.leveldesign",names:["Stefan 'R.D.' Lange","Henning 'GFl\u00fcgel' Hartmann","Felix 'Lachsen' Klein"]},sound:{title:"sc.gui.credits.sound",
names:["Florian 'Teflo' Valentin Valerius Ben \n Abdeslam Ben Modeslam Ben Omar Mohammed Abdeslam","Airon","Deniz 'Intero' Akbulut"]},music:{title:"sc.gui.credits.music",names:["Deniz 'Intero' Akbulut "]},betatesters:{title:"sc.gui.credits.betatesters",names:["Jens Meisters","Stefan Links","Lobby","Maximilian Malek","ChronoMoogle","IHeartPieGaming"]},thanks:{title:"sc.gui.credits.thanks",names:["Anna M. Geudert - Lead Mental Support","Josephine Rettig - Cubic Environment Architect","Itaju - High-Level Complaining",
"FamilyJules7X - Musical Coffee Substitute","FlareShard","Steven Sch\u00e4fer","That guy named Steve","Friends and Family","Our Supporters and Fans (You are great!)"]}},timeLine:[],timer:0,timeLineIndex:0,done:false,startCreditsUpdate:false,variable:null,transitions:{DEFAULT:{state:{},time:0,timeFunction:KEY_SPLINES.LINEAR},HIDDEN:{state:{alpha:0},time:0,timeFunction:KEY_SPLINES.LINEAR},ROLL:{state:{offsetY:0},time:0,timeFunction:KEY_SPLINES.LINEAR}},logoGui:null,init:function(b){this.parent();this.hook.zIndex=
80;this.hook.size.x=ig.system.width;this.hook.size.y=ig.system.height;this.variable=b.variable;var a=b=0,d;for(d in this.credits){var c=this.credits[d],e=new sc.TextGui(ig.lang.get(c.title),{speed:ig.TextBlock.SPEED.IMMEDIATE});e.setAlign(ig.GUI_ALIGN.X_CENTER,ig.GUI_ALIGN.Y_TOP);e.hook.transitions={HIDDEN:{state:{scaleY:0},time:0,timeFunction:KEY_SPLINES.LINEAR},DEFAULT:{state:{scaleY:1},time:0.7,timeFunction:KEY_SPLINES.LINEAR}};e.hook.pos.y=b+ig.system.height;e.doStateTransition("HIDDEN",true);
this.addChildGui(e);this.timeLine[a]={};this.timeLine[a].gui=e;this.timeLine[a].time=b/35+3;a++;var f=new ig.ColorGui("#989898",e.hook.size.x+10,1);f.setAlign(ig.GUI_ALIGN.X_CENTER,ig.GUI_ALIGN.Y_TOP);f.hook.transitions={HIDDEN:{state:{scaleX:0},time:0,timeFunction:KEY_SPLINES.LINEAR},DEFAULT:{state:{scaleX:1},time:1,timeFunction:KEY_SPLINES.EASE_OUT}};f.doStateTransition("HIDDEN",true);b=b+(3+e.hook.size.y);f.hook.pos.y=b+ig.system.height;this.addChildGui(f);b=b+4;this.timeLine[a]={};this.timeLine[a].gui=
f;this.timeLine[a].time=b/35+3;a++;for(e=0;e<c.names.length;e++){d=c.names[e].indexOf("sc.gui.credits")==0?ig.lang.get(c.names[e]):c.names[e];f=new sc.TextGui(d,{speed:ig.TextBlock.SPEED.IMMEDIATE,textAlign:ig.Font.ALIGN.CENTER,linePadding:0});f.hook.transitions={HIDDEN:{state:{alpha:0},time:0,timeFunction:KEY_SPLINES.LINEAR},DEFAULT:{state:{alpha:1},time:2,timeFunction:KEY_SPLINES.LINEAR}};f.setAlign(ig.GUI_ALIGN.X_CENTER,ig.GUI_ALIGN.Y_TOP);f.doStateTransition("HIDDEN",true);f.hook.pos.y=b+ig.system.height;
this.addChildGui(f);b=b+(f.hook.size.y+2);this.timeLine[a]={};this.timeLine[a].gui=f;this.timeLine[a].time=b/35+3;a++}b=b+105}b=b+ig.system.height;this.hook.transitions.ROLL.state.offsetY=-b;this.hook.transitions.ROLL.time=b/35;d=new ig.ParallaxGui({parallax:"logo"},this._logoDone.bind(this));d.setAlign(ig.GUI_ALIGN.X_CENTER,ig.GUI_ALIGN.Y_CENTER);this.addChildGui(d);this.logoGui=d},clearCached:function(){this.logoGui.clearCached()},onAttach:function(){this.logoGui.start(true)},update:function(){if(this.startCreditsUpdate)for(this.timer=
this.timer+ig.system.actualTick;this.timeLineIndex<this.timeLine.length&&this.timeLine[this.timeLineIndex].time<=this.timer;){this.timeLine[this.timeLineIndex].gui.doStateTransition("DEFAULT");this.timeLineIndex++}},_logoDone:function(){this.startCreditsUpdate=true;this.doStateTransition("ROLL",false,true,this._setVar.bind(this))},_setVar:function(){this.variable&&ig.vars.set(this.variable,true)}})});ig.baked=!0;
ig.module("game.feature.gui.widget.click-box").requires("impact.base.image","impact.feature.interact.gui.focus-gui","game.feature.interact.button-group").defines(function(){sc.CenterMsgBoxGui=ig.GuiElementBase.extend({transitions:{DEFAULT:{state:{alpha:1},time:0.2,timeFunction:KEY_SPLINES.EASE_OUT},HIDDEN:{state:{alpha:0},time:0.3,timeFunction:KEY_SPLINES.EASE_IN}},bgColor:null,msgBox:null,textGui:null,textDone:false,screenInteract:null,callback:null,init:function(b,a,d,c,e,f){this.parent();this.hook.localAlpha=
c;this.hook.zIndex=f?2E3:90;this.hook.pauseGui=f;this.hook.temporary=true;this.hook.size.x=ig.system.width;this.hook.size.y=ig.system.height;this.textGui=new sc.TextGui(b,a);this.bgColor=d;this.msgBox=new sc.CenterBoxGui(this.textGui);this.msgBox.setAlign(ig.GUI_ALIGN.X_CENTER,ig.GUI_ALIGN.Y_CENTER);this.addChildGui(this.msgBox);this.doStateTransition("HIDDEN",true);this.doStateTransition("DEFAULT");this.textGui.textBlock.onFinish=this._onTextFinish.bind(this);this.textDone=this.textGui.textBlock.isFinished();
this.callback=e;this.screenInteract=new sc.ScreenInteractEntry(this);ig.system.skipMode||ig.interact.addEntry(this.screenInteract)},setBoxOffset:function(b,a){this.msgBox.hook.pos.x=b;this.msgBox.hook.pos.y=a},_onTextFinish:function(){this.textDone=true},onInteraction:function(){if(this.textDone){ig.interact.removeEntry(this.screenInteract);this._close()}else this.textGui.finish()},_close:function(){this.msgBox.doStateTransition("HIDDEN");this.doStateTransition("HIDDEN",false,true);this.callback&&
this.callback()},update:function(){!this.hook.removeAfterTransition&&(this.textDone&&ig.system.skipMode)&&this._close();this.parent()},updateDrawables:function(b){this.bgColor&&b.addColor(this.bgColor,0,0,this.hook.size.x,this.hook.size.y)}})});ig.baked=!0;
ig.module("game.feature.gui.widget.gamepad-box").requires("impact.base.image","impact.feature.gui.gui").defines(function(){ig.GUI.GamepadBox=ig.GuiElementBase.extend({transitions:{DEFAULT:{state:{alpha:1},time:0,timeFunction:KEY_SPLINES.EASE_OUT},HIDDEN:{state:{alpha:1},time:0.3,timeFunction:KEY_SPLINES.EASE_IN}},gfx:new ig.Image("media/gui/buttons.png"),infoButton:null,text:null,gamepadActive:false,init:function(b,a,d){this.parent();this.setSize(180,26);this.hook.zIndex=90;this.infoButton=new sc.ButtonGui("?",
28);this.infoButton.setPos(1,1);this.infoButton.setAlign(ig.GUI_ALIGN.X_RIGHT,ig.GUI_ALIGN.Y_BOTTOM);this.infoButton.onButtonPress=function(){var a=ig.lang.get("sc.gui.gamepad-box.info-title")+"\n\n"+ig.lang.get("sc.gui.gamepad-box.info-text"),a=new sc.CenterMsgBoxGui(a,{maxWidth:300,speed:ig.TextBlock.SPEED.IMMEDIATE},"black",0.9);a.hook.zIndex=1500;ig.gui.addGuiElement(a)}.bind(this);b.addFocusGui(this.infoButton,a,d);this.addChildGui(this.infoButton);this.text=new sc.TextGui(ig.lang.get("sc.gui.gamepad-box.not-connected"),
{maxWidth:105,speed:ig.TextBlock.SPEED.SLOW});this.text.setAlign(ig.GUI_ALIGN.X_CENTER,ig.GUI_ALIGN.Y_CENTER);this.text.setPos(4,0);this.addChildGui(this.text)},varsChanged:function(){if(!this.gamepadActive&&ig.input.currentDevice==ig.INPUT_DEVICES.GAMEPAD){this.gamepadActive=true;this.text.setText(ig.lang.get("sc.gui.gamepad-box.connected"))}},updateDrawables:function(b){b.addGfx(this.gfx,0,0,0,160,this.hook.size.x,this.hook.size.y)}})});ig.baked=!0;
ig.module("game.feature.gui.widget.counter-hud").requires("game.feature.gui.hud.right-hud","impact.feature.gui.base.basic-gui","impact.base.image").defines(function(){ig.GUI.CounterHud=sc.RightHudBoxGui.extend({maxCount:0,currentCount:0,variable:null,zIndex:101,_wm:new ig.Config({width:500,attributes:{taskTitle:{_type:"LangLabel",_info:"Text to describe task"},maxCount:{_type:"NumberExpression",_info:"Maximum count to reach"},variable:{_type:"VarName",_info:"Variable that stores current hit count"}}}),
maxNumberGui:null,init:function(b){this.parent(new ig.LangLabel(b.taskTitle));this.maxCount=b.maxCount;this.variable=b.variable;this.currentCount=ig.vars.get(this.variable);this.maxNumberGui=new sc.MaxNumberGui(ig.Event.getExpressionValue(this.maxCount),0);this.maxNumberGui.setNumber(this.currentCount);this.pushContent(this.maxNumberGui,true)},varsChanged:function(){this.updateNumber()},updateNumber:function(){var b=ig.Event.getExpressionValue(this.maxCount);b!=this.maxNumberGui.getMaxNumber&&this.maxNumberGui.setMaxNumber(b);
if(b>0){b=ig.vars.get(this.variable);if(b!=this.currentCount){this.currentCount=b;this.maxNumberGui.setNumber(this.currentCount)}}},remove:function(){sc.Model.removeObserver(sc.model,this);this.parent()},modelChanged:function(b,a){if(a==sc.GAME_MODEL_MSG.SUB_STATE_CHANGED||a==sc.GAME_MODEL_MSG.STATE_CHANGED)b.isQuickMenu()||b.isCutscene()?this.hide():this.show()},onSpawn:function(){sc.Model.addObserver(sc.model,this);this.updateNumber()}});ig.GUI.CounterHud.spawnHandler=function(b){sc.gui.rightHudPanel.addHudBoxBefore(b,
sc.gui.moneyHud);b.onSpawn&&b.onSpawn();b.show()};ig.GUI.ScoreHud=sc.RightHudBoxGui.extend({currentCount:0,variable:null,zIndex:101,_wm:new ig.Config({width:500,attributes:{taskTitle:{_type:"LangLabel",_info:"Text to describe score"},variable:{_type:"VarName",_info:"Variable that stores value"},maxValue:{_type:"Number",_info:"Max Number to display (value can still be higher)"},time:{_type:"Number",_info:"Transition time for the score value when counting up and down",_optional:true,_default:0.2},signed:{_type:"Boolean",
_info:"If true, also allow negative numbers",_optional:true,_default:true},useDots:{_type:"Boolean",_info:"If true, use dots every 3 digits of the number",_optional:true,_default:true}}}),numberGui:null,_cutscene:false,init:function(b){this.parent(new ig.LangLabel(b.taskTitle));this.variable=b.variable;this._cutscene=b.cutsceneOkay||false;this.currentCount=ig.vars.get(this.variable);this.numberGui=new sc.NumberGui(b.maxValue||9999999,{transitionTime:b.time||0,signed:b.signed||false,dots:b.useDots||
false});this.numberGui.setNumber(this.currentCount);this.pushContent(this.numberGui,true)},varsChanged:function(){var b=ig.vars.get(this.variable);if(b!=this.currentCount){this.currentCount=b;this.numberGui.setNumber(this.currentCount)}},remove:function(){sc.Model.removeObserver(sc.model,this);this.parent()},modelChanged:function(b,a){if(a==sc.GAME_MODEL_MSG.SUB_STATE_CHANGED||a==sc.GAME_MODEL_MSG.STATE_CHANGED)b.isQuickMenu()||b.isCutscene()?this._cutscene?this.show():this.hide():this.show()},onSpawn:function(){sc.Model.addObserver(sc.model,
this)}});ig.GUI.ScoreHud.spawnHandler=function(b){sc.gui.rightHudPanel.addHudBoxBefore(b,sc.gui.moneyHud);b.onSpawn&&b.onSpawn();b.show()}});ig.baked=!0;
ig.module("game.feature.gui.widget.information").requires("game.feature.gui.base.boxes","impact.feature.gui.gui","impact.feature.gui.base.basic-gui","impact.base.image","impact.base.lang","game.feature.gui.base.boxes").defines(function(){ig.GUI.Information=sc.SideBoxGui.extend({text:null,altText:null,altCondition:null,_wm:new ig.Config({width:500,attributes:{text:{_type:"LangLabel",_info:"Text to display in information.",_large:true},altText:{_type:"LangLabel",_info:"Alternative text to display",
_large:true,_optional:true},altCondition:{_type:"VarCondition",_info:"Condition for alternative text",_default:"false"}}}),useAltText:false,textGui:null,hidden:false,init:function(b){this.parent(true,ig.lang.get("sc.gui.information.title"));this.hook.zIndex=99;this.hook.pauseGui=true;this.text=new ig.LangLabel(b.text);if(b.altText){this.altText=new ig.LangLabel(b.altText);this.altCondition=new ig.VarCondition(b.altCondition)}this.textGui=new sc.TextGui(this.text,{maxWidth:200});this.pushContent(this.textGui);
this.updateText();this.setPos(0,3);this.setAlign(ig.GUI_ALIGN.X_RIGHT,ig.GUI_ALIGN.Y_BOTTOM)},onAttach:function(){sc.Model.addObserver(sc.model,this);this.show()},onDetach:function(){sc.Model.removeObserver(sc.model,this)},updateText:function(){if(this.altCondition&&this.altCondition.evaluate()!=this.useAltText){this.useAltText=!this.useAltText;this.textGui.setText(this.useAltText?this.altText:this.text);this.replaceContent(0,this.textGui);this.hide(true);this.show()}},modelChanged:function(b,a){if(a==
sc.GAME_MODEL_MSG.STATE_CHANGED||a==sc.GAME_MODEL_MSG.SUB_STATE_CHANGED)!this.hidden&&b.isGame()&&!b.isPaused()&&!b.isMenu()&&!b.isQuickMenu()&&!b.isLevelUp()&&!b.isQuestSolved()?this.show():this.hide()},varsChanged:function(){this.updateText()},remove:function(){this.parent()}})});ig.baked=!0;
ig.module("game.feature.combat.gui.hp-bar-boss").requires("impact.feature.gui.gui","impact.feature.gui.base.box").defines(function(){function b(a,b){return a.barOrder-b.barOrder}function a(a){for(var b=c.length,g=(ig.system.width-d*2)/b,h=d,i=0;i<b;++i){var j=c[i];j.updatePlacement(h,g,a==j);h=h+g}sc.model.message.setBottomGap(b?14:0)}var d=2;Vec2.create();sc.BigGenericBar=ig.GuiElementBase.extend({gfx:new ig.Image("media/gui/status-gui.png"),ninepatchOuter:new ig.NinePatch("media/gui/status-gui.png",
{width:12,height:0,left:10,top:11,right:10,bottom:0,offsets:{"default":{x:0,y:213}}}),ninepatchInner:new ig.NinePatch("media/gui/status-gui.png",{width:12,height:0,left:6,top:7,right:6,bottom:0,offsets:{"default":{x:32,y:215}}}),currentValue:0,targetValue:0,flowValue:0,maxValue:0,timer:0,splits:[],leftOffset:null,init:function(a,b,c){this.parent();this.leftOffset=a;this.lowerColor=c;this.upperColor=b;this.hook.zIndex=0;this.hook.invisibleUpdate=true},setMaxValue:function(a){this.maxValue=a;if(this.currentValue>
this.maxValue)this.currentValue=this.maxValue},setValue:function(a,b,c){if(a>this.maxValue)a=this.maxValue;if(this.targetValue!=a){this.timer=0.75;if((this.targetValue-this.currentValue)*(a-this.targetValue)<0)this.flowValue=a;this.targetValue=a;if(this.targetValue<0)this.targetValue=0;if(b){this.flowValue=this.targetValue;this.timer=0}if(c)this.currentValue=this.targetValue}},update:function(){if(this.timer>0){this.timer=this.timer-ig.system.tick;if(this.timer<=0)this.flowValue=this.targetValue}if(this.flowValue!=
this.currentValue){var a=ig.system.actualTick*this.maxValue/4;if(this.currentValue>this.flowValue)this.currentValue=Math.max(this.flowValue,this.currentValue-a);else if(this.currentValue<this.flowValue)this.currentValue=Math.min(this.flowValue,this.currentValue+a)}},updateDrawables:function(a){var b=this.hook;this.ninepatchOuter.draw(a,b.size.x,b.size.y,"default");var c=this.maxValue,d=b.size.y-4,i=this.leftOffset+12,b=b.size.x-i-12-d+1;this.ninepatchInner.draw(a,b+d-1,d,"default",i,2);var j=Math.round(b*
Math.min(this.targetValue,this.currentValue)/c),k=Math.round(b*Math.max(this.targetValue,this.currentValue)/c);j&&this.updateBarDraw(a,i,j,this.upperColor,this.lowerColor,d);k!=j&&this.updateBarDraw(a,i+j,k-j,"white","white",d);c=Math.max(this.targetValue,this.currentValue)/c;for(d=this.splits.length;d--;){j=Math.round(this.splits[d]*b)-10;a.addGfx(this.gfx,i+j,0,56+(this.splits[d]>c?24:0),213,24,11)}},updateBarDraw:function(a,b,c,d,i,j){for(var k=2,b=b+j-1,l=Math.ceil(j/2);j--;){a.addColor(j>=l?
d:i,b,k,c,1);k++;b--}}});sc.BigHpBar=sc.BigGenericBar.extend({transitions:{DEFAULT:{state:{},time:0.25,timeFunction:KEY_SPLINES.EASE_OUT},CUTSCENE:{state:{offsetY:20},time:0.25,timeFunction:KEY_SPLINES.EASE_OUT},HIDDEN:{state:{scaleX:1,scaleY:0},time:0.25,timeFunction:KEY_SPLINES.EASE_IN},HIDDEN_CUTSCENE:{state:{scaleX:1,scaleY:0,offsetY:20},time:0.25,timeFunction:KEY_SPLINES.EASE_IN}},target:null,init:function(a,b){this.parent(b,"#ff7a7a","#d71112");this.target=a;sc.Model.addObserver(sc.model,this);
sc.Model.addObserver(sc.model.message,this);this.doStateTransition("HIDDEN",true);this._isHpBarVisible()&&(sc.model.isCutscene()?this.doStateTransition("CUTSCENE"):this.doStateTransition("DEFAULT"))},initWithParams:function(){this.setMaxValue(this.target.params.getStat("hp"));this.setValue(this.target.params.currentHp,true);this.updateSplits();sc.Model.addObserver(this.target.params,this)},_isHpBarVisible:function(){return this.target.visibility.hpBar==sc.ENEMY_HP_BAR.VISIBLE?true:this.target.visibility.hpBar==
sc.ENEMY_HP_BAR.HIDDEN?false:this.target.aggression!=sc.ENEMY_AGGRESSION.PEACEFUL},modelChanged:function(a){if(!this.hook.removeAfterTransition)if(a instanceof sc.GameModel||a instanceof sc.MessageModel)this._isHpBarVisible()&&(sc.model.isCutscene()?this.doStateTransition(sc.model.message.hasPerson()?"HIDDEN_CUTSCENE":"CUTSCENE"):this.doStateTransition("DEFAULT"));else{this.setMaxValue(this.target.params.getStat("hp"));this.setHp(this.target.params.currentHp)}},setHp:function(a){this.setValue(a);
this.updateSplits()},updateSplits:function(){if(this.target){var a=this.target.enemyType.hpBreaks,b=a.length;for(this.splits.length=0;b-- >this.target.hpBreakReached;)this.splits.push(a[b].hp)}},update:function(){if(!this.hook.removeAfterTransition)if(this._isHpBarVisible())sc.model.isCutscene()?this.doStateTransition(sc.model.message.hasPerson()?"HIDDEN_CUTSCENE":"CUTSCENE"):this.doStateTransition("DEFAULT");else{this.doStateTransition("HIDDEN");return}this.parent()},remove:function(){this.target.params&&
sc.Model.removeObserver(this.target.params,this);sc.Model.removeObserver(sc.model,this);sc.Model.removeObserver(sc.model.message,this);this.doStateTransition("HIDDEN",false,true)},forceRemove:function(){this.target.params&&sc.Model.removeObserver(this.target.params,this);sc.Model.removeObserver(sc.model,this);this.doStateTransition("HIDDEN",true,true)}});sc.SUB_HP_EDITOR={};var c=[];sc.SUB_HP_EDITOR.BOSS=sc.BigHpBar.extend({labelGui:null,listed:false,barOrder:0,init:function(a){this.labelGui=new sc.TextGui("Boss",
{font:sc.fontsystem.tinyFont});this.labelGui.setPos(12,2);this.parent(a,this.labelGui.hook.size.x+4);this.addChildGui(this.labelGui);this.setSize(ig.system.width-d*2,11);this.setPivot(this.hook.size.x/2,5.5);this.setAlign(ig.GUI_ALIGN.X_LEFT,ig.GUI_ALIGN.Y_BOTTOM);this.setPos(d,4)},initWithParams:function(){var a=ig.LangLabel.getText(this.target.enemyType.bossLabel);this.barOrder=this.target.enemyType.bossOrder;this.labelGui.setText(a);this.leftOffset=this.labelGui.hook.size.x+4;this.parent()},update:function(){if(this.hook.currentStateName!=
"HIDDEN"&&!this.listed){this.listed=true;c.push(this);c.sort(b);a(this)}else if(this.hook.currentStateName=="HIDDEN"&&this.listed){this.listed=false;c.erase(this);a()}this.parent()},onDetach:function(){if(this.listed){this.listed=false;c.erase(this);a()}},updatePlacement:function(a,b){this.setSize(b,11);this.setPivot(b/2,5.5);this.setPos(a,4)}});sc.SUB_HP_EDITOR.PVP=sc.BigHpBar.extend({heads:new ig.Image("media/gui/severed-heads.png"),spBGPatch:new ig.NinePatch("media/gui/status-gui.png",{width:13,
height:0,left:7,top:7,right:7,bottom:0,offsets:{"default":{x:0,y:128}}}),init:function(a){this.parent(a,4);this.setSize(ig.system.width/3,9);this.setPivot(this.hook.size.x/2,this.hook.size.y/2);this.setAlign(ig.GUI_ALIGN.X_RIGHT,ig.GUI_ALIGN.Y_BOTTOM);this.setPos(d,4);this.spBar=new sc.SpMiniHudGui(a.params);this.spBar.setPos(12,-6);this.addChildGui(this.spBar)},updateDrawables:function(a){this.parent(a);this.spBGPatch.draw(a,36,7,"default",4,-8);a.addGfx(this.gfx,-15,-13,231,175,25,25);var b=this.target.getHeadIdx();
a.addGfx(this.heads,-14,-16,b*24,0,24,24)}})});ig.baked=!0;
ig.module("game.feature.gui.widget.bar-widget").requires("game.feature.gui.base.boxes","impact.feature.gui.gui","impact.feature.gui.base.basic-gui","impact.base.image","impact.base.lang","game.feature.gui.base.boxes","game.feature.combat.gui.hp-bar-boss").defines(function(){var b={FILL:1,EMPTY:2},a={RED:{upper:"#ff7a7a",lower:"#d71112"},GREEN:{upper:"#96f766",lower:"#25b000"},BLUE:{upper:"#66bef7",lower:"#0057b0"}};ig.GUI.BarWidget=sc.BigGenericBar.extend({transitions:{DEFAULT:{state:{},time:0.25,
timeFunction:KEY_SPLINES.EASE_OUT},CUTSCENE:{state:{offsetY:20},time:0.25,timeFunction:KEY_SPLINES.EASE_OUT},HIDDEN:{state:{scaleX:1,scaleY:0},time:0.25,timeFunction:KEY_SPLINES.EASE_IN}},_wm:new ig.Config({width:500,attributes:{text:{_type:"LangLabel",_info:"Text to display infront of widget.",_large:true},variable:{_type:"VarName",_info:"Variable from which to fetch the value"},maxValue:{_type:"Number",_info:"Maximum value of bar"},barType:{_type:"String",_info:"Type of Bar. EMPTY => is empty when value=maxValue",
_select:b},color:{_type:"String",_info:"Color of Bar",_select:a},position:{_type:"Number",_info:"Position of bar. 0 = bottom most bar. 1= one bar above",_default:0},splits:{_type:"NumberArray",_info:"Splits added to the bar. Each value a number between 0-1.",_optional:true},hideWhite:{_type:"Boolean",_info:"True if the bar should not have the white total damage bar",_optional:true},instant:{_type:"Boolean",_info:"True if the value should be the max value immediately",_optional:true}}}),labelGui:null,
variable:null,barType:null,prevValue:-1,hideWhite:false,init:function(d){var c=new ig.LangLabel(d.text);this.labelGui=new sc.TextGui(c.toString(),{font:sc.fontsystem.tinyFont});this.labelGui.setPos(12,2);c=a[d.color]||a.RED;this.parent(this.labelGui.hook.size.x+4,c.upper,c.lower);this.addChildGui(this.labelGui);this.setSize(ig.system.width/2,11);this.setPivot(this.hook.size.x/2,5.5);this.setAlign(ig.GUI_ALIGN.X_RIGHT,ig.GUI_ALIGN.Y_BOTTOM);this.setPos(2,4+16*(d.position||0));this.variable=d.variable;
this.barType=b[d.barType];this.hideWhite=d.hideWhite||false;if(d.splits)this.splits=d.splits;this.setMaxValue(d.maxValue);d.instant&&this.setValue(d.maxValue,true)},onAttach:function(){sc.Model.addObserver(sc.model,this);this.doStateTransition("HIDDEN",true);this.doStateTransition(sc.model.isCutscene()?"CUTSCENE":"DEFAULT");this.updateValue(true)},onDetach:function(){sc.Model.removeObserver(sc.model,this)},modelChanged:function(a,b){a instanceof sc.GameModel&&b==sc.GAME_MODEL_MSG.STATE_CHANGED&&(a.isCutscene()?
this.doStateTransition("CUTSCENE"):this.doStateTransition("DEFAULT"))},updateValue:function(a,c){var e=ig.vars.get(this.variable);if(e!=this.prevValue){this.prevValue=e;this.barType==b.EMPTY&&(e=this.maxValue-e);this.setValue(e,a,c)}},varsChanged:function(){this.updateValue(this.hideWhite,this.hideWhite)},remove:function(){this.doStateTransition("HIDDEN",false,true)}})});ig.baked=!0;
ig.module("game.feature.gui.widget.indiegogo-gui").requires("impact.feature.gui.gui","impact.feature.interact.gui.focus-gui","impact.feature.gui.base.box").defines(function(){sc.INDIEGOGO_FETCH_URL="http://www.cross-code.com/page/api/get-indiegogo-data.php";sc.IndiegogoGui=ig.GuiElementBase.extend({transitions:{DEFAULT:{state:{},time:0.2,timeFunction:KEY_SPLINES.EASE_IN},HIDDEN:{state:{alpha:0,offsetY:-20},time:0.2,timeFunction:KEY_SPLINES.EASE_OUT}},button:null,goalListGui:null,goalsData:null,active:false,
init:function(){this.parent();this.setSize(158,93);this.button=new sc.IndiegogoButton(this.onBarFilled.bind(this));this.addChildGui(this.button);this.goalListGui=new sc.IndiegogoGoalList;this.goalListGui.setAlign(ig.GUI_ALIGN.X_LEFT,ig.GUI_ALIGN.Y_BOTTOM);this.goalListGui.setPos(0,94);this.addChildGui(this.goalListGui)},setData:function(a){this.goalsData=a.goals;this.button.setData(a);this.goalListGui.setData(a.goals);this.active&&this.doStateTransition("DEFAULT")},onBarFilled:function(a){this.goalListGui.setReachedGoal(a)},
update:function(){this.goalListGui.setViewAll(this.button.focus)},show:function(){this.active=true;$.ajax({url:sc.INDIEGOGO_FETCH_URL,type:"GET",dataType:"json",async:true,success:this._dataResponse.bind(this)})},_dataResponse:function(a){this.setData(a)},hide:function(a){this.active=false;this.doStateTransition("HIDDEN",a)}});sc.IndiegogoButton=ig.FocusGui.extend({gfx:new ig.Image("media/gui/indiegogo.png"),highlight:null,daysGui:null,fundBar:null,actionText:null,init:function(a){this.parent();this.setSize(158,
93);this.highlight=new sc.IndiegogoButtonHighlight;this.addChildGui(this.highlight);var b=new sc.TextGui("days\nleft!",{font:sc.fontsystem.tinyFont});b.setAlign(ig.GUI_ALIGN.X_RIGHT,ig.GUI_ALIGN.Y_TOP);b.setPos(10,8);this.addChildGui(b);this.daysGui=new sc.NumberGui(99,{size:sc.NUMBER_SIZE.LARGE,transitionTime:3});this.daysGui.setAlign(ig.GUI_ALIGN.X_RIGHT,ig.GUI_ALIGN.Y_TOP);this.daysGui.setPos(37,9);this.addChildGui(this.daysGui);b=new sc.TextGui("fund-o-meter",{font:sc.fontsystem.tinyFont});b.setAlign(ig.GUI_ALIGN.X_RIGHT,
ig.GUI_ALIGN.Y_BOTTOM);b.setPos(9,27);this.addChildGui(b);this.fundBar=new sc.IndiegogoFundBar(a);this.fundBar.setAlign(ig.GUI_ALIGN.X_LEFT,ig.GUI_ALIGN.Y_BOTTOM);this.fundBar.setPos(5,23);this.addChildGui(this.fundBar);this.actionText=new sc.TextGui("",{font:sc.fontsystem.font,speed:ig.TextBlock.SPEED.NORMAL});this.actionText.setAlign(ig.GUI_ALIGN.X_CENTER,ig.GUI_ALIGN.Y_BOTTOM);this.actionText.setPos(0,3);this.addChildGui(this.actionText)},setData:function(a){this.fundBar.setData(a.goals,a.current);
this.daysGui.setNumber(a.days,true);this.actionText.setText(a.callToAction||"Make it happen!")},update:function(){this.highlight.doStateTransition(this.focus?"DEFAULT":"HIDDEN")},updateDrawables:function(a){var b=this.hook;a.addGfx(this.gfx,0,0,0,0,b.size.x,b.size.y)},onButtonPress:function(){sc.BUTTON_SOUND.submit.play();window.SHOW_INDIEGOGO&&window.SHOW_INDIEGOGO()}});sc.IndiegogoButtonHighlight=ig.BoxGui.extend({ninepatch:new ig.NinePatch("media/gui/indiegogo.png",{width:8,height:8,left:8,top:8,
right:8,bottom:8,offsets:{"default":{x:184,y:0}}}),transitions:{DEFAULT:{state:{},time:0.1,timeFunction:KEY_SPLINES.LINEAR},HIDDEN:{state:{alpha:0},time:0.1,timeFunction:KEY_SPLINES.LINEAR}},init:function(){this.parent(158,93,false)}});sc.IndiegogoFundBar=ig.GuiElementBase.extend({gfx:new ig.Image("media/gui/indiegogo.png"),filledCallback:null,fundingGoals:null,value:0,maxValue:0,fillCount:0,fadeTimer:0,beepSound:new ig.Sound("media/sound/hud/dialog-beep-2.ogg",0.5),beepTimer:0,init:function(a){this.parent();
this.setSize(148,5);this.filledCallback=a},setData:function(a,b){this.fundingGoals=a;this.maxValue=b;this.fillCount=this.value=0},update:function(){if(this.fundingGoals){var a=this.fundingGoals[this.fillCount].money-(this.fillCount?this.fundingGoals[this.fillCount-1].money:0);if(this.value<this.maxValue){this.value=this.value+Math.min(a*1,4E4)*ig.system.actualTick;if(this.value>=this.maxValue){this.value=this.maxValue;this.beepSound.play(null)}else{this.beepTimer=this.beepTimer+ig.system.actualTick;
if(this.beepTimer>0.05){this.beepTimer=this.beepTimer-0.05;a=0.2+0.8*(Math.log(this.value/5)/13);this.beepSound.play(null,{speed:a})}}}for(a=this.fundingGoals.length;a--;)if(this.fundingGoals[a].money<=this.value)break;a++;if(a>this.fillCount){this.fillCount=a;this.filledCallback(a);this.fadeTimer=0.4}if(this.fadeTimer>0)this.fadeTimer=this.fadeTimer-ig.system.actualTick}},updateDrawables:function(a){if(this.fundingGoals){var b=this.fillCount?this.fundingGoals[this.fillCount-1].money:0,d=this.hook,
g=Math.floor(d.size.x*((this.value-b)/(this.fundingGoals[this.fillCount].money-b)%1));if(this.fadeTimer>0){b=this.fillCount%2?112:120;a.addGfx(this.gfx,0,0,0,b,d.size.x,d.size.y).setAlpha(this.fadeTimer/0.4)}b=this.fillCount%2?120:112;a.addGfx(this.gfx,0,0,0,b,g,d.size.y)}}});var b={x:160,y:16},a={x:160,y:24},d={x:160,y:32};sc.IndiegogoGoal=ig.BoxGui.extend({gfx:new ig.Image("media/gui/indiegogo.png"),ninepatch:new ig.NinePatch("media/gui/indiegogo.png",{width:16,height:8,left:4,top:4,right:4,bottom:4,
offsets:{"default":{x:160,y:0}}}),transitions:{DEFAULT:{state:{},time:0.2,timeFunction:KEY_SPLINES.LINEAR},FADE_1:{state:{alpha:0.9},time:0.2,timeFunction:KEY_SPLINES.LINEAR},FADE_2:{state:{alpha:0.75},time:0.2,timeFunction:KEY_SPLINES.LINEAR},FADE_3:{state:{alpha:0.5},time:0.2,timeFunction:KEY_SPLINES.LINEAR},FADE_4:{state:{alpha:0.2},time:0.2,timeFunction:KEY_SPLINES.LINEAR},HIDDEN:{state:{alpha:0},time:0.2,timeFunction:KEY_SPLINES.LINEAR}},fade:1,icon:null,init:function(a){a=new sc.TextGui(a,{font:sc.fontsystem.tinyFont,
maxWidth:138});a.setPos(16,2);this.parent(158,4+a.hook.size.y-1,false);this.addChildGui(a);this.icon=new ig.ImageGui;this.icon.setAlign(ig.GUI_ALIGN.X_LEFT,ig.GUI_ALIGN.Y_CENTER);this.icon.setPos(4,0);this.addChildGui(this.icon);this.setGoalState(b);this.hook.localAlpha=0.9},setGoalState:function(a){this.icon.setImage(this.gfx,a.x,a.y,10,8)}});sc.IndiegogoGoalList=ig.GuiElementBase.extend({goalGuis:[],viewAllMode:false,reachedGoal:0,init:function(){this.parent();this.setSize(158,0)},setData:function(a){this.removeAllChildren();
for(var b=this.reachedGoal=this.goalGuis.length=0;b<a.length;++b){var d=new sc.IndiegogoGoal(a[b].text);this.goalGuis.push(d);d.setAlign(ig.GUI_ALIGN.X_CENTER,ig.GUI_ALIGN.Y_BOTTOM);this.addChildGui(d)}this.updateList()},updateList:function(){for(var c=this.goalGuis.length,e=0;c--;){var f=this.goalGuis[c];f.doPosTranstition(0,e,0.2);var g=b;c<this.reachedGoal?g=d:c==this.reachedGoal&&(g=a);f.setGoalState(g);if(this.viewAllMode||c<=this.reachedGoal)e=e+(f.hook.size.y+1);g="DEFAULT";if(!this.viewAllMode)if(c>
this.reachedGoal)g="HIDDEN";else if(c<this.reachedGoal-5){g=this.reachedGoal-5-c;g=g>4?"HIDDEN":"FADE_"+g}f.doStateTransition(g)}},setViewAll:function(a){if(this.viewAllMode!=a){this.viewAllMode=a;this.updateList()}},setReachedGoal:function(a){this.reachedGoal=a;this.updateList()}})});ig.baked=!0;
ig.module("game.feature.gui.widget.level-up-hud").requires("impact.feature.gui.gui","impact.feature.gui.base.basic-gui","game.feature.gui.base.boxes","impact.base.image").defines(function(){var b=["level","cp","hp","attack","defense","focus"];sc.LevelUpContentGui=ig.GuiElementBase.extend({gfx:new ig.Image("media/gui/status-gui.png"),arrowTimer:0,init:function(){this.parent();this.setSize(136,20)},update:function(){if(this.arrowTimer<1.5){this.arrowTimer=this.arrowTimer+ig.system.actualTick;if(this.arrowTimer>
1.5)this.arrowTimer=1.5}},updateDrawables:function(a){a.addGfx(this.gfx,1,0,0,192,112,20);var b=this.arrowTimer/1.5,b=KEY_SPLINES.EASE_OUT.get(b),b=b*12%1,c=0,c=0,e=20,c=Math.round(b*20);(e=e-c)&&a.addGfx(this.gfx,113,0,112,192+c,23,e);e=20;c=Math.round((1-b)*20);(e=e-c)&&a.addGfx(this.gfx,113,c,112,192,23,e)}});sc.LevelUpSideStatsGui=sc.SideBoxGui.extend({deltaValues:null,init:function(a){this.parent(true,ig.lang.get("sc.gui.levelup.title"));this.hook.zIndex=99;this.hook.pauseGui=true;this.deltaValues=
a.deltaValues;for(var a=178,d=b.length;d--;)this.deltaValues[b[d]]||(a=a+22);this.setPos(0,a);this.setAlign(ig.GUI_ALIGN.X_RIGHT,ig.GUI_ALIGN.Y_TOP);this.show()},addDeltaEntry:function(a){if(!this.deltaValues[a])return false;var b=ig.lang.get("sc.gui.levelup."+a),c=Math.min(0.5,this.deltaValues[a]*0.07),b=new sc.LabeledNumberGuy(b,60,9999,{signed:true,showPlus:true,transitionTime:c});b.setNumber(this.deltaValues[a],false);this.pushContent(b,true);return true}});ig.GUI.LevelUpHud=ig.SimpleGui.extend({transitions:{DEFAULT:{state:{alpha:1},
time:0.5,timeFunction:KEY_SPLINES.EASE_OUT},HIDDEN:{state:{alpha:1},time:0.5,timeFunction:KEY_SPLINES.EASE_IN}},screenInteract:null,currentEntry:0,timer:0,sideStatGui:null,lineBox:null,init:function(a){this.parent(true,ig.lang.get("sc.gui.levelup.title"));this.setSize(ig.system.width,ig.system.height);this.sideStatGui=new sc.LevelUpSideStatsGui(a);this.addChildGui(this.sideStatGui);a=new sc.LevelUpContentGui;this.lineBox=new sc.LineBoxGui(a,32);this.lineBox.setPos(0,100);this.addChildGui(this.lineBox);
this.screenInteract=new sc.ScreenInteractEntry(this);ig.interact.addEntry(this.screenInteract);ig.vars.set("tmp._levelUpFinished",false)},update:function(){if(this.currentEntry<b.length){this.timer=this.timer-ig.system.actualTick;if(this.timer<=0){do{var a=this.sideStatGui.addDeltaEntry(b[this.currentEntry]);this.currentEntry++}while(this.currentEntry<b.length&&!a);this.timer=0.5}}},onInteraction:function(){if(this.currentEntry<b.length)this.timer=0;else{ig.vars.set("tmp._levelUpFinished",true);ig.interact.removeEntry(this.screenInteract);
this.remove()}},remove:function(){this.lineBox.doStateTransition("HIDDEN",false,true);this.sideStatGui.remove();this.doStateTransition("HIDDEN",false,true)}})});ig.baked=!0;
ig.module("game.feature.gui.widget.social").requires("impact.feature.gui.gui","impact.feature.gui.base.basic-gui","impact.base.image").defines(function(){ig.GUI.Social=ig.SimpleGui.extend({transitions:{DEFAULT:{state:{alpha:1},time:0,timeFunction:KEY_SPLINES.EASE_OUT},HIDDEN:{state:{alpha:0},time:0.3,timeFunction:KEY_SPLINES.EASE_IN}},_wm:new ig.Config({width:500,attributes:{},label:function(){return"Social Gui! FOLLOW US FFS!!!"}}),init:function(){this.parent();this.setSize(200,32);this.setAlign(ig.GUI_ALIGN.X_CENTER,
ig.GUI_ALIGN.Y_BOTTOM);this.hook.zIndex=100;$("#socialPopup").css({display:"block",height:0});$("#socialPopup").animate({height:110},400)},remove:function(){this.parent();$("#socialPopup").animate({height:0},400,"swing",function(){$("#socialPopup").hide()})}})});ig.baked=!0;
ig.module("game.feature.gui.widget.timer-gui").requires("impact.base.event","game.feature.gui.base.boxes","game.feature.gui.base.numbers","game.feature.gui.base.slick-box").defines(function(){ig.GUI.TimerGui=sc.SlickBoxRawGui.extend({pos:{x:4,y:50},size:{x:80,y:18},pivot:{x:40,y:6},align:{x:ig.GUI_ALIGN.X_LEFT,y:ig.GUI_ALIGN.Y_TOP},_wm:new ig.Config({width:100,attributes:{start:{_type:"Boolean",_info:"True if the timer should start right aways"}}}),transitions:{DEFAULT:{state:{},time:0.3,timeFunction:KEY_SPLINES.LINEAR},
HIDDEN:{state:{alpha:0,offsetX:-100},time:0.3,timeFunction:KEY_SPLINES.LINEAR}},gfx:new ig.Image("media/gui/basic.png"),centiseconds:null,seconds:null,minutes:null,time:0,running:false,zIndex:1001,init:function(b){this.parent(false,"Timer");this.setSize(80,16);this.setPos(0,60);this.hook.zIndex=1E6;this.centiseconds=new sc.NumberGui(99,{padZeros:true});this.seconds=new sc.NumberGui(99,{padZeros:true});this.minutes=new sc.NumberGui(99,{padZeros:true});this.centiseconds.setAlign(ig.GUI_ALIGN.X_RIGHT,
ig.GUI_ALIGN.Y_TOP);this.seconds.setAlign(ig.GUI_ALIGN.X_RIGHT,ig.GUI_ALIGN.Y_TOP);this.minutes.setAlign(ig.GUI_ALIGN.X_RIGHT,ig.GUI_ALIGN.Y_TOP);var a=8;this.centiseconds.setPos(a,3);var a=a+this.centiseconds.hook.size.x,d=new ig.ImageGui(this.gfx,104,0,8,8);d.setAlign(ig.GUI_ALIGN.X_RIGHT,ig.GUI_ALIGN.Y_TOP);d.setPos(a,3);this.addChildGui(d);a=a+8;this.seconds.setPos(a,3);a=a+this.seconds.hook.size.x;d=new ig.ImageGui(this.gfx,104,0,8,8);d.setAlign(ig.GUI_ALIGN.X_RIGHT,ig.GUI_ALIGN.Y_TOP);d.setPos(a,
3);this.addChildGui(d);this.minutes.setPos(a+8,3);this.addChildGui(this.centiseconds);this.addChildGui(this.seconds);this.addChildGui(this.minutes);if(b)this.running=b.start||false;this.doStateTransition("HIDDEN",true);this.doStateTransition("DEFAULT")},update:function(){if(this.running)this.time=this.time+ig.system.tick;var b=Math.floor(this.time*100);this.centiseconds.setNumber(b%100);b=Math.floor(b/100);this.seconds.setNumber(b%60);b=Math.floor(b/60);this.minutes.setNumber(b);this.parent()},start:function(){this.running=
true},stop:function(){this.running=false},remove:function(){this.doStateTransition("HIDDEN",false,true)}});ig.EVENT_STEP.STOP_TIMER=ig.EventStepBase.extend({hide:null,_wm:new ig.Config({attributes:{hide:{_type:"Boolean",_info:"True if the timer should be hidden and removed."}}}),init:function(b){this.hide=b.hide},start:function(){var b=ig.gui.namedGuiElements.timer;if(b){b.stop();this.hide&&b.remove()}}})});ig.baked=!0;
ig.module("game.feature.gui.widget.sergey-mode").requires("impact.feature.gui.gui").defines(function(){ig.GUI.SergeyMode=ig.GuiElementBase.extend({_wm:new ig.Config({width:100,attributes:{}}),transitions:{DEFAULT:{state:{},time:0.1,timeFunction:KEY_SPLINES.LINEAR},HIDDEN:{state:{alpha:0},time:0.1,timeFunction:KEY_SPLINES.LINEAR}},cornerImage:null,patternSheet:null,startSound:null,endSound:null,scroll:0,init:function(){this.parent();this.setSize(ig.system.width,ig.system.height);this.hook.zIndex=49;
this.hook.localAlpha=0.4;this.cornerImage=new ig.Image("media/gui/sergey-mode-corner.png");this.patternSheet=new ig.ImagePatternSheet("media/gui/sergey-mode-corner.png",ig.ImagePattern.OPT.REPEAT_X_AND_Y,64,64,64,0,1,1);this.startSound=new ig.Sound("media/sound/scenes/sergey-mode-start.ogg",0.8);this.endSound=new ig.Sound("media/sound/scenes/sergey-mode-end.ogg",0.8)},clearCached:function(){this.cornerImage.decreaseRef();this.patternSheet.decreaseRef()},onAttach:function(){this.doStateTransition("HIDDEN",
true);this.doStateTransition("DEFAULT");ig.soundManager.pushPaused();this.startSound.play()},update:function(){this.scroll=this.scroll-ig.system.actualTick*32},updateDrawables:function(b){b.addPattern(this.patternSheet.getPattern(0),0,0,this.scroll,this.scroll,ig.system.width,ig.system.height).setCompositionMode("lighter");b.addGfx(this.cornerImage,0,20,0,0,64,64,false,false).setCompositionMode("lighter");b.addGfx(this.cornerImage,ig.system.width-64,20,0,0,64,64,true,false).setCompositionMode("lighter");
b.addGfx(this.cornerImage,ig.system.width-64,ig.system.height-64-20,0,0,64,64,true,true).setCompositionMode("lighter");b.addGfx(this.cornerImage,0,ig.system.height-64-20,0,0,64,64,false,true).setCompositionMode("lighter")},remove:function(){this.endSound.play();ig.soundManager.popPaused();this.doStateTransition("HIDDEN",false,true)}})});ig.baked=!0;
ig.module("game.feature.gui.widget.chest-items").requires("impact.base.image","impact.feature.gui.gui","game.feature.inventory.inventory").defines(function(){var b=Vec2.createC(),a=Vec2.createC(),d=Vec2.createC(),c=[0,30,-30,45,-45,15,-15];sc.ItemGui=ig.GuiElementBase.extend({transitions:{HIDDEN:{state:{scaleX:0,scaleY:0,angle:-(Math.PI/2)},time:0.3,timeFunction:KEY_SPLINES.LINEAR},DEFAULT:{state:{},time:0.2,timeFunction:KEY_SPLINES.LINEAR},END:{state:{alpha:0},time:0.5,timeFunction:KEY_SPLINES.LINEAR}},
icon:null,timer:0,target:null,moveTimer:0.4,moveTime:0.4,diff:Vec2.create(0,0),init:function(a,b,c,d,i){this.parent();this.setSize(14,16);this.setPivot(7,8);this.setPos(c.x,c.y);this.diff.x=d.x-c.x;this.diff.y=d.y-c.y;this.target=a;this.icon=new ig.TextBlock(sc.fontsystem.font,"\\i["+b+"]",{speed:ig.TextBlock.SPEED.IMMEDIATE});this.doStateTransition("HIDDEN",true);this.start(d,i)},start:function(a,b){this.doStateTransition("DEFAULT",false,false,null,b);this.timer=1;this.moveTime=0.4;this.moveTimer=
0},update:function(){if(this.timer>0){this.timer=this.timer-ig.system.actualTick;this.timer<=0&&this.doStateTransition("END",false,true)}var a=this.hook,c=this.target.coll;ig.system.getScreenFromMapPos(b,Math.round(c.pos.x+c.size.x/2),Math.round(c.pos.y-c.pos.z-c.size.z/2+c.size.y/2));a.pos.x=b.x-a.size.x/2;a.pos.y=b.y-a.size.y/2;if(this.moveTimer<this.moveTime){this.moveTimer=this.moveTimer+ig.system.actualTick;if(this.moveTimer>=this.moveTime)this.moveTimer=this.moveTime}c=Math.min(1,Math.max(0,
this.moveTimer)/this.moveTime);c=KEY_SPLINES.EASE_OUT.get(c);a.pos.x=a.pos.x+this.diff.x*c;a.pos.y=a.pos.y+this.diff.y*c},updateDrawables:function(a){a.addDraw().setText(this.icon,0,0)}});sc.ItemGuiLayer=ig.GuiElementBase.extend({init:function(){this.parent();this.setSize(ig.system.width,ig.system.height);this.hook.zIndex=5},addItem:function(e,f,g){var h=null,h=-1E6,h=h=0,f=sc.inventory.getItem(f),f=(f.icon||"item-default")+sc.inventory.getRaritySuffix(f.rarity||0),i=0,j=e.coll;ig.system.getScreenFromMapPos(b,
Math.round(j.pos.x+j.size.x/2),Math.round(j.pos.y-j.pos.z-j.size.z/2+j.size.y/2));Vec2.subC(b,7,8);for(j=0;j<g;j++){h=c[j%c.length];h=h+(-2+Math.random()*4);h=h*(Math.PI/180);a.x=Math.sin(h);a.y=Math.cos(h);h=Math.floor(20+Math.random()*20);d.x=Math.floor(b.x-a.x*h);d.y=Math.floor(b.y-a.y*h);h=new sc.ItemGui(e,f,b,d,i);this.addChildGui(h);i=i+0.08}}})});ig.baked=!0;
ig.module("game.feature.gui.widget.demo-stats").requires("impact.base.event","game.feature.gui.base.boxes","game.feature.gui.base.numbers").defines(function(){function b(b){return a(b/60/60,3)+":"+a(Math.floor(b/60)%60,2)+":"+a(Math.floor(b)%60,2)}function a(a,b){var e="0000"+Math.floor(a);return e.length>=4+b?Math.floor(a):e.substr(e.length-b)}sc.DemoStatsStat=ig.GuiElementBase.extend({nameGui:null,valueGui:null,totalGui:null,name:null,value:null,updateCallback:null,init:function(a,b,e,f){this.parent();
this.hook.size.x=200;this.hook.size.y=20;this.nameGui=new sc.TextGui(ig.lang.get("sc.gui.stats."+a)+":");this.nameGui.setAlign(ig.GUI_ALIGN.X_LEFT,ig.GUI_ALIGN.Y_CENTER);this.nameGui.setPos(10,0);this.addChildGui(this.nameGui);this.valueGui=new sc.TextGui(b+"");this.valueGui.setAlign(ig.GUI_ALIGN.X_RIGHT,ig.GUI_ALIGN.Y_CENTER);this.addChildGui(this.valueGui);e&&this.addUpdater(e);f&&this.addTotalNumber(f)},update:function(){this.updateCallback&&this.updateCallback(this)},setValue:function(a){this.valueGui.setText(a+
"")},addUpdater:function(a){this.updateCallback=a||null},addTotalNumber:function(a){a=new sc.TextGui(" / "+a);a.setAlign(ig.GUI_ALIGN.X_RIGHT,ig.GUI_ALIGN.Y_CENTER);this.addChildGui(a);this.valueGui.setPos(a.hook.size.x+5,0)}});sc.DemoStats=ig.GuiElementBase.extend({transitions:{DEFAULT:{state:{alpha:1},time:0.2,timeFunction:KEY_SPLINES.EASE_OUT},HIDDEN:{state:{alpha:0},time:0.3,timeFunction:KEY_SPLINES.EASE_IN}},bgColor:null,msgBox:null,content:null,callback:null,screenInteract:null,init:function(a){this.parent();
this.hook.localAlpha=0.8;this.hook.zIndex=90;this.hook.temporary=true;this.hook.size.x=ig.system.width;this.hook.size.y=ig.system.height;this.callback=a;this.screenInteract=new sc.ScreenInteractEntry(this);this.content=new ig.GuiElementBase;this.content.setSize(210,160);this._createContent();this.msgBox=new sc.CenterBoxGui(this.content);this.msgBox.setAlign(ig.GUI_ALIGN.X_CENTER,ig.GUI_ALIGN.Y_CENTER);this.addChildGui(this.msgBox);this.doStateTransition("HIDDEN",true);this.doStateTransition("DEFAULT");
ig.system.skipMode||ig.interact.addEntry(this.screenInteract)},update:function(){!this.hook.removeAfterTransition&&ig.system.skipMode&&this._close();this.parent()},updateDrawables:function(a){a.addColor("#000",0,0,this.hook.size.x,this.hook.size.y)},onInteraction:function(){ig.interact.removeEntry(this.screenInteract);this._close()},_createContent:function(){var a=2,c=new sc.TextGui(ig.lang.get("sc.gui.stats.stats"));c.setAlign(ig.GUI_ALIGN.X_CENTER,ig.GUI_ALIGN.Y_TOP);c.setPos(0,a);this.content.addChildGui(c);
a=a+(c.hook.size.y+2);c=new sc.LineGui(200);c.setAlign(ig.GUI_ALIGN.X_CENTER,ig.GUI_ALIGN.Y_TOP);c.setPos(0,a);this.content.addChildGui(c);a=this._createStatLine(a+4,"time",b(sc.stats.getMap("player","playtime")),function(a){a.setValue(b(sc.stats.getMap("player","playtime")))}.bind(this));c=sc.stats.getMap("chests","autumn-area");a=this._createStatLine(a,"chests",c,null,Math.max(27,c));a=this._createStatLine(a,"level",sc.model.player.level||0);a=this._createStatLine(a,"exp",sc.stats.getMap("player",
"exp")||0);a=this._createStatLine(a,"money",sc.stats.getMap("player","money")||0);a=this._createStatLine(a,"kills",sc.stats.getMap("combat","totalKilled")||0)},_createStatLine:function(a,b,e,f,g){b=new sc.DemoStatsStat(b,e,f,g);b.setPos(0,a);this.content.addChildGui(b);return a+b.hook.size.y+2},_close:function(){this.msgBox.doStateTransition("HIDDEN");this.doStateTransition("HIDDEN",false,true);this.callback&&this.callback()}})});ig.baked=!0;
ig.module("game.feature.gui.widget.demo-highscore").requires("impact.base.event","impact.feature.gui.base.basic-gui","game.feature.gui.base.boxes","game.feature.gui.base.numbers").defines(function(){function b(b){return a(b/60/60,2)+":"+a(b/60,2)+":"+a(Math.floor(b)%60,2)+"."+a(b*100%100,2)}function a(a,b){var e="0000"+Math.floor(a);return e.length>=4+b?Math.floor(a):e.substr(e.length-b)}sc.DemoHighscoreEntry=ig.GuiElementBase.extend({nameGui:null,valueGui:null,name:null,value:null,init:function(d,
c,e){this.parent();this.hook.size.x=200;this.hook.size.y=18;this.nameGui=new sc.TextGui((e?"\\c[3]":"")+a(d,2));this.nameGui.setAlign(ig.GUI_ALIGN.X_LEFT,ig.GUI_ALIGN.Y_CENTER);this.nameGui.setPos(10,0);this.addChildGui(this.nameGui);this.valueGui=new sc.TextGui((e?"\\c[3]":"")+b(c));this.valueGui.setAlign(ig.GUI_ALIGN.X_RIGHT,ig.GUI_ALIGN.Y_CENTER);this.addChildGui(this.valueGui);c=new ig.ColorGui("#222222",200,1);c.setAlign(ig.GUI_ALIGN.X_CENTER,ig.GUI_ALIGN.Y_BOTTOM);c.setPos(5,0);this.addChildGui(c);
if(d%2==1&&!e){this.nameGui.hook.localAlpha=0.6;this.valueGui.hook.localAlpha=0.6}}});sc.DemoHighscore=ig.GuiElementBase.extend({transitions:{DEFAULT:{state:{alpha:1},time:0.2,timeFunction:KEY_SPLINES.EASE_OUT},HIDDEN:{state:{alpha:0},time:0.3,timeFunction:KEY_SPLINES.EASE_IN}},msgBox:null,content:null,callback:null,screenInteract:null,second:false,init:function(a,b){this.parent();this.hook.localAlpha=0.8;this.hook.zIndex=90;this.hook.temporary=true;this.hook.size.x=ig.system.width;this.hook.size.y=
ig.system.height;this.callback=a;this.second=b!=void 0?b:false;this.screenInteract=new sc.ScreenInteractEntry(this);this.content=new ig.GuiElementBase;this.content.setSize(210,218);this._createContent();this.msgBox=new sc.CenterBoxGui(this.content);this.msgBox.setAlign(ig.GUI_ALIGN.X_CENTER,ig.GUI_ALIGN.Y_CENTER);this.addChildGui(this.msgBox);this.doStateTransition("HIDDEN",true);this.doStateTransition("DEFAULT");ig.system.skipMode||ig.interact.addEntry(this.screenInteract)},update:function(){!this.hook.removeAfterTransition&&
ig.system.skipMode&&this._close();this.parent()},updateDrawables:function(a){a.addColor("#000",0,0,this.hook.size.x,this.hook.size.y)},onInteraction:function(){ig.interact.removeEntry(this.screenInteract);this._close()},_createContent:function(){var a=2,b=new sc.TextGui(ig.lang.get("sc.gui.highscore.header"+(this.second?"2":"")));b.setAlign(ig.GUI_ALIGN.X_CENTER,ig.GUI_ALIGN.Y_TOP);b.setPos(0,a);this.content.addChildGui(b);a=a+(b.hook.size.y+2);b=new sc.LineGui(200);b.setAlign(ig.GUI_ALIGN.X_CENTER,
ig.GUI_ALIGN.Y_TOP);b.setPos(0,a);this.content.addChildGui(b);for(var a=a+4,b=this.second?sc.model.highScoreObs:sc.model.highScore,e=0;e<10;e++)a=b[e]!=void 0?this._createHighscoreEntryLine(a,e+1,b[e],e==0):this._createHighscoreEntryLine(a,e+1,0,e==0)},_createHighscoreEntryLine:function(a,b,e,f){b=new sc.DemoHighscoreEntry(b,e,f);b.setPos(0,a);this.content.addChildGui(b);return a+b.hook.size.y+1},_close:function(){this.msgBox.doStateTransition("HIDDEN");this.doStateTransition("HIDDEN",false,true);
this.callback&&this.callback()}});sc.DemoLastTime=ig.GuiElementBase.extend({transitions:{DEFAULT:{state:{alpha:1},time:0.2,timeFunction:KEY_SPLINES.EASE_OUT},HIDDEN:{state:{alpha:0},time:0.3,timeFunction:KEY_SPLINES.EASE_IN}},msgBox:null,content:null,callback:null,screenInteract:null,newRecordDone:false,recordGui:null,second:false,init:function(a,b){this.parent();this.hook.localAlpha=0.8;this.hook.zIndex=90;this.hook.temporary=true;this.hook.size.x=ig.system.width;this.hook.size.y=ig.system.height;
this.setPos(0,80);this.callback=a;this.second=b!=void 0?b:false;this.screenInteract=new sc.ScreenInteractEntry(this);this.content=new ig.GuiElementBase;this.content.setSize(180,60);this._createContent();this.msgBox=new sc.CenterBoxGui(this.content);this.msgBox.setAlign(ig.GUI_ALIGN.X_CENTER,ig.GUI_ALIGN.Y_CENTER);this.msgBox.centerBox.hook.localAlpha=0.9;this.addChildGui(this.msgBox);this.doStateTransition("HIDDEN",true);this.doStateTransition("DEFAULT");ig.system.skipMode||ig.interact.addEntry(this.screenInteract)},
update:function(){!this.hook.removeAfterTransition&&(this.newRecordDone&&ig.system.skipMode)&&this._close();this.parent()},onInteraction:function(){if(this.newRecordDone){ig.interact.removeEntry(this.screenInteract);this._close()}else this.recordGui.finish()},_createContent:function(){var a=2,c=new sc.TextGui(ig.lang.get("sc.gui.highscore.last-time"+(this.second?"2":"")));c.setAlign(ig.GUI_ALIGN.X_CENTER,ig.GUI_ALIGN.Y_TOP);c.setPos(0,a);this.content.addChildGui(c);a=a+(c.hook.size.y+2);c=new sc.LineGui(170);
c.setAlign(ig.GUI_ALIGN.X_CENTER,ig.GUI_ALIGN.Y_TOP);c.setPos(0,a);this.content.addChildGui(c);var a=a+4,c=sc.model,e=new sc.TextGui("\\c[3]"+b(c.hsTimer));e.setAlign(ig.GUI_ALIGN.X_CENTER,ig.GUI_ALIGN.Y_TOP);e.setPos(0,a);this.content.addChildGui(e);a=a+(e.hook.size.y+2);this.newRecordDone=true;e=this.second?c.highScoreObs:c.highScore;if(e[0]!=void 0&&c.hsTimer==e[0]){this.recordGui=new sc.TextGui("\\c[3]"+ig.lang.get("sc.gui.highscore.new-record"),{speed:ig.TextBlock.SPEED.NORMAL});this.recordGui.hook.transitions=
{DEFAULT:{state:{alpha:1},time:0.1,timeFunction:KEY_SPLINES.EASE_OUT},HIDDEN:{state:{alpha:0},time:0,timeFunction:KEY_SPLINES.EASE_IN}};this.newRecordDone=false;this.recordGui.setAlign(ig.GUI_ALIGN.X_CENTER,ig.GUI_ALIGN.Y_TOP);this.recordGui.setPos(0,a);this.recordGui.doStateTransition("HIDDEN",true);this.recordGui.doStateTransition("DEFAULT",false,false,function(){this.newRecordDone=true}.bind(this),0.3);this.content.addChildGui(this.recordGui)}},_close:function(){this.msgBox.doStateTransition("HIDDEN");
this.doStateTransition("HIDDEN",false,true);this.callback&&this.callback()}})});ig.baked=!0;
ig.module("game.feature.gui.widget.tutorial-marker").requires("impact.base.image","game.feature.gui.base.boxes").defines(function(){sc.TUT_BOX_POINTING_DIR={BOTTOM_RIGHT:{alignX:ig.GUI_ALIGN.X_LEFT,alignY:ig.GUI_ALIGN.Y_TOP,flipped:false,scaleX:1,scaleY:1},BOTTOM_LEFT:{alignX:ig.GUI_ALIGN.X_RIGHT,alignY:ig.GUI_ALIGN.Y_TOP,flipped:true,scaleX:-1,scaleY:1},TOP_RIGHT:{alignX:ig.GUI_ALIGN.X_LEFT,alignY:ig.GUI_ALIGN.Y_BOTTOM,flipped:true,scaleX:1,scaleY:-1},TOP_LEFT:{alignX:ig.GUI_ALIGN.X_RIGHT,alignY:ig.GUI_ALIGN.Y_BOTTOM,
flipped:false,scaleX:-1,scaleY:-1}};sc.TutorialPointingGui=ig.GuiElementBase.extend({transitions:{DEFAULT:{state:{alpha:1},time:0.15,timeFunction:KEY_SPLINES.EASE_OUT},HIDDEN:{state:{alpha:0,scaleX:0,scaleY:0},time:0.15,timeFunction:KEY_SPLINES.EASE_IN}},gfx:new ig.Image("media/gui/message.png"),init:function(b,a){this.parent();var b=b||sc.TUT_BOX_POINTING_DIR.TOP_LEFT,d=new sc.RegularBoxGui(b.flipped),a=new sc.TextGui(a,{maxWidth:200});d.setContent(a);d.setAlign(b.alignX,b.alignY);d.setPos(18,18);
this.addChildGui(d);var c=new ig.ImageGui(this.gfx,56,64,32,32);c.hook.setScale(b.scaleX,b.scaleY);c.setAlign(b.alignX,b.alignY);this.addChildGui(c);this.setSize(d.hook.size.x+18,d.hook.size.y+18);this.setPivot(this.hook.size.x*(1-(b.scaleX+1)/2),this.hook.size.y*(1-(b.scaleY+1)/2));this.doStateTransition("HIDDEN",true)}});sc.TutorialShadowGui=ig.GuiElementBase.extend({x:0,y:0,width:0,height:0,transitions:{DEFAULT:{state:{alpha:0.7},time:0.15,timeFunction:KEY_SPLINES.EASE_OUT},HIDDEN:{state:{alpha:0,
scaleX:1,scaleY:1},time:0.15,timeFunction:KEY_SPLINES.EASE_IN}},init:function(b,a,d,c){this.parent();this.x=b;this.y=a;this.width=d;this.height=c;this.setSize(ig.system.width,ig.system.height);this.setPivot(this.x+this.width/2,this.y+this.height/2);this.doStateTransition("HIDDEN",true)},updateDrawables:function(b){var a=this.hook.size.x,d=this.hook.size.y;b.addColor("black",0,0,a,this.y);b.addColor("black",0,this.y,this.x,this.height);b.addColor("black",this.x+this.width,this.y,a-this.x-this.width,
this.height);b.addColor("black",0,this.y+this.height,a,d-this.y-this.height)}});sc.TutorialMarkerGui=ig.GuiElementBase.extend({transitions:{DEFAULT:{state:{alpha:1},time:0.2,timeFunction:KEY_SPLINES.EASE_OUT},HIDDEN:{state:{alpha:1},time:0.2,timeFunction:KEY_SPLINES.EASE_IN}},shadowGui:null,highlightGui:null,pointerGui:null,callback:null,screenInteract:null,sounds:{start:new ig.Sound("media/sound/hud/popup-2.ogg",1)},init:function(b,a,d,c,e,f,g,h,i){this.parent();this.hook.pauseGui=true;this.setSize(ig.system.width,
ig.system.height);this.hook.zIndex=2E3;this.stopTime=h;h=new sc.TutorialShadowGui(b,a,d,c);this.addChildGui(h);this.shadowGui=h;var j=new sc.WhiteLineBox(d+2,c+2);j.setPos(b-1,a-1);j.doStateTransition("HIDDEN",true);this.addChildGui(j);this.highlightGui=j;e=new sc.TutorialPointingGui(f,e);b=b+d*g;a=f.scaleY==1?a+c:a-e.hook.size.y;f.scaleX==-1&&(b=b-e.hook.size.x);e.setPos(b,a);this.addChildGui(e);this.pointerGui=e;h.doStateTransition("DEFAULT");j.doStateTransition("DEFAULT");e.doStateTransition("DEFAULT",
false,false,null,0.1);if(this.stopTime){ig.slowMotion.add(0,0,"tutorialMsg");ig.soundManager.pushPaused();this.sounds.start.play()}this.callback=i;this.screenInteract=new sc.ScreenInteractEntry(this);this.screenInteract.autoCtrlIgnore=true;ig.interact.addEntry(this.screenInteract)},onInteraction:function(){ig.interact.removeEntry(this.screenInteract);this._close()},_close:function(){this.shadowGui.doStateTransition("HIDDEN");this.highlightGui.doStateTransition("HIDDEN");this.pointerGui.doStateTransition("HIDDEN");
this.doStateTransition("HIDDEN",false,true);if(this.stopTime){ig.soundManager.popPaused();ig.slowMotion.clearNamed("tutorialMsg",0)}this.callback&&this.callback()}})});ig.baked=!0;
ig.module("game.feature.gui.widget.tutorial-start-gui").requires("impact.base.image","impact.feature.interact.gui.focus-gui","game.feature.interact.button-group","game.feature.gui.base.compact-choice-box").defines(function(){sc.TutorialStartHeaderGui=ig.GuiElementBase.extend({init:function(b,a){this.parent();var d=new sc.TextGui(ig.lang.get(b.title),{font:sc.fontsystem.tinyFont});d.setAlign(ig.GUI_ALIGN.X_CENTER,ig.GUI_ALIGN.Y_TOP);this.addChildGui(d);var c=new sc.TextGui(a);c.setAlign(ig.GUI_ALIGN.X_CENTER,
ig.GUI_ALIGN.Y_TOP);c.setPos(0,d.hook.size.y);this.addChildGui(c);this.setSize(Math.max(d.hook.size.x,c.hook.size.x),d.hook.size.y+c.hook.size.y)}});sc.TutorialStartContentGui=ig.GuiElementBase.extend({init:function(b,a){this.parent();var d=null,c=0;if(a){d=new ig.ImageGui(a);d.setAlign(ig.GUI_ALIGN.X_CENTER,ig.GUI_ALIGN.Y_TOP);this.addChildGui(d);c=c+(d.hook.size.y+2)}var e=new sc.TextGui(b,{maxWidth:d&&d.hook.size.x||400,textAlign:ig.Font.ALIGN.CENTER});e.setAlign(ig.GUI_ALIGN.X_CENTER,ig.GUI_ALIGN.Y_TOP);
e.setPos(0,c);this.addChildGui(e);c=c+e.hook.size.y;this.setSize(Math.max(d&&d.hook.size.x,e.hook.size.x),c)}});sc.TutorialStartGui=ig.GuiElementBase.extend({transitions:{DEFAULT:{state:{alpha:1},time:0.2,timeFunction:KEY_SPLINES.EASE_OUT},HIDDEN:{state:{alpha:0},time:0.3,timeFunction:KEY_SPLINES.EASE_IN}},bgColor:null,titleBox:null,contentText:null,contentImage:null,centerBox:null,decisionBox:null,screenInteract:null,pausePushed:false,sounds:{start:new ig.Sound("media/sound/hud/popup.ogg",1)},init:function(b,
a,d,c,e){this.parent();this.hook.localAlpha=0.5;this.hook.zIndex=90;this.hook.temporary=true;this.hook.pauseGui=true;this.hook.size.x=ig.system.width;this.hook.size.y=ig.system.height;this.callback=e;this.titleBox=new sc.CenterBoxGui(new sc.TutorialStartHeaderGui(b,a));this.titleBox.setAlign(ig.GUI_ALIGN.X_CENTER,ig.GUI_ALIGN.Y_TOP);this.titleBox.setPos(0,24);this.addChildGui(this.titleBox);this.contentText=d;if(c){this.contentImage=new ig.Image(c);this.contentImage.addLoadListener(this)}else this.buildContent();
this.decisionBox=new sc.CompactChoiceBoxGui([{key:"show",label:ig.lang.get(b.yes)},{key:"skip",label:ig.lang.get(b.no)}],200,this.onChoice.bind(this));this.decisionBox.setAlign(ig.GUI_ALIGN.X_CENTER,ig.GUI_ALIGN.Y_BOTTOM);this.decisionBox.setPos(0,24);this.addChildGui(this.decisionBox);this.doStateTransition("HIDDEN",true);this.doStateTransition("DEFAULT");this.startPause();sc.model.clearTopMessage();sc.model.addChoiceGui(this)},onLoadableComplete:function(){this.buildContent()},buildContent:function(){if(this.titleBox){var b=
new sc.TutorialStartContentGui(this.contentText,this.contentImage);this.msgBox=new sc.CenterBoxGui(b);this.msgBox.setAlign(ig.GUI_ALIGN.X_CENTER,ig.GUI_ALIGN.Y_CENTER);this.msgBox.setPos(0,-3);this.addChildGui(this.msgBox)}},onDetach:function(){this.clearPause();this.contentImage&&this.contentImage.decreaseRef()},startPause:function(){this.pausePushed=true;ig.slowMotion.add(0,0,"tutorial");ig.slowMotion.forceUpdate();this.sounds.start.play()},clearPause:function(){if(this.pausePushed){this.pausePushed=
false;ig.slowMotion.clearNamed("tutorial",0);ig.slowMotion.forceUpdate()}},_close:function(){sc.model.removeChoiceGui(this);this.titleBox.doStateTransition("HIDDEN");this.msgBox&&this.msgBox.doStateTransition("HIDDEN");this.decisionBox.doStateTransition("HIDDEN");this.doStateTransition("HIDDEN",false,true);this.clearPause();this.titleBox=null},updateDrawables:function(b){b.addColor("black",0,0,this.hook.size.x,this.hook.size.y)},onChoice:function(b){this._close();this.callback&&this.callback(b=="show")}})});
ig.baked=!0;
ig.module("game.feature.gui.widget.skip-scene").requires("impact.base.image","impact.feature.gui.gui","impact.feature.gui.base.basic-gui").defines(function(){sc.SkipSceneGui=ig.GuiElementBase.extend({transitions:{DEFAULT:{state:{},time:0.2,timeFunction:KEY_SPLINES.LINEAR},HIDDEN:{state:{alpha:0},time:0.2,timeFunction:KEY_SPLINES.LINEAR}},textGui:null,timer:0,init:function(){this.parent();this.hook.zIndex=60;this.setAlign(ig.GUI_ALIGN.X_RIGHT,ig.GUI_ALIGN.Y_TOP);this.setPos(2,1);sc.Model.addObserver(sc.model,this);
this.textGui=new sc.TextGui(ig.lang.get("sc.gui.dialogs.skipAsk"));this.addChildGui(this.textGui);this.setSize(this.textGui.hook.size.x,this.textGui.hook.size.y);this.doStateTransition("HIDDEN",true)},modelChanged:function(b,a,d){a==sc.GAME_MODEL_MSG.CUTSCENE_SKIP?d?this.doStateTransition("DEFAULT"):this.doStateTransition("HIDDEN"):a==sc.GAME_MODEL_MSG.SUB_STATE_CHANGED&&sc.model.isReset()&&this.doStateTransition("HIDDEN")}})});ig.baked=!0;
ig.module("game.feature.gui.plug-in").requires("game.feature.gui.base.boxes","game.feature.gui.base.slick-box","game.feature.gui.base.button","game.feature.gui.base.numbers","game.feature.gui.base.text","game.feature.gui.base.misc","game.feature.gui.base.compact-choice-box","game.feature.gui.hud.combat-hud","game.feature.gui.hud.right-hud","game.feature.gui.hud.item-hud","game.feature.gui.hud.element-hud","game.feature.gui.hud.money-hud","game.feature.gui.hud.task-hud","game.feature.gui.hud.status-hud",
"game.feature.gui.hud.hp-hud","game.feature.gui.hud.exp-hud","game.feature.gui.hud.param-hud","game.feature.gui.hud.buff-hud","game.feature.gui.hud.item-timer-hud","game.feature.gui.hud.quest-hud","game.feature.gui.hud.landmark-hud","game.feature.gui.hud.lore-hud","game.feature.gui.hud.drop-hud","game.feature.gui.hud.member-hud","game.feature.gui.hud.sp-change-hud","game.feature.gui.hud.sp-mini-hud","game.feature.gui.hud.top-msg-hud","game.feature.gui.hud.feat-hud","game.feature.gui.screen.loading-screen",
"game.feature.gui.screen.title-screen","game.feature.gui.screen.pause-screen","game.feature.gui.screen.credits-screen","game.feature.gui.widget.click-box","game.feature.gui.widget.gamepad-box","game.feature.gui.widget.counter-hud","game.feature.gui.widget.information","game.feature.gui.widget.bar-widget","game.feature.gui.widget.indiegogo-gui","game.feature.gui.widget.level-up-hud","game.feature.gui.widget.social","game.feature.gui.widget.timer-gui","game.feature.gui.widget.sergey-mode","game.feature.gui.widget.chest-items",
"game.feature.gui.widget.demo-stats","game.feature.gui.widget.demo-highscore","game.feature.gui.widget.tutorial-marker","game.feature.gui.widget.tutorial-start-gui","game.feature.gui.widget.modal-dialog","game.feature.gui.widget.skip-scene").defines(function(){ig.langFileList.push("sc.gui")});ig.baked=!0;
ig.module("game.feature.menu.gui.equip.equip-status").requires("impact.feature.gui.gui","impact.feature.gui.base.basic-gui","game.feature.gui.plug-in","game.feature.menu.gui.menu-misc").defines(function(){var b={params:{elemFactor:[1,1,1,1]},properties:{}};sc.EquipStatusContainer=ig.GuiElementBase.extend({compareMode:false,compareOffHand:false,baseParams:{hp:null,atk:null,def:null,foc:null,fire:null,cold:null,shock:null,wave:null},allModifiers:{},modifiers:{},statusPanel:null,modPanel:null,modMore:null,
arrow:null,arrow2:null,gfx:new ig.Image("media/gui/menu.png"),mode:true,init:function(){this.parent();this.setSize(169,264);this.setPos(sc.options.hdMode?25:2,28);this.hook.transitions={DEFAULT:{state:{},time:0.2,timeFunction:KEY_SPLINES.LINEAR},HIDDEN:{state:{alpha:0,offsetX:-(169+(sc.options.hdMode?25:3))},time:0.2,timeFunction:KEY_SPLINES.LINEAR}};var a=new sc.MenuPanel(sc.MenuPanelType.TOP_RIGHT_EDGE);a.hook.transitions={DEFAULT:{state:{},time:0.2,timeFunction:KEY_SPLINES.LINEAR},HIDDEN:{state:{alpha:0,
scaleY:0},time:0.2,timeFunction:KEY_SPLINES.LINEAR}};a.setSize(169,121);a.setPivot(0,0);this.addChildGui(a);this.statusPanel=a;this.modMore=new sc.TextGui(ig.lang.get("sc.gui.menu.equip.moreMod"));this.modMore.hook.transitions={DEFAULT:{state:{},time:0.2,timeFunction:KEY_SPLINES.LINEAR},HIDDEN:{state:{alpha:0},time:0.2,timeFunction:KEY_SPLINES.LINEAR}};this.modMore.setAlign(ig.GUI_ALIGN.X_CENTER,ig.GUI_ALIGN.Y_BOTTOM);this.modMore.setPos(0,0);this.modMore.doStateTransition("DEFAULT",true);var b=5,
c=sc.model.player.equipParams;this.baseParams.hp=this._createStatusDisplay(0,b,"maxhp",0,0,false,9999,c.hp,void 0,a);b=b+14;this.baseParams.atk=this._createStatusDisplay(0,b,"atk",0,1,false,999,c.attack,void 0,a);b=b+14;this.baseParams.def=this._createStatusDisplay(0,b,"def",0,2,false,999,c.defense,void 0,a);b=b+14;this.baseParams.foc=this._createStatusDisplay(0,b,"foc",0,3,false,999,c.focus,void 0,a);b=b+16;this.baseParams.fire=this._createStatusDisplay(0,b,"res",1,4,true,999,c.elemFactor[0],void 0,
a);b=b+14;this.baseParams.cold=this._createStatusDisplay(0,b,"res",2,5,true,999,c.elemFactor[1],void 0,a);b=b+14;this.baseParams.shock=this._createStatusDisplay(0,b,"res",3,6,true,999,c.elemFactor[2],void 0,a);this.baseParams.wave=this._createStatusDisplay(0,b+14,"res",4,7,true,999,c.elemFactor[3],void 0,a);a=new sc.HeaderMenuPanel(ig.lang.get("sc.gui.menu.equip.modifiers"),sc.MenuPanelType.TOP_RIGHT_EDGE);a.setPos(0,125);a.setPivot(0,0);a.setSize(169,139);this.addChildGui(a);this.modPanel=a;for(var e in sc.MODIFIERS){b=
sc.MODIFIERS[e];b=this._createStatusDisplay(0,0,"modifier."+e,5,b.icon,true,sc.MAX_MOD_VAL,1,b.noPercent||false,a,e,b.order);b.doStateTransition("HIDDEN",true);this.allModifiers[e]=b}this._setCurrentModifiers();a=new ig.ColorGui("#7E7E7E",169,1);a.setPos(0,247);this.addChildGui(a);a=new ig.ImageGui(this.gfx,528,224,13,8);a.setPos(3,252);this.addChildGui(a);this.arrow=a;a=new ig.ImageGui(this.gfx,528,224,13,8);a.setAlign(ig.GUI_ALIGN.X_RIGHT,ig.GUI_ALIGN.Y_TOP);a.setPos(3,252);this.addChildGui(a);
this.arrow2=a;a=new ig.ColorGui("#2C2D2D",169,1);a.setPos(0,264);this.addChildGui(a);this.addChildGui(this.modMore);this.doStateTransition("HIDDEN",true)},showMenu:function(){this._setCurrentValues();this.doStateTransition("DEFAULT")},toggleViewMode:function(a){if(this.mode=!this.mode){this.modMore.setText(ig.lang.get("sc.gui.menu.equip.moreMod"));this.arrow.offsetX=528;this.arrow2.offsetX=528;this.updateStatusView(a);this.statusPanel.doStateTransition("DEFAULT",false,false,function(){}.bind(this));
this.modPanel.doPosTranstition(0,125,0.2,KEY_SPLINES.LINEAR);this.modPanel.doSizeTransition(169,139,0.2)}else{this.arrow.offsetX=512;this.arrow2.offsetX=512;this.modMore.setText(ig.lang.get("sc.gui.menu.equip.lessMod"));this.statusPanel.doStateTransition("HIDDEN",false,false,function(){this.updateStatusView(a)}.bind(this));this.modPanel.doPosTranstition(0,0,0.2,KEY_SPLINES.LINEAR);this.modPanel.doSizeTransition(169,264,0.2)}},updateStatusView:function(a){a?a.data&&a.data.id!=void 0?this._setParameters(a.data.id,
!this.mode):this.mode?this._resetChangeValue():this._setCurrentModifiers():this.mode?this._resetChangeValue():this._setCurrentModifiers()},updateModText:function(a){if(this.mode){var b="";if(a>(this.mode?7:100))b=" ["+(a-7)+" "+ig.lang.get("sc.gui.menu.equip.hidden")+"]";this.modMore.setText(ig.lang.get("sc.gui.menu.equip.moreMod")+b)}},_createStatusDisplay:function(a,b,c,e,f,g,h,i,j,k,l,o){g=new sc.SimpleStatusDisplay(ig.lang.get("sc.gui.menu.equip."+c),e,f,g,h,null,null,j);g.setPos(a,b);g.setCurrentValue(i);
if(c=="res"){e==1&&(c="heat");e==2&&(c="cold");e==3&&(c="shock");e==4&&(c="wave")}l||(l=c);g.annotation={type:"INFO",content:{title:"sc.gui.menu.equip."+c,description:"sc.gui.menu.equip.descriptions."+l},offset:{x:-1,y:-1},index:{x:0,y:o!=void 0?o+8:f}};k?k.addChildGui(g):this.addChildGui(g);return g},_setParameters:function(a,d){this._resetChangeValue(d);d&&this._setCurrentModifiers();if(!(a!=-1E3&&a<0)){var c=null,e=a!=-1E3?sc.inventory.getItem(a):b;if(this.compareMode)switch(e.equipType){case sc.ITEMS_EQUIP_TYPES.HEAD:c=
sc.model.player.equip.head;break;case sc.ITEMS_EQUIP_TYPES.ARM:c=this.compareOffHand?sc.model.player.equip.leftArm:sc.model.player.equip.rightArm;break;case sc.ITEMS_EQUIP_TYPES.TORSO:c=sc.model.player.equip.torso;break;case sc.ITEMS_EQUIP_TYPES.FEET:c=sc.model.player.equip.feet}else switch(sc.menu.currentBodyPart){case sc.MENU_EQUIP_BODYPART.NONE:return;case sc.MENU_EQUIP_BODYPART.HEAD:c=sc.model.player.equip.head;break;case sc.MENU_EQUIP_BODYPART.RIGHT_ARM:c=sc.model.player.equip.rightArm;break;
case sc.MENU_EQUIP_BODYPART.LEFT_ARM:c=sc.model.player.equip.leftArm;break;case sc.MENU_EQUIP_BODYPART.TORSO:c=sc.model.player.equip.torso;break;case sc.MENU_EQUIP_BODYPART.FEET:c=sc.model.player.equip.feet}var f=e.params,e=e.properties,g=null,g=this._calculateDifference(c,"hp",f.hp||0);this.baseParams.hp.setChangeValue(g);g=this._calculateDifference(c,"attack",f.attack||0);this.baseParams.atk.setChangeValue(g);g=this._calculateDifference(c,"defense",f.defense||0);this.baseParams.def.setChangeValue(g);
g=this._calculateDifference(c,"focus",f.focus||0);this.baseParams.foc.setChangeValue(g);g=this._calculateDifference(c,"elemFactor",f.elemFactor?f.elemFactor[0]:1,0);this.baseParams.fire.setChangeValue(g);g=this._calculateDifference(c,"elemFactor",f.elemFactor?f.elemFactor[1]:1,1);this.baseParams.cold.setChangeValue(g);g=this._calculateDifference(c,"elemFactor",f.elemFactor?f.elemFactor[2]:1,2);this.baseParams.shock.setChangeValue(g);g=this._calculateDifference(c,"elemFactor",f.elemFactor?f.elemFactor[3]:
1,3);this.baseParams.wave.setChangeValue(g);var f=11,g=sc.model.player.equipModifiers,h=0,i;for(i in this.allModifiers)if(e[i]!=void 0){if(h<(this.mode?7:100)){this.allModifiers[i].doStateTransition("DEFAULT",true);this.allModifiers[i].setChangeValue(this._calculateDifferenceModifier(c,i,e[i]));this.allModifiers[i].setPos(0,f);f=f+16}else this.allModifiers[i].doStateTransition("HIDDEN",true);h++}else if(g[i]!=void 0){if(h<(this.mode?7:100)){this.allModifiers[i].doStateTransition("DEFAULT",true);this.allModifiers[i].setChangeValue(this._calculateDifferenceModifier(c,
i,1));this.allModifiers[i].setPos(0,f);f=f+16}else this.allModifiers[i].doStateTransition("HIDDEN",true);h++}else this.allModifiers[i].doStateTransition("HIDDEN",true);this.updateModText(h)}},_calculateDifferenceModifier:function(a,b,c,e){if(a<0)return c=(Math.round(c*100)-100)/100;if(e){b=a[b]||1;return c=(Math.round(b*100)-Math.round(c*100))/100}a=sc.inventory.getItem(a).properties;b=a[b]!=void 0?a[b]:1;return c=(Math.round(c*100)-Math.round(b*100))/100},_calculateDifference:function(a,b,c,e){if(a<
0){e!=void 0&&(c=(Math.round(c*100)-100)/100);return c}if((a=sc.inventory.getItem(a))&&a.params&&a.params[b]){var f=0;if(e!=void 0){f=a.params[b][e]||0;c=(Math.round(c*100)-Math.round(f*100))/100}else{f=a.params[b]||0;c=c-f}}else e!=void 0&&(c=(Math.round(c*100)-100)/100);return c},_resetChangeValue:function(a){for(var b in this.baseParams)this.baseParams[b].setChangeValue(0);b=11;var c=sc.model.player.equipModifiers,e=0,f;for(f in this.allModifiers){this.allModifiers[f].setChangeValue(0);if(c[f]==
void 0){this.allModifiers[f].setCurrentValue(1,true);this.allModifiers[f].doStateTransition("HIDDEN",true)}else{if(e<(this.mode?7:100)){a&&this.allModifiers[f].hook.currentStateName=="HIDDEN"&&this.allModifiers[f].setCurrentValue(1,true);this.allModifiers[f].setPos(0,b);this.allModifiers[f].doStateTransition("DEFAULT",true);b=b+16}else{this.allModifiers[f].setCurrentValue(1,true);this.allModifiers[f].doStateTransition("HIDDEN",true)}e++}}this.updateModText(e)},_setCurrentValues:function(){var a=sc.model.player.equipParams;
this.baseParams.hp.setCurrentValue(a.hp);this.baseParams.atk.setCurrentValue(a.attack);this.baseParams.def.setCurrentValue(a.defense);this.baseParams.foc.setCurrentValue(a.focus);this.baseParams.fire.setCurrentValue(a.elemFactor[0]);this.baseParams.cold.setCurrentValue(a.elemFactor[1]);this.baseParams.shock.setCurrentValue(a.elemFactor[2]);this.baseParams.wave.setCurrentValue(a.elemFactor[3]);this._setCurrentModifiers()},_setCurrentModifiers:function(){var a=sc.model.player.equipModifiers,b=11,c=
0,e;for(e in this.allModifiers)if(a[e]!=void 0){if(c<(this.mode?7:100)){this.allModifiers[e].doStateTransition("DEFAULT",true);this.allModifiers[e].setCurrentValue(a[e]);this.allModifiers[e].setPos(0,b);b=b+16}c++}this.updateModText(c)},modelChanged:function(a,b,c){a==sc.menu&&(b==sc.MENU_EVENT.ITEM_INFO_CHANGED?this._setParameters(c):b==sc.MENU_EVENT.INFO_TEXT_CHANGED?sc.menu.infoText==""&&this._resetChangeValue():b==sc.MENU_EVENT.EQUIP_CHANGED?this._setCurrentValues():b==sc.MENU_EVENT.SELECTED_BODYPART?
this._resetChangeValue():b==sc.MENU_EVENT.ITEM_RESET_INFO?this._resetChangeValue():b==sc.MENU_EVENT.EQUIP_ENSURE_CURRENT_VALUES&&this._setCurrentValues())}})});ig.baked=!0;
ig.module("game.feature.menu.gui.equip.equip-misc").requires("impact.feature.gui.gui","game.feature.gui.plug-in").defines(function(){sc.EquipLevelOverview=sc.MenuPanel.extend({transitions:{DEFAULT:{state:{},time:0.2,timeFunction:KEY_SPLINES.LINEAR},HIDDEN:{state:{alpha:0,offsetX:-195},time:0.2,timeFunction:KEY_SPLINES.LINEAR}},playerLevel:null,equipLevel:null,init:function(){this.parent(sc.MenuPanelType.TOP_LEFT_EDGE);this.setAlign(ig.GUI_ALIGN.X_LEFT,ig.GUI_ALIGN.Y_TOP);this.setSize(53,28);this.setPos(197,
28);this.annotation={descType:"levels",content:{title:"sc.gui.menu.equip.levels",description:"sc.gui.menu.equip.descriptions.levels"},size:{x:55,y:30},offset:{x:-1,y:-1},index:{x:1,y:0}};var a=new sc.TextGui("LVL",{font:sc.fontsystem.tinyFont});a.setAlign(ig.GUI_ALIGN.X_RIGHT,ig.GUI_ALIGN.Y_TOP);a.setPos(3,0);this.addChildGui(a);a=new ig.ColorGui("#cdcdcd",51,1);a.setPos(1,7);this.addChildGui(a);a=new sc.TextGui(ig.lang.get("sc.gui.menu.equip.player"),{font:sc.fontsystem.tinyFont});a.setAlign(ig.GUI_ALIGN.X_RIGHT,
ig.GUI_ALIGN.Y_TOP);a.setPos(21,9);this.addChildGui(a);a=new sc.TextGui(ig.lang.get("sc.gui.menu.equip.equip"),{font:sc.fontsystem.tinyFont});a.setAlign(ig.GUI_ALIGN.X_RIGHT,ig.GUI_ALIGN.Y_TOP);a.setPos(21,19);this.addChildGui(a);this.playerLevel=new sc.NumberGui(99,{transitionTime:0.2});this.playerLevel.setAlign(ig.GUI_ALIGN.X_RIGHT,ig.GUI_ALIGN.Y_TOP);this.playerLevel.setPos(2,9);this.addChildGui(this.playerLevel);this.equipLevel=new sc.NumberGui(99,{transitionTime:0.2});this.equipLevel.setAlign(ig.GUI_ALIGN.X_RIGHT,
ig.GUI_ALIGN.Y_TOP);this.equipLevel.setPos(2,19);this.addChildGui(this.equipLevel);this.doStateTransition("HIDDEN",true)},show:function(){if(sc.options.get("equip-level-display")){this.updateNumbers(true);this.doStateTransition("DEFAULT")}},hide:function(a){this.doStateTransition("HIDDEN",a)},updateNumbers:function(a){var b=sc.model.player,c=b.level,b=~~b.getAvgEquipLevel();this.playerLevel.setNumber(c,a);this.equipLevel.setNumber(b,a);a=b-c;a>=-2?this.setColors(sc.GUI_NUMBER_COLOR.GREEN):a>=-4?this.setColors(sc.GUI_NUMBER_COLOR.WHITE):
a>=-8?this.setColors(sc.GUI_NUMBER_COLOR.ORANGE):a<-8&&this.setColors(sc.GUI_NUMBER_COLOR.RED)},setColors:function(a){this.playerLevel.setColor(a);this.equipLevel.setColor(a)}});sc.BodyPartButton=sc.ButtonGui.extend({otherButton:null,callback:null,init:function(a,b,c,e,f){this.parent(a,b,true,c,null,f);this.otherButton=e||null},focusGained:function(){this.parent();if(this.otherButton)this.otherButton.focus=true;this.callback&&this.callback(this.focus,this.pressed)},focusLost:function(){this.parent();
if(this.otherButton)this.otherButton.focus=false;this.callback&&this.callback(this.focus,this.pressed)},setPressed:function(a){this.parent(a);if(this.otherButton)this.otherButton.pressed=a;this.callback&&this.callback(this.focus,this.pressed)},setPressedAndUnFocus:function(a){this.pressed=a;this.focus=false;if(this.otherButton){this.otherButton.focus=false;this.otherButton.pressed=a}this.callback&&this.callback(this.focus,this.pressed)},isSameAs:function(a){return this==a||a==this.otherButton}});
sc.BodyPartMouseButton=ig.GuiElementBase.extend({gfx:new ig.Image("media/gui/menu.png"),button:null,slope:null,line:null,connect:null,end:null,equip:null,sizeTransition:null,topY:1,bottomY:1,_isActiveTop:false,_hasLine:false,init:function(a,b,c,e,f,g){this.parent();this.topY=f||0;g=g||0;this.button=new sc.BodyPartButton("",39,sc.BUTTON_TYPE.EQUIP,null,true);this.button.callback=this._focusCallback.bind(this);this.button.setWidth(39);this.button.hook.transitions={DEFAULT:{state:{},time:0.2,timeFunction:KEY_SPLINES.LINEAR},
HIDDEN:{state:{alpha:0,scaleX:0,scaleY:0},time:0.2,timeFunction:KEY_SPLINES.LINEAR},HIDDEN_FADE:{state:{alpha:0},time:0.1,timeFunction:KEY_SPLINES.LINEAR}};this.button.doStateTransition("HIDDEN",true);this.addChildGui(this.button);this.equip=new sc.EquipMenuMiddleIcon;this.equip.setPos(0,-1);this.button.addChildGui(this.equip);a=a||false;b=b||0;c=c||9;e=e||10;this.slope=new sc.SlopeLine(c,true,!a,sc.SlopeLine_Color.BLUE);this.slope.setPos(b,a?2:36+g);this.slope.hide();this.addChildGui(this.slope);
this.line=new ig.ColorGui("#94CEFF",e,1);this.line.setPos(b+c,a?-(c-2):35+c+g);this.line.setPivot(0,0);this.line.hook.transitions={DEFAULT:{state:{},time:0.1,timeFunction:KEY_SPLINES.LINEAR},HIDDEN:{state:{scaleX:0},time:0.1,timeFunction:KEY_SPLINES.LINEAR},HIDDEN_FADE:{state:{alpha:0},time:0.1,timeFunction:KEY_SPLINES.LINEAR}};this.addChildGui(this.line);this.line.doStateTransition("HIDDEN",true);this.connect=new ig.ColorGui("#94CEFF",1,0);this.connect.setPos(b+c+e-1,a?-(c-2):35+c+g);this.connect.setPivot(0,
0);this.connect.hook.transitions={DEFAULT:{state:{scaleY:-1},time:0,timeFunction:KEY_SPLINES.LINEAR},HIDDEN:{state:{alpha:0,scaleY:-1},time:0.1,timeFunction:KEY_SPLINES.LINEAR}};this.addChildGui(this.connect);this.connect.doStateTransition("HIDDEN",true);this.connect.doStateTransition("DEFAULT",true);this.end=new ig.ImageGui(this.gfx,0,403,172,2);this.end.setPos(c+b+e,a?-(c-2):35+c+g);this.end.setPivot(0,0);this.end.hook.transitions={DEFAULT:{state:{},time:0.1,timeFunction:KEY_SPLINES.LINEAR},HIDDEN:{state:{scaleX:0},
time:0.1,timeFunction:KEY_SPLINES.LINEAR},HIDDEN_FADE:{state:{alpha:0,scaleX:0},time:0.1,timeFunction:KEY_SPLINES.LINEAR}};this.bottomY=this.end.hook.pos.y;this.addChildGui(this.end);this.end.doStateTransition("HIDDEN",true)},_focusCallback:function(a,b){if(b||a){if(this.slope.color!=sc.SlopeLine_Color.ORANGE){this.slope.color=sc.SlopeLine_Color.ORANGE;this.line.color="#FF8A34";this.connect.color="#FF8A34";this.end.offsetY=405}}else if(this.slope.color!=sc.SlopeLine_Color.BLUE){this.slope.color=sc.SlopeLine_Color.BLUE;
this.line.color="#94CEFF";this.connect.color="#94CEFF";this.end.offsetY=403}},update:function(){this.parent();this._updateSize()},_updateSize:function(){if(this.sizeTransition){this.sizeTransition.timer=this.sizeTransition.timer+ig.system.actualTick;var a=Math.min(1,Math.max(0,this.sizeTransition.timer)/this.sizeTransition.time),a=this.sizeTransition.timeFunction.get(a);this.connect.hook.size.y=Math.round(this.sizeTransition.startHeight*(1-a)+this.sizeTransition.height*a);if(a==1)this.sizeTransition=
null}},setEquip:function(a,b,c,e){this.equip.setEquip(a,b,c,e)},setPressedAndUnFocus:function(a){this.button.setPressedAndUnFocus(a)},moveToBottom:function(){if(this._isActiveTop){this._isActiveTop=false;this.sizeTransition={startHeight:this.connect.hook.size.y,height:0,time:0.1,timeFunction:KEY_SPLINES.EASE,timer:0};this.end.doPosTranstition(this.end.hook.pos.x,this.bottomY,0.1,KEY_SPLINES.EASE)}},moveToTop:function(){if(!this._isActiveTop){this._isActiveTop=true;this.connect.doStateTransition("DEFAULT",
true);if(this.connect.hook.size.y!=0)this.connect.hook.size.y=0;var a=this.line.hook.anim.timer<this.line.hook.anim.maxTime?0.048+(this.line.hook.anim.maxTime-this.line.hook.anim.timer):0;this.sizeTransition={startHeight:this.connect.hook.size.y,height:this.topY,time:0.1,timeFunction:KEY_SPLINES.EASE,timer:0-a};this.end.doPosTranstition(this.end.hook.pos.x,this.end.hook.pos.y-this.topY,0.1,KEY_SPLINES.EASE,a)}},showButton:function(){this.button.doStateTransition("HIDDEN",true);this.button.doStateTransition("DEFAULT");
this.slope.doStateTransition("DEFAULT");this.slope.hide();this.slope.show(0.1,0.2);this.line.doStateTransition("HIDDEN",true);this.line.doStateTransition("DEFAULT",false,false,null,0.1+0.2);this.end.doStateTransition("HIDDEN",true);this.connect.doStateTransition("DEFAULT",true);this.sizeTransition={startHeight:this.connect.hook.size.y,height:0,time:0,timeFunction:KEY_SPLINES.LINEAR,timer:0};this.end.setPos(this.end.hook.pos.x,this.bottomY);this.end.doStateTransition("DEFAULT",false,false,null,0.4);
this._hasLine=true},hideButton:function(){this.button.doStateTransition("HIDDEN_FADE");this.line.hook.currentStateName!="HIDDEN"&&this.line.doStateTransition("HIDDEN_FADE");this.slope.doStateTransition("HIDDEN");this.end.hook.currentStateName!="HIDDEN"&&this.end.doStateTransition("HIDDEN_FADE");this.connect.hook.currentStateName!="HIDDEN"&&this.connect.doStateTransition("HIDDEN");this._hasLine=this._isActiveTop=false},showLine:function(a){if(!this._hasLine){this.slope.show(0.1);this.line.doStateTransition("DEFAULT",
false,false,null,0.1);this.connect.doStateTransition("DEFAULT",true);this.sizeTransition={startHeight:this.connect.hook.size.y,height:0,time:0,timeFunction:KEY_SPLINES.LINEAR,timer:0};this.end.setPos(this.end.hook.pos.x,this.bottomY);this.end.doStateTransition("DEFAULT",false,false,null,0.2);this._hasLine=true}a&&this.moveToTop()},hideLine:function(a){if(this._hasLine){if(this._isActiveTop){this._isActiveTop=false;this.sizeTransition={startHeight:this.connect.hook.size.y,height:0,time:0.1,timeFunction:KEY_SPLINES.LINEAR,
timer:0};this.end.doPosTranstition(this.end.hook.pos.x,this.bottomY,0.1,KEY_SPLINES.LINEAR)}this.line.doStateTransition("HIDDEN",a,false,null,0.1);this.slope.hide(a?0:0.1,a?0:0.2);this.end.doStateTransition("HIDDEN",a);this._hasLine=false}},resetLine:function(){this._hasLine?this._isActiveTop&&this.moveToBottom():this.showLine()}});var b=[0,1,2,3,4];sc.EquipMenuMiddleIcon=ig.GuiElementBase.extend({gfx:new ig.Image("media/gui/equip-fx.png"),menuGfx:new ig.Image("media/gui/menu.png"),transitions:{DEFAULT:{state:{},
time:0.2,timeFunction:KEY_SPLINES.EASE_IN},HIDDEN:{state:{alpha:0},time:0.2,timeFunction:KEY_SPLINES.LINEAR}},equipIcon:null,animTimer:0,animFrame:b.length,init:function(){this.parent();this.setSize(38,38);this.equipIcon=new ig.ImageGui(this.gfx,0,32,11,12);this.equipIcon.hook.transitions={DEFAULT:{state:{},time:0.15,timeFunction:KEY_SPLINES.EASE_IN},HIDDEN:{state:{alpha:0,scaleX:1.5,scaleY:1.5},time:0.2,timeFunction:KEY_SPLINES.LINEAR}};this.equipIcon.setPos(14,14);this.addChildGui(this.equipIcon)},
setEquip:function(a,b,c,e){if(b){this.equipIcon.doStateTransition("HIDDEN",true);this.equipIcon.offsetX=0+a*11;this.equipIcon.offsetY=32+this.getTypeIndex(b)*12;if(!e)this.animTimer=this.animFrame=0;this.equipIcon.doStateTransition("DEFAULT",e)}else this.equipIcon.doStateTransition("HIDDEN",true)},getTypeIndex:function(a){switch(a){case sc.ITEMS_EQUIP_TYPES.HEAD:return 0;case sc.ITEMS_EQUIP_TYPES.ARM:return 1;case sc.ITEMS_EQUIP_TYPES.TORSO:return 2;case sc.ITEMS_EQUIP_TYPES.FEET:return 3}},update:function(){if(this.animFrame<
b.length){this.animTimer=this.animTimer+ig.system.actualTick;if(this.animTimer>=0.05){this.animTimer=0;this.animFrame++;if(this.animFrame>=b.length)this.animFrame=b.length}}},updateDrawables:function(a){this.animFrame<b.length&&a.addGfx(this.gfx,3,4,b[this.animFrame]*32,0,32,32).setCompositionMode("lighter");a.addGfx(this.gfx,7,7,96,32,24,25)}})});ig.baked=!0;
ig.module("game.feature.menu.gui.equip.equip-bodypart").requires("impact.feature.gui.gui","game.feature.gui.plug-in","game.feature.menu.gui.equip.equip-misc","game.feature.menu.gui.menu-misc").defines(function(){sc.EquipRightContainer=sc.MenuPanel.extend({partChooser:null,itemList:null,sortTypes:[],_itemListActive:false,_lastEquipState:false,_globalButtons:null,_refocusFromCycle:false,init:function(b){this.parent();this.setSize(170,264);this.setAlign(ig.GUI_ALIGN.X_RIGHT,ig.GUI_ALIGN.Y_TOP);this.setPos(sc.options.hdMode?
25:2,28);this._globalButtons=b;this.hook.transitions={DEFAULT:{state:{},time:0.2,timeFunction:KEY_SPLINES.LINEAR},HIDDEN:{state:{alpha:0,offsetX:-(170+(sc.options.hdMode?25:3))},time:0.2,timeFunction:KEY_SPLINES.LINEAR}};this.partChooser=new sc.EquipBodyPartContainer(b);this.addChildGui(this.partChooser);this.itemList=new sc.ItemListBox(1);this.itemList.hook.transitions={DEFAULT:{state:{},time:0.2,timeFunction:KEY_SPLINES.LINEAR},HIDDEN:{state:{alpha:0,offsetX:170+(sc.options.hdMode?25:3)},time:0.2,
timeFunction:KEY_SPLINES.LINEAR}};this.itemList.setSize(170,210);this.itemList.setPos(0,44);this.itemList.doStateTransition("HIDDEN",true);this.itemList.list.buttonGroup.addSelectionCallback(function(a){if(a.data){sc.menu.setInfoText(a.data.description?a.data.description:a.data);if(a.data.id){ig.input.mouseGuiActive||sc.menu.ensureCurrentValues();sc.menu.setItemInfo(a.data.id)}}}.bind(this));this.itemList.list.buttonGroup.setMouseFocusLostCallback(function(){sc.menu.setInfoText("",true)});this.itemList.list.buttonGroup.addPressCallback(function(a,
b){if(a.data&&a.data.id){ig.input.mouseGuiActive||sc.menu.ensureCurrentValues();this._equipItem(a.data.id,b)&&sc.BUTTON_SOUND.equip.play();ig.input.mouseGuiActive?sc.menu.changeEquipOnCurrentBodypart(a.data.id):this.partChooser._setText(a.data.id)}}.bind(this));this.addChildGui(this.itemList);this.doStateTransition("HIDDEN",true)},update:function(){this.parent();this._updateItemList()},_equipItem:function(b,a){var d=sc.model.player.setEquipment(sc.menu.currentBodyPart,b);this._makeList(true,a,b);
return d},setCurrentBodypartPressed:function(){switch(sc.menu.currentBodyPart){case sc.MENU_EQUIP_BODYPART.NONE:for(var b in this._globalButtons)this.buttons[b]&&this.buttons[b].setPressedAndUnFocus(false);break;case sc.MENU_EQUIP_BODYPART.HEAD:this._globalButtons.head.setPressedAndUnFocus(true);break;case sc.MENU_EQUIP_BODYPART.RIGHT_ARM:this._globalButtons.rightArm.setPressedAndUnFocus(true);break;case sc.MENU_EQUIP_BODYPART.LEFT_ARM:this._globalButtons.leftArm.setPressedAndUnFocus(true);break;
case sc.MENU_EQUIP_BODYPART.TORSO:this._globalButtons.torso.setPressedAndUnFocus(true);break;case sc.MENU_EQUIP_BODYPART.FEET:this._globalButtons.feet.setPressedAndUnFocus(true)}},setCurrentBodypartUnpressed:function(){switch(sc.menu.currentBodyPart){case sc.MENU_EQUIP_BODYPART.NONE:for(var b in this._globalButtons)this.buttons[b]&&this.buttons[b].setPressedAndUnFocus(false);break;case sc.MENU_EQUIP_BODYPART.HEAD:this._globalButtons.head.setPressedAndUnFocus(false);break;case sc.MENU_EQUIP_BODYPART.RIGHT_ARM:this._globalButtons.rightArm.setPressedAndUnFocus(false);
break;case sc.MENU_EQUIP_BODYPART.LEFT_ARM:this._globalButtons.leftArm.setPressedAndUnFocus(false);break;case sc.MENU_EQUIP_BODYPART.TORSO:this._globalButtons.torso.setPressedAndUnFocus(false);break;case sc.MENU_EQUIP_BODYPART.FEET:this._globalButtons.feet.setPressedAndUnFocus(false)}},_updateItemList:function(){if(this._itemListActive&&this.itemList.list.buttonGroup.isActive()){if(sc.control.rightPressed()){this.itemList.list.buttonGroup.stepDown(10);this.itemList.list.setScrollAtCurrentYIndex()}else if(sc.control.leftPressed()){this.itemList.list.buttonGroup.stepUp(9);
this.itemList.list.setScrollAtCurrentYIndex()}if(sc.control.menuCircleLeft()){this._refocusFromCycle=true;this.setCurrentBodypartUnpressed();sc.menu.cycleBodyPartLeft();this.setCurrentBodypartPressed()}else if(sc.control.menuCircleRight()){this._refocusFromCycle=true;this.setCurrentBodypartUnpressed();sc.menu.cycleBodyPartRight();this.setCurrentBodypartPressed()}}},_activateItemList:function(){if(this._itemListActive){ig.interact.setBlockDelay(0.2);this._makeList(false)}else{this._itemListActive=
true;sc.menu.pushBackCallback(this._exitItemList.bind(this));this._makeList(false);sc.menu.buttonInteract.pushButtonGroup(this.itemList.list.buttonGroup);this.itemList.list.buttonGroup.mouseOverGui=this.partChooser.buttonGroup.mouseOverGui;ig.interact.setBlockDelay(0.2);this.itemList.doStateTransition("DEFAULT")}},_deactivateItemList:function(b){if(this._itemListActive){this._itemListActive=false;b||sc.menu.popBackCallback();this.itemList.doStateTransition("HIDDEN",b);sc.menu.buttonInteract.removeButtonGroup(this.itemList.list.buttonGroup)}},
_exitItemList:function(){sc.menu.selectBodyPart(sc.MENU_EQUIP_BODYPART.NONE);ig.input.mouseGuiActive||this.partChooser.refocusOnBack()},_makeList:function(b,a,d,c,e){b=b||this._refocusFromCycle||false;a=a||false;c=c||false;this.sortTypes[sc.menu.currentBodyPart]!=void 0?e==void 0?e=this.sortTypes[sc.menu.currentBodyPart]:this.sortTypes[sc.menu.currentBodyPart]=e:this.sortTypes[sc.menu.currentBodyPart]=e||sc.SORT_TYPE.ORDER;var f=0,g=0;if(b&&!this._refocusFromCycle){f=this.itemList.list.buttonGroup.current.y;
g=-this.itemList.list.box.hook.scroll.y}this._refocusFromCycle=false;this.itemList.list.buttonGroup.clear();this.itemList.list.clear(b);var h=false,i=null,j=sc.model.player;switch(sc.menu.currentBodyPart){case sc.MENU_EQUIP_BODYPART.HEAD:i=j.getEquipSubList(sc.ITEMS_EQUIP_TYPES.HEAD,null,e||sc.SORT_TYPE.ORDER);j.equip.head>0&&(h=true);break;case sc.MENU_EQUIP_BODYPART.LEFT_ARM:i=j.getEquipSubList(sc.ITEMS_EQUIP_TYPES.ARM,null,e||sc.SORT_TYPE.ORDER);j.equip.leftArm>0&&(h=true);break;case sc.MENU_EQUIP_BODYPART.RIGHT_ARM:i=
j.getEquipSubList(sc.ITEMS_EQUIP_TYPES.ARM,null,e||sc.SORT_TYPE.ORDER);j.equip.rightArm>0&&(h=true);break;case sc.MENU_EQUIP_BODYPART.TORSO:i=j.getEquipSubList(sc.ITEMS_EQUIP_TYPES.TORSO,null,e||sc.SORT_TYPE.ORDER);j.equip.torso>0&&(h=true);break;case sc.MENU_EQUIP_BODYPART.FEET:i=j.getEquipSubList(sc.ITEMS_EQUIP_TYPES.FEET,null,e||sc.SORT_TYPE.ORDER);j.equip.feet>0&&(h=true)}var k=null,k=null,l=0,o=0;if(h){k=new sc.ItemBoxButton(ig.lang.get("sc.gui.menu.equip.unequip-name"),140,26,-1,-1E3,ig.lang.get("sc.gui.menu.equip.unequip-des"),
true,true,null);k.button.submitSound=null;this.itemList.list.addButton(k)}for(var m=0;m<i.length;m++){o=j.items[i[m]]||0;k=sc.inventory.getItem(i[m]);l++;var n=new ig.LangLabel(k.name),n="\\i["+(k.icon+sc.inventory.getRaritySuffix(k.rarity||0)||"item-default")+"]"+ig.LangLabel.getText(k.name),p=ig.LangLabel.getText(k.description),k=new sc.ItemBoxButton(n,141,26,o,i[m],p,void 0,void 0,null,99,k.level||86);k.button.submitSound=null;this.isIDEquipped(i[m])&&k.setActive(false);this.itemList.list.addButton(k)}if(b){this.itemList.list._prevIndex=
f;if(e)g=f=0;else if(!this._lastEquipState&&h&&d!=void 0&&sc.model.player.items[d]&&sc.model.player.items[d]>0){f=Math.min(f,l-1);g=g+this.itemList.list.pageSize}a?this.itemList.list.buttonGroup.setCurrentFocus(0,f):this.itemList.list.buttonGroup.focusCurrentButton(0,f,false,c);this.itemList.list.scrollToY(g,true)}this._lastEquipState=h},isIDEquipped:function(b){switch(sc.menu.currentBodyPart){case sc.MENU_EQUIP_BODYPART.HEAD:return sc.model.player.equip.head==b;case sc.MENU_EQUIP_BODYPART.LEFT_ARM:return sc.model.player.equip.leftArm==
b;case sc.MENU_EQUIP_BODYPART.RIGHT_ARM:return sc.model.player.equip.rightArm==b;case sc.MENU_EQUIP_BODYPART.TORSO:return sc.model.player.equip.torso==b;case sc.MENU_EQUIP_BODYPART.FEET:return sc.model.player.equip.feet==b}},getCurrentSortText:function(){var b="auto";switch(this.sortTypes[sc.menu.currentBodyPart]||sc.SORT_TYPE.ORDER){case sc.SORT_TYPE.ORDER:b="auto";break;case sc.SORT_TYPE.NAME:b="name";break;case sc.SORT_TYPE.AMOUNT:b="amount";break;case sc.SORT_TYPE.RARITY:b="rarity";break;case sc.SORT_TYPE.LEVEL:b=
"level";break;case sc.SORT_TYPE.HP:b="hp";break;case sc.SORT_TYPE.ATTACK:b="attack";break;case sc.SORT_TYPE.DEFENSE:b="defense";break;case sc.SORT_TYPE.FOCUS:b="focus"}return ig.lang.get("sc.gui.menu.sort."+b)},modelChanged:function(b,a,d){b==sc.menu&&(a==sc.MENU_EVENT.SELECTED_BODYPART?b.previousBodyPart!=b.currentBodyPart&&(b.currentBodyPart==sc.MENU_EQUIP_BODYPART.NONE?this._deactivateItemList():this._activateItemList()):a==sc.MENU_EVENT.SORT_LIST&&this._makeList(true,ig.input.mouseGuiActive,null,
!ig.input.mouseGuiActive,d.data.sortType))},showMenu:function(){this._deactivateItemList(true);this.partChooser.showMenu();this.doStateTransition("DEFAULT")},hideMenu:function(){this._deactivateItemList();this.partChooser.hideMenu();this.doStateTransition("HIDDEN")},tempShowMenu:function(){sc.menu.currentBodyPart==0&&!this.partChooser.buttonGroup.isActive()?this.partChooser.showMenu():sc.menu.currentBodyPart!=0&&sc.menu.pushBackCallback(this._exitItemList.bind(this));this.doStateTransition("DEFAULT")},
tempHideMenu:function(){this.doStateTransition("HIDDEN")}});sc.EquipBodyPartContainer=ig.GuiElementBase.extend({buttonGroup:null,buttons:{head:null,rightArm:null,leftArm:null,torso:null,feet:null},init:function(b){this.parent();this.setSize(169,264);this.buttonGroup=new sc.ButtonGroup(false,ig.BUTTON_GROUP_SELECT_TYPE.VERTICAL);this.buttonGroup.addSelectionCallback(function(a){sc.menu.setInfoText(a.data)});this.buttonGroup.setMouseFocusLostCallback(function(){sc.menu.setInfoText("",true)});var a=
36,d=sc.model.player.equip;this.buttons.head=this._createButton("head",d.head,9,a,b.head.button,0,33,function(){sc.menu.selectBodyPart(sc.MENU_EQUIP_BODYPART.HEAD)}.bind(this));this.addChildGui(this.buttons.head);a=a+38;this.buttons.rightArm=this._createButton("rightarm",d.rightArm,9,a,b.rightArm.button,1,71,function(){sc.menu.selectBodyPart(sc.MENU_EQUIP_BODYPART.RIGHT_ARM)}.bind(this));this.addChildGui(this.buttons.rightArm);a=a+38;this.buttons.leftArm=this._createButton("leftarm",d.leftArm,9,a,
b.leftArm.button,2,109,function(){sc.menu.selectBodyPart(sc.MENU_EQUIP_BODYPART.LEFT_ARM)}.bind(this));this.addChildGui(this.buttons.leftArm);a=a+38;this.buttons.torso=this._createButton("torso",d.torso,9,a,b.torso.button,3,147,function(){sc.menu.selectBodyPart(sc.MENU_EQUIP_BODYPART.TORSO)}.bind(this));this.addChildGui(this.buttons.torso);this.buttons.feet=this._createButton("feet",d.feet,9,a+38,b.feet.button,4,185,function(){sc.menu.selectBodyPart(sc.MENU_EQUIP_BODYPART.FEET)}.bind(this));this.addChildGui(this.buttons.feet)},
showMenu:function(){for(var b in this.buttons)this.buttons[b]&&this.buttons[b].reset();ig.interact.setBlockDelay(0.2);sc.menu.buttonInteract.pushButtonGroup(this.buttonGroup)},hideMenu:function(){sc.menu.buttonInteract.removeButtonGroup(this.buttonGroup)},refocusOnBack:function(){switch(sc.menu.previousBodyPart){case sc.MENU_EQUIP_BODYPART.NONE:ig.debug("Whoops, Why is this happening?");break;case sc.MENU_EQUIP_BODYPART.HEAD:this.buttonGroup.focusCurrentButton(0,0,false,true);break;case sc.MENU_EQUIP_BODYPART.RIGHT_ARM:this.buttonGroup.focusCurrentButton(0,
1,false,true);break;case sc.MENU_EQUIP_BODYPART.LEFT_ARM:this.buttonGroup.focusCurrentButton(0,2,false,true);break;case sc.MENU_EQUIP_BODYPART.TORSO:this.buttonGroup.focusCurrentButton(0,3,false,true);break;case sc.MENU_EQUIP_BODYPART.FEET:this.buttonGroup.focusCurrentButton(0,4,false,true)}},_createButton:function(b,a,d,c,e,f,g,h){b=ig.lang.get("sc.gui.menu.equip."+b);a=sc.inventory.getItem(a);d=new sc.EquipBodyPartContainer.Entry(b,a,d,c,e,g);d.button.onButtonPress=h;e.onButtonPress=h;this.buttonGroup.addFocusGui(d.button,
0,f);return d},_moveButtons:function(b){switch(b){case sc.MENU_EQUIP_BODYPART.NONE:for(var a in this.buttons)this.buttons[a]&&this.buttons[a].moveToNormal();break;case sc.MENU_EQUIP_BODYPART.HEAD:this._pullInAllButtons(this.buttons.head);this.buttons.head.moveToTop();break;case sc.MENU_EQUIP_BODYPART.RIGHT_ARM:this._pullInAllButtons(this.buttons.rightArm);this.buttons.rightArm.moveToTop();break;case sc.MENU_EQUIP_BODYPART.LEFT_ARM:this._pullInAllButtons(this.buttons.leftArm);this.buttons.leftArm.moveToTop();
break;case sc.MENU_EQUIP_BODYPART.TORSO:this._pullInAllButtons(this.buttons.torso);this.buttons.torso.moveToTop();break;case sc.MENU_EQUIP_BODYPART.FEET:this._pullInAllButtons(this.buttons.feet);this.buttons.feet.moveToTop()}},_pullInAllButtons:function(b){var a=null,d;for(d in this.buttons)(a=this.buttons[d])&&a!=b&&a.hideButton()},_setText:function(b){var a=ig.lang.get("sc.gui.menu.equip.nothing"),d="",c="item-default",c=-1,e=false;if(b>0){b=sc.inventory.getItem(b);c=(b.icon||"item-default")+sc.inventory.getRaritySuffix(b.rarity||
0);a="\\i["+c+"]"+ig.LangLabel.getText(b.name);d=new ig.LangLabel(b.description);c=b.level||1;e=b.isScalable||false}switch(sc.menu.currentBodyPart){case sc.MENU_EQUIP_BODYPART.HEAD:this.buttons.head.setData(a,d,c,e);break;case sc.MENU_EQUIP_BODYPART.RIGHT_ARM:this.buttons.rightArm.setData(a,d,c,e);break;case sc.MENU_EQUIP_BODYPART.LEFT_ARM:this.buttons.leftArm.setData(a,d,c,e);break;case sc.MENU_EQUIP_BODYPART.TORSO:this.buttons.torso.setData(a,d,c,e);break;case sc.MENU_EQUIP_BODYPART.FEET:this.buttons.feet.setData(a,
d,c,e)}},modelChanged:function(b,a,d){if(b==sc.menu)if(a==sc.MENU_EVENT.SELECTED_BODYPART){if(b.currentBodyPart!=b.previousBodyPart){ig.interact.setBlockDelay(0.2);this._moveButtons(b.currentBodyPart)}}else a==sc.MENU_EVENT.EQUIP_CHANGED&&this._setText(d)}});sc.EquipBodyPartContainer.Entry=ig.GuiElementBase.extend({numberGfx:new ig.Image("media/gui/menu.png"),text:null,button:null,defaultPosition:Vec2.createC(0,0),_isActiveTop:false,_hidden:false,topY:1,bottomY:1,level:-1,isScalable:false,init:function(b,
a,d,c,e,f){this.parent();this.setSize(150,33);this.setAlign(ig.GUI_ALIGN.X_RIGHT,ig.GUI_ALIGN.Y_TOP);this.defaultPosition.x=d;this.defaultPosition.y=c;this.topY=f||1;this.setPos(this.defaultPosition.x,this.defaultPosition.y);this.hook.transitions={DEFAULT:{state:{},time:0.2,timeFunction:KEY_SPLINES.LINEAR},HIDDEN:{state:{alpha:0,offsetX:-(160+(sc.options.hdMode?25:3))},time:0.2,timeFunction:KEY_SPLINES.LINEAR}};d=null;if(a){d="\\i["+((a.icon||"item-default")+sc.inventory.getRaritySuffix(a.rarity||
0))+"]"+ig.LangLabel.getText(a.name);this.level=a.level||1;this.isScalable=a.isScalable||false}else{d=ig.lang.get("sc.gui.menu.equip.nothing");this.level=-1;this.isScalable=false}this.text=new sc.TextGui(b,{speed:ig.TextBlock.SPEED.IMMEDIATE,font:sc.fontsystem.tinyFont});this.text.setPos(2,0);this.addChildGui(this.text);this.button=new sc.BodyPartButton(d,150,sc.BUTTON_TYPE.DEFAULT,e,true);this.button.textChild.setDrawCallback(function(a,b){this.level<=0||sc.MenuHelper.drawLevel(this.level,a,b,this.numberGfx,
this.isScalable)}.bind(this));this.button.callback=e.callback;e.otherButton=this.button;this.button.setPos(0,10);this.addChildGui(this.button);this.bottomY=this.hook.pos.y;a&&this.button.setData(new ig.LangLabel(a.description));this.doStateTransition("DEFAULT",true)},setData:function(b,a,d,c){this.level=d;this.isScalable=c;this.button.textChild.setText(b);this.button.setData(a)},moveToNormal:function(){this._isActiveTop=false;if(this._hidden){this.setPos(this.hook.pos.x,this.bottomY);this.doStateTransition("DEFAULT");
this._hidden=false}else this.doPosTranstition(this.hook.pos.x,this.bottomY,0.1,KEY_SPLINES.EASE);this.button.setPressed(false)},moveToBottom:function(){if(this._isActiveTop){this._isActiveTop=false;if(this._hidden){this.setPos(this.hook.pos.x,this.bottomY);this.doStateTransition("DEFAULT");this._hidden=false}else this.doPosTranstition(this.hook.pos.x,this.bottomY,0.1,KEY_SPLINES.EASE)}},moveToTop:function(){if(!this._isActiveTop){this._isActiveTop=true;if(this._hidden){this.setPos(this.hook.pos.x,
this.bottomY-this.topY);this.doStateTransition("DEFAULT");this._hidden=false}else this.doPosTranstition(this.hook.pos.x,this.hook.pos.y-this.topY,0.1,KEY_SPLINES.EASE)}},reset:function(){this.doStateTransition("DEFAULT",true);this._isActiveTop=this._hidden=false;this.setPos(this.hook.pos.x,this.bottomY);this.button.setPressed(false)},hideButton:function(){this.doStateTransition("HIDDEN");this._hidden=true;this._isActiveTop=false;this.button.setPressed(false)},showButton:function(){this.doStateTransition("DEFAULT");
this._hidden=false}})});ig.baked=!0;
ig.module("game.feature.menu.gui.help.help-misc").requires("impact.feature.gui.gui","impact.feature.gui.base.basic-gui","game.feature.menu.gui.menu-misc").defines(function(){sc.HELP_ICON_TYPE={INFO:0};sc.HelpAnnoBase=ig.FocusGui.extend({gfx:new ig.Image("media/gui/menu.png"),icon:0,flipX:false,flipY:false,init:function(b,a,d,c){this.parent();this.setSize(d||13,c||13);this.icon=b||0;this.flipX=a.flipIconX||false;this.flipY=a.flipIconY||false},updateDrawables:function(b){var a=this.hook;b.addGfx(this.gfx,
-1,-1,642+(this.focus?7:0),160+(a.size.y<=11?8:0),6,6);b.addGfx(this.gfx,a.size.x-5,-1,642+(this.focus?7:0),160+(a.size.y<=11?8:0),6,6,true);b.addGfx(this.gfx,a.size.x-5,a.size.y-5,642+(this.focus?7:0),160+(a.size.y<=11?8:0),6,6,true,true);b.addGfx(this.gfx,-1,a.size.y-5,642+(this.focus?7:0),160+(a.size.y<=11?8:0),6,6,false,true)}});sc.HELP_ANNO_TYPE={};sc.HELP_ANNO_TYPE.INFO=sc.HelpAnnoBase.extend({init:function(b){this.parent(sc.HELP_ICON_TYPE.INFO,b)}});sc.HelpInfoBox=sc.MenuPanel.extend({transitions:{DEFAULT:{state:{},
time:0.1,timeFunction:KEY_SPLINES.LINEAR},HIDDEN:{state:{alpha:0,scaleY:0},time:0.1,timeFunction:KEY_SPLINES.LINEAR}},title:null,description:null,line:null,content:null,init:function(){this.parent(sc.MenuPanelType.TOP_RIGHT_EDGE_DARKER);this.setSize(200,13);this.title=new sc.TextGui("");this.title.hook.transitions={DEFAULT:{state:{},time:0.2,timeFunction:KEY_SPLINES.LINEAR},HIDDEN:{state:{alpha:0},time:0.2,timeFunction:KEY_SPLINES.LINEAR}};this.title.setPos(5,1);this.addChildGui(this.title);this.description=
new sc.TextGui("",{font:sc.fontsystem.smallFont,maxWidth:190});this.description.hook.transitions={DEFAULT:{state:{},time:0.2,timeFunction:KEY_SPLINES.LINEAR},HIDDEN:{state:{alpha:0},time:0.2,timeFunction:KEY_SPLINES.LINEAR}};this.description.setPos(5,18);this.addChildGui(this.description);this.line=new ig.ColorGui("#545454",196,1);this.line.hook.transitions={DEFAULT:{state:{},time:0.2,timeFunction:KEY_SPLINES.LINEAR},HIDDEN:{state:{alpha:0},time:0.2,timeFunction:KEY_SPLINES.LINEAR}};this.line.setPos(2,
17);this.addChildGui(this.line);this.content=new ig.GuiElementBase;this.addChildGui(this.content);this.doStateTransition("HIDDEN",true);this.hook.anim.targetState=null},show:function(b,a,d,c,e){var f=b.hook.pos,g=f.x+b.hook.size.x+1;g>=ig.system.width/2+85&&(g=f.x-200-1);var h=f.y;b.hook.size.y<30&&(h=h+b.hook.size.y);var b=200,i=100;this.content.removeAllChildren();if(e=="buff"){this.content.hook.size.x=200;this.title.doStateTransition("HIDDEN",true);this.description.doStateTransition("HIDDEN",true);
this.line.doStateTransition("HIDDEN",true);(a=sc.inventory.getItem(sc.menu.buffID))||(a=sc.inventory.getItem(sc.trade.buffID));d=a.stats;c=d.length;for(a=0;c--;){e=sc.STAT_CHANGE_SETTINGS[d[c]];if(e.type.key!="heal"){e=new sc.HelpBuffEntry(e,c,d.length);e.setPos(0,a);a=a+e.hook.size.y;this.content.addChildGui(e)}}b=398;i=a}else if(e=="levels"){this.description.doStateTransition("HIDDEN",true);this.title.doStateTransition("DEFAULT",true);this.line.doStateTransition("DEFAULT",true);this.title.setText("\\c[3]"+
this.getText(a,c)+"\\c[0]");this.content.setPos(0,18);this.content.hook.size.x=150;a=0;d=new sc.HelpLevelEntry("green",sc.FONT_COLORS.GREEN);d.setPos(5,a);this.content.addChildGui(d);a=a+(d.hook.size.y+1);d=new sc.HelpLevelEntry("white",0);d.setPos(5,a);this.content.addChildGui(d);a=a+(d.hook.size.y+1);d=new sc.HelpLevelEntry("orange",sc.FONT_COLORS.PURPLE);d.setPos(5,a);this.content.addChildGui(d);a=a+(d.hook.size.y+1);d=new sc.HelpLevelEntry("red",sc.FONT_COLORS.RED);d.setPos(5,a);this.content.addChildGui(d);
a=a+(d.hook.size.y+1);b=204;i=a+20;g=g-4}else{this.title.doStateTransition("DEFAULT",true);this.description.doStateTransition("DEFAULT",true);this.line.doStateTransition("DEFAULT",true);this.title.setText("\\c[3]"+this.getText(a,c)+"\\c[0]");this.description.setText(this.getText(d,c));i=18+this.description.hook.size.y+4}if(i!=this.hook.size.y||b!=this.hook.size.x)this.hook.currentStateName=="HIDDEN"&&this.hook.hasTransition()?this.doSizeTransition(b,i,0.2,KEY_SPLINES.EASE):this.setSize(b,i);h+i>=
310&&(h=f.y-i);this.hook.currentStateName=="HIDDEN"&&this.hook.hasTransition()?this.doPosTranstition(g,h,0.2,KEY_SPLINES.EASE):this.hook.currentStateName=="DEFAULT"?this.doPosTranstition(g,h,0.2,KEY_SPLINES.EASE):this.setPos(g,h);this.doStateTransition("DEFAULT")},hide:function(){this.doStateTransition("HIDDEN",false,false,null,0.1)},getText:function(b,a){return typeof b=="function"?b(a):ig.lang.get(b)}});sc.HelpLevelEntry=ig.GuiElementBase.extend({color:null,desc:null,init:function(b,a){this.parent();
this.color=new sc.TextGui("\\c["+a+"]"+ig.lang.get("sc.gui.menu.help.equip.colors."+b)+"\\c[0]:",{font:sc.fontsystem.smallFont});this.addChildGui(this.color);this.desc=new sc.TextGui(ig.lang.get("sc.gui.menu.help.equip.colorDesc."+b),{font:sc.fontsystem.smallFont,maxWidth:160});this.desc.setPos(35,0);this.addChildGui(this.desc);this.hook.size.y=Math.max(this.desc.hook.size.y,this.color.hook.size.y)}});sc.HelpBuffEntry=ig.GuiElementBase.extend({icon:null,statName:null,description:null,init:function(b,
a){this.parent();this.icon=new sc.TextGui("\\i["+b.icon+"]\\i["+b.grade+"]",{font:sc.fontsystem.tinyFont});this.icon.setPos(2,2);this.addChildGui(this.icon);var d=this.getStatName(b.type,b.change),d=b.negative?d+(" \\c[1]- "+-1*this.getStatValue(b.type,b.value,b.change)+"%\\c[0]"):d+(" \\c[2]+ "+this.getStatValue(b.type,b.value,b.change)+"%\\c[0]");this.statName=new sc.TextGui(d,{font:sc.fontsystem.smallFont});this.statName.setPos(19,0);this.addChildGui(this.statName);d=new sc.TextGui("\\i[insetArrow]",
{font:sc.fontsystem.smallFont});d.setPos(2,12);this.addChildGui(d);this.description=new sc.TextGui(this.getStatName(b.type,b.change,true),{font:sc.fontsystem.smallFont,maxWidth:378});this.description.setPos(19,11);this.addChildGui(this.description);this.setSize(400,11+this.description.hook.size.y);if(a!=0){d=new ig.ColorGui("#545454",400,1);d.setAlign(ig.GUI_ALIGN.X_CENTER,ig.GUI_ALIGN.Y_BOTTOM);this.addChildGui(d);this.hook.size.y=this.hook.size.y+1}},getStatName:function(b,a,d){var c="param";if(a==
sc.STAT_CHANGE_TYPE.STATS)if(b.key=="elemFactor")switch(b.index){case 0:c="heat";break;case 1:c="cold";break;case 2:c="shock";break;case 3:c="wave"}else b.key=="hp"?c="maxhp":b.key=="attack"?c="atk":b.key=="defense"?c="def":b.key=="focus"&&(c="foc");else if(a==sc.STAT_CHANGE_TYPE.MODIFIER)c=(!d?"modifier.":"")+b.key;else if(a==sc.STAT_CHANGE_TYPE.HEAL)return"ERROR ERROR";return ig.lang.get("sc.gui.menu.equip."+(d?"descriptions.":"")+c)},getStatValue:function(b,a,d){d==sc.STAT_CHANGE_TYPE.STATS&&(a=
b.key=="elemFactor"?(a-1)*-1:a-1);return Math.round(a*100)}})});ig.baked=!0;
ig.module("game.feature.menu.gui.help.help-menu").requires("impact.feature.gui.gui","impact.feature.gui.base.basic-gui","impact.feature.interact.button-interact","game.feature.menu.gui.base-menu","game.feature.menu.gui.menu-misc","game.feature.menu.gui.help.help-misc").defines(function(){var b={x:1E5,y:1E5};sc.HelpScreen=ig.GuiElementBase.extend({hotkeyHelp:null,hotkeyBack:null,topBar:null,bottomBar:null,box:null,color:null,content:null,info:null,buttonInteract:null,buttonGroup:null,backCallback:null,
manualTitle:null,manualContent:null,manualGui:null,base:null,addons:[],fillEmptySpaces:false,init:function(a,b,c,e,f){this.parent();this.hook.size.x=ig.system.width;this.hook.size.y=ig.system.height;this.fillEmptySpaces=f||false;this.base=a;this.manualTitle=b;this.manualContent=c;this.backCallback=e||null;this.buttonInteract=new ig.ButtonInteractEntry;this.buttonGroup=new sc.ButtonGroup;this.buttonGroup.addSelectionCallback(function(a){if(a.data)if(a.data.annotation){var b=a.data.annotation.content;
this.info.show(a,b.title,b.description,b,a.data.annotation.descType)}else this.info.hide();else this.info.hide()}.bind(this));this.buttonGroup.setMouseFocusLostCallback(function(){this.info.hide()}.bind(this));this.buttonInteract.pushButtonGroup(this.buttonGroup);this.color=new ig.ColorGui("#000",ig.system.width,ig.system.height);this.color.hook.transitions={DEFAULT:{state:{},time:0.2,timeFunction:KEY_SPLINES.LINEAR},HIDDEN:{state:{alpha:0},time:0.2,timeFunction:KEY_SPLINES.LINEAR}};this.color.hook.localAlpha=
0.5;this.color.doStateTransition("HIDDEN",true);this.addChildGui(this.color);this.topBar=new ig.ColorGui("#151515",this.hook.size.x,22);this.topBar.hook.transitions={DEFAULT:{state:{},time:0.2,timeFunction:KEY_SPLINES.LINEAR},HIDDEN:{state:{alpha:0,offsetY:-23},time:0.2,timeFunction:KEY_SPLINES.LINEAR}};this.topBar.doStateTransition("HIDDEN",true);this.addChildGui(this.topBar);a=new sc.TextGui("\\i[help-icon]"+ig.lang.get("sc.gui.menu.menu-titles.help"));a.setPos(2,3);this.topBar.addChildGui(a);this.bottomBar=
new ig.ColorGui("#151515",this.hook.size.x,1);this.bottomBar.hook.transitions={DEFAULT:{state:{},time:0.2,timeFunction:KEY_SPLINES.LINEAR},HIDDEN:{state:{alpha:0,offsetY:-1},time:0.2,timeFunction:KEY_SPLINES.LINEAR}};this.bottomBar.setAlign(ig.GUI_ALIGN.X_LEFT,ig.GUI_ALIGN.Y_BOTTOM);this.bottomBar.doStateTransition("HIDDEN",true);this.addChildGui(this.bottomBar);this.box=new sc.HelpScreenBorder;this.addChildGui(this.box);this.content=new ig.GuiElementBase;this.content.setSize(ig.system.width,ig.system.height);
this.content.hook.transitions={DEFAULT:{state:{},time:0.2,timeFunction:KEY_SPLINES.LINEAR},HIDDEN:{state:{alpha:0},time:0.2,timeFunction:KEY_SPLINES.LINEAR}};this.content.doStateTransition("HIDDEN",true);this.addChildGui(this.content);this.info=new sc.HelpInfoBox;this.addChildGui(this.info);this.hotkeyBack=new sc.ButtonGui("\\i[back]"+ig.lang.get("sc.gui.menu.back"),sc.BUTTON_TOP_MENU_WIDTH,true,sc.BUTTON_TYPE.SMALL,sc.BUTTON_SOUND.back);this.hotkeyBack.keepMouseFocus=true;this.hotkeyBack.hook.transitions=
{DEFAULT:{state:{},time:0.2,timeFunction:KEY_SPLINES.LINEAR},HIDDEN:{state:{offsetY:-this.hotkeyBack.hook.size.y},time:0.2,timeFunction:KEY_SPLINES.LINEAR}};this.hotkeyBack.onButtonPress=this.onBackButtonPressed.bind(this);this.hotkeyBack.setAlign(ig.GUI_ALIGN.X_RIGHT,ig.GUI_ALIGN.Y_TOP);this.hotkeyBack.setData(ig.lang.get("sc.gui.menu.description.back"));this.hotkeyBack.doStateTransition("HIDDEN",true);this.addChildGui(this.hotkeyBack);this.hotkeyHelp=new sc.ButtonGui("\\i[help]"+ig.lang.get("sc.gui.menu.manual"),
void 0,true,sc.BUTTON_TYPE.SMALL);this.hotkeyHelp.hook.transitions={DEFAULT:{state:{},time:0.2,timeFunction:KEY_SPLINES.LINEAR},HIDDEN:{state:{offsetY:-this.hotkeyHelp.hook.size.y},time:0.2,timeFunction:KEY_SPLINES.LINEAR}};this.hotkeyHelp.onButtonPress=this.onHelpButtonPressed.bind(this);this.hotkeyHelp.keepMouseFocus=true;this.hotkeyHelp.setAlign(ig.GUI_ALIGN.X_RIGHT,ig.GUI_ALIGN.Y_TOP);this.hotkeyHelp.setPos(this.hotkeyBack.hook.size.x+7,0);this.hotkeyHelp.doStateTransition("HIDDEN",true);this.addChildGui(this.hotkeyHelp);
this.doStateTransition("DEFAULT")},addObservers:function(){sc.Model.addObserver(sc.menu,this)},removeObservers:function(){sc.Model.removeObserver(sc.menu,this)},openMenu:function(a){this.addObservers();sc.menu.helpMenuOpen=true;ig.interact.addEntry(this.buttonInteract);this.hotkeyHelp.doStateTransition("DEFAULT",false,false,null,0.2);this.hotkeyBack.doStateTransition("DEFAULT",true);Vec2.assignC(b,1E5,1E5);this.buttonGroup.clear();this.content.removeAllChildren();this.createAnnotationsRec(this.base.hook,
0,0,0);for(var d=0;d<this.addons.length;d++)this.createAnnotationsRec(this.addons[d].hook,0,0,0);!a&&this.fillEmptySpaces&&this.buttonGroup.fillEmptySpace();this.buttonGroup.setCurrentFocus(b.x,b.y);this.buttonInteract.pushButtonGroup(this.buttonGroup);this.content.doStateTransition("DEFAULT");this.color.doStateTransition("DEFAULT");this.topBar.doStateTransition("DEFAULT");this.bottomBar.doStateTransition("DEFAULT");this.box.show();ig.interact.setBlockDelay(0.2);this.onAddHotkeys()},exitMenu:function(){this.removeObservers();
sc.menu.helpMenuOpen=false;this.color.doStateTransition("HIDDEN");this.topBar.doStateTransition("HIDDEN");this.bottomBar.doStateTransition("HIDDEN");this.box.hide();this.content.doStateTransition("HIDDEN");this.hotkeyHelp.doStateTransition("HIDDEN",false,false,function(){this.hotkeyBack.doStateTransition("HIDDEN",true)}.bind(this));this.info.hide();this.buttonInteract.removeGlobalButton(this.hotkeyHelp);this.buttonInteract.removeGlobalButton(this.hotkeyBack);this.buttonInteract.removeButtonGroup(this.buttonGroup);
ig.interact.removeEntry(this.buttonInteract);ig.interact.setBlockDelay(0.2);this.backCallback&&this.backCallback()},createAnnotationsRec:function(a,b,c,e){var f=a.children;e++;if(!(f.length==0||e>=5))for(var g=0;g<f.length;g++){var h=f[g];if((!h.gui.isHelpVisible||h.gui.isHelpVisible())&&h._visible){switch(h.align.x){case ig.GUI_ALIGN.X_LEFT:b=b+h.pos.x;break;case ig.GUI_ALIGN.X_CENTER:b=b+(h.pos.x+Math.floor(a.size.x/2)-Math.floor(h.size.x/2));break;case ig.GUI_ALIGN.X_RIGHT:b=b+(a.size.x-h.size.x-
h.pos.x)}switch(h.align.y){case ig.GUI_ALIGN.Y_TOP:c=c+h.pos.y;break;case ig.GUI_ALIGN.Y_CENTER:c=c+(h.pos.y+Math.floor(a.size.y/2)-Math.floor(h.size.y/2));break;case ig.GUI_ALIGN.Y_BOTTOM:c=c+(a.size.y-h.size.y-h.pos.y)}if(h.gui.annotation){var i=h.gui.annotation;if(i.condition&&!i.condition())continue;if(i instanceof Array)for(var j=0;j<i.length;j++)this.createGUI(h,i[j],b,c);else this.createGUI(h,i,b,c)}this.createAnnotationsRec(h,b,c,e);switch(h.align.x){case ig.GUI_ALIGN.X_LEFT:b=b-h.pos.x;break;
case ig.GUI_ALIGN.X_CENTER:b=b-(h.pos.x+Math.floor(a.size.x/2)-Math.floor(h.size.x/2));break;case ig.GUI_ALIGN.X_RIGHT:b=b-(a.size.x-h.size.x-h.pos.x)}switch(h.align.y){case ig.GUI_ALIGN.Y_TOP:c=c-h.pos.y;break;case ig.GUI_ALIGN.Y_CENTER:c=c-(h.pos.y+Math.floor(a.size.y/2)-Math.floor(h.size.y/2));break;case ig.GUI_ALIGN.Y_BOTTOM:c=c-(a.size.y-h.size.y-h.pos.y)}}}},createGUI:function(a,b,c,e){var f=new sc.HELP_ANNO_TYPE[b.type||"INFO"](b);f.data={annotation:b};b.offset?f.setPos(c+b.offset.x,e+b.offset.y):
f.setPos(c,e);if(b.size){var g=b.size.x,h=b.size.y;b.size.x=="dyn"&&(g=a.size.x+(b.size.offX||0));b.size.y=="dyn"&&(h=a.size.y+(b.size.offY||0));f.setSize(g,h)}this.content.addChildGui(f);a=Math.floor(c);e=Math.floor(e);if(b.index){a=b.index.x==void 0?a:b.index.x;e=b.index.y=="last"?this.buttonGroup.elements[a]?this.buttonGroup.elements[a].length:0:b.index.y==void 0?e:b.index.y}this.addToButtonGroup(f,a,e)},addToButtonGroup:function(a,d,c){this.buttonGroup.addFocusGui(a,d,c);b.x=Math.min(b.x,d);b.y=
Math.min(b.y,c)},onHotkeyHelpCheck:function(){return sc.control.menuHotkeyHelp()},onHelpButtonPressed:function(){if(!this.manualGui){this.manualGui=new sc.MultiPageBoxGui;this.manualGui.setDefaultHeaderText(this.manualTitle);this.manualGui.addPages(this.manualContent);this.manualGui.hook.zIndex=2E5;this.manualGui.hook.pauseGui=true}ig.gui.addGuiElement(this.manualGui);this.manualGui.openMenu()},onHotkeyBackCheck:function(){return sc.control.menuBack()},onBackButtonPressed:function(){this.exitMenu()},
createHelpGui:function(){if(!this.helpGui){this.helpGui=new sc.MultiPageBoxGui;this.helpGui.setDefaultHeaderText(ig.lang.get("sc.gui.menu.help-texts.save.title"));this.helpGui.addPages(ig.lang.get("sc.gui.menu.help-texts.save.pages"));this.helpGui.hook.zIndex=15E4;this.helpGui.hook.pauseGui=true}},onAddHotkeys:function(){this.buttonInteract.addGlobalButton(this.hotkeyHelp,this.onHotkeyHelpCheck.bind(this));this.buttonInteract.addGlobalButton(this.hotkeyBack,this.onHotkeyBackCheck.bind(this))},modelChanged:function(){}});
sc.HelpScreenBorder=ig.GuiElementBase.extend({ninepatch:new ig.NinePatch("media/gui/menu.png",{width:10,height:10,left:9,top:9,right:9,bottom:9,offsets:{"default":{x:642,y:185}}}),box:null,init:function(){this.parent();this.setSize(ig.system.width,ig.system.height);this.box=new ig.BoxGui(ig.system.width+18,ig.system.height+4+18,false,this.ninepatch);this.box.setPos(-9,-11);this.addChildGui(this.box)},update:function(){if(this.sizeTransition){this.sizeTransition.timer=this.sizeTransition.timer+ig.system.actualTick;
var a=Math.min(1,Math.max(0,this.sizeTransition.timer)/this.sizeTransition.time),a=this.sizeTransition.timeFunction.get(a);this.box.hook.size.x=Math.round(this.sizeTransition.startWidth*(1-a)+this.sizeTransition.width*a);this.box.hook.size.y=Math.round(this.sizeTransition.startHeight*(1-a)+this.sizeTransition.height*a);if(a==1)this.sizeTransition=null}},show:function(){this.box.doPosTranstition(0,22,0.2,KEY_SPLINES.LINEAR);this.doSizeTransition(ig.system.width,ig.system.height-23,0.2)},hide:function(){this.box.doPosTranstition(-9,
-11,0.2,KEY_SPLINES.LINEAR);this.doSizeTransition(ig.system.width+18,ig.system.height+4+18,0.2)},doSizeTransition:function(a,b,c,e,f){if(c)this.sizeTransition={startWidth:this.box.hook.size.x,width:a||0,startHeight:this.box.hook.size.y,height:b||0,time:c,timeFunction:e||KEY_SPLINES.LINEAR,timer:0-(f||0)};else{this.box.hook.size.x=a;this.box.hook.size.y=b}}})});ig.baked=!0;
ig.module("game.feature.menu.gui.equip.equip-menu").requires("impact.feature.gui.gui","game.feature.gui.plug-in","game.feature.menu.gui.base-menu","game.feature.menu.gui.main-menu","game.feature.menu.gui.equip.equip-status","game.feature.menu.gui.equip.equip-bodypart","game.feature.inventory.inventory","game.feature.menu.gui.help.help-menu").defines(function(){sc.EquipMenu=sc.BaseMenu.extend({gfx:new ig.Image("media/gui/menu.png"),transitions:{DEFAULT:{state:{},time:0.1,timeFunction:KEY_SPLINES.LINEAR},
HIDDEN:{state:{alpha:0},time:0.1,timeFunction:KEY_SPLINES.LINEAR}},globalButtons:{head:null,leftArm:null,rightArm:null,torso:null,feet:null},statusContainer:null,rightContainer:null,overview:null,quickSelectButtonGroup:null,hotkeys:{help:null,status:null,sort:null,"switch":null},sortMenu:null,helpGui:null,init:function(){this.parent();this.hook.size.x=ig.system.width;this.hook.size.y=ig.system.height;this.sortMenu=new sc.ItemSortMenu;this.sortMenu.addButton("level",sc.SORT_TYPE.LEVEL,4);this.sortMenu.addButton("hp",
sc.SORT_TYPE.HP,5);this.sortMenu.addButton("attack",sc.SORT_TYPE.ATTACK,6);this.sortMenu.addButton("defense",sc.SORT_TYPE.DEFENSE,7);this.sortMenu.addButton("focus",sc.SORT_TYPE.FOCUS,8);this.statusContainer=new sc.EquipStatusContainer;this.addChildGui(this.statusContainer);this.quickSelectButtonGroup=new sc.ButtonGroup;this.quickSelectButtonGroup.addSelectionCallback(function(a){sc.menu.setInfoText(a.data)});this.quickSelectButtonGroup.setMouseFocusLostCallback(function(){sc.menu.setInfoText("",
true)});this.quickSelectButtonGroup.addPressCallback(function(){this.sortMenu.active&&this.sortMenu.hideSortMenu()}.bind(this));this.globalButtons.head=new sc.BodyPartMouseButton(false,17,9,sc.options.hdMode?81:59,33);this.globalButtons.head.setPos(sc.options.hdMode?264:221,27);this.initEquipIcon(this.globalButtons.head,sc.model.player.equip.head);this.globalButtons.rightArm=new sc.BodyPartMouseButton(true,17,12,sc.options.hdMode?121:99,71);this.globalButtons.rightArm.setPos(sc.options.hdMode?221:
178,119);this.initEquipIcon(this.globalButtons.rightArm,sc.model.player.equip.rightArm);this.globalButtons.leftArm=new sc.BodyPartMouseButton(false,36,5,sc.options.hdMode?24:1,109,-12);this.globalButtons.leftArm.setPos(sc.options.hdMode?306:263,119);this.initEquipIcon(this.globalButtons.leftArm,sc.model.player.equip.leftArm);this.globalButtons.torso=new sc.BodyPartMouseButton(false,16,26,sc.options.hdMode?65:43,147);this.globalButtons.torso.setPos(sc.options.hdMode?264:221,124);this.initEquipIcon(this.globalButtons.torso,
sc.model.player.equip.torso);this.globalButtons.feet=new sc.BodyPartMouseButton(true,16,35,sc.options.hdMode?42:20,185);this.globalButtons.feet.setPos(sc.options.hdMode?278:235,256);this.initEquipIcon(this.globalButtons.feet,sc.model.player.equip.feet);this.quickSelectButtonGroup.addFocusGui(this.globalButtons.head.button,1,0);this.quickSelectButtonGroup.addFocusGui(this.globalButtons.rightArm.button,0,1);this.quickSelectButtonGroup.addFocusGui(this.globalButtons.torso.button,1,1);this.quickSelectButtonGroup.addFocusGui(this.globalButtons.leftArm.button,
2,1);this.quickSelectButtonGroup.addFocusGui(this.globalButtons.feet.button,2,2);this.rightContainer=new sc.EquipRightContainer(this.globalButtons);this.addChildGui(this.rightContainer);for(var b in this.globalButtons)this.globalButtons[b]&&this.addChildGui(this.globalButtons[b]);this.doStateTransition("DEFAULT",true);this.overview=new sc.EquipLevelOverview;this.addChildGui(this.overview);this.hotkeys.help=new sc.ButtonGui("\\i[help]"+ig.lang.get("sc.gui.menu.hotkeys.help"),void 0,true,sc.BUTTON_TYPE.SMALL);
this.hotkeys.help.keepMouseFocus=true;this.hotkeys.help.hook.transitions={DEFAULT:{state:{},time:0.2,timeFunction:KEY_SPLINES.EASE},HIDDEN:{state:{offsetY:-this.hotkeys.help.hook.size.y},time:0.2,timeFunction:KEY_SPLINES.LINEAR}};this.hotkeys.help.onButtonPress=this._onHelpButtonPressed.bind(this);this.hotkeys.sort=new sc.ButtonGui("\\i[help3]"+ig.lang.get("sc.gui.menu.item.sort-title"),void 0,true,sc.BUTTON_TYPE.SMALL);this.hotkeys.sort.keepMouseFocus=true;this.hotkeys.sort.hook.transitions={DEFAULT:{state:{},
time:0.2,timeFunction:KEY_SPLINES.EASE},HIDDEN:{state:{offsetY:-this.hotkeys.sort.hook.size.y},time:0.2,timeFunction:KEY_SPLINES.LINEAR}};this.hotkeys.sort.onButtonPress=this.onSortButtonPress.bind(this);this.hotkeys.status=new sc.ButtonGui("\\i[help2]"+ig.lang.get("sc.gui.menu.hotkeys.status"),void 0,true,sc.BUTTON_TYPE.SMALL);this.hotkeys.status.keepMouseFocus=true;this.hotkeys.status.hook.transitions={DEFAULT:{state:{},time:0.2,timeFunction:KEY_SPLINES.EASE},HIDDEN:{state:{offsetY:-this.hotkeys.status.hook.size.y},
time:0.2,timeFunction:KEY_SPLINES.LINEAR}};this.hotkeys.status.onButtonPress=this.onStatusButtonPress.bind(this);this.hotkeys.switch=new sc.ButtonGui("",null,true,sc.BUTTON_TYPE.SMALL);this.hotkeys.switch.keepMouseFocus=true;this.hotkeys.switch.submitSound=null;this.hotkeys.switch.onButtonPress=function(){var a=ig.input.mouseGuiActive?sc.menu.buttonInteract.mouseOverGui:this.rightContainer.itemList.list.buttonGroup.getCurrentElement();this.statusContainer.toggleViewMode(a);ig.interact.setBlockDelay(0.2)}.bind(this)},
initEquipIcon:function(b,a){var d=sc.inventory.getItemRarity(a),c=sc.inventory.getItemSubType(a),e=sc.inventory.getItemLevel(a);b.setEquip(d,c,e,true)},addObservers:function(){sc.Model.addObserver(sc.model.menu,this);sc.Model.addObserver(sc.model.player,this);sc.Model.addObserver(sc.model.menu,this.statusContainer);sc.Model.addObserver(sc.model.menu,this.rightContainer);sc.Model.addObserver(sc.model.menu,this.rightContainer.partChooser)},removeObservers:function(){sc.Model.removeObserver(sc.model.menu,
this);sc.Model.removeObserver(sc.model.player,this);sc.Model.removeObserver(sc.model.menu,this.statusContainer);sc.Model.removeObserver(sc.model.menu,this.rightContainer);sc.Model.removeObserver(sc.model.menu,this.rightContainer.partChooser)},_onHelpButtonCheck:function(){return sc.control.menuHotkeyHelp()},_onHelpButtonPressed:function(){sc.menu.removeHotkeys();this.createHelpGui();ig.gui.addGuiElement(this.helpGui);this.helpGui.openMenu()},createHelpGui:function(){if(!this.helpGui){this.helpGui=
new sc.HelpScreen(this,ig.lang.get("sc.gui.menu.help-texts.equip.title"),ig.lang.get("sc.gui.menu.help-texts.equip.pages"),function(){this._addHotKeys(true)}.bind(this));this.helpGui.hook.zIndex=15E4;this.helpGui.hook.pauseGui=true}},onSortButtonCheck:function(){return sc.control.menuHotkeyHelp3()},onSortButtonPress:function(){if(this.sortMenu.active)this.sortMenu.hideSortMenu();else{ig.gui.addGuiElement(this.sortMenu);this.sortMenu.showSortMenu(this.hotkeys.sort)}},onStatusButtonCheck:function(){return ig.interact.isBlocked()?
false:sc.control.menuHotkeyHelp2()},onStatusButtonPress:function(){if(sc.menu.previousMenu==sc.MENU_SUBMENU.START){sc.menu.currentBodyPart!=0&&sc.menu.popBackCallback();sc.menu.pushMenu(sc.MENU_SUBMENU.STATUS)}else if(sc.menu.previousMenu==sc.MENU_SUBMENU.STATUS){sc.menu.currentBodyPart!=0&&sc.menu.popBackCallback();this._exitMenu()}},onHotkeySwitchCheck:function(){return sc.control.menuHotkeyHelp4()},_addHotKeys:function(b){sc.menu.addHotkey(function(){return this.hotkeys.status}.bind(this));sc.menu.addHotkey(function(){return this.hotkeys.sort}.bind(this));
sc.menu.addHotkey(function(){return this.hotkeys.help}.bind(this));sc.menu.commitHotkeys(b)},_exitMenu:function(){var b=sc.menu.previousMenu;sc.menu.popBackCallback();sc.menu.popMenu();b==sc.MENU_SUBMENU.STATUS?sc.menu.previousMenu=sc.MENU_SUBMENU.START:sc.menu.exitEquipMenu()},_moveBodyPartLines:function(b,a){switch(b){case sc.MENU_EQUIP_BODYPART.NONE:for(var d in this.globalButtons)this.globalButtons[d]&&this.globalButtons[d].resetLine(a);break;case sc.MENU_EQUIP_BODYPART.HEAD:this._pullInAllButtons(this.globalButtons.head,
a);this.globalButtons.head.showLine(true);break;case sc.MENU_EQUIP_BODYPART.RIGHT_ARM:this._pullInAllButtons(this.globalButtons.rightArm,a);this.globalButtons.rightArm.showLine(true);break;case sc.MENU_EQUIP_BODYPART.LEFT_ARM:this._pullInAllButtons(this.globalButtons.leftArm,a);this.globalButtons.leftArm.showLine(true);break;case sc.MENU_EQUIP_BODYPART.TORSO:this._pullInAllButtons(this.globalButtons.torso,a);this.globalButtons.torso.showLine(true);break;case sc.MENU_EQUIP_BODYPART.FEET:this._pullInAllButtons(this.globalButtons.feet,
a);this.globalButtons.feet.showLine(true)}},_pullInAllButtons:function(b,a){var d=null,c;for(c in this.globalButtons)(d=this.globalButtons[c])&&d!=b&&d.hideLine(a)},_updateSortHotkey:function(b){var a="\\i[help3]"+ig.lang.get("sc.gui.menu.item.sort-title")+": ";this.hotkeys.sort.setText(a+("\\c[3]"+b+"\\c[0]"));sc.menu.updateHotkeys()},_updateMouseButtons:function(b,a){var d=b.equipID?sc.inventory.getItemRarity(b.equipID):null,c=b.equipID?sc.inventory.getItemSubType(b.equipID):null,e=b.equipID?sc.inventory.getItemLevel(b.equipID):
null;switch(sc.menu.currentBodyPart){case sc.MENU_EQUIP_BODYPART.NONE:this.globalButtons.head.setEquip(d,c,e,a);this.globalButtons.rightArm.setEquip(d,c,e,a);this.globalButtons.leftArm.setEquip(d,c,e,a);this.globalButtons.torso.setEquip(d,c,e,a);this.globalButtons.feet.setEquip(d,c,e,a);break;case sc.MENU_EQUIP_BODYPART.HEAD:this.globalButtons.head.setEquip(d,c,e,a);break;case sc.MENU_EQUIP_BODYPART.RIGHT_ARM:this.globalButtons.rightArm.setEquip(d,c,e,a);break;case sc.MENU_EQUIP_BODYPART.LEFT_ARM:this.globalButtons.leftArm.setEquip(d,
c,e,a);break;case sc.MENU_EQUIP_BODYPART.TORSO:this.globalButtons.torso.setEquip(d,c,e,a);break;case sc.MENU_EQUIP_BODYPART.FEET:this.globalButtons.feet.setEquip(d,c,e,a)}},modelChanged:function(b,a,d){if(b==sc.menu)if(a==sc.MENU_EVENT.SELECTED_BODYPART){if(b.currentBodyPart!=b.previousBodyPart){if(b.currentBodyPart==sc.MENU_EQUIP_BODYPART.NONE)this.hotkeys.sort.setActive(false);else{this._updateSortHotkey(this.rightContainer.getCurrentSortText());this.hotkeys.sort.setActive(true)}this._moveBodyPartLines(b.currentBodyPart)}}else a==
sc.MENU_EVENT.SORT_LIST&&this._updateSortHotkey(d.text);else if(b==sc.model.player&&a==sc.PLAYER_MSG.EQUIP_CHANGE){this.overview.updateNumbers();this._updateMouseButtons(d,false)}},showMenu:function(b,a){this.addObservers();sc.menu.menuHost==0&&sc.menu.setHost(sc.MENU_SUBMENU.EQUIPMENT);this.statusContainer.showMenu();this.overview.show();if(sc.menu.menuHost==sc.MENU_SUBMENU.EQUIPMENT)if(a==sc.MENU_SUBMENU.STATUS){sc.menu.statusPage!=sc.MENU_STATUS_PAGES.MAIN&&sc.menu.moveLeaSprite(0,-101,sc.MENU_LEA_STATE.SMALL,
true);this.rightContainer.tempShowMenu()}else{this._updateSortHotkey(ig.lang.get("sc.gui.menu.sort.auto"));this.hotkeys.sort.setActive(false);sc.menu.pushBackCallback(this._exitMenu.bind(this));this.rightContainer.showMenu()}else{sc.menu.pushBackCallback(this._exitMenu.bind(this));sc.menu.moveLeaSprite(0,-101,sc.MENU_LEA_STATE.SMALL,true);if(sc.menu.currentBodyPart==0&&!this.rightContainer.partChooser.buttonGroup.isActive()){this._updateSortHotkey(ig.lang.get("sc.gui.menu.sort.auto"));this.hotkeys.sort.setActive(false);
this.rightContainer.showMenu()}else this.rightContainer.tempShowMenu()}for(var d in this.globalButtons)this.globalButtons[d]&&this.globalButtons[d].showButton();sc.menu.currentBodyPart!=0&&a==sc.MENU_SUBMENU.STATUS&&this._moveBodyPartLines(sc.menu.currentBodyPart,true);ig.interact.setBlockDelay(0.2);sc.menu.buttonInteract.addParallelGroup(this.quickSelectButtonGroup);sc.menu.buttonInteract.addGlobalButton(this.hotkeys.help,this._onHelpButtonCheck.bind(this));sc.menu.buttonInteract.addGlobalButton(this.hotkeys.status,
this.onStatusButtonCheck.bind(this));sc.menu.buttonInteract.addGlobalButton(this.hotkeys.sort,this.onSortButtonCheck.bind(this));sc.menu.buttonInteract.addGlobalButton(this.hotkeys.switch,this.onHotkeySwitchCheck.bind(this));this._addHotKeys();if(a!=null&&a==0){this._updateSortHotkey(ig.lang.get("sc.gui.menu.sort.auto"));this.hotkeys.sort.setActive(false);sc.menu.moveLeaSprite(sc.options.hdMode?0:1,-101,sc.MENU_LEA_STATE.SMALL)}},hideMenu:function(b,a){a!=sc.MENU_SUBMENU.STATUS&&sc.menu.moveLeaSprite(0,
0,sc.MENU_LEA_STATE.LARGE);this.exitMenu(a)},exitMenu:function(b){this.removeObservers();this.statusContainer.doStateTransition("HIDDEN");this.overview.hide();if(b==sc.MENU_SUBMENU.STATUS)this.rightContainer.tempHideMenu();else{this.rightContainer.hideMenu();sc.menu.menuHost=0}this.helpGui&&ig.gui.removeGuiElement(this.helpGui);this.helpGui=null;sc.menu.buttonInteract.removeParallelGroup(this.quickSelectButtonGroup);sc.menu.buttonInteract.removeGlobalButton(this.hotkeys.help);sc.menu.buttonInteract.removeGlobalButton(this.hotkeys.sort);
sc.menu.buttonInteract.removeGlobalButton(this.hotkeys.status);sc.menu.buttonInteract.removeGlobalButton(this.hotkeys.switch);this.sortMenu.active&&this.sortMenu.hideSortMenu();for(var a in this.globalButtons)this.globalButtons[a]&&this.globalButtons[a].hideButton()}})});ig.baked=!0;
ig.module("game.feature.skills.skills").requires("impact.base.game","game.feature.combat.model.combat-params").defines(function(){function b(a,b,c){a=f[a]||f.FALLBACK;return c==sc.ELEMENT.NEUTRAL?a.neutral[b-1]:a.element[b-1]}function a(a,b,c,d){b=g[b];if(!b)return null;b=b[a];if(!b)return null;b=b[c-1];return!b?null:b[d]||null}sc.SkillTools={getCPCost:function(a,b){return a==sc.ELEMENT.NEUTRAL&&b==3?4:b}};sc.SKILL_STATES={NORMAL:0,OR_BRANCH:1,OR_BRANCH_FIRST:2};var d=[0.05,0.09,0.13],c=[0.07,0.13,
0.19],e=[0.04,0.08,0.14],f={};f.hp=f.attack=f.defense=f.focus={element:[0.04,0.07,0.09],neutral:[0.04,0.06,0.1]};f.RANGED_DMG={element:[0.06,0.11,0.15],neutral:[0.06,0.12,0.22]};f.KNOCKBACK={element:[0.15,0.3,0.45],neutral:[0.16,0.3,0.6]};f.MELEE_DMG={element:[0.06,0.11,0.15],neutral:[0.06,0.12,0.22]};f.CRITICAL_DMG={element:[0.15,0.3,0.45],neutral:[0.15,0.3,0.6]};f.GUARD_STRENGTH={element:[0.08,0.16,0.24],neutral:[0.08,0.16,0.32]};f.STUN_THRESHOLD={element:[0.02,0.04,0.06],neutral:[0.02,0.04,0.08]};
f.DASH_INVINC={element:[0.1,0.2,0.3],neutral:[0.1,0.2,0.4]};f.HP_REGEN={element:[0.13,0.25,0.36],neutral:[0.13,0.25,0.5]};f.AIM_SPEED={element:[0.1,0.2,0.3],neutral:[0.1,0.2,0.4]};f.ITEM_BOOST={element:[0.12,0.25,0.37],neutral:[0.12,0.25,0.5],propagateFactor:1};f.APPETITE={element:[0,0,1],neutral:[0,0,1],propagateFactor:1};f.SPIKE_DMG={element:[0.15,0.3,0.45],neutral:[0.15,0.3,0.6]};f.CROSS_COUNTER={element:[0.1,0.2,0.3],neutral:[0.1,0.2,0.4]};f.BERSERK={element:[0.1,0.2,0.3],neutral:[0.1,0.2,0.4]};
f.ONCE_MORE={element:[1,1,1],neutral:[1,1,1]};f.OVERHEAT_REDUCTION={element:[0.1,0.2,0.3],neutral:[0.1,0.2,0.4]};f.AIMING_MOVEMENT={element:[0.08,0.16,0.24],neutral:[0.08,0.16,0.32]};f.GUARD_SP={element:[0.1,0.2,0.3],neutral:[0.1,0.2,0.4]};f.COND_HEALING={element:[0.13,0.25,0.35],neutral:[0.13,0.3,0.6]};f.AIM_STABILITY={element:[0.2,0.4,0.6],neutral:[0.2,0.4,0.8]};f.GUARD_AREA={element:[1,1,1],neutral:[1,1,1]};f.DASH_STEP={element:[1,1,1],neutral:[1,1,1]};f.ASSAULT={element:[0.1,0.2,0.3],neutral:[0.1,
0.2,0.3]};f.COND_EFFECT_HEAT={element:[0.13,0.25,0.35],neutral:[0.15,0.3,0.6]};f.COND_EFFECT_COLD={element:[0.13,0.25,0.35],neutral:[0.15,0.3,0.6]};f.COND_EFFECT_SHOCK={element:[0.13,0.25,0.35],neutral:[0.15,0.3,0.6]};f.COND_EFFECT_WAVE={element:[0.13,0.25,0.35],neutral:[0.15,0.3,0.6]};f.COND_GUARD_HEAT={element:[0.2,0.35,0.5],neutral:[0.2,0.4,0.8]};f.COND_GUARD_COLD={element:[0.2,0.35,0.5],neutral:[0.2,0.4,0.8]};f.COND_GUARD_SHOCK={element:[0.2,0.35,0.5],neutral:[0.2,0.4,0.8]};f.COND_GUARD_WAVE=
{element:[0.2,0.35,0.5],neutral:[0.2,0.4,0.8]};f.FALLBACK={element:[0.12,0.24,0.36],neutral:[0.12,0.24,0.48]};sc.BaseSkill=ig.Class.extend({id:-1,level:1,element:sc.ELEMENT.NEUTRAL,type:sc.SKILL_STATES.NORMAL,skillKey:null,icon:2,init:function(a,b){this.id=b.id!=void 0?b.id:-1;this.level=b.level!=void 0?b.level:1;this.element=b.element!=void 0?b.element:sc.ELEMENT.NEUTRAL;this.type=b.type!=void 0?b.type:sc.SKILL_STATES.NORMAL;this.skillKey=a},applyOnConfigs:function(){},getName:function(){return ig.lang.get("sc.gui.skills.names."+
this.skillKey)},getDescription:function(){return ig.lang.get("sc.gui.skills.descriptions."+this.skillKey)},getCPCost:function(){return sc.SkillTools.getCPCost(this.element,this.level)},_getElementConfig:function(a){return a[this.element]}});sc.SKILLS={};sc.SKILLS.EMPTY=sc.BaseSkill.extend({init:function(a,b){this.parent(a,b)},apply:function(){},getDescription:function(){return"This is an empty Skill for testing. Gives 0 on everything!"}});sc.StatSkill=sc.BaseSkill.extend({statType:null,applyOnConfigs:function(a){var c=
this.statType;if(!c)throw Error("Stat is not defined!");var d=this._getElementConfig(a),e=b(c,this.level,this.element);d.skillFactors[c]=d.skillFactors[c]+e;d=f[c]||f.FALLBACK;if(this.element==sc.ELEMENT.NEUTRAL){var d=d.propagateFactor||0.5,g;for(g in a)g!=sc.ELEMENT.NEUTRAL&&(a[g].skillFactors[c]=a[g].skillFactors[c]+e*d)}},getDescription:function(){var a=ig.lang.get("sc.gui.skills.descriptions."+this.skillKey),c=b(this.statType,this.level,this.element);return a=a.replace("[xyz]",Math.floor(c*100))}});
sc.SKILLS.MAXHP=sc.StatSkill.extend({icon:7,statType:"hp"});sc.SKILLS.ATK=sc.StatSkill.extend({icon:4,statType:"attack"});sc.SKILLS.DEF=sc.StatSkill.extend({icon:5,statType:"defense"});sc.SKILLS.FOC=sc.StatSkill.extend({icon:6,statType:"focus"});sc.ElementSkill=sc.BaseSkill.extend({counter:false,init:function(a,b){this.parent(a,b)},applyOnConfigs:function(a){var a=this._getElementConfig(a),b=this._getFactor(),c=this.element-1;this.counter&&(c=c==0?1:c==1?0:c==2?3:2);a.skillFactors.elemFactor[c]=a.skillFactors.elemFactor[c]-
b},_getFactor:function(){return this.counter?c[this.level-1]:d[this.level-1]},getDescription:function(){var a=ig.lang.get("sc.gui.skills.descriptions."+this.skillKey),b=this._getFactor();return a=a.replace("[xyz]",Math.floor(b*100))}});sc.SKILLS.OWN_ELEMENT_RES_HEAT=sc.ElementSkill.extend({icon:8,counter:false});sc.SKILLS.COUNTER_ELEMENT_RES_HEAT=sc.ElementSkill.extend({icon:9,counter:true});sc.SKILLS.OWN_ELEMENT_RES_COLD=sc.ElementSkill.extend({icon:9,counter:false});sc.SKILLS.COUNTER_ELEMENT_RES_COLD=
sc.ElementSkill.extend({icon:8,counter:true});sc.SKILLS.OWN_ELEMENT_RES_SHOCK=sc.ElementSkill.extend({icon:10,counter:false});sc.SKILLS.COUNTER_ELEMENT_RES_SHOCK=sc.ElementSkill.extend({icon:11,counter:true});sc.SKILLS.OWN_ELEMENT_RES_WAVE=sc.ElementSkill.extend({icon:11,counter:false});sc.SKILLS.COUNTER_ELEMENT_RES_WAVE=sc.ElementSkill.extend({icon:10,counter:true});sc.SKILLS.ALL_ELEMENT_RES=sc.BaseSkill.extend({icon:12,init:function(a,b){this.parent(a,b)},applyOnConfigs:function(a){for(var b=this._getElementConfig(a),
c=e[this.level-1],d=0;d<b.skillFactors.elemFactor.length;d++)b.skillFactors.elemFactor[d]=b.skillFactors.elemFactor[d]-c;if(this.element==sc.ELEMENT.NEUTRAL)for(d in a)if(d!=sc.ELEMENT.NEUTRAL)for(var b=a[d].skillFactors.elemFactor,f=0;f<b.length;f++)b[f]=b[f]-c/2},getDescription:function(){var a=ig.lang.get("sc.gui.skills.descriptions."+this.skillKey);return a=a.replace("[xyz]",Math.floor(e[this.level-1]*100))}});sc.SKILLS.RANGED_DAMAGE=sc.StatSkill.extend({icon:13,statType:"RANGED_DMG"});sc.SKILLS.CHARGED_KNOCKBACK=
sc.StatSkill.extend({icon:14,statType:"KNOCKBACK"});sc.SKILLS.MELEE_DAMAGE=sc.StatSkill.extend({icon:15,statType:"MELEE_DMG"});sc.SKILLS.ASSAULT=sc.StatSkill.extend({icon:16,statType:"ASSAULT"});sc.SKILLS.CRITICAL_DAMAGE=sc.StatSkill.extend({icon:17,statType:"CRITICAL_DMG"});sc.SKILLS.AIMING_SPEED=sc.StatSkill.extend({icon:18,statType:"AIM_SPEED"});sc.SKILLS.AIMING_STABILITY=sc.StatSkill.extend({icon:19,statType:"AIM_STABILITY"});sc.SKILLS.AIMING_MOVEMENT_SPEED=sc.StatSkill.extend({icon:20,statType:"AIMING_MOVEMENT"});
sc.SKILLS.DASH_DISTANCE=sc.StatSkill.extend({icon:21,statType:"DASH_INVINC"});sc.SKILLS.ADDITIONAL_DASH_STEP=sc.StatSkill.extend({icon:22,statType:"DASH_STEP"});sc.SKILLS.GUARD_STRENGTH=sc.StatSkill.extend({icon:23,statType:"GUARD_STRENGTH"});sc.SKILLS.ADDITIONAL_GUARD_AREA=sc.StatSkill.extend({icon:24,statType:"GUARD_AREA"});sc.SKILLS.STUN_THRESHOLD=sc.StatSkill.extend({icon:26,statType:"STUN_THRESHOLD"});sc.SKILLS.STATUS_CONDITION_EFFECT_HEAT=sc.StatSkill.extend({icon:140,statType:"COND_EFFECT_HEAT"});
sc.SKILLS.STATUS_CONDITION_EFFECT_COLD=sc.StatSkill.extend({icon:141,statType:"COND_EFFECT_COLD"});sc.SKILLS.STATUS_CONDITION_EFFECT_SHOCK=sc.StatSkill.extend({icon:142,statType:"COND_EFFECT_SHOCK"});sc.SKILLS.STATUS_CONDITION_EFFECT_WAVE=sc.StatSkill.extend({icon:143,statType:"COND_EFFECT_WAVE"});sc.SKILLS.STATUS_CONDITION_GUARD_HEAT=sc.StatSkill.extend({icon:144,statType:"COND_GUARD_HEAT"});sc.SKILLS.STATUS_CONDITION_GUARD_COLD=sc.StatSkill.extend({icon:145,statType:"COND_GUARD_COLD"});sc.SKILLS.STATUS_CONDITION_GUARD_SHOCK=
sc.StatSkill.extend({icon:146,statType:"COND_GUARD_SHOCK"});sc.SKILLS.STATUS_CONDITION_GUARD_WAVE=sc.StatSkill.extend({icon:147,statType:"COND_GUARD_WAVE"});sc.SKILLS.STATUS_CONDITION_HEALING=sc.StatSkill.extend({icon:35,statType:"COND_HEALING"});sc.SKILLS.HP_REGENERATION=sc.StatSkill.extend({icon:36,statType:"HP_REGEN"});sc.SKILLS.OVERHEAT_REDUCTION=sc.StatSkill.extend({icon:37,statType:"OVERHEAT_REDUCTION"});sc.SKILLS.ITEM_BOOST=sc.StatSkill.extend({icon:38,statType:"ITEM_BOOST"});sc.SKILLS.APPETITE=
sc.StatSkill.extend({icon:28,statType:"APPETITE"});sc.SKILLS.SPIKE_DAMAGE=sc.StatSkill.extend({icon:25,statType:"SPIKE_DMG"});sc.SKILLS.CROSS_COUNTER=sc.StatSkill.extend({icon:30,statType:"CROSS_COUNTER"});sc.SKILLS.BERSERKER=sc.StatSkill.extend({icon:31,statType:"BERSERK"});sc.SKILLS.ONCE_MORE=sc.StatSkill.extend({icon:32,statType:"ONCE_MORE"});sc.SKILLS.GUARD_SP=sc.StatSkill.extend({icon:27,statType:"GUARD_SP"});var g={};g[sc.ELEMENT.NEUTRAL]={THROW:[{A:{icon:40},B:{icon:41}},{A:{icon:42},B:{icon:43}}],
ATTACK:[{A:{icon:44},B:{icon:45}},{A:{icon:46},B:{icon:47}}],DASH:[{A:{icon:48},B:{icon:49}},{A:{icon:50},B:{icon:51}}],GUARD:[{A:{icon:52},B:{icon:53}},{A:{icon:54},B:{icon:55}}]};g[sc.ELEMENT.HEAT]={THROW:[{A:{icon:60}},{A:{icon:61}}],ATTACK:[{A:{icon:62},B:{icon:63}},{A:{icon:64},B:{icon:65}},{A:{icon:66},B:{icon:67}}],DASH:[{A:{icon:68},B:{icon:69}},{A:{icon:70},B:{icon:71}},{A:{icon:72}}],GUARD:[{A:{icon:73},B:{icon:74}},{A:{icon:75},B:{icon:76}},{A:{icon:77},B:{icon:78}}]};g[sc.ELEMENT.COLD]=
{THROW:[{A:{icon:80},B:{icon:81}},{A:{icon:82},B:{icon:83}},{A:{icon:84}}],ATTACK:[{A:{icon:85},B:{icon:86}},{A:{icon:87},B:{icon:88}},{A:{icon:89},B:{icon:90}}],DASH:[{A:{icon:91}},{A:{icon:92}}],GUARD:[{A:{icon:93},B:{icon:94}},{A:{icon:95},B:{icon:96}},{A:{icon:97},B:{icon:98}}]};g[sc.ELEMENT.SHOCK]={THROW:[{A:{icon:100},B:{icon:101}},{A:{icon:102},B:{icon:103}},{A:{icon:104},B:{icon:105}}],ATTACK:[{A:{icon:106},B:{icon:107}},{A:{icon:108},B:{icon:109}},{A:{icon:110}}],DASH:[{A:{icon:111},B:{icon:112}},
{A:{icon:113},B:{icon:114}},{A:{icon:115},B:{icon:116}}],GUARD:[{A:{icon:117}},{A:{icon:118}}]};g[sc.ELEMENT.WAVE]={THROW:[{A:{icon:120},B:{icon:121}},{A:{icon:122},B:{icon:123}},{A:{icon:124},B:{icon:125}}],ATTACK:[{A:{icon:126}},{A:{icon:127}}],DASH:[{A:{icon:128},B:{icon:129}},{A:{icon:130},B:{icon:131}},{A:{icon:132},B:{icon:133}}],GUARD:[{A:{icon:134},B:{icon:135}},{A:{icon:136},B:{icon:137}},{A:{icon:138}}]};var h=/(.+)_SPECIAL(\d)_(A|B)/;sc.getCombatArtIcon=function(b,c){var d=h.exec(c);if(d)return(d=
a(d[1],b,d[2],d[3]))&&d.icon||0;return 0};sc.SKILLS.ACTIVE_PLACEHOLDER=sc.BaseSkill.extend({icon:0,init:function(a,b){this.parent(a,b)},applyOnConfigs:function(){}});sc.SpecialSkill=sc.BaseSkill.extend({skillType:null,branchType:null,init:function(b,c,d,e){this.parent(b,c);this.skillType=d;this.branchType=e;this.icon=(b=a(d,this.element,this.level,e))?b.icon:48},getName:function(){var a=sc.model.player.getCombatArt(this.element,this.skillType+"_SPECIAL"+this.level+"_"+this.branchType);return a&&a.name?
a.name.toString():ig.lang.get("sc.gui.skills.specials.wip.name")},getDescription:function(){var a=sc.model.player.getCombatArt(this.element,this.skillType+"_SPECIAL"+this.level+"_"+this.branchType);return a&&a.description?a.description.toString():ig.lang.get("sc.gui.skills.specials.wip.desc")},applyOnConfigs:function(a){var a=this._getElementConfig(a),b=this.skillType+"_SPECIAL"+this.level,c=b+"_"+this.branchType,d=b+"_"+(this.branchType=="A"?"B":"A");a.actions[c]?a.activeActions[sc.PLAYER_ACTION[b]]=
a.actions[c]:a.actions[d]&&(a.activeActions[sc.PLAYER_ACTION[b]]=a.actions[d])},getCombatArtLevel:function(a,b){return a&&a!=this.skillType||b!=void 0&&b!=this.element?0:this.level},_getElementName:function(){switch(this.element){case sc.ELEMENT.NEUTRAL:return"NEUTRAL";case sc.ELEMENT.HEAT:return"HEAT";case sc.ELEMENT.COLD:return"COLD";case sc.ELEMENT.SHOCK:return"SHOCK";case sc.ELEMENT.WAVE:return"WAVE"}}});sc.SKILLS.THROW_SPECIAL_A=sc.SpecialSkill.extend({init:function(a,b){this.parent(a,b,"THROW",
"A")}});sc.SKILLS.THROW_SPECIAL_B=sc.SpecialSkill.extend({init:function(a,b){this.parent(a,b,"THROW","B")}});sc.SKILLS.ATTACK_SPECIAL_A=sc.SpecialSkill.extend({init:function(a,b){this.parent(a,b,"ATTACK","A")}});sc.SKILLS.ATTACK_SPECIAL_B=sc.SpecialSkill.extend({init:function(a,b){this.parent(a,b,"ATTACK","B")}});sc.SKILLS.DASH_SPECIAL_A=sc.SpecialSkill.extend({init:function(a,b){this.parent(a,b,"DASH","A")}});sc.SKILLS.DASH_SPECIAL_B=sc.SpecialSkill.extend({init:function(a,b){this.parent(a,b,"DASH",
"B")}});sc.SKILLS.GUARD_SPECIAL_A=sc.SpecialSkill.extend({init:function(a,b){this.parent(a,b,"GUARD","A")}});sc.SKILLS.GUARD_SPECIAL_B=sc.SpecialSkill.extend({init:function(a,b){this.parent(a,b,"GUARD","B")}})});ig.baked=!0;
ig.module("game.feature.skills.skilltree").requires("impact.base.game","game.feature.skills.skills").defines(function(){sc.SKILLS_DISTANCE_MULTIPLIER=8;sc.SKILLS_DIRECTION={};sc.SKILLS_DIRECTION.STRAIGHT=0;sc.SKILLS_DIRECTION.CW_45=1;sc.SKILLS_DIRECTION.CW_90=2;sc.SKILLS_DIRECTION.CW_135=3;sc.SKILLS_DIRECTION.CCW_45=4;sc.SKILLS_DIRECTION.CCW_90=5;sc.SKILLS_DIRECTION.CCW_135=6;sc.SkillTree=ig.SingleLoadable.extend({version:3,_trees:null,skills:[],UID:0,init:function(){ig.SKILL_TREE?this.parent():ig.warn("Can't initialize skill tree because ig.SKILL_TREE was not provided")},
loadInternal:function(){$.ajax({dataType:"json",url:ig.root+ig.SKILL_TREE+ig.getCacheSuffix(),context:this,success:this.onload.bind(this),error:this.onerror.bind(this)})},onerror:function(b){this._trees=null;this.loadingFinished(true);ig.error("Could not load Skilltree json file! Event: %O",b)},onload:function(b){this._trees=[];this._trees[sc.ELEMENT.NEUTRAL]=b.NEUTRAL;this._trees[sc.ELEMENT.HEAT]=b.HEAT;this._trees[sc.ELEMENT.COLD]=b.COLD;this._trees[sc.ELEMENT.SHOCK]=b.SHOCK;this._trees[sc.ELEMENT.WAVE]=
b.WAVE;this.loadingFinished(true);ig.JSON_LOG&&ig.log("%cLOADABLE: %cLoaded Skilltree: \n%O","color:#149AEB","",b);this._createSkills()},_createSkills:function(){this.skills=[];this.UID=-1;var b={id:0,level:0,element:0};this._createElementTreeSkills(this._trees[sc.ELEMENT.NEUTRAL],sc.ELEMENT.NEUTRAL,b);this._createElementTreeSkills(this._trees[sc.ELEMENT.HEAT],sc.ELEMENT.HEAT,b);this._createElementTreeSkills(this._trees[sc.ELEMENT.COLD],sc.ELEMENT.COLD,b);this._createElementTreeSkills(this._trees[sc.ELEMENT.SHOCK],
sc.ELEMENT.SHOCK,b);this._createElementTreeSkills(this._trees[sc.ELEMENT.WAVE],sc.ELEMENT.WAVE,b)},_createElementTreeSkills:function(b,a,d){if(b.length!=0){d.element=a;for(var c=0;c<b.length;c++){var e=b[c];if(this.isEmpty(e))ig.warn("Empty Skill detected [element ID: %i]! Please add content for the skill, for now we skip it.",a);else{if(e.orBranch)for(var f=e.orBranch,g=0;g<f.levels.length;g++){d.level=f.levels[g];d.id=++this.UID;d.type=g==0?sc.SKILL_STATES.OR_BRANCH_FIRST:sc.SKILL_STATES.OR_BRANCH;
this.skills[this.UID]=this._createSkill(f.left[g].type,d);f.left[g].uid=this.UID;d.id=++this.UID;d.type=sc.SKILL_STATES.OR_BRANCH;this.skills[this.UID]=this._createSkill(f.right[g].type,d);f.right[g].uid=this.UID}else{d.id=++this.UID;d.level=e.level;d.type=sc.SKILL_STATES.NORMAL;e.uid=this.UID;this.skills[this.UID]=this._createSkill(e.skill.type,d)}e.children&&this._createElementTreeSkills(e.children,a,d)}}}},_createSkill:function(b,a){if(sc.SKILLS[b])return new sc.SKILLS[b](b,a);var d=new sc.SKILLS.EMPTY("EMTPY",
a);ig.warn("Unknown or no skill type detected: %c"+b,"color:orange");ig.warn("Creating Empty skill: %O",d);return d},isEmpty:function(b){for(var a in b)return false;return true},autoSkill:function(b,a,d){for(var c in sc.ELEMENT)this._autoSkillElement(b,a-1,this._trees[sc.ELEMENT[c]],d)},_autoSkillElement:function(b,a,d,c){var e=[];for(this._addAutoSkillOptions(e,d);e.length>0;){for(var d=e.length,f=null,g=0;d--;){var h=e[d];if(h.skill.getCPCost()>a)e.splice(d,1);else{var i=c&&c.indexOf(h.skill.skillKey)||
0;i==-1&&(i=500);i=i+h.skill.level*1E3;if(!f||i<g){f=h;g=i}}}if(f){a=a-f.skill.getCPCost();this._learnSkillOption(b,f,e)}}},_addAutoSkillOptions:function(b,a){for(var d=a.length;d--;){var c=a[d];if(c.orBranch){for(var e=c.orBranch,f=e.levels.length,g;f--;){if(e.left[f].type.indexOf("SPECIAL_A")){g="left";break}e.right[f].type.indexOf("SPECIAL_A")&&(g="right")}b.push({skill:this.skills[e[g][0].uid],branchObj:e,branch:g,step:0,children:c.children})}else b.push({skill:this.skills[c.uid],children:c.children})}},
_learnSkillOption:function(b,a,d){d.erase(a);b.push(a.skill);if(a.branch&&a.step+1<a.branchObj.levels.length){a.step++;a.skill=this.skills[a.branchObj[a.branch][a.step].uid];d.push(a)}else a.children&&this._addAutoSkillOptions(d,a.children)},getTree:function(b){return b!=void 0?this._trees[b]:null},getSkill:function(b){return this.skills[b]}});sc.skilltree=new sc.SkillTree});ig.baked=!0;
ig.module("game.feature.menu.gui.circuit.circuit-misc").requires("impact.feature.gui.gui","impact.feature.gui.base.basic-gui","game.feature.gui.base.numbers","game.feature.menu.gui.menu-misc","game.feature.skills.skilltree","game.feature.player.player-model").defines(function(){sc.LINE_DRAW_TYPE={HORZ:1,VERT:2,SLOPE:3};sc.TREE_CARDINAL_DIR={NORTH:0,EAST:2,SOUTH:4,WEST:6,NORTH_EAST:1,SOUTH_EAST:3,SOUTH_WEST:5,NORTH_WEST:7};sc.CircuitSwapCursor=ig.GuiElementBase.extend({gfx:new ig.Image("media/gui/circuit.png"),
focusOffset:{x:0,y:0},focus:false,_focusTimer:0,_focusTime:0,_focusOffset:0,_lastDevice:0,_gamepadActive:false,_worldmap:false,_ignoreModel:false,init:function(){this.parent();this.setSize(49,49);this._worldmap=true},focusOnNode:function(b,a){this.setPos(b-Math.floor(this.hook.size.x/2),a-Math.floor(this.hook.size.y/2)-this.focusOffset.y);this.focus=true;this._focusTimer=0;this._focusTime=0.15;this._focusOffset=0},unfocus:function(){this.focus=false;this.resetFocusTimer()},resetFocusTimer:function(){this._focusTime=
this._focusTimer=0.15;this._focusOffset=0},moveTo:function(b,a,d,c){d&&ig.input.currentDevice==ig.INPUT_DEVICES.GAMEPAD?this.doPosTranstition(b-Math.floor(this.hook.size.x/2),a-Math.floor(this.hook.size.y/2)-this.focusOffset.y,c,KEY_SPLINES.EASE):this.setPos(b-Math.floor(this.hook.size.x/2),a-Math.floor(this.hook.size.y/2)-this.focusOffset.y);if(this.focus){this._focusTimer=0;this._focusTime=0.15;this._focusOffset=3;this.focus=false}},update:function(){if(this._lastDevice!=ig.input.currentDevice){this._gamepadActive=
ig.input.currentDevice==ig.INPUT_DEVICES.GAMEPAD;this._lastDevice=ig.input.currentDevice}if(this._focusTimer<this._focusTime){this._focusTimer=this._focusTimer+ig.system.tick;if(this._focusTimer>=this._focusTime){this._focusTimer=this._focusTime;this._focusOffset=this.focus?3:0}else this._focusOffset=(this._focusTime?1:-1)*(this._focusTimer/this._focusTime)*3}},updateDrawables:function(b){this.focus?b.addGfx(this.gfx,0,0,424,168,49,49):this._gamepadActive&&b.addGfx(this.gfx,0,0,424,223,49,49)},modelChanged:function(b,
a){if(!this._ignoreModel&&b==sc.menu)if(a==sc.MENU_EVENT.MAP_CHANGED_FLOOR){this.unfocus();if(ig.input.currentDevice==ig.INPUT_DEVICES.GAMEPAD)this._gamepadActive=true}else if(a==sc.MENU_EVENT.SKILL_TOGGLED_INPUT_MODE){this._focusTime=this._focusTimer=0.15;this._focusOffset=0}else a==sc.MENU_EVENT.SKILL_SWAP_FOCUS?this.focusOnNode(sc.menu.skillSwapCursor.x,sc.menu.skillSwapCursor.y):a==sc.MENU_EVENT.SKILL_SWAP_UNFOCUS?this.unfocus():a==sc.MENU_EVENT.SKILL_SWAP_ENSURE&&(this.focus||this.focusOnNode(sc.menu.skillSwapCursor.x,
sc.menu.skillSwapCursor.y))}});sc.CrossPointsOverview=ig.GuiElementBase.extend({gfx:new ig.Image("media/gui/circuit.png"),transitions:{DEFAULT:{state:{},time:0.2,timeFunction:KEY_SPLINES.LINEAR},HIDDEN:{state:{alpha:0,offsetX:-86},time:0.2,timeFunction:KEY_SPLINES.LINEAR},HIDDEN_MIN:{state:{alpha:0,offsetX:-145},time:0.2,timeFunction:KEY_SPLINES.LINEAR}},sizeTransition:null,points:[],background:null,leftButton:null,rightButton:null,currentElement:-1,minimized:false,_elementCount:0,init:function(){this.parent();
this.setPos(10,30);this.setSize(132,100);this.setAlign(ig.GUI_ALIGN.X_LEFT,ig.GUI_ALIGN.Y_BOTTOM);this.background=new sc.MenuPanel(sc.MenuPanelType.TOP_RIGHT_EDGE);this.background.setSize(76,100);this.background.setAlign(ig.GUI_ALIGN.X_LEFT,ig.GUI_ALIGN.Y_BOTTOM);this.addChildGui(this.background);for(var b in sc.ELEMENT){var a=sc.ELEMENT[b];this.points[a]=new sc.CrossPointsOverview.Entry(a);this.addChildGui(this.points[a])}this.leftButton=new sc.ButtonGui("\\i[arrow-left]",34,true,sc.BUTTON_TYPE.SMALL);
this.leftButton.hook.transitions={DEFAULT:{state:{},time:0.2,timeFunction:KEY_SPLINES.EASE_OUT},HIDDEN:{state:{alpha:0,offsetX:-5},time:0.2,timeFunction:KEY_SPLINES.EASE_IN}};this.leftButton.setAlign(ig.GUI_ALIGN.X_LEFT,ig.GUI_ALIGN.Y_BOTTOM);this.leftButton.setPos(5,0);this.leftButton.onButtonPress=this._onHotkeyLeft.bind(this);this.rightButton=new sc.ButtonGui("\\i[arrow-right]",34,true,sc.BUTTON_TYPE.SMALL);this.rightButton.hook.transitions={DEFAULT:{state:{},time:0.2,timeFunction:KEY_SPLINES.EASE_OUT},
HIDDEN:{state:{alpha:0,offsetX:-5},time:0.2,timeFunction:KEY_SPLINES.EASE_IN}};this.rightButton.setAlign(ig.GUI_ALIGN.X_RIGHT,ig.GUI_ALIGN.Y_BOTTOM);this.rightButton.setPos(-20,0);this.rightButton.onButtonPress=this._onHotkeyRight.bind(this);this.leftButton.doStateTransition("HIDDEN",true);this.rightButton.doStateTransition("HIDDEN",true);this.background.annotation={content:{title:"sc.gui.menu.help.circuit.titles.points",description:"sc.gui.menu.help.circuit.description.points"},offset:{x:0,y:0},
size:{x:"dyn",y:"dyn"},index:{x:0,y:0},condition:function(){return!this.minimized}.bind(this)};this.addChildGui(this.leftButton);this.addChildGui(this.rightButton);this.doStateTransition("HIDDEN",true)},update:function(){if(this.sizeTransition){this.sizeTransition.timer=this.sizeTransition.timer+ig.system.actualTick;var b=Math.min(1,Math.max(0,this.sizeTransition.timer)/this.sizeTransition.time),b=this.sizeTransition.timeFunction.get(b);this.background.hook.size.x=Math.round(this.sizeTransition.startWidth*
(1-b)+this.sizeTransition.width*b);this.background.hook.size.y=Math.round(this.sizeTransition.startHeight*(1-b)+this.sizeTransition.height*b);if(b==1)this.sizeTransition=null}},doSizeTransition:function(b,a,d,c){this.sizeTransition={startWidth:this.background.hook.size.x,width:b||0,startHeight:this.background.hook.size.y,height:a||0,time:d,timeFunction:KEY_SPLINES.EASE,timer:0-(c||0)}},_addHotkeys:function(){sc.menu.buttonInteract.addGlobalButton(this.leftButton,this._checkHotkey.bind(this));sc.menu.buttonInteract.addGlobalButton(this.rightButton,
this._checkHotkey.bind(this))},_onHotkeyRight:function(){this._circleTree(1)},_onHotkeyLeft:function(){this._circleTree(0)},_checkHotkey:function(){return false},_circleTree:function(b){if(b>=0){b=this._cycleElements(b);b!=sc.menu.currentSkillTree&&sc.menu.selectSkillTree(b)}},_cycleElements:function(b){var a=sc.menu.currentSkillTree;do if(b>0)a=(a+1)%5;else{a--;a<0&&(a=4)}while(!sc.model.player.hasElement(a));return a},_selectElement:function(b){if(!(this._elementCount<=1)&&this.currentElement!=
b){if(this.minimized){this.points[this.currentElement].doStateTransition("HIDDEN",true);this.points[b].setPos(42,-2+(this._elementCount-1)*20);this.points[b].doStateTransition("DEFAULT",true);this.points[b].hideIcon(0,true);this.points[b].showIcon(0.2,false,this.currentElement)}else for(var a=this.points.length;a--;)a!=b&&this.points[a].doStateTransition("HIDDEN");this.currentElement=b;this._minimizeOverview(b)}},_minimizeOverview:function(b){if(!this.minimized){this.points[b].doPosTranstition(42,
-2+(this._elementCount-1)*20,0.2,KEY_SPLINES.EASE,0.1);this.background.doPosTranstition(13,0,0.2,null,0.2);this.doSizeTransition(132,21,0.2,0.1);this.leftButton.doStateTransition("DEFAULT",false,false,null,0.3);this.rightButton.doStateTransition("DEFAULT",false,false,null,0.3);this._addHotkeys();this.minimized=true}},_maximizeOverview:function(b){if(this.minimized){this.currentElement=-1;b=this._setPositions(false,true,b);this.background.doPosTranstition(0,0,0.2,null,0.1);this.doSizeTransition(76,
b,0.2,0.1);this.leftButton.doStateTransition("HIDDEN");this.rightButton.doStateTransition("HIDDEN");this.minimized=false;this.removeHotkeys()}},_resetOverview:function(){this.minimized=false;this.currentElement=-1;var b=this._setPositions();this.hook.size.y=b;this.background.setPos(0,0);this.background.setSize(76,b<20?20:b);this.leftButton.doStateTransition("HIDDEN",true);this.rightButton.doStateTransition("HIDDEN",true)},_setPositions:function(b,a,d){for(var c=-2,e=null,f=sc.model.player,g=this._elementCount=
0;g<this.points.length;g++){e=this.points[g];if(f.getCore(g+8)){if(a&&d!=g){e.doStateTransition("HIDDEN",true);e.doStateTransition("DEFAULT",false,false,null,0.3)}else e.doStateTransition("DEFAULT",!b);this._elementCount++}else e.doStateTransition("HIDDEN",!b);d==g&&a?e.doPosTranstition(2,c,0.2,KEY_SPLINES.EASE,0.1):e.setPos(2,c);f.getCore(g+8)&&(c=c+20)}return this._elementCount*20},addObservers:function(){sc.Model.addObserver(sc.menu,this);sc.Model.addObserver(sc.model.player,this)},removeObservers:function(){sc.Model.removeObserver(sc.model.menu,
this);sc.Model.removeObserver(sc.model.player,this)},showMenu:function(){this._resetOverview();this.doStateTransition("DEFAULT")},hideMenu:function(){this.exitMenu()},exitMenu:function(){this.minimized?this.doStateTransition("HIDDEN_MIN"):this.doStateTransition("HIDDEN",false,false,function(){this._resetOverview()}.bind(this));this.minimized=false;this.removeHotkeys()},removeHotkeys:function(){sc.menu.buttonInteract.removeGlobalButton(this.leftButton);sc.menu.buttonInteract.removeGlobalButton(this.rightButton)},
modelChanged:function(b,a){if(b==sc.menu)a==sc.MENU_EVENT.SKILL_TREE_SELECT&&(sc.menu.currentSkillTree<0?this._maximizeOverview(this.currentElement):this._selectElement(sc.menu.currentSkillTree));else if(b==sc.model.player&&(a==sc.PLAYER_MSG.CP_CHANGE||a==sc.PLAYER_MSG.SKILL_CHANGED))for(var d=this.points.length;d--;)this.points[d].updatePoints()}});sc.CrossPointsOverview.Entry=ig.GuiElementBase.extend({elementGfx:new ig.Image("media/gui/status-gui.png"),gfx:new ig.Image("media/gui/circuit.png"),
transitions:{DEFAULT:{state:{},time:0.2,timeFunction:KEY_SPLINES.LINEAR},HIDDEN:{state:{alpha:0},time:0.2,timeFunction:KEY_SPLINES.LINEAR}},number:null,alphaTransition:null,element:0,preElement:0,alpha:1,init:function(b){this.parent();this.setSize(75,24);this.number=new sc.NumberGui(108,{transitionTime:0.2});this.number.setNumber(sc.model.player.skillPoints[b],true);this.number.setAlign(ig.GUI_ALIGN.X_RIGHT,ig.GUI_ALIGN.Y_TOP);this.number.setPos(7,10);this.addChildGui(this.number);this.element=b},
update:function(){if(this.alphaTransition){this.alphaTransition.timer=this.alphaTransition.timer+ig.system.actualTick;var b=Math.min(1,Math.max(0,this.alphaTransition.timer)/this.alphaTransition.time),b=this.alphaTransition.timeFunction.get(b);this.alpha=this.alphaTransition.startAlpha*(1-b)+this.alphaTransition.alpha*b;if(b==1)this.alphaTransition=null}},updateDrawables:function(b){this.alphaTransition&&b.addGfx(this.elementGfx,0,0,104,32+this.preElement*24,24,24).setAlpha(1-this.alpha);b.addGfx(this.elementGfx,
0,0,104,32+this.element*24,24,24).setAlpha(this.alpha);b.addGfx(this.gfx,22,6,368,272,52,11)},updatePoints:function(){this.number.setNumber(sc.model.player.skillPoints[this.element])},hideIcon:function(b,a){this.doIconTransition(0,b,a)},showIcon:function(b,a,d){this.preElement=d;this.doIconTransition(1,b,a)},doIconTransition:function(b,a,d){d?this.alpha=b:this.alphaTransition={startAlpha:this.alpha,alpha:b,time:a,timeFunction:KEY_SPLINES.EASE,timer:0}}});sc.DebugSkillLearner=ig.GuiElementBase.extend({buttonInteract:null,
button:null,itemList:null,selfUpdate:false,init:function(){this.parent();this.setSize(ig.system.width,ig.system.height);this.hook.zIndex=2E3;this.hook.pauseGui=true;this.buttonInteract=new ig.ButtonInteractEntry;sc.Model.addObserver(sc.model.player,this);this.button=new sc.ButtonGui("+ 2 CP",0,true,sc.BUTTON_TYPE.SMALL);this.button.setAlign(ig.GUI_ALIGN.X_LEFT,ig.GUI_ALIGN.Y_CENTER);this.button.setPos(0,-116);this.button.hook.transitions={DEFAULT:{state:{},time:0.2,timeFunction:KEY_SPLINES.LINEAR},
HIDDEN:{state:{alpha:0,offsetX:-180},time:0.2,timeFunction:KEY_SPLINES.LINEAR}};this.button.doStateTransition("HIDDEN",true);this.button.onButtonPress=function(){sc.model.player.addSkillPoints(2,-1,true)}.bind(this);this.addChildGui(this.button);this.itemList=new sc.ItemListBox(1);this.itemList.setSize(170,210);this.itemList.setAlign(ig.GUI_ALIGN.X_LEFT,ig.GUI_ALIGN.Y_CENTER);this.itemList.quantity.setText("learned");this.itemList.list.buttonGroup.addPressCallback(function(b){this._updateLearned(b)}.bind(this));
this.itemList.setPos(0,11);this.itemList.hook.transitions={DEFAULT:{state:{},time:0.2,timeFunction:KEY_SPLINES.LINEAR},HIDDEN:{state:{alpha:0,offsetX:-180},time:0.2,timeFunction:KEY_SPLINES.LINEAR}};this.buttonInteract.pushButtonGroup(this.itemList.list.buttonGroup);this._loadSkills();this.addChildGui(this.itemList);this.itemList.doStateTransition("HIDDEN",true);this.buttonInteract.addGlobalButton(this.button,function(){return false}.bind(this))},update:function(){if(ig.input.pressed("skills"))if(this.itemList.hook.currentStateName==
"DEFAULT"){ig.interact.removeEntry(this.buttonInteract);this.itemList.doStateTransition("HIDDEN");this.button.doStateTransition("HIDDEN")}else{ig.interact.addEntry(this.buttonInteract);this.itemList.doStateTransition("DEFAULT");this.button.doStateTransition("DEFAULT")}},modelChanged:function(b,a,d){if(b==sc.model.player&&(a==sc.PLAYER_MSG.SKILL_CHANGED||a==sc.PLAYER_MSG.SKILL_BRANCH_SWAP))if(this.selfUpdate)this.selfUpdate=false;else for(var b=a==sc.PLAYER_MSG.SKILL_BRANCH_SWAP,a=this.itemList.list.getChildren(),
c=a.length,e=null,f=false;c--;){e=a[c].gui;if(f=b?true:e.data&&d==e.data.description){sc.model.player.hasSkill(e.data.description)?e.has.setText("YES"):e.has.setText("NO");if(!b)break}}},_loadSkills:function(){this.itemList.list.buttonGroup.clear();this.itemList.list.clear(false);for(var b=sc.skilltree.skills,a=null,a=null,d=0;d<Math.floor(b.length/2);d++){a=b[d];a=new sc.DebugSkillLearner.ItemBoxButton(a.getName(),136,31,a.id,d);this.itemList.list.addButton(a)}},_updateLearned:function(b){if(b.data){this.selfUpdate=
true;if(sc.model.player.hasSkill(b.data.description)){sc.model.player.unlearnSkill(b.data.description);b.has.setText("NO")}else{sc.model.player.learnSkill(b.data.description,true);b.has.setText("YES")}}}});sc.DebugSkillLearner.ItemBoxButton=sc.ListBoxButton.extend({has:null,init:function(b,a,d,c,e){this.parent(b,a,d,e,c);b=sc.model.player.hasSkill(c)?"YES":"NO";this.has=new sc.TextGui(b,{speed:ig.TextBlock.SPEED.IMMEDIATE});this.has.setAlign(ig.GUI_ALIGN.X_RIGHT,ig.GUI_ALIGN.Y_TOP);this.has.setPos(3,
2);this.addChildGui(this.has)}})});ig.baked=!0;
ig.module("game.feature.menu.gui.circuit.circuit-detail-elements").requires("impact.feature.gui.gui","impact.feature.gui.base.basic-gui","impact.feature.interact.interact","game.feature.font.font-system","game.feature.menu.gui.circuit.circuit-misc","game.feature.menu.gui.menu-misc","game.feature.model.options-model","game.feature.skills.skills").defines(function(){var b=[];b[sc.CIRCUIT_MENU_DISPLAY_TIME.SHORT]={hideDelay:0.05,midDelay:0.05,showDuration:0.1,hideDuration:0.1,noInterrupt:true};b[sc.CIRCUIT_MENU_DISPLAY_TIME.LONG]=
{hideDelay:0.3,midDelay:0.2,showDuration:0.2,hideDuration:0.2,noInterrupt:true};sc.CiruitCursor=ig.GuiElementBase.extend({gfx:new ig.Image("media/gui/circuit.png"),focus:false,_focusTimer:0,_focusTime:0,_focusOffset:0,_lastDevice:0,_gamepadActive:false,init:function(){this.parent();this.setSize(31,31)},focusOnNode:function(a,b){this.setPos(a-Math.floor(this.hook.size.x/2),b-Math.floor(this.hook.size.y/2));this.focus=true;this._focusTimer=0;this._focusTime=0.2;this._focusOffset=0},unfocus:function(){this.focus=
false;this._focusTime=this._focusTimer=0.2;this._focusOffset=0},moveTo:function(a,b,c,d){c!=void 0&&ig.input.currentDevice==ig.INPUT_DEVICES.GAMEPAD?this.doPosTranstition(a-Math.floor(this.hook.size.x/2),b-Math.floor(this.hook.size.y/2),d,KEY_SPLINES.EASE):this.setPos(a-Math.floor(this.hook.size.x/2),b-Math.floor(this.hook.size.y/2));if(this.focus){this._focusTimer=0;this._focusTime=0.2;this._focusOffset=3;this.focus=false}},addObservers:function(){sc.Model.addObserver(sc.menu,this)},removeObservers:function(){sc.Model.removeObserver(sc.menu,
this)},update:function(){if(this._lastDevice!=ig.input.currentDevice){this._gamepadActive=ig.input.currentDevice==ig.INPUT_DEVICES.GAMEPAD;this._lastDevice=ig.input.currentDevice}if(this._focusTimer<this._focusTime){this._focusTimer=this._focusTimer+ig.system.actualTick;if(this._focusTimer>=this._focusTime){this._focusTimer=this._focusTime;this._focusOffset=this.focus?3:0}else this._focusOffset=(this._focusTime?1:-1)*(this._focusTimer/this._focusTime)*3}},updateDrawables:function(a){if(this._gamepadActive||
this.focus){a.addGfx(this.gfx,3-this._focusOffset,3-this._focusOffset,36,116,12,12);a.addGfx(this.gfx,16+this._focusOffset,3-this._focusOffset,48,116,12,12);a.addGfx(this.gfx,3-this._focusOffset,16+this._focusOffset,36,128,12,12);a.addGfx(this.gfx,16+this._focusOffset,16+this._focusOffset,48,128,12,12)}},modelChanged:function(a,b){if(a==sc.menu)if(b==sc.MENU_EVENT.SKILL_TREE_SELECT){this.unfocus();if(ig.input.currentDevice==ig.INPUT_DEVICES.GAMEPAD)this._gamepadActive=true}else if(b==sc.MENU_EVENT.SKILL_CURSOR_FOCUS_NODE)this.focusOnNode(sc.menu.skillCursor.x,
sc.menu.skillCursor.y);else if(b==sc.MENU_EVENT.SKILL_CURSOR_UNFOCUS_NODE)this.unfocus();else if(b==sc.MENU_EVENT.SKILL_TOGGLED_INPUT_MODE){this._focusTime=this._focusTimer=0.2;this._focusOffset=0}else b==sc.MENU_EVENT.SKILL_ENSURE_GAMEPAD_FOCUS&&(this.focus||this.focusOnNode(sc.menu.skillCursor.x,sc.menu.skillCursor.y))}});var a=Vec2.createC(0,0),d=Vec2.createC(0,0),c=Vec2.createC(0,0);sc.CIRCUIT_NODE_MENU_MODE={ACTIVATE:0,SWAP:1};sc.CircuitNodeMenu=sc.MenuPanel.extend({ninepatch:new ig.NinePatch("media/gui/circuit.png",
{width:5,height:5,left:5,top:5,right:5,bottom:5,offsets:{"top-left":{x:32,y:176},"top-right":{x:48,y:176}}}),transitions:{DEFAULT:{state:{},time:0.2,timeFunction:KEY_SPLINES.LINEAR},HIDDEN:{state:{scaleX:1,scaleY:0},time:0.2,timeFunction:KEY_SPLINES.LINEAR}},activateSound:new ig.Sound("media/sound/menu/circuit/circuit-upgrade-b-2.ogg",1),cost:null,costNumber:null,costCP:null,activate:null,cancel:null,buttonGroup:null,mode:sc.CIRCUIT_NODE_MENU_MODE.ACTIVATE,delta:Vec2.createC(-1,-1),_scrollHook:null,
_currentFocusGui:null,_maxOrSkillStep:0,_chainMode:false,init:function(a){this.parent();this.setSize(100,63);this._scrollHook=a;this.hook.invisibleUpdate=true;this.hook.setMouseRecord(true);this.buttonGroup=new sc.ButtonGroup(false,ig.BUTTON_GROUP_SELECT_TYPE.VERTICAL);this.cost=new sc.TextGui(ig.lang.get("sc.gui.menu.skill.cost"),{speed:ig.TextBlock.SPEED.IMMEDIATE});this.cost.setPos(6,2);this.addChildGui(this.cost);this.costCP=new sc.TextGui("cp",{speed:ig.TextBlock.SPEED.IMMEDIATE});this.costCP.setAlign(ig.GUI_ALIGN.X_RIGHT,
ig.GUI_ALIGN.Y_TOP);this.costCP.setPos(6,2);this.costCP.hook.transitions={DEFAULT:{state:{},time:0,timeFunction:KEY_SPLINES.LINEAR},HIDDEN:{state:{alpha:0},time:0,timeFunction:KEY_SPLINES.LINEAR}};this.addChildGui(this.costCP);this.costNumber=new sc.NumberGui(444,{transitionTime:0,size:sc.NUMBER_SIZE.TEXT});this.costNumber.setAlign(ig.GUI_ALIGN.X_RIGHT,ig.GUI_ALIGN.Y_TOP);this.costNumber.setPos(this.costCP.hook.size.x+6,6);this.costNumber.hook.transitions={DEFAULT:{state:{},time:0,timeFunction:KEY_SPLINES.LINEAR},
HIDDEN:{state:{alpha:0},time:0,timeFunction:KEY_SPLINES.LINEAR}};this.addChildGui(this.costNumber);this.activate=new sc.ButtonGui(ig.lang.get("sc.gui.menu.skill.activate"),96,true,sc.BUTTON_TYPE.ITEM);this.activate.setPos(1,21);this.activate.submitSound=null;this.activate.onButtonPress=this._onActivatePress.bind(this);this.addChildGui(this.activate);this.cancel=new sc.ButtonGui(ig.lang.get("sc.gui.menu.skill.cancel"),96,true,sc.BUTTON_TYPE.ITEM);this.cancel.setPos(1,41);this.cancel.onButtonPress=
this._onCancelPress.bind(this);this.addChildGui(this.cancel);this.buttonGroup.addFocusGui(this.activate,0,0);this.buttonGroup.addFocusGui(this.cancel,0,1);this._addLine(1,19,98,1);this._addLine(1,61,98,1);this._addLine(98,20,1,7);this._addLine(98,36,1,25);this.doStateTransition("HIDDEN",true)},addObservers:function(){sc.Model.addObserver(sc.menu,this)},removeObservers:function(){sc.Model.removeObserver(sc.menu,this)},update:function(){this._updatePos()},updateDrawables:function(a){this.parent(a);
a.addGfx(this.ninepatch.gfx,99,26,32,148,12,13)},modelChanged:function(a,b,c){a==sc.menu&&(b==sc.MENU_EVENT.SKILL_NODE_SELECT?this._enterNodeMenu(c):b==sc.MENU_EVENT.SKILL_NODE_EXIT?this._exitNodeMenu():b==sc.MENU_EVENT.SKILL_TREE_SELECT&&this.hook.currentStateName=="DEFAULT"&&this._exitNodeMenu())},_onActivatePress:function(){if(this._currentFocusGui){var a=this._currentFocusGui.branchSkill?true:false,b=this._currentFocusGui,c=this._currentFocusGui.parentGui?this._currentFocusGui.parentGui:null,
d=this._currentFocusGui.skill.uid;sc.skilltree.getSkill(d);if(sc.skilltree.skills[d]){if(a){a=false;b.orLeft?sc.model.player.hasSkill(d+1)&&(a=true):sc.model.player.hasSkill(d-1)&&(a=true);if(a){this.activateSound.play();sc.model.player.switchBranch(d-b.orBranchIndex*2,b.orLeft);this._showEffectOnBranch(this._currentFocusGui)}else{a=false;b.orBranchIndex>0?c.orLeft?sc.model.player.hasSkill(c.skill.uid+1)&&(a=true):sc.model.player.hasSkill(c.skill.uid-1)&&(a=true):a=false;if(sc.model.player.hasSkillPoints(d))if(a){this.activateSound.play();
sc.model.player.switchBranch(d-b.orBranchIndex*2,b.orLeft,d);this._showEffectOnBranch(this._currentFocusGui)}else if(this._chainMode)this._chainActive(this._currentFocusGui);else{this.activateSound.play();sc.model.player.learnSkill(d);sc.menu.showSkillEffect(this._currentFocusGui,false)}}}else if(sc.model.player.hasSkillPoints(d))if(this._chainMode)this._chainActive(this._currentFocusGui);else{this.activateSound.play();sc.model.player.learnSkill(d);sc.menu.showSkillEffect(this._currentFocusGui,false)}sc.menu.exitNodeMenu()}else ig.warn("Could not find skill: "+
d)}},_showEffectOnBranch:function(a){if(a.orBranchIndex==0){sc.menu.showSkillEffect(this._currentFocusGui,false);sc.menu.showSkillEffect(this._currentFocusGui.nextGui,false);sc.menu.showSkillEffect(this._currentFocusGui.nextGui.nextGui,false)}else if(a.orBranchIndex==1){sc.menu.showSkillEffect(this._currentFocusGui.parentGui,false);sc.menu.showSkillEffect(this._currentFocusGui,false);sc.menu.showSkillEffect(this._currentFocusGui.nextGui,false)}else if(a.orBranchIndex==2){sc.menu.showSkillEffect(this._currentFocusGui.parentGui,
false);sc.menu.showSkillEffect(this._currentFocusGui.parentGui.parentGui,false);sc.menu.showSkillEffect(this._currentFocusGui,false)}},_chainActive:function(a){var b=0.2,c=[],d=Vec2.createC(0,0);this._collectSkills(a,c,a);for(var i=c.length;i--;){var j=c[i];j.switch?sc.model.player.switchBranch(j.skill.uid-j.gui.orBranchIndex*2,j.gui.orLeft,j.noNew?void 0:j.skill.uid):sc.model.player.learnSkill(j.skill.uid);j.gui.getNodeFocus(d);sc.menu.showSkillEffect(j.gui,false,b);b=b+0.1}c=c[c.length-1];sc.menu.centerOnNodeCam(c.gui,
c.gui.getNodeFocus(),0.2,function(){sc.menu.centerOnNodeCam(a,a.getNodeFocus(),b)}.bind(this));ig.interact.setBlockDelay(b+0.1)},_collectSkills:function(a,b,c){var d=a.skill,i=sc.model.player;if(!i.hasSkill(d.uid)){if(a.skill){if(a.orGui){var j=a.orGui;if(i.hasSkill(j.skill.uid)){if(c.orGui&&c.orLeft!=j.orLeft){b.push({gui:a,skill:d,"switch":true,noNew:true});return}if(j.orBranchIndex==2)return;if(j.orBranchIndex<=1){b[b.length-1]={gui:j.nextGui,skill:j.nextGui.skill,"switch":true};j.nextGui.nextGui&&
(b[b.length-2]={gui:j.nextGui.nextGui,skill:j.nextGui.nextGui.skill,"switch":true});return}}}b.push({gui:a,skill:d})}a.parentGui&&this._collectSkills(a.parentGui,b,c)}},_setContent:function(a){this._chainMode=a||false;var b=this._currentFocusGui.branchSkill?true:false,c=this._currentFocusGui.skill,d=c.uid,i=this._currentFocusGui.parentGui?this._currentFocusGui.parentGui:null;this.activate.textChild.setText(ig.lang.get("sc.gui.menu.skill.activate"));this.activate.setActive(true);this.cost.setText(ig.lang.get("sc.gui.menu.skill.cost"));
this.costCP.doStateTransition("DEFAULT",true);this.costNumber.doStateTransition("DEFAULT",true);this.costNumber.setColor(0,sc.GUI_NUMBER_COLOR.WHITE);this.costNumber.setNumber(0,true);this.buttonGroup.setCurrentFocus(0,0);if(sc.model.player.hasSkill(c.uid)){this.cost.setText(ig.lang.get("sc.gui.menu.skill.activated"));this.costCP.doStateTransition("HIDDEN",false);this.costNumber.doStateTransition("HIDDEN",false);this.activate.setActive(false);this.buttonGroup.setCurrentFocus(0,1)}else{var j=false;
if(b){b=false;this._currentFocusGui.orLeft?sc.model.player.hasSkill(c.uid+1)&&(b=true):sc.model.player.hasSkill(c.uid-1)&&(b=true);if(b){this.activate.textChild.setText(ig.lang.get("sc.gui.menu.skill.switch"));this.cost.setText(ig.lang.get("sc.gui.menu.skill.activated"));this.costCP.doStateTransition("HIDDEN",false);this.costNumber.doStateTransition("HIDDEN",false);return}this._currentFocusGui.orBranchIndex>0&&(i.orLeft?sc.model.player.hasSkill(i.skill.uid+1)&&(b=true):sc.model.player.hasSkill(i.skill.uid-
1)&&(b=true));b&&this.activate.textChild.setText(ig.lang.get("sc.gui.menu.skill.switch"));!b&&a&&(j=true)}else a&&(j=true);if(j){if(!this._hasParent(i)){sc.menu.setInfoText(ig.lang.get("sc.gui.menu.skill.chain-des"));a=this._getTotalSkillCost(this._currentFocusGui,0);this.costNumber.setNumber(a,true);if(sc.model.player.hasSkillPointsByCp(a,sc.skilltree.getSkill(c.uid).element)){this.activate.setActive(true);this.activate.textChild.setText(ig.lang.get("sc.gui.menu.skill.chain"));this.costNumber.setColor(sc.GUI_NUMBER_COLOR.GREEN);
this.costCP.setText("\\c[2]cp\\c[0]")}else{this.costNumber.setColor(sc.GUI_NUMBER_COLOR.RED);this.activate.setActive(false);this.activate.textChild.setText("\\c[4]"+ig.lang.get("sc.gui.menu.skill.chain")+"\\c[0]");this.buttonGroup.setCurrentFocus(0,1);this.costCP.setText("\\c[1]cp\\c[0]")}return}}else this._chainMode=false;c=sc.skilltree.getSkill(c.uid);if(!a&&!this._hasParent(i)){this.activate.setActive(false);this.buttonGroup.setCurrentFocus(0,1)}this.costNumber.setNumber(c.getCPCost(),true);if(sc.model.player.hasSkillPoints(d)){this.costNumber.setColor(sc.GUI_NUMBER_COLOR.GREEN);
this.costCP.setText("\\c[2]cp\\c[0]")}else{this.costNumber.setColor(sc.GUI_NUMBER_COLOR.RED);this.activate.setActive(false);this.buttonGroup.setCurrentFocus(0,1);this.costCP.setText("\\c[1]cp\\c[0]")}}},_getTotalSkillCost:function(a,b){if(!a.skill||sc.model.player.hasSkill(a.skill.uid)||a.orGui&&sc.model.player.hasSkill(a.orGui.skill.uid))return b;var c=sc.skilltree.getSkill(a.skill.uid),b=b+c.getCPCost();return a.parentGui?this._getTotalSkillCost(a.parentGui,b):b},_onCancelPress:function(){sc.menu.exitNodeMenu()},
_enterNodeMenu:function(a){if(this._currentFocusGui=sc.menu.currentSkillFocus){this.doStateTransition("DEFAULT");sc.menu.pushBackCallback(this._onBackButtonPress.bind(this));this._setContent(a);sc.menu.buttonInteract.pushButtonGroup(this.buttonGroup)}else this._currentFocusGui=null},_exitNodeMenu:function(){sc.menu.buttonInteract.removeButtonGroup(this.buttonGroup);this._currentFocusGui=null;this._chainMode&&sc.menu.setInfoText("",true);this.doStateTransition("HIDDEN");sc.menu.popBackCallback()},
_onBackButtonPress:function(){sc.menu.exitNodeMenu()},_addLine:function(a,b,c,d){c=new ig.ColorGui("#7E7E7E",c,d);c.setPos(a,b);this.addChildGui(c)},_updatePos:function(){if(sc.menu.currentSkillFocus&&this._currentFocusGui){var b=this.hook;d.x=b.size.x+11;d.y=b.size.y;a.x=sc.menu.skillCursor.x+6;a.y=sc.menu.skillCursor.y+54;a.x=this._currentFocusGui.hook.pos.x+6+15+this._currentFocusGui.getOffsetX();a.y=this._currentFocusGui.hook.pos.y+54+15+this._currentFocusGui.getOffsetY();var b=a.x+Math.floor(this._scrollHook.scroll.x),
f=a.y+Math.floor(this._scrollHook.scroll.y);this.delta.x=-1;this.delta.y=-1;c.x=b+this.delta.x*(15.5+d.x/2)-d.x/2;c.y=f+this.delta.y*(15.5+d.y/2)-d.y/2;this.hook.pos.x=Math.ceil(c.x);this.hook.pos.y=Math.ceil(c.y)}},_hasParent:function(a){if(a)if(a.branchSkill)if(a.orBranchIndex==2){if(!sc.model.player.hasSkill(a.skill.uid)&&!sc.model.player.hasSkill(a.skill.uid-1))return false}else if(a.orLeft){if(!sc.model.player.hasSkill(a.skill.uid)&&!sc.model.player.hasSkill(a.skill.uid+1))return false}else{if(!sc.model.player.hasSkill(a.skill.uid)&&
!sc.model.player.hasSkill(a.skill.uid-1))return false}else if(!sc.model.player.hasSkill(a.skill.uid))return false;return true}});sc.CircuitInfoBox=sc.MenuPanel.extend({ninepatch:new ig.NinePatch("media/gui/circuit.png",{width:5,height:5,left:5,top:5,right:5,bottom:5,offsets:{"top-left":{x:32,y:176},"top-right":{x:48,y:176}}}),header:null,line:null,text:null,special:null,cpCost:null,prevMove:Vec2.createC(-1,-1),delta:Vec2.createC(-1,-1),jumpFromLastSkill:null,lastPos:Vec2.createC(0,0),lastPosTimer:0,
_scrollHook:null,sizeTransition:null,FONT_BOX_OPTIONS:null,init:function(a){this.parent(sc.MenuPanelType.TOP_RIGHT_EDGE);this.FONT_BOX_OPTIONS=[{font:sc.fontsystem.tinyFont,padding:0,offset:1},{font:sc.fontsystem.smallFont,padding:-1,offset:0},{font:sc.fontsystem.font,padding:-1,offset:0}];this._scrollHook=a;this.header=new sc.TextGui("UberSkill 9000gt",{speed:ig.TextBlock.SPEED.IMMEDIATE,maxWidth:170});this.header.setPos(8,2);this.addChildGui(this.header);this.special=new sc.TextGui("Guard Art",
{speed:ig.TextBlock.SPEED.IMMEDIATE,font:sc.fontsystem.tinyFont,maxWidth:170});this.special.setPos(7,9);this.special.setAlign(ig.GUI_ALIGN.X_RIGHT,ig.GUI_ALIGN.Y_TOP);this.addChildGui(this.special);this.special.hook.localAlpha=0;this.line=new ig.ColorGui("#FFFFFF",10,1);this.line.setPos(4,19);this.addChildGui(this.line);this.cpCost=new sc.TextGui("Cost: ",{font:sc.fontsystem.tinyFont});this.cpCost.setAlign(ig.GUI_ALIGN.X_RIGHT,ig.GUI_ALIGN.Y_TOP);this.addChildGui(this.cpCost);a=sc.options.get("circuit-text-size");
a=this.FONT_BOX_OPTIONS[a]?a:0;this.text=new sc.TextGui("Unlocks Magic Dagger + 5.\nIncreases text by a third line.",{speed:ig.TextBlock.SPEED.IMMEDIATE,maxWidth:170,linePadding:this.FONT_BOX_OPTIONS[a].padding,font:this.FONT_BOX_OPTIONS[a].font});this.text.setPos(8,20+this.FONT_BOX_OPTIONS[a].offset);this.addChildGui(this.text);a=b[sc.options.get("circuit-display-time")||0];this.hook.transitions={DEFAULT:{state:{},time:a.showDuration,timeFunction:KEY_SPLINES.LINEAR},HIDDEN:{state:{scaleX:1,scaleY:0,
alpha:0},time:a.hideDuration,timeFunction:KEY_SPLINES.LINEAR}};this.hook.invisibleUpdate=true;this.doSizeTransition(true);this.setPos(100,100);this.doStateTransition("HIDDEN",true)},addObservers:function(){sc.Model.addObserver(sc.menu,this);var a=sc.options.get("circuit-text-size"),a=this.FONT_BOX_OPTIONS[a]?a:0;this.text.setFont(this.FONT_BOX_OPTIONS[a].font,this.FONT_BOX_OPTIONS[a].padding);this.text.setPos(8,20+this.FONT_BOX_OPTIONS[a].offset);a=b[sc.options.get("circuit-display-time")||0];this.hook.transitions=
{DEFAULT:{state:{},time:a.showDuration,timeFunction:KEY_SPLINES.LINEAR},HIDDEN:{state:{scaleX:1,scaleY:0,alpha:0},time:a.hideDuration,timeFunction:KEY_SPLINES.LINEAR}};this.doSizeTransition(true)},removeObservers:function(){sc.Model.removeObserver(sc.menu,this);this.jumpFromLastSkill=null;this.prevMove.x=0},doSizeTransition:function(a){var b;b=30+(this.text.hook.size.y+4);if(!(186==this.hook.size.x&&b==this.hook.size.y)){this.line.setSize(178,1);this.line.setPos(4,19);this.cpCost.setPos(8,this.text.hook.size.y+
24);a?this.setSize(186,b):this.sizeTransition={startWidth:this.hook.size.x,width:186,startHeight:this.hook.size.y,height:b||0,time:0.1,timeFunction:KEY_SPLINES.EASE,timer:0}}},update:function(){if(sc.menu.skillDrag&&!sc.menu.currentSkillFocus){this.doStateTransition("HIDDEN",false,false,function(){this.jumpFromLastSkill=null}.bind(this));this.jumpFromLastSkill=null}this._updatePos(true);this._updateSize();if(!this.hook.hasTransition()&&this.hook.currentStateName=="HIDDEN"){this.jumpFromLastSkill=
null;this.lastPosTimer=0}},modelChanged:function(a,b){if(a==sc.menu)if(b==sc.MENU_EVENT.SKILL_CURSOR_FOCUS_NODE){this._setContent();this.doStateTransition("DEFAULT")}else if(b==sc.MENU_EVENT.SKILL_CURSOR_UNFOCUS_NODE)this._hideInfo();else if(b==sc.MENU_EVENT.SKILL_TREE_SELECT||b==sc.MENU_EVENT.SKILL_TOGGLED_INPUT_MODE){this.jumpFromLastSkill=sc.menu.currentSkillFocus=null;this.prevMove.x=0;this.doStateTransition("HIDDEN",false,false,function(){this.jumpFromLastSkill=null}.bind(this))}},_updatePos:function(b){if(sc.menu.currentSkillFocus){if(this.jumpFromLastSkill&&
this.jumpFromLastSkill!=sc.menu.currentSkillFocus){Vec2.assign(this.lastPos,this.hook.pos);this.lastPosTimer=0.1}this.jumpFromLastSkill=sc.menu.currentSkillFocus;var f=this.hook;d.x=f.size.x;d.y=f.size.y;if(ig.input.currentDevice==ig.INPUT_DEVICES.GAMEPAD){f=sc.menu.currentSkillFocus;a.x=f.hook.pos.x+20+f.getOffsetX();a.y=f.hook.pos.y+20+f.getOffsetY()}else{a.x=sc.menu.skillCursor.x;a.y=sc.menu.skillCursor.y}var f=a.x+Math.ceil(this._scrollHook.scroll.x),g=a.y+Math.ceil(this._scrollHook.scroll.y),
h=f-(ig.system.width-d.x-16),i=h<=0?1:-1;if(b&&this.prevMove.x!=0){if(sc.menu.skillState==sc.MENU_SKILL_STATE.NODE_MENU)this.prevMove.x=1;else if(i!=this.prevMove.x&&Math.abs(h)>16)this.prevMove.x=i;this.delta.x=this.delta.x*0.8+this.prevMove.x*0.2;this.delta.y=this.delta.y*0.8+this.prevMove.y*0.2}else{this.prevMove.x=this.delta.x=i;this.prevMove.y=this.delta.y=-1}c.x=f+this.delta.x*(15.5+d.x/2)-d.x/2;c.y=g+this.delta.y*(15.5+d.y/2)-d.y/2;c.x=c.x.limit(1,ig.system.width-d.x-1);c.y=c.y.limit(22,ig.system.height-
d.y-22-(c.x<192?Math.min(30,192-c.x):0));if(this.lastPosTimer>0){this.lastPosTimer=this.lastPosTimer-ig.system.actualTick;this.lastPosTimer<=0?this.lastPosTimer=0:Vec2.lerp(c,this.lastPos,this.lastPosTimer/0.1)}this.hook.pos.x=Math.ceil(c.x);this.hook.pos.y=Math.ceil(c.y)}else{if(this.hook.currentStateName=="HIDDEN"&&!this.hook.hasTransition())this.jumpFromLastSkill=null;this.prevMove.x=0}},_updateSize:function(){if(this.sizeTransition){this.sizeTransition.timer=this.sizeTransition.timer+ig.system.actualTick;
var a=Math.min(1,Math.max(0,this.sizeTransition.timer)/this.sizeTransition.time),a=this.sizeTransition.timeFunction.get(a);this.hook.size.x=Math.round(this.sizeTransition.startWidth*(1-a)+this.sizeTransition.width*a);this.hook.size.y=Math.round(this.sizeTransition.startHeight*(1-a)+this.sizeTransition.height*a);if(a==1)this.sizeTransition=null}},_setContent:function(){var a=sc.menu.currentSkillFocus.skill,b=sc.skilltree.getSkill(a.uid);if(b.getName().slice(0,4)=="BS [")this.header.setText("UberSkill 9000gt");
else if(b instanceof sc.SpecialSkill){this.header.setText("\\c[3]"+b.getName()+"\\c[0]");this.special.setText(ig.lang.get("sc.gui.skills.special-types."+b.skillType));this.special.hook.localAlpha=1}else{this.header.setText(b.getName());this.special.hook.localAlpha=0}if(sc.menu.currentSkillFocus.blocked){var c="\\c[3]"+sc.inventory.getItemName(sc.menu.currentSkillFocus.blockID)+"\\c[0]",d=ig.lang.get("sc.gui.menu.skill.shade");this.text.setText(d.replace("[xyz]",c))}else this.text.setText(b.getDescription());
var c=sc.SkillTools.getCPCost(b.element,b.level),d=sc.menu.currentSkillFocus,i=sc.model.player;if(d.branchSkill){var j=false;d.orLeft?i.hasSkill(b.id+1)&&(j=true):i.hasSkill(b.id-1)&&(j=true);j?this.cpCost.setText("\\c[3]"+ig.lang.get("sc.gui.menu.skill.swappable")+"\\c[0]"):i.hasSkill(a.uid)?this.cpCost.setText("\\c[3]"+ig.lang.get("sc.gui.menu.skill.activated")+"\\c[0]"):i.hasSkillPoints(a.uid)?this.cpCost.setText(ig.lang.get("sc.gui.menu.skill.cost")+" \\c[2]"+c+"cp\\c[0]"):this.cpCost.setText(ig.lang.get("sc.gui.menu.skill.cost")+
" \\c[1]"+c+"cp\\c[0]")}else i.hasSkill(a.uid)?this.cpCost.setText("\\c[3]"+ig.lang.get("sc.gui.menu.skill.activated")+"\\c[0]"):i.hasSkillPoints(a.uid)?this.cpCost.setText(ig.lang.get("sc.gui.menu.skill.cost")+" \\c[2]"+c+"cp\\c[0]"):this.cpCost.setText(ig.lang.get("sc.gui.menu.skill.cost")+" \\c[1]"+c+"cp\\c[0]");this.doSizeTransition(true)},_hideInfo:function(){var a=b[sc.options.get("circuit-display-time")||0];this.hook.hasTransition()&&this.hook.currentStateName!="DEFAULT"?this.doStateTransition("HIDDEN",
false,false,function(){this.jumpFromLastSkill=null}.bind(this)):a.noInterrupt&&this.hook.hasTransition()&&this.hook.currentStateName=="DEFAULT"?this.hook.stateCallback=function(){this.doStateTransition("HIDDEN",false,false,function(){this.jumpFromLastSkill=null}.bind(this),a.midDelay)}.bind(this):this.doStateTransition("HIDDEN",false,false,function(){this.jumpFromLastSkill=null}.bind(this),a.hideDelay)}});sc.CircuitDetailButtonGroup=ig.ButtonGroup.extend({sounds:{focus:new ig.Sound("media/sound/menu/menu-hover.ogg",
0.9)},isNonMouseMenuInput:function(){return sc.control.elementModeSwitch()||sc.control.menuCircleRight()||sc.control.menuCircleLeft()},doButtonTraversal:function(){if(ig.input.currentDevice==ig.INPUT_DEVICES.GAMEPAD&&sc.control.menuConfirm()&&sc.menu.currentSkillFocus)sc.menu.currentSkillFocus.onButtonPress();var a=-1;sc.control.menuCircleRight()&&(a=1);sc.control.menuCircleLeft()&&(a=0);if(a>=0){a=this.cycleElements(a);a!=sc.menu.currentSkillTree&&sc.menu.selectSkillTree(a)}a=sc.control.elementModeSwitch();
a!==false&&(!a||a==sc.menu.currentSkillTree?sc.menu.selectSkillTree(sc.ELEMENT.NEUTRAL):sc.model.player.hasElement(a)&&sc.menu.selectSkillTree(a))},cycleElements:function(a){var b=sc.menu.currentSkillTree;do if(a>0)b=(b+1)%5;else{b--;b<0&&(b=4)}while(!sc.model.player.hasElement(b));return b}})});ig.baked=!0;
ig.module("game.feature.menu.gui.circuit.circuit-overview").requires("impact.feature.gui.gui","impact.feature.gui.base.basic-gui","game.feature.menu.gui.circuit.circuit-misc","game.feature.combat.model.combat-params").defines(function(){var b=Vec2.createC(0,0),a=Vec2.createC(0,0),d=Vec2.createC(0,0),c=Vec2.createC(0,0),e=Math.PI/2,f=Math.PI/4,g=e+f;sc.CIRCUIT_VAR_KEY="menu.circuit.start.";var h={element:sc.ELEMENT.NEUTRAL,startDir:{x:0,y:-1},node:{x:44,y:44},base:{x:0,y:0},rotation:0,panels:[{x:24,
y:1},{x:1,y:24},{x:47,y:24},{x:24,y:47}]},i={element:sc.ELEMENT.HEAT,rotation:e,base:{x:0,y:-149},startDir:{x:1,y:0},node:{x:72,y:21},panels:[{x:29,y:1},{x:75,y:1},{x:6,y:24},{x:52,y:24},{x:98,y:24},{x:29,y:47},{x:75,y:47},{x:52,y:70}]},j={element:sc.ELEMENT.COLD,rotation:-e,base:{x:-127,y:0},startDir:{x:-1,y:0},node:{x:72,y:101},panels:[{x:52,y:12},{x:29,y:35},{x:75,y:35},{x:6,y:58},{x:52,y:58},{x:98,y:58},{x:29,y:81},{x:75,y:81}]},k={rotation:0,element:sc.ELEMENT.SHOCK,base:{x:0,y:0},startDir:{x:0,
y:-1},node:{x:21,y:72},panels:[{x:1,y:29},{x:1,y:75},{x:24,y:6},{x:24,y:52},{x:24,y:98},{x:47,y:29},{x:47,y:75},{x:70,y:52}]},l={element:sc.ELEMENT.WAVE,rotation:Math.PI,base:{x:-127,y:-149},startDir:{x:0,y:1},node:{x:101,y:72},panels:[{x:12,y:52},{x:35,y:29},{x:35,y:75},{x:58,y:6},{x:58,y:52},{x:58,y:98},{x:81,y:29},{x:81,y:75}]};sc.CircuitMenuButtonGroup=ig.ButtonGroup.extend({sounds:{focus:new ig.Sound("media/sound/menu/menu-hover.ogg",0.9)},repeater:null,init:function(){this.parent();this.repeater=
new ig.PressRepeater},setButtons:function(a,b,c,d,e){this.addFocusGui(a,1,1);this.addFocusGui(b,1,2);this.addFocusGui(c,1,0);this.addFocusGui(d,2,1);this.addFocusGui(e,0,1);this.setCurrentFocus(1,1);a.focusable&&(ig.input.mouseGuiActive?this.setCurrentFocus(1,1):this.focusCurrentButton(1,1,true,true,false,true))},isNonMouseMenuInput:function(){return sc.control.menuConfirm()||sc.control.rightDown()||sc.control.leftDown()||sc.control.downDown()||sc.control.upDown()},doButtonTraversal:function(a){sc.control.menuBack()&&
this.invokeBackButton();var b=this.getRepeaterValue();if(!a){sc.control.menuConfirm()&&this.invokeCurrentButton();var c=a=0,d=false;if(b=="left"){a=Math.max(0,this.current.x-1);c=this.current.y;if(a==this.current.x)return;if(c==0||c==2)c=1;d=true}else if(b=="right"){a=Math.min(2,this.current.x+1);c=this.current.y;if(a==this.current.x)return;if(c==0||c==2)c=1;d=true}if(b=="up"){a=this.current.x;c=Math.max(0,this.current.y-1);if(c==this.current.y)return;if(a==0||a==2)a=1;d=true}else if(b=="down"){a=
this.current.x;c=Math.min(2,this.current.y+1);if(c==this.current.y)return;if(a==0||a==2)a=1;d=true}d&&this.elements[a][c].focusable&&this.focusCurrentButton(a,c)}},getRepeaterValue:function(){sc.control.rightDown()?this.repeater.setDown("right"):sc.control.leftDown()?this.repeater.setDown("left"):sc.control.downDown()?this.repeater.setDown("down"):sc.control.upDown()&&this.repeater.setDown("up");return this.repeater.getPressed()},activate:function(){this.parent();this.getRepeaterValue()}});sc.CircuitOverviewMenu=
ig.GuiElementBase.extend({gfx:new ig.Image("media/gui/circuit.png"),transitions:{DEFAULT:{state:{},time:0.2,timeFunction:KEY_SPLINES.LINEAR},HIDDEN:{state:{alpha:0},time:0.2,timeFunction:KEY_SPLINES.LINEAR},SCALE:{state:{alpha:0,scaleX:1.5,scaleY:1.5},time:0.2,timeFunction:KEY_SPLINES.LINEAR}},buffers:[],elements:[],buttons:[],buttonGroup:null,init:function(){this.parent();this.hook.size.x=ig.system.width;this.hook.size.y=ig.system.height;this.hook.pivot.x=Math.floor(ig.system.width/2);this.hook.pivot.y=
Math.floor(ig.system.height/2);this.buttonGroup=new sc.CircuitMenuButtonGroup;this.buttonGroup.addSelectionCallback(function(a){sc.menu.setInfoText(a.data)});this.buttonGroup.setMouseFocusLostCallback(function(){sc.menu.setInfoText("",true)});this.doStateTransition("DEFAULT",true)},onAttach:function(){this._createTrees();for(var a=this.buttons.length;a--;)if(ig.vars.get(sc.CIRCUIT_VAR_KEY+""+a))this.buttons[a].focusable=true;this.buttonGroup.setButtons(this.buttons[0],this.buttons[1],this.buttons[2],
this.buttons[3],this.buttons[4])},onFirstTimeAnimationDone:function(a){this.buttons[a].focusable=true;a==0&&(ig.input.mouseGuiActive||this.buttonGroup.sounds.focus.play())},onDetach:function(){this.buffers[h.element].release();this.buffers[i.element].release();this.buffers[j.element].release();this.buffers[k.element].release();this.buffers[l.element].release()},modelChanged:function(a,b){if(a==sc.model.player&&(b==sc.PLAYER_MSG.SKILL_CHANGED||b==sc.PLAYER_MSG.SKILL_BRANCH_SWAP))if(sc.menu.currentSkillTree==
-1)for(var c=this.elements.length;c--;)this.updateBuffer(c);else this.elements[sc.menu.currentSkillTree].needsUpdate=true},addObservers:function(){sc.Model.addObserver(sc.model.player,this)},removeObservers:function(){sc.Model.removeObserver(sc.model.player,this)},showMenu:function(){for(var a=this.elements.length;a--;){this.elements[a].show();this.buttons[a].doStateTransition("DEFAULT",false,false,null,0.1)}ig.interact.setBlockDelay(0.2);sc.menu.buttonInteract.pushButtonGroup(this.buttonGroup)},
exitMenu:function(a){sc.menu.buttonInteract.removeButtonGroup(this.buttonGroup);for(var b=this.elements.length;b--;){this.elements[b].doStateTransition("HIDDEN",a);this.buttons[b].doStateTransition("HIDDEN",a)}},enterDetailView:function(){this.doStateTransition("SCALE")},leaveDetailView:function(){for(var a=this.elements.length;a--;)if(this.elements[a].needsUpdate){this.updateBuffer(a);this.elements[a].needsUpdate=false}this.doStateTransition("DEFAULT");ig.input.currentDevice==ig.INPUT_DEVICES.GAMEPAD&&
this.buttonGroup.regainFocusOnKeyboard();ig.interact.setBlockDelay(0.2)},updateAllBuffers:function(){for(var a=this.elements.length;a--;)this.updateBuffer(a)},updateBuffer:function(a){this.elements[a].buffer=null;this.buffers[a].release();switch(a){case sc.ELEMENT.NEUTRAL:this.buffers[a]=ig.imageAtlas.getFragment(93,93,function(){this._preDrawTree(h)}.bind(this));break;case sc.ELEMENT.HEAT:this.buffers[a]=ig.imageAtlas.getFragment(149,127,function(){this._preDrawTree(i)}.bind(this));break;case sc.ELEMENT.COLD:this.buffers[a]=
ig.imageAtlas.getFragment(149,127,function(){this._preDrawTree(j)}.bind(this));break;case sc.ELEMENT.SHOCK:this.buffers[a]=ig.imageAtlas.getFragment(127,149,function(){this._preDrawTree(k)}.bind(this));break;case sc.ELEMENT.WAVE:this.buffers[a]=ig.imageAtlas.getFragment(127,149,function(){this._preDrawTree(l)}.bind(this))}this.elements[a].buffer=this.buffers[a]},_createTrees:function(){var a=h.element,b=i.element,c=j.element,d=k.element,e=l.element;this.buffers[a]=ig.imageAtlas.getFragment(93,93,
function(){this._preDrawTree(h)}.bind(this));this.buffers[b]=ig.imageAtlas.getFragment(149,127,function(){this._preDrawTree(i)}.bind(this));this.buffers[c]=ig.imageAtlas.getFragment(149,127,function(){this._preDrawTree(j)}.bind(this));this.buffers[d]=ig.imageAtlas.getFragment(127,149,function(){this._preDrawTree(k)}.bind(this));this.buffers[e]=ig.imageAtlas.getFragment(127,149,function(){this._preDrawTree(l)}.bind(this));var f=this._updateBufferFromFirstTime.bind(this),g=this.onFirstTimeAnimationDone.bind(this);
this.elements[a]=new sc.CircuitOverviewMenu.Tree(0,0,this.buffers[a],a,f,g);this.elements[b]=new sc.CircuitOverviewMenu.Tree(0,86,this.buffers[b],b,f,g);this.elements[c]=new sc.CircuitOverviewMenu.Tree(0,-86,this.buffers[c],c,f,g);this.elements[d]=new sc.CircuitOverviewMenu.Tree(86,0,this.buffers[d],d,f,g);this.elements[e]=new sc.CircuitOverviewMenu.Tree(-86,0,this.buffers[e],e,f,g);this.addChildGui(this.elements[a]);this.addChildGui(this.elements[b]);this.addChildGui(this.elements[c]);this.addChildGui(this.elements[d]);
this.addChildGui(this.elements[e]);this.buttons[a]=new sc.CircuitOverviewMenu.FocusOverlay(0,0,this.buffers[a],a);this.buttons[b]=new sc.CircuitOverviewMenu.FocusOverlay(0,86,this.buffers[b],b);this.buttons[c]=new sc.CircuitOverviewMenu.FocusOverlay(0,-86,this.buffers[c],c);this.buttons[d]=new sc.CircuitOverviewMenu.FocusOverlay(86,0,this.buffers[d],d);this.buttons[e]=new sc.CircuitOverviewMenu.FocusOverlay(-86,0,this.buffers[e],e);this.addChildGui(this.buttons[a]);this.addChildGui(this.buttons[b]);
this.addChildGui(this.buttons[c]);this.addChildGui(this.buttons[d]);this.addChildGui(this.buttons[e])},_updateBufferFromFirstTime:function(a){this.updateBuffer(a)},_preDrawTree:function(a){var b=a.panels.length,c=80+48*a.element;if(a.rotation!=void 0)if(a.rotation!=0){ig.system.context.save();ig.system.context.rotate(a.rotation);this.gfx.draw(a.base.x,a.base.y,65,160,127,149);ig.system.context.restore()}else a.element==0?this.gfx.draw(a.base.x,a.base.y,392,368,93,93):this.gfx.draw(a.base.x,a.base.y,
65,160,127,149);if(sc.model.player.getCore(a.element+8)&&ig.vars.get(sc.CIRCUIT_VAR_KEY+a.element)&&sc.model.player.hasElement(a.element)){for(;b--;){this.gfx.draw(a.panels[b].x,a.panels[b].y,c,112,46,46);sc.menu.skillState==sc.MENU_SKILL_STATE.SWAP_BRANCHES&&this.gfx.draw(a.panels[b].x,a.panels[b].y,224+a.element*48,320,45,45)}this.gfx.draw(a.node.x,a.node.y,a.element*8,304,5,5);this._preDrawTreeNodes(a.element,a.node.x+2,a.node.y+2,a.startDir.x,a.startDir.y)}},_preDrawTreeNodes:function(a,c,e,f,
g){var h=sc.skilltree.getTree(a);d.x=c;d.y=e;b.x=f;b.y=g;for(var i=null,j=0;j<h.length;j++){i=h[j];if(!this.isEmpty(i)){this._drawLine(d.x,d.y,f,g,i,a);this._preDrawTreeRecursive(a,i,c,e,b.x,b.y)}this._rotate("CW_90",f,g);f=b.x;g=b.y}},_preDrawTreeRecursive:function(d,e,f,g,h,i){var j=false;if(e.orBranch){var k=e.orBranch;this._rotate(e.direction,h,i);j=Math.abs(b.x)==1&&Math.abs(b.y)==1;f=f+((j?4:5)+e.distance)*b.x;g=g+((j?2:5)+e.distance)*b.y;a.x=b.x;a.y=b.y;this._rotate(k.direction,b.x,b.y);if(j)if(a.x<
0&&b.x==0){f=f+2;g=g+(b.y>0?2:-2)}else if(a.x>0&&b.x==0){f=f-2;g=g+(b.y>0?2:-2)}(j=Math.abs(b.x)==1&&Math.abs(b.y)==1)&&ig.error("orBranch can't be rendered with a slope direction.");this._drawOrBranchConnection(f,g,b,d,false,k);f=f+(j?3:4)*b.x;g=g+(j?3:4)*b.y;for(h=0;h<3;h++){c.x=0+d*8;c.y=256+(sc.model.player.hasSkill(k.left[h].uid)?8:0);b.x!=0?this.gfx.draw(f-2,g-2+(b.x>0?-3:3),c.x,c.y,5,5):this.gfx.draw(f-2+(b.y<0?-3:3),g-2,c.x,c.y,5,5);c.y=256+(sc.model.player.hasSkill(k.right[h].uid)?8:0);b.x!=
0?this.gfx.draw(f-2,g-2+(b.x>0?3:-3),c.x,c.y,5,5):this.gfx.draw(f-2+(b.y<0?3:-3),g-2,c.x,c.y,5,5);f=f+(j?3:5)*b.x;g=g+(j?3:5)*b.y}this._drawOrBranchConnection(f,g,b,d,true,k,e);f=f-b.x;g=g-b.y}else{this._rotate(e.direction,h,i);j=Math.abs(b.x)==1&&Math.abs(b.y)==1;f=f+((j?3:5)+e.distance)*b.x;g=g+((j?3:5)+e.distance)*b.y;c.x=0+d*8;c.y=256+(sc.model.player.hasSkill(e.uid)?8:0);this.gfx.draw(f-Math.floor(2.5),g-Math.floor(2.5),c.x,c.y,5,5)}e=e.children;if(e.length!=0){j=null;h=b.x;i=b.y;for(k=0;k<e.length;k++){j=
e[k];if(!this.isEmpty(j)){this._drawLine(f,g,h,i,j,d);this._preDrawTreeRecursive(d,j,f,g,h,i)}}}},_drawLine:function(a,d,f,g,h,i){if(!(h.distance<=0)){var j=false,j=h.orBranch?sc.model.player.hasSkill(h.orBranch.left[0].uid)||sc.model.player.hasSkill(h.orBranch.right[0].uid)?true:false:sc.model.player.hasSkill(h.uid)?true:false;this._rotate(h.direction,f,g);f=this._getDrawingDirection(b);g=ig.system.context;h=h.distance;if(f==sc.LINE_DRAW_TYPE.HORZ){c.x=i*8;c.y=j?276:272;this._drawLineStraightLine(b.x>
0?a+3:a-2-(8-(8-h)),d,h)}else{if(f==sc.LINE_DRAW_TYPE.VERT){c.x=i*8;c.y=j?276:272;g.save();g.translate((a+(b.y>0?1:0))*ig.system.scale,(d+(b.y>0?3:-2))*ig.system.scale);g.rotate(b.y>0?e:-e);this._drawLineStraightLine(0,0,h)}else{c.x=i*8;c.y=j?288:280;g.save();g.translate(a*ig.system.scale,d*ig.system.scale);g.scale(b.x<0?-1:1,b.y<0?-1:1);this.gfx.draw(b.x<0?1:2,b.y<0?1:2,c.x,c.y,h,h)}g.restore()}}},_drawLineStraightLine:function(a,b,d){if(d<=8)this.gfx.draw(a,b,c.x,c.y,d,1);else for(var e=Math.ceil(d/
8),f=8;e--;){d<8&&(f=d);this.gfx.draw(a,b,c.x,c.y,f,1);a=a+8;d=Math.max(0,d-8)}},_drawOrBranchConnection:function(a,b,c,d,e,f,g){var h=sc.model.player,i=h.hasSkill(f.left[0].uid),j=h.hasSkill(f.right[0].uid),k=i||j;if(c.x<0||c.y<0)if(j){i=true;j=false}else if(i){j=true;i=false}var m=false;j&&!i&&(m=true);var l=e;if(c.x<0||c.y<0)l=!l;if(e){h.hasSkill(f.left[2].uid);h.hasSkill(f.right[2].uid);if(g.children[0].orBranch){i=h.hasSkill(g.children[0].orBranch.left[0].uid);j=h.hasSkill(g.children[0].orBranch.right[0].uid);
k=i||j}else k=h.hasSkill(g.children[0].uid)}c.x!=0?this.gfx.draw(a-(c.x<0?1:2),b-3,d*8+(k?4:0),296,4,7,l,m):c.y!=0&&this.gfx.draw(a-3,b-(c.y<0?1:2),48,256+(d*8+(k?4:0)),7,4,m,l)},_rotate:function(a,c,d){b.x=c;b.y=d;switch(sc.SKILLS_DIRECTION[a]){case sc.SKILLS_DIRECTION.CW_45:Vec2.rotate(b,-f);b.x=Math.round(b.x);b.y=Math.round(b.y);break;case sc.SKILLS_DIRECTION.CCW_45:Vec2.rotate(b,f);b.x=Math.round(b.x);b.y=Math.round(b.y);break;case sc.SKILLS_DIRECTION.CW_90:Vec2.rotate90CCW(b);break;case sc.SKILLS_DIRECTION.CCW_90:Vec2.rotate90CW(b);
break;case sc.SKILLS_DIRECTION.CW_135:Vec2.rotate(b,-g);b.x=Math.round(b.x);b.y=Math.round(b.y);break;case sc.SKILLS_DIRECTION.CCW_135:Vec2.rotate(b,g);b.x=Math.round(b.x);b.y=Math.round(b.y)}return b},_getDrawingDirection:function(a){if(a.x==0&&a.y==0){ig.error("Can't get cardinal direction when x and y are zero! Direction: [x: %i, y: %i]",a.x,a.y);return-1}if(a.x>=0){if(a.y<0&&a.x==0||a.y>0&&a.x==0)return sc.LINE_DRAW_TYPE.VERT;if(a.y==0&&a.x>0)return sc.LINE_DRAW_TYPE.HORZ;if(a.y<0&&a.x>0||a.y>
0&&a.x>0)return sc.LINE_DRAW_TYPE.SLOPE}else{if(a.y==0&&a.x<0)return sc.LINE_DRAW_TYPE.HORZ;if(a.y<0&&a.x<0||a.y>0&&a.x<0)return sc.LINE_DRAW_TYPE.SLOPE}return"If this return, you broke something horribly Bro."},isEmpty:function(a){for(var b in a)return false;return true}});var o={"0":{sx:176,sy:368,w:92,h:92,x:1,y:1},1:{sx:272,sy:368,w:120,h:149,x:11,y:-11,rot:Math.PI/2},2:{sx:272,sy:368,w:120,h:149,x:11,y:-11,rot:-(Math.PI/2)},3:{sx:272,sy:368,w:120,h:149,x:0,y:0},4:{sx:272,sy:368,w:120,h:149,x:0,
y:0,rot:Math.PI}};sc.CircuitOverviewMenu.Tree=ig.GuiElementBase.extend({gfx:new ig.Image("media/gui/circuit.png"),buffer:null,element:0,needsUpdate:false,overlay:null,updater:null,done:null,_timer:0,_alpha:0,_firstTime:false,init:function(a,b,c,d,e,f){this.parent();this.setSize(c.width,c.height);this.setPivot(c.width/2,c.height/2);this.setAlign(ig.GUI_ALIGN.X_CENTER,ig.GUI_ALIGN.Y_CENTER);this.buffer=c;this.element=d||0;this.updater=e||null;this.done=f||null;this.hook.transitions={DEFAULT:{state:{offsetX:a,
offsetY:b},time:0.2,timeFunction:KEY_SPLINES.EASE_OUT},HIDDEN:{state:{alpha:0,offsetX:a+(a?a>0?15:-15:0),offsetY:b+(b?b>0?15:-15:0)},time:0.2,timeFunction:KEY_SPLINES.LINEAR}};this.doStateTransition("HIDDEN",true)},updateDrawables:function(a){this.buffer&&a.addGfx(this.buffer,0,0,0,0);if(this._timer>0){this._timer=this._timer-ig.system.tick;if(this._timer<=0){this._timer=0;this.done&&this.done(this.element)}else if(this._timer<=1&&!ig.vars.get(sc.CIRCUIT_VAR_KEY+this.element)&&!this._firstTime){ig.vars.set("menu.circuit.start."+
this.element,true);this.updater(this.element);this._firstTime=true}var b=(this._timer/2).limit(0,1);this._alpha=this._timer>1?2-KEY_SPLINES.LINEAR.get(b*2):KEY_SPLINES.LINEAR.get(b*2);b=o[this.element];b.rot&&a.addTransform().setPivot(this.buffer.width/2,this.buffer.height/2).setRotate(b.rot);a.addGfx(this.gfx,b.x,b.y,b.sx,b.sy,b.w,b.h).setAlpha(this._alpha);b.rot&&a.undoTransform()}},show:function(){this.doStateTransition("DEFAULT",false,false,function(){if(sc.model.player.getCore(this.element+8)&&
!ig.vars.get(sc.CIRCUIT_VAR_KEY+this.element)){ig.interact.setBlockDelay(2);this._timer=2}}.bind(this),0.1)}});var m=[{x:47,y:47}],n=[{x:52,y:47},{x:75,y:70},{x:98,y:47}],p=[{x:52,y:81},{x:75,y:58},{x:98,y:81}],r=[{x:47,y:52},{x:70,y:75},{x:47,y:98}],t=[{x:81,y:52},{x:58,y:75},{x:81,y:98}];sc.CircuitOverviewMenu.FocusOverlay=ig.FocusGui.extend({gfx:new ig.Image("media/gui/circuit.png"),rotation:0,neutral:false,piv:Vec2.createC(0,0),points:[],element:0,submitSound:null,focusable:false,init:function(a,
b,c,d){this.parent();this.setSize(c.width,c.height);this.setAlign(ig.GUI_ALIGN.X_CENTER,ig.GUI_ALIGN.Y_CENTER);this.element=d;this.submitSound=sc.BUTTON_SOUND.submit;this.hook.transitions={DEFAULT:{state:{offsetX:a,offsetY:b},time:0.2,timeFunction:KEY_SPLINES.EASE_OUT},HIDDEN:{state:{alpha:0,offsetX:a+(a?a>0?15:-15:0),offsetY:b+(b?b>0?15:-15:0)},time:0.2,timeFunction:KEY_SPLINES.LINEAR}};switch(this.element){case sc.ELEMENT.NEUTRAL:this.points=m;break;case sc.ELEMENT.HEAT:this.points=n;this.rotation=
e;this.piv.y=-c.width||0;break;case sc.ELEMENT.COLD:this.points=p;this.rotation=-e;this.piv.x=-c.height||0;break;case sc.ELEMENT.SHOCK:this.points=r;break;case sc.ELEMENT.WAVE:this.points=t;this.rotation=-Math.PI;this.piv.y=-c.height||0;this.piv.x=-c.width||0}this.doStateTransition("HIDDEN",true)},onButtonPress:function(){if(this.focusable){this.submitSound&&this.submitSound.play();sc.menu.selectSkillTree(this.element)}},updateDrawables:function(a){if(sc.menu.skillState!=sc.MENU_SKILL_STATE.SWAP_BRANCHES&&
(!ig.interact.isBlocked()&&this.focusable)&&this.focus)if(this.element!=sc.ELEMENT.NEUTRAL){a.addTransform().setRotate(this.rotation);a.addGfx(this.gfx,-3+this.piv.x,2+this.piv.y,192,160,122,145);a.undoTransform()}else a.addGfx(this.gfx,-3,-3,320,168,99,99)},canPlayFocusSounds:function(){return!ig.interact.isBlocked()||this.focusable},isMouseOver:function(){if(!this.focusable||ig.input.currentDevice==ig.INPUT_DEVICES.GAMEPAD)return false;for(var a=Math.floor(this.hook.screenCoords.x),b=Math.floor(this.hook.screenCoords.y),
c=Math.floor(sc.control.getMouseX()),d=Math.floor(sc.control.getMouseY()),e=this.points.length;e--;)if(Math.abs(c-(this.points[e].x+a))+Math.abs(d-(this.points[e].y+b))<=45)return true;return false}})});ig.baked=!0;
ig.module("game.feature.menu.gui.circuit.circuit-effect-display").requires("impact.feature.gui.gui").defines(function(){sc.CircuitEffectDisplay=ig.GuiElementBase.extend({gfx:new ig.Image("media/gui/circuit.png"),transitions:{DEFAULT:{state:{},time:0.2,timeFunction:KEY_SPLINES.LINEAR},DEFAULT_LARGE:{state:{scaleX:1.5,scaleY:1.5},time:0.2,timeFunction:KEY_SPLINES.LINEAR},HIDDEN:{state:{alpha:0},time:0.2,timeFunction:KEY_SPLINES.LINEAR},HIDDEN_LARGE:{state:{scaleX:1.5,scaleY:1.5,alpha:0},time:0.2,timeFunction:KEY_SPLINES.LINEAR}},
skillGui:null,skill:null,timer:0,display:null,container:null,effectDone:false,delay:0,large:false,iconSize:25,init:function(b){this.parent();this.setSize(128,128);this.setPivot(64,64);this.hook.invisibleUpdate=true;if(this.large=b)this.iconSize=48;this.container=new ig.GuiElementBase;this.container.hook.invisibleUpdate=true;this.container.hook.clip=true;this.container.setSize(128,128);this.container.setPos(0,0);this.addChildGui(this.container)},show:function(b,a,d){this.skillGui=b;this.skill=b.skill;
this.delay=d||0;b=b.hook;a=this.hook;this.setPos(~~(b.pos.x+b.size.x/2-a.size.x/2)+1,~~(b.pos.y+b.size.y/2-a.size.y/2)+1);this.timer=0.5+this.delay;this.display=new sc.NPCDisplayGui("misc.menu-effect-large",true,null,this.onLoaded.bind(this),true);this.container.addChildGui(this.display)},hide:function(){this.display.remove(true);this.doStateTransition("HIDDEN",true,true)},update:function(){if(this.timer>0){this.timer=this.timer-ig.system.actualTick;if(this.timer<=0)this.timer=0}if(this.timer<=0&&
this.effectDone){this.display.remove(true);this.doStateTransition("HIDDEN",true,true)}},updateDrawables:function(b){var a=this.hook;b.addGfx(this.gfx,~~(a.size.x/2-this.iconSize/2),~~(a.size.y/2-this.iconSize/2),this.large?512:487,(this.large?280:352)+this.iconSize*this.skillGui.element,this.iconSize,this.iconSize).setAlpha(this.timer>0.5?0:this.timer/0.5).setCompositionMode("lighter")},onLoaded:function(b){if(b.npc){b.setPos(this.container.hook.size.x/2-b.hook.size.x/2-1,this.container.hook.size.y/
2-b.hook.size.y/2);this.delay?b.playEffect("combat","chargeLevel1Loop",{callback:this,offset:{x:0,y:-16},duration:this.delay}):b.playEffect("combat","chargeLevel1",{callback:this,offset:{x:0,y:-16}})}},onEffectEvent:function(b){if(b.state==ig.EFFECT_STATE.ENDED)this.effectDone=true}})});ig.baked=!0;
ig.module("game.feature.menu.gui.circuit.circuit-detail").requires("impact.feature.gui.gui","impact.feature.gui.base.basic-gui","game.feature.menu.gui.menu-misc","game.feature.menu.gui.circuit.circuit-misc","game.feature.menu.gui.circuit.circuit-detail-elements","game.feature.menu.gui.circuit.circuit-overview","game.feature.menu.gui.circuit.circuit-effect-display").defines(function(){function b(a,b,c){if(b<=1)return false;if(sc.newgame.get("remove-skill-blocks"))return 0;for(var c=m[c].shadeBlock,
d=c.ids,e=d.length;e--;)if(a==d[e]&&!sc.model.player.hasItem(c.levels[b-2]))return c.levels[b-2];return 0}function a(a,b,f,g,h,i,j,k,m,l,o,r){var u=f&&sc.model.player.hasSkill(f.uid),y=null,L=false;if(!l){q.x=32;q.y=0;s.x=h;s.y=i;v.x=8;v.y=8;t.x=0;t.y=0;n.x=-j;n.y=-k;c(n,l,u,true,m);q.x=o>=0?q.x+Math.max(0,r[o]-1)*8:q.x+Math.max(0,f.level-1)*8;a.addGfx(b,s.x,s.y,q.x,q.y,v.x,v.y)}if(g&&g.length!=0){n.x=j;n.y=k;for(f=0;f<g.length;f++){y=g[f];L=y.orBranch?sc.model.player.hasSkill(y.orBranch.left[0].uid)||
sc.model.player.hasSkill(y.orBranch.right[0].uid)?true:false:sc.model.player.hasSkill(y.uid)?true:false;q.x=32;q.y=0;s.x=h;s.y=i;v.x=8;v.y=8;t.x=0;t.y=0;if(!l){n.x=j;n.y=k;e(y.direction,n.x,n.y)}c(n,l,u,L,m);q.x=o>=0?o+1>=3?y.orBranch?q.x+Math.max(0,y.orBranch.levels[0]-1)*8:q.x+Math.max(0,y.level-1)*8:q.x+Math.max(0,r[o+1]-1)*8:y.orBranch?q.x+Math.max(0,y.orBranch.levels[0]-1)*8:q.x+Math.max(0,y.level-1)*8;a.addGfx(b,s.x,s.y,q.x,q.y,v.x,v.y);if(l){Vec2.assign(p,n);d(a,b,y,m,s.x+t.x,s.y+t.y,n.x,n.y,
1,true);Vec2.assign(n,p);e("CW_90",n.x,n.y)}}}}function d(a,b,c,d,f,h,i,j,k,m,l){var o=0,o=l?k:(k!=void 0?k:c.distance)*8;if(!(o<=0)){n.x=i;n.y=j;var p=c.orBranch?true:false,l=false,l=p?sc.model.player.hasSkill(c.orBranch.left[0].uid)||sc.model.player.hasSkill(c.orBranch.right[0].uid)?true:false:sc.model.player.hasSkill(c.uid)?true:false,k=0,k=p?c.orBranch.levels[0]:c.level||0,k=Math.max(0,k-1)*16;m&&e(c.direction,i,j);switch(g(n)){case sc.LINE_DRAW_TYPE.HORZ:if(o<=16)a.addGfx(b,f,h,(l?80+d*48:32)+
k,80,o,8);else{c=Math.ceil(o/16);for(i=16;c--;){o<16&&(i=o);a.addGfx(b,f,h,(l?80+d*48:32)+k,80,i,8);f=f+16;o=Math.max(0,o-16)}}break;case sc.LINE_DRAW_TYPE.VERT:if(o<=16)a.addGfx(b,f,h,l?177+d*8:169,312+k,8,o);else{c=Math.ceil(o/16);for(i=16;c--;){o<16&&(i=o);a.addGfx(b,f,h,l?177+d*8:169,312+k,8,i);h=h+16;o=Math.max(0,o-16)}}break;case sc.LINE_DRAW_TYPE.SLOPE:c=l;i=n.x;j=n.y;m=false;if(i>0&&j<0||i<0&&j>0){m=true;h=h+(o-16+1)}else h=h+1;n.x=i;n.y=j;i=Math.ceil(o/16);for(j=16;i--;){o<16&&(j=o);a.addGfx(b,
f,h-3,(c?80+d*48:32)+k,88,j,24,m);f=f+16;o=Math.max(0,o-16);h=h+(m?-(o<16?o:16):16)}}}}function c(a,b,c,d,e){if(b||c){q.x=d?80:104;q.x=q.x+e*48}else q.x=32;switch(f(a)){case sc.TREE_CARDINAL_DIR.NORTH:q.y=0;v.y=8;s.x=s.x-3;s.y=s.y-(b?11:19);t.y=-8;break;case sc.TREE_CARDINAL_DIR.EAST:q.y=8;v.y=8;s.x=s.x+(b?5:13);s.y=s.y-3;t.x=8;break;case sc.TREE_CARDINAL_DIR.SOUTH:q.y=16;v.y=8;s.x=s.x-3;s.y=s.y+(b?5:13);t.y=t.y+8;break;case sc.TREE_CARDINAL_DIR.WEST:q.y=24;v.y=8;s.x=s.x-(b?11:19);s.y=s.y-3;t.x=-8;
break;case sc.TREE_CARDINAL_DIR.NORTH_EAST:q.y=32;v.y=12;s.x=25;s.y=4;break;case sc.TREE_CARDINAL_DIR.SOUTH_EAST:q.y=44;v.y=12;s.x=25;s.y=25;break;case sc.TREE_CARDINAL_DIR.SOUTH_WEST:q.y=56;v.y=12;s.x=9;s.y=25;break;case sc.TREE_CARDINAL_DIR.NORTH_WEST:q.y=68;v.y=12;s.x=9;s.y=5}}function e(a,b,c){n.x=b;n.y=c;switch(sc.SKILLS_DIRECTION[a]){case sc.SKILLS_DIRECTION.CW_45:Vec2.rotate(n,-j);n.x=Math.round(n.x);n.y=Math.round(n.y);break;case sc.SKILLS_DIRECTION.CCW_45:Vec2.rotate(n,j);n.x=Math.round(n.x);
n.y=Math.round(n.y);break;case sc.SKILLS_DIRECTION.CW_90:Vec2.rotate90CCW(n);break;case sc.SKILLS_DIRECTION.CCW_90:Vec2.rotate90CW(n);break;case sc.SKILLS_DIRECTION.CW_135:Vec2.rotate(n,-k);n.x=Math.round(n.x);n.y=Math.round(n.y);break;case sc.SKILLS_DIRECTION.CCW_135:Vec2.rotate(n,k);n.x=Math.round(n.x);n.y=Math.round(n.y)}return n}function f(a){if(a.x>=0){if(a.y<0&&a.x==0)return sc.TREE_CARDINAL_DIR.NORTH;if(a.y>0&&a.x==0)return sc.TREE_CARDINAL_DIR.SOUTH;if(a.y==0&&a.x>0)return sc.TREE_CARDINAL_DIR.EAST;
if(a.y<0&&a.x>0)return sc.TREE_CARDINAL_DIR.NORTH_EAST;if(a.y>0&&a.x>0)return sc.TREE_CARDINAL_DIR.SOUTH_EAST}else{if(a.y==0&&a.x<0)return sc.TREE_CARDINAL_DIR.WEST;if(a.y<0&&a.x<0)return sc.TREE_CARDINAL_DIR.NORTH_WEST;if(a.y>0&&a.x<0)return sc.TREE_CARDINAL_DIR.SOUTH_WEST}return null}function g(a){if(a.x>=0){if(a.y<0&&a.x==0||a.y>0&&a.x==0)return sc.LINE_DRAW_TYPE.VERT;if(a.y==0&&a.x>0)return sc.LINE_DRAW_TYPE.HORZ;if(a.y<0&&a.x>0||a.y>0&&a.x>0)return sc.LINE_DRAW_TYPE.SLOPE}else{if(a.y==0&&a.x<
0)return sc.LINE_DRAW_TYPE.HORZ;if(a.y<0&&a.x<0||a.y>0&&a.x<0)return sc.LINE_DRAW_TYPE.SLOPE}return"If this return, you broke something horribly Bro."}function h(a){for(var b in a)return false;return true}var i=Math.PI/2,j=Math.PI/4,k=i+j,l=Math.floor(20),o=!window.IG_GAME_DEBUG||false,m=[{element:sc.ELEMENT.NEUTRAL,startDir:{x:0,y:-1},node:{x:375,y:375},offset:{x:1095,y:1095},size:{x:751,y:751},shadeBlock:{ids:[7,8,20,21,33,34,46,47],levels:[225,225]}},{element:sc.ELEMENT.HEAT,rotation:i,startDir:{x:1,
y:0},node:{x:519,y:199},offset:{x:951,y:1990},size:{x:1039,y:951},shadeBlock:{ids:[64,63,89,97,98,118,119,128,127,105,73,72],levels:[230,410]}},{element:sc.ELEMENT.COLD,rotation:-i,startDir:{x:-1,y:0},node:{x:519,y:751},offset:{x:951,y:0},size:{x:1039,y:951},shadeBlock:{ids:[176,205,206,214,215,151,150,160,159,184,185,192],levels:[230,410]}},{rotation:0,element:sc.ELEMENT.SHOCK,startDir:{x:0,y:-1},node:{x:199,y:519},offset:{x:1990,y:951},size:{x:951,y:1039},shadeBlock:{ids:[7,8,20,21,33,34,46,47,
246,247,279,301,302],levels:[230,410]}},{element:sc.ELEMENT.WAVE,rotation:Math.PI,startDir:{x:0,y:1},node:{x:751,y:519},offset:{x:0,y:951},size:{x:951,y:1039},shadeBlock:{ids:[7,8,20,21,33,34,46,47,333,334,366,388,389],levels:[230,410]}}],n=Vec2.createC(0,0),p=Vec2.createC(0,0),r=Vec2.createC(0,0),t=Vec2.createC(0,0),q=Vec2.createC(0,0),s=Vec2.createC(0,0),v=Vec2.createC(0,0),y={225:0,230:40,231:80,410:80},u=Vec2.createC(0,0);sc.CircuitTreeDetailContainer=ig.GuiElementBase.extend({gfx:new ig.Image("media/gui/circuit.png"),
transitions:{DEFAULT:{state:{},time:0.2,timeFunction:KEY_SPLINES.LINEAR},HIDDEN:{state:{alpha:0,scaleX:0.5,scaleY:0.5},time:0.2,timeFunction:KEY_SPLINES.LINEAR}},trees:[],cursor:null,_lastMousePos:Vec2.createC(0,0),_dragTimer:0,_cameraLastPositions:[],_lastDevice:0,_gamepadActive:false,_cursorPos:[],_delayedDrag:false,init:function(){this.parent();this.setSize(ig.system.width,ig.system.height);this.setPivot(ig.system.width/2,ig.system.height/2);if(!this.constructor.PATTERN)this.constructor.PATTERN=
this.gfx.createPattern(0,192,64,64,ig.ImagePattern.OPT.REPEAT_X_AND_Y);this.hook.setMouseRecord(true);this.cursor=new sc.CiruitCursor;this.addChildGui(this.cursor);this.doStateTransition("HIDDEN",true)},scrollToTree:function(a,b,c,d){var e=null;if(ig.input.currentDevice==ig.INPUT_DEVICES.GAMEPAD){e=this._cursorPos[a];this._initCursorPos(e,a);sc.menu.skillCursor.x=e.x;sc.menu.skillCursor.y=e.y;this.limitCursorPos(a);this.cursor.moveTo(sc.menu.skillCursor.x,sc.menu.skillCursor.y,b!=-1,c);sc.menu.skillCamera.x=
Math.floor(-e.x+ig.system.width/2);sc.menu.skillCamera.y=Math.floor(-e.y+ig.system.height/2)}else{e=this._cameraLastPositions[a];sc.menu.skillCamera.x=e.x;sc.menu.skillCamera.y=e.y}this.limitCameraPos(a);this.doScrollTransition(sc.menu.skillCamera.x,sc.menu.skillCamera.y,c,KEY_SPLINES.EASE,d)},limitCameraPos:function(a){var a=m[a],b=-sc.menu.skillCamera.x,c=Math.floor(162);sc.menu.skillCamera.x=-b.limit(a.offset.x-c,a.offset.x+(a.size.x-ig.system.width)+c);b=-sc.menu.skillCamera.y;c=Math.floor(42);
sc.menu.skillCamera.y=-b.limit(a.offset.y-c,a.offset.y+(a.size.y-ig.system.height)+c)},limitCursorPos:function(a){var a=m[a],b=sc.menu.skillCursor.x;sc.menu.skillCursor.x=b.limit(a.offset.x-32+16-120,a.offset.x+(a.size.x-16)+32+120);var b=sc.menu.skillCursor.y,c=sc.menu.skillCursor.x+sc.menu.skillCamera.x;sc.menu.skillCursor.y=b.limit(a.offset.y,a.offset.y+a.size.y-(c<181?Math.min(25,181-c):0))},switchElementTree:function(a,b){if(a>=0){this._addTreeLazy(a);if(b!=-1){var c=this._cameraLastPositions[b];
c.x=sc.menu.skillCamera.x;c.y=sc.menu.skillCamera.y;if(ig.input.currentDevice==ig.INPUT_DEVICES.GAMEPAD){c=this._cursorPos[b];c.x=sc.menu.skillCursor.x;c.y=sc.menu.skillCursor.y}this.trees[b].deactivate(true);this.trees[a].activate(false);this.scrollToTree(a,b,0.5,function(){this.trees[sc.menu.previousSkillTree].doStateTransition("HIDDEN",true)}.bind(this));ig.interact.setBlockDelay(0.5)}else{this.trees[a].activate(true);this.scrollToTree(a,b);this.doStateTransition("DEFAULT")}this._checkLastDevice()}else{if(b!=
-1){c=this._cameraLastPositions[b];c.x=sc.menu.skillCamera.x;c.y=sc.menu.skillCamera.y;if(ig.input.currentDevice==ig.INPUT_DEVICES.GAMEPAD){c=this._cursorPos[b];c.x=sc.menu.lastSkillCursor.x;c.y=sc.menu.lastSkillCursor.y}}this.doStateTransition("HIDDEN")}},exitMenu:function(){for(var a=this.trees.length;a--;)this.trees[a]&&this.trees[a].exit();this.doStateTransition("HIDDEN")},addObservers:function(){sc.Model.addObserver(sc.menu,this);this.cursor.addObservers();for(var a=this.trees.length;a--;)this.trees[a]&&
this.trees[a].addObservers()},removeObservers:function(){this.cursor.removeObservers();sc.Model.removeObserver(sc.menu,this);for(var a=this.trees.length;a--;)this.trees[a]&&this.trees[a].removeObservers()},update:function(){sc.menu.skillCursorMoved=false;if(!ig.interact.isBlocked()&&!(sc.menu.skillState==sc.MENU_SKILL_STATE.NODE_MENU||sc.menu.skillState==sc.MENU_SKILL_STATE.OVERVIEW||sc.menu.currentSkillTree>=0&&!this.trees[sc.menu.currentSkillTree].buttonGroup.isActive())){var a=sc.menu.currentSkillTree;
if(this._lastDevice!=ig.input.currentDevice){this._gamepadActive=ig.input.currentDevice==ig.INPUT_DEVICES.GAMEPAD;this._lastDevice=ig.input.currentDevice;var b=null;if(ig.input.currentDevice==ig.INPUT_DEVICES.GAMEPAD){b=this._cursorPos[a];this._initCursorPos(b,a);sc.menu.skillCursor.x=b.x;sc.menu.skillCursor.y=b.y;this.limitCursorPos(a);sc.menu.skillCamera.x=Math.floor(-b.x+ig.system.width/2);sc.menu.skillCamera.y=Math.floor(-b.y+ig.system.height/2);this.limitCameraPos(a);this.doScrollTransition(sc.menu.skillCamera.x,
sc.menu.skillCamera.y,0.3,KEY_SPLINES.EASE);this.cursor.moveTo(sc.menu.skillCursor.x,sc.menu.skillCursor.y)}else if(ig.input.currentDevice==ig.INPUT_DEVICES.KEYBOARD_AND_MOUSE){b=this._cursorPos[a];if(sc.menu.currentSkillFocus){b.x=sc.menu.skillRecoverPos.x;b.y=sc.menu.skillRecoverPos.y}else{b.x=sc.menu.skillCursor.x;b.y=sc.menu.skillCursor.y}sc.menu.unfocusCursor(sc.menu.currentSkillFocus)}sc.menu.toggledInputMode()}a=false;if(!this.hook.scrollTransition){if(sc.control.menuSkillLeft(0.5)){sc.menu.skillCamera.x=
Math.floor(sc.menu.skillCamera.x+250*ig.system.actualTick);this.limitCameraPos(sc.menu.currentSkillTree);this.hook.scroll.x=sc.menu.skillCamera.x;a=true}else if(sc.control.menuSkillRight(0.5)){sc.menu.skillCamera.x=Math.floor(sc.menu.skillCamera.x-250*ig.system.actualTick);this.limitCameraPos(sc.menu.currentSkillTree);this.hook.scroll.x=sc.menu.skillCamera.x;a=true}if(sc.control.menuSkillUp(0.5)){sc.menu.skillCamera.y=Math.floor(sc.menu.skillCamera.y+250*ig.system.actualTick);this.limitCameraPos(sc.menu.currentSkillTree);
this.hook.scroll.y=sc.menu.skillCamera.y;a=true}else if(sc.control.menuSkillDown(0.5)){sc.menu.skillCamera.y=Math.floor(sc.menu.skillCamera.y-250*ig.system.actualTick);this.limitCameraPos(sc.menu.currentSkillTree);this.hook.scroll.y=sc.menu.skillCamera.y;a=true}}if(!a&&ig.input.currentDevice==ig.INPUT_DEVICES.GAMEPAD){var c=b=0,d=0,a=false;if((d=sc.control.getAxesValue(ig.AXES.LEFT_STICK_X))<-0.5){b=(-150+d*100)*ig.system.actualTick;a=true}else if((d=sc.control.getAxesValue(ig.AXES.LEFT_STICK_X))>
0.5){b=(150+d*100)*ig.system.actualTick;a=true}if((d=sc.control.getAxesValue(ig.AXES.LEFT_STICK_Y))<-0.5){c=(-150+d*100)*ig.system.actualTick;a=true}else if((d=sc.control.getAxesValue(ig.AXES.LEFT_STICK_Y))>0.5){c=(150+d*100)*ig.system.actualTick;a=true}if(a){sc.menu.skillCursorMoved=true;sc.menu.skillCursor.x=b>=0?Math.floor(sc.menu.skillCursor.x+b):Math.ceil(sc.menu.skillCursor.x+b);sc.menu.skillCursor.y=c>=0?Math.floor(sc.menu.skillCursor.y+c):Math.ceil(sc.menu.skillCursor.y+c);this.limitCursorPos(sc.menu.currentSkillTree);
this.cursor.moveTo(sc.menu.skillCursor.x,sc.menu.skillCursor.y);u.x=sc.menu.skillCamera.x;u.y=sc.menu.skillCamera.y;sc.menu.skillCamera.x=Math.floor(-sc.menu.skillCursor.x+ig.system.width/2);sc.menu.skillCamera.y=Math.floor(-sc.menu.skillCursor.y+ig.system.height/2);this.limitCameraPos(sc.menu.currentSkillTree)}a=false;if(Math.abs(sc.menu.skillCamera.x-u.x)>=18||Math.abs(sc.menu.skillCamera.y-u.y)>=18)a=true;if(this.hook.scrollTransition){this.hook.scrollTransition.x=sc.menu.skillCamera.x;this.hook.scrollTransition.y=
sc.menu.skillCamera.y}else if(a)this.doScrollTransition(sc.menu.skillCamera.x,sc.menu.skillCamera.y,0.3,KEY_SPLINES.LINEAR);else{this.hook.scroll.x=sc.menu.skillCamera.x;this.hook.scroll.y=sc.menu.skillCamera.y}}}},updateDrawables:function(a){var b=this.hook;b.hasTransition()?a.addPattern(this.constructor.PATTERN,-256,-256,-b.scroll.x,-b.scroll.y,1216,704):a.addPattern(this.constructor.PATTERN,0,0,-b.scroll.x,-b.scroll.y,b.size.x,b.size.y)},onMouseInteract:function(a,b){if(!(ig.interact.isBlocked()||
this.trees[sc.menu.currentSkillFocus]&&!this.trees[sc.menu.currentSkillTree].buttonGroup.isActive()))if(sc.menu.currentSkillTree==-1||sc.menu.skillState==sc.MENU_SKILL_STATE.NODE_MENU)if(a&&sc.control.getGuiPressed()){sc.menu.exitNodeMenu();sc.menu.unfocusCursor(sc.menu.currentSkillFocus);this._delayedDrag=true}else sc.menu.skillDrag=false;else if(!b){var c=Math.floor(sc.control.getMouseX()),d=Math.floor(sc.control.getMouseY());if(sc.control.getGuiPressed()||this._delayedDrag){this._delayedDrag=false;
Vec2.assignC(this._lastMousePos,c,d);sc.menu.skillDrag=true;this._dragTimer=0}else if(sc.control.getGuiHold()){if(sc.menu.skillDrag){this._dragTimer=this._dragTimer+ig.system.actualTick;if(!sc.menu.skillWasDragged)sc.menu.skillWasDragged=(Math.abs(c-this._lastMousePos.x)>=1||Math.abs(d-this._lastMousePos.y)>=1)&&this._dragTimer>=0.1;sc.menu.skillCamera.x=sc.menu.skillCamera.x+(c-this._lastMousePos.x);sc.menu.skillCamera.y=sc.menu.skillCamera.y+(d-this._lastMousePos.y);this.limitCameraPos(sc.menu.currentSkillTree);
this.hook.scroll.x=sc.menu.skillCamera.x;this.hook.scroll.y=sc.menu.skillCamera.y;Vec2.assignC(this._lastMousePos,c,d)}}else sc.menu.skillDrag=false}},modelChanged:function(a,b,c){if(a==sc.menu)if(b==sc.MENU_EVENT.SKILL_NODE_SELECT){this.limitCameraPos(sc.menu.currentSkillTree);this.doScrollTransition(sc.menu.skillCamera.x,sc.menu.skillCamera.y,0.2)}else if(b==sc.MENU_EVENT.SKILL_CURSOR_FOCUS_NODE){if(ig.input.currentDevice==ig.INPUT_DEVICES.GAMEPAD){sc.menu.skillCamera.x=Math.floor(-sc.menu.skillCursor.x+
ig.system.width/2);sc.menu.skillCamera.y=Math.floor(-sc.menu.skillCursor.y+ig.system.height/2);this.limitCameraPos(sc.menu.currentSkillTree);this.doScrollTransition(sc.menu.skillCamera.x,sc.menu.skillCamera.y,0.2,KEY_SPLINES.LINEAR)}}else if(b==sc.MENU_EVENT.CIRCUIT_FOCUS_CAM){this.limitCameraPos(sc.menu.currentSkillTree);this.doScrollTransition(sc.menu.skillCamera.x,sc.menu.skillCamera.y,c?c.time||0.2:0.2,void 0,c&&c.callback)}},_initCursorPos:function(a,b){if(a.x<=-1E4||a.y<=-1E4){a.x=-this._cameraLastPositions[b].x+
ig.system.width/2;a.y=-this._cameraLastPositions[b].y+ig.system.height/2}},_checkLastDevice:function(){if(this._lastDevice!=ig.input.currentDevice){this._gamepadActive=ig.input.currentDevice==ig.INPUT_DEVICES.GAMEPAD;this._lastDevice=ig.input.currentDevice}},_addTreeLazy:function(a){if(!this.trees[a]){this.trees[a]=new sc.CircuitTreeDetail(a);this.trees[a].setPos(m[a].offset.x,m[a].offset.y);var b=Vec2.createC(0,0);b.x=ig.system.width/2-m[a].node.x-m[a].offset.x;b.y=ig.system.height/2-m[a].node.y-
m[a].offset.y;this._cameraLastPositions[a]=b;this._cursorPos[a]=Vec2.createC(-1E4,-1E4);this.insertChildGui(this.trees[a],0)}}});sc.CircuitTreeDetail=ig.GuiElementBase.extend({gfx:new ig.Image("media/gui/circuit.png"),transitions:{DEFAULT:{state:{},time:0.2,timeFunction:KEY_SPLINES.LINEAR},HIDDEN:{state:{alpha:0},time:0.2,timeFunction:KEY_SPLINES.LINEAR}},tree:null,buttonGroup:null,skills:[],skillStart:0,effectGuis:[],init:function(a){this.parent();this.setSize(m[a].size.x,m[a].size.y);if(a==void 0)throw Error("Element muss be defined");
this.tree=m[a];this.buttonGroup=new sc.CircuitDetailButtonGroup;sc.Model.addObserver(sc.model.player,this);sc.Model.addObserver(sc.menu,this);this._createTree();this.doStateTransition("DEFAULT",true)},updateDrawables:function(a){window.IG_GAME_DEBUG&&o&&a.addColor("white",0,0,this.hook.size.x,this.hook.size.y).setAlpha(0.05)},addObservers:function(){sc.Model.addObserver(sc.model.player,this);sc.Model.addObserver(sc.menu,this)},removeObservers:function(){sc.Model.removeObserver(sc.model.player,this);
sc.Model.removeObserver(sc.menu,this)},activate:function(a,b){sc.menu.buttonInteract.pushButtonGroup(this.buttonGroup);sc.menu.pushBackCallback(this._onBackButtonPress.bind(this));ig.interact.setBlockDelay(0.2);this.doStateTransition("DEFAULT",a,false,b||null)},deactivate:function(a){for(var b=this.effectGuis.length;b--;){this.effectGuis[b].hide();this.removeChildGui(this.effectGuis[b])}this.effectGuis.length=0;sc.menu.popBackCallback();sc.menu.buttonInteract.removeButtonGroup(this.buttonGroup);a||
this.doStateTransition("HIDDEN")},exit:function(){sc.menu.buttonInteract.removeButtonGroup(this.buttonGroup)},modelChanged:function(a,b,c){if(a==sc.model.player){if(b==sc.PLAYER_MSG.SKILL_CHANGED&&c>=this.skillStart&&c<=this.skillStart+this.skills.length-1)for(a=this.skills.length;a--;)this.skills[a].updateIconAlpha()}else a==sc.menu&&b==sc.MENU_EVENT.SKILL_SHOW_EFFECT&&this._showEffect(c.gui,c.isSwitch,c.delay)},_showEffect:function(a,b,c){if(a&&this.tree.element==a.element){var d=new sc.CircuitEffectDisplay;
this.addChildGui(d);d.show(a,b,c);this.effectGuis.push(d)}},_onBackButtonPress:function(){this.deactivate();sc.menu.selectSkillTree(-1)},_createTree:function(){var a=sc.skilltree.getTree(this.tree.element);r.x=this.tree.node.x;r.y=this.tree.node.y;var b=this.tree.startDir.x,c=this.tree.startDir.y;n.x=b;n.y=c;var d=null;this.skillStart=a[0].uid;d=new sc.CircuitTreeDetail.Start(r.x,r.y,b,c,this.tree.element,a);this.addChildGui(d);for(var f=0;f<a.length;f++){d=a[f];h(d)||this._createTreeNodesRecursive(d,
this.tree.element,r.x,r.y,b,c,null);e("CW_90",b,c);b=n.x;c=n.y}},_createTreeNodesRecursive:function(a,b,c,d,f,g,i){var j=false,k=null,m=null;if(a.orBranch){var l=a.orBranch;e(a.direction,f,g);j=Math.abs(n.x)==1&&Math.abs(n.y)==1;c=c+(a.distance+(j?2:3))*8*n.x;d=d+(a.distance+(j?2:3))*8*n.y;p.x=n.x;p.y=n.y;e(l.direction,n.x,n.y);(j=Math.abs(n.x)==1&&Math.abs(n.y)==1)&&ig.error("orBranch can't be rendered with a slope direction.");k=new sc.CircuitTreeDetail.OrBranchLine(c,d,n.x,n.y,l,a,b,false);this.addChildGui(k);
for(var c=c+(j?3:6)*8*n.x,d=d+(j?3:6)*8*n.y,f=k=null,g=i,o=0;o<3;o++){if(o+1>=3)k=f=a.children[0];else{k=l.left[o+1];f=l.right[o+1]}if(n.x!=0){k=new sc.CircuitTreeDetail.Node(c,d+(n.x>0?-24:24),n.x,n.y,l.left[o],b,k,this.buttonGroup,this.skillStart,g,o,l.levels,true);if(g)g.nextGui=k;g=k;this.addChildGui(k);this.skills[l.left[o].uid-this.skillStart]=k;k=new sc.CircuitTreeDetail.Node(c,d+(n.x>0?24:-24),n.x,n.y,l.right[o],b,f,this.buttonGroup,this.skillStart,i,o,l.levels,false)}else{k=new sc.CircuitTreeDetail.Node(c+
(n.y>0?24:-24),d,n.x,n.y,l.left[o],b,k,this.buttonGroup,this.skillStart,g,o,l.levels,true);if(g)g.nextGui=k;g=k;this.addChildGui(k);this.skills[l.left[o].uid-this.skillStart]=k;k=new sc.CircuitTreeDetail.Node(c+(n.y>0?-24:24),d,n.x,n.y,l.right[o],b,f,this.buttonGroup,this.skillStart,i,o,l.levels,false)}if(i)i.nextGui=k;i=k;this.addChildGui(k);g.orGui=i;i.orGui=g;this.skills[l.right[o].uid-this.skillStart]=k;c=c+(j?3:5)*8*n.x;d=d+(j?3:5)*8*n.y;m=k}c=c-(j?1:2)*8*n.x;d=d-(j?1:2)*8*n.y;k=new sc.CircuitTreeDetail.OrBranchLine(c,
d,n.x,n.y,l,a,b,true);this.addChildGui(k);c=c+8*n.x;d=d+8*n.y}else{e(a.direction,f,g);j=Math.abs(n.x)==1&&Math.abs(n.y)==1;c=c+(a.distance+(j?3:5))*8*n.x;d=d+(a.distance+(j?3:5))*8*n.y;k=new sc.CircuitTreeDetail.Node(c,d,n.x,n.y,a,b,null,this.buttonGroup,this.skillStart,i);this.addChildGui(k);m=this.skills[a.uid-this.skillStart]=k}a=a.children;if(a.length!=0){j=null;f=n.x;g=n.y;for(l=0;l<a.length;l++){j=a[l];if(!h(j)){d=this._createLine(j,b,c,d,f,g);this._createTreeNodesRecursive(j,b,c,d,f,g,m)}}}},
_createLine:function(a,b,c,d,f,g){if(a.distance<=0)return d;e(a.direction,f,g);n.x==1&&(n.y==-1&&a.orBranch)&&(d=d-1);a=new sc.CircuitTreeDetail.Line(c,d,n.x,n.y,a,b);this.addChildGui(a);return d}});sc.CircuitTreeDetail.Start=ig.GuiElementBase.extend({gfx:new ig.Image("media/gui/circuit.png"),element:0,children:null,dirX:0,dirY:0,centerPos:0,init:function(a,b,c,d,e,f){this.parent();this.setSize(40,40);this.setPos(a-l,b-l);this.element=e;this.children=f;this.dirX=c;this.dirY=d;this.centerPos=l-6},
updateDrawables:function(b){window.IG_GAME_DEBUG&&o&&b.addColor("red",1,1,39,39).setAlpha(0.2);b.addGfx(this.gfx,this.centerPos,this.centerPos,56,0+this.element*16,13,13);a(b,this.gfx,null,this.children,l,l,this.dirX,this.dirY,this.element,true)}});sc.CircuitTreeDetail.Node=ig.FocusGui.extend({gfx:new ig.Image("media/gui/circuit.png"),icons:new ig.Image("media/gui/circuit-icons.png"),parentGui:null,element:0,skill:null,branchSkill:null,coords:{x:5,y:5,w:31,h:31},dirX:0,dirY:0,centerPos:0,orBranchIndex:-1,
orLevels:null,orLeft:true,blocked:false,blockID:0,submitSound:null,blockedSound:null,_iconAlpha:1,_player:null,_buttonGroup:null,init:function(a,c,d,e,f,g,h,i,j,k,m,o,n){this.parent();this.setSize(41,41);this.setPos(a-l,c-l);this.parentGui=k||null;this.element=g;this.skill=f;this.dirX=d;this.dirY=e;this.centerPos=l-15;this.submitSound=sc.BUTTON_SOUND.submit;this.blockedSound=sc.BUTTON_SOUND.denied;this._player=sc.model.player;this.updateIconAlpha();if(h){this.branchSkill=[];this.branchSkill.push(h);
this.orBranchIndex=m;this.orLevels=o;this.orLeft=n==void 0?true:n;this.blockID=b(this.skill.uid,this.orLevels[this.orBranchIndex],this.element)}else this.blockID=b(this.skill.uid,this.skill.level,this.element);if(this.blockID>0)this.blocked=true;(this._buttonGroup=i)&&i.addFocusGui(this,f.uid-j||0,0)},updateIconAlpha:function(){this._iconAlpha=1;if(!this._player.hasSkill(this.skill.uid))this._iconAlpha=this._calculateAlpha(this.parentGui,this._iconAlpha)},getOffsetX:function(){return m[this.element].offset.x},
getOffsetY:function(){return m[this.element].offset.y},getDistanceToCursor:function(){return Math.floor(Vec2.distanceC(sc.menu.skillCursor.x-m[this.element].offset.x,sc.menu.skillCursor.y-m[this.element].offset.y,this.hook.pos.x+l,this.hook.pos.y+l))},updateDrawables:function(b){if(window.IG_GAME_DEBUG){o&&b.addColor(this.branchSkill?"yellow":"green",1,1,39,39).setAlpha(0.2);o&&b.addColor(this.branchSkill?"yellow":"green",5,5,31,31).setAlpha(0.2)}var c=sc.model.player.hasSkill(this.skill.uid);b.addGfx(this.gfx,
this.centerPos,this.centerPos,0,c?32+this.element*32:0,31,31);if(this._iconAlpha>0){c=sc.skilltree.getSkill(this.skill.uid).icon;b.addGfx(this.icons,8,8,c%10*24,Math.floor(c/10)*24,24,24).setAlpha(this._iconAlpha)}a(b,this.gfx,this.skill,this.branchSkill?this.branchSkill:this.skill.children,l,l,this.dirX,this.dirY,this.element,false,this.orBranchIndex,this.orLevels);if(this.blocked){c=m[this.element].shadeBlock.levels[(this.branchSkill?this.orLevels[this.orBranchIndex]:this.skill.level)-2];c=y[c];
b.addGfx(this.gfx,this.centerPos,this.centerPos,480,168+c,32,40)}},onButtonPress:function(){if(sc.menu.skillWasDragged)sc.menu.skillWasDragged=false;else{var a=false;if(this._checkParentForBlock(this.parentGui))this.blockedSound&&this.blockedSound.play();else{this.parentGui&&(this._hasParent(this.parentGui)||(a=true));if(ig.input.currentDevice==ig.INPUT_DEVICES.KEYBOARD_AND_MOUSE){var b=Math.floor(sc.control.getMouseY());if(b<=21||b>=299)return}this.submitSound&&this.submitSound.play();sc.menu.centerOnNode(this,
a)}}},onMouseInteract:function(a,b){ig.input.state("shift")||this.parent(a,b)},isMouseOver:function(){if(sc.menu.currentSkillTree==-1||sc.menu.skillState==sc.MENU_SKILL_STATE.NODE_MENU)return false;if(sc.menu.skillDrag)return sc.menu.currentSkillFocus==this;if(!ig.interact.isBlocked()&&this._buttonGroup.isActive()){if(ig.input.currentDevice==ig.INPUT_DEVICES.GAMEPAD){var a=this.getDistanceToCursor();if(sc.menu.skillCursorMoved){sc.menu.unfocusCursor(this);return false}if(a<=14){sc.menu.focusCursorOnNode(this.hook.pos.x+
20+m[this.element].offset.x,this.hook.pos.y+20+m[this.element].offset.y,this);return true}sc.menu.unfocusCursor(this);return false}var a=Math.floor(sc.control.getMouseX()),b=Math.floor(sc.control.getMouseY());if(b<=21||b>=299){sc.menu.unfocusCursor(this);return false}this.coords.x=5+this.hook.screenCoords.x;this.coords.y=5+this.hook.screenCoords.y;(a=this.coords.x<=a&&this.coords.x+this.coords.w>a&&this.coords.y<=b&&this.coords.y+this.coords.h>b)&&!ig.input.state("shift")?sc.menu.focusCursorOnNode(this.hook.pos.x+
20+m[this.element].offset.x,this.hook.pos.y+20+m[this.element].offset.y,this):sc.menu.unfocusCursor(this);return a}},getNodeFocus:function(a){a=a||Vec2.createC(0,0);a.x=this.hook.pos.x+20+m[this.element].offset.x;a.y=this.hook.pos.y+20+m[this.element].offset.y;return a},_hasParent:function(a){if(a)if(a.branchSkill)if(a.orBranchIndex==2){if(!sc.model.player.hasSkill(a.skill.uid)&&!sc.model.player.hasSkill(a.skill.uid-1))return false}else if(a.orLeft){if(!sc.model.player.hasSkill(a.skill.uid)&&!sc.model.player.hasSkill(a.skill.uid+
1))return false}else{if(!sc.model.player.hasSkill(a.skill.uid)&&!sc.model.player.hasSkill(a.skill.uid-1))return false}else if(!sc.model.player.hasSkill(a.skill.uid))return false;return true},_checkParentForBlock:function(a){return this.blocked?true:a?a.blocked?true:a.parentGui?a.parentGui.blocked?true:this._checkParentForBlock(a.parentGui):false:false},_calculateAlpha:function(a,b){if(b<=0.2)return 0.2;if(a){if(a.branchSkill)if(a.orBranchIndex==2){if(this._player.hasSkill(a.skill.uid)||this._player.hasSkill(a.skill.uid-
1))return b}else if(a.orLeft){if(this._player.hasSkill(a.skill.uid)||this._player.hasSkill(a.skill.uid+1))return b}else{if(this._player.hasSkill(a.skill.uid)||this._player.hasSkill(a.skill.uid-1))return b}else if(this._player.hasSkill(a.skill.uid))return b;return this._calculateAlpha(a.parentGui,(b*100-20)/100)}return b}});sc.CircuitTreeDetail.OrBranchLine=ig.GuiElementBase.extend({gfx:new ig.Image("media/gui/circuit.png"),orSkill:null,skill:null,element:0,dirX:0,dirY:0,drawDir:0,flip:false,levelOffset:0,
uidLeft:0,uidRight:0,uidNext:-1,uidLeftNext:-1,uidRightNext:-1,hasBranchChildren:false,init:function(a,b,c,d,e,f,h,i){this.parent();this.setPos(a,b);this.element=h;this.orSkill=e;this.skill=f;this.dirX=c;this.dirY=d;this.flip=i!=void 0?i:false;n.x=c;n.y=d;this.levelOffset=this.flip?Math.max(0,f.children[0].level-1)*56:Math.max(0,e.levels[0]-1)*56;this.uidLeft=this.orSkill.left[0].uid;this.uidRight=this.orSkill.right[0].uid;this.uidLeftNext=this.skill?this.orSkill.left[2].uid:-1;this.uidRightNext=
this.skill?this.orSkill.right[2].uid:-1;this.hasBranchChildren=this.skill.children[0].orBranch?true:false;this.uidNext=this.skill?this.skill.children[0].uid:-1;if(this.hasBranchChildren){this.uidLeftNext=this.skill?this.skill.children[0].orBranch.left[0].uid:-1;this.uidRightNext=this.skill?this.skill.children[0].orBranch.right[0].uid:-1;if(this.flip)this.levelOffset=Math.max(0,this.skill.children[0].orBranch.levels[0]-1)*56}this.drawDir=g(n);switch(this.drawDir){case sc.LINE_DRAW_TYPE.HORZ:this.setSize(32,
56);this.setPos(a+(c>0?-3:-27),b-27);break;case sc.LINE_DRAW_TYPE.VERT:this.setSize(56,32);this.setPos(a-27,b+(d>0?-3:-27));break;case sc.LINE_DRAW_TYPE.SLOPE:ig.warn("This will lead to an error bro, we can't draw orBranches in slopes: "+Vec2.print(c,d))}},updateDrawables:function(a){window.IG_GAME_DEBUG&&o&&a.addColor("yellow",0,0,this.hook.size.x,this.hook.size.y).setAlpha(0.2);var b=sc.model.player,c=b.hasSkill(this.uidLeft),d=b.hasSkill(this.uidRight),e=c||d;if(this.dirX<0||this.dirY<0)if(c&&
d)c=d=true;else if(d){c=true;d=false}else if(c){d=true;c=false}var f=false;d&&!c&&(f=true);var g=this.flip;if(this.dirX<0||this.dirY<0)g=!g;if(this.flip)if(this.hasBranchChildren){c=b.hasSkill(this.uidLeftNext);d=b.hasSkill(this.uidRightNext);e=c||d}else e=b.hasSkill(this.uidNext);switch(this.drawDir){case sc.LINE_DRAW_TYPE.HORZ:a.addGfx(this.gfx,0,f?-1:0,e?352+this.element*32:320,this.levelOffset,32,56,g,f);break;case sc.LINE_DRAW_TYPE.VERT:a.addGfx(this.gfx,f?-1:0,0,this.levelOffset,e?344+this.element*
32:312,56,32,f,g)}c&&d&&a.addGfx(this.gfx,this.hook.size.x/2-16,this.hook.size.y/2-16,480,320,32,32)}});sc.CircuitTreeDetail.Line=ig.GuiElementBase.extend({gfx:new ig.Image("media/gui/circuit.png"),endSkill:null,element:0,dirX:0,dirY:0,overrideDistance:false,init:function(a,b,c,d,e,h){this.parent();this.element=h;this.endSkill=e;this.dirX=c;this.dirY=d;n.x=c;n.y=d;c=e.distance*8;d=g(n);h=d==sc.LINE_DRAW_TYPE.SLOPE;a=a+(h?n.x>0?13:c+11:n.x>0?21:c+19)*n.x;b=b+(h?n.y>0?n.x>0?12:11:c+(n.x>0?13:12):n.y>
0?21:c+19)*n.y;n.x==0&&(a=a-3);n.y==0&&(b=b-3);var i=h=0;if(e.orBranch){if(g(n)==sc.LINE_DRAW_TYPE.SLOPE){h=3;i=6;this.overrideDistance=true}switch(f(n)){case sc.TREE_CARDINAL_DIR.SOUTH_WEST:a=a-3;break;case sc.TREE_CARDINAL_DIR.NORTH_EAST:b=b-2;break;case sc.TREE_CARDINAL_DIR.NORTH_WEST:a=a-3;b=b-3}}this.setPos(a,b);switch(d){case sc.LINE_DRAW_TYPE.HORZ:this.setSize(c,8);break;case sc.LINE_DRAW_TYPE.VERT:this.setSize(8,c);break;case sc.LINE_DRAW_TYPE.SLOPE:this.setSize(c+h,c+i)}},updateDrawables:function(a){window.IG_GAME_DEBUG&&
o&&a.addColor("blue",0,0,this.hook.size.x,this.hook.size.y).setAlpha(0.2);this.overrideDistance?d(a,this.gfx,this.endSkill,this.element,0,0,this.dirX,this.dirY,this.endSkill.distance*8+3,false,true):d(a,this.gfx,this.endSkill,this.element,0,0,this.dirX,this.dirY)}})});ig.baked=!0;
ig.module("game.feature.menu.gui.circuit.circuit-swap-branches").requires("impact.feature.gui.base.basic-gui","game.feature.menu.gui.circuit.circuit-misc","game.feature.menu.gui.circuit.circuit-detail-elements").defines(function(){Vec2.createC(0,0);Vec2.createC(0,0);Vec2.createC(0,0);var b=new ig.Sound("media/sound/menu/circuit/circuit-upgrade-b-2.ogg",1);sc.CircuitSwapBranches=ig.GuiElementBase.extend({transitions:{DEFAULT:{state:{},time:0.2,timeFunction:KEY_SPLINES.LINEAR},HIDDEN:{state:{alpha:0},
time:0.2,timeFunction:KEY_SPLINES.LINEAR},SCALE:{state:{alpha:0,scaleX:1.5,scaleY:1.5},time:0.2,timeFunction:KEY_SPLINES.LINEAR}},buttonGroup:null,cursor:null,_gamepadActive:false,_lastDevice:0,_cursorPos:Vec2.createC(-1E4,-1E4),_firstVisit:false,effectGuis:[],init:function(){this.parent();this.setSize(274,274);this.setPos(sc.options.hdMode?147:103,23);this.hook.pivot.x=Math.floor(137);this.hook.pivot.y=Math.floor(137);var a=d.length,b=null,b=null;this.buttonGroup=new sc.MouseButtonGroup;this.buttonGroup.ignoreActiveFocus=
true;for(this.buttonGroup.onButtonTraversal=function(){if(ig.input.currentDevice==ig.INPUT_DEVICES.GAMEPAD&&sc.control.menuConfirm()&&sc.menu.skillSwapFocus)sc.menu.skillSwapFocus.onButtonPress()}.bind(this);a--;){b=d[a];if(sc.model.player.hasElement(b.element))if(sc.skilltree.getSkill(b.startUID).type!=sc.SKILL_STATES.OR_BRANCH_FIRST)ig.warn("Swap Skill UID is not first branch UID: "+b.startUID+" [Panel will be skipped]");else{b=new sc.CircuitSwapBranches.Button(b.pos.x-1,b.pos.y,b.startUID,b.element);
this.addChildGui(b);this.buttonGroup.addFocusGui(b)}}this.cursor=new sc.CircuitSwapCursor;this.addChildGui(this.cursor);this.doStateTransition("HIDDEN",true)},update:function(){sc.menu.skillSwapMoved=false;if(!ig.interact.isBlocked()&&this.buttonGroup.isActive()){if(this._lastDevice!=ig.input.currentDevice){this._gamepadActive=ig.input.currentDevice==ig.INPUT_DEVICES.GAMEPAD;this._lastDevice=ig.input.currentDevice;var a=null;if(ig.input.currentDevice==ig.INPUT_DEVICES.GAMEPAD){a=this._cursorPos;this._initCursor(a);
sc.menu.skillSwapCursor.x=a.x;sc.menu.skillSwapCursor.y=a.y;this._limitCursorPos();sc.menu.resetSwapCursor();this.cursor.moveTo(sc.menu.skillSwapCursor.x,sc.menu.skillSwapCursor.y)}else if(ig.input.currentDevice==ig.INPUT_DEVICES.KEYBOARD_AND_MOUSE){this._cursorPos.x=sc.menu.skillSwapCursor.x;this._cursorPos.y=sc.menu.skillSwapCursor.y;this.cursor.unfocus()}sc.menu.toggledInputMode()}if(ig.input.currentDevice==ig.INPUT_DEVICES.GAMEPAD){var b=a=0,d=0,g=false;if((d=sc.control.getAxesValue(ig.AXES.LEFT_STICK_X))<
-0.5){a=(-100+d*100)*ig.system.actualTick;g=true}else if((d=sc.control.getAxesValue(ig.AXES.LEFT_STICK_X))>0.5){a=(100+d*100)*ig.system.actualTick;g=true}if((d=sc.control.getAxesValue(ig.AXES.LEFT_STICK_Y))<-0.5){b=(-100+d*100)*ig.system.actualTick;g=true}else if((d=sc.control.getAxesValue(ig.AXES.LEFT_STICK_Y))>0.5){b=(100+d*100)*ig.system.actualTick;g=true}if(g){sc.menu.skillSwapMoved=true;sc.menu.skillSwapCursor.x=a>=0?Math.floor(sc.menu.skillSwapCursor.x+a):Math.ceil(sc.menu.skillSwapCursor.x+
a);sc.menu.skillSwapCursor.y=b>=0?Math.floor(sc.menu.skillSwapCursor.y+b):Math.ceil(sc.menu.skillSwapCursor.y+b);this._limitCursorPos();this.cursor.moveTo(sc.menu.skillSwapCursor.x,sc.menu.skillSwapCursor.y)}}}},addObservers:function(){sc.Model.addObserver(sc.menu,this)},removeObservers:function(){sc.Model.removeObserver(sc.menu,this)},showMenu:function(){sc.menu.buttonInteract.pushButtonGroup(this.buttonGroup);sc.menu.pushBackCallback(this._onBackButtonPress.bind(this));sc.menu.resetSwapCursor();
if(this._lastDevice!=ig.input.currentDevice){this._gamepadActive=ig.input.currentDevice==ig.INPUT_DEVICES.GAMEPAD;this._lastDevice=ig.input.currentDevice}this._focusButton();if(sc.menu.skillStateOrigin==sc.MENU_SKILL_STATE.DETAIL_VIEW){this.doStateTransition("SCALE",true);this.doStateTransition("DEFAULT")}else this.doStateTransition("DEFAULT",true)},exitMenu:function(){this.cursor.unfocus();sc.menu.buttonInteract.removeButtonGroup(this.buttonGroup);this.buttonGroup.unfocusCurrentButton();sc.menu.popBackCallback();
for(var a=this.effectGuis.length;a--;){this.effectGuis[a].hide();this.removeChildGui(this.effectGuis[a])}this.effectGuis.length=0;this.doStateTransition("HIDDEN",true)},_initCursor:function(a){if(a.x<=-1E4||a.y<=-1E4){a.x=Math.floor(this.hook.size.x/2);a.y=Math.floor(this.hook.size.y/2)}},_limitCursorPos:function(){var a=sc.menu.skillSwapCursor.x;sc.menu.skillSwapCursor.x=a.limit(0,Math.floor(this.hook.size.x));a=sc.menu.skillSwapCursor.y;sc.menu.skillSwapCursor.y=a.limit(0,this.hook.size.y)},_focusButton:function(){if(this._firstVisit){var a=
this._cursorPos;a.x=sc.menu.skillSwapCursor.x;a.y=sc.menu.skillSwapCursor.y;this._limitCursorPos();this.cursor.moveTo(sc.menu.skillSwapCursor.x,sc.menu.skillSwapCursor.y)}else if(ig.input.currentDevice==ig.INPUT_DEVICES.GAMEPAD){this._firstVisit=true;a=this._cursorPos;this._initCursor(a);sc.menu.skillSwapCursor.x=a.x;sc.menu.skillSwapCursor.y=a.y;this._limitCursorPos();this.cursor.moveTo(sc.menu.skillSwapCursor.x,sc.menu.skillSwapCursor.y)}},_onBackButtonPress:function(){sc.menu.leaveSwapBranches()},
_showEffect:function(a){if(a){var b=new sc.CircuitEffectDisplay(true);this.addChildGui(b);b.show(a,true,0,true);this.effectGuis.push(b)}},modelChanged:function(a,b,d){a==sc.menu&&(b==sc.MENU_EVENT.SKILL_ENTER_SWAP_BRANCHES?this.showMenu():b==sc.MENU_EVENT.SKILL_LEAVE_SWAP_BRANCHES?this.exitMenu():b==sc.MENU_EVENT.SKILL_TOGGLED_INPUT_MODE?this.buttonGroup.isActive()&&this.cursor.resetFocusTimer():b==sc.MENU_EVENT.SKILL_SWAP_FOCUS?this.buttonGroup.isActive()&&this.cursor.focusOnNode(sc.menu.skillSwapCursor.x,
sc.menu.skillSwapCursor.y):b==sc.MENU_EVENT.SKILL_SWAP_UNFOCUS?this.buttonGroup.isActive()&&this.cursor.unfocus():b==sc.MENU_EVENT.SKILL_SWAP_ENSURE?this.buttonGroup.isActive()&&(this.cursor.focus||this.cursor.focusOnNode(sc.menu.skillSwapCursor.x,sc.menu.skillSwapCursor.y)):b==sc.MENU_EVENT.SKILL_SHOW_EFFECT_SWAP&&this._showEffect(d))}});var a=Math.floor(22.5);sc.CircuitSwapBranches.Button=ig.FocusGui.extend({gfx:new ig.Image("media/gui/circuit.png"),submitSound:null,blockedSound:null,startUID:-1,
element:-1,init:function(a,d,f,g){this.parent();this.setSize(45,45);this.setPos(a,d);this.startUID=f||-1;this.element=g||0;this.submitSound=b;this.blockedSound=sc.BUTTON_SOUND.denied},updateDrawables:function(){if(sc.menu.skillState!=sc.MENU_SKILL_STATE.SWAP_BRANCHES)return false},onButtonPress:function(){if(ig.interact.isBlocked())return false;if(this.startUID<0)ig.warn("skill UID is not valid: "+this.startUID);else{for(var a=sc.skilltree.getSkill(this.startUID).type==sc.SKILL_STATES.OR_BRANCH_FIRST,
b=false,d=0;d<6;d++)if(sc.model.player.hasSkill(this.startUID+d)){b=true;break}var g=-1;if(sc.model.player.hasSkill(this.startUID)){g=this.startUID+1;a=false}else sc.model.player.hasSkill(this.startUID+1)?g=this.startUID:b=false;if(b&&g>=0){this.submitSound&&this.submitSound.play();sc.model.player.switchBranch(g,a);if(window.IG_GAME_DEBUG){console.groupCollapsed("%cSwitched Branch: ","color:#00CC00");console.groupCollapsed("%cNew BranchIndices: %c[%i, %i, %i]","color:#00CC00","",g,g+2,g+4);for(d=
0;d<3;d++)ig.log("%c [%i]: %c"+sc.skilltree.getSkill(g+d*2).getName(),"color:#00CC00",g+d*2,"");console.groupEnd();g=g+(a?1:-1);console.groupCollapsed("%cOld BranchIndices: %c[%i, %i, %i]","color:#00CC00","",g,g+2,g+4);for(d=0;d<3;d++)ig.log("%c [%i]: %c"+sc.skilltree.getSkill(g+d*2).getName(),"color:#00CC00",g+d*2,"");console.groupEnd();console.groupEnd()}sc.menu.showSwapSkillEffect(this)}else this.blockedSound&&this.blockedSound.play()}},isMouseOver:function(){if(ig.interact.isBlocked()||sc.menu.skillState!=
sc.MENU_SKILL_STATE.SWAP_BRANCHES)return false;if(ig.input.currentDevice==ig.INPUT_DEVICES.GAMEPAD){var b=this.getDistanceToCursor();if(sc.menu.skillSwapMoved){sc.menu.unfocusSwapCursor(this);return false}if(b<=16){sc.menu.focusSwapCursor(this.hook.pos.x+22,this.hook.pos.y+22,this);return true}sc.menu.unfocusSwapCursor(this)}else if(ig.input.currentDevice==ig.INPUT_DEVICES.KEYBOARD_AND_MOUSE){var b=Math.floor(this.hook.screenCoords.x),d=Math.floor(this.hook.screenCoords.y),f=Math.floor(sc.control.getMouseX()),
g=Math.floor(sc.control.getMouseY());(b=Math.abs(f-(a+b))+Math.abs(g-(a+d))<=a)?sc.menu.focusSwapCursor(this.hook.pos.x+22,this.hook.pos.y+22,this):sc.menu.unfocusSwapCursor(this);return b}return false},getDistanceToCursor:function(){return Math.floor(Vec2.distanceC(sc.menu.skillSwapCursor.x,sc.menu.skillSwapCursor.y,this.hook.pos.x+Math.floor(this.hook.size.x/2),this.hook.pos.y+Math.floor(this.hook.size.y/2)))}});sc.CircuitSwapBranchesInfoBox=ig.GuiElementBase.extend({transitions:{DEFAULT:{state:{},
time:0.1,timeFunction:KEY_SPLINES.LINEAR},HIDDEN:{state:{alpha:0,scaleX:1,scaleY:0},time:0.1,timeFunction:KEY_SPLINES.LINEAR}},gfx:new ig.Image("media/gui/menu.png"),buttonGroup:null,currentFocus:null,leftContent:null,rightContent:null,arrow:null,branches:{left:[null,null,null],right:[null,null,null]},_scrollHook:null,delta:Vec2.createC(-1,-1),init:function(a){this.parent(sc.MenuPanelType.TOP_RIGHT_EDGE);this.setAlign(ig.GUI_ALIGN.X_RIGHT,ig.GUI_ALIGN.Y_CENTER);this.setPos(5,0);this.setSize(150,209);
this.setPivot(0,104.5);this.hook.invisibleUpdate=true;this.buttonGroup=a;this.leftContent=new sc.MenuPanel(sc.MenuPanelType.BOTTOM_LEFT_EDGE);this.leftContent.hook.transitions={DEFAULT:{state:{},time:0.2,timeFunction:KEY_SPLINES.LINEAR},HIDDEN:{state:{alpha:0,offsetX:75},time:0.2,timeFunction:KEY_SPLINES.LINEAR}};this.leftContent.setSize(150,77);this.leftContent.doStateTransition("HIDDEN",true);this.addChildGui(this.leftContent);this.leftContent.annotation={content:{title:"sc.gui.menu.help.circuit.titles.branch",
description:"sc.gui.menu.help.circuit.description.branch"},offset:{x:0,y:-1},size:{x:150,y:77},index:{x:1,y:1}};this.rightContent=new sc.MenuPanel(sc.MenuPanelType.TOP_LEFT_EDGE);this.rightContent.hook.transitions={DEFAULT:{state:{},time:0.2,timeFunction:KEY_SPLINES.LINEAR},HIDDEN:{state:{alpha:0,offsetX:75},time:0.2,timeFunction:KEY_SPLINES.LINEAR}};this.rightContent.setAlign(ig.GUI_ALIGN.X_LEFT,ig.GUI_ALIGN.Y_BOTTOM);this.rightContent.setSize(150,77);this.rightContent.doStateTransition("HIDDEN",
true);this.addChildGui(this.rightContent);this.rightContent.annotation={content:{title:"sc.gui.menu.help.circuit.titles.branch",description:"sc.gui.menu.help.circuit.description.branch"},offset:{x:0,y:-1},size:{x:150,y:77},index:{x:1,y:0}};this.arrow=new ig.ImageGui(this.gfx,576,224,23,20);this.arrow.setAlign(ig.GUI_ALIGN.X_CENTER,ig.GUI_ALIGN.Y_CENTER);this.arrow.hook.transitions={DOWN:{state:{},time:0.1,timeFunction:KEY_SPLINES.LINEAR},DOWN_INACTIVE:{state:{},time:0.05,timeFunction:KEY_SPLINES.LINEAR},
UP:{state:{angle:Math.PI},time:0.1,timeFunction:KEY_SPLINES.LINEAR},UP_INACTIVE:{state:{angle:Math.PI},time:0.1,timeFunction:KEY_SPLINES.LINEAR},HIDDEN:{state:{alpha:0,scaleX:0,scaleY:0,angle:-Math.PI/2},time:0.2,timeFunction:KEY_SPLINES.LINEAR}};this.arrow.doStateTransition("HIDDEN",true);this.addChildGui(this.arrow);for(var a=2,b=0;b<3;b++){this.branches.left[b]=new sc.CircuitSwapBranchesInfoBox.Skill;this.branches.left[b].setPos(0,a);this.branches.right[b]=new sc.CircuitSwapBranchesInfoBox.Skill;
this.branches.right[b].setPos(0,a);this.leftContent.addChildGui(this.branches.left[b]);this.rightContent.addChildGui(this.branches.right[b]);a=a+24}this.doStateTransition("DEFAULT",true)},setContent:function(a){this.currentFocus=sc.menu.skillSwapFocus;if(!this.currentFocus||a){a="UP_INACTIVE";this.arrow.hook.currentStateName=="DOWN"&&(a="DOWN_INACTIVE");this.arrow.doStateTransition(a,false,false,function(){for(var a=0;a<3;a++){this.branches.left[a].setContent(null,-1,false,0.05);this.branches.right[a].setContent(null,
-1,false,0.05)}this.arrow.offsetY=245}.bind(this),0.05)}else{this.arrow.hook.stateCallback=null;var a=this.currentFocus.startUID,b=sc.model.player;sc.skilltree.getSkill(a);var d=null,g=0,h=this.branches.left,i=this.branches.right,j=b.hasSkill(a)?true:false,k=false;if(!b.hasSkill(a)&&!b.hasSkill(a+1)){this.arrow.offsetY=245;j=true}else{this.arrow.offsetY=224;k=true}for(b=0;b<6;b=b+2){d=sc.skilltree.getSkill(a+b);h[g].setContent(d,a+b,j,k);d=sc.skilltree.getSkill(a+(b+1));i[g].setContent(d,a+(b+1),
!j,k);g++}this.arrow.doStateTransition(!j?"UP":"DOWN");this.doStateTransition("DEFAULT")}},showMenu:function(){this.setContent();this.leftContent.doStateTransition("DEFAULT");this.rightContent.doStateTransition("DEFAULT");this.arrow.doStateTransition("DOWN")},hideMenu:function(){this.leftContent.doStateTransition("HIDDEN");this.rightContent.doStateTransition("HIDDEN");this.arrow.doStateTransition("HIDDEN")},modelChanged:function(a,b){a==sc.menu?b==sc.MENU_EVENT.SKILL_ENTER_SWAP_BRANCHES?this.showMenu():
b==sc.MENU_EVENT.SKILL_LEAVE_SWAP_BRANCHES?this.hideMenu():b==sc.MENU_EVENT.SKILL_SWAP_FOCUS?this.buttonGroup.isActive()&&this.setContent():b==sc.MENU_EVENT.SKILL_SWAP_UNFOCUS&&this.buttonGroup.isActive()&&this.setContent(true):a==sc.model.player&&this.buttonGroup.isActive()&&b==sc.PLAYER_MSG.SKILL_BRANCH_SWAP&&this.setContent()},addObservers:function(){sc.Model.addObserver(sc.menu,this);sc.Model.addObserver(sc.model.player,this)},removeObservers:function(){sc.Model.removeObserver(sc.menu,this);sc.Model.removeObserver(sc.model.player,
this)}});sc.CircuitSwapBranchesInfoBox.Skill=ig.GuiElementBase.extend({transitions:{DEFAULT:{state:{},time:0.2,timeFunction:KEY_SPLINES.LINEAR},HALF:{state:{alpha:0.5},time:0.2,timeFunction:KEY_SPLINES.LINEAR},HIDDEN:{state:{alpha:0},time:0.2,timeFunction:KEY_SPLINES.LINEAR}},icons:new ig.Image("media/gui/circuit-icons.png"),text:null,skill:-1,init:function(){this.parent();this.setSize(150,25);this.text=new sc.TextGui("\\c[4]---------------\\c[0]");this.text.hook.transitions={DEFAULT:{state:{},time:0.2,
timeFunction:KEY_SPLINES.LINEAR},HIDDEN:{state:{alpha:0,offsetX:10},time:0.2,timeFunction:KEY_SPLINES.LINEAR}};this.text.setPos(32,4);this.addChildGui(this.text)},setContent:function(a,b,d,g){this.skill=b;var h=a?a.getName():"\\c[4]---------------\\c[0]";sc.model.player.hasSkill(b)?a instanceof sc.SpecialSkill?h="\\c[3]"+h+"\\c[0]":a||(h="\\c[4]---------------\\c[0]"):h=g&&a instanceof sc.SpecialSkill?"\\c[3]"+h+"\\c[0]":"\\c[4]"+h+"\\c[0]";this.text.setText(h);a?this.doStateTransition(d?"DEFAULT":
"HALF"):this.doStateTransition("HALF",true)},updateDrawables:function(a){var b=3;if(this.skill>=0)b=sc.skilltree.getSkill(this.skill).icon;a.addGfx(this.icons,4,0,b%10*24,Math.floor(b/10)*24,24,24)}});var d=[{element:sc.ELEMENT.COLD,pos:{x:115,y:0},startUID:184},{element:sc.ELEMENT.COLD,pos:{x:92,y:23},startUID:159},{element:sc.ELEMENT.COLD,pos:{x:138,y:23},startUID:214},{element:sc.ELEMENT.COLD,pos:{x:69,y:46},startUID:150},{element:sc.ELEMENT.COLD,pos:{x:115,y:46},startUID:178},{element:sc.ELEMENT.COLD,
pos:{x:161,y:46},startUID:205},{element:sc.ELEMENT.COLD,pos:{x:92,y:69},startUID:143},{element:sc.ELEMENT.COLD,pos:{x:138,y:69},startUID:198},{element:sc.ELEMENT.WAVE,pos:{x:0,y:115},startUID:358},{element:sc.ELEMENT.WAVE,pos:{x:23,y:92},startUID:388},{element:sc.ELEMENT.WAVE,pos:{x:23,y:138},startUID:333},{element:sc.ELEMENT.WAVE,pos:{x:46,y:69},startUID:379},{element:sc.ELEMENT.WAVE,pos:{x:46,y:115},startUID:352},{element:sc.ELEMENT.WAVE,pos:{x:46,y:161},startUID:324},{element:sc.ELEMENT.WAVE,pos:{x:69,
y:92},startUID:372},{element:sc.ELEMENT.WAVE,pos:{x:69,y:138},startUID:317},{element:sc.ELEMENT.NEUTRAL,pos:{x:115,y:92},startUID:3},{element:sc.ELEMENT.NEUTRAL,pos:{x:115,y:138},startUID:29},{element:sc.ELEMENT.NEUTRAL,pos:{x:92,y:115},startUID:42},{element:sc.ELEMENT.NEUTRAL,pos:{x:138,y:115},startUID:16},{element:sc.ELEMENT.HEAT,pos:{x:115,y:230},startUID:97},{element:sc.ELEMENT.HEAT,pos:{x:92,y:207},startUID:127},{element:sc.ELEMENT.HEAT,pos:{x:138,y:207},startUID:72},{element:sc.ELEMENT.HEAT,
pos:{x:69,y:184},startUID:118},{element:sc.ELEMENT.HEAT,pos:{x:115,y:184},startUID:91},{element:sc.ELEMENT.HEAT,pos:{x:161,y:184},startUID:63},{element:sc.ELEMENT.HEAT,pos:{x:92,y:161},startUID:111},{element:sc.ELEMENT.HEAT,pos:{x:138,y:161},startUID:56},{element:sc.ELEMENT.SHOCK,pos:{x:230,y:115},startUID:271},{element:sc.ELEMENT.SHOCK,pos:{x:207,y:92},startUID:246},{element:sc.ELEMENT.SHOCK,pos:{x:207,y:138},startUID:301},{element:sc.ELEMENT.SHOCK,pos:{x:184,y:69},startUID:237},{element:sc.ELEMENT.SHOCK,
pos:{x:184,y:115},startUID:265},{element:sc.ELEMENT.SHOCK,pos:{x:184,y:161},startUID:292},{element:sc.ELEMENT.SHOCK,pos:{x:161,y:92},startUID:230},{element:sc.ELEMENT.SHOCK,pos:{x:161,y:138},startUID:285}]});ig.baked=!0;
ig.module("game.feature.menu.gui.circuit.circuit-menu").requires("impact.feature.gui.gui","impact.feature.gui.base.basic-gui","game.feature.menu.gui.menu-misc","game.feature.menu.gui.circuit.circuit-misc","game.feature.menu.gui.circuit.circuit-detail-elements","game.feature.menu.gui.circuit.circuit-detail","game.feature.menu.gui.circuit.circuit-swap-branches","game.feature.menu.gui.circuit.circuit-overview").defines(function(){sc.CircuitMenu=sc.BaseMenu.extend({overview:null,points:null,detail:null,
info:null,node:null,swap:null,bg:null,swapInfo:null,hotkeySwap:null,hotkeyHelp:null,helpGui:null,init:function(){this.parent();this.hook.size.x=ig.system.width;this.hook.size.y=ig.system.height;this.bg=new ig.ColorGui("black",ig.system.width,ig.system.height);this.bg.hook.transitions={DEFAULT:{state:{alpha:0.2},time:0.2,timeFunction:KEY_SPLINES.LINEAR},HIDDEN:{state:{alpha:0},time:0.2,timeFunction:KEY_SPLINES.LINEAR}};this.bg.doStateTransition("HIDDEN",true);this.addChildGui(this.bg);this.overview=
new sc.CircuitOverviewMenu;this.addChildGui(this.overview);this.detail=new sc.CircuitTreeDetailContainer;this.addChildGui(new sc.DummyContainer(this.detail));this.info=new sc.CircuitInfoBox(this.detail.hook);this.addChildGui(this.info);this.points=new sc.CrossPointsOverview;this.addChildGui(this.points);this.node=new sc.CircuitNodeMenu(this.detail.hook);this.node.setPos(100,100);this.addChildGui(this.node);this.swap=new sc.CircuitSwapBranches;this.addChildGui(this.swap);this.swapInfo=new sc.CircuitSwapBranchesInfoBox(this.swap.buttonGroup);
this.addChildGui(this.swapInfo);this.hotkeyHelp=new sc.ButtonGui("\\i[help]"+ig.lang.get("sc.gui.menu.hotkeys.help"),void 0,true,sc.BUTTON_TYPE.SMALL);this.hotkeyHelp.keepMouseFocus=true;this.hotkeyHelp.hook.transitions={DEFAULT:{state:{},time:0.2,timeFunction:KEY_SPLINES.EASE},HIDDEN:{state:{offsetY:-this.hotkeyHelp.hook.size.y},time:0.2,timeFunction:KEY_SPLINES.LINEAR}};this.hotkeyHelp.onButtonPress=this._onHelpButtonPressed.bind(this);this.hotkeySwap=new sc.ButtonGui("\\i[help2]"+ig.lang.get("sc.gui.menu.hotkeys.swap-branches"),
void 0,true,sc.BUTTON_TYPE.SMALL);this.hotkeySwap.keepMouseFocus=true;this.hotkeySwap.hook.transitions={DEFAULT:{state:{},time:0.2,timeFunction:KEY_SPLINES.EASE},HIDDEN:{state:{offsetY:-this.hotkeySwap.hook.size.y},time:0.2,timeFunction:KEY_SPLINES.LINEAR}};this.hotkeySwap.onButtonPress=this._onSwapButtonPressed.bind(this);this.doStateTransition("DEFAULT",true)},_onBackButtonPress:function(){sc.menu.popBackCallback();sc.menu.popMenu()},_onHelpButtonCheck:function(){return sc.control.menuHotkeyHelp()},
_onHelpButtonPressed:function(){sc.menu.removeHotkeys();this.createHelpGui();ig.gui.addGuiElement(this.helpGui);this.helpGui.openMenu()},createHelpGui:function(){if(!this.helpGui){this.helpGui=new sc.HelpScreen(this,ig.lang.get("sc.gui.menu.help-texts.circuit.title"),ig.lang.get("sc.gui.menu.help-texts.circuit.pages"),function(){this.commitHotKeysToTopBar(true)}.bind(this),true);this.helpGui.hook.zIndex=15E4;this.helpGui.hook.pauseGui=true}},_onSwapButtonCheck:function(){return sc.control.menuHotkeyHelp2()},
_onSwapButtonPressed:function(){var b=sc.menu.skillState;if(b==sc.MENU_SKILL_STATE.SWAP_BRANCHES){this.hotkeySwap.setText("\\i[help2]"+ig.lang.get("sc.gui.menu.hotkeys.swap-branches"));sc.menu.updateHotkeys();sc.menu.leaveSwapBranches()}else{if(b!=sc.MENU_SKILL_STATE.OVERVIEW){if(b==sc.MENU_SKILL_STATE.NODE_MENU){sc.menu.exitNodeMenu();b=sc.MENU_SKILL_STATE.DETAIL_VIEW}ig.interact.setBlockDelay(0.2);this.detail.trees[sc.menu.currentSkillTree]._onBackButtonPress()}sc.menu.enterSwapBranches(b);this.overview.updateAllBuffers();
this.hotkeySwap.setText("\\i[help2]"+ig.lang.get("sc.gui.menu.hotkeys.swap-exit"));sc.menu.updateHotkeys();this.bg.doStateTransition("DEFAULT")}},_addHotKeys:function(b){sc.menu.buttonInteract.addGlobalButton(this.hotkeyHelp,this._onHelpButtonCheck.bind(this));sc.menu.buttonInteract.addGlobalButton(this.hotkeySwap,this._onSwapButtonCheck.bind(this));this.commitHotKeysToTopBar(b)},commitHotKeysToTopBar:function(b){sc.menu.addHotkey(function(){return this.hotkeySwap}.bind(this));sc.menu.addHotkey(function(){return this.hotkeyHelp}.bind(this));
sc.menu.commitHotkeys(b)},addObservers:function(){sc.Model.addObserver(sc.model.menu,this);this.overview.addObservers();this.points.addObservers();this.info.addObservers();this.node.addObservers();this.detail.addObservers();this.swap.addObservers();this.swapInfo.addObservers()},removeObservers:function(){sc.Model.removeObserver(sc.model.menu,this);this.overview.removeObservers();this.points.removeObservers();this.info.removeObservers();this.node.removeObservers();this.detail.removeObservers();this.swap.removeObservers();
this.swapInfo.removeObservers()},showMenu:function(){this.addObservers();sc.menu.pushBackCallback(this._onBackButtonPress.bind(this));sc.menu.moveLeaSprite(0,0,sc.MENU_LEA_STATE.HIDDEN);ig.interact.setBlockDelay(0.2);this._addHotKeys();this.overview.showMenu();this.points.showMenu()},hideMenu:function(){sc.menu.moveLeaSprite(0,0,sc.MENU_LEA_STATE.LARGE);this.exitMenu()},exitMenu:function(){this.removeObservers();sc.menu.buttonInteract.removeGlobalButton(this.hotkeyHelp);sc.menu.buttonInteract.removeGlobalButton(this.hotkeySwap);
this.helpGui=null;if(sc.menu.currentSkillTree==-1){this.overview.exitMenu();this.points.exitMenu();this.swapInfo.hideMenu()}else{this.overview.exitMenu(true);this.detail.exitMenu();this.points.removeHotkeys()}},modelChanged:function(b,a){if(b==sc.menu)if(a==sc.MENU_EVENT.SKILL_TREE_SELECT){if(sc.menu.previousSkillTree!=sc.menu.currentSkillTree){sc.menu.currentSkillTree==-1?this.overview.leaveDetailView():this.overview.enterDetailView();this.detail.switchElementTree(sc.menu.currentSkillTree,sc.menu.previousSkillTree)}}else if(a==
sc.MENU_EVENT.SKILL_LEAVE_SWAP_BRANCHES){this.hotkeySwap.setText("\\i[help2]"+ig.lang.get("sc.gui.menu.hotkeys.swap-branches"));sc.menu.updateHotkeys();this.overview.updateAllBuffers();this.bg.doStateTransition("HIDDEN")}}})});ig.baked=!0;
ig.module("game.feature.menu.gui.item.item-status-equip").requires("impact.feature.gui.gui","impact.feature.gui.base.basic-gui","game.feature.menu.gui.menu-misc").defines(function(){sc.ItemStatusEquip=sc.MenuPanel.extend({baseParams:{hp:null,atk:null,def:null,foc:null,fire:null,cold:null,shock:null,wave:null},gfx:new ig.Image("media/gui/menu.png"),init:function(){this.parent(sc.MenuPanelType.TOP_RIGHT_EDGE);this.setSize(126,121);this.setPos(sc.options.hdMode?25:2,28);this.hook.transitions={DEFAULT:{state:{},
time:0.2,timeFunction:KEY_SPLINES.LINEAR},HIDDEN:{state:{alpha:0,offsetX:-(126+(sc.options.hdMode?25:3))},time:0.2,timeFunction:KEY_SPLINES.LINEAR}};var b=5;this.baseParams.hp=this._createStatusDisplay(0,b,"maxhp",0,0,false,9999);b=b+14;this.baseParams.atk=this._createStatusDisplay(0,b,"atk",0,1,false,999);b=b+14;this.baseParams.def=this._createStatusDisplay(0,b,"def",0,2,false,999);b=b+14;this.baseParams.foc=this._createStatusDisplay(0,b,"foc",0,3,false,999);b=b+16;this.baseParams.fire=this._createStatusDisplay(0,
b,"res",1,4,true,999);b=b+14;this.baseParams.cold=this._createStatusDisplay(0,b,"res",2,5,true,999);b=b+14;this.baseParams.shock=this._createStatusDisplay(0,b,"res",3,6,true,999);this.baseParams.wave=this._createStatusDisplay(0,b+14,"res",4,7,true,999);this.doStateTransition("HIDDEN",true)},addObservers:function(){sc.Model.addObserver(sc.menu,this)},removeObservers:function(){sc.Model.removeObserver(sc.menu,this)},showMenu:function(){this._resetParameters();sc.menu.isItemEquipTab()&&this.doStateTransition("DEFAULT")},
exitMenu:function(){this.doStateTransition("HIDDEN")},modelChanged:function(b,a,d){b==sc.menu&&(a==sc.MENU_EVENT.ITEM_INFO_CHANGED?this._setParameters(d):a==sc.MENU_EVENT.INFO_TEXT_CHANGED?sc.menu.infoText==""&&this._resetParameters():a==sc.MENU_EVENT.ITEM_CHANGED_TAB?sc.menu.isItemEquipTab()?this.doStateTransition("DEFAULT"):this.doStateTransition("HIDDEN"):a==sc.MENU_EVENT.ITEM_RESET_INFO&&this._resetParameters())},_setParameters:function(b){this._resetParameters();if(!(b<0)&&sc.menu.isItemEquipTab())if(b=
sc.inventory.getItem(b).params){this.baseParams.hp.setChangeValue(b.hp||0);this.baseParams.atk.setChangeValue(b.attack||0);this.baseParams.def.setChangeValue(b.defense||0);this.baseParams.foc.setChangeValue(b.focus||0);if(b.elemFactor){this.baseParams.fire.setChangeValue(Math.round((b.elemFactor[0]||1)*100-100)/100);this.baseParams.cold.setChangeValue(Math.round((b.elemFactor[1]||1)*100-100)/100);this.baseParams.shock.setChangeValue(Math.round((b.elemFactor[2]||1)*100-100)/100);this.baseParams.wave.setChangeValue(Math.round((b.elemFactor[3]||
1)*100-100)/100)}}},_resetParameters:function(){for(var b in this.baseParams)this.baseParams[b].setChangeValue(0)},_createStatusDisplay:function(b,a,d,c,e,f,g){f=new sc.SimpleStatusDisplay(ig.lang.get("sc.gui.menu.equip."+d),c,e,f,g,true,126);f.setPos(b,a);if(d=="res"){c==1&&(d="heat");c==2&&(d="cold");c==3&&(d="shock");c==4&&(d="wave")}f.annotation={type:"INFO",content:{title:"sc.gui.menu.equip."+d,description:"sc.gui.menu.equip.descriptions."+d},offset:{x:-1,y:-1},index:{x:0,y:e}};this.addChildGui(f);
return f}});sc.ItemEquipModifier=sc.HeaderMenuPanel.extend({modifierText:null,modifierPool:{},init:function(){this.parent(ig.lang.get("sc.gui.menu.equip.modifiers"),sc.MenuPanelType.TOP_RIGHT_EDGE);this.setSize(126,139);this.setPos(sc.options.hdMode?25:2,153);this.hook.transitions={DEFAULT:{state:{},time:0.2,timeFunction:KEY_SPLINES.LINEAR},HIDDEN:{state:{alpha:0,offsetX:-(126+(sc.options.hdMode?25:3))},time:0.2,timeFunction:KEY_SPLINES.LINEAR}};for(var b in sc.MODIFIERS){var a=sc.MODIFIERS[b],a=
this._createStatusDisplay(0,0,"modifier."+b,5,a.icon,true,sc.MAX_MOD_VAL,a.noPercent||false,b,a.order);a.doStateTransition("HIDDEN",true);this.modifierPool[b]=a}this.doStateTransition("HIDDEN",true)},addObservers:function(){sc.Model.addObserver(sc.menu,this)},removeObservers:function(){sc.Model.removeObserver(sc.menu,this)},showMenu:function(){this._resetParameters();sc.menu.isItemEquipTab()&&this.doStateTransition("DEFAULT")},exitMenu:function(){this.doStateTransition("HIDDEN")},modelChanged:function(b,
a,d){b==sc.menu&&(a==sc.MENU_EVENT.ITEM_INFO_CHANGED?this._setParameters(d):a==sc.MENU_EVENT.INFO_TEXT_CHANGED?sc.menu.infoText==""&&this._resetParameters():a==sc.MENU_EVENT.ITEM_CHANGED_TAB&&(sc.menu.isItemEquipTab()?this.doStateTransition("DEFAULT"):this.doStateTransition("HIDDEN")))},_setParameters:function(b){this._resetParameters();if(!(b<0)&&sc.menu.isItemEquipTab())if(b=sc.inventory.getItem(b).properties){var a=12,d;for(d in this.modifierPool)if(b[d]!=void 0){this.modifierPool[d].doStateTransition("DEFAULT",
true);this.modifierPool[d].setChangeValue(Math.round((b[d]||0)*100-100)/100);this.modifierPool[d].setPos(0,a);a=a+16}}},_resetParameters:function(){for(var b in this.modifierPool){this.modifierPool[b].setChangeValue(0);this.modifierPool[b].doStateTransition("HIDDEN",true)}},_createStatusDisplay:function(b,a,d,c,e,f,g,h,i,j){d=new sc.SimpleStatusDisplay(ig.lang.get("sc.gui.menu.equip."+d),c,e,f,g,true,126,h);d.setPos(b,a);d.annotation={type:"INFO",content:{title:"sc.gui.menu.equip.modifier."+i,description:"sc.gui.menu.equip.descriptions."+
i},offset:{x:-1,y:-1},index:{x:0,y:j+8}};this.addChildGui(d);return d}})});ig.baked=!0;
ig.module("game.feature.menu.gui.item.item-status-default").requires("impact.feature.gui.gui","impact.feature.gui.base.basic-gui","game.feature.menu.gui.menu-misc").defines(function(){function b(a,b,d,m,l,o,n,p){var r=c,w=e;o||(w=w+i);n||(w=w+j);var x=f*2+g*4,E=x-h;if(m!=void 0){r=r+(f+m*g);x=x-(f+m*g);E=x-h}if(l!=void 0)E=x=x-(f+(4-l)*g);if(n&&!o&&p==0){r=r+f;E=x=x-(f+1)}a.addGfx(b,d.posX,9,r,w,x,k);d.posX=d.posX+E}function a(a,b,c,d,e,f,g,h){var i=l,j=o;f||(j=j+r);g||(j=j+t);var k=m*2+n*4,E=k-p;
if(d!=void 0){i=i+(m+d*n);k=k-(m+d*n);E=k-p}if(e!=void 0)E=k=k-(m+(4-e)*n);if(g&&!f&&h==0){i=i+m;E=k=k-(m+1)}a.addGfx(b,c.posX,9,i,j,k,q);c.posX=c.posX+E}sc.MENU_BAR_TYPE={HP:0,EXP:1,SP:2,BUFF:3};var d={sp:0,posX:0,barFilled:0,regenFilled:0};sc.ItemStatusDefaultBar=ig.GuiElementBase.extend({gfx:new ig.Image("media/gui/status-gui.png"),backgroundPatch:new ig.NinePatch("media/gui/menu.png",{width:2,height:0,left:4,top:6,right:4,bottom:0,offsets:{"default":{x:128,y:408},sp:{x:112,y:408},spm:{x:112,y:416}}}),
barPatch:new ig.NinePatch("media/gui/status-gui.png",{width:46,height:0,left:1,top:1,right:1,bottom:0,offsets:{hp:{x:0,y:48},bg:{x:0,y:49},red:{x:0,y:50},fg:{x:0,y:51},exp:{x:0,y:52},buff:{x:0,y:54}}}),type:0,name:"",maxValue:0,currentValue:-1,targetValue:0,timer:0,currentNumber:null,maxNumber:null,buff:null,barHeight:0,model:null,init:function(a,b,c,d,e,f){this.parent();this.setSize(d||126,14);this.barHeight=e||0;this.buff=c||null;this.type=b||sc.MENU_BAR_TYPE.HP;this.model=sc.model.player;a=new sc.TextGui(a,
{font:sc.fontsystem.tinyFont,speed:ig.TextBlock.SPEED.IMMEDIATE});a.setPos(3,f);this.addChildGui(a);if(this.type!=sc.MENU_BAR_TYPE.BUFF){f=0;switch(this.type){case sc.MENU_BAR_TYPE.HP:f=9999;break;case sc.MENU_BAR_TYPE.EXP:f=sc.EXP_PER_LEVEL;break;case sc.MENU_BAR_TYPE.SP:f=99}this.maxNumber=new sc.NumberGui(f);this.maxNumber.setAlign(ig.GUI_ALIGN.X_RIGHT,ig.GUI_ALIGN.Y_TOP);this.maxNumber.setPos(6,0);this.addChildGui(this.maxNumber);this.currentNumber=new sc.NumberGui(f,{transitionTime:0.2});this.currentNumber.setAlign(ig.GUI_ALIGN.X_RIGHT,
ig.GUI_ALIGN.Y_TOP);this.currentNumber.setPos(48,0)}else{f=new sc.TextGui(ig.lang.get("sc.gui.menu.seconds"),{font:sc.fontsystem.tinyFont,speed:ig.TextBlock.SPEED.IMMEDIATE});f.setAlign(ig.GUI_ALIGN.X_RIGHT,ig.GUI_ALIGN.Y_TOP);f.setPos(3,-1);this.addChildGui(f);this.currentNumber=new sc.NumberGui(999);this.currentNumber.setAlign(ig.GUI_ALIGN.X_RIGHT,ig.GUI_ALIGN.Y_TOP);this.currentNumber.setPos(19,0)}this.addChildGui(this.currentNumber)},updateValues:function(a,b,c,d){this.model=b?b:sc.model.player;
switch(this.type){case sc.MENU_BAR_TYPE.HP:b=b?b.params:sc.model.player.params;c=c||b.currentHp;if(this.currentValue!=c){if((this.targetValue-this.currentValue)*(c-this.targetValue)<0)this.currentValue=this.targetValue;this.targetValue=c;a?this.currentValue=this.targetValue:this.timer=0.2;this.maxValue=d||b.getStat("hp");this.currentNumber.setNumber(c,a);this.maxNumber.setNumber(this.maxValue,a)}break;case sc.MENU_BAR_TYPE.EXP:b=b?b:sc.model.player;if(this.currentValue!=b.exp){this.currentValue=this.targetValue=
Math.floor(b.exp);this.maxValue=sc.EXP_PER_LEVEL;this.currentNumber.setNumber(b.exp,a);this.maxNumber.setNumber(this.maxValue,a)}break;case sc.MENU_BAR_TYPE.SP:b=b?b.params:sc.model.player.params;this.currentValue!=b.currentSp&&this.currentNumber.setNumber(Math.floor(b.currentSp),a);this.maxNumber.setNumber(b.maxSp,a);break;case sc.MENU_BAR_TYPE.BUFF:b=Math.ceil(this.buff.timer);if(this.currentValue!=b){this.currentValue=this.targetValue=b;this.maxValue=this.buff.time;this.currentNumber.setNumber(b,
a)}}},resetValues:function(){this.currentNumber.setNumber(0);this.targetValue=this.currentValue=-1;this.timer=0},update:function(){if(this.timer>0)this.timer=this.timer-ig.system.actualTick;else if(this.targetValue!=this.currentValue){var a=ig.system.actualTick*this.maxValue/2;if(this.currentValue>this.targetValue)this.currentValue=Math.max(this.targetValue,this.currentValue-a);else if(this.currentValue<this.targetValue)this.currentValue=Math.min(this.targetValue,this.currentValue+a)}},updateDrawables:function(a){if(this.type==
sc.MENU_BAR_TYPE.SP)this._drawSpBar(a);else{var b,c,d,e;this.type!=sc.MENU_BAR_TYPE.BUFF?this.backgroundPatch.draw(a,this.hook.size.x-(this.barHeight?this.barHeight:4),this.barHeight?this.barHeight:4,"default",2,9):this.backgroundPatch.draw(a,this.hook.size.x-3,3,"default",2,9);this.type!=sc.MENU_BAR_TYPE.BUFF&&a.addGfx(this.backgroundPatch.gfx,this.hook.size.x-46,0,80,408,8,8);switch(this.type){case sc.MENU_BAR_TYPE.HP:d="hp";break;case sc.MENU_BAR_TYPE.EXP:d="exp";break;case sc.MENU_BAR_TYPE.BUFF:d=
"buff"}if(this.targetValue>0){if(this.targetValue<this.currentValue){c=this.currentValue/this.maxValue;b=this.targetValue/this.maxValue;e="bg"}else{c=this.targetValue/this.maxValue;b=this.currentValue/this.maxValue;e="fg"}this.type==sc.MENU_BAR_TYPE.HP&&(d=b>0.25?"hp":"red")}for(var f=this.barHeight||(this.type!=sc.MENU_BAR_TYPE.BUFF?4:3),g=0;g<f;g++){c&&(this.targetValue!=this.currentValue&&this.type==sc.MENU_BAR_TYPE.HP)&&this.barPatch.draw(a,Math.round(c.limit(0,1)*(this.hook.size.x-7)),1,e,2+
g,9+g);b>0&&this.barPatch.draw(a,this.type==sc.MENU_BAR_TYPE.BUFF?Math.round(b.limit(0,1)*(this.hook.size.x-6)):Math.round(b.limit(0,1)*(this.hook.size.x-(this.barHeight==3?6:7))),1,d,2+g,9+g)}}},_drawSpBarMinified:function(a){var b=this.backgroundPatch.gfx,c=this.model.params.maxSp,c=16;this.backgroundPatch.draw(a,this.hook.size.x-4,4,"spm",2,9);a.addGfx(b,this.hook.size.x-46,0,80,408,8,8);for(var b=6,d=0;d<c;d++){a.addColor(d+1>c/2?SP_REG_COLOR:SP_NORMAL_COLOR,b,10,3,2);b=(d+1)%4==0?b+6:b+4}},_drawSpBar:function(c){var e=
this.backgroundPatch.gfx,f=this.model.params,g=f.maxSp,h=g*sc.SP_REGEN_FACTOR,i=f.currentSp,f=Math.floor(i);this.barHeight==3?this.backgroundPatch.draw(c,this.hook.size.x-4,4,"spm",2,9):this.backgroundPatch.draw(c,this.hook.size.x-4,6,"sp",2,9);c.addGfx(e,this.hook.size.x-46,0,80,408,8,8);this.barHeight==3?c.addGfx(e,2,9,560,160+(i<1?16:0),6,4):c.addGfx(e,2,9,144,480+(i<1?16:0),6,6);d.posX=8;d.sp=0;d.barFilled=Math.min(4,f);d.regenFilled=Math.min(4,h);for(i=this.barHeight==3?a:b;d.sp+1<=f;){var j=
d.sp?void 0:0;if(d.barFilled==4&&(d.regenFilled==4||d.regenFilled==0))i(c,e,d,j,void 0,true,d.regenFilled==4);else if(d.regenFilled>0&&d.regenFilled<d.barFilled){var k=d.barFilled==4?void 0:d.barFilled;i(c,e,d,j,d.regenFilled,true,true);i(c,e,d,d.regenFilled,k,true,false)}else i(c,e,d,j,d.barFilled,true,d.regenFilled>0);d.sp=d.sp+d.barFilled;if(d.barFilled==4){d.barFilled=Math.min(4,f-d.sp);d.regenFilled=(h-d.sp).limit(0,4)}}if(d.sp%4!=0){if(d.regenFilled>d.barFilled&&d.regenFilled<4){i(c,e,d,d.barFilled,
d.regenFilled,false,true);d.barFilled=d.regenFilled}i(c,e,d,d.barFilled,void 0,false,d.regenFilled==4);d.sp=Math.ceil(d.sp/4)*4}for(;d.sp<g;){d.regenFilled=(h-d.sp).limit(0,4);if(d.regenFilled==4||d.regenFilled==0)i(c,e,d,void 0,void 0,false,d.regenFilled==4,f);else{i(c,e,d,void 0,d.regenFilled,false,true);i(c,e,d,d.regenFilled,void 0,false,false)}d.sp=d.sp+4}}});var c=144,e=480,f=6,g=5,h=2,i=16,j=8,k=6,l=560,o=160,m=6,n=3,p=2,r=10,t=5,q=4;sc.ItemStatusDefault=sc.MenuPanel.extend({menuGfx:new ig.Image("media/gui/menu.png"),
statusGfx:new ig.Image("media/gui/status-gui.png"),level:null,hpBar:null,spBar:null,expBar:null,skinGfx:null,bounds:null,init:function(){this.parent(sc.MenuPanelType.TOP_RIGHT_EDGE);this.setSize(126,95);this.setPos(sc.options.hdMode?25:2,28);this.hook.transitions={DEFAULT:{state:{},time:0.2,timeFunction:KEY_SPLINES.LINEAR},HIDDEN:{state:{alpha:0,offsetX:-(126+(sc.options.hdMode?25:3))},time:0.2,timeFunction:KEY_SPLINES.LINEAR}};this.level=new sc.NumberGui(99,{size:sc.NUMBER_SIZE.LARGE});this.level.setAlign(ig.GUI_ALIGN.X_RIGHT,
ig.GUI_ALIGN.Y_TOP);this.level.setPos(3,2);this.addChildGui(this.level);this.hpBar=new sc.ItemStatusDefaultBar("HP",sc.MENU_BAR_TYPE.HP);this.hpBar.setPos(0,39);this.addChildGui(this.hpBar);this.hpBar.updateValues(true);this.hpBar.annotation={size:{x:this.hpBar.hook.size.x+2,y:this.hpBar.hook.size.y+2},offset:{x:-1,y:-1},content:{title:"sc.gui.menu.help.item.titles.hp",description:"sc.gui.menu.help.item.description.hp"},index:{x:0,y:0}};this.spBar=new sc.ItemStatusDefaultBar("SP",sc.MENU_BAR_TYPE.SP);
this.spBar.setPos(0,57);this.addChildGui(this.spBar);this.spBar.updateValues(true);this.spBar.annotation={size:{x:this.spBar.hook.size.x+2,y:this.spBar.hook.size.y+2},offset:{x:-1,y:-1},content:{title:"sc.gui.menu.help.item.titles.sp",description:"sc.gui.menu.help.item.description.sp"},index:{x:0,y:1}};this.expBar=new sc.ItemStatusDefaultBar("EXP",sc.MENU_BAR_TYPE.EXP);this.expBar.setPos(0,77);this.addChildGui(this.expBar);this.expBar.updateValues(true);this.expBar.annotation={size:{x:this.expBar.hook.size.x+
2,y:this.expBar.hook.size.y+2},offset:{x:-1,y:-1},content:{title:"sc.gui.menu.help.item.titles.exp",description:"sc.gui.menu.help.item.description.exp"},index:{x:0,y:2}};this.doStateTransition("HIDDEN",true)},updateDrawables:function(a){this.parent(a);a.addGfx(this.menuGfx,0,0,280,472,126,35);this.skinGfx&&this.bounds?a.addGfx(this.skinGfx,0,0,this.bounds.x,this.bounds.y,this.bounds.w,this.bounds.h):a.addGfx(this.menuGfx,0,0,211,26,60,34);a.addGfx(this.statusGfx,64,5,104,32+sc.model.player.currentElementMode*
24,24,24)},addObservers:function(){sc.Model.addObserver(sc.menu,this);sc.Model.addObserver(sc.model.player,this);sc.Model.addObserver(sc.model.player.params,this);sc.Model.addObserver(sc.playerSkins,this)},removeObservers:function(){sc.Model.removeObserver(sc.menu,this);sc.Model.removeObserver(sc.model.player,this);sc.Model.removeObserver(sc.model.player.params,this);sc.Model.removeObserver(sc.playerSkins,this)},showMenu:function(){this.checkSkin();this._updateElements(true);!sc.menu.isItemEquipTab()&&
sc.menu.itemCurrentTab!=6&&this.doStateTransition("DEFAULT")},exitMenu:function(){this.doStateTransition("HIDDEN")},checkSkin:function(){var a=sc.playerSkins.getCurrentSkin("Appearance");if(a&&a.loaded){this.skinGfx=a.guiImage;this.bounds=a.guiImageBounds?a.guiImageBounds.face||null:null}else this.bounds=this.skinGfx=null},modelChanged:function(a,b){a==sc.menu?b==sc.MENU_EVENT.ITEM_CHANGED_TAB&&(!sc.menu.isItemEquipTab()&&sc.menu.itemCurrentTab!=6?this.doStateTransition("DEFAULT"):this.doStateTransition("HIDDEN")):
a==sc.model.player?(b==sc.PLAYER_MSG.LEVEL_CHANGE||b==sc.PLAYER_MSG.EXP_CHANGE||b==sc.PLAYER_MSG.ELEMENT_MODE_CHANGE)&&this._updateElements():a==sc.model.player.params?(b==sc.COMBAT_PARAM_MSG.BUFF_ADDED||b==sc.COMBAT_PARAM_MSG.HP_CHANGED||b==sc.COMBAT_PARAM_MSG.SP_CHANGED||b==sc.COMBAT_PARAM_MSG.STATS_CHANGED)&&this._updateElements():a==sc.playerSkins&&this.checkSkin()},_updateElements:function(a){this.level.setNumber(sc.model.player.level);this.hpBar.updateValues(a);this.expBar.updateValues(a);this.spBar.updateValues(a)}})});
ig.baked=!0;
ig.module("game.feature.menu.gui.item.item-status-buffs").requires("impact.feature.gui.gui","impact.feature.gui.base.basic-gui","game.feature.menu.gui.menu-misc","game.feature.menu.gui.item.item-status-default").defines(function(){sc.ItemStatusBuffs=sc.HeaderMenuPanel.extend({gfx:new ig.Image("media/gui/basic.png"),maxBuffs:null,currentBuffs:null,_removeStartIndex:3,init:function(){this.parent(ig.lang.get("sc.gui.menu.item.buff"),sc.MenuPanelType.TOP_RIGHT_EDGE);this.setSize(126,83);this.setPos(sc.options.hdMode?25:
2,127);this.hook.transitions={DEFAULT:{state:{},time:0.2,timeFunction:KEY_SPLINES.LINEAR},HIDDEN:{state:{alpha:0,offsetX:-(126+(sc.options.hdMode?25:3))},time:0.2,timeFunction:KEY_SPLINES.LINEAR}};var b=sc.model.player.params,a={size:sc.NUMBER_SIZE.TINY,color:sc.GUI_NUMBER_COLOR.GREY};this.maxBuffs=new sc.NumberGui(4,a);this.maxBuffs.setAlign(ig.GUI_ALIGN.X_RIGHT,ig.GUI_ALIGN.Y_TOP);this.maxBuffs.setPos(6,2);this.maxBuffs.setNumber(b.getMaxBuffs());this.addChildGui(this.maxBuffs);this.currentBuffs=
new sc.NumberGui(4,a);this.currentBuffs.setAlign(ig.GUI_ALIGN.X_RIGHT,ig.GUI_ALIGN.Y_TOP);this.currentBuffs.setPos(20,2);this.currentBuffs.setNumber(b.currentItemBuffs);this.addChildGui(this.currentBuffs);b=new ig.ImageGui(this.gfx,208,18,5,5);b.setAlign(ig.GUI_ALIGN.X_RIGHT,ig.GUI_ALIGN.Y_TOP);b.setPos(14,2);this.addChildGui(b);this.doStateTransition("HIDDEN",true)},addObservers:function(){sc.Model.addObserver(sc.menu,this);sc.Model.addObserver(sc.model.player.params,this)},removeObservers:function(){sc.Model.removeObserver(sc.menu,
this);sc.Model.removeObserver(sc.model.player.params,this)},showMenu:function(){this._createBuffs();this.maxBuffs.setNumber(sc.model.player.params.getMaxBuffs());sc.menu.getCurrentTabType()==sc.ITEMS_TYPES.CONS&&this.doStateTransition("DEFAULT")},exitMenu:function(){this.doStateTransition("HIDDEN")},modelChanged:function(b,a){if(b==sc.menu)a==sc.MENU_EVENT.ITEM_CHANGED_TAB&&(sc.menu.getCurrentTabType()==sc.ITEMS_TYPES.CONS?this.doStateTransition("DEFAULT"):this.doStateTransition("HIDDEN"));else if(b==
sc.model.player.params&&a==sc.COMBAT_PARAM_MSG.STATS_CHANGED){this.maxBuffs.setNumber(b.getMaxBuffs());this.currentBuffs.setNumber(b.currentItemBuffs);this._createBuffs()}},_createBuffs:function(){for(var b=this.hook.children.slice(this._removeStartIndex,this.hook.children.length-this._removeStartIndex),a=b.length;a--;){b[a].onDetach();b[a].removeAfterTransition=false}for(var b=sc.model.player.params.buffs,d=null,d=null,c=12,a=0;a<b.length;a++)if(d=sc.inventory.getItem(b[a].itemID)){d=new sc.ItemStatusDefaultBar(ig.LangLabel.getText(d.name),
sc.MENU_BAR_TYPE.BUFF,b[a]);d.setPos(0,c);d.updateValues(true);c=c+18;this.addChildGui(d)}}});sc.ItemBuffHelp=ig.GuiElementBase.extend({gfx:new ig.Image("media/gui/menu.png"),transitions:{DEFAULT:{state:{},time:0.2,timeFunction:KEY_SPLINES.LINEAR},HIDDEN:{state:{alpha:0,offsetX:-10},time:0.2,timeFunction:KEY_SPLINES.LINEAR}},init:function(){this.parent();this.setAlign(ig.GUI_ALIGN.X_LEFT,ig.GUI_ALIGN.Y_BOTTOM);this.setPos(25,37);var b=new ig.ImageGui(this.gfx,480,336,10,9);b.setPos(0,6);this.addChildGui(b);
b=new sc.TextGui("\\i[help]");b.setPos(12,0);this.addChildGui(b);b=new sc.TextGui(ig.lang.get("sc.gui.menu.item.buffHelp"),{font:sc.fontsystem.smallFont});b.setPos(26,2);this.addChildGui(b);this.doStateTransition("HIDDEN",true)},addObservers:function(){sc.Model.addObserver(sc.menu,this)},removeObservers:function(){sc.Model.removeObserver(sc.menu,this)},showMenu:function(){this.store=false;sc.options.get("buff-help")&&this.doStateTransition("DEFAULT")},exitMenu:function(b){if(b&&this.hook.currentStateName==
"DEFAULT")this.store=true;this.doStateTransition("HIDDEN")},modelChanged:function(b,a,d){if(b==sc.menu)if(a==sc.MENU_EVENT.ITEM_CHANGED_TAB)this.doStateTransition("HIDDEN");else if(a==sc.MENU_EVENT.SET_BUFF_INFO)if(sc.menu.getCurrentTabType()==sc.ITEMS_TYPES.CONS&&sc.options.get("buff-help")){d=d||false;sc.menu.buffText?this.doStateTransition("DEFAULT"):this.doStateTransition("HIDDEN",false,false,null,d?0.5:0)}else this.doStateTransition("HIDDEN")}})});ig.baked=!0;
ig.module("game.feature.menu.gui.item.item-status-favs").requires("impact.feature.gui.gui","impact.feature.gui.base.basic-gui","game.feature.menu.gui.menu-misc","game.feature.player.player-model").defines(function(){sc.FavoriteElementGui=ig.GuiElementBase.extend({gfx:new ig.Image("media/gui/menu.png"),text:null,id:-1,init:function(){this.parent();this.setSize(19,19);this.text=new sc.TextGui("");this.text.setPos(2,1);this.addChildGui(this.text)},setItem:function(b){this.id=b||-1;if(this.id>=0){b=sc.inventory.getItem(this.id);
this.text.setText("\\i["+b.icon+sc.inventory.getRaritySuffix(b.rarity)+"]")}else this.text.setText("")},updateDrawables:function(b){this.id>=0?b.addGfx(this.gfx,0,0,213,480,19,19):b.addGfx(this.gfx,0,0,192,480,19,19)}});sc.ItemStatusFavorites=sc.HeaderMenuPanel.extend({gfx:new ig.Image("media/gui/menu.png"),line:new ig.Image("media/gui/basic.png"),maxFavs:null,currentFavs:null,_favs:[],init:function(){this.parent(ig.lang.get("sc.gui.menu.item.favs"),sc.MenuPanelType.TOP_RIGHT_EDGE);this.setSize(126,
63);this.setPos(sc.options.hdMode?25:2,214);this.hook.transitions={DEFAULT:{state:{},time:0.2,timeFunction:KEY_SPLINES.LINEAR},HIDDEN:{state:{alpha:0,offsetX:-(126+(sc.options.hdMode?25:3))},time:0.2,timeFunction:KEY_SPLINES.LINEAR}};var b=sc.model.player,a={size:sc.NUMBER_SIZE.TINY,color:sc.GUI_NUMBER_COLOR.GREY};this.maxFavs=new sc.NumberGui(12,a);this.maxFavs.setAlign(ig.GUI_ALIGN.X_RIGHT,ig.GUI_ALIGN.Y_TOP);this.maxFavs.setPos(6,2);this.maxFavs.setNumber(sc.ITEM_MAX_FAVS);this.addChildGui(this.maxFavs);
this.currentFavs=new sc.NumberGui(12,a);this.currentFavs.setAlign(ig.GUI_ALIGN.X_RIGHT,ig.GUI_ALIGN.Y_TOP);this.currentFavs.setPos(24,2);this.currentFavs.setNumber(b.itemFavs.length);this.addChildGui(this.currentFavs);b=new ig.ImageGui(this.line,208,18,5,5);b.setAlign(ig.GUI_ALIGN.X_RIGHT,ig.GUI_ALIGN.Y_TOP);b.setPos(18,2);this.addChildGui(b);for(var a=4,d=15,c=0;c<sc.ITEM_MAX_FAVS;c++){b=new sc.FavoriteElementGui;b.setPos(a,d);a=a+20;if((c+1)%6==0){a=5;d=d+23}this._favs.push(b);this.addChildGui(b);
var e=c%6,f=Math.floor(c/6)+4;b.annotation={size:{x:12,y:12},offset:{x:3,y:4},content:{id:c,title:function(a){a=sc.model.player.itemFavs[a.id];return a>=-1?sc.inventory.getItemName(a):ig.lang.get("sc.gui.menu.help.item.titles.favs")}.bind(this),description:function(a){a=sc.model.player.itemFavs[a.id];return a>=-1?sc.inventory.getItemDescription(a):ig.lang.get("sc.gui.menu.help.item.description.favs")}.bind(this)},index:{x:e,y:f}}}this.doStateTransition("HIDDEN",true)},addObservers:function(){sc.Model.addObserver(sc.menu,
this);sc.Model.addObserver(sc.model.player,this)},removeObservers:function(){sc.Model.removeObserver(sc.menu,this);sc.Model.removeObserver(sc.model.player,this)},showMenu:function(){if(sc.menu.getCurrentTabType()==sc.ITEMS_TYPES.CONS){this.updateFavorites();this.doStateTransition("DEFAULT")}},exitMenu:function(){this.doStateTransition("HIDDEN")},updateFavorites:function(){var b=sc.model.player.itemFavs;this.currentFavs.setNumber(b.length,true);for(var a=0;a<this._favs.length;a++)this._favs[a].setItem(b[a])},
modelChanged:function(b,a){b==sc.menu?a==sc.MENU_EVENT.ITEM_CHANGED_TAB&&(sc.menu.getCurrentTabType()==sc.ITEMS_TYPES.CONS?this.doStateTransition("DEFAULT"):this.doStateTransition("HIDDEN")):b==sc.model.player&&a==sc.PLAYER_MSG.ITEM_FAVORITES_CHANGED&&this.updateFavorites()}})});ig.baked=!0;
ig.module("game.feature.menu.gui.item.item-status-trade").requires("impact.feature.gui.gui","impact.feature.gui.base.basic-gui","game.feature.menu.gui.menu-misc","game.feature.menu.gui.item.item-status-default").defines(function(){sc.ItemStatusTrade=sc.HeaderMenuPanel.extend({gfx:new ig.Image("media/gui/basic.png"),content:null,init:function(){this.parent(ig.lang.get("sc.gui.menu.item.availability"),sc.MenuPanelType.TOP_RIGHT_EDGE);this.setSize(136,264);this.setPos(sc.options.hdMode?25:2,28);this.hook.transitions=
{DEFAULT:{state:{},time:0.2,timeFunction:KEY_SPLINES.LINEAR},HIDDEN:{state:{alpha:0,offsetX:-(136+(sc.options.hdMode?25:3))},time:0.2,timeFunction:KEY_SPLINES.LINEAR}};this.annotation={size:{x:this.hook.size.x+2,y:this.hook.size.y+2},offset:{x:-1,y:-1},content:{title:"sc.gui.menu.help.item.titles.avail",description:"sc.gui.menu.help.item.description.avail"},index:{x:0,y:3}};this.content=new ig.GuiElementBase;this.content.setSize(124,140);this.content.setPos(1,10);this.addChildGui(this.content);this.doStateTransition("HIDDEN",
true)},addObservers:function(){sc.Model.addObserver(sc.menu,this)},removeObservers:function(){sc.Model.removeObserver(sc.menu,this)},showMenu:function(){sc.menu.getCurrentTabType()==sc.ITEMS_TYPES.TRADE&&this.doStateTransition("DEFAULT")},exitMenu:function(){this.doStateTransition("HIDDEN")},modelChanged:function(a,b,e){a==sc.menu&&(b==sc.MENU_EVENT.ITEM_CHANGED_TAB?sc.menu.getCurrentTabType()==sc.ITEMS_TYPES.TRADE?this.doStateTransition("DEFAULT"):this.doStateTransition("HIDDEN"):b==sc.MENU_EVENT.ITEM_INFO_CHANGED?
this._setTradeInfo(e):b==sc.MENU_EVENT.INFO_TEXT_CHANGED&&(a.infoText||this._setTradeInfo()))},_setTradeInfo:function(a){this.content.removeAllChildren();if(a){var c=sc.inventory.getItem(a).sources;if(c&&c.length!=0)for(var e=0,f=0;f<c.length;f++){var g=c[f],g=b[g.type]?new b[g.type](g,a):new sc.ItemStatusTrade.BaseEntryType(g,a);g.setPos(0,e);e=e+(g.hook.size.y+1);this.content.addChildGui(g)}}}});var b={},a={ENEMY:0,TRADER:1,PLANT:2,QUEST:3,CHEST:5,OTHER:4};sc.ItemStatusTrade.BaseEntryType=ig.GuiElementBase.extend({gfx:new ig.Image("media/gui/menu.png"),
tradeGfx:new ig.Image("media/gui/trade-types.png"),transitions:{DEFAULT:{state:{},time:0.2,timeFunction:KEY_SPLINES.LINEAR},HIDDEN:{state:{alpha:0},time:0.2,timeFunction:KEY_SPLINES.LINEAR}},type:null,itemID:null,textEntry:null,subEntry:null,tradeIcon:null,init:function(b,c,e,f){this.parent();this.setSize(134,18);this.type=b.type||"NONE";this.itemID=c||0;this.tradeIcon=new ig.ImageGui(this.tradeGfx,a[this.type]*28,0,28,18);this.addChildGui(this.tradeIcon);b=new ig.ImageGui(this.gfx,81,389,95,1);b.setAlign(ig.GUI_ALIGN.X_LEFT,
ig.GUI_ALIGN.Y_BOTTOM);b.setPos(47,0);this.addChildGui(b);b=new ig.ColorGui("#C7C7C7",19,1);b.setAlign(ig.GUI_ALIGN.X_LEFT,ig.GUI_ALIGN.Y_BOTTOM);b.setPos(28,0);this.addChildGui(b);this.textEntry=new sc.TextGui("",{font:sc.fontsystem.tinyFont,maxWidth:f?0:103});this.textEntry.setAlign(ig.GUI_ALIGN.X_LEFT,ig.GUI_ALIGN.Y_TOP);this.textEntry.setPos(30,0);this.addChildGui(this.textEntry);this.subEntry=new sc.TextGui("",{font:sc.fontsystem.tinyFont});this.subEntry.setAlign(ig.GUI_ALIGN.X_LEFT,ig.GUI_ALIGN.Y_TOP);
this.subEntry.setPos(43,9);this.addChildGui(this.subEntry);e&&this.addArrow()},addArrow:function(){var a=new ig.ImageGui(this.gfx,530,210,9,8);a.setPos(32,8);this.addChildGui(a)},setIcon:function(b){this.tradeIcon.setImage(this.tradeGfx,a[b]*28,0,28,18)}});b.ENEMY=sc.ItemStatusTrade.BaseEntryType.extend({init:function(a,b){this.parent(a,b,true);var e=a.value,f=sc.stats.getMap("combat","kill"+e);this.textEntry.setText(f>=1?sc.combat.getEnemyName(e):"???");this.subEntry.setText(f>=1?sc.combat.getEnemyArea(e,
true):"???")}});b.TRADER=sc.ItemStatusTrade.BaseEntryType.extend({init:function(a,b){this.parent(a,b,true);var e=a.value,f=sc.trade.getFoundTrader(e);this.textEntry.setText(f?sc.trade.getTraderName(e):"???");this.subEntry.setText(f?sc.trade.getTraderAreaName(e,true):"???")}});b.PLANT=sc.ItemStatusTrade.BaseEntryType.extend({init:function(a,b){this.parent(a,b,true,true);var e=a.value,f=sc.menu.getFoundDrop(e);this.textEntry.setText(f?sc.menu.getDropName(e):"???");this.subEntry.setText(f?sc.menu.getDropArea(e):
"???")}});b.QUEST=sc.ItemStatusTrade.BaseEntryType.extend({init:function(a,b){this.parent(a,b);this.textEntry.setText(sc.quests.getQuestName(a.value));this.textEntry.setAlign(ig.GUI_ALIGN.X_LEFT,ig.GUI_ALIGN.Y_CENTER)}});b.CHEST=sc.ItemStatusTrade.BaseEntryType.extend({init:function(a,b){this.parent(a,b);var e=sc.map.getVisitedArea(a.value)||false;this.textEntry.setText(e?sc.map.getAreaName(a.value):"???");this.textEntry.setAlign(ig.GUI_ALIGN.X_LEFT,ig.GUI_ALIGN.Y_CENTER)}});b.OTHER=sc.ItemStatusTrade.BaseEntryType.extend({init:function(a,
b){this.parent(a,b);var e=a.value;this.textEntry.setText(ig.LangLabel.getText(e.text));e.icon&&this.setIcon(e.icon);e.subText?this.subEntry.setText(ig.LangLabel.getText(e.subText)):this.textEntry.setAlign(ig.GUI_ALIGN.X_LEFT,ig.GUI_ALIGN.Y_CENTER);e.arrow&&this.addArrow()}})});ig.baked=!0;
ig.module("game.feature.menu.gui.item.item-sort-menu").requires("impact.feature.gui.gui","impact.feature.gui.base.basic-gui","impact.feature.gui.base.box").defines(function(){sc.SortMenu=ig.BoxGui.extend({ninepatch:new ig.NinePatch("media/gui/menu.png",{width:8,height:8,left:8,top:8,right:8,bottom:8,offsets:{"default":{x:480,y:304}}}),transitions:{HIDDEN:{state:{alpha:0,scaleX:0.2,scaleY:0},time:0.2,timeFunction:KEY_SPLINES.LINEAR},DEFAULT:{state:{},time:0.2,timeFunction:KEY_SPLINES.EASE}},buttongroup:null,
buttons:[],active:false,yPosition:3,callback:null,backCallback:null,currentSortingText:null,init:function(b,a,d){d=d||102;this.parent(d,85);this.setPivot(d,0);this.setAlign(ig.GUI_ALIGN.X_RIGHT,ig.GUI_ALIGN.Y_TOP);this.callback=b;this.backCallback=a;this.hook.zIndex=1500;this.hook.pauseGui=true;this.hook.screenBlocking=true;this.buttongroup=new sc.ButtonGroup(false,ig.BUTTON_GROUP_SELECT_TYPE.VERTICAL);this.buttongroup.addPressCallback(function(a){this.currentSortingText=a.name;this.callback&&this.callback(a)}.bind(this));
this.buttongroup.addSelectionCallback(function(a){a.data&&a.data.description&&sc.menu.setInfoText(a.data.description?a.data.description:a.data)}.bind(this));this.buttongroup.setMouseFocusLostCallback(function(){sc.menu.setInfoText("",true)}.bind(this));this.doStateTransition("HIDDEN",true)},addButton:function(b,a,d){this.yPosition=this._createButton(b,a,this.yPosition,d);this.hook.size.y=this.yPosition+2},setButtonKey:function(b,a){this.buttons[b].setText(ig.lang.get("sc.gui.menu.sort."+a),true);
this.buttons[b].data.description=ig.lang.get("sc.gui.menu.sort.des."+a)},showSortMenu:function(b){this.showSortMenuAt(b.hook.pos.x,b.hook.size.y)},showSortMenuAt:function(b,a){if(!this.active){sc.menu.pushBackCallback(this.onBackButtonPress.bind(this));sc.menu.buttonInteract.pushButtonGroup(this.buttongroup);this.setPos(b,a);this.active=true;this.doStateTransition("DEFAULT")}},hideSortMenu:function(){if(this.active){sc.menu.popBackCallback();sc.menu.buttonInteract.removeButtonGroup(this.buttongroup);
this.active=false;this.doStateTransition("HIDDEN",false,true)}},onBackButtonPress:function(){this.hideSortMenu();this.backCallback&&this.backCallback()},_createButton:function(b,a,d,c){var e=new sc.ButtonGui(ig.lang.get("sc.gui.menu.sort."+b),this.hook.size.x-6,true,sc.BUTTON_TYPE.ITEM);e.textChild.setPos(0,0);e.textChild.setAlign(ig.GUI_ALIGN.X_CENTER,ig.GUI_ALIGN.Y_CENTER);e.setData({sortType:a,description:ig.lang.get("sc.gui.menu.sort.des."+b),name:e.text});e.setPos(3,d);this.buttongroup.addFocusGui(e,
0,c);if(this.buttons.length==0)this.currentSortingText=e.text;this.buttons[c]=e;this.addChildGui(e);return d=d+e.hook.size.y}});sc.ItemSortMenu=sc.SortMenu.extend({init:function(){this.parent(this.onButtonPress.bind(this));this.addButton("auto",sc.SORT_TYPE.ORDER,0);this.addButton("name",sc.SORT_TYPE.NAME,1);this.addButton("amount",sc.SORT_TYPE.AMOUNT,2);this.addButton("rarity",sc.SORT_TYPE.RARITY,3)},onButtonPress:function(b){if(b.data){this.hideSortMenu();sc.menu.sortList(b)}}})});ig.baked=!0;
ig.module("game.feature.menu.gui.item.item-list").requires("impact.feature.gui.gui","impact.feature.gui.base.basic-gui","impact.feature.gui.base.box","game.feature.gui.base.text","game.feature.menu.gui.menu-misc","game.feature.menu.gui.list-boxes","game.feature.menu.gui.item.item-sort-menu").defines(function(){sc.ItemTabbedBox=ig.GuiElementBase.extend({gfx:new ig.Image("media/gui/menu.png"),list:null,tabs:{news:null,items:null,arms:null,head:null,torso:null,feet:null,trade:null,keys:null},sortTypes:{},
tabArray:[],buttonGroup:null,tabGroup:null,submitSound:null,favSound:null,errorSound:null,toggleOnSound:null,toggleOffSound:null,_prevPressed:null,_refocusFromCycle:-1,_lastCursorPos:[],_bgRev:null,_curElement:-1,init:function(){this.parent();this.setSize(340,260);this.setAlign(ig.GUI_ALIGN.X_RIGHT,ig.GUI_ALIGN.Y_TOP);this.setPos(sc.options.hdMode?25:2,27);this.favSound=this.submitSound=sc.BUTTON_SOUND.submit;this.errorSound=sc.BUTTON_SOUND.denied;this.toggleOnSound=sc.BUTTON_SOUND.toggle_on;this.toggleOffSound=
sc.BUTTON_SOUND.toggle_off;this.hook.transitions={DEFAULT:{state:{},time:0.2,timeFunction:KEY_SPLINES.LINEAR},HIDDEN:{state:{alpha:0,offsetX:-(340/3+(sc.options.hdMode?25:3))},time:0.2,timeFunction:KEY_SPLINES.LINEAR}};this.tabGroup=new sc.ButtonGroup;this.tabGroup.addPressCallback(function(a){if(this._prevPressed!=a){this.submitSound.play();this._prevPressed=a;a.setPressed(true);this._resetButtons(a);this._rearrangeTabs();sc.menu.itemLastButtonData=a.data;for(var b=this.tabArray.length;b--;)if(a==
this.tabArray[b]){sc.menu.setItemTab(b);break}}}.bind(this));this.tabGroup.addSelectionCallback(function(){sc.menu.setInfoText("");sc.menu.setBuffText("",true)});this.tabGroup.setMouseFocusLostCallback(function(){sc.menu.setInfoText("",true);sc.menu.setBuffText("",true)});var b=new sc.MenuPanel;b.setSize(340,244);b.setPos(0,21);this.addChildGui(b);this.list=new sc.MultiColumnItemListBox(1,168,sc.LIST_COLUMNS.TWO,1);this.list.setPos(0,29);this.list.setSize(340,230);this.list.setSelectState("HIDDEN",
true);this.list.list.onGetHeightAtIndex=this.onGetHeightAtIndex.bind(this);this.addChildGui(this.list);this._bgRev=this.list.buttonGroup();this._bgRev.isNonMouseMenuInput=this.isNonMouseMenuInput.bind(this);this._bgRev.addSelectionCallback(function(a){if(a.data){this._curElement=a;sc.menu.setInfoText(a.data.description?a.data.description:a.data);if(a.data.id){sc.menu.setItemInfo(a.data.id);var b=sc.inventory.getItemName(a.data.id)+" [Description]";ig.langEdit.submitCustomFile(b,new ig.LangLabel(sc.inventory.getItem(a.data.id).description),
"data/item-database.json",true);sc.inventory.isBuffID(a.data.id)?sc.menu.setBuffText(sc.inventory.getBuffString(a.data.id),false,a.data.id):sc.menu.setBuffText("",false)}}}.bind(this));this._bgRev.addPressCallback(this.onItemButtonPressed.bind(this));this._bgRev.setMouseFocusLostCallback(function(){sc.menu.setInfoText("",true);sc.menu.setBuffText("",true);this._curElement=null}.bind(this));this._bgRev.onButtonTraversal=this.onButtonTraversal.bind(this);b=new ig.ImageGui(this.gfx,32,408,5,5);b.setPos(0,
21);this.addChildGui(b);b=new ig.ColorGui("#FF6D00",335,1);b.setPos(5,21);this.addChildGui(b);this.tabs.news=this._createTabButton("news","item-news",0,"NEW");this.tabs.items=this._createTabButton("items","item-items",1,sc.ITEMS_TYPES.CONS);this.tabs.arms=this._createTabButton("arms","item-sword",2,sc.ITEMS_TYPES.EQUIP,sc.ITEMS_EQUIP_TYPES.ARM);this.tabs.head=this._createTabButton("head","item-helm",3,sc.ITEMS_TYPES.EQUIP,sc.ITEMS_EQUIP_TYPES.HEAD);this.tabs.torso=this._createTabButton("torso","item-belt",
4,sc.ITEMS_TYPES.EQUIP,sc.ITEMS_EQUIP_TYPES.TORSO);this.tabs.feet=this._createTabButton("feet","item-shoe",5,sc.ITEMS_TYPES.EQUIP,sc.ITEMS_EQUIP_TYPES.FEET);this.tabs.trade=this._createTabButton("trade","item-trade",6,sc.ITEMS_TYPES.TRADE);this.tabs.keys=this._createTabButton("keys","item-key",7,sc.ITEMS_TYPES.KEY);if(sc.model.player.hasAnyToggleItems())this.tabs.toggle=this._createTabButton("toggle","item-toggle",8,sc.ITEMS_TYPES.TOGGLE);sc.menu.itemLastButtonData=this.tabs.items.data;for(b=0;b<
this.tabArray.length;b++)this._lastCursorPos[b]={x:0,y:0,scroll:0};this.tabGroup.setCurrentFocus(1,0);this.tabs.items.setPressed(true);this._prevPressed=this.tabs.items;this._rearrangeTabs();this.doStateTransition("HIDDEN",true)},addObservers:function(){sc.Model.addObserver(sc.menu,this)},removeObservers:function(){sc.Model.removeObserver(sc.menu,this)},showMenu:function(){sc.menu.buttonInteract.addParallelGroup(this.tabGroup);this._refocusFromCycle=-1;ig.interact.setBlockDelay(0.2);var b=sc.menu.itemLastButtonData;
if(b){this._refocusFromCycle=sc.menu.itemCurrentTab;this._createList(b.type,b.subType,true,ig.input.mouseGuiActive,true)}this.list.activate();this.doStateTransition("DEFAULT")},exitMenu:function(){sc.menu.buttonInteract.removeParallelGroup(this.tabGroup);var b=sc.menu.itemCurrentTab;this._lastCursorPos[b].x=this._bgRev.current.x;this._lastCursorPos[b].y=this._bgRev.current.y;this._lastCursorPos[b].scroll=this.list.list.box.hook.scroll.y;this.list.deactivate();sc.menu.setInfoText("",false);sc.menu.setBuffText("",
false);this.doStateTransition("HIDDEN")},setFavorite:function(){if(this._curElement&&sc.menu.itemCurrentTab==1)if(sc.model.player.canAddFavorite()||sc.model.player.isFavorite(this._curElement.data.id)){this.favSound&&this.favSound.play();sc.model.player.updateFavorite(this._curElement.data.id)?this._addFavoriteOverlay(this._curElement):this._removeFavoriteOverlay(this._curElement)}else this.errorSound.play();else{this.submitSound.play();var b=ig.lang.get("sc.gui.menu.help-texts.inventory.title-2")+
"\n\n"+ig.lang.get("sc.gui.menu.help-texts.inventory.text-2"),b=new sc.CenterMsgBoxGui(b,{maxWidth:300,speed:ig.TextBlock.SPEED.IMMEDIATE},"black",0.9);b.hook.zIndex=15E4;b.hook.pauseGui=true;ig.gui.addGuiElement(b)}},onGetHeightAtIndex:function(b,a){if(sc.menu.itemCurrentTab!=8)return b.getHeightAtIndex(a,true);var d=this._bgRev.getYElementAt(a);d||(d=this._bgRev.getElementAt(this._bgRev.current.x-1,a));var c=0;a>=0&&d&&(c=c+(d.setGui.hook.pos.y+d.hook.pos.y+d.hook.size.y));return c},isNonMouseMenuInput:function(){return sc.control.menuConfirm()||
sc.control.rightDown()||sc.control.leftDown()||sc.control.downDown()||sc.control.upDown()||sc.control.menuCircleLeft()||sc.control.menuCircleRight()},onButtonTraversal:function(){if(sc.menu.itemCurrentTab==-1)sc.menu.itemCurrentTab=1;var b=sc.menu.itemCurrentTab,a=this.tabArray[b],d=-1;sc.control.menuCircleRight()?d=1:sc.control.menuCircleLeft()&&(d=0);if(d>=0){this.submitSound.play();a.setPressed(false);this._lastCursorPos[b].x=this._bgRev.current.x;this._lastCursorPos[b].y=this._bgRev.current.y;
this._lastCursorPos[b].scroll=this.list.list.box.hook.scroll.y;if(d==1){b++;b>=this.tabArray.length&&(b=0)}else{b--;b<0&&(b=this.tabArray.length-1)}this._refocusFromCycle=b;this._prevPressed=a=this.tabArray[b];a.setPressed(true);this._resetButtons(a,true);this._rearrangeTabs();sc.menu.itemLastButtonData=a.data;sc.menu.setItemTab(b)}},onItemButtonPressed:function(b){if(sc.menu.getCurrentTabType()==sc.ITEMS_TYPES.TOGGLE){var a=sc.model.player.toggleItem(b.data.id,b.set);a?this.toggleOnSound.play():
this.toggleOffSound.play();a?b.setGui.updateTogglesStates(b):b.setGui.updateTogglesStates()}},modelChanged:function(b,a,d){if(b==sc.menu)if(a==sc.MENU_EVENT.ITEM_CHANGED_TAB){b=sc.menu.itemLastButtonData;this._createList(b.type,b.subType,true,ig.input.mouseGuiActive,!ig.input.mouseGuiActive)}else if(a==sc.MENU_EVENT.SORT_LIST){b=sc.menu.itemLastButtonData;this._createList(b.type,b.subType,true,ig.input.mouseGuiActive,!ig.input.mouseGuiActive,d.data.sortType)}},getCurrentSortText:function(){var b=
"auto";switch(this.sortTypes[sc.menu.itemLastButtonData.subType||sc.menu.itemLastButtonData.type]||sc.SORT_TYPE.ORDER){case sc.SORT_TYPE.ORDER:b="auto";break;case sc.SORT_TYPE.NAME:b="name";break;case sc.SORT_TYPE.AMOUNT:b="amount";break;case sc.SORT_TYPE.RARITY:b="rarity"}return ig.lang.get("sc.gui.menu.sort."+b)},_createList:function(b,a,d,c,e,f){d=d||false;c=c||false;e=e||false;this.sortTypes[a||b]!=void 0?f==void 0?f=this.sortTypes[a||b]:this.sortTypes[a||b]=f:this.sortTypes[a||b]=f||sc.SORT_TYPE.ORDER;
var g=0,h=0,i=sc.model.player;this._bgRev.clear();this.list.clear(d);var j=null,k=-1,l=-1;if(b=="NEW")j=i.getNewItemList();else if(a)if(b==sc.ITEMS_TYPES.EQUIP){j=i.getEquipSubList(a,true,f||sc.SORT_TYPE.ORDER);switch(a){case sc.ITEMS_EQUIP_TYPES.HEAD:k=i.equip.head;break;case sc.ITEMS_EQUIP_TYPES.ARM:k=i.equip.leftArm;l=i.equip.rightArm;break;case sc.ITEMS_EQUIP_TYPES.TORSO:k=i.equip.torso;break;case sc.ITEMS_EQUIP_TYPES.FEET:k=i.equip.feet}}else throw Error("Only equip can have a subType! [type: "+
b+", subType: "+a+"]");else j=i.getItemSubList(b,f||sc.SORT_TYPE.ORDER);var o=null,a=null,m=0,n=b==sc.ITEMS_TYPES.TOGGLE;if(n){this.list.setQuantityState("HIDDEN");b=i.toggleSets;this.list.list.columns=1;this.list.list.paddingTop=1;var j=0,k={counter:0},p;for(p in b){l=b[p];k.counter=0;if(i.hasAnySetItem(l)){l=new sc.ToggleSet(l,this.list,j,k);this.list.addButton(l,true);j=j+Math.ceil(k.counter/2)}}this.list.list.paddingTop=1;this.list.list.columns=2;this._bgRev.fillEmptySpace()}else{this.list.setQuantityState("DEFAULT");
for(p=0;p<j.length;p++){var m=i.items[j[p]]||0,a=sc.inventory.getItem(j[p]),o=new ig.LangLabel(a.name),o=n?"\\i["+(i.getToggleItemState(j[p])?"toggle-item-on":"toggle-item-off")+"]":"\\i["+(a.icon+sc.inventory.getRaritySuffix(a.rarity||0)||"item-default")+"]",o=o+ig.LangLabel.getText(a.name),r=ig.LangLabel.getText(a.description),t=0;b==sc.ITEMS_TYPES.EQUIP&&(t=a.level||1);k==j[p]&&(m=m+1);l==j[p]&&(m=m+1);o=n?new sc.ItemBoxButton(o,142,24,-1,j[p],r,true,void 0,void 0,void 0,t):new sc.ItemBoxButton(o,
142,26,m,j[p],r,void 0,void 0,void 0,void 0,t);if(m==0&&b=="NEW"&&a.equipType&&i.isEquipped(j[p])){m=i.getItemAmountWithEquip(j[p]);o.amount.setNumber(m,true);this._addEquipOverlay(o,1)}m==0&&o.setActive(false);o.button.submitSound=null;if(j[p]==k||j[p]==l){this._addEquipOverlay(o,k);this._addEquipOverlay(o,l)}i.isFavorite(j[p])&&this._addFavoriteOverlay(o);this.list.addButton(o)}}if(d){d=0;if(f==void 0){if(this._refocusFromCycle>=0){f=this._lastCursorPos[this._refocusFromCycle];this._refocusFromCycle=
-1;if(this._bgRev.isPositionValid(f.x,f.y)){d=f.x;g=f.y;h=-f.scroll}else h=g=d=0}}else h=g=0;this.list.list._prevIndex=g;c?this._bgRev.setCurrentFocus(d,g):this._bgRev.focusCurrentButton(d,g,false,e);this.list.scrollToY(h,true)}},addEmpty:function(){},_createTabButton:function(b,a,d,c,e){b=new sc.ItemTabbedBox.TabButton(ig.lang.get("sc.gui.menu.item."+b),a);b.setPos(0,2);b.setData({type:c,subType:e||null,description:null});this.addChildGui(b);this.tabGroup.addFocusGui(b,d,0);return this.tabArray[d]=
b},_resetButtons:function(b,a){for(var d=0;d<this.tabArray.length;d++){b!=this.tabArray[d]&&this.tabArray[d].setPressed(false);if(a)this.tabArray[d].focus=false}},_rearrangeTabs:function(){for(var b=8,a=null,d=0;d<this.tabArray.length;d++){a=this.tabArray[d];a.hook.pos.x=b;b=b+a.hook.size.x}},_addEquipOverlay:function(b,a){if(a>=0){var d=new ig.ImageGui(this.gfx,112,480,19,16);b.addChildGui(d)}},_addFavoriteOverlay:function(b){var a=new ig.ImageGui(this.gfx,256,480,19,17);a.setPos(0,0);b.addChildGui(a)},
_removeFavoriteOverlay:function(b){b.removeChildGuiByIndex(b.hook.children.length-1)}});sc.ItemTabbedBox.TabButton=ig.FocusGui.extend({ninepatch:new ig.NinePatch("media/gui/buttons.png",{width:15,height:0,left:9,top:20,right:4,bottom:0,offsets:{"default":{x:0,y:92},focus:{x:32,y:92},pressed:{x:64,y:92}}}),text:"",icon:"item-default",data:null,noIcon:false,textChild:null,iconChild:null,_smallWidth:28,_largeWidth:106,init:function(b,a,d,c,e){this.parent(true,true);this._smallWidth=c||28;this._largeWidth=
d||106;this.setSize(this._smallWidth,20);this.text=b||"";this.icon=a||"item-default";this.noIcon=e||false;this.textChild=new sc.TextGui(this.getButtonText(),{speed:ig.TextBlock.SPEED.IMMEDIATE});this.textChild.setAlign(ig.GUI_ALIGN.X_LEFT,ig.GUI_ALIGN.Y_CENTER);this.textChild.setPos(8,0);this.addChildGui(this.textChild)},setData:function(b){if(b!=void 0)this.data=b},getButtonText:function(){return this.pressed?this.noIcon?this.text:"\\i["+this.icon+"]"+this.text:this.noIcon?this.icon:"\\i["+this.icon+
"]"},setText:function(b){this.text=b;this.textChild.setText(b)},setWidthToTextSize:function(){this._largeWidth=this.textChild.hook.size.x+16;this.hook.size.x=this.pressed?this._largeWidth:this._smallWidth},updateDrawables:function(b){var a="default";this.keepPressed&&this.pressed?a="pressed":this.focus&&(a="focus");this.ninepatch.draw(b,this.hook.size.x,this.hook.size.y,a)},setPressed:function(b){var a=this.pressed;this.parent(b);if(a!=this.pressed){this.textChild.setText(this.getButtonText());this.hook.size.x=
this.pressed?this._largeWidth:this._smallWidth;this.onPressedChange(this.pressed)}},onPressedChange:function(){}})});ig.baked=!0;
ig.module("game.feature.menu.gui.item.item-menu").requires("impact.feature.gui.gui","impact.feature.gui.base.basic-gui","game.feature.menu.gui.item.item-status-equip","game.feature.menu.gui.item.item-status-default","game.feature.menu.gui.item.item-status-buffs","game.feature.menu.gui.item.item-status-favs","game.feature.menu.gui.item.item-status-trade","game.feature.menu.gui.item.item-list").defines(function(){sc.ItemMenu=sc.BaseMenu.extend({hotkeyHelp:null,hotkeyFav:null,hotkeySort:null,statusEquipBox:null,
statusModifierBox:null,statusDefaultBox:null,statusBuffBox:null,statusFavs:null,statusTrade:null,listBox:null,consHelp:null,sortMenu:null,helpGui:null,init:function(){this.parent();this.hook.size.x=ig.system.width;this.hook.size.y=ig.system.height;this.hotkeyHelp=new sc.ButtonGui("\\i[help]"+ig.lang.get("sc.gui.menu.hotkeys.help"),void 0,true,sc.BUTTON_TYPE.SMALL);this.hotkeyHelp.keepMouseFocus=true;this.hotkeyHelp.hook.transitions={DEFAULT:{state:{},time:0.2,timeFunction:KEY_SPLINES.EASE},HIDDEN:{state:{offsetY:-this.hotkeyHelp.hook.size.y},
time:0.2,timeFunction:KEY_SPLINES.LINEAR}};this.hotkeyHelp.onButtonPress=this.onHelpButtonPressed.bind(this);this.hotkeySort=new sc.ButtonGui("\\i[help3]"+ig.lang.get("sc.gui.menu.item.sort-title"),void 0,true,sc.BUTTON_TYPE.SMALL);this.hotkeySort.keepMouseFocus=true;this.hotkeySort.hook.transitions={DEFAULT:{state:{},time:0.2,timeFunction:KEY_SPLINES.EASE},HIDDEN:{state:{offsetY:-this.hotkeySort.hook.size.y},time:0.2,timeFunction:KEY_SPLINES.LINEAR}};this.hotkeySort.onButtonPress=this.onSortButtonPress.bind(this);
this.sortMenu=new sc.ItemSortMenu;this.statusEquipBox=new sc.ItemStatusEquip;this.addChildGui(this.statusEquipBox);this.statusModifierBox=new sc.ItemEquipModifier;this.addChildGui(this.statusModifierBox);this.statusDefaultBox=new sc.ItemStatusDefault;this.addChildGui(this.statusDefaultBox);this.statusBuffBox=new sc.ItemStatusBuffs;this.addChildGui(this.statusBuffBox);this.consHelp=new sc.ItemBuffHelp;this.addChildGui(this.consHelp);this.statusBuffBox.annotation={size:{x:this.statusBuffBox.hook.size.x+
2,y:this.statusBuffBox.hook.size.y+2},offset:{x:-1,y:-1},content:{title:"sc.gui.menu.help.item.titles.buffs",description:"sc.gui.menu.help.item.description.buffs"},index:{x:0,y:3}};this.statusFavs=new sc.ItemStatusFavorites;this.addChildGui(this.statusFavs);this.statusTrade=new sc.ItemStatusTrade;this.addChildGui(this.statusTrade);this.listBox=new sc.ItemTabbedBox;this.addChildGui(this.listBox);this.hotkeyFav=new sc.ButtonGui("\\i[help2]"+ig.lang.get("sc.gui.menu.item.set-fav"),void 0,true,sc.BUTTON_TYPE.SMALL);
this.hotkeyFav.submitSound=null;this.hotkeyFav.keepMouseFocus=true;this.hotkeyFav.hook.transitions={DEFAULT:{state:{},time:0.2,timeFunction:KEY_SPLINES.EASE},HIDDEN:{state:{offsetY:-this.hotkeyFav.hook.size.y},time:0.2,timeFunction:KEY_SPLINES.LINEAR}};this.hotkeyFav.onButtonPress=this.onFavButtonPress.bind(this);this.doStateTransition("DEFAULT")},addObservers:function(){sc.Model.addObserver(sc.menu,this);this.statusEquipBox.addObservers();this.statusModifierBox.addObservers();this.statusDefaultBox.addObservers();
this.statusBuffBox.addObservers();this.consHelp.addObservers();this.statusFavs.addObservers();this.statusTrade.addObservers();this.listBox.addObservers()},removeObservers:function(){sc.Model.removeObserver(sc.menu,this);this.statusEquipBox.removeObservers();this.statusModifierBox.removeObservers();this.statusDefaultBox.removeObservers();this.statusBuffBox.removeObservers();this.consHelp.removeObservers();this.statusFavs.removeObservers();this.statusTrade.removeObservers();this.listBox.removeObservers()},
showMenu:function(){this.addObservers();sc.menu.pushBackCallback(this.onBackButtonPress.bind(this));sc.menu.moveLeaSprite(0,0,sc.MENU_LEA_STATE.HIDDEN);this.onAddHotkeys();if(sc.menu.itemCurrentTab==-1)sc.menu.itemCurrentTab=1;this._updateSortMenuButton(this.listBox.getCurrentSortText());sc.menu.itemCurrentTab==0?this.hotkeySort.setActive(false):this.hotkeySort.setActive(true);this.statusEquipBox.showMenu();this.statusModifierBox.showMenu();this.statusDefaultBox.showMenu();this.statusBuffBox.showMenu();
this.statusFavs.showMenu();this.statusTrade.showMenu();this.listBox.showMenu()},hideMenu:function(){sc.menu.moveLeaSprite(0,0,sc.MENU_LEA_STATE.LARGE);this.exitMenu()},exitMenu:function(){this.removeObservers();sc.menu.buttonInteract.removeGlobalButton(this.hotkeyHelp);sc.menu.buttonInteract.removeGlobalButton(this.hotkeyFav);sc.menu.buttonInteract.removeGlobalButton(this.hotkeySort);this.helpGui=null;this.sortMenu.active&&this.sortMenu.hideSortMenu();this.statusEquipBox.exitMenu();this.statusModifierBox.exitMenu();
this.statusDefaultBox.exitMenu();this.statusBuffBox.exitMenu();this.consHelp.exitMenu();this.statusFavs.exitMenu();this.statusTrade.exitMenu();this.listBox.exitMenu()},onHotkeyHelpCheck:function(){return sc.control.menuHotkeyHelp()},onHelpButtonPressed:function(){this.consHelp.exitMenu(true);sc.menu.removeHotkeys();this.createHelpGui();ig.gui.addGuiElement(this.helpGui);this.helpGui.openMenu(sc.menu.itemCurrentTab!=1)},createHelpGui:function(){if(!this.helpGui){this.helpGui=new sc.HelpScreen(this,
ig.lang.get("sc.gui.menu.help-texts.inventory.title"),ig.lang.get("sc.gui.menu.help-texts.inventory.pages"),function(){this.commitHotKeysToTopBar(true);ig.input.mouseGuiActive?sc.menu.buttonInteract.mouseOverGui?this.consHelp.showMenu():this.consHelp.store=false:this.consHelp.store&&this.consHelp.showMenu()}.bind(this),true);this.helpGui.addons.push(sc.menu.guiReference.buffInfo);this.helpGui.hook.zIndex=15E4;this.helpGui.hook.pauseGui=true}},onHotkeyFavoriteCheck:function(){return sc.control.menuHotkeyHelp2()},
onFavButtonPress:function(){this.listBox.setFavorite()},onHotkeySortCheck:function(){return sc.control.menuHotkeyHelp3()},onSortButtonPress:function(){if(this.sortMenu.active)this.sortMenu.hideSortMenu();else{ig.gui.addGuiElement(this.sortMenu);this.sortMenu.showSortMenu(this.hotkeySort)}},onAddHotkeys:function(b){sc.menu.buttonInteract.addGlobalButton(this.hotkeyHelp,this.onHotkeyHelpCheck.bind(this));sc.menu.buttonInteract.addGlobalButton(this.hotkeyFav,this.onHotkeyFavoriteCheck.bind(this));sc.menu.buttonInteract.addGlobalButton(this.hotkeySort,
this.onHotkeySortCheck.bind(this));this.commitHotKeysToTopBar(b)},commitHotKeysToTopBar:function(b){sc.menu.addHotkey(function(){return this.hotkeyFav}.bind(this));sc.menu.addHotkey(function(){return this.hotkeySort}.bind(this));sc.menu.addHotkey(function(){return this.hotkeyHelp}.bind(this));sc.menu.commitHotkeys(b)},onBackButtonPress:function(){sc.menu.popBackCallback();sc.menu.popMenu()},_updateSortMenuButton:function(b){var a="\\i[help3]"+ig.lang.get("sc.gui.menu.item.sort-title")+": ";this.hotkeySort.setText(a+
("\\c[3]"+b+"\\c[0]"));sc.menu.updateHotkeys()},modelChanged:function(b,a,d){if(b==sc.menu)if(a==sc.MENU_EVENT.SORT_LIST)this._updateSortMenuButton(d.text);else if(a==sc.MENU_EVENT.ITEM_CHANGED_TAB){this.sortMenu.active&&this.sortMenu.hideSortMenu();if(d!=sc.menu.itemCurrentTab){this._updateSortMenuButton(this.listBox.getCurrentSortText());sc.menu.itemCurrentTab==0?this.hotkeySort.setActive(false):this.hotkeySort.setActive(true)}}}})});ig.baked=!0;
ig.module("game.feature.menu.gui.map.map-misc").requires("impact.feature.gui.gui","impact.feature.gui.base.basic-gui","game.feature.gui.base.numbers","game.feature.menu.gui.menu-misc").defines(function(){var b=[],a=0,d=0;sc.LandmarkGui=ig.FocusGui.extend({gfx:new ig.Image("media/gui/menu.png"),key:null,activated:true,floor:0,landmark:null,map:null,description:null,name:null,init:function(a,b,c,d,i){this.parent();this.setSize(16,16);this.setPos(b.x-8,b.y-8);this.key=a;this.landmark=b;this.floor=c;
this.map=d;this.activated=sc.map.isLandmarkActive(a,i,true);if(sc.model.isTeleportBlockedNewGame())this.activated=false;this.name=(a=sc.map.getCurrentAreaLandmark(this.key).name)?ig.LangLabel.getText(a):null;this.description=(a=sc.map.getCurrentAreaLandmark(this.key).description)?ig.LangLabel.getText(a):null},updateDrawables:function(a){if(this.activated)if(this.focus&&this.floor==sc.map.currentFloor){a.addGfx(this.gfx,-5,-6,450,170,28,28).setCompositionMode("lighter");a.addGfx(this.gfx,0,0,464,144,
16,16)}else a.addGfx(this.gfx,0,0,448,144,16,16);else this.focus&&this.floor==sc.map.currentFloor?a.addGfx(this.gfx,0,0,624,144,16,16):a.addGfx(this.gfx,0,0,608,144,16,16)},isMouseOver:function(){if(!(this.floor!=sc.map.currentFloor||sc.menu.mapWorldmapActive||ig.interact.isBlocked()||sc.menu.mapStampMenu)){if(sc.menu.mapDrag)return sc.menu.mapMapFocus==this;if(ig.input.currentDevice==ig.INPUT_DEVICES.GAMEPAD){var b=this.getDistanceToCursor();if(sc.menu.mapCursorMoved){sc.menu.unfocusMap(this);return false}if(b<=
10){b=this.hook;sc.menu.focusMap(b.pos.x+Math.floor(b.size.x/2)+sc.menu.mapAreaOffset.x,b.pos.y+Math.floor(b.size.y/2)+1+sc.menu.mapAreaOffset.y,this,true);return true}sc.menu.unfocusMap(this)}else if(ig.input.currentDevice==ig.INPUT_DEVICES.KEYBOARD_AND_MOUSE){var c=Math.floor(sc.control.getMouseX()),g=Math.floor(sc.control.getMouseY());if(g<=21||g>=299){sc.menu.unfocusMap(this);return false}b=this.hook;a=b.screenCoords.x;d=b.screenCoords.y;(c=c>=a&&c<=a+15&&g>=d&&g<=d+16)?sc.menu.focusMap(b.pos.x+
Math.floor(b.size.x/2)+sc.menu.mapAreaOffset.x,b.pos.y+Math.floor(b.size.y/2)+1+sc.menu.mapAreaOffset.y,this):sc.menu.unfocusMap(this);return c}return false}},getDistanceToCursor:function(){return Math.floor(Vec2.distanceC(sc.menu.mapCursor.x-sc.menu.mapAreaOffset.x,sc.menu.mapCursor.y-sc.menu.mapAreaOffset.y,this.hook.pos.x+Math.floor(this.hook.size.x/2),this.hook.pos.y+Math.floor(this.hook.size.y/2)))}});sc.MapCurrentRoomWrapper=ig.GuiElementBase.extend({gfx:new ig.Image("media/gui/menu.png"),transitions:{DEFAULT:{state:{},
time:0.2,timeFunction:KEY_SPLINES.LINEAR},HIDDEN:{state:{alpha:0},time:0.2,timeFunction:KEY_SPLINES.LINEAR}},init:function(a){this.parent();this.setPos(a.pos.x,a.pos.y);this.setSize(a.size.x,a.size.y);var a=648+(a.size.x<=24||a.size.y<=24?0:16),b=new ig.ImageGui(this.gfx,a,144,16,16);b.setAlign(ig.GUI_ALIGN.X_LEFT,ig.GUI_ALIGN.Y_TOP);b.setPos(-3,-3);this.addChildGui(b);b=new ig.ImageGui(this.gfx,a,144,16,16);b.setAlign(ig.GUI_ALIGN.X_RIGHT,ig.GUI_ALIGN.Y_TOP);b.flipX=true;b.setPos(-2,-3);this.addChildGui(b);
b=new ig.ImageGui(this.gfx,a,144,16,16);b.flipY=true;b.setAlign(ig.GUI_ALIGN.X_LEFT,ig.GUI_ALIGN.Y_BOTTOM);b.setPos(-3,-2);this.addChildGui(b);b=new ig.ImageGui(this.gfx,a,144,16,16);b.setAlign(ig.GUI_ALIGN.X_RIGHT,ig.GUI_ALIGN.Y_BOTTOM);b.flipY=true;b.flipX=true;b.setPos(-2,-2);this.addChildGui(b)}});sc.MapNameGui=ig.BoxGui.extend({transitions:{DEFAULT:{state:{},time:0.1,timeFunction:KEY_SPLINES.LINEAR},HIDDEN:{state:{alpha:0,scaleY:0},time:0.1,timeFunction:KEY_SPLINES.LINEAR}},ninepatch:new ig.NinePatch("media/gui/menu.png",
{width:2,height:2,left:3,top:3,right:3,bottom:3,offsets:{"default":{x:296,y:448}}}),text:null,init:function(){this.parent(8,8);this.hook.localAlpha=0.8;this.text=new sc.TextGui("T",{font:sc.fontsystem.tinyFont});this.text.setAlign(ig.GUI_ALIGN.X_CENTER,ig.GUI_ALIGN.Y_CENTER);this.addChildGui(this.text);this.hook.size.y=this.text.hook.size.y+2},setText:function(a,b,c){if(a){this.doStateTransition("DEFAULT",b?false:true,false,null,b||0);this.text.setText(a);this.setSize(this.text.hook.size.x+4,this.text.hook.size.y+
2)}else this.doStateTransition("HIDDEN",c)}});sc.WorldmapAreaName=ig.GuiElementBase.extend({gfx:new ig.Image("media/gui/menu.png"),name:null,hasText:false,flip:false,init:function(){this.parent();this.name=new sc.MapNameGui;this.name.setAlign(ig.GUI_ALIGN.X_RIGHT,ig.GUI_ALIGN.Y_TOP);this.addChildGui(this.name)},updateDrawables:function(a){this.parent(a);this.flip?this.hasText&&a.addGfx(this.gfx,this.hook.size.x,-3,320,461,3,3):this.hasText&&a.addGfx(this.gfx,0,this.hook.size.y-3,320,461,3,3)},setText:function(a,
b,c){this.name.setText(a,b,c);this.hasText=a!="";this.hook.size.x=this.name.hook.size.x+3;this.hook.size.y=this.name.hook.size.y+3},setFlip:function(a){this.flip=a||false}});sc.MapCursor=ig.GuiElementBase.extend({gfx:new ig.Image("media/gui/menu.png"),focusOffset:{x:0,y:8},focus:false,_focusTimer:0,_focusTime:0,_focusOffset:0,_lastDevice:0,_gamepadActive:false,_worldmap:false,_ignoreModel:false,init:function(a){this.parent();this.setSize(11,24);this._worldmap=a||false},focusOnNode:function(a,b){this.setPos(a-
Math.floor(this.hook.size.x/2),b-Math.floor(this.hook.size.y/2)-this.focusOffset.y);this.focus=true;this._focusTimer=0;this._focusTime=0.15;this._focusOffset=0},unfocus:function(){this.focus=false;this._focusTime=this._focusTimer=0.15;this._focusOffset=0},moveTo:function(a,b,c,d){c&&ig.input.currentDevice==ig.INPUT_DEVICES.GAMEPAD?this.doPosTranstition(a-Math.floor(this.hook.size.x/2),b-Math.floor(this.hook.size.y/2)-this.focusOffset.y,d,KEY_SPLINES.EASE):this.setPos(a-Math.floor(this.hook.size.x/
2),b-Math.floor(this.hook.size.y/2)-this.focusOffset.y);if(this.focus){this._focusTimer=0;this._focusTime=0.15;this._focusOffset=3;this.focus=false}},looseFocus:function(){this._focusTime=this._focusTimer=0.15;this._focusOffset=0},addObservers:function(){sc.Model.addObserver(sc.menu,this)},removeObservers:function(){sc.Model.removeObserver(sc.menu,this)},update:function(){if(this._lastDevice!=ig.input.currentDevice){this._gamepadActive=ig.input.currentDevice==ig.INPUT_DEVICES.GAMEPAD;this._lastDevice=
ig.input.currentDevice}if(this._focusTimer<this._focusTime){this._focusTimer=this._focusTimer+ig.system.tick;if(this._focusTimer>=this._focusTime){this._focusTimer=this._focusTime;this._focusOffset=this.focus?3:0}else this._focusOffset=(this._focusTime?1:-1)*(this._focusTimer/this._focusTime)*3}},updateDrawables:function(a){if(this.focus)a.addGfx(this.gfx,0,-1+this._focusOffset,434,146,11,17);else if(this._gamepadActive){a.addGfx(this.gfx,1,0,419,147,9,14);a.addGfx(this.gfx,1,this.hook.size.y-9,483,
147,9,9).setCompositionMode("lighter")}},modelChanged:function(a,b,c){if(!this._ignoreModel&&a==sc.menu)if(b==sc.MENU_EVENT.MAP_CHANGED_FLOOR){this.unfocus();if(ig.input.currentDevice==ig.INPUT_DEVICES.GAMEPAD)this._gamepadActive=true}else if(b==sc.MENU_EVENT.SKILL_TOGGLED_INPUT_MODE){this._focusTime=this._focusTimer=0.15;this._focusOffset=0}else b==sc.MENU_EVENT.MAP_FOCUS_AREA?this._worldmap&&this.focusOnNode(sc.menu.mapWorldCursor.x,sc.menu.mapWorldCursor.y):b==sc.MENU_EVENT.MAP_FOCUS_MAP?this._worldmap||
this.focusOnNode(sc.menu.mapCursor.x,sc.menu.mapCursor.y):b==sc.MENU_EVENT.MAP_UNFOCUS?this._worldmap==c&&this.unfocus():b==sc.MENU_EVENT.MAP_ENSURE_FOCUS&&(this.focus||(c?this.focusOnNode(sc.menu.mapWorldCursor.x,sc.menu.mapWorldCursor.y):this.focusOnNode(sc.menu.mapCursor.x,sc.menu.mapCursor.y)))}});sc.MapChestDisplay=ig.GuiElementBase.extend({gfx:new ig.Image("media/gui/menu.png"),current:null,max:null,_oldCount:-1,_oldMax:-1,transitions:{DEFAULT:{state:{},time:0.2,timeFunction:KEY_SPLINES.LINEAR},
HIDDEN:{state:{alpha:0,offsetX:-70},time:0.2,timeFunction:KEY_SPLINES.LINEAR}},init:function(){this.parent();this.setSize(58,11);this.setAlign(ig.GUI_ALIGN.X_LEFT,ig.GUI_ALIGN.Y_BOTTOM);this.setPos(12,24);this.current=new sc.NumberGui(99,{leadingZeros:2});this.current.setPos(26,2);this.current.setAlign(ig.GUI_ALIGN.X_RIGHT,ig.GUI_ALIGN.Y_TOP);this.addChildGui(this.current);this.max=new sc.NumberGui(99,{leadingZeros:2});this.max.setAlign(ig.GUI_ALIGN.X_RIGHT,ig.GUI_ALIGN.Y_TOP);this.max.setPos(0,2);
this.addChildGui(this.max);this.annotation={type:"INFO",content:{title:"sc.gui.menu.help.map.titles.chest",description:"sc.gui.menu.help.map.description.chest"},offset:{x:-3,y:-2},size:{x:"dyn",y:15,offX:6},index:{x:0,y:1}};this.doStateTransition("HIDDEN",true)},update:function(){var a=sc.map.getCurrentChestCount();if(a!=this._oldMax){this._oldMax=a;this.max.setNumber(a)}a=sc.stats.getMap("chests",sc.map.currentArea.path)||0;if(a!=this._oldCount){this._oldCount=a;this.current.setNumber(Math.min(this._oldMax,
a))}},updateDrawables:function(a){a.addGfx(this.gfx,0,0,280,448,11,11);a.addGfx(this.gfx,33,2,80,408,8,8)}});sc.MapStampDisplay=ig.GuiElementBase.extend({gfx:new ig.Image("media/gui/menu.png"),current:null,max:null,_oldCount:-1,transitions:{DEFAULT:{state:{},time:0.2,timeFunction:KEY_SPLINES.LINEAR},HIDDEN:{state:{alpha:0,offsetX:-70},time:0.2,timeFunction:KEY_SPLINES.LINEAR}},init:function(){this.parent();this.setSize(58,11);this.setAlign(ig.GUI_ALIGN.X_LEFT,ig.GUI_ALIGN.Y_BOTTOM);this.setPos(12,
42);this.current=new sc.NumberGui(99,{leadingZeros:2});this.current.setPos(26,2);this.current.setAlign(ig.GUI_ALIGN.X_RIGHT,ig.GUI_ALIGN.Y_TOP);this.addChildGui(this.current);this.max=new sc.NumberGui(99,{leadingZeros:2});this.max.setNumber(sc.MAP_STAMPS_MAX,true);this.max.setAlign(ig.GUI_ALIGN.X_RIGHT,ig.GUI_ALIGN.Y_TOP);this.max.setPos(0,2);this.addChildGui(this.max);this.annotation={type:"INFO",content:{title:"sc.gui.menu.help.map.titles.stamps",description:"sc.gui.menu.help.map.description.stamps"},
offset:{x:-3,y:-2},size:{x:"dyn",y:15,offX:6},index:{x:0,y:0}};this.doStateTransition("HIDDEN",true)},update:function(){var a=sc.menu.getStampCount(sc.map.currentArea.path);if(a!=this._oldCount){this._oldCount=a;this.current.setNumber(Math.min(sc.MAP_STAMPS_MAX,a))}},updateDrawables:function(a){a.addGfx(this.gfx,0,0,280,460,11,11);a.addGfx(this.gfx,33,2,80,408,8,8)}});sc.MapFloorButton=ig.FocusGui.extend({gfx:new ig.Image("media/gui/menu.png"),textGui:null,name:"???",level:0,alpha:1,alphaTimer:0,
init:function(a,b){this.parent(true,true);this.setSize(62,34);this.name=a||"???";this.level=b||0;this.keepMouseFocus=true;this.textGui=new sc.TextGui(this.name,{speed:ig.TextBlock.SPEED.IMMEDIATE});this.textGui.setAlign(ig.GUI_ALIGN.X_CENTER,ig.GUI_ALIGN.Y_CENTER);this.textGui.setPos(0,-2);this.addChildGui(this.textGui)},focusGained:function(a){this.parent(a);if(this.focus){this.alphaTimer=0;this.alpha=1}},onMouseInteract:function(a,b){if(!sc.menu.mapDrag){this.parent(a,b);if(!sc.menu.mapMouseOverFloorButtons&&
a&&!sc.menu.mapDrag)sc.menu.mapMouseOverFloorButtons=true}},update:function(){this.alphaTimer=(this.alphaTimer+ig.system.actualTick)%1;var a=this.alphaTimer/1,a=KEY_SPLINES.EASE_IN_OUT.get(1-(a>0.5?1-(a-0.5)*2:a*2));this.alpha=0.8*a+0.2},updateDrawables:function(a){a.addGfx(this.gfx,0,0,314,384+(this.focus?34:0),62,34);this.focus?a.addGfx(this.gfx,0,0,376,384,62,34).setAlpha(this.alpha):this.pressed&&a.addGfx(this.gfx,0,0,376,384,62,34)}});sc.MapFloorButtonContainer=ig.GuiElementBase.extend({gfx:new ig.Image("media/gui/menu.png"),
buttongroup:null,leaIcon:null,hasVisitedRooms:[],_floors:null,_selfUpdate:false,_submitSound:null,_minFloor:0,_maxFloor:0,init:function(){this.parent();this.hook.transitions={DEFAULT:{state:{},time:0.2,timeFunction:KEY_SPLINES.LINEAR},HIDDEN:{state:{alpha:0,offsetX:-87},time:0.2,timeFunction:KEY_SPLINES.LINEAR}};this.setPos(25,33);this.setAlign(ig.GUI_ALIGN.X_RIGHT,ig.GUI_ALIGN.Y_TOP);this.doStateTransition("HIDDEN",true);this._submitSound=sc.BUTTON_SOUND.submit;this.buttongroup=new sc.ButtonGroup;
this.buttongroup.ignoreActiveFocus=true;this.buttongroup.addPressCallback(this.onFloorPress.bind(this));this.leaIcon=new ig.ImageGui(this.gfx,280,388,34,20);this.leaIcon.hook.transitions={DEFAULT:{state:{},time:0.2,timeFunction:KEY_SPLINES.LINEAR},HIDDEN:{state:{alpha:0},time:0.2,timeFunction:KEY_SPLINES.LINEAR}};this.leaIcon.doStateTransition("HIDDEN",true);if(sc.map.getCurrentArea()){this._floors=sc.map.getCurrentArea().floors;this.setSize(62,34*this._floors.length+-8*Math.max(0,this._floors.length-
1));this._createButtons(true)}},showMenu:function(){sc.menu.buttonInteract.addParallelGroup(this.buttongroup);this.doStateTransition("DEFAULT")},exitMenu:function(){sc.menu.buttonInteract.removeParallelGroup(this.buttongroup);this.doStateTransition("HIDDEN")},addObservers:function(){sc.Model.addObserver(sc.menu,this)},removeObservers:function(){sc.Model.removeObserver(sc.menu,this)},centerMap:function(){this._selfUpdate=true;this._submitSound.play();sc.menu.selectFloor(sc.map.currentFloor)},update:function(){if(this._floors&&
!sc.menu.mapWorldmapActive&&!sc.menu.mapStampMenu&&!sc.menu.helpMenuOpen){var a=-1E4;if(this.pressed("circle-right",ig.BUTTONS.DPAD_UP,ig.BUTTONS.LEFT_SHOULDER)){a=sc.map.currentFloor+1;if(a>this._maxFloor)a=this._minFloor}else if(this.pressed("circle-left",ig.BUTTONS.DPAD_DOWN,ig.BUTTONS.RIGHT_SHOULDER)){a=sc.map.currentFloor-1;if(a<this._minFloor)a=this._maxFloor}if(a>-1E4&&a!=sc.map.currentFloor){this._submitSound.play();sc.menu.selectFloor(a);if(sc.menu.mapMapFocus)this.hoverRoom=sc.menu.mapMapFocus=
null}}},pressed:function(a,b,c){return ig.input.pressed(a)||ig.gamepad.isButtonPressed(b)||ig.gamepad.isButtonPressed(c)},onFloorPress:function(a){if(a.level!=void 0){this._selfUpdate=true;this._submitSound.play();sc.menu.selectFloor(a.level||0)}},modelChanged:function(a,b,c){if(a==sc.menu)if(b==sc.MENU_EVENT.MAP_CHANGED_FLOOR)if(this._selfUpdate)this._selfUpdate=false;else{if(a=this.buttongroup.elements[0])for(b=a.length;b--;)a[b]&&(a[b].level!=void 0&&a[b].level==sc.map.currentFloor)&&this.buttongroup.setPressedFocusGui(a[b])}else if(b==
sc.MENU_EVENT.MAP_WORLDMAP_STATE)c?this.exitMenu():this.showMenu();else if(b==sc.MENU_EVENT.MAP_AREA_LOAD_DONE){this._floors=sc.map.getCurrentArea().floors;this.setSize(62,34*this._floors.length+-8*Math.max(0,this._floors.length-1));this._createButtons(true);this.showMenu()}},_createButtons:function(a){this.hook.removeAllChildren();this.buttongroup.clear();this.leaIcon.doStateTransition("HIDDEN",true);var c=this._floors.length,d=0,h=null,i=0,h=false,j=0,k=null;this._minFloor=1E5;for(this._maxFloor=
-1E5;c--;){k=this._floors[c].maps;i=this._floors[c].level;j=k.length;for(h=false;j--;)if(ig.vars.storage.maps[k[j].path.toCamel().toPath("","")]){h=true;break}if(h){if(i<this._minFloor)this._minFloor=i;if(i>this._maxFloor)this._maxFloor=i;h=new sc.MapFloorButton(this._getFloorName(i,c),i);h.setPos(0,d);this.buttongroup.addFocusGui(h,0,c);if(sc.map.currentFloor==i){this.buttongroup.setPressedFocusGui(h);if(sc.map.currentPlayerArea==sc.map.currentArea){this.leaIcon.setPos(45,d-3);this.leaIcon.doStateTransition("DEFAULT",
a||false)}}d=d+26;b.push(h)}}for(c=b.length;c--;)this.addChildGui(b[c]);this.addChildGui(this.leaIcon);b.length=0},_getFloorName:function(a,b){var c=sc.map.getCurrentArea().floors[b];return c&&c.handle?ig.LangLabel.getText(c.handle):a==0?ig.lang.get("sc.gui.menu.map-menu.gf"):a<0?ig.lang.get("sc.gui.menu.map-menu.base-short")+Math.abs(a):Math.abs(a)+ig.lang.get("sc.gui.menu.map-menu.floor-short")}});sc.CurrentAreaDisplay=sc.MenuPanel.extend({transitions:{DEFAULT:{state:{},time:0.2,timeFunction:KEY_SPLINES.LINEAR},
HIDDEN:{state:{alpha:0,offsetX:0},time:0.2,timeFunction:KEY_SPLINES.LINEAR}},text:null,init:function(){this.parent(sc.MenuPanelType.SQUARE);this.setPos(2,24);this.setAlign(ig.GUI_ALIGN.X_RIGHT,ig.GUI_ALIGN.Y_BOTTOM);this.text=new sc.TextGui("",{font:sc.fontsystem.tinyFont});this.text.setPos(0,1);this.text.setAlign(ig.GUI_ALIGN.X_CENTER,ig.GUI_ALIGN.Y_TOP);this.addChildGui(this.text)},addObservers:function(){sc.Model.addObserver(sc.menu,this)},removeObservers:function(){sc.Model.removeObserver(sc.menu,
this)},showMenu:function(){this.text.setText(ig.lang.get("sc.gui.menu.map-menu.area")+sc.map.getCurrentAreaName());var a=this.text.hook;this.setSize(a.size.x+6,a.size.y+2);this.setStateValue("HIDDEN","offsetX",-(a.size.x+2));this.doStateTransition("DEFAULT")},exitMenu:function(){this.doStateTransition("HIDDEN")},modelChanged:function(a,b,c){a==sc.menu&&(b==sc.MENU_EVENT.MAP_WORLDMAP_STATE?c?this.exitMenu():this.showMenu():b==sc.MENU_EVENT.MAP_AREA_LOAD_DONE&&this.showMenu())}});var c=["black","red",
"green","blue","yellow","pink","cyan","orange","purple","wheat"];sc.DebugFloorView=sc.MenuPanel.extend({transitions:{DEFAULT:{state:{},time:0.2,timeFunction:KEY_SPLINES.LINEAR},HIDDEN:{state:{alpha:0},time:0.2,timeFunction:KEY_SPLINES.LINEAR}},floor:null,init:function(){this.parent();if(sc.map.getCurrentArea()){this.floor=sc.map.getCurrentArea().floors;this.doStateTransition("HIDDEN",true)}},updateDrawables:function(a){this.parent(a);if(this.floor)for(var b=this.floor.length,d=null,h=0;b--;){for(var d=
this.floor[b].tiles,i=0;i<d.length;i++)for(var j=0;j<d[0].length;j++)d[i][j]&&a.addColor(c[d[i][j]%c.length],j*4,i*4+h,4,4);h=h+(d.length*4+4)}}})});ig.baked=!0;
ig.module("game.feature.menu.gui.map.map-stamp").requires("impact.feature.gui.gui","impact.feature.gui.base.basic-gui","game.feature.gui.base.numbers","game.feature.menu.gui.menu-misc").defines(function(){var b=0,a=0,d=0,c=0;sc.MAP_STAMPS={DEFAULT:{icon:0},CHEST:{icon:1},ENEMY:{icon:2},GREEN:{icon:3},SECRET:{icon:4},QUEST:{icon:5},UNKNOWN:{icon:6},XXX:{icon:7},ARROW_RIGHT:{icon:15},ARROW_LEFT:{icon:16},ARROW_UP:{icon:17},ARROW_DOWN:{icon:18},ARROW_DOWN_RIGHT:{icon:19},ARROW_DOWN_LEFT:{icon:20},ARROW_UP_RIGHT:{icon:21},
ARROW_UP_LEFT:{icon:22}};sc.StampGui=ig.FocusGui.extend({gfx:new ig.Image("media/gui/menu.png"),key:"DEFAULT",icon:{x:0,y:0},floor:0,floorGui:null,name:"",index:-1,activated:true,init:function(a,b,c,d,i,j){this.parent();this.setSize(8,8);this.setPos(b-4,c-4);this.floorGui=j;this.index=i;this.key=a||"DEFAULT";a=sc.MAP_STAMPS[this.key].icon;this.icon.x=a%15;this.icon.y=~~(a/15);this.floor=d||0;this.name=ig.lang.get("sc.gui.menu.map-menu.stamps."+this.key)},setKey:function(a){this.key=a||"DEFAULT";a=
sc.MAP_STAMPS[this.key].icon;this.icon.x=a%15;this.icon.y=~~(a/15);this.name=ig.lang.get("sc.gui.menu.map-menu.stamps."+this.key)},updateDrawables:function(a){a.addGfx(this.gfx,1,1,56+this.icon.x*8,288+this.icon.y*8,8,8)},isMouseOver:function(){if(!(this.floor!=sc.map.currentFloor||sc.menu.mapWorldmapActive||ig.interact.isBlocked()||sc.menu.mapStampMenu)){if(sc.menu.mapDrag)return sc.menu.mapMapFocus==this;if(ig.input.currentDevice==ig.INPUT_DEVICES.GAMEPAD){var a=this.getDistanceToCursor();if(sc.menu.mapCursorMoved){sc.menu.unfocusMap(this);
return false}if(a<=6){a=this.hook;sc.menu.focusMap(a.pos.x+Math.floor(a.size.x/2)+sc.menu.mapAreaOffset.x,a.pos.y+Math.floor(a.size.y/2)+1+sc.menu.mapAreaOffset.y,this,true)}else sc.menu.unfocusMap(this)}else if(ig.input.currentDevice==ig.INPUT_DEVICES.KEYBOARD_AND_MOUSE){var b=Math.floor(sc.control.getMouseX()),g=Math.floor(sc.control.getMouseY());if(g<=21||g>=299){sc.menu.unfocusMap(this);return false}a=this.hook;d=a.screenCoords.x;c=a.screenCoords.y;(b=b>=d&&b<=d+7&&g>=c&&g<=c+8)?sc.menu.focusMap(a.pos.x+
Math.floor(a.size.x/2)+sc.menu.mapAreaOffset.x,a.pos.y+Math.floor(a.size.y/2)+1+sc.menu.mapAreaOffset.y,this):sc.menu.unfocusMap(this);return b}return false}},getDistanceToCursor:function(){return Math.floor(Vec2.distanceC(sc.menu.mapCursor.x-sc.menu.mapAreaOffset.x,sc.menu.mapCursor.y-sc.menu.mapAreaOffset.y,this.hook.pos.x+Math.floor(this.hook.size.x/2),this.hook.pos.y+Math.floor(this.hook.size.y/2)))}});sc.StampEditMenu=ig.BoxGui.extend({transitions:{DEFAULT:{state:{},time:0.1,timeFunction:KEY_SPLINES.LINEAR},
HIDDEN:{state:{alpha:0,scaleY:0},time:0.1,timeFunction:KEY_SPLINES.LINEAR}},ninepatch:new ig.NinePatch("media/gui/menu.png",{width:6,height:6,left:9,top:9,right:9,bottom:9,offsets:{"default":{x:432,y:304}}}),"delete":null,anchor:null,stamps:[],buttongroup:null,_active:false,init:function(){this.parent(70,111);this.delete=new sc.ButtonGui(ig.lang.get("sc.gui.menu.map-menu.delete"),64,true,sc.BUTTON_TYPE.ITEM);this.delete.setPos(3,3);this.delete.data={"delete":true};this.delete.textChild.setAlign(ig.GUI_ALIGN.X_CENTER,
ig.GUI_ALIGN.Y_CENTER);this.delete.textChild.setPos(0,0);this.addChildGui(this.delete);this.buttongroup=new sc.ButtonGroup;this.buttongroup.soundsOnPressed=true;this.buttongroup.addSelectionCallback(function(){}.bind(this));this.buttongroup.addPressCallback(function(a){if(a.data.delete){sc.menu.removeStamp(sc.map.currentArea.path,this.anchor.index);sc.menu.unfocusMap(this.anchor);sc.menu.popBackCallback();this.anchor.floorGui.removeChildGui(this.anchor);this.hide()}else if(a.data.stamp){this.anchor.setKey(a.key);
sc.menu.editStamp(this.anchor.index,sc.map.currentArea.path,a.key);sc.menu.unfocusMap(this.anchor);sc.menu.popBackCallback();this.hide()}}.bind(this));this.buttongroup.addFocusGui(this.delete,0,0);this.createStamps();this.buttongroup.fillEmptySpace();this.doStateTransition("HIDDEN",true)},show:function(c){if(!this._active){this._active=true;sc.menu.mapDrag=false;this.hook.currentStateName=="DEFAULT"&&this.doStateTransition("HIDDEN",true);this.anchor=c;sc.menu.mapStampMenu=true;sc.menu.buttonInteract.pushButtonGroup(this.buttongroup);
sc.menu.pushBackCallback(this.onBackPressed.bind(this));c=c.hook;this.limitPosition(c.pos.x+sc.menu.mapAreaOffset.x+sc.menu.mapCamera.x-70-2,c.pos.y+sc.menu.mapAreaOffset.y+sc.menu.mapCamera.y+3);this.setPos(b,a);this.unPressAllButtons();this.pressCurrentStamp(this.anchor.key);ig.input.currentDevice!=ig.INPUT_DEVICES.GAMEPAD?this.buttongroup.setCurrentFocus(0,0):this.buttongroup.focusCurrentButton(0,0,false,true);this.doStateTransition("DEFAULT")}},hide:function(a){if(this._active){this._active=false;
a&&sc.menu.popBackCallback();sc.menu.mapStampMenu=false;sc.menu.buttonInteract.removeButtonGroup(this.buttongroup);this.doStateTransition("HIDDEN")}},createStamps:function(){var a=3,b=25,c=0,d=1,i=0,j;for(j in sc.MAP_STAMPS){var k=new sc.StampMenuButton(j);k.data={stamp:true};k.setPos(a,b);this.addChildGui(k);this.buttongroup.addFocusGui(k,c,d);this.stamps[i]=k;c++;a=a+16;i++;if(c>=4){c=0;d++;a=3;b=b+21}}},limitPosition:function(c,d){b=c;a=d;b<1&&(c=c+80);a+111>=298&&(d=d-111);b=c;a=d},unPressAllButtons:function(){for(var a=
this.stamps.length;a--;)this.stamps[a].setPressed(false)},pressCurrentStamp:function(a){for(var b=this.stamps.length;b--;)a==this.stamps[b].key&&this.buttongroup.setPressedFocusGui(this.stamps[b])},updateDrawables:function(a){this.parent(a);a.addColor("#292b2f",2,23,66,1)},onBackPressed:function(){sc.menu.popBackCallback();this.hide()}});sc.StampMenuButton=sc.ButtonGui.extend({icons:new ig.Image("media/gui/menu.png"),key:"DEFAULT",icon:{x:0,y:0},iconGui:null,init:function(a){this.parent("",16,true,
sc.BUTTON_TYPE.GROUP,null,true);this.noFocusOnPressed=true;this.key=a||"DEFAULT";a=sc.MAP_STAMPS[a].icon;this.icon.x=a%15;this.icon.y=~~(a/15);this.iconGui=new ig.ImageGui(this.icons,56+this.icon.x*8,288+this.icon.y*8,8,8);this.iconGui.setAlign(ig.GUI_ALIGN.X_CENTER,ig.GUI_ALIGN.Y_CENTER);this.addChildGui(this.iconGui)}})});ig.baked=!0;
ig.module("game.feature.menu.gui.map.map-floor").requires("impact.feature.gui.gui","impact.feature.gui.base.basic-gui","game.feature.menu.area-loadable").defines(function(){function b(a,b,d,h,i){e=sc.AREA_CONNECTIONS[h.dir];f=i?e.second:e.first;if(h.offset){g.x=h.offset.x;g.y=h.offset.y}else{g.x=0;g.y=0}c.x=a;c.y=b;a=Math.max(0,h.size-1);d.draw(c.x+f.ox+g.x,c.y+f.oy+g.y,f.x,f.y,f.w2,f.h2);c.x=c.x+e.step.x;for(c.y=c.y+e.step.y;a--;){d.draw(c.x+f.ox+g.x,c.y+f.oy+g.y,281,411,f.w,f.h);c.x=c.x+e.step.x2;
c.y=c.y+e.step.y2}d.draw(c.x+f.ox+g.x,c.y+f.oy+g.y,f.x+e.step.x,f.y+e.step.y,f.w2,f.h2)}function a(a,b,d,e){e.fill&&d.draw(a,b,284,412,8,8);if(e.offset){c.x=e.offset.x;c.y=e.offset.y}else{c.x=0;c.y=0}d.draw(a+c.x,b+c.y,e.src.x,e.src.y,e.size[0],e.size[1]);e.src2&&d.draw(a+e.offset2.x,b+e.offset2.y,e.src2.x,e.src2.y,e.size[2],e.size[3])}function d(a,b,c,d){return a<0||b<0||a>=c[0].length||b>=c.length?0:c[b][a]==d?1:0}sc.MapRoom=ig.GuiElementBase.extend({gfx:new ig.Image("media/gui/menu.png"),room:null,
buffer:null,floor:null,name:"default_empty",id:0,roomAlpha:1,tileWidth:0,tileHeight:0,active:false,unlocked:false,prerendered:false,init:function(a,b,c){this.parent();this.room=a;this.name=a.name.toCamel().toPath("","");this.unlocked=ig.vars.storage.maps[this.name]?true:false;this.floor=b;this.id=c;b=a.name==sc.map.currentMap;a.zMin!=void 0&&(b=b&&ig.game.playerEntity.coll.level>=a.zMin);a.zMax!=void 0&&(b=b&&ig.game.playerEntity.coll.level<=a.zMax);this.active=b;this.tileWidth=Math.max(0,a.max.x-
a.min.x);this.tileHeight=Math.max(0,a.max.y-a.min.y);this.setPos(a.min.x*8,a.min.y*8);this.setSize(this.tileWidth*8,this.tileHeight*8)},onVisibilityChange:function(a){a?this.preRender():this.clearPrerendered()},onDetach:function(){this.clearPrerendered()},updateDrawables:function(a){this.prerendered&&a.addGfx(this.buffer,0,0,0,0).setAlpha(this.roomAlpha)},preRender:function(){if(!this.prerendered&&this.unlocked){this.buffer=ig.imageAtlas.getFragment(this.tileWidth*8,this.tileHeight*8,function(){for(var c=
this.room,e=this.floor.tiles,f=this.floor.connections,g=this.gfx,p=this.active,r=c.id,t=0,q=0,s=null,v=0,y=0,u=true,z=null,D=h,C=ig.system.context,A=[],B=c.min.y;B<c.max.y;B++){for(var t=0,w=c.min.x;w<c.max.x;w++){if(e[B][w]==r){for(v=0;v<D.length;++v)A[v]=d(w+D[v].x,B+D[v].y,e,r);for(v=j.length;v--;){z=j[v];s=z.check;u=true;for(y=i.length;y--;)if(s[y]!=A[i[y]]){u=false;break}if(u){a(t,q,g,z);break}}for(v=k.length;v--;){z=k[v];s=z.check;u=true;for(y=A.length;y--;)if(s[y]!=-1&&s[y]!=A[y]){u=false;
break}u&&a(t,q,g,z)}}t=t+8}q=q+8}v=f.length;for(t=new ig.VarCondition("");v--;){s=f[v];if(s.map1+1==r||s.map2+1==r)if(s.condition!=void 0){t.setCondition(s.condition);t.evaluate()&&b((s.tx-c.min.x)*8,(s.ty-c.min.y)*8,g,s,s.map2+1==r)}else b((s.tx-c.min.x)*8,(s.ty-c.min.y)*8,g,s,s.map2+1==r)}if(p){q=0;for(B=c.min.y;B<c.max.y;B++){t=0;for(w=c.min.x;w<c.max.x;w++){if(e[B][w]==r){f=t;p=q;s=g;v=C;y=d(w+1,B,e,r)!=1;u=d(w,B+1,e,r)!=1;z=v.globalAlpha;v.globalAlpha=v.globalAlpha*0.3;s.draw(f,p,292,436,8-(y?
1:0),8-(u?1:0));v.globalAlpha=z}t=t+8}q=q+8}}}.bind(this));this.prerendered=true}},clearPrerendered:function(){if(this.prerendered){this.buffer.release();this.buffer=null;this.prerendered=false}}});sc.MapIcon=ig.GuiElementBase.extend({gfx:new ig.Image("media/gui/area-icons.png"),offsetX:0,offsetY:0,map:0,icon:"",init:function(a,b,c,d,e){this.parent();var f=Math.floor(this.gfx.width/12);this.icon=sc.AREA_ICONS[c]||sc.AREA_ICONS.arrow_up;var g=this.icon.index;this.map=d||null;this.offsetX=g%f*12;this.offsetY=
Math.floor(g/f)*12;this.setPos(a-6,b-6);this.setSize(12,12);d=this.icon.type;if(d==sc.AREA_ICON_TYPE.LARGE){this.setPos(a-this.icon.width/2,b-this.icon.height/2);this.setSize(this.icon.width,this.icon.height)}e&&this.map&&this.map.unlocked&&d==sc.AREA_ICON_TYPE.AREA&&e.area&&this.createAreaName(e,c,a,b)},updateDrawables:function(a){this.map&&this.map.unlocked&&(this.icon.type==sc.AREA_ICON_TYPE.LARGE?a.addGfx(this.gfx,0,0,this.icon.sx,this.icon.sy,this.icon.width,this.icon.height):a.addGfx(this.gfx,
this.hook.size.x/2-6,0,this.offsetX,this.offsetY,12,12))},createAreaName:function(a,b,c,d){var e="???";a.map&&ig.vars.storage.maps[a.map.toCamel().toPath("","")]&&(e=sc.map.getAreaName(a.area));var f=new ig.ColorGui("black");f.hook.localAlpha=0.5;e=new sc.TextGui(e,{font:sc.fontsystem.tinyFont});e.setAlign(ig.GUI_ALIGN.X_CENTER,ig.GUI_ALIGN.Y_CENTER);f.setSize(e.hook.size.x+4,e.hook.size.y+2);switch(b){case "area_up":f.setPos(0,-(f.hook.size.y+1));f.setAlign(ig.GUI_ALIGN.X_CENTER,ig.GUI_ALIGN.Y_TOP);
break;case "area_down":f.setPos(0,13);f.setAlign(ig.GUI_ALIGN.X_CENTER,ig.GUI_ALIGN.Y_TOP);break;case "area_left":f.setPos(f.hook.size.x/2-6-(f.hook.size.x+1),1);f.setAlign(ig.GUI_ALIGN.X_LEFT,ig.GUI_ALIGN.Y_CENTER);break;case "area_right":f.setPos(f.hook.size.x/2-6+13,1);f.setAlign(ig.GUI_ALIGN.X_LEFT,ig.GUI_ALIGN.Y_CENTER)}if(a.offset){f.hook.pos.x=f.hook.pos.x+a.offset.x;f.hook.pos.y=f.hook.pos.y+a.offset.y}f.addChildGui(e);this.addChildGui(f);this.setSize(f.hook.size.x,f.hook.size.y);this.setPos(c-
this.hook.size.x/2,d-6)}});sc.MapFloor=ig.GuiElementBase.extend({transitions:{DEFAULT:{state:{},time:0.4,timeFunction:KEY_SPLINES.LINEAR},HIDDEN:{state:{alpha:0},time:0.2,timeFunction:KEY_SPLINES.LINEAR},HIDDEN_FAST:{state:{alpha:0},time:0.4,timeFunction:KEY_SPLINES.LINEAR}},floor:null,name:"",nameGui:null,leaGui:null,rooms:null,activeRoom:null,callback:null,bounds:{x:1E5,y:1E5,width:-1,height:-1},init:function(a,b){this.parent();this.callback=b||null;this.floor=a;this.name=a.name?ig.LangLabel.getText(a.name):
"";this.rooms=this.floor.rooms;this.setPos(0,0);this.setSize(a.tiles[0].length*8,a.tiles.length*8);this.doStateTransition("HIDDEN",true)},onAttach:function(){var a=this._createRooms();if(this.activeRoom){this.leaGui=new sc.MapCurrentRoomWrapper(this.activeRoom);this.addChildGui(this.leaGui)}this._createIcons(a);this.callback&&this.callback(true,this,a)},update:function(){},updateDrawables:function(){},showFloor:function(){this.addObservers();this.doStateTransition("DEFAULT");this.calculateOpacity(true,
true)},hideFloor:function(){this.removeObservers();this.doStateTransition("HIDDEN")},calculateOpacity:function(a,b){sc.map.currentFloor!=this.floor.level?this.doStateTransition("HIDDEN_FAST",a):b||this.doStateTransition("DEFAULT",a)},calculatePosOffset:function(){this.doPosTranstition(this.hook.pos.x,(sc.map.currentFloor-this.floor.level)*8,0.3,KEY_SPLINES.EASE)},addObservers:function(){sc.Model.addObserver(sc.menu,this)},removeObservers:function(){sc.Model.removeObserver(sc.menu,this)},modelChanged:function(a,
b){if(a==sc.menu&&b==sc.MENU_EVENT.MAP_CHANGED_FLOOR){this.calculatePosOffset();this.calculateOpacity(false)}},_updateAlphaOnRooms:function(){for(var a=this.hook.children,b=a.length;b--;)if(a[b].gui.roomAlpha!=void 0)a[b].gui.roomAlpha=this._alpha},_createIcons:function(a){for(var b=null,b=null,c=this.floor.icons,d=c.length,e=new ig.VarCondition;d--;){var b=c[d],f=b.data?b.data.condition:null;if(f){e.setCondition(f);if(!e.evaluate())continue}b=new sc.MapIcon(b.x,b.y,b.icon,a[b.map],b.data);this.addChildGui(b)}},
_createRooms:function(){for(var a=null,b=null,c=[],d=[],e=0;e<this.rooms.length;e++)if(a=this.rooms[e]){b=new sc.MapRoom(a,this.floor,this.floor.level);if(b.active){this.activeRoom=b.hook;d.push(b.hook)}if(b.unlocked){if(b.hook.pos.y<this.bounds.y)this.bounds.y=b.hook.pos.y;if(b.hook.pos.y<this.bounds.x)this.bounds.x=b.hook.pos.x;if(b.hook.pos.x+b.hook.size.x>this.bounds.width)this.bounds.width=b.hook.pos.x+b.hook.size.x;if(b.hook.pos.y+b.hook.size.y>this.bounds.height)this.bounds.height=b.hook.pos.y+
b.hook.size.y}c[a.id-1]=b}if(d.length>=2){a=new ig.GuiElementBase;d=this.getBounds(d);a.hook.pos.x=d.x;a.hook.pos.y=d.y;a.hook.size.x=d.width;a.hook.size.y=d.height;this.activeRoom=a.hook}for(e=0;e<c.length;e++)c[e]&&c[e].unlocked&&this.addChildGui(c[e]);this.bounds.width=this.bounds.width-this.bounds.x;this.bounds.height=this.bounds.height-this.bounds.y;return c},getBounds:function(a){for(var b=0,c=0,d=0,e=0,b=a[0].pos.x,c=a[0].pos.y,d=b+a[0].size.x,e=c+a[0].size.y,f=1;f<a.length;f++){if(a[f].pos.x<
b)b=a[f].pos.x;if(a[f].pos.y<c)c=a[f].pos.y;a[f].pos.x+a[f].size.x>d&&(d=a[f].pos.x+a[f].size.x);a[f].pos.y+a[f].size.y>e&&(e=a[f].pos.y+a[f].size.y)}return{x:b,y:c,width:d-b,height:e-c}}});var c=Vec2.createC(0,0),e=null,f=false,g=Vec2.createC(0,0),h=[{x:-1,y:-1},{x:0,y:-1},{x:1,y:-1},{x:-1,y:0},{x:1,y:0},{x:-1,y:1},{x:0,y:1},{x:1,y:1}],i=[1,3,4,6],j=[{check:[0,0,0,0],src:{x:304,y:408},size:[8,8],fill:false},{check:[1,1,1,1],src:{x:284,y:412},size:[8,8],fill:false},{check:[0,0,1,1],src:{x:280,y:408},
size:[8,8],fill:false},{check:[0,1,0,1],src:{x:288,y:408},size:[8,8],fill:false},{check:[1,0,1,0],src:{x:280,y:416},size:[8,8],fill:false},{check:[1,1,0,0],src:{x:288,y:416},size:[8,8],fill:false},{check:[1,0,1,1],src:{x:280,y:412},size:[8,8],fill:false},{check:[1,1,0,1],src:{x:288,y:412},size:[8,8],fill:false},{check:[1,1,1,0],src:{x:284,y:416},size:[8,8],fill:false},{check:[0,1,1,1],src:{x:284,y:408},size:[8,8],fill:false},{check:[0,1,1,0],src:{x:284,y:408},size:[8,4,8,4],src2:{x:284,y:420},offset2:{x:0,
y:4},fill:false},{check:[1,0,0,1],src:{x:280,y:412},size:[4,8,4,8],src2:{x:292,y:412},offset2:{x:4,y:0},fill:false},{check:[0,1,0,0],src:{x:288,y:408},size:[8,4,8,4],src2:{x:288,y:420},offset2:{x:0,y:4},fill:false},{check:[0,0,1,0],src:{x:280,y:408},size:[8,4,8,4],src2:{x:280,y:420},offset2:{x:0,y:4},fill:false},{check:[0,0,0,1],src:{x:280,y:408},size:[4,8,4,8],src2:{x:292,y:408},offset2:{x:4,y:0},fill:false},{check:[1,0,0,0],src:{x:280,y:416},size:[4,8,4,8],src2:{x:292,y:416},offset2:{x:4,y:0},fill:false}],
k=[{check:[-1,-1,-1,1,-1,0,1,-1],src:{x:296,y:412},size:[4,4],offset:{x:0,y:4}},{check:[-1,-1,-1,-1,1,-1,1,0],src:{x:300,y:412},size:[4,4],offset:{x:4,y:4}},{check:[0,1,-1,1,-1,-1,-1,-1],src:{x:296,y:408},size:[4,4],offset:{x:0,y:0}},{check:[-1,1,0,-1,1,-1,-1,-1],src:{x:300,y:408},size:[4,4],offset:{x:4,y:0}}]});ig.baked=!0;
ig.module("game.feature.menu.gui.map.map-area").requires("impact.feature.gui.gui","impact.feature.gui.base.basic-gui","game.feature.menu.gui.map.map-floor","game.feature.menu.gui.map.map-misc").defines(function(){var b=0,a=0,d=Vec2.createC(0,0),c=sc.BUTTON_SOUND.submit,e=sc.BUTTON_SOUND.denied;sc.MapArea=ig.GuiElementBase.extend({transitions:{DEFAULT:{state:{},time:0.2,timeFunction:KEY_SPLINES.LINEAR},HIDDEN:{state:{alpha:0},time:0.2,timeFunction:KEY_SPLINES.LINEAR}},init:function(){this.parent();
b=Math.floor(ig.system.width/2);a=Math.floor(ig.system.height/2)},updateDrawables:function(){}});sc.MapAreaContainer=ig.GuiElementBase.extend({gfx:new ig.Image("media/gui/menu.png"),background:new ig.Image("media/gui/env-white.png"),transitions:{DEFAULT:{state:{},time:0.2,timeFunction:KEY_SPLINES.LINEAR},HIDDEN:{state:{alpha:0},time:0.2,timeFunction:KEY_SPLINES.LINEAR},HIDDEN_WORLD:{state:{alpha:1,scaleX:0.5,scaleY:0.5,angle:0.5},time:0.2,timeFunction:KEY_SPLINES.LINEAR}},area:null,buttongroup:null,
_lastMousePos:Vec2.createC(0,0),_cursorPos:Vec2.createC(-1E4,-1E4),_dragTimer:0,_delayedDrag:false,_alphaTimer:0.1,_alphaTime:0.5,_alpha:0,_firstVisit:false,_prevFloor:-100,_vertOffset:0,_vertOffsetTarget:0,_vertOffsetStart:0,_vertOffsetCurrent:0,_vertOffsetTimer:0,_vertOffsetTime:0.3,_areaCache:{},_gamepadActive:false,_lastDevice:0,mapNameGui:null,hoverRoom:null,cursor:null,landmarks:[],stamps:[],init:function(){this.parent();this.setSize(ig.system.width,ig.system.height);this.setPivot(ig.system.width/
2,ig.system.height/2);if(!this.constructor.PATTERN){this.constructor.PATTERN=this.gfx.createPattern(440,400,32,32,ig.ImagePattern.OPT.REPEAT_X_AND_Y);this.constructor.PATTERN2=this.gfx.createPattern(472,400,32,32,ig.ImagePattern.OPT.REPEAT_X_AND_Y)}this.hook.setMouseRecord(true);this.area=new sc.MapArea;this.addChildGui(this.area);this.cursor=new sc.MapCursor;this.addChildGui(this.cursor);this.mapNameGui=new sc.MapNameGui;this.addChildGui(this.mapNameGui);this.buttongroup=new sc.MouseButtonGroup;
this.buttongroup.ignoreActiveFocus=true;this.buttongroup.addSelectionCallback(function(a){a.data?sc.menu.setInfoText(a.data):a.description?sc.menu.setInfoText(a.description):sc.menu.setInfoText("",true)});this.buttongroup.setMouseFocusLostCallback(function(){sc.menu.setInfoText("",true)});this.buttongroup.addPressCallback(function(a){this.onLandmarkPressed(a)}.bind(this));this.buttongroup.onButtonTraversal=function(){if(ig.input.currentDevice==ig.INPUT_DEVICES.GAMEPAD&&sc.control.menuConfirm()&&sc.menu.mapMapFocus)this.onLandmarkPressed(sc.menu.mapMapFocus)}.bind(this);
this.setArea();this.calculateScrollingOffset(true);this.limitCameraPos();this.doStateTransition("HIDDEN",true)},update:function(){sc.menu.mapCursorMoved=false;if(this._alphaTimer<this._alphaTime){this._alphaTimer=this._alphaTimer+ig.system.tick;if(this._alphaTimer>=this._alphaTime){this._alphaTimer=this._alphaTime;this._alpha=1}else this._alpha=this._alphaTimer/this._alphaTime}if(!sc.menu.mapLoading){if(this._vertOffsetTimer<this._vertOffsetTime){this._vertOffsetTimer=this._vertOffsetTimer+ig.system.tick;
var a=Math.min(1,Math.max(0,this._vertOffsetTimer)/this._vertOffsetTime),a=KEY_SPLINES.EASE.get(a);this._vertOffset=this._vertOffsetStart*(1-a)+this._vertOffsetTarget*a;if(a==1)this._vertOffsetTimer=this._vertOffsetTime}if(!ig.interact.isBlocked()&&this.buttongroup.isActive()&&!sc.menu.mapStampMenu){if(this._lastDevice!=ig.input.currentDevice){this._gamepadActive=ig.input.currentDevice==ig.INPUT_DEVICES.GAMEPAD;this._lastDevice=ig.input.currentDevice;a=null;if(ig.input.currentDevice==ig.INPUT_DEVICES.GAMEPAD){a=
this._cursorPos;this.initCursor(a);sc.menu.mapCursor.x=a.x;sc.menu.mapCursor.y=a.y;this.limitCursorPos();sc.menu.mapCamera.x=Math.floor(-a.x+ig.system.width/2);sc.menu.mapCamera.y=Math.floor(-a.y+ig.system.height/2);this.limitCameraPos();this.doScrollTransition(sc.menu.mapCamera.x,sc.menu.mapCamera.y,0.3,KEY_SPLINES.EASE);this.cursor.moveTo(sc.menu.mapCursor.x,sc.menu.mapCursor.y);if(sc.menu.mapMapFocus)this.hoverRoom=sc.menu.mapMapFocus=null;this.findMap(sc.menu.mapCursor.x,sc.menu.mapCursor.y,true)}else if(ig.input.currentDevice==
ig.INPUT_DEVICES.KEYBOARD_AND_MOUSE){this._cursorPos.x=sc.menu.mapCursor.x;this._cursorPos.y=sc.menu.mapCursor.y;this.cursor.unfocus();this.findMap(sc.control.getMouseX(),sc.control.getMouseY())}sc.menu.toggledInputMode()}a=false;if(!this.hook.scrollTransition){if(sc.control.menuSkillLeft(0.5)){sc.menu.mapCamera.x=sc.menu.mapCamera.x+250*ig.system.actualTick;this.limitCameraPos();this.hook.scroll.x=sc.menu.mapCamera.x;a=true}else if(sc.control.menuSkillRight(0.5)){sc.menu.mapCamera.x=sc.menu.mapCamera.x-
250*ig.system.actualTick;this.limitCameraPos();this.hook.scroll.x=sc.menu.mapCamera.x;a=true}if(sc.control.menuSkillUp(0.5)){sc.menu.mapCamera.y=sc.menu.mapCamera.y+250*ig.system.actualTick;this.limitCameraPos();this.hook.scroll.y=sc.menu.mapCamera.y;a=true}else if(sc.control.menuSkillDown(0.5)){sc.menu.mapCamera.y=sc.menu.mapCamera.y-250*ig.system.actualTick;this.limitCameraPos();this.hook.scroll.y=sc.menu.mapCamera.y;a=true}}if(!a&&ig.input.currentDevice==ig.INPUT_DEVICES.GAMEPAD){var b=0,c=0,e=
0;if((e=sc.control.getAxesValue(ig.AXES.LEFT_STICK_X))<-0.5){b=(-150+e*100)*ig.system.actualTick;a=true}else if((e=sc.control.getAxesValue(ig.AXES.LEFT_STICK_X))>0.5){b=(150+e*100)*ig.system.actualTick;a=true}if((e=sc.control.getAxesValue(ig.AXES.LEFT_STICK_Y))<-0.5){c=(-150+e*100)*ig.system.actualTick;a=true}else if((e=sc.control.getAxesValue(ig.AXES.LEFT_STICK_Y))>0.5){c=(150+e*100)*ig.system.actualTick;a=true}if(a){sc.menu.mapCursorMoved=true;sc.menu.mapCursor.x=b>=0?Math.floor(sc.menu.mapCursor.x+
b):Math.ceil(sc.menu.mapCursor.x+b);sc.menu.mapCursor.y=c>=0?Math.floor(sc.menu.mapCursor.y+c):Math.ceil(sc.menu.mapCursor.y+c);this.limitCursorPos();this.findMap(sc.menu.mapCursor.x,sc.menu.mapCursor.y,true);this.cursor.moveTo(sc.menu.mapCursor.x,sc.menu.mapCursor.y);d.x=sc.menu.mapCamera.x;d.y=sc.menu.mapCamera.y;sc.menu.mapCamera.x=Math.floor(-sc.menu.mapCursor.x+ig.system.width/2);sc.menu.mapCamera.y=Math.floor(-sc.menu.mapCursor.y+ig.system.height/2);this.limitCameraPos()}a=false;if(Math.abs(sc.menu.mapCamera.x-
d.x)>=18||Math.abs(sc.menu.mapCamera.y-d.y)>=18)a=true;if(this.hook.scrollTransition){this.hook.scrollTransition.x=sc.menu.mapCamera.x;this.hook.scrollTransition.y=sc.menu.mapCamera.y}else if(a)this.doScrollTransition(sc.menu.mapCamera.x,sc.menu.mapCamera.y,0.3,KEY_SPLINES.LINEAR);else{this.hook.scroll.x=sc.menu.mapCamera.x;this.hook.scroll.y=sc.menu.mapCamera.y}}}}},updateDrawables:function(a){var b=this.hook;if(b.hasTransition())a.addPattern(this.constructor.PATTERN2,-512,-512,-b.scroll.x,-b.scroll.y+
this._vertOffset,2064,2064);else{a.addColor("#154453",0,0,b.size.x,b.size.y);a.addGfx(this.background,0,0).setAlpha(0.3*this._alpha);a.addGfx(this.background,b.size.x-this.background.width,0,0,0,void 0,void 0,true).setAlpha(0.3*this._alpha);a.addPattern(this.constructor.PATTERN,0,0,-b.scroll.x,-b.scroll.y+this._vertOffset,b.size.x,b.size.y)}},onMouseInteract:function(a,b){if(!ig.interact.isBlocked()&&!b&&sc.map.getCurrentArea()&&this.buttongroup.isActive()&&!sc.menu.mapLoading&&!sc.menu.mapStampMenu)if(sc.menu.mapMouseOverFloorButtons)if(a&&
sc.control.getGuiPressed()){sc.menu.mapMouseOverFloorButtons=false;sc.menu.unfocusMap(sc.menu.mapMapFocus);this._delayedDrag=true}else{if(a)sc.menu.mapMouseOverFloorButtons=false;else{this.hoverRoom=null;this.mapNameGui.setText("")}sc.menu.mapDrag=false}else{var c=Math.floor(sc.control.getMouseX()),d=Math.floor(sc.control.getMouseY());ig.input.currentDevice!=ig.INPUT_DEVICES.GAMEPAD&&this.findMap(sc.control.getMouseX(),sc.control.getMouseY());if(sc.control.getGuiPressed()||this._delayedDrag){this._delayedDrag=
false;Vec2.assignC(this._lastMousePos,c,d);sc.menu.mapDrag=true;this._dragTimer=0;ig.input.currentDevice!=ig.INPUT_DEVICES.GAMEPAD&&this.findMap(sc.control.getMouseX(),sc.control.getMouseY())}else if(sc.control.getGuiHold()){if(sc.menu.mapDrag){this._dragTimer=this._dragTimer+ig.system.actualTick;if(!sc.menu.mapWasDragged)sc.menu.mapWasDragged=(Math.abs(c-this._lastMousePos.x)>=1||Math.abs(d-this._lastMousePos.y)>=1)&&this._dragTimer>=0.1;sc.menu.mapCamera.x=sc.menu.mapCamera.x+(c-this._lastMousePos.x);
sc.menu.mapCamera.y=sc.menu.mapCamera.y+(d-this._lastMousePos.y);this.limitCameraPos();this.hook.scroll.x=sc.menu.mapCamera.x;this.hook.scroll.y=sc.menu.mapCamera.y;Vec2.assignC(this._lastMousePos,c,d);ig.input.currentDevice!=ig.INPUT_DEVICES.GAMEPAD&&this.findMap(sc.control.getMouseX(),sc.control.getMouseY())}}else sc.menu.mapDrag=false}},onLandmarkPressed:function(a){if(sc.menu.mapWasDragged)sc.menu.mapWasDragged=false;else if(a instanceof sc.StampGui){c.play();sc.menu.openStampMenu(a)}else if(a.activated){c.play();
var b=ig.lang.get("sc.gui.menu.map-menu.teleport"),b=ig.lang.grammarReplace(b,sc.map.getMapName(a.map.path));sc.Dialogs.showYesNoDialog(b,null,function(b){sc.menu.mapDrag=false;b.data==0&&sc.map.startTeleport(a.map)}.bind(this))}else e.play()},findMap:function(a,b,c,d){if(!sc.menu.mapMapFocus){var e=0,k=0;if(c){e=a-this.area.hook.pos.x;k=b-this.area.hook.pos.y}else{e=a-sc.menu.mapCamera.x-this.area.hook.pos.x+1;k=b-sc.menu.mapCamera.y-this.area.hook.pos.y+1}if(this.area.hook.children.length!=0&&this.area.hook.children[sc.map.getCurrentFloorIndex()]){var l=
sc.map.getCurrentArea(),o=l.floors[sc.map.getCurrentFloorIndex()].tiles,e=Math.min(Math.max(Math.floor(e/8),-1),l.width),m=Math.min(Math.max(Math.floor(k/8),-1),l.height);if(e>=l.width||e<=-1||m>=l.height||m<=-1){this.hoverRoom=null;this.mapNameGui.setText("");return false}k=false;l=l.floors[sc.map.getCurrentFloorIndex()].rooms;o=o[m][e];for(e=l.length;e--;)if(ig.vars.storage.maps[l[e].name.toCamel().toPath("","")]&&l[e].id==o){o=e;k=true;break}if(k){o=l[o];c?this.mapNameGui.setPos(sc.menu.mapCursor.x+
5,sc.menu.mapCursor.y-this.mapNameGui.hook.size.y-4):this.mapNameGui.setPos(a-sc.menu.mapCamera.x,b-sc.menu.mapCamera.y-this.mapNameGui.hook.size.y-1);if(this.hoverRoom!=o){this.hoverRoom=o;this.mapNameGui.setText(o.text,d)}return true}this.hoverRoom=null;this.mapNameGui.setText("");return false}}},showLandmarkName:function(a){a=a?a:"???";sc.menu.mapMapFocus.activated||(a="\\c[1]"+ig.lang.get("sc.gui.menu.map-menu.blocked")+"\\c[0]: "+a);this.mapNameGui.setText(a);var a=sc.menu.mapMapFocus.hook.pos.x,
b=sc.menu.mapMapFocus.hook.pos.y,b=b-(this.mapNameGui.hook.size.y-2);this.hoverRoom=sc.mapMapFocus;this.mapNameGui.setPos(a+15+sc.menu.mapAreaOffset.x,b+sc.menu.mapAreaOffset.y)},loadNewArea:function(a){this.doStateTransition("DEFAULT");sc.menu.setInfoText("",true);this.hoverRoom=null;this.mapNameGui.setText("");this.landmarks.length=0;this.stamps.length=0;var b=this._areaCache[sc.map.currentArea.path]||{x:-1E4,y:-1E4,cx:-1E4,cy:-1E4,floor:0};b.x=sc.menu.mapCursor.x;b.y=sc.menu.mapCursor.y;b.cx=sc.menu.mapCamera.x;
b.cy=sc.menu.mapCamera.y;b.floor=sc.map.currentFloor;this._areaCache[sc.map.currentArea.path]=b;for(var b=this.area.hook.children,c=b.length;c--;)b[c].gui.removeObservers();this.buttongroup.clear();this.area.removeAllChildren();this.area.doStateTransition("HIDDEN",true);sc.map.unloadCurrentArea();sc.map.loadArea(a,this)},onLoadableComplete:function(a,b){sc.map.loading=false;if(a){sc.menu.mapWasDragged=false;this.setArea();this._prevFloor=sc.map.currentFloor;if(this._lastDevice!=ig.input.currentDevice){this._gamepadActive=
ig.input.currentDevice==ig.INPUT_DEVICES.GAMEPAD;this._lastDevice=ig.input.currentDevice}var c=this._areaCache[b.path];c?sc.map.currentFloor=c.floor:sc.map.validateCurrentFloor();this.calculateScrollingOffset(true);this.centerCurrentPosition(true,false);if(c){this._cursorPos.x=c.x;this._cursorPos.y=c.y;sc.menu.mapCursor.x=c.x;sc.menu.mapCursor.y=c.y;sc.menu.mapCamera.x=c.cx;sc.menu.mapCamera.y=c.cy;this.limitCursorPos();this.cursor.moveTo(sc.menu.mapCursor.x,sc.menu.mapCursor.y,false);this.findMap(sc.menu.mapCursor.x,
sc.menu.mapCursor.y,true)}this._prevFloor=sc.map.currentFloor;this.limitCameraPos();this.doScrollTransition(sc.menu.mapCamera.x,sc.menu.mapCamera.y,0,KEY_SPLINES.LINEAR);this.area.doStateTransition("DEFAULT");ig.interact.setBlockDelay(0.2);sc.menu.setAreaLoadDone(b.path)}},setArea:function(){var a=sc.map.getCurrentArea();if(a){var b=this.area.hook,c=this.hook,d=a.floors;this.area.setSize(a.width*8,a.height*8);this.area.setPos(c.size.x/2-b.size.x/2,c.size.y/2-b.size.y/2);this.area.removeAllChildren();
sc.menu.mapAreaOffset.x=b.pos.x;sc.menu.mapAreaOffset.y=b.pos.y;sc.map.validateCurrentPlayerFloor();for(a=0;a<d.length;a++){b=new sc.MapFloor(d[a],this.createLandmarks.bind(this));this.area.addChildGui(b)}}},createLandmarks:function(a,b){if(a){var c=b.floor,d=c.landmarks,e=sc.map.currentArea.path;if(d)for(var k=d.length;k--;){var l=d[k].id;if(sc.map.isLandmarkActive(l,e)){l=new sc.LandmarkGui(l,d[k],c.level,c.maps[d[k].map],e);b.addChildGui(l);this.buttongroup.addFocusGui(l);this.landmarks.push(l)}}if(d=
sc.menu.getStamps(e))for(k=d.length;k--;)if(d[k]&&d[k].level==c.level){l=new sc.StampGui(d[k].key,d[k].x,d[k].y,d[k].level,k,b);b.addChildGui(l);this.buttongroup.addFocusGui(l);this.stamps.push(l)}}},addStamp:function(){var a=this.getCurrentFloorGui(),b=sc.map.currentArea.path;if(sc.menu.getStampCount(b)>=sc.MAP_STAMPS_MAX)sc.BUTTON_SOUND.denied.play();else if(a){var c=0,d=0;if(ig.input.currentDevice==ig.INPUT_DEVICES.GAMEPAD){c=sc.menu.mapCursor.x-sc.menu.mapAreaOffset.x;d=sc.menu.mapCursor.y-sc.menu.mapAreaOffset.y-
1}else{c=Math.floor(sc.control.getMouseX());d=Math.floor(sc.control.getMouseY());if(d<=22||d>=298){sc.BUTTON_SOUND.denied.play();return}c=c-(sc.menu.mapAreaOffset.x+sc.menu.mapCamera.x);d=d-(sc.menu.mapAreaOffset.y+sc.menu.mapCamera.y)}if(this.isSettable(a,c,d)){sc.BUTTON_SOUND.submit.play();b=sc.menu.addMapStamp(b,"DEFAULT",c,d,a.floor.level);c=new sc.StampGui("DEFAULT",c,d,a.floor.level,b,a);d=c.hook;a.addChildGui(c);this.buttongroup.addFocusGui(c);this.stamps.push(c);sc.menu.focusMap(d.pos.x+Math.floor(d.size.x/
2)+sc.menu.mapAreaOffset.x,d.pos.y+Math.floor(d.size.y/2)+1+sc.menu.mapAreaOffset.y,c,ig.input.currentDevice==ig.INPUT_DEVICES.GAMEPAD);sc.menu.openStampMenu(c)}else sc.BUTTON_SOUND.denied.play()}},isSettable:function(a,b,c){for(var a=a.hook.children,d=a.length;d--;){var e=a[d];if(e.gui instanceof sc.StampGui||e.gui instanceof sc.LandmarkGui)if(Vec2.distanceC(b,c,e.pos.x+e.size.x/2,e.pos.y+e.size.y/2)<=(e.gui instanceof sc.LandmarkGui?14:10))return false}return true},getCurrentFloorGui:function(){for(var a=
this.area.hook.children,b=a.length;b--;)if(a[b].gui.floor.level==sc.map.currentFloor)return a[b].gui;return null},centerCurrentPosition:function(a,b){for(var c=this.area.hook,d=null,e=null,k=c.children,l=k.length;l--;){a&&k[l].gui.showFloor();if(k[l].gui.floor.level==sc.map.currentFloor){d=k[l];e=k[l].gui.activeRoom}}if(ig.input.currentDevice==ig.INPUT_DEVICES.GAMEPAD){k=this._cursorPos;this.initCursor(k);if(e){k.x=c.pos.x+e.pos.x+e.size.x/2;k.y=c.pos.y+e.pos.y+e.size.y/2}else if(d){e=d.gui.bounds;
k.x=c.pos.x+c.size.x/2;k.y=c.pos.y+d.pos.y+d.size.y/2;k.x=c.pos.x+e.x+e.width/2;k.y=c.pos.y+e.y+e.height/2}else{k.x=c.pos.x+c.size.x/2;k.y=c.pos.y+c.size.y/2}sc.menu.mapCursor.x=k.x;sc.menu.mapCursor.y=k.y;this.cursor.moveTo(sc.menu.mapCursor.x,sc.menu.mapCursor.y,b,0.3);this.findMap(sc.menu.mapCursor.x,sc.menu.mapCursor.y,true,b?0.2:0);ig.interact.setBlockDelay(0.3);sc.menu.mapCamera.x=Math.floor(-k.x+ig.system.width/2);sc.menu.mapCamera.y=Math.floor(-k.y+ig.system.height/2)}else if(e){sc.menu.mapCamera.x=
-(c.pos.x+e.pos.x+e.size.x/2)+ig.system.width/2;sc.menu.mapCamera.y=-(c.pos.y+e.pos.y+e.size.y/2)+ig.system.height/2}else if(d){e=d.gui.bounds;sc.menu.mapCamera.x=-(c.pos.x+e.x+e.width/2)+ig.system.width/2;sc.menu.mapCamera.y=-(c.pos.y+e.y+e.height/2)+ig.system.height/2}else{sc.menu.mapCamera.x=-(ig.system.width/2-c.pos.x-c.size.x/2);sc.menu.mapCamera.y=-(ig.system.height/2-c.pos.y-c.size.y/2)}this.limitCameraPos()},limitCameraPos:function(){var c=this.area.hook,d=-sc.menu.mapCamera.x,e=c.pos.x;sc.menu.mapCamera.x=
-d.limit(e-b,e+(c.size.x-b));d=-sc.menu.mapCamera.y;e=c.pos.y;sc.menu.mapCamera.y=-d.limit(e-a,e+(c.size.y-a))},limitCursorPos:function(){var a=sc.menu.mapCursor.x;sc.menu.mapCursor.x=a.limit(this.area.hook.pos.x,this.area.hook.pos.x+this.area.hook.size.x);var a=sc.menu.mapCursor.y,b=sc.menu.mapCursor.x+sc.menu.mapCamera.x;sc.menu.mapCursor.y=a.limit(this.area.hook.pos.y,this.area.hook.pos.y+this.area.hook.size.y-(b<181?Math.min(25,181-b):0))},initCursor:function(a){if(a.x<=-1E4||a.y<=-1E4){for(var b=
this.area.hook,c=null,d=null,e=b.children,k=e.length;k--;)if(e[k].gui.floor.level==sc.map.currentFloor){c=e[k];d=e[k].gui.activeRoom}if(d){a.x=b.pos.x+d.pos.x+d.size.x/2;a.y=b.pos.y+d.pos.y+d.size.y/2}else if(c){a.x=b.pos.x+b.size.x/2;a.y=b.pos.y+c.pos.y+c.size.y/2}else{a.x=b.pos.x+b.size.x/2;a.y=b.pos.y+b.size.y/2}}},calculateScrollingOffset:function(a){if(a){this._vertOffsetStart=this._vertOffsetTarget=this._vertOffset=-sc.map.currentFloor*8;this._vertOffsetTimer=0.3}else{this._vertOffsetTarget=
-sc.map.currentFloor*8;this._vertOffsetStart=this._vertOffset;this._vertOffsetTimer=0;this._vertOffsetTime=0.3}},showMenu:function(){sc.menu.mapWasDragged=false;sc.menu.buttonInteract.pushButtonGroup(this.buttongroup);if(sc.menu.mapFirstVisit)for(var a=this.area.hook.children,b=a.length;b--;)a[b].gui.showFloor();else{this.centerCurrentPosition(true);sc.menu.mapFirstVisit=true}this.hoverRoom=null;this.mapNameGui.setText("");this._prevFloor=sc.map.currentFloor;this._alphaTimer=this._alphaTime;this._alpha=
0;if(this._lastDevice!=ig.input.currentDevice){this._gamepadActive=ig.input.currentDevice==ig.INPUT_DEVICES.GAMEPAD;this._lastDevice=ig.input.currentDevice}ig.input.currentDevice==ig.INPUT_DEVICES.GAMEPAD&&this.findMap(sc.menu.mapCursor.x,sc.menu.mapCursor.y,true);this.doScrollTransition(sc.menu.mapCamera.x,sc.menu.mapCamera.y,0,KEY_SPLINES.LINEAR);this.doStateTransition("DEFAULT",false,false,function(){this._alpha=this._alphaTimer=0}.bind(this))},exitMenu:function(){this.hoverRoom=null;this.mapNameGui.setText("");
sc.menu.buttonInteract.removeButtonGroup(this.buttongroup);sc.menu.mapMapFocus=false;this._cursorPos.x=sc.menu.mapCursor.x;this._cursorPos.y=sc.menu.mapCursor.y;this.cursor.unfocus();this._alpha=0;for(var a=this.area.hook.children,b=a.length;b--;)a[b].gui.hideFloor();this.doStateTransition("HIDDEN")},addObservers:function(){sc.Model.addObserver(sc.menu,this);this.cursor.addObservers()},removeObservers:function(){sc.Model.removeObserver(sc.menu,this);this.cursor.removeObservers()},modelChanged:function(a,
b,c){if(a==sc.menu)if(b==sc.MENU_EVENT.MAP_CHANGED_FLOOR)if(this._prevFloor==sc.map.currentFloor){this.centerCurrentPosition(false,true);this.doScrollTransition(sc.menu.mapCamera.x,sc.menu.mapCamera.y,0.3,KEY_SPLINES.EASE)}else{this.calculateScrollingOffset(false);ig.input.currentDevice==ig.INPUT_DEVICES.GAMEPAD&&this.findMap(sc.menu.mapCursor.x,sc.menu.mapCursor.y,true);this._prevFloor=sc.map.currentFloor}else if(b==sc.MENU_EVENT.MAP_WORLDMAP_STATE)if(c){this.hoverRoom=null;this.mapNameGui.setText("");
this.doStateTransition("HIDDEN_WORLD");this.cursor._ignoreModel=true}else{this.cursor.focus=false;this.cursor._ignoreModel=false;ig.input.currentDevice==ig.INPUT_DEVICES.GAMEPAD&&this.initCursor(this._cursorPos);this.doStateTransition("DEFAULT");ig.input.currentDevice==ig.INPUT_DEVICES.GAMEPAD?this.findMap(sc.menu.mapCursor.x,sc.menu.mapCursor.y,true):this.findMap(sc.control.getMouseX(),sc.control.getMouseY())}else if(b==sc.MENU_EVENT.MAP_AREA_LOAD)this.loadNewArea(c);else if(b==sc.MENU_EVENT.MAP_AREA_LOAD_DONE){this.cursor.focus=
false;this.cursor._ignoreModel=false}else if(b==sc.MENU_EVENT.MAP_FOCUS_MAP){if(ig.input.currentDevice==ig.INPUT_DEVICES.GAMEPAD){sc.menu.mapCamera.x=Math.floor(-sc.menu.mapCursor.x+ig.system.width/2);sc.menu.mapCamera.y=Math.floor(-sc.menu.mapCursor.y+ig.system.height/2);this.limitCameraPos();this.doScrollTransition(sc.menu.mapCamera.x,sc.menu.mapCamera.y,0.2,KEY_SPLINES.LINEAR)}sc.menu.setInfoText(sc.menu.mapMapFocus.description);this.showLandmarkName(sc.menu.mapMapFocus.name)}else b==sc.MENU_EVENT.MAP_UNFOCUS?
sc.menu.setInfoText("",true):b==sc.MENU_EVENT.MAP_UPDATE_STAMP&&this.showLandmarkName(sc.menu.mapMapFocus.name)}})});ig.baked=!0;
ig.module("game.feature.menu.gui.map.map-worldmap").requires("impact.feature.gui.gui","impact.feature.gui.base.basic-gui","game.feature.menu.gui.map.map-misc").defines(function(){Vec2.createC(0,0);var b=sc.BUTTON_SOUND.submit,a={beach:{x:227,y:262,w:29,h:22,sx:0,sy:0},"final-dng":{x:45,y:74,w:31,h:51,sx:58,sy:0}};sc.AreaButton=ig.FocusGui.extend({gfx:new ig.Image("media/gui/menu.png"),key:null,area:null,icon:1,activeArea:false,focusCount:0,description:"",init:function(a,b){this.parent(true,false);
this.setSize(16,16);this.setPivot(8,8);this.key=a;this.area=b;this.description=new ig.LangLabel(this.area.description||"");if(this.area){this.activeArea=a==sc.map.currentPlayerArea.path;this.icon=sc.AREA_TYPE[this.area.areaType]*8}},onButtonPress:function(){if(ig.input.currentDevice==ig.INPUT_DEVICES.KEYBOARD_AND_MOUSE){var a=Math.floor(sc.control.getMouseY());if(a<=21||a>=299)return}b.play();sc.menu.loadArea(this.key)},updateDrawables:function(a){this.focus&&a.addGfx(this.gfx,-3,-2,421,173,21,21).setCompositionMode("lighter");
a.addGfx(this.gfx,4,4,328+this.icon,456+(this.activeArea?8:0),8,8);if(this.activeArea){a.addGfx(this.gfx,1,2,304,440,3,3);a.addGfx(this.gfx,-11,-8,280,424,16,11)}},isMouseOver:function(){if(sc.menu.mapWorldmapActive&&!ig.interact.isBlocked()){if(ig.input.currentDevice==ig.INPUT_DEVICES.GAMEPAD){var a=this.getDistanceToCursor();if(sc.menu.mapWmCursorMoved){sc.menu.unfocusArea(this);return false}if(a<=10){a=this.hook;sc.menu.focusArea(a.pos.x+Math.floor(a.size.x/2)-1,a.pos.y+Math.floor(a.size.y/2)+
1,this,true);return true}sc.menu.unfocusArea(this)}else if(ig.input.currentDevice==ig.INPUT_DEVICES.KEYBOARD_AND_MOUSE){var b=Math.floor(sc.control.getMouseX()),e=Math.floor(sc.control.getMouseY()),a=this.hook;(b=b>=a.pos.x&&b<=a.pos.x+a.size.x&&e>=a.pos.y&&e<=a.pos.y+a.size.y)?sc.menu.focusArea(a.pos.x+Math.floor(a.size.x/2)-1,a.pos.y+Math.floor(a.size.y/2)+1,this):sc.menu.unfocusArea(this);return b}return false}},getDistanceToCursor:function(){return Math.floor(Vec2.distanceC(sc.menu.mapWorldCursor.x,
sc.menu.mapWorldCursor.y,this.hook.pos.x+Math.floor(this.hook.size.x/2),this.hook.pos.y+Math.floor(this.hook.size.y/2)))}});sc.WorldMapExtra=ig.GuiElementBase.extend({gfx:new ig.Image("media/gui/world-map-extra.png"),timer:0,image:null,overlay:null,init:function(b,c){this.parent();var e=a[b];this.setSize(e.w,e.h);this.setPos(e.x,e.y);this.image=new ig.ImageGui(this.gfx,e.sx,e.sy,e.w,e.h);this.image.hook.transitions={DEFAULT:{state:{},time:0.2,timeFunction:KEY_SPLINES.LINEAR},HIDDEN:{state:{alpha:0},
time:0.2,timeFunction:KEY_SPLINES.LINEAR}};this.addChildGui(this.image);if(c){this.overlay=new ig.ImageGui(this.gfx,e.sx+e.w,e.sy,e.w,e.h);this.overlay.renderMode="lighter";this.overlay.hook.transitions={DEFAULT:{state:{},time:0.3,timeFunction:KEY_SPLINES.LINEAR},HIDDEN:{state:{alpha:0},time:0.5,timeFunction:KEY_SPLINES.LINEAR}};this.addChildGui(this.overlay);this.image.doStateTransition("HIDDEN",true);this.overlay.doStateTransition("HIDDEN",true);this.overlay.doStateTransition("DEFAULT",false,false,
function(){this.image.doStateTransition("DEFAULT",true);this.overlay.doStateTransition("HIDDEN",false,false,null,0.2)}.bind(this),0.4)}}});sc.MapWorldMap=ig.GuiElementBase.extend({transitions:{DEFAULT:{state:{},time:0.2,timeFunction:KEY_SPLINES.LINEAR},HIDDEN:{state:{alpha:0,scaleX:1.5,scaleY:1.5},time:0.2,timeFunction:KEY_SPLINES.LINEAR}},gfx:new ig.Image("media/gui/world-map.png"),buttonGroup:null,areas:[],cursor:null,areaName:null,_gamepadActive:false,_lastDevice:0,_cursorPos:Vec2.createC(-1E4,
-1E4),init:function(){this.parent();this.setSize(ig.system.width,ig.system.height);this.setPivot(ig.system.width/2,ig.system.height/2);this.buttonGroup=new sc.MouseButtonGroup;this.buttonGroup.ignoreActiveFocus=true;this.buttonGroup.addSelectionCallback(function(a){a&&a.data&&sc.menu.setInfoText(a.data)}.bind(this));this.buttonGroup.setMouseFocusLostCallback(function(){sc.menu.setInfoText("",true);this.areaName.setText("")}.bind(this));this.buttonGroup.onButtonTraversal=function(){if(ig.input.currentDevice==
ig.INPUT_DEVICES.GAMEPAD&&sc.control.menuConfirm()&&sc.menu.mapAreaFocus)sc.menu.mapAreaFocus.onButtonPress()}.bind(this);this._addAreas();this.cursor=new sc.MapCursor(true);this.addChildGui(this.cursor);this.areaName=new sc.WorldmapAreaName;this.addChildGui(this.areaName);this.doStateTransition("HIDDEN",true)},update:function(){sc.menu.mapWmCursorMoved=false;if(!ig.interact.isBlocked()&&this.buttonGroup.isActive()){if(this._lastDevice!=ig.input.currentDevice){this._gamepadActive=ig.input.currentDevice==
ig.INPUT_DEVICES.GAMEPAD;this._lastDevice=ig.input.currentDevice;var a=null;if(ig.input.currentDevice==ig.INPUT_DEVICES.GAMEPAD){a=this._cursorPos;this._initCursor(a);sc.menu.mapWorldCursor.x=a.x;sc.menu.mapWorldCursor.y=a.y;this._limitCursorPos();sc.menu.resetWorldmapCursor();sc.menu.setInfoText("",true);this.cursor.moveTo(sc.menu.mapWorldCursor.x,sc.menu.mapWorldCursor.y)}else if(ig.input.currentDevice==ig.INPUT_DEVICES.KEYBOARD_AND_MOUSE){this._cursorPos.x=sc.menu.mapWorldCursor.x;this._cursorPos.y=
sc.menu.mapWorldCursor.y;this.cursor.unfocus()}sc.menu.toggledInputMode()}if(ig.input.currentDevice==ig.INPUT_DEVICES.GAMEPAD){var b=a=0,e=0,f=false;if((e=sc.control.getAxesValue(ig.AXES.LEFT_STICK_X))<-0.5){a=(-100+e*100)*ig.system.actualTick;f=true}else if((e=sc.control.getAxesValue(ig.AXES.LEFT_STICK_X))>0.5){a=(100+e*100)*ig.system.actualTick;f=true}if((e=sc.control.getAxesValue(ig.AXES.LEFT_STICK_Y))<-0.5){b=(-100+e*100)*ig.system.actualTick;f=true}else if((e=sc.control.getAxesValue(ig.AXES.LEFT_STICK_Y))>
0.5){b=(100+e*100)*ig.system.actualTick;f=true}if(f){sc.menu.mapWmCursorMoved=true;sc.menu.mapWorldCursor.x=a>=0?Math.floor(sc.menu.mapWorldCursor.x+a):Math.ceil(sc.menu.mapWorldCursor.x+a);sc.menu.mapWorldCursor.y=b>=0?Math.floor(sc.menu.mapWorldCursor.y+b):Math.ceil(sc.menu.mapWorldCursor.y+b);this._limitCursorPos();this.cursor.moveTo(sc.menu.mapWorldCursor.x,sc.menu.mapWorldCursor.y)}}}},updateDrawables:function(a){a.addGfx(this.gfx,0,0,0,0,this.hook.size.x,this.hook.size.y)},addObservers:function(){sc.Model.addObserver(sc.menu,
this)},removeObservers:function(){sc.Model.removeObserver(sc.menu,this)},show:function(){this.areaName.setText("");var a=this.areas.length;sc.menu.pushBackCallback(this.onBackButtonPress.bind(this));for(sc.menu.buttonInteract.pushButtonGroup(this.buttonGroup);a--;)this.areas[a].focusLost();sc.menu.resetWorldmapCursor();this.cursor.addObservers();if(this._lastDevice!=ig.input.currentDevice){this._gamepadActive=ig.input.currentDevice==ig.INPUT_DEVICES.GAMEPAD;this._lastDevice=ig.input.currentDevice}this._focusCurrentArea();
ig.interact.setBlockDelay(0.2);this.doStateTransition("DEFAULT")},hide:function(){this.areaName.setText("");this.cursor.unfocus();sc.menu.buttonInteract.removeButtonGroup(this.buttonGroup);this.cursor.removeObservers();this.doStateTransition("HIDDEN")},_focusCurrentArea:function(){if(sc.menu.mapWorldFirstVisit){var a=this._cursorPos;a.x=sc.menu.mapWorldCursor.x;a.y=sc.menu.mapWorldCursor.y;this._limitCursorPos();this.cursor.moveTo(sc.menu.mapWorldCursor.x,sc.menu.mapWorldCursor.y)}else if(ig.input.currentDevice==
ig.INPUT_DEVICES.GAMEPAD){sc.menu.mapWorldFirstVisit=true;a=this._cursorPos;this._initCursor(a);for(var b=sc.map.currentArea,e=this.areas.length;e--;){a=this.areas[e];if(a.key==b.path){b=a.hook.pos.y+Math.floor(8)+1;sc.menu.mapWorldCursor.x=a.hook.pos.x+Math.floor(8)-1;sc.menu.mapWorldCursor.y=b;this._limitCursorPos();this.cursor.moveTo(sc.menu.mapWorldCursor.x,sc.menu.mapWorldCursor.y);break}}}},_initCursor:function(a){if(a.x<=-1E4||a.y<=-1E4){a.x=ig.system.width/2;a.y=ig.system.height/2}},_limitCursorPos:function(){var a=
sc.menu.mapWorldCursor.x;sc.menu.mapWorldCursor.x=a.limit(5,ig.system.width-Math.floor(this.cursor.hook.size.x/2));a=sc.menu.mapWorldCursor.y;sc.menu.mapWorldCursor.y=a.limit(41,ig.system.height-this.cursor.hook.size.y-4)},_setAreaName:function(a){var b=a.area,e=a.hook.pos,f=sc.stats.getMap("chests",a.key)||0,a=sc.map.getChestCount(a.key),f=Math.min(f,a),g="";a!=0&&(g=f>=a?" \\c[3]["+f+"/"+a+"]\\c[0]":" ["+f+"/"+a+"]");this.areaName.setText(ig.LangLabel.getText(b.name)+g);b=e.x+11;e=e.y-this.areaName.hook.size.y+
5;this.areaName.setPos(b,e);if(this.areaName.hook.pos.x+this.areaName.hook.size.x>=ig.system.width-2){this.areaName.setPos(b-this.areaName.hook.size.x-10,e+23);this.areaName.setFlip(true)}else this.areaName.setFlip(false)},_addAreas:function(){var b=sc.map.areas,c;for(c in a)if(sc.map.getVisitedArea(c)){var e=null;if(ig.vars.get("menu.circuit.start."+c))e=new sc.WorldMapExtra(c,false);else{ig.vars.set("menu.circuit.start."+c,true);e=new sc.WorldMapExtra(c,true)}this.addChildGui(e)}for(c in b){e=b[c];
if((!e.condition||(new ig.VarCondition(e.condition)).evaluate())&&sc.map.getVisitedArea(c)){e=this._addAreaButton(c,e);this.addChildGui(e)}}},_addAreaButton:function(a,b){var e=new sc.AreaButton(a,b);e.setPos(b.position.x-8+1,b.position.y-8);this.buttonGroup.addFocusGui(e);this.areas.push(e);return e},onBackButtonPress:function(){sc.menu.exitWorldMap()},modelChanged:function(a,b,e){if(a==sc.menu)if(b==sc.MENU_EVENT.MAP_WORLDMAP_STATE)if(e)this.show();else{ig.interact.setBlockDelay(0.2);sc.menu.popBackCallback();
this.hide()}else if(b==sc.MENU_EVENT.MAP_FOCUS_AREA){this._setAreaName(sc.menu.mapAreaFocus);sc.menu.setInfoText(sc.menu.mapAreaFocus.description)}else if(b==sc.MENU_EVENT.MAP_UNFOCUS){this.areaName.setText("");sc.menu.setInfoText("",true)}else if(b==sc.MENU_EVENT.SKILL_TOGGLED_INPUT_MODE)this.areaName.setText("",false,true);else if(b==sc.MENU_EVENT.MAP_AREA_LOAD){sc.menu.popBackCallback();this.hide()}}})});ig.baked=!0;
ig.module("game.feature.menu.gui.map.map-menu").requires("impact.feature.gui.gui","impact.feature.gui.base.basic-gui","game.feature.menu.gui.map.map-misc","game.feature.menu.gui.map.map-stamp","game.feature.menu.gui.map.map-area","game.feature.menu.gui.map.map-worldmap").defines(function(){sc.MapMenu=sc.BaseMenu.extend({hotkeyHelp:null,hotkeyWorldmap:null,hotkeyCenter:null,area:null,floorButtons:null,emptyMap:null,chestDisplay:null,stampDisplay:null,worldmap:null,curArea:null,stamps:null,helpGui:null,
init:function(){this.parent();this.hook.size.x=ig.system.width;this.hook.size.y=ig.system.height;this.hotkeyHelp=new sc.ButtonGui("\\i[help]"+ig.lang.get("sc.gui.menu.hotkeys.help"),void 0,true,sc.BUTTON_TYPE.SMALL);this.hotkeyHelp.keepMouseFocus=true;this.hotkeyHelp.hook.transitions={DEFAULT:{state:{},time:0.2,timeFunction:KEY_SPLINES.EASE},HIDDEN:{state:{offsetY:-this.hotkeyHelp.hook.size.y},time:0.2,timeFunction:KEY_SPLINES.LINEAR}};this.hotkeyHelp.onButtonPress=this.onHelpButtonPressed.bind(this);
this.hotkeyCenter=new sc.ButtonGui("\\i[help3]"+ig.lang.get("sc.gui.menu.hotkeys.center-map"),void 0,true,sc.BUTTON_TYPE.SMALL);this.hotkeyCenter.submitSound=null;this.hotkeyCenter.keepMouseFocus=true;this.hotkeyCenter.hook.transitions={DEFAULT:{state:{},time:0.2,timeFunction:KEY_SPLINES.EASE},HIDDEN:{state:{offsetY:-this.hotkeyCenter.hook.size.y},time:0.2,timeFunction:KEY_SPLINES.LINEAR}};this.hotkeyCenter.onButtonPress=this.onCenterButtonPressed.bind(this);this.hotkeyWorldmap=new sc.ButtonGui("\\i[help2]"+
ig.lang.get("sc.gui.menu.hotkeys.worldmap"),void 0,true,sc.BUTTON_TYPE.SMALL);this.hotkeyWorldmap.keepMouseFocus=true;this.hotkeyWorldmap.hook.transitions={DEFAULT:{state:{},time:0.2,timeFunction:KEY_SPLINES.EASE},HIDDEN:{state:{offsetY:-this.hotkeyWorldmap.hook.size.y},time:0.2,timeFunction:KEY_SPLINES.LINEAR}};this.hotkeyWorldmap.onButtonPress=this.onWorldmapButtonPressed.bind(this);this.area=new sc.MapAreaContainer;this.addChildGui(new sc.DummyContainer(this.area));this.worldmap=new sc.MapWorldMap;
this.addChildGui(this.worldmap);this.floorButtons=new sc.MapFloorButtonContainer;this.addChildGui(this.floorButtons);this.chestDisplay=new sc.MapChestDisplay;this.addChildGui(this.chestDisplay);this.stampDisplay=new sc.MapStampDisplay;this.addChildGui(this.stampDisplay);this.curArea=new sc.CurrentAreaDisplay;this.addChildGui(this.curArea);this.emptyMap=new sc.TextGui("???");this.emptyMap.setAlign(ig.GUI_ALIGN.X_CENTER,ig.GUI_ALIGN.Y_CENTER);this.emptyMap.hook.transitions={DEFAULT:{state:{},time:0.2,
timeFunction:KEY_SPLINES.LINEAR},HIDDEN:{state:{alpha:0},time:0.2,timeFunction:KEY_SPLINES.LINEAR}};this.emptyMap.doStateTransition("HIDDEN",true);this.addChildGui(this.emptyMap);this.stamps=new sc.StampEditMenu;this.addChildGui(this.stamps);this.doStateTransition("DEFAULT")},addObservers:function(){sc.Model.addObserver(sc.menu,this);this.area.addObservers();this.floorButtons.addObservers();this.worldmap.addObservers();this.curArea.addObservers()},removeObservers:function(){sc.Model.removeObserver(sc.menu,
this);this.area.removeObservers();this.floorButtons.removeObservers();this.worldmap.removeObservers();this.curArea.removeObservers()},showMenu:function(){this.addObservers();sc.menu.pushBackCallback(this.onBackButtonPress.bind(this));sc.menu.moveLeaSprite(0,0,sc.MENU_LEA_STATE.HIDDEN);ig.interact.setBlockDelay(0.2);this.onAddHotkeys();sc.map.getCurrentArea()||this.emptyMap.doStateTransition("DEFAULT");this.worldmap.doStateTransition("HIDDEN",true);this.area.showMenu();this.floorButtons.showMenu();
this.curArea.showMenu();this.chestDisplay.doStateTransition("DEFAULT");this.stampDisplay.doStateTransition("DEFAULT")},hideMenu:function(){this.removeObservers();sc.menu.moveLeaSprite(0,0,sc.MENU_LEA_STATE.LARGE);this.exitMenu()},exitMenu:function(){sc.menu.buttonInteract.removeGlobalButton(this.hotkeyHelp);sc.menu.buttonInteract.removeGlobalButton(this.hotkeyCenter);sc.menu.buttonInteract.removeGlobalButton(this.hotkeyWorldmap);sc.menu.mapWorldFirstVisit=false;this.helpGui=null;this.emptyMap.doStateTransition("HIDDEN");
this.area.exitMenu();this.floorButtons.exitMenu();this.curArea.exitMenu();this.worldmap.hide();this.chestDisplay.doStateTransition("HIDDEN");this.stampDisplay.doStateTransition("HIDDEN");this.stamps.hide()},onHotkeyHelpCheck:function(){return sc.control.menuHotkeyHelp()},onHelpButtonPressed:function(){sc.menu.removeHotkeys();this.createHelpGui();ig.gui.addGuiElement(this.helpGui);this.helpGui.openMenu()},onHotkeyCenterCheck:function(){return sc.control.menuHotkeyHelp3()},onHotkeyWorldmapCheck:function(){return sc.control.menuHotkeyHelp2()},
onCenterButtonPressed:function(b){if(b)this.area.addStamp();else{sc.BUTTON_SOUND.submit.play();b=ig.lang.get("sc.gui.menu.map-menu.popupTitle")+"\n\n"+ig.lang.get("sc.gui.menu.map-menu.popupDesc");b=new sc.CenterMsgBoxGui(b,{maxWidth:300,speed:ig.TextBlock.SPEED.IMMEDIATE},"black",0.9);b.hook.zIndex=15E4;b.hook.pauseGui=true;ig.gui.addGuiElement(b)}},onWorldmapButtonPressed:function(){if(sc.menu.mapWorldmapActive){sc.menu.setInfoText("",true);sc.menu.exitWorldMap()}else sc.menu.enterWorldMap()},createHelpGui:function(){if(!this.helpGui){this.helpGui=
new sc.HelpScreen(this,ig.lang.get("sc.gui.menu.help-texts.map.title"),ig.lang.get("sc.gui.menu.help-texts.map.pages"),function(){this.commitHotKeysToTopBar(true)}.bind(this),true);this.helpGui.hook.zIndex=15E4;this.helpGui.hook.pauseGui=true}},onAddHotkeys:function(b){sc.menu.buttonInteract.addGlobalButton(this.hotkeyHelp,this.onHotkeyHelpCheck.bind(this));sc.menu.buttonInteract.addGlobalButton(this.hotkeyCenter,this.onHotkeyCenterCheck.bind(this));sc.menu.buttonInteract.addGlobalButton(this.hotkeyWorldmap,
this.onHotkeyWorldmapCheck.bind(this));this.commitHotKeysToTopBar(b)},commitHotKeysToTopBar:function(b){sc.menu.addHotkey(function(){return this.hotkeyWorldmap}.bind(this));sc.menu.addHotkey(function(){return this.hotkeyCenter}.bind(this));sc.menu.addHotkey(function(){return this.hotkeyHelp}.bind(this));sc.menu.commitHotkeys(b)},onBackButtonPress:function(){sc.menu.popBackCallback();sc.menu.popMenu()},modelChanged:function(b,a,d){if(b==sc.menu)if(a==sc.MENU_EVENT.MAP_WORLDMAP_STATE){this.stamps.hide(true);
if(d){this.hotkeyCenter.setActive(false);this.chestDisplay.doStateTransition("HIDDEN");this.stampDisplay.doStateTransition("HIDDEN")}else{this.hotkeyCenter.setActive(true);this.chestDisplay.doStateTransition("DEFAULT");this.stampDisplay.doStateTransition("DEFAULT")}}else if(a==sc.MENU_EVENT.MAP_AREA_LOAD_DONE){this.hotkeyCenter.setActive(true);this.chestDisplay.update();this.stampDisplay.update();this.chestDisplay.doStateTransition("DEFAULT");this.stampDisplay.doStateTransition("DEFAULT")}else if(a==
sc.MENU_EVENT.MAP_OPEN_STAMPS){this.stamps.hide(true);this.stamps.show(d)}}})});ig.baked=!0;
ig.module("game.feature.menu.gui.options.options-misc").requires("impact.feature.gui.gui","impact.feature.gui.base.basic-gui","impact.feature.gui.base.box","game.feature.menu.gui.menu-misc").defines(function(){sc.KeyBinderGui=ig.ColorGui.extend({transitions:{DEFAULT:{state:{alpha:1},time:0.2,timeFunction:KEY_SPLINES.LINEAR},HIDDEN:{state:{alpha:0},time:0.2,timeFunction:KEY_SPLINES.LINEAR}},box:null,button:null,back:null,buttonGroup:null,buttonInteract:null,finishCallback:null,bindedKeyCheck:null,
isAlternative:null,init:function(){this.parent("black");this.hook.pauseGui=true;this.hook.zIndex=9001;this.hook.localAlpha=0.9;this.box=new sc.BlackWhiteBox(200,60);this.box.setAlign(ig.GUI_ALIGN.X_CENTER,ig.GUI_ALIGN.Y_CENTER);this.box.hook.transitions={DEFAULT:{state:{},time:0.2,timeFunction:KEY_SPLINES.LINEAR},HIDDEN:{state:{scaleY:0},time:0.2,timeFunction:KEY_SPLINES.LINEAR}};this.addChildGui(this.box);this.button=new sc.ButtonGui(ig.lang.get("sc.gui.options.controls.unbind"));this.button.setAlign(ig.GUI_ALIGN.X_LEFT,
ig.GUI_ALIGN.Y_BOTTOM);this.button.setPos(4,6);this.button.onButtonPress=this.onUnbindPress.bind(this);this.box.addChildGui(this.button);this.back=new sc.ButtonGui(ig.lang.get("sc.gui.options.controls.back"));this.back.setAlign(ig.GUI_ALIGN.X_RIGHT,ig.GUI_ALIGN.Y_BOTTOM);this.back.setPos(4,6);this.back.onButtonPress=this.onReturnPress.bind(this);this.box.addChildGui(this.back);var b=new sc.TextGui(ig.lang.get("sc.gui.options.controls.anykey"));b.setAlign(ig.GUI_ALIGN.X_CENTER,ig.GUI_ALIGN.Y_TOP);
b.setPos(0,6);this.box.addChildGui(b);this.buttonInteract=new ig.ButtonInteractEntry;this.buttonGroup=new sc.ButtonGroup;this.buttonInteract.pushButtonGroup(this.buttonGroup);this.buttonInteract.addGlobalButton(this.button,this.onGlobalButtonCheck.bind(this));this.buttonInteract.addGlobalButton(this.back,this.onGlobalButtonCheck.bind(this));this.doStateTransition("HIDDEN",true);this.box.doStateTransition("HIDDEN",true)},show:function(b,a,d){this.doStateTransition("DEFAULT");this.box.doStateTransition("DEFAULT");
if(d){this.button.setPos(4,6);this.back.setAlign(ig.GUI_ALIGN.X_RIGHT,ig.GUI_ALIGN.Y_BOTTOM);this.back.setPos(4,6)}else{this.button.setPos(-1E3,-1E3);this.back.setAlign(ig.GUI_ALIGN.X_CENTER,ig.GUI_ALIGN.Y_BOTTOM);this.back.setPos(0,6)}a=Math.max(150,this.button.hook.size.x+this.back.hook.size.x+12);this.box.setSize(a,60);this.finishCallback=b||null;this.isAlternative=d;ig.input.ignoreKeyboard=true;ig.interact.addEntry(this.buttonInteract);ig.interact.setBlockDelay(0.2);this.bindedKeyCheck=this.onKeyCheck.bind(this);
window.addEventListener("keydown",this.bindedKeyCheck,false)},hide:function(){this.doStateTransition("HIDDEN");this.box.doStateTransition("HIDDEN");ig.interact.removeEntry(this.buttonInteract);ig.interact.setBlockDelay(0.2);window.removeEventListener("keydown",this.bindedKeyCheck);this.finishCallback=null;this.isAlternative=false;ig.input.ignoreKeyboard=false},onUnbindPress:function(){if(this.isAlternative){this.finishCallback&&this.finishCallback(null,this.isAlternative,true);this.hide()}},onReturnPress:function(){this.hide()},
onKeyCheck:function(b){b.preventDefault();if(!ig.interact.isBlocked()&&!this._isBlackedListed(b.keyCode)){this.finishCallback&&this.finishCallback(b.keyCode,this.isAlternative,false);this.hide()}},onGlobalButtonCheck:function(){return false},_isBlackedListed:function(b){return sc.KEY_BLACK_LIST[b]}});sc.OptionSlider=sc.Slider.extend({backgroundNinePatch:new ig.NinePatch("media/gui/buttons.png",{width:8,height:0,left:4,top:9,right:4,bottom:0,offsets:{"default":{x:128,y:84},"default-focus":{x:144,y:84},
fill:{x:128,y:72},"fill-focus":{x:144,y:72}}}),fill:false,focus:false,init:function(b,a,d,c){this.parent(b,a,d);this.fill=c!=void 0?c:false},updateDrawables:function(b){this.backgroundNinePatch.draw(b,this.hook.size.x,this.hook.size.y,this.focus?"default-focus":"default");this.fill&&this.backgroundNinePatch.draw(b,this.thumb.hook.pos.x+this.prefWidth/2,this.hook.size.y,this.focus?"fill-focus":"fill")},setSize:function(b,a){this.hook.size.x=b;this.hook.size.y=a;this.setThumbPos(true)}});sc.OptionThumb=
ig.GuiElementBase.extend({thumbNinePatch:new ig.NinePatch("media/gui/buttons.png",{width:6,height:0,left:4,top:21,right:4,bottom:0,offsets:{"default":{x:96,y:72},focus:{x:112,y:72}}}),currentOffset:"default",slider:null,drag:false,wasDragged:false,starValue:0,_startPos:Vec2.createC(0,0),init:function(b){this.parent();this.slider=b},onMouseInteract:function(b,a,d){if(!d)if(sc.control.getGuiPressed()){this.drag=true;this.starValue=this.slider.slider.value;this._startPos.x=b;this._startPos.y=a}else sc.control.getGuiHold()?
this.drag&&this.slider.onDrag&&this.slider.onDrag(b-this._startPos.x,a-this._startPos.y,this.starValue):this.drag=false},updateDrawables:function(b){this.thumbNinePatch.draw(b,this.hook.size.x,this.hook.size.y,this.currentOffset)}});sc.OptionFocusSlider=ig.FocusGui.extend({slider:null,thumb:null,snap:true,changeCallback:null,clickSound:sc.BUTTON_SOUND.submit,_hasKeyboardFocus:false,_buttongroup:null,init:function(b,a,d,c){this.parent();this.setAlign(ig.GUI_ALIGN.X_CENTER,ig.GUI_ALIGN.Y_CENTER);this._buttongroup=
c||null;this.snap=a==void 0?true:a;this.changeCallback=b||null;this.thumb=new sc.OptionThumb(this);this.slider=new sc.OptionSlider(false,this.thumb,false,d);this.slider.setAlign(ig.GUI_ALIGN.X_CENTER,ig.GUI_ALIGN.Y_CENTER);this.slider.offset.y=-6;this.slider.inset.left=2;this.slider.inset.right=2;this.addChildGui(this.slider)},setPreferredThumbSize:function(b,a){this.slider.setPreferredThumbSize(b,a)},setSize:function(b,a,d){this.parent(b,a);this.slider.setSize(b,d||a);this.slider.setThumbPos(true)},
setValue:function(b){this.slider.setValue(b,true)},setMinMaxValue:function(b,a){this.slider.setMinMaxValue(b,a,true)},getValue:function(){return this.slider.value},update:function(){this.parent();if(!ig.input.mouseGuiActive)this.thumb.currentOffset=this.focus?"focus":"default"},focusGained:function(){this.focus=true;this.slider.focus=true},focusLost:function(){this.focus=false;this.slider.focus=false},canPlayFocusSounds:function(){return!this.thumb.drag},canLeaveFocus:function(){return!this.thumb.drag},
onMouseInteract:function(b,a){this.parent(b,a);if(!ig.interact.isBlocked()&&(!this._buttongroup||this._buttongroup.isActive())){this._hasKeyboardFocus=false;var d=this.hook.screenCoords,c=this.thumb.hook;if(!c.screenCoords)this.thumb.hook.screenCoords={x:0,y:0,w:c.size.x,h:c.size.y};c.screenCoords.x=d.x+c.pos.x-this.slider.offset.x;c.screenCoords.y=d.y+c.pos.y-this.slider.offset.y;var d=c.screenCoords,c=sc.control.getMouseX(),e=sc.control.getMouseY();if(d.x<=c&&d.x+d.w>c&&d.y<=e&&d.y+d.h>e||this.thumb.drag){this.thumb.currentOffset=
"focus";this.thumb.onMouseInteract(c|0,e|0,a)}else{this.thumb.currentOffset="default";if(a){this.clickSound&&this.clickSound.play();d=Math.max(0,c-this.hook.screenCoords.x);d=Math.round(d/this.slider.hook.size.x*this.slider.getRange());this.slider.setValue(d,true);this.changeCallback&&this.changeCallback(d)}}}},onDrag:function(b,a,d){b=this.vertical?a:b;a=this.slider;b=(a.maxValue-a.minValue)*b/a.calcThumbArea();a.setValue(this.snap?Math.round(d+b):d+b,true);this.changeCallback&&this.changeCallback(a.value)}});
sc.OptionLangPopUp=ig.BoxGui.extend({transitions:{DEFAULT:{state:{},time:0.2,timeFunction:KEY_SPLINES.EASE},HIDDEN:{state:{alpha:0,scaleX:0.2,scaleY:0},time:0.2,timeFunction:KEY_SPLINES.LINEAR}},ninepatch:new ig.NinePatch("media/gui/menu.png",{width:8,height:8,left:8,top:8,right:8,bottom:8,offsets:{"default":{x:480,y:304}}}),buttongroup:null,anchor:null,callback:null,buttons:[],active:false,_prevPressed:null,init:function(){this.parent(429,50);this.setPivot(427,0);this.buttongroup=new sc.ButtonGroup;
this.buttongroup.addPressCallback(function(b){if(b&&b.data&&b.data.lang!=void 0){this.anchor.onLanguageSelected(false,b.data.lang);this.hide()}}.bind(this));this.createButtons();this.doStateTransition("HIDDEN",true)},createButtons:function(){var b=3,a=4,d=0,c;for(c in sc.LANGUAGE){var e=sc.LANGUAGE[c],f="\\i[language-"+e+"] "+ig.lang.get("sc.gui.options.language.group")[e],f=new sc.ButtonGui(f,210,true,d%2==0?sc.BUTTON_TYPE.GROUP_LEFT:sc.BUTTON_TYPE.GROUP_RIGHT,null,true);f.noFocusOnPressed=true;
f.setPos(b,a);f.setData({lang:e});this.addChildGui(f);this.buttons[e]=f;this.buttongroup.addFocusGui(f,d%2,Math.floor(d/2));d++;b=b+212;if(d%2==0){b=3;a=a+22}}this.hook.size.y=a+24;b=sc.options.get("language");this._prevPressed=this.buttons[b];this.resetButtons(this._prevPressed);this.buttongroup.setPressedFocusGui(this._prevPressed)},resetButtons:function(b){for(var a=this.buttons.length;a--;)this.buttons[a]&&this.buttons[a]!=b&&this.buttons[a].setPressed(false)},show:function(b,a){if(!this.active){sc.menu.buttonInteract.pushButtonGroup(this.buttongroup);
sc.menu.pushBackCallback(this.onBackButtonPressed.bind(this));this.callback=a||null;this.active=true;this.anchor=b;var d=b.button.hook;this.setPos(d.screenCoords.x-429+d.screenCoords.w,d.screenCoords.y+d.screenCoords.h);d=sc.options.get("language");this._prevPressed=this.buttons[d];this.resetButtons(this._prevPressed);this.buttongroup.setPressedFocusGui(this._prevPressed);ig.interact.setBlockDelay(0.2);this.doStateTransition("DEFAULT")}},hide:function(){if(this.active){this.active=false;sc.menu.popBackCallback();
sc.menu.buttonInteract.removeButtonGroup(this.buttongroup);this.callback&&this.callback();this.anchor.onLanguageSelected(true);sc.menu.buttonInteract.clearMouseOverFocus();this.doStateTransition("HIDDEN")}},onBackButtonPressed:function(){this.hide()}})});ig.baked=!0;
ig.module("game.feature.menu.gui.options.options-types").requires("impact.feature.gui.gui","impact.feature.gui.base.basic-gui","impact.feature.gui.base.box","game.feature.gui.base.text","game.feature.menu.gui.menu-misc","game.feature.menu.gui.options.options-misc","game.feature.model.options-model").defines(function(){var b=[],a=0,d=0;sc.OPTION_GUIS={};sc.OPTION_GUIS[sc.OPTION_TYPES.BUTTON_GROUP]=ig.GuiElementBase.extend({base:null,buttons:[],_prevPressed:null,_rowGroup:null,init:function(a,d,f){this.parent();
this.base=a;var g=a.option.data;b.length=0;for(var h in g)b.push(g[h]);this._rowGroup=f;g=Math.floor(d/b.length);h=null;for(var i,j=0,k=0;k<b.length;k++){i=ig.lang.get("sc.gui.options."+a.optionName+".group")[b[k]];h=k==0?new sc.ButtonGui(i,g,true,sc.BUTTON_TYPE.GROUP_LEFT,null,true):k==b.length-1?new sc.ButtonGui(i,g,true,sc.BUTTON_TYPE.GROUP_RIGHT,null,true):new sc.ButtonGui(i,g,true,sc.BUTTON_TYPE.GROUP,null,true);k==b.length-1&&g*b.length<d?h.setWidth(g+1):h.setWidth(g);h.noFocusOnPressed=true;
var l=g;if((new ig.TextBlock(sc.fontsystem.font,i,{})).size.x<l-16)i=sc.fontsystem.font;else if((new ig.TextBlock(sc.fontsystem.smallFont,i,{})).size.x<l-16)i=sc.fontsystem.smallFont;else{new ig.TextBlock(sc.fontsystem.tinyFont,i,{});i=sc.fontsystem.tinyFont}i!=h.textChild.font&&h.textChild.setFont(i,null);h.setPressed=function(a){(this.pressed=a)?this.textChild.setText("\\c[0]"+this.text):this.textChild.setText("\\c["+sc.FONT_COLORS.GREY+"]"+this.text)};h.data={description:a.optionDes,id:b[k],row:a.row};
h.setPos(j,3);j=j+h.hook.size.x;f.addFocusGui(h,k,a.row);this.buttons[b[k]]=h;this.addChildGui(h)}a=sc.options.get(a.optionName,a.local);this._prevPressed=this.buttons[a];this.resetButtons(this._prevPressed);f.setPressedFocusGui(this._prevPressed)},resetButtons:function(a){for(var b=this.buttons.length;b--;)this.buttons[b]!=a&&this.buttons[b].setPressed(false)},onAttach:function(){sc.Model.addObserver(sc.options,this)},onDetach:function(){sc.Model.removeObserver(sc.options,this)},modelChanged:function(a,
b){if(b==sc.OPTIONS_EVENT.OPTION_CHANGED){var d=sc.options.get(this.base.optionName,this.base.local);if(this._prevPressed!=this.buttons[d]){this._prevPressed=this.buttons[d];this.resetButtons(this._prevPressed);this._rowGroup.setPressedFocusGui(this._prevPressed)}}},onPressed:function(a){if(this._prevPressed!=a){this.resetButtons(a);sc.options.set(this.base.optionName,a.data.id,this.base.local);this._prevPressed=a}}});sc.OPTION_GUIS[sc.OPTION_TYPES.OBJECT_SLIDER]=ig.GuiElementBase.extend({slider:null,
base:null,entries:[],currentNumber:null,_lastVal:0,init:function(a,b,d){this.parent();this.base=a;var g=a.option.snap==void 0?true:a.option.snap,h=a.option.data,i=0,j=0,k;for(k in h){this.entries[i]=h[k];h[k]==sc.options.get(a.optionName,a.local)&&(j=i);i++}this._lastVal=j;b=b-4;this.slider=new sc.OptionFocusSlider(this.onChange.bind(this),g,a.option.fill,d);this.slider.setPreferredThumbSize(Math.floor(b/this.entries.length),21);this.slider.setPos(0,0);this.slider.setMinMaxValue(0,this.entries.length-
1);this.slider.setValue(j);this.slider.setSize(b-4,21,9);this.slider.data=a.optionDes;this.addChildGui(this.slider);this.currentNumber=(this.showPercentage=a.option.showPercentage)?new sc.TextGui("100%"):new sc.NumberGui(this.entries.length);this.updateNumberDisplay();this.currentNumber.setAlign(ig.GUI_ALIGN.X_CENTER,ig.GUI_ALIGN.Y_CENTER);this.slider.thumb.addChildGui(this.currentNumber);d.addFocusGui(this.slider,0,a.row)},updateNumberDisplay:function(){if(this.showPercentage){var a=Math.round(this.entries[this._lastVal]*
100)+"%";this.currentNumber.setText(a)}else this.currentNumber.setNumber(this._lastVal+1,true)},onAttach:function(){sc.Model.addObserver(sc.options,this)},onDetach:function(){sc.Model.removeObserver(sc.options,this)},modelChanged:function(a,b){if(b==sc.OPTIONS_EVENT.OPTION_CHANGED){var d=sc.options.get(this.base.optionName,this.base.local);if(d!=this.entries[this._lastVal]){this._lastVal=d=this.entries.indexOf(d);this.slider.setValue(d);this.updateNumberDisplay()}}},onChange:function(a){if(a!=this._lastVal){this._lastVal=
a;this.updateNumberDisplay();sc.options.set(this.base.optionName,this.entries[a],this.base.local)}},onLeftRight:function(a){this._lastVal=a?this._lastVal+1:this._lastVal-1;this.slider.setValue(this._lastVal);this._lastVal=this.slider.getValue();this.updateNumberDisplay();sc.options.set(this.base.optionName,this.entries[this._lastVal],this.base.local)}});sc.OPTION_GUIS[sc.OPTION_TYPES.ARRAY_SLIDER]=ig.GuiElementBase.extend({slider:null,base:null,_lastVal:0,scale:0,stepSize:0,init:function(a,b,d){this.parent();
this.base=a;var g=a.option;this.scale=10;this.stepSize=1;var h=g.data,b=b-4;this.slider=new sc.OptionFocusSlider(this.onChange.bind(this),g.snap,g.fill,d);this.slider.setPreferredThumbSize(10,21);this.slider.setMinMaxValue(h[0]*this.scale,h[1]*this.scale);this.slider.setValue(sc.options.get(a.optionName,a.local)*this.scale);this.slider.setSize(b-4,21,9);this.slider.data=a.optionDes;this.addChildGui(this.slider);this._lastVal=this.slider.getValue();d.addFocusGui(this.slider,0,a.row)},onAttach:function(){sc.Model.addObserver(sc.options,
this)},onDetach:function(){sc.Model.removeObserver(sc.options,this)},modelChanged:function(a,b){if(b==sc.OPTIONS_EVENT.OPTION_CHANGED){var d=sc.options.get(this.base.optionName,this.base.local)*this.scale;if(this._lastVal!=d){this.slider.setValue(d);this._lastVal=d}}},onChange:function(a){if(a!=this._lastVal){this._lastVal=a;sc.options.set(this.base.optionName,a/this.scale,this.base.local)}},onLeftRight:function(a){this._lastVal=a?this._lastVal+1:this._lastVal-1;this.slider.setValue(this._lastVal);
this._lastVal=this.slider.getValue();sc.options.set(this.base.optionName,this._lastVal/this.scale,this.base.local)}});sc.OPTION_GUIS[sc.OPTION_TYPES.CHECKBOX]=ig.GuiElementBase.extend({base:null,button:null,init:function(a,b,d){this.parent();this.base=a;b=sc.options.get(a.optionName,a.local);this.button=new sc.CheckboxGui(b,30);this.button.setAlign(ig.GUI_ALIGN.X_LEFT,ig.GUI_ALIGN.Y_CENTER);this.button.data={description:a.optionDes,row:a.row};this.addChildGui(this.button);d.addFocusGui(this.button,
0,a.row)},onAttach:function(){sc.Model.addObserver(sc.options,this)},onDetach:function(){sc.Model.removeObserver(sc.options,this)},onPressed:function(a){a==this.button&&sc.options.set(this.base.optionName,a.pressed)},modelChanged:function(a,b){if(b==sc.OPTIONS_EVENT.OPTION_CHANGED){var d=sc.options.get(this.base.optionName);this.button.pressed!=d&&this.button.setPressed(d)}}});sc.OPTION_GUIS[sc.OPTION_TYPES.CONTROLS]=ig.GuiElementBase.extend({keyButton:null,altButton:null,base:null,controlKey:"",
init:function(a,b,d){this.parent();this.base=a;this.controlKey=this.base.optionName.substr(5);var g=Math.floor(b/2);a.option.isDebug?this.base.nameGui.setText("Debug "+this.controlKey):this.base.nameGui.setText(ig.lang.get("sc.gui.options.controls.keys."+this.controlKey));this.base.optionDes=ig.lang.get("sc.gui.options.controls.description");var h=sc.options.get(a.optionName),i=h.key1,i=new sc.ButtonGui("\\i[keyCode-"+i+"]",g,true,sc.BUTTON_TYPE.GROUP_LEFT);i.setWidth(g);i.data={description:a.optionDes,
row:a.row};i.setPos(0,3);this.keyButton=i;i=h.key2;i=new sc.ButtonGui(i?"\\i[keyCode-"+i+"]":ig.lang.get("sc.gui.options.controls.none"),g,true,sc.BUTTON_TYPE.GROUP_RIGHT);i.setWidth(b>g*2?g+1:g);i.data={description:a.optionDes,row:a.row};i.setPos(g,3);this.altButton=i;this.addChildGui(this.keyButton);this.addChildGui(this.altButton);d.addFocusGui(this.keyButton,0,a.row);d.addFocusGui(this.altButton,1,a.row)},onAttach:function(){sc.Model.addObserver(sc.options,this)},onDetach:function(){sc.Model.removeObserver(sc.options,
this)},onPressed:function(a){a==this.keyButton?sc.keyBinderGui.show(this.onButtonSetCallback.bind(this),this.controlKey,false):a==this.altButton&&sc.keyBinderGui.show(this.onButtonSetCallback.bind(this),this.controlKey,true)},onButtonSetCallback:function(a,b,d){var g=this.base.optionName;sc.options.keyBinder.changeBinding(g,a,b,d);a=sc.options.get(g);this.keyButton.textChild.setText("\\i[keyCode-"+a.key1+"]");this.altButton.textChild.setText(a.key2?"\\i[keyCode-"+a.key2+"]":ig.lang.get("sc.gui.options.controls.none"))},
modelChanged:function(a,b){if(b==sc.OPTIONS_EVENT.OPTION_KEYS_SWAPPED){var d=sc.options.get(this.base.optionName);this.keyButton.textChild.setText("\\i[keyCode-"+d.key1+"]");this.altButton.textChild.setText(d.key2?"\\i[keyCode-"+d.key2+"]":ig.lang.get("sc.gui.options.controls.none"))}}});sc.OPTION_GUIS[sc.OPTION_TYPES.LANGUAGE]=ig.GuiElementBase.extend({button:null,base:null,init:function(a,b,d){this.parent();this.base=a;var g=sc.options.get(a.optionName),g="\\i[language-"+g+"] "+ig.lang.get("sc.gui.options.language.group")[g],
g=new sc.ButtonGui(g,b,true,sc.BUTTON_TYPE.DEFAULT);g.setWidth(b);g.data={description:a.optionDes,row:a.row};g.setPos(0,3);this.button=g;this.addChildGui(this.button);d.addFocusGui(this.button,0,a.row)},onAttach:function(){sc.Model.addObserver(sc.options,this)},onDetach:function(){sc.Model.removeObserver(sc.options,this)},onPressed:function(a){a==this.button&&sc.menu.openLanguagePopUp(this)},onLanguageSelected:function(a,b){a?ig.input.mouseGuiActive&&this.button.focusLost():sc.options.set(this.base.optionName,
b,this.base.local)},modelChanged:function(a,b){if(b==sc.OPTIONS_EVENT.OPTION_CHANGED){var d=sc.options.get(this.base.optionName),d="\\i[language-"+d+"] "+ig.lang.get("sc.gui.options.language.group")[d];this.button.setText(d,true)}}});sc.OptionInfoBox=ig.GuiElementBase.extend({text:null,box:null,init:function(a,b){this.parent();this.text=new sc.TextGui(ig.lang.get("sc.gui."+a.data),{maxWidth:b-36,font:sc.fontsystem.smallFont});var d=new ig.GuiElementBase;d.setSize(b-36,this.text.hook.size.y);d.addChildGui(this.text);
this.box=new sc.CenterBoxGui(d,true);this.box.setAlign(ig.GUI_ALIGN.X_CENTER,ig.GUI_ALIGN.Y_TOP);this.box.setPos(1,0);this.addChildGui(this.box);this.setSize(b||400,this.box.hook.size.y-5)}});sc.OptionRow=ig.GuiElementBase.extend({gfx:new ig.Image("media/gui/menu.png"),row:-1,optionName:null,option:null,optionDes:null,local:false,divider:false,nameGui:null,typeGui:null,_hasEntered:false,_rowGroup:null,init:function(a,b,d,g,h,i){if(!a)throw Error("option entry is null!");this.parent();this.setSize(h||
400,i||26);this._rowGroup=d;this.local=g||false;this.optionName=a;this.option=sc.OPTIONS_DEFINITION[this.optionName];this.optionDes=ig.lang.get("sc.gui.options."+this.optionName+".description");this.row=b;this.nameGui=new sc.TextGui(ig.lang.get("sc.gui.options."+this.optionName+".name"));this.nameGui.setPos(5,4);this.addChildGui(this.nameGui);a=new ig.ColorGui("#545454",166,1);a.setAlign(ig.GUI_ALIGN.X_LEFT,ig.GUI_ALIGN.Y_BOTTOM);a.setPos(0,4);this.addChildGui(a);b=new ig.ImageGui(this.gfx,32,416,
8,8);b.setAlign(ig.GUI_ALIGN.X_LEFT,ig.GUI_ALIGN.Y_BOTTOM);b.setPos(a.hook.size.x,3);this.addChildGui(b);a=this.hook.size.x-175;if(b=sc.OPTION_GUIS[sc.OPTION_TYPES[this.option.type]]){this.typeGui=new b(this,a,d);this.typeGui.setSize(a,26);this.typeGui.setAlign(ig.GUI_ALIGN.X_LEFT,ig.GUI_ALIGN.Y_BOTTOM);this.typeGui.setPos(175,0);this.addChildGui(this.typeGui)}else{d=new sc.TextGui("Missing Option Type: "+this.option.type);d.setPos(175,4);this.addChildGui(d)}if(this.option.hasDivider){this.divider=
true;this.hook.size.y=this.hook.size.y+17;d=new sc.TextGui(ig.lang.get("sc.gui.options.headers."+this.option.header),{font:sc.fontsystem.tinyFont});d.setPos(2,6);this.addChildGui(d);this.nameGui.setPos(5,21)}if(this.option.data==ig.TextBlock.SPEED){d=new sc.TextGui(ig.lang.get("sc.gui.options.text-speed.example"),{speed:sc.options.get(this.optionName)});d.setAlign(ig.GUI_ALIGN.X_RIGHT,ig.GUI_ALIGN.Y_TOP);d.setPos(265,4);var j=d.textBlock;j.optName=this.optionName;j.optTimer=0.7;j.realUpdate=j.update;
j.update=function(){j.realUpdate();this.setSpeed(sc.options.get(this.optName));if(this.isFinished())if(this.optTimer<=0){this.reset();this.optTimer=0.7}else this.optTimer=this.optTimer-ig.system.actualTick};this.addChildGui(d)}this.hook.setMouseRecord(true)},updateDrawables:function(a){this.divider&&a.addColor("#545454",0,this.hook.size.y-26-1-2,this.hook.size.x+2,1)},onPressed:function(a){this.typeGui.onPressed&&this.typeGui.onPressed(a)},onLeftRight:function(a){return this.typeGui.onLeftRight&&
this.typeGui.onLeftRight(a)||true},onMouseInteract:function(){if(sc.menu.buttonInteract.isActive()&&this._rowGroup.isActive()){var b=this.hook.screenCoords;a=sc.control.getMouseX();d=sc.control.getMouseY();if(b.x<=a&&b.x+b.w>a&&b.y<=d&&b.y+b.h>d){if(!this._hasEntered){sc.menu.setInfoText(this.optionDes);this._hasEntered=true}}else if(this._hasEntered){sc.menu.setInfoText("",true);this._hasEntered=false}}}})});ig.baked=!0;
ig.module("game.feature.menu.gui.options.options-list").requires("impact.feature.gui.gui","impact.feature.gui.base.basic-gui","impact.feature.gui.base.box","game.feature.gui.base.text","game.feature.menu.gui.menu-misc","game.feature.menu.gui.list-boxes","game.feature.menu.gui.item.item-list","game.feature.menu.gui.options.options-types").defines(function(){sc.keyBinderGui=null;sc.OptionsTabBox=ig.GuiElementBase.extend({gfx:new ig.Image("media/gui/menu.png"),list:null,tabs:{general:null,"interface":null,
video:null,audio:null,controls:null,assists:null,arena:null},bg:null,keyBinder:null,tabArray:[],tabGroup:null,rowButtonGroup:null,tabContent:[],rows:[],prevIndex:-1,prevPressed:null,isLocal:false,init:function(b){this.parent();this.setSize(436,258);this.setAlign(ig.GUI_ALIGN.X_CENTER,ig.GUI_ALIGN.Y_CENTER);this.isLocal=b;this.submitSound=sc.BUTTON_SOUND.submit;this.hook.transitions={DEFAULT:{state:{},time:0.2,timeFunction:KEY_SPLINES.LINEAR},HIDDEN:{state:{alpha:0,offsetX:218},time:0.2,timeFunction:KEY_SPLINES.LINEAR}};
this.tabGroup=new sc.ButtonGroup;this.tabGroup.addPressCallback(function(a){if(this.prevPressed!=a){this.submitSound.play();this.prevPressed=a;a.setPressed(true);this._resetButtons(a);this._rearrangeTabs();sc.menu.optionLastButtonData=a.data;for(var b=this.tabArray.length;b--;)if(a==this.tabArray[b]){this._refocusFromCycle=b;sc.menu.setOptionTab(b);break}ig.input.mouseGuiActive&&sc.menu.setInfoText("")}}.bind(this));b=new sc.MenuPanel;b.setSize(436,242);b.setPos(0,21);this.addChildGui(b);this.bg=
new sc.MenuScanLines;this.bg.setPos(0,29);this.bg.setSize(436,228);this.addChildGui(this.bg);b=new ig.ImageGui(this.gfx,32,408,5,5);b.setPos(0,21);this.addChildGui(b);b=new ig.ColorGui("#FF6D00",431,1);b.setPos(5,21);this.addChildGui(b);b=0;this.tabs.general=this._createTabButton("general",b++,sc.OPTION_CATEGORY.GENERAL);this.tabs.interface=this._createTabButton("interface",b++,sc.OPTION_CATEGORY.INTERFACE);this.tabs.video=this._createTabButton("video",b++,sc.OPTION_CATEGORY.VIDEO);this.tabs.gamepad=
this._createTabButton("gamepad",b++,sc.OPTION_CATEGORY.GAMEPAD);if(ig.vars.get("arenaVars.statsUnlocked"))this.tabs.arena=this._createTabButton("arena",b++,sc.OPTION_CATEGORY.ARENA);this.tabs.controls=this._createTabButton("controls",b++,sc.OPTION_CATEGORY.CONTROLS);this.tabs.assists=this._createTabButton("assists",b,sc.OPTION_CATEGORY.ASSISTS);sc.menu.optionLastButtonData=this.tabs.general.data;this.tabGroup.setCurrentFocus(0,0);this.tabs.general.setPressed(true);this.prevPressed=this.tabs.general;
this._rearrangeTabs();this.doStateTransition("HIDDEN",true)},addObservers:function(){sc.Model.addObserver(sc.menu,this)},removeObservers:function(){sc.Model.removeObserver(sc.menu,this)},showMenu:function(){sc.menu.buttonInteract.addParallelGroup(this.tabGroup);ig.interact.setBlockDelay(0.2);this.keyBinder=new sc.KeyBinderGui;ig.gui.addGuiElement(this.keyBinder);sc.keyBinderGui=this.keyBinder;var b=sc.menu.optionLastButtonData;b&&this._createCacheList(b.type,true,ig.input.mouseGuiActive,true);this.doStateTransition("DEFAULT")},
exitMenu:function(){sc.menu.buttonInteract.removeParallelGroup(this.tabGroup);sc.options.persistOptions();this.list.deactivate();this.keyBinder.remove();sc.keyBinderGui=null;this.doStateTransition("HIDDEN")},_createCacheList:function(b,a,d,c){a=a||false;d=d||false;c=c||false;if(this.tabContent[this.prevIndex]){this.list.deactivate();this.list.doStateTransition("HIDDEN",true)}var e=sc.menu.optionCurrentTab,f=this.tabContent[e];if(f){this.list=f.list;this.rows=f.rows;this.rowButtonGroup=f.buttonGroup;
this.list.activate();this.list.doStateTransition("DEFAULT",true);a&&!d&&this.rowButtonGroup.regainCurrentFocus(false,c)}else{f={buttonGroup:null,list:null,rows:null};this.rowButtonGroup=new sc.RowButtonGroup;this.rowButtonGroup.enableMultiPressed=true;this.rowButtonGroup.soundsOnPressed=true;this.list=new sc.ButtonListBox(1,1,28);this.list.setPos(0,29);this.list.setSize(436,228);this.list.setButtonGroup(this.rowButtonGroup);this.list.hook.transitions={DEFAULT:{state:{},time:0.2,timeFunction:KEY_SPLINES.LINEAR},
HIDDEN:{state:{alpha:0},time:0.2,timeFunction:KEY_SPLINES.LINEAR}};this.addChildGui(this.list);this.rowButtonGroup.isNonMouseMenuInput=this.isNonMouseMenuInput.bind(this);this.rowButtonGroup.addSelectionCallback(function(a){a.data&&sc.menu.setInfoText(a.data.description?a.data.description:a.data)}.bind(this));this.rowButtonGroup.setLeftRightCallback(function(a,b){return this.rows[b]?this.rows[b].onLeftRight(a):true}.bind(this));this.rowButtonGroup.addPressCallback(function(a){if(a.data&&a.data.row!=
void 0)this.rows[a.data.row].onPressed(a)}.bind(this));this.rowButtonGroup.onButtonTraversal=this.onButtonTraversal.bind(this);if(b==sc.OPTION_CATEGORY.CONTROLS)this.rowButtonGroup.usePrevRowIndex=true;this._createOptionList(b);f.buttonGroup=this.rowButtonGroup;f.list=this.list;f.rows=this.rows;this.list.activate();this.tabContent[e]=f;this.prevIndex=e}},_createOptionList:function(b){var a=[],d=null,d=null,c=false,e=0,d=sc.OPTIONS_DEFINITION,f;for(f in d){d=sc.OPTIONS_DEFINITION[f];c=false;if(d.cat==
b){d.browser?ig.platform==ig.PLATFORM_TYPES.BROWSER&&(c=true):d.noBrowser?ig.platform!=ig.PLATFORM_TYPES.BROWSER&&(c=true):c=true;if(c){d=d.type=="INFO"?new sc.OptionInfoBox(d,431):new sc.OptionRow(f,e,this.rowButtonGroup,this.isLocal,431);this.list.addButton(d,true);a[e]=d;e++}}}this.rows=a},_resetButtons:function(b,a){for(var d=0;d<this.tabArray.length;d++){b!=this.tabArray[d]&&this.tabArray[d].setPressed(false);if(a)this.tabArray[d].focus=false}},_rearrangeTabs:function(){for(var b=9,a=null,d=
0;d<this.tabArray.length;d++){a=this.tabArray[d];a.hook.pos.x=b;b=b+a.hook.size.x}},_createTabButton:function(b,a,d){b=new sc.ItemTabbedBox.TabButton(ig.lang.get("sc.gui.menu.option."+b),b,90);b.textChild.setPos(7,1);b.setPos(0,2);b.setData({type:d});this.addChildGui(b);this.tabGroup.addFocusGui(b,a,0);return this.tabArray[a]=b},isNonMouseMenuInput:function(){return sc.control.menuConfirm()||sc.control.rightDown()||sc.control.leftDown()||sc.control.downDown()||sc.control.upDown()||sc.control.menuCircleLeft()||
sc.control.menuCircleRight()},onButtonTraversal:function(){var b=sc.menu.optionCurrentTab,a=this.tabArray[b],d=-1;sc.control.menuCircleRight()?d=1:sc.control.menuCircleLeft()&&(d=0);if(d>=0){this.submitSound.play();a.setPressed(false);if(d==1){b++;b>=this.tabArray.length&&(b=0)}else{b--;b<0&&(b=this.tabArray.length-1)}this.prevPressed=a=this.tabArray[b];a.setPressed(true);this._resetButtons(a,true);this._rearrangeTabs();sc.menu.optionLastButtonData=a.data;sc.menu.setOptionTab(b)}},modelChanged:function(b,
a){b==sc.menu&&a==sc.MENU_EVENT.OPTION_CHANGED_TAB&&this._createCacheList(sc.menu.optionLastButtonData.type,true,ig.input.mouseGuiActive,!ig.input.mouseGuiActive)}})});ig.baked=!0;
ig.module("game.feature.menu.gui.options.options-menu").requires("impact.feature.gui.gui","game.feature.menu.gui.options.options-list").defines(function(){sc.OptionsMenu=sc.BaseMenu.extend({hotkeyHelp:null,hotkeyDefault:null,listBox:null,helpGui:null,blackBox:null,langGui:null,init:function(){this.parent();this.hook.size.x=ig.system.width;this.hook.size.y=ig.system.height;this.hotkeyHelp=new sc.ButtonGui("\\i[help]"+ig.lang.get("sc.gui.menu.hotkeys.help"),void 0,true,sc.BUTTON_TYPE.SMALL);this.hotkeyHelp.keepMouseFocus=
true;this.hotkeyHelp.hook.transitions={DEFAULT:{state:{},time:0.2,timeFunction:KEY_SPLINES.EASE},HIDDEN:{state:{offsetY:-this.hotkeyHelp.hook.size.y},time:0.2,timeFunction:KEY_SPLINES.LINEAR}};this.hotkeyHelp.onButtonPress=this.onHelpButtonPressed.bind(this);this.hotkeyDefault=new sc.ButtonGui("\\i[help2]"+ig.lang.get("sc.gui.menu.hotkeys.reset-default"),void 0,true,sc.BUTTON_TYPE.SMALL);this.hotkeyDefault.keepMouseFocus=true;this.hotkeyDefault.hook.transitions={DEFAULT:{state:{},time:0.2,timeFunction:KEY_SPLINES.EASE},
HIDDEN:{state:{offsetY:-this.hotkeyDefault.hook.size.y},time:0.2,timeFunction:KEY_SPLINES.LINEAR}};this.hotkeyDefault.onButtonPress=this.onDefaultButtonPressed.bind(this);this.listBox=new sc.OptionsTabBox(sc.menu.optionsLocalMode);this.addChildGui(this.listBox);this.blackBox=new ig.ColorGui("black",433,196);this.blackBox.hook.transitions={DEFAULT:{state:{},time:0.2,timeFunction:KEY_SPLINES.LINEAR},HIDDEN:{state:{alpha:0},time:0.2,timeFunction:KEY_SPLINES.LINEAR}};this.blackBox.hook.localAlpha=0.8;
this.blackBox.setPos(-1,29);this.blackBox.setAlign(ig.GUI_ALIGN.X_CENTER,ig.GUI_ALIGN.Y_CENTER);this.blackBox.doStateTransition("HIDDEN",true);this.addChildGui(this.blackBox);this.langGui=new sc.OptionLangPopUp;this.addChildGui(this.langGui);this.doStateTransition("DEFAULT",true)},addObservers:function(){sc.Model.addObserver(sc.menu,this);this.listBox.addObservers()},removeObservers:function(){sc.Model.removeObserver(sc.menu,this);this.listBox.removeObservers()},showMenu:function(){this.addObservers();
sc.menu.pushBackCallback(this.onBackButtonPress.bind(this));sc.menu.moveLeaSprite(0,0,sc.MENU_LEA_STATE.HIDDEN);this.onAddHotkeys();this.listBox.showMenu()},hideMenu:function(){this.removeObservers();sc.menu.moveLeaSprite(0,0,sc.MENU_LEA_STATE.LARGE);this.exitMenu()},exitMenu:function(){sc.menu.buttonInteract.removeGlobalButton(this.hotkeyHelp);sc.menu.buttonInteract.removeGlobalButton(this.hotkeyDefault);this.helpGui=null;this.langGui.hide();this.blackBox.doStateTransition("HIDDEN");this.listBox.exitMenu()},
onHotkeyDefaultCheck:function(){return sc.control.menuHotkeyHelp2()},onDefaultButtonPressed:function(){sc.Dialogs.showYesNoDialog(ig.lang.get("sc.gui.dialogs.resetAsk"),sc.DIALOG_INFO_ICON.WARNING,function(b){b.data==0&&sc.options.resetDefaultValues()}.bind(this))},onHotkeyHelpCheck:function(){return sc.control.menuHotkeyHelp()},onHelpButtonPressed:function(){sc.menu.removeHotkeys();this.createHelpGui();ig.gui.addGuiElement(this.helpGui);this.helpGui.openMenu()},createHelpGui:function(){if(!this.helpGui){this.helpGui=
new sc.HelpScreen(this,ig.lang.get("sc.gui.menu.help-texts.options.title"),ig.lang.get("sc.gui.menu.help-texts.options.pages"),function(){this.commitHotKeysToTopBar(true)}.bind(this),true);this.helpGui.hook.zIndex=15E4;this.helpGui.hook.pauseGui=true}},onAddHotkeys:function(b){sc.menu.buttonInteract.addGlobalButton(this.hotkeyHelp,this.onHotkeyHelpCheck.bind(this));sc.menu.buttonInteract.addGlobalButton(this.hotkeyDefault,this.onHotkeyDefaultCheck.bind(this));this.commitHotKeysToTopBar(b)},commitHotKeysToTopBar:function(b){sc.menu.addHotkey(function(){return this.hotkeyDefault}.bind(this));
sc.menu.addHotkey(function(){return this.hotkeyHelp}.bind(this));sc.menu.commitHotkeys(b)},onBackButtonPress:function(){sc.menu.popBackCallback();sc.menu.popMenu()},onLangPopUpClose:function(){this.blackBox.doStateTransition("HIDDEN")},modelChanged:function(b,a,d){if(b==sc.menu)if(a==sc.MENU_EVENT.OPTION_LANG_POP_UP){this.langGui.show(d,this.onLangPopUpClose.bind(this));this.blackBox.doStateTransition("DEFAULT")}else if(a==sc.MENU_EVENT.OPTION_CHANGED_TAB){this.langGui.hide();this.blackBox.doStateTransition("HIDDEN")}}})});
ig.baked=!0;
ig.module("game.feature.menu.gui.shop.shop-start").requires("impact.feature.gui.gui","impact.feature.gui.base.basic-gui","game.feature.menu.gui.menu-misc","game.feature.gui.base.button").defines(function(){sc.ShopStartMenu=ig.BoxGui.extend({ninepatch:new ig.NinePatch("media/gui/menu.png",{width:16,height:9,left:4,top:4,right:4,bottom:4,offsets:{"default":{x:512,y:457}}}),transitions:{DEFAULT:{state:{},time:0.2,timeFunction:KEY_SPLINES.LINEAR},HIDDEN:{state:{alpha:0,offsetY:10},time:0.2,timeFunction:KEY_SPLINES.LINEAR},
HIDDEN_SCALE:{state:{alpha:0,scaleX:0},time:0.2,timeFunction:KEY_SPLINES.LINEAR}},buy:null,sell:null,buttongroup:null,init:function(){this.parent(162,71);this.setAlign(ig.GUI_ALIGN.X_CENTER,ig.GUI_ALIGN.Y_CENTER);this.setSize(162,71);this.setPos(0,-1);this.buttongroup=new sc.ButtonGroup;this.buttongroup.addPressCallback(this.onButtonPress.bind(this));this.buy=new sc.ButtonGui(ig.lang.get("sc.gui.shop.buy"),150);this.buy.setAlign(ig.GUI_ALIGN.X_CENTER,ig.GUI_ALIGN.Y_TOP);this.buy.setPos(0,8);this.buy.setData(0);
this.addChildGui(this.buy);this.sell=new sc.ButtonGui(ig.lang.get("sc.gui.shop.sell"),150);this.sell.setAlign(ig.GUI_ALIGN.X_CENTER,ig.GUI_ALIGN.Y_BOTTOM);this.sell.setPos(0,8);this.sell.setData(1);this.addChildGui(this.sell);var b=ig.database.get("shops")[sc.menu.shopID];sc.MENU_SHOP_TYPES[b.shopType]==sc.MENU_SHOP_TYPES.BUY&&this.sell.setActive(false);this.buttongroup.addFocusGui(this.buy,0,0);this.buttongroup.addFocusGui(this.sell,0,1);this.doStateTransition("HIDDEN",true)},show:function(){sc.menu.buttonInteract.pushButtonGroup(this.buttongroup);
sc.menu.setInfoText("",true);this.doStateTransition("DEFAULT")},hide:function(b,a){sc.menu.buttonInteract.removeButtonGroup(this.buttongroup);this.doStateTransition(b?"HIDDEN_SCALE":"HIDDEN",a)},onButtonPress:function(b){b.data==0?sc.menu.setShopState(sc.MENU_SHOP_STATE.BUY):b.data==1&&sc.menu.setShopState(sc.MENU_SHOP_STATE.SELL)}});sc.ShopStartTitle=ig.BoxGui.extend({ninepatch:new ig.NinePatch("media/gui/menu.png",{width:16,height:9,left:4,top:4,right:4,bottom:4,offsets:{"default":{x:512,y:457}}}),
transitions:{DEFAULT:{state:{},time:0.2,timeFunction:KEY_SPLINES.LINEAR},HIDDEN:{state:{alpha:0,offsetY:-10},time:0.2,timeFunction:KEY_SPLINES.LINEAR},HIDDEN_SCALE:{state:{alpha:0,scaleX:0},time:0.2,timeFunction:KEY_SPLINES.LINEAR}},text:null,init:function(){this.parent(20,20);this.setAlign(ig.GUI_ALIGN.X_CENTER,ig.GUI_ALIGN.Y_TOP);this.setPos(0,50);this.text=new sc.TextGui;this.text.setAlign(ig.GUI_ALIGN.X_CENTER,ig.GUI_ALIGN.Y_CENTER);this.addChildGui(this.text);this.doStateTransition("HIDDEN",
true)},show:function(){var b=ig.database.get("shops")[sc.menu.shopID],b=b?ig.LangLabel.getText(b.name):"Unknown Shop Name";this.text.setText(" - "+b+" - ");this.setSize(this.text.hook.size.x+12,20);this.doStateTransition("DEFAULT")},hide:function(b,a){this.doStateTransition(b?"HIDDEN_SCALE":"HIDDEN",a)}})});ig.baked=!0;
ig.module("game.feature.menu.gui.shop.shop-misc").requires("game.feature.inventory.inventory").defines(function(){sc.ShopHelper={getMaxBuyable:function(b,a,d,c){if(sc.menu.shopSellMode)return sc.model.player.getItemAmount(b);var a=a*d,e=sc.menu.shopCoinMode?sc.arena.getTotalArenaCoins():sc.model.player.credit,b=Math.min(c||99,(c||99)-sc.model.player.getItemAmount(b));return b=Math.min(b,Math.floor(Math.max(0,e-sc.menu.getTotalCost()+a)/d))},sortList:function(b,a){switch(a){case sc.SORT_TYPE.ORDER:b.sort(function(a,
b){var e=sc.inventory,f=e.getItem(a.item||a.id),e=e.getItem(b.item||b.id),f=f.order+sc.ShopHelper.getItemTypeOrderAddition(f.type,f.equipType),e=e.order+sc.ShopHelper.getItemTypeOrderAddition(e.type,e.equipType);return f-e}.bind(this));break;case sc.SORT_TYPE.NAME:b.sort(function(a,b){var e=sc.inventory,f=ig.LangLabel.getText(e.getItem(a.item).name),e=ig.LangLabel.getText(e.getItem(b.item).name);return f.localeCompare(e)}.bind(this));break;case sc.SORT_TYPE.RARITY:b.sort(function(a,b){var e=sc.inventory,
f=e.getItem(a.item),e=e.getItem(b.item);if(f.rarity==e.rarity){f=f.order+sc.ShopHelper.getItemTypeOrderAddition(f.type,f.equipType);e=e.order+sc.ShopHelper.getItemTypeOrderAddition(e.type,e.equipType);return f-e}return(f.rarity||0)-(e.rarity||0)}.bind(this))}},getItemTypeOrderAddition:function(b,a){switch(b){case "CONS":return-1E4;case "EQUIP":switch(a){case "ARM":return 2E4;case "TORSO":return 3E4;case "FEET":return 4E4}return 1E4;case "TRADE":return 5E4;case "KEY":return 6E4}}}});ig.baked=!0;
ig.module("game.feature.menu.gui.shop.shop-list").requires("impact.feature.gui.gui","impact.feature.gui.base.basic-gui","impact.feature.gui.base.box","impact.feature.interact.press-repeater","game.feature.gui.base.boxes","game.feature.gui.base.text","game.feature.menu.gui.menu-misc","game.feature.menu.gui.list-boxes","game.feature.menu.gui.shop.shop-misc").defines(function(){sc.ShopListMenu=sc.MenuPanel.extend({buttongroup:null,pagesCache:[],list:null,repeater:null,_prevSortType:sc.SORT_TYPE.ORDER,
_amp:0,_ampTimer:0,_ampDir:null,init:function(){this.parent();this.setAlign(ig.GUI_ALIGN.X_RIGHT,ig.GUI_ALIGN.Y_CENTER);this.setSize(252,241);this.setPos(5,14);this.setPivot(126,0);this.hook.transitions={DEFAULT:{state:{alpha:1},time:0.2,timeFunction:KEY_SPLINES.LINEAR},HIDDEN:{state:{alpha:0,offsetX:-257},time:0.2,timeFunction:KEY_SPLINES.LINEAR}};this.list=new sc.ItemListBox(1);this.list.quantity.setText(ig.lang.get("sc.gui.shop.cost"));this.list.quantity.setPos(60,0);this.list.setSize(252,230);
this.list.setPos(0,3);this.buttongroup=this.list.list.buttonGroup;this.buttongroup.addSelectionCallback(function(a){if(a.data&&a.data!=1){sc.menu.setInfoText(a.data.description?a.data.description:a.data);if(a.data.id){var b=sc.inventory.getItem(a.data.id);b.equipType!=void 0?sc.menu.setItemInfo(a.data.id):sc.menu.resetItemInfo();b.isBuff?sc.menu.setBuffText(sc.inventory.getBuffString(a.data.id),false,a.data.id):sc.menu.setBuffText("",false)}else sc.menu.resetItemInfo()}}.bind(this));this.buttongroup.setMouseFocusLostCallback(function(){sc.menu.setInfoText("",
true);sc.menu.setBuffText("",true);sc.menu.resetItemInfo()}.bind(this));this.buttongroup.addPressCallback(this.onPressCallback.bind(this));this.buttongroup.isNonMouseMenuInput=function(){return sc.control.menuConfirm()||sc.control.downDown()||sc.control.upDown()}.bind(this);this.addChildGui(this.list);var b=new sc.TextGui(ig.lang.get("sc.gui.shop.owned"),{font:sc.fontsystem.tinyFont});b.setAlign(ig.GUI_ALIGN.X_RIGHT,ig.GUI_ALIGN.Y_TOP);b.setPos(5,0);this.list.addChildGui(b);this.repeater=new ig.PressRepeater;
this.doStateTransition("HIDDEN",true)},update:function(){if(this.buttongroup.isActive()&&!ig.interact.isBlocked()){if(this._ampTimer>0){this._ampTimer=this._ampTimer-ig.system.actualTick;if(this._ampTimer<=0)this._amp=this._ampTimer=0}switch(this.getRepeaterValue()){case "right":this.stepRight();break;case "left":this.stepLeft()}}},show:function(){sc.menu.pushBackCallback(this.onBackButtonPress.bind(this));sc.menu.buttonInteract.pushButtonGroup(this.buttongroup);sc.menu.shopSellMode?this.list.quantity.setText(ig.lang.get("sc.gui.shop.price")):
this.list.quantity.setText(ig.lang.get("sc.gui.shop.cost"));sc.menu.shopPage=0;this.createBuyList(true,ig.input.mouseGuiActive,!ig.input.mouseGuiActive,sc.SORT_TYPE.ORDER);ig.interact.setBlockDelay(0.2);this.doStateTransition("DEFAULT")},hide:function(){sc.menu.buttonInteract.removeButtonGroup(this.buttongroup);this.doStateTransition("HIDDEN")},getRepeaterValue:function(){sc.control.rightDown()?this.repeater.setDown("right"):sc.control.leftDown()&&this.repeater.setDown("left");return this.repeater.getPressed()},
getActiveElement:function(){return ig.input.mouseGuiActive?sc.menu.buttonInteract.mouseOverGui:this.buttongroup.getCurrentElement()},stepRight:function(){this.changeCount(1)},stepLeft:function(){this.changeCount(-1)},changeCount:function(b){var a=this.getActiveElement();if(a&&a.active&&a.data&&a.data.id){var d=ig.database.get("shops")[sc.menu.shopID].maxOwn||99,c=a.data.id,e=a.price,f=sc.menu.getItemQuantity(c,e),d=sc.ShopHelper.getMaxBuyable(c,f,e,d);if(!(f==0&&b==-1)&&!(f==d&&b==1)){this.playSound(b,
true);sc.menu.updateCart(c,f+b,e);a.setCountNumber(f+b,f==0);this.updateListEntries()}}},playSound:function(b,a){this._ampTimer=0.3;if(this._ampDir!=b)this._amp=0;this._ampDir=b;this._amp=Math.min(0.2,this._amp+0.04);b==1?sc.BUTTON_SOUND.shop_up.play(null,{speed:1+(a?this._amp:0)}):sc.BUTTON_SOUND.shop_down.play(null,{speed:1-(a?this._amp:0)})},updateListEntries:function(b){for(var a=sc.model.player,d=sc.menu.shopCoinMode?sc.arena.getTotalArenaCoins():a.credit,c=sc.menu.getTotalCost(),d=d-c,c=this.list.getChildren(),
e=c.length,f=ig.database.get("shops")[sc.menu.shopID].maxOwn||99;e--;){var g=c[e].gui;if(!sc.menu.shopSellMode){var h=sc.menu.getItemQuantity(g.data.id,g.price);a.getItemAmountWithEquip(g.data.id)>=f?g.setActive(false):!h&&g.price>d?g.setActive(false):g.setActive(true)}if(b){g.setCountNumber(0,true);g.owned.setNumber(sc.menu.shopSellMode?a.getItemAmount(g.data.id):a.getItemAmountWithEquip(g.data.id))}}},updateShopPage:function(b){this.createBuyList(true,ig.input.mouseGuiActive,!ig.input.mouseGuiActive,
b||sc.SORT_TYPE.ORDER)},createBuyList:function(b,a,d,c){b=b||false;a=a||false;d=d||false;this._prevSortType=c=c||sc.SORT_TYPE.ORDER;this.buttongroup.clear();this.list.clear(b);var e=null,e=null;if(sc.menu.shopSellMode){e=sc.SELL_PAGES[sc.menu.shopPage];e=e.type=="EQUIP"?sc.model.player.getEquipSubList(e.equipType,false,c):sc.model.player.getItemSubList(e.type,c)}else{e=ig.database.get("shops")[sc.menu.shopID].pages;e=ig.copy(e[sc.menu.shopPage].content);sc.ShopHelper.sortList(e,c)}sc.menu.shopSellMode?
this.scrapSellList(e):this.scrapBuyList(e);if(b){a?this.buttongroup.setCurrentFocus(0,0):this.buttongroup.focusCurrentButton(0,0,false,d);this.list.list.scrollToY(0,true)}this.getRepeaterValue()},scrapSellList:function(b){for(var a=null,a=null,d=0,c=0,e=0,f=c=0;f<b.length;f++){var e=b[f],a=sc.inventory.getItem(e),d=sc.model.player.getItemAmount(e),c=Math.floor(a.cost/2),g=new ig.LangLabel(a.name),g="\\i["+(a.icon+sc.inventory.getRaritySuffix(a.rarity||0)||"item-default")+"]"+ig.LangLabel.getText(a.name),
h=ig.LangLabel.getText(a.description),i=0;a.type==sc.ITEMS_TYPES.EQUIP&&(i=a.level||1);a=new sc.ShopItemButton(g,e,h,d,c,i);c==0&&a.setActive(false);c=sc.menu.getItemQuantity(e,c);c>0&&a.setCountNumber(c,true);this.list.addButton(a)}this.getRepeaterValue()},scrapBuyList:function(b){for(var a=null,d=null,c=0,e=0,f=0,g=0,h=sc.menu.shopCoinMode,i=(h?sc.arena.getTotalArenaCoins():sc.model.player.credit)-sc.menu.getTotalCost(),j=ig.database.get("shops")[sc.menu.shopID].maxOwn||99,k=0;k<b.length;k++)if(!b[k].condition||
(new ig.VarCondition(b[k].condition)).evaluate()){f=b[k].item;d=sc.inventory.getItem(f);c=sc.model.player.getItemAmountWithEquip(f);a=0;d.type==sc.ITEMS_TYPES.EQUIP&&(a=d.level||1);var e=b[k].price||(h?d.coins:d.cost),g=sc.menu.getItemQuantity(f,e),l=new ig.LangLabel(d.name),l="\\i["+(d.icon+sc.inventory.getRaritySuffix(d.rarity||0)||"item-default")+"]"+ig.LangLabel.getText(d.name),d=ig.LangLabel.getText(d.description),a=new sc.ShopItemButton(l,f,d,c,e,a);g>0&&a.setCountNumber(g,true);ig.database.get("shops")[sc.menu.shopID].maxOwn!=
void 0&&(c=sc.stats.getMap("items",f));(i<e&&!sc.menu.getItemQuantity(f,e)||c>=j)&&a.setActive(false);this.list.addButton(a)}},onPressCallback:function(b){sc.menu.openShopQuantitySelect(b)},onBackButtonPress:function(){sc.menu.shopCart.length>=1?sc.Dialogs.showYesNoDialog(ig.lang.get("sc.gui.shop.leaveWithCartItems"),sc.DIALOG_INFO_ICON.WARNING,function(b){b.data==0&&this.leaveList()}.bind(this)):this.leaveList()},leaveList:function(){sc.menu.popBackCallback();sc.menu.shopCart.length=0;sc.menu.setShopState(sc.MENU_SHOP_STATE.START)}});
sc.ShopPageCounter=ig.GuiElementBase.extend({transitions:{DEFAULT:{state:{},time:0.2,timeFunction:KEY_SPLINES.LINEAR},HIDDEN:{state:{alpha:0,offsetX:-257},time:0.2,timeFunction:KEY_SPLINES.LINEAR}},pageText:null,cycleLeft:null,cycleRight:null,init:function(){this.parent();this.setAlign(ig.GUI_ALIGN.X_RIGHT,ig.GUI_ALIGN.Y_TOP);this.setSize(158,21);this.setPos(52,29);this.hook.localAlpha=0.5;this.pageText=new sc.TextGui("");this.pageText.setAlign(ig.GUI_ALIGN.X_CENTER,ig.GUI_ALIGN.Y_CENTER);this.addChildGui(this.pageText);
this.cycleLeft=new sc.ButtonGui("\\i[arrow-left]",34,true,sc.BUTTON_TYPE.SMALL);this.cycleLeft.keepMouseFocus=true;this.cycleLeft.setPos(-27,0);this.cycleLeft.onButtonPress=function(){sc.menu.shopSellMode?this.cycleSellPages(-1):this.cycleOffers(-1)}.bind(this);this.addChildGui(this.cycleLeft);this.cycleRight=new sc.ButtonGui("\\i[arrow-right]",34,true,sc.BUTTON_TYPE.SMALL);this.cycleRight.keepMouseFocus=true;this.cycleRight.setAlign(ig.GUI_ALIGN.X_RIGHT,ig.GUI_ALIGN.Y_TOP);this.cycleRight.setPos(-27,
0);this.cycleRight.onButtonPress=function(){sc.menu.shopSellMode?this.cycleSellPages(1):this.cycleOffers(1)}.bind(this);this.addChildGui(this.cycleRight);this.doStateTransition("HIDDEN",true)},updateDrawables:function(b){b.addColor("#000",0,0,this.hook.size.x,this.hook.size.y)},show:function(){sc.menu.buttonInteract.addGlobalButton(this.cycleLeft,this.onLeftPressCheck.bind(this),true);sc.menu.buttonInteract.addGlobalButton(this.cycleRight,this.onRightPressCheck.bind(this),true);this.doStateTransition("DEFAULT");
var b=null;if(sc.menu.shopSellMode){b=sc.SELL_PAGES;this.pageText.setText(ig.lang.get("sc.gui.shop.sellPages."+b[sc.menu.shopPage].lang))}else{b=ig.database.get("shops")[sc.menu.shopID].pages;this.pageText.setText(ig.LangLabel.getText(b[sc.menu.shopPage].title))}if(b.length==1){this.cycleLeft.setActive(false);this.cycleRight.setActive(false);this.cycleLeft.setText("\\i[arrow-left-off]");this.cycleRight.setText("\\i[arrow-right-off]")}else{this.cycleLeft.setActive(true);this.cycleRight.setActive(true);
this.cycleLeft.setText("\\i[arrow-left]");this.cycleRight.setText("\\i[arrow-right]")}},hide:function(){sc.menu.buttonInteract.removeGlobalButton(this.cycleLeft);sc.menu.buttonInteract.removeGlobalButton(this.cycleRight);this.doStateTransition("HIDDEN")},cycleSellPages:function(b){var a=sc.SELL_PAGES,d=sc.menu.shopPage+b;b<0?d<0&&(d=a.length-1):b>0&&d>=a.length&&(d=0);sc.menu.setShopPage(d);this.pageText.setText(ig.lang.get("sc.gui.shop.sellPages."+a[sc.menu.shopPage].lang))},cycleOffers:function(b){var a=
ig.database.get("shops")[sc.menu.shopID].pages;if(a.length!=1){var d=sc.menu.shopPage+b;b<0?d<0&&(d=a.length-1):b>0&&d>=a.length&&(d=0);sc.menu.setShopPage(d);this.pageText.setText(ig.LangLabel.getText(a[sc.menu.shopPage].title))}},onLeftPressCheck:function(){return sc.control.menuCircleLeft()},onRightPressCheck:function(){return sc.control.menuCircleRight()}});sc.ShopItemButton=sc.ListBoxButton.extend({symbolGfx:new ig.Image("media/gui/menu.png"),cost:null,owned:null,count:null,symbol:null,level:0,
init:function(b,a,d,c,e,f){this.parent(b,142,106,a,d);this.price=e||0;this.level=f||0;this.owned=new sc.NumberGui(99,{transitionTime:0.1});this.owned.setNumber(c,true);this.owned.setAlign(ig.GUI_ALIGN.X_RIGHT,ig.GUI_ALIGN.Y_TOP);this.owned.setPos(4,7);this.addChildGui(this.owned);this.cost=new sc.NumberGui(999999);this.cost.setNumber(e,true);this.cost.setAlign(ig.GUI_ALIGN.X_RIGHT,ig.GUI_ALIGN.Y_TOP);this.cost.setPos(54,7);this.addChildGui(this.cost);this.count=new sc.NumberGui(99,{noZero:true,transitionTime:0.1});
this.count.setColor(sc.GUI_NUMBER_COLOR.GREEN);this.count.setNumber(0,true);this.count.setAlign(ig.GUI_ALIGN.X_RIGHT,ig.GUI_ALIGN.Y_TOP);this.count.setPos(28,7);this.addChildGui(this.count);this.symbol=new ig.ImageGui(this.symbolGfx,136,448,6,6);this.symbol.hook.transitions={DEFAULT:{state:{},time:0.2,timeFunction:KEY_SPLINES.LINEAR},HIDDEN:{state:{alpha:0},time:0.2,timeFunction:KEY_SPLINES.LINEAR}};this.symbol.setAlign(ig.GUI_ALIGN.X_RIGHT,ig.GUI_ALIGN.Y_TOP);this.symbol.setPos(46,8);this.addChildGui(this.symbol);
this.symbol.doStateTransition("HIDDEN",true);this.setLevel(f)},setCountNumber:function(b,a){this.count.setNumber(b,a);b>=1?this.symbol.doStateTransition("DEFAULT",true,false):this.symbol.doStateTransition("HIDDEN",true)},keepButtonPressed:function(){this.keepPressed=true;this.setPressed(true);this.button.keepPressed=true;this.button.setPressed(true)},unPressButton:function(){this.keepPressed=false;this.setPressed(false);this.button.keepPressed=false;this.button.setPressed(false)}})});ig.baked=!0;
ig.module("game.feature.trade.trade-model").requires("impact.base.game","impact.base.loader","impact.feature.interact.button-interact","impact.feature.database.database","impact.feature.storage.storage","game.feature.model.base-model").defines(function(){sc.TRADE_COMPARE_MODE={};sc.TRADE_COMPARE_MODE.EQUIP=0;sc.TRADE_COMPARE_MODE.OFF_HAND=1;sc.TRADE_COMPARE_MODE.BASE_STATS=2;sc.TRADE_SORT_TYPE={ORDER:0,FOUND:1};sc.TradeModel=ig.GameAddon.extend({observers:[],buttonInteract:null,options:null,infoText:null,
buffText:null,buffID:-1,equipID:-1,visible:false,sessionTradeCount:0,tradeIndex:0,statsToggle:false,statsToggleOffHand:false,hasEquippedTrade:false,equippedID1:{id:-1,bodypart:null},equippedID2:{id:-1,bodypart:null},compareMode:sc.TRADE_COMPARE_MODE.EQUIP,traders:{},tradersFound:{},init:function(){this.parent("Traders");this.buttonInteract=new ig.ButtonInteractEntry;ig.storage.register(this);window.wm&&ig.database.register("traders","TradeEnumEditor","Traders");this.traders=ig.database.get("traders")||
{};for(var b in this.traders){var a=this.traders[b];a.upgradeTo&&this.traders[a.upgradeTo]&&(this.traders[a.upgradeTo].child=b)}ig.vars.registerVarAccessor("traders",this,"VarTradeEditor")},onStorageSave:function(b){var a={},d;for(d in this.tradersFound)this.traders[d]&&(a[d]={characterName:this.tradersFound[d].characterName,map:this.tradersFound[d].map&&this.tradersFound[d].map.getSaveData?this.tradersFound[d].map.getSaveData():"???",area:this.tradersFound[d].area&&this.tradersFound[d].area.getSaveData?
this.tradersFound[d].area.getSaveData():"???",time:this.tradersFound[d].time||0});b.tradersFound=a},onStoragePreLoad:function(b){b=b.tradersFound||{};this.tradersFound={};for(var a in b)this.tradersFound[a]={characterName:b[a].characterName,map:new ig.LangLabel(b[a].map||"???"),area:new ig.LangLabel(b[a].area||"???"),time:b[a].time||0};this.checkForParents();sc.stats.setMap("trade","tradeRate",this.getTotalTradersFound(true))},onNewGameApply:function(b){this.onStoragePreLoad(b)},checkForParents:function(){for(var b in this.traders){var a=
this.traders[b];this.tradersFound[b]&&a.upgradeTo&&(this.tradersFound[a.upgradeTo]||this.unlockParents(a.upgradeTo,this.tradersFound[b].characterName,b))}},getTotalTradersFound:function(b,a){var d=0,c=0,e;for(e in this.traders)if(!this.traders[e].noTrack&&!(a&&this.traders[e].area!=a)){this.tradersFound[e]&&d++;c=c+1}return b?d/c:d},getTotalTraders:function(b){var a=0,d;for(d in this.traders)this.traders[d].noTrack||b&&this.traders[d].area!=b||a++;return a},onReset:function(){this.tradersFound={}},
onVarAccess:function(b,a){if(a[0]=="traders"){var d=a[1];if(this.traders[d])switch(a[2]){case "name":return ig.LangLabel.getText(this.traders[d].name);case "unlocked":return this.tradersFound[d]}}throw Error("Unsupported var access path: "+b);},hasAreaTraders:function(b){for(var a in this.traders)if(this.traders[a].area==b)return true;return false},hasTraderInArea:function(b){for(var a in this.tradersFound)if(this.traders[a]&&this.traders[a].area==b)return true;return false},hasAnyTraderFound:function(){if(sc.map.hasAnyAreaUnlocked())for(var b in this.tradersFound)return true;
return false},hasTrader:function(b){return this.tradersFound[b]},unlockTrader:function(b,a){if(!this.traders[b].noTrack&&!this.tradersFound[b]){this.tradersFound[b]={characterName:a||"",map:sc.map.getCurrentMapName(),area:sc.map.getCurrentPlayerAreaName(),time:(new Date).getTime()};var d=0;this.traders[b].upgradeTo&&(d=this.unlockParents(this.traders[b].upgradeTo,a,b));sc.stats.setMap("tradersFound",b,1);sc.stats.addMap("trade","tradersTotal",1);sc.stats.setMap("trade","tradeRate",this.getTotalTradersFound(true));
sc.menu.addLog({type:"TRADER",trader:b,isUpdate:d==1})}},unlockParents:function(b,a,d){if(this.traders[b].noTrack)return 0;if(this.tradersFound[b])return 1;this.tradersFound[b]={characterName:a||"",map:ig.copy(this.tradersFound[d].map),area:ig.copy(this.tradersFound[d].area),time:(new Date).getTime()};sc.stats.setMap("tradersFound",b,1);sc.stats.addMap("trade","tradersTotal",1);return this.traders[b].upgradeTo?this.unlockParents(this.traders[b].upgradeTo,a,b):2},resetTrader:function(b){if(!this.traders[b].noTrack&&
this.tradersFound[b]){sc.stats.setMap("tradersFound",b,0);sc.stats.subMap("trade","tradersTotal",1);sc.stats.setMap("trade","tradeRate",this.getTotalTradersFound(true));delete this.tradersFound[b]}},getTrader:function(b){return this.traders[b]},getTraderName:function(b){return ig.LangLabel.getText(this.traders[b].name)},getTraderAreaName:function(b,a){return sc.map.getAreaName(this.traders[b].area,a)},getFoundTrader:function(b){return this.tradersFound[b]},getFoundTraders:function(b,a){var d=[],c;
for(c in this.tradersFound)this.traders[c]&&(this.traders[c].noTrack||(b?this.traders[c].area==b&&d.push(c):d.push(c)));a!=void 0&&this.sortList(d,a);return d},sortList:function(b,a){switch(a){case sc.TRADE_SORT_TYPE.FOUND:b.sort(function(a,b){return(this.tradersFound[b].time||0)-(this.tradersFound[a].time||0)}.bind(this));break;case sc.TRADE_SORT_TYPE.ORDER:b.sort(function(a,b){return(this.traders[a].order||0)-(this.traders[b].order||0)}.bind(this))}},enterTrade:function(b){this.hasEquippedTrade=
false;ig.interact.addEntry(this.buttonInteract);this.options=b||null;this.visible=true;this.sessionTradeCount=0},exitTrade:function(){ig.interact.removeEntry(this.buttonInteract);this.options=null;this.statsToggle=this.hasEquippedTrade=this.visible=false;this.equippedID1.id=-1;this.buffID=this.equippedID2.id=-1;this.compareMode=sc.TRADE_COMPARE_MODE.EQUIP;this.tradeIndex=0},doTrade:function(b){sc.stats.addMap("trade","total",1);for(var a=this.options[this.tradeIndex],d=sc.model.player,c=a.require,
e=c.length,f=0;e--;){d.removeItem(c[e].id,c[e].amount);f=f+(c[e].amount||1)}sc.stats.addMap("trade","lost",f);c=a.get;e=c.length;for(f=0;e--;){d.addItem(c[e].id,c[e].amount,true);f=f+(c[e].amount||1)}d.removeCredit(b,true);sc.stats.addMap("trade","moneyLost",b);sc.stats.addMap("trade","got",f);this.sessionTradeCount++;sc.Model.notifyObserver(this,sc.TRADE_MODEL_EVENT.TRADED)},setEquippedID:function(b,a){var d=sc.model.player.equip;switch(a){case sc.ITEMS_EQUIP_TYPES.HEAD:this._checkBodyPart(this.equippedID1,
b,d.head,sc.MENU_EQUIP_BODYPART.HEAD);break;case sc.ITEMS_EQUIP_TYPES.ARM:this._checkBodyPart(this.equippedID1,b,d.leftArm,sc.MENU_EQUIP_BODYPART.LEFT_ARM);this._checkBodyPart(this.equippedID2,b,d.rightArm,sc.MENU_EQUIP_BODYPART.RIGHT_ARM);break;case sc.ITEMS_EQUIP_TYPES.TORSO:this._checkBodyPart(this.equippedID1,b,d.torso,sc.MENU_EQUIP_BODYPART.TORSO);break;case sc.ITEMS_EQUIP_TYPES.FEET:this._checkBodyPart(this.equippedID1,b,d.feet,sc.MENU_EQUIP_BODYPART.FEET)}},clearEquippedState:function(){this.equippedID1.id=
-1;this.equippedID2.id=-1;this.hasEquippedTrade=false},unequipTradeItems:function(){var b=sc.model.player;if(this.equippedID1.id>=0)if(this.equippedID1.id==this.equippedID2.id&&this.equippedID1.bodypart==this.equippedID2.bodypart){b.setEquipment(this.equippedID1.bodypart,-1);b.setEquipment(this.equippedID2.bodypart,-1);this.equippedID1.id=-1;this.equippedID2.id=-2}else{b.setEquipment(this.equippedID1.bodypart,-1);this.equippedID1.id=-1}if(this.equippedID2.id>=0){b.setEquipment(this.equippedID2.bodypart,
-1);this.equippedID2.id=-1}this.hasEquippedTrade=false},setActiveOffer:function(b){if(b<0||b>=this.options.length)throw Error("No such active offer at index: "+b);this.tradeIndex=b;sc.Model.notifyObserver(this,sc.TRADE_MODEL_EVENT.OFFER_CHANGED)},getCurrentOffer:function(){return this.options[this.tradeIndex]},canTrade:function(){for(var b=this.options[this.tradeIndex],a=sc.model.player,d=b.require,c=d.length;c--;)if(a.getItemAmountWithEquip(d[c].id)<d[c].amount)return false;for(var d=b.get,c=d.length,
e=false,f=0;c--;){a.getItemAmountWithEquip(d[c].id)<99&&(e=true);b.cost==void 0&&(f=f+sc.inventory.getItem(d[c].id).cost*(d[c].amount||1))}f=b.cost!=void 0?b.cost:Math.floor((f||1)*(b.scale||1));a.credit-f<0&&(e=false);return e},setInfoText:function(b,a){this.infoText=b;sc.Model.notifyObserver(this,sc.TRADE_MODEL_EVENT.INFO_TEXT_CHANGED,a)},setBuffText:function(b,a,d){this.buffText=b;this.buffID=d||-1;sc.Model.notifyObserver(this,sc.TRADE_MODEL_EVENT.BUFF_TEXT_CHANGED,a)},setEquipID:function(b,a){this.equipID=
b;this.compareMode=sc.TRADE_COMPARE_MODE.EQUIP;sc.Model.notifyObserver(this,sc.TRADE_MODEL_EVENT.EQUIP_ID_CHANGED,a)},toggleCompareMode:function(){if(!(this.equipID<=-1)){this.statsToggle=!this.statsToggle;this.compareMode=sc.inventory.getItem(this.equipID).equipType==sc.ITEMS_EQUIP_TYPES.ARM?(this.compareMode+1)%3:this.compareMode==sc.TRADE_COMPARE_MODE.EQUIP?sc.TRADE_COMPARE_MODE.BASE_STATS:sc.TRADE_COMPARE_MODE.EQUIP;sc.Model.notifyObserver(this,sc.TRADE_MODEL_EVENT.COMPARE_MODE_CHANGED)}},_checkBodyPart:function(b,
a,d,c){if(a==d){b.id=a;b.bodypart=c}}});sc.TradeInfo=ig.Class.extend({key:"",settings:null,iconGui:null,event:null,entity:null,init:function(b,a){this.key=b.trader;this.settings=sc.trade.getTrader(this.key)||{};this.entity=a;if(!window.wm)this.iconGui=new sc.TradeIconGui(this.key);var d=b.event;d||(d=[{type:"START_NPC_TRADE_MENU"}]);this.event=new ig.Event({name:"NPC EVENT",steps:d})},startTradeMenu:function(){sc.model.enterOnMapMenu();sc.model.stopSkip();sc.trade.unlockTrader(this.key,this.entity.characterName);
var b=new sc.TradeMenu(this.settings);ig.gui.addGuiElement(b);b.enterTrade()},clearCached:function(){this.event.clearCached();this.iconGui=null}});sc.TRADE_MODEL_EVENT={};sc.TRADE_MODEL_EVENT.OFFER_CHANGED=0;sc.TRADE_MODEL_EVENT.INFO_TEXT_CHANGED=1;sc.TRADE_MODEL_EVENT.BUFF_TEXT_CHANGED=2;sc.TRADE_MODEL_EVENT.EQUIP_ID_CHANGED=3;sc.TRADE_MODEL_EVENT.COMPARE_MODE_CHANGED=4;sc.TRADE_MODEL_EVENT.TRADED=5;ig.addGameAddon(function(){return sc.trade=new sc.TradeModel})});ig.baked=!0;
ig.module("game.feature.trade.gui.equip-toggle-stats").requires("impact.base.image","impact.feature.gui.gui","impact.feature.gui.base.basic-gui","game.feature.menu.gui.menu-misc","game.feature.trade.trade-model").defines(function(){sc.TradeToggleStats=ig.BoxGui.extend({transitions:{DEFAULT:{state:{},time:0.2,timeFunction:KEY_SPLINES.EASE},HIDDEN:{state:{alpha:0,offsetX:-10},time:0.2,timeFunction:KEY_SPLINES.LINEAR}},ninepatch:new ig.NinePatch("media/gui/menu.png",{width:8,height:8,left:8,top:8,right:8,
bottom:8,offsets:{"default":{x:456,y:280},changes:{x:480,y:280}}}),baseParams:{hp:null,atk:null,def:null,foc:null,fire:null,cold:null,shock:null,wave:null},modifierPool:{},compareText:null,compareItem:null,compareHelpText:null,titleOffset:8,lineOffset:4,level:0,isScalable:false,init:function(b,a){this.parent(176,266);this.setPos(21,27);this.hook.localAlpha=0.9;this.titleOffset=b==void 0?8:b;this.lineOffset=a==void 0?4:a;this._createContent();this.doStateTransition("HIDDEN",true)},updateDrawables:function(b){this.parent(b);
b.addColor("#7E7E7E",2,12,this.hook.size.x-4,1);b.addColor("#7E7E7E",2,38,this.hook.size.x-4,1);b.addColor("#7E7E7E",2,162,this.hook.size.x-4,1)},showMenu:function(){sc.Model.removeObserver(sc.trade,this);sc.Model.addObserver(sc.trade,this)},hideMenu:function(){sc.Model.removeObserver(sc.trade,this);this.doStateTransition("HIDDEN")},_setEquipID:function(b){if(sc.trade.equipID<0){this.hasTransition()&&this.hook.currentStateName=="DEFAULT"&&(b=0);this.doStateTransition("HIDDEN",false,false,null,b||
0)}else{this._setParameters(sc.trade.equipID);this.doStateTransition("DEFAULT")}},_getBodyPartIcon:function(b){switch(b){case "HEAD":return"item-helm";case "ARM":return"item-sword";case "TORSO":return"item-belt";case "FEET":return"item-shoe"}},_setParameters:function(b){this._resetParameters();var a=null,d=sc.inventory.getItem(b),b=null;this.level=0;this.isScalable=false;this.compareItem.setPos(this.titleOffset-2+this.compareHelpText.hook.size.x,13);var c=ig.lang.get("sc.gui.trade.compare")+" ";if(sc.trade.compareMode==
sc.TRADE_COMPARE_MODE.BASE_STATS){a=-1;c=c+ig.lang.get("sc.gui.trade.compareBASE");this.compareItem.setText("-----------------");this.level=0}else{switch(d.equipType){case sc.ITEMS_EQUIP_TYPES.HEAD:a=sc.model.player.equip.head;c=c+ig.lang.get("sc.gui.trade.compareHEAD");break;case sc.ITEMS_EQUIP_TYPES.ARM:if(sc.trade.compareMode==sc.TRADE_COMPARE_MODE.OFF_HAND){a=sc.model.player.equip.leftArm;c=c+ig.lang.get("sc.gui.trade.compareARMLeft")}else{a=sc.model.player.equip.rightArm;c=c+ig.lang.get("sc.gui.trade.compareARMRight")}break;
case sc.ITEMS_EQUIP_TYPES.TORSO:a=sc.model.player.equip.torso;c=c+ig.lang.get("sc.gui.trade.compareTORSO");break;case sc.ITEMS_EQUIP_TYPES.FEET:a=sc.model.player.equip.feet;c=c+ig.lang.get("sc.gui.trade.compareFEET")}if(a>=0){b=sc.inventory.getItem(a);if(b.type==sc.ITEMS_TYPES.EQUIP){this.level=b.level||1;this.isScalable=b.isScalable||false}var e;e=""+("\\i["+(b.icon+sc.inventory.getRaritySuffix(b.rarity||0)||"item-default")+"]");e=e+ig.LangLabel.getText(b.name);this.compareItem.setText(e)}else{this.compareItem.setText("\\i["+
this._getBodyPartIcon(d.equipType)+"]-----------------");this.level=0}}this.compareText.setText(c);this.level>0?this.compareItem.setDrawCallback(function(a,b){sc.MenuHelper.drawLevel(this.level,a,b,this.ninepatch.gfx,this.isScalable)}.bind(this)):this.compareItem.setDrawCallback(null);c=d.params;e=this._calculateDifference(a,"hp",c.hp||0);this.baseParams.hp.setChangeValue(e);e=this._calculateDifference(a,"attack",c.attack||0);this.baseParams.atk.setChangeValue(e);e=this._calculateDifference(a,"defense",
c.defense||0);this.baseParams.def.setChangeValue(e);e=this._calculateDifference(a,"focus",c.focus||0);this.baseParams.foc.setChangeValue(e);e=this._calculateDifference(a,"elemFactor",c.elemFactor?c.elemFactor[0]:1,0);this.baseParams.fire.setChangeValue(e);e=this._calculateDifference(a,"elemFactor",c.elemFactor?c.elemFactor[1]:1,1);this.baseParams.cold.setChangeValue(e);e=this._calculateDifference(a,"elemFactor",c.elemFactor?c.elemFactor[2]:1,2);this.baseParams.shock.setChangeValue(e);e=this._calculateDifference(a,
"elemFactor",c.elemFactor?c.elemFactor[3]:1,3);this.baseParams.wave.setChangeValue(e);if(d=d.properties){var b=b?b.properties||{}:{},c=166,f;for(f in this.modifierPool)if(d[f]!=void 0){this.modifierPool[f].doStateTransition("DEFAULT",true);if(b[f]){this.modifierPool[f].setChangeValue(this._calculateDifferenceModifier(a,f,d[f]));this.modifierPool[f].setCurrentValue(b[f],true)}else this.modifierPool[f].setChangeValue(Math.round((d[f]||0)*100-100)/100);this.modifierPool[f].setPos(this.lineOffset,c);
c=c+16}else if(b[f]!=void 0){this.modifierPool[f].doStateTransition("DEFAULT",true);this.modifierPool[f].setChangeValue(this._calculateDifferenceModifier(a,f,1));this.modifierPool[f].setCurrentValue(b[f],true);this.modifierPool[f].setPos(this.lineOffset,c);c=c+16}else this.modifierPool[f].doStateTransition("HIDDEN",true)}},_setBaseStats:function(){var b=null,b=sc.trade.compareMode==sc.TRADE_COMPARE_MODE.BASE_STATS?sc.model.player.baseParams:sc.model.player.equipParams;this.baseParams.hp.setCurrentValue(b.hp);
this.baseParams.atk.setCurrentValue(b.attack);this.baseParams.def.setCurrentValue(b.defense);this.baseParams.foc.setCurrentValue(b.focus);this.baseParams.fire.setCurrentValue(b.elemFactor[0]);this.baseParams.cold.setCurrentValue(b.elemFactor[1]);this.baseParams.shock.setCurrentValue(b.elemFactor[2]);this.baseParams.wave.setCurrentValue(b.elemFactor[3])},_resetParameters:function(){for(var b in this.baseParams)this.baseParams[b].setChangeValue(0);this._setBaseStats();for(var a in this.modifierPool){this.modifierPool[a].setChangeValue(0);
this.modifierPool[a].doStateTransition("HIDDEN",true)}},_setCompareParameters:function(b){this._resetChangeValue();b<0||sc.inventory.getItem(b)},_calculateDifference:function(b,a,d,c){if(b<0){c!=void 0&&(d=(Math.round(d*100)-100)/100);return d}if((b=sc.inventory.getItem(b))&&b.params&&b.params[a]){var e=0;if(c!=void 0){e=b.params[a][c]||0;d=(Math.round(d*100)-Math.floor(e*100))/100}else{e=b.params[a]||0;d=d-e}}else c!=void 0&&(d=(Math.round(d*100)-100)/100);return d},_calculateDifferenceModifier:function(b,
a,d,c){if(b<0)return d=(Math.round(d*100)-100)/100;if(c){a=b[a]||1;return d=(Math.round(a*100)-Math.round(d*100))/100}b=sc.inventory.getItem(b).properties;a=b[a]!=void 0?b[a]:1;return d=(Math.round(d*100)-Math.round(a*100))/100},_createContent:function(){var b=this.lineOffset,a=5;this.compareText=new sc.TextGui(ig.lang.get("sc.gui.trade.compare"),{font:sc.fontsystem.tinyFont});this.compareText.setPos(this.titleOffset,a);this.addChildGui(this.compareText);this.compareHelpText=new sc.TextGui("\\i[help4]");
this.compareHelpText.setPos(this.titleOffset-2,a+8);this.addChildGui(this.compareHelpText);this.compareItem=new sc.TextGui("");this.compareItem.setPos(this.titleOffset-2+this.compareHelpText.hook.size.x,a+8);this.addChildGui(this.compareItem);var a=a+26,d=new sc.TextGui(ig.lang.get("sc.gui.trade.stats"),{font:sc.fontsystem.tinyFont});d.setPos(this.titleOffset,a);this.addChildGui(d);a=41;d=sc.model.player.equipParams;this.baseParams.hp=this._createStatusDisplay(b,a,"maxhp",0,0,false,9999,d.hp);a=a+
14;this.baseParams.atk=this._createStatusDisplay(b,a,"atk",0,1,false,999,d.attack);a=a+14;this.baseParams.def=this._createStatusDisplay(b,a,"def",0,2,false,999,d.defense);a=a+14;this.baseParams.foc=this._createStatusDisplay(b,a,"foc",0,3,false,999,d.focus);a=a+16;this.baseParams.fire=this._createStatusDisplay(b,a,"res",1,4,true,999,d.elemFactor[0],0);a=a+14;this.baseParams.cold=this._createStatusDisplay(b,a,"res",2,5,true,999,d.elemFactor[1],1);a=a+14;this.baseParams.shock=this._createStatusDisplay(b,
a,"res",3,6,true,999,d.elemFactor[2],2);a=a+14;this.baseParams.wave=this._createStatusDisplay(b,a,"res",4,7,true,999,d.elemFactor[3],3);a=a+14;d=new sc.TextGui(ig.lang.get("sc.gui.trade.modifier"),{font:sc.fontsystem.tinyFont});d.setPos(this.titleOffset,a);this.addChildGui(d);for(var c in sc.MODIFIERS){b=sc.MODIFIERS[c];b=this._createStatusDisplay(this.lineOffset,0,"modifier."+c,5,b.icon,true,sc.MAX_MOD_VAL,1,void 0,b.noPercent||false,c,b.order);b.doStateTransition("HIDDEN",true);this.modifierPool[c]=
b}},_createStatusDisplay:function(b,a,d,c,e,f,g,h,i,j,k,l){f=new sc.SimpleStatusDisplay(ig.lang.get("sc.gui.menu.equip."+d),c,e,f,g,null,0,j);f.setPos(b,a);f.setCurrentValue(h,true);if(d=="res"){c==1&&(d="heat");c==2&&(d="cold");c==3&&(d="shock");c==4&&(d="wave")}k||(k=d);f.annotation={type:"INFO",content:{title:"sc.gui.menu.equip."+d,description:"sc.gui.menu.equip.descriptions."+k},offset:{x:-1,y:-1},index:{x:0,y:l+8||e}};this.addChildGui(f);return f},modelChanged:function(b,a,d){b==sc.trade&&(a==
sc.TRADE_MODEL_EVENT.EQUIP_ID_CHANGED?this._setEquipID(d?0.5:0):a==sc.TRADE_MODEL_EVENT.COMPARE_MODE_CHANGED&&this._setEquipID(0))}})});ig.baked=!0;
ig.module("game.feature.menu.gui.shop.shop-stats").requires("impact.base.image","impact.feature.gui.gui","impact.feature.gui.base.basic-gui","game.feature.trade.gui.equip-toggle-stats").defines(function(){sc.ShopEquipStats=sc.TradeToggleStats.extend({transitions:{DEFAULT:{state:{},time:0.2,timeFunction:KEY_SPLINES.LINEAR},HIDDEN:{state:{alpha:0,offsetX:-181},time:0.2,timeFunction:KEY_SPLINES.LINEAR}},ninepatch:new ig.NinePatch("media/gui/menu.png",{width:5,height:5,left:5,top:5,right:5,bottom:5,offsets:{"default":{x:116,
y:425}}}),init:function(){this.parent(4,0);this.setPos(5,29);this.hook.size.x=169;this.hook.size.y=this.hook.size.y-1;this.hook.localAlpha=1;this.compareText.setText(ig.lang.get("sc.gui.trade.nothing"));this.compareItem.setText(ig.lang.get("sc.gui.shop.noEquip"));this.doStateTransition("HIDDEN",true)},updateDrawables:function(b){this.parent(b);b.addColor("#7E7E7E",0,12,this.hook.size.x,1);b.addColor("#7E7E7E",0,38,this.hook.size.x,1);b.addColor("#7E7E7E",0,162,this.hook.size.x,1)},updateStatsView:function(){this._setParameters(sc.trade.equipID)},
reset:function(){this.compareText.setText(ig.lang.get("sc.gui.trade.nothing"));this.compareItem.setText(ig.lang.get("sc.gui.shop.noEquip"));this.compareItem.setDrawCallback(null);this._resetParameters()},show:function(){this.doStateTransition("DEFAULT")},hide:function(){this.doStateTransition("HIDDEN")}})});ig.baked=!0;
ig.module("game.feature.menu.gui.shop.shop-cart").requires("impact.base.image","impact.feature.gui.gui","impact.feature.gui.base.basic-gui","impact.feature.gui.base.box").defines(function(){sc.ShopCart=ig.BoxGui.extend({transitions:{DEFAULT:{state:{},time:0.2,timeFunction:KEY_SPLINES.LINEAR},HIDDEN:{state:{alpha:0,scaleX:0},time:0.2,timeFunction:KEY_SPLINES.LINEAR}},ninepatch:new ig.NinePatch("media/gui/menu.png",{width:16,height:9,left:4,top:4,right:4,bottom:4,offsets:{"default":{x:512,y:457}}}),
credits:null,value:null,rest:null,checkout:null,enabled:true,init:function(){this.parent(125,88);this.setAlign(ig.GUI_ALIGN.X_LEFT,ig.GUI_ALIGN.Y_BOTTOM);this.setPos(180,26);var b=5,a=new sc.TextGui(ig.lang.get("sc.gui.shop.cart"),{font:sc.fontsystem.tinyFont});a.setPos(4,b);this.addChildGui(a);b=b+13;this.credits=new sc.ShopCartEntry(ig.lang.get("sc.gui.shop."+(sc.menu.shopCoinMode?"coins":"credits"))+":");this.credits.setPos(0,b);this.addChildGui(this.credits);b=b+13;this.value=new sc.ShopCartEntry(ig.lang.get("sc.gui.shop.cost")+
":");this.value.setPos(0,b);this.value.number.noZero=true;this.value.hideSymbol=true;this.value.number.signed=true;this.value.number.setColor(sc.GUI_NUMBER_COLOR.RED);this.addChildGui(this.value);b=b+16;this.rest=new sc.ShopCartEntry(ig.lang.get("sc.gui.shop.rest")+":");this.rest.setPos(0,b);this.addChildGui(this.rest);this.checkout=new sc.ButtonGui("\\i[help2]"+ig.lang.get("sc.gui.shop.checkout"));this.checkout.onButtonPress=this.onCheckoutPress.bind(this);this.checkout.setAlign(ig.GUI_ALIGN.X_RIGHT,
ig.GUI_ALIGN.Y_BOTTOM);this.checkout.setPos(3,3);this.addChildGui(this.checkout);this.doStateTransition("HIDDEN",true)},resetNumbers:function(b){var a=sc.menu.shopCoinMode?sc.arena.getTotalArenaCoins():sc.model.player.credit;this.credits.setNumber(a,b);this.value.setNumber(0,b);this.rest.setNumber(a,b);a<0?this.rest.number.setColor(sc.GUI_NUMBER_COLOR.RED):this.rest.number.setColor(sc.GUI_NUMBER_COLOR.WHITE);this.checkout.setActive(false)},updateValue:function(b){var a=b||0;if(b==void 0){for(var b=
sc.menu.shopCart,d=b.length;d--;)a=a+b[d].price*b[d].amount;this.value.setNumber(-a)}b=0;if(sc.menu.shopSellMode){this.value.number.setColor(sc.GUI_NUMBER_COLOR.GREEN);b=sc.model.player.credit+a;this.value.setNumber(a)}else{b=sc.menu.shopCoinMode?sc.arena.getTotalArenaCoins()-a:sc.model.player.credit-a;this.value.number.setColor(sc.GUI_NUMBER_COLOR.RED);this.value.setNumber(-a)}this.rest.setNumber(b);this.value.number.showPlus=sc.menu.shopSellMode&&a;if(b<0){this.rest.number.setColor(sc.GUI_NUMBER_COLOR.RED);
this.checkout.setActive(false)}else{sc.menu.shopCart.length==0?this.checkout.setActive(false):this.enabled&&this.checkout.setActive(true);this.rest.number.setColor(sc.GUI_NUMBER_COLOR.WHITE)}},updateDrawables:function(b){this.parent(b);b.addColor("#7E7E7E",0,12,this.hook.size.x,1);b.addColor("#FFF",3,42,this.hook.size.x-6,1)},show:function(){this.resetNumbers(true);if(sc.menu.shopSellMode){this.value.text.setText(ig.lang.get("sc.gui.shop.profit")+":");this.rest.text.setText(ig.lang.get("sc.gui.shop.total")+
":")}else{this.value.text.setText(ig.lang.get("sc.gui.shop.cost")+":");this.rest.text.setText(ig.lang.get("sc.gui.shop.rest")+":")}sc.menu.buttonInteract.addGlobalButton(this.checkout,this.onCheckoutCheck.bind(this),true);this.doStateTransition("DEFAULT")},hide:function(){sc.menu.buttonInteract.removeGlobalButton(this.checkout);this.doStateTransition("HIDDEN")},setCheckout:function(b){(this.enabled=b)?sc.menu.shopCart.length>=1&&this.checkout.setActive(true):this.checkout.setActive(false)},onCheckoutPress:function(){sc.menu.openCheckout()},
onCheckoutCheck:function(){return sc.control.menuHotkeyHelp2()}});sc.ShopCartEntry=ig.GuiElementBase.extend({gfx:new ig.Image("media/gui/menu.png"),text:null,number:null,hideSymbol:false,init:function(b){this.parent();this.setAlign(ig.GUI_ALIGN.X_RIGHT,ig.GUI_ALIGN.Y_TOP);this.setSize(120,8);this.text=new sc.TextGui(b,{font:sc.fontsystem.tinyFont});this.text.setPos(0,0);this.addChildGui(this.text);this.number=new sc.NumberGui(9999999,{transitionTime:0.1});this.number.setPos(41,0);this.addChildGui(this.number)},
updateDrawables:function(b){this.hideSymbol||(sc.menu.shopCoinMode?b.addGfx(this.gfx,this.hook.size.x-15,-1,500,224,12,12):b.addGfx(this.gfx,this.hook.size.x-13,0,490,224,10,8))},setNumber:function(b,a){this.number.setNumber(b,a)}})});ig.baked=!0;
ig.module("game.feature.menu.gui.shop.shop-quantity").requires("impact.base.image","impact.feature.gui.gui","impact.feature.gui.base.basic-gui","impact.feature.gui.base.box","impact.feature.interact.gui.focus-gui").defines(function(){var b={x:584,y:352,number:1,insetY:2,numberOffX:-2},a={x:584,y:352,number:-1,insetY:-2,numberOffX:-2,numberOffY:1,flipY:true},d={x:621,y:352,number:10,insetX:-2,numberOffX:3},c={x:621,y:352,number:-10,insetX:2,numberOffX:-3,flipX:true};sc.ShopQuantitySelect=ig.BoxGui.extend({transitions:{DEFAULT:{state:{},
time:0.2,timeFunction:KEY_SPLINES.EASE},HIDDEN:{state:{alpha:0,scaleX:0.2,scaleY:0},time:0.2,timeFunction:KEY_SPLINES.LINEAR}},ninepatch:new ig.NinePatch("media/gui/menu.png",{width:6,height:6,left:9,top:9,right:9,bottom:9,offsets:{"default":{x:480,y:304}}}),buttongroup:null,quantityText:null,costText:null,buttonUp:null,buttonDown:null,buttonLeft:null,buttonRight:null,quantity:null,cost:null,submit:null,quantityLine:null,itemCostLine:null,active:false,submitCallback:null,cancelCallback:null,_number:0,
_max:99,_button:null,_amp:0,_ampTimer:0,_ampDir:null,repeater:null,init:function(e,g){this.parent();this.setSize(247,83);this.setPivot(0,0);this.hook.zIndex=1500;this.hook.pauseGui=true;this.hook.screenBlocking=true;this.submitCallback=e||null;this.cancelCallback=g||null;this.buttongroup=new sc.ButtonGroup;this.buttongroup.isNonMouseMenuInput=function(){return sc.control.menuConfirm()}.bind(this);this.quantityText=new sc.TextGui(ig.lang.get("sc.gui.shop.quantity"),{font:sc.fontsystem.tinyFont});this.quantityText.setPos(10,
11);this.addChildGui(this.quantityText);this.costText=new sc.TextGui(ig.lang.get("sc.gui.shop.cost"),{font:sc.fontsystem.tinyFont});this.costText.setPos(147,11);this.addChildGui(this.costText);this.cost=new sc.NumberGui(9999999,{transitionTime:0.1,signed:true});this.cost.setPos(174,10);this.addChildGui(this.cost);this.quantityLine=new sc.ShopSlopLine(91,false);this.quantityLine.setPos(9,18);this.quantityLine.show(true);this.addChildGui(this.quantityLine);this.itemCostLine=new sc.ShopSlopLine(91,true);
this.itemCostLine.setPos(142,18);this.itemCostLine.show(true);this.addChildGui(this.itemCostLine);this.quantity=new sc.NumberGui(99,{transitionTime:0.1,leadingZeros:2});this.quantity.setPos(116,38);this.addChildGui(this.quantity);this.buttonUp=this.addDirectionButton(b,106,4);this.buttonDown=this.addDirectionButton(a,106,44);this.buttonRight=this.addDirectionButton(d,126,24);this.buttonLeft=this.addDirectionButton(c,86,24);this.submit=new sc.ButtonGui(ig.lang.get("sc.gui.shop.submit"),84);this.submit.setAlign(ig.GUI_ALIGN.X_RIGHT,
ig.GUI_ALIGN.Y_BOTTOM);this.submit.setPos(4,4);this.addChildGui(this.submit);this.buttongroup.addFocusGui(this.submit,0,0);this.buttongroup.addPressCallback(function(){this.hide();this._button.setCountNumber(this._number);this.submitCallback&&this.submitCallback(this._button,this._number)}.bind(this));this.repeater=new ig.PressRepeater(0.3,0.1);this.doStateTransition("HIDDEN",true)},update:function(){if(this.buttongroup.isActive()&&!ig.interact.isBlocked()){if(this._ampTimer>0){this._ampTimer=this._ampTimer-
ig.system.actualTick;if(this._ampTimer<=0)this._amp=this._ampTimer=0}switch(this.getRepeaterValue()){case "up":this.buttonUp.onButtonPress(true);break;case "down":this.buttonDown.onButtonPress(true);break;case "right":this.buttonRight.onButtonPress(true);break;case "left":this.buttonLeft.onButtonPress(true)}}},getRepeaterValue:function(){sc.control.upDown()?this.repeater.setDown("up"):sc.control.downDown()?this.repeater.setDown("down"):sc.control.rightDown()?this.repeater.setDown("right"):sc.control.leftDown()&&
this.repeater.setDown("left");return this.repeater.getPressed()},addDirectionButton:function(a,b,c){var d=new sc.ShopQuanityButton(a);d.keepMouseFocus=true;d.setPos(b,c);d.onButtonPress=function(){var b=this._number;this._number=(this._number+a.number).limit(0,this._max);if(b!=this._number){this.quantity.setNumber(this._number);this.updateCost();this.playSound(a,true);d.focus||d.highlight()}else sc.BUTTON_SOUND.denied.play();sc.menu.updateTotalCost(this._button.data.id,this._number,this._button.price);
this.updateDirectionButtons(this._number)}.bind(this);this.addChildGui(d);return d},updateCost:function(){var a=this._number*this._button.price;this.cost.setNumber(sc.menu.shopSellMode?a:-a);this.cost.showPlus=sc.menu.shopSellMode&&a;a?this.cost.setColor(sc.menu.shopSellMode?sc.GUI_NUMBER_COLOR.GREEN:sc.GUI_NUMBER_COLOR.RED):this.cost.setColor(sc.GUI_NUMBER_COLOR.WHITE)},updateDirectionButtons:function(a){this.buttonUp.setColor(sc.GUI_NUMBER_COLOR.WHITE);this.buttonDown.setColor(sc.GUI_NUMBER_COLOR.WHITE);
this.buttonRight.setColor(sc.GUI_NUMBER_COLOR.WHITE);this.buttonLeft.setColor(sc.GUI_NUMBER_COLOR.WHITE);if(a==this._max){this.buttonUp.setColor(sc.GUI_NUMBER_COLOR.GREY);this.buttonRight.setColor(sc.GUI_NUMBER_COLOR.GREY)}if(a<=0){this.buttonDown.setColor(sc.GUI_NUMBER_COLOR.GREY);this.buttonLeft.setColor(sc.GUI_NUMBER_COLOR.GREY)}},playSound:function(a,c){this._ampTimer=0.3;if(this._ampDir!=a)this._amp=0;this._ampDir=a;this._amp=Math.min(0.2,this._amp+0.04);a==b||a==d?sc.BUTTON_SOUND.shop_up.play(null,
{speed:1+(c?this._amp:0)}):sc.BUTTON_SOUND.shop_down.play(null,{speed:1-(c?this._amp:0)})},show:function(a,b,c){if(!this.active){this.setPos(b,c);sc.menu.pushBackCallback(this.onBackButtonPress.bind(this));sc.menu.buttonInteract.pushButtonGroup(this.buttongroup);sc.menu.buttonInteract.addGlobalButton(this.buttonUp,this.onUpCheck.bind(this),true);sc.menu.buttonInteract.addGlobalButton(this.buttonDown,this.onDownCheck.bind(this),true);sc.menu.buttonInteract.addGlobalButton(this.buttonRight,this.onRightCheck.bind(this),
true);sc.menu.buttonInteract.addGlobalButton(this.buttonLeft,this.onLeftCheck.bind(this),true);sc.menu.shopSellMode?this.costText.setText(ig.lang.get("sc.gui.shop.profit")):this.costText.setText(ig.lang.get("sc.gui.shop.cost"));this.buttonUp.show();this.buttonDown.show();this.buttonRight.show();this.buttonLeft.show();this._amp=0;this._button=a;var b=this._button.price,c=sc.menu.getItemQuantity(this._button.data.id,b),d=c*b,e=ig.database.get("shops")[sc.menu.shopID].maxOwn||99;if(sc.menu.shopSellMode)this._max=
sc.model.player.getItemAmount(a.data.id);else{var k=sc.menu.shopCoinMode?sc.arena.getTotalArenaCoins():sc.model.player.credit;this._max=Math.min(e||99,(e||99)-sc.model.player.getItemAmount(a.data.id));this._max=Math.min(this._max,Math.floor(Math.max(0,k-sc.menu.getTotalCost()+d)/b))}this._number=c||1;this._button.setCountNumber(c,true);this.updateDirectionButtons(this._number);this.quantity.setNumber(this._number,true);this.updateCost();sc.menu.updateTotalCost(this._button.data.id,this._number,this._button.price);
ig.interact.setBlockDelay(0.1);this.getRepeaterValue();this.active=true;this.doStateTransition("DEFAULT")}},hide:function(){if(this.active){sc.menu.popBackCallback();sc.menu.buttonInteract.removeButtonGroup(this.buttongroup);sc.menu.buttonInteract.removeGlobalButton(this.buttonUp);sc.menu.buttonInteract.removeGlobalButton(this.buttonDown);sc.menu.buttonInteract.removeGlobalButton(this.buttonRight);sc.menu.buttonInteract.removeGlobalButton(this.buttonLeft);this.buttonUp.hide();this.buttonDown.hide();
this.buttonRight.hide();this.buttonLeft.hide();this.active=false;if(ig.input.mouseGuiActive){sc.menu.setInfoText("",true);sc.menu.setBuffText("",false);sc.menu.resetItemInfo()}this.doStateTransition("HIDDEN")}},onBackButtonPress:function(){this.hide();this._button.setCountNumber(sc.menu.getItemQuantity(this._button.data.id,this._button.price),true);sc.menu.updateTotalCost();this.cancelCallback&&this.cancelCallback(this._button)},onUpCheck:function(){return false},onDownCheck:function(){return false},
onRightCheck:function(){return false},onLeftCheck:function(){return false}});var e=Math.floor(17.5);sc.ShopQuanityButton=ig.FocusGui.extend({gfx:new ig.Image("media/gui/menu.png"),direction:b,highlightTimer:0,number:null,init:function(a){this.parent();this.setSize(35,35);this.direction=a||b;this.hook.transitions={DEFAULT:{state:{},time:0.2,timeFunction:KEY_SPLINES.LINEAR},HIDDEN:{state:{offsetX:this.direction.insetX||0,offsetY:this.direction.insetY||0},time:0.2,timeFunction:KEY_SPLINES.LINEAR}};this.number=
new sc.NumberGui(99,{size:sc.NUMBER_SIZE.SMALL,signed:true,showPlus:true});this.number.setAlign(ig.GUI_ALIGN.X_CENTER,ig.GUI_ALIGN.Y_CENTER);this.number.setNumber(a.number);this.number.setPos(a.numberOffX||0,a.numberOffY||0);this.addChildGui(this.number)},setColor:function(a){this.number.setColor(a)},highlight:function(){this.highlightTimer=0.4},show:function(){this.highlightTimer=0;this.doStateTransition("HIDDEN",true);this.doStateTransition("DEFAULT",false,false,null,0.1)},hide:function(){this.doStateTransition("HIDDEN")},
update:function(){if(this.highlightTimer>0){this.highlightTimer=this.highlightTimer-ig.system.actualTick;if(this.highlightTimer<=0)this.highlightTimer=0}},updateDrawables:function(a){a.addGfx(this.gfx,0,0,this.direction.x,this.direction.y+(this.focus?36:0),35,35,this.direction.flipX,this.direction.flipY);if(this.highlightTimer>0){var b=(this.highlightTimer/0.4).limit(0,1);a.addGfx(this.gfx,0,0,this.direction.x,this.direction.y+36,35,35,this.direction.flipX,this.direction.flipY).setAlpha(b)}},isMouseOver:function(){if(ig.interact.isBlocked())return false;
var a=Math.floor(this.hook.screenCoords.x),b=Math.floor(this.hook.screenCoords.y),c=Math.floor(sc.control.getMouseX()),d=Math.floor(sc.control.getMouseY());return Math.abs(c-(e+a))+Math.abs(d-(e+b))<=e}});sc.ShopSlopLine=ig.GuiElementBase.extend({slop:null,line:null,hasLine:false,init:function(a,b){this.parent();this.setSize(a+5,5);this.slope=new sc.SlopeLine(5,b,false,sc.SlopeLine_Color.DARK_GREY);this.addChildGui(this.slope);this.line=new ig.ColorGui("#7E7E7E",a,1);this.line.hook.transitions={DEFAULT:{state:{},
time:0.1,timeFunction:KEY_SPLINES.LINEAR},HIDDEN:{state:{scaleX:0},time:0.1,timeFunction:KEY_SPLINES.LINEAR}};this.addChildGui(this.line);if(b){this.slope.setPos(0,5);this.line.setPos(5,0);this.line.setPivot(0,0)}else{this.slope.setPos(a+5,5);this.line.setPos(0,0);this.line.setPivot(a,0)}this.slope.hide();this.line.doStateTransition("HIDDEN",true)},show:function(a){if(!this.hasLine)if(a){this.slope.show(0);this.line.doStateTransition("DEFAULT",true)}else{this.line.hook.currentStateName=="HIDDEN"&&
this.line.hasTransition();this.slope.hide();this.slope.show(0.1);this.line.doStateTransition("HIDDEN",true);this.line.doStateTransition("DEFAULT",false,false,null,0.1);this.hasLine=true}},hide:function(a){if(this.hasLine){this.slope.hide(a?0:0.1,a?0:0.1);this.line.doStateTransition("HIDDEN",a);this.hasLine=false}}})});ig.baked=!0;
ig.module("game.feature.menu.gui.shop.shop-confirm").requires("impact.base.image","impact.feature.gui.gui","impact.feature.gui.base.basic-gui","impact.feature.gui.base.box","impact.feature.gui.base.basic-gui","game.feature.menu.gui.menu-misc","game.feature.gui.widget.modal-dialog","game.feature.menu.gui.shop.shop-misc").defines(function(){sc.ShopConfirmDialog=sc.ModalButtonInteract.extend({confirmCallback:null,cancelCallback:null,list:null,listContent:null,notifyRaritySell:false,keepOpen:true,init:function(b,
a){this.parent(ig.lang.get("sc.gui.shop.confirmBuy"),null,[ig.lang.get("sc.gui.shop.buy"),ig.lang.get("sc.gui.shop.cancel")],this.onDialogCallback.bind(this));this.msgBox.centerBox.hook.localAlpha=1;this.textGui.setAlign(ig.GUI_ALIGN.X_CENTER,ig.GUI_ALIGN.Y_TOP);this.confirmCallback=b||null;this.cancelCallback=a||null;var d=this.content.hook.size.y,c=this.textGui.hook.size.y+1;this.listContent=new ig.GuiElementBase;this.list=new sc.ScrollPane(sc.ScrollType.Y_ONLY);this.list.setContent(this.listContent);
this.list.setSize(250,121);this.list.setPos(0,c);this.content.addChildGui(this.list);this.content.setSize(250,121+d);this.msgBox.setPos(0,-12);this.msgBox.resize();this.buttons[0].submitSound=sc.BUTTON_SOUND.shop_cash},update:function(){this.parent();this.buttonInteract.isActive()&&this.buttongroup.isActive()&&(sc.control.menuScrollUp()?this.list.scrollY(-17):sc.control.menuScrollDown()&&this.list.scrollY(17))},show:function(){if(sc.menu.shopSellMode){this.textGui.setText(ig.lang.get("sc.gui.shop.confirmSell"));
this.buttons[0].setText(ig.lang.get("sc.gui.shop.sell"),true)}else{this.textGui.setText(ig.lang.get("sc.gui.shop.confirmBuy"));this.buttons[0].setText(ig.lang.get("sc.gui.shop.buy"),true)}this.createList();this.parent()},createList:function(){this.listContent.removeAllChildren();this.list.box.doScrollTransition(0,0,0);this.list.recalculateScrollBars();var b=sc.menu.shopCart;sc.ShopHelper.sortList(b,sc.SORT_TYPE.ORDER);var a=sc.inventory,d=null,c=d=null,e=0;this.notifyRaritySell=false;for(var f=0;f<
b.length;f++){d=a.getItem(b[f].id);c="\\i["+(d.icon+sc.inventory.getRaritySuffix(d.rarity||0)||"item-default")+"]"+ig.LangLabel.getText(d.name);if(d.rarity>=sc.ITEMS_RARITY.LEGENDARY&&sc.menu.shopSellMode)this.notifyRaritySell=true;d=new sc.ShopConfirmEntry(c,b[f].amount,b[f].price);d.setPos(0,e);e=e+d.hook.size.y;this.listContent.addChildGui(d)}this.buttons[0].submitSound=this.notifyRaritySell?null:sc.BUTTON_SOUND.shop_cash;this.listContent.hook.size.y=e;this.list.recalculateScrollBars(true)},onDialogCallback:function(b){if(b.data==
0)if(this.notifyRaritySell){sc.BUTTON_SOUND.submit.play();sc.Dialogs.showYesNoDialog(ig.lang.get("sc.gui.dialogs.sellRare"),sc.DIALOG_INFO_ICON.WARNING,function(a){this.hide();if(a.data==0){sc.BUTTON_SOUND.shop_cash.play();this.confirmCallback&&this.confirmCallback()}else{sc.BUTTON_SOUND.submit.play();this.cancelCallback&&this.cancelCallback()}}.bind(this),true)}else{this.hide();this.confirmCallback&&this.confirmCallback()}else{this.hide();this.cancelCallback&&this.cancelCallback()}}});sc.ShopConfirmEntry=
ig.GuiElementBase.extend({gfx:new ig.Image("media/gui/menu.png"),item:null,amount:null,price:null,init:function(b,a,d){this.parent();this.setSize(246,17);this.item=new sc.TextGui(b);this.item.setPos(0,0);this.addChildGui(this.item);this.amount=new sc.NumberGui(99,{size:sc.NUMBER_SIZE.TEXT});this.amount.setPos(145,4);this.amount.setNumber(a,true);this.addChildGui(this.amount);this.price=new sc.NumberGui(9999999,{size:sc.NUMBER_SIZE.TEXT});this.price.setPos(174,4);this.price.setNumber(d*a,true);this.addChildGui(this.price)},
updateDrawables:function(b){this.parent(b);b.addGfx(this.gfx,132,6,560,416,8,8);b.addGfx(this.gfx,164,7,568,416,8,8);sc.menu.shopCoinMode?b.addGfx(this.gfx,232,4,500,224,12,12):b.addGfx(this.gfx,232,4,488,32,12,10)}})});ig.baked=!0;
ig.module("game.feature.menu.gui.shop.shop-menu").requires("impact.feature.gui.gui","impact.feature.gui.base.basic-gui","game.feature.menu.gui.base-menu","game.feature.menu.gui.menu-misc","game.feature.menu.gui.shop.shop-start","game.feature.menu.gui.shop.shop-list","game.feature.menu.gui.shop.shop-stats","game.feature.menu.gui.shop.shop-cart","game.feature.menu.gui.shop.shop-quantity","game.feature.menu.gui.shop.shop-confirm","game.feature.control.control").defines(function(){sc.ShopMenu=sc.BaseMenu.extend({hotkeyHelp:null,
hotkeySort:null,hotkeySwitch:null,shopName:null,start:null,shopList:null,pageView:null,stats:null,cart:null,quantity:null,confirmDialog:null,sortMenu:null,helpGui:null,init:function(){this.parent();this.hook.size.x=ig.system.width;this.hook.size.y=ig.system.height;this.hotkeyHelp=new sc.ButtonGui("\\i[help]"+ig.lang.get("sc.gui.menu.hotkeys.help"),void 0,true,sc.BUTTON_TYPE.SMALL);this.hotkeyHelp.keepMouseFocus=true;this.hotkeyHelp.hook.transitions={DEFAULT:{state:{},time:0.2,timeFunction:KEY_SPLINES.EASE},
HIDDEN:{state:{offsetY:-this.hotkeyHelp.hook.size.y},time:0.2,timeFunction:KEY_SPLINES.LINEAR}};this.hotkeyHelp.onButtonPress=this.onHelpButtonPressed.bind(this);this.hotkeySort=new sc.ButtonGui("\\i[help3]"+ig.lang.get("sc.gui.menu.item.sort-title"),void 0,true,sc.BUTTON_TYPE.SMALL);this.hotkeySort.keepMouseFocus=true;this.hotkeySort.hook.transitions={DEFAULT:{state:{},time:0.2,timeFunction:KEY_SPLINES.EASE},HIDDEN:{state:{offsetY:-this.hotkeySort.hook.size.y},time:0.2,timeFunction:KEY_SPLINES.LINEAR}};
this.hotkeySort.onButtonPress=this.onSortButtonPress.bind(this);this.hotkeySwitch=new sc.ButtonGui("",null,true,sc.BUTTON_TYPE.SMALL);this.hotkeySwitch.keepMouseFocus=true;this.hotkeySwitch.submitSound=null;this.hotkeySwitch.onButtonPress=function(){if(sc.trade.equipID>=0){sc.BUTTON_SOUND.submit.play();sc.trade.toggleCompareMode();this.stats.updateStatsView()}}.bind(this);this.shopName=new sc.ShopStartTitle;this.addChildGui(this.shopName);this.start=new sc.ShopStartMenu;this.addChildGui(this.start);
this.shopList=new sc.ShopListMenu;this.addChildGui(this.shopList);this.pageView=new sc.ShopPageCounter;this.addChildGui(this.pageView);this.stats=new sc.ShopEquipStats;this.addChildGui(this.stats);this.cart=new sc.ShopCart;this.addChildGui(this.cart);this.quantity=new sc.ShopQuantitySelect(this.onQuantitySubmit.bind(this),this.onQuantityBack.bind(this));this.confirmDialog=new sc.ShopConfirmDialog(this.onConfirm.bind(this));this.sortMenu=new sc.SortMenu(this.onExecuteSort.bind(this));this.sortMenu.addButton("auto",
sc.SORT_TYPE.ORDER,0);this.sortMenu.addButton("name",sc.SORT_TYPE.NAME,1);this.sortMenu.addButton("rarity",sc.SORT_TYPE.RARITY,2);this.doStateTransition("DEFAULT")},addObservers:function(){sc.Model.addObserver(sc.menu,this)},removeObservers:function(){sc.Model.removeObserver(sc.menu,this)},showMenu:function(){this.addObservers();sc.menu.pushBackCallback(this.onBackButtonPress.bind(this));sc.menu.moveLeaSprite(0,0,sc.MENU_LEA_STATE.HIDDEN);if(sc.menu.shopCoinMode){sc.arena._validateCoins();sc.menu.shopState=
sc.MENU_SHOP_STATE.BUY;this.resolveStateChange(null,true)}else{this.start.show();this.shopName.show()}this.updateSortMenuButton(ig.lang.get("sc.gui.menu.sort.auto"));ig.interact.setBlockDelay(0.2);this.onAddHotkeys()},hideMenu:function(){this.removeObservers();sc.menu.moveLeaSprite(0,0,sc.MENU_LEA_STATE.LARGE);this.exitMenu()},exitMenu:function(){sc.menu.buttonInteract.removeGlobalButton(this.hotkeyHelp);sc.menu.buttonInteract.removeGlobalButton(this.hotkeySort);sc.menu.buttonInteract.removeGlobalButton(this.hotkeySwitch);
this.helpGui=null;this.start.hide();this.shopName.hide();this.shopList.hide();this.stats.hide();this.cart.hide();sc.trade.compareMode=sc.TRADE_COMPARE_MODE.EQUIP;sc.party.updateEquipment();this.sortMenu.active&&this.sortMenu.hideSortMenu();this.quantity.active&&this.quantity.hide()},openQuantitySelect:function(b){this.hotkeySort.setActive(false);this.cart.setCheckout(false);ig.gui.addGuiElement(this.quantity);var a=b.hook.screenCoords,d=a.x,c=a.y+a.h-2,e=this.quantity.hook;if(c+e.size.y>ig.system.height-
28){c=a.y-e.size.y+1;this.quantity.setPivot(e.size.x/2,e.size.y)}else this.quantity.setPivot(e.size.x/2,0);b.keepButtonPressed();this.quantity.show(b,d,c)},updateSortMenuButton:function(b){var a="\\i[help3]"+ig.lang.get("sc.gui.menu.item.sort-title")+": ";this.hotkeySort.setText(a+("\\c[3]"+b+"\\c[0]"));sc.menu.updateHotkeys()},resolveStateChange:function(b,a){sc.menu.buttonInteract.removeGlobalButton(this.hotkeySort);sc.menu.buttonInteract.removeGlobalButton(this.hotkeySwitch);this.hotkeySort.doStateTransition("HIDDEN");
sc.menu.shopSellMode=false;switch(sc.menu.shopState){case sc.MENU_SHOP_STATE.START:this.pageView.hide();this.shopList.hide();this.cart.hide();this.stats.hide();this.start.show();this.shopName.show();break;case sc.MENU_SHOP_STATE.BUY:sc.menu.buttonInteract.addGlobalButton(this.hotkeySort,this.onHotkeySortCheck.bind(this),true);sc.menu.buttonInteract.addGlobalButton(this.hotkeySwitch,this.onHotkeySwitchCheck.bind(this),true);this.hotkeySort.doStateTransition("DEFAULT");this.start.hide(true,a);this.shopName.hide(true,
a);this.shopList.show();this.pageView.show();this.stats.show();this.cart.show();break;case sc.MENU_SHOP_STATE.SELL:sc.menu.shopSellMode=true;sc.menu.buttonInteract.addGlobalButton(this.hotkeySort,this.onHotkeySortCheck.bind(this),true);sc.menu.buttonInteract.addGlobalButton(this.hotkeySwitch,this.onHotkeySwitchCheck.bind(this),true);this.hotkeySort.doStateTransition("DEFAULT");this.start.hide(true);this.shopName.hide(true);this.shopList.show();this.pageView.show();this.stats.show();this.cart.show()}},
onConfirm:function(){var b=sc.menu.shopSellMode?this.sellItems():this.buyItems();sc.menu.shopCart.length=0;b?this.shopList.createBuyList(true,ig.input.mouseGuiActive,!ig.input.mouseGuiActive,this.shopList._prevSortType):this.shopList.updateListEntries(true);this.cart.resetNumbers()},buyItems:function(){var b=sc.menu.getTotalCost(),a=sc.model.player;sc.menu.shopCoinMode?sc.arena.removeArenaCoins(b):a.removeCredit(b,true);for(var b=sc.menu.shopCart,d=b.length;d--;){a.addItem(b[d].id,b[d].amount,true);
sc.stats.addMap("items","buy",b[d].amount)}return false},sellItems:function(){var b=sc.menu.getTotalCost(),a=sc.model.player;a.addCredit(b,true);for(var b=sc.menu.shopCart,d=b.length,c=false;d--;){a.removeItem(b[d].id,b[d].amount);sc.stats.addMap("items","sell",b[d].amount);a.getItemAmount(b[d].id)<=0&&!c&&(c=true)}return c},onQuantitySubmit:function(b,a){sc.menu.updateCart(b.data.id,a,b.price);this.onQuantityBack(b);this.cart.setCheckout(true);this.shopList.updateListEntries()},onQuantityBack:function(b){this.cart.setCheckout(true);
this.hotkeySort.setActive(true);b.unPressButton()},onHotkeyHelpCheck:function(){return sc.control.menuHotkeyHelp()},onHelpButtonPressed:function(){sc.menu.removeHotkeys();this.createHelpGui();ig.gui.addGuiElement(this.helpGui);this.helpGui.openMenu()},onHotkeySortCheck:function(){return sc.control.menuHotkeyHelp3()},onHotkeySwitchCheck:function(){return sc.control.menuHotkeyHelp4()},onSortButtonPress:function(){if(this.sortMenu.active)this.sortMenu.hideSortMenu();else{ig.gui.addGuiElement(this.sortMenu);
this.sortMenu.showSortMenu(this.hotkeySort)}},onExecuteSort:function(b){if(b.data){this.sortMenu.hideSortMenu();sc.menu.sortList(b)}},createHelpGui:function(){if(!this.helpGui){this.helpGui=new sc.HelpScreen(this,ig.lang.get("sc.gui.menu.help-texts.shop.title"),ig.lang.get("sc.gui.menu.help-texts.shop.pages"),function(){this.commitHotKeysToTopBar(true);if(sc.menu.shopState==sc.MENU_SHOP_STATE.START){this.hotkeySort.startHidden=true;this.hotkeySort.doStateTransition("HIDDEN",true)}else this.hotkeySort.startHidden=
false}.bind(this));this.helpGui.addons.push(sc.menu.guiReference.buffInfo);this.helpGui.hook.zIndex=15E4;this.helpGui.hook.pauseGui=true}},onAddHotkeys:function(b){sc.menu.buttonInteract.addGlobalButton(this.hotkeyHelp,this.onHotkeyHelpCheck.bind(this));this.commitHotKeysToTopBar(b);this.hotkeySort.doStateTransition("HIDDEN",true)},commitHotKeysToTopBar:function(b){sc.menu.addHotkey(function(){return this.hotkeySort}.bind(this));sc.menu.addHotkey(function(){return this.hotkeyHelp}.bind(this));sc.menu.commitHotkeys(b)},
onBackButtonPress:function(){sc.menu.popBackCallback();sc.menu.popMenu()},modelChanged:function(b,a,d){if(b==sc.menu)if(a==sc.MENU_EVENT.SHOP_STATE_CHANGED)this.resolveStateChange(d);else if(a==sc.MENU_EVENT.SORT_LIST){this.updateSortMenuButton(d.text);this.shopList.updateShopPage(d.data.sortType)}else if(a==sc.MENU_EVENT.SHOP_PAGE_CHANGED){this.updateSortMenuButton(ig.lang.get("sc.gui.menu.sort.auto"));this.shopList.updateShopPage()}else if(a==sc.MENU_EVENT.ITEM_INFO_CHANGED){sc.trade.setEquipID(d);
this.stats.updateStatsView()}else if(a==sc.MENU_EVENT.ITEM_RESET_INFO){sc.trade.setEquipID(-1);this.stats.reset()}else if(a==sc.MENU_EVENT.SHOP_OPEN_QUANTITY)this.openQuantitySelect(d);else if(a==sc.MENU_EVENT.SHOP_CART_CHANGED)this.cart.updateValue(d);else if(a==sc.MENU_EVENT.SHOP_OPEN_CHECKOUT){ig.gui.addGuiElement(this.confirmDialog);this.confirmDialog.show()}}})});ig.baked=!0;
ig.module("game.feature.menu.gui.help-boxes").requires("impact.feature.gui.base.basic-gui","game.feature.gui.base.boxes","game.feature.menu.gui.menu-misc").defines(function(){sc.HelpScrollContainer=ig.GuiElementBase.extend({scrollPane:null,content:null,init:function(){this.parent();this.content=new ig.GuiElementBase;this.scrollPane=new sc.ScrollPane(sc.ScrollType.Y_ONLY);this.scrollPane.setContent(this.content);this.scrollPane.showTopBar=false;this.scrollPane.showBottomBar=false;this.addChildGui(this.scrollPane)},
setElement:function(a){this.content.removeAllChildren();this.content.hook.size.y=0;this.scrollPane.box.doScrollTransition(0,0,0);this.scrollPane.recalculateScrollBars(true);this.content.addChildGui(a);this._updateContentHeight()},scroll:function(a,b){this.scrollPane.scrollY(a,b,0.05)},getScrollY:function(){return this.scrollPane.getScrollY()},clear:function(){this.content.removeAllChildren();this.content.hook.size.y=0;this.scrollPane.box.doScrollTransition(0,0,0);this.scrollPane.recalculateScrollBars(true)},
setSize:function(a,b){this.parent(a,b);this.scrollPane.setSize(a,b)},_updateContentHeight:function(){var a=this.content.hook.children,a=a[a.length-1];this.content.hook.size.y=a.pos.y+a.size.y;this.scrollPane.recalculateScrollBars()}});var b=-1;sc.MultiPagePageCounter=ig.GuiElementBase.extend({gfx:new ig.Image("media/gui/basic.png"),transitions:{DEFAULT:{state:{alpha:1},time:0.2,timeFunction:KEY_SPLINES.LINEAR},HIDDEN:{state:{alpha:0},time:0.2,timeFunction:KEY_SPLINES.LINEAR}},count:null,max:null,
init:function(a){this.parent();this.setSize(a,8);this.count=new sc.NumberGui(9);this.count.setAlign(ig.GUI_ALIGN.X_LEFT,ig.GUI_ALIGN.Y_CENTER);this.count.setPos(a/2-13,0);this.max=new sc.NumberGui(9);this.max.setAlign(ig.GUI_ALIGN.X_LEFT,ig.GUI_ALIGN.Y_CENTER);this.max.setPos(a/2+5,0);var b=new ig.ImageGui(this.gfx,96,0,8,8);b.setAlign(ig.GUI_ALIGN.X_LEFT,ig.GUI_ALIGN.Y_CENTER);b.setPos(a/2-4,0);this.addChildGui(this.count);this.addChildGui(this.max);this.addChildGui(b)},setCount:function(a){this.count.setNumber(a,
true)},setMax:function(a){this.max.setNumber(a,true)}});sc.MultiPageBoxGui=ig.GuiElementBase.extend({transitions:{DEFAULT:{state:{alpha:1},time:0.2,timeFunction:KEY_SPLINES.EASE_OUT},HIDDEN:{state:{alpha:0},time:0.3,timeFunction:KEY_SPLINES.EASE_IN}},msgBox:null,content:null,header:null,buttonInteract:null,buttonGroup:null,defaultHeaderText:"Default",linePadding:2,listPadding:2,turnLeft:null,turnRight:null,pageCounter:null,pages:[],curPage:0,backSound:null,_width:300,init:function(a,b){this.parent();
this.setSize(ig.system.width,ig.system.height);this.hook.localAlpha=0.8;a=a||300;b=b||240;this._width=a;this.buttonInteract=new ig.ButtonInteractEntry;this.buttonGroup=new sc.ButtonGroup(false,ig.BUTTON_GROUP_SELECT_TYPE.HORIZONTAL);this.buttonInteract.pushButtonGroup(this.buttonGroup);this.content=new ig.GuiElementBase;this.content.setSize(a,b);this._createInitContent(a);this.msgBox=new sc.CenterBoxGui(this.content);this.msgBox.setAlign(ig.GUI_ALIGN.X_CENTER,ig.GUI_ALIGN.Y_CENTER);this.msgBox.setPos(0,
0);this.addChildGui(this.msgBox);this.turnLeft=new sc.ButtonGui("\\i[arrow-left]");this.turnLeft.setAlign(ig.GUI_ALIGN.X_CENTER,ig.GUI_ALIGN.Y_CENTER);this.turnLeft.setPos(-(a/2+this.turnLeft.hook.size.x+4),0);this.turnLeft.hook.transitions={DEFAULT:{state:{alpha:1},time:0.2,timeFunction:KEY_SPLINES.LINEAR},HIDDEN:{state:{alpha:0},time:0.2,timeFunction:KEY_SPLINES.LINEAR}};this.turnLeft.onButtonPress=function(){var a=this.curPage;this.curPage--;if(this.curPage<=0)this.curPage=0;a!=this.curPage&&this._setPage(this.curPage)}.bind(this);
this.turnLeft.doStateTransition("HIDDEN",true);this.addChildGui(this.turnLeft);this.turnRight=new sc.ButtonGui("\\i[arrow-right]");this.turnRight.setAlign(ig.GUI_ALIGN.X_CENTER,ig.GUI_ALIGN.Y_CENTER);this.turnRight.setPos(a/2+this.turnRight.hook.size.x+4,0);this.turnRight.hook.transitions={DEFAULT:{state:{alpha:1},time:0.2,timeFunction:KEY_SPLINES.LINEAR},HIDDEN:{state:{alpha:0},time:0.2,timeFunction:KEY_SPLINES.LINEAR}};this.turnRight.onButtonPress=function(){var a=this.curPage;this.curPage++;if(this.curPage>=
this.pages.length-1)this.curPage=this.pages.length-1;a!=this.curPage&&this._setPage(this.curPage)}.bind(this);this.turnRight.doStateTransition("HIDDEN",true);this.addChildGui(this.turnRight);this.backSound=sc.BUTTON_SOUND.back;this.doStateTransition("HIDDEN",true)},openMenu:function(){ig.interact.addEntry(this.buttonInteract);ig.interact.setBlockDelay(0.2);this.buttonInteract.clearAllButtons();this.msgBox.doStateTransition("DEFAULT");this.turnLeft.doStateTransition("HIDDEN",true);this.turnRight.doStateTransition("HIDDEN",
true);this.curPage=0;this.pages.length>0&&this._setPage(0);this.pages.length>1?this.pageCounter.doStateTransition("DEFAULT",true):this.pageCounter.doStateTransition("HIDDEN",true);this.doStateTransition("DEFAULT")},closeMenu:function(){ig.interact.removeEntry(this.buttonInteract);ig.interact.setBlockDelay(0.2);this.msgBox.doStateTransition("HIDDEN");this.doStateTransition("HIDDEN",false,true)},addPage:function(a,b,c){this.pages.push({header:a||null,content:b||null,isList:c||false});this.pageCounter.setMax(this.pages.length)},
addPages:function(a){var b=new ig.VarCondition;if(a&&a!="UNKNOWN LABEL")for(var c=0;c<a.length;c++){if(a[c].condition){b.setCondition(a[c].condition);if(!b.evaluate())continue}this.addPage(a[c].title,a[c].content,a[c].content instanceof Array)}},setDefaultHeaderText:function(a){this.defaultHeaderText=a||"DEFAULT";this.header.setText(this.defaultHeaderText)},_setPage:function(a){var d=new ig.GuiElementBase;d.hook.size.x=296;var c=this.pages[a];this.header.setText(c.header||this.defaultHeaderText);
var e=2;b=-1;if(c.content)if(c.isList)for(var c=c.content,f=0;f<c.length;f++)e=this.addListEntry(c[f],d,e);else e=this.addListEntry(c.content,d,e);d.hook.size.y=e;this.scrollContainer.setElement(d);this.pageCounter.setCount(a+1);if(this.curPage>=this.pages.length-1){this.turnRight.unsetFocus();this.buttonInteract.removeGlobalButton(this.turnRight);this.turnRight.doStateTransition("HIDDEN",true)}else if(this.pages.length>1){this.buttonInteract.addGlobalButton(this.turnRight,this.onTurnRightCheck.bind(this),
true);this.turnRight.doStateTransition("DEFAULT",true)}if(this.curPage==0){this.buttonInteract.removeGlobalButton(this.turnLeft);this.turnLeft.unsetFocus();this.turnLeft.doStateTransition("HIDDEN",true)}else if(this.pages.length>1){this.buttonInteract.addGlobalButton(this.turnLeft,this.onTurnLeftCheck.bind(this),true);this.turnLeft.doStateTransition("DEFAULT",true)}},addListEntry:function(a,d,c){var a=ig.LangLabel.getText(a),e=null;if(a.indexOf("!!min=")==0)b=a.substring(6)*1;else if(a.indexOf("--")==
0){var e=a.substring(2),f=e.indexOf("--");if(f==-1){e=new sc.TextGui("\\i[li]"+e,{maxWidth:this._width-8});e.setPos(0,c);c=c+(e.hook.size.y+this.listPadding);d.addChildGui(e)}else{e=new sc.TextGui("\\i[li]"+(f!=-1?e.substring(0,f):""));e.setPos(0,c);f!=-1&&d.addChildGui(e);f=f==-1?2:f+4;a=new sc.TextGui(a.substring(f),{maxWidth:this._width-(b==-1?e.hook.size.x-8:b+8)});a.setPos(f==2?9:b==-1?e.hook.size.x+4:b,c);c=c+(a.hook.size.y+this.listPadding);d.addChildGui(a)}}else if(a.indexOf("!!====")==0){e=
new ig.ColorGui("#7E7E7E",296,1);e.setPos(0,c);d.addChildGui(e);c=c+3}else if(a.indexOf("......")==0)c=c+4;else if(a.indexOf("....")==0)c=c+2;else if(a.indexOf("..")==0)c=c+1;else{if(a.indexOf("__")==0){e=new sc.TextGui(a.substring(2),{maxWidth:this._width-4});e.setPos(0,c);e.setAlign(ig.GUI_ALIGN.X_CENTER,ig.GUI_ALIGN.Y_TOP)}else{e=new sc.TextGui(a,{maxWidth:this._width-4});e.setPos(0,c)}d.addChildGui(e);c=c+(e.hook.size.y+this.linePadding)}return c},_createInitContent:function(a){var b=2;this.header=
new sc.TextGui(this.defaultHeaderText);this.header.setAlign(ig.GUI_ALIGN.X_CENTER,ig.GUI_ALIGN.Y_TOP);this.header.setPos(0,b);this.content.addChildGui(this.header);var b=b+(this.header.hook.size.y+2),c=new sc.LineGui(300);c.setAlign(ig.GUI_ALIGN.X_CENTER,ig.GUI_ALIGN.Y_TOP);c.setPos(0,b);this.content.addChildGui(c);b=b+1;this.scrollContainer=new sc.HelpScrollContainer;this.scrollContainer.setPos(0,b);this.scrollContainer.setSize(301,208);b=b+this.scrollContainer.hook.size.y;c=new sc.LineGui(300);
c.setAlign(ig.GUI_ALIGN.X_CENTER,ig.GUI_ALIGN.Y_TOP);c.setPos(0,b);this.content.addChildGui(c);this.content.addChildGui(this.scrollContainer);b=b+4;this.pageCounter=new sc.MultiPagePageCounter(a);this.pageCounter.setAlign(ig.GUI_ALIGN.X_CENTER,ig.GUI_ALIGN.Y_TOP);this.pageCounter.setPos(0,b);this.pageCounter.doStateTransition("HIDDEN",true);this.content.addChildGui(this.pageCounter)},onTurnLeftCheck:function(){return sc.control.menuCircleLeft()||sc.control.leftPressed()},onTurnRightCheck:function(){return sc.control.menuCircleRight()||
sc.control.rightPressed()},update:function(){if(!ig.interact.isBlocked()){sc.control.menuScrollUp()?this.scrollContainer.scroll(-20):sc.control.menuScrollDown()&&this.scrollContainer.scroll(20);sc.control.downDown()?this.scrollContainer.scroll(200*ig.system.tick):sc.control.upDown()&&this.scrollContainer.scroll(-200*ig.system.tick);sc.control.menuBack()&&this.closeMenu()}},updateDrawables:function(a){a.addColor("#000",0,0,this.hook.size.x,this.hook.size.y)}})});ig.baked=!0;
ig.module("game.feature.menu.gui.synop.synop-misc").requires("impact.feature.gui.base.box","impact.feature.gui.gui","game.feature.menu.gui.menu-misc","game.feature.menu.gui.quests.quest-entries").defines(function(){sc.LOG_GUI_TYPE={};sc.LogGuiTypeBase=ig.GuiElementBase.extend({iconGui:null,textGui:null,type:null,init:function(b){this.parent();this.setSize(376,18);this.type=b.type||sc.LOG_TYPES.STORY;this.iconGui=new sc.TextGui("\\i[logs-"+this.type+"]");this.iconGui.setAlign(ig.GUI_ALIGN.X_LEFT,ig.GUI_ALIGN.Y_CENTER);
this.addChildGui(this.iconGui);this.textGui=new sc.TextGui("");this.textGui.setAlign(ig.GUI_ALIGN.X_LEFT,ig.GUI_ALIGN.Y_CENTER);this.textGui.setPos(14,0);this.addChildGui(this.textGui)}});sc.LOG_GUI_TYPE.LANDMARK=sc.LogGuiTypeBase.extend({init:function(b){this.parent(b);var a=ig.lang.get("sc.gui.menu.synopsis-menu.types.landmark"),a=a+("\\c[3]"+sc.map.getLandmarkName(b.landmark,b.area)+"\\c[0]");this.textGui.setText(a);this.textGui.setAlign(ig.GUI_ALIGN.X_LEFT,ig.GUI_ALIGN.Y_TOP);this.iconGui.setAlign(ig.GUI_ALIGN.X_LEFT,
ig.GUI_ALIGN.Y_TOP);a="\\i[insetArrow]"+ig.lang.get("sc.gui.menu.synopsis-menu.types.lm")+sc.map.getAreaName(b.area);this.areaGui=new sc.TextGui(a,{font:sc.fontsystem.smallFont});this.areaGui.setPos(6,16);this.addChildGui(this.areaGui);this.setSize(376,28)}});sc.LOG_GUI_TYPE.TRADER=sc.LogGuiTypeBase.extend({init:function(b){this.parent(b);var a=null,a=b.isUpdate?ig.lang.get("sc.gui.menu.synopsis-menu.types.traderUpdate"):ig.lang.get("sc.gui.menu.synopsis-menu.types.trader"),a=a+("\\c[3]"+sc.trade.getTraderName(b.trader)+
"\\c[0]");this.textGui.setText(a);this.textGui.setAlign(ig.GUI_ALIGN.X_LEFT,ig.GUI_ALIGN.Y_TOP);this.iconGui.setAlign(ig.GUI_ALIGN.X_LEFT,ig.GUI_ALIGN.Y_TOP);b=sc.trade.getFoundTrader(b.trader);a="\\i[insetArrow]"+ig.lang.get("sc.gui.menu.synopsis-menu.types.lm")+b.area.toString()+" - "+b.map.toString();this.areaGui=new sc.TextGui(a,{font:sc.fontsystem.smallFont});this.areaGui.setPos(6,16);this.addChildGui(this.areaGui);this.setSize(376,28)}});sc.LOG_GUI_TYPE.TRADER.isAvailable=function(b){return sc.trade.getTrader(b.trader)};
sc.LOG_GUI_TYPE.LORE=sc.LogGuiTypeBase.extend({init:function(b){this.parent(b);this.iconGui.setAlign(ig.GUI_ALIGN.X_LEFT,ig.GUI_ALIGN.Y_TOP);this.textGui.setMaxWidth(360);var a="",a=b.update?ig.lang.get("sc.gui.menu.synopsis-menu.types.loreUpdated"):ig.lang.get("sc.gui.menu.synopsis-menu.types.lore"),a=(b=sc.lore.getLore(b.lore))?a+("\\c[3]"+ig.LangLabel.getText(b.title)+"\\c[0]"):a+"\\c[3]???\\c[0]";this.textGui.setText(a);this.setSize(376,Math.max(18,this.textGui.hook.size.y+2))}});sc.LOG_GUI_TYPE.TROPHY=
sc.LogGuiTypeBase.extend({init:function(b){this.parent(b);var a=ig.lang.get("sc.gui.menu.synopsis-menu.types.trophy"),a=a+(" \\c[3]"+sc.trophies.getTrophyName(b.trophy)+"\\c[0]");this.textGui.setText(a)}});sc.LOG_GUI_TYPE.DROP=sc.LogGuiTypeBase.extend({init:function(b){this.parent(b);var a=ig.lang.get("sc.gui.menu.synopsis-menu.types.dropCompleted"),a=a+("\\c[3]"+sc.menu.getDropName(b.drop)+"\\c[0]");this.textGui.setText(a)}});sc.LOG_GUI_TYPE.QUEST=sc.LogGuiTypeBase.extend({init:function(b){this.parent(b);
var a="";if(b.task!=void 0){a=ig.lang.get("sc.gui.menu.synopsis-menu.types.questTask");this.textGui.setAlign(ig.GUI_ALIGN.X_LEFT,ig.GUI_ALIGN.Y_TOP);this.iconGui.setAlign(ig.GUI_ALIGN.X_LEFT,ig.GUI_ALIGN.Y_TOP);var d=sc.quests.getQuestTask(b.quest,b.task),a=a+("\\c[3]"+sc.quests.getQuestName(b.quest)+"\\c[0]");this.textGui.setText(a);a="\\i[insetArrow]"+ig.lang.get("sc.gui.menu.synopsis-menu.types.qtm");b=new sc.TextGui(a,{font:sc.fontsystem.smallFont});b.setPos(6,16);this.addChildGui(b);a=Math.max(72,
b.hook.size.x+8);d=new sc.TextGui(d.task,{font:sc.fontsystem.smallFont,maxWidth:360-b.hook.size.x-2});d.setPos(a,16);this.addChildGui(d);this.setSize(376,14+d.hook.size.y)}else if(b.finish){a=ig.lang.get("sc.gui.menu.synopsis-menu.types.questFinish");d=sc.quests.getStaticQuest(b.quest);a=a+("\\c[3]"+(d?d.name:"????")+"\\c[0]");this.textGui.setText(a)}else if(b.accept){a=ig.lang.get("sc.gui.menu.synopsis-menu.types.questStart");d=sc.quests.getStaticQuest(b.quest);a=a+("\\c[3]"+(d?d.name:"????")+"\\c[0]");
this.textGui.setText(a)}}});sc.SynopsisLogDisplay=sc.HeaderMenuPanel.extend({transitions:{DEFAULT:{state:{},time:0.2,timeFunction:KEY_SPLINES.EASE},HIDDEN:{state:{alpha:0,offsetX:-204.5},time:0.2,timeFunction:KEY_SPLINES.LINEAR}},content:null,init:function(){this.parent(ig.lang.get("sc.gui.menu.synopsis-menu.log"),sc.MenuPanelType.TOP_RIGHT_EDGE);this.setSize(384,206);this.setPos(25,85);this.content=new ig.GuiElementBase;this.content.setPos(4,9);this.content.setSize(376,195);this.addChildGui(this.content);
this.header.annotation={type:"INFO",content:{title:"sc.gui.menu.help.synopsis.titles.activity",description:"sc.gui.menu.help.synopsis.description.activity"},offset:{x:-3,y:-2},size:{x:"dyn",y:11,offX:6},index:{x:0,y:1}};this.doStateTransition("HIDDEN",true)},show:function(){this.doStateTransition("DEFAULT");this.content.removeAllChildren();this.setPos(25,80);this.setSize(384,206);for(var b=sc.menu.logEntries,a=b.length,d=null,c=1,e=this.hook.size.y-10;a--;){d=b[a];if((sc.model.player.hasItem(135)||
d.type!="LORE")&&(!sc.LOG_GUI_TYPE[d.type].isAvailable||sc.LOG_GUI_TYPE[d.type].isAvailable(d))){d=new sc.LOG_GUI_TYPE[d.type](d);d.setPos(0,c);c=c+d.hook.size.y;e=e-d.hook.size.y;if(e>0)this.content.addChildGui(d);else break}}},hide:function(){this.doStateTransition("HIDDEN")}});sc.SynopsisTaskDisplay=sc.HeaderMenuPanel.extend({transitions:{DEFAULT:{state:{},time:0.2,timeFunction:KEY_SPLINES.EASE},HIDDEN:{state:{alpha:0,offsetX:-204.5},time:0.2,timeFunction:KEY_SPLINES.LINEAR}},task:null,init:function(){this.parent(ig.lang.get("sc.gui.menu.synopsis-menu.task"),
sc.MenuPanelType.TOP_RIGHT_EDGE);this.setSize(384,46);this.setPos(25,29);this.task=new sc.TextGui(ig.lang.get("sc.gui.menu.synopsis-menu.notask"),{maxWidth:374});this.task.setPos(5,11);this.addChildGui(this.task);this.header.annotation={type:"INFO",content:{title:"sc.gui.menu.help.synopsis.titles.objective",description:"sc.gui.menu.help.synopsis.description.objective"},offset:{x:-3,y:-2},size:{x:"dyn",y:11,offX:6},index:{x:0,y:0}};this.doStateTransition("HIDDEN",true)},show:function(){var b=sc.model.currentTask||
sc.model.permaTask;if(b){this.task.setAlign(ig.GUI_ALIGN.X_LEFT,ig.GUI_ALIGN.Y_TOP);this.task.hook.pos.y=11}else{this.task.setAlign(ig.GUI_ALIGN.X_CENTER,ig.GUI_ALIGN.Y_CENTER);this.task.hook.pos.y=5}this.task.setText(b||ig.lang.get("sc.gui.menu.synopsis-menu.notask"));this.doStateTransition("DEFAULT")},hide:function(){this.doStateTransition("HIDDEN")}});sc.SynopsisQuestDisplay=sc.HeaderMenuPanel.extend({gfx:new ig.Image("media/gui/menu.png"),transitions:{DEFAULT:{state:{},time:0.2,timeFunction:KEY_SPLINES.EASE},
HIDDEN:{state:{alpha:0,offsetX:-204.5},time:0.2,timeFunction:KEY_SPLINES.LINEAR}},questNameGui:null,taskGUI:null,quest:null,init:function(){this.parent(ig.lang.get("sc.gui.menu.synopsis-menu.favquest"),sc.MenuPanelType.TOP_RIGHT_EDGE);this.setSize(384,109);this.setPos(25,80);this.questNameGui=new sc.TextGui("");this.addChildGui(this.questNameGui);this.taskGUI=new sc.TaskEntry;this.taskGUI.setPos(30,34);this.addChildGui(this.taskGUI);this.header.annotation={type:"INFO",content:{title:"sc.gui.menu.help.synopsis.titles.quest",
description:"sc.gui.menu.help.synopsis.description.quest"},offset:{x:-3,y:-2},size:{x:"dyn",y:11,offX:6},index:{x:0,y:1}};this.doStateTransition("HIDDEN",true)},setQuest:function(b){if(b){this.quest=b;this.taskGUI.doStateTransition("DEFAULT",true);this.questNameGui.setAlign(ig.GUI_ALIGN.X_LEFT,ig.GUI_ALIGN.Y_TOP);this.questNameGui.setPos(4,11);this.questNameGui.setText("\\i[quest-fav]"+b.name);this.taskGUI.setTask(sc.quests.getCurrentMarkedQuestTaskIndex(),this.quest,true,true);this.taskGUI.show(true,
0.1);this.setSize(384,34+this.taskGUI.hook.size.y)}else{this.quest=null;this.questNameGui.setAlign(ig.GUI_ALIGN.X_CENTER,ig.GUI_ALIGN.Y_TOP);this.questNameGui.setPos(4,11);this.questNameGui.setText(ig.lang.get("sc.gui.menu.synopsis-menu.noquest"));this.taskGUI.doStateTransition("HIDDEN",true);this.setSize(384,30)}},updateDrawables:function(b){this.parent(b);this.quest&&b.addGfx(this.gfx,10,30,416,53,17,16)},show:function(){this.setQuest(sc.quests.getMarkedQuest());this.doStateTransition("DEFAULT")},
hide:function(b){this.doStateTransition("HIDDEN",b)}})});ig.baked=!0;
ig.module("game.feature.menu.gui.synop.synop-menu").requires("impact.feature.gui.gui","impact.feature.gui.base.basic-gui","game.feature.menu.gui.help-boxes","game.feature.menu.gui.synop.synop-misc").defines(function(){var b=[43,73,103,133,163,193,223,253,283];sc.SynopsisMenu=sc.BaseMenu.extend({hotkeyHelp:null,temp_button_group:null,helpGui:null,buttonGroup:null,buttons:{map:null,lore:null,trophies:null,records:null,trade:null,enemies:null,botanics:null,newgame:null},infoTask:null,infoQuest:null,
infoLogs:null,init:function(){this.parent();this.hook.size.x=ig.system.width;this.hook.size.y=ig.system.height;this.hotkeyHelp=new sc.ButtonGui("\\i[help]"+ig.lang.get("sc.gui.menu.hotkeys.help"),void 0,true,sc.BUTTON_TYPE.SMALL);this.hotkeyHelp.keepMouseFocus=true;this.hotkeyHelp.hook.transitions={DEFAULT:{state:{},time:0.2,timeFunction:KEY_SPLINES.EASE},HIDDEN:{state:{offsetY:-this.hotkeyHelp.hook.size.y},time:0.2,timeFunction:KEY_SPLINES.LINEAR}};this.hotkeyHelp.onButtonPress=this.onHelpButtonPressed.bind(this);
this.buttonGroup=new sc.ButtonGroup;this.buttonGroup.addSelectionCallback(function(a){a.data&&(a.active?sc.menu.setInfoText(a.data):sc.menu.setInfoText("???"))});this.buttonGroup.setMouseFocusLostCallback(function(){sc.menu.setInfoText("",true)});var a=sc.model.player;this.buttons.trade=this._createButton("trade",0,sc.MENU_SUBMENU.TRADE,!a.hasItem(135)||!sc.trade.hasAnyTraderFound());this.buttons.botanics=this._createButton("botanics",1,sc.MENU_SUBMENU.BOTANICS,!a.hasItem(285)||!sc.menu.hasAnyDropFound());
this.buttons.enemies=this._createButton("enemies",2,sc.MENU_SUBMENU.ENEMY,!a.hasItem(135));this.buttons.map=this._createButton("map",3,sc.MENU_SUBMENU.MAP);this.buttons.lore=this._createButton("lore",4,sc.MENU_SUBMENU.LORE,!a.hasItem(135),true);this.buttons.trophies=this._createButton("trophies",5,sc.MENU_SUBMENU.TROPHY,false,true);this.buttons.records=this._createButton("records",6,sc.MENU_SUBMENU.STATS,!a.hasItem(135));if(sc.newgame.active){this.buttons.newgame=this._createButton("newgame",7,sc.MENU_SUBMENU.NEW_GAME);
this.buttons.newgame.onButtonPress=function(){sc.menu.newGameViewMode=true;sc.menu.pushMenu(sc.MENU_SUBMENU.NEW_GAME)}.bind(this)}this.buttons.lore.setActive(a.hasItem(135));this.buttons.records.setActive(a.hasItem(135));this.buttons.trade.setActive(a.hasItem(135)&&sc.trade.hasAnyTraderFound());this.buttons.enemies.setActive(a.hasItem(135));this.buttons.botanics.setActive(a.hasItem(285)&&sc.menu.hasAnyDropFound());this.buttons.newgame&&this.buttons.newgame.setActive(sc.newgame.active);for(var b in this.buttons)this.buttons[b]&&
this.addChildGui(this.buttons[b]);this.buttonGroup.addFocusGui(this.buttons.trade,0,0);this.buttonGroup.addFocusGui(this.buttons.botanics,0,1);this.buttonGroup.addFocusGui(this.buttons.enemies,0,2);this.buttonGroup.addFocusGui(this.buttons.map,0,3);this.buttonGroup.addFocusGui(this.buttons.lore,0,4);this.buttonGroup.addFocusGui(this.buttons.trophies,0,5);this.buttonGroup.addFocusGui(this.buttons.records,0,6);this.buttons.newgame&&this.buttonGroup.addFocusGui(this.buttons.newgame,0,7);this.infoTask=
new sc.SynopsisTaskDisplay;this.addChildGui(this.infoTask);this.infoLogs=new sc.SynopsisLogDisplay;this.addChildGui(this.infoLogs);this.doStateTransition("DEFAULT")},addObservers:function(){sc.Model.addObserver(sc.menu,this)},removeObservers:function(){sc.Model.removeObserver(sc.menu,this)},showMenu:function(){this.addObservers();sc.menu.buttonInteract.pushButtonGroup(this.buttonGroup);sc.menu.previousMenu==sc.MENU_SUBMENU.START&&sc.menu.pushBackCallback(this.onBackButtonPress.bind(this));sc.menu.moveLeaSprite(0,
0,sc.MENU_LEA_STATE.HIDDEN);this.buttons.lore.active?sc.menu.hasNewUnlock(sc.MENU_SUBMENU.LORE)?this.buttons.lore.activateNewOverlay(true):this.buttons.lore.deactivateNewOverlay():this.buttons.lore.deactivateNewOverlay();this.buttons.trophies.active?sc.menu.hasNewUnlock(sc.MENU_SUBMENU.TROPHY)?this.buttons.trophies.activateNewOverlay(true):this.buttons.trophies.deactivateNewOverlay():this.buttons.trophies.deactivateNewOverlay();(!sc.model.isSaveAllowed()||sc.model.isTeleportBlocked())&&!sc.autoControl.isActive()?
this.buttons.map.setActive(false):this.buttons.map.setActive(true);this.buttons.trade.doStateTransition("DEFAULT",false,false,null,0.032);this.buttons.botanics.doStateTransition("DEFAULT",false,false,null,0.016);this.buttons.enemies.doStateTransition("DEFAULT",false,false,null,0);this.buttons.map.doStateTransition("DEFAULT",false,false,null,0);this.buttons.lore.doStateTransition("DEFAULT",false,false,null,0);this.buttons.trophies.doStateTransition("DEFAULT",false,false,null,0);this.buttons.records.doStateTransition("DEFAULT",
false,false,null,0.016);this.buttons.newgame&&this.buttons.newgame.doStateTransition("DEFAULT",false,false,null,0.032);this.infoTask.show();this.infoLogs.show();ig.interact.setBlockDelay(0.2);this.onAddHotkeys()},hideMenu:function(){this.removeObservers();sc.menu.moveLeaSprite(0,0,sc.MENU_LEA_STATE.LARGE);this.exitMenu()},exitMenu:function(){for(var a in this.buttons){var b=this.buttons[a];b&&b.doStateTransition("HIDDEN")}this.infoTask.hide();this.infoLogs.hide();sc.menu.buttonInteract.removeGlobalButton(this.hotkeyHelp);
sc.menu.buttonInteract.removeButtonGroup(this.buttonGroup)},_createButton:function(a,d,c,e,f){var g=null,g=f?new sc.NewUnlockButton(e?"???":ig.lang.get("sc.gui.menu.synopsis-menu."+a),sc.BUTTON_MENU_WIDTH):new sc.ButtonGui(e?"???":ig.lang.get("sc.gui.menu.synopsis-menu."+a),sc.BUTTON_MENU_WIDTH);g.setAlign(ig.GUI_ALIGN.X_RIGHT,ig.GUI_ALIGN.Y_TOP);g.setPos(10,b[d]+0);g.hook.transitions={DEFAULT:{state:{},time:0.2,timeFunction:KEY_SPLINES.EASE},HIDDEN:{state:{offsetX:-(sc.BUTTON_MENU_WIDTH+10)},time:0.2,
timeFunction:KEY_SPLINES.LINEAR}};g.setData(ig.lang.get("sc.gui.menu.synopsis-menu.descriptions."+a));g.menu=c;g.onButtonPress=function(){this.menu&&sc.menu.pushMenu(this.menu)};g.doStateTransition("HIDDEN",true);return g},onHotkeyHelpCheck:function(){return sc.control.menuHotkeyHelp()},onHelpButtonPressed:function(){sc.menu.removeHotkeys();this.createHelpGui();ig.gui.addGuiElement(this.helpGui);this.helpGui.openMenu()},createHelpGui:function(){if(!this.helpGui){this.helpGui=new sc.HelpScreen(this,
ig.lang.get("sc.gui.menu.help-texts.synopsis.title"),ig.lang.get("sc.gui.menu.help-texts.synopsis.pages"),function(){this.commitHotKeysToTopBar(true)}.bind(this),true);this.helpGui.hook.zIndex=15E4;this.helpGui.hook.pauseGui=true}},onAddHotkeys:function(a){sc.menu.buttonInteract.addGlobalButton(this.hotkeyHelp,this.onHotkeyHelpCheck.bind(this));this.commitHotKeysToTopBar(a)},commitHotKeysToTopBar:function(a){sc.menu.addHotkey(function(){return this.hotkeyHelp}.bind(this));sc.menu.commitHotkeys(a)},
onBackButtonPress:function(){sc.menu.popBackCallback();sc.menu.popMenu()},modelChanged:function(){}})});ig.baked=!0;
ig.module("game.feature.menu.gui.quests.quest-misc").requires("impact.feature.gui.base.box","impact.feature.gui.gui","impact.feature.interact.button-interact","game.feature.interact.button-group","game.feature.menu.gui.quests.quest-entries").defines(function(){function b(a){switch(a){case "ALL":return"\\i[element-neutral]\\i[element-heat]\\i[element-cold]\\i[element-shock]\\i[element-wave]";case "ALL_ELEMENTS":return"\\i[element-heat]\\i[element-cold]\\i[element-shock]\\i[element-wave]";case "NEUTRAL":return"\\i[element-neutral]";
case "HEAT":return"\\i[element-heat]";case "COLD":return"\\i[element-cold]";case "SHOCK":return"\\i[element-shock]";case "WAVE":return"\\i[element-wave]"}}var a=new ig.Sound("media/sound/hud/quest-solved.ogg",0.6);sc.SolvedLine=ig.SimpleGui.extend({transitions:{DEFAULT:{state:{},time:0.2,timeFunction:KEY_SPLINES.LINEAR},HIDDEN:{state:{alpha:0.5,scaleY:0},time:0.2,timeFunction:KEY_SPLINES.LINEAR}},ninepatch:new ig.NinePatch("media/gui/menu.png",{width:2,height:2,left:6,top:13,right:6,bottom:0,offsets:{"default":{x:473,
y:17}}}),textGui:null,init:function(){this.parent();this.textGui=new sc.TextGui(ig.lang.get("sc.gui.menu.quests.solved"),{font:sc.fontsystem.smallFont});this.textGui.setAlign(ig.GUI_ALIGN.X_CENTER,ig.GUI_ALIGN.Y_TOP);this.textGui.setPos(0,0);this.addChildGui(this.textGui);this.setSize(105,13)},setSize:function(a,b){this.parent(a,b);this.setPivot(a/2,b/2)},updateDrawables:function(a){a.addColor("#008277",0,6,this.hook.size.x,1);this.ninepatch.draw(a,95,13,"default",this.hook.size.x/2-47.5,0)}});sc.QuestBaseBox=
ig.BoxGui.extend({ninepatch:new ig.NinePatch("media/gui/menu.png",{width:2,height:8,left:27,top:21,right:27,bottom:3,offsets:{"default":{x:416,y:0},dialog:{x:416,y:80},solved:{x:456,y:48},overlay:{x:416,y:112},"dialog-solved":{x:416,y:112},elite:{x:616,y:64},"elite-darker":{x:616,y:96}}}),levelGui:null,elite:0,init:function(a,b,d){this.parent(56,32);this.setSize(a||56,b||32);this.levelGui=new sc.NumberGui(99,{leadingZeros:2});this.levelGui.setAlign(ig.GUI_ALIGN.X_RIGHT,ig.GUI_ALIGN.Y_TOP);this.levelGui.setNumber(d!=
void 0?d:0);this.levelGui.setPos(5,11);this.addChildGui(this.levelGui)},updateDrawables:function(a){this.parent(a);this.elite!=0&&a.addGfx(this.ninepatch.gfx,6,3,this.elite==1?608:624,0,16,16)},setLevel:function(a){this.levelGui.setNumber(a||0,true)},setElite:function(a,b){this.elite=a?b?2:1:0}});var d=0;sc.QuestInfoBoxActive=ig.SimpleGui.extend({gfx:new ig.Image("media/gui/menu.png"),transitions:{DEFAULT:{state:{},time:0.2,timeFunction:KEY_SPLINES.LINEAR},HIDDEN:{state:{alpha:0},time:0.2,timeFunction:KEY_SPLINES.LINEAR}},
lineGui:null,taskContainer:null,init:function(){this.parent();this.setSize(281,164);this.lineGui=new ig.ColorGui("#545454",257,1);this.lineGui.setAlign(ig.GUI_ALIGN.X_CENTER,ig.GUI_ALIGN.Y_TOP);this.lineGui.setPos(0,0);this.addChildGui(this.lineGui);this.taskContainer=new ig.GuiElementBase;this.taskContainer.setSize(257,173);this.taskContainer.setPos(12,2);this.addChildGui(this.taskContainer);this.hide(true)},setTasks:function(a,b){this.taskContainer.removeAllChildren();this.lineGui.color=a.elite?
"#8d0000":"#545454";for(var f=b+1,g=10;f--;){g=this._addTask(f,a,g);if(g>=163){f=new ig.ImageGui(this.gfx,434,56,14,4);f.setAlign(ig.GUI_ALIGN.X_CENTER,ig.GUI_ALIGN.Y_TOP);f.setPos(0,4);this.taskContainer.addChildGui(f);d=d+5;break}else d=g}this.taskContainer.setSize(257,d)},_addTask:function(a,b,f){var g=new sc.TaskEntry(a,b,false,true);g.doStateTransition("DEFAULT",true);g.setAlign(ig.GUI_ALIGN.X_LEFT,ig.GUI_ALIGN.Y_BOTTOM);g.setPos(1,f);f=f+(g.hook.size.y+3);ig.langEdit&&ig.langEdit.submitCustomFile("Quest Task ["+
(a+1)+"]: "+b.name,b.tasks[a].task,"data/database.json");if(f<=163){this.taskContainer.addChildGui(g);return f}d=f-g.hook.size.y;return f}});sc.QuestInfoBoxSolved=ig.SimpleGui.extend({transitions:{DEFAULT:{state:{},time:0.2,timeFunction:KEY_SPLINES.LINEAR},HIDDEN:{state:{alpha:0},time:0.2,timeFunction:KEY_SPLINES.LINEAR}},solvedGui:null,endDescription:null,init:function(){this.parent();this.setSize(281,186);this.solvedGui=new sc.SolvedLine;this.solvedGui.setAlign(ig.GUI_ALIGN.X_CENTER,ig.GUI_ALIGN.Y_TOP);
this.solvedGui.setSize(257,13);this.solvedGui.setPos(0,0);this.addChildGui(this.solvedGui);this.endDescription=new sc.TextGui("",{font:sc.fontsystem.smallFont,linePadding:0,maxWidth:254});this.endDescription.setAlign(ig.GUI_ALIGN.X_LEFT,ig.GUI_ALIGN.Y_TOP);this.endDescription.setPos(13,17);this.addChildGui(this.endDescription);this.hide(true)}});sc.QuestInfoBox=sc.QuestBaseBox.extend({gfx:new ig.Image("media/gui/menu.png"),titleGui:null,descriptionGui:null,locationGui:null,locationText:null,lineGui:null,
activeView:null,solvedView:null,init:function(){this.parent(281,265);this.setPivot(0,265);this.annotation=[];this.annotation[0]={content:{title:"sc.gui.menu.help.quest.titles.type",description:"sc.gui.menu.help.quest.description.type"},offset:{x:3,y:2},size:{x:21,y:19},index:{x:0,y:0}};this.annotation[1]={content:{title:"sc.gui.menu.help.quest.titles.level",description:"sc.gui.menu.help.quest.description.level"},offset:{x:257,y:2},size:{x:21,y:19},index:{x:1,y:0}};this.annotation[2]={content:{title:"sc.gui.menu.help.quest.titles.content",
description:"sc.gui.menu.help.quest.description.content"},offset:{x:3,y:24},size:{x:275,y:217},index:{x:0,y:1}};this.annotation[3]={content:{title:"sc.gui.menu.help.quest.titles.location",description:"sc.gui.menu.help.quest.description.location"},offset:{x:3,y:243},size:{x:19,y:22},index:{x:0,y:2}};this.titleGui=new sc.TextGui("");this.titleGui.setAlign(ig.GUI_ALIGN.X_CENTER,ig.GUI_ALIGN.Y_TOP);this.titleGui.setPos(0,4);this.addChildGui(this.titleGui);this.descriptionGui=new sc.TextGui("",{font:sc.fontsystem.smallFont,
linePadding:0,maxWidth:254});this.descriptionGui.setAlign(ig.GUI_ALIGN.X_LEFT,ig.GUI_ALIGN.Y_TOP);this.descriptionGui.setPos(13,24);this.addChildGui(this.descriptionGui);this.locationGui=new ig.ColorGui("#545454",277,19);this.locationGui.setAlign(ig.GUI_ALIGN.X_CENTER,ig.GUI_ALIGN.Y_BOTTOM);this.locationGui.setPos(0,2);this.addChildGui(this.locationGui);this.locationText=new sc.TextGui("");this.locationText.setPos(22,2);this.locationGui.addChildGui(this.locationText);var a=new ig.ImageGui(this.gfx,
418,33,12,18);a.setPos(5,1);this.locationGui.addChildGui(a);this.activeView=new sc.QuestInfoBoxActive;this.activeView.setPos(0,80);this.addChildGui(this.activeView);this.solvedView=new sc.QuestInfoBoxSolved;this.solvedView.setPos(0,80);this.addChildGui(this.solvedView);this.setQuest(null)},setQuest:function(a){if(a){this.activeView.hide(true);this.solvedView.hide(true);this.titleGui.setText(a.name);this.descriptionGui.setText(a.description);this.setLevel(a.level);this.setElite(a.elite,sc.quests.isQuestSolved(a.id));
this.locationText.setText(a.location.area+" - "+a.location.map);if(ig.langEdit){var b="Quest Name: "+a.name;ig.langEdit.submitCustomFile(b,a.name,"data/database.json");b="Quest Description: "+a.name;ig.langEdit.submitCustomFile(b,a.description,"data/database.json")}if(sc.quests.isQuestSolved(a.id)){this.currentTileOffset="solved";this.locationGui.color="#008277";this.solvedView.show(true);this.solvedView.endDescription.setText(a.endDescription);if(ig.langEdit){b="Quest End Description: "+a.name;ig.langEdit.submitCustomFile(b,
a.endDescription,"data/database.json")}}else{this.currentTileOffset=a.elite?"elite":"default";this.locationGui.color=a.elite?"#8d0000":"#545454";this.activeView.show(true);this.activeView.setTasks(a,sc.quests.getCurrentTask(a,true))}}else{this.currentTileOffset="default";this.locationGui.color="#545454";this.activeView.hide(true);this.solvedView.hide(true);this.locationText.setText("");this.titleGui.setText(ig.lang.get("sc.gui.menu.quests.noquest"));this.descriptionGui.setText("");this.setLevel(0);
this.setElite(false);this.currentTileOffset="default"}},show:function(){this.doStateTransition("DEFAULT")},hide:function(a){this.doStateTransition("HIDDEN",a)}});sc.QuestDialog=sc.QuestBaseBox.extend({gfx:new ig.Image("media/gui/menu.png"),transitions:{DEFAULT:{state:{},time:0.1,timeFunction:KEY_SPLINES.EASE_IN},HIDDEN:{state:{},time:0.2,timeFunction:KEY_SPLINES.LINEAR},SMALLER:{state:{scaleX:0.9,scaleY:0.9},time:0.1,timeFunction:KEY_SPLINES.EASE_OUT}},titleGui:null,descriptionGui:null,endDescriptionGui:null,
firstTaskGui:null,expGui:null,creditGui:null,cpGui:null,itemsGui:null,solvedGui:null,quest:null,init:function(a,b){this.parent(281,b?239:218);this.currentTileOffset=b?"dialog-solved":a.elite?"elite-darker":"dialog";this.quest=a;this.setLevel(this.quest.level);this.setElite(this.quest.elite,b);this.titleGui=new sc.TextGui(this.quest.name);this.titleGui.setAlign(ig.GUI_ALIGN.X_CENTER,ig.GUI_ALIGN.Y_TOP);this.titleGui.setPos(0,4);this.addChildGui(this.titleGui);this.descriptionGui=new sc.TextGui(this.quest.description,
{font:sc.fontsystem.smallFont,linePadding:0,maxWidth:254});this.descriptionGui.setPos(13,24);this.addChildGui(this.descriptionGui);var d=null;if(b){this.solvedGui=new sc.SolvedLine;this.solvedGui.setAlign(ig.GUI_ALIGN.X_CENTER,ig.GUI_ALIGN.Y_TOP);this.solvedGui.setSize(257,13);this.solvedGui.setPos(0,79);this.addChildGui(this.solvedGui);this.endDescriptionGui=new sc.TextGui(this.quest.endDescription,{font:sc.fontsystem.smallFont,linePadding:0,maxWidth:254});this.endDescriptionGui.setPos(13,95);this.addChildGui(this.endDescriptionGui)}else{d=
new ig.ColorGui(a.elite?"#8d0000":"#545454",257,1);d.setAlign(ig.GUI_ALIGN.X_CENTER,ig.GUI_ALIGN.Y_TOP);d.setPos(0,78);this.addChildGui(d);this.firstTaskGui=new sc.TaskEntry(0,a,false,true);this.firstTaskGui.setPos(13,83);this.addChildGui(this.firstTaskGui);this.firstTaskGui.doStateTransition("DEFAULT",true)}d=new ig.ImageGui(this.gfx,457,37,14,9);d.setPos(12,b?175:152);this.addChildGui(d);d=new ig.ColorGui(b?"#008277":a.elite?"#8d0000":"#545454",242,1);d.setPos(27,b?180:157);this.addChildGui(d);
d=a.hideRewards&&!b;this.expGui=new sc.TextGui("");this.creditGui=new sc.TextGui("");this.cpGui=new sc.TextGui("");this.addChildGui(this.expGui);this.addChildGui(this.creditGui);this.addChildGui(this.cpGui);this.itemsGui=new ig.GuiElementBase;this.itemsGui.setAlign(ig.GUI_ALIGN.X_RIGHT,ig.GUI_ALIGN.Y_TOP);this.itemsGui.setPos(11,b?181:158);this.itemsGui.setSize(146,48);this.addChildGui(this.itemsGui);this.setQuestRewards(a,d,b)},setQuest:function(a){this.quest=a||null;this.titleGui.setText(this.quest.name);
this.descriptionGui.setText(this.quest.description);this.firstTaskGui.setTask(0,this.quest,false,true);this.setElite(this.quest.elite,false);this.currentTileOffset=this.quest.elite?"elite-darker":"dialog";var b=this.quest.hideRewards;this.expGui.setText("");this.creditGui.setText("");this.cpGui.setText("");this.setQuestRewards(a,b,false)},setQuestRewards:function(a,d,f){var f=f?181:158,g=null;if(a.rewards.exp){var g="\\i[exp]",h=false;if(d)g=g+"????";else{h=sc.model.player.getRawExpGain(a.rewards.exp.exp,
a.level,sc.LEVEL_CURVES.QUEST);g=g+(h+"* ")+(a.rewards.exp.bonus?"+"+a.rewards.exp.bonus:"")}this.expGui.setText(g);this.expGui.setPos(31,f);f=f+14;if(!d&&!h){g=new sc.TextGui(ig.lang.get("sc.gui.menu.quests.atCurLvl"),{font:sc.fontsystem.tinyFont});g.setAlign(ig.GUI_ALIGN.X_LEFT,ig.GUI_ALIGN.Y_BOTTOM);g.setPos(32,4);this.addChildGui(g)}}if(a.rewards.money){d?this.creditGui.setText("\\i[credit]????????"):this.creditGui.setText("\\i[credit]"+(a.rewards.money||0));this.creditGui.setPos(31,f);f=f+14}if(a.rewards.cp){d?
this.cpGui.setText("\\i[cp]????????"):a.rewards.cp.amount==1?this.cpGui.setText("\\i[cp]"+b(a.rewards.cp.element)):this.cpGui.setText("\\i[cp]"+b(a.rewards.cp.element)+"x "+(a.rewards.cp.amount||0));this.cpGui.setPos(31,f)}this.itemsGui.removeAllChildren();if(a.rewards.items)for(var f=this.itemsGui,a=a.rewards.items,g=this.gfx,i=h=0;i<a.length;i++){var j=a[i].amount,k=sc.inventory.getItem(a[i].id),l="\\i["+(k.icon+sc.inventory.getRaritySuffix(k.rarity||0)||"item-default")+"]",l=d?l+"?????????????":
l+ig.LangLabel.getText(k.name);j>1&&(l=l+(" x "+j));j=0;k.type==sc.ITEMS_TYPES.EQUIP&&(j=k.level||0);l=new sc.TextGui(l);l.setPos(0,h);l.level=j;l.numberGfx=g;j>0&&!d&&l.setDrawCallback(function(a,b){sc.MenuHelper.drawLevel(this.level,a,b,this.numberGfx,k.isScalable)}.bind(l));f.addChildGui(l);h=h+17}}});sc.QuestDialogWrapper=ig.GuiElementBase.extend({transitions:{DEFAULT:{state:{},time:0.2,timeFunction:KEY_SPLINES.EASE_OUT},HIDDEN:{state:{alpha:0,scaleX:0.5,scaleY:0.5,angle:0.3},time:0.2,timeFunction:KEY_SPLINES.EASE_IN}},
screenInteract:null,buttonInteract:null,buttonGroup:null,callback:null,quest:null,questBox:null,buttons:null,acceptText:null,overlay:null,finished:false,firstQuest:null,subQuests:null,next:0,_characterName:null,_mapName:null,init:function(b,d,f,g,h){this.parent();this.hook.zIndex=90;this.hook.temporary=true;this.hook.size.x=ig.system.width;this.hook.size.y=ig.system.height;this.setPivot(this.hook.size.x/2,this.hook.size.y/2);this._characterName=g||null;this._mapName=h||null;this.firstQuest=b;this.finished=
f||false;this.callback=d;this.screenInteract=new sc.ScreenInteractEntry(this);this.questBox=new sc.QuestDialog(b,f);this.questBox.setAlign(ig.GUI_ALIGN.X_CENTER,ig.GUI_ALIGN.Y_CENTER);this.questBox.setPos(0,f?-11:-22);this.addChildGui(this.questBox);this.buttonInteract=new ig.ButtonInteractEntry;this.buttonGroup=new sc.ButtonGroup;this.buttonGroup.addPressCallback(this.onButtonPress.bind(this));this.buttonInteract.pushButtonGroup(this.buttonGroup);this.buttons=new sc.QuestStartDialogButtonBox(this.buttonGroup,
f,b.mandatory,b.parentQuest?true:false);this.buttons.setAlign(ig.GUI_ALIGN.X_CENTER,ig.GUI_ALIGN.Y_BOTTOM);this.buttons.setPos(0,f?24:25);this.addChildGui(this.buttons);if(!this.finished){this.overlay=new ig.GuiElementBase;this.overlay.setSize(281,218);this.overlay.hook.transitions={DEFAULT:{state:{},time:0.2,timeFunction:KEY_SPLINES.LINEAR},HIDDEN:{state:{alpha:0},time:0.2,timeFunction:KEY_SPLINES.LINEAR}};this.overlay.updateDrawables=function(a){this.questBox.ninepatch.drawComposite(a,281,218,this.questBox.elite?
"elite":"default","darker");this.questBox.elite&&a.addGfx(this.questBox.ninepatch.gfx,6,3,this.questBox.elite==1?608:624,0,16,16)}.bind(this);this.overlay.doStateTransition("HIDDEN",true);this.questBox.addChildGui(this.overlay);this.questBox.removeChildGui(this.questBox.levelGui);this.questBox.addChildGui(this.questBox.levelGui);this.acceptText=new sc.TextGui("\\c[3]"+ig.lang.get("sc.gui.menu.quests.accepted-large")+"\\c[0]");this.acceptText.hook.transitions={DEFAULT:{state:{scaleX:2,scaleY:2,angle:0.3},
time:0.2,timeFunction:KEY_SPLINES.LINEAR},WAIT:{state:{scaleX:2,scaleY:2,angle:0.3},time:0.1,timeFunction:KEY_SPLINES.EASE_IN},HIDDEN:{state:{alpha:0,scaleX:4,scaleY:4,angle:0.5},time:0.2,timeFunction:KEY_SPLINES.LINEAR},SMALLER:{state:{scaleX:1.8,scaleY:1.8,angle:0.3},time:0.1,timeFunction:KEY_SPLINES.EASE_OUT}};this.acceptText.setAlign(ig.GUI_ALIGN.X_CENTER,ig.GUI_ALIGN.Y_CENTER);this.acceptText.setPos(0,-22);this.acceptText.doStateTransition("HIDDEN",true);this.addChildGui(this.acceptText)}ig.interact.addEntry(this.buttonInteract);
f&&a.play(false,{startTime:0.1});this.doStateTransition("HIDDEN",true);this.doStateTransition("DEFAULT")},onDetach:function(){ig.interact.removeEntry(this.buttonInteract)},onButtonPress:function(a){if(this.finished){ig.interact.setBlockDelay(0.22);this._close(false)}else{ig.interact.setBlockDelay(1.4);if(a.data==1){sc.BUTTON_SOUND.quest_accept.play();this.acceptText.doStateTransition("DEFAULT",false,false,function(){this.acceptText.doStateTransition("SMALLER");this.overlay.doStateTransition("DEFAULT");
this.questBox.doStateTransition("SMALLER",false,false,function(){this.questBox.doStateTransition("DEFAULT");this.acceptText.doStateTransition("WAIT",false,false,function(){this._close(true)}.bind(this))}.bind(this))}.bind(this))}else a.data==2&&this._close(false)}},_close:function(a){a?this.doStateTransition("HIDDEN",false,false,function(){this.questBox.quest.elite&&!ig.vars.get("tutorials.questElite")&&ig.vars.set("tutorials.questElite",true);var a=sc.quests.activateStaticQuest(this.questBox.quest.id,
this._characterName,this._mapName);if(a){if(!this.subQuests)this.subQuests=sc.quests.getSubQuests(a.quest);if(this.subQuests&&this.next<this.subQuests.length){a=sc.quests.getStaticQuest(this.subQuests[this.next]);this.acceptText.doStateTransition("HIDDEN",true);this.overlay.doStateTransition("HIDDEN",true);this.questBox.setQuest(a);this.questBox.hook.pos.y=-11;this.buttons.hook.pos.y=24;this.buttons.setAcceptMode(this.buttonGroup);ig.interact.setBlockDelay(0.2);if(this.buttonInteract.mouseOverGui)this.buttonInteract.mouseOverGui=
null;this.doStateTransition("DEFAULT");this.next++}else{if(this.subQuests){for(var a=0,b=this.subQuests.length;b--;){sc.quests.updateTimeStamp(sc.quests.getStaticQuest(this.subQuests[b]),a);a=a+0.1}sc.quests.updateTimeStamp(this.firstQuest,a)}ig.interact.removeEntry(this.buttonInteract);this.callback&&this.callback(true,this.firstQuest)}}else{ig.interact.removeEntry(this.buttonInteract);this.callback&&this.callback(false,this.questBox.quest);ig.warn("Something went wrong!")}}.bind(this),a?0.3:0):
this.doStateTransition("HIDDEN",false,true,function(){ig.interact.removeEntry(this.buttonInteract);this.callback&&this.callback(false,this.questBox.quest)}.bind(this),a?0.3:0)}});ig.GUI.QuestSolvedDialog=sc.QuestDialogWrapper.extend({init:function(a){this.parent(a.quest,this.onCollectRewards.bind(this),true);ig.vars.set("tmp._questRewardsFinished",false)},onCollectRewards:function(){sc.quests.finishUpQuest(this.questBox.quest);ig.vars.set("tmp._questRewardsFinished",true)}});ig.GUI.QuestSolvedDialog._noGuiSave=
true;sc.QuestStartDialogButtonBox=ig.BoxGui.extend({transitions:{DEFAULT:{state:{},time:0.2,timeFunction:KEY_SPLINES.EASE},HIDDEN:{state:{alpha:0},time:0.2,timeFunction:KEY_SPLINES.LINEAR}},ninepatch:new ig.NinePatch("media/gui/menu.png",{width:8,height:8,left:8,top:8,right:8,bottom:8,offsets:{"default":{x:480,y:304}}}),acceptButton:null,declineButton:null,acceptMode:false,init:function(a,b,d,g){this.parent();this.setSize(142,b||d?25:45);g=b?g?ig.lang.get("sc.gui.menu.quests.collectSubQuest"):ig.lang.get("sc.gui.menu.quests.collect"):
ig.lang.get("sc.gui.menu.quests.accept");this.acceptButton=new sc.ButtonGui(g,136,true,sc.BUTTON_TYPE.ITEM);this.acceptButton.textChild.setAlign(ig.GUI_ALIGN.X_CENTER,ig.GUI_ALIGN.Y_CENTER);this.acceptButton.textChild.setPos(0,0);this.acceptButton.setPos(3,3);this.acceptButton.setData(1);this.addChildGui(this.acceptButton);this.declineButton=new sc.ButtonGui(ig.lang.get("sc.gui.menu.quests.decline"),136,true,sc.BUTTON_TYPE.ITEM);this.declineButton.textChild.setAlign(ig.GUI_ALIGN.X_CENTER,ig.GUI_ALIGN.Y_CENTER);
this.declineButton.textChild.setPos(0,0);this.declineButton.setPos(3,23);this.declineButton.setData(2);!b&&!d&&this.addChildGui(this.declineButton);a.addFocusGui(this.acceptButton,0,0);!b&&!d&&a.addFocusGui(this.declineButton,0,1)},setAcceptMode:function(a){a.unfocusCurrentButton();if(!this.acceptMode){this.removeChildGui(this.declineButton);a.removeFocusGui(0,1);ig.input.mouseGuiActive?a.setCurrentFocus(0,0):a.focusCurrentButton(0,0,true,true,true);this.hook.size.y=25;this.acceptMode=true}}})});
ig.baked=!0;
ig.module("game.feature.menu.gui.quests.quest-tab-list").requires("impact.feature.gui.gui","impact.feature.gui.base.basic-gui","game.feature.menu.gui.quests.quest-misc","game.feature.gui.base.text","game.feature.menu.gui.menu-misc","game.feature.menu.gui.list-boxes","game.feature.menu.gui.item.item-sort-menu").defines(function(){var b=[];sc.QuestListBox=ig.GuiElementBase.extend({gfx:new ig.Image("media/gui/menu.png"),list:null,bg:null,tabs:{active:null,solved:null,all:null},tabArray:[],tabContent:[],
buttongroup:null,tabGroup:[],submitSound:null,favSound:null,errorSound:null,_prevIndex:null,_prevPressed:null,_refocusFromCycle:-1,_lastCursorPos:[],_curElement:-1,init:function(){this.parent();this.setSize(264,262);this.setAlign(ig.GUI_ALIGN.X_RIGHT,ig.GUI_ALIGN.Y_TOP);this.setPivot(264,262);this.favSound=this.submitSound=sc.BUTTON_SOUND.submit;this.errorSound=sc.BUTTON_SOUND.denied;this.hook.transitions={DEFAULT:{state:{},time:0.2,timeFunction:KEY_SPLINES.LINEAR},HIDDEN:{state:{alpha:0,offsetX:-132},
time:0.2,timeFunction:KEY_SPLINES.LINEAR},HIDDEN_EASE:{state:{alpha:0,offsetX:-132},time:0.2,timeFunction:KEY_SPLINES.EASE}};this.tabGroup=new sc.ButtonGroup;this.tabGroup.addPressCallback(function(a){if(this._prevPressed!=a){this.submitSound.play();this._prevPressed=a;a.setPressed(true);this._resetButtons(a);this._rearrangeTabs();sc.menu.questLastButtonData=a.data;for(var b=this.tabArray.length;b--;)if(a==this.tabArray[b]){sc.menu.setQuestTab(b);break}sc.menu.setQuestInfo(null,true)}}.bind(this));
this.tabGroup.addSelectionCallback(function(){});this.tabGroup.setMouseFocusLostCallback(function(){});var a=new sc.MenuPanel;a.setSize(264,243);a.setPos(0,21);this.addChildGui(a);this.bg=new sc.MenuScanLines;this.bg.setPos(0,35);this.bg.setSize(262,223);this.addChildGui(this.bg);a=new ig.ImageGui(this.gfx,32,408,5,5);a.setPos(0,21);this.addChildGui(a);a=new ig.ColorGui("#FF6D00",259,1);a.setPos(5,21);this.addChildGui(a);a=new sc.TextGui(ig.lang.get("sc.gui.status-hud.lvl"),{font:sc.fontsystem.tinyFont});
a.setAlign(ig.GUI_ALIGN.X_RIGHT,ig.GUI_ALIGN.Y_TOP);a.setPos(7,-8);this.bg.addChildGui(a);this.tabs.active=this._createTabButton("active",0,sc.QUEST_LIST_TYPE.ACTIVE,"quest");this.tabs.solved=this._createTabButton("solved",1,sc.QUEST_LIST_TYPE.SOLVED,"quest-solve");this.tabs.all=this._createTabButton("all",2,sc.QUEST_LIST_TYPE.ALL,"quest-all");sc.menu.questLastButtonData=this.tabs.active.data;this.tabGroup.setCurrentFocus(0,0);this.tabs.active.setPressed(true);this._prevPressed=this.tabs.active;this._rearrangeTabs();
this.doStateTransition("HIDDEN",true)},setFavorite:function(){if(this._curElement&&sc.menu.questCurrentTab==0)if(this._curElement.data&&this._curElement.data.id!=void 0){this.favSound&&this.favSound.play();sc.quests.markQuest(this._curElement.data.quest.id);this._curElement.setText(this._makeName(this._curElement.data.quest))}else this.errorSound.play();else{this.submitSound.play();var a=ig.lang.get("sc.gui.menu.help-texts.quests.title-2")+"\n\n"+ig.lang.get("sc.gui.menu.help-texts.quests.text-2"),
a=new sc.CenterMsgBoxGui(a,{maxWidth:300,speed:ig.TextBlock.SPEED.IMMEDIATE},"black",0.9);a.hook.zIndex=15E4;a.hook.pauseGui=true;ig.gui.addGuiElement(a)}},addObservers:function(){sc.Model.addObserver(sc.menu,this)},removeObservers:function(){sc.Model.removeObserver(sc.menu,this)},show:function(){sc.menu.buttonInteract.addParallelGroup(this.tabGroup);ig.interact.setBlockDelay(0.2);var a=sc.menu.questLastButtonData;a&&this._createCacheList(a.type,true,ig.input.mouseGuiActive,true);this.doStateTransition("DEFAULT")},
hide:function(){sc.menu.buttonInteract.removeParallelGroup(this.tabGroup);this.list.deactivate();this.doStateTransition("HIDDEN")},getCurrentSortText:function(){var a=null,a=this.tabContent[sc.menu.questCurrentTab]?this.tabContent[sc.menu.questCurrentTab].sort||sc.QUEST_SORT_TYPE.ACCEPTED:sc.QUEST_SORT_TYPE.ACCEPTED,b="auto";switch(a){case sc.QUEST_SORT_TYPE.ACCEPTED:b="questAccepted";break;case sc.QUEST_SORT_TYPE.ORDER:b="auto";break;case sc.QUEST_SORT_TYPE.NAME:b="name";break;case sc.QUEST_SORT_TYPE.LEVEL:b=
"questLevel"}return ig.lang.get("sc.gui.menu.sort."+b)},isNonMouseMenuInput:function(){return sc.control.menuConfirm()||sc.control.rightDown()||sc.control.leftDown()||sc.control.downDown()||sc.control.upDown()||sc.control.menuCircleLeft()||sc.control.menuCircleRight()},onButtonTraversal:function(){var a=sc.menu.questCurrentTab,b=this.tabArray[a],c=-1;if(sc.control.menuCircleRight()||sc.control.rightPressed())c=1;else if(sc.control.menuCircleLeft()||sc.control.leftPressed())c=0;if(c>=0){this.submitSound.play();
b.setPressed(false);if(c==1){a++;a>=this.tabArray.length&&(a=0)}else{a--;a<0&&(a=this.tabArray.length-1)}this._prevPressed=b=this.tabArray[a];b.setPressed(true);sc.menu.setQuestInfo(null,true);this._resetButtons(b,true);this._rearrangeTabs();sc.menu.questLastButtonData=b.data;sc.menu.setQuestTab(a)}},modelChanged:function(a,b,c){if(a==sc.menu)if(b==sc.MENU_EVENT.QUEST_CHANGED_TAB)this._createCacheList(sc.menu.questLastButtonData.type,true,ig.input.mouseGuiActive,!ig.input.mouseGuiActive);else if(b==
sc.MENU_EVENT.QUEST_ENTER_DEAILS){sc.menu.buttonInteract.removeParallelGroup(this.tabGroup);this.doStateTransition("HIDDEN_EASE")}else if(b==sc.MENU_EVENT.QUEST_LEAVE_DEAILS){sc.menu.buttonInteract.addParallelGroup(this.tabGroup);this.doStateTransition("DEFAULT")}else b==sc.MENU_EVENT.SORT_LIST&&this._sortCacheList(c.data.sortType)},_sortCacheList:function(a){this.tabContent[sc.menu.questCurrentTab].sort=a;this._createListEntries(sc.menu.questLastButtonData.type,a);ig.input.mouseGuiActive?this.buttongroup.setRegainFocus():
this.buttongroup.regainCurrentFocus(false,true)},_createCacheList:function(a,b,c,e){b=b||false;c=c||false;e=e||false;if(this.tabContent[this._prevIndex]){this.list.deactivate();this.list.doStateTransition("HIDDEN",true)}var f=sc.menu.questCurrentTab,g=this.tabContent[f];if(g){this.list=g.list;this.buttongroup=g.buttongroup;this.list.activate();this.list.doStateTransition("DEFAULT",true);b&&(c?this.buttongroup.setRegainFocus():this.buttongroup.regainCurrentFocus(false,e))}else{g={buttongroup:null,
list:null,sort:sc.QUEST_SORT_TYPE.ACCEPTED};this.buttongroup=new sc.ButtonGroup;this.list=new sc.ButtonListBox(1,0,28);this.list.setPos(0,35);this.list.setSize(264,223);this.list.setButtonGroup(this.buttongroup);this.list.hook.transitions={DEFAULT:{state:{},time:0.2,timeFunction:KEY_SPLINES.LINEAR},HIDDEN:{state:{alpha:0},time:0.2,timeFunction:KEY_SPLINES.LINEAR}};this.addChildGui(this.list);this.buttongroup.isNonMouseMenuInput=this.isNonMouseMenuInput.bind(this);this.buttongroup.addSelectionCallback(function(a){if(a.data){this._curElement=
a;if(a.data.quest)sc.menu.setQuestInfo(a.data.quest);else{a.data instanceof Object||sc.menu.setInfoText(a.data);sc.menu.setQuestInfo(null,true)}}}.bind(this));this.buttongroup.setMouseFocusLostCallback(function(){this._curElement=null;sc.menu.setInfoText("",true);sc.menu.setQuestInfo(null,true)}.bind(this));this.buttongroup.addPressCallback(function(a){sc.menu.enterQuestDetails(a.data.quest)}.bind(this));this.buttongroup.onButtonTraversal=this.onButtonTraversal.bind(this);this._createListEntries(a);
g.buttongroup=this.buttongroup;g.list=this.list;this.list.activate();this.tabContent[f]=g;this._prevIndex=f}},_createListEntries:function(a,d){var c=null,e=c=null,f=null,g=0;this.buttongroup.clear();this.list.clear();for(var d=d||sc.QUEST_SORT_TYPE.ACCEPTED,h=sc.quests.getQuestList(a,d),i=b.length=0;i<h.length;i++)if(f=h[i]){c=this._makeName(f);if(f.parentQuest){e=(!sc.quests.isQuestSolved(f.parentQuest)||false)&&a==sc.QUEST_LIST_TYPE.SOLVED;c=new sc.ItemBoxButton(c,236-(e?0:22),25,f.level);g=e?0:
22;if(!e){e=new ig.ImageGui(this.gfx,541,208,14,15);e.setPos(-16,1);c.addChildGui(e)}c.setData({quest:f,id:i});d==sc.QUEST_SORT_TYPE.ORDER||d==sc.QUEST_SORT_TYPE.ACCEPTED?this.list.addButton(c,null,g):b.push(f)}else{c=new sc.ItemBoxButton(c,236,25,f.level);g=0;c.setData({quest:f,id:i});this.list.addButton(c,null,g)}}if(b.length>=1){i=b.length;for(h=this.list.getChildren().length;i--;){f=b[i];sc.quests.isQuestSolved(f.parentQuest);g=this._findParentIndex(f.parentQuest);if(g>=0){c=this._makeName(f);
c=new sc.ItemBoxButton(c,214,25,f.level);e=new ig.ImageGui(this.gfx,541,208,14,15);e.setPos(-16,1);c.addChildGui(e);c.setData({quest:f,id:this.list.getChildren().length});g==h-1?this.list.addButton(c,null,22):this.list.insertButton(c,g+1,null,null,null,true);c.hook.pos.x=22}}}},_findParentIndex:function(a){for(var b=this.list.getChildren(),c=b.length;c--;)if(b[c].gui.data.quest.id==a)return c;return-1},_createTabButton:function(a,b,c,e){a=new sc.ItemTabbedBox.TabButton(ig.lang.get("sc.gui.menu.quests.tabs."+
a),e,90);a.textChild.setPos(6,0);a.setPos(0,2);a.setData({type:c});this.addChildGui(a);this.tabGroup.addFocusGui(a,b,0);return this.tabArray[b]=a},_rearrangeTabs:function(){for(var a=9,b=null,c=0;c<this.tabArray.length;c++){b=this.tabArray[c];b.hook.pos.x=a;a=a+b.hook.size.x}},_resetButtons:function(a,b){for(var c=0;c<this.tabArray.length;c++){a!=this.tabArray[c]&&this.tabArray[c].setPressed(false);if(b)this.tabArray[c].focus=false}},_makeName:function(a){var b="",b=sc.quests.isMarkedQuest(a.id)?
"\\i[quest-fav]":sc.quests.isQuestSolved(a.id)?a.elite?"\\i[quest-elite-solve]":"\\i[quest-solve]":a.elite?"\\i[quest-elite]":"\\i[quest]";return b=b+a.name}})});ig.baked=!0;
ig.module("game.feature.npc.gui.npc-display-gui").requires("impact.feature.gui.gui").defines(function(){sc.NPCDisplayGui=ig.GuiElementBase.extend({transitions:{DEFAULT:{state:{},time:0.2,timeFunction:KEY_SPLINES.EASE_OUT},HIDDEN:{state:{alpha:0},time:0.2,timeFunction:KEY_SPLINES.EASE_IN}},npc:null,gameState:null,animSheet:null,size:{x:0,y:0},displayOffset:{x:0,y:0},hideBackground:false,entity:null,callback:null,skipIfLoaded:false,anim:"idle",effect:null,effectEntity:null,init:function(b,a,d,c,e){this.parent();
this.hook.invisibleUpdate=e||false;this.callback=c;this.anim=d||"idle";this.npc=new sc.Character(b);this.doStateTransition("HIDDEN",true);if(this.npc.loaded&&a)this.skipIfLoaded=true;this.npc.addLoadListener(this)},initGameState:function(){this.gameState=new ig.GameState;this.gameState.initEmpty(this.hook.size.x,this.hook.size.y);ig.game.pushState(this.gameState);this.entity=ig.game.spawnEntity(ig.ActorEntity,0,this.size.z,0,{});this.entity.setSize(this.size.x,this.size.y,this.size.z);this.entity.animSheet=
this.animSheet;this.entity.initAnimations();this.entity.setCurrentAnim(this.anim);this.callback&&this.callback(this);ig.game.popState()},playEffect:function(b,a,d){this.effect&&this.effect.clearCached();this.effect=new ig.EffectHandle({sheet:b,name:a});ig.game.pushState(this.gameState);if(this.entity)this.effectEntity=this.effect.spawnOnTarget(this.entity,d);ig.game.popState()},clearEffects:function(){this.entity&&this.entity.clearEntityAttached(function(b){return b instanceof ig.ENTITY.Effect}.bind(this))},
onDetach:function(){this.npc&&this.npc.decreaseRef();this.npc=null;this.animSheet&&this.animSheet.decreaseRef();this.animSheet=null;this.gameState&&this.gameState.clear();this.gameState=null;this.effect&&this.effect.clearCached()},onLoadableComplete:function(b,a){if(b&&this.npc)if(a==this.npc){var d=this.npc.data;Vec3.assign(this.size,d.size||{x:12,y:12,z:28});Vec2.assign(this.displayOffset,d.displayOffset||{x:0,y:0});if(d.displayOffset)this.hideBackground=d.displayOffset.hideBackground;this.setSize(this.size.x,
this.size.y+this.size.z);this.setPivot(this.hook.size.x/2,this.hook.size.y/2);this.animSheet=new ig.AnimationSheet(d.animSheet);this.animSheet.addLoadListener(this)}else if(a==this.animSheet){this.initGameState();this.doStateTransition("DEFAULT",this.skipIfLoaded)}},update:function(){this.gameState&&this.gameState.forceUpdate()},updateDrawables:function(b){this.gameState&&b.addGameStateDraw(this.gameState,0,0)}})});ig.baked=!0;
ig.module("game.feature.menu.gui.quests.quest-details").requires("impact.feature.gui.base.box","impact.feature.gui.gui","impact.feature.interact.button-interact","game.feature.interact.button-group","game.feature.menu.gui.quests.quest-entries","game.feature.menu.gui.quests.quest-misc","game.feature.npc.gui.npc-display-gui").defines(function(){function b(a){switch(a){case "ALL":return"\\i[element-neutral]\\i[element-heat]\\i[element-cold]\\i[element-shock]\\i[element-wave]";case "ALL_ELEMENTS":return"\\i[element-heat]\\i[element-cold]\\i[element-shock]\\i[element-wave]";
case "NEUTRAL":return"\\i[element-neutral]";case "HEAT":return"\\i[element-heat]";case "COLD":return"\\i[element-cold]";case "SHOCK":return"\\i[element-shock]";case "WAVE":return"\\i[element-wave]"}}sc.QuestDetailTasks=ig.BoxGui.extend({transitions:{DEFAULT:{state:{},time:0.2,timeFunction:KEY_SPLINES.EASE},HIDDEN:{state:{alpha:0,scaleX:0.2,scaleY:0.2},time:0.2,timeFunction:KEY_SPLINES.LINEAR}},ninepatch:new ig.NinePatch("media/gui/menu.png",{width:4,height:8,left:6,top:8,right:6,bottom:8,offsets:{"default":{x:472,
y:80},solved:{x:488,y:80},elite:{x:504,y:80}}}),container:null,content:null,init:function(){this.parent(270,186);this.setAlign(ig.GUI_ALIGN.X_RIGHT,ig.GUI_ALIGN.Y_BOTTOM);this.setPivot(270,186);this.setPos(1,1);this.annotation={content:{title:"sc.gui.menu.help.quest.titles.content",description:"sc.gui.menu.help.quest.description.content2"},offset:{x:-2,y:-2},size:{x:272,y:188},index:{x:1,y:1}};this.content=new ig.GuiElementBase;this.container=new sc.ScrollPane(sc.ScrollType.Y_ONLY);this.container.showTopBar=
false;this.container.showBottomBar=false;this.container.setSize(268,186);this.container.setPos(1,0);this.addChildGui(this.container);this.container.setContent(this.content)},scroll:function(a,b){this.container.scrollY(a,b,0.05)},show:function(a,b,c){var e=sc.quests.getCurrentTask(a,true)+1,f=null,g=this.content,h=5;if(!(g.hook.children.length>=1&&c)){g.removeAllChildren();for(c=0;c<e;c++){f=new sc.TaskEntry(c,a,false,true);f.doStateTransition("DEFAULT",true);f.setPos(4,h);h=h+(f.hook.size.y+5);ig.langEdit&&
ig.langEdit.submitCustomFile("Quest Task ["+(c+1)+"]: "+a.name,a.tasks[c].task,"data/database.json");g.addChildGui(f)}g.setSize(266,h);this.container.recalculateScrollBars(true);this.container.setScrollY(0,true)}this.doStateTransition("DEFAULT",!b)},hide:function(){this.doStateTransition("HIDDEN",true)}});sc.QuestDetailsSolved=ig.GuiElementBase.extend({transitions:{DEFAULT:{state:{},time:0.2,timeFunction:KEY_SPLINES.LINEAR},HIDDEN:{state:{alpha:0},time:0.2,timeFunction:KEY_SPLINES.LINEAR}},endDescription:null,
init:function(){this.parent();this.setSize(254,186);this.setAlign(ig.GUI_ALIGN.X_RIGHT,ig.GUI_ALIGN.Y_BOTTOM);this.setPos(11,1);var a=new sc.SolvedLine;a.setAlign(ig.GUI_ALIGN.X_CENTER,ig.GUI_ALIGN.Y_TOP);a.setPos(1,2);a.setSize(249,13);this.addChildGui(a);this.endDescription=new sc.TextGui("",{font:sc.fontsystem.smallFont,linePadding:0,maxWidth:254});this.endDescription.setAlign(ig.GUI_ALIGN.X_LEFT,ig.GUI_ALIGN.Y_TOP);this.endDescription.setPos(0,19);this.addChildGui(this.endDescription);this.hide()},
show:function(a){this.endDescription.setText(a.endDescription);this.doStateTransition("DEFAULT",true)},hide:function(){this.doStateTransition("HIDDEN",true)}});sc.QuestCharacterView=ig.BoxGui.extend({ninepatch:new ig.NinePatch("media/gui/menu.png",{width:2,height:2,left:5,top:5,right:5,bottom:5,offsets:{"default":{x:488,y:16},solved:{x:500,y:16},elite:{x:501,y:32}}}),display:null,container:null,hideBackground:false,transitions:{DEFAULT:{state:{},time:0.1,timeFunction:KEY_SPLINES.EASE},HIDDEN:{state:{alpha:0},
time:0.1,timeFunction:KEY_SPLINES.EASE}},init:function(){this.parent(31,42);this.container=new ig.GuiElementBase;this.container.setSize(31,42);this.container.setPos(1,1);this.addChildGui(this.container)},setCharacter:function(a,b){if(a){if(this.display){this.display.remove(true);this.display=null}if(a){this.display=new sc.NPCDisplayGui(a,true,null,this.centerNPC.bind(this));this.container.addChildGui(this.display);this.doStateTransition("DEFAULT",true)}}else{if(this.display){b?this.display.remove(true):
this.display.doStateTransition("HIDDEN",false,true);this.display=null}this.doStateTransition("HIDDEN",true)}},centerNPC:function(a){if(a.npc){this.hideBackground=a.hideBackground;a.setPos(this.container.hook.size.x/2-a.hook.size.x/2-1+a.displayOffset.x,this.container.hook.size.y/2-a.hook.size.y/2+a.displayOffset.y)}},updateDrawables:function(a){this.hideBackground||this.parent(a)}});sc.QuestDetailsView=sc.QuestBaseBox.extend({gfx:new ig.Image("media/gui/menu.png"),transitions:{DEFAULT:{state:{},time:0.2,
timeFunction:KEY_SPLINES.EASE},HIDDEN:{state:{alpha:0,scaleX:0.3},time:0.2,timeFunction:KEY_SPLINES.EASE}},titleGui:null,descriptionGui:null,locationArea:null,locationMap:null,personTextGui:null,personCharGui:null,expGui:null,moneyGui:null,cpGui:null,itemsGui:null,atCurLevelGui:null,activeView:null,solvedView:null,buttongroup:null,taskButton:null,taskSwitch:null,lines:[],currentQuest:null,submitSound:null,init:function(a){this.parent(453,265);this.setAlign(ig.GUI_ALIGN.X_CENTER,ig.GUI_ALIGN.Y_CENTER);
this.setPos(0,2);this.annotation=[];this.annotation[0]={content:{title:"sc.gui.menu.help.quest.titles.type",description:"sc.gui.menu.help.quest.description.type"},offset:{x:3,y:1},size:{x:21,y:19},index:{x:0,y:0}};this.annotation[1]={content:{title:"sc.gui.menu.help.quest.titles.level",description:"sc.gui.menu.help.quest.description.level"},offset:{x:428,y:1},size:{x:21,y:19},index:{x:1,y:0}};this.annotation[2]={content:{title:"sc.gui.menu.help.quest.titles.location",description:"sc.gui.menu.help.quest.description.location"},
offset:{x:3,y:23},size:{x:32,y:20},index:{x:0,y:1}};this.annotation[3]={content:{title:"sc.gui.menu.help.quest.titles.owner",description:"sc.gui.menu.help.quest.description.owner"},offset:{x:3,y:82},size:{x:32,y:20},index:{x:0,y:2}};this.annotation[4]={content:{title:"sc.gui.menu.help.quest.titles.rewards",description:"sc.gui.menu.help.quest.description.rewards"},offset:{x:3,y:142},size:{x:32,y:20},index:{x:0,y:3}};this.taskButton=a||null;this.submitSound=sc.BUTTON_SOUND.submit;this.buttongroup=new sc.ButtonGroup;
this.buttongroup.doButtonTraversal=this.doButtonTraversal.bind(this);this.titleGui=new sc.TextGui("");this.titleGui.setAlign(ig.GUI_ALIGN.X_CENTER,ig.GUI_ALIGN.Y_TOP);this.titleGui.setPos(0,4);this.addChildGui(this.titleGui);this.descriptionGui=new sc.TextGui("",{font:sc.fontsystem.smallFont,linePadding:0,maxWidth:254});this.descriptionGui.setAlign(ig.GUI_ALIGN.X_LEFT,ig.GUI_ALIGN.Y_TOP);this.descriptionGui.setPos(188,24);this.addChildGui(this.descriptionGui);this.personTextGui=new sc.TextGui("Ice Cream Dealer",
{font:sc.fontsystem.smallFont});this.personTextGui.setPos(20,102);this.addChildGui(this.personTextGui);this.atCurLevelGui=new sc.TextGui(ig.lang.get("sc.gui.menu.quests.atCurLvl"),{font:sc.fontsystem.tinyFont});this.atCurLevelGui.setAlign(ig.GUI_ALIGN.X_RIGHT,ig.GUI_ALIGN.Y_BOTTOM);this.atCurLevelGui.setPos(275,3);this.atCurLevelGui.hook.transitions={DEFAULT:{state:{},time:0.2,timeFunction:KEY_SPLINES.LINEAR},HIDDEN:{state:{alpha:0},time:0.2,timeFunction:KEY_SPLINES.LINEAR}};this.addChildGui(this.atCurLevelGui);
this.atCurLevelGui.doStateTransition("HIDDEN",true);a=160;this.expGui=new sc.TextGui("");this.expGui.setPos(20,a);this.addChildGui(this.expGui);a=a+16;this.moneyGui=new sc.TextGui("");this.moneyGui.setPos(20,a);this.addChildGui(this.moneyGui);a=a+16;this.cpGui=new sc.TextGui("");this.cpGui.setPos(20,a);this.addChildGui(this.cpGui);a=a+16;this.itemsGui=new ig.GuiElementBase;this.itemsGui.setPos(20,a);this.addChildGui(this.itemsGui);a=new ig.ImageGui(this.gfx,418,33,12,18);a.setPos(7,25);this.addChildGui(a);
a=new ig.ColorGui("#545454",155,1);a.setPos(20,39);this.addChildGui(a);this.lines.push(a);a=new ig.ImageGui(this.gfx,440,64,8,8);a.setPos(21,62);this.addChildGui(a);a=new ig.ImageGui(this.gfx,433,34,22,16);a.setPos(8,85);this.addChildGui(a);a=new ig.ColorGui("#545454",156,1);a.setPos(19,97);this.addChildGui(a);this.lines.push(a);a=new ig.ImageGui(this.gfx,457,37,14,10);a.setPos(8,148);this.addChildGui(a);a=new ig.ColorGui("#545454",152,1);a.setPos(23,154);this.addChildGui(a);this.lines.push(a);this.personCharGui=
new sc.QuestCharacterView;this.personCharGui.setPos(143,105);this.addChildGui(this.personCharGui);this.locationArea=new sc.TextGui("Rookie Harbor");this.locationArea.setPos(20,43);this.addChildGui(this.locationArea);this.locationMap=new sc.TextGui("Marketplace");this.locationMap.setPos(32,60);this.addChildGui(this.locationMap);this.solvedView=new sc.QuestDetailsSolved;this.addChildGui(this.solvedView);this.activeView=new sc.QuestDetailTasks;this.addChildGui(this.activeView);this.doStateTransition("HIDDEN",
true)},update:function(){if(!ig.interact.isBlocked()&&this.buttongroup.isActive()&&this.activeView.isVisible()){sc.control.menuScrollUp()?this.activeView.scroll(-20):sc.control.menuScrollDown()&&this.activeView.scroll(20);sc.control.downDown()?this.activeView.scroll(200*ig.system.tick):sc.control.upDown()&&this.activeView.scroll(-200*ig.system.tick)}},checkTaskSwitch:function(){this.submitSound&&this.submitSound.play();(this.taskSwitch=!this.taskSwitch)?this.activeView.show(this.currentQuest,false,
true):this.activeView.hide()},addObservers:function(){sc.Model.addObserver(sc.menu,this)},removeObservers:function(){sc.Model.removeObserver(sc.menu,this)},show:function(a){this.personCharGui.setCharacter(null,true);this.taskButton.setText("\\i[help2]"+ig.lang.get("sc.gui.menu.quests.tasks"));this._setQuest(a);sc.menu.pushBackCallback(this.onBackButtonPress.bind(this));sc.menu.buttonInteract.pushButtonGroup(this.buttongroup);sc.menu.updateHotkeys();ig.interact.setBlockDelay(0.2);this.doStateTransition("DEFAULT")},
hide:function(){this.currentQuest=null;this.taskSwitch=false;this.taskButton.setText("\\i[help2]"+ig.lang.get("sc.gui.menu.quests.fav"));this.taskButton.setActive(true);sc.menu.buttonInteract.removeButtonGroup(this.buttongroup);sc.menu.updateHotkeys();ig.interact.setBlockDelay(0.2);this.doStateTransition("HIDDEN",false,false,function(){this.personCharGui.setCharacter(null,true)}.bind(this))},_setQuest:function(a){this.currentQuest=a;this.titleGui.setText(a.name);this.descriptionGui.setText(a.description);
this.locationArea.setText(a.location.area);this.locationMap.setText(a.location.map);this.personCharGui.setCharacter(a.character);this.setLevel(a.level);var d=sc.quests.isQuestSolved(a.id),c=160,e=null;this.setElite(a.elite,d);var f=a.hideRewards&!d;this.personTextGui.setText(d?a.personAfter||a.person||"???":a.person||"???");this.activeView.content.removeAllChildren();if(d){this.currentTileOffset=this.personCharGui.currentTileOffset="solved";this.activeView.currentTileOffset="solved";for(e=this.lines.length;e--;)this.lines[e].color=
"#008277";this.taskButton.setActive(true)}else{if(a.elite){this.currentTileOffset=this.personCharGui.currentTileOffset="elite";this.activeView.currentTileOffset="elite"}else{this.currentTileOffset=this.personCharGui.currentTileOffset="default";this.activeView.currentTileOffset="default"}for(e=this.lines.length;e--;)this.lines[e].color=a.elite?"#8d0000":"#545454";this.taskButton.setActive(false)}if(f){if(a.rewards.exp){this.expGui.setText("\\i[exp]????");c=c+16}else this.expGui.setText("");this.atCurLevelGui.doStateTransition("HIDDEN");
if(a.rewards.money){this.moneyGui.setText("\\i[credit]????????");c=c+16}else this.moneyGui.setText("");if(a.rewards.cp){this.cpGui.setText("\\i[cp]????????");c=c+16}else this.cpGui.setText("")}else{if(a.rewards.exp){e="\\i[exp]"+(sc.model.player.getRawExpGain(a.rewards.exp.exp,a.level,sc.LEVEL_CURVES.QUEST)+"* ");e=e+(a.rewards.exp.bonus?"+"+a.rewards.exp.bonus:"");this.expGui.setText(e);this.expGui.hook.pos.y=c;c=c+16;this.atCurLevelGui.doStateTransition("DEFAULT",true)}else{this.expGui.setText("");
this.atCurLevelGui.doStateTransition("HIDDEN",true)}if(a.rewards.money){this.moneyGui.setText("\\i[credit]"+(a.rewards.money||0));this.moneyGui.hook.pos.y=c;c=c+16}else this.moneyGui.setText("");if(a.rewards.cp){a.rewards.cp.amount==1?this.cpGui.setText("\\i[cp]"+b(a.rewards.cp.element)):this.cpGui.setText("\\i[cp]"+b(a.rewards.cp.element)+"x "+(a.rewards.cp.amount||0));this.cpGui.hook.pos.y=c;c=c+16}else this.cpGui.setText("")}this.itemsGui.removeAllChildren();if(a.rewards.items){this.itemsGui.hook.pos.y=
c;for(var c=this.itemsGui,e=a.rewards.items,g=this.gfx,h=0,i=0;i<e.length;i++){var j=e[i].amount,k=sc.inventory.getItem(e[i].id),l="\\i["+(k.icon+sc.inventory.getRaritySuffix(k.rarity||0)||"item-default")+"]",l=f?l+"?????????????":l+ig.LangLabel.getText(k.name);j>1&&(l=l+(" x "+j));j=0;k.type==sc.ITEMS_TYPES.EQUIP&&(j=k.level||0);l=new sc.TextGui(l);l.setPos(0,h);l.level=j;l.numberGfx=g;j>0&&!f&&l.setDrawCallback(function(a,b){sc.MenuHelper.drawLevel(this.level,a,b,this.numberGfx,k.isScalable)}.bind(l));
c.addChildGui(l);h=h+17}}if(d){this.activeView.hide();this.solvedView.show(a)}else{this.solvedView.hide();this.activeView.show(a)}},doButtonTraversal:function(){sc.control.menuBack()&&this.buttongroup.invokeBackButton()},onBackButtonPress:function(){this.hide();sc.menu.popBackCallback();sc.menu.leaveQuestDetails()},modelChanged:function(a,b,c){a==sc.menu&&b==sc.MENU_EVENT.QUEST_ENTER_DEAILS&&this.show(c)}})});ig.baked=!0;
ig.module("game.feature.menu.gui.quests.quest-menu").requires("impact.feature.gui.gui","impact.feature.gui.base.basic-gui","game.feature.menu.gui.quests.quest-misc","game.feature.menu.gui.quests.quest-tab-list","game.feature.menu.gui.quests.quest-details").defines(function(){sc.QuestMenu=sc.BaseMenu.extend({hotkeyHelp:null,hotkeySort:null,hotkeyTask:null,helpGui:null,questInfoBox:null,questListBox:null,questDetailBox:null,sortMenu:null,init:function(){this.parent();this.hook.size.x=ig.system.width;
this.hook.size.y=ig.system.height;this.questInfoBox=new sc.QuestInfoBox;this.questInfoBox.setPos(8,29);this.questInfoBox.hook.transitions={DEFAULT:{state:{},time:0.2,timeFunction:KEY_SPLINES.EASE},HIDDEN:{state:{alpha:0,offsetX:-(this.questInfoBox.hook.size.x/2)},time:0.2,timeFunction:KEY_SPLINES.LINEAR},HIDDEN_EASE:{state:{alpha:0,offsetX:-(this.questInfoBox.hook.size.x/2)},time:0.2,timeFunction:KEY_SPLINES.EASE}};this.addChildGui(this.questInfoBox);this.questInfoBox.hide(true);this.questListBox=
new sc.QuestListBox;this.questListBox.setPos(8,29);this.addChildGui(this.questListBox);this.questListBox.doStateTransition("HIDDEN",true);this.hotkeyHelp=new sc.ButtonGui("\\i[help]"+ig.lang.get("sc.gui.menu.hotkeys.help"),void 0,true,sc.BUTTON_TYPE.SMALL);this.hotkeyHelp.keepMouseFocus=true;this.hotkeyHelp.hook.transitions={DEFAULT:{state:{},time:0.2,timeFunction:KEY_SPLINES.EASE},HIDDEN:{state:{offsetY:-this.hotkeyHelp.hook.size.y},time:0.2,timeFunction:KEY_SPLINES.LINEAR}};this.hotkeyHelp.onButtonPress=
this.onHelpButtonPressed.bind(this);this.hotkeySort=new sc.ButtonGui("\\i[help3]"+ig.lang.get("sc.gui.menu.item.sort-title"),void 0,true,sc.BUTTON_TYPE.SMALL);this.hotkeySort.keepMouseFocus=true;this.hotkeySort.hook.transitions={DEFAULT:{state:{},time:0.2,timeFunction:KEY_SPLINES.EASE},HIDDEN:{state:{offsetY:-this.hotkeySort.hook.size.y},time:0.2,timeFunction:KEY_SPLINES.LINEAR}};this.hotkeySort.onButtonPress=this.onSortButtonPress.bind(this);this.hotkeyTask=new sc.ButtonGui("\\i[help2]"+ig.lang.get("sc.gui.menu.quests.fav"),
void 0,true,sc.BUTTON_TYPE.SMALL);this.hotkeyTask.keepMouseFocus=true;this.hotkeyTask.submitSound=null;this.hotkeyTask.hook.transitions={DEFAULT:{state:{},time:0.2,timeFunction:KEY_SPLINES.EASE},HIDDEN:{state:{offsetY:-this.hotkeyTask.hook.size.y},time:0.2,timeFunction:KEY_SPLINES.EASE}};this.hotkeyTask.onButtonPress=function(){sc.menu.questDetailMode?this.questDetailBox.checkTaskSwitch():this.questListBox.setFavorite()}.bind(this);this.sortMenu=new sc.SortMenu(this.onExecuteSort.bind(this));this.sortMenu.addButton("questAccepted",
sc.QUEST_SORT_TYPE.ACCEPTED,0);this.sortMenu.addButton("auto",sc.QUEST_SORT_TYPE.ORDER,1);this.sortMenu.addButton("name",sc.QUEST_SORT_TYPE.NAME,2);this.sortMenu.addButton("questLevel",sc.QUEST_SORT_TYPE.LEVEL,3);this.questDetailBox=new sc.QuestDetailsView(this.hotkeyTask);this.addChildGui(this.questDetailBox);this.doStateTransition("DEFAULT")},addObservers:function(){sc.Model.addObserver(sc.menu,this);this.questListBox.addObservers();this.questDetailBox.addObservers()},removeObservers:function(){sc.Model.removeObserver(sc.menu,
this);this.questListBox.removeObservers();this.questDetailBox.removeObservers()},showMenu:function(){this.addObservers();sc.menu.pushBackCallback(this.onBackButtonPress.bind(this));sc.menu.moveLeaSprite(0,0,sc.MENU_LEA_STATE.HIDDEN);ig.interact.setBlockDelay(0.2);this._updateSortMenuButton(this.questListBox.getCurrentSortText());this.questInfoBox.show();this.questListBox.show();this.onAddHotkeys()},hideMenu:function(){this.removeObservers();sc.menu.moveLeaSprite(0,0,sc.MENU_LEA_STATE.LARGE);this.exitMenu()},
exitMenu:function(){sc.menu.buttonInteract.removeGlobalButton(this.hotkeyHelp);sc.menu.buttonInteract.removeGlobalButton(this.hotkeySort);sc.menu.buttonInteract.removeGlobalButton(this.hotkeyTask);this.questInfoBox.hide();this.questListBox.hide();this.questDetailBox.hide();this.helpGui=null;this.sortMenu.active&&this.sortMenu.hideSortMenu();ig.cleanCache()},onHotkeyHelpCheck:function(){return sc.control.menuHotkeyHelp()},onHelpButtonPressed:function(){sc.menu.removeHotkeys();this.createHelpGui();
ig.gui.addGuiElement(this.helpGui);this.helpGui.openMenu()},onHotkeySortCheck:function(){return sc.control.menuHotkeyHelp3()},onHotkeyTaskCheck:function(){return sc.control.menuHotkeyHelp2()},onSortButtonPress:function(){if(this.sortMenu.active)this.sortMenu.hideSortMenu();else{ig.gui.addGuiElement(this.sortMenu);this.sortMenu.showSortMenu(this.hotkeySort)}},onExecuteSort:function(b){if(b.data){this.sortMenu.hideSortMenu();sc.menu.sortList(b)}},createHelpGui:function(){if(!this.helpGui){this.helpGui=
new sc.HelpScreen(this,ig.lang.get("sc.gui.menu.help-texts.quests.title"),ig.lang.get("sc.gui.menu.help-texts.quests.pages"),function(){this.commitHotKeysToTopBar(true)}.bind(this),true);this.helpGui.hook.zIndex=15E4;this.helpGui.hook.pauseGui=true}},onAddHotkeys:function(b){sc.menu.buttonInteract.addGlobalButton(this.hotkeyHelp,this.onHotkeyHelpCheck.bind(this));sc.menu.buttonInteract.addGlobalButton(this.hotkeySort,this.onHotkeySortCheck.bind(this));sc.menu.buttonInteract.addGlobalButton(this.hotkeyTask,
this.onHotkeyTaskCheck.bind(this));this.commitHotKeysToTopBar(b)},commitHotKeysToTopBar:function(b){sc.menu.addHotkey(function(){return this.hotkeyTask}.bind(this));sc.menu.addHotkey(function(){return this.hotkeySort}.bind(this));sc.menu.addHotkey(function(){return this.hotkeyHelp}.bind(this));sc.menu.commitHotkeys(b)},onBackButtonPress:function(){sc.menu.popBackCallback();sc.menu.popMenu()},_updateSortMenuButton:function(b){var a="\\i[help3]"+ig.lang.get("sc.gui.menu.item.sort-title")+": ";this.hotkeySort.setText(a+
("\\c[3]"+b+"\\c[0]"));sc.menu.updateHotkeys()},modelChanged:function(b,a,d){if(b==sc.menu)if(a==sc.MENU_EVENT.QUEST_SET_INFO)this.questInfoBox.setQuest(sc.menu.questInfo);else if(a==sc.MENU_EVENT.QUEST_ENTER_DEAILS){this.hotkeySort.setActive(false);this.questInfoBox.doStateTransition("HIDDEN_EASE")}else if(a==sc.MENU_EVENT.QUEST_LEAVE_DEAILS){this.hotkeySort.setActive(true);ig.input.mouseGuiActive&&this.questInfoBox.setQuest(null);this.questInfoBox.doStateTransition("DEFAULT")}else if(a==sc.MENU_EVENT.QUEST_CHANGED_TAB){this.sortMenu.active&&
this.sortMenu.hideSortMenu();d!=sc.menu.questCurrentTab&&this._updateSortMenuButton(this.questListBox.getCurrentSortText())}else a==sc.MENU_EVENT.SORT_LIST&&this._updateSortMenuButton(d.text)}})});ig.baked=!0;
ig.module("game.feature.menu.gui.tab-box").requires("impact.feature.gui.gui","impact.feature.gui.base.basic-gui","game.feature.gui.base.text","game.feature.menu.gui.menu-misc","game.feature.menu.gui.list-boxes").defines(function(){sc.TabbedPane=ig.GuiElementBase.extend({gfx:new ig.Image("media/gui/menu.png"),transitions:{DEFAULT:{state:{},time:0.2,timeFunction:KEY_SPLINES.LINEAR},HIDDEN:{state:{alpha:0},time:0.2,timeFunction:KEY_SPLINES.LINEAR}},tabGroup:null,keys:[],tabs:{},tabArray:[],tabContent:[],
currentTabIndex:-1,currentContent:null,tabSelectionListener:null,tabPressListener:null,tabButtonCreationCallback:null,cacheContent:true,menuPanel:null,menuHighlight:null,_prevIndex:-1,_prevPressed:null,_refocusFromCycle:-1,_lastCursorPos:[],init:function(b){this.parent();this.cacheContent=b==void 0?true:b;this.menuPanel=new sc.MenuPanel;this.menuPanel.setSize(100,200);this.menuPanel.setPos(0,21);this.addChildGui(this.menuPanel);b=new ig.ImageGui(this.gfx,32,408,5,5);b.setPos(0,21);this.addChildGui(b);
this.menuHighlight=new ig.ColorGui("#FF6D00",95,1);this.menuHighlight.setPos(5,21);this.addChildGui(this.menuHighlight);this.setSize(100,200);this.tabGroup=new sc.ButtonGroup;this.tabGroup.addPressCallback(function(a){if(this._prevPressed!=a){a.setPressed(true);this._prevPressed=a;this.resetButtons(a);this.rearrangeTabs();this.onTabPressed(a,false)&&this.setTab(this.getButtonIndex(a))}else this.onTabPressed(a,true)}.bind(this));this.tabGroup.addSelectionCallback(function(a){this.onTabSelected(a)}.bind(this));
this.tabGroup.setMouseFocusLostCallback(function(){this.onTabMouseFocusLost()}.bind(this))},setSize:function(b,a){this.parent(b,a);this.menuHighlight.setSize(b-5,1)},setPanelSize:function(b,a){this.menuPanel.setSize(b,a)},addTab:function(b,a,d){d=this.onTabButtonCreation(b,a,d);if(!d)throw Error("Tab Button Creation failed for index: "+a);this.tabGroup.addFocusGui(d,a,0);this.tabArray[a]=d;this.tabs[b]=d;this.keys[a]=b;this.rearrangeTabs();if(this.tabArray.length==1){this.currentTabIndex=0;this.tabGroup.setCurrentFocus(0,
0);this.tabs[b].setPressed(true);this._prevPressed=this.tabs[b]}},setTab:function(b,a,d){if(a)this._prevIndex=-1;if(this._prevIndex!=b){if(!this.tabArray[b])throw Error("No such tab at index: "+b);if(this.currentTabIndex>=0&&this._prevIndex>=0)if(a=this.tabContent[this._prevIndex])this.onClearPrevContent(a,d);this.currentTabIndex=b;this.currentContent&&this.onClearCurrentContent&&this.onClearCurrentContent(this.currentContent);this.currentContent=null;a=this._prevIndex;this._prevIndex=this.currentTabIndex;
var c=this.tabContent[b];if(c){this.onSetCacheContent(c,b,d);this.onTabChanged(this.currentTabIndex,a,d)}else{this.currentContent=this.onContentCreation(b,d);if(this.cacheContent)this.tabContent[this.currentTabIndex]=this.currentContent;this.onTabChanged(this.currentTabIndex,a)}}},show:function(b){sc.menu.buttonInteract.addParallelGroup(this.tabGroup);b!=void 0&&this.setTab(b)},hide:function(){sc.menu.buttonInteract.removeParallelGroup(this.tabGroup)},rearrangeTabs:function(){for(var b=9,a=null,d=
0;d<this.tabArray.length;d++){a=this.tabArray[d];a.hook.pos.x=b;b=b+a.hook.size.x}},resetButtons:function(b,a){for(var d=0;d<this.tabArray.length;d++){b!=this.tabArray[d]&&this.tabArray[d].setPressed(false);if(a)this.tabArray[d].focus=false}},getCurrentTabButton:function(){return this.currentTabIndex<=-1?null:this.tabArray[this.currentTabIndex]},getCurrentTabKey:function(){return this.keys[this.currentTabIndex]},getButtonIndex:function(b){return this.tabArray.indexOf(b)},onTabSelected:function(){},
onTabPressed:function(){},onTabButtonCreation:function(){},onTabMouseFocusLost:function(){},onTabChanged:function(){},onClearPrevContent:function(){},onContentCreation:function(){},onSetCacheContent:function(){}});sc.ListTabbedPane=sc.TabbedPane.extend({currentList:null,currentGroup:null,listPadding:0,listPageSize:20,defaultSortType:0,containerHeightOffset:0,listPosOffset:0,listHeightOffset:0,bg:null,init:function(b,a){this.parent(b);this.defaultSortType=a||0;this.bg=new sc.MenuScanLines;this.bg.setPos(0,
35);this.bg.setSize(this.hook.size.x,223+this.containerHeightOffset);this.addChildGui(this.bg)},update:function(){if(this.currentGroup&&this.currentGroup.isActive()&&ig.input.mouseGuiActive)this.onButtonTraversal()},setSize:function(b,a){this.parent(b,a);this.bg&&this.bg.setSize(this.hook.size.x,223+this.containerHeightOffset)},show:function(){this.parent()},hide:function(){this.parent();this.currentList.deactivate()},onClearPrevContent:function(){if(this.currentList){this.currentList.deactivate();
this.currentList.doStateTransition("HIDDEN",true)}},onSetCacheContent:function(b,a,d){this.currentList=b.list;this.currentGroup=b.buttongroup;this.currentList.activate();this.currentList.doStateTransition("DEFAULT",true);ig.input.mouseGuiActive?this.currentGroup.setRegainFocus():this.currentGroup.regainCurrentFocus(false,d&&d.skipSounds)},onContentCreation:function(){var b={buttongroup:null,list:null,sort:this.onInitSortType()||sc.LORE_SORT_TYPE.ORDER};this.currentGroup=new sc.ButtonGroup;this.currentList=
new sc.ButtonListBox(1,this.listPadding,this.listPageSize);this.currentList.setPos(0,35+this.listPosOffset);this.currentList.setSize(this.hook.size.x,223+this.containerHeightOffset+this.listHeightOffset);this.currentList.setButtonGroup(this.currentGroup);this.currentList.hook.transitions={DEFAULT:{state:{},time:0.2,timeFunction:KEY_SPLINES.LINEAR},HIDDEN:{state:{alpha:0},time:0.2,timeFunction:KEY_SPLINES.LINEAR}};this.addChildGui(this.currentList);this.currentGroup.isNonMouseMenuInput=this.isNonMouseMenuInput.bind(this);
this.currentGroup.onButtonTraversal=this.onButtonTraversal.bind(this);this.currentGroup.addSelectionCallback(function(a){this.onListEntrySelected(a)}.bind(this));this.currentGroup.setMouseFocusLostCallback(function(){this.onListMouseFocusLost()}.bind(this));this.currentGroup.addPressCallback(function(a){this.onListEntryPressed(a)}.bind(this));this.onCreateListEntries(this.currentList,this.currentGroup,this.getCurrentTabButton().data.type,b.sort);b.buttongroup=this.currentGroup;b.list=this.currentList;
this.currentList.activate();return b},sort:function(b){var a=this.tabArray[this.currentTabIndex].data.type;this.tabContent[this.currentTabIndex].sort=b;this.onCreateListEntries(this.currentList,this.currentGroup,a,b);ig.input.mouseGuiActive?this.currentGroup.setRegainFocus():this.currentGroup.regainCurrentFocus(false,true)},isNonMouseMenuInput:function(){return sc.control.menuConfirm()||sc.control.downDown()||sc.control.upDown()},onButtonTraversal:function(){var b=-1;sc.control.menuCircleRight()?
b=1:sc.control.menuCircleLeft()&&(b=0);this.switchTab(b)},switchTab:function(b){var a=this.currentTabIndex,d=this.getCurrentTabButton();if(b>=0){d.setPressed(false);if(b==1){a++;a>=this.tabArray.length&&(a=0)}else{a--;a<0&&(a=this.tabArray.length-1)}this._prevPressed=d=this.tabArray[a];d.setPressed(true);b=this.onLeftRightPress(d,a,b);this.setTab(a,false,b);this.resetButtons(d,true);this.rearrangeTabs()}},onInitSortType:function(){return 0},onListEntryPressed:function(){},onListEntrySelected:function(){},
onListMouseFocusLost:function(){},onLeftRightPress:function(){},onCreateListEntries:function(){}})});ig.baked=!0;
ig.module("game.feature.msg.gui.msg-skip-hud").requires("impact.feature.gui.gui","game.feature.gui.base.boxes","game.feature.gui.base.text").defines(function(){sc.MsgSkipGui=ig.GuiElementBase.extend({transitions:{DEFAULT:{state:{alpha:1},time:0.2,timeFunction:KEY_SPLINES.LINEAR},HIDDEN:{state:{alpha:0,scaleY:0,scaleX:0},time:0.2,timeFunction:KEY_SPLINES.LINEAR}},text:null,box:null,personEntry:null,timer:0,init:function(){this.parent();this.text=new sc.TextGui("\\i[skip-cutscene]",{});this.box=new sc.SmallBlackBoxGui(this.text.hook.size.x+
4);this.text.setAlign(ig.GUI_ALIGN.X_CENTER,ig.GUI_ALIGN.Y_CENTER);this.text.setPos(1,0);this.hook.size.x=this.box.hook.size.x;this.hook.size.y=this.box.hook.size.y;this.hook.pivot.x=this.box.hook.pivot.x;this.hook.pivot.y=this.box.hook.pivot.y;this.addChildGui(this.box);this.addChildGui(this.text)},update:function(){this.timer=this.timer+ig.system.actualTick;var b=0.75+0.25*Math.sin(this.timer/0.5*2*Math.PI);this.box.hook.localAlpha=b;this.text.hook.localAlpha=b},hide:function(){this.doStateTransition("HIDDEN")},
show:function(){this.doStateTransition("DEFAULT")}})});ig.baked=!0;
ig.module("game.feature.msg.gui.side-message-hud").requires("impact.feature.gui.gui","game.feature.gui.base.boxes","game.feature.gui.base.text","game.feature.gui.base.slick-box","game.feature.msg.gui.msg-skip-hud").defines(function(){sc.SideMessageHudGui=ig.GuiElementBase.extend({sideLabel:null,pauseMaxY:0,pauseBoxes:[],visibleBoxes:[],timer:0,pauseMode:false,messageIndex:0,prePauseMsgState:null,contentGui:null,skipGui:null,quickPop:false,skipInteractEntry:null,transitions:{DEFAULT:{state:{},time:0.2,
timeFunction:KEY_SPLINES.EASE_OUT},HIDDEN:{state:{alpha:0},time:0.2,timeFunction:KEY_SPLINES.EASE_IN}},init:function(){this.parent();this.setSize(290,200);this.hook.align.y=ig.GUI_ALIGN.Y_BOTTOM;this.hook.zIndex=101;this.hook.pauseGui=true;this.contentGui=new sc.SideMessageContentGui;this.addChildGui(this.contentGui);this.setPos(0,3);this.skipGui=new sc.MsgSkipGui;this.addChildGui(this.skipGui);this.skipGui.doStateTransition("HIDDEN",true);this.skipGui.setAlign(ig.GUI_ALIGN.X_LEFT,ig.GUI_ALIGN.Y_BOTTOM);
this.skipInteractEntry=new sc.SkipInteractEntry(this,10);this.sideLabel=new sc.SideMessageLabelGui;this.addChildGui(this.sideLabel);this.sideLabel.doStateTransition("HIDDEN",true);sc.Model.addObserver(sc.model.message,this);sc.Model.addObserver(sc.model,this)},update:function(){if(!this.pauseMode&&this.hook.currentStateName=="DEFAULT")if(this.timer>0){this.timer=this.timer-ig.system.actualTick;this.timer<=0&&this.doMessageStep()}else if(this.timer<0){this.timer=this.timer+ig.system.actualTick;if(this.timer>=
0)this.visibleBoxes.length>0?this.popMessage():this.timer=0}this.pauseMode&&ig.canLeavePauseMenu&&(sc.control.scrollUp()?this.scrollMessages(-48):sc.control.scrollDown()&&this.scrollMessages(48))},doMessageStep:function(b){if(sc.model.message.hasStackedSideMessages())this.showNextSideMessage();else{if(b)this.quickPop=true;this.popMessage()}},updateBottomGap:function(){var b=3+sc.model.message.bottomGap;sc.model.isCutscene()&&(b=b+20);this.doPosTranstition(0,b,0.2,KEY_SPLINES.EASE_IN_OUT)},modelChanged:function(b,
a){if(b==sc.model.message)if(a==sc.MESSAGE_EVENT.NEW_SIDE_MESSAGE)this.timer<=0&&this.showNextSideMessage();else if(a==sc.MESSAGE_EVENT.CLEARED_SIDE_MESSAGE)for(;this.visibleBoxes.length>0;)this.popMessage();else if(a==sc.MESSAGE_EVENT.SIDE_MESSAGES_LOADED){this.restoreAfterLoad();this.restoreAfterPause(true);if(b.sideMessageStack.length>0||this.visibleBoxes.length>0)this.timer=2}else a==sc.MESSAGE_EVENT.BOTTOM_GAP_CHANGE&&this.updateBottomGap();else if(b==sc.model&&(a==sc.GAME_MODEL_MSG.STATE_CHANGED||
a==sc.GAME_MODEL_MSG.SUB_STATE_CHANGED)){this.updateBottomGap();var d=sc.model.isRunning()||sc.model.isPaused()&&!sc.arena.isSideMessagesBlocked();this.doStateTransition(d?"DEFAULT":"HIDDEN");this.visibleBoxes[this.visibleBoxes.length-1]&&!sc.model.isCutscene()&&sc.skipInteract.addEntry(this.skipInteractEntry);if(d&&!sc.model.isReset()){d=sc.model.isPaused();if(d!=this.pauseMode)(this.pauseMode=d)?this.fillMessagesOnPause():this.restoreAfterPause()}}},clearMessages:function(){for(;this.visibleBoxes.length>
0;)this.visibleBoxes.shift().remove();this.updateSkipGui();sc.skipInteract.removeEntry(this.skipInteractEntry);this.timer=0;this.quickPop=false},fillMessagesOnPause:function(){var b=this.visibleBoxes[this.visibleBoxes.length-1];b&&b.text.stop();for(var b=sc.model.message.sideMessages,a=0,d=this.visibleBoxes.length;d--;)a=a+(this.visibleBoxes[d].hook.size.y+3);for(d=Math.max(0,b.length-this.visibleBoxes.length);d--;){var c=b[d],e=new sc.SideMessageBoxGui;e.setContent(c.charExpression,c.message,true);
e.setPos(0,a);e.show();a=a+(e.hook.size.y+3);this.contentGui.addChildGui(e);this.pauseBoxes.push(e)}this.pauseMaxY=a-3;this.visibleBoxes.length<b.length&&this.sideLabel.doStateTransition("DEFAULT");for(d=0;d<this.visibleBoxes.length;++d)this.visibleBoxes[d].doStateTransition("DEFAULT");this.updateSkipGui()},restoreAfterLoad:function(){this.clearMessages();for(var b=sc.model.message.sideMessages,a=b.length-sc.model.message.displayedSideMessages;a<b.length;++a)this.pushMessageBottom(b[a],100,a<b.length-
1);this.contentGui.doScrollTransition(0,0,0.2,KEY_SPLINES.EASE_OUT)},restoreAfterPause:function(){this.sideLabel.doStateTransition("HIDDEN");this.contentGui.doScrollTransition(0,0,0.2,KEY_SPLINES.EASE_OUT);for(var b=this.pauseBoxes.length;b--;)this.pauseBoxes[b].remove(false);for(b=0;b<this.visibleBoxes.length-1;++b)this.visibleBoxes[b].doStateTransition("UPWARD");(b=this.visibleBoxes[this.visibleBoxes.length-1])&&b.text.resume();this.updateSkipGui()},scrollMessages:function(b){var a=this.contentGui.getDestScroll().y,
a=(a-b).limit(0,this.pauseMaxY-this.contentGui.hook.size.y);this.contentGui.doScrollTransition(0,a,0.2,KEY_SPLINES.EASE_OUT)},showNextSideMessage:function(){var b=sc.model.message.getNextSideMessage();this.timer=sc.getMessageTime(b.message);this.pushMessageBottom(b,100);sc.voiceActing.play(b.charExpression,b.message);this.quickPop=false;sc.model.message.displayedSideMessages=this.visibleBoxes.length},pushMessageBottom:function(b,a,d){var c=new sc.SideMessageBoxGui;c.setContent(b.charExpression,b.message,
d||false);d||c.setOnFinish(this.onMessageFinish.bind(this));sc.model.isCutscene()||sc.skipInteract.addEntry(this.skipInteractEntry);b=c.hook.size.y;this.contentGui.addChildGui(c);c.show();c.setPos(0,0);this.visibleBoxes.push(c);for(var d=this.visibleBoxes.length,e=b=0;d--;){c=this.visibleBoxes[d];if(!e&&d<this.visibleBoxes.length-1&&b+c.hook.size.y>a){e=d+1;b=Math.max(c.hook.pos.y,b-c.hook.size.y-3)}c.doPosTranstition(0,b,0.2,KEY_SPLINES.EASE_OUT);d<this.visibleBoxes.length-1&&c.doStateTransition("UPWARD");
e||(b=b+(c.hook.size.y+3))}if(e){for(d=e;d--;)this.visibleBoxes[d].remove(true);this.visibleBoxes.splice(0,e)}this.updateSkipGui();return true},isLastBlockFinished:function(){var b=this.visibleBoxes.length;return b==0?false:this.visibleBoxes[b-1].isFinished()},popMessage:function(){this.timer=this.quickPop?-0.2:-1;var b=this.visibleBoxes.shift();b.text.finish();b.remove();if(this.visibleBoxes.length==0){sc.skipInteract.removeEntry(this.skipInteractEntry);this.quickPop=false}sc.model.message.displayedSideMessages=
this.visibleBoxes.length},updateSkipGui:function(){var b=this.visibleBoxes[this.visibleBoxes.length-1];if(!this.pauseMode&&b&&b.isFinished()&&this.skipInteractEntry.isActive()){this.skipGui.setPos(b.hook.size.x+1,0);this.skipGui.show()}else this.skipGui.hide()},onMessageFinish:function(){this.updateSkipGui()},onSkipInteract:function(b){if(b==sc.SKIP_INTERACT_MSG.SKIPPED)(b=this.visibleBoxes[this.visibleBoxes.length-1])&&(b.isFinished()?this.doMessageStep(true):b.skip());this.updateSkipGui()}});sc.getMessageTime=
function(b){return Math.max(2,b.toString().length/20*1+1)};sc.SideMessageContentGui=ig.GuiElementBase.extend({init:function(){this.parent();this.setSize(264,180);this.hook.align.y=ig.GUI_ALIGN.Y_BOTTOM;this.hook.clip=true}});sc.SideMessageBoxGui=sc.SlickBoxRawGui.extend({text:null,face:null,beepSound:new ig.Sound("media/sound/hud/dialog-beep-2.ogg",1,0.02),transitions:{DEFAULT:{state:{},time:0.2,timeFunction:KEY_SPLINES.EASE_OUT},UPWARD:{state:{alpha:0.5},time:0.2,timeFunction:KEY_SPLINES.EASE_OUT},
HIDDEN:{state:{alpha:0.5,scaleX:1,scaleY:0,offsetX:0},time:0.2,timeFunction:KEY_SPLINES.EASE_OUT}},init:function(){this.parent(0,0,false);this.hook.align.y=ig.GUI_ALIGN.Y_BOTTOM;this.text=new sc.TextGui("",{maxWidth:202,speed:ig.TextBlock.SPEED.NORMAL});this.text.setAlign(ig.GUI_ALIGN.X_LEFT,ig.GUI_ALIGN.Y_CENTER);this.text.setPos(60,0);this.addChildGui(this.text);this.face=new sc.SideMessageFaceGui;this.addChildGui(this.face)},setContent:function(b,a,d){this.text.setText(a);d?this.text.finish():
this.text.setBeepSound(this.beepSound);a=this.text.hook.size.x;a=(a<101?101:202)+62;d=Math.max(42,this.text.hook.size.y+4);this.setSize(a,d);this.face.setFace(b,d)},setOnFinish:function(b){this.text.textBlock.onFinish=b},isFinished:function(){return this.text.textBlock.isFinished()},skip:function(){this.text.finish()},show:function(b){this.hook.pivot.y=b?0:this.hook.size.y;this.doStateTransition("HIDDEN",true);this.doStateTransition("DEFAULT")},remove:function(b){this.hook.pivot.y=b?0:this.hook.size.y;
this.doStateTransition("HIDDEN",false,true)}});sc.SideMessageFaceGui=ig.GuiElementBase.extend({charExpression:null,timer:0,transitions:{DEFAULT:{state:{scaleX:-1},time:0,timeFunction:KEY_SPLINES.EASE_OUT}},init:function(){this.parent();this.hook.size.x=56;this.hook.pivot.x=28;this.doStateTransition("DEFAULT",true)},setFace:function(b,a){this.charExpression=b;this.hook.size.y=a;this.timer=0},update:function(){this.timer=this.timer+ig.system.actualTick},updateDrawables:function(b){this.charExpression&&
sc.MsgGuiTools.drawPortrait(b,this.charExpression,this.timer,0,0,this.hook.size.x,this.hook.size.y)}});sc.SideMessageLabelGui=ig.GuiElementBase.extend({gfx:new ig.Image("media/gui/message.png"),transitions:{DEFAULT:{state:{},time:0.2,timeFunction:KEY_SPLINES.EASE_OUT},HIDDEN:{state:{alpha:0.5,scaleX:0},time:0.2,timeFunction:KEY_SPLINES.EASE_OUT}},iconText:null,currentIconDevice:null,init:function(){this.parent();this.setSize(24,180);this.hook.align.x=ig.GUI_ALIGN.X_RIGHT;this.hook.align.y=ig.GUI_ALIGN.Y_BOTTOM;
var b=new sc.SlickSmallSideGui(this.hook.size.y);this.addChildGui(b);b=new sc.SlickBigSideGui(70);b.setAlign(ig.GUI_ALIGN.X_RIGHT,ig.GUI_ALIGN.Y_CENTER);this.addChildGui(b);b=new ig.ImageGui(this.gfx,16,80,8,8);b.setAlign(ig.GUI_ALIGN.X_CENTER,ig.GUI_ALIGN.Y_CENTER);b.setPos(0,-19);this.addChildGui(b);b=new ig.ImageGui(this.gfx,16,88,8,8);b.setAlign(ig.GUI_ALIGN.X_CENTER,ig.GUI_ALIGN.Y_CENTER);b.setPos(0,19);this.addChildGui(b);this.iconText=new sc.TextGui("\\i[mousewheel]");this.currentIconDevice=
ig.INPUT_DEVICES.KEYBOARD_AND_MOUSE;this.iconText.setAlign(ig.GUI_ALIGN.X_CENTER,ig.GUI_ALIGN.Y_CENTER);this.addChildGui(this.iconText)},update:function(){if(this.currentIconDevice!=ig.input.currentDevice){this.currentIconDevice=ig.input.currentDevice;this.iconText.setText(this.currentIconDevice==ig.INPUT_DEVICES.GAMEPAD?"\\i[gamepad-l1]\n\\i[gamepad-r1]":"\\i[mousewheel]")}}})});ig.baked=!0;
ig.module("game.feature.combat.gui.enemy-display-gui").requires("impact.feature.gui.gui").defines(function(){sc.EnemyDisplayGui=ig.GuiElementBase.extend({transitions:{DEFAULT:{state:{},time:0.2,timeFunction:KEY_SPLINES.EASE_OUT},HIDDEN:{state:{alpha:0},time:0.2,timeFunction:KEY_SPLINES.EASE_IN}},enemy:null,gameState:null,entity:null,callback:null,skipIfLoaded:false,displayOffset:{x:0,y:0},anim:"idle",randomAnim:null,boosted:false,randomTimer:0,randomReset:0,init:function(b,a,d,c,e,f){this.parent();
this.callback=c;this.anim=d||"idle";this.boosted=f||false;if(this.randomAnim=e||null)this.randomTimer=5+Math.random()*10;this.enemy=new sc.EnemyType(b);this.doStateTransition("HIDDEN",true);if(this.enemy.loaded&&a)this.skipIfLoaded=true;this.enemy.addLoadListener(this);this.enemy.loaded&&this.callback&&this.callback(this)},onDetach:function(){this.enemy&&this.enemy.decreaseRef();this.enemy=null;this.gameState&&this.gameState.clear();this.gameState=null},onLoadableComplete:function(b,a){if(this.enemy)if(a==
this.enemy){var d=sc.combat.getEnemyMenuOffset(this.enemy.path);this.displayOffset.x=d?d.x:0;this.displayOffset.y=d?d.y:0;this.setSize(this.enemy.size.x,this.enemy.size.y+this.enemy.size.z);this.setPivot(this.hook.size.x/2,this.hook.size.y/2);this.enemy.animSheet.addLoadListener(this)}else if(a==this.enemy.animSheet){this.initGameState();this.doStateTransition("DEFAULT",this.skipIfLoaded)}},initGameState:function(){this.gameState=new ig.GameState;this.gameState.initEmpty(this.hook.size.x,this.hook.size.y);
ig.game.pushState(this.gameState);this.entity=ig.game.spawnEntity(ig.ActorEntity,0,this.enemy.size.z,0,{});this.boosted&&sc.combat.canShowBoosted(this.enemy)&&sc.combat.effects.combatant.spawnOnTarget("boostedMenu",this.entity,{align:"CENTER",group:"_boostedFX",duration:-1});this.entity.setSize(this.enemy.size.x,this.enemy.size.y,this.enemy.size.z);this.entity.animSheet=this.enemy.animSheet;this.entity.initAnimations();this.entity.setCurrentAnim(this.anim);this.callback&&this.callback(this);ig.game.popState()},
update:function(){if(this.gameState){this.gameState.forceUpdate();if(this.randomAnim&&this.randomTimer>0){this.randomTimer=this.randomTimer-ig.system.actualTick;if(this.randomTimer<=0)if(this.randomReset){this.randomReset=false;this.randomTimer=5+Math.random()*10;this.entity.setCurrentAnim(this.anim)}else{this.randomTimer=2;this.randomReset=true;this.entity.setCurrentAnim(this.randomAnim)}}}},updateDrawables:function(b){this.gameState&&b.addGameStateDraw(this.gameState,0,0)}})});ig.baked=!0;
ig.module("game.feature.menu.gui.enemies.enemy-pages").requires("impact.feature.gui.base.box","impact.feature.gui.gui","impact.feature.gui.base.basic-gui","game.feature.combat.gui.enemy-display-gui","game.feature.menu.gui.menu-misc","game.feature.gui.base.misc").defines(function(){ig.perf.fullEnemyFibula=false;var b=[1,1,1,1];sc.EnemyPageGeneralInfo=ig.GuiElementBase.extend({transitions:{DEFAULT:{state:{},time:0.2,timeFunction:KEY_SPLINES.LINEAR},HIDDEN:{state:{alpha:0},time:0.2,timeFunction:KEY_SPLINES.LINEAR}},
location:null,kills:null,display:null,baseHp:null,baseAttack:null,baseDefense:null,baseFocus:null,resistance:null,expMoney:null,drops:null,init:function(){this.parent();this.setSize(269,216);this.location=new sc.EnemyLocation;this.location.setPos(2,0);this.addChildGui(this.location);this.kills=new sc.EnemyKillCount;this.addChildGui(this.kills);this.display=new sc.EnemyDisplayBox;this.display.setPos(0,14);this.addChildGui(this.display);var a=15;this.baseHp=this.createStatusLine("maxhp",0,0,a);a=a+
14;this.baseAttack=this.createStatusLine("atk",1,0,a);a=a+14;this.baseDefense=this.createStatusLine("def",2,0,a);a=a+14;this.baseFocus=this.createStatusLine("foc",3,0,a);a=a+23;this.resistance=new sc.EnemyResistence;this.resistance.setPos(0,a);this.addChildGui(this.resistance);this.expMoney=new sc.EnemyExpMoney;this.expMoney.setPos(0,this.display.hook.size.y+3+14);this.addChildGui(this.expMoney);this.drops=new sc.EnemyDrops;this.addChildGui(this.drops);this.setData();this.annotation=[];this.annotation[0]=
{content:{title:"sc.gui.menu.help.enemy.titles.res",description:"sc.gui.menu.help.enemy.description.res"},offset:{x:-2,y:76},size:{x:121,y:63},index:{x:0,y:5}};this.annotation[1]={content:{title:"sc.gui.menu.help.enemy.titles.view",description:"sc.gui.menu.help.enemy.description.view"},offset:{x:121,y:13},size:{x:149,y:126},index:{x:1,y:1}};this.annotation[2]={content:{title:"sc.gui.menu.help.enemy.titles.rewards",description:"sc.gui.menu.help.enemy.description.rewards"},offset:{x:-2,y:142},size:{x:272,
y:73},index:{x:0,y:6}};this.doStateTransition("HIDDEN",true)},setData:function(a,d,f,g){if(d){this.display.setEnemy(a,true,d.anim,d.extra,g);var h=d.params,i=d.credit,j=d.level;if(g&&sc.combat.canShowBoostedEntry(a,d.boss)){j=ig.perf.fullEnemyFibula?sc.MIN_BOOSTER_LEVEL:d.boostedLevel||sc.MIN_BOOSTER_LEVEL;h=sc.EnemyLevelScaling.adaptParams(h,d.level,j);i=sc.EnemyLevelScaling.adaptCredits(i,d.level,j)}this.baseHp.setNumber(h.hp,f);this.baseAttack.setNumber(h.attack,f);this.baseDefense.setNumber(h.defense,
f);this.baseFocus.setNumber(h.focus,f);this.resistance.setResistance(h.elemFactor||b,f);this.expMoney.setValues(sc.model.player.getRawExpGain(d.exp||0,j,sc.LEVEL_CURVES.REGULAR),i||0,f);this.drops.setDrops(d.itemDrops,f,g);this.location.setLocation(d.area,f);this.kills.setKills(sc.stats.getMap("combat","kill"+a),f);this.baseHp.setScrambleNumbers(h.hp>9999999)}else{this.display.setEnemy();this.baseHp.hide();this.baseAttack.hide();this.baseDefense.hide();this.baseFocus.hide();this.resistance.hide();
this.expMoney.hide();this.drops.hide();this.location.hide();this.kills.hide()}},createStatusLine:function(a,b,d,g){var h=new sc.EnemyBaseParamLine(ig.lang.get("sc.gui.menu.equip."+a),b);h.setPos(d,g);h.annotation={type:"INFO",content:{title:"sc.gui.menu.equip."+a,description:"sc.gui.menu.help.enemy.description."+a},offset:{x:-1,y:-1},index:{x:0,y:b+1}};this.addChildGui(h);return h}});sc.EnemyPageMetaInfo=ig.GuiElementBase.extend({transitions:{DEFAULT:{state:{},time:0.2,timeFunction:KEY_SPLINES.LINEAR},
HIDDEN:{state:{alpha:0},time:0.2,timeFunction:KEY_SPLINES.LINEAR}},killMore:null,species:null,trivia:null,descriptions:null,content:null,init:function(){this.parent();this.setSize(269,216);this.killMore=new sc.TextGui("",{maxWidth:259});this.killMore.setAlign(ig.GUI_ALIGN.X_CENTER,ig.GUI_ALIGN.Y_CENTER);this.killMore.hook.transitions={DEFAULT:{state:{},time:0.2,timeFunction:KEY_SPLINES.LINEAR},HIDDEN:{state:{alpha:0},time:0.2,timeFunction:KEY_SPLINES.LINEAR}};this.killMore.doStateTransition("HIDDEN",
true);this.addChildGui(this.killMore);this.content=new ig.GuiElementBase;this.addChildGui(this.content);this.species=new sc.TextGui(ig.lang.get("sc.gui.menu.enemy.species"),{font:sc.fontsystem.smallFont});this.species.hook.transitions={DEFAULT:{state:{},time:0.2,timeFunction:KEY_SPLINES.LINEAR},HIDDEN:{state:{alpha:0},time:0.2,timeFunction:KEY_SPLINES.LINEAR}};this.species.setPos(2,0);this.addChildGui(this.species);this.trivia=new sc.TextGui(ig.lang.get("sc.gui.menu.enemy.trivia"),{font:sc.fontsystem.smallFont});
this.trivia.hook.transitions={DEFAULT:{state:{},time:0.2,timeFunction:KEY_SPLINES.LINEAR},HIDDEN:{state:{alpha:0},time:0.2,timeFunction:KEY_SPLINES.LINEAR}};this.trivia.setPos(2,15);this.addChildGui(this.trivia);this.descriptions=new ig.GuiElementBase;this.descriptions.setSize(265,186);this.descriptions.setPos(2,30);this.addChildGui(this.descriptions);this.setData();this.doStateTransition("HIDDEN",true)},setData:function(a,b){this.killMore.doStateTransition("HIDDEN",true);this.species.doStateTransition("HIDDEN",
true);this.trivia.doStateTransition("HIDDEN",true);this.descriptions.removeAllChildren();if(b){var d=b.boss?1:b.kills||sc.MIN_KILLS,g=sc.stats.getMap("combat","kill"+a)||0;if(ig.perf.fullEnemyFibula||g<=-1||g>=d){d=null;d=b.species?ig.LangLabel.getText(b.species,true):ig.lang.get("sc.gui.menu.enemy.unknown");this.species.setText(ig.lang.get("sc.gui.menu.enemy.species")+d);this.species.doStateTransition("DEFAULT",true);if((d=b.descriptions)&&d.length>=1){var g=new ig.VarCondition(""),h=null,i=0,j=
0,k={font:sc.fontsystem.smallFont,maxWidth:265},l=new ig.ColorGui("#C7C7C7",269,1);l.setPos(-2,i);this.descriptions.addChildGui(l);for(var i=i+1,o=0;o<d.length;o++){h=d[o];g.setCondition(h.condition||"");if(ig.perf.fullEnemyFibula||g.evaluate()){l=new sc.TextGui(ig.LangLabel.getText(h.text),k);l.setPos(0,i);this.descriptions.addChildGui(l);i=i+l.hook.size.y;j++;l=sc.combat.getEnemyName(a)+" Report #"+(o+1);ig.langEdit.submitCustomFile(l,new ig.LangLabel(h.text),"data/enemies/"+a.toPath("",".json"),
true)}}this.trivia.setText(ig.lang.get("sc.gui.menu.enemy.trivia"))}else this.trivia.setText(ig.lang.get("sc.gui.menu.enemy.trivia")+ig.lang.get("sc.gui.menu.enemy.noReports"));this.trivia.doStateTransition("DEFAULT",true)}else{h=ig.lang.get("sc.gui.menu.enemy.killMore");h=h.replace("[x]",d-g);h=h.replace("[y]",ig.LangLabel.getText(b.name)+"");this.killMore.setText(h);this.killMore.doStateTransition("DEFAULT",true)}}},getPercent:function(a,b){return Math.floor(a/b*100)}});sc.EnemyLocation=ig.GuiElementBase.extend({gfx:new ig.Image("media/gui/menu.png"),
transitions:{DEFAULT:{state:{},time:0.1,timeFunction:KEY_SPLINES.EASE},HIDDEN:{state:{alpha:0,offsetX:4},time:0.1,timeFunction:KEY_SPLINES.LINEAR}},location:null,image:null,init:function(){this.parent();this.setSize(269,20);this.location=new sc.TextGui("Location: Bergen Trail",{font:sc.fontsystem.smallFont});this.location.hook.transitions={DEFAULT:{state:{},time:0.1,timeFunction:KEY_SPLINES.LINEAR},HIDDEN:{state:{alpha:0,offsetX:4},time:0.2,timeFunction:KEY_SPLINES.LINEAR}};this.location.setPos(10,
0);this.addChildGui(this.location);this.image=new ig.ImageGui(this.gfx,481,224,8,11);this.image.hook.transitions={DEFAULT:{state:{},time:0.1,timeFunction:KEY_SPLINES.EASE},HIDDEN:{state:{alpha:0,scaleX:0,scaleY:0,angle:0.2},time:0.2,timeFunction:KEY_SPLINES.LINEAR}};this.image.setPivot(4,6);this.addChildGui(this.image);this.hide(true)},setLocation:function(a,b){var d=a?sc.map.getAreaName(a):null;this.location.setText(ig.lang.get("sc.gui.menu.enemy.location")+(d?d:"???"));this.location.doStateTransition("DEFAULT",
b);this.image.doStateTransition("DEFAULT",b)},hide:function(a){this.location.doStateTransition("HIDDEN",a);this.image.doStateTransition("HIDDEN",a)}});sc.EnemyBaseParamLine=ig.GuiElementBase.extend({gfx:new ig.Image("media/gui/menu.png"),transitions:{DEFAULT:{state:{},time:0.1,timeFunction:KEY_SPLINES.EASE},HIDDEN:{state:{alpha:0},time:0.1,timeFunction:KEY_SPLINES.EASE}},number:null,name:"Flowey",icon:0,init:function(a,b){this.parent();this.setSize(118,12);this.name=a||"Flowey";this.icon=b||0;var d=
new sc.TextGui(a,{font:sc.fontsystem.tinyFont});d.setPos(13,3);this.addChildGui(d);this.number=new sc.NumberGui(9999999,{transitionTime:0.15});this.number.setAlign(ig.GUI_ALIGN.X_RIGHT,ig.GUI_ALIGN.Y_TOP);this.number.setPos(0,4);this.addChildGui(this.number);this.doStateTransition("HIDDEN",true)},setNumber:function(a,b){this.hook.currentStateName=="HIDDEN"&&this.number.setNumber(0,true);this.doStateTransition("DEFAULT",true);this.number.setNumber(a||0,b)},setScrambleNumbers:function(a){this.number.scramble=
a},hide:function(){this.doStateTransition("HIDDEN",true)},updateDrawables:function(a){a.addGfx(this.gfx,0,0,520,48,118,11);a.addGfx(this.gfx,0,0,sc.MODIFIER_ICON_DRAW.X+this.icon*12,sc.MODIFIER_ICON_DRAW.Y,11,11)}});var a={D:0,C:1,B:2,A:3,S:4};sc.EnemyDrops=ig.GuiElementBase.extend({gfx:new ig.Image("media/gui/menu.png"),transitions:{DEFAULT:{state:{},time:0.2,timeFunction:KEY_SPLINES.LINEAR},HIDDEN:{state:{alpha:0},time:0.2,timeFunction:KEY_SPLINES.LINEAR}},container:null,prevChances:[],init:function(){this.parent();
this.setAlign(ig.GUI_ALIGN.X_LEFT,ig.GUI_ALIGN.Y_TOP);this.setSize(269,70);this.setPos(0,144);var a=new sc.TextGui(ig.lang.get("sc.gui.menu.enemy.drops"),{font:sc.fontsystem.tinyFont});a.setPos(2,0);this.addChildGui(a);a=new sc.TextGui(ig.lang.get("sc.gui.menu.enemy.rank"),{font:sc.fontsystem.tinyFont});a.setAlign(ig.GUI_ALIGN.X_RIGHT,ig.GUI_ALIGN.Y_TOP);a.setPos(1,0);this.addChildGui(a);a=new sc.TextGui(ig.lang.get("sc.gui.menu.enemy.chance"),{font:sc.fontsystem.tinyFont});a.setAlign(ig.GUI_ALIGN.X_RIGHT,
ig.GUI_ALIGN.Y_TOP);a.setPos(62,0);this.addChildGui(a);a=new ig.ColorGui("#CCCCCC",269,1);a.setPos(0,7);this.addChildGui(a);this.container=new ig.GuiElementBase;this.container.setSize(269,60);this.container.setPos(0,10);this.addChildGui(this.container)},setDrops:function(b,d,f){this.doStateTransition("DEFAULT",true);this.container.removeAllChildren();if(b)for(var g=null,h=null,g=g=g=null,i=0,j=0;j<4;j++)if(b[j]){if(!b[j].boosted||f){g=sc.inventory.getItem(b[j].item);h="\\i["+g.icon+sc.inventory.getRaritySuffix(g.rarity||
0)+"]";h=sc.stats.getMap("items",b[j].item)?h+ig.LangLabel.getText(g.name):h+"???????????????";g=new sc.TextGui(h);g.setPos(0,i-3);this.container.addChildGui(g);g=new sc.PercentNumber(100,{transitionTime:0.15});this.prevChances[j]&&g.setNumber(this.prevChances[j],true);g.setNumber(Math.round(b[j].prob*100),d);g.setAlign(ig.GUI_ALIGN.X_RIGHT,ig.GUI_ALIGN.Y_TOP);g.setPos(63,i+2);this.container.addChildGui(g);this.prevChances[j]=Math.round(b[j].prob*100);g=new ig.ImageGui(this.gfx,537+a[b[j].rank||"D"]*
15,34,14,12);g.setAlign(ig.GUI_ALIGN.X_RIGHT,ig.GUI_ALIGN.Y_TOP);g.setPos(1,i);this.container.addChildGui(g);i=i+15}}else this.prevChances[j]=0},hide:function(){for(var a=4;a--;)this.prevChances[a]=0;this.doStateTransition("HIDDEN",true)}});sc.EnemyKillCount=ig.GuiElementBase.extend({gfx:new ig.Image("media/gui/menu.png"),transitions:{DEFAULT:{state:{},time:0.2,timeFunction:KEY_SPLINES.LINEAR},HIDDEN:{state:{alpha:0},time:0.2,timeFunction:KEY_SPLINES.LINEAR}},count:null,image:null,special:null,init:function(){this.parent();
this.setAlign(ig.GUI_ALIGN.X_RIGHT,ig.GUI_ALIGN.Y_TOP);this.setSize(269,20);this.count=new sc.NumberGui(99999999,{size:sc.NUMBER_SIZE.SMALL,transitionTime:0.15});this.count.hook.transitions={DEFAULT:{state:{},time:0.1,timeFunction:KEY_SPLINES.LINEAR},HIDDEN:{state:{alpha:0,offsetX:4},time:0.2,timeFunction:KEY_SPLINES.LINEAR}};this.count.setAlign(ig.GUI_ALIGN.X_RIGHT,ig.GUI_ALIGN.Y_TOP);this.count.setPos(14,3);this.addChildGui(this.count);this.image=new ig.ImageGui(this.gfx,579,19,11,10);this.image.hook.transitions=
{DEFAULT:{state:{},time:0.1,timeFunction:KEY_SPLINES.EASE},HIDDEN:{state:{alpha:0,scaleX:0,scaleY:0,angle:-0.3},time:0.2,timeFunction:KEY_SPLINES.LINEAR}};this.image.setAlign(ig.GUI_ALIGN.X_RIGHT,ig.GUI_ALIGN.Y_TOP);this.image.setPos(1,2);this.addChildGui(this.image);this.special=new sc.TextGui(ig.lang.get("sc.gui.menu.enemy.special"),{font:sc.fontsystem.smallFont});this.special.hook.transitions={DEFAULT:{state:{},time:0.2,timeFunction:KEY_SPLINES.LINEAR},HIDDEN:{state:{alpha:0,offsetX:4},time:0.2,
timeFunction:KEY_SPLINES.LINEAR}};this.special.setAlign(ig.GUI_ALIGN.X_RIGHT,ig.GUI_ALIGN.Y_TOP);this.special.doStateTransition("HIDDEN",true);this.special.setPos(1,0);this.addChildGui(this.special);this.hide()},setKills:function(a,b){if(a<=-1){this.count.doStateTransition("HIDDEN",true);this.image.doStateTransition("HIDDEN",true);this.special.doStateTransition("DEFAULT")}else{if(this.count.isVisible())this.special.doStateTransition("HIDDEN");else{this.count.setNumber(0,true);this.special.doStateTransition("HIDDEN",
true)}this.count.setNumber(a||0,b);this.count.doStateTransition("DEFAULT",b);this.image.doStateTransition("DEFAULT",b)}},hide:function(){this.special.doStateTransition("HIDDEN");this.count.doStateTransition("HIDDEN");this.image.doStateTransition("HIDDEN")}});sc.EnemyExpMoney=ig.GuiElementBase.extend({gfx:new ig.Image("media/gui/menu.png"),transitions:{DEFAULT:{state:{},time:0.2,timeFunction:KEY_SPLINES.LINEAR},HIDDEN:{state:{alpha:0},time:0.2,timeFunction:KEY_SPLINES.LINEAR}},exp:null,money:null,
init:function(){this.parent();this.setAlign(ig.GUI_ALIGN.X_RIGHT,ig.GUI_ALIGN.Y_TOP);this.setSize(147,10);this.exp=new sc.NumberGui(9999999,{transitionTime:0.15});this.exp.setPos(15,1);this.addChildGui(this.exp);this.money=new sc.NumberGui(9999999,{transitionTime:0.15});this.money.setPos(89,1);this.addChildGui(this.money);this.hide()},setValues:function(a,b,d){this.doStateTransition("DEFAULT",true);this.exp.setNumber(a,d);this.money.setNumber(b,d)},hide:function(){this.exp.setNumber(0,true);this.money.setNumber(0,
true);this.doStateTransition("HIDDEN",true)},updateDrawables:function(a){a.addGfx(this.gfx,0,0,472,32,14,10);a.addGfx(this.gfx,75,0,488,32,12,10)}});var d={"0":{x:-2,y:42,x2:0,y2:46,x3:49,y3:29,width:49,down:true},1:{x:77,y:-1,x2:66,y2:7,x3:48,y3:7,width:47,right:true},2:{x:77,y:10,x2:77,y2:18,x3:60,y3:18,width:36,right:true},3:{x:-2,y:31,x2:0,y2:35,x3:38,y3:18,width:38,down:true}};sc.EnemyResistence=ig.GuiElementBase.extend({gfx:new ig.Image("media/gui/menu.png"),transitions:{DEFAULT:{state:{},time:0.2,
timeFunction:KEY_SPLINES.LINEAR},HIDDEN:{state:{alpha:0},time:0.2,timeFunction:KEY_SPLINES.LINEAR}},res:[],lines:[],images:[],init:function(){this.parent();this.setSize(118,51);var a=new sc.TextGui(ig.lang.get("sc.gui.menu.enemy.resistance"),{font:sc.fontsystem.tinyFont});a.setPos(0,0);this.addChildGui(a);for(a=0;a<4;a++){this.createNumber(a);this.createLine(a);this.createImage(a)}},setResistance:function(a,b){this.doStateTransition("DEFAULT",true);if(a)for(var d=this.res.length;d--;){var g=this.getValue(a[d]);
if(g){this.lines[d].show(b);this.res[d].setNumber(g,b);g<0?this.res[d].setColor(sc.GUI_NUMBER_COLOR.RED):this.res[d].setColor(sc.GUI_NUMBER_COLOR.WHITE);this.images[d].doStateTransition("DEFAULT",b)}else{this.lines[d].hide(b);this.res[d].setNumber(0,b);this.res[d].doStateTransition("HIDDEN",b);this.images[d].doStateTransition("HIDDEN",b)}}else for(d=this.res.length;d--;){this.res[d].hide();this.lines[d].hide(true)}},hide:function(){for(var a=this.res.length;a--;){this.res[a].hide();this.lines[a].hasLine=
true;this.lines[a].hide(true);this.images[a].doStateTransition("HIDDEN",true)}this.doStateTransition("HIDDEN",true)},createNumber:function(a){var b=new sc.PercentNumber(999,{signed:true,transitionTime:0.15});b.setPos(d[a].x,d[a].y);this.addChildGui(b);this.res[a]=b},createLine:function(a){var b=new sc.EnemyElementSlopeLine(a,d[a].width);b.setPos(d[a].x2,d[a].y2);this.addChildGui(b);this.lines[a]=b},createImage:function(a){var b=new ig.ImageGui(this.gfx,520+a*21,120,21,21);b.hook.transitions={DEFAULT:{state:{},
time:0.1,timeFunction:KEY_SPLINES.LINEAR},HIDDEN:{state:{alpha:0},time:0.2,timeFunction:KEY_SPLINES.LINEAR}};b.setPos(d[a].x3,d[a].y3);this.addChildGui(b);this.images[a]=b},getValue:function(a){return Math.round((a-1)*-100)},updateDrawables:function(a){a.addGfx(this.gfx,0,0,520,63,83,51)}});sc.EnemyElementSlopeLine=ig.GuiElementBase.extend({slope:null,line:null,hasLine:false,init:function(a,b){this.parent();this.setSize(b+5,5);this.slope=new sc.SlopeLine(5,d[a].right||false,d[a].down||false,sc.SlopeLine_Color.GREY);
this.addChildGui(this.slope);this.line=new ig.ColorGui("#C7C7C7",b,1);this.line.hook.transitions={DEFAULT:{state:{},time:0.1,timeFunction:KEY_SPLINES.LINEAR},HIDDEN:{state:{scaleX:0},time:0.1,timeFunction:KEY_SPLINES.LINEAR}};this.addChildGui(this.line);if(d[a].right){this.slope.setPos(0,5);this.line.setPos(5,0);this.line.setPivot(0,0)}else{this.slope.setPos(b+5,0);this.line.setPos(0,4);this.line.setPivot(b,0)}this.slope.hide();this.line.doStateTransition("HIDDEN",true)},show:function(a){if(!this.hasLine)if(a){this.slope.show(0);
this.line.doStateTransition("DEFAULT",true)}else{this.line.hook.currentStateName=="HIDDEN"&&this.line.hasTransition();this.slope.hide();this.slope.show(0.1);this.line.doStateTransition("HIDDEN",true);this.line.doStateTransition("DEFAULT",false,false,null,0.1);this.hasLine=true}},hide:function(a){if(this.hasLine){this.slope.hide(a?0:0.1,a?0:0.1);this.line.doStateTransition("HIDDEN",a);this.hasLine=false}}});sc.EnemyDisplayBox=ig.BoxGui.extend({display:null,container:null,transitions:{DEFAULT:{state:{},
time:0.1,timeFunction:KEY_SPLINES.EASE},HIDDEN:{state:{alpha:0},time:0.1,timeFunction:KEY_SPLINES.EASE}},ninepatch:new ig.NinePatch("media/gui/menu.png",{width:8,height:6,left:4,top:4,right:4,bottom:4,offsets:{"default":{x:520,y:33}}}),init:function(){this.parent(147,111);this.setAlign(ig.GUI_ALIGN.X_RIGHT,ig.GUI_ALIGN.Y_TOP);this.container=new ig.GuiElementBase;this.container.hook.clip=true;this.container.setSize(145,109);this.container.setPos(1,1);this.addChildGui(this.container)},setEnemy:function(a,
b,d,g,h){if(a){if(this.display){this.display.remove(true);this.display=null}if(a){this.display=new sc.EnemyDisplayGui(a,true,d,this.centerEnemy.bind(this),g,h);this.container.addChildGui(this.display);this.doStateTransition("DEFAULT",true)}}else{this.display&&(b?this.display.remove(true):this.display.doStateTransition("HIDDEN",false,true));this.doStateTransition("HIDDEN",true)}},centerEnemy:function(a){a.enemy&&a.setPos(this.container.hook.size.x/2-a.hook.size.x/2+a.displayOffset.x,this.container.hook.size.y/
2-a.hook.size.y/2+a.displayOffset.y)}})});ig.baked=!0;
ig.module("game.feature.menu.gui.social.social-misc").requires("impact.feature.gui.base.box","impact.feature.gui.gui","impact.feature.gui.base.basic-gui","game.feature.menu.gui.menu-misc","game.feature.menu.gui.item.item-status-default","game.feature.msg.gui.side-message-hud","game.feature.menu.gui.enemies.enemy-pages").defines(function(){var b=[],a=[];sc.SocialInfoBox=ig.BoxGui.extend({ninepatch:new ig.NinePatch("media/gui/menu.png",{width:12,height:4,left:6,top:6,right:6,bottom:6,offsets:{"default":{x:512,
y:440}}}),noEntry:null,base:null,clazz:null,name:null,baseHp:null,baseAttack:null,baseDefense:null,baseFocus:null,equip:null,content:null,init:function(){this.parent(281,129);this.hook.transitions={DEFAULT:{state:{},time:0.2,timeFunction:KEY_SPLINES.LINEAR},HIDDEN:{state:{alpha:0,offsetX:-(this.hook.size.x/2)},time:0.2,timeFunction:KEY_SPLINES.LINEAR}};this.base=new sc.SocialBaseInfoBox;this.base.setPos(3,3);this.addChildGui(this.base);this.noEntry=new sc.TextGui(ig.lang.get("sc.gui.menu.social.noMember"));
this.noEntry.hook.transitions={DEFAULT:{state:{},time:0.2,timeFunction:KEY_SPLINES.LINEAR},HIDDEN:{state:{alpha:0},time:0.2,timeFunction:KEY_SPLINES.LINEAR}};this.noEntry.setAlign(ig.GUI_ALIGN.X_CENTER,ig.GUI_ALIGN.Y_CENTER);this.noEntry.setPos(0,3);this.addChildGui(this.noEntry);this.noEntry.doStateTransition("HIDDEN",true);this.content=new ig.GuiElementBase;this.content.hook.transitions={DEFAULT:{state:{},time:0.2,timeFunction:KEY_SPLINES.LINEAR},HIDDEN:{state:{alpha:0},time:0.2,timeFunction:KEY_SPLINES.LINEAR}};
this.content.setPos(3,39);this.content.setSize(275,98);this.addChildGui(this.content);var a=new ig.ColorGui("#545454",275,1);a.setPos(0,0);this.content.addChildGui(a);a=new sc.TextGui(ig.lang.get("sc.gui.menu.social.class"),{font:sc.fontsystem.tinyFont});a.setPos(3,3);this.content.addChildGui(a);var b=a.hook.size.x,a=new sc.TextGui(ig.lang.get("sc.gui.menu.social.name"),{font:sc.fontsystem.tinyFont});a.setPos(3,18);this.content.addChildGui(a);b=Math.max(a.hook.size.x,b)+6;this.clazz=new sc.TextGui("Ultra Lord");
this.clazz.setPos(b,0);this.content.addChildGui(this.clazz);this.name=new sc.TextGui("Ultra Lord");this.name.setPos(b,15);this.content.addChildGui(this.name);b=3;a=32;this.baseHp=this.createStatusLine("maxhp",0,b,a);a=a+14;this.baseAttack=this.createStatusLine("atk",1,b,a);a=a+14;this.baseDefense=this.createStatusLine("def",2,b,a);this.baseFocus=this.createStatusLine("foc",3,b,a+14);a=new sc.TextGui(ig.lang.get("sc.gui.menu.social.equipment"),{font:sc.fontsystem.tinyFont});a.setPos(139,3);this.content.addChildGui(a);
a=new ig.ColorGui("#545454",137,1);a.setAlign(ig.GUI_ALIGN.X_RIGHT,ig.GUI_ALIGN.Y_TOP);a.setPos(0,11);this.content.addChildGui(a);this.equip=new ig.GuiElementBase;this.equip.setAlign(ig.GUI_ALIGN.X_RIGHT,ig.GUI_ALIGN.Y_TOP);this.equip.setSize(136,72);this.equip.setPos(1,13);this.content.addChildGui(this.equip);this.equip.annotation={content:{title:"sc.gui.menu.help.social.titles.equip",description:"sc.gui.menu.help.social.description.equip"},offset:{x:0,y:0},size:{x:136,y:72},index:{x:1,y:0}}},show:function(){this.doStateTransition("DEFAULT")},
hide:function(){this.doStateTransition("HIDDEN")},setCharacter:function(a){if(a){var b=sc.party.models[a];this.base.show(a,b);this.clazz.setText(ig.lang.get("sc.gui.menu.social.classes."+b.clazz));this.name.setText(ig.LangLabel.getText(b.character.data.realname));this.baseHp.setNumber(b.params.getStat("hp"),true);this.baseAttack.setNumber(b.params.getStat("attack"),true);this.baseDefense.setNumber(b.params.getStat("defense"),true);this.baseFocus.setNumber(b.params.getStat("focus"),true);this.equip.removeAllChildren();
var a=b.equip,b=-3,e;for(e in a)b=this.createEquipEntry(a[e],b,e);this.content.doStateTransition("DEFAULT",true);this.noEntry.doStateTransition("HIDDEN",true)}else{this.base.hide(true);this.content.doStateTransition("HIDDEN",true);this.noEntry.doStateTransition("DEFAULT",true)}},createEquipEntry:function(a,b,e){var f=null,g=null,g=null;if(f=a<0?null:sc.inventory.getItem(a)){g="\\i["+f.icon+sc.inventory.getRaritySuffix(f.rarity||0)+"]";g=g+ig.LangLabel.getText(f.name)}else g="\\i["+this.getBodyPartIcon(e)+
"]-----------------";a=sc.inventory.getItemLevel(a);g=new sc.TextGui(g);g.setPos(0,b);g.level=a;g.numberGfx=this.ninepatch.gfx;g.setDrawCallback(function(a,b){sc.MenuHelper.drawLevel(this.level,a,b,this.numberGfx,f&&f.isScalable)}.bind(g));this.equip.addChildGui(g);return b+15},getBodyPartIcon:function(a){switch(a){case "head":return"item-helm";case "leftArm":return"item-sword";case "rightArm":return"item-sword";case "torso":return"item-belt";case "feet":return"item-shoe"}},createStatusLine:function(a,
b,e,f){var g=new sc.EnemyBaseParamLine(ig.lang.get("sc.gui.menu.equip."+a),b);g.setPos(e,f);g.annotation={content:{title:"sc.gui.menu.equip."+a,description:"sc.gui.menu.equip.descriptions."+a},offset:{x:-1,y:-1},index:{x:0,y:b}};this.content.addChildGui(g);return g}});sc.SocialPartyBox=ig.GuiElementBase.extend({lea:null,members:[],init:function(){this.parent("blue");this.setSize(281,120);this.setPos(8,29)},updatePartyMembers:function(){var d=3+this.members[0].hook.size.y;b.length=0;a.length=0;for(var c=
1;c<this.members.length;c++){var e=this.members[c];if(sc.party.isPartyMember(e.name)){a.push(e.name);e.doPosTranstition(0,d,0.2);d=d+(e.hook.size.y+3)}else{b.push(c);e.doStateTransition("SCALE",false,true)}}for(c=b.length;c--;)this.members.splice(b[c],1);d=35*this.members.length+3*this.members.length+9;e=sc.party.currentParty;for(c=0;c<e.length;c++){var f=sc.party.models[e[c]];if(a.indexOf(e[c])==-1&&!f.temporary){f=new sc.SocialPartyMember(false,sc.party.models[e[c]],e[c]);f.setPos(0,d);f.show();
d=d+(f.hook.size.y+3);this.addChildGui(f);this.members.push(f)}}this.members[0]&&this.members[0].isLea&&this.members[0].currentValue.setNumber(sc.party.currentParty.length+1,true)},show:function(a){for(var b=this.members.length;b--;)a&&b>=1?this.members[b].hide(true):this.members[b].remove();var e=this.members.length=0,f=new sc.SocialPartyMember(true,sc.model.player);this.addChildGui(f);this.members.push(f);e=e+(f.hook.size.y+3);f.show(a);a=sc.party.currentParty;for(b=0;b<a.length;b++)if(!sc.party.models[a[b]].temporary){f=
new sc.SocialPartyMember(false,sc.party.models[a[b]],a[b]);f.setPos(0,e);f.show();e=e+(f.hook.size.y+3);this.addChildGui(f);this.members.push(f)}},hide:function(a){for(var b=this.members.length;b--;)this.members[b].hide(a)}});sc.SocialPartyMember=sc.MenuPanel.extend({gfx:new ig.Image("media/gui/basic.png"),headerPatch:new ig.NinePatch("media/gui/menu.png",{width:2,height:0,left:1,top:9,right:5,bottom:0,offsets:{"default":{x:96,y:408}}}),info:null,name:null,isLea:false,init:function(a,b,e){this.parent(sc.MenuPanelType.TOP_RIGHT_EDGE);
this.setSize(281,a?44:35);this.setPivot(0,0);this.isLea=a||false;this.name=e||null;this.hook.transitions={DEFAULT:{state:{},time:0.2,timeFunction:KEY_SPLINES.LINEAR},HIDDEN:{state:{alpha:0,offsetX:-(this.hook.size.x/2)},time:0.2,timeFunction:KEY_SPLINES.LINEAR},SCALE:{state:{alpha:0,scaleY:0},time:0.2,timeFunction:KEY_SPLINES.LINEAR}};if(a){e=new sc.TextGui(ig.lang.get("sc.gui.menu.social.party"),{font:sc.fontsystem.tinyFont,speed:ig.TextBlock.SPEED.IMMEDIATE});e.setPos(2,1);this.addChildGui(e);e=
{size:sc.NUMBER_SIZE.TINY,color:sc.GUI_NUMBER_COLOR.GREY};this.maxValue=new sc.NumberGui(4,e);this.maxValue.setAlign(ig.GUI_ALIGN.X_RIGHT,ig.GUI_ALIGN.Y_TOP);this.maxValue.setPos(6,2);this.maxValue.setNumber(sc.PARTY_MAX_MEMBERS+1);this.addChildGui(this.maxValue);this.currentValue=new sc.NumberGui(4,e);this.currentValue.setAlign(ig.GUI_ALIGN.X_RIGHT,ig.GUI_ALIGN.Y_TOP);this.currentValue.setPos(20,2);this.currentValue.setNumber(sc.party.currentParty.length+1);this.addChildGui(this.currentValue);e=
new ig.ImageGui(this.gfx,208,18,5,5);e.setAlign(ig.GUI_ALIGN.X_RIGHT,ig.GUI_ALIGN.Y_TOP);e.setPos(14,2);this.addChildGui(e)}this.info=new sc.SocialBaseInfoBox;this.info.setPos(3,a?9:0);this.info.show("PARTY_MEMBER",b);this.addChildGui(this.info);this.doStateTransition("HIDDEN",true)},show:function(a){this.doStateTransition("DEFAULT",a)},hide:function(a){this.doStateTransition("HIDDEN",false,a)},updateDrawables:function(a){this.parent(a);this.isLea&&this.headerPatch.draw(a,this.hook.size.x,9,"default");
a.addColor("#FFF",1,this.isLea?9:0,1,this.hook.size.y-(this.isLea?9:0))}});sc.SocialBaseInfoBox=ig.GuiElementBase.extend({transitions:{DEFAULT:{state:{},time:0.2,timeFunction:KEY_SPLINES.LINEAR},HIDDEN:{state:{alpha:0},time:0.2,timeFunction:KEY_SPLINES.LINEAR}},face:null,level:null,name:null,exp:null,hp:null,sp:null,init:function(){this.parent();this.setSize(275,35);var a=new sc.TextGui("LVL",{font:sc.fontsystem.tinyFont});a.setPos(53,18);this.addChildGui(a);this.face=new sc.SocialFace;this.addChildGui(this.face);
this.name=new sc.TextGui;this.name.setPos(53,0);this.addChildGui(this.name);this.level=new sc.NumberGui(99,{size:sc.NUMBER_SIZE.LARGE});this.level.setPos(68,19);this.addChildGui(this.level);this.exp=new sc.ItemStatusDefaultBar("EXP",sc.MENU_BAR_TYPE.EXP,null,93,0,-1);this.exp.setPos(92,19);this.addChildGui(this.exp);this.hp=new sc.ItemStatusDefaultBar("HP",sc.MENU_BAR_TYPE.HP,null,95,0,-1);this.hp.setAlign(ig.GUI_ALIGN.X_RIGHT,ig.GUI_ALIGN.Y_TOP);this.hp.setPos(-2,3);this.addChildGui(this.hp);this.sp=
new sc.ItemStatusDefaultBar("SP",sc.MENU_BAR_TYPE.SP,null,95,3,-1);this.sp.setAlign(ig.GUI_ALIGN.X_RIGHT,ig.GUI_ALIGN.Y_TOP);this.sp.setPos(-2,19);this.addChildGui(this.sp)},show:function(a,b){this.face.setCharacter(b.defaultExpression);this.name.setText(b.getCharacterName());this.level.setNumber(b.level||1);this.exp.updateValues(true,b);this.hp.updateValues(true,b);this.sp.updateValues(true,b);this.doStateTransition("DEFAULT",true)},hide:function(a){this.doStateTransition("HIDDEN",a)}});sc.SocialFace=
ig.GuiElementBase.extend({charExpression:null,transitions:{DEFAULT:{state:{scaleX:-1},time:0.2,timeFunction:KEY_SPLINES.LINEAR}},init:function(){this.parent();this.setSize(52,35);this.setPos(2,0);this.setPivot(26,0);this.doStateTransition("DEFAULT",true)},setCharacter:function(a){this.charExpression=a},updateDrawables:function(a){this.charExpression&&sc.MsgGuiTools.drawPortrait(a,this.charExpression,0,4,0,this.hook.size.x-2,this.hook.size.y)}});sc.SocialEntryButton=sc.ListBoxButton.extend({gfx2:new ig.Image("media/gui/menu.png"),
head:null,status:null,level:null,key:null,init:function(a,b){this.parent(this.getMemberName(a,b),187,73);this.blockedSound=this.button.submitSound=null;this.button.textChild.setPos(34,0);this.key=a;var e=sc.party.isPartyMember(a)?0:sc.party.contacts[a].online?1:2;this.head=new sc.SocialHead(b.getHeadIdx());this.head.setPos(7,1);this.head.active=e==0;this.addChildGui(this.head);this.level=new sc.NumberGui(99);this.level.setAlign(ig.GUI_ALIGN.X_RIGHT,ig.GUI_ALIGN.Y_TOP);this.level.setPos(5,7);this.level.setNumber(b.level||
1);this.addChildGui(this.level);this.status=new ig.ImageGui(this.gfx2,512,416+e*8,38,7);this.status.setAlign(ig.GUI_ALIGN.X_RIGHT,ig.GUI_ALIGN.Y_TOP);this.status.setPos(30,7);this.addChildGui(this.status)},focusGained:function(){this.parent();this.head.focus=true},focusLost:function(){this.parent();this.head.focus=false},updateMemberStatus:function(){var a=sc.party.isPartyMember(this.key)?0:sc.party.contacts[this.key].online?1:2;this.status.offsetY=416+a*8;this.head.active=a==0},keepButtonPressed:function(){this.keepPressed=
true;this.setPressed(true);this.button.keepPressed=true;this.button.setPressed(true);this.head.keepPressed=true},unPressButton:function(){this.keepPressed=false;this.setPressed(false);this.button.keepPressed=false;this.button.setPressed(false);this.head.keepPressed=false},getMemberName:function(a,b){return b.getCharacterName()||a}});sc.SocialHead=ig.GuiElementBase.extend({gfx:new ig.Image("media/gui/menu.png"),headsGfx:new ig.Image("media/gui/severed-heads.png"),index:0,active:false,focus:false,keepPressed:false,
init:function(a){this.parent();this.setSize(24,17);this.index=a},updateDrawables:function(a){a.addGfx(this.gfx,0,0,512,457,24,17);a.addGfx(this.headsGfx,0,0,this.index*24,7,24,17);this.active&&a.addGfx(this.gfx,0,0,512,this.focus||this.keepPressed?493:475,24,17)}})});ig.baked=!0;
ig.module("game.feature.menu.gui.quest-hub.quest-hub-misc").requires("impact.feature.gui.base.box","impact.feature.gui.gui","impact.feature.interact.button-interact","game.feature.gui.base.text","game.feature.menu.gui.menu-misc","game.feature.menu.gui.list-boxes","game.feature.menu.gui.tab-box","game.feature.menu.gui.social.social-misc","game.feature.interact.button-group","game.feature.menu.gui.quests.quest-entries").defines(function(){sc.QuestHubAvailable=sc.MenuPanel.extend({gfx:new ig.Image("media/gui/menu.png"),
transitions:{DEFAULT:{state:{},time:0.2,timeFunction:KEY_SPLINES.LINEAR},HIDDEN:{state:{alpha:0,offsetX:220},time:0.2,timeFunction:KEY_SPLINES.LINEAR}},text:null,number:null,init:function(){this.parent(sc.MenuPanelType.BOTTOM_LEFT_EDGE);this.setAlign(ig.GUI_ALIGN.X_LEFT,ig.GUI_ALIGN.Y_BOTTOM);this.setSize(200,23);this.setPos(66,28);if(!this.constructor.PATTERN)this.constructor.PATTERN=this.gfx.createPattern(512,184,16,4,ig.ImagePattern.OPT.REPEAT_X);this.text=new sc.TextGui(ig.lang.get("sc.gui.menu.questHub.available"));
this.text.setAlign(ig.GUI_ALIGN.X_LEFT,ig.GUI_ALIGN.Y_CENTER);this.text.setPos(5,0);this.addChildGui(this.text);this.number=new sc.NumberGui(999,{size:sc.NUMBER_SIZE.TEXT});this.number.setAlign(ig.GUI_ALIGN.X_RIGHT,ig.GUI_ALIGN.Y_CENTER);this.number.setPos(5,1);this.addChildGui(this.number);this.annotation={content:{title:"sc.gui.menu.help.hub.titles.available",description:"sc.gui.menu.help.hub.description.available"},offset:{x:0,y:0},size:{x:"dyn",y:"dyn"},index:{x:0,y:0}};this.doStateTransition("HIDDEN",
true)},show:function(){var a=ig.database.get("questHubs")[sc.menu.questHubID];if(!a)throw Error("Quest HUB ID not found: "+sc.menu.questHubID);var a=a.areas,b=sc.quests.staticQuests,c=new ig.VarCondition,e=0,f;for(f in b){var g=b[f];if(g.hubSettings&&!g.noTrack)for(var h=0;h<a.length;h++)if(g.area==a[h]&&!sc.quests.isQuestActive(f)&&!sc.quests.isQuestSolved(f)&&(!g.extension||ig.extensions.hasExtension(g.extension)))if(g.hubSettings.condition){c.setCondition(g.hubSettings.condition);c.evaluate()&&
e++}else e++}this.number.setMaxNumber(e);this.number.setNumber(e,true);this.doStateTransition("DEFAULT")},hide:function(){this.doStateTransition("HIDDEN")},updateDrawables:function(a){this.parent(a);var b=this.text.hook.size.x+this.text.hook.pos.x+1,c=this.hook.size.x-this.text.hook.size.x-this.number.hook.size.x-10,c=Math.floor(c/4)*4;a.addPattern(this.constructor.PATTERN,b,14,0,0,c,4)}});var b={total:0,solved:0};sc.QuestHubCompletion=sc.MenuPanel.extend({gfx:new ig.Image("media/gui/menu.png"),transitions:{DEFAULT:{state:{},
time:0.2,timeFunction:KEY_SPLINES.LINEAR},HIDDEN:{state:{alpha:0,offsetX:-220},time:0.2,timeFunction:KEY_SPLINES.LINEAR}},text:null,percent:null,init:function(){this.parent(sc.MenuPanelType.BOTTOM_RIGHT_EDGE);this.setAlign(ig.GUI_ALIGN.X_RIGHT,ig.GUI_ALIGN.Y_BOTTOM);this.setSize(200,23);this.setPos(66,28);if(!this.constructor.PATTERN)this.constructor.PATTERN=this.gfx.createPattern(512,184,16,4,ig.ImagePattern.OPT.REPEAT_X);this.text=new sc.TextGui(ig.lang.get("sc.gui.menu.questHub.completion"));this.text.setAlign(ig.GUI_ALIGN.X_LEFT,
ig.GUI_ALIGN.Y_CENTER);this.text.setPos(5,0);this.addChildGui(this.text);this.percent=new sc.StatPercentNumber(null,{size:sc.NUMBER_SIZE.TEXT,leadingZeros:1,scramble:false});this.percent.setAlign(ig.GUI_ALIGN.X_RIGHT,ig.GUI_ALIGN.Y_CENTER);this.percent.setPos(5,1);this.addChildGui(this.percent);this.annotation={content:{title:"sc.gui.menu.help.hub.titles.rate",description:"sc.gui.menu.help.hub.description.rate"},offset:{x:0,y:0},size:{x:"dyn",y:"dyn"},index:{x:1,y:0}};this.doStateTransition("HIDDEN",
true)},show:function(){var a=ig.database.get("questHubs")[sc.menu.questHubID];if(!a)throw Error("Quest HUB ID not found: "+sc.menu.questHubID);for(var a=a.areas,d=0,c=a.length,e=0;c--;){sc.quests.getTotalHubQuestsSolved(a[c],b);if(b.total!=0){e++;d=d+b.solved/b.total}}d=d/e;this.percent.setNumber(d,true);d>=1&&this.percent.setColor(sc.GUI_NUMBER_COLOR.ORANGE);this.doStateTransition("DEFAULT")},hide:function(){this.doStateTransition("HIDDEN")},updateDrawables:function(a){this.parent(a);var b=this.text.hook.size.x+
this.text.hook.pos.x+1,c=this.hook.size.x-this.text.hook.size.x-this.percent.hook.size.x-10,c=Math.floor(c/4)*4;a.addPattern(this.constructor.PATTERN,b,14,0,0,c,4)}});sc.QuestHubListEntry=ig.FocusGui.extend({transitions:{DEFAULT:{state:{},time:0.2,timeFunction:KEY_SPLINES.LINEAR},HIDDEN:{state:{alpha:0},time:0.2,timeFunction:KEY_SPLINES.LINEAR}},gfx:new ig.Image("media/gui/menu.png"),ninepatch:new ig.NinePatch("media/gui/buttons.png",{width:28,height:10,left:8,top:15,right:8,bottom:15,offsets:{"default":{x:0,
y:114},focus:{x:45,y:114},hdefault:{x:170,y:50},hfocus:{x:213,y:50}}}),character:null,questTitle:null,questLocation:null,levelContent:null,level:null,areaContent:null,area:null,rewards:null,init:function(a,b){this.parent();this.setSize(433,50);var c=sc.quests.getStaticQuest(a),e=c.hubSettings;this.character=new sc.QuestHubCharacterView;this.character.setPos(6,3);this.character.setCharacter(e.hideChar&&b==sc.MENU_QUEST_HUB_TABS.OPEN?"misc.blank":e.character);this.addChildGui(this.character);this.questTitle=
new sc.TextGui(c.name);this.questTitle.setPos(40,1);this.addChildGui(this.questTitle);this.questLocation=new sc.TextGui(e.location,{font:sc.fontsystem.smallFont,maxWidth:238});this.questLocation.setPos(52,18);this.addChildGui(this.questLocation);this.levelContent=new ig.ColorGui("000");this.levelContent.setAlign(ig.GUI_ALIGN.X_RIGHT,ig.GUI_ALIGN.Y_TOP);this.levelContent.setSize(37,13);this.levelContent.setPos(6,3);this.levelContent.hook.localAlpha=0.5;this.addChildGui(this.levelContent);e=new sc.TextGui("LvL",
{font:sc.fontsystem.tinyFont});e.setPos(3,2);this.levelContent.addChildGui(e);this.level=new sc.NumberGui(99,{leadingZeros:2});this.level.setAlign(ig.GUI_ALIGN.X_RIGHT,ig.GUI_ALIGN.Y_TOP);this.level.setPos(2,3);this.level.setNumber(c.level);this.levelContent.addChildGui(this.level);this.areaContent=new ig.ColorGui("000");this.areaContent.setAlign(ig.GUI_ALIGN.X_RIGHT,ig.GUI_ALIGN.Y_TOP);this.areaContent.setPos(6+this.levelContent.hook.size.x+1,3);this.areaContent.hook.localAlpha=0.5;this.areaContent.setSize(98,
13);this.addChildGui(this.areaContent);e=new ig.ImageGui(this.gfx,480,224,9,11);e.setPos(2,1);this.areaContent.addChildGui(e);this.area=new sc.TextGui(sc.map.getAreaName(c.area),{font:sc.fontsystem.smallFont});this.area.setAlign(ig.GUI_ALIGN.X_LEFT,ig.GUI_ALIGN.Y_TOP);this.area.setPos(14,0);this.areaContent.addChildGui(this.area);this.rewards=new sc.QuestHubRewards;this.rewards.setAlign(ig.GUI_ALIGN.X_RIGHT,ig.GUI_ALIGN.Y_BOTTOM);this.rewards.setPos(6,4);this.addChildGui(this.rewards);e=new sc.TextGui(ig.lang.get("sc.gui.menu.questHub.rewards"),
{font:sc.fontsystem.tinyFont});e.setPos(3,2);this.rewards.addChildGui(e);var f=c.rewards,c=10,e=14;f.exp&&(c=this.addImageRewardGui(c,e,472,32,14,10,17));f.cp&&(c=this.addImageRewardGui(c,e,593,19,10,10,13));f.money&&(c=this.addImageRewardGui(c,e,488,32,12,10,15));if(f.items)for(var f=f.items||[],e=e-4,g=0;g<f.length;g++)c=this.addItemRewardGui(c,e,f[g].id);sc.menu.questsSeen[a]||(sc.menu.questsSeen[a]=true)},addImageRewardGui:function(a,b,c,e,f,g,h){c=new ig.ImageGui(this.gfx,c,e,f,g);c.setPos(a,
b);this.rewards.addChildGui(c);return a+h},addItemRewardGui:function(a,b,c){c=new sc.TextGui(sc.inventory.getItemIcon(c));c.setPos(a,b);this.rewards.addChildGui(c);return a+16},updateDrawables:function(a){this.ninepatch.draw(a,this.hook.size.x,this.hook.size.y,this.focus?"focus":"default");this.ninepatch.draw(a,this.hook.size.x,this.hook.size.y,this.focus?"hfocus":"hdefault",1);a.addGfx(this.gfx,41,18,530,208,9,10)}});sc.QuestHubRewards=ig.BoxGui.extend({ninepatch:new ig.NinePatch("media/gui/menu.png",
{width:5,height:5,left:5,top:5,right:5,bottom:5,offsets:{"default":{x:560,y:465}}}),init:function(){this.parent(136,29)}});sc.QuestHubCharacterView=ig.BoxGui.extend({ninepatch:new ig.NinePatch("media/gui/menu.png",{width:2,height:2,left:5,top:5,right:5,bottom:5,offsets:{"default":{x:544,y:482}}}),display:null,container:null,transitions:{DEFAULT:{state:{},time:0.1,timeFunction:KEY_SPLINES.EASE},HIDDEN:{state:{alpha:0},time:0.1,timeFunction:KEY_SPLINES.EASE}},init:function(){this.parent(31,44);this.container=
new ig.GuiElementBase;this.container.setSize(31,44);this.container.setPos(1,1);this.addChildGui(this.container)},setCharacter:function(a,b){if(a){if(this.display){this.display.remove(true);this.display=null}if(a){this.display=new sc.NPCDisplayGui(a,true,null,this.centerNPC.bind(this));this.container.addChildGui(this.display);this.doStateTransition("DEFAULT",true)}}else{if(this.display){b?this.display.remove(true):this.display.doStateTransition("HIDDEN",false,true);this.display=null}this.doStateTransition("HIDDEN",
true)}},centerNPC:function(a){a.npc&&a.setPos(this.container.hook.size.x/2-a.hook.size.x/2-1,this.container.hook.size.y/2-a.hook.size.y/2)}})});ig.baked=!0;
ig.module("game.feature.menu.gui.quest-hub.quest-hub-list").requires("impact.feature.gui.base.box","impact.feature.gui.gui","impact.feature.interact.button-interact","game.feature.menu.gui.quest-hub.quest-hub-misc").defines(function(){sc.QuestHubList=sc.ListTabbedPane.extend({submitSound:null,containerHeightOffset:-26,listPosOffset:-6,listHeightOffset:6,listPageSize:25,init:function(){this.parent(true);this.setSize(436,258);this.setAlign(ig.GUI_ALIGN.X_CENTER,ig.GUI_ALIGN.Y_TOP);this.setPivot(436,
258);this.setPanelSize(436,216);this.submitSound=sc.BUTTON_SOUND.submit;this.hook.transitions={DEFAULT:{state:{},time:0.2,timeFunction:KEY_SPLINES.LINEAR},HIDDEN:{state:{alpha:0,offsetX:218},time:0.2,timeFunction:KEY_SPLINES.LINEAR},HIDDEN_EASE:{state:{alpha:0,offsetX:218},time:0.2,timeFunction:KEY_SPLINES.EASE}};this.addTab("open",0,{type:sc.MENU_QUEST_HUB_TABS.OPEN});this.addTab("active",1,{type:sc.MENU_QUEST_HUB_TABS.ACTIVE});this.addTab("finished",2,{type:sc.MENU_QUEST_HUB_TABS.FINISHED})},addObservers:function(){sc.Model.addObserver(sc.menu,
this)},removeObservers:function(){sc.Model.removeObserver(sc.menu,this)},show:function(){this.parent();this.setTab(this.currentTabIndex||0,true,{skipSounds:true});ig.interact.setBlockDelay(0.2);this.doStateTransition("DEFAULT")},hide:function(){this.parent();this.doStateTransition("HIDDEN")},getCurrentSortText:function(){var b=null,b=this.tabContent[this.currentTabIndex]?this.tabContent[this.currentTabIndex].sort||sc.QUEST_SORT_TYPE.ORDER:sc.QUEST_SORT_TYPE.ORDER,a="auto";switch(b){case sc.QUEST_SORT_TYPE.ORDER:a=
"auto";break;case sc.QUEST_SORT_TYPE.NAME:a="name";break;case sc.QUEST_SORT_TYPE.LEVEL:a="questLevel"}return ig.lang.get("sc.gui.menu.sort."+a)},onLeftRightPress:function(){this.submitSound.play();return{skipSounds:true}},onTabChanged:function(b){sc.menu.setSynoTab(b)},onTabButtonCreation:function(b,a,d){b=new sc.ItemTabbedBox.TabButton(ig.lang.get("sc.gui.menu.questHub.tabs."+b),"questHub-"+b,85);b.textChild.setPos(7,1);b.setPos(0,2);b.setData({type:d.type});this.addChildGui(b);return b},onTabPressed:function(b,
a){if(!a){this.submitSound.play();this.setTab(this.getButtonIndex(b));for(var d=this.tabArray.length;d--;)if(b==this.tabArray[d]){sc.menu.setSynoTab(d);break}return false}},onTabSelected:function(){sc.menu.setInfoText("",true)},onTabMouseFocusLost:function(){sc.menu.setInfoText(null,true)},onInitSortType:function(){return 1},onCreateListEntries:function(b,a,d,c){var e=null,e=null,c=this.collectQuests(d,c);b.clear();a.clear();for(a=0;a<c.length;a++){e=c[a];e=new sc.QuestHubListEntry(e,d);b.addButton(e)}},
onListEntrySelected:function(b){b.data&&(b.data instanceof Object||sc.menu.setInfoText(b.data))},onListMouseFocusLost:function(){sc.menu.setInfoText(null,true)},collectQuests:function(b,a){var d=ig.database.get("questHubs")[sc.menu.questHubID];if(!d)throw Error("Quest HUB ID not found: "+sc.menu.questHubID);var d=d.areas,c=sc.quests.staticQuests,e=[],f=new ig.VarCondition,g;for(g in c){var h=c[g];if(h.hubSettings&&!h.noTrack&&(!h.extension||ig.extensions.hasExtension(h.extension)))for(var i=0;i<d.length;i++)if(h.area==
d[i])if(b==sc.MENU_QUEST_HUB_TABS.OPEN){if(!sc.quests.isQuestActive(g)&&!sc.quests.isQuestSolved(g))if(h.hubSettings.condition){f.setCondition(h.hubSettings.condition);f.evaluate()&&e.push(g)}else e.push(g)}else b==sc.MENU_QUEST_HUB_TABS.ACTIVE?sc.quests.isQuestActive(g)&&e.push(g):b==sc.MENU_QUEST_HUB_TABS.FINISHED&&sc.quests.isQuestSolved(g)&&e.push(g)}a!=void 0&&this.sortList(e,a);return e},sortList:function(b,a){switch(a){case sc.QUEST_SORT_TYPE.ORDER:b.sort(function(a,b){var e=sc.quests.getStaticQuest(a),
f=sc.quests.getStaticQuest(b);if(e.area!=f.area){e=sc.map.getAreaOrder(e.area);f=sc.map.getAreaOrder(f.area);return e-f}return e.order-f.order});break;case sc.QUEST_SORT_TYPE.NAME:b.sort(function(a,b){var e=sc.quests.getStaticQuest(a),f=sc.quests.getStaticQuest(b);return e.name.toString().localeCompare(f.name.toString())});break;case sc.QUEST_SORT_TYPE.LEVEL:b.sort(function(a,b){var e=sc.quests.getStaticQuest(a),f=sc.quests.getStaticQuest(b);return e.level-f.level})}},modelChanged:function(b,a,d){b==
sc.menu&&a==sc.MENU_EVENT.SORT_LIST&&this.sort(d.data.sortType)}})});ig.baked=!0;
ig.module("game.feature.menu.gui.quest-hub.quest-hub-menu").requires("impact.feature.gui.gui","impact.feature.gui.base.basic-gui","game.feature.menu.gui.base-menu","game.feature.menu.gui.quest-hub.quest-hub-list").defines(function(){sc.QuestHubMenu=sc.ListInfoMenu.extend({helpGui:null,completion:null,available:null,init:function(){this.parent(new sc.QuestHubList);this.list.hook.pos.x=0;this.list.bg.hook.pos.y=this.list.bg.hook.pos.y-5;this.list.bg.hook.size.y=this.list.bg.hook.size.y+5;this.completion=
new sc.QuestHubCompletion;this.addChildGui(this.completion);this.available=new sc.QuestHubAvailable;this.addChildGui(this.available);this.sortMenu.addButton("auto",sc.QUEST_SORT_TYPE.ORDER,0);this.sortMenu.addButton("name",sc.QUEST_SORT_TYPE.NAME,1);this.sortMenu.addButton("questLevel",sc.QUEST_SORT_TYPE.LEVEL,2);this.doStateTransition("DEFAULT")},showMenu:function(){this.parent();this.list&&this.updateSortMenuButton(this.list.getCurrentSortText());this.completion.show();this.available.show()},exitMenu:function(){this.parent();
this.completion.hide();this.available.hide();sc.menu.moveLeaSprite(0,0,sc.MENU_LEA_STATE.LARGE)},createHelpGui:function(){if(!this.helpGui){this.helpGui=new sc.HelpScreen(this,ig.lang.get("sc.gui.menu.help-texts.questHub.title"),ig.lang.get("sc.gui.menu.help-texts.questHub.pages"),function(){this.commitHotKeysToTopBar(true)}.bind(this),true);this.helpGui.hook.zIndex=15E4;this.helpGui.hook.pauseGui=true}},modelChanged:function(b,a,d){if(b==sc.menu)if(a==sc.MENU_EVENT.SORT_LIST)this.updateSortMenuButton(d.text);
else if(a==sc.MENU_EVENT.SYNO_CHANGED_TAB){this.sortMenu.active&&this.sortMenu.hideSortMenu();this.updateSortMenuButton(this.list.getCurrentSortText())}}})});ig.baked=!0;
ig.module("game.feature.menu.gui.enemies.enemy-list").requires("impact.feature.gui.gui","impact.feature.gui.base.basic-gui","game.feature.gui.base.text","game.feature.menu.gui.menu-misc","game.feature.menu.gui.list-boxes","game.feature.menu.gui.tab-box").defines(function(){ig.perf.fullEnemyFibula=false;sc.EnemyListBox=sc.ListTabbedPane.extend({submitSound:null,favSound:null,errorSound:null,enemies:null,init:function(){this.parent(true);this.setSize(264,262);this.setAlign(ig.GUI_ALIGN.X_RIGHT,ig.GUI_ALIGN.Y_TOP);
this.setPivot(264,262);this.setPanelSize(264,243);this.favSound=this.submitSound=sc.BUTTON_SOUND.submit;this.errorSound=sc.BUTTON_SOUND.denied;this.hook.transitions={DEFAULT:{state:{},time:0.2,timeFunction:KEY_SPLINES.LINEAR},HIDDEN:{state:{alpha:0,offsetX:-132},time:0.2,timeFunction:KEY_SPLINES.LINEAR},HIDDEN_EASE:{state:{alpha:0,offsetX:-132},time:0.2,timeFunction:KEY_SPLINES.EASE}};this.enemies=ig.database.get("enemies");var b=new sc.TextGui(ig.lang.get("sc.gui.status-hud.lvl"),{font:sc.fontsystem.tinyFont});
b.setAlign(ig.GUI_ALIGN.X_RIGHT,ig.GUI_ALIGN.Y_TOP);b.setPos(7,-8);this.bg.addChildGui(b);this.addTab("animals",0,{type:sc.ENEMY_CATEGORY.ANIMALS});this.addTab("mecha",1,{type:sc.ENEMY_CATEGORY.MECHA});this.addTab("avatars",2,{type:sc.ENEMY_CATEGORY.PLAYERS});this.addTab("abstract",3,{type:sc.ENEMY_CATEGORY.ABSTRACT});this.addTab("boss",4,{type:sc.ENEMY_CATEGORY.BOSS})},addObservers:function(){sc.Model.addObserver(sc.menu,this)},removeObservers:function(){sc.Model.removeObserver(sc.menu,this)},show:function(){this.parent();
this.setTab(this.currentTabIndex||0,true,{skipSounds:true});ig.interact.setBlockDelay(0.2);this.doStateTransition("DEFAULT")},hide:function(){this.parent();this.doStateTransition("HIDDEN")},getCurrentSortText:function(){var b=null,b=this.tabContent[this.currentTabIndex]?this.tabContent[this.currentTabIndex].sort||sc.COMBAT_ENEMY_SORT_TYPE.ORDER:sc.COMBAT_ENEMY_SORT_TYPE.ORDER,a="auto";switch(b){case sc.COMBAT_ENEMY_SORT_TYPE.ORDER:a="auto";break;case sc.COMBAT_ENEMY_SORT_TYPE.NAME:a="name";break;
case sc.COMBAT_ENEMY_SORT_TYPE.LEVEL:a="enemyLevel";break;case sc.COMBAT_ENEMY_SORT_TYPE.AREA:a="area"}return ig.lang.get("sc.gui.menu.sort."+a)},onLeftRightPress:function(b,a,d){this.submitSound.play();sc.menu.switchSynopsisPage(d==1?1:-1);return{skipSounds:true}},onTabChanged:function(b){sc.menu.setSynoTab(b);(ig.input.mouseGuiActive||this.currentGroup.isEmpty())&&sc.menu.setSynopInfo(null,true)},onTabButtonCreation:function(b,a,d){b=new sc.ItemTabbedBox.TabButton(ig.lang.get("sc.gui.menu.enemy.tabs."+
b),"enemy-"+b,105);b.textChild.setPos(7,1);b.setPos(0,2);b.setData({type:d.type});this.addChildGui(b);return b},onTabPressed:function(b,a){if(!a){this.submitSound.play();this.setTab(this.getButtonIndex(b));for(var d=this.tabArray.length;d--;)if(b==this.tabArray[d]){sc.menu.setSynoTab(d);break}sc.menu.setSynopInfo(null,true);return false}},onTabSelected:function(){ig.input.mouseGuiActive&&sc.menu.setSynopInfo(null,true)},onTabMouseFocusLost:function(){sc.menu.setSynopInfo(null,true)},onCreateListEntries:function(b,
a,d,c){var e=null,f=null,g=e=null,h=null,c=this.getEnemyList(d,c);b.clear();a.clear();for(a=0;a<c.length;a++){e=c[a];g=this.enemies[e];if((ig.perf.fullEnemyFibula||sc.stats.getMap("combat","kill"+e))&&g.track&&(!g.extension||ig.extensions.hasExtension(g.extension))){var f=sc.map.getAreaItemToggleState(sc.AREA_ITEM_TYPE.BOOSTER,g.area),h=d==sc.ENEMY_CATEGORY.BOSS?"\\i[enemy-"+this.getEnemyCategoryKey(g.category)+"-boss]":"\\i[enemy-"+this.getCurrentTabKey()+(g.boss?"-boss":"")+"]",i=f&&sc.combat.canShowBoostedEntry(e,
g.boss)?g.boostedLevel||sc.MIN_BOOSTER_LEVEL:g.level,f="",f=f+(h+ig.LangLabel.getText(g.name)),e=new sc.EnemyEntryButton(f,e,i||1);b.addButton(e)}}},onListEntrySelected:function(b){if(b.key){sc.menu.setSynopInfo(b.key);sc.menu.setInfoText(null,true)}else{sc.menu.setSynopInfo(b.key);b.data&&(b.data instanceof Object||sc.menu.setInfoText(b.data))}},onListMouseFocusLost:function(){sc.menu.setSynopInfo(null,true);sc.menu.setInfoText(null,true)},getEnemyList:function(b,a){var d=[],c=this.enemies,e;for(e in c){var f=
c[e];b==sc.ENEMY_CATEGORY.BOSS?f.boss&&d.push(e):sc.ENEMY_CATEGORY[f.category||"ABSTRACT"]==b&&d.push(e)}a!=void 0&&this.sortLoreList(d,a);return d},sortLoreList:function(b,a){switch(a){case sc.COMBAT_ENEMY_SORT_TYPE.ORDER:b.sort(function(a,b){a=this.enemies[a].order;b=this.enemies[b].order;return a-b}.bind(this));break;case sc.COMBAT_ENEMY_SORT_TYPE.NAME:b.sort(function(a,b){var e=ig.LangLabel.getText(this.enemies[a].name),f=ig.LangLabel.getText(this.enemies[b].name);return e.localeCompare(f)}.bind(this));
break;case sc.COMBAT_ENEMY_SORT_TYPE.LEVEL:b.sort(function(a,b){var e=this.enemies[a],f=this.enemies[b];return(e.level||1)==(f.level||1)?e.order-f.order:(e.level||1)-(f.level||1)}.bind(this));break;case sc.COMBAT_ENEMY_SORT_TYPE.AREA:b.sort(function(a,b){var e=this.enemies[a],f=this.enemies[b];return e.area==f.area?e.order-f.order:sc.map.getAreaName(e.area).toString().localeCompare(sc.map.getAreaName(f.area).toString())}.bind(this))}},getEnemyCategoryKey:function(b){switch(sc.ENEMY_CATEGORY[b]){case sc.ENEMY_CATEGORY.ANIMALS:return"animals";
case sc.ENEMY_CATEGORY.MECHA:return"mecha";case sc.ENEMY_CATEGORY.PLAYERS:return"avatars";case sc.ENEMY_CATEGORY.ABSTRACT:return"abstract"}},modelChanged:function(b,a,d){if(b==sc.menu&&a==sc.MENU_EVENT.SORT_LIST){sc.menu.setSynopInfo(null,true);sc.menu.setInfoText(null,true);this.sort(d.data.sortType)}}})});ig.baked=!0;
ig.module("game.feature.menu.gui.enemies.enemy-misc").requires("impact.feature.gui.base.box","impact.feature.gui.gui","impact.feature.gui.base.basic-gui","game.feature.menu.gui.menu-misc","game.feature.menu.gui.enemies.enemy-pages").defines(function(){sc.EnemyInfoBox=ig.BoxGui.extend({gfx:new ig.Image("media/gui/basic.png"),ninepatch:new ig.NinePatch("media/gui/menu.png",{width:2,height:8,left:27,top:21,right:27,bottom:3,offsets:{"default":{x:520,y:0}}}),title:null,level:null,category:null,display:null,
rightButton:null,leftButton:null,pagesNumberContainer:null,currentPage:null,maxPages:null,pages:[],enemy:null,page:-1,key:"-1s",init:function(){this.parent(281,265);this.setAlign(ig.GUI_ALIGN.X_LEFT,ig.GUI_ALIGN.Y_TOP);this.hook.transitions={DEFAULT:{state:{},time:0.2,timeFunction:KEY_SPLINES.EASE},HIDDEN:{state:{alpha:0,offsetX:-(this.hook.size.x/2)},time:0.2,timeFunction:KEY_SPLINES.LINEAR}};this.annotation=[];this.annotation[0]={content:{title:"sc.gui.menu.help.enemy.titles.type",description:"sc.gui.menu.help.enemy.description.type"},
offset:{x:4,y:2},size:{x:20,y:19},index:{x:0,y:0}};this.annotation[1]={content:{title:"sc.gui.menu.help.enemy.titles.level",description:"sc.gui.menu.help.enemy.description.level"},offset:{x:257,y:2},size:{x:21,y:19},index:{x:1,y:0}};this.title=new sc.TextGui("");this.title.setAlign(ig.GUI_ALIGN.X_CENTER,ig.GUI_ALIGN.Y_TOP);this.title.setPos(0,4);this.addChildGui(this.title);this.category=new sc.TextGui("");this.category.setPos(7,3);this.addChildGui(this.category);this.level=new sc.NumberGui(99,{leadingZeros:2});
this.level.setAlign(ig.GUI_ALIGN.X_RIGHT,ig.GUI_ALIGN.Y_TOP);this.level.setPos(5,11);this.addChildGui(this.level);var b=new sc.EnemyPageGeneralInfo;b.setPos(6,24);this.addChildGui(b);this.pages.push(b);b=new sc.EnemyPageMetaInfo;b.setPos(6,24);this.addChildGui(b);this.pages.push(b);b=new ig.ColorGui("#545454",277,22);b.setAlign(ig.GUI_ALIGN.X_CENTER,ig.GUI_ALIGN.Y_BOTTOM);b.setPos(0,2);this.addChildGui(b);b=new sc.TextGui("lvl",{font:sc.fontsystem.tinyFont});b.setAlign(ig.GUI_ALIGN.X_RIGHT,ig.GUI_ALIGN.Y_TOP);
b.setPos(6,3);this.addChildGui(b);this.rightButton=new sc.ButtonGui("\\i[page-right]",32,true,sc.BUTTON_TYPE.SMALL);this.rightButton.onButtonPress=this.onRightButtonPressed.bind(this);this.rightButton.textChild.setPos(1,0);this.rightButton.keepMouseFocus=true;this.rightButton.hook.transitions={DEFAULT:{state:{},time:0.2,timeFunction:KEY_SPLINES.EASE},HIDDEN:{state:{alpha:0,offsetX:5},time:0.2,timeFunction:KEY_SPLINES.LINEAR}};this.rightButton.setAlign(ig.GUI_ALIGN.X_RIGHT,ig.GUI_ALIGN.Y_BOTTOM);this.rightButton.setPos(2,
2);this.addChildGui(this.rightButton);this.leftButton=new sc.ButtonGui("\\i[page-left]",32,true,sc.BUTTON_TYPE.SMALL);this.leftButton.onButtonPress=this.onLeftButtonPressed.bind(this);this.leftButton.textChild.setPos(1,0);this.leftButton.keepMouseFocus=true;this.leftButton.hook.transitions={DEFAULT:{state:{},time:0.2,timeFunction:KEY_SPLINES.EASE},HIDDEN:{state:{alpha:0,offsetX:5},time:0.2,timeFunction:KEY_SPLINES.LINEAR}};this.leftButton.setAlign(ig.GUI_ALIGN.X_LEFT,ig.GUI_ALIGN.Y_BOTTOM);this.leftButton.setPos(2,
2);this.addChildGui(this.leftButton);this.rightButton.doStateTransition("HIDDEN",true);this.leftButton.doStateTransition("HIDDEN",true);this.pagesNumberContainer=new ig.GuiElementBase;this.pagesNumberContainer.setAlign(ig.GUI_ALIGN.X_CENTER,ig.GUI_ALIGN.Y_BOTTOM);this.pagesNumberContainer.setPos(0,7);this.pagesNumberContainer.setSize(60,8);this.pagesNumberContainer.hook.transitions={DEFAULT:{state:{},time:0.2,timeFunction:KEY_SPLINES.LINEAR},HIDDEN:{state:{alpha:0},time:0.2,timeFunction:KEY_SPLINES.LINEAR}};
b=new ig.ImageGui(this.gfx,96,0,8,8);b.setAlign(ig.GUI_ALIGN.X_CENTER,ig.GUI_ALIGN.Y_TOP);this.pagesNumberContainer.addChildGui(b);this.currentPage=new sc.NumberGui(99);this.currentPage.setAlign(ig.GUI_ALIGN.X_RIGHT,ig.GUI_ALIGN.Y_TOP);this.currentPage.setPos(36,0);this.pagesNumberContainer.addChildGui(this.currentPage);this.maxPages=new sc.NumberGui(null);this.maxPages.setNumber(this.pages.length,true);this.maxPages.setAlign(ig.GUI_ALIGN.X_LEFT,ig.GUI_ALIGN.Y_TOP);this.maxPages.setPos(36,0);this.pagesNumberContainer.addChildGui(this.maxPages);
this.addChildGui(this.pagesNumberContainer);this.setEnemy()},show:function(){for(var b=this.pages.length;b--;)this.page==b&&this.enemy?this.pages[b].doStateTransition("DEFAULT",true):this.pages[b].doStateTransition("HIDDEN",true);this.doStateTransition("DEFAULT")},hide:function(){this.pages[0].display.setEnemy(null,true);this.page=-1;this.key="-1s";this.doStateTransition("HIDDEN");sc.menu.buttonInteract.removeGlobalButton(this.rightButton);sc.menu.buttonInteract.removeGlobalButton(this.leftButton)},
onRightButtonCheck:function(){return sc.control.rightPressed()},onLeftButtonCheck:function(){return sc.control.leftPressed()},onRightButtonPressed:function(){this.switchPage(1)},onLeftButtonPressed:function(){this.switchPage(-1)},setPage:function(b){if(b!=this.page){this.page>=0&&this.pages[this.page].doStateTransition("HIDDEN",true);this.page=b||0;this.pages[this.page].doStateTransition("HIDDEN",true);this.pages[this.page].doStateTransition("DEFAULT",true);if(this.pages.length==0){this.rightButton.doStateTransition("HIDDEN");
this.leftButton.doStateTransition("HIDDEN");sc.menu.buttonInteract.removeGlobalButton(this.rightButton);sc.menu.buttonInteract.removeGlobalButton(this.leftButton)}this.currentPage.setNumber(this.page+1);if(this.pages.length==1){this.rightButton.doStateTransition("HIDDEN",true);this.leftButton.doStateTransition("HIDDEN",true);sc.menu.buttonInteract.removeGlobalButton(this.rightButton);sc.menu.buttonInteract.removeGlobalButton(this.leftButton)}else if(this.page==this.pages.length-1){this.rightButton.doStateTransition("HIDDEN",
true);sc.menu.buttonInteract.removeGlobalButton(this.rightButton);this.leftButton.doStateTransition("DEFAULT",true);sc.menu.buttonInteract.addGlobalButton(this.leftButton,this.onLeftButtonCheck.bind(this),true)}else{if(this.page==0){this.leftButton.doStateTransition("HIDDEN",true);sc.menu.buttonInteract.removeGlobalButton(this.leftButton)}else{this.leftButton.doStateTransition("DEFAULT",true);sc.menu.buttonInteract.addGlobalButton(this.leftButton,this.onLeftButtonCheck.bind(this),true)}this.rightButton.doStateTransition("DEFAULT",
true);sc.menu.buttonInteract.addGlobalButton(this.rightButton,this.onRightButtonCheck.bind(this),true)}}},switchPage:function(b){if(this.key&&this.pages.length!=1){var a=this.page,a=a+b;a>=this.pages.length&&(a=this.pages.length-1);a<0&&(a=0);a!=this.page&&this.setPage(a)}},setCategory:function(b){this.category.setText("\\i[enemy-"+b+"]")},setEnemy:function(b){if(this.key!=b){var a=(this.enemy=(this.key=b)?ig.database.get("enemies")[b]:null)?sc.map.getAreaItemToggleState(sc.AREA_ITEM_TYPE.BOOSTER,
this.enemy.area):false,d=1;if(this.enemy){d=a?this.enemy.boostedLevel||sc.MIN_BOOSTER_LEVEL:this.enemy.level||1;this.title.setText(ig.LangLabel.getText(this.enemy.name));this.level.setNumber(d)}else{this.level.setNumber(0);this.title.setText(ig.lang.get("sc.gui.menu.enemy.noEnemy"))}for(d=this.pages.length;d--;)this.pages[d].setData(b,this.enemy,this.page==-1?false:this.page!=d,a);if(this.key){this.setPage(this.page==-1?0:this.page);this.pagesNumberContainer.doStateTransition("DEFAULT",true)}else{this.page>=
0&&this.pages[this.page].doStateTransition("HIDDEN",true);this.page=-1;this.pagesNumberContainer.doStateTransition("HIDDEN",true);this.rightButton.doStateTransition("HIDDEN",true);this.leftButton.doStateTransition("HIDDEN",true);sc.menu.buttonInteract.removeGlobalButton(this.rightButton);sc.menu.buttonInteract.removeGlobalButton(this.leftButton)}}}});sc.EnemyEntryButton=sc.ListBoxButton.extend({key:null,level:null,init:function(b,a,d){this.parent(b,236,25);this.key=a||null;this.blockedSound=this.button.submitSound=
null;if(d>=0){this.level=new sc.NumberGui(99);this.level.setNumber(d,true);this.level.setAlign(ig.GUI_ALIGN.X_RIGHT,ig.GUI_ALIGN.Y_TOP);this.level.setPos(5,7);this.addChildGui(this.level)}}})});ig.baked=!0;
ig.module("game.feature.menu.gui.enemies.enemy-menu").requires("impact.feature.gui.gui","impact.feature.gui.base.basic-gui","game.feature.menu.gui.enemies.enemy-list","game.feature.menu.gui.enemies.enemy-misc").defines(function(){sc.EnemyMenu=sc.ListInfoMenu.extend({init:function(){this.parent(new sc.EnemyListBox,new sc.EnemyInfoBox);this.sortMenu.addButton("auto",sc.COMBAT_ENEMY_SORT_TYPE.ORDER,0);this.sortMenu.addButton("name",sc.COMBAT_ENEMY_SORT_TYPE.NAME,1);this.sortMenu.addButton("enemyLevel",
sc.COMBAT_ENEMY_SORT_TYPE.LEVEL,2);this.sortMenu.addButton("area",sc.COMBAT_ENEMY_SORT_TYPE.AREA,3);this.doStateTransition("DEFAULT")},showMenu:function(){sc.menu.setSynopInfo(null,false);this.parent();this.updateSortMenuButton(this.list.getCurrentSortText());this.info.setCategory(this.list.getCurrentTabKey())},exitMenu:function(){this.parent();ig.cleanCache()},createHelpGui:function(){if(!this.helpGui){this.helpGui=new sc.HelpScreen(this,ig.lang.get("sc.gui.menu.help-texts.enemy.title"),ig.lang.get("sc.gui.menu.help-texts.enemy.pages"),
function(){this.commitHotKeysToTopBar(true)}.bind(this),true);this.helpGui.hook.zIndex=15E4;this.helpGui.hook.pauseGui=true}},modelChanged:function(b,a,d){if(b==sc.menu)if(a==sc.MENU_EVENT.SORT_LIST)this.updateSortMenuButton(d.text);else if(a==sc.MENU_EVENT.SYNO_CHANGED_TAB){this.sortMenu.active&&this.sortMenu.hideSortMenu();this.info.setCategory(this.list.getCurrentTabKey());this.updateSortMenuButton(this.list.getCurrentSortText())}else a!=sc.MENU_EVENT.SYNOP_SWITCH_PAGE&&a==sc.MENU_EVENT.SYNOP_SET_INFO&&
this.info.setEnemy(sc.menu.synopInfo)}})});ig.baked=!0;
ig.module("game.feature.menu.gui.lore.lore-misc").requires("impact.feature.gui.base.box","impact.feature.gui.gui","game.feature.menu.gui.menu-misc").defines(function(){sc.LoreInfoBox=ig.BoxGui.extend({gfx:new ig.Image("media/gui/basic.png"),ninepatch:new ig.NinePatch("media/gui/menu.png",{width:2,height:8,left:27,top:21,right:27,bottom:3,offsets:{"default":{x:456,y:244},focus:{x:576,y:432}}}),title:null,category:null,alternativeArrow:null,alternative:null,scrollContainer:null,content:null,key:null,
lore:null,buttongroup:null,currentButton:null,focus:false,scrollMemory:{},init:function(){this.parent(281,265);this.setAlign(ig.GUI_ALIGN.X_LEFT,ig.GUI_ALIGN.Y_TOP);this.hook.transitions={DEFAULT:{state:{},time:0.2,timeFunction:KEY_SPLINES.EASE},HIDDEN:{state:{alpha:0,offsetX:-(this.hook.size.x/2)},time:0.2,timeFunction:KEY_SPLINES.LINEAR}};this.annotation=[];this.annotation[0]={content:{title:"sc.gui.menu.help.lore.titles.type",description:"sc.gui.menu.help.lore.description.type"},offset:{x:4,y:3},
size:{x:19,y:18},index:{x:0,y:0}};this.annotation[1]={content:{title:"sc.gui.menu.help.lore.titles.content",description:"sc.gui.menu.help.lore.description.content"},offset:{x:4,y:23},size:{x:273,y:241},index:{x:0,y:1}};this.buttongroup=new sc.ButtonGroup;this.buttongroup.doButtonTraversal=this.onButtonTraversal.bind(this);this.title=new sc.TextGui("");this.title.setAlign(ig.GUI_ALIGN.X_CENTER,ig.GUI_ALIGN.Y_TOP);this.title.setPos(0,4);this.addChildGui(this.title);this.alternativeArrow=new ig.ImageGui(this.ninepatch.gfx,
465,338,13,10);this.alternativeArrow.setPos(10,23);this.alternativeArrow.setPivot(13,7);this.alternativeArrow.hook.transitions={DEFAULT:{state:{},time:0.2,timeFunction:KEY_SPLINES.EASE},HIDDEN:{state:{alpha:0,scaleX:0.2,scaleY:0.5,offsetY:5},time:0.2,timeFunction:KEY_SPLINES.LINEAR}};this.alternativeArrow.doStateTransition("HIDDEN",true);this.addChildGui(this.alternativeArrow);this.alternative=new sc.TextGui("",{font:sc.fontsystem.smallFont});this.alternative.hook.transitions={DEFAULT:{state:{},time:0.2,
timeFunction:KEY_SPLINES.EASE},HIDDEN:{state:{alpha:0,offsetX:10},time:0.2,timeFunction:KEY_SPLINES.LINEAR}};this.alternative.doStateTransition("HIDDEN",true);this.alternative.setPos(25,25);this.addChildGui(this.alternative);this.category=new sc.TextGui("");this.category.setPos(7,3);this.addChildGui(this.category);this.scrollContainer=new sc.ScrollPane(sc.ScrollType.Y_ONLY);this.scrollContainer.showBottomBar=false;this.scrollContainer.setSize(261,221);this.scrollContainer.setPos(10,40);this.addChildGui(this.scrollContainer);
this.content=new ig.GuiElementBase;this.scrollContainer.setContent(this.content);this.setLore()},show:function(){this.focus=false;this.currentTileOffset="default";this.doStateTransition("DEFAULT")},hide:function(){this.doStateTransition("HIDDEN")},setFocus:function(b){if(b){this.setLore(b.key);this.focus=true;this.currentTileOffset="focus";this.currentButton=b;this.currentButton.setPressState(true);this.currentButton&&this.currentButton.setPressed(true);sc.menu.buttonInteract.pushButtonGroup(this.buttongroup);
sc.menu.pushBackCallback(this.onBackButtonPress.bind(this))}else this.clearFocus()},clearFocus:function(){if(this.focus){this.focus=false;this.currentButton&&this.currentButton.setPressState(false);this.currentButton=null;this.currentTileOffset="default";sc.menu.popBackCallback();sc.menu.buttonInteract.removeButtonGroup(this.buttongroup);ig.input.mouseGuiActive&&this.setLore(null)}},onButtonTraversal:function(){sc.control.menuBack()&&this.buttongroup.invokeBackButton()},onBackButtonPress:function(){this.clearFocus()},
update:function(){if(!ig.interact.isBlocked())if(this.focus&&this.buttongroup.isActive()){sc.control.menuScrollUp()?this.scrollContainer.scrollY(-20,false,0.05):sc.control.menuScrollDown()&&this.scrollContainer.scrollY(20,false,0.05);sc.control.downDown()?this.scrollContainer.scrollY(200*ig.system.tick,false,0.05):sc.control.upDown()&&this.scrollContainer.scrollY(-200*ig.system.tick,false,0.05)}else sc.control.loreDown()?this.scrollContainer.scrollY(200*ig.system.tick,false,0.05):sc.control.loreUp()&&
this.scrollContainer.scrollY(-200*ig.system.tick,false,0.05)},setCategory:function(b){this.category.setText("\\i[lore-"+b+"]");b=="story"?this.category.setPos(6,3):this.category.setPos(7,3)},setLore:function(b){if(!this.focus){var a=this.key;this.lore=(this.key=b)?sc.lore.getLore(b):null;this.alternativeArrow.doStateTransition("HIDDEN",true);this.alternative.doStateTransition("HIDDEN",true);a&&(this.scrollMemory[a]=this.scrollContainer.getScrollY());this.content.removeAllChildren();this.content.setSize(261,
0);this.scrollContainer.setPos(6,25);this.scrollContainer.setSize(269,238);if(this.lore)if(ig.perf.fullLoreList||sc.lore.isLoreAvailable(b)){this.title.setText(ig.LangLabel.getText(this.lore.title));if(this.lore.alternative){this.alternativeArrow.doStateTransition("DEFAULT");this.alternative.setText(ig.lang.get("sc.gui.menu.lore.aka")+ig.LangLabel.getText(this.lore.alternative));this.alternative.doStateTransition("DEFAULT");this.scrollContainer.setPos(6,40);this.scrollContainer.setSize(269,223)}this._createEntry(b)}else this.title.setText(ig.lang.get("sc.gui.menu.lore.lockedEntry"));
else this.title.setText(ig.lang.get("sc.gui.menu.lore.noLore"));this.scrollContainer.recalculateScrollBars(true);this.scrollContainer.setScrollY(this.scrollMemory[b]||0,true)}},_createEntry:function(b){var a=this.lore.content,d=null,c=1,e=0,f;for(f in a){if(!ig.perf.fullLoreList&&!sc.lore.isLoreEntryUnlocked(b,f))break;(d=a[f])&&(c=this._addContent(d.content,d.image,d.hr,d.options,c,e,d.imageCond,d.altContent));e++}this.content.setSize(261,c)},_addContent:function(b,a,d,c,e,f,g,h){if(!b)return e;
var i=this.content,j=null,k=null,k=c?sc.LORE_IMAGE_ALIGN[c.align]:0,c=c?c.wrap:false;if(d){j=new ig.ColorGui("#545454",266,1);j.setAlign(ig.GUI_ALIGN.X_CENTER,ig.GUI_ALIGN.Y_TOP);j.setPos(0,e);i.addChildGui(j);e=e+2}j=new ig.VarCondition;if(h){j.setCondition(h.condition);j.evaluate()&&(b=h.content)}j.setCondition(g||"true");if(a&&j.evaluate()){j=new ig.ImageGui(new ig.Image(a.src),a.offX,a.offY,a.width,a.height);j.setAlign(k+4,ig.GUI_ALIGN.Y_TOP);j.setPos(0,e);i.addChildGui(j);g=261-j.hook.size.x-
2;a=1;if(c)switch(k){case sc.LORE_IMAGE_ALIGN.LEFT:a=j.hook.size.x+4;g=g-2;break;case sc.LORE_IMAGE_ALIGN.CENTER:g=261;c=false}else g=259;c||(e=e+(j.hook.size.y+2));k=new sc.TextGui(ig.LangLabel.getText(b),{font:sc.fontsystem.smallFont,maxWidth:g});k.setPos(a,e);i.addChildGui(k);e=c?e+Math.max(j.hook.size.y,k.hook.size.y)+2:e+(k.hook.size.y+2)}else{j=new sc.TextGui(ig.LangLabel.getText(b),{font:sc.fontsystem.smallFont,maxWidth:261});j.setPos(1,e);i.addChildGui(j);e=e+(j.hook.size.y+2)}if(ig.langEdit){f=
"Lore: "+ig.LangLabel.getText(this.lore.title)+", Paragraph: "+(f+1);ig.langEdit.submitCustomFile(f,new ig.LangLabel(b),"data/database.json")}return e}});sc.LoreEntryButton=sc.ListBoxButton.extend({key:null,completion:null,overlay:null,init:function(b,a,d,c,e){this.parent(b,229-(e?22:0),31,void 0,void 0,this.isNoPercentType(d));this.key=a||null;this.blockedSound=null;b=a?Math.round(sc.lore.getCompletionPercent(a)*100):0;if(b>=0){this.completion=new sc.NumberGui(100,{size:sc.NUMBER_SIZE.NORMAL});this.completion.setNumber(b,
true);this.completion.setAlign(ig.GUI_ALIGN.X_RIGHT,ig.GUI_ALIGN.Y_TOP);this.completion.setPos(5,7);this.addChildGui(this.completion)}if(c&&sc.menu.hasNewUnlockKey(sc.MENU_SUBMENU.LORE,a)){this.overlay=new sc.NewUnlockOverlay;this.overlay.setPos((this.isNoPercentType(d),33),3);this.overlay.activate();this.addChildGui(this.overlay)}},setPressState:function(b){if(b){this.keepPressed=this.pressed=true;this.button.setPressed(true);this.button.keepPressed=true}else{this.keepPressed=this.pressed=false;
this.button.setPressed(false);this.button.keepPressed=false}},clearOverlay:function(){this.overlay&&this.overlay.deactivate(true,true)},isNoPercentType:function(b){return b==sc.LORE_CATERGORIES.STORY||b==sc.LORE_CATERGORIES.MEMORIES}})});ig.baked=!0;
ig.module("game.feature.menu.gui.lore.lore-list").requires("impact.feature.gui.gui","impact.feature.gui.base.basic-gui","game.feature.gui.base.text","game.feature.menu.gui.menu-misc","game.feature.menu.gui.list-boxes","game.feature.menu.gui.tab-box","game.feature.menu.gui.lore.lore-misc").defines(function(){var b=[];ig.perf.fullLoreList=false;sc.LoreListBoxNew=sc.ListTabbedPane.extend({gfx:new ig.Image("media/gui/menu.png"),submitSound:null,favSound:null,errorSound:null,completion:null,newList:[],
init:function(){this.parent(true);this.setSize(264,262);this.setAlign(ig.GUI_ALIGN.X_RIGHT,ig.GUI_ALIGN.Y_TOP);this.setPivot(264,262);this.setPanelSize(264,243);this.favSound=this.submitSound=sc.BUTTON_SOUND.submit;this.errorSound=sc.BUTTON_SOUND.denied;this.completion=new sc.TextGui(ig.lang.get("sc.gui.menu.lore.completion"),{font:sc.fontsystem.tinyFont});this.completion.hook.transitions={DEFAULT:{state:{},time:0.1,timeFunction:KEY_SPLINES.EASE},HIDDEN:{state:{alpha:0,offsetX:4},time:0.1,timeFunction:KEY_SPLINES.EASE}};
this.completion.setAlign(ig.GUI_ALIGN.X_RIGHT,ig.GUI_ALIGN.Y_TOP);this.completion.setPos(4,-8);this.bg.addChildGui(this.completion);this.hook.transitions={DEFAULT:{state:{},time:0.2,timeFunction:KEY_SPLINES.LINEAR},HIDDEN:{state:{alpha:0,offsetX:-132},time:0.2,timeFunction:KEY_SPLINES.LINEAR},HIDDEN_EASE:{state:{alpha:0,offsetX:-132},time:0.2,timeFunction:KEY_SPLINES.EASE}};this.addTab("story",0,{type:sc.LORE_CATERGORIES.STORY});this.addTab("people",1,{type:sc.LORE_CATERGORIES.CHARACTERS});this.addTab("cross-lore",
2,{type:sc.LORE_CATERGORIES.CROSS_LORE});this.addTab("earth-lore",3,{type:sc.LORE_CATERGORIES.EARTH_LORE})},addObservers:function(){sc.Model.addObserver(sc.menu,this)},removeObservers:function(){sc.Model.removeObserver(sc.menu,this)},show:function(){this.parent();this.setTab(this.currentTabIndex||0,true,{skipSounds:true});this.canShowCompletion(this.currentTabIndex)?this.completion.doStateTransition("DEFAULT",true):this.completion.doStateTransition("HIDDEN",true);for(var a in this.tabs)this.tabs[a].newUnlock.deactivate(false);
a=sc.menu.newUnlocks[sc.MENU_SUBMENU.LORE];for(var b=a.length;b--;){var c=sc.lore.getLore(a[b]);if(c)(c=this.tabs[this.keys[sc.LORE_CATERGORIES[c.category]]])&&c.newUnlock.activate()}ig.interact.setBlockDelay(0.2);this.doStateTransition("DEFAULT")},hide:function(){this.parent();for(var a=this.newList.length;a--;){this.newList[a].clearOverlay();sc.menu.clearNewUnlock(sc.MENU_SUBMENU.LORE,this.newList[a].key)}this.newList.length=0;this.doStateTransition("HIDDEN")},getCurrentSortText:function(){var a=
null,a=this.tabContent[this.currentTabIndex]?this.tabContent[this.currentTabIndex].sort||sc.LORE_SORT_TYPE.ORDER:sc.LORE_SORT_TYPE.ORDER,b="auto";switch(a){case sc.LORE_SORT_TYPE.ORDER:b="auto";break;case sc.LORE_SORT_TYPE.NAME:b="name";break;case sc.LORE_SORT_TYPE.UNLOCKED:b="unlocked"}return ig.lang.get("sc.gui.menu.sort."+b)},onListEntryPressed:function(a){sc.menu.setSynopFocus(a)},onLeftRightPress:function(a,b,c){this.submitSound.play();sc.menu.switchSynopsisPage(c==1?1:-1);return{skipSounds:true}},
onTabChanged:function(a){sc.menu.setSynoTab(a);(ig.input.mouseGuiActive||this.currentGroup.isEmpty())&&sc.menu.setSynopInfo(null,true)},onTabButtonCreation:function(a,b,c){a=new sc.ItemTabbedBox.TabButton(ig.lang.get("sc.gui.menu.lore.tabs."+a),"lore-"+a,115);a.onPressedChange=function(a){a?this.newUnlock.setPos(4,4):this.newUnlock.setPos(2,2)};b=new sc.NewUnlockOverlay;b.deactivate(false);b.setPos(2,2);a.addChildGui(b);a.newUnlock=b;a.textChild.setPos(7,1);a.setPos(0,2);a.setData({type:c.type});
this.addChildGui(a);return a},onTabPressed:function(a,b){if(!b){this.submitSound.play();this.setTab(this.getButtonIndex(a));for(var c=this.tabArray.length;c--;)if(a==this.tabArray[c]){sc.menu.setSynoTab(c);break}sc.menu.setSynopInfo(null,true);return false}},onTabSelected:function(){ig.input.mouseGuiActive&&sc.menu.setSynopInfo(null,true)},onTabMouseFocusLost:function(){sc.menu.setSynopInfo(null,true)},onCreateListEntries:function(a,d,c,e){var f=null,g=f=null,h=null,g=null,i=sc.lore.getCategoryList(c,
e);a.clear();d.clear();for(var d="\\i[lore-"+this.getCurrentTabKey()+"]",j=b.length=0;j<i.length;j++){h=i[j];g=sc.lore.getLore(h);if(ig.perf.fullLoreList||sc.lore.isLoreAvailable(h)){if(!g.extension||ig.extensions.hasExtension(g.extension)){f=d+ig.LangLabel.getText(g.title);if(g.parent){f=new sc.LoreEntryButton(f,h,c,true,true);g=new ig.ImageGui(this.gfx,541,208,14,15);g.setPos(-16,1);f.addChildGui(g);e==sc.LORE_SORT_TYPE.ORDER?a.addButton(f,null,22):b.push(h)}else{f=new sc.LoreEntryButton(f,h,c,
true);a.addButton(f)}}}else if((!g.extension||ig.extensions.hasExtension(g.extension))&&this.showLockedEntries(c))if(g.parent&&sc.lore.isLoreAvailable(g.parent)){f=d+"??????????????????";f=new sc.LoreEntryButton(f,h,c,null,true);g=new ig.ImageGui(this.gfx,541,208,14,15);g.setPos(-16,1);f.addChildGui(g);f.setActive(false);a.addButton(f,null,22)}else{f=d+"??????????????????";f=new sc.LoreEntryButton(f,h,c);f.setActive(false);a.addButton(f)}}if(b.length>=1){j=b.length;for(e=a.getChildren().length;j--;){g=
sc.lore.getLore(b[j]);h=this.findParentIndex(g.parent,a.getChildren());if(h>=0){f=d+ig.LangLabel.getText(g.title);f=new sc.LoreEntryButton(f,b[j],c,true,true);g=new ig.ImageGui(this.gfx,541,208,14,15);g.setPos(-16,1);f.addChildGui(g);h==e-1?a.addButton(f,null,22):a.insertButton(f,h+1,null,null,null,true);f.hook.pos.x=22}}}},findParentIndex:function(a,b){for(var c=b.length;c--;)if(b[c].gui.key==a)return c;return-1},onListEntrySelected:function(a){if(a.key){sc.menu.setSynopInfo(a.key);a.overlay&&this.newList.push(a);
sc.menu.setInfoText(null)}else{sc.menu.setSynopInfo(a.key);a.data&&(a.data instanceof Object||sc.menu.setInfoText(a.data))}},onListMouseFocusLost:function(){sc.menu.setSynopInfo(null,true);sc.menu.setInfoText(null,true)},showLockedEntries:function(a){return a!=sc.LORE_CATERGORIES.STORY},modelChanged:function(a,b,c){if(a==sc.menu)if(b==sc.MENU_EVENT.SORT_LIST){this.sort(c.data.sortType);sc.menu.setSynopInfo(null,true);sc.menu.setInfoText(null,true)}else b==sc.MENU_EVENT.SYNO_CHANGED_TAB&&(this.canShowCompletion(this.currentTabIndex)?
this.completion.doStateTransition("DEFAULT"):this.completion.doStateTransition("HIDDEN"))},canShowCompletion:function(a){switch(a){case 0:return false;case 1:return true;case 2:return true;case 3:return true;case 4:return true;case 5:return true}}})});ig.baked=!0;
ig.module("game.feature.menu.gui.lore.lore-menu").requires("impact.feature.gui.gui","impact.feature.gui.base.basic-gui","game.feature.menu.gui.base-menu","game.feature.menu.gui.menu-misc","game.feature.control.control","game.feature.menu.gui.lore.lore-list").defines(function(){sc.LoreMenu=sc.BaseMenu.extend({hotkeyHelp:null,hotkeySort:null,helpGui:null,list:null,info:null,sortMenu:null,init:function(){this.parent();this.hook.size.x=ig.system.width;this.hook.size.y=ig.system.height;this.list=new sc.LoreListBoxNew;
this.list.setPos(8,29);this.addChildGui(this.list);this.list.doStateTransition("HIDDEN",true);this.info=new sc.LoreInfoBox;this.info.setPos(8,29);this.addChildGui(this.info);this.info.doStateTransition("HIDDEN",true);this.hotkeyHelp=new sc.ButtonGui("\\i[help]"+ig.lang.get("sc.gui.menu.hotkeys.help"),void 0,true,sc.BUTTON_TYPE.SMALL);this.hotkeyHelp.keepMouseFocus=true;this.hotkeyHelp.hook.transitions={DEFAULT:{state:{},time:0.2,timeFunction:KEY_SPLINES.EASE},HIDDEN:{state:{offsetY:-this.hotkeyHelp.hook.size.y},
time:0.2,timeFunction:KEY_SPLINES.LINEAR}};this.hotkeyHelp.onButtonPress=this.onHelpButtonPressed.bind(this);this.hotkeySort=new sc.ButtonGui("\\i[help3]"+ig.lang.get("sc.gui.menu.item.sort-title"),void 0,true,sc.BUTTON_TYPE.SMALL);this.hotkeySort.keepMouseFocus=true;this.hotkeySort.hook.transitions={DEFAULT:{state:{},time:0.2,timeFunction:KEY_SPLINES.EASE},HIDDEN:{state:{offsetY:-this.hotkeySort.hook.size.y},time:0.2,timeFunction:KEY_SPLINES.LINEAR}};this.hotkeySort.onButtonPress=this.onSortButtonPress.bind(this);
this.sortMenu=new sc.SortMenu(this.onExecuteSort.bind(this));this.sortMenu.addButton("auto",sc.LORE_SORT_TYPE.ORDER,0);this.sortMenu.addButton("name",sc.LORE_SORT_TYPE.NAME,1);this.sortMenu.addButton("unlocked",sc.LORE_SORT_TYPE.UNLOCKED,2);this.doStateTransition("DEFAULT")},addObservers:function(){sc.Model.addObserver(sc.menu,this);this.list.addObservers()},removeObservers:function(){sc.Model.removeObserver(sc.menu,this);this.list.removeObservers()},showMenu:function(){this.addObservers();sc.menu.setSynopInfo(null,
false);sc.menu.pushBackCallback(this.onBackButtonPress.bind(this));sc.menu.moveLeaSprite(0,0,sc.MENU_LEA_STATE.HIDDEN);ig.interact.setBlockDelay(0.2);this.updateSortMenuButton(this.list.getCurrentSortText());this.list.show();this.info.show();this.info.setCategory(this.list.getCurrentTabKey());this.onAddHotkeys()},hideMenu:function(){this.removeObservers();sc.menu.moveLeaSprite(0,0,sc.MENU_LEA_STATE.LARGE);this.exitMenu()},exitMenu:function(){sc.menu.buttonInteract.removeGlobalButton(this.hotkeyHelp);
sc.menu.buttonInteract.removeGlobalButton(this.hotkeySort);this.list.hide();this.info.hide();this.helpGui=null;this.sortMenu.active&&this.sortMenu.hideSortMenu();ig.cleanCache()},onHotkeyHelpCheck:function(){return sc.control.menuHotkeyHelp()},onHelpButtonPressed:function(){sc.menu.removeHotkeys();this.createHelpGui();ig.gui.addGuiElement(this.helpGui);this.helpGui.openMenu()},onHotkeySortCheck:function(){return sc.control.menuHotkeyHelp3()},onSortButtonPress:function(){if(this.sortMenu.active)this.sortMenu.hideSortMenu();
else{ig.gui.addGuiElement(this.sortMenu);this.sortMenu.showSortMenu(this.hotkeySort)}},onExecuteSort:function(b){if(b.data){this.sortMenu.hideSortMenu();sc.menu.sortList(b)}},createHelpGui:function(){if(!this.helpGui){this.helpGui=new sc.HelpScreen(this,ig.lang.get("sc.gui.menu.help-texts.lore.title"),ig.lang.get("sc.gui.menu.help-texts.lore.pages"),function(){this.commitHotKeysToTopBar(true)}.bind(this),true);this.helpGui.hook.zIndex=15E4;this.helpGui.hook.pauseGui=true}},onAddHotkeys:function(b){sc.menu.buttonInteract.addGlobalButton(this.hotkeyHelp,
this.onHotkeyHelpCheck.bind(this));sc.menu.buttonInteract.addGlobalButton(this.hotkeySort,this.onHotkeySortCheck.bind(this));this.commitHotKeysToTopBar(b)},commitHotKeysToTopBar:function(b){sc.menu.addHotkey(function(){return this.hotkeySort}.bind(this));sc.menu.addHotkey(function(){return this.hotkeyHelp}.bind(this));sc.menu.commitHotkeys(b)},onBackButtonPress:function(){sc.menu.popBackCallback();sc.menu.popMenu()},updateSortMenuButton:function(b){var a="\\i[help3]"+ig.lang.get("sc.gui.menu.item.sort-title")+
": ";this.hotkeySort.setText(a+("\\c[3]"+b+"\\c[0]"));sc.menu.updateHotkeys()},modelChanged:function(b,a,d){if(b==sc.menu)if(a==sc.MENU_EVENT.SORT_LIST)this.updateSortMenuButton(d.text);else if(a==sc.MENU_EVENT.SYNO_CHANGED_TAB){this.info.clearFocus();this.sortMenu.active&&this.sortMenu.hideSortMenu();this.info.setCategory(this.list.getCurrentTabKey());this.updateSortMenuButton(this.list.getCurrentSortText())}else a==sc.MENU_EVENT.SYNOP_FOCUS?this.info.setFocus(d):a==sc.MENU_EVENT.SYNOP_SET_INFO&&
this.info.setLore(sc.menu.synopInfo)}})});ig.baked=!0;
ig.module("game.feature.menu.gui.status.status-misc").requires("impact.feature.gui.gui","impact.feature.gui.base.basic-gui","game.feature.menu.gui.menu-misc").defines(function(){var b=["#8bb5ff","#ba0000","#0036d0","#a121bc","#00994c","#c7c7c7"];sc.StatusPageSwitch=ig.GuiElementBase.extend({transitions:{DEFAULT:{state:{},time:0.2,timeFunction:KEY_SPLINES.LINEAR},HIDDEN:{state:{offsetX:-195,alpha:0},time:0.2,timeFunction:KEY_SPLINES.LINEAR}},left:null,right:null,text:null,init:function(){this.parent();
this.setAlign(ig.GUI_ALIGN.X_RIGHT,ig.GUI_ALIGN.Y_TOP);this.setSize(170,21);this.setPos(25,27);this.hook.localAlpha=0.5;this.text=new sc.TextGui("NONE");this.text.setAlign(ig.GUI_ALIGN.X_CENTER,ig.GUI_ALIGN.Y_CENTER);this.addChildGui(this.text);this.annotation={type:"INFO",content:{title:"sc.gui.menu.help.status.titles.page",description:"sc.gui.menu.help.status.description.page"},offset:{x:38,y:0},size:{x:94,y:21,offX:6}};this.left=new sc.ButtonGui("\\i[arrow-left]",34,true,sc.BUTTON_TYPE.SMALL);
this.left.submitSound=null;this.left.keepMouseFocus=true;this.left.setPos(0,0);this.left.onButtonPress=function(){this.updateStatusPage(-1)}.bind(this);this.addChildGui(this.left);this.right=new sc.ButtonGui("\\i[arrow-right]",34,true,sc.BUTTON_TYPE.SMALL);this.right.setAlign(ig.GUI_ALIGN.X_RIGHT,ig.GUI_ALIGN.Y_TOP);this.right.submitSound=null;this.right.keepMouseFocus=true;this.right.onButtonPress=function(){this.updateStatusPage(1)}.bind(this);this.addChildGui(this.right);this.doStateTransition("HIDDEN",
true)},updateDrawables:function(a){a.addColor("#000",8,0,this.hook.size.x-16,this.hook.size.y)},show:function(){this.updateCurrentPageName();sc.menu.buttonInteract.addGlobalButton(this.left,this.onLeftPressCheck.bind(this));sc.menu.buttonInteract.addGlobalButton(this.right,this.onRightPressCheck.bind(this));this.doStateTransition("DEFAULT")},hide:function(){sc.menu.buttonInteract.removeGlobalButton(this.left);sc.menu.buttonInteract.removeGlobalButton(this.right);this.doStateTransition("HIDDEN")},
updateCurrentPageName:function(){var a=ig.lang.get("sc.gui.menu.status.pages");this.text.setText(a[sc.menu.statusPage])},updateStatusPage:function(a){var b=sc.menu.statusPage,c=b;if(a>0){b++;b>=sc.MENU_STATUS_PAGES_LENGTH&&(b=0)}else{b--;b<0&&(b=sc.MENU_STATUS_PAGES_LENGTH-1)}if(c!=b){sc.BUTTON_SOUND.submit.play();sc.menu.setStatusPage(b);this.updateCurrentPageName()}},onLeftPressCheck:function(){return ig.interact.isBlocked()?false:sc.control.menuCircleLeft()},onRightPressCheck:function(){return ig.interact.isBlocked()?
false:sc.control.menuCircleRight()}});sc.StatusElementSwitch=ig.GuiElementBase.extend({gfx:new ig.Image("media/gui/status-gui.png"),transitions:{DEFAULT:{state:{},time:0.2,timeFunction:KEY_SPLINES.LINEAR},HIDDEN:{state:{offsetX:-195,alpha:0},time:0.2,timeFunction:KEY_SPLINES.LINEAR}},left:null,right:null,icon:null,init:function(){this.parent();this.setSize(108,21);this.setPos(25,27);this.hook.localAlpha=0.5;this.icon=new ig.ImageGui(this.gfx,104,32,24,24);this.icon.setPos(0,1);this.icon.setAlign(ig.GUI_ALIGN.X_CENTER,
ig.GUI_ALIGN.Y_CENTER);this.addChildGui(this.icon);this.icon.annotation={content:{title:"sc.gui.menu.help.status.titles.element",description:"sc.gui.menu.help.status.description.element"},offset:{x:0,y:1},size:{x:23,y:21},index:{x:0}};this.left=new sc.ButtonGui("\\i[page-left]",32,true,sc.BUTTON_TYPE.SMALL);this.left.submitSound=null;this.left.textChild.setPos(1,0);this.left.keepMouseFocus=true;this.left.setPos(0,0);this.left.onButtonPress=function(){this.updateElement(-1)}.bind(this);this.addChildGui(this.left);
this.right=new sc.ButtonGui("\\i[page-right]",32,true,sc.BUTTON_TYPE.SMALL);this.right.setAlign(ig.GUI_ALIGN.X_RIGHT,ig.GUI_ALIGN.Y_TOP);this.right.textChild.setPos(1,0);this.right.submitSound=null;this.right.keepMouseFocus=true;this.right.onButtonPress=function(){this.updateElement(1)}.bind(this);this.addChildGui(this.right);this.doStateTransition("HIDDEN",true)},updateDrawables:function(a){a.addColor("#000",8,0,this.hook.size.x-16,this.hook.size.y)},show:function(){this.updateCurrentElementIcon();
sc.menu.buttonInteract.addGlobalButton(this.left,this.onLeftPressCheck.bind(this));sc.menu.buttonInteract.addGlobalButton(this.right,this.onRightPressCheck.bind(this));this.doStateTransition("DEFAULT")},hide:function(){sc.menu.buttonInteract.removeGlobalButton(this.left);sc.menu.buttonInteract.removeGlobalButton(this.right);this.doStateTransition("HIDDEN")},updateCurrentElementIcon:function(){this.icon.offsetY=32+24*sc.menu.statusElement},updateElement:function(a){var b=sc.menu.statusElement,c=sc.menu.statusElement,
e=sc.model.player;do{c=c+a;a>0?c>4&&(c=0):c<0&&(c=4)}while(!e.hasElement(c));if(b!=c){sc.BUTTON_SOUND.submit.play();sc.menu.setStatusElement(c);this.updateCurrentElementIcon()}},onLeftPressCheck:function(){return sc.control.leftPressed()},onRightPressCheck:function(){return sc.control.rightPressed()}});sc.StatusParamBar=ig.GuiElementBase.extend({gfx:new ig.Image("media/gui/menu.png"),name:"nope.",lineID:0,iconID:0,usePercent:false,iconIndex:Vec2.createC(0,0),skipVertLine:false,base:null,equip:null,
skills:null,equipAdd:null,skillAdd:null,description:null,guis:[],_baseRed:false,_equipRed:false,_skillsRed:false,_hideAll:false,_skillHidden:false,_noPercent:false,init:function(a,b,c,e,f,g,h,i,j){this.parent();this.setSize(Math.max(c||169,169),24);this.name=a||"nope.";this.lineID=e||0;this.iconID=f||0;this.usePercent=g||false;this._skillHidden=h||false;this._noPercent=i||false;this.iconIndex.x=this.iconID%sc.MODIFIER_ICON_DRAW.MAX_PER_ROW;this.iconIndex.y=Math.floor(this.iconID/sc.MODIFIER_ICON_DRAW.MAX_PER_ROW);
this.nameGui=new sc.TextGui(a,{font:sc.fontsystem.tinyFont});this.nameGui.setPos(13,3);this.addChildGui(this.nameGui);a=this.usePercent?999:9999;j&&(a=999);this.base=new sc.NumberGui(a,{signed:this.usePercent,transitionTime:0.2});this.base.setPos(83-(this.usePercent?8:0),3);this.base.setNumber(0,true);this.guis.push(this.base);this.addTransitions(this.base);this.addChildGui(this.base);if(j)this.base.hook.pos.x=this.base.hook.pos.x+8;this.equip=new sc.NumberGui(a,{signed:this.usePercent,transitionTime:0.2});
this.equip.setPos(127-(this.usePercent?8:0),3);this.equip.setNumber(0,true);this.guis.push(this.equip);this.addTransitions(this.equip);this.addChildGui(this.equip);if(j)this.equip.hook.pos.x=this.equip.hook.pos.x+8;this.equipAdd=new sc.NumberGui(a,{signed:this.usePercent,transitionTime:0.2,color:sc.GUI_NUMBER_COLOR.GREY});this.equipAdd.showPlus=true;this.equipAdd.showPlusOnZero=true;this.equipAdd.setPos(127-(this.usePercent?8:0),13);this.addTransitions(this.equipAdd);this.guis.push(this.equipAdd);
this.equipAdd.doStateTransition("HIDDEN",true);this.addChildGui(this.equipAdd);if(j)this.equipAdd.hook.pos.x=this.equipAdd.hook.pos.x+8;this.skills=new sc.NumberGui(a,{signed:this.usePercent,transitionTime:0.2});this.skills.setPos(171-(this.usePercent?8:0),3);this.skills.setNumber(0,true);this.guis.push(this.skills);this.addTransitions(this.skills);this.addChildGui(this.skills);if(j)this.skills.hook.pos.x=this.skills.hook.pos.x+8;h&&this.skills.doStateTransition("HIDDEN",true);this.skillAdd=new sc.NumberGui(a,
{signed:this.usePercent,transitionTime:0.2,color:sc.GUI_NUMBER_COLOR.GREY});this.skillAdd.showPlus=true;this.skillAdd.showPlusOnZero=true;this.skillAdd.setPos(171-(this.usePercent?8:0),13);this.skillAdd.setNumber(0,true);this.addTransitions(this.skillAdd);this.guis.push(this.skillAdd);this.skillAdd.doStateTransition("HIDDEN",true);this.addChildGui(this.skillAdd);if(j)this.skillAdd.hook.pos.x=this.skillAdd.hook.pos.x+8;j=new ig.ImageGui(this.gfx,6,321,4,6);j.setPos(119,4);this.guis.push(j);this.addTransitions(j);
this.addChildGui(j);j=new ig.ImageGui(this.gfx,6,321,4,6);j.setPos(163,4);this.guis.push(j);this.addTransitions(j);this.addChildGui(j);h&&j.doStateTransition("HIDDEN",true);this.description=new sc.TextGui(b,{font:sc.fontsystem.smallFont,maxWidth:294+(this._skillHidden?44:0),linePadding:-3});this.description.setPos(214-(this._skillHidden?44:0),0);this.addChildGui(this.description)},updateValues:function(a,b,c,e,f,g,h){this.base.setNumber(a,e);this.equip.setNumber(b,e);this.skills.setNumber(c,e);this.base.color=
sc.GUI_NUMBER_COLOR.WHITE;this.equip.color=sc.GUI_NUMBER_COLOR.WHITE;this.skills.color=sc.GUI_NUMBER_COLOR.WHITE;this._baseRed=this._equipRed=this._skillsRed=false;if(h){if(a<0){this.base.color=sc.GUI_NUMBER_COLOR.RED;this._baseRed=true}if(b<0){this.equip.color=sc.GUI_NUMBER_COLOR.RED;this._equipRed=true}if(c<0){this.skills.color=sc.GUI_NUMBER_COLOR.RED;this._skillsRed=true}}if(sc.menu.statusDiff&&!this._noPercent){this.equipAdd.doStateTransition("DEFAULT",true);this._skillHidden||this.skillAdd.doStateTransition("DEFAULT",
true);this.equipAdd.setNumber(f||0);this.skillAdd.setNumber(g||0)}else{this.equipAdd.doStateTransition("HIDDEN",true);this._skillHidden||this.skillAdd.doStateTransition("HIDDEN",true);this.equipAdd.setNumber(0,true);this.skillAdd.setNumber(0,true)}},hideValues:function(a){for(var b=this.guis.length;b--;)this.guis[b].doStateTransition("HIDDEN",a);this._hideAll=true},updateDrawables:function(a){this.parent(a);var d=0,c=this.lineID*12,d=this.hook.size.x;if(this._hideAll){a.addColor(b[this.lineID],0,
10,152,1);a.addGfx(this.gfx,152,0,71,389,13,11);a.addColor(b[this.lineID],165,0,d-244,1)}else{a.addGfx(this.gfx,0,0,0,329+c,90,11);a.addColor(b[this.lineID],90,0,d-90-79,1)}a.addGfx(this.gfx,d-79,0,90,329+c,79,1);this.skipVertLine||a.addColor(b[this.lineID],209-(this._skillHidden?44:0),0,1,this.hook.size.y);if(this.usePercent&&!this._hideAll){a.addGfx(this.gfx,107,3,this._baseRed?9:0,407,8,8);a.addGfx(this.gfx,151,3,this._equipRed?9:0,407,8,8);this._skillHidden||a.addGfx(this.gfx,195,3,this._skillsRed?
9:0,407,8,8);if(sc.menu.statusDiff){a.addGfx(this.gfx,151,13,0,416,8,8);this._skillHidden||a.addGfx(this.gfx,195,13,0,416,8,8)}}d=this.iconIndex.x*12;c=this.iconIndex.y*12;a.addGfx(this.gfx,0,0,sc.MODIFIER_ICON_DRAW.X+d,sc.MODIFIER_ICON_DRAW.Y+c,11,11)},addTransitions:function(a){a.hook.transitions={DEFAULT:{state:{},time:0.2,timeFunction:KEY_SPLINES.LINEAR},HIDDEN:{state:{alpha:0},time:0.2,timeFunction:KEY_SPLINES.LINEAR}}}})});ig.baked=!0;
ig.module("game.feature.menu.gui.status.status-view-main").requires("impact.feature.gui.gui","impact.feature.gui.base.basic-gui","game.feature.menu.gui.menu-misc").defines(function(){function b(a,b){return Math.round(-(b[a]-1)*100)/100}sc.StatusViewMain=ig.GuiElementBase.extend({transitions:{DEFAULT:{state:{},time:0.2,timeFunction:KEY_SPLINES.LINEAR},HIDDEN:{state:{alpha:0},time:0.2,timeFunction:KEY_SPLINES.LINEAR}},params:null,equip:null,init:function(){this.parent();this.setSize(ig.system.width,
ig.system.height);this.params=new sc.StatusViewMainParameters;this.addChildGui(this.params);this.equip=new sc.StatusViewMainEquipment;this.addChildGui(this.equip);this.hide(true)},show:function(){this.params.show();this.equip.show()},hide:function(a){this.params.hide(a);this.equip.hide(a)},updatePage:function(){this.params.updateValues()}});sc.StatusViewMainEquipment=sc.MenuPanel.extend({transitions:{DEFAULT:{state:{},time:0.2,timeFunction:KEY_SPLINES.LINEAR},HIDDEN:{state:{alpha:0,offsetX:-190},
time:0.2,timeFunction:KEY_SPLINES.LINEAR}},bodyparts:{},init:function(){this.parent(sc.MenuPanelType.TOP_LEFT_EDGE);this.setAlign(ig.GUI_ALIGN.X_RIGHT,ig.GUI_ALIGN.Y_TOP);this.setSize(165,135);this.setPos(25,59);var a=5,a=a+(this.createEntry("head",0,a)+3),a=a+(this.createEntry("rightarm",0,a)+3),a=a+(this.createEntry("leftarm",0,a)+3),a=a+(this.createEntry("torso",0,a)+3);this.createEntry("feet",0,a);this.doStateTransition("HIDDEN",true)},show:function(){this.updateValues();this.doStateTransition("DEFAULT")},
hide:function(){this.doStateTransition("HIDDEN")},updateValues:function(){for(var a in this.bodyparts)this.bodyparts[a].setItem(this.getEquipID(a))},createEntry:function(a,b,c){var e=new sc.StatusViewMainEquipment.Entry(a);e.setPos(b,c);this.addChildGui(e);this.bodyparts[a]=e;return e.hook.size.y},getEquipID:function(a){var b=sc.model.player;switch(a){case "head":return b.equip.head;case "rightarm":return b.equip.rightArm;case "leftarm":return b.equip.leftArm;case "torso":return b.equip.torso;case "feet":return b.equip.feet}}});
sc.StatusViewMainEquipment.Entry=ig.GuiElementBase.extend({gfx:new ig.Image("media/gui/menu.png"),textGui:null,itemGui:null,bodypart:null,init:function(a){this.parent();this.setSize(165,23);this.bodypart=a||"head";this.textGui=new sc.TextGui(ig.lang.get("sc.gui.menu.equip."+a),{font:sc.fontsystem.tinyFont});this.textGui.setPos(4,0);this.addChildGui(this.textGui);this.itemGui=new sc.TextGui("\\i[item-default]Generic Equipment");this.itemGui.setPos(13,7);this.addChildGui(this.itemGui)},updateDrawables:function(a){a.addGfx(this.gfx,
0,7,0,403,165,1)},setItem:function(a){if(a<0){this.itemGui.setText("--------------------");this.itemGui.setDrawCallback(null)}else{var b=sc.inventory.getItemLevel(a);this.itemGui.setText(sc.inventory.getItemNameWithIcon(a));this.itemGui.level=b;this.itemGui.isScalable=sc.inventory.isScalable(a);this.itemGui.numberGfx=this.gfx;this.itemGui.setDrawCallback(function(a,b){sc.MenuHelper.drawLevel(this.level,a,b,this.numberGfx,this.isScalable)}.bind(this.itemGui))}}});sc.StatusViewMainParameters=sc.MenuPanel.extend({menuGfx:new ig.Image("media/gui/menu.png"),
statusGfx:new ig.Image("media/gui/status-gui.png"),transitions:{DEFAULT:{state:{},time:0.2,timeFunction:KEY_SPLINES.LINEAR},HIDDEN:{state:{alpha:0,offsetX:-151},time:0.2,timeFunction:KEY_SPLINES.LINEAR}},level:null,hpBar:null,spBar:null,expBar:null,baseParams:{hp:null,atk:null,def:null,foc:null,fire:null,cold:null,shock:null,wave:null},skinGfx:null,bounds:null,init:function(){this.parent(sc.MenuPanelType.TOP_RIGHT_EDGE);this.setSize(126,215);this.setPos(25,59);this.level=new sc.NumberGui(99,{size:sc.NUMBER_SIZE.LARGE});
this.level.setAlign(ig.GUI_ALIGN.X_RIGHT,ig.GUI_ALIGN.Y_TOP);this.level.setPos(3,2);this.addChildGui(this.level);this.hpBar=new sc.ItemStatusDefaultBar("HP",sc.MENU_BAR_TYPE.HP);this.hpBar.setPos(0,39);this.addChildGui(this.hpBar);this.hpBar.updateValues(true);this.hpBar.annotation={size:{x:this.hpBar.hook.size.x+2,y:this.hpBar.hook.size.y+2},offset:{x:-1,y:-1},content:{title:"sc.gui.menu.help.item.titles.hp",description:"sc.gui.menu.help.item.description.hp"},index:{x:0}};this.spBar=new sc.ItemStatusDefaultBar("SP",
sc.MENU_BAR_TYPE.SP);this.spBar.setPos(0,57);this.addChildGui(this.spBar);this.spBar.updateValues(true);this.spBar.annotation={size:{x:this.spBar.hook.size.x+2,y:this.spBar.hook.size.y+2},offset:{x:-1,y:-1},content:{title:"sc.gui.menu.help.item.titles.sp",description:"sc.gui.menu.help.item.description.sp"},index:{x:0}};this.expBar=new sc.ItemStatusDefaultBar("EXP",sc.MENU_BAR_TYPE.EXP);this.expBar.setPos(0,77);this.addChildGui(this.expBar);this.expBar.updateValues(true);this.expBar.annotation={size:{x:this.expBar.hook.size.x+
2,y:this.expBar.hook.size.y+2},offset:{x:-1,y:-1},content:{title:"sc.gui.menu.help.item.titles.exp",description:"sc.gui.menu.help.item.description.exp"},index:{x:0}};var a=97;this.baseParams.hp=this.createStatusDisplay(0,a,"maxhp",0,0,false,9999);a=a+14;this.baseParams.atk=this.createStatusDisplay(0,a,"atk",0,1,false,999);a=a+14;this.baseParams.def=this.createStatusDisplay(0,a,"def",0,2,false,999);a=a+14;this.baseParams.foc=this.createStatusDisplay(0,a,"foc",0,3,false,999);a=a+18;this.baseParams.fire=
this.createStatusDisplay(0,a,"res",1,4,true,999);a=a+14;this.baseParams.cold=this.createStatusDisplay(0,a,"res",2,5,true,999);a=a+14;this.baseParams.shock=this.createStatusDisplay(0,a,"res",3,6,true,999);this.baseParams.wave=this.createStatusDisplay(0,a+14,"res",4,7,true,999);this.doStateTransition("HIDDEN",true)},updateDrawables:function(a){this.parent(a);a.addGfx(this.menuGfx,0,0,280,472,126,35);this.skinGfx&&this.bounds?a.addGfx(this.skinGfx,0,0,this.bounds.x,this.bounds.y,this.bounds.w,this.bounds.h):
a.addGfx(this.menuGfx,0,0,211,26,60,34);a.addGfx(this.statusGfx,64,5,104,32+sc.model.player.currentElementMode*24,24,24)},show:function(){this.updateValues(true);this.checkSkin();this.doStateTransition("DEFAULT")},hide:function(a){this.doStateTransition("HIDDEN",a)},checkSkin:function(){var a=sc.playerSkins.getCurrentSkin("Appearance");if(a&&a.loaded){this.skinGfx=a.guiImage;this.bounds=a.guiImageBounds?a.guiImageBounds.face||null:null}else this.bounds=this.skinGfx=null},createStatusDisplay:function(a,
b,c,e,f,g,h){f=new sc.SimpleStatusDisplay(ig.lang.get("sc.gui.menu.equip."+c),e,f,g,h,true,126);f.changeValueGui.numTransitionTime=0.2;if(!g){f.changeValueGui.showPlus=false;f.stayWhite=true}f.setPos(a,b);if(c=="res"){e==1&&(c="heat");e==2&&(c="cold");e==3&&(c="shock");e==4&&(c="wave")}f.annotation={type:"INFO",content:{title:"sc.gui.menu.equip."+c,description:"sc.gui.menu.equip.descriptions."+c},offset:{x:-1,y:-1},index:{x:0}};this.addChildGui(f);return f},updateValues:function(a){this.level.setNumber(sc.model.player.level);
this.hpBar.updateValues(a);this.expBar.updateValues(a);this.spBar.updateValues(a);var d=sc.model.player,c=d.getCurrentElementMode(),e=d.elementConfigs[sc.menu.statusElement],c=e.getParam("hp")-(c.getParam("hp")-d.params.currentHp);this.hpBar.updateValues(a,d,c,e.getParam("hp"));this.baseParams.hp.setChangeValue(e.getParam("hp")||0,a);this.baseParams.atk.setChangeValue(e.getParam("attack")||0,a);this.baseParams.def.setChangeValue(e.getParam("defense")||0,a);this.baseParams.foc.setChangeValue(e.getParam("focus")||
0,a);d=e.getParam("elemFactor");this.baseParams.fire.setChangeValue(b(0,d),a,true);this.baseParams.cold.setChangeValue(b(1,d),a,true);this.baseParams.shock.setChangeValue(b(2,d),a,true);this.baseParams.wave.setChangeValue(b(3,d),a,true)}})});ig.baked=!0;
ig.module("game.feature.menu.gui.stats.stats-gui-builds").defines(function(){sc.STATS_CATEGORY={GENERAL:0,COMBAT:1,ITEMS:2,QUESTS:3,EXPLORATION:4,MISC:5,LOG:6,ARENA:7};sc.STATS_BUILD=[];sc.STATS_BUILD[sc.STATS_CATEGORY.GENERAL]={progressComplete:{highlight:{min:1},type:"Percent",calc:function(){var b;b=ig.vars.get("plot.line")||0;b=(b>=32E3?1:b/32E3)+sc.combat.getTotalEnemiesFound(true);b=b+sc.inventory.getTotalItemsUnlocked(true);b=b+sc.quests.getTotalQuestsSolved(true);b=b+sc.lore.getTotalLoreEntriesFound(true);
b=b+sc.map.getTotalLandmarksFound(true);b=b+sc.map.getTotalChestsFound(true);b=b+sc.map.getTotalAreasFound(true);b=b+sc.menu.getTotalDropsFoundAndCompleted(true);b=b+sc.combat.getTotalEnemyReportsFound(true);b=b+sc.trophies.getTotalTrophiesUnlocked(true);b=b+sc.trade.getTotalTradersFound(true);if(ig.vars.get("arenaVars.statsUnlocked")){b=b+sc.arena.getTotalArenaCompletion();return b/13}return b/12}},progressEnemies:{highlight:{min:1},inset:"progress",type:"Percent",calc:function(){var b=sc.combat.getTotalEnemiesFound(true),
b=b+sc.combat.getTotalEnemyReportsFound(true);return b/2}},progressCollection:{highlight:{min:1},type:"Percent",calc:function(){var b=sc.inventory.getTotalItemsUnlocked(true),b=b+sc.trade.getTotalTradersFound(true);return b/2}},progressExploration:{highlight:{min:1},type:"Percent",calc:function(){var b=sc.lore.getTotalLoreEntriesFound(true),b=b+sc.map.getTotalLandmarksFound(true),b=b+sc.map.getTotalAreasFound(true),b=b+sc.map.getTotalChestsFound(true),b=b+sc.menu.getTotalDropsFoundAndCompleted(true);
return b/5}},progressQuests:{highlight:{min:1},type:"Percent",calc:function(){return sc.quests.getTotalQuestsSolved(true)}},progressTrophies:{highlight:{min:1},type:"Percent",calc:function(){return sc.trophies.getTotalTrophiesUnlocked(true)}},progressArena:{highlight:{min:1},type:"Percent",calc:function(){return sc.arena.getTotalArenaCompletion()},condition:"arenaVars.statsUnlocked"},sepProg:{type:"Separator",group:"overview",deset:"progress"},playtime:{type:"Time",map:"player",update:true},assistTime:{type:"Time",
map:"player"},level:{type:"KeyValue",map:"player"},exp:{type:"KeyValue",map:"player"},expEnemies:{type:"KeyValuePercent",map:"player",maxMap:"player",maxStat:"exp",inset:"exp"},expQuest:{type:"KeyValuePercent",map:"quests",stat:"exp",maxMap:"player",maxStat:"exp"},expOther:{type:"KeyValuePercent",map:"player",maxMap:"player",maxStat:"exp"},money:{type:"KeyValue",map:"player",deset:"exp"},saves:{type:"KeyValue",map:"player"},jumps:{type:"KeyValue",map:"player"},steps:{type:"KeyValue",map:"player"},
meters:{type:"KeyValue",value:function(){var b=(sc.stats.getMap("player","steps")||0)*1.632;return b<1E3?Math.round(b):Math.floor(b/1E3)},postfix:function(){var b=(sc.stats.getMap("player","steps")||0)*1.632;if(b<1E3)return"m";var b=Math.floor(b)%1E3/10,a="0000"+Math.floor(b),b=a.length>=6?Math.floor(b):a.substr(a.length-2);return"."+b+"km"}},respawns:{type:"KeyValue",map:"player"},respWater:{type:"KeyValuePercent",map:"player",stat:"waterDeath",maxMap:"player",maxStat:"respawns",inset:"deaths"},
respHole:{type:"KeyValuePercent",map:"player",stat:"holeDeath",maxMap:"player",maxStat:"respawns"},respSand:{type:"KeyValuePercent",map:"player",stat:"sandDeath",maxMap:"player",maxStat:"respawns"},respCoal:{type:"KeyValuePercent",map:"player",stat:"coalDeath",maxMap:"player",maxStat:"respawns"},respHighway:{type:"KeyValuePercent",map:"player",stat:"highwayDeath",maxMap:"player",maxStat:"respawns"},teleports:{type:"KeyValue",map:"player",deset:"deaths"}};sc.STATS_BUILD[sc.STATS_CATEGORY.COMBAT]={enemies:{type:"Percent",
highlight:{min:1},calc:function(){return sc.combat.getTotalEnemiesFound(true)}},foundAnimals:{type:"Percent",highlight:{min:1},calc:function(){return sc.combat.getTotalEnemiesFound(true,"ANIMALS")},inset:"enemies"},foundMechas:{type:"Percent",highlight:{min:1},calc:function(){return sc.combat.getTotalEnemiesFound(true,"MECHA")}},foundPlayers:{type:"Percent",highlight:{min:1},calc:function(){return sc.combat.getTotalEnemiesFound(true,"PLAYERS")}},foundAbstract:{type:"Percent",highlight:{min:1},calc:function(){return sc.combat.getTotalEnemiesFound(true,
"ABSTRACT")}},enemyReports:{type:"Percent",highlight:{min:1},deset:"enemies",calc:function(){return sc.combat.getTotalEnemyReportsFound(true)}},sepFoundEnd:{type:"Separator",group:"overview"},timeCombat:{type:"Time",map:"combat",stat:"time",max:99,leading:2},kills:{type:"KeyValue",map:"combat",stat:"totalKilled"},enviroKills:{type:"KeyValue",map:"combat",inset:"kills"},boostedKills:{type:"KeyValue",map:"combat",hideNameIfNull:true},oneHitKills:{type:"KeyValue",map:"combat",hideNameIfNull:true},damageGiven:{type:"KeyValue",
map:"combat",deset:"kills"},maxDamage:{type:"KeyValue",map:"combat"},hitsTaken:{type:"KeyValue",map:"combat",stat:"damageHits"},damageTaken:{type:"KeyValue",map:"combat"},healed:{type:"KeyValue",map:"combat"},critHits:{type:"KeyValue",map:"combat"},critHitsClose:{type:"KeyValuePercent",map:"combat",maxMap:"combat",maxStat:"critHits",inset:"crits"},critHitsThrow:{type:"KeyValuePercent",map:"combat",maxMap:"combat",maxStat:"critHits"},streakTime:{type:"Time",map:"combat",max:99,leading:2,deset:"crits"},
streakKilled:{type:"KeyValue",map:"combat"},expEn:{type:"KeyValue",map:"player",stat:"expEnemies"},sepThrow:{type:"Separator",group:"throwing"},close:{type:"KeyValue",map:"player"},closeHits:{type:"KeyValue",map:"player",maxMap:"player",maxStat:"close"},aimingTime:{type:"Time",map:"combat",stat:"aiming",max:99,leading:2},"throws":{type:"KeyValue",map:"player"},throwHits:{type:"KeyValue",map:"player"},hitPercent:{type:"Percent",calc:function(){return Math.min(1,(sc.stats.getMap("player","throwHits")||
0)/(sc.stats.getMap("player","throws")||0)||0)},max:function(){}},sepGuard:{type:"Separator",group:"guarding"},dashTime:{type:"Time",map:"player",stat:"dashTime",max:99,leading:2},dash:{type:"KeyValue",map:"player"},perfectDash:{type:"KeyValue",map:"player"},atkDashCancel:{type:"KeyValue",map:"player"},guardTime:{type:"Time",map:"combat",stat:"guardTime",max:99,leading:2},shieldedHits:{type:"KeyValue",map:"combat"},perfectShield:{type:"KeyValuePercent",map:"combat",maxMap:"combat",maxStat:"shieldedHits",
inset:"shields"},guardCounters:{type:"KeyValue",map:"combat",deset:"shields"},shieldBreaks:{type:"KeyValue",map:"combat"},sepSpe:{type:"Separator",group:"combatArts"},chargeTime:{type:"Time",map:"combat",stat:"charging",max:99,leading:2},specials:{type:"KeyValue",map:"combat"},specialsClose:{type:"KeyValuePercent",map:"combat",maxMap:"combat",maxStat:"specials",inset:"specials"},specialsThrow:{type:"KeyValuePercent",map:"combat",maxMap:"combat",maxStat:"specials"},specialsDash:{type:"KeyValuePercent",
map:"combat",maxMap:"combat",maxStat:"specials"},specialsGuard:{type:"KeyValuePercent",map:"combat",maxMap:"combat",maxStat:"specials"},sepCircuits:{type:"Separator",group:"circuits",deset:"specials"},skills:{type:"KeyValue",map:"player"},skillsPassive:{type:"KeyValuePercent",map:"player",maxMap:"player",maxStat:"skills",inset:"skills"},skillsActive:{type:"KeyValuePercent",map:"player",maxMap:"player",maxStat:"skills"},branches:{type:"KeyValue",map:"player",deset:"skills"},skillPoints:{type:"KeyValue",
map:"player"},skillPoints0:{type:"KeyValuePercent",map:"player",maxMap:"player",maxStat:"skillPoints",inset:"points"},skillPoints1:{type:"KeyValuePercent",map:"player",maxMap:"player",maxStat:"skillPoints"},skillPoints2:{type:"KeyValuePercent",map:"player",maxMap:"player",maxStat:"skillPoints"},skillPoints3:{type:"KeyValuePercent",map:"player",maxMap:"player",maxStat:"skillPoints"},skillPoints4:{type:"KeyValuePercent",map:"player",maxMap:"player",maxStat:"skillPoints"},sepElements:{type:"Separator",
group:"elements",deset:"points"},elOverload:{type:"KeyValue",map:"element",stat:"overload"},elSwitches:{type:"KeyValue",max:99,leading:2,value:function(){var b=0,a;for(a in sc.ELEMENT)b=b+(sc.stats.getMap("element","used"+sc.ELEMENT[a])||0);return b}},elSwitchesNeutral:{type:"KeyValue",map:"element",stat:"used0",inset:"switches"},elSwitchesHeat:{type:"KeyValue",map:"element",stat:"used1",condition:"player.core.9"},elSwitchesCold:{type:"KeyValue",map:"element",stat:"used2",condition:"player.core.10"},
elSwitchesShock:{type:"KeyValue",map:"element",stat:"used3",condition:"player.core.11"},elSwitchesWave:{type:"KeyValue",map:"element",stat:"used4",condition:"player.core.12"},elTime:{type:"Time",max:99,leading:2,deset:"switches",value:function(){var b=0,a;for(a in sc.ELEMENT)a!="NEUTRAL"&&(b=b+(sc.stats.getMap("element","time"+sc.ELEMENT[a])||0));return b}},elTimeHeat:{type:"Time",map:"element",stat:"time1",max:99,leading:2,condition:"player.core.9",inset:"elements"},elTimeCold:{type:"Time",map:"element",
stat:"time2",max:99,leading:2,condition:"player.core.10"},elTimeShock:{type:"Time",map:"element",stat:"time3",max:99,leading:2,condition:"player.core.11"},elTimeWave:{type:"Time",map:"element",stat:"time4",max:99,leading:2,condition:"player.core.12"}};sc.STATS_BUILD[sc.STATS_CATEGORY.ITEMS]={tradersFound:{type:"Percent",highlight:{min:1},calc:function(){return sc.trade.getTotalTradersFound(true)}},items:{highlight:{min:1},type:"Percent",calc:function(){return sc.inventory.getTotalItemsUnlocked(true)}},
itemCons:{type:"Percent",highlight:{min:1},calc:function(){return sc.inventory.getTotalItemsUnlocked(true,"CONS")},inset:"items"},itemEquip:{type:"Percent",highlight:{min:1},calc:function(){return sc.inventory.getTotalItemsUnlocked(true,"EQUIP")}},itemEquipHead:{type:"Percent",highlight:{min:1},calc:function(){return sc.inventory.getTotalItemsUnlocked(true,"EQUIP","HEAD")},inset:"equip"},itemEquipArm:{type:"Percent",highlight:{min:1},calc:function(){return sc.inventory.getTotalItemsUnlocked(true,
"EQUIP","ARM")}},itemEquipTorso:{type:"Percent",highlight:{min:1},calc:function(){return sc.inventory.getTotalItemsUnlocked(true,"EQUIP","TORSO")}},itemEquipFeet:{type:"Percent",highlight:{min:1},calc:function(){return sc.inventory.getTotalItemsUnlocked(true,"EQUIP","FEET")}},itemTrade:{type:"Percent",highlight:{min:1},calc:function(){return sc.inventory.getTotalItemsUnlocked(true,"TRADE")},deset:"equip"},sepFoundEnd:{type:"Separator",group:"overview",deset:"items"},total:{type:"KeyValue",map:"items"},
used:{type:"KeyValue",map:"items"},dropsTotal:{type:"KeyValue",map:"items"},dropsProps:{type:"KeyValuePercent",map:"items",maxMap:"items",maxStat:"dropsTotal",inset:"drops"},dropsEnemies:{type:"KeyValuePercent",map:"items",maxMap:"items",maxStat:"dropsTotal"},buy:{type:"KeyValue",map:"items",deset:"drops"},sell:{type:"KeyValue",map:"items"},sepTra:{type:"Separator",group:"trades"},trades:{type:"KeyValue",map:"trade",stat:"total"},tradeGot:{type:"KeyValue",map:"trade",stat:"got"},tradeLost:{type:"KeyValue",
map:"trade",stat:"lost"},traderTotal:{type:"KeyCurMax",highlight:true,value:function(){return sc.trade.getTotalTradersFound()},max:function(){return sc.trade.getTotalTraders()},hide:function(){return sc.trade.getTotalTradersFound(true)<1&&!sc.map.hasAllAreasFound()}},tradersAreas:{type:"List",subtype:"KeyCurMax",list:function(){return sc.map.areas},getSettings:function(b){return!sc.map.getVisitedArea(b)||!sc.trade.hasAreaTraders(b)?null:{highlight:true,displayName:sc.map.getAreaName(b),value:function(){return sc.trade.getTotalTradersFound(false,
b)},max:function(){return sc.trade.getTotalTraders(b)}}},inset:"traders"}};sc.STATS_BUILD[sc.STATS_CATEGORY.EXPLORATION]={areas:{highlight:{min:1},type:"Percent",calc:function(){return sc.map.getTotalAreasFound(true)}},landmarks:{highlight:{min:1},type:"Percent",calc:function(){return sc.map.getTotalLandmarksFound(true)}},chests:{highlight:{min:1},type:"Percent",calc:function(){return sc.map.getTotalChestsFound(true)}},botanics:{highlight:{min:1},type:"Percent",calc:function(){return sc.menu.getTotalDropsFoundAndCompleted(true)}},
lories:{type:"Percent",calc:function(){return sc.lore.getTotalLoreEntriesFound(true)},highlight:{min:1}},loriesStory:{type:"Percent",calc:function(){return sc.lore.getTotalLoreEntriesFound(true,"STORY")},highlight:{min:1},scramble:true,frontLeading:2,inset:"lories"},loriesPeople:{type:"Percent",calc:function(){return sc.lore.getTotalLoreEntriesFound(true,"CHARACTERS")},highlight:{min:1}},loriesCross:{type:"Percent",calc:function(){return sc.lore.getTotalLoreEntriesFound(true,"CROSS_LORE")},highlight:{min:1}},
loriesEarth:{type:"Percent",calc:function(){return sc.lore.getTotalLoreEntriesFound(true,"EARTH_LORE")},highlight:{min:1}},sepOverview:{type:"Separator",group:"overview",deset:"lories"},areasFound:{type:"KeyValue",value:function(){return sc.map.getTotalAreasFound()}},landmarksFound:{type:"KeyValue",map:"exploration",stat:"landmarks"},loreFound:{type:"KeyValue",map:"exploration",stat:"lore"},sepBotanics:{type:"Separator",group:"botanics"},propsDestroyed:{type:"KeyValue",map:"player"},dropsTotalPlants:{type:"KeyValue",
map:"exploration",stat:"dropsTotal"},dropsCompleted:{type:"KeyValuePercent",map:"exploration",stat:"dropsCompleted",maxMap:"exploration",maxStat:"dropsTotal",inset:"drops"},sepChests:{type:"Separator",group:"chests",deset:"drops"},chestFound:{type:"KeyCurMax",highlight:true,value:function(){return sc.map.getTotalChestsFound()},max:function(){return sc.map.getTotalChests()},hide:function(){return!sc.map.hasAllAreasFound()}},chestAres:{type:"List",subtype:"KeyCurMax",list:function(){return sc.map.areas},
getSettings:function(b){return!sc.map.getVisitedArea(b)||!sc.map.areas[b].track||!sc.map.areas[b].chests?null:{highlight:true,displayName:sc.map.getAreaName(b,false,true),map:"chests",stat:b,max:function(){return sc.map.areas[b].chests}}},inset:"chests"}};sc.STATS_BUILD[sc.STATS_CATEGORY.QUESTS]={quests:{type:"Percent",highlight:{min:1},calc:function(){return sc.quests.getTotalQuestsSolved(true)}},sepOverview:{type:"Separator",group:"overview"},questTotal:{type:"KeyValue",map:"quests",stat:"solved"},
tasksTotal:{type:"KeyValue",map:"quests",stat:"tasks"},subTaskTotal:{type:"KeyValue",map:"quests",stat:"subtasks"},subTaskKill:{type:"KeyValuePercent",map:"quests",stat:"subtasksKILL",maxMap:"quests",maxStat:"subtasks",inset:"subtasks"},subTaskCol:{type:"KeyValuePercent",map:"quests",stat:"subtasksCOLLECT",maxMap:"quests",maxStat:"subtasks"},subTaskAct:{type:"KeyValuePercent",map:"quests",stat:"subtasksCONDITION",maxMap:"quests",maxStat:"subtasks"},subTaskQuest:{type:"KeyValuePercent",map:"quests",
stat:"subtasksQUEST",maxMap:"quests",maxStat:"subtasks"},subTaskLandmark:{type:"KeyValuePercent",map:"quests",stat:"subtasksLANDMARK",maxMap:"quests",maxStat:"subtasks"},questActive:{type:"KeyValue",map:"quests",stat:"active",deset:"subtasks"},rewardExp:{type:"KeyValue",map:"quests",stat:"exp"},rewardMoney:{type:"KeyValue",map:"quests",stat:"money"},rewardItems:{type:"KeyValue",map:"quests",stat:"rewards"},rewardCp:{type:"KeyValue",map:"quest",stat:"cp"},sepAreas:{type:"Separator",group:"questAreas"},
questAreas:{type:"List",subtype:"Percent",list:function(){return sc.map.areas},getSettings:function(b){return!sc.map.getVisitedArea(b)||!sc.map.areas[b].track||!sc.quests.hasAreaQuests(b)?null:{highlight:{min:1},displayName:sc.map.getAreaName(b),calc:function(){return sc.quests.getTotalQuestsSolved(true,b)}}}}};sc.STATS_BUILD[sc.STATS_CATEGORY.ARENA]={arenaCompletion:{highlight:{min:1},type:"Percent",calc:function(){return sc.arena.getTotalArenaCompletion()}},sepOverview:{type:"Separator",group:"overview"},
arenaTime:{type:"Time",map:"arena",stat:"time",max:999,leading:3},arenaScore:{type:"KeyValue",map:"arena",stat:"score"},arenaKills:{type:"KeyValue",map:"arena",stat:"kills"},roundsDone:{type:"KeyValue",map:"arena",stat:"roundsCleared"},roundsFailed:{type:"KeyValue",map:"arena",stat:"deaths"},rushDone:{type:"KeyValue",map:"arena",stat:"rushCleared"},totalCoins:{type:"KeyValue",value:function(){return sc.arena.getTotalArenaCoins()+sc.arena.coinsSpend}},sepMedals:{type:"Separator",group:"medals"},totalMedals:{type:"KeyValue",
map:"arena"},totalMedals1:{type:"KeyValuePercent",map:"arena",stat:"medals-got-1",maxMap:"arena",maxStat:"totalMedals",inset:"medals"},totalMedals2:{type:"KeyValuePercent",map:"arena",stat:"medals-got-2",maxMap:"arena",maxStat:"totalMedals"},totalMedals3:{type:"KeyValuePercent",map:"arena",stat:"medals-got-3",maxMap:"arena",maxStat:"totalMedals"},totalMedals4:{type:"KeyValuePercent",map:"arena",stat:"medals-got-4",maxMap:"arena",maxStat:"totalMedals",condition:"stat.arena.medals-got-4 >= 1"},sepTrophies:{type:"Separator",
group:"trophies",deset:"medals"},totalTrophies:{type:"KeyCurMax",highlight:true,value:function(){return sc.arena.getTotalDefaultTrophies(0,false)},max:function(){return sc.arena.getTotalDefaultTrophies(0,true)}},totalTrophies1:{type:"KeyCurMax",highlight:true,inset:"trophies",value:function(){return sc.arena.getTotalDefaultTrophies(1,false)},max:function(){return sc.arena.getTotalDefaultTrophies(1,true)}},totalTrophies2:{type:"KeyCurMax",highlight:true,value:function(){return sc.arena.getTotalDefaultTrophies(2,
false)},max:function(){return sc.arena.getTotalDefaultTrophies(2,true)}},totalTrophies3:{type:"KeyCurMax",highlight:true,value:function(){return sc.arena.getTotalDefaultTrophies(3,false)},max:function(){return sc.arena.getTotalDefaultTrophies(3,true)}},totalTrophies4:{type:"KeyCurMax",highlight:true,value:function(){return sc.arena.getTotalDefaultTrophies(4,false)},max:function(){return sc.arena.getTotalDefaultTrophies(4,true)}},totalTrophies5:{type:"KeyCurMax",highlight:true,condition:"stat.arena.unlockedTruePlatin >= 1",
value:function(){return sc.arena.getTotalDefaultTrophies(5,false)},max:function(){return sc.arena.getTotalDefaultTrophies(5,true)}},sepTrophiesComp:{type:"Separator",group:"trophyCompletion",deset:"trophies"},trophiesByCup:{type:"List",subtype:"Percent",list:function(){return sc.arena.getTotalDefaultCups(true)},getSettings:function(b){return!sc.arena.isCupUnlocked(b)?null:{highlight:{min:1},displayName:sc.arena.getCupName(b),calc:function(){return sc.arena.getCupCompletion(b)}}}}};sc.STATS_BUILD[sc.STATS_CATEGORY.MISC]=
{gameBoots:{type:"KeyValue"},logs:{type:"KeyValue",map:"player"},words:{type:"KeyValue",map:"misc"},hiCount:{type:"KeyValue",map:"misc"},yawns:{type:"KeyValue",map:"misc"},randomNumber:{type:"KeyValue",value:function(){return Math.floor(Math.random()*Math.random()*123952637)}},finalStat:{type:"KeyValue",highlight:true,value:function(){for(var b=0,a=sc.STATS_BUILD,d=a.length,c=null;d--;)for(var e in a[d]){c=a[d][e];if(c.type=="LIST"){var f=c.list(),g;for(g in f)c.getSettings()&&b++}else b++}return b}}};
sc.STATS_BUILD[sc.STATS_CATEGORY.LOG]={activity:{type:"Logs"}}});ig.baked=!0;
ig.module("game.feature.menu.gui.stats.stats-misc").requires("impact.feature.gui.gui","impact.feature.gui.base.basic-gui","game.feature.menu.gui.menu-misc","game.feature.menu.gui.save.save-misc","game.feature.menu.gui.stats.stats-gui-builds").defines(function(){sc.StatsScrollPane=sc.ScrollPane.extend({contentPane:null,paddingTop:1,init:function(b){this.parent(sc.ScrollType.Y_ONLY);this.paddingTop=b==void 0?1:b;this.contentPane=new ig.GuiElementBase;this.setContent(this.contentPane)},update:function(){this.parent();
if(this.isVisible()&&(!this.onCheckScrollable||this.onCheckScrollable())){sc.control.menuScrollUp()?this.scrollY(-20):sc.control.menuScrollDown()&&this.scrollY(20);sc.control.downDown()?this.scroll(200*ig.system.tick):sc.control.upDown()&&this.scroll(-200*ig.system.tick)}},setSize:function(b,a){this.parent(b,a);this.contentPane.setSize(b,a)},scroll:function(b,a){this.scrollY(b,a,0.05)},addEntry:function(b,a){var d=this.getContentHeight(this.contentPane.hook.children.length%1!=0)+0;b.setPos(a,d);this.contentPane.addChildGui(b);
this.setContentHeight(this.getContentHeight())},clear:function(b){this.contentPane.removeAllChildren();this.contentPane.hook.size.y=0;this.box.doScrollTransition(0,0,0);this.recalculateScrollBars(b)},setScrollY:function(b,a,d){this._skipFirst=false;d||this.box.doScrollTransition(0,0,0);this.parent(b,a)},getContentHeight:function(b){var a=this.contentPane.hook.children,d=a.length;b&&(d=d-1);for(b=0;d--;){b=b+(a[d].size.y+0);d=d-0;if(d<0)break}return b+this.paddingTop},setContentHeight:function(b){this.contentPane.hook.size.y=
b;this.recalculateScrollBars()}});sc.StatPercentNumber=ig.GuiElementBase.extend({gfx:new ig.Image("media/gui/menu.png"),number:null,floating:null,color:0,x:528,smallPercent:false,init:function(b,a){this.parent();this.smallPercent=a.smallPercent||false;this.floating=new sc.NumberGui(99,{size:a.size,leadingZeros:2,scramble:a.scramble});this.floating.setAlign(ig.GUI_ALIGN.X_RIGHT,ig.GUI_ALIGN.Y_TOP);this.floating.setPos(9,0);this.addChildGui(this.floating);this.number=new sc.NumberGui(null,a);this.number.setAlign(ig.GUI_ALIGN.X_RIGHT,
ig.GUI_ALIGN.Y_TOP);this.number.setPos(this.floating.hook.size.x+12,0);this.addChildGui(this.number);if(!ig.LANG_DETAILS[ig.currentLang]||!ig.LANG_DETAILS[ig.currentLang].commaDigits)this.x=548;this.setSize(this.number.hook.size.x+this.floating.hook.size.x+12,this.number.hook.size.y)},setNumber:function(b,a){var d=Math.floor(b*100);this.number.setNumber(d,a);d=Math.floor(b*1E4)%100;this.floating.setNumber(d,a);this.setSize(this.number.hook.size.x+this.floating.hook.size.x+12,this.number.hook.size.y)},
setColor:function(b){this.color=b||0;this.number.setColor(this.color);this.floating.setColor(this.color)},updateDrawables:function(b){this.smallPercent?b.addGfx(this.gfx,this.hook.size.x-8,0,440+8*this.color,440,8,8):b.addGfx(this.gfx,this.hook.size.x-8,0,512+9*this.color,192,8,10);b.addGfx(this.gfx,this.hook.size.x-28,this.hook.size.y-3,this.x+4*this.color,184,3,5)}})});ig.baked=!0;
ig.module("game.feature.menu.gui.status.status-view-parameters").requires("impact.feature.gui.gui","impact.feature.gui.base.basic-gui","game.feature.menu.gui.menu-misc","game.feature.menu.gui.stats.stats-misc").defines(function(){sc.StatusViewParameters=ig.GuiElementBase.extend({transitions:{DEFAULT:{state:{},time:0.2,timeFunction:KEY_SPLINES.LINEAR},HIDDEN:{state:{alpha:0},time:0.2,timeFunction:KEY_SPLINES.LINEAR}},container:null,init:function(){this.parent();this.setSize(ig.system.width,ig.system.height);
this.container=new sc.StatusViewParametersContainer;this.addChildGui(this.container);this.hide(true)},show:function(){this.container.updateValues(true);this.container.show()},hide:function(b){this.container.hide(b)},updatePage:function(){this.container.updateValues()}});sc.StatusViewParametersContainer=sc.MenuPanel.extend({transitions:{DEFAULT:{state:{},time:0.2,timeFunction:KEY_SPLINES.LINEAR},HIDDEN:{state:{alpha:0,offsetX:271.5},time:0.2,timeFunction:KEY_SPLINES.LINEAR}},bg:null,list:null,entries:{},
init:function(){this.parent(sc.MenuPanelType.TOP_LEFT_EDGE);this.setSize(518,213);this.setPos(25,59);this.bg=new sc.MenuScanLines;this.bg.setPos(0,11);this.bg.setSize(this.hook.size.x,196);this.addChildGui(this.bg);this.list=new sc.StatsScrollPane(2);this.list.onCheckScrollable=function(){return!sc.menu.helpMenuOpen};this.list.setPos(0,11);this.list.setSize(this.hook.size.x,196);this.addChildGui(this.list);var b=new sc.TextGui(ig.lang.get("sc.gui.menu.equip.param"),{font:sc.fontsystem.tinyFont});
b.setPos(8,4);this.addChildGui(b);b=new sc.TextGui(ig.lang.get("sc.gui.menu.equip.base"),{font:sc.fontsystem.tinyFont});b.setPos(89,4);this.addChildGui(b);b=new sc.TextGui(ig.lang.get("sc.gui.menu.equip.equip"),{font:sc.fontsystem.tinyFont});b.setPos(132,4);this.addChildGui(b);b=new sc.TextGui(ig.lang.get("sc.gui.menu.equip.skills"),{font:sc.fontsystem.tinyFont});b.setPos(174,4);this.addChildGui(b);b=new sc.TextGui(ig.lang.get("sc.gui.menu.equip.info"),{font:sc.fontsystem.tinyFont});b.setPos(213,
4);this.addChildGui(b);this.createParameterLines()},show:function(){this.doStateTransition("DEFAULT")},hide:function(b){this.doStateTransition("HIDDEN",b)},updateValues:function(b){var a=sc.model.player,d=a.baseParams,c=a.equipParams,a=a.elementConfigs[sc.menu.statusElement].baseParams;this.updateLine("maxhp","hp",d,c,a,b);this.updateLine("atk","attack",d,c,a,b);this.updateLine("def","defense",d,c,a,b);this.updateLine("foc","focus",d,c,a,b);this.updateLine("heat","elemFactor",d,c,a,b);this.updateLine("cold",
"elemFactor",d,c,a,b);this.updateLine("shock","elemFactor",d,c,a,b);this.updateLine("wave","elemFactor",d,c,a,b)},updateLine:function(b,a,d,c,e,f){var b=this.entries[b],g=0,h=0,i=0;if(b.usePercent){i=b.lineID-1;g=Math.round(-(d[a][i]-1)*100);h=Math.round((c[a][i]-1)*100);i=Math.round(-(e[a][i]-1)*100)}else{g=d[a];h=c[a];i=e[a]}b.updateValues(g,h,i,f,h-g,i-h,true)},createParameterLines:function(){this.createLine("maxhp",0,0,false);this.createLine("atk",0,1,false,null,null,true);this.createLine("def",
0,2,false,null,null,true);this.createLine("foc",0,3,false,null,0,true);this.createLine("res",1,4,true,"heat");this.createLine("res",2,5,true,"cold");this.createLine("res",3,6,true,"shock");this.createLine("res",4,7,true,"wave")},createLine:function(b,a,d,c,e,f,g){var h=ig.lang.get("sc.gui.menu.equip."+b),i=ig.lang.get("sc.gui.menu.equip.descriptions."+(e||b)),a=new sc.StatusParamBar(h,i,513,a,d,c,null,null,g);if(f)a.hook.size.y=a.hook.size.y+f;this.entries[e||b]=a;this.list.addEntry(a,0)}})});
ig.baked=!0;
ig.module("game.feature.menu.gui.status.status-view-modifiers").requires("impact.feature.gui.gui","impact.feature.gui.base.basic-gui","game.feature.menu.gui.menu-misc","game.feature.menu.gui.stats.stats-misc").defines(function(){sc.StatusViewModifiers=ig.GuiElementBase.extend({transitions:{DEFAULT:{state:{},time:0.2,timeFunction:KEY_SPLINES.LINEAR},HIDDEN:{state:{alpha:0},time:0.2,timeFunction:KEY_SPLINES.LINEAR}},container:null,init:function(){this.parent();this.setSize(ig.system.width,ig.system.height);
this.container=new sc.StatusViewModifiersContainer;this.addChildGui(this.container);this.hide(true)},show:function(){this.container.updateValues(true);this.container.show()},hide:function(b){this.container.hide(b)},updatePage:function(b){this.container.updateValues(false,b)}});sc.StatusViewModifiersContainer=sc.MenuPanel.extend({transitions:{DEFAULT:{state:{},time:0.2,timeFunction:KEY_SPLINES.LINEAR},HIDDEN:{state:{alpha:0,offsetX:271.5},time:0.2,timeFunction:KEY_SPLINES.LINEAR}},bg:null,list:null,
entries:{},init:function(){this.parent(sc.MenuPanelType.TOP_LEFT_EDGE);this.setSize(518,213);this.setPos(25,59);this.bg=new sc.MenuScanLines;this.bg.setPos(0,11);this.bg.setSize(this.hook.size.x,196);this.addChildGui(this.bg);this.list=new sc.StatsScrollPane(2);this.list.onCheckScrollable=function(){return!sc.menu.helpMenuOpen};this.list.setPos(0,11);this.list.setSize(this.hook.size.x,196);this.addChildGui(this.list);var b=new sc.TextGui(ig.lang.get("sc.gui.menu.equip.modifierName"),{font:sc.fontsystem.tinyFont});
b.setPos(8,4);this.addChildGui(b);b=new sc.TextGui(ig.lang.get("sc.gui.menu.equip.equip"),{font:sc.fontsystem.tinyFont});b.setPos(89,4);this.addChildGui(b);b=new sc.TextGui(ig.lang.get("sc.gui.menu.equip.skills"),{font:sc.fontsystem.tinyFont});b.setPos(132,4);this.addChildGui(b);b=new sc.TextGui(ig.lang.get("sc.gui.menu.equip.info"),{font:sc.fontsystem.tinyFont});b.setPos(169,4);this.addChildGui(b);this.createParameterLines()},show:function(){this.doStateTransition("DEFAULT")},hide:function(b){this.doStateTransition("HIDDEN",
b)},updateValues:function(b,a){if(a){var d=sc.model.player.equipModifiers,c=sc.model.player.elementConfigs[sc.menu.statusElement].modifiers,e;for(e in this.entries)this.updateLine(e,d,c,false)}else this.createParameterLines(b)},updateLine:function(b,a,d,c){var e=this.entries[b],f=0,g=0,f=Math.round(((a[b]||1)-1)*100),g=Math.round((d[b]||0)*100);e.hook.pos.y>=194&&(c=true);e.updateValues(f,g,0,c,g-f,0,true)},createParameterLines:function(b){var a=sc.model.player.elementConfigs[sc.menu.statusElement].modifiers,
d=b?this.list.getScrollY():0;this.list.clear(true);var c=sc.model.player.equipModifiers,e=null,f,g=false,h;for(h in a)if(a[h]!=0){f=(e=sc.MODIFIERS[h])?e.icon:50;g=e?e.noPercent:false;this.createLine(h,5,f,g,e.noPercent);this.updateLine(h,c,a,b)}b&&this.list.scrollY(d,true)},createLine:function(b,a,d,c,e){var f=ig.lang.get("sc.gui.menu.equip.modifier."+b),g=ig.lang.get("sc.gui.menu.equip.descriptions."+b),a=new sc.StatusParamBar(f,g,513,a,d,true,true,e);c&&a.hideValues(true);this.entries[b]=a;this.list.addEntry(a,
0);return a}})});ig.baked=!0;
ig.module("game.feature.menu.gui.status.status-view-combat-arts").requires("impact.feature.gui.gui","impact.feature.gui.base.basic-gui","game.feature.menu.gui.menu-misc","game.feature.menu.gui.stats.stats-misc").defines(function(){var b={THROW:{actionKey:"THROW_SPECIAL",icon:0},ATTACK:{actionKey:"ATTACK_SPECIAL",icon:1},DASH:{actionKey:"DASH_SPECIAL",icon:2},GUARD:{actionKey:"GUARD_SPECIAL",icon:3}};sc.StatusViewCombatArts=ig.GuiElementBase.extend({transitions:{DEFAULT:{state:{},time:0.2,timeFunction:KEY_SPLINES.LINEAR},
HIDDEN:{state:{alpha:0},time:0.2,timeFunction:KEY_SPLINES.LINEAR}},container:null,init:function(){this.parent();this.setSize(ig.system.width,ig.system.height);this.container=new sc.StatusViewCombatArtsContainer;this.addChildGui(this.container);this.hide(true)},show:function(){this.container.updateValues(true);this.container.show()},hide:function(a){this.container.hide(a)},updatePage:function(a){this.container.updateValues(false,a)}});sc.StatusViewCombatArtsContainer=sc.MenuPanel.extend({transitions:{DEFAULT:{state:{},
time:0.2,timeFunction:KEY_SPLINES.LINEAR},HIDDEN:{state:{alpha:0,offsetX:271.5},time:0.2,timeFunction:KEY_SPLINES.LINEAR}},bg:null,list:null,entries:{},init:function(){this.parent(sc.MenuPanelType.TOP_LEFT_EDGE);this.setSize(518,213);this.setPos(25,59);this.bg=new sc.MenuScanLines;this.bg.setPos(0,11);this.bg.setSize(this.hook.size.x,196);this.addChildGui(this.bg);this.list=new sc.StatsScrollPane(2);this.list.onCheckScrollable=function(){return!sc.menu.helpMenuOpen};this.list.setPos(0,11);this.list.setSize(this.hook.size.x,
196);this.addChildGui(this.list);this.createArts(false)},show:function(){this.doStateTransition("DEFAULT")},hide:function(a){this.doStateTransition("HIDDEN",a)},updateValues:function(a){this.createArts(a)},createArts:function(a){var d=a?this.list.getScrollY():0;this.list.clear(true);for(var c in b)this.addType(b[c]);a&&this.list.scrollY(d,true)},addType:function(a){var b=this.getMaxArts(sc.menu.statusElement,a);if(b>0){var c=new sc.StatusViewCombatArtsLine(a.actionKey,a.icon);this.list.addEntry(c,
0);this.addArts(a.actionKey,sc.menu.statusElement,b)}},addArts:function(a,b,c){for(var e=0;e<3;e++){var f=sc.model.player.getActiveCombatArt(b,sc.PLAYER_ACTION[a+(e+1)]);if(f)if(f=sc.model.player.getCombatArt(b,f.name)){f=new sc.StatusViewCombatArtsEntry(e+1,f);this.list.addEntry(f);if(e!=c-1){f=new sc.StatusViewCombatArtsLineSingle;this.list.addEntry(f)}}}},getMaxArts:function(a,b){for(var c=0,e=b.actionKey;c<3&&sc.model.player.getActionByElement(a,sc.PLAYER_ACTION[e+(c+1)]);)c++;return c}});sc.StatusViewCombatArtsEntry=
ig.GuiElementBase.extend({skillIcons:new ig.Image("media/gui/circuit-icons.png"),icon:null,level:null,sp:null,dmgType:null,stunType:null,condition:null,name:null,description:null,info:null,init:function(a,b){this.parent();this.setSize(512,41);this.info=b;this.addText("lvl",9,2);this.icon=new ig.ImageGui(this.skillIcons,b.icon%10*24,Math.floor(b.icon/10)*24,24,24);this.icon.setPos(3,12);this.addChildGui(this.icon);this.level=new sc.NumberGui(9,{size:sc.NUMBER_SIZE.LARGE});this.level.setNumber(a);this.level.setPos(25,
3);this.addChildGui(this.level);this.name=new sc.TextGui("\\c[3]"+b.name+"\\c[0]");this.name.setPos(40,-1);this.addChildGui(this.name);this.description=new sc.TextGui(b.description,{maxWidth:460,font:sc.fontsystem.smallFont,linePadding:-3});this.description.setPos(40,17);this.addChildGui(this.description);var c=168,c=c+(this.addText("sp",c,2).x+3);this.sp=new sc.NumberGui(9);this.sp.setNumber(sc.PLAYER_SP_COST[a-1]);this.sp.setPos(c,3);this.addChildGui(this.sp);c=c+13;c=c+(this.addText("dmgType",
c,2).x+3);this.dmgType=new sc.TextGui(this.getDamageType(b.dmgType));this.dmgType.setPos(c,-1);this.addChildGui(this.dmgType);c=c+(this.dmgType.hook.size.x+5);if(b.stunType||b.status&&sc.menu.statusElement!=0)c=c+(this.addText("effects",c,2).x+2);if(b.stunType){this.stunType=new sc.TextGui(this.getStunType(b.stunType));this.stunType.setPos(c,-1);this.addChildGui(this.stunType);c=c+(this.stunType.hook.size.x+6)}if(b.status&&sc.menu.statusElement!=0){this.condition=new sc.TextGui(this.getConditionType(b.status));
this.condition.setPos(c,-1);this.addChildGui(this.condition)}},addText:function(a,b,c){a=new sc.TextGui("\\c[4]"+ig.lang.get("sc.gui.menu.status."+a)+"\\c[0]",{font:sc.fontsystem.tinyFont});a.setPos(b,c);this.addChildGui(a);return a.hook.size},getDamageType:function(a){return ig.lang.get("sc.gui.menu.status.damageTypes")[a-1]},getStunType:function(a){var b=ig.lang.get("sc.gui.menu.status.stunTypes");return"\\i[status-stun-"+a+"]"+b[a-1]},getConditionType:function(){var a=ig.lang.get("sc.gui.menu.status.conditions");
return"\\i[status-cond-"+sc.menu.statusElement+"]"+ig.lang.get("sc.gui.menu.status.inflicts")+" "+a[sc.menu.statusElement]}});sc.StatusViewCombatArtsLine=ig.GuiElementBase.extend({gfx:new ig.Image("media/gui/menu.png"),text:null,icon:0,init:function(a,b){this.parent();this.setSize(515,11);this.icon=b||0;this.text=new sc.TextGui(ig.lang.get("sc.gui.menu.status.artType."+a),{font:sc.fontsystem.tinyFont});this.text.setPos(13,3);this.addChildGui(this.text)},updateDrawables:function(a){a.addColor("#C7C7C7",
0,10,this.hook.size.x,1);a.addGfx(this.gfx,0,0,640,432+this.icon*12,11,11)}});sc.StatusViewCombatArtsLineSingle=ig.GuiElementBase.extend({gfx:new ig.Image("media/gui/menu.png"),init:function(){this.parent();this.setSize(502,1)},updateDrawables:function(a){a.addColor("#545454",0,0,this.hook.size.x-88,1);a.addGfx(this.gfx,this.hook.size.x-88,0,576,511,88,1)}})});ig.baked=!0;
ig.module("game.feature.menu.gui.status.status-menu").requires("impact.feature.gui.gui","impact.feature.gui.base.basic-gui","game.feature.menu.gui.base-menu","game.feature.menu.gui.menu-misc","game.feature.menu.gui.item.item-status-default","game.feature.menu.gui.status.status-misc","game.feature.menu.gui.status.status-view-main","game.feature.menu.gui.status.status-view-parameters","game.feature.menu.gui.status.status-view-modifiers","game.feature.menu.gui.status.status-view-combat-arts").defines(function(){sc.StatusMenu=
sc.BaseMenu.extend({hotkeyHelp:null,hotkeyEquip:null,hotkeyDiff:null,temp_button_group:null,helpGui:null,pages:[],elements:null,pager:null,init:function(){this.parent();this.hook.size.x=ig.system.width;this.hook.size.y=ig.system.height;this.hotkeyHelp=new sc.ButtonGui("\\i[help]"+ig.lang.get("sc.gui.menu.hotkeys.help"),void 0,true,sc.BUTTON_TYPE.SMALL);this.hotkeyHelp.keepMouseFocus=true;this.hotkeyHelp.hook.transitions={DEFAULT:{state:{},time:0.2,timeFunction:KEY_SPLINES.EASE},HIDDEN:{state:{offsetY:-this.hotkeyHelp.hook.size.y},
time:0.2,timeFunction:KEY_SPLINES.LINEAR}};this.hotkeyHelp.onButtonPress=this.onHelpButtonPressed.bind(this);this.hotkeyEquip=new sc.ButtonGui("\\i[help2]"+ig.lang.get("sc.gui.menu.hotkeys.equip"),void 0,true,sc.BUTTON_TYPE.SMALL);this.hotkeyEquip.keepMouseFocus=true;this.hotkeyEquip.hook.transitions={DEFAULT:{state:{},time:0.2,timeFunction:KEY_SPLINES.EASE},HIDDEN:{state:{offsetY:-this.hotkeyEquip.hook.size.y},time:0.2,timeFunction:KEY_SPLINES.LINEAR}};this.hotkeyEquip.onButtonPress=this.onEquipButtonPressed.bind(this);
this.hotkeyDiff=new sc.ButtonGui("\\i[help3]"+ig.lang.get("sc.gui.menu.hotkeys.diff-show"),void 0,true,sc.BUTTON_TYPE.SMALL);this.hotkeyDiff.submitSound=null;this.hotkeyDiff.blockedSound=null;this.hotkeyDiff.keepMouseFocus=true;this.hotkeyDiff.hook.transitions={DEFAULT:{state:{},time:0.2,timeFunction:KEY_SPLINES.EASE},HIDDEN:{state:{offsetY:-this.hotkeyDiff.hook.size.y},time:0.2,timeFunction:KEY_SPLINES.LINEAR}};this.hotkeyDiff.onButtonPress=this.onDiffButtonPressed.bind(this);this.temp_button_group=
new sc.ButtonGroup;this.temp_button_group.addSelectionCallback(function(b){b.data&&sc.menu.setInfoText(b.data.description)});this.temp_button_group.setMouseFocusLostCallback(function(){sc.menu.setInfoText("",true)});this.createPages();this.pager=new sc.StatusPageSwitch;this.addChildGui(this.pager);this.elements=new sc.StatusElementSwitch;this.addChildGui(this.elements);this.doStateTransition("DEFAULT")},addObservers:function(){sc.Model.addObserver(sc.menu,this)},removeObservers:function(){sc.Model.removeObserver(sc.menu,
this)},showMenu:function(b,a){this.addObservers();sc.menu.menuHost==0&&sc.menu.setHost(sc.MENU_SUBMENU.STATUS);if(sc.menu.menuHost==sc.MENU_SUBMENU.STATUS)if(a==sc.MENU_SUBMENU.EQUIPMENT)sc.menu.buttonInteract.pushButtonGroup(this.temp_button_group);else{sc.menu.buttonInteract.pushButtonGroup(this.temp_button_group);sc.menu.pushBackCallback(this.onBackButtonPress.bind(this))}else sc.menu.pushBackCallback(this.onBackButtonPress.bind(this));ig.interact.setBlockDelay(0.2);sc.menu.buttonInteract.pushButtonGroup(this.temp_button_group);
sc.menu.setInfoText("",false);this.pager.show();this.elements.show();this.pages[sc.menu.statusPage].show();this.updateLea(sc.menu.statusPage,true);this.onAddHotkeys()},hideMenu:function(b,a){this.removeObservers();a!=sc.MENU_SUBMENU.EQUIPMENT&&sc.menu.moveLeaSprite(0,0,sc.MENU_LEA_STATE.LARGE);this.pager.hide();this.elements.hide();this.pages[sc.menu.statusPage].hide();this.exitMenu(a)},exitMenu:function(b){sc.menu.buttonInteract.removeGlobalButton(this.hotkeyHelp);sc.menu.buttonInteract.removeGlobalButton(this.hotkeyEquip);
sc.menu.buttonInteract.removeGlobalButton(this.hotkeyDiff);sc.menu.buttonInteract.removeButtonGroup(this.temp_button_group);if(b!=sc.MENU_SUBMENU.EQUIPMENT){sc.menu.menuHost=0;sc.menu.exitEquipMenu()}this.helpGui=null},createPages:function(){this.pages[sc.MENU_STATUS_PAGES.MAIN]=new sc.StatusViewMain;this.pages[sc.MENU_STATUS_PAGES.PARAMS]=new sc.StatusViewParameters;this.pages[sc.MENU_STATUS_PAGES.MODS]=new sc.StatusViewModifiers;this.pages[sc.MENU_STATUS_PAGES.COMBAT_ARTS]=new sc.StatusViewCombatArts;
for(var b=this.pages.length;b--;)this.addChildGui(this.pages[b]);sc.menu.statusElement=sc.model.player.currentElementMode},setCurrentPage:function(b,a){this.updateLea(b);this.pages[a].hide();this.pages[b].show();ig.interact.setBlockDelay(0.2)},updateCurrentPage:function(b){this.pages[sc.menu.statusPage].updatePage&&this.pages[sc.menu.statusPage].updatePage(b)},updateLea:function(b,a){switch(b){case sc.MENU_STATUS_PAGES.MAIN:sc.menu.moveLeaSprite(0,-101,sc.MENU_LEA_STATE.SMALL,!a);break;default:sc.menu.moveLeaSprite(0,
0,sc.MENU_LEA_STATE.HIDDEN)}},onHotkeyHelpCheck:function(){return sc.control.menuHotkeyHelp()},onHelpButtonPressed:function(){sc.menu.removeHotkeys();this.createHelpGui();ig.gui.addGuiElement(this.helpGui);this.helpGui.openMenu();sc.menu.helpMenuOpen=true;sc.menu.fireStatusPageEvent()},onHotkeyEquipCheck:function(){return ig.interact.isBlocked()?false:sc.control.menuHotkeyHelp2()},onEquipButtonPressed:function(){if(sc.menu.previousMenu==sc.MENU_SUBMENU.START)sc.menu.pushMenu(sc.MENU_SUBMENU.EQUIPMENT);
else if(sc.menu.previousMenu==sc.MENU_SUBMENU.EQUIPMENT)this.onBackButtonPress()},onHotkeyDiffCheck:function(){return ig.interact.isBlocked()?false:sc.control.menuHotkeyHelp3()},onDiffButtonPressed:function(){if(this.hotkeyDiff.active){sc.BUTTON_SOUND.submit.play();sc.menu.statusDiff=!sc.menu.statusDiff;this.updateCurrentPage(true);var b="\\i[help3]"+ig.lang.get("sc.gui.menu.hotkeys.diff-"+(sc.menu.statusDiff?"hide":"show"));this.hotkeyDiff.setText(b)}},createHelpGui:function(){if(!this.helpGui){this.helpGui=
new sc.HelpScreen(this,ig.lang.get("sc.gui.menu.help-texts.status.title"),ig.lang.get("sc.gui.menu.help-texts.status.pages"),function(){sc.menu.helpMenuOpen=false;sc.menu.fireStatusPageEvent();this.commitHotKeysToTopBar(true)}.bind(this));this.helpGui.hook.zIndex=15E4;this.helpGui.hook.pauseGui=true}},onAddHotkeys:function(b){sc.menu.buttonInteract.addGlobalButton(this.hotkeyHelp,this.onHotkeyHelpCheck.bind(this));sc.menu.buttonInteract.addGlobalButton(this.hotkeyEquip,this.onHotkeyEquipCheck.bind(this));
sc.menu.buttonInteract.addGlobalButton(this.hotkeyDiff,this.onHotkeyDiffCheck.bind(this));this.commitHotKeysToTopBar(b)},commitHotKeysToTopBar:function(b){sc.menu.addHotkey(function(){return this.hotkeyDiff}.bind(this));sc.menu.addHotkey(function(){return this.hotkeyEquip}.bind(this));sc.menu.addHotkey(function(){return this.hotkeyHelp}.bind(this));sc.menu.commitHotkeys(b);this.updateHotkeys()},updateHotkeys:function(){var b="\\i[help3]"+ig.lang.get("sc.gui.menu.hotkeys.diff-"+(sc.menu.statusDiff?
"hide":"show"));this.hotkeyDiff.setText(b);switch(sc.menu.statusPage){case sc.MENU_STATUS_PAGES.COMBAT_ARTS:this.hotkeyDiff.startHidden=true;this.hotkeyDiff.doStateTransition("HIDDEN");this.hotkeyDiff.setActive(false);break;case sc.MENU_STATUS_PAGES.PARAMS:case sc.MENU_STATUS_PAGES.MODS:this.hotkeyDiff.startHidden=false;this.hotkeyDiff.setActive(true);this.hotkeyDiff.doStateTransition("DEFAULT");break;default:this.hotkeyDiff.startHidden=true;this.hotkeyDiff.doStateTransition("HIDDEN");this.hotkeyDiff.setActive(false)}},
onBackButtonPress:function(){var b=sc.menu.previousMenu;sc.menu.popBackCallback();sc.menu.popMenu();if(b==sc.MENU_SUBMENU.EQUIPMENT)sc.menu.previousMenu=sc.MENU_SUBMENU.START},modelChanged:function(b,a,d){if(b==sc.menu)if(a==sc.MENU_EVENT.STATUS_SET_PAGE){if(d!=sc.menu.statusPage){this.setCurrentPage(sc.menu.statusPage,d);this.updateHotkeys()}}else a==sc.MENU_EVENT.STATUS_SET_ELEMENT&&this.updateCurrentPage()}})});ig.baked=!0;
ig.module("game.feature.menu.gui.museum.museum-menu").requires("impact.feature.gui.gui","impact.feature.gui.base.basic-gui","game.feature.menu.gui.base-menu","game.feature.menu.gui.menu-misc").defines(function(){sc.MuseumMenu=sc.BaseMenu.extend({hotkeyHelp:null,temp_button_group:null,helpGui:null,init:function(){this.parent();this.hook.size.x=ig.system.width;this.hook.size.y=ig.system.height;this.hotkeyHelp=new sc.ButtonGui("\\i[help]"+ig.lang.get("sc.gui.menu.hotkeys.help"),void 0,true,sc.BUTTON_TYPE.SMALL);
this.hotkeyHelp.hook.transitions={DEFAULT:{state:{},time:0.2,timeFunction:KEY_SPLINES.EASE},HIDDEN:{state:{offsetY:-this.hotkeyHelp.hook.size.y},time:0.2,timeFunction:KEY_SPLINES.LINEAR}};this.hotkeyHelp.onButtonPress=this.onHelpButtonPressed.bind(this);this.temp_button_group=new sc.ButtonGroup;this.temp_button_group.addSelectionCallback(function(b){b.data&&sc.menu.setInfoText(b.data.description)});this.temp_button_group.setMouseFocusLostCallback(function(){sc.menu.setInfoText("",true)});this.doStateTransition("DEFAULT")},
addObservers:function(){sc.Model.addObserver(sc.menu,this)},removeObservers:function(){sc.Model.removeObserver(sc.menu,this)},showMenu:function(){this.addObservers();sc.menu.buttonInteract.pushButtonGroup(this.temp_button_group);sc.menu.pushBackCallback(this.onBackButtonPress.bind(this));sc.menu.moveLeaSprite(0,0,sc.MENU_LEA_STATE.HIDDEN);ig.interact.setBlockDelay(0.2);this.onAddHotkeys()},hideMenu:function(){this.removeObservers();sc.menu.moveLeaSprite(0,0,sc.MENU_LEA_STATE.LARGE);this.exitMenu()},
exitMenu:function(){sc.menu.buttonInteract.removeGlobalButton(this.hotkeyHelp);sc.menu.buttonInteract.removeButtonGroup(this.temp_button_group);this.helpGui=null},onHotkeyHelpCheck:function(){return sc.control.menuHotkeyHelp()},onHelpButtonPressed:function(){this.createHelpGui();ig.gui.addGuiElement(this.helpGui);this.helpGui.openMenu()},createHelpGui:function(){if(!this.helpGui){this.helpGui=new sc.MultiPageBoxGui;this.helpGui.setDefaultHeaderText(ig.lang.get("sc.gui.menu.help-texts.save.title"));
this.helpGui.addPages(ig.lang.get("sc.gui.menu.help-texts.save.pages"));this.helpGui.hook.zIndex=15E4;this.helpGui.hook.pauseGui=true}},onAddHotkeys:function(){sc.menu.buttonInteract.addGlobalButton(this.hotkeyHelp,this.onHotkeyHelpCheck.bind(this));sc.menu.addHotkey(function(){return this.hotkeyHelp}.bind(this));sc.menu.commitHotkeys()},onBackButtonPress:function(){sc.menu.popBackCallback();sc.menu.popMenu()},modelChanged:function(){}})});ig.baked=!0;
ig.module("game.feature.menu.gui.stats.stats-types").requires("impact.feature.gui.gui","impact.feature.gui.base.basic-gui","game.feature.menu.gui.menu-misc","game.feature.menu.gui.save.save-misc","game.feature.menu.gui.stats.stats-gui-builds","game.feature.menu.gui.stats.stats-misc","game.feature.menu.gui.synop.synop-misc").defines(function(){function b(a){for(var b=ig.currentLang+"",b=ig.LANG_DETAILS[ig.currentLang]&&ig.LANG_DETAILS[ig.currentLang].commaDigits?".":",",c=/(\d+)(\d{3})/,a=a+"";c.test(a);)a=
a.replace(c,"$1"+b+"$2");return a}sc.STATS_ENTRY_TYPE={};sc.StatsBaseEntryGui=ig.GuiElementBase.extend({gfx:new ig.Image("media/gui/menu.png"),key:null,keyGui:null,valueGui:null,init:function(a,b,c){this.parent();this.setSize(c,20);this.key=a;this.keyGui=new sc.TextGui("");this.keyGui.setAlign(ig.GUI_ALIGN.X_LEFT,ig.GUI_ALIGN.Y_CENTER);this.keyGui.setPos(5,0);this.addChildGui(this.keyGui);c=null;if(b.displayName)c=b.displayName;else(c=ig.lang.get("sc.gui.menu.stats.keys")[a])||(c="\\c[1]~ "+a+"\\c[0]");
this.keyGui.setText(c);if(!this.constructor.PATTERN)this.constructor.PATTERN=this.gfx.createPattern(512,184,16,4,ig.ImagePattern.OPT.REPEAT_X)},updateDrawables:function(a){if(this.keyGui&&this.valueGui){var b=this.keyGui.hook.size.x+this.keyGui.hook.pos.x+1,c=this.hook.size.x-this.keyGui.hook.size.x-this.valueGui.hook.size.x-10,c=Math.floor(c/4)*4;a.addPattern(this.constructor.PATTERN,b,12,0,0,c,4)}}});sc.STATS_ENTRY_TYPE.Time=sc.StatsBaseEntryGui.extend({stat:null,map:null,value:null,updateTime:false,
init:function(a,b,c){this.parent(a,b,c);this.stat=b.stat||a;this.map=b.map||null;this.updateTime=b.update||false;this.valueGui=new sc.SaveSlotPlayTime(sc.NUMBER_SIZE.TEXT,b.max,b.leading,b.transitionTime,b.millis,b.hideHours);this.valueGui.setAlign(ig.GUI_ALIGN.X_RIGHT,ig.GUI_ALIGN.Y_CENTER);this.valueGui.setPos(5,2);this.addChildGui(this.valueGui);a=0;if(b.value){this.value=b.value;a=this.value()}else a=sc.stats.getMap(this.map,this.stat);this.valueGui.second.setNumber(Math.floor(a)%60,true);this.valueGui.minute.setNumber(Math.floor(a/
60)%60,true);this.valueGui.hour.setNumber(Math.floor(a/60/60),true)},update:function(){if(this.updateTime&&this.map&&this.stat){var a=0,a=this.value?this.value():sc.stats.getMap(this.map,this.stat);this.valueGui.second.setNumber(Math.floor(a)%60,true);this.valueGui.minute.setNumber(Math.floor(a/60)%60,true);this.valueGui.hour.setNumber(Math.floor(a/60/60),true)}},setTime:function(a,b){this.valueGui.setTimeFromValue(a,b)}});sc.STATS_ENTRY_TYPE.Percent=sc.StatsBaseEntryGui.extend({init:function(a,b,
c){this.parent(a,b,c);var c=0,c=b.calc?b.calc():b.map?sc.stats.getMap(b.map,b.stat||a)||0:sc.stats.get(b.stat||a)||0,e=null;if(b.displayName)e=b.displayName;else(e=ig.lang.get("sc.gui.menu.stats.keys")[a])||(e="\\c[1]~ "+e+"\\c[0]");this.valueGui=new sc.StatPercentNumber(null,{size:sc.NUMBER_SIZE.TEXT,leadingZeros:b.frontLeading||1,scramble:c>=1?false:b.scramble});if(b.highlight)if(b.highlight.min!=void 0){if(c>=b.highlight.min){this.valueGui.setColor(sc.GUI_NUMBER_COLOR.ORANGE);this.keyGui.setText("\\c[3]"+
e+"\\c[0]")}}else{this.valueGui.setColor(sc.GUI_NUMBER_COLOR.ORANGE);this.keyGui.setText("\\c[3]"+e+"\\c[0]")}this.valueGui.setAlign(ig.GUI_ALIGN.X_RIGHT,ig.GUI_ALIGN.Y_CENTER);this.valueGui.setPos(5,0);this.valueGui.setNumber(Math.min(100,c));this.addChildGui(this.valueGui)}});sc.STATS_ENTRY_TYPE.KeyValue=sc.StatsBaseEntryGui.extend({init:function(a,d,c){this.parent(a,d,c);var c=d.stat||null,e=d.map||null,f=0,f=d.value?typeof d.value=="function"?d.value()||0:d.value||0:e?sc.stats.getMap(e,c||a)||
0:sc.stats.get(c||a)||0;d.add&&(f=f+(d.add||0));d.hideNameIfNull&&f==0&&this.keyGui.setText("???????????????");if(d.asNumber){this.valueGui=new sc.NumberGui(d.maxValue||null,{leadingZeros:d.leadingZeros||0,size:d.numberSize||sc.NUMBER_SIZE.TEXT,signed:f==0,dots:d.numberDots,transitionTime:d.transitionTime||0});this.valueGui.setNumber(f)}else this.valueGui=new sc.TextGui(b(f)+(d.postfix?d.postfix():""));this.valueGui.setAlign(ig.GUI_ALIGN.X_RIGHT,ig.GUI_ALIGN.Y_CENTER);this.valueGui.setPos(5,0);this.addChildGui(this.valueGui)},
setValue:function(a,d,c){this.valueGui.setText((d?b(a):a)+(c?c:""))},setValueAsNumber:function(a,b){this.valueGui.setMaxNumber(a||5);this.valueGui.setNumber(a,b)}});sc.STATS_ENTRY_TYPE.KeyCurMax=sc.StatsBaseEntryGui.extend({init:function(a,d,c){this.parent(a,d,c);var e=d.stat||null,f=d.map||null,c=0,c=d.value?typeof d.value=="function"?d.value()||0:d.value||0:f?sc.stats.getMap(f,e||a)||0:sc.stats.get(e||a)||0,a=d.max?d.max():0,e=b(Math.min(a,c+(d.add||0))),f=b(a);d.hide&&d.hide(c,a)&&(f="???");var g=
null,g=d.highlight?c>=a?"\\c[3]"+e+"\\i[slash-highlight]"+f+"\\c[0]":e+"\\i[slash]"+f:e+"\\i[slash]"+f;this.valueGui=new sc.TextGui(g);this.valueGui.setAlign(ig.GUI_ALIGN.X_RIGHT,ig.GUI_ALIGN.Y_CENTER);this.valueGui.setPos(5,0);this.addChildGui(this.valueGui)}});sc.STATS_ENTRY_TYPE.KeyValuePercent=sc.StatsBaseEntryGui.extend({numberGui:null,percentGui:null,init:function(a,d,c){this.parent(a,d,c);var e=d.stat||null,f=d.map||null,c=0,c=d.value?typeof d.value=="function"?d.value()||0:d.value||0:f?sc.stats.getMap(f,
e||a)||0:sc.stats.get(e||a)||0;this.numberGui=new sc.TextGui(b(c)+"\\i[arrow-percent]");this.numberGui.setAlign(ig.GUI_ALIGN.X_LEFT,ig.GUI_ALIGN.Y_CENTER);e=0;if(d.calc)e=d.calc();else e=(e=d.maxMap?sc.stats.getMap(d.maxMap,d.maxStat||a)||0:sc.stats.get(d.maxStat||a)||0)?Math.min(1,c/e):0;this.percentGui=new sc.StatPercentNumber(null,{size:sc.NUMBER_SIZE.TEXT,leadingZeros:2});this.percentGui.setAlign(ig.GUI_ALIGN.X_RIGHT,ig.GUI_ALIGN.Y_CENTER);this.percentGui.setNumber(e);this.valueGui=new ig.GuiElementBase;
this.valueGui.setAlign(ig.GUI_ALIGN.X_RIGHT,ig.GUI_ALIGN.Y_CENTER);this.valueGui.setPos(5,0);this.addChildGui(this.valueGui);this.valueGui.addChildGui(this.numberGui);this.valueGui.addChildGui(this.percentGui);this.valueGui.setSize(this.numberGui.hook.size.x+this.percentGui.hook.size.x+2,20)}});sc.STATS_ENTRY_TYPE.Separator=ig.GuiElementBase.extend({separatorText:null,init:function(a,b,c){this.parent();this.setSize(c,14);if(b.noText){a=new ig.ColorGui("#545454",c+5,1);a.setPos(0,0);this.addChildGui(a);
this.hook.size.y=1}else{this.separatorText=new sc.TextGui(ig.lang.get("sc.gui.menu.stats.groups."+(b.group||a)),{font:sc.fontsystem.tinyFont});this.separatorText.setPos(2,3);this.addChildGui(this.separatorText);a=new ig.ColorGui("#545454",c+5,1);a.setPos(0,11);this.addChildGui(a)}}});sc.STATS_ENTRY_TYPE.Logs=ig.GuiElementBase.extend({init:function(a,b,c){this.parent();this.setSize(c,20);for(var a=sc.menu.logEntries,b=a.length,c=0,e=null,e=null,f=0;b--;){var e=a[b],g=sc.LOG_GUI_TYPE[e.type];if(g&&
(!g.isAvailable||g.isAvailable(e))){c++;e=new sc.LOG_GUI_TYPE[e.type](e);e.setPos(3,f);this.addChildGui(e);f=f+e.hook.size.y;if(c>=50)break}}this.hook.size.y=f}})});ig.baked=!0;
ig.module("game.feature.menu.gui.stats.stats-list").requires("impact.feature.gui.gui","impact.feature.gui.base.basic-gui","impact.feature.gui.base.box","game.feature.gui.base.text","game.feature.menu.gui.menu-misc","game.feature.menu.gui.item.item-list","game.feature.menu.gui.list-boxes","game.feature.menu.gui.tab-box","game.feature.menu.gui.stats.stats-misc","game.feature.menu.gui.stats.stats-gui-builds","game.feature.menu.gui.stats.stats-types").defines(function(){var b=[];sc.StatsListBox=sc.TabbedPane.extend({gfx:new ig.Image("media/gui/menu.png"),
submitSound:null,bg:null,currentGui:null,tabState:[],_buttongroup:null,init:function(a){this.parent(true);this.setSize(436,258);this.setPanelSize(436,242);this.setAlign(ig.GUI_ALIGN.X_CENTER,ig.GUI_ALIGN.Y_CENTER);this.hook.transitions={DEFAULT:{state:{},time:0.2,timeFunction:KEY_SPLINES.LINEAR},HIDDEN:{state:{alpha:0,offsetX:218},time:0.2,timeFunction:KEY_SPLINES.LINEAR}};this._buttongroup=a;this.submitSound=sc.BUTTON_SOUND.submit;this.bg=new sc.MenuScanLines;this.bg.setPos(0,29);this.bg.setSize(this.hook.size.x,
228);this.addChildGui(this.bg);a=0;this.addTab("general",a++,{type:sc.STATS_CATEGORY.GENERAL});this.addTab("combat",a++,{type:sc.STATS_CATEGORY.COMBAT});this.addTab("items",a++,{type:sc.STATS_CATEGORY.ITEMS});this.addTab("exploration",a++,{type:sc.STATS_CATEGORY.EXPLORATION});this.addTab("quests",a++,{type:sc.STATS_CATEGORY.QUESTS});ig.vars.get("arenaVars.statsUnlocked")&&this.addTab("arena",a++,{type:sc.STATS_CATEGORY.ARENA});this.addTab("misc",a++,{type:sc.STATS_CATEGORY.MISC});this.addTab("log",
a,{type:sc.STATS_CATEGORY.LOG});this.doStateTransition("HIDDEN",true)},show:function(){this.parent();this.setTab(this.currentTabIndex||0,true,{skipSounds:true});ig.interact.setBlockDelay(0.2);this.doStateTransition("DEFAULT")},hide:function(){this.parent();this.doStateTransition("HIDDEN")},switchTab:function(a){var b=this.currentTabIndex,c=this.getCurrentTabButton();if(a>=0){c.setPressed(false);if(a==1){b++;b>=this.tabArray.length&&(b=0)}else{b--;b<0&&(b=this.tabArray.length-1)}this._prevPressed=
c=this.tabArray[b];c.setPressed(true);this.submitSound.play();this.setTab(b,false,{skipSounds:true});this.resetButtons(c,true);this.rearrangeTabs()}},onTabPressed:function(a,b){if(!b){this.submitSound.play();this.setTab(this.getButtonIndex(a));for(var c=this.tabArray.length;c--;)if(a==this.tabArray[c]){sc.menu.setSynoTab(c);break}sc.menu.setSynopInfo(null,true);return false}},onTabButtonCreation:function(a,b,c){a=new sc.ItemTabbedBox.TabButton(ig.lang.get("sc.gui.menu.stats.tabs."+a),"stats-"+a,105);
a.textChild.setPos(7,1);a.setPos(0,2);a.setData({type:c.type});this.addChildGui(a);return a},onTabChanged:function(a){sc.menu.setSynoTab(a)},onContentCreation:function(){var a={gui:null};this.currentGui=new sc.StatsScrollPane;this.currentGui.setPos(0,29);this.currentGui.setSize(this.hook.size.x,228);this.currentGui.hook.transitions={DEFAULT:{state:{},time:0.2,timeFunction:KEY_SPLINES.LINEAR},HIDDEN:{state:{alpha:0},time:0.2,timeFunction:KEY_SPLINES.LINEAR}};this.addChildGui(this.currentGui);this.currentGui.onCheckScrollable=
function(){return this._buttongroup.isActive()}.bind(this);var d=this.getCurrentTabButton().data.type,d=sc.STATS_BUILD[d],c=null,e=null,f=431,g=new ig.VarCondition;b.length=0;for(var h in d)if((c=d[h])&&sc.STATS_ENTRY_TYPE[c.type]||c.type=="List"){if(c.condition){g.setCondition(c.condition);if(!g.evaluate())continue}if(c.inset){if(b.indexOf(c.inset)!=-1)throw Error(c.inset+" inset already exists. (Missing deset?)");b.push(c.inset);f=f-24}else if(c.deset){e=b.indexOf(c.deset);if(e!=-1){if(e!=b.length-
1)throw Error(c.deset+" ist not top deset. (missing inset/deset?)");b.pop();f=f+24}else throw Error(c.deset+" dest does not exist. (missing inset?)");}if(c.type=="List"){var e=c.list(),i;for(i in e)if(e=c.getSettings(i)){e=new sc.STATS_ENTRY_TYPE[c.subtype](i,e,f);e.setAlign(ig.GUI_ALIGN.X_RIGHT,ig.GUI_ALIGN.Y_TOP);if(f<431){var j=new ig.ImageGui(this.gfx,512,207,17,16);j.setPos(-17,-1);e.addChildGui(j)}this.currentGui.addEntry(e,5)}}else{e=new sc.STATS_ENTRY_TYPE[c.type](h,c,f);e.setAlign(ig.GUI_ALIGN.X_RIGHT,
ig.GUI_ALIGN.Y_TOP);if(f<431){j=new ig.ImageGui(this.gfx,512,207,17,16);j.setPos(-17,-1);e.addChildGui(j)}this.currentGui.addEntry(e,5)}}a.gui=this.currentGui;return a},onClearPrevContent:function(){this.currentGui&&this.currentGui.doStateTransition("HIDDEN",true)},onSetCacheContent:function(a){this.currentGui=a.gui;this.currentGui.doStateTransition("DEFAULT",true)},modelChanged:function(){}})});ig.baked=!0;
ig.module("game.feature.menu.gui.stats.stats-menu").requires("impact.feature.gui.gui","impact.feature.gui.base.basic-gui","game.feature.menu.gui.base-menu","game.feature.menu.gui.menu-misc","game.feature.menu.gui.stats.stats-list").defines(function(){sc.StatsMenu=sc.BaseMenu.extend({hotkeyHelp:null,buttongroup:null,helpGui:null,list:null,init:function(){this.parent();this.hook.size.x=ig.system.width;this.hook.size.y=ig.system.height;this.hotkeyHelp=new sc.ButtonGui("\\i[help]"+ig.lang.get("sc.gui.menu.hotkeys.help"),
void 0,true,sc.BUTTON_TYPE.SMALL);this.hotkeyHelp.keepMouseFocus=true;this.hotkeyHelp.hook.transitions={DEFAULT:{state:{},time:0.2,timeFunction:KEY_SPLINES.EASE},HIDDEN:{state:{offsetY:-this.hotkeyHelp.hook.size.y},time:0.2,timeFunction:KEY_SPLINES.LINEAR}};this.hotkeyHelp.onButtonPress=this.onHelpButtonPressed.bind(this);this.buttongroup=new sc.ButtonGroup;this.buttongroup.addSelectionCallback(function(b){b.data&&sc.menu.setInfoText(b.data.description)});this.buttongroup.setMouseFocusLostCallback(function(){sc.menu.setInfoText("",
true)});this.buttongroup.onButtonTraversal=this.onButtonTraversal.bind(this);this.list=new sc.StatsListBox(this.buttongroup);this.addChildGui(this.list);this.doStateTransition("DEFAULT")},update:function(){if(this.buttongroup&&this.buttongroup.isActive()&&ig.input.mouseGuiActive)this.onButtonTraversal()},addObservers:function(){sc.Model.addObserver(sc.menu,this);sc.Model.addObserver(sc.menu,this.list)},removeObservers:function(){sc.Model.removeObserver(sc.menu,this);sc.Model.removeObserver(sc.menu,
this.list)},showMenu:function(){this.addObservers();sc.menu.buttonInteract.pushButtonGroup(this.buttongroup);sc.menu.pushBackCallback(this.onBackButtonPress.bind(this));sc.menu.moveLeaSprite(0,0,sc.MENU_LEA_STATE.HIDDEN);this.list.show();ig.interact.setBlockDelay(0.2);this.onAddHotkeys()},hideMenu:function(){this.removeObservers();sc.menu.moveLeaSprite(0,0,sc.MENU_LEA_STATE.LARGE);this.exitMenu()},exitMenu:function(){sc.menu.buttonInteract.removeGlobalButton(this.hotkeyHelp);sc.menu.buttonInteract.removeButtonGroup(this.buttongroup);
this.list.hide();this.helpGui=null},onButtonTraversal:function(){var b=-1;sc.control.menuCircleRight()?b=1:sc.control.menuCircleLeft()&&(b=0);this.list.switchTab(b)},onHotkeyHelpCheck:function(){return sc.control.menuHotkeyHelp()},onHelpButtonPressed:function(){sc.menu.removeHotkeys();this.createHelpGui();ig.gui.addGuiElement(this.helpGui);this.helpGui.openMenu()},createHelpGui:function(){if(!this.helpGui){this.helpGui=new sc.HelpScreen(this,ig.lang.get("sc.gui.menu.help-texts.stats.title"),ig.lang.get("sc.gui.menu.help-texts.stats.pages"),
function(){this.commitHotKeysToTopBar(true)}.bind(this),true);this.helpGui.hook.zIndex=15E4;this.helpGui.hook.pauseGui=true}},onAddHotkeys:function(b){sc.menu.buttonInteract.addGlobalButton(this.hotkeyHelp,this.onHotkeyHelpCheck.bind(this));this.commitHotKeysToTopBar(b)},commitHotKeysToTopBar:function(b){sc.menu.addHotkey(function(){return this.hotkeyHelp}.bind(this));sc.menu.commitHotkeys(b)},onBackButtonPress:function(){sc.menu.popBackCallback();sc.menu.popMenu()},modelChanged:function(){}})});
ig.baked=!0;
ig.module("game.feature.menu.gui.trophy.trophy-misc").requires("impact.feature.gui.base.box","impact.feature.gui.gui","impact.feature.interact.button-interact","game.feature.gui.base.text","game.feature.menu.gui.menu-misc","game.feature.menu.gui.list-boxes","game.feature.menu.gui.stats.stats-misc","game.feature.interact.button-group").defines(function(){function b(a){for(var b=ig.currentLang+"",b=ig.LANG_DETAILS[ig.currentLang]&&ig.LANG_DETAILS[ig.currentLang].commaDigits?".":",",e=/(\d+)(\d{3})/,a=
a+"";e.test(a);)a=a.replace(e,"$1"+b+"$2");return a}sc.TrophyTabOverview=ig.GuiElementBase.extend({transitions:{DEFAULT:{state:{},time:0.2,timeFunction:KEY_SPLINES.LINEAR},HIDDEN:{state:{alpha:1},time:0.2,timeFunction:KEY_SPLINES.LINEAR}},total:null,category:null,section:null,init:function(){this.parent();this.setSize(132,40);this.setPos(-134,0);this.setAlign(ig.GUI_ALIGN.X_RIGHT,ig.GUI_ALIGN.Y_BOTTOM);var a=2;this.total=new sc.TrophyTabOverview.Entry(ig.lang.get("sc.gui.menu.trophies.totalTrophies"),
"99");this.total.setAlign(ig.GUI_ALIGN.X_LEFT,ig.GUI_ALIGN.Y_BOTTOM);this.total.setPos(1,a);this.addChildGui(this.total);a=a+8;this.category=new sc.TrophyTabOverview.Entry(ig.lang.get("sc.gui.menu.trophies.category"),"99");this.category.setAlign(ig.GUI_ALIGN.X_LEFT,ig.GUI_ALIGN.Y_BOTTOM);this.category.setPos(1,a);this.addChildGui(this.category);a=a+8;this.section=new sc.TrophyTabOverview.Entry(ig.lang.get("sc.gui.menu.trophies.section"),"99");this.section.setAlign(ig.GUI_ALIGN.X_LEFT,ig.GUI_ALIGN.Y_BOTTOM);
this.section.setPos(1,a);this.addChildGui(this.section);this.updateNumbers()},updateNumbers:function(a,b){var e=sc.trophies.getTotalTrophies(a,b),f=sc.trophies.getTotalTrophies(a),g=sc.trophies.getTotalTrophies();this.total.setValue(g.count+" / "+g.total);this.category.setValue(f.count+" / "+f.total);this.section.setValue(e.count+" / "+e.total)},updateDrawables:function(a){a.addColor("#7E7E7E",0,this.hook.size.y-1,132,1)}});sc.TrophyTabOverview.Entry=ig.GuiElementBase.extend({gfx:new ig.Image("media/gui/menu.png"),
text:null,value:null,init:function(a,b,e){this.parent();this.setSize(e||130,8);this.setAlign(ig.GUI_ALIGN.X_LEFT,ig.GUI_ALIGN.Y_BOTTOM);if(!this.constructor.PATTERN)this.constructor.PATTERN=this.gfx.createPattern(512,189,16,1,ig.ImagePattern.OPT.REPEAT_X);this.text=new sc.TextGui(a,{font:sc.fontsystem.tinyFont});this.addChildGui(this.text);this.value=new sc.TextGui(b,{font:sc.fontsystem.tinyFont});this.value.setAlign(ig.GUI_ALIGN.X_RIGHT,ig.GUI_ALIGN.Y_TOP);this.addChildGui(this.value)},setValue:function(a){this.value.setText(a)},
updateDrawables:function(a){var b=this.text.hook.size.x+this.text.hook.pos.x+1,e=this.hook.size.x-this.text.hook.size.x-this.value.hook.size.x-1,e=Math.floor(e/4)*4;a.addPattern(this.constructor.PATTERN,b,5,0,0,e,1)}});sc.TrophyTotalPoints=sc.MenuPanel.extend({gfx:new ig.Image("media/gui/menu.png"),transitions:{DEFAULT:{state:{},time:0.2,timeFunction:KEY_SPLINES.LINEAR},HIDDEN:{state:{alpha:0,offsetX:220},time:0.2,timeFunction:KEY_SPLINES.LINEAR}},text:null,number:null,init:function(){this.parent(sc.MenuPanelType.BOTTOM_LEFT_EDGE);
this.setAlign(ig.GUI_ALIGN.X_LEFT,ig.GUI_ALIGN.Y_BOTTOM);this.setSize(200,23);this.setPos(66,28);if(!this.constructor.PATTERN)this.constructor.PATTERN=this.gfx.createPattern(512,184,16,4,ig.ImagePattern.OPT.REPEAT_X);this.text=new sc.TextGui(ig.lang.get("sc.gui.menu.trophies.points"));this.text.setAlign(ig.GUI_ALIGN.X_LEFT,ig.GUI_ALIGN.Y_CENTER);this.text.setPos(5,0);this.addChildGui(this.text);this.number=new sc.TextGui(b(0));this.number.setAlign(ig.GUI_ALIGN.X_RIGHT,ig.GUI_ALIGN.Y_CENTER);this.number.setPos(5,
0);this.addChildGui(this.number);this.annotation={content:{title:"sc.gui.menu.help.trophy.titles.points",description:"sc.gui.menu.help.trophy.description.points"},offset:{x:0,y:0},size:{x:"dyn",y:"dyn"},index:{x:0,y:0}};this.doStateTransition("HIDDEN",true)},show:function(){this.number.setText(b(sc.trophies.getTotalPoints()));this.doStateTransition("DEFAULT")},hide:function(){this.doStateTransition("HIDDEN")},updateDrawables:function(a){this.parent(a);var b=this.text.hook.size.x+this.text.hook.pos.x+
1,e=this.hook.size.x-this.text.hook.size.x-this.number.hook.size.x-10,e=Math.floor(e/4)*4;a.addPattern(this.constructor.PATTERN,b,14,0,0,e,4)}});sc.TrophyCompletion=sc.MenuPanel.extend({gfx:new ig.Image("media/gui/menu.png"),transitions:{DEFAULT:{state:{},time:0.2,timeFunction:KEY_SPLINES.LINEAR},HIDDEN:{state:{alpha:0,offsetX:-220},time:0.2,timeFunction:KEY_SPLINES.LINEAR}},text:null,percent:null,init:function(){this.parent(sc.MenuPanelType.BOTTOM_RIGHT_EDGE);this.setAlign(ig.GUI_ALIGN.X_RIGHT,ig.GUI_ALIGN.Y_BOTTOM);
this.setSize(200,23);this.setPos(66,28);if(!this.constructor.PATTERN)this.constructor.PATTERN=this.gfx.createPattern(512,184,16,4,ig.ImagePattern.OPT.REPEAT_X);this.text=new sc.TextGui(ig.lang.get("sc.gui.menu.trophies.completion"));this.text.setAlign(ig.GUI_ALIGN.X_LEFT,ig.GUI_ALIGN.Y_CENTER);this.text.setPos(5,0);this.addChildGui(this.text);this.percent=new sc.StatPercentNumber(null,{size:sc.NUMBER_SIZE.TEXT,leadingZeros:1,scramble:false});this.percent.setAlign(ig.GUI_ALIGN.X_RIGHT,ig.GUI_ALIGN.Y_CENTER);
this.percent.setPos(5,1);this.addChildGui(this.percent);this.annotation={content:{title:"sc.gui.menu.help.trophy.titles.rate",description:"sc.gui.menu.help.trophy.description.rate"},offset:{x:0,y:0},size:{x:"dyn",y:"dyn"},index:{x:1,y:0}};this.doStateTransition("HIDDEN",true)},show:function(){var a=sc.trophies.getTotalTrophiesUnlocked(true);this.percent.setNumber(a,true);if(a>=1){this.text.setText("\\c[3]"+ig.lang.get("sc.gui.menu.trophies.completion")+"\\c[0]");this.percent.setColor(sc.GUI_NUMBER_COLOR.ORANGE)}this.doStateTransition("DEFAULT")},
hide:function(){this.doStateTransition("HIDDEN")},updateDrawables:function(a){this.parent(a);var b=this.text.hook.size.x+this.text.hook.pos.x+1,e=this.hook.size.x-this.text.hook.size.x-this.percent.hook.size.x-10,e=Math.floor(e/4)*4;a.addPattern(this.constructor.PATTERN,b,14,0,0,e,4)}});sc.TrophySectionList=ig.GuiElementBase.extend({transitions:{DEFAULT:{state:{},time:0.2,timeFunction:KEY_SPLINES.LINEAR},HIDDEN:{state:{alpha:0},time:0.2,timeFunction:KEY_SPLINES.LINEAR}},buttongroup:null,index:-1,
category:null,callback:null,active:false,currentButton:-1,prevButton:-1,buttons:[],sectionButtons:{},switchLeft:null,switchRight:null,init:function(a,b,e){this.parent();this.setAlign(ig.GUI_ALIGN.X_RIGHT,ig.GUI_ALIGN.Y_TOP);this.setPos(2,45);this.category=a||null;this.index=b||0;this.callback=e||null;this.buttongroup=new sc.ButtonGroup;this.buttongroup.addPressCallback(function(a){a.data.index!=this.currentButton&&this.callback&&this.callback(this.category,this.index,a)}.bind(this));this.bg=new sc.MenuScanLines;
this.addChildGui(this.bg);var b=sc.TROPHY_SECTIONS[a],e=3,f=0,g;for(g in b){this.addButton(a,b[g],1,e,f);f++;e=e+25}this.currentButton=0;this.setActiveButton(this.currentButton);this.setSize(132,e+1);this.bg.setPos(0,1);this.bg.setSize(this.hook.size.x,e-1);this.switchLeft=new sc.TextGui("\\i[list-up]");this.switchLeft.setPos(1,-16);this.addChildGui(this.switchLeft);this.switchRight=new sc.TextGui("\\i[list-down]");this.switchRight.setAlign(ig.GUI_ALIGN.X_RIGHT,ig.GUI_ALIGN.Y_TOP);this.switchRight.setPos(0,
-16);this.addChildGui(this.switchRight);a=new sc.TextGui(ig.lang.get("sc.gui.menu.trophies.sectionText"),{font:sc.fontsystem.smallFont});a.setAlign(ig.GUI_ALIGN.X_CENTER,ig.GUI_ALIGN.Y_TOP);a.setPos(0,-14);this.addChildGui(a);this.doStateTransition("HIDDEN",true)},activate:function(){if(!this.active){this.active=true;sc.menu.buttonInteract.addParallelGroup(this.buttongroup);this.setActiveButton(this.currentButton);this.doStateTransition("DEFAULT",true);var a=sc.TROPHY_SECTIONS[this.category],b=sc.trophies.trophies,
e=sc.menu.newUnlocks[sc.MENU_SUBMENU.TROPHY]||[],f;for(f in b){var g=b[f];if(g.track&&g.category==this.category)for(var h in a)a[h]==g.section&&e.indexOf(f)!=-1&&this.sectionButtons[h].overlay.activate()}}},deactivate:function(){if(this.active){this.active=false;for(var a in this.sectionButtons)this.sectionButtons[a].overlay.deactivate();sc.menu.buttonInteract.removeParallelGroup(this.buttongroup);this.doStateTransition("HIDDEN",true)}},setActiveButton:function(a,b){for(var e=0;e<this.buttons.length;e++)(b||
e!=a)&&this.buttons[e].setPressed(false);this.prevButton=this.currentButton;this.currentButton=a;a>=0&&this.buttons[this.currentButton].setPressed(true)},getCurrentSection:function(){return this.currentButton<0?0:this.buttons[this.currentButton].data.section},getPreviousSection:function(){return this.prevButton<0?0:this.buttons[this.prevButton].data.section},updateDrawables:function(a){a.addColor("#7E7E7E",0,0,132,1);a.addColor("#7E7E7E",0,-16,132,1);a.addColor("#7E7E7E",0,this.hook.size.y-1,132,
1)},addButton:function(a,b,e,f,g){var h=new sc.ButtonGui(ig.lang.get("sc.gui.menu.trophies.sections."+a+"."+b),130,true,sc.BUTTON_TYPE.DEFAULT,null,true);h.animateOnPress=true;h.setData({section:b,category:a,index:g});h.setPos(e,f);a=new sc.NewUnlockOverlay;a.setPos(4,4);a.deactivate();h.addChildGui(a);h.overlay=a;this.addChildGui(h);this.buttongroup.addFocusGui(h,0,g);this.buttons[g]=h;this.sectionButtons[b]=h}});var a=/\\c\[\d\]/g;sc.TrophyListEntry=ig.FocusGui.extend({transitions:{DEFAULT:{state:{},
time:0.2,timeFunction:KEY_SPLINES.LINEAR},HIDDEN:{state:{alpha:0},time:0.2,timeFunction:KEY_SPLINES.LINEAR}},gfx:new ig.Image("media/gui/menu.png"),ninepatch:new ig.NinePatch("media/gui/buttons.png",{width:28,height:10,left:8,top:15,right:8,bottom:15,offsets:{"default":{x:0,y:114},focus:{x:45,y:114},hdefault:{x:170,y:50},hfocus:{x:213,y:50}}}),character:null,title:null,description:null,progress:null,icon:null,overlay:null,steamID:false,key:null,toggleState:false,triggered:false,init:function(a,b,
e,f){this.parent();this.setSize(295,50);this.key=a;b=sc.trophies.getTrophy(a);this.triggered=e=sc.trophies.isTrophyUnlocked(a);this.steamID=b.steamID||false;var g=new ig.VarCondition("");!e&&b.nameCond&&g.setCondition(b.nameCond);var h=0;e||(h=4);var i="\\c[4]"+ig.lang.get("sc.gui.menu.trophies.questionMarks")+"\\c[4]";this.title=new sc.TextGui(g.evaluate()?this.getTextWithColor(b.name,h):i);this.title.setPos(54,1);this.addChildGui(this.title);!e&&b.descCond?g.setCondition(b.descCond):g.setCondition("");
i="\\c[4]"+ig.lang.get("sc.gui.menu.trophies.questionMarksDesc")+"\\c[4]";this.description=new sc.TextGui(g.evaluate()?this.getTextWithColor(b.description,h):i,{font:sc.fontsystem.smallFont,maxWidth:224,linePadding:-1});this.description.hook.transitions={DEFAULT:{state:{},time:0.2,timeFunction:KEY_SPLINES.LINEAR},HIDDEN:{state:{alpha:0},time:0.2,timeFunction:KEY_SPLINES.LINEAR}};this.description.setPos(66,18);this.addChildGui(this.description);this.progress=new sc.TrophyProgress(b);this.progress.hook.transitions=
{DEFAULT:{state:{},time:0.2,timeFunction:KEY_SPLINES.LINEAR},HIDDEN:{state:{alpha:0},time:0.2,timeFunction:KEY_SPLINES.LINEAR}};this.progress.setPos(66,20);this.addChildGui(this.progress);this.toggleProgress(f,true);this.icon=new sc.TrophyIconGraphic(b.icon,b.stars,b.points,e);this.addChildGui(this.icon);if(sc.menu.hasNewUnlockKey(sc.MENU_SUBMENU.TROPHY,a)){this.overlay=new sc.NewUnlockOverlay;this.overlay.setPos(4,3);this.overlay.activate();this.addChildGui(this.overlay)}},updateDrawables:function(a){this.ninepatch.draw(a,
this.hook.size.x,this.hook.size.y,this.focus?"focus":"default");this.ninepatch.draw(a,this.hook.size.x,this.hook.size.y,this.focus?"hfocus":"hdefault",1);a.addGfx(this.gfx,55,18,530,208,9,10);this.steamID&&!this.toggleState&&a.addGfx(this.gfx,this.hook.size.x-17,this.hook.size.y-16,624,496,13,12).setAlpha(this.triggered?0.8:0.25)},toggleProgress:function(a,b){this.toggleState=a;if(sc.trophies.getTrophy(this.key).progType!="NONE")if(a){this.progress.show(b);this.description.doStateTransition("HIDDEN",
true)}else{this.progress.hide(b);this.description.doStateTransition("DEFAULT",true)}else{this.progress.hide(true);this.description.doStateTransition("DEFAULT",true)}},clearOverlay:function(){this.overlay&&this.overlay.deactivate(true,true)},getTextWithColor:function(b,c){b=ig.LangLabel.getText(b);c!=0&&(b=b.replace(a,""));return"\\c["+c+"]"+b+"\\c[0]"}});sc.TrophyProgress=ig.GuiElementBase.extend({numberGfx:new ig.Image("media/gui/basic.png"),bar:null,content:null,init:function(a){this.parent("blue");
this.setSize(222,26);this.bar=new sc.TrophyProgressBar(a.triggered);this.bar.setPos(0,2);this.addChildGui(this.bar);this.content=new ig.GuiElementBase("red");this.content.hook.transitions={DEFAULT:{state:{},time:0.2,timeFunction:KEY_SPLINES.LINEAR},HIDDEN:{state:{alpha:0,scaleY:0},time:0.2,timeFunction:KEY_SPLINES.LINEAR}};this.content.setSize(222,10);this.content.setPos(0,11);this.content.setPivot(0,10);this.addChildGui(this.content);this.content.doStateTransition("DEFAULT",true);this.setProgress(a)},
show:function(){this.doStateTransition("DEFAULT",true)},hide:function(){this.doStateTransition("HIDDEN",true)},setProgress:function(a){this.content.removeAllChildren();var b=a.stats,e=a.progType||(a.condition?"CONDITION":"VALUE");e=="VALUE"||e=="PERCENT"||e=="VALUE_HIDDEN"?this.setProgressForValueType(a.triggered,e,b):e=="TIME"?this.setProgressForTimeType(a.triggered,e,b):this.setProgressFallback(a.triggered)},setProgressFallback:function(a){this.bar.setRatio(a?1:0);var b=new ig.ImageGui(this.numberGfx,
96,!a?24:0,8,8);b.setAlign(ig.GUI_ALIGN.X_CENTER,ig.GUI_ALIGN.Y_TOP);this.content.addChildGui(b);b=new sc.NumberGui(1,{size:sc.NUMBER_SIZE.NORMAL,dots:true});b.setAlign(ig.GUI_ALIGN.X_CENTER,ig.GUI_ALIGN.Y_TOP);b.setPos(-(b.hook.size.x/2)-5,0);b.setNumber(a?1:0);this.content.addChildGui(b);var e=new sc.NumberGui(1,{size:sc.NUMBER_SIZE.NORMAL,dots:true});e.setAlign(ig.GUI_ALIGN.X_CENTER,ig.GUI_ALIGN.Y_TOP);e.setPos(e.hook.size.x/2+5,0);e.setNumber(1);this.content.addChildGui(e);if(!a){b.setColor(sc.GUI_NUMBER_COLOR.GREY);
e.setColor(sc.GUI_NUMBER_COLOR.GREY)}},setProgressForTimeType:function(a,b,e){if(e.length==0)return this.setProgressFallback(a);var e=e[0],f=(e.mapKey?sc.stats.getMap(e.key,e.mapKey):sc.stats.get(e.key))||0,b=parseFloat(ig.Event.getExpressionValue(e.value)),f=a?b:Math.min(f,b);this.bar.setRatio(f/b);var g=new ig.ImageGui(this.numberGfx,96,!a?24:0,8,8);g.setAlign(ig.GUI_ALIGN.X_CENTER,ig.GUI_ALIGN.Y_TOP);this.content.addChildGui(g);g=new sc.SaveSlotPlayTime(sc.NUMBER_SIZE.NORMAL,99,2);g.setAlign(ig.GUI_ALIGN.X_CENTER,
ig.GUI_ALIGN.Y_TOP);g.setPos(-(g.hook.size.x/2)-5,0);g.setTimeFromValue(f);g.stat=e;if(f<b)g.update=function(){this.setTimeFromValue((this.stat.mapKey?sc.stats.getMap(this.stat.key,this.stat.mapKey):sc.stats.get(this.stat.key))||0,true)};this.content.addChildGui(g);e=new sc.SaveSlotPlayTime(sc.NUMBER_SIZE.NORMAL,99,2);e.setAlign(ig.GUI_ALIGN.X_CENTER,ig.GUI_ALIGN.Y_TOP);e.setPos(e.hook.size.x/2+5,0);e.setTimeFromValue(b);this.content.addChildGui(e);if(!a){g.setColor(sc.GUI_NUMBER_COLOR.GREY);e.setColor(sc.GUI_NUMBER_COLOR.GREY)}},
setProgressForValueType:function(a,b,e){for(var f=e.length,g=0,h=0;f--;)var i=e[f],j=parseFloat(ig.Event.getExpressionValue(i.value)),g=a?g+j:g+Math.max(Math.min((i.mapKey?sc.stats.getMap(i.key,i.mapKey):sc.stats.get(i.key))||0,j),0),h=h+j;g=Math.min(g,h);this.bar.setRatio(g/h);e=new ig.ImageGui(this.numberGfx,96,!a?24:0,8,8);e.setAlign(ig.GUI_ALIGN.X_CENTER,ig.GUI_ALIGN.Y_TOP);this.content.addChildGui(e);if(b=="VALUE"||b=="VALUE_HIDDEN"){e=new sc.NumberGui(g||1,{size:sc.NUMBER_SIZE.NORMAL,dots:true});
e.setAlign(ig.GUI_ALIGN.X_CENTER,ig.GUI_ALIGN.Y_TOP);e.setPos(-(e.hook.size.x/2)-5,0);e.setNumber(g);this.content.addChildGui(e);b=new sc.NumberGui(h,{size:sc.NUMBER_SIZE.NORMAL,dots:true,scramble:b=="VALUE_HIDDEN"&&!a});b.setAlign(ig.GUI_ALIGN.X_CENTER,ig.GUI_ALIGN.Y_TOP);b.setPos(b.hook.size.x/2+5,0);b.setNumber(h);this.content.addChildGui(b);if(!a){e.setColor(sc.GUI_NUMBER_COLOR.GREY);b.setColor(sc.GUI_NUMBER_COLOR.GREY)}}else if(b=="PERCENT"){e=new sc.StatPercentNumber(100,{smallPercent:true});
e.setAlign(ig.GUI_ALIGN.X_CENTER,ig.GUI_ALIGN.Y_TOP);e.setNumber(g);e.setPos(-(e.hook.size.x/2)-5,0);this.content.addChildGui(e);b=new sc.StatPercentNumber(100,{smallPercent:true});b.setAlign(ig.GUI_ALIGN.X_CENTER,ig.GUI_ALIGN.Y_TOP);b.setNumber(h);b.setPos(b.hook.size.x/2+5,0);this.content.addChildGui(b);if(!a){e.setColor(sc.GUI_NUMBER_COLOR.GREY);b.setColor(sc.GUI_NUMBER_COLOR.GREY)}}}});sc.TrophyProgressBar=ig.GuiElementBase.extend({backgroundPatch:new ig.NinePatch("media/gui/menu.png",{width:2,
height:0,left:5,top:5,right:5,bottom:0,offsets:{"default":{x:48,y:416}}}),ratio:0,ratioSmall:0,triggered:false,frame:5,init:function(a){this.parent();this.setSize(222,5);this.ratio=0;this.triggered=a},updateDrawables:function(a){this.frame>=1&&this.backgroundPatch.draw(a,this.hook.size.x,this.hook.size.y,"default");if(this.frame==5){a.addColor(this.triggered?"#25b000":"#156C00",4,0,this.ratio,1);a.addColor(this.triggered?"#25b000":"#156C00",3,1,this.ratio,1);a.addColor(this.triggered?"#25b000":"#156C00",
2,2,this.ratio,1);a.addColor(this.triggered?"#25b000":"#156C00",1,3,this.ratio,1);a.addColor(this.triggered?"#25b000":"#156C00",0,4,this.ratio,1)}else if(this.frame==0){a.addColor("#4d4d4d",0,4,this.hook.size.x,1);a.addColor(this.triggered?"#25b000":"#156C00",0,4,this.ratioSmall,1)}},setRatio:function(a){this.ratio=Math.round(a*218);this.ratioSmall=Math.round(a*222)}});sc.TrophyIconGraphic=ig.GuiElementBase.extend({gfx:new ig.Image("media/gui/menu.png"),icons:new ig.Image("media/gui/feat-icons.png"),
ribbon:null,icon:null,points:null,transitions:{DEFAULT:{state:{},time:0.1,timeFunction:KEY_SPLINES.EASE},HIDDEN:{state:{alpha:0},time:0.1,timeFunction:KEY_SPLINES.EASE}},init:function(a,b,e,f){this.parent();this.setSize(43,43);this.setPos(8,3);a=(sc.TROPHY_ICONS[a]||0).index;f||(a=0);this.icon=new ig.ImageGui(this.icons,a%12*42,~~(a/12)*42,42,42);this.addChildGui(this.icon);this.ribbon=new ig.ImageGui(this.gfx,576,f?465:481,51,14);this.ribbon.setAlign(ig.GUI_ALIGN.X_CENTER,ig.GUI_ALIGN.Y_BOTTOM);
this.addChildGui(this.ribbon);this.points=new sc.NumberGui(e,{size:sc.NUMBER_SIZE.TINY,color:sc.GUI_NUMBER_COLOR.GREY});this.points.setAlign(ig.GUI_ALIGN.X_CENTER,ig.GUI_ALIGN.Y_BOTTOM);this.points.setNumber(e);this.points.setPos(1,0);this.ribbon.addChildGui(this.points);this.addStars(b,f)},addStars:function(a,b){var e=null;switch(sc.TROPHY_STARS[a]){case sc.TROPHY_STARS["1"]:e=this.createStar(b);e.setPos(0,0);break;case sc.TROPHY_STARS["2"]:e=this.createStar(b);e.setPos(-5,1);e=this.createStar(b);
e.setPos(5,1);break;case sc.TROPHY_STARS["3"]:e=this.createStar(b);e.setPos(0,0);e=this.createStar(b);e.setPos(-9,1);e=this.createStar(b);e.setPos(9,1);break;case sc.TROPHY_STARS["4"]:e=this.createStar(b);e.setPos(-5,1);e=this.createStar(b);e.setPos(5,1);e=this.createStar(b);e.setPos(-14,3);e=this.createStar(b);e.setPos(14,3);break;case sc.TROPHY_STARS["5"]:e=this.createStar(b);e.setPos(0,0);e=this.createStar(b);e.setPos(-8,1);e=this.createStar(b);e.setPos(8,1);e=this.createStar(b);e.setPos(-15,4);
e=this.createStar(b);e.setPos(15,4)}},createStar:function(a){a=new ig.ImageGui(this.gfx,a?576:585,496,7,6);a.setAlign(ig.GUI_ALIGN.X_CENTER,ig.GUI_ALIGN.Y_TOP);this.ribbon.addChildGui(a);return a}})});ig.baked=!0;
ig.module("game.feature.menu.gui.trophy.trophy-list").requires("impact.feature.gui.base.box","impact.feature.gui.gui","impact.feature.interact.button-interact","game.feature.menu.gui.tab-box","game.feature.menu.gui.trophy.trophy-misc").defines(function(){sc.TrophyList=sc.ListTabbedPane.extend({submitSound:null,containerHeightOffset:-26,listPosOffset:-6,listHeightOffset:6,listPageSize:25,sections:[],sectionCache:{},showStats:false,showProgress:false,newList:[],init:function(){this.parent(true);this.setSize(436,
258);this.setAlign(ig.GUI_ALIGN.X_CENTER,ig.GUI_ALIGN.Y_TOP);this.setPivot(436,258);this.setPanelSize(436,216);this.submitSound=sc.BUTTON_SOUND.submit;this.hook.transitions={DEFAULT:{state:{},time:0.2,timeFunction:KEY_SPLINES.LINEAR},HIDDEN:{state:{alpha:0,offsetX:218},time:0.2,timeFunction:KEY_SPLINES.LINEAR},HIDDEN_EASE:{state:{alpha:0,offsetX:218},time:0.2,timeFunction:KEY_SPLINES.EASE}};this.addTab("GENERAL",0,{type:sc.TROPHY_TYPES.GENERAL});this.addTab("COMBAT",1,{type:sc.TROPHY_TYPES.COMBAT});
this.addTab("EXPLORATION",2,{type:sc.TROPHY_TYPES.EXPLORATION})},addObservers:function(){sc.Model.addObserver(sc.menu,this)},removeObservers:function(){sc.Model.removeObserver(sc.menu,this)},show:function(){this.parent();this.setTab(this.currentTabIndex||0,true,{skipSounds:true});this.sections[this.currentTabIndex||0].activate();ig.interact.setBlockDelay(0.2);this.doStateTransition("DEFAULT")},hide:function(){this.sections[this.currentTabIndex||0].deactivate();this.parent();for(var b=this.newList.length;b--;){this.newList[b].clearOverlay();
sc.menu.clearNewUnlock(sc.MENU_SUBMENU.TROPHY,this.newList[b].key)}this.newList.length=0;this.doStateTransition("HIDDEN")},toggleProgress:function(){this.showProgress=!this.showProgress;if(this.currentList)for(var b=this.currentList.getChildren(),a=b.length;a--;)b[a].gui.toggleProgress&&b[a].gui.toggleProgress(this.showProgress)},onButtonTraversal:function(){this.parent();var b=-1;sc.control.menuListDown()?b=1:sc.control.menuListUp()&&(b=0);b>=0&&this.switchSection(b)},getCurrentSortText:function(){var b=
null,b=this.tabContent[this.currentTabIndex]?this.tabContent[this.currentTabIndex].sort||sc.TROPHY_SORT_TYPES.ORDER:sc.TROPHY_SORT_TYPES.ORDER,a="auto";switch(b){case sc.TROPHY_SORT_TYPES.ORDER:a="auto";break;case sc.TROPHY_SORT_TYPES.UNLOCKED:a="featLock";break;case sc.TROPHY_SORT_TYPES.NAME:a="featName";break;case sc.TROPHY_SORT_TYPES.POINTS:a="featPoints"}return ig.lang.get("sc.gui.menu.sort."+a)},onLeftRightPress:function(){return{skipSounds:true}},onTabChanged:function(b,a){this.submitSound.play();
a>=0&&this.sections[a].deactivate();b>=0&&this.sections[b].activate();if(this.currentList)for(var d=this.currentList.getChildren(),c=d.length;c--;)d[c].gui.toggleProgress&&d[c].gui.toggleProgress(this.showProgress)},onTabButtonCreation:function(b,a,d){var c=new sc.ItemTabbedBox.TabButton(ig.lang.get("sc.gui.menu.trophies.tabs."+b),"trophies-"+b,105);c.textChild.setPos(7,1);c.setPos(0,2);c.setData({type:d.type});this.addChildGui(c);b=new sc.TrophySectionList(b,a,this.onSectionPress.bind(this));this.sections[a]=
b;this.addChildGui(b);return c},onTabPressed:function(b,a){if(!a){this.submitSound.play();this.setTab(this.getButtonIndex(b));for(var d=this.tabArray.length;d--;)if(b==this.tabArray[d]){sc.menu.setSynoTab(d);break}return false}},onTabSelected:function(){sc.menu.setInfoText("",true)},onTabMouseFocusLost:function(){sc.menu.setInfoText("",true)},onSectionPress:function(b,a,d){this.sections[this.currentTabIndex].setActiveButton(d.data.index,true);this.onCreateListEntries(this.currentList,this.currentGroup,
d.data.category,this.tabContent[this.currentTabIndex].sort)},switchSection:function(b){this.submitSound.play();var a=this.sections[this.currentTabIndex],d=a.buttons,c=a.currentButton;if(b==1){c++;c>=d.length&&(c=0)}else{c--;c<0&&(c=d.length-1)}b=d[c];a.setActiveButton(c);this.onCreateListEntries(this.currentList,this.currentGroup,b.data.category,this.tabContent[this.currentTabIndex].sort)},onCreateListEntries:function(b,a,d,c){var e=null,e=null,f=this.sections[this.currentTabIndex].getCurrentSection(),
g=this.sections[this.currentTabIndex].getPreviousSection();if(!b.overview){b.overview=new sc.TrophyTabOverview;b.addChildGui(b.overview)}this.sectionCache[d]||(this.sectionCache[d]={});var h=this.sectionCache[d][g];if(!h){h={y:0,scroll:0,sort:c};this.sectionCache[d][g]=h}if(h.sort=!c){h.y=0;h.scroll=0;h.sort=c}else{h.y=a.current.y;h.scroll=b.getScrollY()}b.setSize(300,203);b.clear();b.scrollToY(0,true);a.clear();g=this.collectTrophies(d,f,c);for(h=0;h<g.length;h++){e=g[h];e=new sc.TrophyListEntry(e,
d,f,this.showProgress);b.addButton(e)}h=this.sectionCache[d][f];if(!h){h={y:0,scroll:0,sort:c};this.sectionCache[d][f]=h}ig.input.mouseGuiActive?a.setCurrentFocus(0,h.y):a.focusCurrentButton(0,h.y,false,true);b.scrollToY(h.scroll,true);b.overview&&b.overview.updateNumbers(d,f);b.overview.doStateTransition(this.showStats?"DEFAULT":"HIDDEN",true)},onListEntrySelected:function(b){b.key&&b.overlay&&this.newList.indexOf(b)==-1&&this.newList.push(b);b.data&&(b.data instanceof Object||sc.menu.setInfoText(b.data))},
onListMouseFocusLost:function(){sc.menu.setInfoText(null,true)},collectTrophies:function(b,a,d){var c=[],e=sc.trophies.trophies,f;for(f in e){var g=e[f];g.track&&g.category==b&&g.section==a&&c.push(f)}this.sortList(c,d);return c},sortList:function(b,a){switch(a){case sc.TROPHY_SORT_TYPES.ORDER:b.sort(function(a,b){var e=sc.trophies.getTrophy(a),f=sc.trophies.getTrophy(b);return(e.order||0)-(f.order||0)});break;case sc.TROPHY_SORT_TYPES.NAME:b.sort(function(a,b){var e=ig.LangLabel.getText(sc.trophies.getTrophy(a).name),
f=ig.LangLabel.getText(sc.trophies.getTrophy(b).name);return e.toString().localeCompare(f.toString())});break;case sc.TROPHY_SORT_TYPES.UNLOCKED:b.sort(function(a,b){var e=sc.trophies.getTrophy(a),f=sc.trophies.getTrophy(b);return e.triggered==f.triggered?(e.order||0)-(f.order||0):e.triggered?-1:f.triggered?1:0});break;case sc.TROPHY_SORT_TYPES.POINTS:b.sort(function(a,b){var e=sc.trophies.getTrophy(a),f=sc.trophies.getTrophy(b);return e.points==f.points?(e.order||0)-(f.order||0):(f.points||0)-(e.points||
0)})}},modelChanged:function(b,a,d){b==sc.menu&&a==sc.MENU_EVENT.SORT_LIST&&this.sort(d.data.sortType)}})});ig.baked=!0;
ig.module("game.feature.menu.gui.trophy.trophy-menu").requires("impact.feature.gui.gui","impact.feature.gui.base.basic-gui","game.feature.menu.gui.base-menu","game.feature.menu.gui.menu-misc","game.feature.menu.gui.trophy.trophy-list").defines(function(){sc.TrophyMenu=sc.ListInfoMenu.extend({hotkeyStats:null,helpGui:null,sectionLeft:null,sectionRight:null,points:null,completion:null,init:function(){this.parent(new sc.TrophyList);if(this.list){this.list.hook.pos.x=0;this.list.bg.hook.pos.y=this.list.bg.hook.pos.y-
5;this.list.bg.hook.size.x=300;this.list.bg.hook.size.y=this.list.bg.hook.size.y+5}this.points=new sc.TrophyTotalPoints;this.addChildGui(this.points);this.completion=new sc.TrophyCompletion;this.addChildGui(this.completion);this.hotkeyStats=new sc.ButtonGui("\\i[help2]"+ig.lang.get("sc.gui.menu.trophies.toggleStats"),void 0,true,sc.BUTTON_TYPE.SMALL);this.hotkeyStats.keepMouseFocus=true;this.hotkeyStats.hook.transitions={DEFAULT:{state:{},time:0.2,timeFunction:KEY_SPLINES.EASE},HIDDEN:{state:{offsetY:-this.hotkeyStats.hook.size.y},
time:0.2,timeFunction:KEY_SPLINES.LINEAR}};this.hotkeyStats.onButtonPress=this.onStatsButtonPressed.bind(this);this.sortMenu.addButton("auto",sc.TROPHY_SORT_TYPES.ORDER,0);this.sortMenu.addButton("featLock",sc.TROPHY_SORT_TYPES.UNLOCKED,1);this.sortMenu.addButton("featName",sc.TROPHY_SORT_TYPES.NAME,2);this.sortMenu.addButton("featPoints",sc.TROPHY_SORT_TYPES.POINTS,3);this.doStateTransition("DEFAULT")},showMenu:function(){this.parent();sc.trophies.validateFeatPoints();this.list&&this.updateSortMenuButton(this.list.getCurrentSortText());
this.points.show();this.completion.show()},exitMenu:function(){sc.menu.buttonInteract.removeGlobalButton(this.hotkeyStats);this.parent();this.points.hide();this.completion.hide();sc.menu.moveLeaSprite(0,0,sc.MENU_LEA_STATE.LARGE)},onAddHotkeys:function(b){sc.menu.buttonInteract.addGlobalButton(this.hotkeyHelp,this.onHotkeyHelpCheck.bind(this));sc.menu.buttonInteract.addGlobalButton(this.hotkeySort,this.onHotkeySortCheck.bind(this));sc.menu.buttonInteract.addGlobalButton(this.hotkeyStats,this.onHotkeyStatsCheck.bind(this));
this.commitHotKeysToTopBar(b)},commitHotKeysToTopBar:function(b){sc.menu.addHotkey(function(){return this.hotkeyStats}.bind(this));sc.menu.addHotkey(function(){return this.hotkeySort}.bind(this));sc.menu.addHotkey(function(){return this.hotkeyHelp}.bind(this));sc.menu.commitHotkeys(b)},onHotkeyStatsCheck:function(){return sc.control.menuHotkeyHelp2()},onStatsButtonPressed:function(){this.list&&this.list.toggleProgress()},createHelpGui:function(){if(!this.helpGui){this.helpGui=new sc.HelpScreen(this,
ig.lang.get("sc.gui.menu.help-texts.feat.title"),ig.lang.get("sc.gui.menu.help-texts.feat.pages"),function(){this.commitHotKeysToTopBar(true)}.bind(this),true);this.helpGui.hook.zIndex=15E4;this.helpGui.hook.pauseGui=true}},modelChanged:function(b,a,d){if(b==sc.menu)if(a==sc.MENU_EVENT.SORT_LIST)this.updateSortMenuButton(d.text);else if(a==sc.MENU_EVENT.SYNO_CHANGED_TAB){this.sortMenu.active&&this.sortMenu.hideSortMenu();this.updateSortMenuButton(this.list.getCurrentSortText())}}})});ig.baked=!0;
ig.module("game.feature.menu.gui.social.social-list").requires("impact.feature.gui.gui","impact.feature.gui.base.basic-gui","game.feature.gui.base.text","game.feature.menu.gui.menu-misc","game.feature.menu.gui.list-boxes","game.feature.menu.gui.tab-box","game.feature.menu.gui.social.social-misc").defines(function(){sc.SocialList=sc.ListTabbedPane.extend({submitSound:null,favSound:null,errorSound:null,init:function(){this.parent(true);this.setSize(264,262);this.setAlign(ig.GUI_ALIGN.X_RIGHT,ig.GUI_ALIGN.Y_TOP);
this.setPivot(264,262);this.setPanelSize(264,243);this.favSound=this.submitSound=sc.BUTTON_SOUND.submit;this.errorSound=sc.BUTTON_SOUND.denied;this.hook.transitions={DEFAULT:{state:{},time:0.2,timeFunction:KEY_SPLINES.LINEAR},HIDDEN:{state:{alpha:0,offsetX:-132},time:0.2,timeFunction:KEY_SPLINES.LINEAR},HIDDEN_EASE:{state:{alpha:0,offsetX:-132},time:0.2,timeFunction:KEY_SPLINES.EASE}};var b=new sc.TextGui(ig.lang.get("sc.gui.status-hud.lvl"),{font:sc.fontsystem.tinyFont});b.setAlign(ig.GUI_ALIGN.X_RIGHT,
ig.GUI_ALIGN.Y_TOP);b.setPos(9,-8);this.bg.addChildGui(b);b=new sc.TextGui(ig.lang.get("sc.gui.menu.social.status"),{font:sc.fontsystem.tinyFont});b.setAlign(ig.GUI_ALIGN.X_RIGHT,ig.GUI_ALIGN.Y_TOP);b.setPos(37,-8);this.bg.addChildGui(b);this.addTab("close",0,{type:sc.PARTY_MEMBER_TYPE.FRIEND});this.addTab("contacts",1,{type:sc.PARTY_MEMBER_TYPE.CONTACT})},addObservers:function(){sc.Model.addObserver(sc.menu,this)},removeObservers:function(){sc.Model.removeObserver(sc.menu,this)},show:function(){this.parent();
this.setTab(this.currentTabIndex||0,true,{skipSounds:true});ig.interact.setBlockDelay(0.2);this.doStateTransition("DEFAULT")},hide:function(){this.parent();this.doStateTransition("HIDDEN")},updatePartyMembers:function(){for(var b=this.currentList.getChildren(),a=b.length;a--;)b[a].gui.updateMemberStatus()},getCurrentSortText:function(){var b=null,b=this.tabContent[this.currentTabIndex]?this.tabContent[this.currentTabIndex].sort||sc.PARTY_SORT_TYPE.STATUS:sc.PARTY_SORT_TYPE.STATUS,a="auto";switch(b){case sc.PARTY_SORT_TYPE.STATUS:a=
"status";break;case sc.PARTY_SORT_TYPE.NAME:a="name";break;case sc.PARTY_SORT_TYPE.LEVEL:a="socialLevel"}return ig.lang.get("sc.gui.menu.sort."+a)},onLeftRightPress:function(){this.submitSound.play();return{skipSounds:true}},onTabChanged:function(b){sc.menu.setSynoTab(b);(ig.input.mouseGuiActive||this.currentGroup.isEmpty())&&sc.menu.setSynopInfo(null,true)},onTabButtonCreation:function(b,a,d){b=new sc.ItemTabbedBox.TabButton(ig.lang.get("sc.gui.menu.social.tabs."+b),"social-"+b,85);b.textChild.setPos(7,
1);b.setPos(0,2);b.setData({type:d.type});this.addChildGui(b);return b},onTabPressed:function(b,a){if(!a){this.submitSound.play();this.setTab(this.getButtonIndex(b));for(var d=this.tabArray.length;d--;)if(b==this.tabArray[d]){sc.menu.setSynoTab(d);break}sc.menu.setSynopInfo(null,true);return false}},onTabSelected:function(){ig.input.mouseGuiActive&&sc.menu.setSynopInfo(null,true)},onTabMouseFocusLost:function(){sc.menu.synopInfo&&sc.menu.setSynopInfo(null,true)},getMemberList:function(b,a){var d=
[],c=sc.party.contacts,e;for(e in c){var f=c[e];f&&f.status==b&&d.push(e)}a!=void 0&&this.sortList(d,a);return d},sortList:function(b,a){switch(a){case sc.PARTY_SORT_TYPE.STATUS:b.sort(function(a,b){var e=sc.party,f=e.isPartyMember(a),g=e.isPartyMember(b);if(e.isFriend(a)&&e.isFriend(b)){if(f==g)return sc.party.models[a].getCharacterName().localeCompare(sc.party.models[b].getCharacterName());if(f)return-1}f=e.contacts[a];g=e.contacts[b];return f.online&&g.online?0:f.online?-1:g.online?1:f.status==
g.status?e.models[a].getCharacterName().localeCompare(e.models[b].getCharacterName()):g.status-f.status}.bind(this));break;case sc.PARTY_SORT_TYPE.NAME:b.sort(function(a,b){var e=sc.party.models[a].getCharacterName(),f=sc.party.models[b].getCharacterName();return e.localeCompare(f)}.bind(this));break;case sc.PARTY_SORT_TYPE.LEVEL:b.sort(function(a,b){var e=sc.party.models[a],f=sc.party.models[b];return e.level==f.level?sc.party.models[a].getCharacterName().localeCompare(sc.party.models[b].getCharacterName()):
f.level-e.level}.bind(this))}},onCreateListEntries:function(b,a,d,c){var e=null,e=null,d=this.getMemberList(d,c);b.clear();a.clear();for(a=0;a<d.length;a++){e=d[a];e=new sc.SocialEntryButton(e,sc.party.getPartyMemberModel(e));b.addButton(e)}},onListEntrySelected:function(b){if(b.key){sc.party.isFriend(b.key)?sc.menu.setSynopInfo(b.key):sc.menu.setSynopInfo(null);sc.menu.setInfoText(null,true)}else{sc.menu.setSynopInfo(b.key);b.data&&(b.data instanceof Object||sc.menu.setInfoText(b.data))}},onListEntryPressed:function(b){this.submitSound.play();
sc.menu.setSynopPressed(b)},onListMouseFocusLost:function(){sc.menu.setSynopInfo(null,true);sc.menu.setInfoText(null,true)},modelChanged:function(b,a,d){if(b==sc.menu&&a==sc.MENU_EVENT.SORT_LIST){this.sort(d.data.sortType);sc.menu.setSynopInfo(null,true);sc.menu.setInfoText(null,true)}}})});ig.baked=!0;
ig.module("game.feature.menu.gui.social.social-menu").requires("impact.feature.gui.gui","impact.feature.gui.base.basic-gui","game.feature.menu.gui.base-menu","game.feature.menu.gui.social.social-list","game.feature.menu.gui.social.social-misc").defines(function(){sc.SocialMenu=sc.ListInfoMenu.extend({party:null,options:null,optionsContacts:null,_keepButtonFocused:null,init:function(){this.parent(new sc.SocialList,new sc.SocialInfoBox);this.info.hook.pos.y=164;this.party=new sc.SocialPartyBox;this.addChildGui(this.party);
this.sortMenu.addButton("status",sc.PARTY_SORT_TYPE.STATUS,0);this.sortMenu.addButton("name",sc.PARTY_SORT_TYPE.NAME,1);this.sortMenu.addButton("socialLevel",sc.PARTY_SORT_TYPE.LEVEL,2);this.options=new sc.SortMenu(this.onOptionsExecute.bind(this),this.onOptionsBack.bind(this),126);this.options.setAlign(ig.GUI_ALIGN.X_LEFT,ig.GUI_ALIGN.Y_TOP);this.options.setPivot(this.options.hook.size.x/2,0);this.options.addButton("invite",0,0);this.options.addButton("contact",1,1);this.optionsContacts=new sc.SortMenu(this.onOptionsExecute.bind(this),
this.onOptionsBack.bind(this),126);this.optionsContacts.setAlign(ig.GUI_ALIGN.X_LEFT,ig.GUI_ALIGN.Y_TOP);this.optionsContacts.setPivot(this.optionsContacts.hook.size.x/2,0);this.optionsContacts.addButton("contact",1,0);this.doStateTransition("DEFAULT")},showMenu:function(){sc.menu.setSynopInfo(null,false);sc.menu.setInfoText("",false);this.parent();sc.menu.moveLeaSprite(0,0,sc.MENU_LEA_STATE.HIDDEN);this.party.show();this.updateSortMenuButton(this.list.getCurrentSortText())},exitMenu:function(){this.parent();
this.options.active&&this.options.hideSortMenu();this.optionsContacts.active&&this.optionsContacts.hideSortMenu();this.party.hide();sc.menu.moveLeaSprite(0,0,sc.MENU_LEA_STATE.LARGE)},openOptionsMenu:function(b,a){this.hotkeySort.setActive(false);var d=a?this.optionsContacts:this.options;ig.gui.addGuiElement(d);var c=b.hook.screenCoords,e=c.x,f=c.y+c.h-2,g=d.hook;if(f+g.size.y>ig.system.height-26){f=c.y-g.size.y+1;d.setPivot(g.size.x/2,g.size.y)}else d.setPivot(g.size.x/2,0);var c=b.key,h=g=true;
sc.model.player.getCore(sc.PLAYER_CORE.MENU_SOCIAL_INVITE)||(g=h=false);if(!sc.party.isPartyMemberOnline(c))h=g=false;if(a)d.buttons[0].setActive(h);else{if(sc.party.isPartyMemberLocked(c)){d.setButtonKey(0,"locked");g=false}else if(sc.party.isPartyMember(c))d.setButtonKey(0,"remove");else if(sc.party.currentParty.length>=sc.PARTY_MAX_MEMBERS){d.setButtonKey(0,"inviteFull");g=false}else d.setButtonKey(0,"invite");d.buttons[0].setActive(g);d.buttons[1]&&d.buttons[1].setActive(h)}b.keepButtonPressed();
this._keepButtonFocused=b;d.showSortMenuAt(e,f)},contactMember:function(b){sc.commonEvents.triggerEvent("SOCIAL_ACTION",{member:b,actionType:sc.SOCIAL_ACTION.CONTACT})},inviteMember:function(b){sc.commonEvents.triggerEvent("SOCIAL_ACTION",{member:b,actionType:sc.SOCIAL_ACTION.PARTY_JOIN}).addEventAttached(this)},removeMember:function(b){sc.commonEvents.triggerEvent("SOCIAL_ACTION",{member:b,actionType:sc.SOCIAL_ACTION.PARTY_LEAVE}).addEventAttached(this)},onEventEndDetach:function(){this.party.updatePartyMembers();
this.list.updatePartyMembers()},onOptionsExecute:function(b){var a=this._keepButtonFocused;if(this._keepButtonFocused){this._keepButtonFocused.unPressButton();this._keepButtonFocused=null}this.options.hideSortMenu();this.optionsContacts.hideSortMenu();switch(b.data.sortType){case 0:sc.party.isPartyMember(a.key)?this.removeMember(a.key):this.inviteMember(a.key);break;case 1:this.contactMember(a.key)}ig.interact.setBlockDelay(0.2);this.onOptionsBack()},onOptionsBack:function(){if(this._keepButtonFocused){this._keepButtonFocused.unPressButton();
this._keepButtonFocused=null}this.hotkeySort.setActive(true);if(ig.input.mouseGuiActive){sc.menu.buttonInteract.mouseOverGui=null;sc.menu.synopInfo=null;this.info.setCharacter(null)}},createHelpGui:function(){if(!this.helpGui){this.helpGui=new sc.HelpScreen(this,ig.lang.get("sc.gui.menu.help-texts.social.title"),ig.lang.get("sc.gui.menu.help-texts.social.pages"),function(){this.commitHotKeysToTopBar(true)}.bind(this),true);this.helpGui.hook.zIndex=15E4;this.helpGui.hook.pauseGui=true}},modelChanged:function(b,
a,d){if(b==sc.menu)if(a==sc.MENU_EVENT.SORT_LIST)this.updateSortMenuButton(d.text);else if(a==sc.MENU_EVENT.SYNO_CHANGED_TAB){this.options.hideSortMenu();this.optionsContacts.hideSortMenu();this.onOptionsBack();this.list.currentTabIndex==0?this.info.show():this.info.hide();this.updateSortMenuButton(this.list.getCurrentSortText())}else a==sc.MENU_EVENT.SYNOP_SET_INFO?(!this.options.active||!this.optionsContacts.active)&&this.info.setCharacter(sc.menu.synopInfo):a==sc.MENU_EVENT.SYNOP_BUTTON_PRESS&&
(sc.party.isFriend(d.key)?this.openOptionsMenu(d):this.openOptionsMenu(d,true))}})});ig.baked=!0;
ig.module("game.feature.trade.gui.trade-dialog").requires("game.feature.trade.trade-model","impact.base.image","impact.feature.gui.base.basic-gui","impact.feature.gui.gui","game.feature.menu.gui.menu-misc").defines(function(){sc.TradeItem=sc.ListBoxButton.extend({helperGfx:new ig.Image("media/gui/menu.png"),requiredGui:null,amount:null,crossGui:null,isTrade:false,required:0,init:function(b,a,d,c,e,f,g){this.parent(b,142,56,a,d);this.blockedSound=null;this.button.submitSound=null;this.isTrade=f||false;
this.required=e||0;this.crossGui=new ig.ImageGui(this.helperGfx,136,432,5,5);this.crossGui.setAlign(ig.GUI_ALIGN.X_RIGHT,ig.GUI_ALIGN.Y_TOP);this.crossGui.setPos(48,9);this.addChildGui(this.crossGui);this.requiredGui=new sc.NumberGui(99);this.requiredGui.setNumber(this.required);this.requiredGui.setAlign(ig.GUI_ALIGN.X_RIGHT,ig.GUI_ALIGN.Y_TOP);this.requiredGui.setPos(30,7);this.addChildGui(this.requiredGui);b=new ig.ImageGui(this.helperGfx,136,416,3,9);b.setAlign(ig.GUI_ALIGN.X_RIGHT,ig.GUI_ALIGN.Y_TOP);
b.setPos(22,6);this.addChildGui(b);b=new ig.ImageGui(this.helperGfx,139,416,3,9);b.setAlign(ig.GUI_ALIGN.X_RIGHT,ig.GUI_ALIGN.Y_TOP);b.setPos(1,6);this.addChildGui(b);this.amount=new sc.NumberGui(99);this.amount.setAlign(ig.GUI_ALIGN.X_RIGHT,ig.GUI_ALIGN.Y_TOP);this.amount.setPos(5,7);this.addChildGui(this.amount);this.updateTradeItem(c,e);this.setLevel(g)},updateTradeItem:function(b){this.amount.setNumber(b||0);if(this.isTrade){if(b>=99){this.crossGui.offsetY=440;this.requiredGui.setColor(sc.GUI_NUMBER_COLOR.RED)}}else if(b>=
this.required){this.crossGui.offsetY=432;this.requiredGui.setColor(sc.GUI_NUMBER_COLOR.WHITE)}else{this.crossGui.offsetY=440;this.requiredGui.setColor(sc.GUI_NUMBER_COLOR.RED);this.setActive(false)}}});sc.TradeItemBox=ig.GuiElementBase.extend({gfx:new ig.Image("media/gui/menu.png"),dividerColor:null,init:function(b,a,d,c,e){this.parent();this.hook.size.x=c;this.setContent(b,a,d,e)},updateDrawables:function(b){var a=this.hook.size;b.addColor("#000",0,0,a.x,a.y);b.addColor(this.dividerColor||"#7E7E7E",
0,0,a.x,1);b.addColor(this.dividerColor||"#7E7E7E",0,a.y-1,a.x,1)},setContent:function(b,a,d,c){this.removeAllChildren();var e=2,f=0,g=0,h=0,i=f=null,j=null,k=null,l=sc.inventory,o=sc.model.player;if(b)for(var m=0;m<b.length;m++){h=b[m].id;if(h!=void 0){i=l.getItem(h);f=b[m].amount||0;g=o.getItemAmountWithEquip(h);new ig.LangLabel(i.name);var j="\\i["+(i.icon+sc.inventory.getRaritySuffix(i.rarity||0)||"item-default")+"]"+ig.LangLabel.getText(i.name),k=ig.LangLabel.getText(i.description),n=0;i.type==
sc.ITEMS_TYPES.EQUIP&&(n=i.level||1);f=new sc.TradeItem(j,h,k,g,f,c,n);f.setPos(1,e);if(this._isEquipped(h,i.equipType,o)){g=new ig.ImageGui(this.gfx,112,480,19,18);f.addChildGui(g);f.equipImage=g;if(!c&&o.getItemAmount(h)<=0){sc.trade.hasEquippedTrade=true;sc.trade.setEquippedID(h,i.equipType)}}a&&a.addFocusGui(f,0,d);d=d+1;e=e+(f.hook.size.y+0);this.addChildGui(f)}}else e=20;this.hook.size.y=e+1;return e+1},updateTradeItemButtons:function(b){for(var a=this.hook.children,d=a.length,c=null,e=sc.model.player,
f=sc.inventory,g=-1;d--;){c=a[d].gui;if(c.data&&c.data.id!=void 0){g=c.data.id;c.updateTradeItem(e.getItemAmountWithEquip(g));if(this._isEquipped(g,f.getItem(g).equipType,e)){if(!b&&e.getItemAmount(g)<=0){sc.trade.hasEquippedTrade=true;sc.trade.setEquippedID(g,f.getItem(g).equipType)}}else if(c.equipImage){c.removeChildGui(c.equipImage);c.equipImage=null}}}},_isEquipped:function(b,a,d){if(!a)return false;switch(a){case sc.ITEMS_EQUIP_TYPES.HEAD:return b==d.equip.head;case sc.ITEMS_EQUIP_TYPES.ARM:return b==
d.equip.leftArm||b==d.equip.rightArm;case sc.ITEMS_EQUIP_TYPES.TORSO:return b==d.equip.torso;case sc.ITEMS_EQUIP_TYPES.FEET:return b==d.equip.feet}}});sc.TradeMoneyGui=ig.GuiElementBase.extend({gfx:new ig.Image("media/gui/menu.png"),transitions:{DEFAULT:{state:{},time:0.2,timeFunction:KEY_SPLINES.LINEAR},HIDDEN:{state:{alpha:0},time:0.2,timeFunction:KEY_SPLINES.LINEAR}},content:null,money:0,credit:null,fee:null,current:null,dividerColor:null,init:function(b,a,d,c){this.parent();this.setSize(223,26+
(c?11:0));this.money=0;if(d!=void 0){if(d==0){this.doStateTransition("HIDDEN",true);return}this.money=d||1}else if(b){for(d=b.length;d--;)this.money=this.money+sc.inventory.getItem(b[d].id).cost*(b[d].amount||1);this.money=Math.floor((this.money||1)*(a||1))}b=0;c&&(b=11);this.content=new ig.GuiElementBase;this.content.setAlign(ig.GUI_ALIGN.X_CENTER,ig.GUI_ALIGN.Y_TOP);this.content.setSize(142,26+b);this.addChildGui(this.content);a=new sc.TextGui(ig.lang.get("sc.gui.trade.fee"),{font:sc.fontsystem.tinyFont});
a.setPos(0,4+b);this.content.addChildGui(a);a=new sc.TextGui(ig.lang.get("sc.gui.trade.rest"),{font:sc.fontsystem.tinyFont});a.setPos(0,15+b);this.content.addChildGui(a);if(c){a=new sc.TextGui(ig.lang.get("sc.gui.trade.credits"),{font:sc.fontsystem.tinyFont});a.setPos(0,4);this.content.addChildGui(a)}this.credit=new sc.NumberGui(99999999,{signed:true,transitionTime:0.2});this.credit.setAlign(ig.GUI_ALIGN.X_RIGHT,ig.GUI_ALIGN.Y_TOP);this.credit.setNumber(sc.model.player.credit-this.money,true);sc.model.player.credit-
this.money<0&&this.credit.setColor(sc.GUI_NUMBER_COLOR.RED);this.credit.setPos(14,15+b);this.content.addChildGui(this.credit);this.fee=new sc.NumberGui(99999999,{signed:true,transitionTime:0.2});this.fee.setAlign(ig.GUI_ALIGN.X_RIGHT,ig.GUI_ALIGN.Y_TOP);this.fee.setNumber(-this.money,true);this.fee.setColor(sc.GUI_NUMBER_COLOR.RED);this.fee.setPos(14,4+b);this.content.addChildGui(this.fee);if(c){this.current=new sc.NumberGui(99999999,{signed:true,transitionTime:0.2});this.current.setAlign(ig.GUI_ALIGN.X_RIGHT,
ig.GUI_ALIGN.Y_TOP);this.current.setNumber(sc.model.player.credit,true);this.current.setPos(14,4);this.content.addChildGui(this.current)}a=new ig.ImageGui(this.gfx,488,32,12,10);a.setAlign(ig.GUI_ALIGN.X_RIGHT,ig.GUI_ALIGN.Y_TOP);a.setPos(0,3+b);a=new ig.ImageGui(this.gfx,488,32,12,10);a.setAlign(ig.GUI_ALIGN.X_RIGHT,ig.GUI_ALIGN.Y_TOP);a.setPos(0,14+b);this.content.addChildGui(a);if(c){a=new ig.ImageGui(this.gfx,488,32,12,10);a.setAlign(ig.GUI_ALIGN.X_RIGHT,ig.GUI_ALIGN.Y_TOP);a.setPos(0,3);this.content.addChildGui(a)}},
setContent:function(b,a,d,c){this.money=0;if(d!=void 0){if(d==0){this.doStateTransition("HIDDEN",true);return}this.money=d||1}else{for(d=b.length;d--;)this.money=this.money+sc.inventory.getItem(b[d].id).cost*(b[d].amount||1);this.money=(this.money||1)*(a||1)}this.updateValues();this.hook.pos.y=c;this.current&&this.current.setNumber(sc.model.player.credit||0,true);this.doStateTransition("DEFAULT",true)},updateValues:function(){this.credit.setNumber(sc.model.player.credit-this.money);sc.model.player.credit-
this.money<0?this.credit.setColor(sc.GUI_NUMBER_COLOR.RED):this.credit.setColor(sc.GUI_NUMBER_COLOR.WHITE);this.fee.setNumber(-this.money)},updateDrawables:function(b){var a=this.hook.size;b.addColor("#000",0,0,a.x,a.y);b.addColor(this.dividerColor||"#7E7E7E",0,0,a.x,1);b.addColor(this.dividerColor||"#7E7E7E",0,a.y-1,a.x,1)}});sc.TradeDialogMenu=ig.BoxGui.extend({transitions:{DEFAULT:{state:{},time:0.2,timeFunction:KEY_SPLINES.EASE},HIDDEN:{state:{alpha:0,offsetX:-10},time:0.2,timeFunction:KEY_SPLINES.LINEAR}},
ninepatch:new ig.NinePatch("media/gui/menu.png",{width:8,height:8,left:8,top:8,right:8,bottom:8,offsets:{"default":{x:432,y:280}}}),buttongroup:null,tradeButton:null,getItems:null,requireItems:null,money:null,arrow:null,forText:null,ownedText:null,init:function(){this.parent(227,100);this.setAlign(ig.GUI_ALIGN.X_RIGHT,ig.GUI_ALIGN.Y_TOP);this.setPos(8,53);this.hook.localAlpha=0.9;this.buttongroup=new sc.ButtonGroup(false,ig.BUTTON_GROUP_SELECT_TYPE.VERTICAL);this.buttongroup.addSelectionCallback(this.onSelection.bind(this));
this.buttongroup.setMouseFocusLostCallback(function(){var b=sc.trade.getCurrentOffer().get[0];if(sc.inventory.isEquipID(b.id)){sc.trade.setEquipID(b.id);sc.trade.setBuffText("",false);sc.trade.setInfoText("",true)}else{sc.trade.setInfoText("",true);sc.trade.setBuffText("",true);sc.trade.setEquipID(-1,true)}}.bind(this));this.doStateTransition("HIDDEN",true)},updateDrawables:function(b){this.parent(b)},onSelection:function(b){var a=false;if(b.data){if(b.data.id){if(sc.inventory.isBuffID(b.data.id)){sc.trade.setEquipID(-1);
sc.trade.setBuffText(sc.inventory.getBuffString(b.data.id),false,b.data.id)}else if(sc.inventory.isEquipID(b.data.id)){sc.trade.setEquipID(b.data.id);a=true}else{sc.trade.setEquipID(-1);sc.trade.setBuffText("",false)}if(!a){var d=sc.trade.getCurrentOffer().get[0];if(sc.inventory.isEquipID(d.id)){sc.trade.setEquipID(d.id);sc.trade.setBuffText("",false)}}}else{sc.trade.setEquipID(-1);sc.trade.setBuffText("",false)}if(b.data.description){if(b.data.key=="trade"&&!a){d=sc.trade.getCurrentOffer().get[0];
if(sc.inventory.isEquipID(d.id)){sc.trade.setEquipID(d.id);sc.trade.setBuffText("",false)}}sc.trade.setInfoText(b.data.description)}}},showMenu:function(){sc.Model.removeObserver(sc.trade,this);sc.Model.addObserver(sc.trade,this);this._createContent();sc.trade.buttonInteract.pushButtonGroup(this.buttongroup);sc.trade.buttonInteract.addGlobalButton(this.tradeButton,this._onTradeButtonCheck.bind(this));this.arrow.doStateTransition("DEFAULT",false,false,null,0.1);this.doStateTransition("DEFAULT")},hideMenu:function(){sc.Model.removeObserver(sc.trade,
this);sc.trade.buttonInteract.removeButtonGroup(this.buttongroup);this.doStateTransition("HIDDEN")},doTrade:function(){if(sc.trade.canTrade())if(sc.trade.hasEquippedTrade){sc.BUTTON_SOUND.submit.play();sc.Dialogs.showYesNoDialog(ig.lang.get("sc.gui.trade.equipInfo"),sc.DIALOG_INFO_ICON.WARNING,function(b){if(b.data==0){sc.BUTTON_SOUND.shop_cash.play();sc.trade.unequipTradeItems();sc.trade.doTrade(this.money.money);this.requireItems.updateTradeItemButtons();this.getItems.updateTradeItemButtons(true);
this.money.updateValues();sc.trade.canTrade()||this.tradeButton.setActive(false)}else sc.BUTTON_SOUND.back.play()}.bind(this),true)}else{sc.BUTTON_SOUND.shop_cash.play();sc.trade.doTrade(this.money.money);sc.trade.clearEquippedState();this.requireItems.updateTradeItemButtons();this.getItems.updateTradeItemButtons(true);this.money.updateValues();sc.trade.canTrade()||this.tradeButton.setActive(false)}else ig.error("Wat.")},modelChanged:function(b,a){b==sc.trade&&a==sc.TRADE_MODEL_EVENT.OFFER_CHANGED&&
this._setOffer()},_onTradeButtonCheck:function(){return sc.control.menuHotkeyHelp2()},_setOffer:function(){sc.trade.clearEquippedState();this.buttongroup.clear();var b=sc.trade.getCurrentOffer();this.buttongroup.addFocusGui(this.tradeButton,0,0);var a=1,d,c=b.get;d=17+(this.getItems.setContent(c,this.buttongroup,a,true)+10);this.arrow.setPos(6,44+(c.length-1)*20);this.forText.setPos(32,d-7);this.ownedText.setPos(4,d-7);a=a+c.length;c=b.require;this.requireItems.setPos(25,d);d=d+(this.requireItems.setContent(c,
this.buttongroup,a)+5);this.money.setContent(b.get,b.scale,b.cost,d);sc.trade.canTrade()?this.tradeButton.setActive(true):this.tradeButton.setActive(false);ig.input.mouseGuiActive?this.buttongroup.setCurrentFocus(0,0):this.buttongroup.focusCurrentButton(0,0,false,true);this.setSize(227,216);b=sc.trade.getCurrentOffer().get[0];if(sc.inventory.isEquipID(b.id)){sc.trade.setEquipID(b.id);sc.trade.setBuffText("",false)}this.arrow.doStateTransition("HIDDEN",true);this.arrow.doStateTransition("DEFAULT")},
_createContent:function(){var b=10,a=new sc.TextGui(ig.lang.get("sc.gui.trade.trade"),{font:sc.fontsystem.tinyFont});a.setPos(8,b);this.addChildGui(a);a=new sc.TextGui(ig.lang.get("sc.gui.trade.owned"),{font:sc.fontsystem.tinyFont});a.setAlign(ig.GUI_ALIGN.X_RIGHT,ig.GUI_ALIGN.Y_TOP);a.setPos(26,b);this.addChildGui(a);var b=b+7,a=sc.trade.options[0],d=a.get,c=1;this.getItems=new sc.TradeItemBox(d,this.buttongroup,c,200,true);this.getItems.setPos(2,b);this.addChildGui(this.getItems);c=c+d.length;b=
b+(this.getItems.hook.size.y+3);this.forText=new sc.TextGui(ig.lang.get("sc.gui.trade.for"),{font:sc.fontsystem.tinyFont});this.forText.setPos(32,b);this.addChildGui(this.forText);this.ownedText=new sc.TextGui(ig.lang.get("sc.gui.trade.owned"),{font:sc.fontsystem.tinyFont});this.ownedText.setAlign(ig.GUI_ALIGN.X_RIGHT,ig.GUI_ALIGN.Y_TOP);this.ownedText.setPos(4,b);this.addChildGui(this.ownedText);b=b+7;d=a.require;this.requireItems=new sc.TradeItemBox(d,this.buttongroup,c,200);this.requireItems.setPos(25,
b);this.addChildGui(this.requireItems);this.arrow=new ig.ImageGui(this.ninepatch.gfx,432,256,16,17);this.arrow.setPos(6,44+(a.get.length-1)*20);this.arrow.setPivot(16,17);this.arrow.hook.transitions={DEFAULT:{state:{},time:0.2,timeFunction:KEY_SPLINES.EASE},HIDDEN:{state:{scaleX:0.2,scaleY:0.5,offsetY:5},time:0.2,timeFunction:KEY_SPLINES.LINEAR}};this.arrow.doStateTransition("HIDDEN",true);this.addChildGui(this.arrow);b=b+(this.requireItems.hook.size.y+5);this.money=new sc.TradeMoneyGui(a.get,a.scale||
1,a.cost);this.money.setPos(2,b);this.addChildGui(this.money);this.tradeButton=new sc.ButtonGui("\\i[help2]"+ig.lang.get("sc.gui.trade.trade"));this.tradeButton.setData({key:"trade",description:ig.lang.get("sc.gui.trade.description")});this.tradeButton.keepMouseFocus=true;this.tradeButton.setAlign(ig.GUI_ALIGN.X_CENTER,ig.GUI_ALIGN.Y_BOTTOM);this.tradeButton.setPos(0,5);this.tradeButton.submitSound=null;this.tradeButton.onButtonPress=function(){this.doTrade()}.bind(this);this.addChildGui(this.tradeButton);
this.buttongroup.addFocusGui(this.tradeButton,0,0);sc.trade.canTrade()||this.tradeButton.setActive(false);b=b+(this.tradeButton.hook.size.y+5);this.setSize(227,216)}});sc.TradeOfferDisplay=ig.GuiElementBase.extend({transitions:{DEFAULT:{state:{},time:0.2,timeFunction:KEY_SPLINES.LINEAR},HIDDEN:{state:{offsetY:-48},time:0.2,timeFunction:KEY_SPLINES.LINEAR}},offerText:null,cycleLeft:null,cycleRight:null,offerToken:null,init:function(){this.parent();this.setSize(151,21);this.setAlign(ig.GUI_ALIGN.X_RIGHT,
ig.GUI_ALIGN.Y_TOP);this.setPos(44,27);this.hook.localAlpha=0.8;this.offerToken=ig.lang.get("sc.gui.trade.offer");this.offerText=new sc.TextGui("");this.offerText.setAlign(ig.GUI_ALIGN.X_CENTER,ig.GUI_ALIGN.Y_CENTER);this.addChildGui(this.offerText);this.cycleLeft=new sc.ButtonGui("\\i[arrow-left]",34,true,sc.BUTTON_TYPE.SMALL);this.cycleLeft.keepMouseFocus=true;this.cycleLeft.setPos(-27,0);this.cycleLeft.onButtonPress=function(){this._cycleOffers(-1)}.bind(this);this.addChildGui(this.cycleLeft);
this.cycleRight=new sc.ButtonGui("\\i[arrow-right]",34,true,sc.BUTTON_TYPE.SMALL);this.cycleRight.keepMouseFocus=true;this.cycleRight.setAlign(ig.GUI_ALIGN.X_RIGHT,ig.GUI_ALIGN.Y_TOP);this.cycleRight.setPos(-27,0);this.cycleRight.onButtonPress=function(){this._cycleOffers(1)}.bind(this);this.addChildGui(this.cycleRight);this.doStateTransition("HIDDEN",true)},updateDrawables:function(b){b.addColor("#000",0,0,this.hook.size.x,this.hook.size.y)},showMenu:function(){if(!(sc.trade.options.length<2)){sc.trade.buttonInteract.addGlobalButton(this.cycleLeft,
this.onLeftPressCheck.bind(this));sc.trade.buttonInteract.addGlobalButton(this.cycleRight,this.onRightPressCheck.bind(this));this.offerText.setText(this.offerToken+" "+(sc.trade.tradeIndex+1)+" / "+sc.trade.options.length);this.doStateTransition("DEFAULT")}},hideMenu:function(){sc.trade.options.length<2||this.doStateTransition("HIDDEN")},_cycleOffers:function(b){var a=sc.trade.tradeIndex+b;b<0?a<0&&(a=sc.trade.options.length-1):b>0&&a>=sc.trade.options.length&&(a=0);sc.trade.setActiveOffer(a);this.offerText.setText(this.offerToken+
" "+(sc.trade.tradeIndex+1)+" / "+sc.trade.options.length)},onLeftPressCheck:function(){return sc.control.menuCircleLeft()},onRightPressCheck:function(){return sc.control.menuCircleRight()}})});ig.baked=!0;
ig.module("game.feature.menu.gui.trade.trade-misc").requires("impact.feature.gui.gui","impact.feature.gui.base.basic-gui","game.feature.trade.gui.trade-dialog","game.feature.npc.gui.npc-display-gui").defines(function(){sc.TradeButtonBox=ig.GuiElementBase.extend({gfx:new ig.Image("media/gui/menu.png"),transitions:{DEFAULT:{state:{},time:0.2,timeFunction:KEY_SPLINES.LINEAR},HIDDEN:{state:{alpha:0},time:0.2,timeFunction:KEY_SPLINES.LINEAR}},trader:null,buttongroup:null,buttonStartIndex:0,buttons:[],
character:null,traderName:null,location:null,init:function(b,a,d){this.parent();this.setSize(431,46);this.trader=b;this.buttongroup=a;this.buttonStartIndex=d||0;a=sc.trade.getTrader(b);b=sc.trade.getFoundTrader(b);this.character=new sc.TradeCharacterView;this.character.setPos(2,1);this.character.setCharacter(b.characterName);this.addChildGui(this.character);this.traderName=new sc.TextGui(ig.LangLabel.getText(a.name));this.traderName.setPos(36,1);this.addChildGui(this.traderName);a=new ig.ImageGui(this.gfx,
481,224,8,11);a.setPos(37,20);this.addChildGui(a);this.location=new sc.TextGui((b.area||"???")+" - "+(b.map||"???"),{font:sc.fontsystem.smallFont});this.location.setPos(50,19);this.addChildGui(this.location)}});sc.TradeEntryButton=sc.TradeItem.extend({offer:0,trader:null,init:function(b,a,d,c,e,f,g,h){this.parent(b,c,e,f,g,true,h);this.offer=d||0;this.trader=a||null}});sc.TradeCharacterView=ig.BoxGui.extend({ninepatch:new ig.NinePatch("media/gui/menu.png",{width:2,height:2,left:5,top:5,right:5,bottom:5,
offsets:{"default":{x:488,y:16},square:{x:500,y:0},none:{x:400,y:0}}}),display:null,container:null,transitions:{DEFAULT:{state:{},time:0.1,timeFunction:KEY_SPLINES.EASE},HIDDEN:{state:{alpha:0},time:0.1,timeFunction:KEY_SPLINES.EASE}},init:function(){this.parent(31,42);this.container=new ig.GuiElementBase;this.container.hook.clip=true;this.container.setSize(31,42);this.container.setPos(1,1);this.addChildGui(this.container)},setCharacter:function(b,a){if(b){if(this.display){this.display.remove(true);
this.display=null}if(b){this.display=new sc.NPCDisplayGui(b,true,null,this.centerNPC.bind(this));this.container.addChildGui(this.display);this.doStateTransition("DEFAULT",true)}}else{if(this.display){a?this.display.remove(true):this.display.doStateTransition("HIDDEN",false,true);this.display=null}this.doStateTransition("HIDDEN",true)}},centerNPC:function(b){b.npc&&b.setPos(this.container.hook.size.x/2-b.hook.size.x/2-1,this.container.hook.size.y/2-b.hook.size.y/2)}});sc.TradeDetailsView=ig.BoxGui.extend({transitions:{DEFAULT:{state:{},
time:0.2,timeFunction:KEY_SPLINES.LINEAR},HIDDEN:{state:{alpha:0},time:0.2,timeFunction:KEY_SPLINES.LINEAR},HIDDEN_SCALE:{state:{alpha:0,scaleY:0.5},time:0.2,timeFunction:KEY_SPLINES.LINEAR},HIDDEN_MOVE:{state:{alpha:0,offsetX:218},time:0.2,timeFunction:KEY_SPLINES.LINEAR}},ninepatch:new ig.NinePatch("media/gui/menu.png",{width:10,height:11,left:34,top:44,right:5,bottom:3,offsets:{"default":{x:592,y:160}}}),sizeTransition:null,container:null,box:null,character:null,name:null,location:null,arrowRight:null,
arrow:null,getGui:null,requireGui:null,moneyGui:null,_trader:null,init:function(){this.parent();this.setSize(228,220);this.setPos(66,67);this.setPivot(0,110);this.annotation=[];this.annotation[0]={content:{title:"sc.gui.menu.help.trader.titles.info",description:"sc.gui.menu.help.trader.description.info"},offset:{x:1,y:1},size:{x:227,y:45},index:{x:0,y:0}};this.annotation[1]={content:{title:"sc.gui.menu.help.trader.titles.content",description:"sc.gui.menu.help.trader.description.content"},offset:{x:1,
y:52},size:{x:227,y:118},index:{x:0,y:1}};this.annotation[2]={content:{title:"sc.gui.menu.help.trader.titles.money",description:"sc.gui.menu.help.trader.description.money"},offset:{x:1,y:180},size:{x:227,y:39},index:{x:0,y:2}};this.character=new sc.TradeCharacterView;this.character.currentTileOffset="square";this.character.setPos(3,2);this.addChildGui(this.character);this.arrowRight=new ig.ImageGui(this.ninepatch.gfx,576,184,9,15);this.arrowRight.setPos(229,0);this.name=new sc.TextGui("");this.name.setPos(37,
2);this.addChildGui(this.name);var b=new ig.ImageGui(this.ninepatch.gfx,481,224,8,11);b.setPos(38,21);this.addChildGui(b);this.location=new sc.TextGui("",{font:sc.fontsystem.smallFont});this.location.setPos(51,20);this.addChildGui(this.location);this.container=new ig.GuiElementBase;this.container.setPos(2,44);this.container.setSize(225,174);this.addChildGui(this.container);b=new ig.ColorGui("#7e7e7e",224,1);this.container.addChildGui(b);b=new sc.TextGui(ig.lang.get("sc.gui.trade.trade"),{font:sc.fontsystem.tinyFont});
b.setPos(8,2);this.container.addChildGui(b);b=new sc.TextGui(ig.lang.get("sc.gui.trade.owned"),{font:sc.fontsystem.tinyFont});b.setAlign(ig.GUI_ALIGN.X_RIGHT,ig.GUI_ALIGN.Y_TOP);b.setPos(25,2);this.container.addChildGui(b);this.getGui=new sc.TradeItemBox(null,null,null,200);this.getGui.dividerColor="#7e7e7e";this.getGui.setPos(1,9);this.container.addChildGui(this.getGui);this.forText=new sc.TextGui(ig.lang.get("sc.gui.trade.for"),{font:sc.fontsystem.tinyFont});this.forText.setPos(32,9);this.container.addChildGui(this.forText);
this.ownedText=new sc.TextGui(ig.lang.get("sc.gui.trade.owned"),{font:sc.fontsystem.tinyFont});this.ownedText.setAlign(ig.GUI_ALIGN.X_RIGHT,ig.GUI_ALIGN.Y_TOP);this.ownedText.setPos(4,9);this.container.addChildGui(this.ownedText);this.requireGui=new sc.TradeItemBox(null,null,null,200);this.requireGui.dividerColor="#7e7e7e";this.requireGui.setPos(24,9);this.container.addChildGui(this.requireGui);this.arrow=new ig.ImageGui(this.ninepatch.gfx,432,256,16,17);this.arrow.setPos(5,36);this.arrow.setPivot(16,
17);this.arrow.hook.transitions={DEFAULT:{state:{},time:0.2,timeFunction:KEY_SPLINES.EASE},HIDDEN:{state:{scaleX:0.2,scaleY:0.5,offsetY:5},time:0.2,timeFunction:KEY_SPLINES.LINEAR}};this.container.addChildGui(this.arrow);this.moneyGui=new sc.TradeMoneyGui(null,null,null,false);this.moneyGui.setAlign(ig.GUI_ALIGN.X_LEFT,ig.GUI_ALIGN.Y_BOTTOM);this.moneyGui.dividerColor="#7e7e7e";this.moneyGui.setPos(1,0);this.container.addChildGui(this.moneyGui);this.doStateTransition("HIDDEN",true)},setTraderData:function(b,
a,d){var c=sc.trade.getTrader(b),e=sc.trade.getFoundTrader(b);if(this._trader!=b){this.character.setCharacter(e.characterName,true);this.name.setText(ig.LangLabel.getText(c.name));this.location.setText((e.area||"???")+" - "+(e.map||"???"));this._trader=b}this.arrowRight.hook.pos.y=d+3;b=c.options[a];a=b.get;d=9+(this.getGui.setContent(a,null,null,true)+10);this.forText.setPos(32,d-7);this.ownedText.setPos(4,d-7);this.arrow.setPos(5,36+(a.length-1)*20);a=b.require;this.requireGui.setPos(24,d);this.requireGui.setContent(a);
this.moneyGui.setContent(b.get,b.scale,b.cost,0)},reset:function(){this.doStateTransition("HIDDEN",true);this._trader=null},show:function(b,a,d){this.doStateTransition("HIDDEN_SCALE",true);this.doStateTransition("DEFAULT");this.setTraderData(b,a,d)},hide:function(b){this._trader=null;sc.menu.tradeToggle?this.doStateTransition("HIDDEN_MOVE"):this.doStateTransition(b?"HIDDEN_SCALE":"HIDDEN")}})});ig.baked=!0;
ig.module("game.feature.menu.gui.trade.trader-list").requires("impact.feature.gui.gui","impact.feature.gui.base.basic-gui","impact.feature.gui.base.box","game.feature.gui.base.text","game.feature.menu.gui.menu-misc","game.feature.menu.gui.item.item-list","game.feature.menu.gui.list-boxes","game.feature.menu.gui.tab-box","game.feature.menu.gui.trade.trade-misc").defines(function(){var b={trader:null,offer:void 0,index:0};sc.TradersListBox=sc.ListTabbedPane.extend({submitSound:null,init:function(){this.parent(true);
this.setSize(436,258);this.setPivot(436,258);this.setPanelSize(436,242);this.setPos(0,0);this.setAlign(ig.GUI_ALIGN.X_CENTER,ig.GUI_ALIGN.Y_CENTER);this.submitSound=sc.BUTTON_SOUND.submit;this.hook.transitions={DEFAULT:{state:{},time:0.2,timeFunction:KEY_SPLINES.LINEAR},HIDDEN:{state:{alpha:0,offsetX:218},time:0.2,timeFunction:KEY_SPLINES.LINEAR}};this.bg.setSize(this.hook.size.x,222);var a=new sc.TextGui(ig.lang.get("sc.gui.trade.owned"),{font:sc.fontsystem.tinyFont});a.setAlign(ig.GUI_ALIGN.X_RIGHT,
ig.GUI_ALIGN.Y_TOP);a.setPos(2,-8);this.bg.addChildGui(a);for(var a=sc.map.getUnlockedAreas(),a=sc.map.sortAreaList(a),b=0,c=0;c<a.length;c++)sc.trade.hasAreaTraders(a[c])&&sc.trade.hasTraderInArea(a[c])&&this.addTab(a[c],b++,{type:a[c]})},addObservers:function(){sc.Model.addObserver(sc.menu,this)},removeObservers:function(){sc.Model.removeObserver(sc.menu,this)},show:function(){this.parent();this.setTab(this.currentTabIndex||0,true,{skipSounds:true});ig.interact.setBlockDelay(0.2);this.doStateTransition("DEFAULT")},
hide:function(){this.parent();this.doStateTransition("HIDDEN")},getCurrentSortText:function(){var a=null,a=this.tabContent[this.currentTabIndex]?this.tabContent[this.currentTabIndex].sort||sc.TRADE_SORT_TYPE.ORDER:sc.TRADE_SORT_TYPE.ORDER,b="auto";switch(a){case sc.TRADE_SORT_TYPE.ORDER:b="auto";break;case sc.TRADE_SORT_TYPE.FOUND:b="trader"}return ig.lang.get("sc.gui.menu.sort."+b)},onLeftRightPress:function(a,b){b!=this.currentTabIndex&&this.submitSound.play();return{skipSounds:true}},onTabChanged:function(){(ig.input.mouseGuiActive||
this.currentGroup.isEmpty())&&sc.menu.setSynopInfo(null,true)},onTabButtonCreation:function(a,b,c){b=sc.map.getAreaName(a,true);a="area-"+a;sc.fontsystem.hasIcon(a)||(a="enemy-abstract");a=new sc.ItemTabbedBox.TabButton(b,a,128);a.textChild.setPos(7,1);a.setPos(0,2);a.setData({type:c.type});this.addChildGui(a);return a},onTabPressed:function(a,b){if(!b){this.submitSound.play();this.setTab(this.getButtonIndex(a));for(var c=this.tabArray.length;c--;)if(a==this.tabArray[c]){sc.menu.setSynoTab(c);break}sc.menu.setSynopInfo(null,
true);return false}},onTabSelected:function(){ig.input.mouseGuiActive&&sc.menu.setSynopInfo(null,true)},onTabMouseFocusLost:function(){sc.menu.setSynopInfo(null,true)},onCreateListEntries:function(a,b,c,e){var f=null,g=null,h=-1,i=null,j=g=null,c=sc.trade.getFoundTraders(c,e);a.setSize(436,222);a.paddingBetween=0;a.paddingTop=2;a.clear();b.clear();if(a.traderInfoGui)a.traderInfoGui.removeAllChildren();else{a.traderInfoGui=new ig.GuiElementBase;a.box.insertChildGui(a.traderInfoGui,0);a.forceLastScroll=
true}for(var e=1,k=0;k<c.length;k++){i=c[k];if(!this.hasAnyUpgrades(i)){g=sc.trade.getTrader(i);j=g.options;g=new sc.TradeButtonBox(i,b,a.getChildren().length);g.setPos(1,e);a.traderInfoGui.addChildGui(g);for(var l=0,o=0;o<j.length;o++){var m=j[o].get;if(m[0]){var h=m[0].id,f=m[0].amount,m=sc.inventory.getItem(h),n=sc.model.player.getItemAmountWithEquip(h),p=sc.inventory.getItemNameWithIcon(h),r=sc.inventory.getItemDescription(h),t=0;m.type==sc.ITEMS_TYPES.EQUIP&&(t=m.level||0);f=new sc.TradeEntryButton(p,
i,o,h,r,n,f,t);a.addButton(f);f.hook.pos.x=234;if(o==0)f.hook.pos.y=e+1}l=l+f.hook.size.y}g.hook.size.y=Math.max(l+1,44);e=e+(g.hook.size.y+2);if(k!=c.length-1){i=new ig.ColorGui("#545454",433,1);i.setPos(0,e-1);a.traderInfoGui.addChildGui(i)}else e=e-2;e=e+1}}a.traderInfoGui.hook.size.y=e;a.updateContentHeight()},hasAnyUpgrades:function(a){a=sc.trade.getTrader(a);return a.child?sc.trade.hasTrader(a.child):false},onListEntrySelected:function(a){if(a.offer!=void 0){if(a.trader){b.trader=a.trader;b.offer=
a.offer;b.index=a.hook.pos.y;sc.menu.setSynopInfo(b)}a.data&&a.data.description?sc.menu.setInfoText(a.data.description):sc.menu.setInfoText(null,true);sc.inventory.isBuffID(a.data.id)?sc.menu.setBuffText(sc.inventory.getBuffString(a.data.id)):sc.menu.setBuffText("",false)}else{sc.menu.setBuffText("",false);sc.menu.setSynopInfo(void 0);a.data&&(a.data instanceof Object||sc.menu.setInfoText(a.data))}},onListEntryPressed:function(a){if(a.trader&&a.offer!=void 0&&!sc.menu.tradeToggle){this.submitSound.play();
sc.menu.enterTradeDetails()}},onListMouseFocusLost:function(){sc.menu.setSynopInfo(null,true);sc.menu.setInfoText(null,true);sc.menu.setBuffText("",false)},modelChanged:function(a,b,c){if(a==sc.menu&&b==sc.MENU_EVENT.SORT_LIST){sc.menu.setSynopInfo(null,true);sc.menu.setInfoText(null,true);sc.menu.setBuffText("",false);this.sort(c.data.sortType)}}})});ig.baked=!0;
ig.module("game.feature.menu.gui.trade.trader-menu").requires("impact.feature.gui.gui","impact.feature.gui.base.basic-gui","game.feature.menu.gui.base-menu","game.feature.menu.gui.menu-misc","game.feature.trade.trade-model","game.feature.menu.gui.trade.trader-list","game.feature.menu.gui.trade.trade-misc").defines(function(){sc.TraderMenu=sc.ListInfoMenu.extend({detail:null,init:function(){this.parent(new sc.TradersListBox);this.detail=new sc.TradeDetailsView;this.addChildGui(this.detail);this.sortMenu.addButton("auto",
sc.TRADE_SORT_TYPE.ORDER,0);this.sortMenu.addButton("trader",sc.TRADE_SORT_TYPE.FOUND,1);this.list.setPos(0,0);this.doStateTransition("DEFAULT")},showMenu:function(){sc.menu.setSynopInfo(null,false);this.detail.reset();this.parent();this.updateSortMenuButton(this.list.getCurrentSortText())},exitMenu:function(){this.parent();this.detail.hide();sc.menu.setBuffText("",false);sc.menu.tradeToggle=false;ig.cleanCache()},enterDetails:function(){var b=sc.menu.synopInfo;this.detail.show(b.trader,b.offer,b.index-
this.list.currentList.getScrollY());sc.menu.pushBackCallback(this.onDetailsBackPressed.bind(this))},setTradeInfo:function(){var b=sc.menu.synopInfo;this.detail.setTraderData(b.trader,b.offer,b.index-this.list.currentList.getScrollY())},exitDetails:function(){this.detail.hide(true)},onDetailsBackPressed:function(){sc.menu.popBackCallback();sc.menu.exitTradeDetails()},createHelpGui:function(){if(!this.helpGui){this.helpGui=new sc.HelpScreen(this,ig.lang.get("sc.gui.menu.help-texts.traders.title"),ig.lang.get("sc.gui.menu.help-texts.traders.pages"),
function(){this.commitHotKeysToTopBar(true)}.bind(this),true);this.helpGui.hook.zIndex=15E4;this.helpGui.hook.pauseGui=true}},modelChanged:function(b,a,d){if(b==sc.menu)if(a==sc.MENU_EVENT.SORT_LIST)this.updateSortMenuButton(d.text);else if(a==sc.MENU_EVENT.SYNO_CHANGED_TAB){this.sortMenu.active&&this.sortMenu.hideSortMenu();this.updateSortMenuButton(this.list.getCurrentSortText())}else a==sc.MENU_EVENT.TRADE_TOGGLE_DETAILS?sc.menu.tradeToggle?this.enterDetails():this.exitDetails():a==sc.MENU_EVENT.SYNOP_SET_INFO&&
sc.menu.tradeToggle&&sc.menu.synopInfo&&this.setTradeInfo()}})});ig.baked=!0;
ig.module("game.feature.menu.gui.botanics.botanics-misc").requires("impact.feature.gui.gui","impact.feature.gui.base.basic-gui","game.feature.menu.gui.menu-misc").defines(function(){sc.BotanicsEntryButton=sc.ListBoxButton.extend({helperGfx:new ig.Image("media/gui/menu.png"),percent:null,plant:null,init:function(b,a,d,c,e){this.parent(b,142,54,d,c);this.plant=a;this.blockedSound=null;this.button.submitSound=null;this.percent=new ig.ImageGui(this.helperGfx,0,407,8,8);this.percent.setAlign(ig.GUI_ALIGN.X_RIGHT,
ig.GUI_ALIGN.Y_TOP);this.percent.setPos(7,7);this.addChildGui(this.percent);this.chance=new sc.NumberGui(100);this.chance.setAlign(ig.GUI_ALIGN.X_RIGHT,ig.GUI_ALIGN.Y_TOP);this.chance.setPos(16,7);this.addChildGui(this.chance);this.chance.setNumber(Math.round(e*100))}});sc.BotanicsPreUnlockButton=ig.FocusGui.extend({gfx:new ig.Image("media/gui/menu.png"),ninepatch:new ig.NinePatch("media/gui/buttons.png",{width:28,height:0,left:8,top:40,right:8,bottom:0,offsets:{"default":{x:0,y:114},focus:{x:45,
y:114}}}),overlayNinepatch:new ig.NinePatch("media/gui/buttons.png",{width:29,height:0,left:6,top:37,right:5,bottom:0,offsets:{"default":{x:171,y:51},focus:{x:214,y:51}}}),plant:null,text:null,collect:null,bar:null,init:function(b,a,d){this.parent();this.setSize(196,39);this.plant=b;this.text=new sc.TextGui(ig.lang.get("sc.gui.botanics.infoLocked"));this.text.setAlign(ig.GUI_ALIGN.X_CENTER,ig.GUI_ALIGN.Y_TOP);this.text.setPos(0,2);this.addChildGui(this.text);b=ig.lang.get("sc.gui.botanics.collect");
b=b.replace("[[x]]",""+a).replace("[[y]]",""+d);this.collect=new sc.TextGui(b,{font:sc.fontsystem.smallFont});this.collect.setAlign(ig.GUI_ALIGN.X_CENTER,ig.GUI_ALIGN.Y_TOP);this.collect.setPos(0,18);this.addChildGui(this.collect);this.bar=new sc.BotanicsProgressBar((a/d).limit(0,1));this.bar.setAlign(ig.GUI_ALIGN.X_LEFT,ig.GUI_ALIGN.Y_BOTTOM);this.bar.setPos(4,3);this.addChildGui(this.bar)},updateDrawables:function(b){this.ninepatch.draw(b,this.hook.size.x,this.hook.size.y,this.focus?"focus":"default");
this.overlayNinepatch.draw(b,this.hook.size.x-4,this.hook.size.y-2,this.focus?"focus":"default",2,1)}});sc.BotanicsProgressBar=ig.GuiElementBase.extend({gfx:new ig.Image("media/gui/status-gui.png"),backgroundPatch:new ig.NinePatch("media/gui/menu.png",{width:2,height:0,left:3,top:3,right:3,bottom:0,offsets:{"default":{x:16,y:416}}}),ratio:0,init:function(b){this.parent();this.setSize(188,3);this.ratio=Math.round(b*186)},updateDrawables:function(b){this.backgroundPatch.draw(b,this.hook.size.x,this.hook.size.y,
"default");b.addColor("#25b000",2,0,this.ratio,1);b.addColor("#25b000",1,1,this.ratio,1);b.addColor("#25b000",0,2,this.ratio,1)}});sc.BotanicsButtonBox=ig.GuiElementBase.extend({gfx:new ig.Image("media/gui/menu.png"),transitions:{DEFAULT:{state:{},time:0.2,timeFunction:KEY_SPLINES.LINEAR},HIDDEN:{state:{alpha:0},time:0.2,timeFunction:KEY_SPLINES.LINEAR}},plant:null,buttongroup:null,buttonStartIndex:0,buttons:[],plantView:null,plantName:null,location:null,init:function(b,a,d,c,e){this.parent();this.setSize(431,
46);this.plant=b;this.buttongroup=c;this.buttonStartIndex=e||0;c=sc.menu.drops[b];this.plantView=new sc.BotanicsPlantView;this.plantView.setPos(2,1);this.plantView.setPlant(b);this.addChildGui(this.plantView);this.plantName=new sc.TextGui(ig.LangLabel.getText(c.name));this.plantName.setPos(37,1);this.addChildGui(this.plantName);b=(a/(d||50)).limit(0,1);e=new ig.ImageGui(this.gfx,481,224,8,11);e.setPos(38,20);this.addChildGui(e);e="";if(b>=0.5){e=ig.LangLabel.getText(c.subArea);e=="MISSING LABEL"&&
(e="???")}else{e=ig.lang.get("sc.gui.botanics.locText");e=e.replace("[[x]]","\\c[3]"+(Math.ceil(d/2)-a)+"\\c[0]")}this.location=new sc.TextGui(e,{font:sc.fontsystem.smallFont,linePadding:-1,maxWidth:184});this.location.setPos(51,19);this.addChildGui(this.location)}});sc.BotanicsPlantView=ig.BoxGui.extend({ninepatch:new ig.NinePatch("media/gui/menu.png",{width:2,height:2,left:5,top:5,right:5,bottom:5,offsets:{"default":{x:488,y:16},square:{x:500,y:0},none:{x:400,y:0}}}),display:null,container:null,
transitions:{DEFAULT:{state:{},time:0.1,timeFunction:KEY_SPLINES.EASE},HIDDEN:{state:{alpha:0},time:0.1,timeFunction:KEY_SPLINES.EASE}},init:function(){this.parent(32,42);this.container=new ig.GuiElementBase;this.container.hook.clip=true;this.container.setSize(32,42);this.container.setPos(1,1);this.addChildGui(this.container)},setPlant:function(b,a){if(b){if(this.display){this.display.remove(true);this.display=null}if(b){this.display=new sc.ItemDestructDisplayGui(b,sc.menu.dropCounts[b].anim,true,
this.centerEntity.bind(this));this.container.addChildGui(this.display);this.doStateTransition("DEFAULT",true)}}else{if(this.display){a?this.display.remove(true):this.display.doStateTransition("HIDDEN",false,true);this.display=null}this.doStateTransition("HIDDEN",true)}},centerEntity:function(b){b.entity&&b.setPos(this.container.hook.size.x/2-b.hook.size.x/2-1,this.container.hook.size.y/2-b.hook.size.y/2-2)}});sc.ItemDestructDisplayGui=ig.GuiElementBase.extend({transitions:{DEFAULT:{state:{},time:0.2,
timeFunction:KEY_SPLINES.EASE_OUT},HIDDEN:{state:{alpha:0},time:0.2,timeFunction:KEY_SPLINES.EASE_IN}},config:null,destructType:null,gameState:null,size:{x:0,y:0},entity:null,callback:null,animSheet:null,init:function(b,a,d,c){this.parent();this.callback=c;this.config=b;this.destructType=a;this.doStateTransition("HIDDEN",true);this.onLoadableComplete(true,this.config)},onDetach:function(){this.animSheet&&this.animSheet.decreaseRef();this.animSheet=null;this.gameState&&this.gameState.clear();this.gameState=
null},onLoadableComplete:function(b,a){if(this.config)if(a==this.config){var d=sc.ITEM_DESTRUCT_TYPE[this.destructType];Vec3.assign(this.size,d.size||{x:12,y:12,z:28});this.setSize(this.size.x,this.size.y+this.size.z);this.setPivot(this.hook.size.x/2,this.hook.size.y/2);this.animSheet=new ig.AnimationSheet(d.anims);this.animSheet.addLoadListener(this)}else if(a==this.animSheet){this.initGameState();this.doStateTransition("DEFAULT",this.skipIfLoaded)}},initGameState:function(){this.gameState=new ig.GameState;
this.gameState.initEmpty(this.hook.size.x,this.hook.size.y);ig.game.pushState(this.gameState);this.entity=ig.game.spawnEntity(ig.ENTITY.ItemDestruct,0,this.size.z,0,{__GLOBAL__:this.config});this.entity.setSize(this.size.x,this.size.y,this.size.z);this.entity.animSheet=this.animSheet;this.entity.initAnimations();this.entity.setCurrentAnim("default");this.callback&&this.callback(this);ig.game.popState()},update:function(){this.gameState&&this.gameState.forceUpdate()},updateDrawables:function(b){this.gameState&&
b.addGameStateDraw(this.gameState,0,0)}})});ig.baked=!0;
ig.module("game.feature.menu.gui.botanics.botanics-list").requires("impact.feature.gui.gui","impact.feature.gui.base.basic-gui","impact.feature.gui.base.box","game.feature.gui.base.text","game.feature.menu.gui.menu-misc","game.feature.menu.gui.item.item-list","game.feature.menu.gui.list-boxes","game.feature.menu.gui.tab-box","game.feature.menu.gui.botanics.botanics-misc").defines(function(){sc.BotanicsListBox=sc.ListTabbedPane.extend({submitSound:null,init:function(){this.parent(true);this.setSize(436,
258);this.setPivot(436,258);this.setPanelSize(436,242);this.setPos(0,0);this.setAlign(ig.GUI_ALIGN.X_CENTER,ig.GUI_ALIGN.Y_CENTER);this.submitSound=sc.BUTTON_SOUND.submit;this.hook.transitions={DEFAULT:{state:{},time:0.2,timeFunction:KEY_SPLINES.LINEAR},HIDDEN:{state:{alpha:0,offsetX:218},time:0.2,timeFunction:KEY_SPLINES.LINEAR}};this.annotation={content:{title:"sc.gui.menu.help.botanics.titles.info",description:"sc.gui.menu.help.botanics.description.info"},offset:{x:2,y:34},size:{x:34,y:224},index:{x:0,
y:0}};this.bg.setSize(this.hook.size.x,222);var b=new sc.TextGui(ig.lang.get("sc.gui.botanics.rate"),{font:sc.fontsystem.tinyFont});b.setAlign(ig.GUI_ALIGN.X_RIGHT,ig.GUI_ALIGN.Y_TOP);b.setPos(6,-8);this.bg.addChildGui(b);for(var b=sc.map.getUnlockedAreas(),b=sc.map.sortAreaList(b),a=0,d=0;d<b.length;d++)sc.menu.hasAnyDropInArea(b[d])&&sc.menu.hasDropInArea(b[d])&&this.addTab(b[d],a++,{type:b[d]});sc.menu.hasAnyOtherDropFound()&&this.addTab("other",a,{type:"other"})},addObservers:function(){sc.Model.addObserver(sc.menu,
this)},removeObservers:function(){sc.Model.removeObserver(sc.menu,this)},show:function(){this.parent();this.setTab(this.currentTabIndex||0,true,{skipSounds:true});ig.interact.setBlockDelay(0.2);this.doStateTransition("DEFAULT")},hide:function(){this.parent();this.doStateTransition("HIDDEN")},getCurrentSortText:function(){var b=null,b=this.tabContent[this.currentTabIndex]?this.tabContent[this.currentTabIndex].sort||sc.BOTANICS_SORT_TYPE.ORDER:sc.BOTANICS_SORT_TYPE.ORDER,a="auto";switch(b){case sc.BOTANICS_SORT_TYPE.ORDER:a=
"auto";break;case sc.BOTANICS_SORT_TYPE.FOUND:a="botanics";break;case sc.BOTANICS_SORT_TYPE.NAME:a="botanicsName"}return ig.lang.get("sc.gui.menu.sort."+a)},onLeftRightPress:function(b,a){a!=this.currentTabIndex&&this.submitSound.play();return{skipSounds:true}},onTabChanged:function(){(ig.input.mouseGuiActive||this.currentGroup.isEmpty())&&sc.menu.setSynopInfo(null,true)},onTabButtonCreation:function(b,a,d){a=null;a=b=="other"?ig.lang.get("sc.gui.area.other"):sc.map.getAreaName(b);b="area-"+b;sc.fontsystem.hasIcon(b)||
(b="enemy-abstract");b=new sc.ItemTabbedBox.TabButton(a,b,140);b.textChild.setPos(7,1);b.setPos(0,2);b.setData({type:d.type});this.addChildGui(b);return b},onTabPressed:function(b,a){if(!a){this.submitSound.play();this.setTab(this.getButtonIndex(b));for(var d=this.tabArray.length;d--;)if(b==this.tabArray[d]){sc.menu.setSynoTab(d);break}sc.menu.setSynopInfo(null,true);return false}},onTabSelected:function(){ig.input.mouseGuiActive&&sc.menu.setSynopInfo(null,true)},onTabMouseFocusLost:function(){sc.menu.setSynopInfo(null,
true)},onCreateListEntries:function(b,a,d,c){var e=null,f=null,e=-1,g=null,h=f=null,i=e=0,j=0,d=sc.menu.getFoundDrops(d,c);b.setSize(436,222);b.paddingBetween=0;b.paddingTop=2;b.clear();a.clear();if(b.plantInfoGui)b.plantInfoGui.removeAllChildren();else{b.plantInfoGui=new ig.GuiElementBase;b.box.insertChildGui(b.plantInfoGui,0);b.forceLastScroll=true}for(var c=1,k=0;k<d.length;k++){g=d[k];f=sc.menu.drops[g];h=f.items;e=sc.menu.getDropCount(g);i=f.progress||50;j=(e/i).limit(0,1);f=new sc.BotanicsButtonBox(g,
e,i,a,b.getChildren().length);f.setPos(1,c);b.plantInfoGui.addChildGui(f);var l=0;if(j>=1)for(i=0;i<h.length;i++){var e=h[i].id,j=sc.inventory.getItemNameWithIcon(e),o=sc.inventory.getItemDescription(e),e=new sc.BotanicsEntryButton(j,g,e,o,h[i].prob||0);b.addButton(e);e.hook.pos.x=237;if(i==0)e.hook.pos.y=c+1;l=l+e.hook.size.y}else{e=new sc.BotanicsPreUnlockButton(g,e,i);b.addButton(e);e.hook.pos.x=236;e.hook.pos.y=c+1;l=l+e.hook.size.y}f.hook.size.y=Math.max(l+1,44);c=c+(f.hook.size.y+2);if(k!=d.length-
1){g=new ig.ColorGui("#545454",433,1);g.setPos(0,c-1);b.plantInfoGui.addChildGui(g)}else c=c-2;c=c+1}b.plantInfoGui.hook.size.y=c;b.updateContentHeight()},onListEntrySelected:function(b){if(b.plant!=void 0)b.data&&b.data.description?sc.menu.setInfoText(b.data.description):sc.menu.setInfoText(null,true);else{sc.menu.setBuffText("",false);sc.menu.setSynopInfo(void 0);b.data&&(b.data instanceof Object||sc.menu.setInfoText(b.data))}},onListEntryPressed:function(){},onListMouseFocusLost:function(){sc.menu.setSynopInfo(null,
true);sc.menu.setInfoText(null,true);sc.menu.setBuffText("",false)},modelChanged:function(b,a,d){if(b==sc.menu&&a==sc.MENU_EVENT.SORT_LIST){sc.menu.setSynopInfo(null,true);sc.menu.setInfoText(null,true);sc.menu.setBuffText("",false);this.sort(d.data.sortType)}}})});ig.baked=!0;
ig.module("game.feature.menu.gui.botanics.botanics-menu").requires("impact.feature.gui.gui","impact.feature.gui.base.basic-gui","game.feature.menu.gui.base-menu","game.feature.menu.gui.menu-misc","game.feature.menu.gui.botanics.botanics-list","game.feature.menu.gui.botanics.botanics-misc").defines(function(){sc.BotanicsMenu=sc.ListInfoMenu.extend({detail:null,init:function(){this.parent(new sc.BotanicsListBox);this.sortMenu.addButton("auto",sc.BOTANICS_SORT_TYPE.ORDER,0);this.sortMenu.addButton("botanics",
sc.BOTANICS_SORT_TYPE.FOUND,1);this.sortMenu.addButton("botanicsName",sc.BOTANICS_SORT_TYPE.NAME,2);this.list.setPos(0,0);this.doStateTransition("DEFAULT")},showMenu:function(){sc.menu.setSynopInfo(null,false);this.parent();this.updateSortMenuButton(this.list.getCurrentSortText())},exitMenu:function(){this.parent();sc.menu.tradeToggle=false;ig.cleanCache()},createHelpGui:function(){if(!this.helpGui){this.helpGui=new sc.HelpScreen(this,ig.lang.get("sc.gui.menu.help-texts.botanics.title"),ig.lang.get("sc.gui.menu.help-texts.botanics.pages"),
function(){this.commitHotKeysToTopBar(true)}.bind(this),true);this.helpGui.hook.zIndex=15E4;this.helpGui.hook.pauseGui=true}},modelChanged:function(b,a,d){if(b==sc.menu)if(a==sc.MENU_EVENT.SORT_LIST)this.updateSortMenuButton(d.text);else if(a==sc.MENU_EVENT.SYNO_CHANGED_TAB){this.sortMenu.active&&this.sortMenu.hideSortMenu();this.updateSortMenuButton(this.list.getCurrentSortText())}else a==sc.MENU_EVENT.SYNOP_SET_INFO&&sc.menu.tradeToggle&&sc.menu.synopInfo&&this.setTradeInfo()}})});ig.baked=!0;
ig.module("game.feature.menu.gui.arena.arena-cup-page").requires("impact.feature.gui.base.box","impact.feature.gui.gui","impact.feature.gui.base.basic-gui","game.feature.menu.gui.menu-misc","game.feature.gui.base.misc").defines(function(){sc.ArenaCupInfoPage=ig.GuiElementBase.extend({gfx:new ig.Image("media/gui/menu.png"),transitions:{DEFAULT:{state:{},time:0.2,timeFunction:KEY_SPLINES.LINEAR},HIDDEN:{state:{alpha:0,scaleY:0},time:0.2,timeFunction:KEY_SPLINES.LINEAR}},banner:null,headerInfo:null,
highscore:null,time:null,rushTime:null,noRush:null,rounds:null,rush:null,difficulty:null,coins:null,init:function(){this.parent();this.setPivot(0,1);this.setSize(269,214);var b=1;this.banner=new sc.ArenaBanner;this.banner.hook.pos.y=b;this.addChildGui(this.banner);b=b+this.banner.hook.size.y;this.highscore=this.createStatGui("highscore","KeyValue",this,b,{value:1,maxValue:999999999,asNumber:true,numberDots:true,transitionTime:0.2});this.setAnnotation(this.highscore,"highscore",0,"dyn",18);this.time=
this.createStatGui("time","Time",this,b+20,{value:function(){return 0},leading:2,max:99,millis:true,hideHours:true,transitionTime:0.2});this.setAnnotation(this.time,"time",1,"dyn",38);this.rushTime=this.createStatGui("rush","Time",this,b+40,{value:function(){return 0},width:253,leading:2,max:99,millis:true,hideHours:true,transitionTime:0.2});this.rushTime.hook.transitions={DEFAULT:{state:{},time:0.2,timeFunction:KEY_SPLINES.LINEAR},HIDDEN:{state:{alpha:0},time:0.2,timeFunction:KEY_SPLINES.LINEAR}};
this.rushTime.doStateTransition("DEFAULT",true);this.noRush=this.createStatGui("rush","KeyValue",this,b+40,{value:ig.lang.get("sc.gui.arena.rushDisabled"),transitionTime:0.2,width:253});this.noRush.hook.transitions={DEFAULT:{state:{},time:0.2,timeFunction:KEY_SPLINES.LINEAR},HIDDEN:{state:{alpha:0},time:0.2,timeFunction:KEY_SPLINES.LINEAR}};this.noRush.doStateTransition("HIDDEN",true);this.noRush.hook.pos.x=this.noRush.hook.pos.x+24;this.rushTime.hook.pos.x=this.rushTime.hook.pos.x+24;var a=new ig.ImageGui(this.gfx,
512,207,17,16);a.setPos(-17,-1);this.rushTime.addChildGui(a);a=new ig.ImageGui(this.gfx,512,207,17,16);a.setPos(-17,-1);this.noRush.addChildGui(a);b=b+62;this.headerInfo=new sc.ArenaInfoLine(ig.lang.get("sc.gui.arena.menu.info"));this.headerInfo.setPos(0,b);this.headerInfo.show(true);this.addChildGui(this.headerInfo);b=b+(this.headerInfo.hook.size.y-1);this.difficulty=new sc.ArenaKeyValue(ig.lang.get("sc.gui.arena.menu.difficulty"),268);this.difficulty.valueGui.setPos(0,-2);this.difficulty.setPos(1,
b);this.setAnnotation(this.difficulty,"difficulty",2,277,16,-5,1);this.addChildGui(this.difficulty);b=b+17;this.coins=new sc.ArenaKeyValue(ig.lang.get("sc.gui.arena.menu."+(sc.menu.arenaCustomMode?"creator":"coins")),267);this.coins.setPos(1,b);this.setAnnotation(this.coins,sc.menu.arenaCustomMode?"creator":"coins",3,277,16,-5,1);this.addChildGui(this.coins);b=b+17;this.rounds=new sc.ArenaKeyValue(ig.lang.get("sc.gui.arena.menu.rounds"),267);this.rounds.setPos(1,b);this.setAnnotation(this.rounds,
"rounds",4,277,34,-5,1);this.addChildGui(this.rounds);b=b+17;this.rush=new sc.ArenaKeyValue("\\i[insetArrow]"+ig.lang.get("sc.gui.arena.menu.rush"),270,true);this.rush.valueGui.setPos(1,-1);this.rush.setPos(1,b);this.addChildGui(this.rush);b=b+17;this.setData();this.hook.size.y=b;this.doStateTransition("HIDDEN",true)},show:function(){this.doStateTransition("DEFAULT")},hide:function(b){this.doStateTransition("HIDDEN",b)},createStatGui:function(b,a,d,c,e){a=new sc.STATS_ENTRY_TYPE[a](b,e,e.width||277);
a.keyGui.setText(ig.lang.get("sc.gui.arena.menu."+b));a.setPos(-4,c);d&&d.addChildGui(a);return a},setAnnotation:function(b,a,d,c,e,f,g){b.annotation={content:{title:"sc.gui.menu.help.arena.titles."+a,description:"sc.gui.menu.help.arena.description."+a},offset:{x:f||0,y:g||0},size:{x:c||"dyn",y:e||"dyn"},index:{x:0,y:d+1}}},setData:function(b,a){if(a){var d=a.core;this.difficulty.setValue(this.getDifficulty(d.difficulty));this.banner.setImage(d.banner,d.offset);this.highscore.setValueAsNumber(sc.arena.getTotalPoints(b,
true));this.time.setTime(sc.arena.getTotalTime(b));this.rushTime.setTime(sc.arena.getRoundTime(b,-1));this.rounds.setValue(sc.arena.getRoundsCleared(b)+"\\i[slash]"+a.rounds.length);sc.menu.arenaCustomMode?this.coins.setValue(d.creator?ig.LangLabel.getText(d.creator):ig.lang.get("sc.gui.arena.arenaName")):this.coins.setValue(sc.arena.getArenaCoinsObtainedInCup(b)+"\\i[slash]"+sc.arena.getAvailableArenaCoinsInCup(b));if(d.noRush){this.noRush.doStateTransition("DEFAULT",true);this.rushTime.doStateTransition("HIDDEN",
true);this.rush.setValue("\\i[arena-medal-x]")}else{this.noRush.doStateTransition("HIDDEN",true);this.rushTime.doStateTransition("DEFAULT",true);this.rush.setValue("\\i[arena-medal-"+sc.arena.getCupMedal(b,-1)+"]")}}else{this.noRush.doStateTransition("HIDDEN",true);this.rushTime.doStateTransition("DEFAULT",true);this.difficulty.setValue(this.getDifficulty(0));this.banner.setImage();this.highscore.setValueAsNumber(0,true);this.time.setTime(0,true);this.rushTime.setTime(0,true);this.rounds.setValue("0\\i[slash]0");
this.rush.setValue("\\i[arena-medal-0]");this.coins.setValue(sc.menu.arenaCustomMode?"":"0\\i[slash]0")}},getDifficulty:function(b){for(var b=parseInt(b).limit(0,6),a="",d=5;d--;)a=a+(d<b?"\\i[diff-"+b+"]":"\\i[diff-0]");return a}});sc.ArenaBanner=ig.GuiElementBase.extend({gfx:new ig.Image("media/gui/menu.png"),image:null,imageGui:null,init:function(b){this.parent();this.setSize(b||277,64);this.setPos(-4,0)},setImage:function(b,a){if(b){this.imageGui&&this.imageGui.remove();this.image=new ig.Image(b.src);
this.imageGui=new ig.ImageGui(this.image,b.offX||0,b.offY||0,b.width||8,b.height||8);a&&this.imageGui.setPos(a.x,a.y);this.addChildGui(this.imageGui)}else{this.image=null;this.imageGui&&this.imageGui.remove();this.imageGui=null}},updateDrawables:function(b){var a=this.hook.size;b.addColor("#000",0,0,a.x,a.y-1).setAlpha(0.5);b.addColor("#FFF",32,0,a.x-64,1);b.addColor("#FFF",32,a.y-2,a.x-64,1);b.addGfx(this.gfx,0,0,416,504,32,1);b.addGfx(this.gfx,0,a.y-2,416,504,32,1);b.addGfx(this.gfx,a.x-32,0,416,
504,32,1,true);b.addGfx(this.gfx,a.x-32,a.y-2,416,504,32,1,true)}})});ig.baked=!0;
ig.module("game.feature.menu.gui.arena.arena-round-page").requires("impact.feature.gui.base.box","impact.feature.gui.gui","impact.feature.gui.base.basic-gui","game.feature.menu.gui.menu-misc","game.feature.gui.base.misc").defines(function(){sc.ArenaRoundInfoPage=ig.GuiElementBase.extend({gfx:new ig.Image("media/gui/menu.png"),numberGFX:new ig.Image("media/gui/basic.png"),transitions:{DEFAULT:{state:{},time:0.2,timeFunction:KEY_SPLINES.LINEAR},HIDDEN:{state:{alpha:0,scaleY:0},time:0.2,timeFunction:KEY_SPLINES.LINEAR}},
highscore:null,time:null,coins:null,clearTimes:null,headerInfo:null,headerFeat:null,headerChallenges:null,medals:null,bonuses:null,challenges:null,noneText:null,leftContent:null,rightContent:null,side:false,init:function(){this.parent();this.setPivot(0,213);this.setSize(269,213);var b=2;this.leftContent=new ig.GuiElementBase;this.leftContent.hook.transitions={DEFAULT:{state:{},time:0.2,timeFunction:KEY_SPLINES.LINEAR},HIDDEN:{state:{alpha:0.5,scaleX:0},time:0.2,timeFunction:KEY_SPLINES.LINEAR}};this.leftContent.setPivot(-4,
0);this.leftContent.setSize(269,213);this.leftContent.setPos(0,0);this.addChildGui(this.leftContent);this.rightContent=new ig.GuiElementBase;this.rightContent.hook.transitions={DEFAULT:{state:{},time:0.2,timeFunction:KEY_SPLINES.LINEAR},HIDDEN:{state:{alpha:0.5,scaleX:0},time:0.2,timeFunction:KEY_SPLINES.LINEAR}};this.rightContent.setPivot(273,0);this.rightContent.setSize(269,213);this.rightContent.setPos(0,0);this.rightContent.doStateTransition("HIDDEN",true);this.addChildGui(this.rightContent);
this.highscore=this.createStatGui("highscore","KeyValue",this.leftContent,b,{value:1,maxValue:999999999,asNumber:true,numberDots:true,transitionTime:0.2});this.setAnnotation(this.highscore,"highscoreRound",0,"dyn",32);b=b+18;this.medals=new sc.ArenaRoundInfoPage.Medals;this.medals.setAlign(ig.GUI_ALIGN.X_RIGHT,ig.GUI_ALIGN.Y_TOP);this.medals.setPos(1,b);this.leftContent.addChildGui(this.medals);var a=new ig.ImageGui(this.gfx,544,224,9,12);a.setAlign(ig.GUI_ALIGN.X_RIGHT,ig.GUI_ALIGN.Y_TOP);a.setPos(this.medals.hook.size.x+
3,b);this.leftContent.addChildGui(a);b=b+this.medals.hook.size.y;this.time=this.createStatGui("timeRound","Time",this.leftContent,b,{value:function(){return 0},leading:2,max:99,millis:true,hideHours:true,transitionTime:0.2});this.setAnnotation(this.time,"timeRound",1,"dyn",18,0,-1);b=b+17;if(!sc.menu.arenaCustomMode){this.coins=new sc.ArenaKeyValue(ig.lang.get("sc.gui.arena.menu.coins"),267);this.coins.setPos(1,b);this.setAnnotation(this.coins,"coinsRound",2,277,16,-5,1);this.leftContent.addChildGui(this.coins);
b=b+17}this.clearTimes=new sc.ArenaKeyValue(ig.lang.get("sc.gui.arena.menu.cleared"),267);this.clearTimes.setPos(1,b);this.setAnnotation(this.clearTimes,"clears",3,277,16,-5,1);this.leftContent.addChildGui(this.clearTimes);b=b+20;this.headerFeat=new sc.ArenaInfoLine(ig.lang.get("sc.gui.arena.menu.objective"));this.headerFeat.setPos(0,b);this.headerFeat.show(true);this.leftContent.addChildGui(this.headerFeat);b=b+(this.headerFeat.hook.size.y+2);a=new ig.GuiElementBase;a.setSize(269,38);a.setPos(0,
b+2);this.leftContent.addChildGui(a);this.setAnnotation(a,"objective",4,277,83+(sc.menu.arenaCustomMode?17:0),-4,-4);this.description=new sc.TextGui("",{font:sc.fontsystem.smallFont,maxWidth:269,textAlign:ig.Font.ALIGN.CENTER,linePadding:0});this.description.setAlign(ig.GUI_ALIGN.X_CENTER,ig.GUI_ALIGN.Y_TOP);this.description.setPos(0,0);a.addChildGui(this.description);b=2;this.headerFeat=new sc.ArenaInfoLine(ig.lang.get("sc.gui.arena.menu.bonuses"));this.headerFeat.setPos(0,b);this.headerFeat.show(true);
this.bonusTotal=this.createStatGui("bonuses","KeyValue",this.rightContent,b,{value:1,maxValue:999999999,asNumber:true,numberDots:true,transitionTime:0.2});this.setAnnotation(this.bonusTotal,"bonus",0,"dyn",72);b=b+14;this.bonuses=new ig.GuiElementBase;this.bonuses.setSize(269,60);this.bonuses.setPos(0,b);this.rightContent.addChildGui(this.bonuses);b=b+this.bonuses.hook.size.y;this.headerChallenges=new sc.ArenaInfoLine(ig.lang.get("sc.gui.arena.menu.challenges"));this.headerChallenges.setPos(0,b);
this.headerChallenges.show(true);this.rightContent.addChildGui(this.headerChallenges);b=b+(this.headerChallenges.hook.size.y+2);this.challenges=new ig.GuiElementBase;this.challenges.setSize(269,92);this.challenges.setPos(0,b);this.rightContent.addChildGui(this.challenges);this.setAnnotation(this.challenges,"challenges",4,277,100,-4,-4);this.noneText=new sc.TextGui(ig.lang.get("sc.gui.arena.menu.bonusNone"),{font:sc.fontsystem.smallFont,maxWidth:269,textAlign:ig.Font.ALIGN.CENTER});this.noneText.setAlign(ig.GUI_ALIGN.X_CENTER,
ig.GUI_ALIGN.Y_CENTER);b=new ig.ColorGui("#545454",277,22);b.setAlign(ig.GUI_ALIGN.X_CENTER,ig.GUI_ALIGN.Y_BOTTOM);b.setPos(0,2);this.addChildGui(b);this.rightButton=new sc.ButtonGui("\\i[page-right]",32,true,sc.BUTTON_TYPE.SMALL);this.rightButton.onButtonPress=this.onRightButtonPressed.bind(this);this.rightButton.textChild.setPos(1,0);this.rightButton.keepMouseFocus=true;this.rightButton.hook.transitions={DEFAULT:{state:{},time:0.2,timeFunction:KEY_SPLINES.EASE},HIDDEN:{state:{alpha:0,offsetX:5},
time:0.2,timeFunction:KEY_SPLINES.LINEAR}};this.rightButton.setAlign(ig.GUI_ALIGN.X_RIGHT,ig.GUI_ALIGN.Y_BOTTOM);this.rightButton.setPos(-4,2);this.addChildGui(this.rightButton);this.leftButton=new sc.ButtonGui("\\i[page-left]",32,true,sc.BUTTON_TYPE.SMALL);this.leftButton.onButtonPress=this.onLeftButtonPressed.bind(this);this.leftButton.textChild.setPos(1,0);this.leftButton.keepMouseFocus=true;this.leftButton.hook.transitions={DEFAULT:{state:{},time:0.2,timeFunction:KEY_SPLINES.EASE},HIDDEN:{state:{alpha:0,
offsetX:5},time:0.2,timeFunction:KEY_SPLINES.LINEAR}};this.leftButton.setAlign(ig.GUI_ALIGN.X_LEFT,ig.GUI_ALIGN.Y_BOTTOM);this.leftButton.setPos(-4,2);this.addChildGui(this.leftButton);this.pagesNumberContainer=new ig.GuiElementBase;this.pagesNumberContainer.setAlign(ig.GUI_ALIGN.X_CENTER,ig.GUI_ALIGN.Y_BOTTOM);this.pagesNumberContainer.setPos(0,7);this.pagesNumberContainer.setSize(60,8);this.pagesNumberContainer.hook.transitions={DEFAULT:{state:{},time:0.2,timeFunction:KEY_SPLINES.LINEAR},HIDDEN:{state:{alpha:0},
time:0.2,timeFunction:KEY_SPLINES.LINEAR}};b=new ig.ImageGui(this.numberGFX,96,0,8,8);b.setAlign(ig.GUI_ALIGN.X_CENTER,ig.GUI_ALIGN.Y_TOP);this.pagesNumberContainer.addChildGui(b);this.currentPage=new sc.NumberGui(99);this.currentPage.setAlign(ig.GUI_ALIGN.X_RIGHT,ig.GUI_ALIGN.Y_TOP);this.currentPage.setPos(36,0);this.pagesNumberContainer.addChildGui(this.currentPage);b=new sc.NumberGui(2);b.setNumber(2,true);b.setAlign(ig.GUI_ALIGN.X_LEFT,ig.GUI_ALIGN.Y_TOP);b.setPos(36,0);this.pagesNumberContainer.addChildGui(b);
this.addChildGui(this.pagesNumberContainer);this.setData()},onRightButtonCheck:function(){return sc.control.rightPressed()},onLeftButtonCheck:function(){return sc.control.leftPressed()},onRightButtonPressed:function(){this.togglePage()},onLeftButtonPressed:function(){this.togglePage()},show:function(){sc.menu.buttonInteract.removeGlobalButton(this.rightButton);sc.menu.buttonInteract.removeGlobalButton(this.leftButton);this.side=true;this.togglePage(true);this.doStateTransition("DEFAULT")},hide:function(b){sc.menu.buttonInteract.removeGlobalButton(this.rightButton);
sc.menu.buttonInteract.removeGlobalButton(this.leftButton);this.doStateTransition("HIDDEN",b)},togglePage:function(b){ig.interact.setBlockDelay(0.2);if(this.side=!this.side){this.leftContent.doStateTransition("HIDDEN",b);this.rightContent.doStateTransition("DEFAULT",b);this.rightButton.doStateTransition("HIDDEN",true);this.leftButton.doStateTransition("DEFAULT",true);sc.menu.buttonInteract.removeGlobalButton(this.rightButton);sc.menu.buttonInteract.addGlobalButton(this.leftButton,this.onLeftButtonCheck.bind(this),
true);this.currentPage.setNumber(2)}else{this.leftContent.doStateTransition("DEFAULT",b);this.rightContent.doStateTransition("HIDDEN",b);this.rightButton.doStateTransition("DEFAULT",true);this.leftButton.doStateTransition("HIDDEN",true);sc.menu.buttonInteract.removeGlobalButton(this.leftButton);sc.menu.buttonInteract.addGlobalButton(this.rightButton,this.onRightButtonCheck.bind(this),true);this.currentPage.setNumber(1)}},setData:function(b,a){if(b){this.highscore.setValueAsNumber(sc.arena.getRoundPoints(b,
a));this.medals.setValues(sc.arena.getRoundMedalRequirement(b,a,true),sc.arena.getRoundMedalRequirement(b,a),sc.arena.getRoundMedalRequirement(b,a,false,true));this.time.setTime(sc.arena.getRoundTime(b,a),true);this.coins&&this.coins.setValue(sc.arena.getArenaCoinsObtainedInRound(b,a)+"\\i[slash]"+sc.arena.getAvailableArenaCoinsInRound(b,a));this.clearTimes.setValue(sc.arena.getRoundCompletionTotal(b,a)+"");this.bonuses.removeAllChildren();this.challenges.removeAllChildren();if(a!=-1){var d=sc.arena.getCupRounds(b)[a],
c=d.objective?ig.LangLabel.getText(d.objective):ig.lang.get("sc.gui.arena.menu.objectiveDefault");d.description&&(c=c+("\\n"+ig.LangLabel.getText(d.description)));this.description.setText(c);this.setBonusPoints(d.bonuses);this.setChallenges(sc.arena.getChallengeMods(b,a))}else{this.setChallenges(sc.arena.getChallengeMods(b,-1));this.bonusTotal.setValueAsNumber(0);this.bonuses.addChildGui(this.noneText);this.description.setText(ig.lang.get("sc.gui.arena.menu.objectiveRushMode"))}}else{this.bonusTotal.setValueAsNumber(0,
true);this.highscore.setValueAsNumber(0,true);this.medals.setValues(0,0,0,true);this.time.setTime(0,true);this.description.setText("");this.bonuses.removeAllChildren();this.challenges.removeAllChildren();this.clearTimes.setValue("0");this.coins&&this.coins.setValue("0\\i[slash]0")}},setChallenges:function(b){if(b){var a=0,d=0,c=Object.keys(b).length>=6,e;for(e in b){var f=new sc.ArenaChallengeEntry(e,269,c,b[e].global);f.setPos(0,a);this.challenges.addChildGui(f);a=a+(f.hook.size.y-3);d++}}},setBonusPoints:function(b){var a=
0,b=ig.copy(b);b.sort(function(a,b){return(sc.ARENA_BONUS_OBJECTIVE[a.type]||0).order-(sc.ARENA_BONUS_OBJECTIVE[b.type]||0).order}.bind(this));if(b)for(var d=Math.min(b.length,sc.ARENA_MAX_BONUS_OBJECTIVES),c=0;c<d;c++){b.length<=4?this.createBonusEntry("\\i[insetArrow]"+this.getBonusText(b[c]),c*14,this.getBonusPointsText(b[c])):this.createBonusEntry("\\i[insetArrow]"+this.getBonusText(b[c]),5+c*9,this.getBonusPointsText(b[c]),true);a=a+b[c].points}this.bonusTotal.setValueAsNumber(a)},getBonusText:function(b){return sc.ARENA_BONUS_OBJECTIVE[b.type]?
sc.ARENA_BONUS_OBJECTIVE[b.type].getText(ig.lang.get("sc.gui.arena.bonuses."+b.type),b):"INVALID TYPE: "+b.type},getBonusPointsText:function(b){var a=sc.ARENA_BONUS_OBJECTIVE[b.type];return a?(a.getPointsRange?a.getPointsRange(b,b.points):b.points||0)+"":"INVALID_TYPE: "+b.type},createBonusEntry:function(b,a,d,c){var e=null;if(c){e=new sc.TrophyTabOverview.Entry(b,d,267);e.setAlign(ig.GUI_ALIGN.X_LEFT,ig.GUI_ALIGN.Y_TOP)}else{e=new sc.ArenaKeyValue(b,267);e.setValue(d||"")}e.setPos(1,a);this.bonuses.addChildGui(e)},
createStatGui:function(b,a,d,c,e){a=new sc.STATS_ENTRY_TYPE[a](b,e,e.width||277);a.keyGui.setText(ig.lang.get("sc.gui.arena.menu."+b));a.setPos(-4,c);d&&d.addChildGui(a);return a},setAnnotation:function(b,a,d,c,e,f,g){b.annotation={content:{title:"sc.gui.menu.help.arena.titles."+a,description:"sc.gui.menu.help.arena.description."+a},offset:{x:f||0,y:g||0},size:{x:c||"dyn",y:e||"dyn"},index:{x:0,y:d+1}}}});sc.ArenaChallengeEntry=ig.GuiElementBase.extend({gfx:new ig.Image("media/gui/arena-gui.png"),
icon:null,text:null,tiny:false,global:false,init:function(b,a,d,c){this.parent();this.tiny=d||false;this.global=c||false;this.icon=sc.ARENA_CHALLENGES[b||"NO_MELEE"].icon||1;if(this.tiny){this.text=new sc.TextGui(ig.lang.get("sc.gui.arena.challenges.descriptions."+b),{font:sc.fontsystem.tinyFont,maxWidth:a-13});this.text.setPos(13,1);this.addChildGui(this.text);this.setSize(a,Math.max(this.text.hook.size.y+4,14))}else{this.text=new sc.TextGui(ig.lang.get("sc.gui.arena.challenges.descriptions."+b),
{font:sc.fontsystem.smallFont,maxWidth:a-21});this.text.setPos(21,2);this.addChildGui(this.text);this.setSize(a,Math.max(this.text.hook.size.y+4,22))}},updateDrawables:function(b){if(this.tiny){b.addGfx(this.gfx,0,0,364+this.icon%6*10,~~(this.icon/6)*10,10,10);this.global&&b.addGfx(this.gfx,0,0,146,48,10,10)}else{b.addGfx(this.gfx,0,0,256+this.icon%6*18,~~(this.icon/6)*18,18,18);this.global&&b.addGfx(this.gfx,0,0,128,48,18,18)}}});sc.ArenaRoundInfoPage.Medals=ig.GuiElementBase.extend({gfx:new ig.Image("media/gui/arena-gui.png"),
silver:null,gold:null,platin:null,platUnlocked:false,init:function(){this.parent();this.silver=new sc.NumberGui(99999999,{size:sc.NUMBER_SIZE.NORMAL,transitionTime:0.2,leadingZeros:8,zeroAsGrey:true});this.silver.setPos(18,4);this.silver.setNumber(0,true);this.addChildGui(this.silver);this.gold=new sc.NumberGui(99999999,{size:sc.NUMBER_SIZE.NORMAL,transitionTime:0.2,leadingZeros:8,zeroAsGrey:true});this.gold.setPos(18+this.silver.hook.size.x+5+18,4);this.gold.setNumber(0,true);this.addChildGui(this.gold);
if(this.platUnlocked=sc.stats.getMap("arena","medals-got-4")>0){this.platin=new sc.NumberGui(99999999,{size:sc.NUMBER_SIZE.NORMAL,transitionTime:0.2,leadingZeros:8,zeroAsGrey:true});this.platin.setPos(18+this.silver.hook.size.x+this.gold.hook.size.x+10+36,4);this.platin.setNumber(0,true);this.addChildGui(this.platin);this.setSize(64+this.silver.hook.size.x+this.gold.hook.size.x+this.platin.hook.size.x,16)}else this.setSize(41+this.silver.hook.size.x+this.gold.hook.size.x,16)},updateDrawables:function(b){b.addGfx(this.gfx,
0,0,32,0,16,16);b.addGfx(this.gfx,this.silver.hook.size.x+5+18,0,48,0,16,16);this.platUnlocked&&b.addGfx(this.gfx,this.silver.hook.size.x+this.gold.hook.size.x+10+36,0,64,0,16,16)},setValues:function(b,a,d,c){this.silver.setNumber(b,c);this.gold.setNumber(a,c);this.platUnlocked&&this.platin.setNumber(d,c)}})});ig.baked=!0;
ig.module("game.feature.menu.gui.arena.arena-misc").requires("impact.feature.gui.base.box","impact.feature.gui.gui","impact.feature.gui.base.basic-gui","game.feature.menu.gui.menu-misc","game.feature.menu.gui.arena.arena-cup-page","game.feature.menu.gui.arena.arena-round-page","game.feature.menu.gui.stats.stats-types").defines(function(){function b(a){for(var b=ig.currentLang+"",b=ig.LANG_DETAILS[ig.currentLang]&&ig.LANG_DETAILS[ig.currentLang].commaDigits?".":",",c=/(\d+)(\d{3})/,a=a+"";c.test(a);)a=
a.replace(c,"$1"+b+"$2");return a}sc.ArenaInfoBox=ig.BoxGui.extend({gfx:new ig.Image("media/gui/basic.png"),ninepatch:new ig.NinePatch("media/gui/menu.png",{width:2,height:8,left:27,top:21,right:27,bottom:3,offsets:{"default":{x:520,y:0},single:{x:456,y:244}}}),title:null,category:null,level:null,pages:[],cup:null,key:"-1s",round:-2,page:0,init:function(){this.parent(281,237);this.setAlign(ig.GUI_ALIGN.X_LEFT,ig.GUI_ALIGN.Y_TOP);this.hook.transitions={DEFAULT:{state:{},time:0.2,timeFunction:KEY_SPLINES.EASE},
HIDDEN:{state:{alpha:0,offsetX:-(this.hook.size.x/2)},time:0.2,timeFunction:KEY_SPLINES.LINEAR}};this.annotation={content:{title:"sc.gui.menu.help.arena.titles.avgLevel",description:"sc.gui.menu.help.arena.description.avgLevel"},offset:{x:257,y:2},size:{x:21,y:19},index:{x:0,y:0}};this.title=new sc.TextGui("");this.title.setAlign(ig.GUI_ALIGN.X_CENTER,ig.GUI_ALIGN.Y_TOP);this.title.setPos(0,4);this.addChildGui(this.title);this.category=new sc.TextGui("");this.category.setPos(7,3);this.addChildGui(this.category);
this.level=new sc.NumberGui(99,{leadingZeros:2});this.level.setAlign(ig.GUI_ALIGN.X_RIGHT,ig.GUI_ALIGN.Y_TOP);this.level.setPos(5,11);this.addChildGui(this.level);var a=new sc.ArenaCupInfoPage;a.setPos(6,23);this.addChildGui(a);this.pages.push(a);a=new sc.ArenaRoundInfoPage;a.setPos(6,24);a.doStateTransition("HIDDEN",true);this.addChildGui(a);this.pages.push(a);a=new sc.ArenaTopLine(277);a.setPos(2,24);this.addChildGui(a);a=new sc.TextGui("lvl",{font:sc.fontsystem.tinyFont});a.setAlign(ig.GUI_ALIGN.X_RIGHT,
ig.GUI_ALIGN.Y_TOP);a.setPos(6,3);this.addChildGui(a);this.setInfo()},show:function(){this.pages[0].doStateTransition("DEFAULT",true);this.doStateTransition("DEFAULT")},hide:function(){this.key="-1s";this.cup=null;this.page=0;this.round=-2;this.doStateTransition("HIDDEN")},switchPage:function(a){this.pages[this.page]&&this.pages[this.page].hide();this.page=a||0;this.pages[this.page]&&this.pages[this.page].show();this.key="-1s";this.round=-2},setInfo:function(a,b){this.page==0?this.setCupInfo(a):this.page==
1&&this.setRoundInfo(a,b)},setCupInfo:function(a){if(this.key!=a){this.level.setNumber(a?sc.arena.getCupLevel(a):0);this.key=a;(this.cup=sc.arena.getCupData(this.key))?this.title.setText(sc.arena.getCupName(this.key)):this.title.setText(ig.lang.get("sc.gui.arena.menu.noCup"));this.pages[0].setData(a,this.cup,true)}},setRoundInfo:function(a,b){if(b==void 0){this.title.setText(ig.lang.get("sc.gui.arena.menu.noRound"));this.pages[1].setData();this.round=-2}else if(!(this.key==a&&this.round==b)){this.key=
a;this.round=b;(this.cup=sc.arena.getCupData(this.key))?b==-1?this.title.setText(ig.lang.get("sc.gui.arena.menu.rush")):this.title.setText(ig.LangLabel.getText(this.cup.rounds[b].name)):this.title.setText(ig.lang.get("sc.gui.arena.menu.noRound"));this.round>=-1&&this.pages[1].setData(a,this.round,true)}},setCategory:function(a){this.category.setText("\\i[arena-"+a+"]")}});sc.ArenaTopLine=ig.GuiElementBase.extend({gfx:new ig.Image("media/gui/menu.png"),init:function(a){this.parent();this.setSize(a||
100,1)},updateDrawables:function(a){this.parent(a);var b=this.hook.size;a.addGfx(this.gfx,0,0,416,504,32,1);a.addColor("#FFF",32,0,b.x-64,1);a.addGfx(this.gfx,b.x-32,0,416,504,32,1,true)}});sc.ArenaKeyValue=ig.SimpleGui.extend({gfx:new ig.Image("media/gui/menu.png"),transitions:{DEFAULT:{state:{},time:0.2,timeFunction:KEY_SPLINES.LINEAR},HIDDEN:{state:{alpha:0},time:0.2,timeFunction:KEY_SPLINES.LINEAR}},keyGui:null,valueGui:null,init:function(a,b,c){this.parent();this.setSize(b||269,20);this.keyGui=
new sc.TextGui(a,{font:sc.fontsystem.smallFont});this.keyGui.setAlign(ig.GUI_ALIGN.X_LEFT,ig.GUI_ALIGN.Y_CENTER);this.keyGui.setPos(0,0);this.addChildGui(this.keyGui);this.valueGui=new sc.TextGui("",{font:c?sc.fontsystem.font:sc.fontsystem.smallFont});this.valueGui.setAlign(ig.GUI_ALIGN.X_RIGHT,ig.GUI_ALIGN.Y_CENTER);this.valueGui.setPos(0,0);this.addChildGui(this.valueGui);if(!this.constructor.PATTERN)this.constructor.PATTERN=this.gfx.createPattern(560,192,15,4,ig.ImagePattern.OPT.REPEAT_X)},setKey:function(a){this.keyGui.setText(a)},
setValue:function(a){this.valueGui.setText(a)},updateDrawables:function(a){if(this.keyGui&&this.valueGui){var b=this.keyGui.hook.size.x+this.keyGui.hook.pos.x+1,c=this.hook.size.x-this.keyGui.hook.size.x-this.valueGui.hook.size.x-1,c=Math.floor(c/3)*3;a.addPattern(this.constructor.PATTERN,b,12,0,0,c,4)}}});sc.ArenaTinyKeyValue=ig.SimpleGui.extend({gfx:new ig.Image("media/gui/menu.png"),transitions:{DEFAULT:{state:{},time:0.2,timeFunction:KEY_SPLINES.LINEAR},HIDDEN:{state:{alpha:0},time:0.2,timeFunction:KEY_SPLINES.LINEAR}},
keyGui:null,valueGui:null,init:function(a,b,c){this.parent();this.setSize(b||269,20);this.keyGui=new sc.TextGui(a,{font:sc.fontsystem.smallFont});this.keyGui.setAlign(ig.GUI_ALIGN.X_LEFT,ig.GUI_ALIGN.Y_CENTER);this.keyGui.setPos(0,0);this.addChildGui(this.keyGui);this.valueGui=new sc.TextGui("",{font:c?sc.fontsystem.font:sc.fontsystem.smallFont});this.valueGui.setAlign(ig.GUI_ALIGN.X_RIGHT,ig.GUI_ALIGN.Y_CENTER);this.valueGui.setPos(0,0);this.addChildGui(this.valueGui);if(!this.constructor.PATTERN)this.constructor.PATTERN=
this.gfx.createPattern(560,192,15,4,ig.ImagePattern.OPT.REPEAT_X)},updateDrawables:function(a){if(this.keyGui&&this.valueGui){var b=this.keyGui.hook.size.x+this.keyGui.hook.pos.x+1,c=this.hook.size.x-this.keyGui.hook.size.x-this.valueGui.hook.size.x-1,c=Math.floor(c/3)*3;a.addPattern(this.constructor.PATTERN,b,12,0,0,c,4)}}});sc.ArenaInfoLine=ig.SimpleGui.extend({transitions:{DEFAULT:{state:{},time:0.2,timeFunction:KEY_SPLINES.LINEAR},HIDDEN:{state:{alpha:0,scaleY:0},time:0.2,timeFunction:KEY_SPLINES.LINEAR}},
ninepatch:new ig.NinePatch("media/gui/menu.png",{width:2,height:2,left:6,top:13,right:6,bottom:0,offsets:{"default":{x:32,y:304}}}),textGui:null,init:function(a){this.parent();this.textGui=new sc.TextGui(a,{font:sc.fontsystem.smallFont});this.textGui.setAlign(ig.GUI_ALIGN.X_CENTER,ig.GUI_ALIGN.Y_TOP);this.textGui.setPos(0,-0.5);this.addChildGui(this.textGui);this.setAlign(ig.GUI_ALIGN.X_CENTER,ig.GUI_ALIGN.Y_TOP);this.setSize(277,13)},setSize:function(a,b){this.parent(a,b);this.setPivot(a/2,b/2)},
updateDrawables:function(a){a.addColor("#545454",0,6,this.hook.size.x,1);this.ninepatch.draw(a,100,this.hook.size.y,"default",this.hook.size.x/2-50,0)}});sc.ArenaTotalPoints=sc.MenuPanel.extend({gfx:new ig.Image("media/gui/menu.png"),transitions:{DEFAULT:{state:{},time:0.2,timeFunction:KEY_SPLINES.EASE},HIDDEN:{state:{alpha:0,offsetX:-140.5},time:0.2,timeFunction:KEY_SPLINES.LINEAR}},text:null,number:null,init:function(){this.parent(sc.MenuPanelType.BOTTOM_LEFT_EDGE);this.setAlign(ig.GUI_ALIGN.X_LEFT,
ig.GUI_ALIGN.Y_BOTTOM);this.setSize(281,23);this.setPos(8,27);if(!this.constructor.PATTERN)this.constructor.PATTERN=this.gfx.createPattern(512,184,16,4,ig.ImagePattern.OPT.REPEAT_X);this.text=new sc.TextGui(ig.lang.get("sc.gui.arena.menu.totalPoints"));this.text.setAlign(ig.GUI_ALIGN.X_LEFT,ig.GUI_ALIGN.Y_CENTER);this.text.setPos(5,0);this.addChildGui(this.text);this.number=new sc.TextGui(b(0));this.number.setAlign(ig.GUI_ALIGN.X_RIGHT,ig.GUI_ALIGN.Y_CENTER);this.number.setPos(5,0);this.addChildGui(this.number);
this.annotation={content:{title:"sc.gui.menu.help.arena.titles.points",description:"sc.gui.menu.help.arena.description.points"},offset:{x:0,y:0},size:{x:"dyn",y:"dyn"},index:{x:0,y:"last"}};this.doStateTransition("HIDDEN",true)},show:function(){this.number.setText(b(sc.arena.getTotalArenaCoins()));this.doStateTransition("DEFAULT")},hide:function(){this.doStateTransition("HIDDEN")},updateDrawables:function(a){this.parent(a);var b=this.text.hook.size.x+this.text.hook.pos.x+1,c=this.hook.size.x-this.text.hook.size.x-
this.number.hook.size.x-10,c=Math.floor(c/4)*4;a.addPattern(this.constructor.PATTERN,b,14,0,0,c,4)}});sc.ArenaEntryButton=sc.ListBoxButton.extend({trophyGfx:new ig.Image("media/gui/arena-gui.png"),key:null,description:null,decoration:null,init:function(a,b,c,e){this.parent(a,233,28);this.key=b||null;this.description=c||null;this.button.submitSound=null;this.decoration=new ig.ImageGui(this.trophyGfx,48,32,16,e==5?17:16);this.decoration.setAlign(ig.GUI_ALIGN.X_RIGHT,ig.GUI_ALIGN.Y_TOP);this.decoration.setPos(5,
2);this.addChildGui(this.decoration);this.setDecoration(e)},setDecoration:function(a){this.decoration.offsetX=(a||0)*16}});sc.ArenaRoundEntryButton=sc.ArenaEntryButton.extend({round:null,dots:null,index:-2,init:function(a,b,c,e,f,g){this.parent(a,b,g,e);this.decoration.offsetY=0;this.index=c;if(c>=0){this.round=new sc.NumberGui(f||99,{size:sc.NUMBER_SIZE.TEXT,leadingZeros:f>=100?3:2});this.round.setPos(7,5);this.round.setNumber(c+1);this.addChildGui(this.round);this.dots=new ig.ImageGui(this.round.gfx,
267,35,3,7);this.dots.setPos(7+this.round.hook.size.x+1,7);this.addChildGui(this.dots);this.button.textChild.hook.pos.x=this.dots.hook.pos.x+6}else{this.button.textChild.setAlign(ig.GUI_ALIGN.X_CENTER,ig.GUI_ALIGN.Y_CENTER);this.button.textChild.setPos(0,0)}},updateDrawables:function(a){this.parent(a)},setActive:function(a){this.parent(a);this.round&&this.round.setColor(a?sc.GUI_NUMBER_COLOR.WHITE:sc.GUI_NUMBER_COLOR.GREY);if(this.dots)this.dots.offsetY=a?35:65}})});ig.baked=!0;
ig.module("game.feature.menu.gui.arena.arena-list").requires("impact.feature.gui.gui","impact.feature.gui.base.basic-gui","game.feature.gui.base.text","game.feature.menu.gui.menu-misc","game.feature.menu.gui.list-boxes","game.feature.menu.gui.tab-box","game.feature.menu.gui.arena.arena-misc").defines(function(){var b={key:"",round:-2};sc.ArenaRoundList=sc.ListTabbedPane.extend({currentCup:null,active:false,submit:new ig.Sound("media/sound/arena/arena-cup-select.ogg",0.8),init:function(){this.parent(false);
this.setSize(264,262);this.setAlign(ig.GUI_ALIGN.X_RIGHT,ig.GUI_ALIGN.Y_TOP);this.setPivot(264,262);this.setPanelSize(264,243);this.submitSound=sc.BUTTON_SOUND.submit;this.errorSound=sc.BUTTON_SOUND.denied;this.hook.transitions={DEFAULT:{state:{},time:0.2,timeFunction:KEY_SPLINES.LINEAR},HIDDEN:{state:{alpha:0,offsetX:-132},time:0.2,timeFunction:KEY_SPLINES.LINEAR},HIDDEN_EASE:{state:{alpha:0,offsetX:-132},time:0.2,timeFunction:KEY_SPLINES.EASE}};var a=new sc.TextGui(ig.lang.get("sc.gui.arena.menu.medal"),
{font:sc.fontsystem.tinyFont});a.setAlign(ig.GUI_ALIGN.X_RIGHT,ig.GUI_ALIGN.Y_TOP);a.setPos(5,-8);this.bg.addChildGui(a);this.addTab("tab",0,{type:"cup"})},addObservers:function(){sc.Model.addObserver(sc.menu,this)},removeObservers:function(){sc.Model.removeObserver(sc.menu,this)},show:function(a){this.parent();this.active=true;this.currentCup=a;this.setTab(this.currentTabIndex||0,true,{skipSounds:true});this.tabs.tab.setText(sc.arena.getCupDifficultyIcon(a)+sc.arena.getCupName(a));this.tabs.tab.setWidthToTextSize();
ig.interact.setBlockDelay(0.2);this.doStateTransition("DEFAULT")},hide:function(){this.parent();this.active=false;ig.interact.setBlockDelay(0.2);this.doStateTransition("HIDDEN")},onTabButtonCreation:function(a,b,c){a=new sc.ItemTabbedBox.TabButton("IfYouReadThisYouAreStupidHiHi",null,230,null,true);a.textChild.setPos(7,1);a.setPos(0,2);a.setData({type:c.type});this.addChildGui(a);return a},onTabPressed:function(a,b){if(!b)return false},onTabSelected:function(){ig.input.mouseGuiActive&&sc.menu.setSynopInfo(null,
true)},onTabMouseFocusLost:function(){sc.menu.setSynopInfo(null,true)},onClearCurrentContent:function(a){a.list.clear();a.list.doStateTransition("HIDDEN",true)},onListEntryPressed:function(a){this.submitSound.play();var b=a.key,c=a.index,a=null,a=c==-1?ig.lang.get("sc.gui.arena.menu.startRushMode").replace("[CUP_NAME]",sc.arena.getCupName(b)):ig.lang.get("sc.gui.arena.menu.startAtRound").replace("[CUP_NAME]",sc.arena.getCupName(b)).replace("[ROUND_INDEX]",c+1);sc.Dialogs.showYesNoDialog(a,sc.DIALOG_INFO_ICON.QUESTION,
function(a){if(a.data==0){sc.arena.enterArenaMode(b,c);this.submit.play();sc.model.enterPrevSubState()}else a.data>0&&sc.BUTTON_SOUND.submit.play()}.bind(this),true)},onCreateListEntries:function(a,b){var c=sc.arena.getCupRounds(this.currentCup);a.clear();b.clear();var e=null,e=null,f=sc.arena.getCupCore(this.currentCup);if(f&&!f.noRush){e="\\i[arena-bolt-left]\\c[0]"+ig.lang.get("sc.gui.arena.menu.rush")+"\\c[0]\\i[arena-bolt-right]";e=new sc.ArenaRoundEntryButton(e,this.currentCup,-1,sc.arena.getCupMedal(this.currentCup,
-1),c.length);a.addButton(e)}for(f=0;f<c.length;f++){e=ig.LangLabel.getText(c[f].name);e=new sc.ArenaRoundEntryButton(e,this.currentCup,f,sc.arena.getCupMedal(this.currentCup,f),c.length);e.setActive(ig.perf.enableArenaRound||this.isRoundActive(this.currentCup,f));a.addButton(e)}},onListEntrySelected:function(a){if(a.key!=void 0){b.key=a.key;b.round=a.index;sc.menu.setSynopInfo(b);a.description?sc.menu.setInfoText(a.description,false):a.active?sc.menu.setInfoText(null,false):sc.menu.setInfoText(ig.lang.get("sc.gui.arena.menu.roundUnlockCond"),
false)}else{sc.menu.setSynopInfo(a.key);a.data&&(a.data instanceof Object||sc.menu.setInfoText(a.data))}},onListMouseFocusLost:function(){sc.menu.setSynopInfo(null,true);sc.menu.setInfoText(null,true)},isRoundActive:function(a,b){return b<=0||sc.arena.getCupProgress(a).rounds[b].cleared>=1?true:sc.arena.getCupProgress(a).rounds[b-1].cleared>=1},modelChanged:function(a,b,c){if(a==sc.menu&&b==sc.MENU_EVENT.SORT_LIST){sc.menu.setSynopInfo(null,true);sc.menu.setInfoText(null,true);this.sort(c.data.sortType)}}});
sc.ArenaCupList=sc.ListTabbedPane.extend({submitSound:null,favSound:null,errorSound:null,init:function(){this.parent(true);this.setSize(264,262);this.setAlign(ig.GUI_ALIGN.X_RIGHT,ig.GUI_ALIGN.Y_TOP);this.setPivot(264,262);this.setPanelSize(264,243);this.favSound=this.submitSound=sc.BUTTON_SOUND.submit;this.errorSound=sc.BUTTON_SOUND.denied;this.hook.transitions={DEFAULT:{state:{},time:0.2,timeFunction:KEY_SPLINES.LINEAR},HIDDEN:{state:{alpha:0,offsetX:-132},time:0.2,timeFunction:KEY_SPLINES.LINEAR},
HIDDEN_EASE:{state:{alpha:0,offsetX:-132},time:0.2,timeFunction:KEY_SPLINES.EASE}};var a=new sc.TextGui(ig.lang.get("sc.gui.arena.menu.trophy"),{font:sc.fontsystem.tinyFont});a.setAlign(ig.GUI_ALIGN.X_RIGHT,ig.GUI_ALIGN.Y_TOP);a.setPos(5,-8);this.bg.addChildGui(a);if(sc.menu.arenaCustomMode){this.addTab("solo",0,{type:sc.ARENA_BASE_TYPE.SOLO_CUSTOM});this.addTab("team",1,{type:sc.ARENA_BASE_TYPE.TEAM_CUSTOM})}else{this.addTab("solo",0,{type:sc.ARENA_BASE_TYPE.SOLO_CUP});this.addTab("team",1,{type:sc.ARENA_BASE_TYPE.TEAM_CUP})}},
addObservers:function(){sc.Model.addObserver(sc.menu,this)},removeObservers:function(){sc.Model.removeObserver(sc.menu,this)},show:function(){this.parent();this.setTab(this.currentTabIndex||0,true,{skipSounds:true});ig.interact.setBlockDelay(0.2);this.doStateTransition("DEFAULT")},hide:function(){this.parent();this.doStateTransition("HIDDEN")},getCurrentSortText:function(){var a=null,a=this.tabContent[this.currentTabIndex]?this.tabContent[this.currentTabIndex].sort||sc.ARENA_SORT_TYPES.ORDER:sc.ARENA_SORT_TYPES.ORDER,
b="auto";switch(a){case sc.ARENA_SORT_TYPES.ORDER:b="auto"}return ig.lang.get("sc.gui.menu.sort."+b)},onLeftRightPress:function(a,b,c){this.submitSound.play();sc.menu.switchSynopsisPage(c==1?1:-1);return{skipSounds:true}},onTabChanged:function(a){sc.menu.setSynoTab(a);(ig.input.mouseGuiActive||this.currentGroup.isEmpty())&&sc.menu.setSynopInfo(null,true)},onTabButtonCreation:function(a,b,c){a=new sc.ItemTabbedBox.TabButton(ig.lang.get("sc.gui.arena.menu.tabs."+a),"arena-"+a,105);a.textChild.setPos(7,
1);a.setPos(0,2);a.setData({type:c.type});this.addChildGui(a);return a},onTabPressed:function(a,b){if(!b){this.submitSound.play();this.setTab(this.getButtonIndex(a));for(var c=this.tabArray.length;c--;)if(a==this.tabArray[c]){sc.menu.setSynoTab(c);break}sc.menu.setSynopInfo(null,true);return false}},onTabSelected:function(){ig.input.mouseGuiActive&&sc.menu.setSynopInfo(null,true)},onTabMouseFocusLost:function(){sc.menu.setSynopInfo(null,true)},onListEntryPressed:function(a){this.submitSound.play();
sc.menu.setSynopPressed(a)},onCreateListEntries:function(a,b,c,e){c=sc.arena.getSortedCupList(c,e);a.clear();b.clear();for(b=0;b<c.length;b++){e=c[b];if(sc.arena.isCupUnlocked(e)){var f=sc.arena.getCupDifficultyIcon(e)+sc.arena.getCupName(e),e=new sc.ArenaEntryButton(f,e,sc.arena.getCupDescription(e),sc.arena.getCupTrophy(e));a.addButton(e)}}},onListEntrySelected:function(a){if(a.key!=void 0){b.key=a.key;b.round=-2;sc.menu.setSynopInfo(b);sc.menu.setInfoText(a.description,false)}else{sc.menu.setSynopInfo(a.key);
a.data&&(a.data instanceof Object||sc.menu.setInfoText(a.data))}},onListMouseFocusLost:function(){sc.menu.setSynopInfo(null,true);sc.menu.setInfoText(null,true)},modelChanged:function(a,b,c){if(a==sc.menu&&b==sc.MENU_EVENT.SORT_LIST){sc.menu.setSynopInfo(null,true);sc.menu.setInfoText(null,true);this.sort(c.data.sortType)}}})});ig.baked=!0;
ig.module("game.feature.menu.gui.arena.arena-menu").requires("impact.feature.gui.gui","impact.feature.gui.base.basic-gui","game.feature.menu.gui.base-menu","game.feature.menu.gui.menu-misc","game.feature.menu.gui.arena.arena-list","game.feature.menu.gui.menu-misc").defines(function(){sc.ArenaMenu=sc.ListInfoMenu.extend({hotkeyOverview:null,helpGui:null,roundList:null,points:null,overview:null,init:function(){this.parent(new sc.ArenaCupList,new sc.ArenaInfoBox);this.points=new sc.ArenaTotalPoints;
this.addChildGui(this.points);this.roundList=new sc.ArenaRoundList;this.roundList.setPos(8,29);this.roundList.doStateTransition("HIDDEN",true);this.addChildGui(this.roundList);this.hotkeyOverview=new sc.ButtonGui("\\i[help2]"+ig.lang.get("sc.gui.arena.buttons.names.summary"),void 0,true,sc.BUTTON_TYPE.SMALL);this.hotkeyOverview.startHidden=true;this.hotkeyOverview.submitSound=null;this.hotkeyOverview.blockedSound=null;this.hotkeyOverview.keepMouseFocus=true;this.hotkeyOverview.hook.transitions={DEFAULT:{state:{},
time:0.2,timeFunction:KEY_SPLINES.EASE},HIDDEN:{state:{offsetY:-this.hotkeyOverview.hook.size.y},time:0.2,timeFunction:KEY_SPLINES.LINEAR}};this.hotkeyOverview.onButtonPress=this.onOverviewButtonPressed.bind(this);this.sortMenu.addButton("auto",sc.ARENA_SORT_TYPES.ORDER,0);this.doStateTransition("DEFAULT")},showMenu:function(){this.parent();sc.arena._validateCoins();this.list&&this.updateSortMenuButton(this.list.getCurrentSortText());this.info&&this.info.setCategory(this.list.getCurrentTabKey());
this.points.show();this.hotkeyOverview.doStateTransition("HIDDEN",true);this.hotkeyOverview.setActive(false)},exitMenu:function(){sc.menu.buttonInteract.removeGlobalButton(this.hotkeyOverview);this.info.page==1&&this.exitRoundMenu();this.parent();this.points.hide();sc.menu.moveLeaSprite(0,0,sc.MENU_LEA_STATE.LARGE)},onAddHotkeys:function(b){sc.menu.buttonInteract.addGlobalButton(this.hotkeyHelp,this.onHotkeyHelpCheck.bind(this));sc.menu.buttonInteract.addGlobalButton(this.hotkeySort,this.onHotkeySortCheck.bind(this));
sc.menu.buttonInteract.addGlobalButton(this.hotkeyOverview,this.onHotkeyOverviewCheck.bind(this));this.commitHotKeysToTopBar(b)},commitHotKeysToTopBar:function(b){this.hotkeyOverview.startHidden=!this.roundList.active;sc.menu.addHotkey(function(){return this.hotkeyOverview}.bind(this));sc.menu.addHotkey(function(){return this.hotkeySort}.bind(this));sc.menu.addHotkey(function(){return this.hotkeyHelp}.bind(this));sc.menu.commitHotkeys(b)},enterRoundMenu:function(b){sc.menu.pushBackCallback(function(){sc.menu.popBackCallback();
this.exitRoundMenu()}.bind(this));this.roundList.addObservers();this.info.switchPage(1);sc.menu.setInfoText(null,true);this.hotkeySort.setActive(false);this.list.removeObservers();this.list.doStateTransition("HIDDEN");this.hotkeyOverview.setActive(true);this.hotkeyOverview.doStateTransition("DEFAULT");this.roundList.show(b)},exitRoundMenu:function(){this.roundList.hide();this.roundList.removeObservers();this.info.switchPage(0);if(this.roundList.currentCup&&!ig.input.mouseGuiActive){this.info.key=
"-1s";this.info.setInfo(this.roundList.currentCup)}else{this.info.key="-1s";this.info.setInfo()}this.hotkeySort.setActive(true);this.hotkeyOverview.setActive(false);this.hotkeyOverview.doStateTransition("HIDDEN");this.list.addObservers();this.list.doStateTransition("DEFAULT")},onHotkeyOverviewCheck:function(){return ig.interact.isBlocked()?false:sc.control.menuHotkeyHelp2()},onOverviewButtonPressed:function(){if(this.hotkeyOverview.active){sc.BUTTON_SOUND.submit.play();this.overview=new sc.ArenaCupOverview(this.roundList.currentCup,
function(){this.overview=null}.bind(this),true);ig.gui.addGuiElement(this.overview);this.overview.show()}},createHelpGui:function(){if(!this.helpGui){this.helpGui=new sc.HelpScreen(this,ig.lang.get("sc.gui.menu.help-texts.feat.title"),ig.lang.get("sc.gui.menu.help-texts.feat.pages"),function(){this.commitHotKeysToTopBar(true)}.bind(this),false);this.helpGui.hook.zIndex=15E4;this.helpGui.hook.pauseGui=true}},modelChanged:function(b,a,d){if(b==sc.menu)if(a==sc.MENU_EVENT.SORT_LIST)this.updateSortMenuButton(d.text);
else if(a==sc.MENU_EVENT.SYNO_CHANGED_TAB){this.sortMenu.active&&this.sortMenu.hideSortMenu();this.info&&this.info.setCategory(this.list.getCurrentTabKey());this.updateSortMenuButton(this.list.getCurrentSortText())}else a==sc.MENU_EVENT.SYNOP_BUTTON_PRESS?this.enterRoundMenu(d.key):a==sc.MENU_EVENT.SYNOP_SET_INFO&&(sc.menu.synopInfo?this.info&&this.info.setInfo(sc.menu.synopInfo.key,sc.menu.synopInfo.round):this.info&&this.info.setInfo())}})});ig.baked=!0;
ig.module("game.feature.menu.gui.new-game.new-game-misc").requires("impact.feature.gui.gui","impact.feature.gui.base.basic-gui","impact.feature.gui.base.box","game.feature.menu.gui.menu-misc").defines(function(){sc.NewGameCart=sc.MenuPanel.extend({transitions:{DEFAULT:{state:{},time:0.2,timeFunction:KEY_SPLINES.LINEAR},HIDDEN:{state:{alpha:0,offsetX:-164},time:0.2,timeFunction:KEY_SPLINES.LINEAR}},points:null,cost:null,rest:null,enabled:true,init:function(){this.parent(sc.MenuPanelType.TOP_RIGHT_EDGE);
this.setSize(164,87);this.setAlign(ig.GUI_ALIGN.X_LEFT,ig.GUI_ALIGN.Y_BOTTOM);this.setPos(8,28);var b=5,a=new sc.TextGui(ig.lang.get("sc.gui.menu.new-game.overview"),{font:sc.fontsystem.tinyFont});a.setPos(2,b);this.addChildGui(a);b=b+13;this.points=new sc.NewGameCartEntry(ig.lang.get("sc.gui.menu.new-game.points"));this.points.setPos(4,b);this.addChildGui(this.points);b=b+13;this.cost=new sc.NewGameCartEntry(ig.lang.get("sc.gui.shop.cost"));this.cost.setPos(4,b);this.cost.hideSymbol=true;this.cost.number.noZero=
true;this.cost.number.signed=true;this.cost.number.setColor(sc.GUI_NUMBER_COLOR.RED);this.addChildGui(this.cost);b=b+16;this.rest=new sc.NewGameCartEntry(ig.lang.get("sc.gui.shop.rest"));this.rest.setPos(4,b);this.addChildGui(this.rest);this.doStateTransition("HIDDEN",true)},resetNumbers:function(b){var a=sc.trophies.getTotalPoints();this.points.setNumber(a,b);this.cost.setNumber(0,b);this.rest.setNumber(a,b);a<0?this.rest.number.setColor(sc.GUI_NUMBER_COLOR.RED):this.rest.number.setColor(sc.GUI_NUMBER_COLOR.WHITE)},
updateCost:function(b){var a=sc.trophies.getTotalPoints(),d=sc.newgame.getCost(),a=a-d;this.cost.setNumber(-d,b);this.rest.setNumber(a,b)},updateDrawables:function(b){this.parent(b);b.addColor("#7E7E7E",0,12,this.hook.size.x,1);b.addColor("#FFF",3,42,this.hook.size.x-6,1)},show:function(){this.resetNumbers(true);this.doStateTransition("DEFAULT")},hide:function(){this.doStateTransition("HIDDEN")}});sc.NewGameCartEntry=ig.GuiElementBase.extend({gfx:new ig.Image("media/gui/menu.png"),text:null,number:null,
hideSymbol:false,init:function(b){this.parent();this.setAlign(ig.GUI_ALIGN.X_LEFT,ig.GUI_ALIGN.Y_TOP);this.setSize(157,8);this.text=new sc.TextGui(b,{font:sc.fontsystem.tinyFont});this.addChildGui(this.text);this.number=new sc.NumberGui(99999,{transitionTime:0.1,dots:true});this.number.setPos(12,0);this.number.setAlign(ig.GUI_ALIGN.X_RIGHT,ig.GUI_ALIGN.Y_TOP);this.addChildGui(this.number)},updateDrawables:function(b){this.hideSymbol||b.addGfx(this.gfx,this.hook.size.x-10,0,468,201,10,8)},setNumber:function(b,
a){this.number.setMaxNumber(Math.abs(b));this.number.setNumber(b,a)}});sc.NewGameToggleSet=ig.GuiElementBase.extend({header:null,background:null,buttons:[],set:null,listIndex:0,init:function(b,a,d,c,e){this.parent();this.setSize(363,9);this.listIndex=c;this.set=sc.NEW_GAME_SETS[b];if(this.set.color){this.background=new ig.ColorGui(this.set.color);this.background.hook.localAlpha=0.2;this.background.setPos(-1,0);this.addChildGui(this.background)}this.header=new sc.TextGui(ig.lang.get("sc.gui.menu.new-game.sets."+
b),{font:sc.fontsystem.tinyFont});this.header.setPos(0,1);this.addChildGui(this.header);this.line=new ig.ColorGui("#545454",this.hook.size.x+2,1);this.line.setPos(-1,9);this.addChildGui(this.line);var c=sc.NEW_GAME_OPTIONS,f=0,g=0,a=a.buttonGroup(),h=0,i;for(i in c){var j=c[i];if(!(j.set!=b||j.disabled)){var k=ig.LangLabel.getText(ig.lang.get("sc.gui.menu.new-game.options.names."+i)),l=ig.LangLabel.getText(ig.lang.get("sc.gui.menu.new-game.options.descriptions."+i)),j=new sc.NewGameOptionButton(k,
j.cost,i,l,b,this.set,this);j.setPos(f*182,g*20+11);this.addChildGui(j);this.buttons.push(j);if(sc.menu.newGameViewMode){j.blockedSound=null;sc.newgame.get(i)||j.setActive(false)}a.addFocusGui(j,f,g+d);f++;if(f>=2){f=0;g++}h++}}this.hook.size.y=Math.ceil(h/2)*20+15;this.background&&this.background.setSize(this.hook.size.x+2,Math.ceil(h/2)*20+15);e.counter=h},updateTogglesStates:function(b){for(var a=this.buttons.length;a--;)b!=this.buttons[a]&&this.buttons[a].updateToggleState();if(b){a=new sc.ItemMenuToggleAnimation(function(){b.updateToggleState()}.bind(this),
b.set.type==sc.TOGGLE_SET_TYPE.SINGLE);b.addChildGui(a)}},updateActiveState:function(b,a,d){b=this.buttons.length;for(a=this.getSingleCost();b--;){var c=this.buttons[b].data.id,e=sc.NEW_GAME_SETS[sc.NEW_GAME_OPTIONS[c].set].type;sc.newgame.options[c]?this.buttons[b].setActive(true):d>=sc.NEW_GAME_OPTIONS[c].cost?this.buttons[b].setActive(this.hasRequired(c)):e=="SINGLE"&&d+a>=sc.NEW_GAME_OPTIONS[c].cost?this.buttons[b].setActive(this.hasRequired(c)):this.buttons[b].setActive(false)}},getSingleCost:function(){if(this.set.type==
"MULTI")return 0;for(var b=this.buttons.length;b--;){var a=this.buttons[b].data.id;if(sc.newgame.options[a])return sc.NEW_GAME_OPTIONS[a].cost||0}},hasRequired:function(b){if(!sc.NEW_GAME_OPTIONS[b].requires)return true;for(var b=sc.NEW_GAME_OPTIONS[b].requires,a=b.length;a--;)if(!sc.newgame.options[b[a]])return false;return true}});sc.NewGameOptionButton=sc.ListBoxButton.extend({amount:null,set:null,setKey:null,setGui:null,init:function(b,a,d,c,e,f,g){this.parent(b,142,40,d,c);this.set=f;this.setKey=
e;this.setGui=g;this.button.submitSound=null;if(a>=0){this.amount=new sc.NumberGui(9999);this.amount.setNumber(a,true);this.amount.setAlign(ig.GUI_ALIGN.X_RIGHT,ig.GUI_ALIGN.Y_TOP);this.amount.setPos(5,7);this.addChildGui(this.amount)}if(sc.NEW_GAME_OPTIONS[d].requires){this.active=false;this.button.setActive(false)}this.updateToggleState()},updateToggleState:function(){var b=null,b=sc.newgame.options[this.data.id]||false,b=this.set.type==sc.TOGGLE_SET_TYPE.SINGLE?"\\i["+(b?"toggle-item-on-radio":
"toggle-item-off-radio")+(this.active?"":"-grey")+"]":"\\i["+(b?"toggle-item-on":"toggle-item-off")+(this.active?"":"-grey")+"]";this.button.textChild.setText(b+this.button.getButtonText())},setActive:function(b){this.active=b;this.button.setActive(b);this.updateToggleState()}})});ig.baked=!0;
ig.module("game.feature.menu.gui.new-game.new-game-list").requires("impact.feature.gui.gui","impact.feature.gui.base.basic-gui","impact.feature.gui.base.box","game.feature.gui.base.text","game.feature.menu.gui.menu-misc","game.feature.menu.gui.list-boxes","game.feature.menu.gui.new-game.new-game-misc").defines(function(){sc.NewGameList=ig.GuiElementBase.extend({transitions:{DEFAULT:{state:{},time:0.2,timeFunction:KEY_SPLINES.LINEAR},HIDDEN:{state:{alpha:0,offsetX:-184},time:0.2,timeFunction:KEY_SPLINES.LINEAR}},
gfx:new ig.Image("media/gui/menu.png"),sets:[],list:null,buttongroup:null,toggleOnSound:null,toggleOffSound:null,_curElement:-1,init:function(){this.parent();this.setSize(368,263);this.setAlign(ig.GUI_ALIGN.X_RIGHT,ig.GUI_ALIGN.Y_TOP);this.toggleOnSound=sc.BUTTON_SOUND.toggle_on;this.toggleOffSound=sc.BUTTON_SOUND.toggle_off;var b=new sc.MenuPanel;b.setSize(368,263);b.setPos(0,0);this.addChildGui(b);this.list=new sc.MultiColumnItemListBox(1,182,sc.LIST_COLUMNS.TWO,1);this.list.setPos(0,5);this.list.setSize(368,
251);this.list.setSelectState("HIDDEN",true);this.list.list.onGetHeightAtIndex=this.onGetHeightAtIndex.bind(this);this.addChildGui(this.list);for(b=this.list.quantities.length;b--;){this.list.quantities[b].setText(ig.lang.get("sc.gui.shop.cost"));this.list.quantities[b].hook.pos.x=this.list.quantities[b].hook.pos.x+2}this.buttongroup=this.list.buttonGroup();this.buttongroup.setMouseFocusLostCallback(function(){sc.menu.setInfoText("",true);sc.menu.setBuffText("",true);this._curElement=null}.bind(this));
this.buttongroup.addSelectionCallback(function(a){if(a.data){this._curElement=a;sc.menu.setInfoText(a.data.description?a.data.description:a.data);a.data.id&&sc.menu.setItemInfo(a.data.id)}}.bind(this));this.buttongroup.addPressCallback(this.onItemButtonPressed.bind(this));this.createListEntries();this.doStateTransition("HIDDEN",true)},createListEntries:function(){this.buttongroup.clear();this.list.clear(true);this.sets.length=0;this.list.list.columns=1;this.list.list.paddingTop=1;var b=0,a={counter:0},
d=0,c;for(c in sc.NEW_GAME_SETS){a.counter=0;var e=new sc.NewGameToggleSet(c,this.list,b,d,a);this.list.addButton(e,true);b=b+Math.ceil(a.counter/2);this.sets[d]=e;d++}this.list.list.paddingTop=1;this.list.list.columns=2;this.buttongroup.fillEmptySpace()},updateEntries:function(b){for(var a=sc.trophies.getTotalPoints(),d=sc.newgame.getCost(),c=sc.trophies.getTotalPoints()-sc.newgame.getCost(),e=this.sets.length;e--;)this.sets[e].updateActiveState(a,d,c);b||sc.menu.setSynopPressed()},addObservers:function(){sc.Model.addObserver(sc.menu,
this)},removeObservers:function(){sc.Model.removeObserver(sc.menu,this)},show:function(){ig.interact.setBlockDelay(0.2);sc.menu.newGameViewMode||this.updateEntries(true);this.list.activate();this.doStateTransition("DEFAULT")},hide:function(){this.list.deactivate();sc.menu.setInfoText("",false);sc.menu.setBuffText("",false);this.doStateTransition("HIDDEN")},onGetHeightAtIndex:function(b,a){var d=this.buttongroup.getYElementAt(a);d||(d=this.buttongroup.getElementAt(this.buttongroup.current.x-1,a));
var c=0;a>=0&&d&&(c=c+(d.setGui.hook.pos.y+d.hook.pos.y+d.hook.size.y));return c},onItemButtonPressed:function(b){if(!sc.menu.newGameViewMode){var a=sc.newgame.toggle(b.data.id,b.setKey);a?this.toggleOnSound.play():this.toggleOffSound.play();a?b.setGui.updateTogglesStates(b):b.setGui.updateTogglesStates();this.updateEntries()}},isNonMouseMenuInput:function(){return sc.control.menuConfirm()||sc.control.rightDown()||sc.control.leftDown()||sc.control.downDown()||sc.control.upDown()||sc.control.menuCircleLeft()||
sc.control.menuCircleRight()},modelChanged:function(){}})});ig.baked=!0;
ig.module("game.feature.menu.gui.new-game.new-game-menu").requires("impact.feature.gui.gui","impact.feature.gui.base.basic-gui","game.feature.menu.gui.base-menu","game.feature.menu.gui.menu-misc","game.feature.menu.gui.new-game.new-game-misc","game.feature.menu.gui.new-game.new-game-list").defines(function(){sc.NewGamePlusMenu=sc.ListInfoMenu.extend({points:null,button:null,init:function(){this.parent(new sc.NewGameList,null,true);this.points=new sc.NewGameCart;this.addChildGui(this.points);this.button=
new sc.ButtonGui("\\i[help2]"+ig.lang.get("sc.gui.menu.new-game.start"),160);this.button.hook.transitions={DEFAULT:{state:{},time:0.2,timeFunction:KEY_SPLINES.LINEAR},HIDDEN:{state:{alpha:0,offsetX:-160},time:0.2,timeFunction:KEY_SPLINES.LINEAR}};this.button.keepMouseFocus=true;this.button.setAlign(ig.GUI_ALIGN.X_LEFT,ig.GUI_ALIGN.Y_BOTTOM);this.button.setPos(10,30);this.button.doStateTransition("HIDDEN",true);this.button.onButtonPress=this.onBeginButtonPressed.bind(this);this.button.setActive(false);
this.addChildGui(this.button);this.doStateTransition("DEFAULT")},showMenu:function(){this.points.show();this.button.doStateTransition("DEFAULT");sc.menu.buttonInteract.addGlobalButton(this.button,this.onHotkeyBeginCheck.bind(this));this.parent();if(sc.menu.previousMenu==sc.MENU_SUBMENU.SAVE){this.points.updateCost(true);sc.menu.popBackCallback()}else sc.menu.newGameViewMode&&this.points.updateCost(true)},exitMenu:function(){this.parent();sc.menu.buttonInteract.removeGlobalButton(this.button);this.points.hide();
this.button.doStateTransition("HIDDEN")},onPostDirectEnter:function(){if(!localStorage.getItem("ccNewGamePlusTutorial")){localStorage.setItem("ccNewGamePlusTutorial","true");ig.interact.setBlockDelay(0.4);sc.Cutscene.startMenuEvent(sc.commonEvents.events["tutorial-newgame"].event,{})}},onHotkeyBeginCheck:function(){return sc.control.menuHotkeyHelp2()},onBeginButtonPressed:function(){sc.newgame.requiresSaveFile()?sc.Dialogs.showDialog(ig.lang.get("sc.gui.menu.new-game.saveFileInfo"),sc.DIALOG_INFO_ICON.INFO,
true,function(){sc.menu.loadClearFilesOnly=true;sc.menu.loadMode=true;sc.menu.pushMenu(sc.MENU_SUBMENU.SAVE)}.bind(this)):sc.Dialogs.showYesNoDialog(ig.lang.get("sc.gui.menu.new-game.confirmOptions"),sc.DIALOG_INFO_ICON.QUESTION,function(b){if(b.data==0){sc.newgame.setActive(true);sc.model.enterRunning()}}.bind(this))},createHelpGui:function(){if(!this.helpGui){this.helpGui=new sc.HelpScreen(this,ig.lang.get("sc.gui.menu.help-texts.newgame.title"),ig.lang.get("sc.gui.menu.help-texts.newgame.pages"),
function(){this.commitHotKeysToTopBar(true)}.bind(this),true);this.helpGui.hook.zIndex=15E4;this.helpGui.hook.pauseGui=true}},modelChanged:function(b,a){if(b==sc.menu&&a==sc.MENU_EVENT.SYNOP_BUTTON_PRESS){this.points.updateCost();this.button.setActive(sc.newgame.hasAnyOptions())}}})});ig.baked=!0;
ig.module("game.feature.menu.menu-model").requires("impact.base.game","impact.feature.interact.button-interact","impact.feature.storage.storage","game.feature.model.base-model","game.feature.menu.area-loadable","game.feature.menu.gui.start-menu","game.feature.menu.gui.equip.equip-menu","game.feature.menu.gui.circuit.circuit-menu","game.feature.menu.gui.item.item-menu","game.feature.menu.gui.map.map-menu","game.feature.menu.gui.save.save-menu","game.feature.menu.gui.options.options-menu","game.feature.menu.gui.shop.shop-menu",
"game.feature.menu.gui.synop.synop-menu","game.feature.menu.gui.quests.quest-menu","game.feature.menu.gui.quest-hub.quest-hub-menu","game.feature.menu.gui.enemies.enemy-menu","game.feature.menu.gui.lore.lore-menu","game.feature.menu.gui.status.status-menu","game.feature.menu.gui.help.help-menu","game.feature.menu.gui.museum.museum-menu","game.feature.menu.gui.stats.stats-menu","game.feature.menu.gui.trophy.trophy-menu","game.feature.menu.gui.social.social-menu","game.feature.menu.gui.trade.trader-menu",
"game.feature.menu.gui.botanics.botanics-menu","game.feature.menu.gui.arena.arena-menu","game.feature.menu.gui.new-game.new-game-menu","game.feature.menu.map-model").defines(function(){function b(a){for(var b=ig.currentLang+"",b=ig.LANG_DETAILS[ig.currentLang]&&ig.LANG_DETAILS[ig.currentLang].commaDigits?".":",",e=/(\d+)(\d{3})/,a=a+"";e.test(a);)a=a.replace(e,"$1"+b+"$2");return a}function a(a,b){var e="0000"+Math.floor(a);return e.length>=4+b?Math.floor(a):e.substr(e.length-b)}sc.MENU_SUBMENU={START:0,
ITEMS:1,SKILLS:2,EQUIPMENT:3,STATUS:4,SYNOPSIS:5,MAP:6,SAVE:7,OPTIONS:8,SHOP:9,QUESTS:10,TROPHY:11,LORE:12,ENEMY:13,SOCIAL:14,STATS:15,MUSEUM:16,TRADE:17,BOTANICS:18,QUEST_HUB:19,ARENA:20,NEW_GAME:21};sc.SUB_MENU_INFO={};sc.SUB_MENU_INFO[sc.MENU_SUBMENU.START]={Clazz:sc.StartMenu,name:"start"};sc.SUB_MENU_INFO[sc.MENU_SUBMENU.ITEMS]={Clazz:sc.ItemMenu,name:"items"};sc.SUB_MENU_INFO[sc.MENU_SUBMENU.SKILLS]={Clazz:sc.CircuitMenu,name:"skills"};sc.SUB_MENU_INFO[sc.MENU_SUBMENU.EQUIPMENT]={Clazz:sc.EquipMenu,
name:"equipment"};sc.SUB_MENU_INFO[sc.MENU_SUBMENU.STATUS]={Clazz:sc.StatusMenu,name:"status"};sc.SUB_MENU_INFO[sc.MENU_SUBMENU.SYNOPSIS]={Clazz:sc.SynopsisMenu,name:"synopsis"};sc.SUB_MENU_INFO[sc.MENU_SUBMENU.MAP]={Clazz:sc.MapMenu,name:"map"};sc.SUB_MENU_INFO[sc.MENU_SUBMENU.SAVE]={Clazz:sc.SaveMenu,name:"save",alt:"load"};sc.SUB_MENU_INFO[sc.MENU_SUBMENU.OPTIONS]={Clazz:sc.OptionsMenu,name:"options"};sc.SUB_MENU_INFO[sc.MENU_SUBMENU.SHOP]={Clazz:sc.ShopMenu,name:"shop",alt:"arenaShop"};sc.SUB_MENU_INFO[sc.MENU_SUBMENU.QUESTS]=
{Clazz:sc.QuestMenu,name:"quests"};sc.SUB_MENU_INFO[sc.MENU_SUBMENU.LORE]={Clazz:sc.LoreMenu,name:"lore"};sc.SUB_MENU_INFO[sc.MENU_SUBMENU.ENEMY]={Clazz:sc.EnemyMenu,name:"enemy"};sc.SUB_MENU_INFO[sc.MENU_SUBMENU.SOCIAL]={Clazz:sc.SocialMenu,name:"social"};sc.SUB_MENU_INFO[sc.MENU_SUBMENU.TROPHY]={Clazz:sc.TrophyMenu,name:"trophy"};sc.SUB_MENU_INFO[sc.MENU_SUBMENU.STATS]={Clazz:sc.StatsMenu,name:"stats"};sc.SUB_MENU_INFO[sc.MENU_SUBMENU.MUSEUM]={Clazz:sc.MuseumMenu,name:"museum"};sc.SUB_MENU_INFO[sc.MENU_SUBMENU.TRADE]=
{Clazz:sc.TraderMenu,name:"trade"};sc.SUB_MENU_INFO[sc.MENU_SUBMENU.BOTANICS]={Clazz:sc.BotanicsMenu,name:"botanics"};sc.SUB_MENU_INFO[sc.MENU_SUBMENU.QUEST_HUB]={Clazz:sc.QuestHubMenu,name:"questHub"};sc.SUB_MENU_INFO[sc.MENU_SUBMENU.ARENA]={Clazz:sc.ArenaMenu,name:"arena",alt:"arenaCustom"};sc.SUB_MENU_INFO[sc.MENU_SUBMENU.NEW_GAME]={Clazz:sc.NewGamePlusMenu,name:"new-game"};sc.MENU_LEA_STATE={LARGE:0,SMALL:1,HIDDEN:2};sc.MENU_EQUIP_BODYPART={NONE:0,HEAD:1,RIGHT_ARM:2,LEFT_ARM:3,TORSO:4,FEET:5};
sc.MENU_SKILL_STATE={OVERVIEW:0,DETAIL_VIEW:1,NODE_SELECT:2,NODE_MENU:3,SWAP_BRANCHES:4};sc.MENU_SHOP_TYPES={};sc.MENU_SHOP_TYPES.BUY_AND_SELL=0;sc.MENU_SHOP_TYPES.BUY=1;sc.MENU_SHOP_TYPES.SELL=2;sc.MENU_SHOP_TYPES.COIN=3;sc.MENU_SHOP_STATE={};sc.MENU_SHOP_STATE.START=0;sc.MENU_SHOP_STATE.BUY=1;sc.MENU_SHOP_STATE.SELL_CAT=2;sc.MENU_SHOP_STATE.SELL=3;sc.LOG_TYPES={QUEST:0,LANDMARK:1,LORE:2,TROPHY:3,TRADER:4,STORY:5,DROP:6};sc.MENU_STATUS_PAGES={MAIN:0,PARAMS:1,MODS:2,COMBAT_ARTS:3};sc.BOTANICS_SORT_TYPE=
{ORDER:0,FOUND:1,NAME:2};sc.MENU_STATUS_PAGES_LENGTH=4;sc.SELL_PAGES=[{lang:"cons",type:"CONS"},{lang:"equip-arm",type:"EQUIP",equipType:"ARM"},{lang:"equip-head",type:"EQUIP",equipType:"HEAD"},{lang:"equip-torso",type:"EQUIP",equipType:"TORSO"},{lang:"equip-feet",type:"EQUIP",equipType:"FEET"},{lang:"trade",type:"TRADE"}];sc.MENU_QUEST_HUB_TABS={OPEN:0,ACTIVE:1,FINISHED:2};sc.MENU_ARENA_TABS={SOLO:0,TEAM:1};sc.MAP_STAMPS_MAX=99;sc.MAX_MOD_VAL=999;sc.TOGGLE_SET_TYPE={SINGLE:"SINGLE",MULTI:"MULTI"};
sc.MenuModel=ig.GameAddon.extend({guiReference:null,observers:[],infoText:null,buffText:null,buffID:-1,currentMenu:sc.MENU_SUBMENU.START,previousMenu:null,menuStack:[],buttonInteract:null,backCallbackStack:[],hotkeysCallbacks:[],currentBackCallback:null,leaState:sc.MENU_LEA_STATE,menuEntered:false,currentBodyPart:sc.MENU_EQUIP_BODYPART.NONE,previousBodyPart:null,exitCallback:null,currentSkillTree:-1,previousSkillTree:-1,skillCursor:Vec2.createC(0,0),lastSkillCursor:Vec2.createC(0,0),skillRecoverPos:Vec2.createC(0,
0),skillCamera:Vec2.createC(0,0),skillDrag:false,skillWasDragged:false,skillState:sc.MENU_SKILL_STATE.OVERVIEW,skillStateOrigin:sc.MENU_SKILL_STATE.OVERVIEW,skillCursorMoved:false,currentSkillFocus:null,skillSwapCursor:Vec2.createC(0,0),skillSwapMoved:false,skillSwapFocus:null,mapDrag:false,mapWasDragged:false,mapCamera:Vec2.createC(0,0),mapFirstVisit:false,mapUnknownArea:false,mapMouseOverFloorButtons:false,mapCursor:Vec2.createC(0,0),mapLastCursor:Vec2.createC(0,0),mapCursorMoved:false,mapWorldmapActive:false,
mapWorldCursor:Vec2.createC(0,0),mapWorldLastCursor:Vec2.createC(0,0),mapWmCursorMoved:false,mapAreaFocus:null,mapMapFocus:null,mapWorldFirstVisit:false,mapLoading:false,mapAreaOffset:Vec2.create(0,0),mapStampMenu:false,mapStamps:{},shopID:null,shopState:sc.MENU_SHOP_STATE.START,shopCoinMode:false,shopPage:0,shopCart:[],shopSellMode:false,itemCurrentTab:-1,itemLastButtonData:null,optionCurrentTab:0,optionLastButtonData:null,optionsLocalMode:true,questCurrentTab:0,questLastButtonData:null,questInfo:null,
questDetailMode:false,questsSeen:{},newGameViewMode:false,tradeToggle:false,directMode:false,directMenu:0,loadMode:false,loadSlotID:-2,loadClearFilesOnly:false,loreCurrentTab:0,synopInfo:null,newUnlocks:{},logEntries:[],gamepadIcons:false,menuHost:0,statusPage:0,statusElement:0,statusDiff:false,drops:{},dropCounts:{},questHubID:null,words:null,helpMenuOpen:false,init:function(){this.parent("MenuModel");this.buttonInteract=new ig.ButtonInteractEntry;if(window.wm){ig.database.register("shops","ShopList",
"Shops");ig.database.register("drops","DropsList","Drops");ig.database.register("leawords","StringArray","Lea Words")}this.drops=ig.database.get("drops");this.words=ig.database.get("leawords");for(var a in this.drops)this.drops[a].other&&(this.drops[a].area=null);ig.vars.registerVarAccessor("drops",this,"VarDropEditor");ig.vars.registerVarAccessor("misc",this,"VarMiscEditor");ig.storage.register(this)},onVarAccess:function(d,c){if(c[0]=="drops")switch(c[1]){case "totalProgress":return this.getTotalDropsFoundAndCompleted(true)}else if(c[0]==
"misc")switch(c[1]){case "time":var e=new Date,f=e.getHours();return f>=11&&f<=13?"It's High Noon":e.getHours()+":"+e.getMinutes();case "words":return c[2]?ig.vars.get("lea.words."+(c[2]+"").toLowerCase()):false;case "localNum":return c[2]?b(c[2]):"";case "localNumTempVar":return c[2]?b(Math.round(parseInt(ig.vars.get("tmp."+c[2])))):"";case "formatTimeVar":if(c[2]){e=ig.vars.get("tmp."+c[2]);return a(Math.min(Math.floor(e/60)%60,99),2)+":"+a(Math.min(Math.floor(e)%60,99),2)+"."+a(Math.min(Math.floor(e*
100)%100,99),2)}}},dev_UnlockDrop:function(a){var b=0,e;for(e in this.drops)if(!this.dropCounts[e]||!this.dropCounts[e].completed){for(var f=0;f<=100;f++)this.incrementDropCount(e,"Autumn-Ground-1");b++;if(b>=a)break}},incrementDropCount:function(a,b){if(this.drops[a]){if(this.drops[a].link){a=this.drops[a].link||"";if(!this.drops[a])return}if(this.drops[a].track){var e=this.dropCounts[a];if(!e){e={anim:b,count:0,time:(new Date).getTime(),completed:false};sc.stats.setMap("exploration","dropFound-"+
a,1);sc.stats.addMap("exploration","dropsTotal",1);this.dropCounts[a]=e}if(!e.completed){e.count++;if(!e.completed&&e.count>=(this.drops[a].progress||50)){e.completed=true;e.count=this.drops[a].progress||50;sc.stats.addMap("exploration","dropsCompleted",1);sc.stats.setMap("exploration","dropsCompletionRate",this.getTotalDropsFoundAndCompleted(true));if(sc.model.player.hasItem(285)){sc.Model.notifyObserver(this,sc.MENU_EVENT.DROP_COMPLETED,a);this.addLog({type:"DROP",drop:a})}}}}}},getFoundDrops:function(a,
b){var e=[],f;for(f in this.dropCounts){var g=this.drops[f];a?a=="other"?g.other&&e.push(f):g.area==a&&e.push(f):e.push(f)}b!=void 0&&this.sortDropList(e,b);return e},sortDropList:function(a,b){switch(b){case sc.BOTANICS_SORT_TYPE.FOUND:a.sort(function(a,b){return(this.dropCounts[b].time||0)-(this.dropCounts[a].time||0)}.bind(this));break;case sc.BOTANICS_SORT_TYPE.ORDER:a.sort(function(a,b){return(this.drops[a].order||0)-(this.drops[b].order||0)}.bind(this));break;case sc.BOTANICS_SORT_TYPE.NAME:a.sort(function(a,
b){var c=ig.LangLabel.getText(this.drops[a].name),d=ig.LangLabel.getText(this.drops[b].name);return c.localeCompare(d)}.bind(this))}},getDropCount:function(a){return this.dropCounts[a].count},hasAnyDropFound:function(){if(sc.map.hasAnyAreaUnlocked())for(var a in this.dropCounts)return true;return false},hasAnyDropInArea:function(a){for(var b in this.drops)if(this.drops[b].area==a)return true},hasDropInArea:function(a){for(var b in this.dropCounts)if(this.drops[b].area==a)return true},hasAnyOtherDropFound:function(){for(var a in this.dropCounts)if(this.drops[a].other)return true},
getTotalDropsFoundAndCompleted:function(a){var b=0,e=0,f;for(f in this.drops){var g=this.drops[f];if(g.track&&!g.extension){sc.stats.getMap("exploration","dropFound-"+f)&&this.dropCounts[f]&&this.dropCounts[f].completed&&b++;e++}}return a?b/e:b},getFoundDrop:function(a){return this.dropCounts[a]},getDropName:function(a){return!this.drops[a]?"???":ig.LangLabel.getText(this.drops[a].name)},getDropArea:function(a){return!this.drops[a]?"???":sc.map.getAreaName(this.drops[a].area)},setStatusPage:function(a){var b=
this.statusPage;this.statusPage=a||sc.MENU_STATUS_PAGES.MAIN;sc.Model.notifyObserver(this,sc.MENU_EVENT.STATUS_SET_PAGE,b)},setStatusElement:function(a){var b=this.statusElement;this.statusElement=a||sc.ELEMENT.NEUTRAL;sc.Model.notifyObserver(this,sc.MENU_EVENT.STATUS_SET_ELEMENT,b)},fireStatusPageEvent:function(){sc.Model.notifyObserver(this,sc.MENU_EVENT.STATUS_SET_PAGE,this.statusPage)},addLog:function(a){if(sc.LOG_TYPES[a.type]!=void 0){this.logEntries.push(a);sc.stats.addMap("player","logs",
1);this.logEntries.length>50&&this.logEntries.shift()}},onReset:function(){this.newUnlocks={};this.logEntries.length=0;this.mapStamps={};this.questsSeen={};this.dropCounts={}},varsChangedOrder:1E3,onVarsChanged:function(){var a=ig.input.currentDevice==ig.INPUT_DEVICES.GAMEPAD;if(this.gamepadIcons!=a){this.gamepadIcons=a;this.updateHotkeys(true)}},onPostUpdate:function(){if(window.IG_GAME_DEBUG&&this.startMenuFromWarmUp&&!this.startUpStarted)this.startUpTimer>0?this.startUpTimer=this.startUpTimer-
ig.system.tick:this.enterStartUpMenu()},onLevelLoadStart:function(){this.startMenuFromWarmUp=false},onLevelLoaded:function(){if(window.MENU_ON_GAME_START&&window.IG_GAME_DEBUG){this.startMenuFromWarmUp=true;this.startUpTimer=0.2}},enterStartUpMenu:function(){if(this.startMenuFromWarmUp&&!this.startUpStarted){this.setDirectMode(true,sc.MENU_SUBMENU[window.MENU_ON_GAME_START]);window.MENU_ON_GAME_START=null;this.startUpStarted=true;sc.model.enterMenu()}},addNewUnlock:function(a,b){this.newUnlocks[a]||
(this.newUnlocks[a]=[]);this.newUnlocks[a].push(b)},hasNewUnlock:function(a){return this.newUnlocks[a]&&this.newUnlocks[a].length>0},hasNewUnlockKey:function(a,b){return this.newUnlocks[a]&&this.newUnlocks[a].indexOf(b)!=-1},clearNewUnlock:function(a,b){this.newUnlocks[a]&&(b?this.newUnlocks[a].erase(b):delete this.newUnlocks[a])},onStorageSave:function(a){a.menuNewEntries=ig.copy(this.newUnlocks);a.logs=ig.copy(this.logEntries);a.drops=ig.copy(this.dropCounts);a.stamps=ig.copy(this.mapStamps);a.questsSeen=
ig.copy(this.questsSeen)},onStoragePreLoad:function(a){this.newUnlocks=a.menuNewEntries||{};this.logEntries=a.logs||[];this.dropCounts=a.drops||{};this.mapStamps=a.stamps||{};this.questsSeen=a.questsSeen||{};this.onPreLoadDrops()},onPreLoadDrops:function(){var a=0,b=0,e;for(e in this.drops)if(this.dropCounts[e]){var f=this.drops[e],g=this.dropCounts[e];if(f.progress<g.count&&g.completed){g.count=f.progress||50;a++}else if(f.progress<g.count){g.count=f.progress||50;g.completed=true;a++;sc.Model.notifyObserver(this,
sc.MENU_EVENT.DROP_COMPLETED,e);this.addLog({type:"DROP",drop:e})}else if(f.progress>g.count&&g.completed){g.count=f.progress;a++}else f.progress<=g.count&&a++;sc.stats.setMap("exploration","dropFound-"+e,1);(f=ig.globalSettings.getGlobalSetting("ENTITY","ItemDestruct",e))&&f.desType!=g.anim&&(g.anim=f.desType);b++}sc.stats.setMap("exploration","dropsTotal",b);sc.stats.setMap("exploration","dropsCompleted",a);sc.stats.setMap("exploration","dropsCompletionRate",this.getTotalDropsFoundAndCompleted(true))},
onNewGameApply:function(a){this.dropCounts=a.drops||{};this.onPreLoadDrops()},addMapStamp:function(a,b,e,f,g){this.mapStamps[a]||(this.mapStamps[a]=[]);for(var h=0;h<sc.MAP_STAMPS_MAX;h++)if(!this.mapStamps[a][h]){this.mapStamps[a][h]={key:b,x:e,y:f,level:g,index:h};return h}return-1},editStamp:function(a,b,e){if(this.mapStamps[b]){this.mapStamps[b][a]&&(this.mapStamps[b][a].key=e);sc.Model.notifyObserver(this,sc.MENU_EVENT.MAP_UPDATE_STAMP)}},removeStamp:function(a,b){this.mapStamps[a]&&this.mapStamps[a][b]&&
(this.mapStamps[a][b]=null)},getStamps:function(a){this.mapStamps[a]||(this.mapStamps[a]=[]);return this.mapStamps[a]},getStampCount:function(a){this.mapStamps[a]||(this.mapStamps[a]=[]);for(var b=0,e=this.mapStamps[a].length;e--;)this.mapStamps[a][e]&&b++;return b},fullyEntered:function(){sc.Model.notifyObserver(this,sc.MENU_EVENT.FULL_MENU_ENTER)},addHotkey:function(a,b){this.hotkeysCallbacks.push(a);b&&sc.Model.notifyObserver(this,sc.MENU_EVENT.TOP_BAR_CHANGED)},commitHotkeys:function(a){sc.Model.notifyObserver(this,
sc.MENU_EVENT.TOP_BAR_CHANGED,a)},updateHotkeys:function(a){sc.Model.notifyObserver(this,sc.MENU_EVENT.TOP_BAR_UPDATE,a)},removeHotkeys:function(){this.hotkeysCallbacks=[];sc.Model.notifyObserver(this,sc.MENU_EVENT.REMOVE_HOTKEYS)},pushBackCallback:function(a){if(a){this.backCallbackStack.push(a);this.currentBackCallback=a}},popBackCallback:function(){this.backCallbackStack.pop();this.currentBackCallback=this.backCallbackStack.length>0?this.backCallbackStack[this.backCallbackStack.length-1]:null},
invokeTopBackButton:function(){this.currentBackCallback&&this.currentBackCallback()},pushMenu:function(a){if(a){this.menuStack.push(a);this.previousMenu=this.currentMenu;this.currentMenu=a;this.hotkeysCallbacks=[];this.setInfoText("",true);sc.Model.notifyObserver(this,sc.MENU_EVENT.ENTER_MENU)}},popMenu:function(){if(!(this.menuStack.length<=0)){this.previousMenu=this.menuStack.pop();this.currentMenu=this.menuStack.length>0?this.menuStack[this.menuStack.length-1]:this.directMode?this.directMenu:sc.MENU_SUBMENU.START;
this.setInfoText("",true);this.hotkeysCallbacks=[];sc.Model.notifyObserver(this,sc.MENU_EVENT.LEAVE_MENU)}},enterMenu:function(){ig.interact.addEntry(this.buttonInteract);this.menuEntered=true},setDirectMode:function(a,b){this.directMode=a||false;this.directMenu=b||sc.MENU_SUBMENU.START},setHost:function(a){this.menuHost=a||0},exitMenu:function(){if(this.menuEntered){this.menuEntered=false;sc.commonEvents.triggerEvent("MENU_LEAVE",{})}this.menuStack=[];this.backCallbackStack=[];this.buffText=this.infoText=
this.currentBackCallback=null;this.buffID=-1;this.currentMenu=sc.MENU_SUBMENU.START;this.previousBodyPart=this.previousMenu=null;this.currentBodyPart=sc.MENU_EQUIP_BODYPART.NONE;this.menuHost=0;this.previousSkillTree=this.currentSkillTree=-1;this.skillState=sc.MENU_SKILL_STATE.OVERVIEW;this.skillDrag=false;this.currentSkillFocus=null;this.skillSwapCursor.x=0;this.skillSwapCursor.y=0;this.skillSwapMoved=false;this.skillSwapFocus=null;this.newGameViewMode=false;this.itemCurrentTab=-1;this.itemLastButtonData=
null;this.optionCurrentTab=0;this.optionLastButtonData=null;this.questCurrentTab=0;this.questInfo=this.questLastButtonData=null;this.questDetailMode=false;this.shopID=null;this.shopState=sc.MENU_SHOP_STATE.START;this.shopPage=0;this.shopCart.length=0;this.tradeToggle=this.shopCoinMode=this.shopSellMode=false;this.statusPage=sc.MENU_STATUS_PAGES.MAIN;this.statusElement=0;this.statusDiff=false;sc.map.restore();this.mapMouseOverFloorButtons=this.mapFirstVisit=this.mapWasDragged=this.mapDrag=false;this.mapCursor.x=
this.mapCursor.y=this.mapLastCursor.x=this.mapLastCursor.y=0;this.mapWorldCursor.x=this.mapWorldCursor.y=this.mapWorldLastCursor.x=this.mapWorldLastCursor.y=0;this.mapWorldmapActive=this.mapWmCursorMoved=this.mapCursorMoved=false;this.mapMapFocus=this.mapAreaFocus=null;this.mapLoading=this.mapWorldFirstVisit=false;this.mapAreaOffset.x=this.mapAreaOffset.y=0;this.loadClearFilesOnly=this.loadMode=this.mapStampMenu=false;this.loreCurrentTab=0;this.questHubID=this.synopInfo=null;this.helpMenuOpen=false;
this.hotkeysCallbacks=[];ig.interact.removeEntry(this.buttonInteract);sc.Model.notifyObserver(this,sc.MENU_EVENT.EXIT_MENU);if(this.exitCallback){var a=this.exitCallback;this.exitCallback=null;a()}},invokePostExit:function(){sc.Model.notifyObserver(this,sc.MENU_EVENT.POST_EXIT)},setInfoText:function(a,b){this.infoText=a;sc.Model.notifyObserver(this,sc.MENU_EVENT.INFO_TEXT_CHANGED,b)},setBuffText:function(a,b,e){this.buffText=a;this.buffID=e||-1;sc.Model.notifyObserver(this,sc.MENU_EVENT.SET_BUFF_INFO,
b)},moveLeaSprite:function(a,b,e,f){this.leaState=e||sc.MENU_LEA_STATE.LARGE;sc.Model.notifyObserver(this,sc.MENU_EVENT.LEA_STATE_CHANGED,{x:a||0,y:b||0,skip:f})},enterTradeDetails:function(){this.tradeToggle=true;sc.Model.notifyObserver(this,sc.MENU_EVENT.TRADE_TOGGLE_DETAILS)},exitTradeDetails:function(){this.tradeToggle=false;sc.Model.notifyObserver(this,sc.MENU_EVENT.TRADE_TOGGLE_DETAILS)},setShopState:function(a){if(this.shopState!=a){var b=this.shopState;this.shopState=a||sc.MENU_SHOP_STATE.START;
sc.Model.notifyObserver(this,sc.MENU_EVENT.SHOP_STATE_CHANGED,b)}},setShopPage:function(a){if(this.shopPage!=a){var b=this.shopPage;this.shopPage=a||0;sc.Model.notifyObserver(this,sc.MENU_EVENT.SHOP_PAGE_CHANGED,b)}},updateCart:function(a,b,e){for(var f=this.shopCart.length;f--;){var g=this.shopCart[f];if(g.id==a&&g.price==e){g.amount=b;g.amount<=0&&this.shopCart.splice(f,1);f=-10;break}}f!=-10&&b>0&&this.shopCart.push({id:a,amount:b,price:e});sc.Model.notifyObserver(this,sc.MENU_EVENT.SHOP_CART_CHANGED)},
getTotalCost:function(a,b){for(var e=0,f=this.shopCart.length;f--;){var g=this.shopCart[f];a==g.id&&b==g.price||(e=e+g.price*g.amount)}return e},getItemQuantity:function(a,b){for(var e=this.shopCart.length;e--;){var f=this.shopCart[e];if(f.id==a&&f.price==b)return f.amount}return 0},openShopQuantitySelect:function(a){sc.Model.notifyObserver(this,sc.MENU_EVENT.SHOP_OPEN_QUANTITY,a)},openCheckout:function(){sc.Model.notifyObserver(this,sc.MENU_EVENT.SHOP_OPEN_CHECKOUT)},updateTotalCost:function(a,b,
e){var f=this.getTotalCost(a,e);a&&(b!=void 0&&e)&&(f=f+(b||0)*e);sc.Model.notifyObserver(this,sc.MENU_EVENT.SHOP_CART_CHANGED,f)},newSlot:function(){sc.stats.addMap("player","saves",1);ig.storage.save(ig.storage.slots.length);sc.Model.notifyObserver(this,sc.MENU_EVENT.SAVE_NEW_SLOT)},saveSlot:function(a){ig.storage.save(a);sc.Model.notifyObserver(this,sc.MENU_EVENT.SAVE_UPDATE_SLOT,a)},deleteSlot:function(a){ig.storage.deleteSlot(a);sc.Model.notifyObserver(this,sc.MENU_EVENT.SAVE_DELETE_SLOT,a)},
loadSlot:function(a){this.loadSlotID=a},setItemInfo:function(a){sc.Model.notifyObserver(this,sc.MENU_EVENT.ITEM_INFO_CHANGED,a)},resetItemInfo:function(){sc.Model.notifyObserver(this,sc.MENU_EVENT.ITEM_RESET_INFO)},setItemTab:function(a){a=a||0;if(a!=this.itemCurrentTab){var b=this.itemCurrentTab;this.itemCurrentTab=a;sc.Model.notifyObserver(this,sc.MENU_EVENT.ITEM_CHANGED_TAB,b)}},getCurrentTabType:function(){switch(this.itemCurrentTab){case 0:return"NEW";case 1:return sc.ITEMS_TYPES.CONS;case 2:case 3:case 4:case 5:return sc.ITEMS_TYPES.EQUIP;
case 6:return sc.ITEMS_TYPES.TRADE;case 7:return sc.ITEMS_TYPES.KEY;case 8:return sc.ITEMS_TYPES.TOGGLE}return null},getCurrentTabSubType:function(){switch(this.itemCurrentTab){case 2:return sc.ITEMS_EQUIP_TYPES.ARM;case 3:return sc.ITEMS_EQUIP_TYPES.HEAD;case 4:return sc.ITEMS_EQUIP_TYPES.TORSO;case 5:return sc.ITEMS_EQUIP_TYPES.FEET}return null},isItemEquipTab:function(){return this.itemCurrentTab>=2&&this.itemCurrentTab<=5},sortList:function(a){sc.Model.notifyObserver(this,sc.MENU_EVENT.SORT_LIST,
a)},setOptionTab:function(a){a=a||0;if(a!=this.optionCurrentTab){this.optionCurrentTab=a;sc.Model.notifyObserver(this,sc.MENU_EVENT.OPTION_CHANGED_TAB)}},getCurrentOptionCategory:function(){for(var a in sc.OPTION_CATEGORY)if(sc.OPTION_CATEGORY[a]==this.itemCurrentTab)return this.itemCurrentTab;return null},openLanguagePopUp:function(a){sc.Model.notifyObserver(this,sc.MENU_EVENT.OPTION_LANG_POP_UP,a)},setSynoTab:function(){sc.Model.notifyObserver(this,sc.MENU_EVENT.SYNO_CHANGED_TAB)},setSynopInfo:function(a,
b){this.synopInfo=a;sc.Model.notifyObserver(this,sc.MENU_EVENT.SYNOP_SET_INFO,b)},setSynopFocus:function(a){sc.Model.notifyObserver(this,sc.MENU_EVENT.SYNOP_FOCUS,a)},switchSynopsisPage:function(a){sc.Model.notifyObserver(this,sc.MENU_EVENT.SYNOP_SWITCH_PAGE,a)},setSynopPressed:function(a){sc.Model.notifyObserver(this,sc.MENU_EVENT.SYNOP_BUTTON_PRESS,a)},setQuestTab:function(a){a=a||0;if(a!=this.questCurrentTab){var b=this.questCurrentTab;this.questCurrentTab=a;sc.Model.notifyObserver(this,sc.MENU_EVENT.QUEST_CHANGED_TAB,
b)}},setQuestInfo:function(a,b){this.questInfo=a;sc.Model.notifyObserver(this,sc.MENU_EVENT.QUEST_SET_INFO,b)},enterQuestDetails:function(a){this.questDetailMode=true;sc.Model.notifyObserver(this,sc.MENU_EVENT.QUEST_ENTER_DEAILS,a)},leaveQuestDetails:function(){this.questDetailMode=false;sc.Model.notifyObserver(this,sc.MENU_EVENT.QUEST_LEAVE_DEAILS)},selectBodyPart:function(a){this.previousBodyPart=this.currentBodyPart;this.currentBodyPart=a||sc.MENU_EQUIP_BODYPART.NONE;sc.Model.notifyObserver(this,
sc.MENU_EVENT.SELECTED_BODYPART)},cycleBodyPartRight:function(){var a=this.currentBodyPart+1;a>5&&(a=sc.MENU_EQUIP_BODYPART.HEAD);this.selectBodyPart(a)},cycleBodyPartLeft:function(){var a=this.currentBodyPart-1;a<1&&(a=sc.MENU_EQUIP_BODYPART.FEET);this.selectBodyPart(a)},changeEquipOnCurrentBodypart:function(a){sc.Model.notifyObserver(this,sc.MENU_EVENT.EQUIP_CHANGED,a)},ensureCurrentValues:function(){sc.Model.notifyObserver(this,sc.MENU_EVENT.EQUIP_ENSURE_CURRENT_VALUES)},exitEquipMenu:function(){this.previousBodyPart=
null;this.currentBodyPart=sc.MENU_EQUIP_BODYPART.NONE},showSkillEffect:function(a,b,e){sc.Model.notifyObserver(this,sc.MENU_EVENT.SKILL_SHOW_EFFECT,{gui:a,isSwitch:b,delay:e})},showSwapSkillEffect:function(a){sc.Model.notifyObserver(this,sc.MENU_EVENT.SKILL_SHOW_EFFECT_SWAP,a)},selectSkillTree:function(a){if(a!=this.currentSkillTree){this.previousSkillTree=this.currentSkillTree;this.currentSkillTree=a!=void 0?a:-1;if(this.currentSkillTree!=-1){this.skillState=sc.MENU_SKILL_STATE.DETAIL_VIEW;this.currentSkillFocus=
null;this.skillWasDragged=false}else{this.skillState=sc.MENU_SKILL_STATE.OVERVIEW;this.skillWasDragged=false;this.lastSkillCursor.x=this.skillCursor.x;this.lastSkillCursor.y=this.skillCursor.y;this.skillCursor.x=0;this.skillCursor.y=0;this.currentSkillFocus=null}sc.Model.notifyObserver(this,sc.MENU_EVENT.SKILL_TREE_SELECT)}},focusCursorOnNode:function(a,b,e){if(this.currentSkillFocus==e){if(ig.input.currentDevice==ig.INPUT_DEVICES.GAMEPAD){this.skillCursor.x=a;this.skillCursor.y=b;sc.Model.notifyObserver(this,
sc.MENU_EVENT.SKILL_ENSURE_GAMEPAD_FOCUS)}}else{this.skillWasDragged=false;this.skillRecoverPos.x=this.skillCursor.x;this.skillRecoverPos.y=this.skillCursor.y;this.skillCursor.x=a;this.skillCursor.y=b;this.currentSkillFocus=e;this.skillState=sc.MENU_SKILL_STATE.NODE_SELECT;sc.Model.notifyObserver(this,sc.MENU_EVENT.SKILL_CURSOR_FOCUS_NODE,this.currentSkillFocus.skill)}},unfocusCursor:function(a){if(this.currentSkillFocus==a){this.currentSkillFocus=null;this.skillState=sc.MENU_SKILL_STATE.DETAIL_VIEW;
sc.Model.notifyObserver(this,sc.MENU_EVENT.SKILL_CURSOR_UNFOCUS_NODE)}},unfocusSwapCursor:function(a){if(this.skillSwapFocus==a){this.skillSwapFocus=null;sc.Model.notifyObserver(this,sc.MENU_EVENT.SKILL_SWAP_UNFOCUS)}},focusSwapCursor:function(a,b,e){if(this.skillSwapFocus==e){if(ig.input.currentDevice==ig.INPUT_DEVICES.GAMEPAD){this.skillSwapCursor.x=a;this.skillSwapCursor.y=b;sc.Model.notifyObserver(this,sc.MENU_EVENT.SKILL_SWAP_ENSURE)}}else{this.skillSwapMoved=false;this.skillSwapCursor.x=a;this.skillSwapCursor.y=
b;this.skillSwapFocus=e;sc.Model.notifyObserver(this,sc.MENU_EVENT.SKILL_SWAP_FOCUS)}},resetSwapCursor:function(){this.skillSwapMoved=false;if(this.skillSwapFocus)this.skillSwapFocus.focus=false;this.skillSwapFocus=null},centerOnNode:function(a,b){if(a){var e=-this.skillCursor.y+ig.system.height/2;this.skillCamera.x=-this.skillCursor.x+ig.system.width/2;this.skillCamera.y=e;this.skillState=sc.MENU_SKILL_STATE.NODE_MENU;sc.Model.notifyObserver(this,sc.MENU_EVENT.SKILL_NODE_SELECT,b)}},centerOnNodeCam:function(a,
b,e,f){if(a){a=-b.y+ig.system.height/2;this.skillCamera.x=-b.x+ig.system.width/2;this.skillCamera.y=a;sc.Model.notifyObserver(this,sc.MENU_EVENT.CIRCUIT_FOCUS_CAM,{callback:f,time:e||0.2})}},exitNodeMenu:function(a){this.skillState=a||sc.MENU_SKILL_STATE.DETAIL_VIEW;sc.Model.notifyObserver(this,sc.MENU_EVENT.SKILL_NODE_EXIT)},enterSwapBranches:function(a){this.skillStateOrigin=a||sc.MENU_SKILL_STATE.OVERVIEW;this.skillState=sc.MENU_SKILL_STATE.SWAP_BRANCHES;sc.Model.notifyObserver(this,sc.MENU_EVENT.SKILL_ENTER_SWAP_BRANCHES)},
leaveSwapBranches:function(){this.skillSwapFocus=null;this.skillState=sc.MENU_SKILL_STATE.OVERVIEW;sc.Model.notifyObserver(this,sc.MENU_EVENT.SKILL_LEAVE_SWAP_BRANCHES)},toggledInputMode:function(){sc.Model.notifyObserver(this,sc.MENU_EVENT.SKILL_TOGGLED_INPUT_MODE)},selectFloor:function(a){sc.map.currentFloor=a||0;sc.Model.notifyObserver(this,sc.MENU_EVENT.MAP_CHANGED_FLOOR)},enterWorldMap:function(){if(this.mapMapFocus&&this.mapMapFocus.focus)this.mapMapFocus.focus=false;this.mapMapFocus=null;this.mapDrag=
false;this.mapWorldmapActive=true;sc.Model.notifyObserver(this,sc.MENU_EVENT.MAP_WORLDMAP_STATE,this.mapWorldmapActive)},exitWorldMap:function(){this.mapWorldmapActive=false;sc.Model.notifyObserver(this,sc.MENU_EVENT.MAP_WORLDMAP_STATE,this.mapWorldmapActive)},focusArea:function(a,b,e,f){if(this.mapAreaFocus==e){if(ig.input.currentDevice==ig.INPUT_DEVICES.GAMEPAD){this.mapWorldCursor.x=a;this.mapWorldCursor.y=b;sc.Model.notifyObserver(this,sc.MENU_EVENT.MAP_ENSURE_FOCUS,true)}}else{this.mapWorldCursor.x=
a;this.mapWorldCursor.y=b;if(this.mapAreaFocus&&this.mapAreaFocus.focus)this.mapAreaFocus.focus=false;if((this.mapAreaFocus=e)&&!this.mapAreaFocus.focus)this.mapAreaFocus.focus=true;sc.Model.notifyObserver(this,sc.MENU_EVENT.MAP_FOCUS_AREA,f)}},focusMap:function(a,b,e,f){if(this.mapMapFocus==e){if(ig.input.currentDevice==ig.INPUT_DEVICES.GAMEPAD){this.mapCursor.x=a;this.mapCursor.y=b;sc.Model.notifyObserver(this,sc.MENU_EVENT.MAP_ENSURE_FOCUS)}}else{this.mapWasDragged=false;this.mapCursor.x=a;this.mapCursor.y=
b;if(this.mapMapFocus&&this.mapMapFocus.focus)this.mapMapFocus.focus=false;if(this.mapMapFocus=e)this.mapMapFocus.focus=true;sc.Model.notifyObserver(this,sc.MENU_EVENT.MAP_FOCUS_MAP,f)}},unfocusArea:function(a){if(this.mapAreaFocus==a){if(this.mapAreaFocus)this.mapAreaFocus.focus=false;this.mapAreaFocus=null;sc.Model.notifyObserver(this,sc.MENU_EVENT.MAP_UNFOCUS,true)}},unfocusMap:function(a){if(this.mapMapFocus==a){if(this.mapMapFocus)this.mapMapFocus.focus=false;this.mapMapFocus=null;sc.Model.notifyObserver(this,
sc.MENU_EVENT.MAP_UNFOCUS,false)}},resetWorldmapCursor:function(){this.mapWmCursorMoved=false;if(this.mapAreaFocus)this.mapAreaFocus.focus=false;this.mapAreaFocus=null},loadArea:function(a){if(a==sc.map.currentArea.path)this.exitWorldMap();else{this.mapLoading=true;this.mapWorldmapActive=false;sc.Model.notifyObserver(this,sc.MENU_EVENT.MAP_AREA_LOAD,a)}},setAreaLoadDone:function(a){this.mapLoading=false;sc.Model.notifyObserver(this,sc.MENU_EVENT.MAP_AREA_LOAD_DONE,a)},openStampMenu:function(a){sc.Model.notifyObserver(this,
sc.MENU_EVENT.MAP_OPEN_STAMPS,a)},getCurrentMenuAsName:function(){return this.getMenuAsName(this.currentMenu)},getMenuAsName:function(a){return ig.lang.get("sc.gui.menu.menu-titles."+((this.loadMode||this.arenaCustomMode||this.shopCoinMode)&&sc.SUB_MENU_INFO[a].alt?sc.SUB_MENU_INFO[a].alt:sc.SUB_MENU_INFO[a].name))},isStart:function(){return this.currentMenu==sc.MENU_SUBMENU.START},isSkills:function(){return this.currentMenu==sc.MENU_SUBMENU.SKILLS},isEquipment:function(){return this.currentMenu==
sc.MENU_SUBMENU.EQUIPMENT},isStatus:function(){return this.currentMenu==sc.MENU_SUBMENU.STATUS},isSynopsis:function(){return this.currentMenu==sc.MENU_SUBMENU.SYNOPSIS},isMap:function(){return this.currentMenu==sc.MENU_SUBMENU.MAP},isSave:function(){return this.currentMenu==sc.MENU_SUBMENU.SAVE},isOptions:function(){return this.currentMenu==sc.MENU_SUBMENU.OPTIONS},isShop:function(){return this.currentMenu==sc.MENU_SUBMENU.SHOP},isButtonInteractActive:function(){return this.buttonInteract.isActive()}});
sc.MENU_EVENT={};sc.MENU_EVENT.INFO_TEXT_CHANGED=0;sc.MENU_EVENT.TOP_BAR_CHANGED=1;sc.MENU_EVENT.TOP_BAR_UPDATE=2;sc.MENU_EVENT.ENTER_MENU=3;sc.MENU_EVENT.LEAVE_MENU=4;sc.MENU_EVENT.EXIT_MENU=5;sc.MENU_EVENT.LEA_STATE_CHANGED=6;sc.MENU_EVENT.ITEM_INFO_CHANGED=7;sc.MENU_EVENT.SELECTED_BODYPART=8;sc.MENU_EVENT.EQUIP_CHANGED=9;sc.MENU_EVENT.SKILL_TREE_SELECT=10;sc.MENU_EVENT.SKILL_CURSOR_FOCUS_NODE=11;sc.MENU_EVENT.SKILL_CURSOR_UNFOCUS_NODE=12;sc.MENU_EVENT.SKILL_NODE_SELECT=13;sc.MENU_EVENT.SKILL_NODE_EXIT=
14;sc.MENU_EVENT.SKILL_ENTER_SWAP_BRANCHES=15;sc.MENU_EVENT.SKILL_LEAVE_SWAP_BRANCHES=16;sc.MENU_EVENT.SKILL_TOGGLED_INPUT_MODE=17;sc.MENU_EVENT.SKILL_ENSURE_GAMEPAD_FOCUS=18;sc.MENU_EVENT.ITEM_CHANGED_TAB=19;sc.MENU_EVENT.MAP_CHANGED_FLOOR=20;sc.MENU_EVENT.OPTION_CHANGED_TAB=21;sc.MENU_EVENT.SORT_LIST=22;sc.MENU_EVENT.ITEM_RESET_INFO=23;sc.MENU_EVENT.SET_BUFF_INFO=24;sc.MENU_EVENT.QUEST_CHANGED_TAB=25;sc.MENU_EVENT.QUEST_SET_INFO=26;sc.MENU_EVENT.QUEST_ENTER_DEAILS=27;sc.MENU_EVENT.QUEST_LEAVE_DEAILS=
28;sc.MENU_EVENT.MAP_WORLDMAP_STATE=29;sc.MENU_EVENT.MAP_FOCUS_AREA=30;sc.MENU_EVENT.MAP_FOCUS_MAP=31;sc.MENU_EVENT.MAP_UNFOCUS=32;sc.MENU_EVENT.MAP_ENSURE_FOCUS=33;sc.MENU_EVENT.MAP_AREA_LOAD=34;sc.MENU_EVENT.MAP_AREA_LOAD_DONE=35;sc.MENU_EVENT.SAVE_NEW_SLOT=36;sc.MENU_EVENT.SAVE_UPDATE_SLOT=37;sc.MENU_EVENT.SAVE_DELETE_SLOT=38;sc.MENU_EVENT.SYNO_CHANGED_TAB=39;sc.MENU_EVENT.SYNOP_SET_INFO=40;sc.MENU_EVENT.SYNOP_SWITCH_PAGE=41;sc.MENU_EVENT.SYNOP_BUTTON_PRESS=42;sc.MENU_EVENT.SKILL_SWAP_FOCUS=43;
sc.MENU_EVENT.SKILL_SWAP_UNFOCUS=44;sc.MENU_EVENT.SKILL_SWAP_ENSURE=45;sc.MENU_EVENT.SHOP_STATE_CHANGED=46;sc.MENU_EVENT.SHOP_PAGE_CHANGED=47;sc.MENU_EVENT.SHOP_CART_CHANGED=48;sc.MENU_EVENT.SHOP_OPEN_QUANTITY=49;sc.MENU_EVENT.SHOP_OPEN_CHECKOUT=50;sc.MENU_EVENT.TRADE_TOGGLE_DETAILS=51;sc.MENU_EVENT.STATUS_SET_PAGE=52;sc.MENU_EVENT.STATUS_SET_ELEMENT=53;sc.MENU_EVENT.DROP_COMPLETED=54;sc.MENU_EVENT.REMOVE_HOTKEYS=55;sc.MENU_EVENT.EQUIP_ENSURE_CURRENT_VALUES=56;sc.MENU_EVENT.MAP_OPEN_STAMPS=57;sc.MENU_EVENT.MAP_UPDATE_STAMP=
58;sc.MENU_EVENT.SYNOP_FOCUS=59;sc.MENU_EVENT.OPTION_LANG_POP_UP=60;sc.MENU_EVENT.SKILL_SHOW_EFFECT=61;sc.MENU_EVENT.CIRCUIT_FOCUS_CAM=62;sc.MENU_EVENT.SKILL_SHOW_EFFECT_SWAP=63;sc.MENU_EVENT.POST_EXIT=99;sc.MENU_EVENT.FULL_MENU_ENTER=100;sc.MenuHelper={drawLevel:function(a,b,e,f,g){b=13;e=e-7;sc.options.get("level-letter-display")&&f.draw(0,e,56,304+(g?14:0),5,7);var h=a,i=2;do{i--;b=b-4;f.draw(b,e,62+h%10*5,304+(a<10&&i==0?7:g?14:0),5,7);h=~~(h/10)}while(i)},drawLevelGui:function(a,b,e,f,g){e=13;
f=f-7;sc.options.get("level-letter-display")&&a.addGfx(g,0,f,56,304,5,7);var h=b,i=2;do{i--;e=e-4;a.addGfx(g,e,f,62+h%10*5,304+(b<10&&i==0?7:0),5,7);h=~~(h/10)}while(i)},addDots:function(a){for(var b=ig.currentLang+"",b=ig.LANG_DETAILS[ig.currentLang]&&ig.LANG_DETAILS[ig.currentLang].commaDigits?".":",",e=/(\d+)(\d{3})/,a=a+"";e.test(a);)a=a.replace(e,"$1"+b+"$2");return a}};ig.addGameAddon(function(){return sc.menu=new sc.MenuModel})});ig.baked=!0;
ig.module("game.feature.model.game-model").requires("impact.base.game","impact.feature.bgm.bgm","game.feature.model.base-model","game.feature.player.player-model","game.feature.msg.message-model","game.feature.menu.menu-model","game.feature.model.options-model","impact.feature.env-particles.env-particles").defines(function(){sc.COMBAT_RANK=[{label:"D",dropRate:1},{label:"C",dropRate:1.1},{label:"B",dropRate:1.25},{label:"A",dropRate:1.5},{label:"S",dropRate:2}];sc.GAME_MOBILITY_BLOCK={NONE:{},TELEPORT:{teleportBlock:true},
SAVE:{teleportBlock:true,saveBlock:true},CHECKPOINT:{teleportBlock:true,saveBlock:true,checkpointBlock:true},NO_MAP_LEAVE:{teleportBlock:true,saveBlock:true,checkpointBlock:true,mapLeaveBlock:true}};sc.GameModel=ig.GameAddon.extend({observers:[],currentState:0,currentSubState:0,prevSubState:0,currentTask:null,permaTask:null,keepTaskDisplayed:false,taskTimer:-1,leaConfig:new sc.PlayerConfig("Lea"),player:null,message:null,menu:null,options:null,inputGuis:[],startDifficulty:sc.DIFFICULTY.NORMAL,skipTimer:0,
combatMode:false,combatTimer:0,combatRank:0,inCombatTime:0,pauseMusicStop:false,mobilityBlock:"NONE",forceCombatMode:false,starSpawner:new ig.EnvParticleSpawner("STARS"),skipBlock:false,runsTimer:false,hsTimer:0,highScore:[],highScoreObs:[],maxHighScore:10,outOfCombatDialogTimer:0,startHighScoreTimer:function(){this.hsTimer=0;this.runsTimer=true},stopHighScoreTimer:function(b){if(this.runsTimer){this.runsTimer=false;b=b?this.highScoreObs:this.highScore;b.push(this.hsTimer);b.sort(function(a,b){return a-
b});b.length>10&&b.pop()}},init:function(){this.parent("GameModel");this.message=sc.message;this.menu=sc.menu;this.options=sc.options;this.player=new sc.PlayerModel;this.player.setConfig(this.leaConfig);ig.storage.register(this)},setCombatMode:function(b,a){var d=this.isCombatMode(),c=this.isCombatCooldown();a?this.forceCombatMode=!!b:this.combatMode=!!b;if(this.isCombatActive())this.combatTimer=this.player.getCombatCooldownTime();c!=this.isCombatCooldown()&&sc.Model.notifyObserver(this,sc.GAME_MODEL_MSG.COMBAT_MODE_CHANGED);
d!=this.isCombatMode()?this.isCombatMode()?this.startCombat():this.endCombat():this.updateCombatMusic()},cancelCombatCooldown:function(){if(this.combatTimer>0){this.combatTimer=0;this.endCombat()}},isCombatRankActive:function(){return sc.autoControl.isActive()?true:!this.player.getCore(sc.PLAYER_CORE.COMBAT_RANK)||!this.isCombatMode()||sc.pvp.isActive()||sc.map.isDungeon()||this.isForceCombat()?false:true},isSRank:function(){return this.getCombatRank()==sc.COMBAT_RANK.length-1},increaseCombatRank:function(b){if(!this.isCombatRankActive())return false;
var b=(b||1)*1,a=this.getCombatRank();this.combatRank=this.combatRank+b/(4*Math.pow(1.5,Math.floor(this.combatRank)));if(this.combatRank>sc.COMBAT_RANK.length-1)this.combatRank=sc.COMBAT_RANK.length-1;b=this.getCombatRank();if(a!=b){if(this.isSRank()&&sc.options.get("s-rank-effects")){if(ig.bgm.hasDefaultTrackType("sRankBattle")){ig.bgm.popDefaultTrackType("SLOW");ig.bgm.pushDefaultTrackType("sRankBattle","IMMEDIATELY")}ig.weather.addExtraParticles(this.starSpawner,10)}sc.Model.notifyObserver(this,
sc.GAME_MODEL_MSG.COMBAT_RANK_CHANGED);return true}return false},forceStartSRank:function(){this.combatRank=sc.COMBAT_RANK.length-1;if(ig.bgm.hasDefaultTrackType("sRankBattle")){ig.bgm.popDefaultTrackType("SLOW");ig.bgm.pushDefaultTrackType("sRankBattle","IMMEDIATELY")}ig.weather.addExtraParticles(this.starSpawner,10);sc.Model.notifyObserver(this,sc.GAME_MODEL_MSG.COMBAT_RANK_CHANGED)},startSRank:function(){},addChoiceGui:function(b){this.inputGuis.push(b)},removeChoiceGui:function(b){this.inputGuis.erase(b)},
notifyDreamFxChange:function(){sc.Model.notifyObserver(this,sc.GAME_MODEL_MSG.DREAM_MODE_CHANGE)},getCombatRank:function(){return Math.floor(this.combatRank)},getCombatRankLabel:function(){return sc.COMBAT_RANK[this.getCombatRank()].label},getCombatRankByLabel:function(b){for(var a=sc.COMBAT_RANK.length;a--;)if(sc.COMBAT_RANK[a].label==b)return a;throw Error("Combat Rannk of Label '"+b+"' does not exist");},getCombatRankDropRate:function(){return sc.COMBAT_RANK[this.getCombatRank()].dropRate},getCombatRankProgress:function(){return this.isSRank()?
1:this.combatRank-Math.floor(this.combatRank)},isMapLeaveBlocked:function(){return sc.GAME_MOBILITY_BLOCK[this.mobilityBlock]&&sc.GAME_MOBILITY_BLOCK[this.mobilityBlock].mapLeaveBlock},isCheckpointBlocked:function(){return sc.GAME_MOBILITY_BLOCK[this.mobilityBlock]&&sc.GAME_MOBILITY_BLOCK[this.mobilityBlock].checkpointBlock},isSaveBlocked:function(){return sc.GAME_MOBILITY_BLOCK[this.mobilityBlock]&&sc.GAME_MOBILITY_BLOCK[this.mobilityBlock].saveBlock},isTeleportBlocked:function(){return sc.GAME_MOBILITY_BLOCK[this.mobilityBlock]&&
sc.GAME_MOBILITY_BLOCK[this.mobilityBlock].teleportBlock},isTeleportBlockedNewGame:function(){return sc.newgame.get("waypoints-teleport")&&ig.game.playerEntity&&!ig.game.playerEntity.atLandmarkTeleport},isAssistMode:function(){return sc.options.get("assist-damage")!=1||sc.options.get("assist-attack-frequency")!=1||sc.options.get("assist-puzzle-speed")!=1},setCancelButton:function(b){this.cancelButtonText=b},setMobilityBlock:function(b){if(sc.GAME_MOBILITY_BLOCK[b])this.mobilityBlock=b},startCombat:function(){sc.stats.addMap("combat",
"started",1);this.inCombatTime=0;this.updateCombatMusic();sc.Model.notifyObserver(this,sc.GAME_MODEL_MSG.COMBAT_MODE_CHANGED,true)},endCombat:function(){sc.stats.setMapMax("combat","streakTime",this.inCombatTime);sc.model.player.params.getHpFactor()<=sc.HP_LOW_WARNING&&sc.stats.addMap("combat","lowHealthWins",1);ig.weather.removeExtraParticles(this.starSpawner);sc.combat.updateCombatCompletionData();sc.combat.setCombatSpeed(1);this.combatRank=0;this.updateCombatMusic();sc.Model.notifyObserver(this,
sc.GAME_MODEL_MSG.COMBAT_MODE_CHANGED,false)},updateCombatMusic:function(){sc.arena.active||(this.isCombatMode()?ig.bgm.getDefaultTrackTypeCount()==1&&(this.isCombatRankActive()&&ig.bgm.hasDefaultTrackType("rankBattle")?ig.bgm.pushDefaultTrackType("rankBattle","FAST_OUT"):ig.bgm.pushDefaultTrackType("battle","FAST_OUT")):ig.bgm.getDefaultTrackTypeCount()>1&&ig.bgm.popDefaultTrackType("SLOW"))},_isOutOfCombatDialogReadyIntern:function(){return!this.isCombatMode()&&this.isRunning()&&this.isGame()&&
!sc.autoControl.isActive()},isOutOfCombatDialogReady:function(){return this._isOutOfCombatDialogReadyIntern()&&this.outOfCombatDialogTimer<=0},onReset:function(){this.player.setConfig(this.leaConfig);this.player.reset();this.setCombatMode(false);this.setCombatMode(false,true);this.cancelCombatCooldown();this.mobilityBlock="NONE";this.cancelButtonText=null;this.skipBlock=this.pauseMusicStop=this.runsTimer=false;this.inCombatTime=0;this.inputGuis.length=0;this.setTask(null,false);this.setPermaTask(null)},
onPreUpdate:function(){if(this.isCombatCooldown())if(this.isCutscene())this.cancelCombatCooldown();else if(this.isRunning()){this.combatTimer=this.combatTimer-ig.system.tick;if(this.combatTimer<=0){this.combatTimer=0;this.endCombat()}}if(this.isCombatMode()&&ig.game.firstUpdateLoop){this.inCombatTime=this.inCombatTime+ig.system.rawTick;sc.stats.addMap("combat","time",ig.system.rawTick)}if(this._isOutOfCombatDialogReadyIntern()){if(this.outOfCombatDialogTimer>0)this.outOfCombatDialogTimer=this.outOfCombatDialogTimer-
1}else this.outOfCombatDialogTimer=2;if(!this.isPaused()&&(this.isRunning()||this.isMenu())&&this.runsTimer)this.hsTimer=this.hsTimer+ig.system.actualTick;if(this.isCutscene()&&this.isRunning()||this.message.isMenuMode()){if(this.skipTimer>0){this.skipTimer=this.skipTimer-ig.system.actualTick;if(this.skipTimer<=0){this.skipTimer=0;sc.Model.notifyObserver(this,sc.GAME_MODEL_MSG.CUTSCENE_SKIP,false)}}}else if(this.skipTimer>0){this.skipTimer=0;sc.Model.notifyObserver(this,sc.GAME_MODEL_MSG.CUTSCENE_SKIP,
false)}},onVarsChanged:function(){!sc.model.isTitle()&&sc.lore.loaded&&this.player&&this.player.updateChapter()},clearTopMessage:function(){sc.Model.notifyObserver(this,sc.GAME_MODEL_MSG.CLEAR_TOP_MESSAGE,true)},skipCutscene:function(){if(!this.skipBlock)if(this.skipTimer>0){this.skipTimer=0;sc.Model.notifyObserver(this,sc.GAME_MODEL_MSG.CUTSCENE_SKIP,false);if(sc.options.get("skip-confirm")){ig.canLeavePauseMenu=false;this.message.isMenuMode()||ig.game.setPaused(true);sc.Dialogs.showYesNoDialog(ig.lang.get("sc.gui.dialogs.skipConfirm"),
null,function(b){ig.canLeavePauseMenu=true;this.message.isMenuMode()||ig.game.setPaused(false);b.data==0&&this.startSkip()}.bind(this))}else this.startSkip()}else{this.skipTimer=3;sc.Model.notifyObserver(this,sc.GAME_MODEL_MSG.CUTSCENE_SKIP,true)}},enterTitle:function(){ig.system.skipMode=false;this._setState(sc.GAME_MODEL_STATE.TITLE);this.message.onSceneEnd(true)},enterCutscene:function(b){this.message.clearSideMessages();this._setState(sc.GAME_MODEL_STATE.CUTSCENE);b&&sc.combat.setActive(true)},
enterGame:function(){ig.system.skipMode=false;this.message.onSceneEnd();this._setState(sc.GAME_MODEL_STATE.GAME)},enterRunning:function(b){this.isPaused()&&this.pauseMusicStop&&ig.bgm.resume("IMMEDIATELY");ig.game.setPaused(false);this._setSubState(sc.GAME_MODEL_SUBSTATE.RUNNING,b)},enterTeleport:function(){this._setSubState(sc.GAME_MODEL_SUBSTATE.TELEPORT)},enterLoading:function(){this._setSubState(sc.GAME_MODEL_SUBSTATE.LOADING)},enterNewGame:function(){this._setSubState(sc.GAME_MODEL_SUBSTATE.NEWGAME)},
enterReset:function(){this._setSubState(sc.GAME_MODEL_SUBSTATE.RESET)},enterLoadGame:function(){this._setSubState(sc.GAME_MODEL_SUBSTATE.LOADGAME)},enterLevelUp:function(){this._setSubState(sc.GAME_MODEL_SUBSTATE.LEVELUP)},enterQuestSolved:function(){this._setSubState(sc.GAME_MODEL_SUBSTATE.QUESTSOLVED)},enterQuickMenu:function(){if(this.currentState==sc.GAME_MODEL_STATE.GAME&&this.currentSubState==sc.GAME_MODEL_SUBSTATE.RUNNING&&!this.isPlayerControlBlocked()){ig.game.setPaused(true);this._setSubState(sc.GAME_MODEL_SUBSTATE.QUICK);
return true}return false},enterOnMapMenu:function(){if((this.currentState==sc.GAME_MODEL_STATE.GAME||this.currentState==sc.GAME_MODEL_STATE.CUTSCENE)&&this.currentSubState==sc.GAME_MODEL_SUBSTATE.RUNNING){this._setSubState(sc.GAME_MODEL_SUBSTATE.ONMAPMENU);return true}return false},enterPrevSubState:function(){if(this.currentSubState!=this.prevSubState)switch(this.prevSubState){case sc.GAME_MODEL_SUBSTATE.MENU:this.enterMenu();break;case sc.GAME_MODEL_SUBSTATE.RUNNING:this.enterRunning();break;case sc.GAME_MODEL_SUBSTATE.PAUSE:this.enterPause(true);
break;default:this._setSubState(this.prevSubState)}},enterMenu:function(b){if(b||this.currentState==sc.GAME_MODEL_STATE.GAME&&this.currentSubState==sc.GAME_MODEL_SUBSTATE.RUNNING){ig.game.setPaused(true);this._setSubState(sc.GAME_MODEL_SUBSTATE.MENU);return true}return false},enterPause:function(b){if(b||this.currentState!==sc.GAME_MODEL_STATE.TITLE&&this.currentSubState==sc.GAME_MODEL_SUBSTATE.RUNNING){this.pauseMusicStop&&ig.bgm.pause("IMMEDIATELY");ig.game.setPaused(true);this.stopSkip();this._setSubState(sc.GAME_MODEL_SUBSTATE.PAUSE);
return true}return false},isTitle:function(){return this.currentState==sc.GAME_MODEL_STATE.TITLE},isGame:function(){return this.currentState==sc.GAME_MODEL_STATE.GAME},isCutscene:function(){return this.currentState==sc.GAME_MODEL_STATE.CUTSCENE},isRunning:function(){return this.currentSubState==sc.GAME_MODEL_SUBSTATE.RUNNING},isTeleport:function(){return this.currentSubState==sc.GAME_MODEL_SUBSTATE.TELEPORT},isLoading:function(){return this.currentSubState==sc.GAME_MODEL_SUBSTATE.LOADING},isNewGame:function(){return this.currentSubState==
sc.GAME_MODEL_SUBSTATE.NEWGAME},isReset:function(){return this.currentSubState==sc.GAME_MODEL_SUBSTATE.RESET},isLoadGame:function(){return this.currentSubState==sc.GAME_MODEL_SUBSTATE.LOADGAME},isMenu:function(){return this.currentSubState==sc.GAME_MODEL_SUBSTATE.MENU},isPaused:function(){return this.currentSubState==sc.GAME_MODEL_SUBSTATE.PAUSE},isHUDBlocked:function(){return this.currentSubState==sc.GAME_MODEL_SUBSTATE.PAUSE||this.currentSubState==sc.GAME_MODEL_SUBSTATE.QUICK||this.currentSubState==
sc.GAME_MODEL_SUBSTATE.TELEPORT||this.currentSubState==sc.GAME_MODEL_SUBSTATE.LOADING},isLevelUp:function(){return this.currentSubState==sc.GAME_MODEL_SUBSTATE.LEVELUP},isQuestSolved:function(){return this.currentSubState==sc.GAME_MODEL_SUBSTATE.QUESTSOLVED},isQuickMenu:function(){return this.currentSubState==sc.GAME_MODEL_SUBSTATE.QUICK},isQuickMenuElementSwapEnabled:function(){var b=sc.options.get("quick-element"),b=b&this.currentSubState==sc.GAME_MODEL_SUBSTATE.QUICK;return b=b&sc.quickmodel.isQuickNone()},
isOnMapMenu:function(){return this.currentSubState==sc.GAME_MODEL_SUBSTATE.ONMAPMENU},isForceCombat:function(){return this.forceCombatMode},isCombatMode:function(){return this.isCombatActive()||this.combatTimer>0},isCombatActive:function(){return this.combatMode||this.forceCombatMode},isCombatCooldown:function(){return!this.isCombatActive()&&this.combatTimer>0},getCombatCooldownFactor:function(){return this.combatTimer/this.player.getCombatCooldownTime()},isSaveAllowed:function(){return!this.isSaveBlocked()&&
!this.isCombatMode()&&ig.game.isInterruptible()},isPlayerControlBlocked:function(){var b=ig.game.playerEntity;return!b?false:b.isControlBlocked()},hasActiveChoice:function(){return this.message.hasChoice()||this.inputGuis.length>0},startSkip:function(){if(!this.skipBlock&&(this.message.isMenuMode()||this.currentState==sc.GAME_MODEL_STATE.CUTSCENE)&&!this.message.hasChoice())ig.system.skipMode=true},stopSkip:function(){ig.system.skipMode=false},setTask:function(b,a,d){this.currentTask=b;this.keepTaskDisplayed=
a;this.taskTimer=d!=void 0&&d>=0?d:-1;sc.Model.notifyObserver(this,sc.GAME_MODEL_MSG.TASK_CHANGED)},setPermaTask:function(b){this.permaTask=b;this.taskTimer=-1;sc.Model.notifyObserver(this,sc.GAME_MODEL_MSG.PERMA_TASK_CHANGED)},resetMenuState:function(){sc.Model.notifyObserver(this,sc.GAME_MODEL_MSG.RESET_MENU_STATE)},_setState:function(b){this.currentState=b;sc.Model.notifyObserver(this,sc.GAME_MODEL_MSG.STATE_CHANGED)},_setSubState:function(b,a){this.prevSubState=this.currentSubState;this.currentSubState=
b;a||sc.Model.notifyObserver(this,sc.GAME_MODEL_MSG.SUB_STATE_CHANGED)},onStorageSave:function(b){b.player=this.player.getSaveData();b.mobilityBlock=this.mobilityBlock;b.forceCombatMode=this.forceCombatMode;b.highscore=ig.copy(this.highScore);b["highscore-obs"]=ig.copy(this.highScoreObs);b.currentTask=this.currentTask&&this.currentTask.data;b.permaTask=this.permaTask&&this.permaTask.data;b.keepTaskDisplayed=this.keepTaskDisplayed;b.cancelButtonText=this.cancelButtonText},onStoragePreLoad:function(b){this.player.preLoad(b.player);
this.mobilityBlock=b.mobilityBlock;this.cancelButtonText=b.cancelButtonText;if(!this.mobilityBlock)this.mobilityBlock=b.saveBlock?"SAVE":"NONE";this.pauseMusicStop=false;this.highScore=b.highscore||[];this.highScoreObs=b["highscore-obs"]||[];this.currentTask=b.currentTask&&new ig.LangLabel(b.currentTask);this.keepTaskDisplayed=b.keepTaskDisplayed;this.setPermaTask(b.permaTask&&new ig.LangLabel(b.permaTask))},onStoragePostLoad:function(b){this.setCombatMode(false);this.setCombatMode(b.forceCombatMode,
true);this.cancelCombatCooldown();this.player.postLoad(b.player)}});ig.addGameAddon(function(){return sc.model=new sc.GameModel});sc.GAME_MODEL_MSG={STATE_CHANGED:0,TASK_CHANGED:1,SUB_STATE_CHANGED:2,COMBAT_MODE_CHANGED:3,COMBAT_RANK_CHANGED:4,CUTSCENE_SKIP:5,RESET_MENU_STATE:6,PERMA_TASK_CHANGED:7,CLEAR_TOP_MESSAGE:8,DREAM_MODE_CHANGE:9};sc.GAME_MODEL_STATE={TITLE:0,GAME:1,CUTSCENE:2};sc.GAME_MODEL_SUBSTATE={RUNNING:0,TELEPORT:1,LOADING:2,NEWGAME:3,RESET:4,LOADGAME:5,MENU:6,PAUSE:7,LEVELUP:8,QUICK:9,
ONMAPMENU:10,QUESTSOLVED:11}});ig.baked=!0;
ig.module("game.feature.inventory.detectors").requires("impact.base.game","game.feature.model.game-model","impact.feature.effect.effect-sheet").defines(function(){sc.DETECTOR_FILTERS={};sc.DETECTOR_FILTERS.FULL_CHEST={entityCheck:function(a){return a instanceof ig.ENTITY.Chest&&(!a.detectCondition||a.detectCondition.evaluate())&&!a.isOpened()}};var b=["documentation","laserpickaxe","dynamite"];sc.DETECTOR_FILTERS.MINE_EQUIP={entityCheck:function(a){return a instanceof ig.ENTITY.Prop&&a.propSheet.path==
"cold-dng"&&b.indexOf(a.propName)!=-1&&!a._hidden}};sc.DETECTORS=[{item:466,areas:["cold-dng"],filter:sc.DETECTOR_FILTERS.MINE_EQUIP,label:"sc.gui.detector.mine-equip"},{item:501,filter:sc.DETECTOR_FILTERS.FULL_CHEST,label:"sc.gui.detector.chest"}];sc.Detectors=ig.GameAddon.extend({timer:0,onStates:[],detectMsg:[],arGui:null,fx:new ig.EffectSheet("puzzle"),init:function(){this.parent("Detectors");sc.Model.addObserver(sc.model.player,this)},onLevelLoaded:function(){this.clearCurrentMsg();this.detectMsg.length=
0;this.timer=this.onStates.length=0;this.checkDetectors()},modelChanged:function(a,b){a instanceof sc.PlayerModel&&b==sc.PLAYER_MSG.ITEM_TOGGLED&&this.checkDetectors(true)},checkDetectors:function(a){for(var b=sc.DETECTORS.length;b--;){var c=sc.DETECTORS[b],e=this.checkDetector(c,b);e&&this.detectMsg.push({detector:c,count:e})}if(!this.timer&&this.detectMsg.length>0)this.timer=a?0.05:0.3},onDeferredUpdate:function(){if(this.timer>0&&!sc.model.isCutscene()&&sc.model.isRunning()&&ig.game.isInterruptible()){this.timer=
this.timer-ig.system.actualTick;if(this.timer<=0)if(this.detectMsg.length>0){this.timer=2;this.startDetector(this.detectMsg.pop())}else{this.clearCurrentMsg();this.timer=0}}},checkDetector:function(a,b){if(sc.model.player.getItemAmount(a.item)==0)return 0;var c=sc.model.player.getToggleItemState(a.item);if(!c||this.onStates[b]==c){this.onStates[b]=c;return 0}this.onStates[b]=c;if(a.areas&&(!sc.map.currentPlayerArea||a.areas.indexOf(sc.map.currentPlayerArea.path)==-1))return 0;for(c=this.detectMsg.length;c--;)if(this.detectMsg[0].detector==
a)return 0;var e=0,f=a.filter;if(f.entityCheck)for(var g=ig.game.entities,c=g.length;c--;)f.entityCheck(g[c])&&e++;return e},clearCurrentMsg:function(){if(this.arGui){this.arGui.remove();this.arGui=null}},startDetector:function(a){this.clearCurrentMsg();if(sc.model.isGame()){var b=a.count,a=ig.lang.get(a.detector.label),a=a.replace("[[x]]",b);this.fx.spawnOnTarget("detector",ig.game.playerEntity);this.arGui=new ig.GUI.ARBox(ig.game.playerEntity,a,0,sc.AR_BOX_MODE.NO_LINE,sc.AR_COLOR.GREEN);ig.gui.addGuiElement(this.arGui)}}});
ig.addGameAddon(function(){return sc.detectors=new sc.Detectors})});ig.baked=!0;ig.module("game.feature.inventory.plug-in").requires("game.feature.inventory.inventory","game.feature.inventory.detectors","game.feature.inventory.item-level-scaling").defines(function(){window.wm&&wm.postLoadModules.push("game.feature.inventory.editors.item-editors")});ig.baked=!0;
ig.module("game.feature.ar.gui.ar-box").requires("impact.feature.gui.gui").defines(function(){sc.AR_BOX_MODE={NO_LINE:0,LINE_FILL:1,LINE_EMPTY:2};sc.AR_COLOR={GREEN:{rgb:"#166c70",yOff:0},RED:{rgb:"#6e0000",yOff:16}};ig.GUI.ARBox=ig.GuiElementBase.extend({transitions:{DEFAULT:{state:{},time:0.25,timeFunction:KEY_SPLINES.EASE_OUT},HIDDEN:{state:{scaleX:1,scaleY:0},time:0.25,timeFunction:KEY_SPLINES.EASE_IN}},gfx:new ig.Image("media/gui/map-ar.png"),target:null,attachEntity:null,text:null,timer:0,maxTime:0,
prevMove:Vec2.createC(-1,-1),delta:Vec2.createC(-1,-1),arrowX:0,mode:sc.AR_BOX_MODE.NO_LINE,color:null,finished:false,hideOutsideOfScreen:false,tracker:null,varName:null,varMaxFill:null,varRefEntity:null,init:function(b,a,d,c,e){this.parent();this.setPivot(0,4);this.hook.zIndex=-50;this.target=b;this.text=a;this.maxTime=this.timer=d||0;this.mode=c||false;this.color=e||sc.AR_COLOR.GREEN;this.hook.invisibleUpdate=true;b=new sc.TextGui(this.text,{speed:ig.TextBlock.SPEED.NORMAL,font:sc.fontsystem.smallFont});
b.setAlign(ig.GUI_ALIGN.X_CENTER,ig.GUI_ALIGN.Y_CENTER);this.addChildGui(b);this.setSize(b.hook.size.x+8,b.hook.size.y+4+(this.mode?2:0));this.hook.pivot.y=b.hook.size.y/2+2;this.doStateTransition("HIDDEN",true);this.target?this._updatePos(false):this.doStateTransition("DEFAULT")},setVarFill:function(b,a,d){this.varName=b;this.varMaxFill=a;this.varRefEntity=d},setTracker:function(b){var a=this.target.getCombatantRoot();if(a.trackers){b=a.trackers[b];if(b instanceof sc.ENEMY_TRACKER.TIME)this.tracker=
b}},update:function(){if(this.tracker){this.maxTime=this.tracker._getTarget(this.target.getCombatantRoot());this.timer=this.maxTime-this.tracker.current;this.timer<=0&&this.remove()}else if(this.varName){this.maxTime=this.varMaxFill;this.varRefEntity&&ig.vars.pushEntityAccessor(this.varRefEntity);this.timer=this.maxTime-ig.vars.get(this.varName);this.varRefEntity&&ig.vars.popEntityAccessor(this.varRefEntity)}else if(this.timer){this.timer=this.timer-ig.system.tick;this.timer<=0&&this.remove()}this.target||
this.remove();this.target._killed&&this.remove();this.target instanceof ig.ENTITY.Combatant&&this.target.isDefeated()&&this.remove();this._updatePos(true)},updateDrawables:function(b){b.addColor(this.color.rgb,2,2,this.hook.size.x-4,this.hook.size.y-4).setAlpha(0.5);if(this.hasTransition()){var a=this.getTransitionFactor();this.hook.currentStateName=="DEFAULT"&&(a=1-a);b.addDraw().setAlpha(a).setColor("white",2,2,this.hook.size.x-4,this.hook.size.y-4)}else{b.addTransform().setAlpha(0.5);b.addGfx(this.gfx,
0,0,0,0+this.color.yOff,8,8);b.addGfx(this.gfx,this.hook.size.x-8,0,8,0+this.color.yOff,8,8);b.addGfx(this.gfx,this.hook.size.x-8,this.hook.size.y-8,8,8+this.color.yOff,8,8);b.addGfx(this.gfx,0,this.hook.size.y-8,0,8+this.color.yOff,8,8);b.undoTransform();this.arrowX<=3?b.addGfx(this.gfx,-13,this.hook.size.y-3,32,0+this.color.yOff,16,16,true):this.arrowX>=this.hook.size.x-3?b.addGfx(this.gfx,this.hook.size.x-3,this.hook.size.y-3,32,0+this.color.yOff,16,16):b.addGfx(this.gfx,this.arrowX-8,this.hook.size.y-
1,16,0+this.color.yOff,16,16)}if(this.mode&&this.maxTime){b.addColor("black",4,this.hook.size.y-2-2,this.hook.size.x-8,1);a=(this.timer/this.maxTime).limit(0,1);this.mode==sc.AR_BOX_MODE.LINE_FILL&&(a=1-a);b.addColor("white",4,this.hook.size.y-2-2,(this.hook.size.x-8)*a,1)}},remove:function(){this.finished=true;this.attachEntity&&this.attachEntity.removeEntityAttached(this);this.doStateTransition("HIDDEN",false,true)},isFinished:function(){return this.finished},onActionEndDetach:function(){this.remove()},
onEntityKillDetach:function(){this.remove()},_getCurrentNumber:function(){if(this.timer>=this.numTransitionTime)return this.targetNumber;var b=this.timer/this.numTransitionTime;return Math.floor((1-b)*this.initNumber+b*this.targetNumber)},_updatePos:function(b){var a=this.hook,d=this.target.getCenter(),c=Math.round(d.x)-ig.game.screen.x,d=Math.round(d.y-this.target.coll.pos.z-this.target.coll.size.z/2)-ig.game.screen.y,e=this.target.coll.size.x/2,f=(this.target.coll.size.y+this.target.coll.size.z)/
2-4,g=Math.max(e,f),h=c-ig.system.width/2,i=h>0?1:-1;if(b){if(i!=this.prevMove.x&&Math.abs(h)>16)this.prevMove.x=i;this.delta.x=this.delta.x*0.9+this.prevMove.x*0.1;this.delta.y=this.delta.y*0.9+this.prevMove.y*0.1}else{this.prevMove.x=this.delta.x=i;this.prevMove.y=this.delta.y=-1}a.pos.x=c+this.delta.x*(e+a.size.x/2)-a.size.x/2;a.pos.y=d+this.delta.y*(f+a.size.y/2)-a.size.y/2;if(!this.hideOutsideOfScreen){a.pos.x=a.pos.x.limit(0,ig.system.width-a.size.x);b=sc.gui.statusHud.getFreeScreenMinY(a.pos.x);
a.pos.y=a.pos.y.limit(b,ig.system.height-a.size.y);a.removeAfterTransition||this.doStateTransition("DEFAULT")}this.arrowX=c-a.pos.x;this.hideOutsideOfScreen&&!a.removeAfterTransition&&(this.arrowX<-8-g||this.arrowX>a.size.x+g+8||a.pos.y>d||a.pos.y<d-g-a.size.y-8?this.doStateTransition("HIDDEN"):this.doStateTransition("DEFAULT"))},setAttachedEntity:function(b){b.addEntityAttached(this);this.attachEntity=b}})});ig.baked=!0;
ig.module("game.feature.ar.ar-steps").requires("impact.base.action","impact.base.event","game.feature.ar.gui.ar-box").defines(function(){function b(a){return a instanceof ig.GUI.ARBox}ig.EVENT_STEP.SHOW_AR_MSG=ig.EventStepBase.extend({entity:null,text:null,time:null,mode:false,color:null,partName:null,varFill:null,varFillMax:null,_wm:new ig.Config({attributes:{entity:{_type:"Entity",_info:"Entity to show AR Message on"},text:{_type:"LangLabel",_info:"AR Text to display"},time:{_type:"NumberExpression",
_info:"Time in seconds the message should be visible. 0 = forever"},mode:{_type:"String",_info:"Mode of AR display.",_select:sc.AR_BOX_MODE},color:{_type:"String",_info:"Color of AR display.",_select:sc.AR_COLOR},hideOutsideOfScreen:{_type:"Boolean",_info:"If defined: don't show offscreen-msg"},partName:{_type:"String",_info:"If provided: Show AR display to sub part of entity",_optional:true},varFill:{_type:"VarName",_info:"Filling of AR Message depends on value of variable",_optional:true},varFillMax:{_type:"NumberExpression",
_info:"Maximum Number of variable to fill bar",_optional:true}},width:400}),init:function(a){this.entity=a.entity;this.text=new ig.LangLabel(a.text);this.time=a.time;this.mode=sc.AR_BOX_MODE[a.mode];this.color=sc.AR_COLOR[a.color];this.partName=a.partName;this.varFill=a.varFill;this.varFillMax=a.varFillMax},start:function(a,b){var c=ig.Event.getEntity(this.entity,b),e=c,f=ig.Event.getExpressionValue(this.time);if(this.partName)for(var g=c.coll.subColls,h=g.length;h--;)if(g[h].entity.partName==this.partName){e=
g[h].entity;break}e=new ig.GUI.ARBox(e,this.text.toString(),f,this.mode,this.color);ig.gui.addGuiElement(e);if(this.hideOutsideOfScreen)e.hideOutsideOfScreen=true;this.varFill&&e.setVarFill(this.varFill,ig.Event.getExpressionValue(this.varFillMax),c);e.setAttachedEntity(c)}});ig.EVENT_STEP.CLEAR_AR_MSG=ig.EventStepBase.extend({entity:null,_wm:new ig.Config({attributes:{entity:{_type:"Entity",_info:"Entity to show AR Message on"}},width:400}),init:function(a){this.entity=a.entity},start:function(a,
d){ig.Event.getEntity(this.entity,d).clearEntityAttached(b)}});ig.ACTION_STEP.SHOW_AR_MSG=ig.ActionStepBase.extend({text:null,time:null,mode:false,color:null,actionDetached:false,partName:null,varFill:null,varFillMax:null,_wm:new ig.Config({attributes:{text:{_type:"LangLabel",_info:"AR Text to display"},time:{_type:"NumberExpression",_info:"Time in seconds the message should be visible. 0 = forever"},mode:{_type:"String",_info:"Mode of AR display.",_select:sc.AR_BOX_MODE},color:{_type:"String",_info:"Color of AR display.",
_select:sc.AR_COLOR},actionDetached:{_type:"Boolean",_info:"If true, keep Message even after action is finished or canceled"},hideOutsideOfScreen:{_type:"Boolean",_info:"If defined: don't show offscreen-msg"},partName:{_type:"String",_info:"If provided: Show AR display to sub part of entity",_optional:true},tracker:{_type:"TrackerRef",_info:"If defined: bind time value of AR message to enemy tracker",_optional:true},varFill:{_type:"VarName",_info:"Filling of AR Message depends on value of variable",
_optional:true},varFillMax:{_type:"NumberExpression",_info:"Maximum Number of variable to fill bar",_optional:true}}}),init:function(a){this.text=new ig.LangLabel(a.text);this.time=a.time;this.mode=sc.AR_BOX_MODE[a.mode];this.color=sc.AR_COLOR[a.color];this.actionDetached=a.actionDetached||false;this.hideOutsideOfScreen=a.hideOutsideOfScreen||false;this.partName=a.partName;this.tracker=a.tracker||null;this.varFill=a.varFill;this.varFillMax=a.varFillMax},start:function(a){var b=a;if(this.partName)for(var c=
a.coll.subColls,e=c.length;e--;)if(c[e].entity.partName==this.partName){b=c[e].entity;break}c=ig.Event.getExpressionValue(this.time);b=new ig.GUI.ARBox(b,this.text.toString(),c,this.mode,this.color);this.tracker?b.setTracker(this.tracker):this.varFill&&b.setVarFill(this.varFill,ig.Event.getExpressionValue(this.varFillMax),a);ig.gui.addGuiElement(b);this.actionDetached||a.addActionAttached(b);if(this.hideOutsideOfScreen)b.hideOutsideOfScreen=true;b.setAttachedEntity(a)}});ig.ACTION_STEP.CLEAR_AR_MSG=
ig.ActionStepBase.extend({_wm:new ig.Config({attributes:{}}),init:function(){},start:function(a){a.clearEntityAttached(b)}})});ig.baked=!0;ig.module("game.feature.ar.plug-in").requires("game.feature.ar.gui.ar-box","game.feature.ar.ar-steps").defines(function(){});ig.baked=!0;
ig.module("game.feature.npc.entities.sc-actor").requires("impact.base.actor-entity","impact.feature.effect.effect-sheet").defines(function(){function b(a,b){var c=ig.terrain.getTerrain(a,true,true),e=sc.ACTOR_SOUND[b]||sc.ACTOR_SOUND.none;return e[c]||e[ig.TERRAIN_DEFAULT]}sc.ACTOR_SOUND={};sc.ACTOR_SOUND.none={};sc.ACTOR_SOUND.none[ig.TERRAIN_DEFAULT]={};sc.ACTOR_SOUND["default"]={};sc.ACTOR_SOUND["default"][ig.TERRAIN_DEFAULT]={jump:new ig.Sound("media/sound/move/jump.ogg",0.4,0.1),land:new ig.Sound("media/sound/move/land.ogg",
1,0.1),step1:new ig.Sound("media/sound/move/step-2.ogg",0.5,0.1),step2:new ig.Sound("media/sound/move/step-1.ogg",0.5,0.1)};sc.ACTOR_SOUND["default"][ig.TERRAIN.CARDBOARD]={jump:new ig.Sound("media/sound/move/jump.ogg",0.4,0.1),land:new ig.Sound("media/sound/move/cardboard-land.ogg",0.5,0.1),step1:new ig.Sound("media/sound/move/cardboard-step-2.ogg",0.5,0.1),step2:new ig.Sound("media/sound/move/cardboard-step-1.ogg",0.5,0.1)};sc.ACTOR_SOUND["default"][ig.TERRAIN.EARTH]={jump:new ig.Sound("media/sound/move/jump.ogg",
0.4,0.1),land:new ig.Sound("media/sound/move/grass-land.ogg",1,0.1),step1:new ig.Sound("media/sound/move/earth-step-1.ogg",1,0.1),step2:new ig.Sound("media/sound/move/earth-step-2.ogg",1,0.1),stepFx:"dust"};sc.ACTOR_SOUND["default"][ig.TERRAIN.GRASS]={jump:new ig.Sound("media/sound/move/jump.ogg",0.4,0.1),land:new ig.Sound("media/sound/move/grass-land.ogg",1,0.1),step1:new ig.Sound("media/sound/move/grass-step-2.ogg",1,0.1),step2:new ig.Sound("media/sound/move/grass-step-1.ogg",1,0.1)};sc.ACTOR_SOUND["default"][ig.TERRAIN.WOOD]=
{jump:new ig.Sound("media/sound/move/jump.ogg",0.4,0.1),land:new ig.Sound("media/sound/move/wooden-land.ogg",0.5,0.1),step1:new ig.Sound("media/sound/move/wooden-step-2.ogg",0.5,0.1),step2:new ig.Sound("media/sound/move/wooden-step-1.ogg",0.5,0.1)};sc.ACTOR_SOUND["default"][ig.TERRAIN.STONE]={jump:new ig.Sound("media/sound/move/jump.ogg",0.4,0.1),land:new ig.Sound("media/sound/move/stone-land.ogg",0.7,0.1),step1:new ig.Sound("media/sound/move/stone-step-2.ogg",0.8,0.1),step2:new ig.Sound("media/sound/move/stone-step-1.ogg",
0.8,0.1)};sc.ACTOR_SOUND["default"][ig.TERRAIN.METALSOLID]={jump:new ig.Sound("media/sound/move/jump.ogg",0.4,0.1),land:new ig.Sound("media/sound/move/metal-solid-land.ogg",0.7,0.1),step1:new ig.Sound("media/sound/move/metal-solid-step-2.ogg",0.8,0.1),step2:new ig.Sound("media/sound/move/metal-solid-step-1.ogg",0.8,0.1)};sc.ACTOR_SOUND["default"][ig.TERRAIN.METAL_HOLLOW]={jump:new ig.Sound("media/sound/move/jump.ogg",0.4,0.1),land:new ig.Sound("media/sound/move/pipe-land.ogg",0.7,0.1),step1:new ig.Sound("media/sound/move/pipe-step-1.ogg",
0.7,0.1),step2:new ig.Sound("media/sound/move/pipe-step-2.ogg",0.7,0.1)};sc.ACTOR_SOUND["default"][ig.TERRAIN.SNOW]={jump:new ig.Sound("media/sound/move/jump.ogg",0.4,0.1),land:new ig.Sound("media/sound/move/snow-land.ogg",0.6,0.1),step1:new ig.Sound("media/sound/move/snow-step-1.ogg",0.5,0.1),step2:new ig.Sound("media/sound/move/snow-step-2.ogg",0.5,0.1)};sc.ACTOR_SOUND["default"][ig.TERRAIN.ICE]={jump:new ig.Sound("media/sound/move/jump.ogg",0.4,0.1),land:new ig.Sound("media/sound/move/ice-land.ogg",
1,0.1),step1:new ig.Sound("media/sound/move/ice-step-1.ogg",1,0.1),step2:new ig.Sound("media/sound/move/ice-step-2.ogg",1,0.1)};sc.ACTOR_SOUND["default"][ig.TERRAIN.SAND]={jump:new ig.Sound("media/sound/move/jump.ogg",0.4,0.1),land:new ig.Sound("media/sound/move/snow-land.ogg",0.6,0.1),step1:new ig.Sound("media/sound/move/snow-step-1.ogg",0.5,0.1),step2:new ig.Sound("media/sound/move/snow-step-2.ogg",0.5,0.1),stepFx:"dust"};sc.ACTOR_SOUND["default"][ig.TERRAIN.QUICKSAND]={jump:new ig.Sound("media/sound/move/jump.ogg",
0.4,0.1),land:new ig.Sound("media/sound/move/snow-land.ogg",0.6,0.1),step1:new ig.Sound("media/sound/move/snow-step-1.ogg",0.5,0.1),step2:new ig.Sound("media/sound/move/snow-step-2.ogg",0.5,0.1)};sc.ACTOR_SOUND["default"][ig.TERRAIN.SHALLOW_WATER]={jump:new ig.Sound("media/sound/move/jump.ogg",0.4,0.1),land:new ig.Sound("media/sound/move/ice-land.ogg",1,0.1),step1:new ig.Sound("media/sound/move/water-step-01.ogg",0.3,0.1),step2:new ig.Sound("media/sound/move/water-step-02.ogg",0.3,0.1),stepFx:"water"};
sc.ACTOR_SOUND["default"][ig.TERRAIN.LASER]={jump:new ig.Sound("media/sound/move/jump.ogg",0.4,0.1),land:new ig.Sound("media/sound/move/laser-land.ogg",0.7,0.1),step1:new ig.Sound("media/sound/move/laser-step-1.ogg",0.7,0.1),step2:new ig.Sound("media/sound/move/laser-step-2.ogg",0.7,0.1),stepFx:"laser"};sc.ACTOR_SOUND["default"][ig.TERRAIN.CRYSTAL]={jump:new ig.Sound("media/sound/move/jump.ogg",0.4,0.1),land:new ig.Sound("media/sound/move/dark-crystal-land.ogg",0.6,0.1),step1:new ig.Sound("media/sound/move/dark-crystal-step-01.ogg",
0.4,0.1),step2:new ig.Sound("media/sound/move/dark-crystal-step-02.ogg",0.4,0.1)};sc.ACTOR_SOUND["default"][ig.TERRAIN.BEACH_SAND]={jump:new ig.Sound("media/sound/move/jump.ogg",0.4,0.1),land:new ig.Sound("media/sound/move/snow-land.ogg",0.6,0.1),step1:new ig.Sound("media/sound/move/snow-step-1.ogg",0.5,0.1),step2:new ig.Sound("media/sound/move/snow-step-2.ogg",0.5,0.1),stepFx:"beachSand",stepFaceAlign:true};sc.ACTOR_SOUND["default"][ig.TERRAIN.BEACH_WATER]={jump:new ig.Sound("media/sound/move/jump.ogg",
0.4,0.1),land:new ig.Sound("media/sound/move/ice-land.ogg",1,0.1),step1:new ig.Sound("media/sound/move/water-step-01.ogg",0.4,0.15),step2:new ig.Sound("media/sound/move/water-step-02.ogg",0.4,0.15),stepFx:"beach",cancelOnChange:true};sc.ACTOR_SOUND.defaultQuiet={};sc.ACTOR_SOUND.defaultQuiet[ig.TERRAIN_DEFAULT]={jump:new ig.Sound("media/sound/move/jump.ogg",0.2,0.1),land:new ig.Sound("media/sound/move/land.ogg",0.5,0.1)};sc.ACTOR_SOUND.giantMachine={};sc.ACTOR_SOUND.giantMachine[ig.TERRAIN_DEFAULT]=
{jump:new ig.Sound("media/sound/boss/crab/robot-jump.ogg",0.8),land:new ig.Sound("media/sound/boss/crab/robot-land.ogg",0.8)};sc.ACTOR_SOUND.colDngBoss={};sc.ACTOR_SOUND.colDngBoss[ig.TERRAIN_DEFAULT]={jump:new ig.Sound("media/sound/boss/crab/robot-jump.ogg",0.8),land:new ig.Sound("media/sound/boss/drill-boss/drill-boss-walk-2.ogg",0.8)};sc.ACTOR_SOUND.slime={};sc.ACTOR_SOUND.slime[ig.TERRAIN_DEFAULT]={jump:new ig.Sound("media/sound/battle/blubb.ogg",0.6),land:new ig.Sound("media/sound/battle/blubb-3.ogg",
0.6)};sc.ACTOR_DUST={NONE:0,DEFAULT:1};sc.ActorEntity=ig.ActorEntity.extend({soundType:"default",dustType:sc.ACTOR_DUST.NONE,stepFx:{frames:0,lastFrame:0,effects:new ig.EffectSheet("stepFx"),prevTerrain:null,prevEffect:null},nav:{path:null,failTimer:0,lastFailCount:0},tooHighToFall:false,stepStats:{terrain:0,centerTerrain:0},influencer:null,init:function(a,b,c,e){this.parent(a,b,c,e);this.nav.path=ig.navigation.getNavPath(this);this.influencer=new ig.Influencer(this)},update:function(){this.stepStats.terrain=
ig.terrain.getTerrain(this.coll,true);this.stepStats.centerTerrain=ig.terrain.getTerrain(this.coll,false);if(this.stepFx.prevEffect&&this.stepFx.prevTerrain!=this.stepStats.terrain){this.stepFx.prevEffect.stop();this.stepFx.prevEffect=null}this.onTerrainUpdate();this.influencer.onUpdate();var a=this.nav;if(a.path.failCount){a.failTimer=a.failTimer+ig.system.tick;if(a.path.failCount!=a.lastFailCount){a.lastFailCount=a.path.failCount;this.onNavigationFailed(a.failTimer)}}else a.failTimer=0;this.parent();
if(!this.jumping&&!this.animationFixed&&this.stepFx.frames&&!Vec2.isZero(this.coll.accelDir)&&this.coll.relativeVel>=ig.ACTOR_RUN_THRESHOLD){a=this.animState.getFrame();if(a!=this.stepFx.lastFrame){var d=b(this.coll,this.soundType),c=false;if(a==this.stepFx.frames[0]){c=true;ig.SoundHelper.playAtEntity(d.step1,this,null,null,700);this.onMoveEffect&&this.onMoveEffect("step")}if(a==this.stepFx.frames[1]){c=true;ig.SoundHelper.playAtEntity(d.step2,this,null,null,700);this.onMoveEffect&&this.onMoveEffect("step")}if(c&&
d.stepFx&&!ig.CollTools.isPostMoveOverHole(this.coll,true)){c=this.stepFx.effects.spawnOnTarget(d.stepFx,this,d.stepFaceAlign?{rotateFace:-1}:null);if(d.cancelOnChange){this.stepFx.prevEffect=c;this.stepFx.prevTerrain=this.stepStats.terrain}}this.stepFx.lastFrame=a}}else this.stepFx.lastFrame=-1},onTerrainUpdate:function(){},onMoveEffect:null,onJump:function(a,d){var c=b(this.coll,this.soundType);d||ig.SoundHelper.playAtEntity(c.jump,this,null,null,700);c=this.getCenter();ig.game.effects.dust.spawnFixed("medium",
c.x,c.y,this.coll.pos.z);this.onMoveEffect&&this.onMoveEffect("jump")},onTouchGround:function(a){this.parent(a);if((this.tooHighToFall||this.coll.pos.z>=ig.game.minLevelZ)&&(!this.coll.ignoreCollision&&!this.coll.float.height)&&this.dustType===sc.ACTOR_DUST.DEFAULT){var d=this.getCenter();if(a<0){var c=b(this.coll,this.soundType);ig.SoundHelper.playAtEntity(c.land,this,null,null,700);c.stepFx&&this.stepFx.effects.spawnOnTarget(c.stepFx,this)}if(a<-150){(a=this.tooHighToFall?ig.game.effects.dust.spawnFixed("giantHole",
d.x,d.y,this.coll.pos.z):this.coll.size.x>100?ig.game.effects.dust.spawnFixed("giant",d.x,d.y,this.coll.pos.z):this.coll.size.x>20?ig.game.effects.dust.spawnFixed("large",d.x,d.y,this.coll.pos.z):ig.game.effects.dust.spawnFixed("medium",d.x,d.y,this.coll.pos.z))&&a.setTimeEntity(this);this.onMoveEffect&&this.onMoveEffect("land")}}},onNavigationFailed:function(){},updateSprites:function(){ig.AnimatedEntity.prototype.updateSprites.call(this);this.influencer.onPostSpriteUpdate()}});ig.ACTOR_CONFIGS.SCACTOR=
{classType:sc.ActorEntity,KEYS:{stepSfxFrames:0,soundType:"default",dustType:"DEFAULT"},fromDataFix:function(){typeof this.dustType=="string"&&(this.dustType=sc.ACTOR_DUST[this.dustType])},apply:function(a){a.stepFx.frames=this.stepSfxFrames;a.soundType=this.soundType;a.dustType=this.dustType},load:function(a){this.stepSfxFrames=a.stepFx.frames;this.soundType=a.soundType;this.dustType=a.dustType}}});ig.baked=!0;
ig.module("game.feature.base.action-steps").requires("impact.base.action","impact.base.actor-entity","game.feature.npc.entities.sc-actor").defines(function(){var b=Vec3.create(),a=Vec2.create(),d=Vec3.create(),c=Vec2.create();ig.ACTION_STEP.SET_SOUNDTYPE=ig.ActionStepBase.extend({value:Vec2.create(),_wm:new ig.Config({attributes:{value:{_type:"String",_info:"New Soundtype",_select:sc.ACTOR_SOUND}}}),init:function(a){this.value=a.value},run:function(a){a.soundType=this.value;return true}});ig.ACTION_STEP.CHANGE_STAT_MAP_NUMBER=
ig.ActionStepBase.extend({map:"",stat:"",changeType:null,value:0,_wm:new ig.Config({attributes:{map:{_type:"String",_info:"The map."},stat:{_type:"String",_info:"The stat."},changeType:{_type:"String",_info:"Type of modification",_select:{set:1,add:1,sub:1}},value:{_type:"Number",_info:"Number"}},label:function(){return"<i style='color: orange'>SET STAT MAP</i>: "+this.map+"."+this.stat}}),init:function(a){this.map=a.map;this.stat=a.stat;this.changeType=a.changeType;this.value=a.value},start:function(){this.value&&
(this.changeType=="set"?sc.stats.setMap(this.map,this.stat,this.value):this.changeType=="add"?sc.stats.addMap(this.map,this.stat,this.value):this.changeType=="sub"&&sc.stats.subMap(this.map,this.stat,this.value))}});ig.ACTION_STEP.CIRCLE_ENTITY=ig.ActionStepBase.extend({_wm:new ig.Config({attributes:{entity:{_type:"Entity",_info:"Entity to focus camera on"},distance:{_type:"Number",_info:"Distance to target",_default:32,_optional:true},duration:{_type:"Number",_info:"Duration of rotating movement"},
ccw:{_type:"Boolean",_info:"If true, rotate counterclockwise"},rotateTime:{_type:"Number",_info:"Seconds for one full rotation. If not defined used current speed to determine rotation speed",_optional:true},distAdjustSpeed:{_type:"Number",_info:"Speed with which projectile adjust distance to target (pixel per seconds)"},zDistance:{_type:"Number",_info:"If defined: Interpolate to this z Distance (with same speed as dist interpolation)",_optional:true},waitUntil:{_type:"VarCondition",_info:"If defined: continue spinning until condition evaluates to true. Duration is minimum wait",
_optional:true},waitTargetAlign:{_type:"Boolean",_info:"If true: keep rotating until rotate velocity roughly matches direction to target"}}}),init:function(a){this.entity=a.entity;this.distance=a.distance===void 0?null:a.distance;this.duration=a.duration||0;this.rotateTime=a.rotateTime||0;this.distAdjustSpeed=a.distAdjustSpeed||0;this.ccw=a.ccw||false;this.zDistance=a.zDistance===void 0?null:a.zDistance;this.waitUntil=new ig.VarCondition(a.waitUntil);this.waitTargetAlign=a.waitTargetAlign||false},
start:function(a,b){var c=ig.Event.getEntity(this.entity,b);if(c){a.stepTimer=this.duration;a.stepData.target=c;a.stepData.lastPos=Vec3.create(c.coll.pos)}},run:function(e){var f=e.stepData.target;if(!f)return true;var g=e.coll.maxVel*e.coll.relativeVel,h=e.getAlignedPos(ig.ENTITY_ALIGN.BOTTOM,b),i=Vec3.assign(d,f.coll.pos);Vec3.sub(i,e.stepData.lastPos);this.zDistance!==null?Vec3.add(h,i):Vec2.add(h,i);Vec3.assign(e.stepData.lastPos,f.coll.pos);var j=f.getAlignedPos(ig.ENTITY_ALIGN.BOTTOM,d),f=Vec2.sub(h,
j,a);Vec2.isZero(f)&&Vec2.assignC(f,0,-1);var k=Vec2.length(f),i=this.distAdjustSpeed||g;if(this.distance!==null){if(k<this.distance){k=k+ig.system.tick*i;if(k>this.distance)k=this.distance}else if(k>this.distance){k=k-ig.system.tick*i;if(k<this.distance)k=this.distance}Vec2.length(f,k)}k=k*2*Math.PI;g=this.rotateTime?1/this.rotateTime:g/k;g=g*ig.system.tick*Math.PI*2;e.stepTimer<0&&(this.waitUntil.evaluate()&&!this.waitTargetAlign)&&(g=g*(1+e.stepTimer/ig.system.tick));this.ccw||(g=-g);Vec2.rotate(f,
g);Vec2.assign(h,j);Vec2.add(h,f);if(this.zDistance!==null){g=j.z+this.zDistance;if(h.z>g){h.z=h.z-ig.system.tick*i;if(h.z<g)h.z=g}else if(h.z<g){h.z=h.z+ig.system.tick*i;if(h.z>g)h.z=g}}h.x=h.x-e.coll.size.x/2;h.y=h.y-e.coll.size.y/2;this.ccw?Vec2.rotate90CW(f):Vec2.rotate90CCW(f);e.setPos(h.x,h.y,h.z);e.faceDirFixed||Vec2.assign(e.face,f);if(!this.waitUntil.evaluate())return false;if(e.stepTimer<=0&&this.waitTargetAlign){h=ig.CollTools.getDistVec2(e.coll,e.getTarget().coll,c);if(Vec2.angle(h,f)>
Math.PI/2*0.125)return false}return e.stepTimer<=0}})});ig.baked=!0;
ig.module("game.feature.base.event-steps").requires("impact.base.utils","impact.base.event","impact.base.action").defines(function(){ig.EVENT_STEP.SET_TELEPORT_COLOR=ig.EventStepBase.extend({color:null,lighter:false,_wm:new ig.Config({attributes:{color:{_type:"Color",_info:"Color of overlay"},lighter:{_type:"Boolean",_info:"Apply color in lighter mode"}}}),init:function(a){this.color=new ig.RGBColor(a.color);this.lighter=a.lighter||false},start:function(){ig.game.setTeleportColor(this.color.r,this.color.g,
this.color.b,this.lighter)}});ig.EVENT_STEP.SET_TELEPORT_TIME=ig.EventStepBase.extend({color:null,lighter:false,_wm:new ig.Config({attributes:{fadeIn:{_type:"Number",_info:"Color fade in time in seconds"},fadeOut:{_type:"Number",_info:"Color fade out time in seconds"}}}),init:function(a){this.fadeIn=a.fadeIn||0;this.fadeOut=a.fadeOut||0},start:function(){ig.game.setTeleportTime(this.fadeIn,this.fadeOut)}});ig.EVENT_STEP.LOAD=ig.EventStepBase.extend({_wm:new ig.Config({attributes:{}}),init:function(){},
start:function(){ig.storage.loadCheckpoint()}});ig.EVENT_STEP.SAVE=ig.EventStepBase.extend({marker:null,_wm:new ig.Config({attributes:{marker:{_type:"Entity",_info:"Marker to place entity at",_optional:true}}}),init:function(a){this.marker=a.marker},start:function(a,b){var c=null,e=ig.Event.getEntity(this.marker,b);e&&e.name&&(c=new ig.TeleportPosition(e.name));ig.storage.saveCheckpoint(void 0,c)}});ig.EVENT_STEP.GOTO_TITLE=ig.EventStepBase.extend({_wm:new ig.Config({attributes:{}}),start:function(){ig.game.gotoTitle()}});
ig.EVENT_STEP.ADD_MONEY=ig.EventStepBase.extend({amount:0,_wm:new ig.Config({attributes:{amount:{_type:"Number",_info:"Amount to add",_default:0}},label:function(){return"<b>ADD MONEY: </b> <em>"+this.amount+"</em>"}}),init:function(a){this.amount=a.amount||0},start:function(){this.amount>0&&sc.model.player.addCredit(this.amount)}});ig.EVENT_STEP.REMOVE_MONEY=ig.EventStepBase.extend({amount:0,_wm:new ig.Config({attributes:{amount:{_type:"Number",_info:"Amount to remove",_default:0}},label:function(){return"<b>REMOVE MONEY: </b> <em>"+
this.amount+"</em>"}}),init:function(a){this.amount=a.amount||0},start:function(){this.amount>0&&sc.model.player.removeCredit(this.amount)}});ig.EVENT_STEP.DROP_ITEM_ENTITY=ig.EventStepBase.extend({entity:null,item:0,amount:0,_wm:new ig.Config({attributes:{entity:{_type:"Entity",_info:"the entity to spawn the drop from"},item:{_type:"Item",_info:"The item to spawn."},amount:{_type:"Number",_info:"Amount of the given item. 0 = 1.",_default:1}},label:function(){return"<b>DROP ITEM: </b> "+wmPrint("Entity",
this.entity)+" <em>"+wmPrint("Item",this.item)+"</em> x"+this.amount}}),init:function(a){this.entity=a.entity||null;this.item=a.item||0;this.amount=a.amount||1},start:function(a,b){var c=ig.Event.getEntity(this.entity,b);sc.ItemDropEntity.spawnDrops(c,ig.ENTITY_ALIGN.CENTER,ig.game.playerEntity,this.item,this.amount,sc.ITEM_DROP_TYPE.EVENT_PROP)}});ig.EVENT_STEP.GIVE_ITEM=ig.EventStepBase.extend({item:0,amount:0,skip:false,_wm:new ig.Config({attributes:{item:{_type:"Item",_info:"The item to spawn."},
amount:{_type:"NumberExpression",_info:"Amount of the given item. 0 = 1.",_default:1},skip:{_type:"Boolean",_info:"True if the side gui should hide the obtained item",_default:false}},label:function(){return"<b>GIVE ITEM: </b> <em>"+wmPrint("Item",this.item)+"</em> x"+this.amount+(this.skip?"  <i>+ Skip Display</i>":"")}}),init:function(a){this.item=a.item||0;this.amount=a.amount||1;this.skip=a.skip||false},start:function(){var a=ig.Event.getExpressionValue(this.amount);sc.model.player.addItem(this.item,
a,this.skip)}});ig.EVENT_STEP.ADD_CP=ig.EventStepBase.extend({element:null,amount:0,_wm:new ig.Config({attributes:{element:{_type:"String",_info:"Element that gets the CP",_select:sc.ELEMENT},amount:{_type:"NumberExpression",_info:"Amount of CP to give.",_default:1}},label:function(){return"<b>ADD CP: </b> <em>"+wmPrint("Element",this.element)+"</em> x"+this.amount}}),init:function(a){this.element=sc.ELEMENT[a.element]||sc.ELEMENT.NEUTRAL;this.amount=a.amount||1},start:function(){var a=ig.Event.getExpressionValue(this.amount);
sc.model.player.addSkillPoints(a,this.element,false,true)}});ig.EVENT_STEP.REMOVE_ITEM=ig.EventStepBase.extend({item:0,amount:0,unequip:false,_wm:new ig.Config({attributes:{item:{_type:"Item",_info:"The item to spawn."},amount:{_type:"NumberExpression",_info:"Amount of the given item. 0 = 1.",_default:1},unequip:{_type:"Boolean",_info:"If true, unequip the item, if it is equipped",_optional:true,_default:true}},label:function(){return"<b>REMOVE ITEM: </b> <em>"+wmPrint("Item",this.item)+"</em> x"+
this.amount+(this.unequip?" [UNEQUIP]":"")}}),init:function(a){this.item=a.item||0;this.amount=a.amount||1;this.unequip=a.unequip||false},start:function(){var a=ig.Event.getExpressionValue(this.amount);sc.model.player.removeItem(this.item,a,false,this.unequip)}});ig.EVENT_STEP.TOGGLE_ITEM=ig.EventStepBase.extend({item:0,_wm:new ig.Config({attributes:{item:{_type:"Item",_info:"Item to toggle"}}}),init:function(a){this.item=a.item||0},start:function(){var a=sc.model.player.getToggleSet(this.item);a&&
sc.model.player.toggleItem(this.item,a)}});var b={BOTTOM_POS:1,JUMPING:2,SIZE:3,VELOCITY:4};ig.EVENT_STEP.SET_VAR_ENTITY_STAT=ig.EventStepBase.extend({varName:null,stat:null,entity:null,_wm:new ig.Config({attributes:{varName:{_type:"VarName",_info:"Variable to store stat"},entity:{_type:"Entity",_info:"Entity of which to fetch stat"},stat:{_type:"String",_info:"Type of Stat",_select:b}}}),init:function(a){this.varName=a.varName;this.entity=a.entity;this.stat=b[a.stat]||b.RELATIVE_HP},start:function(a,
d){var c=ig.Event.getVarName(this.varName);if(c){var e=ig.Event.getEntity(this.entity,d);if(e){var f;this.stat==b.BOTTOM_POS?f=e.getAlignedPos(ig.ENTITY_ALIGN.BOTTOM):this.stat==b.JUMPING?f=e.jumping||false:this.stat==b.SIZE?f=ig.copy(e.coll.size):this.stat==b.VELOCITY&&(f=ig.copy(e.coll.vel));ig.vars.set(c,f)}}else ig.log("SET_VAR_ENTITY_STAT: Variable Name is not a String!")}})});ig.baked=!0;ig.module("game.feature.base.plug-in").requires("game.feature.base.action-steps","game.feature.base.event-steps").defines(function(){});
ig.baked=!0;
ig.module("game.feature.bgm.playlist").requires("impact.feature.bgm.bgm").defines(function(){ig.merge(ig.BGM_TRACK_LIST,{silence:null,tutorial:{path:"media/bgm/muCargohold.mp3",loopEnd:124.364,volume:0.5,introPath:"media/bgm/muCargohold-i.mp3",introEnd:3.272},intro:{path:"media/bgm/muAwakened.mp3",loopEnd:130.068,volume:0.5},"short":{path:"media/bgm/short.mp3",loopEnd:5,volume:0.5},"tutorial-battle":{path:"media/bgm/muBattle1.mp3",loopEnd:61.736,volume:0.5,introPath:"media/bgm/muBattle1-i.mp3",introEnd:0.385},
challenge:{path:"media/bgm/muChallenge1.mp3",loopEnd:89.6,volume:0.5,introPath:"media/bgm/muChallenge1-i.mp3",introEnd:2.8},title:{path:"media/bgm/muTitle.mp3",loopEnd:36.099,volume:0.5},"cargoship-exterior":{path:"media/bgm/muSolar.mp3",loopEnd:93.658,volume:0.5},lolfanfare:{path:"media/bgm/lolfanfare.mp3",loopEnd:5.8,volume:0.5},landmark:{path:"media/sound/hud/landmark-discovery.mp3",loopEnd:3,volume:0.5},"ability-got":{path:"media/bgm/ability-got.mp3",loopEnd:1.5,volume:0.5},exposition:{path:"media/bgm/muCrossworlds.mp3",
loopEnd:83.173,volume:0.5},designer:{path:"media/bgm/muAvatar.mp3",loopEnd:72,volume:0.5,introPath:"media/bgm/muAvatar-i.mp3",introEnd:6},challenge2:{path:"media/bgm/muChallenge2.mp3",loopEnd:65.581,volume:0.5,introPath:"media/bgm/muChallenge2-i.mp3",introEnd:5.581},"puzzle-pg":{path:"media/bgm/puzzle-bgm.mp3",loopEnd:81,volume:0.5},bossbattle1:{path:"media/bgm/muBossbattle.mp3",loopEnd:59.823,volume:0.5,introPath:"media/bgm/muBossbattle-i.mp3",introEnd:11.823},escape:{path:"media/bgm/muEscape.mp3",
loopEnd:55,volume:0.5,introPath:"media/bgm/muEscape-i.mp3",introEnd:2.666},crosscounter:{path:"media/bgm/muCrosscounter.mp3",loopEnd:42.352,volume:0.5,introPath:"media/bgm/muCrosscounter-i.mp3",introEnd:8.823},oldHideout1:{path:"media/bgm/muMysterious.mp3",loopEnd:42.666,volume:0.5},oldHideoutBattle:{path:"media/bgm/muFiercebattle.mp3",loopEnd:57.6,volume:0.5,introPath:"media/bgm/muFiercebattle-i.mp3",introEnd:2.742},oldHideoutEnding:{path:"media/bgm/muDistantfuture.mp3",loopEnd:27,volume:0.5},autumnsRise:{path:"media/bgm/muAutumnsrise.mp3",
loopEnd:151.117,volume:0.5},fieldBattle:{path:"media/bgm/muBattle2.mp3",loopEnd:122.482,volume:0.5},rhombusDungeon:{path:"media/bgm/muRhombusdungeon.mp3",loopEnd:60,volume:0.5},rookieHarbor:{path:"media/bgm/muRookie.mp3",loopEnd:61.832,volume:0.5},firstScholars:{path:"media/bgm/muFirstscholars.mp3",loopEnd:84.857,volume:0.5},bergenTrail:{path:"media/bgm/muBergentrail.mp3",loopEnd:81,volume:0.5,introPath:"media/bgm/muBergentrail-i.mp3",introEnd:8},rhombusSquare:{path:"media/bgm/muNewcomer.mp3",loopEnd:64.477,
volume:0.5},apolloTheme:{path:"media/bgm/muApollo.mp3",loopEnd:44.689,volume:0.5,introPath:"media/bgm/muApollo-i.mp3",introEnd:10.758},coldDungeon:{path:"media/bgm/muTemplemine.mp3",loopEnd:83.076,volume:0.5},bergenVillage:{path:"media/bgm/muBergenvillage.mp3",loopEnd:98.331,volume:0.5},heatArea:{path:"media/bgm/muMaroonvalley.mp3",loopEnd:90.666,volume:0.5},heatVillage:{path:"media/bgm/muBakiikum.mp3",loopEnd:104.873,volume:0.5},heatDungeon:{path:"media/bgm/muTemplevalley.mp3",loopEnd:110.608,volume:0.5},
shockDungeon:{path:"media/bgm/muTemplethunder.mp3",loopEnd:119.999,volume:0.5},waveDungeon:{path:"media/bgm/muTemplelake.mp3",loopEnd:130.487,volume:0.5},treeDungeon:{path:"media/bgm/muTempletree.mp3",loopEnd:110.769,volume:0.5},jungle:{path:"media/bgm/muGarden.mp3",loopEnd:112,volume:0.5},emilie:{path:"media/bgm/muValse.mp3",loopEnd:62.905,volume:0.5,introPath:"media/bgm/muValse-i.mp3",introEnd:2.167},basinKeep:{path:"media/bgm/muBasinkeep.mp3",loopEnd:102.893,volume:0.5},casual:{path:"media/bgm/muTravel.mp3",
loopEnd:60,volume:0.5},briefing:{path:"media/bgm/muBriefing.mp3",loopEnd:79.592,volume:0.5},ponder:{path:"media/bgm/muImprovising.mp3",loopEnd:100.285,volume:0.5},lea:{path:"media/bgm/muLea.mp3",loopEnd:122.465,volume:0.5},"dreamsequence-intro":{path:"media/bgm/muDream1.mp3",loopEnd:19.672,volume:0.5},dreamsequence:{path:"media/bgm/muDream3.mp3",loopEnd:137.704,volume:0.5,introPath:"media/bgm/muDream2.mp3",introEnd:19.672},sorrow:{path:"media/bgm/muShock.mp3",loopEnd:87.887,volume:0.5,introPath:"media/bgm/muShock-i.mp3",
introEnd:39.718},raidTheme:{path:"media/bgm/muRaid.mp3",loopEnd:229.5,volume:0.5,introPath:"media/bgm/muRaid-i.mp3",introEnd:12.614},forestField:{path:"media/bgm/muSapphireridge.mp3",loopEnd:105.404,volume:0.5,introPath:"media/bgm/muSapphireridge-i.mp3",introEnd:9.792},designerBoss1:{path:"media/bgm/muBlueavatar.mp3",loopEnd:127.059,volume:0.6,introPath:"media/bgm/muBlueavatar-i.mp3",introEnd:25.038},waiting:{path:"media/bgm/muImprisoned.mp3",loopEnd:108.845,volume:0.5},aridField:{path:"media/bgm/muVermillion.mp3",
loopEnd:133.686,volume:0.5},aridBattle:{path:"media/bgm/muBattle3.mp3",loopEnd:104.728,volume:0.5,introPath:"media/bgm/muBattle3-i.mp3",introEnd:0.74},shizukaConfrontation:{path:"media/bgm/muConfrontation.mp3",loopEnd:43.522,volume:0.5,introPath:"media/bgm/muConfrontation-i.mp3",introEnd:183.238},confrontationLoop:{path:"media/bgm/muConfrontation.mp3",loopEnd:43.522,volume:0.5},evoDungeon1:{path:"media/bgm/muVermillionDungeon.mp3",loopEnd:80.842,volume:0.5},evoDungeon2:{path:"media/bgm/muVermillionDungeon2.mp3",
loopEnd:91.579,volume:0.5,introPath:"media/bgm/muVermillionDungeon2-i.mp3",introEnd:1.578},evoEscape:{path:"media/bgm/muEscape2.mp3",loopEnd:93.563,volume:0.5,introPath:"media/bgm/muEscape2-i.mp3",introEnd:9.376},sergeyExposition:{path:"media/bgm/muPastevents.mp3",loopEnd:123.887,volume:0.5},schneiderTour:{path:"media/bgm/muImprovising.mp3",loopEnd:100.285,volume:0.5},infiltration:{path:"media/bgm/muInfiltration.mp3",loopEnd:113.777,volume:0.5},sadness:{path:"media/bgm/muSadtheme.mp3",loopEnd:106.751,
volume:0.5},oldHideout2:{path:"media/bgm/muOldhideout.mp3",loopEnd:119.365,volume:0.5},trueIntentions:{path:"media/bgm/muTrueintention.mp3",loopEnd:164.383,volume:0.5,introPath:"media/bgm/muTrueintention-i.mp3",introEnd:0},rhombusSquare2:{path:"media/bgm/muRhombussquare.mp3",loopEnd:124.956,volume:0.5,introPath:"media/bgm/muRhombussquare-i.mp3",introEnd:10.06},autumnsFall:{path:"media/bgm/muAutumnsfall.mp3",loopEnd:132.954,volume:0.5},snailBattle1:{path:"media/bgm/muExponential.mp3",loopEnd:50.261,
volume:0.6,introPath:"media/bgm/muExponential-i.mp3",introEnd:5.34},snailBattle2:{path:"media/bgm/muExponentialpart2.mp3",loopEnd:130.68,volume:0.6,introPath:"media/bgm/muExponentialpart2-i.mp3",introEnd:2.513},lastDungeon:{path:"media/bgm/muVermillionDungeon3.mp3",loopEnd:164.359,volume:0.5},shizuka:{path:"media/bgm/muShizuka.mp3",loopEnd:86.069,volume:0.5,introPath:"media/bgm/muShizuka-i.mp3",introEnd:15.967},finalBoss:{path:"media/bgm/muUltimate.mp3",loopEnd:264.334,volume:0.6,introPath:"media/bgm/muUltimate-i.mp3",
introEnd:32.792},credits:{introPath:"media/bgm/muEnding.mp3",introEnd:244,path:"media/bgm/muLea.mp3",loopEnd:122.465,volume:0.5},credits2:{introPath:"media/bgm/muEnding.mp3",introEnd:244,path:"media/bgm/silence.mp3",loopEnd:122.465,volume:0.5},arena:{introPath:"media/bgm/muArena-i.mp3",introEnd:1.237,path:"media/bgm/muArena.mp3",loopEnd:98.969,volume:0.5},"s-rank":{introPath:"media/bgm/muSrank-i.mp3",introEnd:16,path:"media/bgm/muSrank.mp3",loopEnd:157.333,volume:0.5},bossRush:{introPath:"media/bgm/muBossrush-i.mp3",
introEnd:1.434,path:"media/bgm/muBossrush.mp3",loopEnd:154.182,volume:0.5},glitchArea:{introPath:"media/bgm/muGlitch-i.mp3",introEnd:30.629,path:"media/bgm/muGlitch.mp3",loopEnd:82.137,volume:0.5},evolabSubtle:{path:"media/bgm/evo-lab/evo-lab-subtle.mp3",loopEnd:24,volume:0.45},evolabMelody:{path:"media/bgm/evo-lab/evo-lab-melody.mp3",loopEnd:24,volume:0.5},evolabDissonant:{path:"media/bgm/evo-lab/evo-lab-dissonant.mp3",loopEnd:32,volume:0.5},evolabMid:{path:"media/bgm/evo-lab/evo-lab-mid.mp3",loopEnd:24,
volume:0.5},evolabHeartbeat:{path:"media/bgm/evo-lab/evo-lab-heartbeat.mp3",loopEnd:24,volume:0.5},beach:{path:"media/bgm/muBeach.mp3",loopEnd:96,volume:0.5},finalDungeon:{path:"media/bgm/muFinalDungeon.mp3",loopEnd:130.21,volume:0.5},godBoss:{introPath:"media/bgm/muGodBattle-i.mp3",introEnd:42.27,path:"media/bgm/muGodBattle.mp3",loopEnd:190.78,volume:0.5},discoLow:{path:"media/bgm/disco-low.mp3",loopEnd:14.4,volume:1},discoFull:{path:"media/bgm/disco-full.mp3",loopEnd:14.4,volume:1}});ig.Bgm.preloadStartTrack("title");
ig.merge(ig.BGM_DEFAULT_TRACKS,{cargoShipIntro:{field:{track:"intro",volume:1},battle:{track:"tutorial-battle",volume:1},rankBattle:{track:"tutorial-battle",volume:1},sRankBattle:{track:"s-rank",volume:1}},cargoShip:{field:{track:"tutorial",volume:1},battle:{track:"tutorial-battle",volume:1},sRankBattle:{track:"s-rank",volume:1}},cargoChallenge:{field:{track:"tutorial",volume:1},battle:{track:"tutorial-battle",volume:1},sRankBattle:{track:"s-rank",volume:1}},cargoShipExterior:{field:{track:"cargoship-exterior",
volume:1},battle:{track:"tutorial-battle",volume:1},sRankBattle:{track:"s-rank",volume:1}},puzzle:{field:{track:"rhombusDungeon",volume:1},battle:{track:"tutorial-battle",volume:1},sRankBattle:{track:"s-rank",volume:1}},hideout:{field:{track:"oldHideout1",volume:1},battle:{track:"oldHideoutBattle",volume:1},sRankBattle:{track:"s-rank",volume:1}},hideout2:{field:{track:"oldHideout2",volume:1},battle:{track:"oldHideoutBattle",volume:1},sRankBattle:{track:"s-rank",volume:1}},forest:{field:{track:"forestField",
volume:1},battle:{track:"tutorial-battle",volume:1},rankBattle:{track:"fieldBattle",volume:1},sRankBattle:{track:"s-rank",volume:1}},autumn:{field:{track:"autumnsRise",volume:1},battle:{track:"tutorial-battle",volume:1},rankBattle:{track:"fieldBattle",volume:1},sRankBattle:{track:"s-rank",volume:1}},autumnsFall:{field:{track:"autumnsFall",volume:1},battle:{track:"tutorial-battle",volume:1},rankBattle:{track:"fieldBattle",volume:1},sRankBattle:{track:"s-rank",volume:1}},rookieHarbor:{field:{track:"rookieHarbor",
volume:1},battle:{track:"tutorial-battle",volume:1},rankBattle:{track:"fieldBattle",volume:1},sRankBattle:{track:"s-rank",volume:1}},firstScholars:{field:{track:"firstScholars",volume:1},battle:{track:"tutorial-battle",volume:1},rankBattle:{track:"fieldBattle",volume:1},sRankBattle:{track:"s-rank",volume:1}},bergenTrail:{field:{track:"bergenTrail",volume:1},battle:{track:"tutorial-battle",volume:1},rankBattle:{track:"fieldBattle",volume:1},sRankBattle:{track:"s-rank",volume:1}},bergenVillage:{field:{track:"bergenVillage",
volume:1},battle:{track:"tutorial-battle",volume:1},rankBattle:{track:"fieldBattle",volume:1},sRankBattle:{track:"s-rank",volume:1}},heatArea:{field:{track:"heatArea",volume:1},battle:{track:"tutorial-battle",volume:1},rankBattle:{track:"fieldBattle",volume:1},sRankBattle:{track:"s-rank",volume:1}},rhombusSquare:{field:{track:"rhombusSquare",volume:1},battle:{track:"tutorial-battle",volume:1},rankBattle:{track:"fieldBattle",volume:1},sRankBattle:{track:"s-rank",volume:1}},rhombusSquare2:{field:{track:"rhombusSquare2",
volume:1},battle:{track:"tutorial-battle",volume:1},rankBattle:{track:"fieldBattle",volume:1},sRankBattle:{track:"s-rank",volume:1}},rhombusSquareArena:{field:{track:"arena",volume:1},battle:{track:"tutorial-battle",volume:1},rankBattle:{track:"fieldBattle",volume:1},sRankBattle:{track:"s-rank",volume:1}},crossCentral:{field:{track:"intro",volume:1},battle:{track:"tutorial-battle",volume:1},rankBattle:{track:"fieldBattle",volume:1},sRankBattle:{track:"s-rank",volume:1}},coldDungeon:{field:{track:"coldDungeon",
volume:1},battle:{track:"tutorial-battle",volume:1},rankBattle:{track:"fieldBattle",volume:1},sRankBattle:{track:"s-rank",volume:1}},heatVillage:{field:{track:"heatVillage",volume:1},battle:{track:"tutorial-battle",volume:1},rankBattle:{track:"fieldBattle",volume:1},sRankBattle:{track:"s-rank",volume:1}},heatGlitch:{field:{track:"glitchArea",volume:1},battle:{track:"tutorial-battle",volume:1},rankBattle:{track:"fieldBattle",volume:1},sRankBattle:{track:"s-rank",volume:1}},heatDungeonOutside:{field:{track:null,
volume:0.3},battle:{track:"tutorial-battle",volume:1},rankBattle:{track:"fieldBattle",volume:1},sRankBattle:{track:"s-rank",volume:1}},silence:{field:{track:null,volume:0.3},battle:{track:"tutorial-battle",volume:1},rankBattle:{track:"fieldBattle",volume:1},sRankBattle:{track:"s-rank",volume:1}},silenceCombat:{field:{track:null,volume:0.3},battle:{track:null,volume:1}},heatDungeon:{field:{track:"heatDungeon",volume:1},battle:{track:"tutorial-battle",volume:1},rankBattle:{track:"fieldBattle",volume:1},
sRankBattle:{track:"s-rank",volume:1}},jungle:{field:{track:"jungle",volume:1},battle:{track:"tutorial-battle",volume:1},rankBattle:{track:"fieldBattle",volume:1},sRankBattle:{track:"s-rank",volume:1}},basinKeep:{field:{track:"basinKeep",volume:1},battle:{track:"tutorial-battle",volume:1},rankBattle:{track:"fieldBattle",volume:1},sRankBattle:{track:"s-rank",volume:1}},shockDungeon:{field:{track:"shockDungeon",volume:1},battle:{track:"tutorial-battle",volume:1},rankBattle:{track:"fieldBattle",volume:1},
sRankBattle:{track:"s-rank",volume:1}},waveDungeon:{field:{track:"waveDungeon",volume:1},battle:{track:"tutorial-battle",volume:1},rankBattle:{track:"fieldBattle",volume:1},sRankBattle:{track:"s-rank",volume:1}},treeDungeon:{field:{track:"treeDungeon",volume:1},battle:{track:"tutorial-battle",volume:1},rankBattle:{track:"fieldBattle",volume:1},sRankBattle:{track:"s-rank",volume:1}},arid:{field:{track:"aridField",volume:1},battle:{track:"aridBattle",volume:1}},aridLab:{field:{track:null,volume:1},
battle:{track:"aridBattle",volume:1}},aridDng:{field:{track:"evoDungeon1",volume:1},battle:{track:"aridBattle",volume:1}},lastDng:{field:{track:"lastDungeon",volume:1},battle:{track:"aridBattle",volume:1}},lab:{field:{track:"coldDungeon",volume:1},battle:{track:"tutorial-battle",volume:1},rankBattle:{track:"fieldBattle",volume:1},sRankBattle:{track:"s-rank",volume:1}},evoVillage:{field:{track:"rookieHarbor",volume:1},battle:{track:"tutorial-battle",volume:1},rankBattle:{track:"fieldBattle",volume:1},
sRankBattle:{track:"s-rank",volume:1}},finalDng:{field:{track:"finalDungeon",volume:1},battle:{track:"aridBattle",volume:1}},finalDngEnd:{field:{track:"exposition",volume:0.8},battle:{track:"aridBattle",volume:1}},beach:{field:{track:"beach",volume:1},battle:{track:"tutorial-battle",volume:1},rankBattle:{track:"fieldBattle",volume:1},sRankBattle:{track:"s-rank",volume:1}},disco:{field:{track:"discoLow",volume:1},battle:{track:"aridBattle",volume:1}}})});ig.baked=!0;
ig.module("game.feature.bgm.volume-map").requires("impact.base.sound").defines(function(){ig.GlobalVolume.set("media/sound/menu/menu-cancel.ogg",0.8);ig.GlobalVolume.set("media/sound/move/jump.ogg",0.7);ig.GlobalVolume.set("media/sound/misc/scifi-effect-1.ogg",0.68);ig.GlobalVolume.set("media/sound/battle/ball-kill.ogg",0.7);ig.GlobalVolume.set("media/sound/puzzle/door-open.ogg",0.8)});ig.baked=!0;
ig.module("game.feature.bgm.plug-in").requires("game.feature.bgm.playlist","game.feature.bgm.volume-map").defines(function(){window.wm&&wm.mapAttribs&&(wm.mapAttribs.volume={_type:"Number",_info:"Volume modifier for BGM",_default:1})});ig.baked=!0;
ig.module("game.feature.character.abstract-face").defines(function(){function b(a){return{src:a.src,width:a.torso.w,height:a.torso.h+a.head.h-a.head.overlapY,centerX:a.centerX,centerY:a.centerY,parts:[{torso:{srcX:a.torso.x,srcY:a.torso.y,width:a.torso.w,height:a.torso.h,destX:0,destY:a.head.h-a.head.overlapY}},{head:{srcX:a.head.x,srcY:a.head.y,width:a.head.w,height:a.head.h,destX:a.head.offX,destY:0}}],expressions:{DEFAULT:{faces:[["torso","head"]]}}}}sc.ABSTRACT_FACES={};sc.ABSTRACT_FACES.sensei=
{src:"sensei.png",width:184,height:184,centerX:94,centerY:70,parts:[{torso:{srcX:0,srcY:100,width:184,height:84,destX:0,destY:100}},{head:{srcX:0,srcY:0,width:184,height:100,destX:0,destY:0}}],expressions:{DEFAULT:{faces:[["torso","head"]]}}};sc.ABSTRACT_FACES.oldman={src:"oldman.png",width:168,height:160,centerX:50,centerY:60,parts:[{torso:{srcX:0,srcY:100,width:168,height:60,destX:0,destY:100}},{head:{srcX:0,srcY:0,width:168,height:100,destX:0,destY:0}}],expressions:{DEFAULT:{faces:[["torso","head"]]}}};
sc.ABSTRACT_FACES.henry={src:"henry.png",width:134,height:160,centerX:50,centerY:60,parts:[{torso:{srcX:0,srcY:100,width:134,height:60,destX:0,destY:100},torsoH:{srcX:144,srcY:100,width:134,height:60,destX:0,destY:100}},{head:{srcX:0,srcY:0,width:134,height:100,destX:0,destY:0},headH:{srcX:144,srcY:0,width:134,height:100,destX:0,destY:0}}],expressions:{DEFAULT:{faces:[["torso","head"]]},HOLOGRAM:{faces:[["torsoH","headH"]]}}};sc.ABSTRACT_FACES.shadAlbino={src:"albinoshad.png",width:136,height:160,
centerX:44,centerY:92,parts:[{torso:{srcX:0,srcY:100,width:136,height:60,destX:0,destY:100}},{head:{srcX:0,srcY:0,width:136,height:100,destX:0,destY:0}}],expressions:{DEFAULT:{faces:[["torso","head"]]}}};sc.ABSTRACT_FACES.maleNormalHair1=b({src:"npc-portrait.png",torso:{x:0,y:0,w:136,h:64},head:{x:136,y:0,w:72,h:88,offX:24,overlapY:0},centerX:43,centerY:55});sc.ABSTRACT_FACES.maleNormalHair2={src:"npc-portrait.png",width:128,height:152,centerX:43,centerY:55,parts:[{straight:{srcX:0,srcY:0,width:136,
height:64,destX:0,destY:88}},{norm:{srcX:280,srcY:0,width:80,height:88,destX:24,destY:0},glass:{srcX:360,srcY:0,width:80,height:88,destX:24,destY:0}}],expressions:{DEFAULT:{faces:[["straight","norm"]]},GLASS:{faces:[["straight","glass"]]}}};sc.ABSTRACT_FACES.maleNormalBald1=b({src:"npc-portrait.png",torso:{x:0,y:64,w:136,h:64},head:{x:208,y:0,w:72,h:88,offX:24,overlapY:0},centerX:43,centerY:55});sc.ABSTRACT_FACES.maleFarmer=b({src:"npc-portrait.png",torso:{x:0,y:64,w:136,h:64},head:{x:440,y:0,w:104,
h:96,offX:8,overlapY:0},centerX:43,centerY:63});sc.ABSTRACT_FACES.femaleShortHair1=b({src:"npc-portrait.png",torso:{x:0,y:128,w:104,h:56},head:{x:136,y:88,w:80,h:88,offX:8,overlapY:0},centerX:36,centerY:60});sc.ABSTRACT_FACES.femaleLongHair1=b({src:"npc-portrait.png",torso:{x:0,y:128,w:104,h:56},head:{x:216,y:88,w:80,h:88,offX:8,overlapY:0},centerX:36,centerY:60});sc.ABSTRACT_FACES.femalePigtails=b({src:"npc-portrait.png",torso:{x:0,y:184,w:104,h:56},head:{x:296,y:88,w:80,h:88,offX:8,overlapY:0},
centerX:36,centerY:60});sc.ABSTRACT_FACES.femaleFarmer=b({src:"npc-portrait.png",torso:{x:0,y:184,w:104,h:56},head:{x:544,y:0,w:104,h:96,offX:0,overlapY:0},centerX:36,centerY:68});sc.ABSTRACT_FACES.maleNormalMustache=b({src:"npc-portrait.png",torso:{x:0,y:0,w:136,h:64},head:{x:352,y:272,w:80,h:96,offX:16,overlapY:2},centerX:40,centerY:64});sc.ABSTRACT_FACES.maleNormalOldBeard=b({src:"npc-portrait.png",torso:{x:0,y:0,w:136,h:64},head:{x:512,y:288,w:72,h:88,offX:16,overlapY:2},centerX:40,centerY:58});
sc.ABSTRACT_FACES.maleShadyBaldEyepatch=b({src:"npc-portrait.png",torso:{x:0,y:0,w:136,h:64},head:{x:112,y:264,w:72,h:88,offX:24,overlapY:0},centerX:43,centerY:55});sc.ABSTRACT_FACES.maleHairSunglasses=b({src:"npc-portrait.png",torso:{x:0,y:0,w:136,h:64},head:{x:664,y:288,w:72,h:88,offX:24,overlapY:0},centerX:48,centerY:55});sc.ABSTRACT_FACES.femaleAdvisor=b({src:"npc-portrait.png",torso:{x:0,y:128,w:104,h:56},head:{x:264,y:176,w:80,h:104,offX:8,overlapY:0},centerX:36,centerY:72});sc.ABSTRACT_FACES.maleAdvisor=
b({src:"npc-portrait.png",torso:{x:0,y:0,w:136,h:64},head:{x:192,y:176,w:72,h:104,offX:24,overlapY:0},centerX:43,centerY:67});sc.ABSTRACT_FACES.femaleAdventurerPonytail=b({src:"npc-portrait.png",torso:{x:0,y:128,w:104,h:56},head:{x:104,y:176,w:88,h:88,offX:8,overlapY:0},centerX:36,centerY:54});sc.ABSTRACT_FACES.femaleAdventurerPigtails=b({src:"npc-portrait.png",torso:{x:0,y:128,w:104,h:56},head:{x:664,y:104,w:96,h:88,offX:8,overlapY:0},centerX:36,centerY:54});sc.ABSTRACT_FACES.maleAdventurerSpikeHair=
b({src:"npc-portrait.png",torso:{x:0,y:0,w:136,h:64},head:{x:648,y:0,w:72,h:104,offX:24,overlapY:0},centerX:43,centerY:71});sc.ABSTRACT_FACES.maleAdventurerBald=b({src:"npc-portrait.png",torso:{x:0,y:0,w:136,h:64},head:{x:600,y:104,w:64,h:88,offX:32,overlapY:0},centerX:43,centerY:51});sc.ABSTRACT_FACES.femaleMiner=b({src:"npc-portrait.png",torso:{x:0,y:128,w:104,h:56},head:{x:520,y:96,w:80,h:96,offX:8,overlapY:0},centerX:36,centerY:68});sc.ABSTRACT_FACES.maleMiner=b({src:"npc-portrait.png",torso:{x:0,
y:64,w:136,h:64},head:{x:440,y:96,w:80,h:96,offX:24,overlapY:0},centerX:43,centerY:63});sc.ABSTRACT_FACES.femaleColonialShorthair=b({src:"npc-portrait.png",torso:{x:0,y:128,w:104,h:56},head:{x:344,y:176,w:80,h:96,offX:8,overlapY:0},centerX:40,centerY:59});sc.ABSTRACT_FACES.femaleColonialPigtails=b({src:"npc-portrait.png",torso:{x:0,y:128,w:104,h:56},head:{x:424,y:192,w:112,h:96,offX:0,overlapY:0},centerX:40,centerY:59});sc.ABSTRACT_FACES.maleColonialBlack=b({src:"npc-portrait.png",torso:{x:0,y:0,
w:136,h:64},head:{x:536,y:192,w:80,h:96,offX:24,overlapY:0},centerX:48,centerY:59});sc.ABSTRACT_FACES.maleColonialMonocle=b({src:"npc-portrait.png",torso:{x:0,y:0,w:136,h:64},head:{x:616,y:192,w:80,h:96,offX:24,overlapY:0},centerX:48,centerY:59});sc.ABSTRACT_FACES.maleGuard=b({src:"guards-portrait.png",torso:{x:0,y:0,w:136,h:72},head:{x:136,y:0,w:88,h:88,offX:16,overlapY:0},centerX:48,centerY:59});sc.ABSTRACT_FACES.femaleGuard=b({src:"guards-portrait.png",torso:{x:0,y:72,w:104,h:64},head:{x:224,y:0,
w:88,h:88,offX:8,overlapY:0},centerX:48,centerY:59});sc.ABSTRACT_FACES.maleGuardGlasses=b({src:"guards-portrait.png",torso:{x:0,y:0,w:136,h:72},head:{x:136,y:96,w:88,h:88,offX:16,overlapY:0},centerX:48,centerY:59});sc.ABSTRACT_FACES.femaleMonk=b({src:"npc-portrait.png",torso:{x:0,y:128,w:104,h:56},head:{x:440,y:288,w:72,h:88,offX:16,overlapY:0},centerX:34,centerY:58});sc.ABSTRACT_FACES.maleMonk=b({src:"npc-portrait.png",torso:{x:0,y:0,w:136,h:64},head:{x:376,y:88,w:64,h:88,offX:32,overlapY:0},centerX:43,
centerY:55});sc.ABSTRACT_FACES.maleBusinessHeatHeadscarf=b({src:"npc-portrait.png",torso:{x:0,y:0,w:136,h:64},head:{x:192,y:280,w:72,h:96,offX:20,overlapY:2},centerX:40,centerY:66});sc.ABSTRACT_FACES.femaleBusinessHeatHeadscarf=b({src:"npc-portrait.png",torso:{x:0,y:128,w:104,h:56},head:{x:264,y:280,w:80,h:96,offX:12,overlapY:2},centerX:40,centerY:66});sc.ABSTRACT_FACES.femaleGlassesCap=b({src:"npc-portrait.png",torso:{x:0,y:128,w:104,h:56},head:{x:584,y:288,w:80,h:88,offX:8,overlapY:0},centerX:28,
centerY:60});sc.ABSTRACT_FACES.tribladerMale=b({src:"avatars-new.png",torso:{x:0,y:0,w:152,h:80},head:{x:152,y:0,w:80,h:96,offX:32,overlapY:8},centerX:54,centerY:62});sc.ABSTRACT_FACES.tribladerFemale=b({src:"avatars-new.png",torso:{x:0,y:80,w:128,h:72},head:{x:152,y:96,w:80,h:88,offX:16,overlapY:8},centerX:38,centerY:54});sc.ABSTRACT_FACES.pentafistMale=b({src:"avatars-new.png",torso:{x:0,y:152,w:128,h:72},head:{x:232,y:0,w:96,h:88,offX:16,overlapY:0},centerX:42,centerY:60});sc.ABSTRACT_FACES.pentafistMaleRasta=
b({src:"avatars-new.png",torso:{x:0,y:152,w:128,h:72},head:{x:224,y:376,w:96,h:88,offX:24,overlapY:0},centerX:42,centerY:58});sc.ABSTRACT_FACES.pentafistFemale=b({src:"avatars-new.png",torso:{x:0,y:224,w:96,h:64},head:{x:232,y:88,w:96,h:88,offX:0,overlapY:0},centerX:30,centerY:56});sc.ABSTRACT_FACES.pentafistFemaleRasta=b({src:"avatars-new.png",torso:{x:0,y:224,w:96,h:64},head:{x:320,y:384,w:104,h:88,offX:-8,overlapY:0},centerX:28,centerY:56});sc.ABSTRACT_FACES.hexacastMale=b({src:"avatars-new.png",
torso:{x:0,y:288,w:136,h:72},head:{x:232,y:176,w:96,h:88,offX:16,overlapY:0},centerX:42,centerY:55});sc.ABSTRACT_FACES.hexacastMaleBlockhead=b({src:"avatars-new.png",torso:{x:0,y:288,w:136,h:72},head:{x:136,y:352,w:88,h:88,offX:24,overlapY:0},centerX:44,centerY:58});sc.ABSTRACT_FACES.hexacastFemale=b({src:"avatars-new.png",torso:{x:0,y:360,w:104,h:40},head:{x:328,y:0,w:104,h:112,offX:0,overlapY:0},centerX:26,centerY:56});sc.ABSTRACT_FACES.quadroguardMale=b({src:"avatars-new.png",torso:{x:0,y:536,
w:168,h:96},head:{x:152,y:184,w:80,h:80,offX:40,overlapY:8},centerX:60,centerY:48});sc.ABSTRACT_FACES.quadroguardMaleSpiky=b({src:"avatars-new.png",torso:{x:0,y:536,w:168,h:96},head:{x:152,y:264,w:80,h:88,offX:40,overlapY:8},centerX:60,centerY:58});sc.ABSTRACT_FACES.quadroguardFemale=b({src:"avatars-new.png",torso:{x:0,y:472,w:128,h:64},head:{x:328,y:216,w:96,h:80,offX:16,overlapY:0},centerX:42,centerY:46});sc.ABSTRACT_FACES.quadroguardFemalePony=b({src:"avatars-new.png",torso:{x:0,y:472,w:128,h:64},
head:{x:336,y:296,w:88,h:88,offX:24,overlapY:0},centerX:44,centerY:54});sc.ABSTRACT_FACES.spheromancerMale=b({src:"avatars-new.png",torso:{x:0,y:400,w:135,h:72},head:{x:328,y:112,w:96,h:104,offX:24,overlapY:0},centerX:50,centerY:66});sc.ABSTRACT_FACES.spheromancerFemale=b({src:"avatars-new.png",torso:{x:168,y:576,w:96,h:56},head:{x:232,y:264,w:88,h:112,offX:0,overlapY:0},centerX:30,centerY:66});sc.ABSTRACT_FACES.shadMale=b({src:"shad-portrait.png",torso:{x:0,y:0,w:120,h:72},head:{x:120,y:0,w:96,h:88,
offX:8,overlapY:0},centerX:43,centerY:55});sc.ABSTRACT_FACES.shadFemale=b({src:"shad-portrait.png",torso:{x:0,y:72,w:112,h:48},head:{x:216,y:0,w:80,h:96,offX:8,overlapY:0},centerX:43,centerY:55})});ig.baked=!0;
ig.module("game.feature.character.character").requires("game.feature.character.abstract-face").defines(function(){sc.Character=ig.JsonLoadable.extend({cacheType:"Character",data:null,name:null,faceImage:null,init:function(b){this.parent(b);this.name=b},getExpression:function(b){return this.data.face&&this.data.face.expressions[b]},onCacheCleared:function(){this.faceImage&&this.faceImage.decreaseRef()},getJsonPath:function(){return ig.root+this.path.toPath("data/characters/",".json")+ig.getCacheSuffix()},
onload:function(b){this.data=b;if(this.data.face){this.data.face.ABSTRACT&&(this.data.face=sc.ABSTRACT_FACES[this.data.face.ABSTRACT]);this.faceImage=new ig.Image("media/face/"+this.data.face.src)}},getExpressionImages:function(b){var a;if(this.data&&this.data.face&&this.data.face.expressions){var b=this.data.face.expressions[b],d=this.data.face.parts;if(b)for(var b=b.faces,c=b.length;c--;)for(var e=b[c].length;e--;){var f=b[c][e];if(f=d[e]&&d[e][f]&&d[e][f].img){a||(a={});a[f]||(a[f]=new ig.Image("media/face/"+
this.data.face.subImages[f]))}}}return a}});sc.CharacterExpression=ig.Cacheable.extend({cacheType:"CHAR_EXPRESSION",character:null,expression:null,expressionImages:null,init:function(b,a){this.parent();this.character=new sc.Character(b);this.expression=a;this.character.addLoadListener(this)},getCacheKey:function(b,a){return b+"|"+a},onCacheCleared:function(){this.character&&this.character.decreaseRef();if(this.expressionImages)for(var b in this.expressionImages)this.expressionImages[b].decreaseRef()},
onLoadableComplete:function(b){if(b)this.expressionImages=this.character.getExpressionImages(this.expression)},clone:function(){return new sc.CharacterExpression(this.character.name,this.expression)}})});ig.baked=!0;
ig.module("game.feature.character.char-templates").requires("impact.base.loader").defines(function(){ig.jsonTemplate.register("NPCBasic",{name:{jsonPARAM:"name","default":null},gender:{jsonPARAM:"gender","default":null},animSheet:{DOCTYPE:"MULTI_DIR_ANIMATION",namedSheets:{move:{src:{jsonPARAM:"img"},width:{jsonPARAM:"width","default":32},height:{jsonPARAM:"height","default":40},xCount:3,offX:{jsonPARAM:"x"},offY:{jsonPARAM:"y"}},sit:{jsonIF:"sitX",src:{jsonPARAM:"img"},width:32,height:40,xCount:1,
offX:{jsonPARAM:"sitX"},offY:{jsonPARAM:"sitY"}},sit2:{jsonIF:"sit2X",src:{jsonPARAM:"img"},width:32,height:40,xCount:1,offX:{jsonPARAM:"sit2X"},offY:{jsonPARAM:"sit2Y"}}},shapeType:"Y_FLAT",offset:{x:0,y:-2,z:0},SUB:[{sheet:"move",dirs:4,flipX:[0,0,0,1],tileOffsets:[0,3,6,3],SUB:[{name:"idle",time:1,repeat:false,frames:[1]},{name:"walk",time:0.133,repeat:true,frames:[0,1,2,1]}]},{jsonIF:"sitX",sheet:"sit",dirs:4,flipX:[0,0,0,1],tileOffsets:[0,1,2,1],SUB:[{name:"sit",time:1,repeat:false,frames:[0]}]},
{jsonIF:"sit2X",sheet:"sit2",dirs:4,flipX:[0,0,0,1],tileOffsets:[0,1,2,1],SUB:[{name:"sit2",time:1,repeat:false,frames:[0]}]}]},walkAnimSet:{normal:{idle:"idle",move:"walk"},sit:{jsonIF:"sitX",idle:"sit"},sit2:{jsonIF:"sit2X",idle:"sit2"}},walkAnims:"normal",configs:{normal:{relativeVel:0.5},sit:{jsonIF:"sitX",walkAnims:"sit",shadow:0},sitFloat:{jsonIF:"sitX",walkAnims:"sit",zGravityFactor:0,shadow:0},sit2:{jsonIF:"sit2X",walkAnims:"sit2",shadow:0},sit2Float:{jsonIF:"sit2X",walkAnims:"sit2",shadow:0,
zGravityFactor:0}},face:{ABSTRACT:{jsonPARAM:"face"}}});ig.jsonTemplate.register("NPCAvatarSimple",{name:{jsonPARAM:"name","default":null},realname:{jsonPARAM:"realname","default":null},gender:{jsonPARAM:"gender","default":null},animSheet:{DOCTYPE:"MULTI_DIR_ANIMATION",namedSheets:{move:{src:{jsonPARAM:"img"},width:32,height:40,xCount:3,offX:{jsonPARAM:"x"},offY:{jsonPARAM:"y"}},offline:{src:{jsonPARAM:"img"},width:32,height:40,xCount:3,offX:{jsonPARAM:"offlineX"},offY:{jsonPARAM:"offlineY"}},run:{jsonIF:"runSrc",
src:{jsonPARAM:"runSrc"},width:32,height:40,xCount:5,offX:{jsonPARAM:"runX"},offY:{jsonPARAM:"runY"}},sit:{jsonIF:"sitX",src:{jsonPARAM:"img"},width:32,height:40,xCount:1,offX:{jsonPARAM:"sitX"},offY:{jsonPARAM:"sitY"}}},shapeType:"Y_FLAT",offset:{x:0,y:-2,z:0},SUB:[{sheet:"move",dirs:4,flipX:[0,0,0,1],tileOffsets:[0,3,6,3],SUB:[{name:"idle",time:1,repeat:false,frames:[1]},{name:"walk",time:0.133,repeat:true,frames:[0,1,2,1]},{sheet:"offline",name:"offline",time:0.166,repeat:true,frames:[0,1,2]}]},
{jsonIF:"runSrc",sheet:"run",dirs:6,flipX:[0,0,0,1,1,1],tileOffsets:[0,5,10,10,5,0],SUB:[{name:"run",time:0.1,repeat:true,frames:[0,1,2,3]},{name:"jump",time:0.1,repeat:true,frames:[3]},{name:"fall",time:0.1,repeat:true,frames:[4]}]},{jsonIF:"sitX",sheet:"sit",dirs:4,flipX:[0,0,0,1],tileOffsets:[0,1,2,1],SUB:[{name:"sit",time:0.1,repeat:false,frames:[0]}]},{sheet:"move",dirs:2,flipX:[0,1],tileOffsets:[9,9],SUB:[{name:"ground",time:1,repeat:false,frames:[0],offset:{x:0,y:2,z:0}}]}]},walkAnimSet:{normal:{idle:"idle",
move:"walk",run:{jsonIF:"runSrc",jsonTHEN:"run"},jump:{jsonIF:"runSrc",jsonTHEN:"jump"},fall:{jsonIF:"runSrc",jsonTHEN:"fall"}},ground:{idle:"ground"},sit:{jsonIF:"sitX",idle:"sit"},offline:{idle:"offline"}},walkAnims:"normal",configs:{normal:{relativeVel:0.5},run:{jsonIF:"runSrc",relativeVel:1},ground:{walkAnims:"ground"},groundFloat:{walkAnims:"ground",zGravityFactor:0,shadow:0},sit:{jsonIF:"sitX",walkAnims:"sit"},sitFloat:{jsonIF:"sitX",walkAnims:"sit",zGravityFactor:0,shadow:0},offline:{walkAnims:"offline"}},
face:{ABSTRACT:{jsonPARAM:"face"}}})});ig.baked=!0;ig.module("game.feature.character.plug-in").requires("game.feature.character.character","game.feature.character.char-templates").defines(function(){});ig.baked=!0;
ig.module("game.feature.combat.combat").requires("impact.base.game","impact.feature.effect.effect-sheet","impact.feature.database.database","impact.feature.navigation.navigation","game.feature.model.game-model").defines(function(){sc.COMBATANT_PARTY={PLAYER:1,ENEMY:2,OTHER:3};sc.COMBATANT_MATERIAL={METAL:1,ORGANIC:2};sc.COMBAT_ENEMY_SORT_TYPE={ORDER:0,NAME:1,LEVEL:2,AREA:3};var b={};b[sc.ELEMENT.NEUTRAL]="neutral";b[sc.ELEMENT.HEAT]="heat";b[sc.ELEMENT.COLD]="cold";b[sc.ELEMENT.SHOCK]="shock";b[sc.ELEMENT.WAVE]=
"wave";sc.THROW_SOUND_CLASS={HEXACAST:"Hexa"};sc.ATTACK_FREQUENCY={SPAMM:{gap:0.25},OFTEN:{gap:0.5},NORMAL:{gap:1},SOMETIMES:{gap:2.5},RARE:{gap:5},VERY_RARE:{gap:10}};var a=[1,0.85,0.7],d=[],c;for(c in sc.ATTACK_FREQUENCY)d.push(c);sc.COMBAT_EVENT={DEFEATED:1};var e={};c=e[sc.ELEMENT.NEUTRAL]={};c[sc.ATTACK_TYPE.LIGHT]=[new ig.Sound("media/sound/battle/airon/ball-hit-light1.ogg",1,0.1,"hitLight"),new ig.Sound("media/sound/battle/airon/ball-hit-light2.ogg",1,0.1,"hitLight"),new ig.Sound("media/sound/battle/airon/ball-hit-light3.ogg",
1,0.1,"hitLight"),new ig.Sound("media/sound/battle/airon/ball-hit-light4.ogg",1,0.1,"hitLight")];c[sc.ATTACK_TYPE.MEDIUM]=[new ig.Sound("media/sound/battle/airon/ball-hit-medium1.ogg",1,0.1,"hitMedium"),new ig.Sound("media/sound/battle/airon/ball-hit-medium2.ogg",1,0.1,"hitMedium"),new ig.Sound("media/sound/battle/airon/ball-hit-medium3.ogg",1,0.1,"hitMedium"),new ig.Sound("media/sound/battle/airon/ball-hit-medium4.ogg",1,0.1,"hitMedium")];c[sc.ATTACK_TYPE.HEAVY]=[new ig.Sound("media/sound/battle/airon/ball-hit-hard1.ogg",
1,0.1,"hitHeavy"),new ig.Sound("media/sound/battle/airon/ball-hit-hard2.ogg",1,0.1,"hitHeavy"),new ig.Sound("media/sound/battle/airon/ball-hit-hard3.ogg",1,0.1,"hitHeavy"),new ig.Sound("media/sound/battle/airon/ball-hit-hard4.ogg",1,0.1,"hitHeavy")];c[sc.ATTACK_TYPE.MASSIVE]=[new ig.Sound("media/sound/battle/airon/ball-hit-hard3.ogg",1,0.1,"hitMassive"),new ig.Sound("media/sound/battle/airon/ball-hit-hard4.ogg",1,0.1,"hitMassive")];c=e[sc.ELEMENT.HEAT]={};c[sc.ATTACK_TYPE.LIGHT]=[new ig.Sound("media/sound/battle/airon/fire-hit-light1.ogg",
1,0.1,"hitLight"),new ig.Sound("media/sound/battle/airon/fire-hit-light2.ogg",1,0.1,"hitLight"),new ig.Sound("media/sound/battle/airon/fire-hit-light3.ogg",1,0.1,"hitLight"),new ig.Sound("media/sound/battle/airon/fire-hit-light4.ogg",1,0.1,"hitLight")];c[sc.ATTACK_TYPE.MEDIUM]=[new ig.Sound("media/sound/battle/airon/fire-hit-medium1.ogg",1,0.1,"hitMedium"),new ig.Sound("media/sound/battle/airon/fire-hit-medium2.ogg",1,0.1,"hitMedium"),new ig.Sound("media/sound/battle/airon/fire-hit-medium3.ogg",1,
0.1,"hitMedium"),new ig.Sound("media/sound/battle/airon/fire-hit-medium4.ogg",1,0.1,"hitMedium")];c[sc.ATTACK_TYPE.HEAVY]=[new ig.Sound("media/sound/battle/airon/fire-hit-hard1.ogg",1,0.1,"hitHeavy"),new ig.Sound("media/sound/battle/airon/fire-hit-hard2.ogg",1,0.1,"hitHeavy"),new ig.Sound("media/sound/battle/airon/fire-hit-hard3.ogg",1,0.1,"hitHeavy"),new ig.Sound("media/sound/battle/airon/fire-hit-hard4.ogg",1,0.1,"hitHeavy")];c[sc.ATTACK_TYPE.MASSIVE]=[new ig.Sound("media/sound/battle/airon/fire-hit-hard3.ogg",
1,0.1,"hitMassive"),new ig.Sound("media/sound/battle/airon/fire-hit-hard4.ogg",1,0.1,"hitMassive")];c=e[sc.ELEMENT.COLD]={};c[sc.ATTACK_TYPE.LIGHT]=[new ig.Sound("media/sound/battle/airon/cold/ball-hit-cold-light1.ogg",1,0.1,"hitLight"),new ig.Sound("media/sound/battle/airon/cold/ball-hit-cold-light2.ogg",1,0.1,"hitLight"),new ig.Sound("media/sound/battle/airon/cold/ball-hit-cold-light3.ogg",1,0.1,"hitLight"),new ig.Sound("media/sound/battle/airon/cold/ball-hit-cold-light4.ogg",1,0.1,"hitLight")];
c[sc.ATTACK_TYPE.MEDIUM]=[new ig.Sound("media/sound/battle/airon/cold/ball-hit-cold-medium1.ogg",1,0.1,"hitMedium"),new ig.Sound("media/sound/battle/airon/cold/ball-hit-cold-medium2.ogg",1,0.1,"hitMedium"),new ig.Sound("media/sound/battle/airon/cold/ball-hit-cold-medium3.ogg",1,0.1,"hitMedium"),new ig.Sound("media/sound/battle/airon/cold/ball-hit-cold-medium4.oggg",1,0.1,"hitMedium")];c[sc.ATTACK_TYPE.HEAVY]=[new ig.Sound("media/sound/battle/airon/cold/ball-hit-cold-hard1.ogg",1,0.1,"hitHeavy"),new ig.Sound("media/sound/battle/airon/cold/ball-hit-cold-hard2.ogg",
1,0.1,"hitHeavy"),new ig.Sound("media/sound/battle/airon/cold/ball-hit-cold-hard3.ogg",1,0.1,"hitHeavy"),new ig.Sound("media/sound/battle/airon/cold/ball-hit-cold-hard4.ogg",1,0.1,"hitHeavy")];c[sc.ATTACK_TYPE.MASSIVE]=[new ig.Sound("media/sound/battle/airon/cold/ball-hit-cold-hard3.ogg",1,0.1,"hitMassive"),new ig.Sound("media/sound/battle/airon/cold/ball-hit-cold-hard4.ogg",1,0.1,"hitMassive")];c=e[sc.ELEMENT.SHOCK]={};c[sc.ATTACK_TYPE.LIGHT]=[new ig.Sound("media/sound/battle/airon/shock/hit-shock-light1.ogg",
1,0.1,"hitLight"),new ig.Sound("media/sound/battle/airon/shock/hit-shock-light2.ogg",1,0.1,"hitLight"),new ig.Sound("media/sound/battle/airon/shock/hit-shock-light3.ogg",1,0.1,"hitLight"),new ig.Sound("media/sound/battle/airon/shock/hit-shock-light4.ogg",1,0.1,"hitLight")];c[sc.ATTACK_TYPE.MEDIUM]=[new ig.Sound("media/sound/battle/airon/shock/hit-shock-medium1.ogg",1,0.1,"hitMedium"),new ig.Sound("media/sound/battle/airon/shock/hit-shock-medium2.ogg",1,0.1,"hitMedium"),new ig.Sound("media/sound/battle/airon/shock/hit-shock-medium3.ogg",
1,0.1,"hitMedium"),new ig.Sound("media/sound/battle/airon/shock/hit-shock-medium4.oggg",1,0.1,"hitMedium")];c[sc.ATTACK_TYPE.HEAVY]=[new ig.Sound("media/sound/battle/airon/shock/hit-shock-hard1.ogg",1,0.1,"hitHeavy"),new ig.Sound("media/sound/battle/airon/shock/hit-shock-hard2.ogg",1,0.1,"hitHeavy"),new ig.Sound("media/sound/battle/airon/shock/hit-shock-hard3.ogg",1,0.1,"hitHeavy"),new ig.Sound("media/sound/battle/airon/shock/hit-shock-hard4.ogg",1,0.1,"hitHeavy")];c[sc.ATTACK_TYPE.MASSIVE]=[new ig.Sound("media/sound/battle/airon/shock/hit-shock-hard3.ogg",
1,0.1,"hitMassive"),new ig.Sound("media/sound/battle/airon/shock/hit-shock-hard4.ogg",1,0.1,"hitMassive")];c=e[sc.ELEMENT.WAVE]={};c[sc.ATTACK_TYPE.LIGHT]=[new ig.Sound("media/sound/battle/airon/wave/hit-wave-light1.ogg",1,0.1,"hitLight"),new ig.Sound("media/sound/battle/airon/wave/hit-wave-light2.ogg",1,0.1,"hitLight"),new ig.Sound("media/sound/battle/airon/wave/hit-wave-light3.ogg",1,0.1,"hitLight"),new ig.Sound("media/sound/battle/airon/wave/hit-wave-light4.ogg",1,0.1,"hitLight")];c[sc.ATTACK_TYPE.MEDIUM]=
[new ig.Sound("media/sound/battle/airon/wave/hit-wave-medium1.ogg",1,0.1,"hitMedium"),new ig.Sound("media/sound/battle/airon/wave/hit-wave-medium2.ogg",1,0.1,"hitMedium"),new ig.Sound("media/sound/battle/airon/wave/hit-wave-medium3.ogg",1,0.1,"hitMedium"),new ig.Sound("media/sound/battle/airon/wave/hit-wave-medium4.oggg",1,0.1,"hitMedium")];c[sc.ATTACK_TYPE.HEAVY]=[new ig.Sound("media/sound/battle/airon/wave/hit-wave-hard1.ogg",1,0.1,"hitHeavy"),new ig.Sound("media/sound/battle/airon/wave/hit-wave-hard2.ogg",
1,0.1,"hitHeavy"),new ig.Sound("media/sound/battle/airon/wave/hit-wave-hard3.ogg",1,0.1,"hitHeavy"),new ig.Sound("media/sound/battle/airon/wave/hit-wave-hard4.ogg",1,0.1,"hitHeavy")];c[sc.ATTACK_TYPE.MASSIVE]=[new ig.Sound("media/sound/battle/airon/wave/hit-wave-hard3.ogg",1,0.1,"hitMassive"),new ig.Sound("media/sound/battle/airon/wave/hit-wave-hard4.ogg",1,0.1,"hitMassive")];var f={ignore:new ig.Sound("media/sound/battle/ball-kill.ogg",0.8,0.1),shielded:new ig.Sound("media/sound/battle/hit-block.ogg",
0.8,0.05),perfectShielded:new ig.Sound("media/sound/battle/hit-counter-echo.ogg",1,0.05),neutralized:new ig.Sound("media/sound/battle/blubb-4.ogg",1,0.05)},g={};c=g[sc.COMBATANT_MATERIAL.METAL]={};c[sc.ATTACK_TYPE.LIGHT]=[new ig.Sound("media/sound/battle/airon/hit-metal-light-2.ogg",0.6,0.1,"hitMatLight"),new ig.Sound("media/sound/battle/airon/hit-metal-light-3.ogg",0.6,0.1,"hitMatLight")];c[sc.ATTACK_TYPE.MEDIUM]=[new ig.Sound("media/sound/battle/airon/hit-metal-medium-1.ogg",1,0.1,"hitMatMedium"),
new ig.Sound("media/sound/battle/airon/hit-metal-medium-2.ogg",1,0.1,"hitMatMedium"),new ig.Sound("media/sound/battle/airon/hit-metal-medium-3.ogg",1,0.1,"hitMatMedium"),new ig.Sound("media/sound/battle/airon/hit-metal-medium-4.ogg",1,0.1,"hitMatMedium")];c=g[sc.COMBATANT_MATERIAL.ORGANIC]={};c[sc.ATTACK_TYPE.LIGHT]=[new ig.Sound("media/sound/battle/airon/hit-organic-1.ogg",0.6,0.1,"hitMatLight"),new ig.Sound("media/sound/battle/airon/hit-organic-2.ogg",0.6,0.1,"hitMatLight"),new ig.Sound("media/sound/battle/airon/hit-organic-3.ogg",
0.6,0.1,"hitMatLight")];c[sc.ATTACK_TYPE.MEDIUM]=[new ig.Sound("media/sound/battle/airon/hit-organic-deep-1.ogg",0.8,0.1,"hitMatMedium"),new ig.Sound("media/sound/battle/airon/hit-organic-deep-2.ogg",0.8,0.1,"hitMatMedium"),new ig.Sound("media/sound/battle/airon/hit-organic-deep-3.ogg",0.8,0.1,"hitMatMedium")];sc.DRAMATIC_EFFECT={HP_BREAK_ZOOM:{timeFactor:0.1,wait:0.5,blurDuration:0.2,clearTime:0.2,zoom:1.5,camera:1,alwaysFocus:true,speedlines:true},LAST_ENEMY_ZOOM:{timeFactor:0.001,wait:0.5,blurDuration:0.2,
clearTime:0.2,zoom:1.5,camera:1,alwaysFocus:true,speedlines:true},BOSS_ZOOM:{timeFactor:0.001,wait:1,blurDuration:0.7,clearTime:1,zoom:1.5,camera:1,alwaysFocus:true,speedlines:true},BREAK_NONE:{timeFactor:0,wait:0,clearTime:0,zoom:0,label:"sc.gui.combat-msg.break","break":true,camera:2,blurDuration:0,blurType:"NONE"},BREAK_NO_TEXT:{timeFactor:0,wait:0,clearTime:0,"break":true,zoom:0,camera:2,blurDuration:0,blurType:"NONE"},BREAK_LIGHT:{timeFactor:0.001,wait:0.1,clearTime:0.1,zoom:1,label:"sc.gui.combat-msg.break",
"break":true,camera:2,blurDuration:0.1,blurType:"LIGHT",speedlines:true},BREAK:{timeFactor:0.001,wait:0.2,clearTime:0.1,zoom:1.25,label:"sc.gui.combat-msg.break","break":true,camera:2,blurDuration:0.1,blurType:"LIGHT",speedlines:true},BREAK_ALWAYS:{timeFactor:0.001,wait:0.2,clearTime:0.1,zoom:1.25,label:"sc.gui.combat-msg.break","break":true,camera:2,blurDuration:0.1,blurType:"LIGHT",alwaysFocus:true,speedlines:true},BREAK_BIG:{timeFactor:0.001,wait:0.4,clearTime:0.1,zoom:1.5,label:"sc.gui.combat-msg.break",
"break":true,camera:1,blurDuration:0.1,blurType:"LIGHT",alwaysFocus:true,speedlines:true},BREAK_WIDE:{timeFactor:0.001,wait:0.4,clearTime:0.1,zoom:1.25,label:"sc.gui.combat-msg.break","break":true,camera:1,blurDuration:0.1,blurType:"LIGHT",alwaysFocus:true,speedlines:true},BREAK_WIDE_NOSLOW:{timeFactor:1,wait:0.4,clearTime:0.1,zoom:1.25,label:"sc.gui.combat-msg.break","break":true,camera:1,blurDuration:0.1,blurType:"LIGHT",alwaysFocus:true,speedlines:true},OVERLOAD:{timeFactor:0.001,wait:1,clearTime:0.3,
zoom:1,camera:1,blurDuration:0.7,speedlines:true},GUARD_COUNTER:{timeFactor:0.001,wait:0.2,clearTime:0.1,zoom:1.25,label:"sc.gui.combat-msg.guard-counter",camera:2,blurDuration:0.1,blurType:"LIGHT",speedlines:true},GUARD_BREAK:{timeFactor:0.1,wait:0.4,label:"sc.gui.combat-msg.guard-break",clearTime:0.1,zoom:1,camera:1,blurDuration:0.3,blurType:"LIGHT",speedlines:true},RANK_UP:{timeFactor:1,wait:0.3,blurDuration:0.2,clearTime:0.2,blurType:"LIGHT"},S_RANK:{timeFactor:0.025,wait:0.2,earlyCameraOut:3,
cameraOutOverlap:1,clearTime:0.8,zoom:2,cameraBackTime:1,camera:1,blurDuration:0.2,speedlines:true,blurType:"LIGHTER"},PVP_KO:{timeFactor:0.001,wait:0.5,blurDuration:0.2,clearTime:0.2,zoom:1.5,camera:2,speedlines:true},PVP_FINAL_KO:{timeFactor:0.001,wait:1,blurDuration:0.7,clearTime:1,zoom:1.5,camera:2,speedlines:true},ARENA_FINAL_KO:{timeFactor:0.001,wait:1,blurDuration:0.7,clearTime:1,zoom:1.5,camera:1,arena:true,speedlines:true},ONCE_MORE:{timeFactor:0.001,wait:0.6,label:"sc.gui.combat-msg.once-more",
clearTime:0.3,zoom:1,camera:1,blurDuration:0.4,speedlines:true},ELEMENT_SHIELD:{timeFactor:0.001,wait:0.2,clearTime:0.1,zoom:1.125,camera:1,blurDuration:0.1,blurType:"LIGHT"},PERFECT_DASH:{timeFactor:0.1,wait:0.2,clearTime:0.1,zoom:1.125,camera:1,blurDuration:0.1,blurType:"LIGHT"}};sc.COMBAT_MSG_TYPE={STUN_CANCEL:{icon:"\\i[stun-cancel]",msg:"sc.gui.combat.stun",keepPos:true,duration:1}};sc.MIN_KILLS=10;var h=Vec2.create(),i=Vec2.create(),j=Vec2.create(),k=Vec2.create(),l=Vec2.create(),o=Vec2.create(),
m=Vec3.create(),n=Vec2.create(),p={damagingEntity:null,attackInfo:null};sc.Combat=ig.GameAddon.extend({listeners:[],actionToken:{},freeLineCommands:[],activeCombatants:{},forces:[],active:true,time:0,speed:1,recentlyAttacked:[],playerStartedCombat:false,collabs:[],hideDamageNumbers:false,effects:{hit:new ig.EffectSheet("default-hit"),guard:new ig.EffectSheet("guard"),combat:new ig.EffectSheet("combat"),combatant:new ig.EffectSheet("combatant"),"throw":new ig.EffectSheet("throw"),mode:new ig.EffectSheet("combat.mode"),
heal:new ig.EffectSheet("drops"),cooldownHandle:null},cooldownTick:{sounds:[{below:0.6,sound:new ig.Sound("media/sound/battle/rank-timeout-01.ogg",1)},{below:0.2,sound:new ig.Sound("media/sound/battle/rank-timeout-02.ogg",1)}],hasCooldown:false,currentSound:-1,endSound:new ig.Sound("media/sound/battle/rank-timeout-03.ogg",1),handle:null},stats:{killStreak:0,killedEnemies:[],prevRank:0},finalDramaticEffect:null,respawnBlocker:[],enemyDataList:null,init:function(){this.parent("Combat");sc.Model.addObserver(sc.model,
this);this.activeCombatants[sc.COMBATANT_PARTY.PLAYER]=[];this.activeCombatants[sc.COMBATANT_PARTY.ENEMY]=[];this.activeCombatants[sc.COMBATANT_PARTY.OTHER]=[];window.wm&&ig.database.register("enemies","EnemyEnumEditor","Enemies");this.enemyDataList=ig.database.get("enemies");for(var a in this.enemyDataList)if(this.enemyDataList[a].track)for(var b=this.enemyDataList[a].descriptions,c=b.length;c--;)if(b[c].condition){var d=new ig.VarCondition(b[c].condition);b[c].condObj=d}ig.vars.registerVarAccessor("combat",
this,"VarCombatEditor")},_unlockAllEnemies:function(){for(var a in this.enemyDataList)this.enemyDataList[a].track&&sc.stats.setMap("combat","kill"+a,999)},setCombatSpeed:function(a){this.speed=a},getTotalEnemiesFound:function(a,b){var c=0,d=0,e;for(e in this.enemyDataList){var f=this.enemyDataList[e];if(f.track&&!f.extension)if(b){if(f.category==b){(sc.stats.getMap("combat","kill"+e)>=1||sc.stats.getMap("combat","kill"+e)<=-1)&&c++;d++}}else{(sc.stats.getMap("combat","kill"+e)>=1||sc.stats.getMap("combat",
"kill"+e)<=-1)&&c++;d++}}return a?c/d:c},getTotalEnemyReportsFound:function(a,b,c){var d=0,e=0,f=this.enemyDataList,g=0,h=0,i;for(i in f)if(f[i].track&&!f[i].extension&&!(b&&f[i].category!=b)){if(c){(sc.stats.getMap("combat","kill"+i)>=1||sc.stats.getMap("combat","kill"+i)<=-1)&&g++;h++}var j=f[i].boss?1:f[i].kills||sc.MIN_KILLS;(sc.stats.getMap("combat","kill"+i)<=-1||sc.stats.getMap("combat","kill"+i)>=j)&&d++;e++}if(c){c.enemies=g/h;c.reports=d/e}else return a?d/e:d},getEnemyMenuOffset:function(a){return!this.enemyDataList[a]?
null:this.enemyDataList[a].offset||null},isEnemyAnalyzable:function(a){return!a||!this.enemyDataList[a]?false:!this.enemyDataList[a].disableAnalyze},addActiveCombatant:function(a){if(this.activeCombatants[a.party].indexOf(a)!=-1)throw Error("Tried to add same combatant as active twice!");this.activeCombatants[a.party].push(a);if(a.party==sc.COMBATANT_PARTY.ENEMY&&a.aggression==sc.ENEMY_AGGRESSION.THREAT){this.recentlyAttacked.push(a);a.boosterState==sc.ENEMY_BOOSTER_STATE.BOOSTED&&this.effects.combatant.spawnOnTarget("boosted",
a,{align:"CENTER",group:"_boostedFX",duration:-1})}},removeActiveCombatant:function(a){this.activeCombatants[a.party].erase(a);ig.EffectTools.clearEffects(a,"_boostedFX")},changeCombatantParty:function(a,b){a.target&&this.removeActiveCombatant(a);a.party=b;a.target&&this.addActiveCombatant(a)},areSpawnersCleared:function(){for(var a=ig.game.getEntitiesByType(ig.ENTITY.EnemySpawner),b=a.length;b--;)if(!a[b].isCleared())return false;return true},getActiveCombatantCount:function(a,b){if(a==sc.COMBATANT_PARTY.PLAYER)return sc.party.getStrategy("BEHAVIOUR").onlyTargetPlayer?
1:1+sc.party.getPartySizeAlive(true);for(var c=this.activeCombatants[a],d=0,e=c.length;e--;)b&&c[e].enemyName!=b||c[e].aggression!=sc.ENEMY_AGGRESSION.PEACEFUL&&d++;return d},getActiveCombatants:function(a,b){for(var c=ig.copy(this.activeCombatants[a]),d=c.length;d--;)c[d].isDefeated()?c.splice(d,1):b&&(!c[d].isPlayer&&!ig.EntityTools.isInScreen(c[d],32))&&c.splice(d,1);return c},isDamageIgnore:function(){return sc.model.isCutscene()||sc.model.isTeleport()||ig.game.events.getBlockingEventCall()},
getEnemyTarget:function(){if(sc.party.getStrategy("BEHAVIOUR").onlyTargetPlayer)return ig.game.playerEntity;for(var a=[ig.game.playerEntity],b=0;b<sc.party.currentParty.length;++b)this._addPartyMember(a,sc.party.getPartyMemberEntityByIndex(b),sc.party.ai.targeting>0);if(sc.party.ai.targeting>0&&a.length>1&&Math.random()<sc.party.ai.targeting)a.splice(0,1);else if(sc.party.ai.targeting<0&&a.length>1&&Math.random()<-sc.party.ai.targeting)a.length=1;return a[Math.floor(Math.random()*a.length)]},_addPartyMember:function(a,
b,c){b&&(c||ig.EntityTools.isInScreen(b,32))&&a.push(b)},getPlayerTarget:function(a){var b=ig.game.playerEntity.combatStats.lastTarget,c=sc.party.getStrategy("TARGET");if(c.same&&b&&!b.isDefeated()&&!b._killed)return b;for(var d=this.getActiveCombatants(sc.COMBATANT_PARTY.ENEMY,true),e=d.length;e--;)if(ig.navigation.isPathAvailable(a,d[e])){if(sc.EnemyAnno.doesRandomlyUnderstand(d[e],a)){if(sc.EnemyAnno.isVulnerable(d[e])||sc.EnemyAnno.isWeak(d[e]))return d[e];sc.EnemyAnno.isImmune(d[e])&&d.length>
1&&d.splice(e,1)}}else d.splice(e,1);b&&(d.length>1&&!c.same)&&d.erase(b);return d[Math.floor(Math.random()*d.length)]},getActiveEnemiesNames:function(){for(var a=[],b=this.activeCombatants[sc.COMBATANT_PARTY.ENEMY],c=b.length;c--;)a.indexOf(b[c].enemyName)==-1&&a.push(b[c].enemyName);return a},getEnemyName:function(a){return this.enemyDataList[a]?ig.LangLabel.getText(this.enemyDataList[a].name):"\\c[1]ERROR\\c[0]"},getEnemyCategory:function(a){return this.enemyDataList[a]?sc.ENEMY_CATEGORY[this.enemyDataList[a].category||
"ANIMALS"]:sc.ENEMY_CATEGORY.ANIMALS},canShowBoosted:function(a){return!a.boss&&sc.stats.getMap("combat","kill"+a.path)>0&&this.getEnemyCategory(a.path)!=sc.ENEMY_CATEGORY.PLAYERS},canShowBoostedEntry:function(a,b){return!b&&sc.stats.getMap("combat","kill"+a)>0&&this.getEnemyCategory(a)!=sc.ENEMY_CATEGORY.PLAYERS},getEnemyLevel:function(a){return this.enemyDataList[a]?this.enemyDataList[a].level:1},getEnemyArea:function(a){return this.enemyDataList[a]?sc.map.getAreaName(this.enemyDataList[a].area,
true):"\\c[1]ERROR\\c[0]"},getEnemyDrops:function(a){return this.enemyDataList[a]?this.enemyDataList[a].itemDrops:"\\c[1]ERROR\\c[0]"},setScreenEnemiesTarget:function(a){for(var b=ig.game.shownEntities,c=b.length;c--;){var d=b[c];d instanceof ig.ENTITY.Enemy&&ig.EntityTools.isInScreen(d,0)&&d.setTarget(a,true)}},removeEnemies:function(a,b,c,d){for(var e=ig.game.shownEntities,f=e.length;f--;){var g=e[f];g instanceof ig.ENTITY.Enemy&&!g.isDefeated()&&(g!=b&&!(a&&g.enemyName!=a))&&g.instantDefeat(c,
d)}},setFinalDramaticEffect:function(a){this.finalDramaticEffect=a},onCombatantDeathHit:function(a,b){var c=sc.pvp.onPvpCombatantDefeat(b);c&&a&&this.doDramaticEffect(a,b,c,true);if(b.isPlayer&&!b.manualKill&&!sc.pvp.isActive()){c=ig.vars.get("stats.deaths")||0;ig.game.respawn();ig.vars.set("stats.deaths",c+1)}else if(b.party==sc.COMBATANT_PARTY.ENEMY){c=false;sc.arena.onCombatantDeathHit(a,b);if(this.finalDramaticEffect){for(var d=this.activeCombatants[b.party],e=0,f=d.length;f--;){var g=d[f];(!g.params||
!g.params.isDefeated())&&e++}if(e==0){if(!c&&a){this.doDramaticEffect(a||b,b,this.finalDramaticEffect,true);c=true}if(this.finalDramaticEffect.arena)sc.arena.onFinalDeathHit();this.finalDramaticEffect=null}}e=sc.model.increaseCombatRank(1*b.enemyType.enduranceScale);d=b.getAlignedPos(ig.ENTITY_ALIGN.CENTER,m);if(e){if(sc.model.isSRank()&&sc.options.get("s-rank-effects")){c=this.effects.combat.spawnFixed("rankS",d.x,d.y,d.z);c.setIgnoreSlowdown();this.doDramaticEffect(a,b,sc.DRAMATIC_EFFECT.S_RANK,
true)}else{e="rank"+sc.model.getCombatRankLabel();this.effects.combat.spawnFixed(e,d.x,d.y,d.z);c||this.doDramaticEffect(a||b,b,sc.DRAMATIC_EFFECT.RANK_UP)}c=ig.lang.get("sc.gui.combat-msg.rank-up")+" "+sc.model.getCombatRankLabel();c=new sc.SmallEntityBox(b,c,2);ig.gui.addGuiElement(c)}else if(sc.model.isSRank()&&sc.options.get("s-rank-effects")){c=this.effects.combat.spawnFixed("sRankKill",d.x,d.y,d.z);c.setIgnoreSlowdown()}}},showCombatantLabel:function(a,b,c){var d=sc.SMALL_BOX_ALIGN.TOP,e=-10;
if(a.dmgZFocus){d=sc.SMALL_BOX_ALIGN.BOTTOM;e=a.dmgZFocus}else if(a.cameraZFocus){d=sc.SMALL_BOX_ALIGN.BOTTOM;e=a.cameraZFocus+48}a=new sc.SmallEntityBox(a,b,c||1,d,e);ig.gui.addGuiElement(a)},showCombatMessage:function(a,b){var c=b.icon+ig.lang.get(b.msg),c=new sc.SmallEntityBox(a,c,b.duration||0.5,sc.SMALL_BOX_ALIGN.CENTER);b.keepPos&&c.setFixedPos();ig.gui.addGuiElement(c)},hasCollabs:function(){return this.collabs.length>0},doDramaticEffect:function(a,b,c,d){if(c.label){var e=ig.lang.get(c.label);
this.showCombatantLabel(b,e)}a||(a=b);b||(b=a);e=[];d=d||a.isPlayer||c.alwaysFocus;c.speedlines&&sc.options.get("speedlines")&&e.push({type:"SHOW_EFFECT",entity:b,align:"CENTER",effect:{sheet:"speedlines",name:"speedlinesDramatic"},duration:c.wait+(c.earlyCameraOut||0)-(c.cameraOutOverlap||0)+0.05,ignoreSlowMo:true});if(d){e.push({type:"ADD_SLOW_MOTION",name:"levelUp",factor:c.timeFactor,time:c.timeFadeIn||0});c.camera==1&&e.push({type:"SET_CAMERA_TARGET",entity:b,speed:0.1,transition:"EASE_OUT",
zoom:c.zoom||1});c.camera==2&&e.push({type:"SET_CAMERA_BETWEEN",entity1:a,entity2:b,speed:0.1,transition:"EASE_OUT",zoom:c.zoom||1})}c.blurDuration&&e.push({type:"SET_ZOOM_BLUR",zoomType:c.blurType||"MEDIUM",fadeIn:0.1,duration:c.blurDuration,fadeOut:0.2,target:b});e.push({type:"WAIT",time:c.wait,ignoreSlowDown:true});if(c.earlyCameraOut&&c.camera){e.push({type:"SET_CAMERA_ZOOM",zoom:1,duration:c.earlyCameraOut,transition:"EASE_IN_OUT"});e.push({type:"WAIT",time:c.earlyCameraOut-c.cameraOutOverlap,
ignoreSlowDown:true})}if(d){e.push({type:"CLEAR_SLOW_MOTION",name:"levelUp",time:c.clearTime});c.camera&&e.push({type:"UNDO_CAMERA",speed:c.cameraBackTime||1,transition:"EASE_IN_OUT",wait:true})}a=new ig.Event({steps:e});ig.game.events.callEvent(a,ig.EventRunType.INTERRUPTABLE)},sendEnemyMessage:function(a,b){this.sendGlobalEnemyEvent(a,sc.COMBAT_ENEMY_EVENT.ENEMY_MSG,{key:b})},sendGlobalEnemyEvent:function(a,b,c){for(var d=ig.game.shownEntities,e=d.length;e--;){var f=d[e];if(f instanceof ig.ENTITY.Enemy&&
!f.isDefeated()&&f.onEnemyEvent)f.onEnemyEvent(a,b,c)}},postUpdateOrder:500,onPostUpdate:function(){if(!ig.loading&&!ig.game.paused){if(this.active)this.time=this.time+ig.system.tick;if(this.recentlyAttacked.length>0){for(var a=0,b=[],c=this.recentlyAttacked.length;c--;){var d=this.recentlyAttacked[c],a=Math.max(a,d.enemyType.level);b.indexOf(d.enemyName)==-1&&b.push(d.enemyName)}c=this.activeCombatants[sc.COMBATANT_PARTY.ENEMY].length<=this.recentlyAttacked.length;!sc.model.isForceCombat()&&!sc.arena.active&&
sc.commonEvents.triggerEvent("ENEMY_ATTACKS",{enemies:b,levelGap:a-sc.model.player.level,playerStarted:this.playerStartedCombat,battleStarted:c});this.recentlyAttacked.length=0;this.playerStartedCombat=false}for(c=this.forces.length;c--;){a=this.forces[c];(b=a.combatantRoot)&&ig.vars.pushEntityAccessor(b);if(!a.combatantRoot||a.update()){if(a.onEnd)a.onEnd();a.onActionEndDetach();this.forces.splice(c,1)}b&&ig.vars.popEntityAccessor(b)}for(var e in this.actionToken){this.actionToken[e]=this.actionToken[e]-
ig.system.tick;this.actionToken[e]<=0&&delete this.actionToken[e]}for(c=this.freeLineCommands.length;c--;){e=this.freeLineCommands[c];e.time=e.time-ig.system.tick;(e.time<=0||e.entity.hasStun())&&this.freeLineCommands.splice(c,1)}e=-1;if(sc.model.isCombatCooldown()&&sc.options.get("s-rank-effects")){this.cooldownTick.hasCooldown=true;a=sc.model.getCombatCooldownFactor();for(c=this.cooldownTick.sounds.length;c--;)if(a<this.cooldownTick.sounds[c].below){e=c;break}}if(e!==this.cooldownTick.currentSound){this.cooldownTick.currentSound=
e;if(this.cooldownTick.handle){this.cooldownTick.handle.stop();this.cooldownTick.handle=null}if(e!==-1){c=this.cooldownTick.sounds[e];this.cooldownTick.handle=c.sound.play(true,{speed:c.speed})}}}},onReset:function(){this.stats.killStreak=0;this.stats.killedEnemies.length=0;this.respawnBlocker.length=0;this.recentlyAttacked.length=0;this.finalDramaticEffect=null},onLevelLoadStart:function(){this.respawnBlocker.length=0;this.finalDramaticEffect=null;this.hideDamageNumbers=false},onVarAccess:function(a,
b){if(b[0]=="combat"){var c=b.slice(2).join("."),c=c?c.replace(/\//g,"."):null;switch(b[1]){case "name":return this.getEnemyName(c);case "activeCnt":return this.getActiveCombatantCount(sc.COMBATANT_PARTY.ENEMY,c);case "spawnersCleared":return this.areSpawnersCleared();case "active":return sc.model.isCombatActive();case "enemiesFound":return this.getTotalEnemiesFound(true);case "enemyReportsFound":return this.getTotalEnemyReportsFound(true)}}throw Error("Unsupported var access path: "+a);},modelChanged:function(a,
b,c){if(a instanceof sc.GameModel)if(b==sc.GAME_MODEL_MSG.STATE_CHANGED)this.setActive(!a.isCutscene());else if(b==sc.GAME_MODEL_MSG.COMBAT_MODE_CHANGED)if(c!=void 0)if(c){this.stats.killStreak=0;this.stats.killedEnemies.length=0;this.stats.prevRank=sc.model.getCombatRank()}else{if(this.cooldownTick.hasCooldown){this.cooldownTick.hasCooldown=false;this.cooldownTick.handle&&this.cooldownTick.handle.stop();this.cooldownTick.currentSound=-1;!ig.game.isReset&&sc.options.get("s-rank-effects")&&this.cooldownTick.endSound.play()}sc.arena.active||
sc.commonEvents.triggerEvent("BATTLE_OVER",{enemies:this.stats.killedEnemies,killCount:this.stats.killStreak,rank:this.stats.prevRank});sc.stats.setMapMax("combat","streakKilled",this.stats.killStreak)}else if(sc.model.isCombatCooldown()){sc.arena.active||sc.commonEvents.triggerEvent("COOLDOWN_START",{enemies:this.stats.killedEnemies,killCount:this.stats.killStreak,rank:sc.model.getCombatRank(),prevRank:this.stats.prevRank});this.stats.killedEnemies.length=0;this.stats.prevRank=sc.model.getCombatRank()}},
addCombatForce:function(a){this.forces.push(a)},setActive:function(a){this.active=a},forceEnd:function(){for(var a=this.activeCombatants[sc.COMBATANT_PARTY.ENEMY],b=a.length;b--;)a[b].setTarget(null);sc.model.cancelCombatCooldown()},addCombatListener:function(a){this.listeners.push(a)},removeCombatListener:function(a){this.listeners.erase(a)},gatherCollaborators:function(a,b,c,d,e,f){for(var g=this.activeCombatants[sc.COMBATANT_PARTY.ENEMY],h=g.length,e=e||d,i=0;h--;){var j=g[h];if(f||!j.hasStun())if(!j.params||
!j.params.defeated){j.params&&j.params.isLocked()&&j.params.clearLock();if(!j.collaboration&&j.collabReady(b)&&a.addParticipant(j,b,c)){i++;if(i==e)return true}}}return i>=d},getNearbyThreat:function(a,b,c,d){for(var e=a.coll.pos,f=a.coll.size,b=ig.game.getEntitiesInRectangle(e.x-b,e.y-b,e.z,f.x+2*b,f.y+2*b,f.z+b,a),e=b.length;e--;){f=b[e];if(f.getCombatant){var g=f.getCombatant();if(g&&g.party!=a.party){g=f.getAttackInfo&&f.getAttackInfo();if(!g&&(!f.isThreat||Vec2.isZero(f.coll.vel)))if(!(a instanceof
sc.PartyMemberEntity)||!(f instanceof ig.ENTITY.Enemy)||!sc.EnemyAnno.needDodge(f,a))continue;if(!g||!g.hasNoEffect()){var h=null;if(g){p.damagingEntity=f;p.attackInfo=g;h=p}if(!d||d.check(a,Math.random(),h)){g=ig.CollTools.getDistVec2(a.coll,f.coll,k);if(!(Vec2.angle(g,a.face)>Math.PI*c)){Vec2.flip(g);if(Vec2.angle(g,f.coll.vel)<Math.PI/2)return f}}}}}}return null},getPartyHpFactor:function(a){return a==sc.COMBATANT_PARTY.PLAYER?ig.game.playerEntity.params.getHpFactor():0},getAssistDamageFactor:function(){return sc.options.get("assist-damage")},
getAssistAttackFrequency:function(){var a=sc.options.get("assist-attack-frequency");sc.newgame.hasHarderEnemies()&&(a=a*1.5);return a},notifyCombatantDefeated:function(a,b,c){if(!a.defeatNotified){a.defeatNotified=true;a.onDefeat(b);if(c)sc.arena.onCombatantDeathHit(a,a);this.stats.killStreak++;if(a.enemyName){sc.stats.addMap("combat","totalKilled",1);b=sc.stats.getMap("combat","kill"+a.enemyName)||0;b=Math.max(1,b+1);sc.stats.setMap("combat","kill"+a.enemyName,b);a.enemyType.aiGroup&&sc.stats.addMap("combat",
"aiGroupKill"+a.enemyType.aiGroup,1);a.boosterState&&a.boosterState==sc.ENEMY_BOOSTER_STATE.BOOSTED&&sc.stats.addMap("combat","boostedKills",1);this.stats.killedEnemies.indexOf(a.enemyName)==-1&&this.stats.killedEnemies.push(a.enemyName);sc.commonEvents.triggerEvent("ENEMY_DEFEATED",{enemy:a.enemyName})}for(b=0;b<this.listeners.length;++b){var d=this.listeners[b].onCombatEvent(a,sc.COMBAT_EVENT.DEFEATED);if(d){var c=a,e=c.getCenter(h);ig.game.spawnEntity("CombatantMarble",e.x,e.y,c.coll.pos.z,{target:d})}}}},
updateCombatCompletionData:function(){var a={enemies:0,reports:0};this.getTotalEnemyReportsFound(true,null,a);sc.stats.setMap("combat","enemyCompletionRate",a.enemies);sc.stats.setMap("combat","enemyReportsCompletionRate",a.reports)},getMultiToken:function(a,b){for(var c=a.length;c--;)if(this.actionToken[a[c]])return false;for(c=a.length;c--;)this.actionToken[a[c]]=b[c]||0;return true},getActionToken:function(a,b){if(this.actionToken[a])return false;this.actionToken[a]=b;return true},getGlobalDmgFactor:function(a){var b=
1,b=a==sc.COMBATANT_PARTY.PLAYER?b*sc.party.getDmgFactor():b*this.getAssistDamageFactor();return b=b*sc.pvp.getDmgFactor()},initFrequencyTimers:function(a){for(var b=this.getActiveCombatantCount(a.party),c=this.getActiveCombatantCount(sc.COMBATANT_PARTY.PLAYER),b=this._getTimerFrequencyFactor(a,b,c),c=d.length;c--;){var e=d[c];a.stateTimers["_freq"+e]=sc.ATTACK_FREQUENCY[e].gap*b*(0.05+Math.random()*0.4)}},checkFrequency:function(a,b){for(var c=d.indexOf(b)+1;c--;){var e="_freq"+d[c];if(this.actionToken[e]||
a.stateTimers[e]>0)return false}return true},submitFrequency:function(a,b,c){var e=this.getActiveCombatantCount(a.party),f=this.getActiveCombatantCount(sc.COMBATANT_PARTY.PLAYER);if(e){var g=this._getTimerFrequencyFactor(a,e,f),e=this._getTokenFrequencyFactor(a,e,f);a.nextTimerChange={};b=d.indexOf(b)+1;for(f=1;b--;){var h=d[b],i=sc.ATTACK_FREQUENCY[h],h="_freq"+h;a.nextTimerChange[h]=Math.max(a.nextTimerChange[h]||0,i.gap*g*(0.8+Math.random()*0.4)*f);c||(this.actionToken[h]=Math.max(this.actionToken[h]||
0,i.gap*e*(0.8+Math.random()*0.4)*f));f=0.5}}},_getTimerFrequencyFactor:function(b,c,d){d=d.limit(1,3);return Math.pow(c,0.75)*2*a[d-1]/(this.speed*this.getAssistAttackFrequency())},_getTokenFrequencyFactor:function(b,c,d){d=d.limit(1,3);return Math.pow(1/c,0.25)*2*a[d-1]/(this.speed*this.getAssistAttackFrequency())},addFreeLineCommand:function(a,b){this.freeLineCommands.push({entity:a,time:b})},isBlockingFreeLine:function(a){for(var b=a.getCenter(h),c=0;c<this.freeLineCommands.length;++c){var d=
this.freeLineCommands[c],e=d.entity.getTarget();if(e){var f=d.entity.coll.size.x+a.coll.size.x,d=d.entity.getCenter(i),e=e.getCenter(j),e=Vec2.sub(e,d,k),g=Vec2.length(e);Vec2.normalize(e);var d=Vec2.sub(b,d,l),m=Vec2.dot(d,e);if(m<0||m>g)continue;e=Vec2.rotate90CCW(e,o);d=Vec2.dot(d,e);if(Math.abs(d)>f*1.5)continue;return d>0?e:Vec2.flip(e)}return false}},showHitEffect:function(a,b,c,d,i,j,k,m){var l="";switch(c){case sc.ATTACK_TYPE.NONE:l="none";break;case sc.ATTACK_TYPE.LIGHT:l="light";break;case sc.ATTACK_TYPE.MEDIUM:l=
"medium";break;case sc.ATTACK_TYPE.HEAVY:l="heavy";break;case sc.ATTACK_TYPE.MASSIVE:l="massive";break;case sc.ATTACK_TYPE.BREAK:l="massive"}var w="";switch(d){case sc.ELEMENT.HEAT:w="Heat";break;case sc.ELEMENT.COLD:w="Cold";break;case sc.ELEMENT.SHOCK:w="Shock";break;case sc.ELEMENT.WAVE:w="Wave"}if(j){j=this.effects.hit.spawnFixed("critical",b.x,b.y,b.z,a,{angle:Math.PI*2*Math.random(),spriteFilter:m});j.setIgnoreSlowdown()}if(i==sc.SHIELD_RESULT.PERFECT){j=ig.getRoundedFaceDir(a.face.x,a.face.y,
8,n);j=this.effects.guard.spawnOnTarget("perfectGuard",a,{align:"CENTER",angle:Vec2.clockangle(j),spriteFilter:m});j.setIgnoreSlowdown()}j=this.effects.hit.spawnFixed(l+w,b.x,b.y,b.z,a,{angle:Math.PI*2*Math.random(),spriteFilter:m});j.setIgnoreSlowdown();if(!k){Vec2.assignC(h,b.x,b.y-b.z);if(i==sc.SHIELD_RESULT.NEUTRALIZE)b=f.neutralized;else if(i&&c!=sc.ATTACK_TYPE.BREAK)b=i==sc.SHIELD_RESULT.PERFECT?f.perfectShielded:f.shielded;else if(c==sc.ATTACK_TYPE.NONE)b=f.ignore;else{b=e[d]||e[sc.ELEMENT.NEUTRAL];
b=b[c]||b[sc.ATTACK_TYPE.MASSIVE];d=Math.floor(Math.random()*b.length);b=b[d]}(j=b.play())&&j.setFixPosition(h);if(!i&&a&&c!=sc.ATTACK_TYPE.NONE){a=g[a.material]||g[sc.COMBATANT_MATERIAL.METAL];c=a[c]||a[sc.ATTACK_TYPE.MEDIUM];a=Math.floor(Math.random()*c.length);b=c[a];(j=b.play())&&j.setFixPosition(h)}}return j},showPerfectDashEffect:function(a){var b=ig.getRoundedFaceDir(a.face.x,a.face.y,8,n);this.effects.guard.spawnOnTarget("perfectDash",a,{align:"CENTER",angle:Vec2.clockangle(b)}).setIgnoreSlowdown();
this.doDramaticEffect(a,a,sc.DRAMATIC_EFFECT.PERFECT_DASH,false)},showHealEffect:function(a){this.effects.heal.spawnOnTarget("healing",a)},showCharge:function(a,c,d){c="chargeLevel"+c;d&&(c=c+b[d]);return this.effects.combat.spawnOnTarget(c,a,{duration:-1,align:ig.ENTITY_ALIGN.CENTER})},showThrowEffect:function(a,c,d,e){c=b[c];d&&(c=c+"Charged");e&&(c=c+e);return this.effects.throw.spawnOnTarget(c,a,{duration:0,align:ig.ENTITY_ALIGN.FACE})},showModeChange:function(a,c){var d=b[c];ig.EffectTools.clearEffects(a,
"modeChange");return this.effects.mode.spawnOnTarget(d,a,{duration:0,align:ig.ENTITY_ALIGN.BOTTOM,group:"modeChange",offset:{x:0,y:0,z:16}})},showModeAura:function(a,c){var d=b[c]+"Aura",e=ig.EffectTools.getFirstEffect(a,"modeAura");if(!(e&&e.effect.id=="combat.mode/"+d)){ig.EffectTools.clearEffects(a,"modeAura");c!=sc.ELEMENT.NEUTRAL&&this.effects.mode.spawnOnTarget(d,a,{duration:-1,align:ig.ENTITY_ALIGN.BOTTOM,group:"modeAura",offset:{x:0,y:0,z:12}})}},clearModeAura:function(a){ig.EffectTools.clearEffects(a,
"modeAura")},showModeDash:function(a,c){var d=b[c]+"Dash";ig.EffectTools.clearEffects(a,"modeDash");c!=sc.ELEMENT.NEUTRAL&&this.effects.mode.spawnOnTarget(d,a,{duration:0.3,align:ig.ENTITY_ALIGN.BOTTOM,group:"modeDash",offset:{x:0,y:0,z:12}})},addRespawnBlocker:function(a){this.respawnBlocker.push(a.coll)},isRespawnBlocked:function(a){for(var b=this.respawnBlocker.length;b--;)if(ig.CollTools.intersect(a,this.respawnBlocker[b],true))return true;return false},notifyNearbyEnemiesOfTarget:function(a,
b){for(var c=a.getAlignedPos(ig.ENTITY_ALIGN.BOTTOM,m),c=ig.game.getEntitiesInCircle(c,b,1,16,void 0,void 0,void 0,a),d=c.length;d--;){var e=c[d];e instanceof ig.ENTITY.Enemy&&(e.target||e.enemyType.reselectTarget(e,true))}},isInCombat:function(a){return a.target||a.party==sc.COMBATANT_PARTY.PLAYER&&sc.model.isCombatMode()&&!sc.model.isCutscene()||sc.pvp.isCombatantInPvP(a)?true:false},isPlayerPartyInCombat:function(){for(var a=this.activeCombatants[sc.COMBATANT_PARTY.ENEMY],b=a.length;b--;)if(a[b].aggression==
sc.ENEMY_AGGRESSION.THREAT)return true;return false},getEnemyAiExp:function(a,b){if(!a.enemyType)return 0;if(a.enemyType.aiLearnType.knowItAll)return 1;var b=b||1,c=a.enemyType.enduranceScale,d=sc.stats.getMap("combat","kill"+a.enemyName)||0,e=0,d=d*c*b;if(a.enemyType.aiGroup){e=sc.stats.getMap("combat","aiGroupKill"+a.enemyType.aiGroup)||0;e=e*c*t;e>r/2&&(e=r/2)}else d=d*(1+t);c=Math.min(d+e,r);return Math.pow(c,q)/Math.pow(r,q)},getKillCount:function(){},getElementMode:function(a){return a instanceof
sc.PlayerBaseEntity?a.model.currentElementMode:a instanceof ig.ENTITY.Enemy?a.elementModes?a.elementModes.current:sc.ELEMENT.NEUTRAL:sc.ELEMENT.NEUTRAL}});var r=20,t=0.5,q=0.75;ig.addGameAddon(function(){return sc.combat=new sc.Combat});h=Vec2.create();ig.NavExternalBlockers.register(function(a,b){return b.party!=sc.COMBATANT_PARTY.PLAYER?false:a.externalData.partyBlocked})});ig.baked=!0;
ig.module("game.feature.combat.pvp").requires("impact.base.game").defines(function(){sc.PvpModel=ig.GameAddon.extend({observers:[],state:0,round:0,winPoints:0,points:{},enemies:[],lastWinParty:null,blocking:false,roundGui:null,init:function(){this.parent("PvP");ig.vars.registerVarAccessor("pvp",this,"VarPvpEditor")},start:function(b,a){this.state=1;this.round=0;this.winPoints=b;this.points[sc.COMBATANT_PARTY.PLAYER]=0;this.points[sc.COMBATANT_PARTY.ENEMY]=0;this.enemies=a;sc.Model.notifyObserver(this,
sc.PVP_MESSAGE.STARTED,null);sc.model.setCombatMode(true,true)},getDmgFactor:function(){return!this.isActive()?1:sc.model.player.hasItem(410)?0.2:sc.model.player.hasItem(223)?0.25:sc.model.player.hasItem(225)?0.33:0.5},isActive:function(){return this.state!=0},isKillHit:function(){return this.state==3},isBrake:function(){return this.state==4},isFinished:function(){return this.state==5},isOver:function(){return this.points[sc.COMBATANT_PARTY.PLAYER]==this.winPoints||this.points[sc.COMBATANT_PARTY.ENEMY]==
this.winPoints},isCombatantInPvP:function(b){return!this.isActive()?false:b.party==sc.COMBATANT_PARTY.PLAYER?true:this.enemies.indexOf(b)!=-1},onPvpCombatantDefeat:function(b){if(!this.isActive())return false;if(b.party==sc.COMBATANT_PARTY.PLAYER){if(sc.party.isDefeated())return this.showKO(sc.COMBATANT_PARTY.ENEMY)}else{if(this.enemies.indexOf(b)==-1)return false;for(var b=true,a=this.enemies.length;a--;)this.enemies[a].isDefeated()||(b=false);if(b)return this.showKO(sc.COMBATANT_PARTY.PLAYER)}},
releaseBlocking:function(){this.blocking=false},showKO:function(b){var a=++this.points[b];this.lastWinParty=b;if(sc.arena.active){sc.arena.stopTimers();sc.arena.onPvpRoundFinished(this.lastWinParty)}this.state=3;ig.game.varsChangedDeferred();b=new sc.PvpKoGui;ig.gui.addGuiElement(b);return sc.DRAMATIC_EFFECT[a==this.winPoints?"PVP_FINAL_KO":"PVP_KO"]},onPostKO:function(b){var a=b==sc.COMBATANT_PARTY.ENEMY?1:0.5,b=b==sc.COMBATANT_PARTY.ENEMY?0.5:1;ig.game.playerEntity.regenPvp(a);for(var d=sc.party.getPartySize();d--;)sc.party.getPartyMemberEntityByIndex(d).regenPvp(a);
for(d=this.enemies.length;d--;)this.enemies[d].regenPvp(b);this.state=this.isOver()?5:4;ig.game.varsChangedDeferred()},startNextRound:function(b){this.round=this.round+1;this.roundGui=new sc.PvpRoundGui(this.round,b);ig.gui.addGuiElement(this.roundGui);this.blocking=true},finalizeRoundStart:function(){this.state=2;if(this.roundGui){this.roundGui.remove();this.roundGui=null}for(var b=0;b<this.enemies.length;++b)this.enemies[b].setTarget(ig.game.playerEntity,true);sc.arena.active&&sc.arena.resumeTimers();
ig.game.varsChangedDeferred();this.releaseBlocking()},stop:function(){for(var b=this.enemies.length,a=this.points[sc.COMBATANT_PARTY.PLAYER]==this.winPoints&&this.points[sc.COMBATANT_PARTY.ENEMY]==0;b--;){this.enemies[b].onPvpEnd(this.lastWinParty==sc.COMBATANT_PARTY.PLAYER);a&&sc.stats.addMap("pvp","flawlessWin-"+this.enemies[b].enemyName,1)}this.state=0;this.enemies.length=0;sc.Model.notifyObserver(this,sc.PVP_MESSAGE.STOPPED,null);sc.model.setCombatMode(false,true)},onVarAccess:function(b,a){if(a[0]==
"pvp")switch(a[1]){case "active":return this.state!=0;case "brake":return this.state==4;case "killHit":return this.state==3;case "finalHit":return this.state==3&&this.isOver();case "finished":return this.state==5;case "round":return this.round;case "lastWinPlayer":return this.lastWinParty==sc.COMBATANT_PARTY.PLAYER;case "playerPoints":return this.points[sc.COMBATANT_PARTY.PLAYER];case "enemyPoints":return this.points[sc.COMBATANT_PARTY.ENEMY]}throw Error("Unsupported var access path: "+b);},onPostUpdate:function(){if(this.state==
3){var b=true;ig.game.playerEntity.dying!=sc.DYING_STATE.DYING&&(b=false);for(var a=sc.party.getPartySize();a--;)sc.party.getPartyMemberEntityByIndex(a).dying||(b=false);for(var d=true,a=this.enemies.length;a--;)this.enemies[a].dying!=sc.DYING_STATE.DYING&&(d=false);if(b||d)this.onPostKO(b?sc.COMBATANT_PARTY.ENEMY:sc.COMBATANT_PARTY.PLAYER)}},onReset:function(){this.state=0;sc.Model.notifyObserver(this,sc.PVP_MESSAGE.STOPPED,null);this.winPoints=this.round=0;this.enemies.length=0;this.blocking=false;
if(this.roundGui){this.roundGui.remove();this.roundGui=null}}});sc.PVP_MESSAGE={STARTED:1,STOPPED:2,ROUND_OVER:3};ig.addGameAddon(function(){return sc.pvp=new sc.PvpModel})});ig.baked=!0;
ig.module("game.feature.combat.combat-shield").requires("game.feature.combat.model.combat-params").defines(function(){sc.SHIELD_STRENGTH={REGULAR:1,BLOCK_ABOVE:2,BLOCK_ALL:3};sc.CombatShield=ig.Class.extend({name:null,baseFactor:1,elementFactors:[1,1,1,1],hitResist:sc.ATTACK_TYPE.MASSIVE,stableOverride:sc.ATTACK_TYPE.HEAVY,duration:0,effect:void 0,neutralize:false,init:function(a,b){this.name=b;this.baseFactor=a.baseFactor!==void 0?a.baseFactor:0;this.elementFactors=a.elementFactors!==void 0?a.elementFactors:
this.elementFactors;this.strength=sc.SHIELD_STRENGTH[a.strength]||sc.SHIELD_STRENGTH.BLOCK_ALL;this.hitResist=sc.ATTACK_TYPE[a.hitResist]||this.hitResist;this.stableOverride=sc.ATTACK_TYPE[a.stableOverride];this.neutralize=a.neutralize;if(this.stableOverride===void 0)this.stableOverride=sc.ATTACK_TYPE.HEAVY;this.duration=a.duration!=void 0?a.duration:-1;if(a.effect){this.effect=new ig.EffectHandle(a.effect);this.fxOffset=a.fxOffset}},clearCached:function(){this.effect&&this.effect.clearCached()},
onActivate:null,onDeactivate:null,isActive:function(){return true},getDamageFactor:function(a){return this.baseFactor*(a.element?this.elementFactors[a.element-1]:1)},reduceSpikeDamage:function(){return true}});sc.CombatantShieldConnection=ig.Class.extend({combatant:null,shield:null,timer:0,perfectGuardTime:0,perfectTimeReset:0,effectHandle:null,init:function(a,b,e){this.combatant=a;this.shield=b;this.perfectGuardTime=e||0;this.perfectTimeReset=e||0;this.shield.onActivate&&this.shield.onActivate(a);
if(this.shield.effect)this.effectHandle=b.effect.spawnOnTarget(a,{duration:-1,align:"CENTER",offset:this.shield.fxOffset})},update:function(){if(this.shield.duration!=-1){this.timer=this.timer+ig.system.tick;if(this.timer>=this.shield.duration)return true}if(this.perfectGuardTime>0){this.perfectGuardTime=this.perfectGuardTime-ig.system.tick;if(this.perfectGuardTime<0)this.perfectGuardTime=0}return false},isPerfect:function(){return this.perfectGuardTime>0},resetPerfectGuardTime:function(){this.perfectGuardTime=
this.perfectTimeReset},onDetach:function(a){this.effectHandle&&this.effectHandle.stop();this.shield.onDeactivate&&this.shield.onDeactivate(a)},onActionEndDetach:function(){this.combatant.removeShield(this)},onEntityKillDetach:function(){this.combatant.removeShield(this)}});sc.COMBAT_SHIELDS={};var b=Vec2.create(),a=Vec2.create();sc.COMBAT_SHIELDS.DIRECTIONAL=sc.CombatShield.extend({_wm:new ig.Config({attributes:{baseFactor:{_type:"Number",_info:"Basic effectiveness of shield. 0.1 = reduces damage to 10%."},
elementFactors:{_type:"ElementDef",_info:"Effectiveness per element",_optional:true},strength:{_type:"String",_info:"Strength of shield. Determines what is blocked",_select:sc.SHIELD_STRENGTH,optional:true},hitResist:{_type:"String",_info:"Up to which attackType attacks are resisted by default",_select:sc.ATTACK_TYPE,_optional:true},stableOverride:{_type:"String",_info:"If shield is effective, what is the new hit stable for the entity?",_select:sc.ATTACK_TYPE,_optional:true},duration:{_type:"Number",
_info:"Duration of shield if -1: will last forever",_optional:true},range:{_type:"Number",_info:"Range of shield per circularAngle. 0.5 = 50% circular angle protected",_default:0.5},back:{_type:"Boolean",_info:"If true: shield is around back of entity, not front"},effect:{_type:"Effect",_info:"Effect to be shown while shield is active",_optional:true},fxOffset:{_type:"Offset",_info:"Offset to effects spanning (CENTER) by default",_optional:true},neutralize:{_type:"Boolean",_info:"If true: entirely neutralize damage effect, even knockback + no damage + special sound",
_optional:true}}}),range:0.5,back:false,init:function(a,b){this.parent(a,b);this.strength=sc.SHIELD_STRENGTH[a.strength]||sc.SHIELD_STRENGTH.REGULAR;this.range=a.range||0.5;this.back=a.back||false},isActive:function(d,c){var e=d.getCurrentAnimFaceCount();e>1?ig.getRoundedFaceDir(d.face.x,d.face.y,e,a):Vec2.assign(a,d.face);this.back&&Vec2.flip(a);var f=c.getHitDir(d,b),f=Math.PI-Math.abs(Vec2.angle(f,a)),e=this.range*Math.PI;if(f<=e)return true;f=c.getHitVel(d,b);f=Math.PI-Math.abs(Vec2.angle(f,a));
return f<=e/2?true:false},reduceSpikeDamage:function(){return this.range>=1}});sc.COMBAT_SHIELDS.PARTS=sc.CombatShield.extend({_wm:new ig.Config({attributes:{baseFactor:{_type:"Number",_info:"Basic effectiveness of shield. 0.1 = reduces damage to 10%."},elementFactors:{_type:"ElementDef",_info:"Effectiveness per element",_optional:true},strength:{_type:"String",_info:"Strength of shield. Determines what is blocked",_select:sc.SHIELD_STRENGTH,optional:true},hitResist:{_type:"String",_info:"Up to which attackType attacks are resisted by default",
_select:sc.ATTACK_TYPE,_optional:true},stableOverride:{_type:"String",_info:"If shield is effective, what is the new hit stable for the entity?",_select:sc.ATTACK_TYPE,_optional:true},duration:{_type:"Number",_info:"Duration of shield if -1: will last forever",_optional:true},parts:{_type:"Array",_info:"An array of part names that are protected",_sub:{_type:"String"}},inverse:{_type:"Boolean",_info:"If true: Protect all parts that are NOT in the part list"},effect:{_type:"Effect",_info:"Effect to be shown while shield is active",
_optional:true}}}),parts:null,inverse:false,init:function(a,b){this.parent(a,b);this.strength=sc.SHIELD_STRENGTH[a.strength]||sc.SHIELD_STRENGTH.BLOCK_ALL;this.parts=a.parts||null;this.inverse=a.inverse||false},isActive:function(a,b,e,f){a=this.parts.indexOf(f)!=-1;this.inverse&&(a=!a);return a},reduceSpikeDamage:function(){return true}});sc.COMBAT_SHIELDS.PLAYER=sc.COMBAT_SHIELDS.DIRECTIONAL.extend({_wm:new ig.Config({attributes:{baseFactor:{_type:"Number",_info:"Basic effectiveness of shield. Is MULTIPLIED with calculated def effectiveness. 1.0 = normal shield defense",
_default:1},elementFactors:{_type:"ElementDef",_info:"Effectiveness per element",_optional:true},strength:{_type:"String",_info:"Strength of shield. Determines what is blocked",_select:sc.SHIELD_STRENGTH,optional:true},hitResist:{_type:"String",_info:"Up to which attackType attacks are resisted by default",_select:sc.ATTACK_TYPE,_optional:true},stableOverride:{_type:"String",_info:"If shield is effective, what is the new hit stable for the entity?",_select:sc.ATTACK_TYPE,_optional:true},duration:{_type:"Number",
_info:"Duration of shield if -1: will last forever",_optional:true},range:{_type:"Number",_info:"Range of shield per circularAngle. 0.5 = 50% circular angle protected",_default:0.5},back:{_type:"Boolean",_info:"If true: shield is around back of entity, not front"},noShieldDamage:{_type:"Boolean",_info:"If true, don't apply shield damage when effective (no guard break)"},effect:{_type:"Effect",_info:"Effect to be shown while shield is active. Won't show default effect when active.",_optional:true},
noDefaultFX:{_type:"Boolean",_info:"If true: Hide default shield graphics"}}}),init:function(a,b){this.parent(a,b);this.noShieldDamage=a.noShieldDamage||false;this.noDefaultFX=a.noDefaultFX||false},isActive:function(a,b,e,f,g){if(!this.parent(a,b,e,f,g))return false;if(a.params.getModifier("GUARD_SP")&&!this.noShieldDamage){b=a.params.getModifier("GUARD_SP");a.params.addSp(b*e.damageFactor*(g?2:1))}if(this.noShieldDamage||g)return true;g=this.getDefenseRatio(e,a);e=e.damageFactor*Math.pow(g,1.5);
return!a.damageShield(e)},onActivate:function(a){!this.effect&&!this.noDefaultFX&&a.startGuardEffect()},onDeactivate:function(a){!this.effect&&!this.noDefaultFX&&a.endGuardEffect()},getDamageFactor:function(a,b){var e=this.parent(a,b),f=1,f=this.getDefenseRatio(a,b),f=f<=1?0.2-(1-Math.pow(f,0.3))*1:0.2+(Math.pow(f,1.1)-1)*0.35,f=f-b.params.getModifier("GUARD_STRENGTH"),f=f.limit(0,1);return e*f},getDefenseRatio:function(a,b){var e=b.params.getStat("defense");return!a.attackerParams?0:a.attackerParams.getStat("attack")/
e},reduceSpikeDamage:function(){return false}})});ig.baked=!0;
ig.module("game.feature.combat.combat-force").requires("impact.base.entity").defines(function(){sc.CombatForce=ig.Class.extend({combatant:null,combatantRoot:null,init:function(a){this.combatant=a;this.combatantRoot=a.getCombatantRoot&&a.getCombatantRoot()||a},update:function(){return true},isRepeating:function(){return false},onActionEndDetach:function(){this.combatantRoot&&this.combatantRoot.removeActionAttached(this);this.combatantRoot=null},getCombatant:function(){return this.combatant},getCombatantRoot:function(){return this.combatantRoot},
onEnd:null});var b=Vec3.create(),a=Vec2.create(),d=Vec2.create(),c=Vec2.create(),e=Vec2.create(),f=Vec3.create();sc.CircleHitForce=sc.CombatForce.extend({attackInfo:null,align:ig.ENTITY_ALIGN.BOTTOM,offset:null,radius:0,dir:null,yScale:1,zHeight:0,centralAngle:0,startAngle:0,duration:0,expandRadius:0,alwaysFull:false,clockwise:false,flipLeftFace:0,party:0,rectangular:false,pos:null,prevAngle:0,timer:0,hitEntities:null,hitEntitiesAngle:null,init:function(a,b){this.parent(a);this.party=sc.COMBATANT_PARTY[b.party]||
this.combatant.party;this.attackInfo=new sc.AttackInfo(a.params,b.attack);this.align=ig.ENTITY_ALIGN[b.align]||this.align;this.pos=b.pos||null;if(b.fixPos)this.pos=a.getAlignedPos(this.align);this.dir=b.dir||null;this.offset=b.offset||null;this.radius=b.radius;this.yScale=b.yScale||1;this.zHeight=b.zHeight||24;this.centralAngle=Math.PI*2*(b.centralAngle||1);this.startAngle=b.startAngle!==void 0?Math.PI*2*b.startAngle:-this.centralAngle/2;this.duration=b.duration||0;this.expandRadius=b.expandRadius||
0;this.alwaysFull=b.alwaysFull||false;this.clockwise=b.clockwise||false;this.flipLeftFace=b.flipLeftFace||false;this.rectangular=b.rectangular||false;this.repeat=b.repeat||false;this.uniformHitDir=b.uniformHitDir||false;this.checkCollision=b.checkCollision||false;this.timer=this.duration;this.prevAngle=0;this.hitEntities=[];this.hitEntitiesAngle=[]},update:function(){this.timer=this.timer-this.combatant.coll.getTick(true);var a=this.duration?1-(this.timer/this.duration).limit(0,1):1,b=this.startAngle+
Math.max(0,this.prevAngle-Math.PI*0.5),c=this.centralAngle*a;if(this.alwaysFull){this.prevAngle=0;b=this.startAngle;c=this.centralAngle}var d=this.startAngle+c,e=this.radius+a*this.expandRadius;if(this.timer<=0||c-this.prevAngle>Math.PI*0.1){if(!this.alwaysFull)for(;this.hitEntitiesAngle.length&&c-this.hitEntitiesAngle[0]>Math.PI;){this.hitEntities.shift();this.hitEntitiesAngle.shift()}this.prevAngle=c;a=!this.clockwise;this.flipLeftFace&&ig.isFaceLeftHalf(this.combatant,this.flipLeftFace)&&(a=!a);
if(a){a=b;b=-d;d=-a}var a=this.party,f=this.alwaysFull&&this.centralAngle>=Math.PI*2?null:this.dir||this.combatant.face,g=this.combatant.party==this.party?this.combatant:null,h=this._getPos(),g=ig.game.getEntitiesInCircle(h,e,this.yScale,this.zHeight,f,b,d,g,this.hitEntities,this.rectangular,this.checkCollision);window.ig.perf.showHitBoxes&&(this.rectangular||ig.debugView.addMapCircle(h.x,h.y,h.z,e,f,b,d,this.zHeight,"red",0.1,this.yScale));for(b=g.length;b--;){d=false;e=g[b];f=null;if(e.coll.parentColl&&
e.coll.parentGroup){f=e.coll.parentColl.entity.uid+e.coll.parentGroup;if(this.hitEntities.indexOf(f)!=-1)continue}if(d=e.isCombatant&&a!=e.party?e.damage(this,this.attackInfo):true){e.ballHit&&e.ballHit(this);f?this.hitEntities.push(f):this.hitEntities.push(e);this.hitEntitiesAngle.push(c)}}}if(this.repeat&&this.timer<=0){this.timer=this.duration;this.hitEntities.length=0;this.prevAngle=this.hitEntitiesAngle.length=0}return this.timer<=0},getElement:function(){return this.attackInfo&&this.attackInfo.element||
sc.ELEMENT.NEUTRAL},getHitCenter:function(a,b){var c=b||Vec3.create();a.getAlignedPos(ig.ENTITY_ALIGN.CENTER,c);var e=this._getPos();Vec2.assign(d,c);Vec2.sub(d,e);var f=this.duration?1-(this.timer/this.duration).limit(0,1):1,f=this.radius+f*this.expandRadius;if(Vec2.length(d)>f){Vec2.length(d,f);Vec2.assign(c,e);Vec2.add(c,d)}c.z=c.z.limit(e.z,e.z+this.zHeight);return c},getHitVel:function(a,b){var c=b||Vec2.create();a.getCenter(c);this.uniformHitDir?Vec2.sub(c,this.combatant.getCenter(d)):Vec2.sub(c,
this._getPos());if(!this.pos&&Vec2.dot(c,this.combatant.face)>0){Vec2.assign(d,this.combatant.face);Vec2.length(d,2);Vec2.length(c,1);Vec2.add(c,d)}return c},getHitDir:function(a,b){b=b||Vec2.create();a.getCenter(b);this.uniformHitDir?Vec2.sub(b,this.combatant.getCenter(d)):Vec2.sub(b,this._getPos());return b},getCollideSide:function(b){b=this.getHitDir(b,a);return Math.abs(b.x)>Math.abs(b.y)?ig.ActorEntity.FACE4[b.x<0?"EAST":"WEST"]:ig.ActorEntity.FACE4[b.y<0?"SOUTH":"NORTH"]},_getPos:function(){if(this.pos)return this.pos;
var a=this.combatant.getAlignedPos(this.align,b);this.offset&&Vec3.add(a,this.offset);return a},isRepeating:function(){return this.repeat}});sc.DIRECT_HIT_DIR={TOWARD:1,AWAY:2};sc.DirectHitForce=sc.CombatForce.extend({attackInfo:null,hitDir:null,align:ig.ENTITY_ALIGN.CENTER,hitCount:0,hitDelay:0,effect:null,victim:null,timer:0,init:function(a,b,c,d){this.parent(a);this.attackInfo=new sc.AttackInfo(this.combatantRoot.params,c.attack);this.hitDir=sc.DIRECT_HIT_DIR[c.hitDir||"AWAY"];this.align=ig.ENTITY_ALIGN[c.align]||
this.align;this.hitCount=c.hitCount||1;this.hitDelay=c.hitDelay||0.1;this.timer=0;this.effect=d;this.victim=b},update:function(){if(!this.victim.damage)return true;for(this.timer=this.timer-this.combatant.coll.getTick(true);this.hitCount&&this.timer<=0;){this.timer=this.timer+this.hitDelay;this.hitCount--;this.effect&&this.effect.spawnOnTarget(this.victim,{align:this.align});this.victim.damage(this,this.attackInfo)}return this.hitCount==0},getElement:function(){return this.attackInfo&&this.attackInfo.element||
sc.ELEMENT.NEUTRAL},getHitCenter:function(a,b){var c=b||Vec2.create();a.getCenter(c);c.z=a.coll.pos.z+a.coll.size.z/2;return c},getHitVel:function(a,b){var d=b||Vec2.create();a.getCenter(d);this.combatant.getCenter(c);Vec2.sub(d,c);this.hitDir==sc.DIRECT_HIT_DIR.TOWARD&&Vec2.flip(d);return d},getHitDir:function(a,b){return this.getHitVel(a,b)},getCollideSide:function(b){b=this.getHitVel(b,a);return Math.abs(b.x)>Math.abs(b.y)?ig.ActorEntity.FACE4[b.x<0?"EAST":"WEST"]:ig.ActorEntity.FACE4[b.y<0?"SOUTH":
"NORTH"]}});sc.PUSH_PULL_STRENGTH={EASY_ESCAPE:40,WALK_ESCAPE:100,RUN_ESCAPE:130,DASH_ESCAPE:190,NO_ESCAPE:300,SERIOUSLY_GO_AWAY:500};sc.PushPullForce=sc.CombatForce.extend({radius:0,fadeRadius:0,zHeight:0,influencedEntities:[],fxHandles:[],timer:0,pullAll:false,init:function(a,b){this.parent(a);this.radius=b.radius;this.minRadius=b.minRadius||0;this.fadeRadius=b.fadeRadius;this.faceDist=b.faceDist;this.strength=sc.PUSH_PULL_STRENGTH[b.strength]||sc.PUSH_PULL_STRENGTH.WALK_ESCAPE;this.influence=new ig.InfluenceEntry;
this.influence.setPushType(b.pull?sc.INFLUENCE_PUSH.PULL:sc.INFLUENCE_PUSH.PUSH,this.radius,this.fadeRadius,this.strength);this.zHeight=b.zHeight||32;this.timer=b.duration||0;this.party=sc.COMBATANT_PARTY[b.party]||this.combatant.party;this.effect=b.effect||null;this.align=ig.ENTITY_ALIGN[b.align]||ig.ENTITY_ALIGN.BOTTOM},update:function(){var c=this.combatant.getAlignedPos(this.align,b);if(this.faceDist){var d=Vec2.assign(a,this.combatant.face);Vec2.length(d,this.faceDist);Vec2.add(c,d)}this.influence.setPushCenter(c);
for(var e=this.combatant.coll,d=this.influencedEntities.length;d--;){var f=this.influencedEntities[d],g=f.coll,h=Vec2.sub(f.getCenter(a),c),h=Vec2.length(h),n=h-this.combatant.coll.size.y/2-f.coll.size.y/2;(h>this.radius+this.fadeRadius||this.minRadius&&n<this.minRadius||g.pos.z>e.pos.z+this.zHeight||g.pos.z+g.size.z<e.pos.z)&&this._removeEntity(d)}e=ig.game.getEntitiesInCircle(c,this.radius+this.fadeRadius,1,this.zHeight,null,null,null,this.combatantRoot,this.influencedEntities,false);for(d=e.length;d--;){f=
e[d];if(f!=this.combatant&&(f.influencer&&f instanceof ig.ENTITY.Combatant&&f.party!=this.party)&&f.coll.groundConnect==ig.COLL_GROUND_CONNECT.LOOSE&&f.coll.weight!=-1){h=Vec2.sub(f.getCenter(a),c);h=Vec2.length(h);n=h-this.combatant.coll.size.y/2-f.coll.size.y/2;if(!(this.minRadius&&n<this.minRadius)){f.influencer.addInfluence(this.influence);this.influencedEntities.push(f);if(this.effect){f=this.effect.spawnOnTarget(f,{duration:-1,align:ig.ENTITY_ALIGN.CENTER,target2:this.combatant,target2Align:ig.ENTITY_ALIGN.CENTER});
this.fxHandles.push(f)}}}}if(this.timer>0){this.timer=this.timer-ig.system.tick;if(this.timer<=0)this.timer=0}return this.timer==0},_removeEntity:function(a){this.influencedEntities[a].influencer.removeInfluence(this.influence);this.influencedEntities.splice(a,1);if(this.effect){this.fxHandles[a].stop();this.fxHandles.splice(a,1)}},onEnd:function(){for(var a=this.influencedEntities.length;a--;)this._removeEntity(a)},isRepeating:function(){return this.timer<0}});sc.PROXY_GRID_FLOW={SQUARE:function(a,
b,c,d,e){d=Math.abs(d+0.5-b/2);e=Math.abs(e+0.5-c/2);return a*b/2>=d&&a*c/2>=e},CIRCLE:function(a,b,c,d,e){d=Math.abs(d+0.5-b/2);e=Math.abs(e+0.5-c/2);e=Math.sqrt(d*d+e*e);return a*Math.sqrt(b*b/4+c*c/4)>=e}};sc.ProxyGridForce=sc.CombatForce.extend({init:function(a,b,c){this.parent(a);this.posTarget=c;this.proxies=b.proxies;this.pattern=b.pattern;this.tilesize=b.tilesize;this.align=ig.ENTITY_ALIGN[b.align]||ig.ENTITY_ALIGN.BOTTOM;this.offset=b.offset;this.duration=b.duration;this.spawnDelay=b.spawnDelay||
0;this.delayTimer=this.timer=0;this.width=this.pattern[0].length;this.height=this.pattern.length;this.flow=sc.PROXY_GRID_FLOW[b.flow]||sc.PROXY_GRID_FLOW.CIRCLE;this.oldWeight=0;this.spawnList=[]},update:function(){var a=this.posTarget||this.combatant,c=a.getAlignedPos(this.align,b);Vec3.add(c,this.offset);this.timer=this.timer+ig.system.tick;for(var d=this.duration?this.timer/this.duration:1,e=this.height;e--;)for(var f=this.width;f--;)if(this.pattern[e]&&this.pattern[e][f]&&(!this.oldWeight||!this.flow(this.oldWeight,
this.width,this.height,f,e))&&this.flow(d,this.width,this.height,f,e)){var g=this.pattern[e][f]-1;if(a=sc.ProxyTools.getProxy(this.proxies[g],this.combatantRoot)){var h=c.x+(f+0.5-this.width/2)*this.tilesize,p=c.y+(e+0.5-this.height/2)*this.tilesize;if(!ig.game.isAreaBlocked(h-this.tilesize/2,p-this.tilesize/2,c.z,this.tilesize,this.tilesize,16)){if(this.maxGroundDistance!=null){var r=ig.game.physics.getBaseZPos(h-1,p-1,c.z,2,2);if(c.z-r>this.maxGroundDistance)continue}if(this.spawnDelay)this.spawnList.push({x:h,
y:p,index:g-1,proxy:a});else{a=a.spawn(h,p,c.z,this.combatant,this.combatant.face);a.setAttribute("gridIndex",g+1)}}}}if(this.delayTimer){this.delayTimer=this.delayTimer-ig.system.tick;if(this.delayTimer<=0)this.delayTimer=0}for(;this.spawnList.length>0&&!this.delayTimer;){e=this.spawnList.shift();a=e.proxy.spawn(e.x,e.y,c.z,this.combatant,this.combatant.face);a.setAttribute("gridIndex",e.index);this.delayTimer=this.delayTimer+this.spawnDelay}this.oldWeight=d;return this.timer>=this.duration&&this.spawnList.length==
0}});var g=[{radius:1,angle:0,x:0.5,y:1},{radius:1,angle:0.25,x:0.5,y:0},{radius:1,angle:0.5,x:1,y:0.5},{radius:1,angle:0.75,x:0,y:0.5}],h={};sc.SPAWN_START_DIST_COLLIDE={NONE:0,CLOSER:1,DROP:2,ALT_DIR:3};sc.SpawnHelper=ig.Class.extend({align:ig.ENTITY_ALIGN.FACE,offset:null,centralAngle:0,startAngle:0,angleVary:0,count:1,duration:0,clockwise:false,random:false,flipLeftFace:0,dir:null,offsetArea:null,circularArea:false,callback:null,maxGroundDistance:null,uniformDir:0,delay:0,yScale:0,repeat:false,
posEntity:false,limitRangeOnColl:0,init:function(a,b,c){this.align=ig.ENTITY_ALIGN[a.align]||this.align;this.offset=a.offset||null;this.centralAngle=Math.PI*2*(a.centralAngle||0);this.startAngle=a.startAngle!==void 0?Math.PI*2*a.startAngle:-this.centralAngle/2;this.startDist=a.startDist||0;this.startDistAdd=a.startDistAdd||0;this.startDistCollide=sc.SPAWN_START_DIST_COLLIDE[a.startDistCollide]||sc.SPAWN_START_DIST_COLLIDE.NONE;this.angleVary=(a.angleVary||0)*Math.PI*2;this.count=a.count||1;this.duration=
a.duration||0;this.clockwise=a.clockwise||false;this.flipLeftFace=a.flipLeftFace||false;this.random=a.random||false;this.timer=this.duration;this.dir=a.dir||null;this.aimAtTarget=a.aimAtTarget||false;this.yScale=a.yScale||1;this.offsetArea=a.offsetArea||null;this.circularArea=a.circularArea||false;this.uniformDir=a.uniformDir||0;this.delay=a.delay||0;this.callback=b;this.repeat=a.repeat;this.posEntity=c;if(a.maxGroundDistance!=null&&a.maxGroundDistance!=void 0)this.maxGroundDistance=a.maxGroundDistance;
if(a.terrainFilter){b=a.terrainFilter;this.terrainFilter=[];for(c=b.length;c--;)this.terrainFilter.push(ig.TERRAIN[b[c]])}this.limitRangeOnColl=a.limitRangeOnColl||0},initData:function(a){a.count=ig.Event.getExpressionValue(this.count);a.spawned=0;return ig.Event.getExpressionValue(this.duration)},spawn:function(a,b,k,l,o,m){var l=l||16,o=o||16,m=m||16,n;if(this.dir)n=ig.Action.getVec2(this.dir,a,d);else if(this.aimAtTarget){var p=this._getPos(a,0);if(n=a.getTarget()){n=n.getCenter(c);n=Vec2.sub(n,
p,d)}else n=Vec2.assign(d,a.face)}else n=Vec2.assign(d,a.face);var r=ig.Event.getExpressionValue(this.startDist);r&&Vec2.length(n,r);if(this.startDistCollide||this.limitRangeOnColl)var t=Math.min((this.posEntity||a).coll.size.x,l),q=Math.min((this.posEntity||a).coll.size.y,o);if(this.limitRangeOnColl){this.limitRangeOnColl=0;this._limitRange(a,n,t,q,m)}var b=b-a.coll.getTick(true),s=ig.Event.getExpressionValue(this.duration);if(s-b<this.delay)return b;var p=s?1-(b/(s-this.delay)).limit(0,1):1,v=this.repeat?
k.count:k.count-1,y=this.repeat?Math.ceil(v*p):1+Math.floor(v*p);if(y>k.spawned)for(var u=k.spawned;u<y;++u){p=0;if(v&&s){p=(s-this.delay)*(1-u/v);p=p-b}this.startDistAdd&&Vec2.length(n,r+this.startDistAdd*(u/(k.count-1||1)));var p=this._getPos(a,p),z=this.random?Math.random():u/(k.count==1||this.centralAngle==Math.PI*2?k.count:k.count-1),D=this.startAngle+z*this.centralAngle;this.clockwise&&(D=-D);D=D+(Math.random()-0.5)*this.angleVary;this.flipLeftFace&&ig.isFaceLeftHalf(a,this.flipLeftFace)&&(D=
-D);var C=Vec2.rotate(n,D,c),A=Vec3.assignC(f,0,0,0);if(r){z=1;if(this.startDistCollide){var B=0.0625,w=false,x=false;do{var w=false,E=ig.game.physics.initTraceResult(h);ig.game.trace(E,p.x-t/2,p.y-q/2,p.z,C.x,C.y*this.yScale,t,q,m,ig.COLLTYPE.IGNORE,a,void 0,true);z=E.dist;if(E.dist<1&&this.startDistCollide==sc.SPAWN_START_DIST_COLLIDE.ALT_DIR){Vec2.rotate(C,Math.PI*2*B);B=-B;B=B+(B>0?0.0625:-0.0625);w=Math.abs(B)<0.5}else E.dist<1&&this.startDistCollide==sc.SPAWN_START_DIST_COLLIDE.DROP&&(x=true)}while(w);
if(x)continue}A.x=A.x+C.x*z;A.y=A.y+C.y*this.yScale*z}C.y=C.y*this.yScale;if(this.offsetArea){z=10;do{B=Math.random();w=Math.random();if(this.circularArea){if(g[z-1]){B=g[z-1].radius;w=g[z-1].angle}x=Vec2.assignC(e,0,Math.sqrt(B));Vec2.rotate(x,w*Math.PI*2);B=this.offsetArea.x/2*x.x;w=this.offsetArea.y/2*x.y}else{if(g[z-1]){B=g[z-1].x;w=g[z-1].y}B=(B-0.5)*this.offsetArea.x;w=(w-0.5)*this.offsetArea.y}var x=p.x+A.x+B,E=p.y+A.y+w,G=p.z+A.z}while((ig.game.isAreaBlocked(x-l/2,E-o/2,G,l,o,0)||this.terrainFilter&&
this.terrainFilter.indexOf(ig.terrain.getPointTerrain(x,E,G+4,l,o))==-1)&&--z);z==0&&(B=w=0);A.x=A.x+B;A.y=A.y+w}if(this.uniformDir){C=Vec2.rotate(n,D*(1-this.uniformDir),c);C.y=C.y*this.yScale}if(this.maxGroundDistance!=null){D=ig.game.physics.getBaseZPos(p.x+A.x-1,p.y+A.y-1,p.z+A.z,2,2);if(p.z+A.z-D>this.maxGroundDistance)continue}this.callback(p.x+A.x,p.y+A.y,p.z+A.z,C,k)}k.spawned=y;if(b<=0&&this.repeat){b=b+(s-this.delay);k.spawned=0}return b},_limitRange:function(a,b,d,e,f){for(var g=0,n=0,
p=false,r=0,t=16,q=Math.PI*2/t;t--;){var s=ig.game.physics.initTraceResult(h),v=this._getPos(a,0),y=Vec2.rotate(b,r+n,c);ig.game.trace(s,v.x-d/2,v.y-e/2,v.z,y.x,y.y*this.yScale,d,e,f-ig.COLLISION.HEIGHT_TOLERATE,ig.COLLTYPE.IGNORE,a,void 0,true);if(g){if(s.dist<1!=p){p=!p;if(g==1){if(p){this.startAngle=r+n-q;this.centralAngle=-n+q;n=0;q=-q;p=!p}else{r=this.startAngle=r+n;this.centralAngle=n=0}g=2}else if(g==2)break}}else{g=1;p=s.dist<1}n=n+q}if(g>1)this.centralAngle=this.centralAngle+n},_getPos:function(a,
c){if(this.posEntity)a=this.posEntity;var d=a.getAlignedPos(this.align,b);if(a.isPlayer&&this.align==ig.ENTITY_ALIGN.BOTTOM){var e=a.maxJumpHeight===void 0?-1:a.maxJumpHeight;if(e>=0)d.z=Math.min(a.coll.pos.z,e)}this.offset&&Vec3.add(d,this.offset);Vec2.addMulF(d,a.coll.vel,-c);return d}});sc.ProxySpawnerForce=sc.CombatForce.extend({proxy:null,spawnHelper:null,timer:0,spawnData:{},init:function(a,b,c){this.parent(a);this.proxy=sc.ProxyTools.getProxy(b.proxy,a);this.spawnHelper=new sc.SpawnHelper(b,
this.spawnProxy.bind(this),c);this.timer=this.spawnHelper.initData(this.spawnData)},update:function(){var a=this.proxy.getSize(f);this.timer=this.spawnHelper.spawn(this.combatant,this.timer,this.spawnData,a.x,a.y,a.z);return this.timer<=0},spawnProxy:function(a,b,c,d){this.proxy&&this.proxy.spawn(a,b,c,this.combatant,d,this.combatant)},isRepeating:function(){return this.spawnHelper.repeat}});sc.EnemySpawnerForce=sc.CombatForce.extend({enemyInfo:null,enemyType:null,spawnHelper:null,timer:0,spawnData:{},
init:function(a,b){this.parent(a);this.enemyType=b.enemyType;this.enemyInfo=b.enemyInfo;this.pushVel=b.pushVel;this.pushZVel=b.pushZVel;this.proxySrc=b.proxySrc;this.spawnHelper=new sc.SpawnHelper(b,this.spawnEnemy.bind(this));this.timer=this.spawnHelper.initData(this.spawnData)},update:function(){this.timer=this.spawnHelper.spawn(this.combatant,this.timer,this.spawnData);return this.timer<=0},spawnEnemy:function(a,b,c,d){var e=null;if(this.combatantRoot instanceof ig.ENTITY.Enemy)e=this.combatantRoot;
var f=ig.game.spawnEntity(ig.ENTITY.Enemy,a-this.enemyType.size.x/2,b-this.enemyType.size.y/2,c,{enemyInfo:this.enemyInfo,ownerEnemy:e},true);Vec2.assign(f.face,d);this.combatant.target?f.setTarget(this.combatant.target,true):f.enemyType.reselectTarget(f,false,true,true);if(this.pushVel){Vec2.assign(f.coll.vel,d);Vec2.length(f.coll.vel,ig.Event.getNumberVary(this.pushVel));f.coll.friction.air=0}if(this.pushZVel)f.coll.vel.z=ig.Event.getNumberVary(this.pushZVel);if(this.proxySrc){var g=sc.ProxyTools.getProxy(this.proxySrc,
e);if(g)g.spawn(a,b,c,e,d).target=f}},isRepeating:function(){return this.spawnHelper.repeat}})});ig.baked=!0;
ig.module("game.feature.combat.combat-stun").requires("impact.base.entity","impact.base.actor-entity").defines(function(){sc.COMBAT_STUN={};sc.CombatStun=ig.Class.extend({preHit:null,start:null,run:function(){return true}});sc.COMBAT_STUN={};var b=Vec2.create(),a=Vec2.create(),d=Vec3.create();sc.COMBAT_STUN.START_LOCK=sc.CombatStun.extend({_wm:new ig.Config({attributes:{}}),preHit:function(a,b){a.params&&a.params.startLock(b)}});sc.COMBAT_STUN.END_LOCK=sc.CombatStun.extend({_wm:new ig.Config({attributes:{}}),
preHit:function(a,b){a.params&&a.params.endLock(b)}});sc.COMBAT_STUN.BLOCK_XY=sc.CombatStun.extend({_wm:new ig.Config({attributes:{}}),init:function(){},run:function(a){a.coll.vel.x=0;a.coll.vel.y=0}});sc.COMBAT_STUN.BLOCK_FALL=sc.CombatStun.extend({maxTime:0,_wm:new ig.Config({attributes:{maxTime:{_type:"Number",_info:"Time how long fall should be blocked"}}}),init:function(a){this.maxTime=a.maxTime},run:function(a){if(a.coll.vel.z<0)a.coll.vel.z=0;return this.maxTime&&a.stepTimer>=this.maxTime}});
sc.COMBAT_STUN.PULL=sc.CombatStun.extend({speed:0,distance:0,maxTime:0,_wm:new ig.Config({attributes:{distance:{_type:"Number",_info:"Distance to be pulled to"},speed:{_type:"Number",_info:"Speed with which victim will be pulled toward attacker"},maxTime:{_type:"Number",_info:"How long victim will be pulled toward attacker. 0=until stun over"}}}),init:function(a){this.distance=a.distance;this.speed=a.speed||300;this.maxTime=a.maxTime||0},start:function(){},run:function(a,d){if(!d||a.coll.groundConnect||
a.coll.weight==-1)return this.maxTime;var f=ig.CollTools.getDistVec2(a.coll,d.coll,b);if(Vec2.length(f)-a.coll.size.x/2-d.coll.size.x/2>this.distance){Vec2.length(f,this.speed);Vec2.assign(a.coll.vel,f);return this.maxTime&&a.stepTimer>=this.maxTime}if(!this.maxTime){f=Math.max(0,Vec2.length(a.coll.vel)-ig.system.tick*5*this.speed);Vec2.length(a.coll.vel,f)}return this.maxTime}});sc.COMBAT_STUN.Z_PULL=sc.CombatStun.extend({maxSpeed:0,accel:1,offZ:1,_wm:new ig.Config({attributes:{accel:{_type:"Number",
_info:"Acceleration with which victom will be pulled to same z height"},offZ:{_type:"Number",_info:"Z Offset to attacker position to which victim will be pulled"},maxTime:{_type:"Number",_info:"How long victim will be pulled toward attacker. 0=until stun over"},maxSpeed:{_type:"Number",_info:"Maximum Speed for Z movement. Default is 300",_optional:true}}}),init:function(a){this.maxSpeed=a.maxSpeed||300;this.accel=a.accel||1;this.offZ=a.offZ||0;this.maxTime=a.maxTime||0},start:function(){},run:function(a,
b){if(!a.coll.groundConnect&&b){var d=((b.coll.pos.z-a.coll.pos.z+this.offZ)*10*this.accel).limit(-this.maxSpeed,this.maxSpeed);a.coll.vel.z=d}return this.maxTime&&a.stepTimer>=this.maxTime}});sc.COMBAT_STUN.FORCE_POS=sc.CombatStun.extend({_wm:new ig.Config({attributes:{align:{_type:"String",_info:"Alignment of to target",_select:ig.ENTITY_ALIGN},offset:{_type:"Offset",_info:"Offset to attack position",_optional:true},maxTime:{_type:"Number",_info:"How long victim will be pulled toward attacker. 0=until stun over"},
interpolateFactor:{_type:"Number",_info:"Factor to interpolate between positions over time, the higher, the faster",_optional:true}}}),init:function(a){this.align=ig.ENTITY_ALIGN[a.align]||ig.ENTITY_ALIGN.BOTTOM;this.offset=a.offset||null;this.maxTime=a.maxTime||0;this.interpolateFactor=a.interpolateFactor||0},start:function(){},run:function(a,b){if(!a.coll.groundConnect&&b){var f=b.getAlignedPos(this.align,d);this.offset&&Vec3.add(f,this.offset);Vec2.addMulF(f,a.coll.size,-0.5);if(this.interpolateFactor){var g=
ig.system.tick*60,h=a.stepTimer/0.3,i=this.interpolateFactor;h<1&&(i=1-h+i*h);i=Math.pow(i,g);f=Vec3.lerp(f,a.coll.pos,i,f)}a.setPos(f.x,f.y,f.z)}return this.maxTime&&a.stepTimer>=this.maxTime}});sc.COMBAT_STUN.Z_VEL=sc.CombatStun.extend({value:0,_wm:new ig.Config({attributes:{value:{_type:"Number",_info:"Value to set z velocity to."}}}),init:function(a){this.value=a.value||0},start:function(a){if(!a.coll.groundConnect)a.coll.vel.z=this.value}});sc.COMBAT_STUN.Z_BOUNCINESS=sc.CombatStun.extend({value:0,
_wm:new ig.Config({attributes:{value:{_type:"Number",_info:"Value to set Z bounciness to"}}}),init:function(a){this.value=a.value||0},start:function(a){a.coll.zBounciness=this.value}});sc.COMBAT_STUN.SET_FACE=sc.CombatStun.extend({value:0,_wm:new ig.Config({attributes:{faces:{_type:"Array",_info:"Face direction options. By default, will choose one looking at target",_sub:{_type:"Face",_select:ig.ActorEntity.FACE8}},invert:{_type:"Boolean",_info:"If true: will select face that looks furthest away from target."}}}),
init:function(a){this.faces=a.faces;this.invert=a.invert||false},start:function(c,d){if(d){var f=ig.CollTools.getDistVec2(c.coll,d.coll,b);this.invert&&Vec2.flip(f);for(var g=null,h=-1,i=this.faces.length;i--;){var j=ig.ActorEntity.getFaceVec(ig.ActorEntity.FACE8[this.faces[i]],a),j=Vec2.angle(j,f);if(h==-1||j<h){h=j;g=this.faces[i]}}j=ig.ActorEntity.getFaceVec(ig.ActorEntity.FACE8[g],a);Vec2.assign(c.face,j)}}})});ig.baked=!0;
ig.module("game.feature.combat.combat-assault").requires("game.feature.combat.model.combat-params","game.feature.combat.entities.ball").defines(function(){var b={type:"BALL",effects:"ball-assault",speed:250,maxBounce:0,timer:0.166,animation:{name:"default",sheet:{src:"media/entity/balls/default.png",width:16,height:16,offY:168},time:0.05,repeat:true,frames:[0],renderMode:"lighter",guiSprites:true},attack:{type:"NONE",visualType:"LIGHT",element:"HEAT",damageFactor:0.6,reverse:false,spFactor:1,guardable:"",
skillBonus:"MELEE_DMG",hints:["NO_PUZZLE"]},behaviors:[]};sc.ASSAULT_PROJECTILES={};for(var a in sc.ELEMENT){var d=sc.ELEMENT[a],c=ig.copy(b);c.attack.element=a;c.animation.frames[0]=d;sc.ASSAULT_PROJECTILES[d]=new sc.BallInfo(c)}var e=Vec3.create(),f=Vec2.create();sc.AssaultTools={spawn:function(a,b,c){var d=a.params.getModifier("ASSAULT")*c;if(d){c=Math.max(1,Math.round(d/0.2));if(b=sc.ASSAULT_PROJECTILES[b]){b.data.attack.damageFactor=d/c;d=a.getAlignedPos(ig.ENTITY_ALIGN.BOTTOM,e);for(d.z=d.z+
Constants.BALL_HEIGHT;c--;){var k=Vec2.assign(f,a.face);Vec2.rotate(k,Math.PI*0.4*(Math.random()-0.5));Vec2.length(k,4);b.spawn(d.x+k.x,d.y+k.y,d.z,a,k)}}}}}});ig.baked=!0;
ig.module("game.feature.combat.combat-poi").requires("game.feature.combat.model.combat-params").defines(function(){sc.COMBAT_POI={};sc.COMBAT_POI.NAMED_ENTITY={_wm:{attributes:{name:{_type:"StringExpression",_info:"Name of entity to be searched"}}},getEntities:function(a,b){var d=ig.Event.getExpressionValue(b.name);(d=ig.game.namedEntities[d])&&a.push(d)}};sc.COMBAT_POI.NAMED_ENTITIES={_wm:{attributes:{namePart:{_type:"StringExpression",_info:"String included within name."}}},getEntities:function(a,
b){var d=ig.Event.getExpressionValue(b.namePart),g;for(g in ig.game.namedEntities){var h=ig.game.namedEntities[g];g.indexOf(d)!=-1&&!h._hidden&&a.push(h)}}};var b={ACCEPT:1,IGNORE:2,LAST_RESORT:3};sc.COMBAT_POI.ACTIVE_ENEMIES={_wm:{attributes:{enemyTypes:{_type:"Array",_info:"Types of enemy supported",_sub:{_type:"EnemySearch"},_optional:true},conditions:{_type:"CombatConditions",_info:"Combat condition to further filter enemies",_optional:true},self:{_type:"String",_info:"How to handle self enemy",
_select:b,_optional:true},allEnemies:{_type:"Boolean",_info:"If true, consider all enemies, not just active ones."}}},initSettings:function(a){a.conditions&&(a.conditions=new sc.CombatConditions(a.conditions));a.self=b[a.self]||b.ACCEPT},getEntities:function(a,d,f){var g;g=d.allEnemies?ig.game.getEntitiesByType(ig.ENTITY.Enemy):sc.combat.activeCombatants[sc.COMBATANT_PARTY.ENEMY];for(var h=g.length,i=null;h--;){var j=g[h];if(j&&!j.isDefeated()&&!(d.enemyTypes&&d.enemyTypes.indexOf(j.enemyName)==-1)&&
(!d.conditions||d.conditions.check(j,0))){if(j==f){if(d.self==b.IGNORE)continue;if(d.self==b.LAST_RESORT){i=j;continue}}a.push(j)}}a.length==0&&i&&a.push(i)}};var a=[],d=Vec3.create();sc.CombatPoI={initPoiFilter:function(a){if(!a)return null;var b=sc.COMBAT_POI[a.type];b&&(b.initSettings&&!window.wm)&&b.initSettings(a);return a},getClosestPoI:function(b,e,f,g,h){var i=sc.COMBAT_POI[b.type];if(!i)return null;a.length=0;var j;if(i.getEntities){i.getEntities(a,b,e);j=a}else if(i.filterEntities){j=e.getAlignedPos(ig.ENTITY_ALIGN.BOTTOM,
d);j.z=j.z-128;j=ig.game.getEntitiesInCircle(j,f,1,256);i.filterEntities(a,j,b);j=a}for(var b=j.length,i=null,k=0;b--;){var l=j[b];if(l){var o=ig.CollTools.getGroundDistance(e.coll,l.coll);if(o<=f){h&&(o=f-o);if(!i||o<k)if(!g||ig.navigation.isPathAvailable(e,l)){i=l;k=o}}}}return i}}});ig.baked=!0;
ig.module("game.feature.combat.combat-charge").requires("game.feature.combat.model.combat-params","game.feature.combat.entities.ball").defines(function(){var b=[new ig.Sound("media/sound/battle/charge-01-short.mp3",0.7),new ig.Sound("media/sound/battle/charge-02-short.mp3",0.7),new ig.Sound("media/sound/battle/charge-03-short.mp3",0.7),new ig.Sound("media/sound/battle/charge-04.mp3",0.7)],a=[0.4,0.5,0.6];sc.CombatCharge=ig.Class.extend({fx:null,darkness:null,soundHandle:null,init:function(a,b,e,f){this.entity=
a;this.entity.addEntityAttached(this);this.stereo=b;this.slowmo=e;this.camera=f},charge:function(d,c,e){if(!e){if(!this.darkness){this.darkness=new ig.DarknessHandle;ig.light.addDarknessHandle(this.darkness)}this.darkness.setTemporary(this.entity,a[c-1],-1,0.05,0.5);this.soundHandle&&this.soundHandle.stop();this.soundHandle=b[c-1].play()}this.fx&&this.fx.stop();this.fx=sc.combat.showCharge(this.entity,c,d);this.fx.setIgnoreSlowdown();if(this.slowmo&&!this.slowmoHandle){this.slowmoHandle=ig.slowMotion.add(0.1,
0.2,null);this.entity.coll.time.animStatic=true}if(this.camera){d=1+c*0.5/3;if(this.cameraHandle)this.cameraHandle.setZoom(d,0.5,KEY_SPLINES.JUMPY);else{this.cameraHandle=new ig.Camera.TargetHandle(new ig.Camera.EntityTarget(this.entity),0,0);this.cameraHandle.setZoom(d);ig.camera.pushTarget(this.cameraHandle,"FAST",KEY_SPLINES.EASE_OUT)}}},stop:function(){if(this.darkness){this.darkness.stop();this.darkness=null}if(this.soundHandle){this.soundHandle.stop();this.soundHandle=null;b[3].play()}if(this.fx){this.fx.stop();
this.fx=null}if(this.slowmoHandle){this.slowmoHandle.clear(0);this.slowmoHandle=null;this.entity.coll.time.animStatic=false}if(this.cameraHandle){ig.camera.removeTarget(this.cameraHandle,"NORMAL",KEY_SPLINES.EASE_OUT);this.cameraHandle=null}this.entity.removeEntityAttached(this)},onActionEndDetach:function(){this.stop()},onEntityKillDetach:function(){this.stop()}})});ig.baked=!0;
ig.module("game.feature.combat.combat-sweep").requires("impact.feature.effect.effect-sheet").defines(function(){sc.COMBAT_SWEEPS={};sc.COMBAT_SWEEPS.SPHEROMANCER={sheet:new ig.EffectSheet("sweeps"),keys:["default","heat","cold","shock","wave"],force:{radius:32,zHeight:24,centralAngle:0.5,duration:0.1,attack:{type:"MEDIUM",damageFactor:0.8,spFactor:1,skillBonus:"MELEE_DMG"},checkCollision:true}};sc.COMBAT_SWEEPS.SPHEROMANCER_FINISHER={sheet:new ig.EffectSheet("special-neutral"),keys:["finisherNeutral",
"finisherHeat","finisherCold","finisherShock","finisherWave"],force:{radius:32,zHeight:24,centralAngle:1.5,startAngle:-0.25,duration:0.3,attack:{type:"HEAVY",damageFactor:1,spFactor:1,skillBonus:"MELEE_DMG"},checkCollision:true}};sc.COMBAT_SWEEPS.TRIBLADER={sheet:new ig.EffectSheet("combat.triblader"),keys:["sweepNeutral","sweepHeat","sweepCold","sweepShock","sweepWave"],fxDuration:-1,force:{radius:48,zHeight:24,centralAngle:0.7,duration:0.2,attack:{type:"MEDIUM",fly:"HEAVY",damageFactor:1.15,spFactor:1,
skillBonus:"MELEE_DMG"},checkCollision:true}};sc.COMBAT_SWEEPS.TRIBLADER_FINISHER={sheet:new ig.EffectSheet("combat.triblader"),keys:["finisherNeutral","finisherHeat","finisherCold","finisherShock","finisherWave"],fxDuration:-1,force:{radius:48,zHeight:24,centralAngle:1.7,startAngle:-0.35,duration:0.4,attack:{type:"HEAVY",damageFactor:1.4,spFactor:1,skillBonus:"MELEE_DMG"},checkCollision:true}};sc.COMBAT_SWEEPS.QUADROGUARD={sheet:new ig.EffectSheet("combat.quadroguard"),keys:["shieldNeutral","shieldHeat",
"shieldCold","shieldShock","shieldWave"],fxRotOffset:{x:0,y:-20},force:{radius:40,zHeight:24,centralAngle:0.3,duration:0.1,alwaysFull:true,attack:{type:"HEAVY",damageFactor:1.5,spFactor:1,skillBonus:"MELEE_DMG"},checkCollision:true}};sc.COMBAT_SWEEPS.QUADROGUARD_FINISHER={sheet:new ig.EffectSheet("combat.quadroguard"),keys:["shieldNeutralFinisher","shieldHeatFinisher","shieldColdFinisher","shieldShockFinisher","shieldWaveFinisher"],fxRotOffset:{x:0,y:-20},force:{radius:40,zHeight:24,centralAngle:0.3,
duration:0.1,alwaysFull:true,attack:{type:"HEAVY",damageFactor:3,spFactor:1,skillBonus:"MELEE_DMG"},checkCollision:true}};sc.CombatSweep={show:function(b,a,d,c,e,f){var g=ig.copy(b.force);g.attack.element=d;f=f?c:0;e&&(g.clockwise=!g.clockwise);f&&(g.flipLeftFace=f);g=new sc.CircleHitForce(a,g);sc.combat.addCombatForce(g);a.addActionAttached(g);d=b.keys[d];e&&(d=d+"Rev");b=b.sheet.spawnOnTarget(d,a,{rotateFace:c,flipLeftFace:f,duration:b.fxDuration||0,rotOffset:b.fxRotOffset||false});a.addActionAttached(b)}}});
ig.baked=!0;
ig.module("game.feature.combat.entities.combatant-marble").requires("impact.feature.effect.effect-sheet","impact.base.entity").defines(function(){ig.ENTITY.CombatantMarble=ig.AnimatedEntity.extend({tileSheet:new ig.TileSheet("media/entity/enemy/combatant-marble.png",8,8),effects:new ig.EffectSheet("marble"),startPos:Vec2.create(),startZPos:0,target:null,timer:0,maxZHeight:0,maxTime:0,lineHandle:null,init:function(b,a,d,c){this.parent(b,a,d,c);this.coll.type=ig.COLLTYPE.NONE;this.coll.setSize(8,8,
8);this.coll.time.globalStatic=true;this.coll.shadow.size=8;this.target=c.target;Vec2.assign(this.startPos,this.coll.pos);this.startZPos=this.coll.pos.z;b=Vec2.length(Vec2.sub(this.target.getCenter(),this.coll.pos));b=Math.max(b,120);this.maxTime=0.3+Math.sqrt(b)/16;this.maxHeight=32+Math.sqrt(b)*8;b=Math.max(0,(this.startZPos-this.target.coll.pos.z)*0.6/this.maxTime);this.maxHeight=this.maxHeight+b;this.lineHandle=this.effects.spawnOnTarget("line",this,{duration:-1});this.lineHandle.coll.time.globalStatic=
true;b=new ig.LightHandle(this,ig.LIGHT_SIZE.XS,0,0,-1,1);ig.light.addLightHandle(b);this.initAnimations({sheet:this.tileSheet,name:"default",time:0.03,frames:[0,1,2,3,4,5],repeat:true})},update:function(){this.parent();this.timer=this.timer+ig.system.tick;var b=Math.min(1,this.timer/this.maxTime),b=KEY_SPLINES.EASE_IN.get(b),a=1-(2*b-1)*(2*b-1),d=this.target.getCenter(),c=this.target.coll.pos.z+this.target.coll.size.z+1;this.coll.pos.x=this.startPos.x*(1-b)+(d.x-this.coll.size.x/2)*b;this.coll.pos.y=
this.startPos.y*(1-b)+(d.y-this.coll.size.y/2)*b;this.coll.pos.z=this.startZPos*(1-b)+c*b+a*this.maxHeight;this.coll.baseZPos=0;if(this.timer>=this.maxTime){this.lineHandle.stop();this.effects.spawnOnTarget("explode",this).coll.time.globalStatic=true;this.target.onCombatMarbleReach(this);this.kill()}}})});ig.baked=!0;
ig.module("game.feature.combat.entities.hit-number").requires("impact.base.entity","impact.base.entity-pool").defines(function(){sc.HIT_NUMBER_SIZE={XXS:0,XS:1,S:2,M:3,L:4,XL:5};sc.HIT_NUMBER_COLOR={NORMAL:0,HEALING:1,CRITICAL:2,PLAYER_DAMAGE:3,PLAYER_HEALING:4,PLAYER_CRITICAL:5,ENEMY_SUM:6,PLAYER_SUM:7};sc.HIT_NUMBER_APPENDIX={NONE:0,SHIELD:1,STRONG:2,WEAK:3,PERFECT:4,WEAKNESS:5};var b={};sc.HitNumberEntityBase=ig.Entity.extend({offset:{x:0,y:0,z:0},oldNumber:0,number:0,digitCount:0,numberSize:0,
numberColor:0,numberAppendix:[],shuffleTime:0,alpha:1,zIndex:1E4,init:function(a,b,c,d){this.parent(a,b,c,d);this.coll.type=ig.COLLTYPE.NONE;this.coll.friction.ground=0;this.coll.time.globalStatic=true;this.coll.setSize(0,0,0)},initSprites:function(){},setNumber:function(a,b,c,d,f,g){this.oldNumber=g===void 0?this.number:g;this.number=a;this.numberSize=b;this.numberColor=c;this.numberAppendix.length=0;d&&this.numberAppendix.push.apply(this.numberAppendix,d);this.digitCount=0;a=this.number;if(a!==
void 0){do{this.digitCount++;a=Math.floor(a/10)}while(a)}if(this.numberAppendix)this.digitCount=this.digitCount+this.numberAppendix.length;this.offset.x=this.digitCount*e[this.numberSize].offsetX/2;this.offset.y=e[this.numberSize].offsetY;this.shuffleTime=f;this.setSpriteCount(this.digitCount,true)},updateSprites:function(){var a=this.alpha,b=this.number;if(this.shuffleTime&&Math.abs(b-this.oldNumber)>=8){this.shuffleTime=this.shuffleTime-ig.system.actualTick;if(this.shuffleTime<0)this.shuffleTime=
0;b=Math.floor(this.oldNumber+(b-this.oldNumber)*(1-this.shuffleTime/h))}for(var c=0,d,e=this.numberAppendix.length;e--;){d=9+this.numberAppendix[e];this._setupSprite(c,d,a);c++}if(b!==void 0){do{d=b%10;b=Math.floor(b/10);this._setupSprite(c,d,a);c++}while(b)}},_setupSprite:function(a,d,f){var d=d+c*this.numberColor,g=e[this.numberSize],d=g.sheet.getTileSrc(b,d),h=this.sprites[a];if(h){h.setPos(this.coll.pos.x-this.offset.x+(this.digitCount-a-1)*g.offsetX,this.coll.pos.y-this.offset.y-this.coll.pos.z+
this.zIndex,this.zIndex);h.setSize(g.sheet.width,g.sheet.height,0);h.setImageSrc(g.sheet.image,d.x,d.y);h.setAlpha(f)}}});ig.ENTITY.HitNumber=sc.HitNumberEntityBase.extend({timer:0,blockerEntry:null,combatant:null,init:function(a,b,c,d){this.parent(a,b,c,d);this._initHitNumber(d)},reset:function(a,b,c,d){this.parent(a,b,c,d);this._initHitNumber(d)},_initHitNumber:function(a){this.combatant=a.combatant;this.setNumber(a.number,a.numberSize,a.numberColor,a.numberAppendix,h,0);this.timer=f;this.alpha=
1;this.blockerEntry=sc.HitNumberTools.placeHitNumber(this.coll,this.offset.x,this.offset.y)},clear:function(){if(this.timer>g)this.timer=g;this.unlock()},update:function(){this.timer=this.timer-ig.system.actualTick;if(this.timer<=0)this.kill();else if(this.timer<=g){this.alpha=this.timer/0.3;this.unlock();this.coll.vel.z=this.coll.vel.z+ig.system.actualTick*400}},unlock:function(){if(this.blockerEntry){this.combatant.stunData.hitNumberEntities.erase(this);d.erase(this.blockerEntry);this.blockerEntry=
null}},onKill:function(a){this.unlock();this.parent(a)}});ig.EntityPool.enableFor(ig.ENTITY.HitNumber);Vec2.create();ig.ENTITY.HitNumberSum=sc.HitNumberEntityBase.extend({timer:0,disappear:false,combatant:null,entityOff:Vec2.create(),init:function(a,b,c,d){this.parent(a,b,c,d);this._initHitNumber(d);this.zIndex=2E4},reset:function(a,b,c,d){this.parent(a,b,c,d);this._initHitNumber(d)},_initHitNumber:function(a){this.combatant=a.combatant;this.combatant.stunData.damageSumEntity=this;this.alpha=1;this.timer=
g;this.disappear=false;this._updatePos();this.updateSum(true);this.blockerEntry=sc.HitNumberTools.placeHitNumber(this.coll,this.offset.x,this.offset.y,true)},updateEntityOffset:function(){var a=sc.SMALL_BOX_ALIGN.TOP,b=0;if(this.combatant.dmgZFocus){a=sc.SMALL_BOX_ALIGN.BOTTOM;b=this.combatant.dmgZFocus}else if(this.combatant.cameraZFocus){a=sc.SMALL_BOX_ALIGN.BOTTOM;b=this.combatant.cameraZFocus+48}a(this.entityOff,this.combatant.coll);this.entityOff.y=this.entityOff.y-b},updateSum:function(a){var b=
this.combatant.party==sc.COMBATANT_PARTY.PLAYER?sc.HIT_NUMBER_COLOR.PLAYER_SUM:sc.HIT_NUMBER_COLOR.ENEMY_SUM;this.combatant.stunData.damageSum<0&&(b=this.combatant.party==sc.COMBATANT_PARTY.PLAYER?sc.HIT_NUMBER_COLOR.PLAYER_HEALING:sc.HIT_NUMBER_COLOR.HEALING);this.setNumber(Math.abs(this.combatant.stunData.damageSum),sc.HIT_NUMBER_SIZE.XL,b,null,h,a?0:void 0)},clear:function(){this.timer=g;this.disappear=true},update:function(){if(this.timer){this.timer=this.timer-ig.system.actualTick;if(this.timer<=
0){this.timer=0;this.disappear&&this.kill()}}},deferredUpdate:function(){this._updatePos();sc.HitNumberTools.updateBlocker(this.blockerEntry,this.coll,this.offset.x,this.offset.y)},_updatePos:function(){this.updateEntityOffset();var a=this.combatant,b=this.timer/g;this.disappear&&(b=1-b);b=KEY_SPLINES.EASE_IN.get(b);this.coll.setPos(a.coll.pos.x+this.entityOff.x,a.coll.pos.y+256,a.coll.pos.z-this.entityOff.y+256+b*(this.disappear?1:-1)*16);this.alpha=1-b},onKill:function(a){if(this.blockerEntry){d.erase(this.blockerEntry);
this.blockerEntry=null}this.parent(a)}});ig.EntityPool.enableFor(ig.ENTITY.HitNumber);ig.perf.hitNumberFactors=false;var a=[];ig.ENTITY.HitNumber.spawnHitNumber=function(b,c,d,e,f,g,h,p){var r;r=e<0.5?sc.HIT_NUMBER_SIZE.XXS:e<1?sc.HIT_NUMBER_SIZE.XS:e<1.5?sc.HIT_NUMBER_SIZE.S:e<2?sc.HIT_NUMBER_SIZE.M:sc.HIT_NUMBER_SIZE.L;var t=0,t=c.party===sc.COMBATANT_PARTY.PLAYER?d<0?sc.HIT_NUMBER_COLOR.PLAYER_HEALING:h?sc.HIT_NUMBER_COLOR.PLAYER_CRITICAL:sc.HIT_NUMBER_COLOR.PLAYER_DAMAGE:d<0?sc.HIT_NUMBER_COLOR.HEALING:
h?sc.HIT_NUMBER_COLOR.CRITICAL:sc.HIT_NUMBER_COLOR.NORMAL;if(ig.perf.hitNumberFactors)d=e=Math.abs(Math.round(e*100));else e=Math.abs(d);a.length=0;if(g){if(g==sc.SHIELD_RESULT.PERFECT){a.push(sc.HIT_NUMBER_APPENDIX.PERFECT);e=void 0}a.push(sc.HIT_NUMBER_APPENDIX.SHIELD)}else f>=1.25?a.push(sc.HIT_NUMBER_APPENDIX.STRONG):f<=0.75&&a.push(sc.HIT_NUMBER_APPENDIX.WEAK);p&&a.push(sc.HIT_NUMBER_APPENDIX.WEAKNESS);for(f=c.stunData.hitNumberEntities;f.length>2;)f[0].clear();r=ig.game.spawnEntity(ig.ENTITY.HitNumber,
b.x,b.y-8,b.z,{number:e,numberSize:r,numberColor:t,numberAppendix:a,combatant:c});c.stunData.hitNumberEntities.push(r);c.stunData.damageSum=c.stunData.damageSum+d;c.stunData.damageSumHits=c.stunData.damageSumHits+1;c.stunData.damageSumTimer=0.5;c.stunData.damageSumHits>1&&Math.abs(c.stunData.damageSum)>1&&!c.stunData.damageSumEntity?ig.game.spawnEntity(ig.ENTITY.HitNumberSum,b.x,b.y-8,b.z,{combatant:c}):c.stunData.damageSumEntity&&c.stunData.damageSumEntity.updateSum()};ig.ENTITY.HitNumber.spawnHealingNumber=
function(a,b,c){var d=sc.HIT_NUMBER_SIZE.M,e=b.isPlayer?sc.HIT_NUMBER_COLOR.PLAYER_HEALING:sc.HIT_NUMBER_COLOR.HEALING;ig.game.spawnEntity(ig.ENTITY.HitNumber,a.x,a.y-8,a.z,{number:Math.abs(c),numberSize:d,numberColor:e,numberAppendix:null,combatant:b})};var d=[];sc.HitNumberTools={placeHitNumber:function(a,b,c,e){var f=a.pos.x,g=a.pos.y,h=a.pos.z,b={xMin:f-b-2,yMin:g-h-c-1,xMax:f+b+2,yMax:g-h};if(!e){var e=a.pos.x,f=a.pos.y,g=true,p=Math.random()<0.5;do for(var r=0,t=false,q=0;q<d.length;++q){var s=
d[q];if(!(s.xMin>=b.xMax||s.xMax<=b.xMin||s.yMin>=b.yMax||s.yMax<=b.yMin)){t=true;r=p?Math.min(r,s.xMin-b.xMax):Math.max(r,s.xMax-b.xMin);q=s.yMin-b.yMax;if(g&&Math.abs(f-a.pos.y-q)>Math.abs(e-a.pos.x-r)){g=false;a.pos.y=f;b.yMin=f-h-c-1;b.yMax=f-h;b.xMin=b.xMin+r;b.xMax=b.xMax+r;a.pos.x=a.pos.x+r}else{b.yMin=b.yMin+q;b.yMax=b.yMax+q;a.pos.y=a.pos.y+q}break}}while(t)}d.push(b);return b},updateBlocker:function(a,b,c,d){var e=b.pos.x,f=b.pos.y,b=b.pos.z;a.xMin=e-c-2;a.yMin=f-b-d-1;a.xMax=e+c+2;a.yMax=
f-b}};var c=16,e={"0":{offsetX:7,offsetY:8,sheet:new ig.TileSheet("media/entity/map-gui/hit-numbers.png",8,8,0,0,c)},1:{offsetX:7,offsetY:8,sheet:new ig.TileSheet("media/entity/map-gui/hit-numbers.png",8,8,128,0,c)},2:{offsetX:7,offsetY:9,sheet:new ig.TileSheet("media/entity/map-gui/hit-numbers.png",8,12,0,48,c)},3:{offsetX:8,offsetY:9,sheet:new ig.TileSheet("media/entity/map-gui/hit-numbers.png",12,12,128,48,c)},4:{offsetX:9,offsetY:11,sheet:new ig.TileSheet("media/entity/map-gui/hit-numbers.png",
12,12,0,120,c)},5:{offsetX:10,offsetY:12,sheet:new ig.TileSheet("media/entity/map-gui/hit-numbers.png",12,12,0,192,c)}},f=1,g=0.3,h=0.2});ig.baked=!0;
ig.module("game.feature.combat.entities.combatant").requires("game.feature.npc.entities.sc-actor","game.feature.combat.combat","game.feature.combat.entities.hit-number","game.feature.combat.model.combat-params","impact.feature.effect.effect-sheet","game.feature.model.options-model","impact.feature.terrain.terrain","game.feature.combat.model.proxy").defines(function(){ig.terrain.registerDangerTerrain(ig.TERRAIN.COAL,true);ig.terrain.registerDangerTerrain(ig.TERRAIN.WATER,true);ig.terrain.registerDangerTerrain(ig.TERRAIN.HIGHWAY,
true);sc.SHIELD_RESULT={NONE:0,REGULAR:1,PERFECT:2,NEUTRALIZE:3};sc.COMBAT_FLY_LEVEL={LIGHT:{vel:100,stun:0.2,jump:0},MEDIUM:{vel:200,stun:0.25,jump:0},HEAVY:{vel:250,stun:0.3,jump:100,bounciness:0.2,airFriction:0.5},MASSIVE:{vel:300,stun:0.55,jump:150,bounciness:0.5,airFriction:0.3,far:true},"MASSIVE+":{vel:400,stun:0.7,jump:180,bounciness:0.5,airFriction:0.2,far:true},"MASSIVE++":{vel:500,stun:0.9,jump:200,bounciness:0.5,airFriction:0.15,far:true},"MASSIVE+++":{vel:600,stun:1,jump:200,bounciness:0.5,
airFriction:0.13,far:true}};var b=Vec2.create(),a=Vec2.create(),d=Vec3.create(),c=Vec3.create(),e={},f={damageResult:void 0,attackType:void 0,flyLevel:void 0,hitStable:void 0,damageFactor:void 0,weakness:false,alignFace:false,ignoreHit:false};sc.BasicCombatant=sc.ActorEntity.extend({tackle:{attackInfo:null,orthoDirFactor:0,blocked:[],hitCount:0,cancelOnHit:0},combo:{damageCeiling:null,hitCombatants:[],dmgSum:0,blockedDamage:0,blockedFactor:0,guardedHits:0,guardedEntity:null,hitProxy:null,guardTrapTime:0},
target:null,tmpTarget:null,replaceTargets:null,ignoreTaunts:false,getTarget:function(a){var b=this.tmpTarget||this.target;if(!a&&b&&b.replaceTargets&&!sc.pvp.isActive()){a=b.replaceTargets[0];return this.ignoreTaunts&&a.group=="taunt"?b:a}return b},hasBlockEntity:function(){var a=this.combo.guardedEntity;return!a||a.isBall||a instanceof sc.CircleHitForce&&a.pos?false:a.getCombatant()instanceof ig.ENTITY.Combatant},setTackle:function(a,b,c,d){this.tackle.attackInfo=a;this.tackle.orthoDirFactor=b||
0;this.tackle.blocked.length=0;if(d)(a=this.combo.hitCombatants[this.combo.hitCombatants.length-1])&&this.tackle.blocked.push(a.id);this.tackle.hitCount=0;this.tackle.cancelOnHit=c||false;if(this.tackle.attackInfo){c=this.coll;c=ig.game.getEntitiesInRectangle(c.pos.x,c.pos.y,c.pos.z,c.size.x,c.size.y,c.size.z,this);a=c.length;for(a=0;a<c.length;++a)this.checkTackle(c[a],null,true)}},getElement:function(){return this.tackle.attackInfo?this.tackle.attackInfo.element:sc.ELEMENT.NEUTRAL},getAttackInfo:function(){for(var a=
this.actionAttached,b=a.length;b--;)if(a[b]instanceof sc.CircleHitForce)return a[b].attackInfo;return this.tackle.attackInfo||null},collideWith:function(a){this.checkTackle(a,null)},checkTackle:function(a,c,d){if(this.tackle.attackInfo&&a.isCombatant&&a.party!=this.party){if(a.coll.pos.z>=this.coll.pos.z+this.coll.size.z||this.coll.pos.z>=a.coll.pos.z+a.coll.size.z||a.coll.subColls.length>0)return false;var e=a.coll.parentColl?a.coll.parentColl.entity:a;if(this.tackle.blocked.indexOf(e.id)==-1){if(d&&
this.coll.maxVel>0){d=ig.CollTools.getDistVec2(this.coll,a.coll,b);if(Vec2.dot(d,this.face)<0)return false}if(a.damage(c||this,this.tackle.attackInfo)){this.tackle.blocked.push(e.id);this.tackle.hitCount++;if(this.tackle.cancelOnHit)this.tackle.attackInfo=null;return true}}}return false},getHitCenter:function(a,b){return this.getOverlapCenterCoords(a,b)},getCombatant:function(){return this},getCombatantRoot:function(){return this},getHitVel:function(c,d){var e=d||{};Vec2.assign(e,this.coll.vel);Vec2.isZero(e)&&
this.coll.maxVel*this.coll.relativeVel>0&&Vec2.assign(e,this.coll.accelDir);if(Vec2.isZero(e)){Vec2.assign(e,c.coll.vel);Vec2.flip(e)}if(this.tackle.orthoDirFactor){Vec2.assign(b,e);Vec2.rotate90CW(b);ig.CollTools.getDistVec2(this.coll,c.coll,a);Vec2.dot(b,a)<0&&Vec2.flip(b);Vec2.lerp(e,b,this.tackle.orthoDirFactor,e)}return e},setHitProxy:function(a,b,c,d){this.combo.hitProxy=new sc.HitProxyConnect(a,b,c,d)},spawnHitProxy:function(a,b,c){this.combo.hitProxy&&this.combo.hitProxy.spawn(a,this,this.face,
b,c)},onVarAccess:function(a,b){return b[1]=="target"?ig.vars.forwardEntityVarAccess(this.getTarget(),b,2):b[1]=="hasTmpTarget"?!!this.tmpTarget:b[1]=="manualKill"?this.manualKill:b[1]=="defeated"?this.dying>sc.DYING_STATE.ALIVE:b[1]=="lastHitElement"?this.stunData.lastHitElement:b[1]=="blockedDamage"?this.combo.blockedDamage:b[1]=="blockedFactor"?this.combo.blockedFactor:b[1]=="hpFactor"?this.params.getHpFactor():this.parent(a,b)}});sc.ReplaceTargetHandle=ig.Class.extend({combatant:null,init:function(a,
b){this.combatant=a;b.addActionAttached(this);if(!this.combatant.replaceTargets)this.combatant.replaceTargets=[];this.combatant.replaceTargets.push(b)},onActionEndDetach:function(a){if(this.combatant.replaceTargets){this.combatant.replaceTargets.erase(a);if(this.combatant.replaceTargets.length==0)this.combatant.replaceTargets=null}}});sc.DYING_STATE={ALIVE:0,KILL_HIT:1,DYING:2};ig.ENTITY.Combatant=sc.BasicCombatant.extend({params:null,isCombatant:true,party:0,material:sc.COMBATANT_MATERIAL.METAL,
damageTimer:0,defeatNotified:false,dying:sc.DYING_STATE.ALIVE,skipRumble:false,deathEffect:null,manualKill:null,invincibleTimer:0,stunThreshold:0,stunCombatant:null,stunSteps:[],stunData:{time:0,hits:0,damage:0,resetTimer:0,stunEscapeTime:0,damageSum:0,damageSumHits:0,damageSumEntity:null,lastHitElement:0,hitNumberEntities:[],damageSumTimer:0},targetedBy:[],threat:null,regenFactor:0,regenTimer:0,walkAnims:{idle:null,preMove:null,move:null,moveRev:null,run:null,runRev:null,brake:null,preIdle:null,
jump:null,fall:null,hover:null,preHoverMove:null,hoverMove:null,hoverMoveRev:null,land:null,damage:null,postDamage:null,damageFly:null,damageFall:null,pvpDown:null},hitStable:0,hitIgnore:false,statusGui:null,shieldsConnections:[],spikeDmg:{baseFactor:0,tmpFactor:0,receiveStash:[]},pvp:{active:false,enemies:[],round:0,points:{}},respawn:{dmgFactor:0.1,pos:Vec3.create(),oldPos:Vec3.create(),timer:0,terrain:null},effects:{death:new ig.EffectSheet("combatant")},init:function(a,b,c,d){this.parent(a,b,
c,d);Vec3.assign(this.respawn.pos,this.coll.pos)},show:function(a){this.parent(a);this.statusGui=new ig.GUI.StatusBar(this);this.params&&this.params.initStatusFx();ig.gui.addGuiElement(this.statusGui)},hide:function(){this.clearDamageSum();this.statusGui&&this.statusGui.remove();this.statusGui=null;this.parent()},hasStun:function(){return this.damageTimer>0},setRespawnPoint:function(a){Vec3.assignC(this.respawn.pos,a.x-this.coll.size.x/2,a.y-this.coll.size.y/2,a.z)},isDefeated:function(){return this.params&&
this.params.isDefeated()},cancelStun:function(){if(this.damageTimer>0){this.stepTimer=this.damageTimer=0;this.stunSteps.length=0;this.defaultConfig.apply(this);this.walkAnims.postDamage&&this.setCurrentAnim(this.walkAnims.postDamage,true,this.walkAnims.idle);this.walkAnims.preIdle&&this.setCurrentAnim(this.walkAnims.preIdle,true,this.walkAnims.idle)}},onStunEnd:null,setTarget:function(a,b){if(!this._killed&&this.target!=a){!this.target&&a?sc.combat.addActiveCombatant(this):this.target&&!a&&sc.combat.removeActiveCombatant(this);
if(a&&b)this.targetFixed=true;this.target&&this.target._removeTargetedBy&&this.target._removeTargetedBy(this);(this.target=a)&&this.target._addTargetedBy&&this.target._addTargetedBy(this)}},setReplaceTarget:function(a){return new sc.ReplaceTargetHandle(this,a)},_addTargetedBy:function(a){this.targetedBy.push(a)},_removeTargetedBy:function(a){this.targetedBy.erase(a)},onEnemyEvent:null,sendEnemyEvent:function(a,b){for(var c=this.targetedBy.length;c--;){var d=this.targetedBy[c];if(d.onEnemyEvent)d.onEnemyEvent(this,
a,b)}},hasShield:function(a){for(var b=this.shieldsConnections.length;b--;)if(this.shieldsConnections[b].shield.name==a)return true;return false},updateShields:function(){for(var a=this.shieldsConnections.length;a--;)if(this.shieldsConnections[a].update()){this.shieldsConnections[a].onDetach(this);this.shieldsConnections.splice(a,1)}},addShield:function(a,b){var c=new sc.CombatantShieldConnection(this,a,b);this.shieldsConnections.push(c);return c},removeShield:function(a){a.onDetach(this);this.shieldsConnections.erase(a)},
removeNamedShield:function(a){for(var b=this.shieldsConnections.length;b--;)if(this.shieldsConnections[b].shield.name==a){this.shieldsConnections[b].onDetach(this);this.shieldsConnections.splice(b,1)}},damage:function(a,b,c){if(sc.pvp.isActive()&&!sc.pvp.isCombatantInPvP(this)||sc.pvp.isCombatantInPvP(this)&&(sc.pvp.isBrake()||sc.pvp.isFinished()||sc.pvp.isKillHit())||!c&&this.coll.subColls.length>0)return false;if(this.invincibleTimer&&!b.hitInvincible&&!b.limiter.noAggro){this.onPerfectDash();return false}return this.elementFilter&&
a.getElement()!=this.elementFilter||this.party==sc.COMBATANT_PARTY.ENEMY&&(!this.target&&!b.limiter.noAggro)&&(!a.getCombatantRoot().isPlayer||!ig.EntityTools.isInScreen(this,32))?false:this.onDamage(a,b,c)},isShielded:function(a,b,c,d){for(var c=c&&c.partName,e=this.shieldsConnections.length,f=sc.SHIELD_RESULT.NONE;e--;){var g=this.shieldsConnections[e],n=g.shield;if(n.strength!=sc.SHIELD_STRENGTH.BLOCK_ALL&&b.guardable!=sc.GUARDABLE.ALWAYS){if(b.guardable==sc.GUARDABLE.NEVER)continue;if(b.guardable==
sc.GUARDABLE.FROM_ABOVE&&n.strength!=sc.SHIELD_STRENGTH.BLOCK_ABOVE)continue;if(n.hitResist<b.type)continue}if(n.isActive(this,a,b,c,g.isPerfect())&&n.getDamageFactor(b,this)<1){if(n.neutralize)return sc.SHIELD_RESULT.NEUTRALIZE;if(d){if(n.stableOverride>d.hitStable)d.hitStable=n.stableOverride;d.damageFactor=g.isPerfect()?0:d.damageFactor*n.getDamageFactor(b,this)}f=Math.max(f,g.isPerfect()?sc.SHIELD_RESULT.PERFECT:sc.SHIELD_RESULT.REGULAR)}}return f},getSpikeShieldFactor:function(){for(var a=1,
b=this.shieldsConnections.length;b--;){var c=this.shieldsConnections[b].shield;c.reduceSpikeDamage()&&(a=a*c.baseFactor)}return a},onPreDamageModification:function(){return false},onPerfectDash:function(){},onStunLockClear:function(){this.damageTimer=0.01;this.stunSteps.length=0},onDamage:function(a,c,g){var k=this.hitStable,l,o=c.type,m=c.visualType,n=c.fly,p=c.reverse,r=g||this,t=this.hitIgnore;e.hitStable=k;e.damageFactor=1;var q=this.isShielded(a,c,g,e),k=e.hitStable;l=e.damageFactor;var s=a.getHitCenter(r,
d),v=a.getCombatant(),y=v.getCombatantRoot();if(this.params&&this.params.isDefeated()||!this.statusGui)return false;var u;if(q==sc.SHIELD_RESULT.NEUTRALIZE){sc.combat.showHitEffect(r,s,sc.ATTACK_TYPE.NONE,c.element,q);return true}if(!c.damageFactor||c.limiter.onlyHitProxy){c.limiter.noHitProxy||(a.spawnHitProxy?a.spawnHitProxy(r,null,s):v.spawnHitProxy(r,null,s));return true}this.params&&c.attackerParams&&(u=this.params.getDamage(c,l,v,q,t));f.weakness=false;f.alignFace=false;f.ignoreHit=false;f.survive=
false;f.damageFactor=l;var z=q;l=false;this.stunData.lastHitElement=c.element;if(this.onPreDamageModification(f,a,c,g,u,q,t)){k=f.hitStable==void 0?k:f.hitStable;f.hitStable==sc.ATTACK_TYPE.NONE&&(z=false);if(f.attackType!=void 0)m=o=f.attackType;if(f.damageResult&&u)u=f.damageResult;if(f.survive&&u)u.damage=this.params.currentHp-1;n=f.flyLevel||n;f.damageResult=void 0;f.attackType=void 0;f.flyLevel=void 0;f.hitStable=void 0;l=f.alignFace;t=this.hitIgnore}else if(f.ignoreHit)return false;sc.combat.isDamageIgnore()&&
(u=null);c.limiter.noHitProxy||(a.spawnHitProxy?a.spawnHitProxy(r,u,s):v.spawnHitProxy(r,u,s));if(t&&o<sc.ATTACK_TYPE.BREAK){c.limiter.noDmg||sc.combat.showHitEffect(r,s,sc.ATTACK_TYPE.NONE,c.element);return true}f.weakness&&this.statusGui.setStatusEntry("BREAK",f.weakness);if(v!=r){v.combo.hitCombatants.erase(r);v.combo.hitCombatants.push(r)}if(u&&!c.limiter.noDmg){g=Math.max(1,this.params.getStat("hp")*this.stunThreshold*sc.combat.getGlobalDmgFactor(this.party));k>sc.ATTACK_TYPE.NONE&&(u.damage<=
g&&!c.noIronStance)&&(k=sc.ATTACK_TYPE.MASSIVE);if(this.party==sc.COMBATANT_PARTY.ENEMY&&y.isPlayer&&this.params.getHpFactor()==1&&u.damage>=this.params.getStat("hp")){sc.stats.addMap("combat","oneHitKills",1);sc.arena.onHitKill(this)}sc.arena.onPreDamageApply(this,u,q,v,c);this.params.applyDamage(u,c,v);v.combo.dmgSum=v.combo.dmgSum+u.damage;y.addSpikeDamage(u,this.spikeDmg.baseFactor+this.spikeDmg.tmpFactor,this,q,a);this.onDamageTaken&&this.onDamageTaken(u.damage,q);if(y)y.onTargetHit(this,c,u,
q,a);sc.options.get("damage-numbers")&&!sc.combat.hideDamageNumbers&&(sc.options.get("damage-numbers-crit")?u.critical&&ig.ENTITY.HitNumber.spawnHitNumber(s,this,u.damage,u.baseOffensiveFactor,u.defensiveFactor,q,u.critical,f.weakness):ig.ENTITY.HitNumber.spawnHitNumber(s,this,u.damage,u.baseOffensiveFactor,u.defensiveFactor,q,u.critical,f.weakness))}k=k>=o&&(!this.params||!this.params.isLocked());this.params&&(this.params.isLocked()&&!this.params.isLockedBy(v)&&!this.params.isLockedBy(y))&&(k=true);
o=this.params&&this.params.isLocked();if(!k){this.stunCombatant=v;for(v=c.stunSteps.length;v--;){q=c.stunSteps[v];q.preHit&&q.preHit(this,this.stunCombatant)}}if(o&&!this.params.isLocked()&&y.charging&&y.charging.executeLevel>=1)sc.arena.onLockEnd(this,c,u,y.charging.executeLevel);if(this.params&&this.params.isDefeated()){this._onDeathHit(y);m=sc.ATTACK_TYPE.BREAK;y=u?u.damage/this.params.getStat("hp"):0;y=y>=2?"MASSIVE+++":y>=1?"MASSIVE++":y>=0.5?"MASSIVE+":"MASSIVE";if(!n||sc.COMBAT_FLY_LEVEL[n].vel<
sc.COMBAT_FLY_LEVEL[y].vel)n=y;k=false}if(!c.limiter.noDmg){sc.combat.showHitEffect(r,s,m,c.element,z,u&&u.critical);u&&(u.damage>1E12?sc.combat.effects.hit.spawnOnTarget("hitExtra4",this):u.damage>1E9?sc.combat.effects.hit.spawnOnTarget("hitExtra3",this):u.damage>1E7?sc.combat.effects.hit.spawnOnTarget("hitExtra2",this):u.damage>1E5&&sc.combat.effects.hit.spawnOnTarget("hitExtra1",this))}r=a.getHitVel(this,b);if(l){Vec2.assign(this.face,r);Vec2.flip(this.face)}k||this.cancelAction();if(!n)switch(m){case sc.ATTACK_TYPE.LIGHT:n=
"LIGHT";break;case sc.ATTACK_TYPE.MEDIUM:n="MEDIUM";break;case sc.ATTACK_TYPE.HEAVY:n="HEAVY";break;case sc.ATTACK_TYPE.MASSIVE:case sc.ATTACK_TYPE.BREAK:n="MASSIVE"}m=m==sc.ATTACK_TYPE.BREAK;s=0;a.isBall&&c.hasHint("CHARGED")&&(s=c.attackerParams.getModifier("KNOCKBACK"));a=this.doDamageMovement(r,n,m,k,s,false,p,1);this.damageTimer=Math.max(this.damageTimer,a);if(!k&&this.stunCombatant){this.stunData.hits++;this.stunData.damage=this.stunData.damage+(u&&u.damage||0);this.stunData.resetTimer=0.5;
this.stepTimer=0;if(this.stunSteps.length>0)this.stunSteps.length=0;for(v=c.stunSteps.length;v--;){q=c.stunSteps[v];q.start&&q.start(this,this.stunCombatant);q.run(this,this.stunCombatant)||this.stunSteps.push(q)}}return true},regenPvp:function(a){this.dying=sc.DYING_STATE.ALIVE;this.params.revive(a);this.params.setRelativeSp(sc.SP_REGEN_FACTOR);sc.CombatProxyTools.clearEntityProxy(this);this.resetStunData()},onPvpEnd:function(a){if(a){sc.combat.notifyCombatantDefeated(this);this.defeatNotified=false}else{a=
"kill"+this.enemyName;sc.stats.getMap("combat",a)||sc.stats.setMap("combat",a,-1)}},setCombatStat:function(a,b){this.params&&this.params.setCombatStat(a,b)},getCombatStat:function(a,b){return this.params?this.params.getCombatStat(a,b):void 0},addCombatStat:function(a,b){this.params&&this.params.addCombatStat(a,b)},_onDeathHit:function(a){if(this.dying==sc.DYING_STATE.ALIVE){this.dying=sc.DYING_STATE.KILL_HIT;sc.combat.onCombatantDeathHit(a,this);ig.EffectTools.clearEffects(this);(a=new ig.Rumble.RumbleHandle("RANDOM",
"STRONG","FASTER",0.3,false,true))&&!this.skipRumble&&ig.rumble.addRumble(a);if(!sc.pvp.isCombatantInPvP(this)){this.effects.death.spawnOnTarget("pre_die",this,{duration:-1});this.coll.type=ig.COLLTYPE.IGNORE}}},addSpikeDamage:function(a,b,c,d,e){if(c.party!=sc.COMBATANT_PARTY.PLAYER||d){var f=this.getSpikeShieldFactor()*this.params.damageFactor,g=(this.params.getStat("defense")-c.params.getStat("defense")/2)/2,g=a.defReduced-a.offensiveFactor*g;if(d){c.combo.blockedDamage=c.combo.blockedDamage+Math.max(0,
g);c.combo.blockedFactor=c.combo.blockedFactor+a.offensiveFactor;c.combo.guardedHits=c.combo.guardedHits+1;c.combo.guardedEntity=e}if(b=Math.max(0,Math.round(g*b*f))){d=0;e=this.spikeDmg.receiveStash;for(f=e.length;f--;)d=d+e[f].timer;this.effects.death.spawnOnTarget("spikeDmg",this,{target2:c,target2Align:ig.ENTITY_ALIGN.CENTER,align:ig.ENTITY_ALIGN.CENTER}).setIgnoreSlowdown();this.spikeDmg.receiveStash.push({damage:b,timer:0.6-d,offensiveFactor:a.offensiveFactor})}}},updateSpikeDamage:function(){var a=
this.spikeDmg.receiveStash;if(this.isDefeated())a.length=0;if(a.length)for(a.last().timer-=ig.system.ingameTick;a.length&&a.last().timer<=0;){var b=a.pop(),c=b.damage;if(this.getSpikeShieldFactor()*this.params.damageFactor>0){this.effects.death.spawnOnTarget("spikeHit",this,{align:ig.ENTITY_ALIGN.CENTER}).setIgnoreSlowdown();this.instantDamage(c,b.offensiveFactor)}}},instantDamage:function(a,d,e){if(!this.params.isDefeated()){e=this.onInstantDamage&&this.onInstantDamage(a,e);this.onDamageTaken&&this.onDamageTaken(a);
e&&(a=this.params.currentHp-1);sc.arena.onPreInstantDamage(this,a);this.params.reduceHp(a);e=this.getAlignedPos(ig.ENTITY_ALIGN.CENTER,c);sc.options.get("damage-numbers")&&ig.ENTITY.HitNumber.spawnHitNumber(e,this,a,d,1,false,false,false);if(this.params.isDefeated()){this.cancelAction();this._onDeathHit(this);a=Vec2.assign(b,this.face);Vec2.flip(a);a=this.doDamageMovement(a,"MASSIVE",false,false,0);this.damageTimer=Math.max(this.damageTimer,a)}}},doDamageMovement:function(a,b,c,d,e,f,g,n){b=b&&sc.COMBAT_FLY_LEVEL[b];
if(!b)return 0;e=e||0;if(!d){this.cancelJump();this.walkAnims.damage&&this.setCurrentAnim(this.walkAnims.damage,true,null,true);this.animationFixed=true;this.coll.accelDir.x=this.coll.accelDir.y=0}var p=this.coll.weight==-1?0:Math.min(1,200/this.coll.weight);d&&(p=p/2);c&&!this.coll.groundConnect&&(p=1);n!==void 0&&(p=p*n);c=0;if(!a.x&&!a.y)a.y=1;e=b.vel*(1+e)*p;Vec2.length(a,e);g&&Vec2.flip(a);d?(Vec2.dot(this.coll.vel,a)<=0||Vec2.length(this.coll.vel)<e)&&Vec2.add(this.coll.vel,a):Vec2.assign(this.coll.vel,
a);if(!d){if(this.coll.groundConnect!=ig.COLL_GROUND_CONNECT.STRONG_FLIGHT)this.coll.friction.ground=1;c=b.stun;if(b.jump){if(this.coll.groundConnect!=ig.COLL_GROUND_CONNECT.STRONG_FLIGHT)this.fly.blocked=0.1;if(b.far){this.coll.type==ig.COLLTYPE.VIRTUAL&&this.coll.setType(ig.COLLTYPE.IGNORE);this.coll.float.height=this.floatHeightOnMove=0}if(p){this.coll.zBounciness=b.bounciness;this.coll.friction.air=b.airFriction;a=b.jump;!f&&!this.isDefeated()&&(a=Math.min(b.jump,Math.max(0,ig.CollTools.getJumpSpeedToHeight(this.coll,
this.coll.baseZPos+24))));this.coll.vel.z=a}}}return c},onTargetHit:function(a,b,c){if(b.spFactor){a=c.baseOffensiveFactor*b.spFactor;a=a*((1+c.defensiveFactor)/2);c.critical&&(a=a*1.5);c=this.params.getStat("focus");a=a*(0.75+Math.pow(c/400,0.75));a=a*b.spRepeatFactor;b.spRepeatFactor=0;this.params.addSp(a*0.1)}},heal:function(a,b){if(this.params&&!this.params.isDefeated()){var c=this.params.getHealAmount(a),e=this.getAlignedPos(ig.ENTITY_ALIGN.CENTER,d);sc.arena.onCombatantHeal(this,c);this.params.increaseHp(c);
sc.options.get("damage-numbers")&&!b&&ig.ENTITY.HitNumber.spawnHealingNumber(e,this,c);this.onHeal&&this.onHeal(a,c)}},instantDefeat:function(a,b){if(this.params){this.skipRumble=a;this.params.reduceHp(this.params.currentHp);this.damageTimer=0.01}else if(b){this.skipRumble=a;this.effects.death.spawnFixed("boom_medium",this.coll.pos.x+this.coll.size.x/2,this.coll.pos.y+this.coll.size.y+1,this.coll.pos.z+this.coll.size.z/2+this.coll.size.y/2+1,this).coll.time.globalStatic=true;this.coll.vel.x=this.coll.vel.y=
0;this.coll.zGravityFactor=0;this.dying=sc.DYING_STATE.DYING;this.damageTimer=0;this.stunSteps.length=0}},selfDestruct:function(a){this.dying=sc.DYING_STATE.DYING;this.params&&this.params.setDefeated();this.manualKill?ig.vars.set(this.manualKill,true):this.doManualKill(a,true)},doManualKill:function(a,b){sc.combat.notifyCombatantDefeated(this,a,b);this.kill()},doManualRevive:function(a){ig.EffectTools.clearEffects(this);sc.combat.notifyCombatantDefeated(this);this.dying=sc.DYING_STATE.ALIVE;this.params.revive(a);
this.params.setRelativeSp(sc.SP_REGEN_FACTOR);this.resetStunData()},onKill:function(a){this.setTarget(null);this.clearDamageSum();a?this.statusGui&&this.statusGui.forceRemove():this.statusGui&&this.statusGui.remove();this.statusGui=null;this.parent()},update:function(){if(this.respawn.timer){this.handleRespawn();this.parent()}this.coll.edgeSlipInward=this.damageTimer<=0&&!this.influencer.hasPush();this.updateSpikeDamage();if(this.invincibleTimer>0){this.invincibleTimer=this.invincibleTimer-ig.system.actualTick*
ig.slowMotion.getNonInvertSlowDown();if(this.invincibleTimer<0)this.invincibleTimer=0}var a=sc.combat.isInCombat(this);if((a||sc.newgame.get("waypoints-heals"))&&this.regenFactor&&this.params&&this.params.getHpFactor()<1){var c=0.5/6;this.regenFactor>=0.2*6?c=c/4:this.regenFactor>=0.1*6&&(c=c/2);this.regenTimer=this.regenTimer+ig.system.tick;if(this.regenTimer>60*c){this.regenTimer=this.regenTimer-60*c;sc.pvp.isActive()&&(c=c/4);sc.combat.showHealEffect(this);this.heal(new sc.HealInfo(this.params,
{value:this.regenFactor*c}))}}else this.regenTimer=0;this.updateShields();this.params&&this.params.update(a);this.params&&this.params.isDefeated()&&this.influencer.removeActionInfluences();if(this.dying==sc.DYING_STATE.DYING){if(!this.manualKill&&!sc.pvp.isCombatantInPvP(this)){this.damageTimer=this.damageTimer+ig.system.tick;this.coll.pos.z=this.coll.pos.z+ig.system.tick*16;this.damageTimer>=0.5&&this.kill()}}else if(this.damageTimer>0){this.stunData.time=this.stunData.time+ig.system.tick;this.stepTimer=
this.stepTimer+ig.system.tick;for(a=this.stunSteps.length;a--;)this.stunSteps[a].run(this,this.stunCombatant)&&this.stunSteps.splice(a,1);if(!this.params||!this.params.isLocked())if(this.damageTimer<=ig.system.tick)if(this.params&&this.params.isDefeated())if(this.dying==sc.DYING_STATE.ALIVE){this._onDeathHit(this.stunCombatant||this);if(!this.skipRumble){a=Vec2.assign(b,this.face);Vec2.flip(a);this.damageTimer=this.doDamageMovement(a,"MASSIVE",false,false,0)}}else{this.clearDamageSum();if(sc.pvp.isCombatantInPvP(this)){this.defaultConfig.apply(this);
this.setCurrentAnim("pvpDown")}else if(this.manualKill)ig.vars.set(this.manualKill,true);else{sc.combat.notifyCombatantDefeated(this);this.effects.death.spawnFixed("boom_medium",this.coll.pos.x+this.coll.size.x/2,this.coll.pos.y+this.coll.size.y+1,this.coll.pos.z+this.coll.size.z/2+this.coll.size.y/2+1,this).coll.time.globalStatic=true;this.coll.vel.x=this.coll.vel.y=0;this.coll.zGravityFactor=0}this.dying=sc.DYING_STATE.DYING;this.damageTimer=0;this.stunSteps.length=0}else{this.cancelStun();this.onStunEnd&&
this.onStunEnd()}else this.damageTimer=this.damageTimer-ig.system.tick}else{if(this.stunData.resetTimer>0){this.stunData.resetTimer=this.stunData.resetTimer-ig.system.tick;this.stunData.resetTimer<=0&&this.resetStunData()}if(this.stunData.damageSumTimer>0){this.stunData.damageSumTimer=this.stunData.damageSumTimer-ig.system.tick;this.stunData.damageSumTimer<=0&&this.clearDamageSum()}}this.parent()},resetStunData:function(){this.stunData.resetTimer=0;this.stunData.hits=0;this.stunData.damage=0;this.stunData.time=
0},clearDamageSum:function(){this.stunData.damageSumTimer=0;this.stunData.damageSum=0;this.stunData.damageSumHits=0;if(this.stunData.damageSumEntity){this.stunData.damageSumEntity.clear();this.stunData.damageSumEntity=null}},onTerrainUpdate:function(){this.checkQuickRespawn()},checkQuickRespawn:function(){var a=this.coll;if(a.pos.z<ig.game.minLevelZ&&!this.tooHighToFall&&!this.coll.ignoreCollision&&a._collData){var c=ig.EntityTools.getGroundEntity(this);if(!c||!(c instanceof ig.ENTITY.Elevator)){if(a.vel.z<
0)a.vel.z=0;if(this.dying!=sc.DYING_STATE.DYING&&this.params&&this.params.isDefeated())this.damageTimer=0.001;this.quickFall(ig.TERRAIN.HOLE);return}}if(this.coll.float.height&&!this.jumping){this.getCenter(b);!sc.combat.isRespawnBlocked(this.coll)&&(!this.respawn.timer&&!ig.CollTools.isCloseToEdge(this.coll)&&a.baseZPos>=ig.game.minLevelZ&&!ig.terrain.isDangerTerrain(ig.terrain.getTerrain(this.coll,false,true)))&&Vec3.assign(this.respawn.pos,this.coll.pos)}if(!(a.pos.z>a.baseZPos||this.jumping||
a.zGravityFactor==0)){c=this.stepStats.terrain;if(ig.terrain.isFallTerrain(c))this.quickFall(c);else{c=c==ig.TERRAIN.ICE&&(!this.params||!this.params.getModifier("BEGONE_ICE"))?0.12:this.isPlayer&&sc.newgame.get("ice-physics")?0.12:1;a.friction.terrain=c<=a.friction.terrain?c:(1-ig.system.tick*3)*a.friction.terrain+ig.system.tick*3*c;!ig.CollTools.isCloseToEdge(this.coll)&&(!sc.combat.isRespawnBlocked(this.coll)&&!ig.terrain.isDangerTerrain(this.stepStats.terrain)&&!this.respawn.timer)&&Vec3.assign(this.respawn.pos,
this.coll.pos)}}},quickFall:function(a){if(!this.respawn.timer&&(!this.params||!this.params.isDefeated()||this.isPlayer&&this.manualKill))if(!this.onFallBehavior||!this.onFallBehavior(a)){var b=this.getAlignedPos(ig.ENTITY_ALIGN.BOTTOM,d);this.animState.alpha=0;ig.EntityTools.isInScreen(this)||(a=ig.TERRAIN[sc.map._oobSoundTerrain]);a==ig.TERRAIN.HOLE?this.effects.death.spawnFixed("hole_fall",b.x,b.y,b.z):a==ig.TERRAIN.WATER?this.effects.death.spawnFixed("waterSplash",b.x,b.y,b.z):a==ig.TERRAIN.HIGHWAY?
this.effects.death.spawnFixed("hole_fall",b.x,b.y,b.z):a==ig.TERRAIN.COAL&&this.effects.death.spawnFixed("coalBurn",b.x,b.y,b.z);b=0;if(this.params){sc.combat.isDamageIgnore()||(b=Math.floor(this.params.getStat("hp")*this.fallDmgFactor));this.cancelAction()}this.doQuickRespawn(a,false,b)}},handleRespawn:function(){this.respawn.timer=this.respawn.timer-ig.system.tick;if(this.respawn.timer<0)this.respawn.timer=0;Vec3.assignC(this.coll.vel,0,0,0);Vec2.assignC(this.coll.accelDir,0,0);var a=this.respawn.timer/
this.respawn.duration,b=KEY_SPLINES.EASE_IN_OUT.get((1-a).limit(0,1)),b=Vec3.lerp(this.respawn.oldPos,this.respawn.pos,b,d);this.setPos(b.x,b.y,b.z);if(this.respawn.timer<=0.2&&!this.respawn.fx){this.respawn.fx=true;ig.game.effects.teleport.spawnOnTarget("showRespawn",this)}if(a<=0){this.animState.scaleX=1;this.animState.scaleY=1;this.invincibleTimer=0.3;if(this.onRespawnEnd)this.onRespawnEnd();this.nav.path.redoPathDeferred();if(!this.isDefeated()){this.cancelAction();if(!sc.combat.isDamageIgnore()&&
this.respawn.damage){this.instantDamage(this.respawn.damage,2);this.damageTimer=0.1;if(this.isDefeated()){this.animState.alpha=1;if(!this.isPlayer&&this.respawn.terrain){sc.stats.addMap("combat","enviroKills",1);sc.arena.onEnvironmentKill(this)}}this.respawn.terrain=null}}}},doQuickRespawn:function(a,b,c){Vec3.assignC(this.coll.vel,0,0,0);if(b){this.respawn.terrain=a;this.setPos(this.respawn.pos.x,this.respawn.pos.y,this.respawn.pos.z);this.nav.path.redoPathDeferred();ig.game.effects.teleport.spawnOnTarget("showFast",
this);if(this.onRespawnEnd)this.onRespawnEnd()}else{var b=this.getAlignedPos(ig.ENTITY_ALIGN.BOTTOM,d),e=Vec3.create(this.respawn.pos);Vec2.addMulF(e,this.coll.size,0.5);var f=(Vec3.distance(b,e)/640).limit(0.5,1.5);this.effects.death.spawnFixed("respawnLine",b.x,b.y,b.z,this,{target2Point:e,duration:f+0.1});Vec3.assign(this.respawn.oldPos,this.coll.pos);this.invincibleTimer=-1;this.respawn.timer=f+0.1;this.respawn.duration=f;this.respawn.damage=c||0;this.respawn.fx=false;this.respawn.terrain=a;this.isDefeated()||
this.setAction(g)}},onDefeat:function(){},getAnimPartyEntityClass:function(){return sc.CombatantAnimPartEntity}});sc.CombatantAnimPartEntity=ig.AnimationPartEntity.extend({isCombatant:true,init:function(a,b,c,d){this.parent(a,b,c,d);this.party=this.owner.party},damage:function(a,b){return this.owner.damage(a,b,this)},collideWith:function(a){this.owner.checkTackle(a,this)},getCombatant:function(){return this.owner},getCombatantRoot:function(){return this.owner},getHitCenter:function(a,b){return this.getOverlapCenterCoords(a,
b)},getHitVel:function(a,b){var c=b||{};Vec2.assign(c,this.coll._collData.frameVel);if(Vec2.isZero(c)){Vec2.assign(c,a.coll.vel);Vec2.flip(c)}return c}});var g=new ig.Action("quickRespawnAction",[{type:"WAIT",time:10}]);g.hint="battle";g.eventAction=true;ig.ACTOR_CONFIGS.COMBAT={classType:ig.ENTITY.Combatant,KEYS:{damageFactor:1,ballFactor:1,hitStable:"NONE",hitIgnore:false,tackleAttackInfo:null,invincibleTimer:0,elementFilter:0,spikeDmg:0,tmpTarget:null,fallDmgFactor:0.1},fromDataFix:function(){typeof this.hitStable==
"string"&&(this.hitStable=sc.ATTACK_TYPE[this.hitStable]);typeof this.elementFilter=="string"&&(this.elementFilter=sc.ELEMENT[this.elementFilter])},apply:function(a){if(a.params){a.params.damageFactor=this.damageFactor*1;a.params.ballFactor=this.ballFactor*1}a.hitStable=this.hitStable;a.hitIgnore=this.hitIgnore;a.tackle.attackInfo=this.tackleAttackInfo;a.invincibleTimer=this.invincibleTimer;a.elementFilter=this.elementFilter;a.spikeDmg.tmpFactor=this.spikeDmg;a.tmpTarget=this.tmpTarget;a.fallDmgFactor=
this.fallDmgFactor;a.combo.damageCeiling=null;a.combo.hitCombatants.length=0;a.combo.dmgSum=0;a.combo.blockedDamage=0;a.combo.blockedFactor=0;a.combo.guardedHits=0;a.combo.guardedEntity=null;a.combo.hitProxy=null;a.combo.guardTrapTime=0},load:function(a){if(a.params){this.damageFactor=a.params.damageFactor;this.ballFactor=a.params.ballFactor}this.hitStable=a.hitStable;this.hitIgnore=a.hitIgnore;this.tackleAttackInfo=a.tackle.attackInfo;this.invincibleTimer=a.invincibleTimer;this.elementFilter=a.elementFilter;
this.spikeDmg=a.spikeDmg.tmpFactor;this.tmpTarget=a.tmpTarget;this.fallDmgFactor=a.fallDmgFactor}}});ig.baked=!0;
ig.module("game.feature.combat.entities.food-icon").requires("impact.base.entity","impact.base.entity-pool").defines(function(){sc.FOOD_ICON_STATE={HOLD:0,BUBBLE:1,DONE:2};var b=["SANDWICH","GREEN_TEA","CROISSANT","BAGUETTE","RED_WINE","ICE_CREAM_S","ICE_CREAM_M","ICE_CREAM_L","WATER","SPICY_BUN","FRUIT_SALAT","RICE_CRACKER","VEGGIE_STICKS","STEAK","SALTY_ICE_CREAM","CHILLI","CHILLI_DOG","COLD_PLATE","LEMONADE","PEANUTS","HOT_SAUCE","PISTACHIO","ESPRESSO","COFFEE","KEBAB","KEBAB2","KEBAB3","RISOTTO",
"BEAR_BEER","GRAB_MEAD","FOX_SAKE","WHALE_WINE","ONE_UP","BURGER","SUSHI","SUSHIBURGER","RISING_STAR","DK_PEPPER","SPAETZLE","MAULTASCHE","DURIAN","PENGO_POP","BEAT_ZERO","WEREWOLF_STICK","MOONCAKE","GUACAMOLE_TOAST","WILLI_BUN","PUMPKIN_SPICE"];sc.FOOD_SPRITE={};for(var a=0;a<b.length;++a)sc.FOOD_SPRITE[b[a]]=a;Vec3.create();var d={};sc.FoodIconEntity=ig.Entity.extend({icon:0,combatant:null,offset:Vec2.create(),state:sc.FOOD_ICON_STATE.HOLD,foodSheet:new ig.TileSheet("media/entity/player/item-hold.png",
16,16,0,0),bubbleGfx:new ig.Image("media/entity/map-gui/hit-numbers.png"),timer:0,init:function(a,b,d,g){this.parent(a,b,d,g);this.coll.type=ig.COLLTYPE.NONE;this.coll.friction.ground=0;this.coll.time.globalStatic=true;this.coll.setSize(0,0,0);this.icon=g.icon;this.combatant=g.combatant;this.combatant.addActionAttached(this);this.timer=0.1},initSprites:function(){this.setSpriteCount(this.digitCount,true)},deferredUpdate:function(){if(this.timer>0){this.timer=this.timer-ig.system.tick;if(this.timer<=
0){this.timer=0;if(this.state==sc.FOOD_ICON_STATE.DONE){this.combatant.removeActionAttached(this);this.kill()}}}if(this.combatant){var a=this.combatant.coll;this.setPos(a.pos.x+a.size.x/2,a.pos.y+a.size.y,a.pos.z)}},setState:function(a,b){this.state=a;b?Vec2.assign(this.offset,b):Vec2.assignC(this.offset,0,0);this.setSpriteCount(0);this.timer=0.1},onActionEndDetach:function(){this.kill()},updateSprites:function(){var a=this.timer/0.1;this.state!=sc.FOOD_ICON_STATE.DONE&&(a=1-a);var b,f=0,g=0;if(this.state!=
sc.FOOD_ICON_STATE.HOLD){this.setSpriteCount(2,true);b=this.sprites[0];b.setPos(this.coll.pos.x-12+this.offset.x,this.coll.pos.y+2,this.coll.pos.z+28+2+this.offset.y);b.setSize(24,0,32);b.setPivot(12,16);b.setImageSrc(this.bubbleGfx,0,288);b.setAlpha(0.8);b.setTransform(a,a,0);b=this.sprites[1];f=0;g=38}else{this.setSpriteCount(1);b=this.sprites[0];f=-10;g=17}f=f+this.offset.x;g=g+this.offset.y;b.setPos(this.coll.pos.x+f-8,this.coll.pos.y+4,this.coll.pos.z+g+4);b.setSize(16,0,16);b.setPivot(8,8);
f=this.foodSheet.getTileSrc(d,this.icon);b.setImageSrc(this.foodSheet.image,f.x,f.y);b.setTransform(a,a,0)}})});ig.baked=!0;
ig.module("game.feature.combat.entities.drop").requires("impact.feature.effect.effect-sheet","impact.base.entity").defines(function(){var b=Vec3.create();sc.DROP_TYPE={HP:1,SP:2,ITEM:3,COIN:4};Vec2.create();sc.DropEntity=ig.AnimatedEntity.extend({effects:new ig.EffectSheet("drops"),animSheet:new ig.AnimationSheet({namedSheets:{small:{src:"media/entity/enemy/drops.png",width:8,height:8},medium:{src:"media/entity/enemy/drops.png",width:8,height:8,offX:48},big:{src:"media/entity/enemy/drops.png",width:16,
height:16,offY:8},coin:{src:"media/entity/enemy/drops.png",width:8,height:8,offX:96}},time:0.03,repeat:true,SUB:[{name:"healSmall",sheet:"small",frames:[0,1,2,3,4,5]},{name:"healMedium",sheet:"medium",frames:[0,1,2,3,4,5]},{name:"healBig",sheet:"big",frames:[0,1,2,3,4,5]},{name:"coin",sheet:"coin",frames:[0,1,2,3,2,1]},{name:"coinFlip",sheet:"coin",frames:[0,1,2,3]}]}),timer:0,fallTimer:1,target:null,dropType:0,effectValue:0,varIncrease:null,circleEffect:null,pickupEffect:null,isGeneric:false,init:function(a,
b,e,f){this.parent(a,b,e,f);this.coll.setType(ig.COLLTYPE.IGNORE);this.coll.setSize(8,8,8);this.coll.shadow.size=8;this.coll.zBounciness=1;this.coll.bounciness=0;this.coll.maxVel=250;this.coll.friction.ground=0.1;this.coll.friction.air=0.1;this.coll.accelSpeed=2;this.coll.zGravityFactor=0.6;Vec2.assignC(this.coll.vel,0,40);Vec2.rotate(this.coll.vel,Math.random()*Math.PI*2);this.coll.vel.z=150+Math.random()*70;this.dropType=sc.DROP_TYPE[f.dropType]||sc.DROP_TYPE.HP;this.effectValue=f.value;this.varIncrease=
f.varIncrease;this.isGeneric=f.isGeneric;this.circleEffect=f.circleEffect;this.pickupEffect=f.pickupEffect;this.timer=11;this.isGeneric?this.dropType==sc.DROP_TYPE.COIN&&this.setCurrentAnim("coin"):this.effectValue>=0.5?this.setCurrentAnim("healBig"):this.effectValue>=0.2?this.setCurrentAnim("healMedium"):this.setCurrentAnim("healSmall");a=new ig.LightHandle(this,ig.LIGHT_SIZE.XS,0,0,-1,1);ig.light.addLightHandle(a);f.target&&this.followTarget(f.target)},update:function(){if(this.target||!sc.model.isCutscene()){this.timer=
this.timer-ig.system.tick;if(this.target){var a=this.target.coll.pos.z+12-this.coll.pos.z;this.coll.float.height=this.target.coll.pos.z+12-this.coll.baseZPos;ig.CollTools.getDistVec2(this.coll,this.target.coll,this.coll.accelDir);if(Vec2.length(this.coll.accelDir)<16)Math.abs(a)<16||this.fallTimer<=0?this.isGeneric?this.doGenericPickUp(this.target):this.doHeal(this.target):this.fallTimer=this.fallTimer-ig.system.tick}else this.timer<=10.4&&!this.target&&this.findTarget();if(!this.varIncrease){if(this.timer<=
0.4)this.animState.alpha=this.timer/0.4;this.timer<=0&&this.kill()}}this.parent()},doGenericPickUp:function(a){this.pickupEffect&&this.effects.spawnOnTarget(this.pickupEffect,a);this.varIncrease&&ig.vars.add(this.varIncrease,1);a=this.getAlignedPos(ig.ENTITY_ALIGN.CENTER,b);this.effects.spawnFixed(this.circleEffect||"circle",a.x,a.y,a.z);this.kill()},doHeal:function(a){this.effects.spawnOnTarget("circle",this);this.effects.spawnOnTarget("healing",a);a.heal(new sc.HealInfo(null,{value:this.effectValue}));
a=this.getAlignedPos(ig.ENTITY_ALIGN.CENTER,b);this.effects.spawnFixed("circle",a.x,a.y,a.z);this.kill()},followTarget:function(a){if(this.timer<2)this.timer=2;this.target=a;this.coll.setType(ig.COLLTYPE.NONE);this.coll.float.variance=3;this.coll.float.maxSpeed=1E3;this.coll.float.accel=12;this.coll.friction.air=0.4;this.effects.spawnOnTarget("line",this,{duration:-1});this.effects.spawnOnTarget(this.circleEffect||"circle",this)},findTarget:function(){ig.game.playerEntity&&ig.game.playerEntity.distanceTo(this)<
120&&this.followTarget(ig.game.playerEntity)},onTouchGround:function(){if(this.coll.vel.z<80)this.coll.vel.z=80}});var a=Vec3.create();sc.DropEntity.spawnDrops=function(b,c,e,f,g,h){e={dropType:e,value:0,target:g,varIncrease:h};for(b=b.getAlignedPos(c,a);f>ig.COLLISION.EPS;){c=f>=0.6?0.5:f>=0.2?0.2:Math.min(0.1,f);e.value=c;ig.game.spawnEntity(sc.DropEntity,b.x,b.y,b.z,e);f=f-c}};sc.DropEntity.spawnGenericDrops=function(b,c,e){c={dropType:e.type,value:1,target:c,varIncrease:e.varIncrease,circleEffect:e.circleEffect,
pickupEffect:e.pickupEffect,isGeneric:true};b=b.getAlignedPos(e.align,a);for(e=~~(Math.random()*(e.max-e.min+1))+e.min;e>0;){c.value=1;ig.game.spawnEntity(sc.DropEntity,b.x,b.y,b.z,c);e--}}});ig.baked=!0;
ig.module("game.feature.combat.entities.item-drop").requires("impact.feature.effect.effect-sheet","impact.base.entity").defines(function(){var b={"item-default":0,"item-helm":1,"item-sword":2,"item-belt":3,"item-shoe":4,"item-items":5,"item-key":6,"item-trade":7};sc.ITEM_DROP_TYPE={ENEMY:{},PROP:{},EVENT_PROP:{preCollect:true},CHEST:{fly:true,preCollect:true}};var a={DUNGEON_KEY:0,DUNGEON_MASTER_KEY:1};sc.ItemDropEntity=ig.AnimatedEntity.extend({gfx:new ig.Image("media/entity/enemy/item-drops.png"),
effects:new ig.EffectSheet("marble"),sounds:{start:new ig.Sound("media/sound/drops/drop-start.ogg",0.9),"catch":new ig.Sound("media/sound/drops/drop-catch.ogg",0.6),catchLow:new ig.Sound("media/sound/drops/drop-low-white.ogg",1),catchNormal:new ig.Sound("media/sound/drops/drop-normal-bronze.ogg",1),catchRare:new ig.Sound("media/sound/drops/drop-rare-silver.ogg",1),catchLegendary:new ig.Sound("media/sound/drops/drop-legendary-gold.ogg",1),catchUnique:new ig.Sound("media/sound/drops/drop-unique-purple.ogg",
1)},flying:false,target:null,timer:0,startPos:Vec2.create(),startZPos:0,maxTime:0,maxHeight:0,item:0,amount:0,collected:false,dropType:null,fromCombatant:false,init:function(c,d,f,g){this.parent(c,d,f,g);this.dropType=g.dropType||sc.ITEM_DROP_TYPE.ENEMY;this.coll.setType(ig.COLLTYPE.IGNORE);this.coll.setSize(16,4,12);this.coll.shadow.size=8;this.coll.zBounciness=1;this.coll.bounciness=0;this.coll.maxVel=250;this.coll.friction.ground=0.1;this.coll.friction.air=0.1;this.coll.accelSpeed=2;this.coll.zGravityFactor=
0.6;if(this.dropType.fly){this.coll.float.height=24;this.coll.float.variance=4}g.vel&&Vec2.assign(this.coll.vel,g.vel);this.coll.vel.z=80+Math.random()*50;this.target=g.target;this.item=g.item;this.amount=g.amount;d=sc.inventory.getItem(this.item);c=d.rarity;d=b[d.icon]||0;f=void 0;(g=sc.map.getAreaItemType(this.item))&&(f=a[g]);f===void 0?this.initAnimations({namedSheets:{icons:{src:"media/entity/enemy/item-drops.png",width:16,height:16,xCount:8},rotation:{src:"media/entity/enemy/item-drops.png",
width:16,height:16,offY:96}},time:0.03,repeat:true,SUB:[{name:"default",sheet:"icons",frames:[d],tileOffset:8*c},{name:"rotStart",sheet:"rotation",frames:[0,1,2,3,4,5,6,7,8,8,9,9],repeat:false,tileOffset:10*c},{name:"rotating",sheet:"rotation",frames:[0,1,2,3,4,5,6,7,8,9],tileOffset:10*c}]}):this.initAnimations({namedSheets:{icons:{src:"media/entity/enemy/item-drops.png",width:16,height:24,offY:192},glow:{src:"media/entity/enemy/item-drops.png",width:16,height:16,offY:192,offX:96}},time:0.03,repeat:true,
shapeType:"Y_FLAT",SUB:[{name:"default",sheet:"icons",frames:[f]},{name:"rotStart",sheet:"icons",frames:[f]},{name:"preRotating",sheet:"glow",frames:[0],time:0.1},{name:"rotating",sheet:"glow",frames:[1,2,3,2]}]});if(this.dropType.fly){this.setCurrentAnim("default");this.effects.spawnOnTarget("itemAppear",this)}else this.setCurrentAnim("rotStart",true,"default",true);c=new ig.LightHandle(this,ig.LIGHT_SIZE.XS,0,0,-1,1);ig.light.addLightHandle(c);this.timer=0;this.dropType.fly||ig.SoundHelper.playAtEntity(this.sounds.start,
this)},collectItem:function(a){if(!this.collected){this.collected=true;sc.model.player.addItem(this.item,this.amount,false,a);this.dropType!=sc.ITEM_DROP_TYPE.CHEST&&sc.stats.addMap("items","dropsTotal",this.amount);this.dropType==sc.ITEM_DROP_TYPE.PROP?sc.stats.addMap("items","dropsProps",this.amount):this.dropType==sc.ITEM_DROP_TYPE.ENEMY&&sc.stats.addMap("items","dropsEnemies",this.amount)}},onKill:function(a){this.collectItem();var b=sc.inventory.getItem(this.item).rarity;b==sc.ITEMS_RARITY.LOW?
ig.SoundHelper.playAtEntity(this.sounds.catchLow,ig.game.playerEntity):b==sc.ITEMS_RARITY.NORMAL?ig.SoundHelper.playAtEntity(this.sounds.catchNormal,ig.game.playerEntity):b==sc.ITEMS_RARITY.RARE?ig.SoundHelper.playAtEntity(this.sounds.catchRare,ig.game.playerEntity):b==sc.ITEMS_RARITY.LEGENDARY?ig.SoundHelper.playAtEntity(this.sounds.catchLegendary,ig.game.playerEntity):b==sc.ITEMS_RARITY.UNIQUE?ig.SoundHelper.playAtEntity(this.sounds.catchUnique,ig.game.playerEntity):b==sc.ITEMS_RARITY.BACKER&&ig.SoundHelper.playAtEntity(this.sounds.catchUnique,
ig.game.playerEntity);this.parent(a)},onSave:function(){this.collectItem()},update:function(){this.timer=this.timer+ig.system.tick;this.dropType.preCollect&&this.timer>=0.2&&this.collectItem(true);if(this.flying){var a=Math.min(1,this.timer/this.maxTime),b=1-(2*a-1)*(2*a-1),d=this.target.getCenter();this.coll.setPos(this.startPos.x*(1-a)+(d.x-this.coll.size.x/2)*a,this.startPos.y*(1-a)+(d.y-this.coll.size.y/2)*a,this.startZPos*(1-a)+(this.target.coll.pos.z+this.target.coll.size.z+1)*a+b*this.maxHeight);
this.coll.baseZPos=0;this.timer>=this.maxTime&&this.kill()}else if(this.coll.pos.z<ig.game.minLevelZ)this.startRegularFly();else{a=Vec2.length(Vec2.sub(this.target.getCenter(),this.coll.pos));b=this.dropType.fly?1:0.7;(this.dropType.fly||a<48)&&this.timer>b&&this.startFlying(0.4,12)}this.parent()},onTouchGround:function(){if(!this.flying){if(this.coll.vel.z<100)this.coll.vel.z=100;this.timer>1.3&&this.startRegularFly()}},startRegularFly:function(){var a;a=0.5+(Vec2.length(Vec2.sub(this.target.getCenter(),
this.coll.pos))/200).limit(0,1)*0.5;this.startFlying(a,a*120)},startFlying:function(a,b){this.maxTime=a;this.maxHeight=b;this.setCurrentAnim("preRotating",true,"rotating");this.flying=true;Vec2.assign(this.startPos,this.coll.pos);this.startZPos=this.coll.pos.z;this.timer=0;this.effects.spawnOnTarget("line",this,{duration:-1})}});var d=Vec3.create();sc.ItemDropEntity.spawnDrops=function(a,b,f,g,h,i){i=i||sc.ITEM_DROP_TYPE.ENEMY;a=a.getAlignedPos(b,d);b=Vec2.create();f={target:f,item:g,amount:1,dropType:i,
vel:b};if(h==1){if(!i.fly){Vec2.assignC(b,0,40);Vec2.rotate(b,Math.random()*Math.PI*2)}ig.game.spawnEntity(sc.ItemDropEntity,a.x-8,a.y-2,a.z,f)}else{g=h;for(Vec2.assignC(b,i.fly?20:40,0);g--;){ig.game.spawnEntity(sc.ItemDropEntity,a.x-8,a.y-2,a.z,f);Vec2.rotate(b,Math.PI*2*(1/h)*(0.8+Math.random()*0.4))}}}});ig.baked=!0;
ig.module("game.feature.combat.model.combat-condition").requires("game.feature.combat.model.combat-params").defines(function(){sc.COMBAT_CONDITION={};sc.COMBAT_CONDITION.RANDOM=ig.Class.extend({max:0,_wm:new ig.Config({attributes:{max:{_type:"Number",_info:"Maximum random value. Range 0-1. 1 = 100% likely to happen."}}}),init:function(a){assertContent(a,"max");this.max=a.max},check:function(a,b){return b<=this.max}});sc.COMBAT_CONDITION.HP_BELOW=ig.Class.extend({value:0,_wm:new ig.Config({attributes:{value:{_type:"Number",
_info:"Relative HP are below the given value. Range: 0-1. 0.5 => below 50%"}}}),init:function(a){assertContent(a,"value");this.value=a.value},check:function(a){a=a.params;return!a?false:a.currentHp/a.getStat("hp")<=this.value}});sc.COMBAT_CONDITION.HAS_SP=ig.Class.extend({min:0,_wm:new ig.Config({attributes:{min:{_type:"NumberExpression",_info:"Number of SP that is required"}}}),init:function(a){this.min=a.min},check:function(a){return a.params.currentSp>=ig.Event.getExpressionValue(this.min)}});
sc.COMBAT_CONDITION.SPAWN_POINT_DISTANCE=ig.Class.extend({min:0,max:0,_wm:new ig.Config({attributes:{min:{_type:"Number",_info:"Minimum distance to spawn point in pixels"},max:{_type:"Number",_info:"Maximum distance to spawn point in pixels"}}}),init:function(a){this.min=a.min||0;this.max=a.max||100},check:function(b){var d=b.getCenter(a),b=Vec2.distance(d,b.spawnPoint);return this.min<=b&&b<=this.max}});sc.COMBAT_CONDITION.TARGET_REACHABLE=ig.Class.extend({distance:0,throwing:false,_wm:new ig.Config({attributes:{distance:{_type:"Number",
_info:"Maximum distance to target in pixels."},throwing:{_type:"Boolean",_info:"Plan to throw stuff at target => cliffs in between are ok."}}}),init:function(a){this.distance=a.distance||48;this.throwing=a.throwing||false},check:function(a){var b=a.getTarget();return!b?false:ig.navigation.isTargetReachable(a,b,this.distance,this.throwing)}});sc.COMBAT_CONDITION.TARGET_DISTANCE=ig.Class.extend({min:0,max:0,_wm:new ig.Config({attributes:{min:{_type:"Number",_info:"Min distance to target in pixels."},
max:{_type:"Number",_info:"max distance to target in pixels."}}}),init:function(a){this.min=a.min||0;this.max=a.max||100},check:function(a){var b=a.getTarget();if(!b)return false;a=a.distanceTo(b);return this.min<=a&&a<=this.max}});sc.COMBAT_CONDITION.TARGET_STANDING_ON_SELF=ig.Class.extend({_wm:new ig.Config({attributes:{alsoOnGround:{_type:"Boolean",_info:"If true, make sure target is properly standing"}}}),init:function(a){this.alsoOnGround=a.alsoOnGround||false},check:function(a){var b=a.getTarget();
if(!b)return false;var d=ig.EntityTools.getGroundEntity(b);return d==a||d instanceof ig.AnimationPartEntity&&d.owner==a&&(!this.alsoOnGround||b.coll.pos.z-b.coll.baseZPos<=ig.COLLISION.EPS)?true:false}});sc.COMBAT_CONDITION.TARGET_OVERLAP=ig.Class.extend({ignoreZ:false,_wm:new ig.Config({attributes:{ignoreZ:{_type:"Boolean",_info:"If true, do not check overlapping with z coords"}}}),init:function(a){this.ignoreZ=a.ignoreZ||false},check:function(a){var b=a.getTarget();return!b?false:ig.CollTools.intersect(a.coll,
b.coll,this.ignoreZ)}});sc.COMBAT_CONDITION.TARGET_FACE=ig.Class.extend({maxAngle:0,_wm:new ig.Config({attributes:{maxAngle:{_type:"Number",_info:"How much the face direction of the target diverges from distance vector. 0.5 = 45 degree"}}}),init:function(a){this.maxAngle=a.maxAngle||0},check:function(b){var d=b.getTarget();if(!d)return false;ig.CollTools.getDistVec2(d.coll,b.coll,a);return Vec2.angle(a,d.face)<this.maxAngle*Math.PI}});sc.COMBAT_CONDITION.FACING_TARGET=ig.Class.extend({maxAngle:0,
_wm:new ig.Config({attributes:{maxAngle:{_type:"Number",_info:"How much the OWN face direction diverges from distance to target vector. 0.5 = 45 degree"}}}),init:function(a){this.maxAngle=a.maxAngle||0},check:function(b){var d=b.getTarget();if(!d)return false;ig.CollTools.getDistVec2(b.coll,d.coll,a);return Vec2.angle(a,b.face)<this.maxAngle*Math.PI}});sc.COMBAT_CONDITION.ENTITY_DISTANCE_OVER=ig.Class.extend({entity:null,distance:0,_wm:new ig.Config({attributes:{entity:{_type:"Entity",_info:"Entity distance is messured from."},
distance:{_type:"Number",_info:"Distance value"}}}),init:function(a){this.entity=a.entity;this.distance=a.distance||100},check:function(a){var b=ig.Event.getEntity(this.entity);return!b?false:a.distanceTo(b)>this.distance}});var b=Vec2.create();sc.COMBAT_CONDITION.ENTITY_COORD_DELTA_WITHIN=ig.Class.extend({entity:null,distance:0,_wm:new ig.Config({attributes:{entity:{_type:"Entity",_info:"Entity distance is messured from."},coordinate:{_type:"String",_info:"Coordinate to evaluate distance from",_select:["X",
"Y","Z"]},absolute:{_type:"Boolean",_info:"If true, compare absolute delta. Otherwise it's COMBATANT POS - SELECTED ENTITY POS"},min:{_type:"Number",_info:"Minimum value"},max:{_type:"Number",_info:"Maximum value"},targetDelta:{_type:"Boolean",_info:"If true: Calculate delta TARGET POS - SELECTED ENTITY POS"}}}),init:function(a){this.entity=a.entity;this.coordinate=a.coordinate;this.absolute=a.absolute;this.min=a.min||0;this.max=a.max||0;this.targetDelta=a.targetDelta||false},check:function(a){var d=
ig.Event.getEntity(this.entity);if(!d)return false;a=(this.targetDelta?a.getTarget():a)||a;d=ig.CollTools.getDistVec3(d.coll,a.coll,b);a=0;a=this.coordinate=="X"?d.x:this.coordinate=="Y"?d.y:d.z;this.absolute&&(a=Math.abs(a));return this.min<=a&&a<=this.max}});var a=Vec2.create(),d=Vec2.create();sc.COMBAT_CONDITION.TARGET_X_DISTANCE=ig.Class.extend({min:0,max:0,_wm:new ig.Config({attributes:{min:{_type:"Number",_info:"Min X distance to target in pixels."},max:{_type:"Number",_info:"max X distance to target in pixels."}}}),
init:function(a){this.min=a.min||0;this.max=a.max||100},check:function(b){var e=b.getTarget();if(!e)return false;b=b.getCenter(a);Vec2.sub(b,e.getCenter(d));e=Math.abs(b.x);return this.min<=e&&e<=this.max}});sc.COMBAT_CONDITION.TARGET_Y_DISTANCE_BELOW=ig.Class.extend({value:0,_wm:new ig.Config({attributes:{value:{_type:"value",_info:"Value the y distance needs to be below of"}}}),init:function(a){assertContent(a,"value");this.value=a.value},check:function(a){var b=a.getTarget();return!b?false:b.coll.pos.y-
a.coll.pos.y<=this.value}});sc.COMBAT_CONDITION.TARGET_Z_DISTANCE=ig.Class.extend({zMin:0,zMax:0,_wm:new ig.Config({attributes:{zMin:{_type:"Number",_info:"Min Z distance to target in pixels."},zMax:{_type:"Number",_info:"max Z distance to target in pixels."}}}),init:function(a){this.zMin=a.zMin;this.zMax=a.zMax},check:function(a){var b=a.getTarget();if(!b)return false;var d=b.coll.pos.z-a.coll.pos.z;return this.zMin<=b.coll.pos.z+b.coll.size.z-a.coll.pos.z&&d<=this.zMax}});sc.COMBAT_CONDITION.TARGET_ALIVE=
ig.Class.extend({_wm:new ig.Config({attributes:{}}),init:function(){},check:function(a){return(a=a.getTarget())&&(!a.isDefeated||!a.isDefeated())}});sc.COMBAT_CONDITION.HAS_TARGET=ig.Class.extend({_wm:new ig.Config({attributes:{}}),init:function(){},check:function(a){return!!a.getTarget()}});sc.COMBAT_CONDITION.COLLAB_IS_ONGOING=ig.Class.extend({_wm:new ig.Config({attributes:{}}),init:function(){},check:function(){return sc.combat.hasCollabs()}});sc.COMBAT_CONDITION.HP_BREAK=ig.Class.extend({min:void 0,
max:void 0,_wm:new ig.Config({attributes:{min:{_type:"Number",_info:"If defined: HP Break has to be at least this value.",_optional:true},max:{_type:"Number",_info:"If defined: HP Break has to be at most this value.",_optional:true}}}),init:function(a){this.min=a.min;this.max=a.max},check:function(a){a=a.getCombatantRoot().hpBreakReached||0;return this.min!=void 0&&this.min!=null&&a<this.min||this.max!=void 0&&this.max!=null&&a>this.max?false:true}});sc.COMBAT_CONDITION.HP_BREAK_GLOBAL=ig.Class.extend({min:void 0,
max:void 0,_wm:new ig.Config({attributes:{min:{_type:"Number",_info:"If defined: HP Break has to be at least this value.",_optional:true},max:{_type:"Number",_info:"If defined: HP Break has to be at most this value.",_optional:true}}}),init:function(a){this.min=a.min;this.max=a.max},check:function(){for(var a=sc.combat.activeCombatants[sc.COMBATANT_PARTY.ENEMY],b=0,d=a.length;d--;)b=Math.max(b,a[d].hpBreakReached);return this.min!=void 0&&this.min!=null&&b<this.min||this.max!=void 0&&this.max!=null&&
b>this.max?false:true}});sc.COMBAT_CONDITION.HAS_SHIELD=ig.Class.extend({name:null,_wm:new ig.Config({attributes:{name:{_type:"String",_info:"Name of shield that has to be active"}}}),init:function(a){assertContent(a,"name");this.name=a.name},check:function(a){return a.hasShield(this.name)}});sc.COMBAT_CONDITION.ON_GROUND=ig.Class.extend({name:null,_wm:new ig.Config({attributes:{}}),init:function(){},check:function(a){return a.coll.baseZPos==a.coll.pos.z}});sc.COMBAT_CONDITION.HAS_GROUND_ENTITY=ig.Class.extend({name:null,
_wm:new ig.Config({attributes:{}}),init:function(){},check:function(a){return!!ig.EntityTools.getGroundEntity(a)}});sc.COMBAT_CONDITION.HAS_ENTITY_ON_TOP=ig.Class.extend({name:null,_wm:new ig.Config({attributes:{}}),init:function(){},check:function(a){return ig.game.getEntitiesOnTop(a).length>0}});sc.COMBAT_CONDITION.Z_BASE_UNCERTAIN=ig.Class.extend({name:null,_wm:new ig.Config({attributes:{}}),init:function(){},check:function(a){return!a.coll._collData||a.coll._collData.zBaseUncertain}});sc.COMBAT_CONDITION.TARGET_TRAP_TIME_OVER=
ig.Class.extend({value:null,_wm:new ig.Config({attributes:{value:{_type:"Number",_info:"Value trap time needs to be over. 0 for ANY trap time value",_optional:true}}}),init:function(a){this.value=a.value},check:function(a){a=a.getTarget();return!a||!a.combo?false:a.combo.guardTrapTime>this.value}});sc.COMBAT_CONDITION.TARGET_HIT_STABLE_ABOVE=ig.Class.extend({value:null,_wm:new ig.Config({attributes:{value:{_type:"String",_info:"Hit Stable target needs to be above of",_select:sc.ATTACK_TYPE}}}),init:function(a){this.value=
sc.ATTACK_TYPE[a.value]},check:function(a){a=a.getTarget();return!a?false:a.hitStable>=this.value}});sc.COMBAT_CONDITION.HAS_PROXY=ig.Class.extend({_wm:new ig.Config({attributes:{sticking:{_type:"Boolean",_info:"If true: only proxies sticking to source"},group:{_type:"String",_info:"If true: only proxies matching this group"},count:{_type:"Number",_info:"If defined: need at least that amount of maxing proxies",_optional:true}}}),init:function(a){this.sticking=a.sticking||false;this.group=a.group;
this.count=a.count||0},check:function(a){for(var a=a.entityAttached,b=a.length,d=0;b--;){var g=a[b];if(g instanceof sc.CombatProxyEntity&&(!this.sticking||g.stickToSource)&&!(this.group&&g.group!=this.group))if(this.count)d++;else return true}return this.count&&d>=this.count?true:false}});sc.COMBAT_CONDITION.ENTERED_STATE=ig.Class.extend({_wm:new ig.Config({attributes:{}}),init:function(){},check:function(a){return a.justEnteredState}});sc.COMBAT_CONDITION.CURRENT_STATE=ig.Class.extend({_wm:new ig.Config({attributes:{state:{_type:"EnemyStateRef",
_info:"State enemy is currently in"}}}),init:function(a){this.state=a.state},check:function(a){return a.currentState==this.state}});sc.COMBAT_CONDITION.ENEMY_COUNT=ig.Class.extend({count:0,sameType:0,_wm:new ig.Config({attributes:{count:{_type:"Number",_info:"Minimum amount of enemies"},sameType:{_type:"Boolean",_info:"Only count same enemy type"}}}),init:function(a){this.count=a.count;this.sameType=a.sameType},check:function(a){return sc.combat.getActiveCombatantCount(a.party,this.sameType?a.enemyName:
null)>=this.count}});sc.COMBAT_CONDITION.TRACKER_READY=ig.Class.extend({name:0,noResetOnPerformed:false,_wm:new ig.Config({attributes:{name:{_type:"TrackerRef",_info:"Name of Tracker"},noResetOnPerformed:{_type:"Boolean",_info:"Do not reset tracker after action/reaction has been performed",_optional:true}}}),init:function(a){this.name=a.name;this.noResetOnPerformed=a.noResetOnPerformed||false},check:function(a,b,d,g){var h=a.getCombatantRoot().trackers[this.name];return h&&h.onConditionEval(a,b,d,
g)},onReactionActivate:function(a){var b=a.getCombatantRoot().trackers[this.name];if(b&&b.onReactionActivate)b.onReactionActivate(a)},onPerformed:function(a){var b=a.getCombatantRoot().trackers[this.name];if(b&&b.onPerformed)b.onPerformed(a,this.noResetOnPerformed)}});sc.COMBAT_CONDITION.ACTION_TOKEN=ig.Class.extend({name:0,time:0,_wm:new ig.Config({attributes:{name:{_type:"String",_info:"Name of action token that has to be available."},time:{_type:"Number",_info:"Time to block action token if available."}}}),
init:function(a){assertContent(a,"name","time");this.name=a.name;this.time=a.time},check:function(){return sc.combat.getActionToken(this.name,this.time)}});sc.COMBAT_CONDITION.MULTI_TOKEN=ig.Class.extend({names:[],times:[],_wm:new ig.Config({attributes:{names:{_type:"JSON",_info:"An array of names, one for each token."},times:{_type:"JSON",_info:"An array of waiting times, one for each token."}}}),init:function(a){assertContent(a,"tokens");for(var b in a.tokens){this.names.push(b);this.times.push(a.tokens[b])}},
check:function(){return sc.combat.getMultiToken(this.names,this.times)}});sc.COMBAT_CONDITION.VAR_CONDITION=ig.Class.extend({condition:0,_wm:new ig.Config({attributes:{condition:{_type:"ActorVarCondition",_info:"VarCondition that has to be true."}}}),init:function(a){assertContent(a,"condition");this.condition=a.condition;if(typeof this.condition=="string")this.condition=new ig.VarCondition(this.condition)},check:function(a){ig.vars.pushEntityAccessor(a);var b;if(this.condition.actorAttrib)b=(b=a.getAttribCondition(this.condition.actorAttrib))?
b.evaluate():false;else b=this.condition?this.condition.evaluate():false;ig.vars.popEntityAccessor(a);return b}});sc.COMBAT_CONDITION.ATTRIB_IS_TRUE=ig.Class.extend({name:0,_wm:new ig.Config({attributes:{name:{_type:"String",_info:"Name of actor attrib"}}}),init:function(a){assertContent(a,"name");this.name=a.name},check:function(a){return a.getAttribute(this.name)}});sc.COMBAT_CONDITION.BLOCKING_FREE_LINE=ig.Class.extend({_wm:new ig.Config({attributes:{}}),init:function(){},check:function(a){return sc.combat.isBlockingFreeLine(a)}});
sc.COMBAT_CONDITION.BALL_CHARGE=ig.Class.extend({_wm:new ig.Config({attributes:{}}),init:function(){},check:function(a,b,d){return d&&d.attackInfo&&d.attackInfo.hasHint("CHARGED")}});sc.COMBAT_CONDITION.BALL_SMALL=ig.Class.extend({_wm:new ig.Config({attributes:{}}),init:function(){},check:function(a,b,d){return d&&d.damagingEntity.isBall&&d.attackInfo&&!d.attackInfo.hasHint("CHARGED")}});sc.COMBAT_CONDITION.ATTACK_FROM_ENTITY=ig.Class.extend({_wm:new ig.Config({attributes:{entity:{_type:"Entity",
_info:"Check if incoming attack originates from this entity"}}}),init:function(a){this.entity=a.entity},check:function(a,b,d){if(!d)return false;a=d.damagingEntity.getCombatantRoot();b=ig.Event.getEntity(this.entity);return a==b}});sc.COMBAT_CONDITION.DAMAGE_FACTOR=ig.Class.extend({min:void 0,_wm:new ig.Config({attributes:{min:{_type:"Number",_info:"Minimum value of attack damage factor",_default:1}}}),init:function(a){this.min=a.min||0},check:function(a,b,d){return d&&d.attackInfo.damageFactor>=
this.min}});sc.COMBAT_CONDITION.HAS_BLOCKED_DAMAGE=ig.Class.extend({_wm:new ig.Config({attributes:{}}),init:function(){},check:function(a){return a.combo.blockedDamage>0}});sc.COMBAT_CONDITION.HAS_BLOCKED_HITS=ig.Class.extend({_wm:new ig.Config({attributes:{}}),init:function(){},check:function(a){return a.combo.guardedHits>0}});sc.COMBAT_CONDITION.HAS_BLOCKED_ENTITY=ig.Class.extend({_wm:new ig.Config({attributes:{}}),init:function(){},check:function(a){return a.hasBlockEntity()}});sc.COMBAT_CONDITION.PART_HIT=
ig.Class.extend({partName:null,_wm:new ig.Config({attributes:{partName:{_type:"String",_info:"Name of part that is hit"}}}),init:function(a){this.partName=a.partName},check:function(a,b,d){return!d||!d.partEntity?false:d.partEntity.partName==this.partName}});sc.COMBAT_CONDITION.HAS_HINT=ig.Class.extend({_wm:new ig.Config({attributes:{hint:{_type:"String",_info:"Hint Value"}}}),init:function(a){this.hint=a.hint},check:function(a,b,d){return d&&d.attackInfo&&d.attackInfo.hasHint(this.hint)}});sc.COMBAT_CONDITION.IS_BALL=
ig.Class.extend({_wm:new ig.Config({attributes:{}}),init:function(){},check:function(a,b,d){return d&&d.attackInfo.ballDamage}});sc.COMBAT_CONDITION.IS_SHIELDED=ig.Class.extend({_wm:new ig.Config({attributes:{}}),init:function(){},check:function(a,b,d){return d&&d.shielded}});sc.COMBAT_CONDITION.ELEMENT_HIT=ig.Class.extend({element:null,_wm:new ig.Config({attributes:{element:{_type:"String",_info:"Element required",_select:sc.ELEMENT}}}),init:function(a){this.element=sc.ELEMENT[a.element]||sc.ELEMENT.NEUTRAL},
check:function(a,b,d){return d&&d.attackInfo.element==this.element}});sc.COMBAT_CONDITION.HIT_BY_PLAYER=ig.Class.extend({_wm:new ig.Config({attributes:{}}),init:function(){},check:function(a,b,d){return(a=d&&d.damagingEntity)&&a.getCombatantRoot?a.getCombatantRoot().isPlayer:false}});sc.COMBAT_CONDITION.ELEMENT_HIT_ATTRIB=ig.Class.extend({element:null,_wm:new ig.Config({attributes:{attribName:{_type:"String",_info:"Attrib name which contains Element String that must match hit element"},counter:{_type:"Boolean",
_info:"If true, use counter element of element in attrib"}}}),init:function(a){this.attribName=a.attribName;this.counter=a.counter||false},check:function(a,b,d){if(a=sc.ELEMENT[a.getAttribute(this.attribName)]){this.counter&&(a=sc.ELEMENT_COUNTER[a]);return d&&d.attackInfo.element==a}}});sc.COMBAT_CONDITION.ELEMENT_MODE=ig.Class.extend({element:null,_wm:new ig.Config({attributes:{element:{_type:"String",_info:"Element of the combatant is currently in",_select:sc.ELEMENT}}}),init:function(a){this.element=
sc.ELEMENT[a.element]||sc.ELEMENT.NEUTRAL},check:function(a){a=a.getCombatantRoot();return sc.combat.getElementMode(a)==this.element}});sc.COMBAT_CONDITION.COMBO_HITS=ig.Class.extend({min:0,_wm:new ig.Config({attributes:{min:{_type:"Number",_info:"Minimum amount of hits of combo attack that enemy is stuck in"}}}),init:function(a){this.min=a.min},check:function(a){return a.stunData.hits>=this.min}});sc.COMBAT_CONDITION.COMBO_TIME=ig.Class.extend({min:0,_wm:new ig.Config({attributes:{min:{_type:"Number",
_info:"Minimum amount of time (in SECONDS) of combo attack that enemy is stuck in"}}}),init:function(a){this.min=a.min},check:function(a){return a.stunData.time>=this.min},onPrePerformed:function(a){a.resetStunData()}});sc.COMBAT_CONDITION.STUN_ESCAPE=ig.Class.extend({_wm:new ig.Config({attributes:{showMsg:{_type:"Boolean",_info:"If true, show stunEscape message on success"}}}),init:function(a){this.showMsg=a.showMsg||false},check:function(a){return a.stunData.time>=a.stunData.stunEscapeTime},onPrePerformed:function(a){a.resetStunData();
this.showMsg&&sc.combat.showCombatMessage(a,sc.COMBAT_MSG_TYPE.STUN_CANCEL)}});sc.COMBAT_CONDITION.COMBO_DAMAGE=ig.Class.extend({min:0,_wm:new ig.Config({attributes:{min:{_type:"Number",_info:"Amount of damage (relative to HP) of combo attack that enemy is stuck in"}}}),init:function(a){this.min=a.min},check:function(a){return a.stunData.damage/a.params.getStat("hp")>=this.min}});sc.COMBAT_CONDITION.POI_IS_CLOSE=ig.Class.extend({poiFilter:0,distance:0,_wm:new ig.Config({attributes:{poiFilter:{_type:"PoiFilter",
_info:"Kind of POI searched"},distance:{_type:"Number",_info:"Maximum distance to POI"},checkPath:{_type:"Boolean",_info:"If true: check if path to POI is available"}}}),init:function(a){this.poiFilter=sc.CombatPoI.initPoiFilter(a.poiFilter);this.distance=a.distance;this.checkPath=a.checkPath},check:function(a){var b=sc.CombatPoI.getClosestPoI(this.poiFilter,a,this.distance,this.checkPath);a.lastPoICheck=b;return!!b}});sc.COMBAT_CONDITION.NAVIGATION_SUCCESS=ig.Class.extend({_wm:new ig.Config({attributes:{}}),
init:function(){},check:function(a){return a.nav&&a.nav.path.failCount==0}});sc.COMBAT_CONDITION.ON_NAV_NODE=ig.Class.extend({_wm:new ig.Config({attributes:{}}),init:function(){},check:function(a){return ig.navigation.isSearcherOnNode(a)}});sc.COMBAT_CONDITION.COMPRESSOR_DETOUR_CONDITION=ig.Class.extend({_wm:new ig.Config({attributes:{}}),init:function(){},check:function(a,b,d){b=d&&d.damagingEntity;return!b||!(b instanceof sc.CompressedShockEntity)?false:b.wallBounces<a.hpBreakReached}})});
ig.baked=!0;
ig.module("game.feature.combat.model.enemy-type").requires("impact.base.loader","game.feature.combat.model.combat-params","game.feature.combat.model.combat-condition","impact.base.animation").defines(function(){function b(a,b){return b.hp-a.hp}function a(a,b){if(!b.reactions.restartAction){if(b.deferredPerformedConds.length>0){for(var c=b.deferredPerformedConds.length;c--;)b.deferredPerformedConds[c].onPerformed(b);b.deferredPerformedConds.length=0}if(b.nextTimerChange){var c=b.nextTimerChange,d=
false,e;for(e in c){var d=true,f=c[e];b.stateTimers[e]=typeof f=="number"?f:f[0]+Math.random()*((f[1]||f[0])-f[0])}if(d){b.nav.failTimer=0;b.target&&a.reselectTarget(b)}b.nextTimerChange=null}}b.reactions.running=null}function d(a,b){sc.DropEntity.spawnDrops(a,ig.ENTITY_ALIGN.CENTER,"HP",b,ig.game.playerEntity);for(var c=sc.party.getPartySize();c--;){var d=sc.party.getPartyMemberEntityByIndex(c);d&&(d.model&&d.model.isAlive())&&sc.DropEntity.spawnDrops(a,ig.ENTITY_ALIGN.CENTER,"HP",b,d)}}function c(a,
b,d){for(var e=0;e<b.length;++e){var f={conditions:null,parent:d||null},l=b[e].req;if(l)f.conditions=new sc.CombatConditions(l);if(b[e].sub){f.sub=[];c(f.sub,b[e].sub,f)}else{f.action=b[e].action;f.frequency=b[e].frequency||null;f.collab=b[e].collab||null;if(f.frequency&&!sc.ATTACK_FREQUENCY[f.frequency])throw Error("Unknown attack frequency '"+f.frequency+"'");f.preSwitchState=b[e].preSwitchState;f.postSwitchState=b[e].postSwitchState;f.ignoreStun=b[e].ignoreStun}a.push(f)}}function e(a,b,c){for(var d=
0;d<a.length;++d){var f=a[d];if(f.sub||f.ignoreStun||!b.hasStun())if(!f.frequency||sc.combat.checkFrequency(b,f.frequency))if(!f.conditions||f.conditions.check(b,c))if(f.sub){if(f=e(f.sub,b,c))return f}else{if(f.collab){var l=new sc.EnemyCollab(b,f.collab);if(!l.success)continue;b.postStun.collab=l}else b.postStun.collab=null;return f}}return null}var f=0;sc.ENEMY_CATEGORY={};sc.ENEMY_CATEGORY.ABSTRACT=0;sc.ENEMY_CATEGORY.PLAYERS=1;sc.ENEMY_CATEGORY.ANIMALS=2;sc.ENEMY_CATEGORY.MECHA=3;sc.ENEMY_CATEGORY.BOSS=
4;sc.ENEMY_AI_LEARN={REGULAR:{},IMMEDIATELY:{knowItAll:true}};sc.EnemyType=ig.JsonLoadable.extend({cacheType:"Enemy",aiGroup:null,aiLearnType:sc.ENEMY_AI_LEARN.REGULAR,enduranceScale:null,name:"",params:null,credit:null,exp:0,level:1,maxSp:4,boss:false,hpBreaks:[],hpBreakCond:null,animSheet:null,attribs:{},proxies:{},actions:{},states:{},reactions:{},trackerDef:null,headIdx:0,healDropRate:0,itemDrops:[],targetDetect:{onVisibleRange:0,onDistance:false,onCloseBattle:false,detectDistance:120,loseDistance:240,
loseTime:3},getJsonPath:function(){return ig.root+this.path.toPath("data/enemies/",".json")+ig.getCacheSuffix()},onload:function(a){this.name=a.name;this.boss=a.boss;this.bossLabel=a.bossLabel||"Boss";this.bossOrder=a.bossOrder||0;this.detectType=sc.EnemyType.DETECT_TYPE[a.detectType]||sc.EnemyType.DETECT_TYPE.DISTANCE;this.credit=a.credit||0;this.aiGroup=a.aiGroup||null;this.aiLearnType=sc.ENEMY_AI_LEARN[a.aiLearnType]||sc.ENEMY_AI_LEARN.REGULAR;this.enduranceScale=a.enduranceScale||1;this.exp=a.exp||
0;this.level=a.level||1;this.boostedLevel=a.boostedLevel||60;this.maxSp=a.maxSp||4;this.headIdx=a.headIdx;if(this.headIdx==void 0)this.headIdx=3;this.healDropRate=a.healDropRate||0;this.itemDrops=a.itemDrops||[];this.ignoreTaunts=a.ignoreTaunts||false;this.trackerDef=a.trackers;if(a.params)this.params=a.params;if(a.elementModes)this.elementModes=a.elementModes;if(a.modifiers)this.modifiers=a.modifiers;if(a._wm&&a._wm.attributes)this.attribs=a._wm.attributes;if(a.hpBreaks){for(var c=0;c<a.hpBreaks.length;++c){var d=
a.hpBreaks[c];this.hpBreaks.push({hp:d.hp,healDrop:d.healDrop})}this.hpBreaks.sort(b)}this.hpBreakCond=new ig.VarCondition(a.hpBreakCond);this.animSheet=new ig.AnimationSheet(a.anims);this.size=a.size;this.cameraZFocus=a.cameraZFocus||0;this.dmgZFocus=a.dmgZFocus||0;this.padding=a.padding||Vec2.createC(0,0);this.walkConfigs=a.walkConfigs;this.material=sc.COMBATANT_MATERIAL[a.material]||sc.COMBATANT_MATERIAL.METAL;for(var e in a.proxies){c=a.proxies[e];this.proxies[e]=new sc.PROXY_TYPE[c.type](c)}if(a.targetDetect){c=
a.targetDetect;if(c.detectDistance!=void 0)this.targetDetect.detectDistance=c.detectDistance;if(c.detectZDelta!=void 0)this.targetDetect.detectZDelta=c.detectZDelta||0;if(c.loseDistance!=void 0)this.targetDetect.loseDistance=c.loseDistance;if(c.loseTime!=void 0)this.targetDetect.loseTime=c.loseTime;if(c.onDistance!=void 0)this.targetDetect.onDistance=c.onDistance;if(c.onVisible!=void 0)this.targetDetect.onVisible=c.onVisible;if(c.notifyNeighbourRadius!=void 0)this.targetDetect.notifyNeighbourRadius=
c.notifyNeighbourRadius;if(c.onCloseBattle!=void 0)this.targetDetect.onCloseBattle=c.onCloseBattle;this.targetDetect.onVisible=c.onVisible||false}this.entityConfig=new ig.ActorConfig;this.entityConfig.loadFromData(a);for(e in a.actions){this.actions[e]=new ig.Action(e,a.actions[e]);this.actions[e].hint="battle"}this.defaultState=a.defaultState;for(e in a.states)this.states[e]=new sc.EnemyState(e,a.states[e],this.entityConfig);for(e in a.reactions){c=a.reactions[e];this.reactions[e]=new sc.ENEMY_REACTION[c.type](e,
c)}},onCacheCleared:function(){this.animSheet.decreaseRef();for(var a in this.actions)this.actions[a].clearCached();for(a in this.proxies)this.proxies[a].clearCached()},initEntity:function(a){if(this.loaded&&!a.enemyTypeInitialized){a.enemyTypeInitialized=true;a.setSize(this.size.x,this.size.y,this.size.z);a.cameraZFocus=this.cameraZFocus;a.dmgZFocus=this.dmgZFocus;a.coll.setPadding(this.padding.x,this.padding.y);a.material=this.material;a.animSheet=this.animSheet;a.proxies=this.proxies;a.ignoreTaunts=
this.ignoreTaunts;if(this.size.z>96)a.tooHighToFall=true;for(var b in this.walkConfigs)a.storeWalkAnims(b,this.walkConfigs[b]);for(var c in this.trackerDef){var d=this.trackerDef[c],e=d.type;sc.ENEMY_TRACKER[e]&&(a.trackers[c]=new sc.ENEMY_TRACKER[e](a,d))}for(b in this.attribs){c=a.attributes[b];if(this.attribs[b]._type=="VarCondition")a.setAttribute(b,new ig.VarCondition(c));else if(this.attribs[b]._type=="Vec3")a.setAttribute(b,ig.Event.getVec3(c,Vec3.create()));else if(this.attribs[b]._type==
"Action"&&c){c=new ig.Action(b,c);c.hint="battle";a.setAttribute(b,c)}}ig.vars.pushEntityAccessor(a);if(!this.hpBreakCond.evaluate())a.hpBreakReached=this.hpBreaks.length;ig.vars.popEntityAccessor(a);this.switchState(a,a.currentState||this.defaultState);if(this.params){a.params=new sc.CombatParams(this.params);if(this.elementModes)a.elementModes={current:0,modes:null};this.updateParams(a);this.modifiers&&a.params.setModifiers(this.modifiers);a.params.setCombatant(a);a.params.setMaxSp(this.maxSp);
a.statusGui&&a.statusGui.initWithParams();a.params.initStatusFx()}sc.enemyBooster.updateEnemyBoostState(a)}},updateParams:function(a){var b=this.params;a.level.override&&(b=sc.EnemyLevelScaling.adaptParams(this.params,this.level,a.level.override));if(this.elementModes){var c=[];c[sc.ELEMENT.NEUTRAL]=ig.copy(b);for(var d in sc.ELEMENT){var e=ig.copy(b),f=this.elementModes[d],o;for(o in f)if(f[o])if(f[o]instanceof Array){e[o]||(e[o]=[1,1,1,1]);for(var m=0;m<f[o].length;++m)e[o][m]=f[o][m]}else e[o]=
Math.round(f[o]*(e[o]/this.params[o]));c[sc.ELEMENT[d]]=e}a.elementModes.modes=c;b=c[a.elementModes.current]}a.params.setBaseParams(b,true)},onEntityKill:function(a){for(var b in this.attribs){var c=a.attributes[b];c instanceof ig.Action&&c.clearCached()}},getAppearAction:function(a){a.currentState||this.switchState(a,this.defaultState);return(a=this.states[a.currentState])&&a.appearAction?this.actions[a.appearAction]:null},update:function(b){if(this.loaded&&!b._hidden)if(b.params&&(b.params.isDefeated()||
b.params.isLocked()))b.postStun.choice=null;else{b.target&&b.target.isDefeated()&&this.reselectTarget(b,false,true);b.enemyTypeInitialized||this.initEntity(b);b.currentState||this.switchState(b,this.defaultState);this.updateTarget(b);this.checkReactions(b);if(!b.reactions.current&&!b.currentAction){a(this,b);b.nextState&&!b.hasStun()&&this.switchState(b,b.nextState);b.nextState||this.updateAction(b)}}},checkReactions:function(a){for(var b=0;b<a.reactions.enabled.length;++b){var c=a.reactions.enabled[b],
d=this.reactions[c];if(a.reactions.running!=d&&d.check&&d.check(a)){a.reactions.current=c;d.preApply(a)}}a.reactions.current&&this.applyCurrentReaction(a)},applyCurrentReaction:function(a){var b=this.reactions[a.reactions.current];if(b.ignoreStun||!a.hasStun()){a.postStun.choice=null;a.cancelStun();b.apply(a,this.actions);a.collaboration&&a.addActionAttached(a.collaboration);a.reactions.running=b;a.reactions.current=null}},updateAction:function(a){if(a.reactions.restartAction){a.setAction(a.reactions.restartAction);
a.reactions.restartAction=null}else if(a.postStun.choice){a.damageTimer<=0.2&&a.cancelStun();if(!a.hasStun()){a.resetStunData();this.startChoice(a,a.postStun.choice)}}else{var b=this.states[a.currentState].selectAction(a);if(b)if(a.hasStun()){a.postStun.choice=b;a.hitStable=sc.ATTACK_TYPE.MASSIVE}else this.startChoice(a,b)}},startChoice:function(a,b){a.postStun.collab&&a.postStun.collab.start();for(var c=b;c;){if(c.conditions)c.conditions.onPerformed(a,true);c=c.parent}a.postStun.choice=null;a.postStun.collab=
null;a.justEnteredState=false;a.defaultConfig.apply(a);b.frequency&&sc.combat.submitFrequency(a,b.frequency);a.cancelStun();b.preSwitchState&&this.switchState(a,b.preSwitchState);b.action?a.setAction(this.actions[b.action]):a.setAction(null);a.nextState=b.postSwitchState},updateTarget:function(a){if(a.target){if(!sc.model.isForceCombat()){c=a.distanceTo(a.target);a.targetLoseTimer=c>this.targetDetect.loseDistance?a.targetLoseTimer+ig.system.tick:0;a.targetLoseTimer>=this.targetDetect.loseTime&&a.setTarget(null)}}else if(ig.game.playerEntity){var b=
ig.game.playerEntity,c=a.distanceTo(b),d=Math.abs(a.coll.pos.z-b.coll.pos.z);if(c<this.targetDetect.detectDistance&&(!this.targetDetect.detectZDelta||d<this.targetDetect.detectZDelta))this.targetDetect.onDistance?this.assignTarget(a,b,true):this.targetDetect.onCloseBattle&&b.targetedBy.length>0&&this.assignTarget(a,b,true)}},reselectTarget:function(a,b,c,d){var e=sc.combat.getEnemyTarget(a);e&&this.assignTarget(a,e,b,c,d)},assignTarget:function(a,b,c,d,e){a.targetLoseTimer=0;if(a.target!=b){a.setTarget(b,
e);if(a.target){f++;if(f>100)debugger;else{d||a.cancelAction();c&&this.targetDetect.notifyNeighbourRadius&&sc.combat.notifyNearbyEnemiesOfTarget(a,this.targetDetect.notifyNeighbourRadius)}f--}}},damageUpdate:function(a,b){var c=b.getCombatantRoot();if(!a.target&&c!=a){sc.combat.playerStartedCombat=true;this.assignTarget(a,c,true)}else if(c==a.target)a.targetLoseTimer=0},onNavigationFailed:function(a,b){b>5&&a.setTarget(null)},onStunEnd:function(a){a.reactions.current&&this.applyCurrentReaction(a)},
postActionUpdate:function(b){if((!b.params||!b.params.isDefeated()&&!b.params.isLocked())&&!b._killed&&!b.reactions.current&&!b.currentAction){a(this,b);b.nextState||this.checkReactions(b);if(!b.currentAction){b.nextState&&!b.hasStun()&&this.switchState(b,b.nextState);b.nextState||this.updateAction(b)}}},switchState:function(b,c){b.currentAction&&b.cancelAction();var d=b.currentState;b.currentState=c;b.nextState=null;b.postStun.choice=null;b.currentAction=null;b.currentActionStep=null;b.justEnteredState=
true;a(this,b);var e=this.states[b.currentState];if(e){var f=e.seamlessStates&&e.seamlessStates.indexOf(d)!=-1;d===c&&(f=true);b.setDefaultConfig(e.entityConfig);if(!f){for(var l in b.trackers){d=b.trackers[l];d.onStateChange&&d.onStateChange(b)}sc.combat.initFrequencyTimers(b)}b.walkAnims&&b.walkAnims.preIdle&&b.setCurrentAnim(b.walkAnims.preIdle,true,b.walkAnims.idle)}},switchStateConfig:function(a,b){a.setDefaultConfig(this.states[b].entityConfig)},isReadyToFight:function(a){return sc.combat.active&&
(!a.currentAction||a.currentAction.hint=="battle")},resolveHpBreak:function(a,b,c,e,f){if(!(b.hpBreakReached>=this.hpBreaks.length)){c=false;for(e=(b.params.currentHp-e)/b.params.getStat("hp");b.hpBreakReached<this.hpBreaks.length&&e<this.hpBreaks[b.hpBreakReached].hp;){d(f||b,this.hpBreaks[b.hpBreakReached].healDrop);if(a&&a.attackType==void 0)a.attackType=sc.ATTACK_TYPE.MASSIVE;b.hpBreakReached++;b.params.healStatus();c=true}return c}},resolveDefeat:function(a){if(this.credit){var b=this.credit;
a.level.override&&(b=sc.EnemyLevelScaling.adaptCredits(b,this.level,a.level.override));sc.model.player.addCredit(b,false,true)}if(this.exp){b=sc.model.player.addExperience(this.exp,a.level.override||this.level,0,false,sc.LEVEL_CURVES.REGULAR);sc.stats.addMap("player","expEnemies",b)}this.resolveItemDrops(a);var b=Math.random(),c=sc.combat.getPartyHpFactor(sc.COMBATANT_PARTY.PLAYER);a.dropHealOrb?d(a,a.dropHealOrb):this.healDropRate&&(c>0.8||(c<0.1&&b<0.7?d(a,this.healDropRate):c<0.3&&b<0.5?d(a,this.healDropRate):
b<0.2&&d(a,this.healDropRate)))},resolveItemDrops:function(a){if(sc.model.player.getCore(sc.PLAYER_CORE.ITEMS))for(var b=this.itemDrops,c=b.length,d=ig.game.playerEntity,e=sc.model.player.params.getModifier("DROP_CHANCE")+1,f=sc.model.getCombatRank(),o=sc.model.getCombatRankDropRate()*sc.newgame.getDropRateMultiplier();c--;){var m=b[c],n=Math.random();if(!(m.rank&&f<sc.model.getCombatRankByLabel(m.rank))&&!(m.boosted&&a.boosterState!=sc.ENEMY_BOOSTER_STATE.BOOSTED)&&n<=m.prob*(m.prob==1?1:e)*o){n=
m.min||1;m.max&&(n=n+Math.floor((m.max+1-n)*Math.random()));sc.ItemDropEntity.spawnDrops(a,ig.ENTITY_ALIGN.CENTER,d,m.item,n,sc.ITEM_DROP_TYPE.ENEMY)}}}});Vec2.create();sc.EnemyType.DETECT_TYPE={DISTANCE:1,VIEW:2,NONE:3};sc.CombatConditions=ig.Class.extend({conditions:[],init:function(a){for(var b=0;b<a.length;++b){var c=this._parseCondition(a[b]);this.conditions.push(c)}},_parseCondition:function(a){var b=a.type,c=false;if(b.charAt(0)=="!"){b=b.substr(1);c=true}if(!sc.COMBAT_CONDITION[b])throw Error("Unknown Condition type '"+
b+"'");a=new sc.COMBAT_CONDITION[b](a);a.not=c;return a},check:function(a,b,c,d){ig.vars.pushEntityAccessor(a);for(var e=0;e<this.conditions.length;++e){var f=this.conditions[e].check(a,b,c,d);if(!this.conditions[e].not&&!f||this.conditions[e].not&&f){ig.vars.popEntityAccessor(a);return false}}ig.vars.popEntityAccessor(a);return true},onReactionActivate:function(a){for(var b=this.conditions.length;b--;)if(this.conditions[b].onReactionActivate)this.conditions[b].onReactionActivate(a)},onPerformed:function(a,
b){for(var c=this.conditions.length;c--;){var d=this.conditions[c];if(d.onPrePerformed)d.onPrePerformed(a);if(d.onPerformed)if(b)a.deferredPerformedConds.push(d);else d.onPerformed(a)}}});sc.EnemyInfo=ig.Class.extend({init:function(a){this.settings=a;this.enemyType=new sc.EnemyType(a.type);if(this.settings.startEffect)this.startFx=new ig.EffectHandle(this.settings.startEffect);if(this.settings.hideEffect)this.hideFx=new ig.EffectHandle(this.settings.hideEffect)},getSettings:function(){return this.settings},
clearCached:function(){this.enemyType.decreaseRef();this.startFx&&this.startFx.clearCached();this.hideFx&&this.hideFx.clearCached()}});sc.EnemyState=ig.Class.extend({name:"",entityConfig:{},choices:[],seamlessStates:null,appearAction:null,init:function(a,b,d){this.name=a;this.seamlessStates=b.seamlessStates||null;this.entityConfig=new ig.ActorConfig;this.entityConfig.loadFromData(b,d);this.appearAction=b.appearAction||null;c(this.choices,b.choices)},selectAction:function(a){var b=Math.random();return e(this.choices,
a,b)}})});ig.baked=!0;
ig.module("game.feature.combat.model.enemy-annotation").defines(function(){sc.ENEMY_AGGRESSION={THREAT:0,TEMP_THREAT:1,PEACEFUL:2};sc.ENEMY_ANNO_ACTIVE={NONE:0,PRE_ATTACK:1,ATTACK:2,WIDE_RANGE_ATTACK:3,POST_ATTACK:4};sc.ENEMY_ANNO_PASSIVE={NONE:0,VULNERABLE:1,WEAK:2,IMMUNE:3};sc.ENEMY_ANNO_WEAPON={ANY:0,MELEE:1,RANGED:2};sc.ENEMY_ANNO_EXTRA={ATTACK_BACK:1,ATTACK_FRONT:2,LOOK_AWAY:4,BE_PASSIVE:8,BE_PASSIVE_IF_TARGETED:16,VIRUS_SPECIAL_RULE:32};sc.ENEMY_ANNO_ELEMENT={ANY:0,NEUTRAL:1,HEAT:2,COLD:3,SHOCK:4,
WAVE:5};ig.perf.aiSmart=false;sc.EnemyAnno={useMelee:function(b){return!b.annotate?false:b.annotate.weapon==sc.ENEMY_ANNO_WEAPON.MELEE},useRanged:function(b){return!b.annotate?false:b.annotate.weapon==sc.ENEMY_ANNO_WEAPON.RANGED},isVulnerable:function(b,a){return!b.annotate||a&&!this.doesRandomlyUnderstand(b,a)?false:b.annotate.passive==sc.ENEMY_ANNO_PASSIVE.VULNERABLE},isWeak:function(b,a){return!b.annotate||a&&!this.doesRandomlyUnderstand(b,a)?false:b.annotate.passive==sc.ENEMY_ANNO_PASSIVE.WEAK},
isImmune:function(b,a){return!b.annotate||a&&!this.doesRandomlyUnderstand(b,a)?false:b.annotate.passive==sc.ENEMY_ANNO_PASSIVE.IMMUNE},needDodge:function(b,a){return!b.annotate||a&&!this.doesRandomlyUnderstand(b,a)?false:b.annotate.active==sc.ENEMY_ANNO_ACTIVE.ATTACK||b.annotate.active==sc.ENEMY_ANNO_ACTIVE.WIDE_RANGE_ATTACK},keepFarDistance:function(b,a){return!b.annotate||a&&!this.doesRandomlyUnderstand(b,a)?false:b.annotate.active==sc.ENEMY_ANNO_ACTIVE.WIDE_RANGE_ATTACK},isCrossCounterEffective:function(b){return!b.annotate?
false:b.annotate.active==sc.ENEMY_ANNO_ACTIVE.PRE_ATTACK||b.annotate.active==sc.ENEMY_ANNO_ACTIVE.ATTACK},getElement:function(b){return!b.annotate?0:b.annotate.element-1},doesRandomlyUnderstand:function(b,a,d){return Math.random()<=this.getUnderstandFactor(b,a,d)},getUnderstandFactor:function(b,a,d){if(ig.perf.aiSmart)return 1;b=sc.combat.getEnemyAiExp(b,d);a=Math.min(0.1+a.model.level/100,0.5);a=a+b*(1-a);(b=sc.party.ai.battle)&&(a=b+(1-b)*a);return a},hasExtra:function(b,a){return!b.annotate?false:
b.annotate.extra&a},hasLookAway:function(b,a){return!this.doesRandomlyUnderstand(b,a)||b.target!=a?false:this.hasExtra(b,sc.ENEMY_ANNO_EXTRA.LOOK_AWAY)},hasAttackBack:function(b,a){return a&&!this.doesRandomlyUnderstand(b,a)?false:this.hasExtra(b,sc.ENEMY_ANNO_EXTRA.ATTACK_BACK)},hasAttackFront:function(b,a){return a&&!this.doesRandomlyUnderstand(b,a)?false:this.hasExtra(b,sc.ENEMY_ANNO_EXTRA.ATTACK_FRONT)},shouldBePassive:function(b,a){if(!this.doesRandomlyUnderstand(b,a,4))return false;if(this.isImmune(b)||
b.target==a&&this.hasExtra(b,sc.ENEMY_ANNO_EXTRA.BE_PASSIVE_IF_TARGETED)||this.hasExtra(b,sc.ENEMY_ANNO_EXTRA.BE_PASSIVE))return true;if(this.hasExtra(b,sc.ENEMY_ANNO_EXTRA.VIRUS_SPECIAL_RULE)){var d=sc.combat.getActiveCombatantCount(sc.COMBATANT_PARTY.ENEMY,"arid.virus-cold")+sc.combat.getActiveCombatantCount(sc.COMBATANT_PARTY.ENEMY,"arid.virus-heat"),c=sc.combat.getActiveCombatantCount(sc.COMBATANT_PARTY.ENEMY,"arid.virus-neutral");if(d>0&&c<=2)return true}return false}}});ig.baked=!0;
ig.module("game.feature.new-game.new-game-model").requires("impact.base.game","impact.feature.storage.storage","game.feature.model.base-model").defines(function(){sc.NEW_GAME_SETS={"carry-over":{type:"MULTI",order:1E3},money:{type:"SINGLE",order:2E3},exp:{type:"SINGLE",order:2001},"drop-rate":{type:"SINGLE",order:3E3},"combat-modifier":{type:"MULTI",order:1E4},itemCooldown:{type:"SINGLE",order:10100},"hp-regen":{type:"SINGLE",order:10200},enemy:{type:"MULTI",order:2E4},"enemy-damage":{type:"SINGLE",
order:3E4},"combat-arts":{type:"SINGLE",order:4E4},others:{type:"MULTI",order:5E4}};sc.NEW_GAME_OPTIONS={"money-plus-2":{set:"money",cost:500},"money-plus-4":{set:"money",cost:1E3},"disable-money":{set:"money",cost:100},"exp-plus-2":{set:"exp",cost:500},"exp-plus-4":{set:"exp",cost:1E3},"disable-exp":{set:"exp",cost:100},"drop-rate-2":{set:"drop-rate",cost:1E3},"drop-rate-4":{set:"drop-rate",cost:2E3},"keep-level":{set:"carry-over",cost:500,needsSaveFile:true},"keep-consumables":{set:"carry-over",
cost:500,needsSaveFile:true},"keep-addons":{set:"carry-over",cost:500,needsSaveFile:true},"keep-equipment":{set:"carry-over",cost:500,needsSaveFile:true},"keep-trade":{set:"carry-over",cost:500,needsSaveFile:true},"keep-money":{set:"carry-over",cost:500,needsSaveFile:true},"keep-elements":{set:"carry-over",cost:500,needsSaveFile:true},"keep-arena":{set:"carry-over",cost:500,needsSaveFile:true},"keep-botanics":{set:"carry-over",cost:500,needsSaveFile:true},"keep-traders":{set:"carry-over",cost:500,
needsSaveFile:true},"lea-must-die":{set:"combat-modifier",cost:100},"sergey-hax":{set:"combat-modifier",cost:5E3},"dash-1":{set:"combat-modifier",cost:2500},"witch-time":{set:"combat-modifier",cost:5E3},"overload-disable":{set:"combat-modifier",cost:1E3},"infinite-sp":{set:"combat-modifier",cost:2E3},"double-buff-time":{set:"combat-modifier",cost:2E3},"remove-skill-blocks":{set:"combat-modifier",cost:1E3},"item-cd-double":{set:"itemCooldown",cost:100},"item-cd-half":{set:"itemCooldown",cost:1E3},
"item-cd-zero":{set:"itemCooldown",cost:2E3},"combat-regen-half":{set:"hp-regen",cost:200},"combat-regen-zero":{set:"hp-regen",cost:100},"scale-enemies":{set:"enemy",cost:1E3},"harder-enemies":{set:"enemy",cost:1E3,disabled:false},"enemy-aggro":{set:"enemy",cost:1E3},"enemy-damage-15":{set:"enemy-damage",cost:1E3},"enemy-damage-2":{set:"enemy-damage",cost:1E3},"enemy-damage-4":{set:"enemy-damage",cost:1E3},"combat-arts-level-1":{set:"combat-arts",cost:500},"combat-arts-level-2":{set:"combat-arts",
cost:1E3},"waypoints-heals":{set:"others",cost:500},"waypoints-teleport":{set:"others",cost:500},"rhombus-start":{set:"others",cost:0},"no-trophies":{set:"others",cost:0},"ice-physics":{set:"others",cost:0}};sc.NewGamePlusModel=ig.GameAddon.extend({active:false,options:{},store:{},observers:[],init:function(){this.parent("New Game +");ig.storage.register(this);ig.vars.registerVarAccessor("newgame",this,"VarNewGameEditor");for(var b in sc.NEW_GAME_OPTIONS)if(sc.NEW_GAME_OPTIONS[b].requires)for(var a=
sc.NEW_GAME_OPTIONS[b].requires,d=a.length;d--;){if(!sc.NEW_GAME_OPTIONS[a[d]].usedBy)sc.NEW_GAME_OPTIONS[a[d]].usedBy=[];sc.NEW_GAME_OPTIONS[a[d]].usedBy.push(b)}},onReset:function(){this.options={};this.active=false},setActive:function(b){this.active=b||false},setActiveAndOptions:function(b){this.setActive(true);for(var a=0;a<b.length;++a){var d=b[a];if(!sc.NEW_GAME_OPTIONS[d])throw Error("Invalid Option: "+d);this.options[d]||this.toggle(d)}},toggle:function(b,a){if(sc.NEW_GAME_OPTIONS[b]){this.options[b]=
!this.options[b];if(!a)a=sc.NEW_GAME_OPTIONS[b].set;if(a&&sc.NEW_GAME_SETS[a].type==sc.TOGGLE_SET_TYPE.SINGLE)for(var d in sc.NEW_GAME_OPTIONS)sc.NEW_GAME_OPTIONS[d]&&(a==sc.NEW_GAME_OPTIONS[d].set&&d!=b)&&(this.options[d]=false);if(sc.NEW_GAME_OPTIONS[b].usedBy&&!this.options[b]){d=sc.NEW_GAME_OPTIONS[b].usedBy;for(var c=d.length;c--;)this.options[d[c]]=false}return this.options[b]||false}},get:function(b){return!this.active?false:sc.NEW_GAME_OPTIONS[b]?this.options[b]||false:false},storeSaveData:function(b){this.store.level=
b.player.level},applyData:function(b){for(var a=[],d=sc.model.player,c=b.player,e=c.items,f=sc.inventory.items.length;f--;)this._checkItemCondition(sc.inventory.getItem(f).type)&&(a[f]=e[f]);if(this.options["keep-equipment"]&&c.equip){this._checkEquip(c,"head",a);this._checkEquip(c,"leftArm",a);this._checkEquip(c,"rightArm",a);this._checkEquip(c,"torso",a);this._checkEquip(c,"feet",a)}d.items=a;if(this.options["keep-money"])d.credit=c.credit||0;if(this.options["keep-arena"])sc.arena.onNewGameApply(b);
if(this.options["keep-traders"])sc.trade.onNewGameApply(b);if(this.options["keep-botanics"])sc.menu.onNewGameApply(b)},applyStoreData:function(b){if(this.active&&(this.options["rhombus-start"]||!b)){var a=sc.model.player;this.options["keep-level"]&&this.store.level?a.setLevel(this.store.level):this.options["rhombus-start"]&&b&&(!this.options["disable-exp"]&&a.level<=1?a.setLevel(2):a.setLevel(a.level||1))}},_checkItemCondition:function(b){return b==sc.ITEMS_TYPES.CONS&&this.options["keep-consumables"]||
b==sc.ITEMS_TYPES.EQUIP&&this.options["keep-equipment"]||b==sc.ITEMS_TYPES.TRADE&&this.options["keep-trade"]||b==sc.ITEMS_TYPES.TOGGLE&&this.options["keep-addons"]?true:false},_checkEquip:function(b,a,d){b=b.equip[a];b>=0&&d[b]++},onVarAccess:function(b,a){if(a[0]=="newgame")return a[1]=="active"?this.active:this.get(a[1]);throw Error("Unsupported var access path: "+b);},getCost:function(){var b=0,a;for(a in this.options)this.options[a]&&(b=b+(sc.NEW_GAME_OPTIONS[a].cost||0));return b},requiresSaveFile:function(){for(var b in this.options)if(this.options[b]&&
sc.NEW_GAME_OPTIONS[b].needsSaveFile)return true;return false},hasAnyOptions:function(){for(var b in this.options)if(this.options[b])return true;return false},hasHarderEnemies:function(){return this.get("harder-enemies")},getDropRateMultiplier:function(){return!this.active?1:this.options["drop-rate-4"]?4:this.options["drop-rate-2"]?2:1},getMoneyMultiplier:function(){return!this.active?1:this.options["money-plus-2"]?2:this.options["money-plus-4"]?4:1},getEXPMultiplier:function(){return!this.active?
1:this.options["exp-plus-2"]?2:this.options["exp-plus-4"]?4:1},onStorageSave:function(b){var a={};a.options=ig.copy(this.options);a.active=this.active;a.store=ig.copy(this.store);b.newGamePlus=a},onStoragePreLoad:function(b){this.options={};var b=b.newGamePlus||{},a=b.options||{},d;for(d in a)sc.NEW_GAME_OPTIONS[d]&&a[d]&&(this.options[d]=true);this.active=b.active||false;this.store=b.store||{}}});ig.addGameAddon(function(){return sc.newgame=new sc.NewGamePlusModel})});ig.baked=!0;
ig.module("game.feature.combat.entities.enemy").requires("game.feature.combat.entities.combatant","game.feature.combat.model.enemy-type","game.feature.combat.model.enemy-annotation","game.feature.new-game.new-game-model").defines(function(){Vec2.create();var b={damagingEntity:null,attackInfo:null,partEntity:null,damageResult:null,shielded:false,hpBroken:null,killed:false,weakness:false,dramaticEffect:null};sc.ENEMY_HP_BAR={AUTO:0,VISIBLE:1,HIDDEN:2};sc.ENEMY_BOOSTER_STATE={NONE:0,BOOSTABLE:1,BOOSTED:2};
ig.ENTITY.Enemy=ig.ENTITY.Combatant.extend({party:sc.COMBATANT_PARTY.ENEMY,aggression:sc.ENEMY_AGGRESSION.THREAT,enemyName:null,enemyType:null,enemyGroup:null,defeatVarIncrease:null,enemyTypeInitialized:false,dropHealOrb:0,hpAttached:{enemy:null,value:0},spawnPoint:Vec3.create(),currentState:null,postStun:{choice:null,collab:null},nextState:null,nextTimerChange:null,stateTimers:{},trackers:{},deferredPerformedConds:[],targetLoseTimer:0,reactions:{enabled:[],current:null,running:null,restartAction:null},
dodge:{count:0,timer:0,blocked:0,counterReactTime:0,counterCooldown:0,counterCooldownMax:0},annotate:{active:0,passive:0,weapon:0,element:0,extra:null},hpBreakReached:0,lastPoICheck:null,targetFixed:false,collaboration:null,collabAttribs:null,elementModes:null,storedEnemies:[],ownerEnemy:null,cameraZFocus:0,startEffect:null,targetOnSpawn:false,boosterState:0,level:{override:null,setting:null},visibility:{analyzable:true,hpBar:sc.ENEMY_HP_BAR.AUTO},_wm:new ig.Config({spawnable:true,attributes:{enemyInfo:{_type:"EnemyType",
_info:"Enemy information",_popup:true},spawnCondition:{_type:"VarCondition",_info:"Condition for Enemy to spawn",_popup:true},manualKill:{_type:"VarName",_info:"Instead of killing the enemy, set specified variable to true.",_optional:true}},label:function(){return""},drawBox:true,boxColor:"rgba(255,0,0, 0.5)"}),init:function(a,b,d,g){this.parent(a,b,d,g);this.setSize(24,24,0);Vec3.assign(this.spawnPoint,this.coll.pos);if(g.enemyInfo){this.enemyName=g.enemyInfo.type;this.enemyType=new sc.EnemyType(g.enemyInfo.type);
this.enemyGroup=g.enemyInfo.group;this.currentState=g.enemyInfo.state||null;this.dropHealOrb=g.enemyInfo.dropHealOrb||0;if(g.enemyInfo.startEffect)this.startEffect=new ig.EffectHandle(g.enemyInfo.startEffect);if(g.enemyInfo.hideEffect)this.hideAction=new ig.Action("enemyHide",[{type:"SHOW_EFFECT",effect:g.enemyInfo.hideEffect,wait:true,align:"CENTER"},{type:"HIDE"}]);if(g.enemyInfo.varIncrease){this.defeatVarIncrease=g.enemyInfo.varIncrease;ig.vars.setDefault(this.defeatVarIncrease,0)}this.targetOnSpawn=
g.enemyInfo.targetOnSpawn||false;this.level.setting=sc.newgame.get("scale-enemies")&&!g.enemyInfo.disableNoScale&&!ig.vars.get("g.newgame.intro")?sc.model.player.getParamAvgLevel(4):g.enemyInfo.level||null;if(g.enemyInfo.party)this.party=sc.COMBATANT_PARTY[g.enemyInfo.party];var a=g.enemyInfo.attribs,h;for(h in a)this.setAttribute(h,a[h]);h=ig.ActorEntity.FACE8.SOUTH;g.enemyInfo.face&&(h=ig.ActorEntity.FACE8[g.enemyInfo.face]||ig.ActorEntity.FACE8.NORTH);ig.ActorEntity.getFaceVec(h,this.face);if(window.wm){this._wm=
this._wm.copy();this._wm.drawBox=false;this.enemyType.initEntity(this);this.initAnimations()}}this.manualKill=g.manualKill||null;this.ownerEnemy=g.ownerEnemy||null;this.boosterState=g.boostable?sc.ENEMY_BOOSTER_STATE.BOOSTABLE:sc.ENEMY_BOOSTER_STATE.NONE;g.startAction&&this.setAction(g.startAction)},setElementMode:function(a,b){if(this.elementModes&&this.elementModes.current!=a){this.params.setBaseParams(this.elementModes.modes[a],b);if(b)ig.EffectTools.clearEffects(this,"modeAura");else{sc.combat.showModeChange(this,
a);sc.combat.showModeAura(this,a)}this.elementModes.current=a}},getQuickMenuSettings:function(){return{type:"Enemy",disabled:!this.params||!this.visibility.analyzable||!sc.combat.isEnemyAnalyzable(this.enemyName)}},connectHpToEnemies:function(a){for(var b=this.params.getHpFactor()/a.length,d=a.length;d--;){var g=a[d];g.hpAttached.enemy=this;g.hpAttached.value=b}},setLevelOverride:function(a){this.level.override=a;this.enemyTypeInitialized&&this.enemyType.updateParams(this)},getLevel:function(){return this.level.override||
this.enemyType.level},storeEnemy:function(a){this.storedEnemies.push(a)},onStoredRelease:function(){this.show(true);for(var a=0;a<this.reactions.enabled.length;++a){var b=this.reactions.enabled[a],d=this.enemyType.reactions[b];if(d.type=="STORE_RELEASE"){this.reactions.current=b;d.onStoredRelease(this);return true}}},onEnemyEvent:function(a,b,d){for(var g=0;g<this.reactions.enabled.length;++g){var h=this.reactions.enabled[g],i=this.enemyType.reactions[h];if(i.type=="ENEMY_EVENT"&&i.checkEnemyEvent(this,
a,b,d)){this.reactions.current=h;i.onEnemyEvent(this,this.enemyType.actions);return true}}},onMagnetStart:function(){if(this.isDefeated())return false;if(this.onEnemyEvent(this.target,sc.COMBAT_ENEMY_EVENT.MAGNET_PULL,null)){this.invincibleTimer=-1;this.coll.setType(ig.COLLTYPE.IGNORE);this.damageTimer=1E3;return true}},onMagnetEnd:function(){this.damageTimer=this.invincibleTimer=0;this.cancelAction()},isBoss:function(){return this.enemyType.boss},getHeadIdx:function(){return this.enemyType.headIdx},
show:function(b){this.parent(b);var d=this.currentAction;this.level.setting&&this.setLevelOverride(1*ig.Event.getExpressionValue(this.level.setting));this.enemyType.initEntity(this);this.initAnimations();if(!b){this.animState.alpha=0;b=this.enemyType.getAppearAction(this);if(d||!b)this.startEffect?this.startEffect.spawnOnTarget(this):ig.game.effects.teleport.spawnOnTarget("showDefault",this);this.setAction(d||b||a)}this.targetOnSpawn&&this.enemyType.reselectTarget(this,false,true,true)},onHideRequest:function(){this.statusGui&&
this.statusGui.remove();this.statusGui=null;if(!this.dying){ig.EffectTools.clearEffects(this);this.setAction(this.hideAction||d)}},hide:function(){ig.EffectTools.clearEffects(this);this.parent()},onKill:function(a){this.parent(a);a||this._delegateDamage();this.startEffect&&this.startEffect.clearCached();this.hideAction&&this.hideAction.clearCached();this.enemyType.onEntityKill(this);this.enemyType.decreaseRef()},regenPvp:function(a){this.parent(a);this.setElementMode(sc.ELEMENT.NEUTRAL);this.postStun.choice=
null;this.reactions.current=null;this.reactions.restartAction=null},update:function(){if(this.dodge.counterCooldownMax){this.dodge.counterCooldown=this.dodge.counterCooldown+ig.system.tick;if(this.dodge.counterCooldown>=this.dodge.counterCooldownMax)this.dodge.counterCooldownMax=this.dodge.counterCooldown=0}if(this.dodge.timer>0){this.dodge.timer=this.dodge.timer-ig.system.tick;if(this.dodge.timer<=0){this.dodge.timer=0;this.dodge.count=0;this.dodge.blocked=false}}this.ownerEnemy&&(this.ownerEnemy.isDefeated()&&
!this.isDefeated())&&this.instantDefeat();this.enemyType&&!this.enemyTypeInitialized&&this.enemyType.initEntity(this);if(this.enemyType&&this.enemyType.isReadyToFight(this)){this.targetFixed=false;for(var a in this.stateTimers)this.stateTimers[a]=this.stateTimers[a]-ig.system.tick;for(a in this.trackers){var b=this.trackers[a];b.update&&b.update()}this.enemyType.update(this)}else this.targetFixed||this.setTarget(null);this.parent()},onTargetHit:function(a,b,d,g,h){if(g==sc.SHIELD_RESULT.PERFECT&&
!h.isBall){a.combo&&a.combo.guardTrapTime&&this.setCounterCooldown();for(h=0;h<this.reactions.enabled.length;++h){var i=this.reactions.enabled[h],j=this.enemyType.reactions[i];if(j.type=="GUARD_COUNTER"&&j.onGuardCounterCheck(this)){this.reactions.current=i;j.onGuardCountered(this,a);return true}}}this.parent(a,b,d,g)},setCounterCooldown:function(){for(var a in this.enemyType.reactions){var b=this.enemyType.reactions[a];if(b.type=="COUNTER_COUNTER"){this.dodge.counterCooldownMax=b.cooldown;this.dodge.counterCooldown=
0;break}}},onFallBehavior:function(a){for(var b=0;b<this.reactions.enabled.length;++b){var d=this.reactions.enabled[b],g=this.enemyType.reactions[d];if(g.type=="FALL"&&g.checkFall(a)){if(this.reactions.running==g)return true;g.onFall(this);this.reactions.current=d;return true}}return false},postActionUpdate:function(){this.enemyType&&this.enemyType.isReadyToFight(this)&&this.enemyType.postActionUpdate(this)},onStunEnd:function(){if(this.enemyType&&this.enemyType.isReadyToFight(this))this.enemyType.onStunEnd(this)},
changeState:function(a,b,d){if(this.enemyType)if(b){this.cancelAction();this.enemyType.initEntity(this);this.enemyType.switchState(this,a)}else{this.nextState=a;d&&this.enemyType.switchStateConfig(this,a)}},onPreDamageModification:function(a,d,f,g,h,i,j){var k=false;b.damagingEntity=d;b.attackInfo=f;b.partEntity=g;b.damageResult=h;b.shielded=i;b.weakness=0;b.dramaticEffect=null;f=Math.random();k=this._checkHitReactions(a,d,f,false);if(a.damageResult)h=a.damageResult;g=h&&h.damage||0;i=0;b.killed=
false;if(!j){if(h&&this.enemyType.resolveHpBreak(a,this,d.getCombatant(),h.damage)){i=this.hpBreakReached;k=true}b.killed=this.params&&this.params.currentHp>0&&this.params.currentHp-g<=0;b.killed&&(i=0)}b.hpBroken=i;k=this._checkHitReactions(a,d,f,true)||k;b.dramaticEffect&&sc.combat.doDramaticEffect(d.getCombatantRoot(),this,b.dramaticEffect);b.killed&&!a.survive&&this._delegateDamage();return k},_delegateDamage:function(){if(this.hpAttached.enemy){var a=Math.ceil(this.hpAttached.enemy.params.getStat("hp")*
this.hpAttached.value);this.hpAttached.enemy.instantDamage(a,2,this);this.hpAttached.enemy=null}},onInstantDamage:function(a,d){var f=0;b.damagingEntity=ig.game.playerEntity;b.attackInfo=null;b.partEntity=null;b.damageResult=null;b.shielded=false;b.weakness=0;b.dramaticEffect=null;if(this.enemyType.resolveHpBreak(null,this,ig.game.playerEntity,a,d))f=this.hpBreakReached;b.killed=this.params&&this.params.currentHp>0&&this.params.currentHp-a<=0;b.killed&&(f=0);b.hpBroken=f;f={survive:false};(b.killed||
b.hpBroken)&&this._checkHitReactions(f,ig.game.playerEntity,Math.random(),true);b.dramaticEffect&&sc.combat.doDramaticEffect(ig.game.playerEntity,d||this,b.dramaticEffect);b.killed&&!f.survive&&this._delegateDamage();return f.survive},_checkHitReactions:function(a,d,f,g){for(var h=false,i=0;i<this.reactions.enabled.length;++i){b.weakness=0;var j=this.reactions.enabled[i],k=this.enemyType.reactions[j];if(k.type=="HIT_REACTION"){var l=!k.needInterrupt();if(g||l||!(k.hitType!=sc.HIT_REACTION_TYPE.FORCE_HIT&&
this.reactions.current))if(k.checkHit(this,f,b,a,g)){if(!l)this.reactions.current=j;k.hitApply(this,d,b,a,this.enemyType.actions);if(b.weakness>=1&&k.dramaticEffect){this.statusGui.clearStatusEntry("BREAK");a.weakness=0}h=true;if(!l)return true}else{if(b.weakness&&k.dramaticEffect){k.partFocus?this.statusGui.setReplaceTarget(ig.CollTools.getNamedSubCollEntity(this.coll,k.partFocus)):this.statusGui.setReplaceTarget(null);a.weakness=b.weakness}if(k.ignoreFailed&&!b.weakness)a.ignoreHit=true}}}return h},
collabReady:function(a){for(var b=0;b<this.reactions.enabled.length;++b){var d=this.enemyType.reactions[this.reactions.enabled[b]];if(d.type=="COLLAB"&&d.isReady(this,a))return true}},doCollabReaction:function(a){if(!this.collaboration)throw Error("Tried to do collab reaction without collaboration set. Should never happen!");for(var b=0;b<this.reactions.enabled.length;++b){var d=this.reactions.enabled[b],g=this.enemyType.reactions[d];if(g.type=="COLLAB"&&g.collabKey==a){this.reactions.current=d;this.enemyType.applyCurrentReaction(this);
break}}},getEnemyAction:function(a){var b=this.enemyType.actions[a];if(!b)throw Error("Enemy does not has action of Name: "+a);return b},doEnemyAction:function(a,b,d){var g=this.enemyType.actions[a];if(!g)throw Error("Enemy does not has action of Name: "+a);if(d){if(!b){this.clearActionAttached();this.defaultConfig.apply(this)}this.pushInlineAction(g)}else this.setAction(g,false,b)},onDamage:function(a,b,d){(d=this.parent(a,b,d))&&!b.limiter.noAggro&&!b.hasNoEffect()&&this.enemyType&&this.enemyType.damageUpdate(this,
a);return d},onNavigationFailed:function(a){sc.model.isForceCombat()||this.enemyType&&this.enemyType.onNavigationFailed(this,a)},onDefeat:function(a){this.defeatVarIncrease&&ig.vars.add(this.defeatVarIncrease,1);a||this.enemyType.resolveDefeat(this)},enableReactions:function(a){if(a)for(var b=a.length;b--;){var d=a[b];if(this.reactions.enabled.indexOf(d)==-1)this.enemyType.reactions[d].onActivate(this)}this.reactions.enabled.length=0;a&&this.reactions.enabled.push.apply(this.reactions.enabled,a)},
enableReaction:function(a){if(this.reactions.enabled.indexOf(a)==-1){this.reactions.enabled.push(a);this.enemyType.reactions[a].onActivate(this)}},disableReaction:function(a){a=this.reactions.enabled.indexOf(a);a!=-1&&this.reactions.enabled.splice(a,1)},onVarAccess:function(a,b){return b[1]=="dodgeBlocked"?this.dodge.blocked:b[1]=="hpBreak"?this.hpBreakReached:b[1]=="level"?this.getLevel():b[1]=="storedEnemyCnt"?this.storedEnemies.length:b[1]=="ownerAttrib"?!this.ownerEnemy?null:ig.vars.resolveObjectAccess(this.ownerEnemy.attributes,
b,2):b[1]=="owner"?!this.ownerEnemy?null:ig.vars.forwardEntityVarAccess(this.ownerEnemy,b,2):b[1]=="collab"?!this.collaboration?null:this.collaboration.onVarAccess(a,b):this.parent(a,b)}});ig.ACTOR_CONFIGS.ENEMY={classType:ig.ENTITY.Enemy,KEYS:{enabledReactions:[],aggression:sc.ENEMY_AGGRESSION.THREAT,regenFactor:0,stunEscapeTime:0,annotate:{},size:Vec3.createC(16,16,16),analyzable:true,hpBar:sc.ENEMY_HP_BAR.AUTO},fromDataFix:function(){typeof this.aggression=="string"&&(this.aggression=sc.ENEMY_AGGRESSION[this.aggression]);
typeof this.hpBar=="string"&&(this.hpBar=sc.ENEMY_HP_BAR[this.hpBar]);if(this.annotate){var a=this.annotate;if(a.extra&&a.extra instanceof Array){for(var b=a.extra,d=0,g=0;g<b.length;++g)d=d|sc.ENEMY_ANNO_EXTRA[b[g]];a.extra=d}typeof a.active=="string"&&(a.active=sc.ENEMY_ANNO_ACTIVE[a.active]);typeof a.passive=="string"&&(a.passive=sc.ENEMY_ANNO_PASSIVE[a.passive]);typeof a.weapon=="string"&&(a.weapon=sc.ENEMY_ANNO_WEAPON[a.weapon]);typeof a.element=="string"&&(a.element=sc.ENEMY_ANNO_ELEMENT[a.element])}else this.annotate=
{}},apply:function(a){a.enableReactions(this.enabledReactions);if(a.aggression!=this.aggression){a.aggression=this.aggression;if(a.target){var b=a.target;a.setTarget(null);a.setTarget(b)}}a.visibility.analyzable=this.analyzable==void 0?true:this.analyzable;a.visibility.hpBar=this.hpBar;a.regenFactor=this.regenFactor;a.stunData.stunEscapeTime=this.stunEscapeTime||0;a.annotate.active=this.annotate.active||0;a.annotate.passive=this.annotate.passive||0;a.annotate.weapon=this.annotate.weapon||0;a.annotate.extra=
this.annotate.extra||0;a.annotate.element=this.annotate.element||0;this.size&&!window.wm&&a.coll.setSize(this.size.x,this.size.y,this.size.z,true)},load:function(a){this.enabledReactions=ig.copy(a.reactions.enabled);this.stunEscapeTime=a.stunData.stunEscapeTime;this.aggression=a.aggression;this.regenFactor=a.regenFactor;this.annotate={active:a.annotate.active,passive:a.annotate.passive,weapon:a.annotate.weapon,extra:a.annotate.extra,element:a.annotate.element};this.analyzable=a.visibility.analyzable;
this.hpBar=a.visibility.hpBar}};var a=new ig.Action("enemyStart",[{type:"WAIT",time:0.4}]),d=new ig.Action("enemyHide",[{type:"SHOW_EFFECT",effect:{sheet:"teleport",name:"hideDefault"},wait:true,align:"CENTER"},{type:"HIDE"}])});ig.baked=!0;
ig.module("game.feature.combat.entities.enemy-spawner").requires("impact.base.actor-entity").defines(function(){ig.ENTITY.EnemySpawner=ig.Entity.extend({enemyTypes:[],maxEnemies:0,respawnTimer:0,initialSpawn:false,effectInitialSpawn:false,_wm:new ig.Config({spawnable:true,attributes:{spawnCondition:{_type:"VarCondition",_info:"Condition for prop to appear",_popup:true},enemyTypes:{_type:"EnemyTypeList",_info:"All enemies that are spawned on this place",_popup:true},onActivateClear:{_type:"Boolean",
_info:"If true: initially set all enemies as killed when activated."}},scalableX:true,scalableY:true,drawBox:true,boxColor:"rgba(255,120,0, 0.5)"}),init:function(b,a,d,c){this.parent(b,a,d,c);this.coll.type=ig.COLLTYPE.NONE;c.size||this.coll.setSize(32,32,0);if(c.enemyTypes){b=c.enemyTypes;for(a=0;a<b.length;++a){d={info:b[a].info,type:new sc.EnemyType(b[a].info.type),count:b[a].count,activeEnemies:[]};this.maxEnemies=this.maxEnemies+d.count;this.enemyTypes.push(d)}}this.onActivateClear=c.onActivateClear},
show:function(b){this.parent(b);if(!b)this.onActivateClear?this._storeState(true):this.effectInitialSpawn=true},onKill:function(b){this.parent(b);this._storeState();for(b=this.enemyTypes.length;b--;)this.enemyTypes[b].type.decreaseRef()},_storeState:function(b){for(var a=[],d=0,c=0;c<this.enemyTypes.length;c++){var e=this.enemyTypes[c].activeEnemies.length;b&&(e=0);a[c]=this.enemyTypes[c].count-e;d=d+a[c]}c=-1;d>0&&(c=b?sc.combat.time+180:sc.combat.time+this.respawnTimer);ig.vars.set(this._getVarPrefix(),
{killed:a,respawnTime:c})},_getVarPrefix:function(){return"session.map.spawner"+this.mapId},update:function(){if(!this.initialSpawn){this.initialSpawn=true;var b=ig.vars.get(this._getVarPrefix()),a=null,d=180;if(b&&(sc.combat.time<b.respawnTime-180+30||!sc.model.isSRank()&&sc.combat.time<b.respawnTime)){a=b.killed;d=b.respawnTime-sc.combat.time}this.respawnEnemies(this.effectInitialSpawn,a);this.respawnTimer=d}b=true;a=0;for(d=this.enemyTypes.length;d--;){for(var c=this.enemyTypes[d],e=c.activeEnemies.length;e--;){var f=
c.activeEnemies[e];if(f.defeatNotified){c.activeEnemies.splice(e,1);c.activeEnemies.length==0&&ig.game.varsChangedDeferred()}else f.target&&(b=false)}a=a+(c.count-c.activeEnemies.length)}if(b&&a>0&&sc.combat.active){this.respawnTimer=this.respawnTimer-ig.system.tick;if(this.respawnTimer<=0||sc.model.isSRank()&&this.respawnTimer<=150){this.respawnEnemies(true);this.respawnTimer=180}}},isCleared:function(){if(!this.initialSpawn)return false;for(var b=this.enemyTypes.length;b--;)if(this.enemyTypes[b].activeEnemies.length>
0)return false;return true},respawnEnemies:function(b,a){for(var d=this.enemyTypes.length;d--;)for(var c=this.enemyTypes[d],e=c.count-c.activeEnemies.length-(a&&a[d]||0);e--;){var f=this.spawnEnemy(c,b);if(sc.newgame.get("enemy-aggro"))f.enemyType.targetDetect.onDistance=true;c.activeEnemies.push(f)}ig.game.varsChangedDeferred()},spawnEnemy:function(b,a){var d=this.coll,c=b.type.size,e=d.size.x-c.x,c=d.size.y-c.y;e<0&&(e=0);c<0&&(c=0);return ig.game.spawnEntity(ig.ENTITY.Enemy,Math.round(d.pos.x+
Math.random()*e),Math.round(d.pos.y+Math.random()*c),d.pos.z,{enemyInfo:b.info,boostable:true},a)}})});ig.baked=!0;
ig.module("game.feature.combat.entities.respawn-blocker").requires("impact.base.entity").defines(function(){ig.ENTITY.RespawnBlocker=ig.Entity.extend({_wm:new ig.Config({spawnable:true,attributes:{},label:function(){return"RespawnBlocker"},scalableX:true,scalableY:true,drawBox:true,boxColor:"rgba(0,255,255, 0.3)"}),init:function(b,a,d,c){this.parent(b,a,d,c);this.coll.type=ig.COLLTYPE.NONE;c.size||this.coll.setSize(32,32,0);sc.combat.addRespawnBlocker(this)}})});ig.baked=!0;
ig.module("game.feature.combat.entities.burst-spawner").requires("game.constants","impact.feature.effect.effect-sheet","impact.base.entity").defines(function(){ig.BurstSpawnerEntity=ig.Entity.extend({combatant:null,target:null,attack:null,moveSpeed:0,spawnCount:3,spawnInterval:0.2,effect:null,damageDelay:0,radius:32,zHeight:24,steerDegree:0.2,adjustTime:0,timer:0,spawnList:[],isThreat:true,init:function(b,a,d,c){this.parent(b,a,d,c);this.coll.type=ig.COLLTYPE.IGNORE;this.coll.bounciness=1;this.coll.accelSpeed=
0;this.coll.friction.ground=0;this.coll.setSize(4,4,4);this.coll.vel.x=c.vel.x;this.coll.vel.y=c.vel.y;this.target=(this.combatant=c.combatant||null)&&this.combatant.target;this.attack=c.attack;this.moveSpeed=c.moveSpeed||40;this.spawnCount=c.spawnCount||3;this.spawnInterval=c.spawnInterval||0.3;this.effect=c.effect;this.damageDelay=c.damageDelay||0;this.radius=c.radius||32;this.zHeight=c.zHeight||24;this.steerDegree=c.steerDegree||0.2;this.adjustTime=c.adjustTime||0;if(this.cancelOnCollision=c.cancelOnCollision||
false)this.coll.bounciness=0},getCombatant:function(){return this.combatant},handleMovementTrace:function(b){!this._killed&&b.collided&&this.cancelOnCollision?this.kill():this.parent(b)},update:function(){this.timer=this.timer+ig.system.tick;for(var b=Math.min(this.spawnCount,Math.floor(this.timer/this.spawnInterval));this.spawnList.length<b;)this.startSpawn();for(var a=false,d=0;d<this.spawnList.length;++d)a=this.updateSpawn(this.spawnList[d]);if(b==this.spawnCount&&a)this.kill();else{this.target&&
sc.BallTools.adjustDirection(this,this.target,this.timer,this.adjustTime,this.steerDegree);Vec2.length(this.coll.vel,this.moveSpeed)}this.parent()},startSpawn:function(){var b=Vec3.create(this.coll.pos);this.spawnList.push({pos:b,timer:this.damageDelay});this.effect.spawnFixed(b.x,b.y,b.z)},updateSpawn:function(b){if(b.timer>=0){b.timer=b.timer-ig.system.tick;if(b.timer<=0){b=new sc.CircleHitForce(this.combatant,{pos:b.pos,radius:this.radius,attack:this.attack,zHeight:this.zHeight});sc.combat.addCombatForce(b);
return true}return false}return true}})});ig.baked=!0;
ig.module("game.feature.combat.entities.stone").requires("game.feature.combat.entities.projectile","game.feature.combat.model.proxy","game.constants","impact.feature.effect.effect-sheet","impact.base.entity","impact.feature.light.light").defines(function(){sc.StoneInfo=sc.PROXY_TYPE.STONE=sc.ProxySpawnerBase.extend({data:null,_wm:new ig.Config({attributes:{animation:{_type:"AnimSheet",_info:"Animation sheet of ball. Needs one entry with name 'default'",_popup:true},size:{_type:"Offset",_info:"Size of projectile",
_optional:true},shadow:{_type:"Number",_info:"Shadow size"},effects:{_type:"String",_info:"Effect sheet for effects",_select:"effects",_withNull:true},effectKeys:{_type:"EffectKeys",_info:"What keys to use in the effect sheet",_optional:true},maxBounce:{_type:"Integer",_info:"Number of times the stone can bounce on walls"},groundBounce:{_type:"Integer",_info:"How often stone can bounce on ground before being destroyed"},attack:{_type:"AttackInfo",_info:"How the ball will hit its target"},speed:{_type:"NumberVary",
_info:"Speed of ball",_default:300},zVel:{_type:"NumberVary",_info:"Z Vel when thrown"},zBounciness:{_type:"Number",_info:"Amount of z bounciness"},multiHit:{_type:"Boolean",_info:"True if stone can hit multiple targets"},light:{_type:"String",_info:"Size of light shown for this ball",_optional:true,_select:ig.LIGHT_SIZE},noLightGlow:{_type:"Boolean",_info:"If true, don't make light glow for stone"}}}),init:function(a){this.data=a;a.animation.shapeType||(a.animation.shapeType="YZ_EXPAND");a.animation.wallY=
1;a.animation=new ig.AnimationSheet(a.animation);a.effects&&(a.effects=new ig.EffectSheet(a.effects))},getSize:function(a){this.data.size?Vec3.assign(a,this.data.size):Vec3.assignC(a,8,8,8);return a},clearCached:function(){this.data.effects&&this.data.effects.decreaseRef();this.data.animation&&this.data.animation.clearCached()},spawn:function(a,b,c,e,f){f={dir:f,stoneInfo:this.data,params:e.getCombatantRoot().params,party:e.party,combatant:e};e.getCombatantRoot().isPlayer&&sc.stats.addMap("player",
"throws",1);return ig.game.spawnEntity(ig.ENTITY.Stone,a,b,c,f)}});Vec2.create();var b=Vec3.create();Vec3.create();ig.ENTITY.Stone=ig.ENTITY.Projectile.extend({party:0,target:null,params:null,attackInfo:null,multiHit:false,remainingGroundHits:0,effects:null,effectKeys:null,lightHandle:null,grab:null,behaviors:null,behaviorData:null,init:function(a,b,c,e){this.parent(a,b,c,{vel:e.dir,combatant:e.combatant});this.party=e.party;this.params=e.params;this.setStoneInfo(e.stoneInfo);this.coll.zGravityFactor=
1},setStoneInfo:function(a){var d=this.coll,c=ig.Event.getNumberVary(a.speed),e=ig.Event.getNumberVary(a.zVel);Vec2.length(d.vel,c);d.vel.z=e;d.maxVel=c;d.shadow.size=a.shadow||16;d.zBounciness=a.zBounciness||0;c=a.size;e=Vec3.assign(b,d.size);c?d.setSize(c.x,c.y,c.z):d.setSize(8,8,8);d.setPos(d.pos.x-(this.coll.size.x-e.x)/2,d.pos.y-(this.coll.size.y-e.y)/2,d.pos.z);this.coll.type=ig.COLLTYPE.PROJECTILE;this.coll.setSize(8,8,8);if(this.combatant)this.target=this.combatant.target;this.behaviors=a.behaviors||
null;this.animSheet=a.animation;this.initAnimations(a.animation);this.effects=a.effects;this.effectKeys=a.effectKeys||null;this.multiHit=a.multiHit||false;this.remainingHits=a.maxBounce;this.remainingGroundHits=a.groundBounce;if(a.attack)this.attackInfo=new sc.AttackInfo(this.params,a.attack,true);ig.EffectTools.clearEffects(this,"trail");d=this.effectKeys&&this.effectKeys.trail||"stoneTrail";this.effects&&this.effects.hasEffect(d)&&this.effects.spawnOnTarget(d,this,{duration:-1,group:"trail"});this.lightHandle&&
this.lightHandle.stop();this.lightHandle=new ig.LightHandle(this,ig.LIGHT_SIZE[a.light||"XS"],0,0.2,-1,1,!a.noLightGlow);ig.light.addLightHandle(this.lightHandle)},onBounce:function(a,b){this.effects&&this.effects.spawnFixed(this.effectKeys&&this.effectKeys.wallBounce||"stoneWallBounce",a.x,a.y,this.coll.pos.z,null,{angle:Vec2.clockangle(b.blockDir)})},onProjectileKill:function(){if(this.effects){var a=this.effectKeys&&this.effectKeys.kill||"stoneKill";if(this.effects.hasEffect(a)){var b=this.getAlignedPos(ig.ENTITY_ALIGN.CENTER);
this.effects.spawnFixed(a,b.x,b.y,b.z,null)}}},onProjectileHit:function(a){var b=false;if(this.attackInfo&&a.damage&&a.party!=this.party){var c=this.attackInfo,b=true;if(a.damage(this,c)&&!this.multiHit){this.onProjectileKill();this.kill()}}b&&this.combatant.isPlayer&&sc.stats.addMap("player","throwHits",1);return b},onTouchGround:function(){if(!this.remainingGroundHits){this.onProjectileKill();this.kill()}if(this.coll.vel.z<10){this.onProjectileKill();this.kill()}this.remainingGroundHits--},getElement:function(){return this.attackInfo&&
this.attackInfo.element||sc.ELEMENT.NEUTRAL}})});ig.baked=!0;
ig.module("game.feature.combat.gui.status-bar").requires("impact.feature.gui.gui").defines(function(){var b=Vec2.create();sc.STATUS_BAR_ENTRY={BREAK:{icon:0,init:null,barY:40},BURN:{icon:2,init:null,barY:44,half:true},CHILL:{icon:3,init:null,barY:48,half:true},WEAK:{icon:4,init:null,barY:52,half:true},BRITTLE:{icon:5,init:null,barY:56,half:true}};var a={};ig.GUI.StatusBar=ig.GuiElementBase.extend({transitions:{DEFAULT:{state:{},time:0.25,timeFunction:KEY_SPLINES.EASE_OUT},HIDDEN:{state:{scaleX:1,
scaleY:0,angle:Math.PI*0.1},time:0.25,timeFunction:KEY_SPLINES.EASE_IN}},gfx:new ig.Image("media/gui/status-gui.png"),barIconTiles:new ig.TileSheet("media/gui/status-gui.png",8,8,240,0,2),target:null,replaceTarget:null,currentHp:0,targetHp:0,timer:0,largeTimer:0,subHpHandler:null,subHpType:0,statusEntries:{},statusDisplayOrder:[],init:function(a){this.parent();this.setSize(24,4);this.setPivot(12,2);this.hook.localAlpha=0.7;this.hook.zIndex=-50;this.hook.invisibleUpdate=true;this.doStateTransition("HIDDEN",
true);this.target=a;this.initStatusEntries();a.params&&this.initWithParams()},showHpBar:function(){if(!this.target.params)return false;var a=sc.options.get("hp-bars");return this.target.isPlayer?a==sc.HP_BARS.LEA:this.target.party==sc.COMBATANT_PARTY.PLAYER?a<=sc.HP_BARS.PARTY:this.target instanceof ig.ENTITY.Enemy&&(this.target.visibility.hpBar==sc.ENEMY_HP_BAR.HIDDEN||this.target.visibility.hpBar!=sc.ENEMY_HP_BAR.VISIBLE&&this.target.aggression==sc.ENEMY_AGGRESSION.PEACEFUL)?false:!this.subHpHandler},
initWithParams:function(){if(this.target.params){this.currentHp=this.targetHp=this.target.params.currentHp;sc.Model.addObserver(this.target.params,this);sc.Model.addObserver(sc.pvp,this);this.updateSubHpHandler();this.target instanceof ig.ENTITY.Enemy&&this.target.visibility.analyzable&&this.doStateTransition("DEFAULT")}},updateSubHpHandler:function(){var a=null;this.target.party==sc.COMBATANT_PARTY.ENEMY&&sc.pvp.isCombatantInPvP(this.target)?a="PVP":this.target.isBoss&&this.target.isBoss()&&(a="BOSS");
if(this.subHpType!=a){if(this.subHpHandler){this.subHpHandler.remove();this.subHpHandler=null}if(this.subHpType=a){this.subHpHandler=new sc.SUB_HP_EDITOR[a](this.target);ig.gui.addGuiElement(this.subHpHandler);this.subHpHandler.initWithParams()}}},modelChanged:function(a,b,e){a==sc.pvp?this.updateSubHpHandler():(b==sc.COMBAT_PARAM_MSG.HP_CHANGED||b==sc.COMBAT_PARAM_MSG.STATS_CHANGED)&&this.setHp(this.target.params.currentHp,e)},initStatusEntries:function(){for(var a in sc.STATUS_BAR_ENTRY)this.statusEntries[a]=
{value:0,timer:0}},_shiftFrontStatusDisplayOrder:function(a,b){var e=this.statusDisplayOrder.indexOf(a);if(!(b&&e==-1)&&(!this.statusDisplayOrder.length||e!=this.statusDisplayOrder.length-1)){e!=-1&&this.statusDisplayOrder.splice(e,1);this.statusDisplayOrder.push(a)}},setStatusEntry:function(a,b){this._shiftFrontStatusDisplayOrder(a);a!="BREAK"&&this._shiftFrontStatusDisplayOrder("BREAK",true);var e=this.statusEntries[a];e.value=b;e.stick=false;e.timer=Math.max(e.timer,2)},updateStatusEntry:function(a,
b){this.statusEntries[a].value=b},setReplaceTarget:function(a){this.replaceTarget=a},setStatusEntryStick:function(a,b){if(b){this._shiftFrontStatusDisplayOrder(a);a!="BREAK"&&this._shiftFrontStatusDisplayOrder("BREAK",true)}var e=this.statusEntries[a];if(e.stick=b)e.timer=2},clearStatusEntry:function(a){a=this.statusEntries[a];a.timer=Math.min(a.timer,0.1)},clearAllStatusEntries:function(){for(var a=this.statusDisplayOrder.length;a--;)this.clearStatusEntry(this.statusDisplayOrder[a])},setHp:function(a,
b){a<0&&(a=0);if(b){this.largeTimer=this.timer=0;this.targetHp=this.currentHp=a}else{this.timer=0.5;this.largeTimer=2;if((this.targetHp-this.currentHp)*(a-this.targetHp)<0)this.currentHp=this.targetHp;this.targetHp=a}},update:function(){var a=this.hook;a.removeAfterTransition||(this.target instanceof ig.ENTITY.Combatant&&this.target.isDefeated()&&!sc.pvp.isCombatantInPvP(this.target)?this.remove():(this.target._killed||this.target._hidden)&&this.remove());for(var c=this.statusDisplayOrder.length;c--;)this._updateStatusEntry(this.statusDisplayOrder[c])&&
this.statusDisplayOrder.splice(c,1);if(this.statusDisplayOrder.length==0&&this.replaceTarget)this.replaceTarget=null;a.localAlpha=this.largeTimer>0.2?1:0.9;if(this.largeTimer>0)this.largeTimer=this.largeTimer-ig.system.actualTick;if(this.timer>0)this.timer=this.timer-ig.system.actualTick;else if(this.targetHp!=this.currentHp){c=ig.system.actualTick*this.target.params.getStat("hp")/2;if(this.currentHp>this.targetHp)this.currentHp=Math.max(this.targetHp,this.currentHp-c);else if(this.currentHp<this.targetHp)this.currentHp=
Math.min(this.targetHp,this.currentHp+c);if(this.largeTimer<0.2)this.largeTimer=0.2;if(this.currentHp==this.targetHp)this.timer=0.2}var c=this.replaceTarget||this.target,e=c.getCenter();ig.system.getScreenFromMapPos(b,Math.round(e.x),Math.round(e.y-c.coll.pos.z+c.coll.size.y/2));this.hook.pos.x=b.x-a.size.x/2;this.hook.pos.y=b.y-a.size.y/2;if(!a.removeAfterTransition){c=false;this.target.party==sc.COMBATANT_PARTY.PLAYER&&sc.model.isCutscene()&&(c=true);this.target instanceof ig.ENTITY.Enemy&&!this.target.visibility.analyzable&&
(c=true);c||this.hook.pos.x+a.size.x<0||this.hook.pos.x>ig.system.width||this.hook.pos.y+a.size.y<0||this.hook.pos.y>ig.system.height?this.doStateTransition("HIDDEN"):this.doStateTransition("DEFAULT")}},_updateStatusEntry:function(a){a=this.statusEntries[a];if(!a.stick||a.timer<=0.1)a.timer=a.timer-ig.system.actualTick;if(a.timer<=0)a.stick=false;return a.timer<=0},updateDrawables:function(a){if(!(this.target instanceof ig.ENTITY.Enemy)||sc.options.get("enemy-status-bars")){this.showHpBar()&&this._drawHpBar(a);
for(var b=this.statusDisplayOrder.length,e=0,f=-5;b--;){this.drawStatusEntry(a,e,f,this.statusDisplayOrder[b]);f=f-5;e=e+3}}},_drawHpBar:function(a){var b=this.target.params.getStat("hp"),e=this.largeTimer>=0.2,f=e?0:20;if(!e&&this.largeTimer>=0){e=this.largeTimer/0.2;e=Math.floor(e*24+(1-e)*16)}else e=e?24:16;var g=(24-e)/2,h=(Math.min(this.targetHp,this.currentHp)/b).limit(0,1),i=(Math.max(this.targetHp,this.currentHp)/b).limit(0,1),b=Math.ceil((e-2)*h)+1,h=Math.ceil((e-2)*i)+1,i=0;this.target.party==
sc.COMBATANT_PARTY.PLAYER?i=8:this.target.target&&(i=4);a.addGfx(this.gfx,g,0,216,0+f+i,b,4);h!=b&&a.addGfx(this.gfx,b,0,216+b,16,h-b,4);a.addGfx(this.gfx,g+h,0,240-e+h,12+f,e-h,4)},drawStatusEntry:function(b,c,e,f){var g=this.statusEntries[f],f=sc.STATUS_BAR_ENTRY[f],h=1;g.timer<0.1&&(h=g.timer/0.1);h!=1&&b.addTransform().setPivot(c,e+2).setScale(1,h);var i=24,j=0;if(f.half)j=i=i/2;var k=this.barIconTiles.getTileSrc(a,f.icon);if(g.stick)b.addGfx(this.gfx,c-6,e-2,k.x,k.y,8,8);else{if(g.timer>1.7)var l=
Math.sin(Math.PI*8*(2-g.timer)/0.3),c=c+l;g=1+Math.floor(g.value*(i-2));l=i-1-g;c=c+j;b.addGfx(this.gfx,c,e,216,f.barY,g,4);l&&b.addGfx(this.gfx,c+g,e,216+g,12,l,4);b.addGfx(this.gfx,c+(i-1),e-2,k.x+1,k.y,7,8)}h!=1&&b.undoTransform()},remove:function(){this.target.params&&sc.Model.removeObserver(this.target.params,this);sc.Model.removeObserver(sc.pvp,this);this.doStateTransition("HIDDEN",false,true);this.subHpHandler&&this.subHpHandler.remove();this.subHpHandler=null},forceRemove:function(){this.target.params&&
sc.Model.removeObserver(this.target.params,this);sc.Model.removeObserver(sc.pvp,this);this.doStateTransition("HIDDEN",true,true);this.subHpHandler&&this.subHpHandler.forceRemove();this.subHpHandler=null}})});ig.baked=!0;
ig.module("game.feature.combat.gui.pvp-gui").requires("impact.feature.gui.gui","impact.feature.gui.base.box").defines(function(){sc.PvpRoundGui=ig.GuiElementBase.extend({transitions:{DEFAULT:{state:{},time:0.25,timeFunction:KEY_SPLINES.EASE_OUT},HIDDEN:{state:{scaleX:3,scaleY:0},time:0.25,timeFunction:KEY_SPLINES.EASE_IN}},gfx:new ig.Image("media/gui/pvp.png"),timer:0,init:function(b,a){this.parent();this.setSize(64,64);this.setPivot(32,32);this.setAlign(ig.GUI_ALIGN.X_CENTER,ig.GUI_ALIGN.Y_CENTER);
this.setPos(0,-80);var d=new sc.TextGui("Round",{});d.setAlign(ig.GUI_ALIGN.X_CENTER,ig.GUI_ALIGN.Y_CENTER);d.setPos(0,-5);this.addChildGui(d);d=new sc.NumberGui(9,{size:sc.NUMBER_SIZE.LARGE});d.setNumber(b);d.setAlign(ig.GUI_ALIGN.X_CENTER,ig.GUI_ALIGN.Y_CENTER);d.setPos(0,9);this.addChildGui(d);this.doStateTransition("HIDDEN",true);this.doStateTransition("DEFAULT");if(a)this.timer=1},update:function(){if(this.timer){this.timer=this.timer-ig.system.actualTick;if(this.timer<=0){sc.pvp.finalizeRoundStart();
this.remove()}}},updateDrawables:function(b){b.addGfx(this.gfx,0,0,0,0,64,64)},remove:function(){this.timer=0;this.doStateTransition("HIDDEN",false,true)}});sc.PvpKoGui=ig.GuiElementBase.extend({transitions:{START:{state:{scaleX:3,scaleY:3},time:0.25,timeFunction:KEY_SPLINES.EASE_IN},DEFAULT:{state:{},time:0.1,timeFunction:KEY_SPLINES.EASE_OUT},HIDDEN:{state:{scaleX:3,scaleY:0},time:0.2,timeFunction:KEY_SPLINES.EASE_IN}},gfx:new ig.Image("media/gui/pvp.png"),timer:0,init:function(){this.parent();
this.setSize(64,64);this.setPivot(32,32);this.setAlign(ig.GUI_ALIGN.X_CENTER,ig.GUI_ALIGN.Y_CENTER);this.setPos(0,0);this.doStateTransition("START",true);this.doStateTransition("DEFAULT");this.timer=1},update:function(){if(this.timer){this.timer=this.timer-ig.system.actualTick;this.timer<=0&&this.remove()}},remove:function(){this.timer=0;this.doStateTransition("HIDDEN",false,true)},updateDrawables:function(b){b.addGfx(this.gfx,0,0,64,0,64,64).setCompositionMode("lighter");b.addGfx(this.gfx,0,0,128,
0,64,64)}})});ig.baked=!0;
ig.module("game.feature.combat.model.combat-status").requires("game.feature.combat.model.combat-params","impact.feature.effect.effect-sheet").defines(function(){sc.CombatStatusBase=ig.Class.extend({id:0,statusBarEntry:null,offenseModifier:null,defenseModifier:null,effects:new ig.EffectSheet("combatant"),duration:5,charge:0,active:false,effectiveness:0,fxHandle:null,init:function(){},getInflictValue:function(b,a,d,c){if(this.active||c==sc.SHIELD_RESULT.PERFECT)return 0;a=Math.max(0,1-a.getModifier(this.defenseModifier));
d=this._getOffensiveFactor(d);return b*a*d/12},inflict:function(b,a,d){var c=a.combatant;this.charge=this.charge+b;this.charge>=1?this.activate(c,a,d):this.statusBarEntry&&c.statusGui&&c.statusGui.setStatusEntry(this.statusBarEntry,this.charge)},_getOffensiveFactor:function(b){return 1+b.attackerParams.getModifier(this.offenseModifier)+b.attackerParams.getModifier("COND_EFFECT_ALL")},activate:function(b,a,d){this.charge=1;this.active=true;this.effectiveness=a.getStat("statusEffect")[this.id]*this._getOffensiveFactor(d);
sc.combat.showCombatantLabel(b,this.getLabel(),1.5);if(this.onActivate)this.onActivate(b);this.initEntity(b)},initEntity:function(b){if(this.active){this.fxHandle&&this.fxHandle.stop();b.statusGui&&b.statusGui.setStatusEntryStick(this.statusBarEntry,true);this.fxHandle=this.effects.spawnOnTarget(this.label,b,{duration:-1});if(this.onInitEntity)this.onInitEntity(b)}},getEffectiveness:function(b){b=Math.max(0,1-b.getModifier(this.defenseModifier));return this.effectiveness*b},clear:function(b){this.charge=
0;this.active=false;this.fxHandle&&this.fxHandle.stop();if(b){if(this.onClear)this.onClear(b);b.statusGui&&b.statusGui.clearStatusEntry(this.statusBarEntry)}},update:function(b,a,d){var c=Math.max(0,1-a.getModifier("COND_HEALING"));d||(c=c/5);if(this.active){this.charge=this.charge-ig.system.ingameTick/(c*this.duration);if(this.charge<=0)this.clear(b);else if(this.onUpdate)this.onUpdate(b,a)}else if(this.charge>0){this.charge=this.charge-ig.system.ingameTick/(50*c);if(this.charge<0)this.charge=0;
b.statusGui&&b.statusGui.updateStatusEntry(this.statusBarEntry,this.charge)}},getLabel:function(){var b=ig.lang.get("sc.gui.combat."+this.label);return"\\i["+this.label+"]"+b},onActivate:null,onInitEntity:null,onUpdate:null,onClear:null});sc.COMBAT_STATUS=[];sc.BurnStatus=sc.COMBAT_STATUS[0]=sc.CombatStatusBase.extend({id:0,label:"burn",statusBarEntry:"BURN",offenseModifier:"COND_EFFECT_HEAT",defenseModifier:"COND_GUARD_HEAT",duration:20,burnTimer:0,onUpdate:function(b,a){this.burnTimer=this.burnTimer+
ig.system.ingameTick;if(!(b.getCombatantRoot().isPlayer&&sc.model.isCutscene()||!b.damageFactor&&b.hitIgnore&&b.invincibleTimer)&&this.burnTimer>0.5){var d=Math.floor(a.getStat("hp")*(0.3/(this.duration/0.5))*this.getEffectiveness(a));b.instantDamage(d,0.5);this.effects.spawnOnTarget("burnDamage",b);this.burnTimer=0}}});sc.ChillStatus=sc.COMBAT_STATUS[1]=sc.CombatStatusBase.extend({id:1,label:"chill",statusBarEntry:"CHILL",offenseModifier:"COND_EFFECT_COLD",defenseModifier:"COND_GUARD_COLD",duration:20,
influence:null,init:function(){this.parent();this.influence=new ig.InfluenceEntry},onInitEntity:function(b){b.influencer.addInfluence(this.influence)},onUpdate:function(b,a){this.influence.timeScale=(1-this.getEffectiveness(a)*0.25).limit(0.25,1)},onClear:function(b){b.influencer.removeInfluence(this.influence)}});sc.JoltStatus=sc.COMBAT_STATUS[2]=sc.CombatStatusBase.extend({id:2,label:"jolt",statusBarEntry:"WEAK",offenseModifier:"COND_EFFECT_SHOCK",defenseModifier:"COND_GUARD_SHOCK",duration:20,
shockTimer:0,onActivate:function(b){this.attackInfo=new sc.AttackInfo(b.params,{damageFactor:0.33,type:"MASSIVE",visualType:"LIGHT",fly:"HEAVY",element:"SHOCK",critFactor:0,noHack:true,limiter:"NO_HIT_PROXY"})},onUpdate:function(b,a){this.shockTimer=this.shockTimer+ig.system.ingameTick;if(!(b.getCombatantRoot().isPlayer&&sc.model.isCutscene()||!b.damageFactor&&b.hitIgnore&&b.invincibleTimer)){var d=this.getEffectiveness(a);if(d&&this.shockTimer>3/d&&!b.invincibleTimer){d=0.33;b instanceof ig.ENTITY.Enemy&&
(d=d*(1+b.enemyType.enduranceScale));this.attackInfo.damageFactor=d;b.onDamage(b,this.attackInfo);this.shockTimer=0}}}});sc.MarkStatus=sc.COMBAT_STATUS[3]=sc.CombatStatusBase.extend({id:3,label:"mark",statusBarEntry:"BRITTLE",offenseModifier:"COND_EFFECT_WAVE",defenseModifier:"COND_GUARD_WAVE",duration:20,getValue:function(b){return!this.active?0:this.getEffectiveness(b)*0.5}})});ig.baked=!0;ig.module("game.feature.combat.combat-target-event").defines(function(){sc.COMBAT_ENEMY_EVENT={}});
ig.baked=!0;
ig.module("game.feature.combat.model.enemy-reaction").requires("impact.base.loader","game.feature.combat.model.combat-params","game.feature.combat.model.combat-condition","impact.base.animation","game.feature.combat.entities.combatant","game.feature.combat.combat-target-event").defines(function(){var b={},a=ig.Class.extend({name:"",type:0,action:null,postSwitchState:null,ignoreStun:false,restartPrevAction:false,init:function(a,b){this.name=a;this.type=b.type;this.action=b.action||null;this.postSwitchState=
b.postSwitchState||null;this.restartPrevAction=b.restartPrevAction||false},onActivate:function(){},preApply:function(){},apply:function(a,b){if(this.restartPrevAction)a.reactions.restartAction=a.currentAction;this.action&&a.setAction(b[this.action]);a.nextState=this.postSwitchState},check:null});sc.ENEMY_REACTION={};sc.HIT_REACTION_TYPE={REGULAR:1,FORCE_HIT:2,HP_BREAK_HIT:3,KILL_HIT:4,KILL_SURVIVE:5};var d={FORCE_STUN:1,FORCE_STABLE:2,NO_CHANGE:3};sc.ENEMY_REACTION.HIT_REACTION=a.extend({preAction:null,
preSwitchState:null,blockFurtherHits:false,damageFactor:void 0,attackType:0,flyLevel:null,forceStable:false,conditions:null,dramaticEffect:null,alignFace:false,_wm:new ig.Config({attributes:{hitType:{_type:"String",_info:"Type of hit reaction. Careful: FORCE_HIT will always cancel ANY other concurrent reaction.",_select:sc.HIT_REACTION_TYPE},preAction:{_type:"EnemyActionRef",_info:"An Action that is very quickly executed before enemy is damaged. Any step that is not executed immediately will CANCEL this action",
_optional:true},preSwitchState:{_type:"EnemyStateRef",_info:"State to switch to before reaction starts",_optional:true},postSwitchState:{_type:"EnemyStateRef",_info:"State to switch to after reaction ended",_optional:true},action:{_type:"EnemyActionRef",_info:"Action to perform on reaction",_optional:true},blockFurtherHits:{_type:"Boolean",_info:"If true - increase hitStable to withstand all following hits"},damageFactor:{_type:"Number",_info:"Damange factor applied on this attack",_optional:true,
_default:1},attackType:{_type:"String",_info:"If defined: change attackType of hit",_withNull:true,_select:sc.ATTACK_TYPE},flyLevel:{_type:"String",_info:"If defined: change flyLevel of hit",_withNull:true,_select:sc.COMBAT_FLY_LEVEL},stunChange:{_type:"String",_info:"Determines how Hit reaction will impact attack stun. NO_IMPACT: Will not influence hit stun in any way",_select:d},alignFace:{_type:"Boolean",_info:"If true, then entity should watch towards hit direction"},dramaticEffect:{_type:"String",
_info:"Dramatik effect of Reaction",_withNull:true,_select:sc.DRAMATIC_EFFECT},conditions:{_type:"CombatConditions",_info:"Additional conditions for hit condition"},walkAnims:{_type:"String",_info:"Override walk animation prior to damage",_optional:true},ignoreFailed:{_type:"Boolean",_info:"If true: ignore hit if hit reaction is active but hit doesn't trigger it"},partFocus:{_type:"String",_info:"If defined: set status bar to be located at part of given name",_optional:true}}}),init:function(a,b){this.parent(a,
b);this.hitType=sc.HIT_REACTION_TYPE[b.hitType]||sc.HIT_REACTION_TYPE.REGULAR;this.preAction=b.preAction||null;this.preSwitchState=b.preSwitchState||null;this.blockFurtherHits=b.blockFurtherHits||false;this.damageFactor=b.damageFactor;this.attackType=sc.ATTACK_TYPE[b.attackType]||0;this.flyLevel=b.flyLevel||null;this.stunChange=d[b.stunChange]||d.FORCE_STUN;this.alignFace=b.alignFace||false;this.dramaticEffect=sc.DRAMATIC_EFFECT[b.dramaticEffect]||null;this.walkAnims=b.walkAnims||null;this.ignoreFailed=
b.ignoreFailed||false;this.partFocus=b.partFocus||null;var c=b.conditions;if(c)this.conditions=new sc.CombatConditions(c)},onActivate:function(a){this.conditions&&this.conditions.onReactionActivate(a)},needInterrupt:function(){return this.action||this.postSwitchState||this.preSwitchState||this.stunChange==d.FORCE_STUN},hitApply:function(a,b,c,e,f){a.threat=b.getCombatant();this.conditions&&this.conditions.onPerformed(a);var l=false;if(this.preAction){a.stashAction(true);a.setAction(f[this.preAction]);
a.forceExecuteAction();a.resumeStashedAction(true)}if(this.hitType==sc.HIT_REACTION_TYPE.HP_BREAK_HIT){a.setCombatStat("breaks",0);a.setCombatStat("guardCounters",0)}if((f=b.getCombatantRoot())&&f.party==sc.COMBATANT_PARTY.PLAYER&&this.dramaticEffect&&this.dramaticEffect.break){sc.stats.addMap("combat","enemyBreaks",1);sc.arena.onEnemyBreak(a);a.addCombatStat("breaks",1)}if(this.damageFactor!=void 0){e.damageFactor=e.damageFactor*this.damageFactor;l=true}if(this.stunChange!=d.NO_CHANGE){if(this.attackType)e.attackType=
this.attackType;if(this.flyLevel)e.flyLevel=this.flyLevel;if(this.preSwitchState){a.enemyType.switchState(a,this.preSwitchState);l=true}if(this.stunChange==d.FORCE_STABLE)e.hitStable=sc.ATTACK_TYPE.BREAK;else{e.hitStable=sc.ATTACK_TYPE.NONE;a.cancelAction()}if(this.blockFurtherHits)a.hitStable=sc.ATTACK_TYPE.MASSIVE;this.walkAnims&&a.setWalkAnims(this.walkAnims)}if(this.alignFace)e.alignFace=true;if(this.dramaticEffect)c.dramaticEffect=this.dramaticEffect;if(this.hitType==sc.HIT_REACTION_TYPE.KILL_SURVIVE){e.survive=
true;a.params.damageFactor=0}if(l&&a.params&&c.attackInfo&&c.attackInfo.attackerParams&&(this.hitType==sc.HIT_REACTION_TYPE.REGULAR||this.hitType==sc.HIT_REACTION_TYPE.FORCE_HIT))e.damageResult=a.params.getDamage(c.attackInfo,e.damageFactor,b.getCombatant())},checkHit:function(a,b,c,d,e){if(e){if(this.hitType==sc.HIT_REACTION_TYPE.REGULAR||this.hitType==sc.HIT_REACTION_TYPE.FORCE_HIT||this.hitType==sc.HIT_REACTION_TYPE.HP_BREAK_HIT&&!c.hpBroken||this.hitType==sc.HIT_REACTION_TYPE.KILL_HIT&&!c.killed||
this.hitType==sc.HIT_REACTION_TYPE.KILL_SURVIVE&&!c.killed)return false}else if(this.hitType!=sc.HIT_REACTION_TYPE.REGULAR&&this.hitType!=sc.HIT_REACTION_TYPE.FORCE_HIT)return false;return!this.conditions?true:this.conditions.check(a,b,c,d)}});var c=Vec2.create(),e=Vec2.create(),f=Vec3.create();sc.ENEMY_REACTION.TARGET_DISTANCE=a.extend({minDistance:null,maxDistance:null,_wm:new ig.Config({attributes:{minDistance:{_type:"Number",_info:"Minimum Distance to target to trigger"},maxDistance:{_type:"Number",
_info:"Maximum Distance to target to trigger"},preSwitchState:{_type:"EnemyStateRef",_info:"State to switch to before reaction starts",_optional:true},postSwitchState:{_type:"EnemyStateRef",_info:"State to switch to after reaction ended",_optional:true},targetFace:{_type:"Number",_info:"If defined, only activate if target is looking at enemy with given range. 0.5 = maximum 45 degree away",_optional:true},ownFace:{_type:"Number",_info:"If defined, only activates if enemy is looking at close entity with given range. 0.5 = maximum 45 degree away",
_optional:true},preciseFace:{_type:"Boolean",_info:"If true, use precise face direction, not rounded by animation"},checkCollision:{_type:"Boolean",_info:"If true, check collision for view vector"},poiFilter:{_type:"PoiFilter",_info:"If defined: react to closeby POI instead of target",_optional:true},action:{_type:"EnemyActionRef",_info:"Action to perform on reaction",_optional:true},conditions:{_type:"CombatConditions",_info:"Additional conditions for hit condition"},ignoreParty:{_type:"Boolean",
_info:"If true: Ignore party members for detection"},ignoreReplaceTargets:{_type:"Boolean",_info:"If true: Ignore Target Replacements"}}}),init:function(a,b){this.parent(a,b);this.minDistance=b.minDistance||null;this.maxDistance=b.maxDistance||null;this.preSwitchState=b.preSwitchState||null;this.targetFace=b.targetFace||0;this.ownFace=b.ownFace||0;this.checkCollision=b.checkCollision||false;this.ignoreParty=b.ignoreParty||false;this.ignoreReplaceTargets=b.ignoreReplaceTargets||false;this.ignoreStun=
true;this.preciseFace=b.preciseFace||false;this.poiFilter=sc.CombatPoI.initPoiFilter(b.poiFilter);var c=b.conditions;if(c)this.conditions=new sc.CombatConditions(c)},preApply:function(a){this.preSwitchState&&a.enemyType.switchState(a,this.preSwitchState)},check:function(a){if(this.conditions&&!this.conditions.check(a,Math.random())||a.jumping)return false;if(this.poiFilter){var b=sc.CombatPoI.getClosestPoI(this.poiFilter,a,this.maxDistance);return b&&this._subCheck(a,b)}if(this._subCheck(a,ig.game.playerEntity))return true;
if(!this.ignoreParty)for(b=sc.party.getPartySize();b--;)if(this._subCheck(a,sc.party.getPartyMemberEntityByIndex(b)))return true;return false},_subCheck:function(a,d){if(!d||d.isDefeated()||d._killed)return false;var i=d;!this.ignoreReplaceTargets&&d.replaceTargets&&(d=d.replaceTargets[0]);var j=ig.CollTools.getDistVec2(d.coll,a.coll,c),k=Vec2.length(j),l=(!this.minDistance||k>=this.minDistance)&&(!this.maxDistance||k<=this.maxDistance);if(l&&this.targetFace){if(i!=a.target)return false;Vec2.angle(j,
d.face)>Math.PI*this.targetFace&&(l=false)}var o=0;if(l&&this.ownFace){Vec2.flip(j);var m=a.getCurrentAnimFaceCount();if(this.preciseFace)m=a.face;else{m=a.getCurrentAnimFaceCount();m=ig.getRoundedFaceDir(a.face.x,a.face.y,m,e)}o=Vec2.angle(j,m);o>Math.PI*this.ownFace&&(l=false);Vec2.flip(j)}if(l&&(!this.checkCollision&&this.maxDistance)&&(a.coll.pos.z>d.coll.pos.z+d.coll.size.z||d.coll.pos.z>a.coll.pos.z+a.coll.size.z))return false;if(l&&this.checkCollision){Vec2.flip(j);var m=a.getAlignedPos(ig.ENTITY_ALIGN.TOP,
f),n=a.coll.pos.z+a.coll.size.z,p=n,r=d.coll.pos.z+d.coll.size.z;r>p&&(p=r);r<p&&(p=r);var r=ig.game.getLevelIdx(n),t=ig.game.getLevelIdx(p);if(Math.abs(r-t)>1)return false;var q=Math.abs(n-p);if(k<q*2||this.ownFace&&o>Math.PI*this.ownFace*((k-q)/k))return false;if(r!=t){o=Math.max(n,p);q=Math.min(n,p);k=ig.game.levels[Math.max(r,t)];o=(o-k.height)/(o-q);r<t&&(o=1-o);r=Math.round(j.x*o);t=Math.round(j.y*o);o=m.x+r;q=m.y+t;if(!ig.game.isOverHole(o-1,q-1,k.height,2,2,true))return false;k=ig.game.physics.initTraceResult(b);
if(ig.game.trace(k,m.x-1,m.y-1,n,r,t,2,2,2,ig.COLLTYPE.IGNORE,d)||ig.game.isAreaBlocked(o-1,q-1,p,2,2,2,true))return false;k=ig.game.physics.initTraceResult(b);if(ig.game.trace(k,o-1,q-1,p,j.x-r,j.y-t,2,2,2,ig.COLLTYPE.IGNORE,d))return false}else{k=ig.game.physics.initTraceResult(b);if(ig.game.trace(k,m.x-1,m.y-1,n,j.x,j.y,2,2,2,ig.COLLTYPE.IGNORE,d))return false}}l&&a.setTarget(i);return l}});sc.ENEMY_REACTION.MOVEMENT_BLOCK=a.extend({preSwitchState:null,angle:null,_wm:new ig.Config({attributes:{preSwitchState:{_type:"EnemyStateRef",
_info:"State to switch to before reaction starts",_optional:true},postSwitchState:{_type:"EnemyStateRef",_info:"State to switch to after reaction ended",_optional:true},action:{_type:"EnemyActionRef",_info:"Action to perform on reaction",_optional:true},angle:{_type:"Number",_info:"The minimum angle to the wall for block to be accepted",_default:0.125}}}),init:function(a,b){this.parent(a,b);this.preSwitchState=b.preSwitchState||null;this.angle=b.angle||0.125},preApply:function(a){this.preSwitchState&&
a.enemyType.switchState(a,this.preSwitchState)},check:function(a){return ig.CollTools.hasWallCollide(a.coll,this.angle)}});sc.ENEMY_REACTION.COLLAB=a.extend({collabKey:null,conditions:null,_wm:new ig.Config({attributes:{collabKey:{_type:"String",_info:"Collaboration Key to react to",_optional:true},preSwitchState:{_type:"EnemyStateRef",_info:"State to switch to before reaction starts",_optional:true},postSwitchState:{_type:"EnemyStateRef",_info:"State to switch to after reaction ended",_optional:true},
action:{_type:"EnemyActionRef",_info:"Action to perform on reaction",_optional:true},conditions:{_type:"CombatConditions",_info:"Additional conditions for hit condition"}}}),init:function(a,b){this.parent(a,b);this.collabKey=b.collabKey||null;this.preSwitchState=b.preSwitchState||null;this.ignoreStun=true;this.conditions=new sc.CombatConditions(b.conditions)},isReady:function(a,b){var c=Math.random();return this.collabKey==b&&this.conditions.check(a,c)},apply:function(a,b){this.preSwitchState&&a.enemyType.switchState(a,
this.preSwitchState);this.action&&a.removeEntityAttached(a.collaboration);this.parent(a,b)}});sc.ENEMY_REACTION.GUARD_COUNTER=a.extend({_wm:new ig.Config({attributes:{preSwitchState:{_type:"EnemyStateRef",_info:"State to switch to before reaction starts",_optional:true},postSwitchState:{_type:"EnemyStateRef",_info:"State to switch to after reaction ended",_optional:true},action:{_type:"EnemyActionRef",_info:"Action to perform on reaction",_optional:true},conditions:{_type:"CombatConditions",_info:"Additional conditions for counter block"}}}),
sound:new ig.Sound("media/sound/battle/hit-counter-echo.ogg",1),init:function(a,b){this.parent(a,b);this.preSwitchState=b.preSwitchState||null;this.ignoreStun=true;var c=b.conditions;if(c)this.conditions=new sc.CombatConditions(c)},onGuardCounterCheck:function(a){return this.conditions&&!this.conditions.check(a,Math.random())?false:true},onGuardCountered:function(a,b){this.preSwitchState&&a.enemyType.switchState(a,this.preSwitchState);if(b.getCombatantRoot().isPlayer){sc.stats.addMap("combat","guardCounters",
1);sc.arena.onGuardCounter(a);a.addCombatStat("guardCounters",1)}this.sound.play();sc.combat.doDramaticEffect(b,a,sc.DRAMATIC_EFFECT.GUARD_COUNTER)}});sc.ENEMY_REACTION.ENEMY_EVENT=a.extend({_wm:new ig.Config({attributes:{eventType:{_type:"EnemyEventType",_info:"Type of target event"},preSwitchState:{_type:"EnemyStateRef",_info:"State to switch to before reaction starts",_optional:true},postSwitchState:{_type:"EnemyStateRef",_info:"State to switch to after reaction ended",_optional:true},preAction:{_type:"EnemyActionRef",
_info:"An action that is executed immediately beforehand",_optional:true},action:{_type:"EnemyActionRef",_info:"Action to perform on reaction",_optional:true}}}),init:function(a,b){this.parent(a,b);this.preSwitchState=b.preSwitchState||null;this.preAction=b.preAction||null;this.eventType=sc.COMBAT_ENEMY_EVENT[b.eventType.type];this.settings=b.eventType},checkEnemyEvent:function(a,b,c,d){return c!=this.eventType?false:this.eventType.check(a,b,d,this.settings)},onEnemyEvent:function(a,b){this.preSwitchState&&
a.enemyType.switchState(a,this.preSwitchState);if(this.preAction){a.cancelAction();a.setAction(b[this.preAction]);a.forceExecuteAction();a.cancelAction(true)}}});sc.COMBAT_ENEMY_EVENT.ENEMY_MSG={_wm:{attributes:{key:{_type:"String",_info:"Key required to trigger message reaction. "}}},check:function(a,b,c,d){return d.key===c.key}};sc.ENEMY_REACTION.STORE_RELEASE=a.extend({_wm:new ig.Config({attributes:{preSwitchState:{_type:"EnemyStateRef",_info:"State to switch to before reaction starts",_optional:true},
postSwitchState:{_type:"EnemyStateRef",_info:"State to switch to after reaction ended",_optional:true},action:{_type:"EnemyActionRef",_info:"Action to perform on reaction",_optional:true}}}),init:function(a,b){this.parent(a,b);this.preSwitchState=b.preSwitchState||null},onStoredRelease:function(a){this.preSwitchState&&a.enemyType.switchState(a,this.preSwitchState)}});sc.ENEMY_REACTION.DODGE=a.extend({_wm:new ig.Config({attributes:{preSwitchState:{_type:"EnemyStateRef",_info:"State to switch to before reaction starts",
_optional:true},postSwitchState:{_type:"EnemyStateRef",_info:"State to switch to after reaction ended",_optional:true},action:{_type:"EnemyActionRef",_info:"Action to perform on reaction",_optional:true},viewAngle:{_type:"Number",_info:"View angle from which incoming attacks are seen. 1= full circle. 0.5= half circle",_default:0.5},radius:{_type:"Number",_info:"Radius around entity bounds used to detect threads. 32 by default",_optional:true},restartPrevAction:{_type:"Boolean",_info:"If true, restart previous action after reaction."},
probability:{_type:"Number",_info:"Probability for dodge to work. 1=always",_default:3},count:{_type:"Integer",_info:"Maximum number of consecutive dodges allowed. 0 = infinity"},blockTime:{_type:"Number",_info:"Time for dodge to block or counter reset",_default:1},conditions:{_type:"CombatConditions",_info:"Additional conditions for dodge"}}}),init:function(a,b){this.parent(a,b);this.preSwitchState=b.preSwitchState||null;this.viewAngle=b.viewAngle;this.probability=b.probability;this.radius=b.radius||
32;this.count=b.count;this.blockTime=b.blockTime;var c=b.conditions;if(c)this.conditions=new sc.CombatConditions(c)},preApply:function(a){this.preSwitchState&&a.enemyType.switchState(a,this.preSwitchState)},check:function(a){if(a.dodge.blocked)return false;var b=sc.combat.getNearbyThreat(a,this.radius,this.viewAngle,this.conditions);if(b){a.dodge.timer=this.blockTime;if(Math.random()>this.probability){a.dodge.blocked=true;return false}a.dodge.count++;if(this.count&&a.dodge.count>=this.count)a.dodge.blocked=
true;a.threat=b;return true}return false}});sc.ENEMY_REACTION.COUNTER_COUNTER=a.extend({_wm:new ig.Config({attributes:{maxDelay:{_type:"Number",_info:"Maximum delay until combatant will react to counter trap"},cooldown:{_type:"Number",_info:"Number of seconds combatant will react with increased awareness to counters"},preSwitchState:{_type:"EnemyStateRef",_info:"State to switch to before reaction starts",_optional:true},postSwitchState:{_type:"EnemyStateRef",_info:"State to switch to after reaction ended",
_optional:true},action:{_type:"EnemyActionRef",_info:"Action to perform on reaction",_optional:true},conditions:{_type:"CombatConditions",_info:"Additional conditions for reaction to react"}}}),init:function(a,b){this.parent(a,b);this.maxDelay=b.maxDelay||1;this.cooldown=b.cooldown||10;this.preSwitchState=b.preSwitchState||null;var c=b.conditions;if(c)this.conditions=new sc.CombatConditions(c)},preApply:function(a){this.preSwitchState&&a.enemyType.switchState(a,this.preSwitchState)},onActivate:function(a){a.dodge.counterReactTime=
0},check:function(a){var b=a.getTarget();if(!b||!b.combo)return false;if((b=b.combo.guardTrapTime)&&!a.dodge.counterReactTime){var c=1;a.dodge.counterCooldownMax&&(c=0);a.dodge.counterReactTime=c*this.maxDelay+(1-c)*0.1}if(!b&&a.dodge.counterReactTime)a.dodge.counterReactTime=0;if(b>a.dodge.counterReactTime){if(this.conditions&&!this.conditions.check(a,Math.random()))return false;a.dodge.counterReactTime=0;return true}return false}});sc.ENEMY_REACTION.FALL=a.extend({_wm:new ig.Config({attributes:{preSwitchState:{_type:"EnemyStateRef",
_info:"State to switch to before reaction starts",_optional:true},postSwitchState:{_type:"EnemyStateRef",_info:"State to switch to after reaction ended",_optional:true},action:{_type:"EnemyActionRef",_info:"Action to perform on reaction",_optional:true},terrain:{_type:"String",_info:"If defined: only react when falling into specified terrain",_optional:true,_select:ig.TERRAIN}}}),init:function(a,b){this.parent(a,b);this.preSwitchState=b.preSwitchState||null;this.ignoreStun=true;this.terrain=ig.TERRAIN[b.terrain]||
null},onFall:function(a){this.preSwitchState&&a.enemyType.switchState(a,this.preSwitchState);a.params&&a.params.clearLock()},checkFall:function(a){return!this.terrain||this.terrain==a}})});ig.baked=!0;
ig.module("game.feature.combat.model.enemy-collab").defines(function(){sc.ENEMY_COLLAB_BREAK={ALL:1,INITIATOR:2,ANY:3};var b=Vec3.create();sc.EnemyCollab=ig.Class.extend({initiator:null,participants:[],vars:{},breakType:0,success:true,attached:[],init:function(a,b){this.initiator=a;this.addParticipant(a,null,b.initiatorLabel);this.breakType=sc.ENEMY_COLLAB_BREAK[b.breakType]||sc.ENEMY_COLLAB_BREAK.INITIATOR;for(var c=b.participants,e=c.length;e--;){var f=c[e];if(!sc.combat.gatherCollaborators(this,
f.collabKey,f.label,f.min,f.max,f.acceptStunned)){this.success=false;this.initiator=null;for(c=this.participants.length;c--;)this.participants[c].collabAttribs=null;this.participants.length=0;break}}},getVar:function(a){return this.vars[a]||0},setVar:function(a,b){this.vars[a]=b},onVarAccess:function(a,b){return b[2]=="var"?ig.vars.resolveObjectAccess(this.vars,b,3):b[2]=="count"?this.participants.length:null},addCollabAttached:function(a){this.attached.push(a)},removeCollabAttached:function(a){a=
this.attached.indexOf(a);if(a!=-1){this.attached.splice(a,1);return true}return false},setParticipantsEntity:function(a,b){for(var c=this.participants.length;c--;){var e=this.participants[c];if(!b||b.indexOf(e.collabAttribs.label)!=-1)e.collabAttribs.entity=a}},setParticipantsPoint:function(a,b){for(var c=this.participants.length;c--;){var e=this.participants[c];if(!b||b.indexOf(e.collabAttribs.label)!=-1)e.collabAttribs.point=a}},getLabeledParticipant:function(a){for(var b=this.participants.length;b--;){var c=
this.participants[b];if(c.collabAttribs.label==a)return c}},getLabeledParticipants:function(a){for(var b=[],c=this.participants.length;c--;){var e=this.participants[c];(!a||a.indexOf(e.collabAttribs.label)!=-1)&&b.push(e)}return b},start:function(){for(var a=this.participants.length;a--;){var b=this.participants[a];b.collaboration=this;if(b==this.initiator)b.addActionAttached(this);else{b.setTarget(this.initiator.getTarget(true));b.doCollabReaction(b.collabAttribs.collabKey)}}sc.combat.collabs.push(this)},
doReaction:function(a,b){for(var c=this.participants.length;c--;){var e=this.participants[c];(!b||b.indexOf(e.collabAttribs.label)!=-1)&&e.doCollabReaction(a)}},getCenterPos:function(a,d,c){var e=this.participants,f=e.length;Vec3.assignC(a,0,0,0);for(var g=0;f--;){var h=e[f];if(!(c&&c.indexOf(h.collabAttribs.label)==-1)){Vec3.add(a,h.getAlignedPos(d,b));g++}}Vec3.mulF(a,1/g);return a},addParticipant:function(a,b,c){if(this.participants.indexOf(a)!=-1)return false;this.participants.push(a);a.collabAttribs=
{label:c,collabKey:b,point:null,entity:null};return true},removeParticipant:function(a){var b=this.participants.indexOf(a);if(b==-1)throw Error("Removed Participant that is not part of collab - this should never happen");a.removeActionAttached(this);a.collaboration=null;a.collabAttribs=null;this.participants.splice(b,1);this.breakType==sc.ENEMY_COLLAB_BREAK.ANY?this.cancel():a==this.initiator&&this.breakType==sc.ENEMY_COLLAB_BREAK.INITIATOR?this.cancel():this.participants.length==0&&this.cancel()},
onActionEndDetach:function(a){this.removeParticipant(a)},cancel:function(){for(var a=this.attached.length;a--;)this.attached[a].onCollabEndDetach(this);for(a=this.participants.length;a--;){var b=this.participants[a];b.removeActionAttached(this);b.collaboration=null;b.collabAttribs=null;b.cancelAction()}this.participants.length=0;this.initiator=null;sc.combat.collabs.erase(this)}})});ig.baked=!0;
ig.module("game.feature.combat.model.enemy-level-scaling").defines(function(){var b=[{level:1,base:24,hp:200,credits:5},{level:6,base:32,hp:300,credits:23},{level:11,base:45,hp:420,credits:50},{level:16,base:63,hp:600,credits:80},{level:21,base:84,hp:800,credits:115},{level:26,base:105,hp:1100,credits:160},{level:31,base:132,hp:1500,credits:210},{level:36,base:163,hp:2E3,credits:290},{level:41,base:199,hp:3E3,credits:380},{level:46,base:236,hp:5E3,credits:490},{level:51,base:278,hp:8E3,credits:610},
{level:56,base:323,hp:1E4,credits:750},{level:61,base:372,hp:12E3,credits:900},{level:66,base:425,hp:13100,credits:1200},{level:71,base:484,hp:15E3,credits:1500},{level:76,base:547,hp:16900,credits:1900},{level:81,base:614,hp:19E3,credits:2400},{level:86,base:687,hp:21200,credits:3E3},{level:91,base:766,hp:23700,credits:3800},{level:96,base:850,hp:26300,credits:4800},{level:99,base:928,hp:28700,credits:6E3}];sc.EnemyLevelScaling={getAverageStat:function(a,d){for(var a=a.limit(0,99),c=b.length;c--;){var e=
b[c];if(e.level<=a){if(e.level==a)return e[d];c=b[c+1];return e[d]+(c[d]-e[d])*((a-e.level)/(c.level-e.level))}}return 1},getLevelForAverageStat:function(a){for(var d=b.length;d--;){var c=b[d];if(c.base<=a){d=b[d+1];return!d?99:Math.round(c.level+(d.level-c.level)*((a-c.base)/(d.base-c.base)))}}return 1},getFactor:function(a,b,c){return this.getAverageStat(b,c)/this.getAverageStat(a,c)},adaptParams:function(a,b,c){var e=this.getFactor(b,c,"base"),b=this.getFactor(b,c,"hp"),a=ig.copy(a);a.hp=Math.max(1,
Math.round(a.hp*b));a.attack=Math.round(a.attack*e).limit(1,999);a.defense=Math.round(a.defense*e).limit(1,999);a.focus=Math.round(a.focus*e).limit(1,999);return a},adaptCredits:function(a,b,c){b=this.getFactor(b,c,"credits");return Math.round(a*b)}}});ig.baked=!0;
ig.module("game.feature.combat.model.enemy-tracker").defines(function(){sc.EnemyTracker=ig.Class.extend({update:null,onStateChange:null,onReactionActivate:null,onConditionEval:function(){return false},onPerformed:function(){},reset:function(){}});sc.ENEMY_TRACKER={};sc.ENEMY_TRACKER.TIME=sc.EnemyTracker.extend({target:0,current:0,initRandom:0,resetRandom:0,noStateReset:false,hpBreakFactor:null,_wm:new ig.Config({attributes:{target:{_type:"Number",_info:"Target time in seconds"},initRandom:{_type:"Number",
_info:"How much variance should be used when initializing the timer. 0 = noRandom, 1 = full range random"},resetRandom:{_type:"Number",_info:"How much variance should be used when resetting the timer. 0 = noRandom, 1 = full range random"},noStateReset:{_type:"Boolean",_info:"If true, do not initialize when state is reset"},hpBreakFactor:{_type:"NumberArray",_info:"A factor for each hp break level multiplied with target time",_optional:true},noAssist:{_type:"Boolean",_info:"If true, do not slow down in Assist mode (because it makes it harder)"}}}),
init:function(b,a){this.target=a.target;this.initRandom=a.initRandom;this.resetRandom=a.resetRandom;this.noStateReset=a.noStateReset;this.hpBreakFactor=a.hpBreakFactor;this.noAssist=a.noAssist||false;this._initTimer(b)},update:function(){this.current=this.current+ig.system.tick},onStateChange:function(b){this.noStateReset||this.reset(b)},onConditionEval:function(b){return this.current>=this._getTarget(b)},onPerformed:function(b,a){a||this.reset(b)},_initTimer:function(b){this.current=this._getTarget(b)*
Math.random()*this.initRandom},reset:function(b,a){var d=a!==void 0?a:Math.random()*this.resetRandom;this.current=this._getTarget(b)*d},_getTarget:function(b){var a=this.target;this.hpBreakFactor&&(a=a*(this.hpBreakFactor[b.hpBreakReached]||1));this.noAssist||(a=a/sc.options.get("assist-attack-frequency"));return a}});sc.ENEMY_TRACKER.HIT=sc.EnemyTracker.extend({target:0,current:0,notStateInit:false,hpBreakTargets:null,noStateReset:false,_wm:new ig.Config({attributes:{target:{_type:"Number",_info:"Target number of hits"},
hpBreakTargets:{_type:"NumberArray",_info:"Alternative number for each HP Break State.",_optional:true},scaleDmgFactor:{_type:"Boolean",_info:"If true: weight hit with damage factors. NOTE: This will also consider factors of enemy shields BECAUSE ITS WEIRD."},scaleEnemyFactor:{_type:"Boolean",_info:"If true: scale effectiveness with damageFactor of enemy (will still ignore shields etc.)"},limitOffScale:{_type:"Number",_info:"Offensive factor is limited by this value and can't be higher.",_optional:true},
scaleElement:{_type:"Boolean",_info:"If true: scale with elemental defense"},noStateReset:{_type:"Boolean",_info:"If true, do not initialize when state is reset"}}}),init:function(b,a){this.target=a.target;this.hpBreakTargets=a.hpBreakTargets;this.scaleDmgFactor=a.scaleDmgFactor;this.scaleEnemyFactor=a.scaleEnemyFactor;this.limitOffScale=a.limitOffScale;this.scaleElement=a.scaleElement;this.noStateReset=a.noStateReset||false;this.current=0},onStateChange:function(){},onReactionActivate:function(b){this.noStateReset||
this.reset(b)},onConditionEval:function(b,a,d,c){a=this._getTarget(b);if(d){var e=1;if(this.scaleDmgFactor&&d.damageResult){e=d.damageResult.baseOffensiveFactor;this.limitOffScale&&(e=Math.min(e,this.limitOffScale));c&&c.damageFactor!=void 0&&(e=e*c.damageFactor)}this.scaleEnemyFactor&&(e=e*b.params.damageFactor);this.scaleElement&&d.damageResult&&(e=e*d.damageResult.elementalDef);this.current=this.current+e;d.weakness=this.current/a}return this.current>=a},onPerformed:function(b){this.reset(b)},
reset:function(b,a){this.current=Math.floor((a!==void 0?a:0)*this._getTarget(b))},_getTarget:function(b){var a=this.target;this.hpBreakTargets&&(a=this.hpBreakTargets[b.hpBreakReached]||this.target);return a}});sc.ENEMY_TRACKER.HP=sc.EnemyTracker.extend({target:0,hpReduced:0,notStateInit:false,_wm:new ig.Config({attributes:{target:{_type:"Number",_info:"The target anount of HP relative to HP. 0.1 = 10% of HP reduced"}}}),init:function(b,a){this.target=a.target;this.hpReduced=0},onStateChange:function(){},
onReactionActivate:function(b){this.reset(b)},onConditionEval:function(b,a,d,c){if(d&&d.damageResult){a=d.damageResult.damage;c&&c.damageFactor!=void 0&&(a=a*c.damageFactor);this.hpReduced=this.hpReduced+a;d.weakness=this.hpReduced/b.params.getStat("hp")/this.target}return this.hpReduced/b.params.getStat("hp")>=this.target},onPerformed:function(b){this.reset(b)},reset:function(b,a){if(b.params)this.hpReduced=Math.floor((a!==void 0?a:0)*this.target*b.params.getStat("hp"))}})});ig.baked=!0;
ig.module("game.feature.combat.model.enemy-booster").requires("impact.base.game","game.feature.model.game-model").defines(function(){sc.MIN_BOOSTER_LEVEL=60;sc.EnemyBooster=ig.GameAddon.extend({boosted:false,init:function(){this.parent("EnemyBooster");sc.Model.addObserver(sc.model.player,this)},onLevelLoaded:function(){this.boosted=false;this.updateBoosterState()},modelChanged:function(b,a){b instanceof sc.PlayerModel&&a==sc.PLAYER_MSG.ITEM_TOGGLED&&this.updateBoosterState()},updateBoosterState:function(){var b=
sc.map.getAreaItemToggleState(sc.AREA_ITEM_TYPE.BOOSTER);if(this.boosted!=b){this.boosted=b;for(var b=ig.game.getEntitiesByType(ig.ENTITY.Enemy),a=b.length;a--;)this.updateEnemyBoostState(b[a])}},updateEnemyBoostState:function(b){if(b.boosterState!=sc.ENEMY_BOOSTER_STATE.NONE)if(this.boosted&&b.boosterState==sc.ENEMY_BOOSTER_STATE.BOOSTABLE){b.boosterState=sc.ENEMY_BOOSTER_STATE.BOOSTED;var a=b.enemyType.boostedLevel||sc.MIN_BOOSTER_LEVEL;sc.newgame.get("scale-enemies")&&(a=sc.model.player.getParamAvgLevel(10));
b.setLevelOverride(a)}else if(!this.boosted&&b.boosterState==sc.ENEMY_BOOSTER_STATE.BOOSTED){b.boosterState=sc.ENEMY_BOOSTER_STATE.BOOSTABLE;b.level.setting?b.setLevelOverride(1*ig.Event.getExpressionValue(b.level.setting)):b.setLevelOverride(null)}}});ig.addGameAddon(function(){return sc.enemyBooster=new sc.EnemyBooster})});ig.baked=!0;
ig.module("game.feature.combat.entities.combat-proxy").requires("game.feature.npc.entities.sc-actor","game.feature.combat.model.proxy","game.feature.combat.entities.combatant","game.feature.combat.combat-poi").defines(function(){sc.PROXY_STICK_TYPE={NONE:0,OWNER:1,TARGET:2};sc.PROXY_TYPE.GENERIC=sc.ProxySpawnerBase.extend({data:null,_wm:new ig.Config({attributes:{animation:{_type:"AnimSheet",_info:"Animation sheet of proxy. Needs one entry with name 'default'",_popup:true,_optional:true},faceAnims:{_type:"AnimSheet",
_info:"Animation sheet of proxy. Needs one entry with name 'default'",_multiDir:true,_popup:true,_optional:true},copyOwnerAnims:{_type:"Boolean",_info:"If true: Copy animations from owner combatant."},size:{_type:"Offset",_info:"Size of proxy"},padding:{_type:"Vec2",_info:"Padding of proxy",_optional:true},breakType:{_type:"String",_info:"How proxy is broken",_select:sc.PROXY_BREAK_TYPE},config:{_type:"ProxyConfig",_info:"Configuration of proxy"},action:{_type:"Action",_info:"Action performed with proxy",
_popup:true},invisible:{_type:"Boolean",_info:"If true, set initial alpha to 0"},hp:{_type:"Number",_info:"If 0: proxy will ignore attack. -1: will take hits but is never destroyed (stops balls) >0: takes hits and can be destroyed"},terrain:{_type:"String",_info:"Terrain of proxy, in case you can jump onto it",_select:ig.TERRAIN,_optional:true},killEffect:{_type:"Effect",_info:"Effect shown when proxy is killed",_optional:true},stickToSource:{_type:"String",_info:"Specify whether proxy should move with connected entity",
_select:sc.PROXY_STICK_TYPE},stickFaceAlign:{_type:"Boolean",_info:"If true: align face with sticking entity"},group:{_type:"String",_info:"Group identifier used to clear proxies or WAIT_UNTIL_PROXIES_DONE"},timeDisconnect:{_type:"Boolean",_info:"If true: don't connect proxy to time of owner.",_optional:true},noFallDestroy:{_type:"Boolean",_info:"Do not destory proxy when falling into the ground etc.",_optional:true},walkAnims:{_type:"WalkAnims",_optional:true},startAnim:{_type:"String",_info:"Animation to show at start"}}}),
init:function(a){this.data=ig.copy(a);this.data.animation&&(this.data.animation=new ig.AnimationSheet(a.animation));if(this.data.faceAnims){this.data.faceAnims.DOCTYPE||(this.data.faceAnims.DOCTYPE="MULTI_DIR_ANIMATION");this.data.faceAnims=new ig.AnimationSheet(this.data.faceAnims)}this.data.config=sc.CombatProxyEntity.createActorConfig(a.config);this.data.action=new ig.Action("[PROXY]",a.action,false,false);this.data.breakType=sc.PROXY_BREAK_TYPE[a.breakType];this.data.stickToSource=sc.PROXY_STICK_TYPE[a.stickToSource]||
sc.PROXY_STICK_TYPE.NONE;this.data.killEffect&&(this.data.killEffect=new ig.EffectHandle(a.killEffect))},clearCached:function(){this.data.action.clearCached();this.data.animation&&this.data.animation.clearCached();this.data.faceAnims&&this.data.faceAnims.clearCached();this.data.killEffect&&this.data.killEffect.clearCached()},getSize:function(a){Vec3.assign(a,this.data.size);return a},spawn:function(a,b,d,g,h,i){h={data:this.data,combatant:g,dir:h};!i&&g.getCombatantRoot().isPlayer&&sc.stats.addMap("player",
"throws",1);g=this.data.size;return ig.game.spawnEntity(sc.CombatProxyEntity,a-g.x/2,b-g.y/2,d,h)}});var b=Vec3.create(),a={ACTION_END_DESTROYED:1,HIT_DESTROYED:2};sc.CombatProxyEntity=sc.BasicCombatant.extend({hp:0,maxHp:0,breakType:null,combatant:null,sourceEntity:null,externalEntity:null,party:0,collaboration:null,target:null,params:null,group:null,tackle:{attackInfo:null,blocked:[],hitCount:0},effects:{onKill:null,handle:null},stickToSource:0,wasHit:false,isThreat:true,destroyType:0,init:function(a,
b,d,g){this.parent(a,b,d,g);a=g.data;a.size&&this.coll.setSize(a.size.x,a.size.y,a.size.z);a.padding&&this.coll.setPadding(a.padding.x,a.padding.y);this.setDefaultConfig(a.config);this.sourceEntity=g.combatant;this.combatant=this.sourceEntity.getCombatantRoot();if(!a.timeDisconnect)this.coll.time.parent=this.sourceEntity.coll;this.noFallDestroy=g.noFallDestroy||false;this.terrain=ig.TERRAIN[a.terrain]||null;this.party=this.combatant&&this.combatant.party;this.collaboration=this.combatant.collaboration;
this.target=this.sourceEntity.getTarget(true);this.params=this.combatant.params;this.ignoreTaunts=this.combatant.ignoreTaunts;this.combo.damageCeiling=this.sourceEntity.combo.damageCeiling;Vec2.assign(this.face,g.dir);this.stickToSource=a.stickToSource||0;this.stickFaceAlign=a.stickFaceAlign||false;this.group=a.group;this.breakType=a.breakType;this.breakType==sc.PROXY_BREAK_TYPE.ACTION?this.sourceEntity.addActionAttached(this):this.breakType==sc.PROXY_BREAK_TYPE.COMBATANT?this.combatant.addEntityAttached(this):
this.breakType==sc.PROXY_BREAK_TYPE.COLLABORATION&&this.combatant.collaboration.addCollabAttached(this);if(a.invisible)this.animState.alpha=0;if(a.copyOwnerAnims){this.animSheet=this.combatant.animSheet;if(a.startAnim){this.setCurrentAnim(a.startAnim,true,null);this.animationFixed=true}this.initAnimations();this.storedWalkAnims=ig.copy(this.combatant.storedWalkAnims);this.setWalkAnims(this.combatant.walkAnimsName)}else{if(a.faceAnims||a.animation){this.animSheet=a.faceAnims||a.animation;this.initAnimations()}a.walkAnims?
this.storeWalkAnims("default",a.walkAnims):this.storeWalkAnims("default",{idle:"default"});this.setWalkAnims("default");if(a.startAnim){this.setCurrentAnim(a.startAnim,true,null);this.animationFixed=true}}this.setAction(a.action);this.maxHp=this.hp=a.hp;this.effects.onKill=a.killEffect},getCombatantRoot:function(){return this.combatant},getSourceEntity:function(){return this.sourceEntity},connectExternal:function(a){if(this.externalEntity){this.externalEntity.removeEntityAttached(this);this.externalEntity=
null}if(a)if(a.isDefeated&&a.isDefeated())this.destroy();else{this.externalEntity=a;this.externalEntity.addEntityAttached(this)}},update:function(){this.breakType==sc.PROXY_BREAK_TYPE.COMBATANT&&this.combatant.isDefeated()&&this.destroy();this.coll.pos.z<ig.game.minLevelZ&&(!this.stickToSource&&!this.noFallDestroy)&&this.destroy();if(this.stickToSource){var a=this.stickToSource==sc.PROXY_STICK_TYPE.TARGET?this.getTarget():this.sourceEntity;if(a){var d=ig.CollTools.getCenterXYAlignedPos(b,this.coll,
a.coll);this.setPos(d.x,d.y,a.coll.pos.z);this.stickFaceAlign&&a.face&&Vec2.assign(this.face,a.face)}}this.parent()},onActionEndDetach:function(){this.destroy()},onEntityKillDetach:function(){this.destroy()},onCollabEndDetach:function(){this.destroy()},postActionUpdate:function(){this.currentAction||this.destroy()},detach:function(){if(this.externalEntity){this.externalEntity.removeEntityAttached(this);this.externalEntity=null}this.breakType==sc.PROXY_BREAK_TYPE.ACTION?this.sourceEntity.removeActionAttached(this):
this.breakType==sc.PROXY_BREAK_TYPE.COMBATANT?this.combatant.removeEntityAttached(this):this.breakType==sc.PROXY_BREAK_TYPE.COLLABORATION&&this.combatant.collaboration&&this.combatant.collaboration.removeCollabAttached(this)},onEffectEvent:function(a){a.isDone()&&this.kill()},destroy:function(b){if(!this.destroyType){this.destroyType=b||a.ACTION_END_DESTROYED;this.detach();if(this.effects.onKill){this.cancelAction();Vec2.assignC(this.coll.accelDir,0,0);if(!this.effects.handle){this.effects.handle=
this.effects.onKill.spawnOnTarget(this,{align:"CENTER",callback:this});this.coll.setType(ig.COLLTYPE.NONE)}}else this.kill()}},ballHit:function(a){if(this.hp){if(a.party==this.combatant.party)return false;var b=a.getHitCenter(this);this.wasHit=true;if(this.hp<0){sc.combat.showHitEffect(this,b,sc.ATTACK_TYPE.NONE,a.getElement(),false,false);return true}var d=a.attackInfo.damageFactor;sc.combat.showHitEffect(this,b,a.attackInfo.type,a.getElement(),false,false);this.reduceHp(d);return true}return false},
setMaxHp:function(a){this.hp=this.maxHp>0&&a>0?this.hp*(a/this.maxHp):a;this.maxHp=a},reduceHp:function(b){this.hp=this.hp-b;this.hp<=0&&this.destroy(a.HIT_DESTROYED)},onVarAccess:function(b,d){return d[1]=="collab"?!this.collaboration?null:this.collaboration.onVarAccess(b,d):d[1]=="ownerAttrib"?ig.vars.resolveObjectAccess(this.combatant.attributes,d,2):d[1]=="srcAttrib"?ig.vars.resolveObjectAccess(this.sourceEntity.attributes,d,2):d[1]=="owner"?ig.vars.forwardEntityVarAccess(this.combatant,d,2):
d[1]=="src"?ig.vars.forwardEntityVarAccess(this.sourceEntity,d,2):d[1]=="destroyed"?this.destroyType!=0:d[1]=="hitDestroyed"?this.destroyType==a.HIT_DESTROYED:d[1]=="wasHit"?this.wasHit:this.parent(b,d)}});var d=new ig.ActorConfig({walkAnims:"default",collType:"IGNORE",maxVel:180,weight:-1,flyHeight:0,soundType:"none",friction:1,accelSpeed:1,bounciness:0});sc.CombatProxyEntity.createActorConfig=function(a){var b=new ig.ActorConfig;b.loadFromData(a,d);return b};sc.CombatProxyTools={clearEntityProxy:function(a,
b,d,g,h){g=this.clearAttachedProxy(a.entityAttached,b,d,g,h);this.clearAttachedProxy(a.actionAttached,b,d,g,h)},hasProxy:function(a,b){return this.hasAttachedProxy(a.entityAttached,b)||this.hasAttachedProxy(a.actionAttached,b)},clearAttachedProxy:function(a,b,d,g,h){for(var i=a.length;i--;){var j=a[i];if(j instanceof sc.CombatProxyEntity&&j!=h&&(!d||j.stickToSource))b&&j.group!=b||(g?g--:j.destroy())}return g||0},hasAttachedProxy:function(a,b){for(var d=a.length;d--;){var g=a[d];if(g instanceof sc.CombatProxyEntity&&
g.group==b)return true}}};sc.COMBAT_POI.PROXY={_wm:{attributes:{group:{_type:"String",_info:"Group name of proxy"}}},filterEntities:function(a,b,d){for(var d=d.group,g=b.length;g--;){var h=b[g];h instanceof sc.CombatProxyEntity&&!(d&&h.group!==d)&&a.push(h)}return a}}});ig.baked=!0;
ig.module("game.feature.combat.combat-action-steps").requires("impact.base.animation","impact.base.action","impact.base.entity","game.feature.combat.entities.drop","game.feature.combat.entities.combatant","game.feature.combat.entities.combat-proxy","impact.feature.effect.effect-steps","game.feature.combat.combat-sweep").defines(function(){function b(a){return a instanceof sc.CombatParams}function a(a,b){for(var c=a.length;c--;){var d=a[c];if(d instanceof sc.CombatProxyEntity&&d.group==b)return d}return null}
var d={SELF:function(a){return a},PROXY_OWNER:function(a){return a.getCombatantRoot()},PROXY_SRC:function(a){return a.sourceEntity},TARGET:function(a){return a.getTarget()}},c=Vec3.create();ig.ACTION_STEP.FACE_TO_TARGET=ig.ActionStepBase.extend({value:false,immediately:false,_wm:new ig.Config({attributes:{value:{_type:"Boolean",_info:"True if enemy should always look at the target."},immediately:{_type:"Boolean",_info:"True if enemy should always look at the target IMMEDIATELY.",_optional:true},posOffset:{_type:"Vec2",
_info:"Offset to target position used to set face target (will only be used for immediate face setting)",_optional:true}}}),init:function(a){this.value=a.value;this.immediately=a.immediately||false;this.posOffset=a.posOffset||null},run:function(a){a.faceToTarget.active=this.value;a.forceFaceDirFixed=this.value;var b=a.getTarget();if(this.immediately&&b){b=Vec2.sub(b.getCenter(),a.getCenter());this.posOffset&&Vec2.add(b,this.posOffset);Vec2.isZero(b)&&Vec2.assignC(b,0,1);a.faceToTarget.offset&&Vec2.rotate(b,
a.faceToTarget.offset*2*Math.PI);Vec2.assign(a.face,b)}return true}});ig.ACTION_STEP.UNLOCK_ENEMY=ig.ActionStepBase.extend({enemy:null,asSpecial:null,_wm:new ig.Config({attributes:{enemy:{_type:"EnemySearch",_info:"Enemy to unlock, note that this enemy, use this only for special enemies."},asSpecial:{_type:"Boolean",_info:"if true 'special' will be displayed instead of kill count",_default:true}}}),init:function(a){this.enemy=a.enemy;this.asSpecial=a.asSpecial==void 0?true:a.asSpecial},run:function(){sc.stats.setMap("combat",
"kill"+this.enemy,this.asSpecial?-1:1);sc.stats.setMap("combat","enemyCompletionRate",sc.combat.getTotalEnemiesFound(true));return true}});ig.ACTION_STEP.FACE_TO_TARGET_OFFSET=ig.ActionStepBase.extend({value:false,_wm:new ig.Config({attributes:{value:{_type:"Number",_info:"Offset to target direction to look into"}}}),init:function(a){this.value=a.value},run:function(a){a.faceToTarget.offset=this.value;return true}});ig.ACTION_STEP.FACE_TO_TARGET_SPEED=ig.ActionStepBase.extend({value:false,_wm:new ig.Config({attributes:{value:{_type:"Number",
_info:"Speed for face to target. Default is 2",_default:2}}}),init:function(a){this.value=a.value},run:function(a){a.faceToTarget.speed=this.value;return true}});ig.ACTION_STEP.SET_FACE_TARGET_PREDICT=ig.ActionStepBase.extend({projectileSpeed:false,_wm:new ig.Config({attributes:{projectileSpeed:{_type:"Number",_info:"Speed of projectile to be thrown"}}}),init:function(a){this.projectileSpeed=a.projectileSpeed},run:function(a){var b=a.getTarget();if(b){var c=b.getCenter(i),d=a.getCenter(l),e=Vec2.distance(c,
d)/this.projectileSpeed;Vec2.addMulF(c,b.coll.vel,e);Vec2.sub(c,d,a.face)}return true}});ig.ACTION_STEP.FACE_ALIGN=ig.ActionStepBase.extend({value:false,_wm:new ig.Config({attributes:{target:{_type:"String",_info:"Where is player found?",_select:d,_optional:true}}}),init:function(a){this.target=d[a.target]||d.SELF},run:function(a){var b=this.target(a);b&&b.face&&Vec2.assign(a.face,b.face);return true}});ig.ACTION_STEP.SHOW_THROW_FX=ig.ActionStepBase.extend({_wm:new ig.Config({attributes:{charged:{_type:"Boolean",
_info:"If true: show charged effect"},charClass:{_type:"String",_info:"If true: show charged effect",_select:sc.THROW_SOUND_CLASS,_optional:true}}}),init:function(a){this.charged=a.charged;this.charClass=sc.THROW_SOUND_CLASS[a.charClass]||null},start:function(a){var b=sc.ELEMENT.NEUTRAL;if(a instanceof sc.PlayerBaseEntity)b=a.model.currentElementMode;else if(a.elementModes)b=a.elementModes.current;sc.combat.showThrowEffect(a,b,this.charged,this.charClass)}});ig.ACTION_STEP.COMBAT_ART_CHARGE=ig.ActionStepBase.extend({_wm:new ig.Config({attributes:{element:{_type:"String",
_info:"Element of the charge",_select:sc.ELEMENT},level:{_type:"Integer",_info:"Level to charge to"}}}),init:function(a){this.element=sc.ELEMENT[a.element];this.level=a.level},start:function(a){a.stepData.fx=new sc.CombatCharge(a,false,true,true);a.stepData.level=0;a.addActionAttached(a.stepData.fx);this.chargeStep(a)},chargeStep:function(a){a.stepData.level++;a.stepTimer=a.stepData.level<this.level?a.stepTimer+0.4:a.stepTimer+0.3;a.stepData.fx.charge(this.element,a.stepData.level)},run:function(a){if(a.stepTimer<=
0){if(a.stepData.level==this.level){a.stepData.fx.stop();a.params.consumeSp(sc.PLAYER_SP_COST[this.level-1]);return true}this.chargeStep(a)}return false}});ig.ACTION_STEP.MOVE_TO_DISTANCE=ig.ActionStepBase.extend({min:0,max:0,maxTime:0,offset:null,forceTime:false,_wm:new ig.Config({attributes:{min:{_type:"Number",_info:"Minimum distance to move to"},max:{_type:"Number",_info:"Maximum distance to move to"},maxTime:{_type:"Number",_info:"Maximum time to move"},offset:{_type:"Vec2",_info:"Offset to target.",
_optional:true},forceTime:{_type:"Boolean",_info:"Keep moving, never stop until maxTime has been reached"},rotateSpeed:{_type:"Number",_info:"Speed in which entity will rotate to target. In rotations per seconds.",_default:2,_optional:true},missReactTime:{_type:"Number",_info:"Reaction time to stop tackle after target has been clearly missed",_optional:true},collideCancel:{_type:"Number",_info:"If defined: if angle to collided wall is lower than this value, cancel step",_optional:true},stopBeforeEdge:{_type:"Boolean",
_info:"If true: Stop before falling down from edge when further moving forward"},flipOffsetLeft:{_type:"Boolean",_info:"If true: Flip offset x when facing left.",_optional:true},keepFace:{_type:"Boolean",_info:"If true: Keep face direction the same, even with rotateSpeed on",_optional:true},waitUntil:{_type:"VarCondition",_info:"If defined: Keep moving until condition evaluates to false",_optional:true}}}),init:function(a){this.min=a.min;this.max=a.max;this.maxTime=a.maxTime;this.offset=a.offset||
null;this.forceTime=a.forceTime||false;this.rotateSpeed=a.rotateSpeed||0;this.missReactTime=a.missReactTime;this.collideCancel=a.collideCancel;this.stopBeforeEdge=a.stopBeforeEdge;this.flipOffsetLeft=a.flipOffsetLeft;this.keepFace=a.keepFace;this.waitUntil=a.waitUntil?new ig.VarCondition(a.waitUntil):null},start:function(a){a.stepTimer=a.stepTimer+this.maxTime;if(this.rotateSpeed)if(this.keepFace){var b=a.stepData.moveDir=Vec2.create(),c=a.getTarget();if(c){ig.CollTools.getDistVec2(a.coll,c.coll,
b);if(this.offset){b.x=b.x+(this.flipOffsetLeft&&a.face.x<0?-this.offset.x:this.offset.x);b.y=b.y+this.offset.y}}}else Vec2.assign(a.coll.accelDir,a.face)},run:function(a){var b=a.getTarget();if(!b)return true;var c=this.keepFace?a.stepData.moveDir:a.face,d=Vec2.sub(b.getCenter(),a.getCenter());if(this.offset){d.x=d.x+(this.flipOffsetLeft&&a.face.x<0?-this.offset.x:this.offset.x);d.y=d.y+this.offset.y}var e=Vec2.length(d);e<this.min&&Vec2.mulC(d,-1);if(this.rotateSpeed){Vec2.rotateToward(c,d,this.rotateSpeed*
Math.PI*2*ig.system.tick);Vec2.assign(a.coll.accelDir,c)}else Vec2.assign(a.coll.accelDir,d);if(this.stopBeforeEdge&&ig.CollTools.isPostMoveOverHole(a.coll,true)){Vec2.assignC(a.coll.accelDir,0,0);Vec2.assignC(a.coll.vel,0,0);if(this.collideCancel)a.stepTimer=0}if(this.collideCancel&&ig.CollTools.hasWallCollide(a.coll,this.collideCancel))a.stepTimer=0;if(this.missReactTime!=void 0&&this.missReactTime!=null&&a.stepTimer>this.missReactTime){ig.CollTools.getDistVec2(a.coll,b.coll,r);if(this.offset){r.x=
r.x+(this.flipOffsetLeft&&a.face.x<0?-this.offset.x:this.offset.x);r.y=r.y+this.offset.y}if(Vec2.angle(r,c)>Math.PI/2)a.stepTimer=this.missReactTime}if(this.min<=e&&e<=this.max){if(!this.forceTime&&!this.waitUntil)return true;Vec2.assignC(a.coll.accelDir,0,0)}return this.waitUntil?this.waitUntil.evaluate():a.stepTimer<=0}});ig.ACTION_STEP.MOVE_TO_PINPOINT=ig.ActionStepBase.extend({maxTime:0,offset:null,forceTime:false,_wm:new ig.Config({attributes:{moveTime:{_type:"Number",_info:"Time of movement. Entity will try to move exactly at target during that time"},
postTime:{_type:"Number",_info:"Amount of time still expected to move after this step. Approach is calculated that way"},offset:{_type:"Vec2",_info:"Offset to target.",_optional:true},rotateSpeed:{_type:"Number",_info:"Speed in which entity will rotate to target. In rotations per seconds.",_default:2,_optional:true},useAccelDir:{_type:"Boolean",_info:"If true, use current accelDir to determine initial movement direction. Use this to continue rotation from precious PINPOINT step"},maxSpeed:{_type:"Number",
_info:"Maximum velocity. Velocity will always be adapted to hit target at end of moveTime + postTime"},maxSpeedEnd:{_type:"Number",_info:"Maximum velocity at end of movement. Speed will linear interpolate to this value if defined."},underEstimation:{_type:"Number",_info:"How much movement duration should be underestimated for speed adjustment. Lower value makes hitting target more reliable, but leads to initially fast movement",_default:0.75,_optional:true}}}),init:function(a){this.moveTime=a.moveTime;
this.postTime=a.postTime||0;this.offset=a.offset||null;this.rotateSpeed=a.rotateSpeed||0;this.useAccelDir=a.useAccelDir||false;this.maxSpeed=a.maxSpeed||200;this.maxSpeedEnd=a.maxSpeedEnd||0;this.underEstimation=a.underEstimation||0.75},start:function(a){a.stepTimer=this.moveTime;if(this.rotateSpeed){if(this.useAccelDir)a.stepData.lastDir=Vec2.create(a.coll.accelDir);if(!this.useAccelDir||Vec2.isZero(a.stepData.lastDir)){a.stepData.lastDir=this._calculateDir(Vec2.create(),a);a.stepData.lastDir&&Vec2.assign(a.coll.accelDir,
a.stepData.lastDir)}}},_calculateDir:function(a,b){var c=b.getTarget();if(!c)return null;ig.CollTools.getDistVec2(b.coll,c.coll,a);this.offset&&Vec2.add(a,this.offset);return a},run:function(a){var b=this._calculateDir(r,a);if(!b)return true;var c=Vec2.length(b);if(c<=4)Vec2.assignC(a.coll.accelDir,0,0);else if(this.rotateSpeed){Vec2.assign(a.coll.accelDir,a.stepData.lastDir);Vec2.isZero(a.coll.accelDir)?Vec2.assign(a.coll.accelDir,b):Vec2.rotateToward(a.coll.accelDir,b,this.rotateSpeed*Math.PI*2*
ig.system.tick);Vec2.assign(a.stepData.lastDir,a.coll.accelDir)}else Vec2.assign(a.coll.accelDir,b);c=c/((a.stepTimer+this.postTime)*this.underEstimation);if(this.rotateSpeed){b=1-Vec2.angle(a.stepData.lastDir,b)/Math.PI*2;c=Math.max(0,c*b)}b=this.maxSpeed;this.maxSpeedEnd&&(b=a.stepTimer/this.moveTime*(this.maxSpeed-this.maxSpeedEnd)+this.maxSpeedEnd);c>b&&(c=b);a.coll.maxVel=c;return a.stepTimer<=0}});ig.ACTION_STEP.MOVE_ALIGN_DIR=ig.ActionStepBase.extend({maxTime:0,dir:null,forceTime:false,_wm:new ig.Config({attributes:{moveTime:{_type:"Number",
_info:"Time of movement. Entity will move to target position projected along alignDir"},alignDir:{_type:"Number",_info:"Dir among which entity can move. If not defined: Use entity face dir",_optional:true},aimFaceRotate:{_type:"Number",_info:"Position will be calculated based on an aiming direction of alignDir rotated toward the target by THIS much (1=full rotation). 0.25 by default",_optional:true},maxDist:{_type:"Number",_info:"Maximum Distance to go along alignDir"},maxOppDist:{_type:"Number",
_info:"Maximum Distance to go along opposite alignDir"},offset:{_type:"Vec2",_info:"Offset to target.",_optional:true},interpolate:{_type:"Boolean",_info:"If true: Interpolate position to reach destination at end of moveTime. Otherwise: Always be set at destination"},waitUntil:{_type:"VarCondition",_info:"If defined: continue spinning until condition evaluates to true. Duration is minimum wait",_optional:true}}}),init:function(a){this.moveTime=a.moveTime;this.alignDir=a.alignDir;this.aimFaceRotate=
a.aimFaceRotate||0.25;this.maxDist=a.maxDist||0;this.maxOppDist=a.maxOppDist||0;this.offset=a.offset||null;this.interpolate=a.interpolate||false;this.waitUntil=a.waitUntil?new ig.VarCondition(a.waitUntil):null},start:function(a){a.stepTimer=this.moveTime;a.stepData.startPos=a.getCenter()},run:function(a){var b=Vec2.assign(i,this.alignDir||a.face);Vec2.normalize(b);var c=a.getTarget();if(!c)return true;c=c.getCenter(l);this.offset&&Vec2.add(c,this.offset);var d=Vec2.sub(c,a.stepData.startPos,o),e;
if(Math.abs(this.aimFaceRotate)===0.25)e=Vec2.dot(d,b);else{e=this.aimFaceRotate;Vec2.areClockwise(b,d)===e>0&&(e=-e);d=Vec2.assign(o,b);Vec2.rotate(d,e*Math.PI*2);e=Line2.intersectRayWeight(a.stepData.startPos,b,c,d)}e=e.limit(-this.maxOppDist,this.maxDist);c=Vec2.assign(o,a.stepData.startPos);Vec2.addMulF(c,b,e);Vec2.addMulF(c,a.coll.size,-0.5);if(this.interpolate){b=(1-a.stepTimer/this.moveTime).limit(0,1);Vec2.lerp(a.stepData.startPos,c,b,c)}a.setPos(c.x,c.y,a.coll.pos.z);return this.waitUntil?
this.waitUntil.evaluate():a.stepTimer<=0}});var e={TARGET_DISTANCE:1,SELF_DISTANCE:2};ig.ACTION_STEP.SET_ATTRIB_CLOSEST_ENTITY=ig.ActionStepBase.extend({_wm:new ig.Config({attributes:{entityAttrib:{_type:"String",_info:"Name of attrib to store entity",_optional:true},indexAttrib:{_type:"String",_info:"Name of attrib to store entity index",_optional:true},entities:{_type:"Array",_info:"List of entities. Will move to one of those",_sub:{_type:"Entity"}},selectBy:{_type:"String",_info:"How entity is selected",
_select:e}}}),init:function(a){this.entityAttrib=a.entityAttrib;this.indexAttrib=a.indexAttrib;this.entities=a.entities;this.selectBy=e[a.selectBy]},start:function(a){var b;b=this.entities;for(var c=-1,d=0,f=b.length,g=this.selectBy==e.TARGET_DISTANCE?a.getTarget():a;f--;){var h=ig.Event.getEntity(b[f]);if(h){h=ig.CollTools.getGroundDistance(g.coll,h.coll);if(c==-1||h<d){c=f;d=h}}}b=c;this.indexAttrib&&a.setAttribute(this.indexAttrib,b);this.entityAttrib&&a.setAttribute(this.entityAttrib,this.entities[b])}});
var f={NORTH:{delta:{x:0,y:-1},orth:{x:1,y:0}},EAST:{delta:{x:1,y:0},orth:{x:0,y:1}},SOUTH:{delta:{x:0,y:1},orth:{x:1,y:0}},WEST:{delta:{x:-1,y:0},orth:{x:0,y:1}},HORIZONTAL_CLOSE:{delta:{x:1,y:0},orth:{x:0,y:1},close:true},HORIZONTAL_FAR:{delta:{x:1,y:0},orth:{x:0,y:1},far:true},VERTICAL_CLOSE:{delta:{x:0,y:1},orth:{x:1,y:0},close:true},VERTICAL_FAR:{delta:{x:0,y:1},orth:{x:1,y:0},far:true}};ig.ACTION_STEP.MOVE_TO_ATTRIB_ENTITY=ig.ActionStepBase.extend({_wm:new ig.Config({attributes:{attrib:{_type:"String",
_info:"Name of attribute that includes index of entity"},positionType:{_type:"String",_info:"How to position entity",_select:f},distance:{_type:"Number",_info:"Distance to entity along position type"},orthogonalDist:{_type:"Number",_info:"Orthogonal distance (Sideways) - can also be negative for opposite direction."},maxOrthDelta:{_type:"Number",_info:"Maximum Delta Value for orthogonal movement",_optional:true},adjustTarget:{_type:"Boolean",_info:"If true, adjust orthogonal distance to fit target"},
maxTime:{_type:"Number",_info:"Maximum time to move. If 0: Move until target is reached"},forceTime:{_type:"Boolean",_info:"Keep moving, never stop until maxTime has been reached"},precise:{_type:"Boolean",_info:"If true, move to point precisely"},saveToAttrib:{_type:"String",_info:"If defined: don't move but instead save result position in attribute",_optional:true},selectBy:{_type:"String",_info:"By which distance positionType is determined",_select:e,_optional:true}}}),init:function(a){this.attrib=
a.attrib;this.positionType=f[a.positionType]||f.NORTH;this.distance=a.distance||0;this.orthogonalDist=a.orthogonalDist||0;this.maxOrthDelta=a.maxOrthDelta||0;this.adjustTarget=a.adjustTarget||false;this.maxTime=a.maxTime;this.forceTime=a.forceTime||false;this.precise=a.precise||false;this.saveToAttrib=a.saveToAttrib||null;this.selectBy=e[a.selectBy]||e.SELF_DISTANCE},start:function(a){delete a.stepData.pos;var b=ig.Event.getEntity(a.getAttribute(this.attrib));if(b){var c=b.getCenter(),d=Vec2.assign(l,
this.positionType.delta);if(this.positionType.close||this.positionType.far){var f=a.coll;if(this.selectBy==e.TARGET_DISTANCE&&a.getTarget())f=a.getTarget().coll;b=ig.CollTools.getDistVec2(b.coll,f,o);b=Vec2.dot(b,d);(this.positionType.close&&b<0||this.positionType.far&&b>0)&&Vec2.flip(d)}Vec2.length(d,this.distance);Vec2.addMulF(d,this.positionType.orth,this.orthogonalDist);Vec2.add(c,d);a.stepData.pos=c;a.stepTimer=a.stepTimer+this.maxTime}},run:function(a){var b=a.stepData.pos;if(!b)return true;
var c=a.getTarget();if(this.adjustTarget&&c){c=c.getCenter(l);this.positionType.orth.x?b.x=c.x+this.orthogonalDist:b.y=c.y+this.orthogonalDist;if(this.maxOrthDelta){c=ig.Event.getEntity(a.getAttribute(this.attrib)).getCenter(l);this.positionType.orth.x?b.x=b.x.limit(c.x-this.maxOrthDelta,c.x+this.maxOrthDelta):b.y=b.y.limit(c.y-this.maxOrthDelta,c.y+this.maxOrthDelta)}}if(this.saveToAttrib){c=Vec3.create();Vec2.assign(c,b);c.z=a.coll.pos.z;a.setAttribute(this.saveToAttrib,c);return true}b=Vec2.sub(b,
a.getCenter(),i);c=Vec2.length(b);if(this.precise&&a.coll.maxVel*a.coll.relativeVel>c*10)a.coll.relativeVel=c/a.coll.maxVel*10;Vec2.assign(a.coll.accelDir,b);if(c<=(this.precise?2:8)){if(!this.maxTime||!this.forceTime)return true;Vec2.assignC(a.coll.accelDir,0,0)}return this.maxTime&&a.stepTimer<=0}});ig.ACTION_STEP.SET_COMBATANT_PARTY=ig.ActionStepBase.extend({_wm:new ig.Config({attributes:{party:{_type:"String",_info:"Override party determine which things are hit",_select:sc.COMBATANT_PARTY}}}),
init:function(a){this.party=sc.COMBATANT_PARTY[a.party]},run:function(a){sc.combat.changeCombatantParty(a,this.party);return true}});ig.ACTION_STEP.JUMP_TO_TARGET=ig.ActionStepBase.extend({jumpSpeed:0,adjustAbove:0,offset:null,_wm:new ig.Config({attributes:{jumpSpeed:{_type:"Number",_info:"Jump Speed / Z Velocity"},adjustAbove:{_type:"Number",_info:"Until how high above player X/Z movement should be adjusted"},offset:{_type:"Vec2",_info:"Offset to target.",_optional:true}}}),init:function(a){this.jumpSpeed=
a.jumpSpeed;this.adjustAbove=a.adjustAbove||0;this.offset=a.offset||null},start:function(a){a.doJump(this.jumpSpeed)},run:function(a){var b=a.getTarget();if(!b)return true;var c=a.coll.pos.z-a.coll.baseZPos;if(a.coll.vel.z<=0&&c<=this.adjustAbove){Vec2.assignC(a.coll.accelDir,0,0);if(c==0)return true}else{b=Vec2.sub(b.getCenter(),a.getCenter());this.offset&&Vec2.add(b,this.offset);Vec2.length(b)>8&&Vec2.assign(a.coll.accelDir,b)}return false}});ig.ACTION_STEP.SET_Z_VEL_TO_TARGET=ig.ActionStepBase.extend({value:null,
_wm:new ig.Config({attributes:{speed:{_type:"Number",_info:"Speed with which entity should jump towards target"},distance:{_type:"Number",_info:"Distance to arrive to before target."},minZVel:{_type:"Number",_info:"Minimum z Vel",_optional:true},maxZVel:{_type:"Number",_info:"Maximum z Vel",_optional:true}}}),init:function(a){this.distance=a.distance||0;this.speed=a.speed||0;this.minZVel=a.minZVel||0;this.maxZVel=a.maxZVel||0},run:function(a){var b=a.getTarget();if(b){var c=this.speed,d=b.distanceTo(a),
d=d-this.distance,b=ig.CollTools.getJumpSpeedForDuration(a.coll,b.coll.pos.z,d/c),b=Math.max(this.minZVel,b);this.maxZVel&&(b=Math.min(this.maxZVel,b));a.coll.vel.z=b}return true}});var g={LANDED:{hasEnded:function(a){var b=a.coll.pos.z-a.coll.baseZPos;if(b>0&&a.stepData.justStarted)a.stepData.justStarted=false;return(!a.stepData.justStarted||a.coll.vel.z<=0)&&b==0},duration:function(a){var b=a.getTarget();return ig.CollTools.getJumpDuration(a.coll,(b||a).coll.baseZPos)}},Z_ZENITH:{hasEnded:function(a){return a.coll.vel.z<=
0},duration:function(a){return ig.CollTools.getJumpZenitDuration(a.coll)}}};ig.ACTION_STEP.JUMP_TARGET_MOVEMENT=ig.ActionStepBase.extend({adjustAbove:0,offset:null,_wm:new ig.Config({attributes:{stopType:{_type:"String",_info:"When to stop Jump Movement",_select:g},stopBeforeTime:{_type:"Number",_info:"Number of seconds to stop before target point has been reached."},distance:{_type:"Number",_info:"Close in to target up to this distance"},offset:{_type:"Vec2",_info:"Offset to target.",_optional:true},
faceAlignOffset:{_type:"Boolean",_info:"If true: use face align offset",_optional:true},rotateSpeed:{_type:"Number",_info:"Speed in which entity will rotate to target. In rotations per seconds.",_default:2,_optional:true},adjustSpeedMax:{_type:"Number",_info:"If defined: optimized speed to hit target with up to this speed",_optional:true},turnMinSpeed:{_type:"Number",_info:"If defined: minimum speed when entity is rotating towards target. If not defined: will stop",_optional:true},maxSpeedChange:{_type:"Number",
_info:"Maximum velocity change per second",_optional:true},missileMode:{_type:"Number",_info:"If set, move entity like missile flying right at entity with speed provided minimal zSpeed. ONLY WORKS WITH adjustSpeedMax defined."},underEstimation:{_type:"Number",_info:"How much jump duration should be underestimated for speed adjustment. Lower value makes hitting target more reliable, but leads to initially fast jump motion.",_default:0.75,_optional:true},cancelIfBelowFall:{_type:"Boolean",_info:"If entity is falling and below target z pos"}}}),
init:function(a){this.stopType=g[a.stopType]||g.LANDED;this.stopBeforeTime=a.stopBeforeTime||0;this.distance=a.distance||0;this.offset=a.offset||null;this.faceAlignOffset=a.faceAlignOffset||null;this.rotateSpeed=a.rotateSpeed||0;this.adjustSpeedMax=a.adjustSpeedMax||0;this.turnMinSpeed=a.turnMinSpeed||0;this.maxSpeedChange=a.maxSpeedChange||0;this.missileMode=a.missileMode||0;this.underEstimation=a.underEstimation||0.75;this.cancelIfBelowFall=a.cancelIfBelowFall||false},start:function(a){a.stepData.justStarted=
true;a.stepData.speedStarted=true;if(this.rotateSpeed)a.stepData.lastDir=Vec2.create(a.face)},run:function(a){var b=a.getTarget();if(b){var d=ig.CollTools.getDistVec3(a.coll,b.coll,c);this.offset&&Vec2.add(d,this.offset);if(this.faceAlignOffset){var e;if(a.getFaceOffset&&(e=a.getFaceOffset())){d.y=d.y-a.coll.size.y/2;d.x=d.x-(e&&e.x||0);d.y=d.y-(e&&e.y||0);d.z=d.z-(e&&e.z||0)}}e=Vec2.length(d);if(e<=Math.max(this.distance,4))Vec2.assignC(a.coll.accelDir,0,0);else if(this.rotateSpeed){Vec2.assign(a.coll.accelDir,
a.stepData.lastDir);Vec2.isZero(a.coll.accelDir)?Vec2.assign(a.coll.accelDir,d):Vec2.rotateToward(a.coll.accelDir,d,this.rotateSpeed*Math.PI*2*ig.system.tick);!a.faceToTarget.active&&!a.faceDirFixed&&Vec2.assign(a.face,a.coll.accelDir);Vec2.assign(a.stepData.lastDir,a.coll.accelDir)}else Vec2.assign(a.coll.accelDir,d);if(this.adjustSpeedMax)if(this.missileMode){e=a.coll;e.zGravityFactor=0;var f=Vec3.length(d);if(f>0){var g=this.adjustSpeedMax,h=g*Vec2.length(d)/f,d=g*d.z/f;e.relativeVel=1;e.maxVel=
h;Vec2.length(e.vel,h);e.vel.z=d;if(e.vel.z>-this.missileMode)e.vel.z=-this.missileMode;e.friction.air=1}}else{g=this.stopType.duration(a);g-this.stopBeforeTime>0.1&&(g=g*this.underEstimation);if(g>0){g=(e-this.distance)/g;if(this.rotateSpeed){d=1-Vec2.angle(a.stepData.lastDir,d)/Math.PI*2;g=Math.max(Math.min(g,this.turnMinSpeed),g*d)}if(this.maxSpeedChange&&!a.stepData.speedStarted){d=g-a.coll.maxVel;e=this.maxSpeedChange*ig.system.tick;Math.abs(d)>e&&(d=d>0?e:-e);g=a.coll.maxVel+d}a.stepData.speedStarted=
false;a.coll.maxVel=Math.min(g,this.adjustSpeedMax)}}if(this.stopBeforeTime){g=this.stopType.duration(a);if(g>0&&g<this.stopBeforeTime)return true}if(this.cancelIfBelowFall){e=a.coll;if(b.coll.pos.z>e.pos.z&&e.vel.z<0)return true}}return this.stopType.hasEnded(a)}});ig.ACTION_STEP.SET_MISSILE_SPEED=ig.ActionStepBase.extend({_wm:new ig.Config({attributes:{speed:{_type:"Number",_info:"Speed of Missile in pixel per seconds. Will be distributed to vel x/y/z to hit target on ground impact. Will always set gravityFactor to 0.",
_default:400},minTime:{_type:"Number",_info:"Minimum amount of time for flight of missile",_optional:true}}}),init:function(a){this.speed=a.speed||400;this.minTime=a.minTime||0},start:function(a){var b=a.getTarget();if(b){var d=a.coll;d.zGravityFactor=0;var a=ig.CollTools.getDistVec3(a.coll,b.coll,c),b=Vec3.length(a),e=this.speed,f=b/e;f<this.minTime&&(e=e*(f/this.minTime));f=e*Vec2.length(a)/b;a=e*a.z/b;d.relativeVel=1;d.maxVel=f;Vec2.length(d.vel,f);d.vel.z=a;d.friction.air=1}}});ig.ACTION_STEP.ESCAPE_FROM_TARGET=
ig.ActionStepBase.extend({distance:0,minTime:0,maxTime:0,_wm:new ig.Config({attributes:{distance:{_type:"Number",_info:"Minimum distance to target"},minTime:{_type:"Number",_info:"Minimum amount of time to escape"},maxTime:{_type:"Number",_info:"Maximum amount of time to escape"}}}),init:function(a){this.distance=a.distance;this.minTime=a.minTime;this.maxTime=a.maxTime},start:function(a){a.stepData.maxTime=this.minTime+Math.random()*(this.maxTime-this.minTime);a.stepTimer=a.stepTimer+a.stepData.maxTime;
a.stepData.doEscape=true},run:function(a){var b=a.getTarget();if(!b)return true;b=Vec2.sub(a.getCenter(),b.getCenter());if(Vec2.length(b)>this.distance)return true;Vec2.normalize(b);if(!a.stepData.dir||a.coll.partlyBlockTimer>0.2){var c=a.coll.partlyBlockTimer=0;if(a.stepData.doEscape)c=b;else{do c=Vec2.normalize(Vec2.createC(Math.random()-0.5,Math.random()-0.5));while(a.stepData.dir&&Vec2.dot(a.stepData.dir,c)>0.8)}a.stepData.dir=c;a.stepData.doEscape=!a.stepData.doEscape}Vec2.assign(a.coll.accelDir,
a.stepData.dir);return a.stepTimer<=0}});ig.ACTION_STEP.CIRCLE_TARGET=ig.ActionStepBase.extend({minTime:0,maxTime:0,_wm:new ig.Config({attributes:{minTime:{_type:"Number",_info:"Minimum amount of time to circle target"},maxTime:{_type:"Number",_info:"Maximum amount of time to circle target"},keepFaceDirection:{_type:"Boolean",_info:"Move so direction which is closer to face direction"},towardsRotate:{_type:"Number",_info:"Rotate direction slightly towards target. If negative: away",optional:true},
towardMinDist:{_type:"Number",_info:"If defined: minimum, distance to keep when rotating towards player. (Rotate away otherwise)",_optional:true},stopBeforeEdge:{_type:"Boolean",_info:"If true: Stop before falling down from edge when further moving forward"}}}),init:function(a){this.minTime=a.minTime;this.maxTime=a.maxTime;this.towardsRotate=a.towardsRotate;this.towardMinDist=a.towardMinDist;this.keepFaceDirection=a.keepFaceDirection;this.stopBeforeEdge=a.stopBeforeEdge},start:function(a){a.stepTimer=
this.minTime+Math.random()*(this.maxTime-this.minTime);a.stepData.ccw=Math.random()>0.5},run:function(a){var b=a.getTarget();if(!b)return true;var b=ig.CollTools.getDistVec2(b.coll,a.coll,i),c=1;if(a.stepData.ccw){Vec2.rotate90CCW(b);c=c*-1}else Vec2.rotate90CW(b);if(this.keepFaceDirection&&Vec2.dot(b,a.face)<0){Vec2.flip(b);c=c*-1}this.towardMinDist&&Vec2.length(b)<this.towardMinDist&&(c=c*-1);this.towardsRotate&&Vec2.rotate(b,Math.PI*0.5*c*this.towardsRotate);Vec2.assign(a.coll.accelDir,b);if(this.stopBeforeEdge&&
ig.CollTools.isPostMoveOverHole(a.coll,true)){Vec2.assignC(a.coll.accelDir,0,0);Vec2.assignC(a.coll.vel,0,0)}return a.stepTimer<=0}});ig.ACTION_STEP.NEW_CIRCLE_TARGET=ig.ActionStepBase.extend({minTime:0,maxTime:0,_wm:new ig.Config({attributes:{time:{_type:"Number",_info:"Time to circle target"},ccw:{_type:"Boolean",_info:"If true: Circle Counter clockwise"},targetDistance:{_type:"Number",_info:"Best distance to target"},yScale:{_type:"Number",_info:"Y scale circle movement"},relativeVel:{_type:"Number",
_info:"Relative Vel when circling"},dodgeVel:{_type:"Number",_info:"Relative Vel when dodging"},avoidEnemyRadius:{_type:"Number",_info:"Radius to check for other enemies to avoid them"}}}),init:function(a){this.time=a.time;this.ccw=a.ccw;this.targetDistance=a.targetDistance;this.yScale=a.yScale||1;this.relativeVel=a.relativeVel||1;this.dodgeVel=a.dodgeVel||1;this.avoidEnemyRadius=a.avoidEnemyRadius||0},start:function(a){a.stepTimer=this.time;a.coll.relativeVel=this.relativeVel},run:function(a){var b=
a.getTarget();if(!b)return true;b=ig.CollTools.getDistVec2(b.coll,a.coll,i);b.y=b.y/this.yScale;var c=Vec2.length(b),d=1;if(this.ccw){Vec2.rotate90CCW(b);d=d*-1}else Vec2.rotate90CW(b);var e=Math.abs(c-this.targetDistance);if(e>8){c<this.targetDistance&&(d=d*-1);c=Math.max((e-8)/this.targetDistance).limit(0,1);Vec2.rotate(b,Math.PI*0.5*d*c);a.coll.relativeVel=this.relativeVel*(1-c)+this.dodgeVel*c}else a.coll.relativeVel=this.relativeVel;if(this.avoidEnemyRadius)for(var d=Vec2.length(b),c=a.getCenter(l),
e=ig.game.getEntitiesInCircle(c,this.avoidEnemyRadius,1,a.coll.size.z),f=e.length,g=[];f--;){c=e[f];if(c.coll.parentColl)c=c.coll.parentColl.entity;if(c&&c instanceof ig.ENTITY.Enemy&&c!=a&&g.indexOf(c)==-1){g.push(c);var h=ig.CollTools.getDistVec2(c.coll,a.coll,l),c=Vec2.length(h);if(c<this.avoidEnemyRadius){Vec2.length(h,d*2*(this.avoidEnemyRadius-c)/this.avoidEnemyRadius);Vec2.add(b,h)}}}Vec2.assign(a.coll.accelDir,b);return a.stepTimer<=0}});var h={TARGET:function(a){return a.getTarget()},PROXY_OWNER:function(a){return a.getCombatantRoot()},
PROXY_SRC:function(a){return a.sourceEntity},COLLAB_ENTITY:function(a){return a.collabAttribs&&a.collabAttribs.entity},OWNER_ENEMY:function(a){return a.ownerEnemy}};ig.ACTION_STEP.STICK_TO_TARGET=ig.ActionStepBase.extend({_wm:new ig.Config({attributes:{target:{_type:"String",_info:"Type of target",_select:h},align:{_type:"String",_info:"Alignment of to target",_select:ig.ENTITY_ALIGN},offset:{_type:"Offset",_info:"Offset to target"},duration:{_type:"Number",_info:"Duration of sticking"},waitUntil:{_type:"VarCondition",
_info:"If defined: continue spinning until condition evaluates to true. Duration is minimum wait",_optional:true}}}),init:function(a){this.target=h[a.target];this.align=ig.ENTITY_ALIGN[a.align]||ig.ENTITY_ALIGN.BOTTOM;this.duration=a.duration||0;this.offset=a.offset;this.waitUntil=new ig.VarCondition(a.waitUntil)},start:function(a){var b=this.target&&this.target(a);if(b){a.stepTimer=this.duration;a.stepData.target=b}},run:function(a){var b=a.stepData.target;if(!b)return true;b=b.getAlignedPos(this.align,
c);this.offset&&Vec3.add(b,this.offset);Vec2.addMulF(b,a.coll.size,-0.5);a.setPos(b.x,b.y,b.z);return!this.waitUntil.evaluate()?false:a.stepTimer<=0}});ig.ACTION_STEP.STICKY_CIRCLE_AROUND=ig.ActionStepBase.extend({_wm:new ig.Config({attributes:{target:{_type:"String",_info:"Type of target",_select:h},distance:{_type:"NumberExpression",_info:"Distance to target",_default:32,_optional:true},duration:{_type:"Number",_info:"Duration of rotating movement"},ccw:{_type:"Boolean",_info:"If true, rotate counterclockwise"},
rotateTime:{_type:"Number",_info:"Seconds for one full rotation. If not defined used current speed to determine rotation speed",_optional:true},rotateTimeEnd:{_type:"Number",_info:"Value for rotation speed at end of duration. Speed will be interpolated.",_optional:true},distAdjustSpeed:{_type:"Number",_info:"Speed with which projectile adjust distance to target (pixel per seconds)"},zDistance:{_type:"Number",_info:"If defined: Interpolate to this z Distance (with same speed as dist interpolation)",
_optional:true},waitUntil:{_type:"VarCondition",_info:"If defined: continue spinning until condition evaluates to true. Duration is minimum wait",_optional:true},waitTargetAlign:{_type:"Boolean",_info:"If true: keep rotating until rotate velocity roughly matches direction to target"}}}),init:function(a){this.target=h[a.target];this.distance=a.distance===void 0?null:a.distance;this.duration=a.duration||0;this.rotateTime=a.rotateTime||0;this.rotateTimeEnd=a.rotateTimeEnd||0;this.distAdjustSpeed=a.distAdjustSpeed||
0;this.ccw=a.ccw||false;this.zDistance=a.zDistance===void 0?null:a.zDistance;this.waitUntil=new ig.VarCondition(a.waitUntil);this.waitTargetAlign=a.waitTargetAlign||false},start:function(a){var b=this.target&&this.target(a);if(b){a.stepTimer=this.duration;a.stepData.target=b;a.stepData.lastPos=Vec3.create(b.coll.pos)}},run:function(a){var b=a.stepData.target;if(!b)return true;var d=a.coll.maxVel*a.coll.relativeVel,e=a.getAlignedPos(ig.ENTITY_ALIGN.BOTTOM,c),f=Vec3.assign(j,b.coll.pos);Vec3.sub(f,
a.stepData.lastPos);this.zDistance!==null?Vec3.add(e,f):Vec2.add(e,f);Vec3.assign(a.stepData.lastPos,b.coll.pos);var g=b.getAlignedPos(ig.ENTITY_ALIGN.BOTTOM,j),b=Vec2.sub(e,g,i);Vec2.isZero(b)&&Vec2.assignC(b,0,-1);var h=Vec2.length(b),f=this.distAdjustSpeed||d;if(this.distance!==null){var k=ig.Event.getExpressionValue(this.distance);if(h<k){h=h+ig.system.tick*f;h>k&&(h=k)}else if(h>this.distance){h=h-ig.system.tick*f;h<k&&(h=k)}Vec2.length(b,h)}k=0;if(this.rotateTime){k=this.rotateTime;if(this.rotateTimeEnd){k=
1/k;k=1/(k+(1/this.rotateTimeEnd-k)*(1-Math.max(0,a.stepTimer/this.duration)))}}h=h*2*Math.PI;d=(k?1/k:d/h)*ig.system.tick*Math.PI*2;a.stepTimer<0&&(this.waitUntil.evaluate()&&!this.waitTargetAlign)&&(d=d*(1+a.stepTimer/ig.system.tick));this.ccw||(d=-d);Vec2.rotate(b,d);Vec2.assign(e,g);Vec2.add(e,b);if(this.zDistance!==null){d=g.z+this.zDistance;if(e.z>d){e.z=e.z-ig.system.tick*f;if(e.z<d)e.z=d}else if(e.z<d){e.z=e.z+ig.system.tick*f;if(e.z>d)e.z=d}}e.x=e.x-a.coll.size.x/2;e.y=e.y-a.coll.size.y/
2;this.ccw?Vec2.rotate90CW(b):Vec2.rotate90CCW(b);a.setPos(e.x,e.y,e.z);!a.faceDirFixed&&!a.faceToTarget.active&&Vec2.assign(a.face,b);if(!this.waitUntil.evaluate())return false;if(a.stepTimer<=0&&this.waitTargetAlign){e=ig.CollTools.getDistVec2(a.coll,a.getTarget().coll,l);if(Vec2.angle(e,b)>Math.PI/2*0.125)return false}return a.stepTimer<=0}});ig.ACTION_STEP.SET_CIRCLE_AROUND_POS=ig.ActionStepBase.extend({_wm:new ig.Config({attributes:{target:{_type:"String",_info:"Type of target",_select:h},proxyGroup:{_type:"String",
_info:"Group of proxies to align circle around pos with"},count:{_type:"Number",_info:"Number of proxies that circle around target with even spacing"},attribBlock:{_type:"String",_info:"If defined: only consider proxy if attrib is false",_optional:true}}}),init:function(a){this.target=h[a.target];this.proxyGroup=a.proxyGroup;this.count=a.count||1;this.attribBlock=a.attribBlock},start:function(a){var b=this.target&&this.target(a);if(b){for(var c=b.getAlignedPos(ig.ENTITY_ALIGN.BOTTOM,j),d=a.getCombatantRoot().entityAttached,
e=d.length,f=[];e--;){var g=d[e];g!=a&&g instanceof sc.CombatProxyEntity&&(!this.attribBlock||!g.getAttribute(this.attribBlock))&&g.group==this.proxyGroup&&f.push(this._getDeltaVector(b,g))}b=Vec2.assignC(i,0,1);d=Math.PI*2/this.count;if(f.length){Vec2.assign(b,f[0]);var h=this.count;do{g=false;Vec2.rotate(b,d);for(e=f.length;e--;)Vec2.angle(b,f[e])<d/2&&(g=true);h--}while(g&&h)}Vec2.length(b,1);Vec2.add(c,b);a.setPos(c.x-a.coll.size.x/2,c.y-a.coll.size.y/2,void 0)}},_getDeltaVector:function(a,b){return ig.CollTools.getDistVec2(a.coll,
b.coll,Vec2.create())}});ig.ACTION_STEP.TACKLE=ig.ActionStepBase.extend({time:0,missReactTime:void 0,attack:null,cancelOnHit:false,withBranches:false,rotateSpeed:0,_wm:new ig.Config({attributes:{attack:{_type:"AttackInfo",_info:"Attack Info of tackle"},time:{_type:"Number",_info:"Movement time to tackel target"},missReactTime:{_type:"Number",_info:"Reaction time to stop tackle after target has been clearly missed",_optional:true},cancelOnHit:{_type:"Boolean",_info:"If true, cancel tackle once target is hit"},
withBranches:{_type:"Boolean",_info:"Show branches to handle hit and miss follow up",_optional:true},collideCancel:{_type:"Number",_info:"If defined: if angle to collided wall is lower than this value, cancel step",_optional:true},rotateSpeed:{_type:"Number",_info:"Speed in which entity will rotate to target. In rotations per seconds.",_default:0.2,_optional:true},orthoDirFactor:{_type:"Number",_info:"0= hit target will fly in dash dir. 1= target will fly orthogonally away from dash trail."},ignoreLastHit:{_type:"Boolean",
_info:"If true, ignore most recently hit entity"},collideSlip:{_type:"Boolean",_info:"If true: when colliding with wall, change dash direction to slip alongside wall."}},branchLabel:function(a){switch(a){case "hit":return"ON TACKLE HIT";case "missed":return"ON TACKE MISS";case "_end":return"end tackle"}return"???"}}),init:function(a){this.time=a.time;this.attack=a.attack;this.missReactTime=a.missReactTime;this.cancelOnHit=a.cancelOnHit||false;this.withBranches=a.withBranches||false;this.collideCancel=
a.collideCancel||0;this.collideSlip=a.collideSlip||false;this.rotateSpeed=a.rotateSpeed||0;this.orthoDirFactor=a.orthoDirFactor||0;this.ignoreLastHit=a.ignoreLastHit||false},start:function(a){a.stepTimer=this.time;a.stepData.dir=Vec2.create(a.face);a.stepData.weight=a.coll.weight;a.coll.weight=-1;Vec2.assign(a.coll.accelDir,a.stepData.dir);var b=a.coll;b.totalBlockTimer=b.partlyBlockTimer=0;a.setTackle(new sc.AttackInfo(a.params,this.attack),this.orthoDirFactor,this.cancelOnHit,this.ignoreLastHit)},
run:function(a){var b=a.getTarget();if(this.rotateSpeed&&b){var c=ig.CollTools.getDistVec2(a.coll,b.coll,i);Vec2.rotateToward(a.stepData.dir,c,this.rotateSpeed*Math.PI*2*ig.system.tick);Vec2.assign(a.face,a.stepData.dir)}Vec2.assign(a.coll.accelDir,a.stepData.dir);if(!a.getCombatantRoot().isPlayer&&!b)a.stepTimer=0;if(b&&this.missReactTime!=void 0&&this.missReactTime!=null&&a.stepTimer>this.missReactTime){ig.CollTools.getDistVec2(a.coll,b.coll,r);if(Vec2.angle(r,a.face)>Math.PI/2)a.stepTimer=this.missReactTime}if(this.collideCancel&&
ig.CollTools.hasWallCollide(a.coll,this.collideCancel))a.stepTimer=0;else if(this.collideSlip&&ig.CollTools.hasWallCollide(a.coll,1)){b=Vec2.assign(i,a.coll._collData.blockDir);Vec2.rotate90CW(b);Vec2.dot(b,a.face)<0&&Vec2.flip(b);Vec2.assign(a.face,b);Vec2.assign(a.stepData.dir,b)}if(this.cancelOnHit&&a.tackle.hitCount>0)a.stepTimer=0;return a.stepTimer<=0},getBranchNames:function(){return this.withBranches?["hit","missed"]:null},getNext:function(a){var b=a.tackle.hitCount>0;a.setTackle(null);a.coll.weight=
a.stepData.weight;return this.withBranches?b?this.branches.hit||this._nextStep:this.branches.missed||this._nextStep:this._nextStep}});ig.ACTION_STEP.CIRCLE_ATTACK=ig.ActionStepBase.extend({circleSettings:null,attack:null,fixPos:false,_wm:new ig.Config({attributes:{attack:{_type:"AttackInfo",_info:"Attack Info of circle attack"},align:{_type:"String",_info:"Alignment of force relative to entity",_select:ig.ENTITY_ALIGN},offset:{_type:"Offset",_info:"Offset to entity"},radius:{_type:"Number",_info:"Radius of circle attack"},
dir:{_type:"Vec2",_info:"Direction to go to",_actorOption:true,_optional:true},yScale:{_type:"Number",_info:"Scale of y dimension relative to x. 1 = equally scaled. 0.5 = half y extend."},zHeight:{_type:"Number",_info:"Z Height of collision force."},centralAngle:{_type:"Number",_info:"Central Angle of circle attack. 1 = one circle"},startAngle:{_type:"Number",_info:"Start angle of circle attack relative to front. If not specified startes at - centralAngle / 2",_optional:true},duration:{_type:"Number",
_info:"Duration of circle sweep"},expandRadius:{_type:"Number",_info:"How much the radius extends during the sweep"},alwaysFull:{_type:"Boolean",_info:"If true, circle is constantly closed."},clockwise:{_type:"Boolean",_info:"If true, sweep clockwise. ccw otherwise."},flipLeftFace:{_type:"Integer",_info:"If true, flip circle orientation if left faced."},rectangular:{_type:"Boolean",_info:"Collision area is actually not a circle, but a box."},repeat:{_type:"Boolean",_info:"If true, repeat proxy spawning until ended by force (action end or call STOP_REPEATING_FORCE)"},
uniformHitDir:{_type:"Boolean",_info:"If true, use entity center to determine hit direction rather than force center"},fixPos:{_type:"Boolean",_info:"If true: show circle attack at a fixed position"},checkCollision:{_type:"Boolean",_info:"If true: check collision before hitting entities"},party:{_type:"String",_info:"Override party determine which things are hit",_select:sc.COMBATANT_PARTY,_optional:true}}}),init:function(a){this.circleSettings=a},run:function(a){var b=new sc.CircleHitForce(a,this.circleSettings);
sc.combat.addCombatForce(b);b.duration>0&&a.addActionAttached(b);return true}});ig.ACTION_STEP.COMBAT_SWEEP=ig.ActionStepBase.extend({_wm:new ig.Config({attributes:{sweepType:{_type:"String",_info:"Type of sweep",_select:sc.COMBAT_SWEEPS},reversed:{_type:"Boolean",_info:"If true: Show effect reversed"},faceCount:{_type:"Number",_info:"For how many face directions the effect should be rotated"},flipLeftFace:{_type:"Boolean",_info:"If true, flip for left facing directions"}}}),init:function(a){this.sweepType=
sc.COMBAT_SWEEPS[a.sweepType];this.reversed=a.reversed;this.faceCount=a.faceCount;this.flipLeftFace=a.flipLeftFace||false},run:function(a){var b=sc.combat.getElementMode(a);sc.CombatSweep.show(this.sweepType,a,b,this.faceCount,this.reversed,this.flipLeftFace);return true}});ig.ACTION_STEP.SET_TARGET_Z_VEL=ig.ActionStepBase.extend({value:null,_wm:new ig.Config({attributes:{value:{_type:"Number",_info:"New Z Vel value. Positive for up movement"}}}),init:function(a){this.value=a.value},run:function(a){if(a=
a.getTarget())a.coll.vel.z=this.value;return true}});ig.ACTION_STEP.PUSH_PULL_FORCE=ig.ActionStepBase.extend({pushPullSettings:null,_wm:new ig.Config({attributes:{strength:{_type:"String",_info:"How strong enemy is pushed/pulled",_select:sc.PUSH_PULL_STRENGTH},pull:{_type:"Boolean",_info:"If true: pull entities towards combatant, otherwise, push away"},radius:{_type:"Number",_info:"Radius of circle attack"},fadeRadius:{_type:"Number",_info:"addition Radius in which the strengh is linarly faded to 0"},
minRadius:{_type:"Number",_info:"If defined, force will stop if entity is below that radius"},faceDist:{_type:"Number",_info:"If defined, place pull center in front of face direction with specified distance",_optional:true},zHeight:{_type:"Number",_info:"Z height of push/pull force range",_default:32},duration:{_type:"Number",_info:"Duration of force. -1 will last until action end or call of STOP_REPEATING_FORCE"},party:{_type:"String",_info:"Party of force. Combatants of other parties are pushed/pulled. Will use combatant party by default",
_select:sc.COMBATANT_PARTY,_optional:true},effect:{_type:"Effect",_info:"If defined: show effect on combatants influenced by force",_optional:true},align:{_type:"String",_info:"Alignment ot push/pull force",_select:ig.ENTITY_ALIGN}}}),init:function(a){this.pushPullSettings=a;this.pushPullSettings.effect&&(this.pushPullSettings.effect=new ig.EffectHandle(this.pushPullSettings.effect))},clearCached:function(){this.pushPullSettings.effect&&this.pushPullSettings.effect.clearCached()},run:function(a){var b=
new sc.PushPullForce(a,this.pushPullSettings);sc.combat.addCombatForce(b);a.addActionAttached(b);return true}});ig.ACTION_STEP.SET_INVINCIBLE=ig.ActionStepBase.extend({value:false,_wm:new ig.Config({attributes:{value:{_type:"Number",_info:"The time the combatant will be invincible. -1 for constant invincibility. Set to 0 to reset."}}}),init:function(a){this.value=a.value},run:function(a){a.invincibleTimer=this.value;return true}});ig.ACTION_STEP.MOD_GENERIC_PROXY=ig.ActionStepBase.extend({killEffect:null,
clearKillEffect:false,hp:null,threat:null,_wm:new ig.Config({attributes:{killEffect:{_type:"Effect",_info:"If defined, set Kill effects of generic proxy",_optional:true},clearKillEffect:{_type:"Boolean",_info:"If true, clear kill effect of generic proxy"},hp:{_type:"Number",_info:"Define to overwrite. If 0: proxy will ignore attack. -1: will take hits but is never destroyed (stops balls) >0: takes hits and can be destroyed",_optional:true},threat:{_type:"Boolean",_info:"If true, consider proxy a threat (true by default)",
_optional:true}}}),init:function(a){if(a.killEffect)this.killEffect=new ig.EffectHandle(a.killEffect);this.clearKillEffect=a.clearKillEffect||false;if(a.hp!==void 0)this.hp=a.hp;if(a.threat!==void 0)this.threat=a.threat},clearCached:function(){this.killEffect&&this.killEffect.clearCached()},start:function(a){if(a instanceof sc.CombatProxyEntity){if(this.killEffect)a.effects.onKill=this.killEffect;if(this.clearKillEffect)a.effects.onKill=null;this.hp!==null&&a.setMaxHp(this.hp);if(this.threat!==null)a.isThreat=
this.threat}}});ig.ACTION_STEP.CONNECT_PROXY_TO_TARGET=ig.ActionStepBase.extend({_wm:new ig.Config({attributes:{}}),init:function(){},start:function(a){var b=a.getTarget();a.connectExternal&&a.connectExternal(b)}});ig.ACTION_STEP.DISCONNECT_PROXY_FROM_TARGET=ig.ActionStepBase.extend({_wm:new ig.Config({attributes:{}}),init:function(){},start:function(a){a.connectExternal&&a.connectExternal(null)}});ig.ACTION_STEP.SET_ELEMENT_FILTER=ig.ActionStepBase.extend({value:false,_wm:new ig.Config({attributes:{value:{_type:"String",
_info:"Value of element filter. NEUTRAL=No Filter.",_select:sc.ELEMENT}}}),init:function(a){this.value=sc.ELEMENT[a.value]||sc.ELEMENT.NEUTRAL},run:function(a){a.elementFilter=this.value;return true}});ig.ACTION_STEP.DODGE_FREE_LINE=ig.ActionStepBase.extend({time:0,_wm:new ig.Config({attributes:{time:{_type:"Number",_info:"How long to dodge the free line."}}}),init:function(a){this.time=a.time},start:function(a){a.stepTimer=this.time;a.stepData.dir=sc.combat.isBlockingFreeLine(a)},run:function(a){if(!a.stepData.dir)return true;
Vec2.assign(a.coll.accelDir,a.stepData.dir);return a.stepTimer<=0}});ig.ACTION_STEP.ENABLE_REACTION=ig.ActionStepBase.extend({reaction:null,_wm:new ig.Config({attributes:{reaction:{_type:"Reaction",_info:"Reaction to enable"}}}),init:function(a){this.reaction=a.reaction},run:function(a){a.enableReaction(this.reaction);return true}});ig.ACTION_STEP.SET_SPIKE_DAMAGE=ig.ActionStepBase.extend({value:null,_wm:new ig.Config({attributes:{value:{_type:"Number",_info:"Value for spike damage factor"}}}),init:function(a){this.value=
a.value},run:function(a){a.spikeDmg.tmpFactor=this.value;return true}});ig.ACTION_STEP.DISABLE_REACTION=ig.ActionStepBase.extend({reaction:null,_wm:new ig.Config({attributes:{reaction:{_type:"Reaction",_info:"Reaction to disable"}}}),init:function(a){this.reaction=a.reaction},run:function(a){a.disableReaction(this.reaction);return true}});ig.ACTION_STEP.SET_DAMAGE_FACTOR=ig.ActionStepBase.extend({value:null,_wm:new ig.Config({attributes:{value:{_type:"Number",_info:"New damage factor"}}}),init:function(a){this.value=
a.value},run:function(a){if(a.params)a.params.damageFactor=this.value;return true}});ig.ACTION_STEP.SET_HIT_STABLE=ig.ActionStepBase.extend({value:null,_wm:new ig.Config({attributes:{value:{_type:"String",_info:"New hit stable value.",_select:sc.ATTACK_TYPE}}}),init:function(a){this.value=sc.ATTACK_TYPE[a.value]},run:function(a){a.hitStable=this.value;return true}});ig.ACTION_STEP.SET_DAMAGE_CEILING=ig.ActionStepBase.extend({value:null,_wm:new ig.Config({attributes:{value:{_type:"Number",_info:"The maximum sum of all damage factors of the attack. Damage factors will be scaled down when sum gets close to maximum"},
forwardToProxies:{_type:"Boolean",_info:"Forward ceiling on all attached action proxies"}}}),init:function(a){this.value=a.value||0},run:function(a){a.combo.damageCeiling={max:this.value,sum:{}};for(var b=a.actionAttached,c=b.length;c--;)if(b[c]instanceof sc.BasicCombatant)b[c].combo.damageCeiling=a.combo.damageCeiling;return true}});ig.ACTION_STEP.CLEAR_DAMAGE_CEILING=ig.ActionStepBase.extend({_wm:new ig.Config({attributes:{forwardToProxies:{_type:"Boolean",_info:"Forward ceiling on all attached action proxies"}}}),
init:function(a){this.value=a.value||0},run:function(a){a.combo.damageCeiling=null;for(var a=a.actionAttached,b=a.length;b--;)if(a[b]instanceof sc.BasicCombatant)a[b].combo.damageCeiling=null;return true}});ig.ACTION_STEP.SET_ENEMY_STATE=ig.ActionStepBase.extend({enemyState:0,_wm:new ig.Config({attributes:{enemyState:{_type:"EnemyState",_info:"State of Enemy to switch to"},switchConfig:{_type:"Boolean",_info:"If true, immediately switch default config. Makes sure correct damage pose is displayed etc.",
_optional:true}}}),init:function(a){this.enemyState=a.enemyState;this.switchConfig=a.switchConfig},run:function(a){a.changeState(this.enemyState,false,this.switchConfig);return true}});var i=Vec2.create(),j=Vec3.create(),k={SELF:function(a,b,c){a=b.getAlignedPos(c,a);if(b.isPlayer&&this.align==ig.ENTITY_ALIGN.BOTTOM){c=b.maxJumpHeight===void 0?-1:b.maxJumpHeight;if(c>=0)a.z=Math.min(b.coll.pos.z,c)}return a},TARGET:function(a,b,c){return(b.getTarget()||b).getAlignedPos(c,a)},COLLAB_CENTER:function(a,
b,c){return!b.collaboration?b.getAlignedPos(c,a):b.collaboration.getCenterPos(a,c)}};ig.ACTION_STEP.SHOOT_PROXY=ig.ActionStepBase.extend({proxySrc:null,offset:{x:0,y:0,z:0},align:ig.ENTITY_ALIGN.FACE,dir:null,posType:null,_wm:new ig.Config({attributes:{proxy:{_type:"ProxyRef",_info:"Ball the entity will shoot"},offset:{_type:"Offset",_info:"Offset relative to entity ground center from which to shoot"},align:{_type:"String",_info:"Alignment relative to entity from which to shoot",_select:ig.ENTITY_ALIGN},
dir:{_type:"Vec2",_info:"Direction to go to",_actorOption:true,_optional:true},aimAtTarget:{_type:"Boolean",_info:"If true: aim at target, ignore any other direction.",_optional:true},posType:{_type:"String",_info:"How to determine start position",_select:k,_optional:true}}}),init:function(a){this.proxySrc=sc.ProxyTools.prepareSrc(a.proxy);this.offset=a.offset||this.offset;this.align=ig.ENTITY_ALIGN[a.align]||this.align;this.dir=a.dir;this.aimAtTarget=a.aimAtTarget;this.posType=k[a.posType]||k.SELF},
clearCached:function(){sc.ProxyTools.releaseSrc(this.proxySrc)},run:function(a){var b=sc.ProxyTools.getProxy(this.proxySrc,a);if(b){var c=this.dir&&ig.Action.getVec2(this.dir,a,i)||a.face,d=this.posType(j,a,this.align);Vec3.add(d,this.offset);if(this.aimAtTarget){var e=a.getTarget();if(e){c=e.getCenter(i);Vec2.sub(c,d)}}b.spawn(d.x,d.y,d.z,a,c)}return true}});ig.ACTION_STEP.SET_HIT_PROXY=ig.ActionStepBase.extend({proxySrc:null,offset:{x:0,y:0,z:0},align:ig.ENTITY_ALIGN.FACE,posType:null,_wm:new ig.Config({attributes:{proxy:{_type:"ProxyRef",
_info:"Ball the entity will shoot"},posType:{_type:"String",_info:"How to determine start position",_select:sc.COMBAT_HIT_PROXY_POS},align:{_type:"String",_info:"Alignment relative to entity from which to shoot",_select:ig.ENTITY_ALIGN},offset:{_type:"Offset",_info:"Offset relative to entity ground center from which to shoot"}}}),init:function(a){this.proxySrc=sc.ProxyTools.prepareSrc(a.proxy);this.offset=a.offset||this.offset;this.align=ig.ENTITY_ALIGN[a.align]||this.align;this.posType=sc.COMBAT_HIT_PROXY_POS[a.posType]||
null},clearCached:function(){sc.ProxyTools.releaseSrc(this.proxySrc)},start:function(a){var b=sc.ProxyTools.getProxy(this.proxySrc,a);b&&a.setHitProxy(b,this.posType,this.align,this.offset)}});ig.ACTION_STEP.SET_PROXY_OWNER_TO_POS=ig.ActionStepBase.extend({_wm:new ig.Config({attributes:{}}),init:function(){},clearCached:function(){},run:function(a){a.getCombatantRoot().setPos(a.coll.pos.x,a.coll.pos.y,a.coll.pos.z);return true}});ig.ACTION_STEP.CLEAR_HIT_PROXY=ig.ActionStepBase.extend({_wm:new ig.Config({attributes:{}}),
init:function(){},start:function(a){a.combo.hitProxy=null}});var l=Vec2.create(),o=Vec3.create();ig.ACTION_STEP.SHOOT_PROXY_RANGE=ig.ActionStepBase.extend({forceSettings:null,_wm:new ig.Config({attributes:{proxy:{_type:"ProxyRef",_info:"Ball the entity will shoot"},offset:{_type:"Offset",_info:"Offset relative to entity ground center from which to shoot"},align:{_type:"String",_info:"Alignment relative to entity from which to shoot",_select:ig.ENTITY_ALIGN},dir:{_type:"Vec2",_info:"Direction to go to",
_actorOption:true,_optional:true},centralAngle:{_type:"Number",_info:"Central angle of range. 1 = full circle"},startAngle:{_type:"Number",_info:"Angle from which to start. Default is - centralAngle / 2",_optional:true},angleVary:{_type:"Number",_info:"Randomly vary each angle with the provided range"},startDist:{_type:"NumberExpression",_info:"Start Distance of ball in throw direction",_optional:true},startDistAdd:{_type:"Number",_info:"Start Distance added for following proxies. Last proxy will be spawned with startDist + startDistAdd distance",
_optional:true},startDistCollide:{_type:"String",_info:"If not NONE: consider environment collision before adding start dist. CLOSER = move closer, DROP = Don't spawn if colliding",_select:sc.SPAWN_START_DIST_COLLIDE},limitRangeOnColl:{_type:"Boolean",_info:"If true, limit range of spawning depending on collision, check only at beginning",_optional:true},random:{_type:"Boolean",_info:"Spawn each Proxy in random direction within range"},count:{_type:"NumberExpression",_info:"The number of proxies thrown"},
duration:{_type:"NumberExpression",_info:"Time it takes to throw proxies"},clockwise:{_type:"Boolean",_info:"If true throw proxies clockwise, otherwise counter clockwise"},flipLeftFace:{_type:"Integer",_info:"If FACE COUNT is provided: swap clockWise if face direction is towards left"},offsetArea:{_type:"Vec2",_info:"offset Area around position to randomly spawn entity at",_optional:true},circularArea:{_type:"Boolean",_info:"Make offsetArea circular, not rectangular"},uniformDir:{_type:"Number",_info:"To what extend the final dir should be uniform. 1=all the same dir, 0= all individual, 0.5=between the two"},
delay:{_type:"Number",_info:"Time delay for first shot"},repeat:{_type:"Boolean",_info:"If true, repeat proxy spawning until ended by force (action end or call STOP_REPEATING_FORCE)"},terrainFilter:{_type:"Array",_info:"Only spawn entity if terrain below is in this list",_sub:{_type:"String",_select:ig.TERRAIN},_optional:true},maxGroundDistance:{_type:"Number",_info:"If specified: must have at most this distance to ground, otherwise won't be spawned",_optional:true},posEntity:{_type:"String",_info:"If selected: use alternative entity for spawn center position",
_optional:true,_select:d},yScale:{_type:"Number",_info:"Scale of y dimension relative to x. 1 = equally scaled. 0.5 = half y extend.",_optional:true,_default:1},aimAtTarget:{_type:"Boolean",_info:"If true: set direction to aim directly at target",_optional:true}}}),init:function(a){a.proxy=sc.ProxyTools.prepareSrc(a.proxy);this.forceSettings=a;this.posEntity=d[a.posEntity]||null},clearCached:function(){sc.ProxyTools.releaseSrc(this.forceSettings.proxy)},run:function(a){var b=null;this.posEntity&&
(b=this.posEntity(a));b=new sc.ProxySpawnerForce(a,this.forceSettings,b);sc.combat.addCombatForce(b);a.addActionAttached(b);return true}});ig.ACTION_STEP.SHOOT_PROXY_GRID=ig.ActionStepBase.extend({_wm:new ig.Config({attributes:{proxies:{_type:"Array",_info:"List of proxy types",_sub:"ProxyRef"},pattern:{_type:"FlexibleTable",_info:"Pattern of proxies. 0=no proxy, otherwise n-1 = proxy id",_cols:20,_rows:30,_popup:true},tilesize:{_type:"Number",_info:"Size of grid tile - distance between neighbouring proxies",
_default:16},align:{_type:"String",_info:"Alignment relative to entity from which to shoot",_select:ig.ENTITY_ALIGN},flow:{_type:"String",_info:"Determines the order in which proxies are spawned",_select:sc.PROXY_GRID_FLOW},offset:{_type:"Offset",_info:"Offset relative to entity ground center from which to shoot"},duration:{_type:"Number",_info:"Duration of proxy spawning"},spawnDelay:{_type:"Number",_info:"If defined guarantee a minimum delay between each spawned proxy",_optional:true},posEntity:{_type:"String",
_info:"If selected: use alternatice entity for spawn center position",_optional:true,_select:d}}}),init:function(a){for(var b=a.proxies,c=[],e=0;e<b.length;++e)c[e]=sc.ProxyTools.prepareSrc(b[e]);a.proxies=c;this.forceSettings=a;this.posEntity=d[a.posEntity]||null},clearCached:function(){for(var a=this.forceSettings.proxies,b=a.length;b--;)sc.ProxyTools.releaseSrc(a[b])},run:function(a){var b=null;this.posEntity&&(b=this.posEntity(a));b=new sc.ProxyGridForce(a,this.forceSettings,b);sc.combat.addCombatForce(b);
a.addActionAttached(b);return true}});ig.ACTION_STEP.STOP_REPEATING_FORCE=ig.ActionStepBase.extend({_wm:new ig.Config({attributes:{}}),init:function(){},run:function(a){for(var a=a.actionAttached,b=a.length;b--;){var c=a[b];if(c instanceof sc.CombatForce&&c.isRepeating())c.onActionEndDetach()}return true}});ig.ACTION_STEP.UNSTICK_STICKING_PROXIES=ig.ActionStepBase.extend({_wm:new ig.Config({attributes:{}}),init:function(){},start:function(a){for(var a=a.actionAttached,b=a.length;b--;){var c=a[b];
if(c instanceof sc.CombatProxyEntity&&c.stickToSource)c.stickToSource=0}}});ig.ACTION_STEP.REMOVE_PROXIES=ig.ActionStepBase.extend({_wm:new ig.Config({attributes:{sticking:{_type:"Boolean",_info:"If true: only remove sticking proxies"},group:{_type:"String",_info:"If set, only clear proxies of that group"},target:{_type:"String",_info:"What entity will get the buff",_select:d,_optional:true},keepCount:{_type:"Number",_info:"If defined: keep this many proxies and only remove proxies beyond that number",
_optional:true},ignoreSelf:{_type:"Boolean",_info:"If true: don't remove itself"}}}),init:function(a){this.sticking=a.sticking||false;this.group=a.group||null;this.target=d[a.target]||d.SELF;this.keepCount=a.keepCount||0;this.ignoreSelf=a.ignoreSelf||false},start:function(a){var b=this.target(a).getCombatantRoot();sc.CombatProxyTools.clearEntityProxy(b,this.group,this.sticking,this.keepCount,this.ignoreSelf?a:null)}});var m={};ig.ACTION_STEP.FANCY_AIM=ig.ActionStepBase.extend({_wm:new ig.Config({attributes:{bounces:{_type:"Number",
_info:"Number of Bounces"},size:{_type:"Number",_info:"Size of projectile"},time:{_type:"Number",_info:"Maximum time to aim"}}}),init:function(a){this.bounces=a.bounces||0;this.size=a.size||0;this.time=a.time||null},start:function(a){var b=a.getTarget(),c=ig.CollTools.getDistVec2(a.coll,b.coll,r),b=Vec2.createC(0,0);Math.abs(c.y)>Math.abs(c.x)*2?b.x=1:b.y=1;Math.random()<0.5&&Vec2.flip(b);var c=a.getAlignedPos(ig.ENTITY_ALIGN.CENTER,j),d=ig.game.physics.initTraceResult(m);ig.game.trace(d,c.x-this.size/
2,c.y-this.size/2,c.z,b.x*256,b.y*256,this.size,this.size,this.size,ig.COLLTYPE.PROJECTILE,a,void 0,false);a.stepData.sidePos=[];a.stepData.sidePos[0]=(b.x?c.x:c.y)+(b.y||b.x)*Math.round(d.dist*256);d=ig.game.physics.initTraceResult(m);ig.game.trace(d,c.x-this.size/2,c.y-this.size/2,c.z,-b.x*256,-b.y*256,this.size,this.size,this.size,ig.COLLTYPE.PROJECTILE,a,void 0,false);a.stepData.sidePos[1]=(b.x?c.x:c.y)-(b.y||b.x)*Math.round(d.dist*256);a.stepData.throwDir=b;a.stepTimer=a.stepTimer+this.time},
run:function(a){var b=a.stepData.throwDir,c=a.stepData.sidePos,d=a.getTarget(),e=d.getCenter(r);Vec2.addMulF(e,d.coll.vel,0.05);var d=a.getAlignedPos(ig.ENTITY_ALIGN.CENTER,j),f=(this.bounces-1)*Math.abs(c[0]-c[1]),g=this.bounces%2?c[0]:c[1];if(b.y){f=f+(Math.abs(c[0]-d.y)+Math.abs(g-e.y));a.face.y=c[0]-d.y;a.face.x=(e.x-d.x)*Math.abs(a.face.y/f)}else{f=f+(Math.abs(c[0]-d.x)+Math.abs(g-e.x));a.face.x=c[0]-d.x;a.face.y=(e.y-d.y)*Math.abs(a.face.x/f)}return a.stepTimer<=0}});ig.ACTION_STEP.WAIT_UNTIL_PLAYER_ACTION=
ig.ActionStepBase.extend({_wm:new ig.Config({attributes:{actions:{_type:"Array",_info:"List of player actions to react to",_sub:{_type:"String",_select:sc.PLAYER_ACTION}},attrib:{_type:"String",_info:"Attrib name to store action value to if successfully found",_optional:true},target:{_type:"String",_info:"Where is player found?",_select:d,_optional:true},maxTime:{_type:"Number",_info:"Maximum time to wait",_optional:true}}}),init:function(a){this.actions=a.actions||[];this.attrib=a.attrib||null;this.target=
d[a.target]||d.SELF;this.maxTime=a.maxTime||0},start:function(a){this.attrib&&a.setAttribute(this.attrib,null);a.stepTimer=a.stepTimer+this.maxTime},run:function(a){var b=this.target(a);if((b=(b=b&&b.getCombatantRoot())&&b.playerTrack&&b.playerTrack.startedAction)&&this.actions.indexOf(b)!=-1){this.attrib&&a.setAttribute(this.attrib,b);return true}return this.maxTime&&a.stepTimer<=0}});ig.ACTION_STEP.SHARE_PROXY_TEMP_TARGET=ig.ActionStepBase.extend({_wm:new ig.Config({attributes:{group:{_type:"String",
_info:"If set, only share target with proxies of that group"}}}),init:function(a){this.group=a.group||null},start:function(a){for(var b=a.getCombatantRoot().entityAttached,c=b.length;c--;){var d=b[c];if(d instanceof sc.CombatProxyEntity&&!(this.group&&d.group!=this.group))d.tmpTarget=a.tmpTarget}}});ig.ACTION_STEP.WAIT_UNTIL_PROXIES_DONE=ig.ActionStepBase.extend({_wm:new ig.Config({attributes:{group:{_type:"String",_info:"If defined: only consider proxies with that label",_optional:true}}}),init:function(a){this.group=
a.group},run:function(a){for(var a=a.actionAttached,b=a.length;b--;)if(a[b]instanceof sc.CombatProxyEntity&&!(this.group&&a[b].group!=this.group))return false;return true}});ig.ACTION_STEP.WAIT_UNTIL_COMBAT_TRUE=ig.ActionStepBase.extend({_wm:new ig.Config({attributes:{conditions:{_type:"CombatConditions",_info:"Combat conditions. Will wait until evaluates to true."},maxTime:{_type:"Number",_info:"Maximum time to wait",_optional:true}}}),init:function(a){this.conditions=new sc.CombatConditions(a.conditions);
this.maxTime=a.maxTime||0},start:function(a){a.stepTimer=a.stepTimer+this.maxTime},run:function(a){return this.conditions.check(a,Math.random())?true:this.maxTime&&a.stepTimer<=0}});ig.ACTION_STEP.WAIT_UNTIL_TRAP_OVER=ig.ActionStepBase.extend({_wm:new ig.Config({attributes:{}}),init:function(){},start:function(){},run:function(a){a=a.getTarget();return!a||!a.combo||!a.combo.guardTrapTime?true:false}});ig.ACTION_STEP.WAIT_UNTIL_TARGET_DEFEATED=ig.ActionStepBase.extend({_wm:new ig.Config({attributes:{maxTime:{_type:"Number",
_info:"If > 0 Maximum time to wait"}}}),init:function(a){this.maxTime=a.maxTime},start:function(a){a.stepTimer=a.stepTimer+this.maxTime},run:function(a){var b=a.getTarget();return!b||!b.isDefeated||b.isDefeated()?true:this.maxTime&&a.stepTimer<=0}});ig.ACTION_STEP.SPAWN_BURSTS=ig.ActionStepBase.extend({offset:{x:0,y:0,z:0},dir:null,inFaceDir:false,burstSettings:null,dirRotate:0,_wm:new ig.Config({attributes:{attack:{_type:"AttackInfo",_info:"Attack Info of circle attack"},offset:{_type:"Offset",_info:"Offset relative to entity ground center from which to shoot"},
dir:{_type:"Vec2",_info:"Static direction to move burst to",_optional:true},dirRotate:{_type:"Number",_info:"Rotation to original dir. 1 = one full circle rotation"},inFaceDir:{_type:"Boolean",_info:"If true, spawn bursts along entity face. Otherwise directly to target"},effect:{_type:"Effect",_info:"Effect to play on each burst"},moveSpeed:{_type:"Number",_info:"Movement speed of bursts",_default:40},spawnCount:{_type:"Number",_info:"Number of bursts to spawn",_default:3},spawnInterval:{_type:"Number",
_info:"Seconds to wait between bursts",_default:0.3},damageDelay:{_type:"Number",_info:"Damage delay after burst effects stars in seconds",_default:0},radius:{_type:"Number",_info:"Radius of burst damage",_default:32},zHeight:{_type:"Number",_info:"Z Range of burst damage",_default:24},steerDegree:{_type:"Number",_info:"To what degree bursts steer towards player.",_default:0.2},adjustTime:{_type:"Number",_info:"Time to 'fade In' steering degree at the beginning",_optional:true},cancelOnCollision:{_type:"Boolean",
_info:"If true: cancel spawning when hitting a wall"}}}),init:function(a){this.offset=a.offset||this.offset;this.dir=a.dir||null;this.dirRotate=(a.dirRotate||0)*Math.PI*2;this.inFaceDir=a.inFaceDir||false;this.burstSettings=a;this.burstSettings.effect=new ig.EffectHandle(a.effect)},clearCached:function(){this.burstSettings.effect.clearCached()},run:function(a){var b=Vec3.create();a.getCenter(b);b.z=a.coll.pos.z;Vec3.add(b,this.offset);var c,d=a.getTarget();if(this.dir)c=Vec2.create(this.dir);else if(this.inFaceDir||
!d)c=Vec2.create(a.face);else{c=Vec2.create();d.getCenter(c);Vec2.sub(c,b)}this.dirRotate&&Vec2.rotate(c,this.dirRotate);this.burstSettings.combatant=a;this.burstSettings.vel=c;ig.game.spawnEntity(ig.BurstSpawnerEntity,b.x,b.y,b.z,this.burstSettings);this.burstSettings.combatant=null;return true}});var n={STUN_LOCKED:1,PREVIOUSLY_HIT:2,TARGET:3};ig.ACTION_STEP.DIRECT_HIT=ig.ActionStepBase.extend({directHitSettings:null,effect:null,_wm:new ig.Config({attributes:{selectType:{_type:"String",_info:"What entities to hit",
_select:n},attack:{_type:"AttackInfo",_info:"Attack Info of circle attack"},effect:{_type:"Effect",_info:"Effect to play on each burst",_optional:true},hitDir:{_type:"String",_info:"Direct Hit direction",_select:sc.DIRECT_HIT_DIR},align:{_type:"String",_info:"Alignment of force relative to entity",_select:ig.ENTITY_ALIGN},hitCount:{_type:"Number",_info:"Number of hits",_default:1},hitDelay:{_type:"Number",_info:"Delay in seconds between hits",_defualt:0.1}}}),init:function(a){this.selectType=n[a.selectType]||
n.STUN_LOCKED;this.directHitSettings=a;if(a.effect)this.effect=new ig.EffectHandle(a.effect)},clearCached:function(){this.effect&&this.effect.clearCached()},start:function(a){if(this.selectType==n.TARGET){var b=a.getTarget();if(b){var c=new sc.DirectHitForce(a,b,this.directHitSettings,this.effect);sc.combat.addCombatForce(c);this.directHitSettings.hitCount>1&&a.addActionAttached(c)}}else for(var b=a.combo.hitCombatants,d=b.length;d--;){c=b[d];if(!(this.selectType==n.STUN_LOCKED&&(!c.params||!c.params.isLockedBy(a)))){c=
new sc.DirectHitForce(a,c,this.directHitSettings,this.effect);sc.combat.addCombatForce(c);this.directHitSettings.hitCount>1&&a.addActionAttached(c)}}}});ig.ACTION_STEP.CLEAR_STUN_LOCKED=ig.ActionStepBase.extend({directHitSettings:null,effect:null,_wm:new ig.Config({attributes:{}}),init:function(){},clearCached:function(){},start:function(a){a.clearActionAttached(b)}});ig.ACTION_STEP.REGEN_HP=ig.ActionStepBase.extend({_wm:new ig.Config({attributes:{value:{_type:"Number",_info:"Relative amount of HP to regen. 1= FULL HP"},
target:{_type:"String",_info:"What entity will get the buff",_select:d,_optional:true},hideNumbers:{_type:"Boolean",_info:"if true: do not show healing numbers"}}}),init:function(a){this.value={value:a.value};this.target=d[a.target]||d.SELF;this.hideNumbers=a.hideNumbers},start:function(a){(a=this.target(a))&&a.heal(this.value,this.hideNumbers)}});ig.ACTION_STEP.HEAL_STATUS=ig.ActionStepBase.extend({_wm:new ig.Config({attributes:{}}),init:function(){},start:function(a){a.params&&a.params.healStatus()}});
ig.ACTION_STEP.CLEAR_STATUS_BAR=ig.ActionStepBase.extend({_wm:new ig.Config({attributes:{}}),init:function(){},start:function(a){a.statusGui&&a.statusGui.clearAllStatusEntries()}});ig.ACTION_STEP.SET_ENEMY_STATUS_VISIBILITY=ig.ActionStepBase.extend({_wm:new ig.Config({attributes:{hpBar:{_type:"String",_info:"If defined, set whether HP bar visible or not",_optional:true,_select:sc.ENEMY_HP_BAR},analyzable:{_type:"Boolean",_info:"If defined, set whether status in general is visible or not",_optional:true}}}),
init:function(a){this.hpBar=a.hpBar?sc.ENEMY_HP_BAR[a.hpBar]:void 0;this.analyzable=a.analyzable},start:function(a){if(this.hpBar!=void 0)a.visibility.hpBar=this.hpBar;if(this.analyzable!=void 0)a.visibility.analyzable=this.analyzable}});ig.ACTION_STEP.SET_HP_CRITICAL=ig.ActionStepBase.extend({_wm:new ig.Config({attributes:{}}),init:function(){},start:function(a){a.params.setCritical()}});var p={MAX_HP:function(a,b){return a.params.getStat("hp")*b},ATTACK:function(a,b){var c=a.params.getStat("attack",
true)/a.params.getStat("attack",false);return a.params.getStat("attack")*b*c}};ig.ACTION_STEP.REDUCE_HP=ig.ActionStepBase.extend({_wm:new ig.Config({attributes:{basedOn:{_type:"String",_info:"What hp reduction is based on",_select:p},factor:{_type:"Number",_info:"Factor to scale damage with",_default:0.1},hitNumberFactor:{_type:"Number",_info:"Will determine size of damage number",_default:0.5}}}),init:function(a){this.basedOn=p[a.basedOn]||p.MAX_HP;this.factor=a.factor||0;this.hitNumberFactor=a.hitNumberFactor||
0},start:function(a){var b=Math.round(this.basedOn(a,this.factor));b&&a.instantDamage(b,this.hitNumberFactor)}});ig.ACTION_STEP.SET_HIT_IGNORE=ig.ActionStepBase.extend({_wm:new ig.Config({attributes:{value:{_type:"Boolean",_info:"If true: ignore hits"}}}),init:function(a){this.value=a.value||false},start:function(a){a.hitIgnore=this.value}});ig.ACTION_STEP.WAIT_UNTIL_GUARDED=ig.ActionStepBase.extend({_wm:new ig.Config({attributes:{maxTime:{_type:"Number",_info:"Maximum time to wait"},meleeOnly:{_type:"Boolean",
_info:"Only continue when melee attack was guarded"}}}),init:function(a){this.maxTime=a.maxTime;this.meleeOnly=a.meleeOnly||false},start:function(a){a.stepTimer=a.stepTimer+this.maxTime},run:function(a){a=a.getCombatantRoot();if(a.isPlayer)if(ig.input.currentDevice==ig.INPUT_DEVICES.KEYBOARD_AND_MOUSE)a.gui.crosshair.getDir(a.face);else{sc.control.moveDir(r,1);Vec2.isZero(r)||Vec2.assign(a.face,r)}a.combo.guardTrapTime=a.combo.guardTrapTime+ig.system.tick;if(a.stepTimer<=0||a.combo.guardedHits>0&&
(!this.meleeOnly||a.hasBlockEntity())){a.combo.guardTrapTime=0;return true}return false}});ig.ACTION_STEP.ABSORB_BLOCKED_DAMAGE=ig.ActionStepBase.extend({_wm:new ig.Config({attributes:{factor:{_type:"Number",_info:"Factor with which to absorb blocked damage"}}}),init:function(a){this.factor=a.factor},start:function(a){var b={absolute:true,value:Math.round(a.combo.blockedDamage*this.factor)};a.heal(b)}});ig.ACTION_STEP.ABSORB_DAMAGE=ig.ActionStepBase.extend({_wm:new ig.Config({attributes:{factor:{_type:"Number",
_info:"Factor with which to absorb blocked damage"}}}),init:function(a){this.factor=a.factor},start:function(a){var b=a.getAttribute("damage");if(b){var a=a.getCombatantRoot(),c=a.params.getStat("attack",true)/a.params.getStat("attack",false),b={absolute:true,value:Math.round(b*this.factor*c)};a.heal(b)}}});ig.ACTION_STEP.ABSORB_DAMAGE_VIA_SUM=ig.ActionStepBase.extend({_wm:new ig.Config({attributes:{factor:{_type:"Number",_info:"Factor with which to absorb dealed damage. Will always take average damage of all hit combatants"},
multiEnemyScale:{_type:"Number",_info:"Add given factor to damage for each additional hit entity"}}}),init:function(a){this.factor=a.factor;this.multiEnemyScale=a.multiEnemyScale||0},start:function(a){var b=a.combo.dmgSum;if(b){var c=a.getCombatantRoot(),d=c.params.getStat("attack",true)/c.params.getStat("attack",false),b=b*d/a.combo.hitCombatants.length;this.multiEnemyScale&&(b=b*(1+this.multiEnemyScale*(a.combo.hitCombatants.length-1)));a={absolute:true,value:Math.round(b*this.factor)};c.heal(a)}}});
ig.ACTION_STEP.CONSUME_SP=ig.ActionStepBase.extend({_wm:new ig.Config({attributes:{sp:{_type:"Integer",_info:"Number of SP to consume"}}}),init:function(a){this.sp=a.sp},start:function(a){a.params.consumeSp(this.sp)}});ig.ACTION_STEP.SET_FREE_LINE_CMD=ig.ActionStepBase.extend({time:0,_wm:new ig.Config({attributes:{time:{_type:"Number",_info:"Time in seconds for free line command to preserve"}}}),init:function(a){this.time=a.time},run:function(a){sc.combat.addFreeLineCommand(a,this.time);return true}});
ig.ACTION_STEP.ADD_SHIELD=ig.ActionStepBase.extend({name:null,shield:null,actionDetached:false,perfectGuardTime:null,_wm:new ig.Config({attributes:{name:{_type:"String",_info:"Name of Shield. If used, shield will remain after action end and can be disabled separately",_optional:true},shield:{_type:"Shield",_info:"The Shield to activate"},actionDetached:{_type:"Boolean",_info:"If true, keep shield even after action is finished/interrupted."},perfectGuardTime:{_type:"Number",_info:"Amount of time for perfect guard",
_optional:true},target:{_type:"String",_info:"What entity will get the buff",_select:d,_optional:true}}}),init:function(a){this.name=a.name;var b=a.shield;this.shield=new sc.COMBAT_SHIELDS[b.type](b.settings,this.name);this.actionDetached=a.actionDetached||false;this.perfectGuardTime=a.perfectGuardTime||null;this.target=d[a.target]||d.SELF},clearCached:function(){this.shield&&this.shield.clearCached()},run:function(a){var b=this.target(a).getCombatantRoot().addShield(this.shield,this.perfectGuardTime);
this.actionDetached||a.addActionAttached(b);return true}});ig.ACTION_STEP.REMOVE_SHIELD=ig.ActionStepBase.extend({name:null,_wm:new ig.Config({attributes:{name:{_type:"String",_info:"Name of Shield to be removed"},target:{_type:"String",_info:"What entity will get the buff",_select:d,_optional:true}}}),init:function(a){this.name=a.name;this.target=d[a.target]||d.SELF},run:function(a){this.target(a).getCombatantRoot().removeNamedShield(this.name);return true}});ig.ACTION_STEP.SPAWN_ASSAULT=ig.ActionStepBase.extend({_wm:new ig.Config({attributes:{baseStrength:{_type:"Number",
_info:"Base Strength Factor. Should match damageFactor of attack"},element:{_type:"String",_info:"Element of Assault projectile",_select:sc.ELEMENT,_optional:true}}}),init:function(a){this.baseStrength=a.baseStrength||0;if(a.element)this.element=sc.ELEMENT[a.element]},run:function(a){var b=this.element===void 0?sc.combat.getElementMode(a):this.element;sc.AssaultTools.spawn(a,b,this.baseStrength);return true}});ig.ACTION_STEP.SHOW_COMBAT_MSG=ig.ActionStepBase.extend({_wm:new ig.Config({attributes:{msgType:{_type:"String",
_info:"What kind of combat message",_select:sc.COMBAT_MSG_TYPE}}}),init:function(a){this.msgType=sc.COMBAT_MSG_TYPE[a.msgType]||sc.COMBAT_MSG_TYPE.STUN_CANCEL},start:function(a){sc.combat.showCombatMessage(a,this.msgType)}});ig.ACTION_STEP.ADD_TARGET_STUN_LOCK=ig.ActionStepBase.extend({_wm:new ig.Config({attributes:{}}),init:function(){},run:function(a){var b=a.getTarget();b&&(b.params&&b.hasStun())&&b.params.startLock(a);return true}});ig.ACTION_STEP.THROW_ENERGY_DROPS=ig.ActionStepBase.extend({target:null,
dropType:null,healValue:null,_wm:new ig.Config({attributes:{dropType:{_type:"String",_info:"Type of Drop",_select:sc.DROP_TYPE},healValue:{_type:"Number",_info:"Amount that is healed. 1=full healing"},align:{_type:"String",_info:"Alignment of throw origin",_select:ig.ENTITY_ALIGN},target:{_type:"Entity",_info:"Target entity to throw drops at",_optional:true},partyToo:{_type:"Boolean",_info:"If true also spawn heal drops for all party members"}}}),init:function(a){this.dropType=a.dropType;this.healValue=
a.healValue||0.1;this.align=ig.ENTITY_ALIGN[a.align]||ig.ENTITY_ALIGN.BOTTOM;this.target=a.target;this.partyToo=a.partyToo},run:function(a){var b=null;this.target&&(b=ig.Event.getEntity(this.target));sc.DropEntity.spawnDrops(a,this.align,this.dropType,this.healValue,b);if(this.partyToo)for(b=sc.party.getPartySize();b--;){var c=sc.party.getPartyMemberEntityByIndex(b);c&&(c.model&&c.model.isAlive())&&sc.DropEntity.spawnDrops(a,this.align,this.dropType,this.healValue,c)}return true}});ig.ACTION_STEP.THROW_GENERIC_DROP=
ig.ActionStepBase.extend({target:null,dropType:null,minVal:null,maxVal:null,varIncrease:null,circleEffect:null,pickupEffect:null,_wm:new ig.Config({attributes:{dropType:{_type:"String",_info:"Type of Drop",_select:sc.DROP_TYPE},align:{_type:"String",_info:"Alignment of throw origin",_select:ig.ENTITY_ALIGN},minVal:{_type:"VarName",_info:"min number of coins to drops at a time"},maxVal:{_type:"VarName",_info:"max number of coins to drops at a time"},varIncrease:{_type:"VarName",_info:"Optional var to increase by the random number",
_optional:true},target:{_type:"Entity",_info:"Target entity to throw drops at",_optional:true},circleEffect:{_type:"EffectSelect",_info:"Circle Effect to be used when drops is picked up.",_effectName:"drops"},pickupEffect:{_type:"EffectSelect",_info:"Circle Effect to be used when drops is picked up.",_effectName:"drops"}}}),init:function(a){this.dropType=a.dropType;this.minVal=a.minVal||1;this.maxVal=a.maxVal||1;this.align=ig.ENTITY_ALIGN[a.align]||ig.ENTITY_ALIGN.BOTTOM;this.target=a.target;this.varIncrease=
a.varIncrease;this.circleEffect=a.circleEffect;this.pickupEffect=a.pickupEffect},run:function(a){var b=null;this.target&&(b=ig.Event.getEntity(this.target));var c={align:this.align,type:this.dropType,min:ig.vars.get(this.minVal)||1,max:ig.vars.get(this.minVal)||1,varIncrease:this.varIncrease,circleEffect:this.circleEffect,pickupEffect:this.pickupEffect};sc.DropEntity.spawnGenericDrops(a,b,c);return true}});ig.ACTION_STEP.NAVIGATE_TO_SPAWN_POINT=ig.ActionStepBase.extend({maxTime:0,maxDistance:0,precise:false,
_wm:new ig.Config({attributes:{maxTime:{_type:"Number",_info:"Maxium time spent on navigation"},maxDistance:{_type:"Number",_info:"The maximum amount of distance to the target"},precise:{_type:"Boolean",_info:"Reach the target precisely, slowing down accordingly"}}}),init:function(a){this.maxTime=a.maxTime;this.maxDistance=a.maxDistance||0;this.precise=a.precise||false},start:function(a){a.stepTimer=a.stepTimer+this.maxTime;var b=a.spawnPoint;if(b){var c=ig.navigation.getNavPath(a);c.toPoint(b,this.maxDistance,
this.precise);a.stepData.path=c}else a.stepData.path=null},run:function(a){if(!a.stepData.path)return true;if(this.maxTime&&a.stepTimer<=0&&!a.jumping){a.stepData.path.interrupt();return true}return a.stepData.path.moveEntity()}});var r=Vec2.create(),t={FACE_REVERSE:1,FACE:2};ig.ACTION_STEP.DO_DAMAGE_MOVEMENT=ig.ActionStepBase.extend({flyLevel:null,breaking:false,stable:false,wait:false,_wm:new ig.Config({attributes:{flyLevel:{_type:"String",_info:"How far entity will fly",_select:sc.COMBAT_FLY_LEVEL},
breaking:{_type:"Boolean",_info:"True if movement is for breaking hit."},stable:{_type:"Boolean",_info:"True if movement is for stable hit."},wait:{_type:"Boolean",_info:"True if step should wait the matching stun time."},direction:{_type:"String",_info:"What face direction? (Reverse Face is default)",_optional:true,_select:t}}}),init:function(a){this.flyLevel=a.flyLevel;this.breaking=a.breaking||false;this.stable=a.stable||false;this.wait=a.wait||false;this.direction=t[a.direction]||t.FACE_REVERSE},
start:function(a){Vec2.assign(r,a.face);this.direction==t.FACE_REVERSE&&Vec2.flip(r);var b=a.doDamageMovement(r,this.flyLevel,this.breaking,false,0,true);if(this.wait)a.stepTimer=a.stepTimer+b},run:function(a){return!this.wait||a.stepTimer<=0}});ig.ACTION_STEP.COMBAT_IF=ig.ActionStepBase.extend({conditions:null,withElse:false,branches:{},_wm:new ig.Config({attributes:{conditions:{_type:"CombatConditions",_info:"Combat conditions for if statement"},withElse:{_type:"Boolean",_info:"With else case.",
_noLabel:true}},branchLabel:function(a){switch(a){case "thenStep":return null;case "elseStep":return"else";case "_end":return"endif"}return"???"}}),init:function(a){this.conditions=new sc.CombatConditions(a.conditions);this.withElse=a.withElse},getBranchNames:function(){return this.withElse?["thenStep","elseStep"]:["thenStep"]},getNext:function(a){var b=Math.random();return this.conditions.check(a,b)?this.branches.thenStep?this.branches.thenStep:this._nextStep:this.branches.elseStep?this.branches.elseStep:
this._nextStep}});var q={set:function(a,b){return b},add:function(a,b){return a+b},sub:function(a,b){return a-b},mul:function(a,b){return a*b},div:function(a,b){return a/b},mod:function(a,b){return a%b}};ig.ACTION_STEP.CHANGE_COLLAB_VAR=ig.ActionStepBase.extend({varName:null,changeOperator:null,value:0,_wm:new ig.Config({attributes:{varName:{_type:"String",_info:"Name of Var"},changeType:{_type:"String",_info:"Type of modification",_select:q},value:{_type:"NumberExpression",_info:"Value to modify with"}}}),
init:function(a){this.varName=a.varName;this.changeOperator=q[a.changeType]||q.set;this.value=a.value||0},run:function(a){if(a=a.getCombatantRoot().collaboration){var b=a.getVar(this.varName),c=ig.Event.getExpressionValue(this.value),b=this.changeOperator(b,c*1);a.setVar(this.varName,b);return true}}});ig.ACTION_STEP.SET_COLLAB_BREAK_TYPE=ig.ActionStepBase.extend({_wm:new ig.Config({attributes:{breakType:{_type:"String",_info:"Who needs to be interrupted to cancel collaboration",_select:sc.ENEMY_COLLAB_BREAK}}}),
init:function(a){this.breakType=sc.ENEMY_COLLAB_BREAK[a.breakType]},start:function(a){if(a.collaboration)a.collaboration.breakType=this.breakType}});var s={TARGET_CIRCLE:function(a,b,c,d,e,f){for(var g=c[0].coll.size,c=c.length,h=-f/2,f=f/(f==1?c:c-1);c--;){var i=Vec3.create();ig.navigation.getClosePosition(i,d,g,b,null,e,0.25,h,ig.NAV_CLOSE_POINT_SEARCH.FRONT,false);h=h+f;a.push(i)}},WHALE_TOP:function(a,b,c,d,e){d=Vec3.create();b.getAlignedPos(ig.ENTITY_ALIGN.BOTTOM,d);d.x=d.x+(b.face.x<0?-1:1)*
e;for(b=c.length;b--;)a.push(d)}},v={SELF:function(a){return a},TARGET:function(a){return a.getTarget()},COLLAB_ENTITY:function(a,b){return a.collaboration?a.collaboration.getLabeledParticipant(b):null}};ig.ACTION_STEP.ASSIGN_COLLAB_POINTS=ig.ActionStepBase.extend({_wm:new ig.Config({attributes:{targetType:{_type:"String",_info:"Target from which points will be set relatively",_select:v},targetLabel:{_type:"String",_info:"Additional target label. (only required for COLLAB_ENTITY type)"},labelFilter:{_type:"Array",
_info:"List of labels to filter collaborators",_sub:{_type:"String"},_optional:true},pointPattern:{_type:"String",_info:"Pattern of points",_select:s},distance:{_type:"Number",_info:"Distance value used to determine points",_default:64},circularAngle:{_type:"Number",_info:"Circular angle used to determine points"}}}),init:function(a){this.targetType=v[a.targetType]||v.TARGET;this.targetLabel=a.targetLabel;this.labelFilter=a.labelFilter||null;this.pointPattern=s[a.pointPattern]||s.TARGET_CIRCLE;this.distance=
a.distance||0;this.circularAngle=a.circularAngle||0},start:function(a){var b=a.collaboration,c=this.targetType(a,this.targetLabel);if(b&&c){a=b.getLabeledParticipants(this.labelFilter);if(a.length){var d=[],b=b.getCenterPos(j,ig.ENTITY_ALIGN.BOTTOM,this.labelFilter);this.pointPattern(d,c,a,b,this.distance,this.circularAngle);for(b=a.length;b--;){for(var c=a[b],e=c.getCenter(i),f=d.length,g=-1,h=-1;f--;){var k=Vec2.distance(d[f],e);if(g==-1||k<g){g=k;h=f}}c.collabAttribs.point=d[h];d.splice(h,1)}}}}});
ig.ACTOR_ATTRIB_CONNECTION.PROXY_OWNER=function(a){return a.getCombatantRoot&&a.getCombatantRoot()};ig.ACTOR_ATTRIB_CONNECTION.PROXY_SOURCE=function(a){return a.sourceEntity};ig.ACTOR_ATTRIB_CONNECTION.TARGET=function(a){return a.getTarget()};var y={ENTITY_NAME:function(a){return a.name}};ig.ACTION_STEP.SET_ATTRIB_TARGET_VALUE=ig.ActionStepBase.extend({_wm:new ig.Config({attributes:{attribName:{_type:"String",_info:"Name of Var"},valueType:{_type:"String",_info:"Kind of value to extract from target",
_select:y}}}),init:function(a){this.attribName=a.attribName;this.valueType=y[a.ENTITY_NAME]||y.ENTITY_NAME},start:function(a){var b=a.getTarget();b&&a.setAttribute(this.attribName,this.valueType(b))}});ig.ACTION_STEP.SET_COLLAB_ENTITY=ig.ActionStepBase.extend({entityType:null,entityLabel:null,labelFilter:null,_wm:new ig.Config({attributes:{entityType:{_type:"String",_info:"What kind of entity is set",_select:v},entityLabel:{_type:"String",_info:"Additional entity label. (only required for COLLAB_ENTITY type)"},
labelFilter:{_type:"CollabLabelFilter",_info:"Labels to filter which entities in collaboration will have entity assigned",_optional:true}}}),init:function(a){this.entityType=v[a.varName]||v.SELF;this.entityLabel=a.entityLabel;this.labelFilter=a.labelFilter},start:function(a){if(a.collaboration){var b=this.entityType(a,this.entityLabel);a.collaboration.setParticipantsEntity(b,this.labelFilter)}}});ig.ACTION_STEP.STORE_IN_COLLAB_PARTNER=ig.ActionStepBase.extend({label:null,_wm:new ig.Config({attributes:{label:{_type:"String",
_info:"Label of collab partner"}}}),init:function(a){this.label=a.label},start:function(a){if(a.collaboration){a.collaboration.getLabeledParticipant(this.label).storeEnemy(a);a.setTarget(null);a.hide()}}});ig.ACTION_STEP.CONNECT_HP_TO_STORED_ENEMIES=ig.ActionStepBase.extend({_wm:new ig.Config({attributes:{}}),init:function(){},start:function(a){a.connectHpToEnemies(a.storedEnemies)}});ig.ACTION_STEP.CONNECT_HP_TO_TYPES_ENEMIES=ig.EventStepBase.extend({target:0,_wm:new ig.Config({attributes:{enemyType:{_type:"String",
_info:"Type of enemy",_select:"enemies"}}}),init:function(a){this.enemyType=a.enemyType},start:function(a){for(var b=ig.game.shownEntities,c=b.length,d=[];c--;){var e=b[c];e instanceof ig.ENTITY.Enemy&&e.enemyName==this.enemyType&&d.push(e)}a.connectHpToEnemies(d)}});ig.ACTION_STEP.UPDATE_RESPAWN_POINT=ig.ActionStepBase.extend({_wm:new ig.Config({attributes:{}}),init:function(){},start:function(a){Vec3.assign(a.respawn.pos,a.coll.pos)}});ig.ACTION_STEP.SEND_ENEMY_MSG=ig.ActionStepBase.extend({_wm:new ig.Config({attributes:{key:{_type:"String",
_info:"Key of Enemy Message that other enemies may react to via ENEMY_EVENT"}}}),init:function(a){this.key=a.key},run:function(a){sc.combat.sendEnemyMessage(a,this.key);return true}});ig.ACTION_STEP.RESET_TRACKER=ig.ActionStepBase.extend({tracker:null,forceValue:void 0,_wm:new ig.Config({attributes:{tracker:{_type:"TrackerRef",_info:"Tracker to reset"},forceValue:{_type:"Number",_info:"Force reset tracker to a certain percentage of target (0-1)",_optional:true}}}),init:function(a){this.tracker=a.tracker;
this.forceValue=a.forceValue},start:function(a){var b=a.trackers[this.tracker];b&&b.reset(a,this.forceValue)}});ig.ACTION_STEP.RESET_FREQUENCY=ig.ActionStepBase.extend({tracker:null,forceValue:void 0,_wm:new ig.Config({attributes:{frequency:{_type:"String",_info:"Frequency to reset (as if the enemy would have executed an attack of that frequency)",_select:sc.ATTACK_FREQUENCY}}}),init:function(a){this.frequency=a.frequency},start:function(a){sc.combat.submitFrequency(a,this.frequency,true)}});ig.ACTION_STEP.RELEASE_STORED_ENEMIES=
ig.ActionStepBase.extend({align:null,distance:0,centralAngle:0,startAngle:0,actionName:null,uniformRandom:0,_wm:new ig.Config({attributes:{align:{_type:"String",_info:"Aligned pos from where to start entity",_select:ig.ENTITY_ALIGN},distance:{_type:"Number",_info:"Distance towards storing entity when spawned"},centralAngle:{_type:"Number",_info:"Central angle of range. 1 = full circle"},startAngle:{_type:"Number",_info:"Angle from which to start. Default is - centralAngle / 2",_optional:true},uniformRandom:{_type:"Number",
_info:"Additional randomness around original direction"}}}),init:function(a){this.align=ig.ENTITY_ALIGN[a.align]||ig.ENTITY_ALIGN.BOTTOM;this.distance=a.distance||0;this.centralAngle=a.centralAngle;this.startAngle=a.startAngle;if(this.startAngle==void 0)this.startAngle=-this.centralAngle/2;this.uniformRandom=a.uniformRandom},start:function(a){var b=a.storedEnemies,d=b.length,e=d;Vec2.assign(r,a.face);Vec2.rotate(r,this.startAngle*Math.PI*2);var d=this.centralAngle/(this.centralAngle==1?d:d-1)*Math.PI*
2,f=a.getAlignedPos(this.align,c);for(this.distance&&Vec2.length(r,this.distance);e--;){var g=b[e],h=(Math.random()-0.5)*this.uniformRandom*d;h&&Vec2.rotate(r,h);Vec2.assign(g.face,r);Vec3.assign(j,f);this.distance&&Vec2.add(j,r);g.setPos(j.x-g.coll.size.x/2,j.y-g.coll.size.y/2,j.z);g.setTarget(a.target);g.onStoredRelease();h&&Vec2.rotate(r,-h);Vec2.rotate(r,d)}b.length=0}});ig.ACTION_STEP.REASSIGN_TARGET=ig.ActionStepBase.extend({_wm:new ig.Config({attributes:{}}),init:function(){},start:function(a){a.enemyType&&
a.enemyType.reselectTarget(a,false,true)}});ig.ACTION_STEP.DESTROY_DESTRUCTIBLES=ig.ActionStepBase.extend({_wm:new ig.Config({attributes:{}}),init:function(){},start:function(){for(var a=ig.game.getEntitiesByType("Destructible"),b=a.length;b--;)a[b].startDestruction()}});ig.ACTION_STEP.SPAWN_ENEMIES=ig.ActionStepBase.extend({forceSettings:null,enemyInfo:null,enemyType:null,_wm:new ig.Config({attributes:{enemyInfo:{_type:"EnemyType",_info:"Enemy information",_popup:true},offset:{_type:"Offset",_info:"Offset relative to entity ground center from which to shoot"},
align:{_type:"String",_info:"Alignment relative to entity from which to shoot",_select:ig.ENTITY_ALIGN},dir:{_type:"Vec2",_info:"Direction to go to",_actorOption:true,_optional:true},pushVel:{_type:"NumberVary",_info:"If defined: push away enemies with given velocity",_optional:true},pushZVel:{_type:"NumberVary",_info:"If defined: push away enemies with given z velocity",_optional:true},centralAngle:{_type:"Number",_info:"Central angle of range. 1 = full circle"},startAngle:{_type:"Number",_info:"Angle from which to start. Default is - centralAngle / 2",
_optional:true},angleVary:{_type:"Number",_info:"Randomly vary each angle with the provided range"},startDist:{_type:"Number",_info:"Start Distance of ball in throw direction",_optional:true},startDistCollide:{_type:"String",_info:"If not NONE: consider environment collision before adding start dist. CLOSER = move closer, DROP = Don't spawn if colliding",_select:sc.SPAWN_START_DIST_COLLIDE},random:{_type:"Boolean",_info:"Spawn each Proxy in random direction within range"},count:{_type:"NumberExpression",
_info:"The number of proxies thrown"},duration:{_type:"Number",_info:"Time it takes to throw proxies"},clockwise:{_type:"Boolean",_info:"If true throw proxies clockwise, otherwise counter clockwise"},flipLeftFace:{_type:"Integer",_info:"If FACE COUNT is provided: swap clockWise if face direction is towards left"},offsetArea:{_type:"Vec2",_info:"offset Area around position to randomly spawn entity at",_optional:true},circularArea:{_type:"Boolean",_info:"Make offsetArea circular, not rectangular"},
uniformDir:{_type:"Number",_info:"To what extend the final dir should be uniform. 1=all the same dir, 0= all individual, 0.5=between the two"},delay:{_type:"Number",_info:"Time delay for first shot"},repeat:{_type:"Boolean",_info:"If true, repeat proxy spawning until ended by force (action end or call STOP_REPEATING_FORCE)"},attachProxy:{_type:"ProxyRef",_info:"If defined: attach proxy to enemies",_optional:true}}}),init:function(a){this.forceSettings=ig.copy(a);if(a.enemyInfo)this.enemyInfo=new sc.EnemyInfo(a.enemyInfo);
this.forceSettings.enemyType=this.enemyInfo.enemyType;a.attachProxy&&(this.forceSettings.proxySrc=sc.ProxyTools.prepareSrc(a.attachProxy))},clearCached:function(){this.enemyInfo&&this.enemyInfo.clearCached();this.forceSettings.proxySrc&&sc.ProxyTools.releaseSrc(this.forceSettings.proxySrc)},start:function(a){var b=new sc.EnemySpawnerForce(a,this.forceSettings);sc.combat.addCombatForce(b);a.addActionAttached(b)}});ig.ACTION_STEP.SPAWN_ENEMY_CLOSEBY=ig.ActionStepBase.extend({forceSettings:null,enemyInfo:null,
enemyType:null,_wm:new ig.Config({attributes:{enemyInfo:{_type:"EnemyType",_info:"Enemy information",_popup:true},radius:{_type:"Number",_info:"Radius from position"},spawnCondition:{_type:"VarCondition",_info:"Condition for Enemy to spawn and despawn",_popup:true,_optional:true}}}),init:function(a){if(a.enemyInfo)this.enemyInfo=new sc.EnemyInfo(a.enemyInfo);this.radius=a.radius||0;this.spawnCondition=a.spawnCondition||null},clearCached:function(){this.enemyInfo&&this.enemyInfo.clearCached()},start:function(a){var b=
Vec3.create();ig.navigation.getClosePosition(b,a.getAlignedPos(ig.ENTITY_ALIGN.BOTTOM,c),this.enemyInfo.enemyType.size,a,null,this.radius,1,0,ig.NAV_CLOSE_POINT_SEARCH.BEHIND_FACE,false);ig.game.spawnEntity(ig.ENTITY.Enemy,b.x-this.enemyInfo.enemyType.size.x/2,b.y-this.enemyInfo.enemyType.size.y/2,b.z,{enemyInfo:this.enemyInfo.getSettings(),ownerEnemy:a.getCombatantRoot(),spawnCondition:this.spawnCondition},true)}});ig.ACTION_STEP.KILL_ENEMIES=ig.ActionStepBase.extend({enemyType:null,noRumble:false,
_wm:new ig.Config({attributes:{enemyType:{_type:"String",_info:"If provided: only remove enemy of this type",_optional:true,_select:"enemies"},noRumble:{_type:"Boolean",_info:"If true, do not rumble screen on enemy kill",_optional:true,_default:"true"}}}),init:function(a){this.enemyType=a.enemyType;this.noRumble=a.noRumble},start:function(){sc.combat.removeEnemies(this.enemyType,null,this.noRumble,true)}});ig.ACTION_STEP.SELF_DESTRUCT=ig.ActionStepBase.extend({entity:null,_wm:new ig.Config({attributes:{noReward:{_type:"Boolean",
_info:"No exp, credit, items etc."}}}),init:function(a){this.noRewards=a.noReward||false},start:function(a){a.selfDestruct(this.noRewards)}});var u={PLAYER:function(){return ig.game.playerEntity},PARTY_0:function(){return sc.party.getPartyMemberEntityByIndex(0,true)},PARTY_1:function(){return sc.party.getPartyMemberEntityByIndex(1,true)},COLLAB_ENTITY:function(a){return a.collabAttribs&&a.collabAttribs.entity},COLLAB_LABELED_ENTITY:function(a,b){return a.collaboration?a.collaboration.getLabeledParticipant(b):
null},CLOSEST_ENEMY:function(a){for(var b=a.getAlignedPos(ig.ENTITY_ALIGN.BOTTOM,j),c=Math.PI*0.5,b=ig.game.getEntitiesInCircle(b,ig.system.width/2,1,32,a.face,-c/2,c/2,a),c=null,d=0,e=b.length;e--;){var f=b[e];if(f instanceof ig.ENTITY.Combatant&&f.party!=a.party){var g=ig.CollTools.getDistVec2(a.coll,f.coll,r),h=Vec2.angle(a.face,g),g=Vec2.length(g)+h*1E3;if(!c||g<d){c=f;d=g}}}return c},GUARDED_ATTACKER:function(a){a=a.combo.guardedEntity;return!a||a.isBall?null:a.getCombatant()},FIRST_HIT:function(a){return a.combo.hitCombatants[0]},
PROXY_OWNER:function(a){return a.getCombatantRoot()},ENEMY_OWNER:function(a){return a.getCombatantRoot().ownerEnemy},ENEMY_OWNER_ACTION_PROXY:function(b,c){if(!b.getCombatantRoot().ownerEnemy)return null;var d=b.getCombatantRoot().ownerEnemy.actionAttached;return a(d,c)},PROXY_SRC:function(a){return a.sourceEntity},ACTION_PROXY:function(b,c){return a(b.actionAttached,c)},PROXY:function(b,c){return a(b.entityAttached,c)},PROXY_OWNER_ACTION_PROXY:function(b,c){var d=b.getCombatantRoot().actionAttached;
return a(d,c)},PROXY_SRC_ACTION_PROXY:function(b,c){return a(b.sourceEntity.actionAttached,c)},NAMED_ENTITY:function(a,b){return ig.game.namedEntities[b]},ATTRIB_ENTITY:function(a,b){return ig.Event.getEntity(a.getAttribute(b))},THREAT:function(a){return a.threat},ENTITY_VIA_ID:function(a,b){return ig.game.entities[b]},PART_TARGET_ROOT:function(a){a=a.getTarget();return a instanceof sc.CombatantAnimPartEntity?a.getCombatantRoot():a}};ig.ACTION_STEP.SET_TEMP_TARGET=ig.ActionStepBase.extend({_wm:new ig.Config({attributes:{kind:{_type:"String",
_info:"Kind of temp target",_select:u},key:{_type:"StringExpression",_info:"Additional String key to fetch named entities etc.",_optional:true}}}),init:function(a){this.kind=u[a.kind]||u.PLAYER;this.key=a.key},start:function(a){var b=ig.Event.getExpressionValue(this.key),b=this.kind(a,b);if(a instanceof sc.BasicCombatant)a.tmpTarget=b}});ig.ACTION_STEP.SET_ATTRIB_TARGET_ENTITY=ig.ActionStepBase.extend({_wm:new ig.Config({attributes:{attrib:{_type:"String",_info:"Attrib name to store target entity in (will use temp target if defined)"}}}),
init:function(a){this.attrib=a.attrib||null},start:function(a){var b=a.getTarget();a.setAttribute(this.attrib,b)}});var z={IN_VIEW:{angle:0.25,radius:350,facePriority:true},CLOSE_RANGE:{angle:1,radius:200},MEDIUM_RANGE:{angle:1,radius:400},LONG_RANGE:{angle:1,radius:600},SCREEN_RANGE:{angle:1,radius:1200}},D={NONE:0,PREFER_NON_HIT:1,ONLY_NON_HIT:2};ig.ACTION_STEP.SET_CLOSE_TEMP_TARGET=ig.ActionStepBase.extend({_wm:new ig.Config({attributes:{searchType:{_type:"String",_info:"How to search close target",
_select:z},distance:{_type:"Number",_info:"If defined: look for entities up to this distance. Otherwise use default",_optional:true},ignoreCurrentTarget:{_type:"Boolean",_info:"If true: ignore current target (will select temp target if available)"},prevHitBehavior:{_type:"String",_info:"How to handle enemies that have been previously hit",_select:D}}}),init:function(a){this.searchType=z[a.searchType]||z.IN_VIEW;this.distance=a.distance||0;this.ignoreCurrentTarget=a.ignoreCurrentTarget||false;this.prevHitBehavior=
D[a.prevHitBehavior]||D.NONE},start:function(a){for(var b=a.getTarget(),c=a.getAlignedPos(ig.ENTITY_ALIGN.BOTTOM,j),d=this.searchType.angle*Math.PI*2,c=ig.game.getEntitiesInCircle(c,this.distance||this.searchType.radius,1,32,a.face,-d/2,d/2,a),d=null,e=0,f=c.length;f--;){var g=c[f];if(!(this.ignoreCurrentTarget&&g==b)){if(g instanceof sc.CombatantAnimPartEntity)g=g.owner;if(g instanceof ig.ENTITY.Combatant&&g.party!=a.party&&(g.party!=sc.COMBATANT_PARTY.ENEMY||g.target)){var h=ig.CollTools.getDistVec2(a.coll,
g.coll,r),i=Vec2.length(h);if(this.searchType.facePriority){h=Vec2.angle(a.face,h);i=i+h*1E3}if(a.combo.hitCombatants.indexOf(g)!=-1)if(this.prevHitBehavior==D.PREFER_NON_HIT)i=i+1E4;else if(this.prevHitBehavior==D.ONLY_NON_HIT)continue;if(!d||i<e){d=g;e=i}}}}a.tmpTarget=d}});ig.ACTION_STEP.SET_OWNER_REPLACE_TARGET=ig.ActionStepBase.extend({_wm:new ig.Config({attributes:{}}),init:function(){},start:function(a){var b=a.getCombatantRoot();b!=a&&b.setReplaceTarget&&b.setReplaceTarget(a)}});ig.ACTION_STEP.SET_TARGET_REPLACE_TARGET=
ig.ActionStepBase.extend({_wm:new ig.Config({attributes:{}}),init:function(){},start:function(a){var b=a.getTarget();b!=a&&b.setReplaceTarget&&b.setReplaceTarget(a)}});ig.ACTION_STEP.SET_POI_TEMP_TARGET=ig.ActionStepBase.extend({_wm:new ig.Config({attributes:{poiFilter:{_type:"PoiFilter",_info:"Kind of POI searched. If not defined, use last searched PoI from Combat Condition",_optional:true},distance:{_type:"Number",_info:"Maximum distance to POI. Only used if poiFilter is defined."},furthest:{_type:"Boolean",
_info:"If true: select POI that is furthest away"}}}),init:function(a){this.poiFilter=sc.CombatPoI.initPoiFilter(a.poiFilter);this.distance=a.distance;this.furthest=a.furthest||false},start:function(a){var b;b=this.poiFilter?sc.CombatPoI.getClosestPoI(this.poiFilter,a,this.distance,false,this.furthest):a.lastPoICheck;a.tmpTarget=b}});sc.PROXY_SELECT_TYPE={PREV_ACTION_PROXY:function(a,b,c){b=b.actionAttached;a=b.indexOf(a);if(a==-1)return null;for(;a--;)if(b[a]instanceof sc.CombatProxyEntity&&(!c||
c==b[a]))return b[a];return null},NEXT_ACTION_PROXY:function(a,b,c){b=b.actionAttached;a=b.indexOf(a);if(a==-1)return null;for(;++a<b.length;)if(b[a]instanceof sc.CombatProxyEntity&&(!c||c==b[a]))return b[a];return null},PROXY_SOURCE:function(a){return a.sourceEntity}};ig.ACTION_STEP.SET_PROXY_TEMP_TARGET=ig.ActionStepBase.extend({_wm:new ig.Config({attributes:{selectType:{_type:"String",_info:"What kind of proxy to select",_select:sc.PROXY_SELECT_TYPE},group:{_type:"String",_info:"Optional group filter for proxy",
_optional:true}}}),init:function(a){this.selectType=sc.PROXY_SELECT_TYPE[a.selectType];this.group=a.group},start:function(a){var b=this.selectType(a,a.getSourceEntity(),this.group);a.tmpTarget=b}});ig.ACTION_STEP.REDUCE_PROXY_HP=ig.ActionStepBase.extend({_wm:new ig.Config({attributes:{damage:{_type:"Number",_info:"Number of HP to reduce"}}}),init:function(a){this.damage=a.damage||1},start:function(a){a.reduceHp&&a.reduceHp(this.damage)}});ig.ACTION_STEP.CLEAR_TEMP_TARGET=ig.ActionStepBase.extend({_wm:new ig.Config({attributes:{}}),
init:function(){},start:function(a){a.tmpTarget=null}});ig.ACTION_STEP.CLEAR_PREV_HIT=ig.ActionStepBase.extend({_wm:new ig.Config({attributes:{}}),init:function(){},start:function(a){a.combo.hitCombatants.length=0}});ig.ACTION_STEP.CLEAR_TARGET=ig.ActionStepBase.extend({_wm:new ig.Config({attributes:{}}),init:function(){},start:function(a){a.setTarget(null)}});ig.ACTION_STEP.DETOUR_COMPRESSOR_THREAT=ig.ActionStepBase.extend({_wm:new ig.Config({attributes:{}}),init:function(){},start:function(a){var b=
a.threat;if(b&&b instanceof sc.CompressedBaseEntity){var c=b.coll,b=Vec2.length(b.coll.vel);if(Math.abs(c.vel.x)>Math.abs(c.vel.y)){c.vel.y=c.pos.y+c.size.y/2>a.coll.pos.y+a.coll.size.y/2?0.5:-0.5;a.setAttribute("compressorDetourNorth",c.vel.y>0);c.vel.x=c.vel.x>0?1:-1}else{var d=ig.game.playerEntity.coll;c.vel.x=c.pos.x+c.size.x/2>d.pos.x+d.size.x/2?1:-1;c.vel.y=c.vel.y>0?0.6:-0.6;a.setAttribute("compressorDetourNorth",c.vel.y>0)}Vec2.length(c.vel,b)}}});ig.ACTION_STEP.ADD_ACTION_BUFF=ig.ActionStepBase.extend({_wm:new ig.Config({attributes:{target:{_type:"String",
_info:"What entity will get the buff",_select:d},stats:{_type:"Array",_info:"Stats to be applied.",_sub:{_type:"String",_select:sc.STAT_CHANGE_SETTINGS}},name:{_type:"String",_info:"Name that can be used to find/modify buff",_optional:true},hacked:{_type:"Boolean",_info:"If true: buff is hacked and should be ignored for certain calculations",_optional:true}}}),init:function(a){this.target=d[a.target]||d.SELF;this.stats=a.stats;this.name=a.name||null;this.hacked=a.hacked||false},start:function(a){var b=
this.target(a);if(b&&b.params){var c=new sc.ActionBuff(this.stats,this.name,this.hacked);b.params.addBuff(c);a.addActionAttached(c)}}});var C={set:function(a,b){return b},mul:function(a,b){return a*b}};ig.ACTION_STEP.MOD_ACTION_BUFF_PARAM=ig.ActionStepBase.extend({_wm:new ig.Config({attributes:{target:{_type:"String",_info:"What entity will get the buff",_select:d},name:{_type:"String",_info:"Name used to search for buff of target entity"},param:{_type:"String",_info:"What param to modify",_select:["hp",
"attack","defense","focus"]},changeType:{_type:"String",_info:"Type of modification",_select:C},value:{_type:"Number",_info:"By what value param is modified"}}}),init:function(a){this.target=d[a.target]||d.SELF;this.name=a.name||null;this.param=a.param;this.value=a.value||0;this.changeType=C[a.changeType]||C.set},start:function(a){if((a=this.target(a))&&a.params)for(var b=a.params.buffs,c=b.length;c--;){var d=b[c];if(d instanceof sc.ActionBuff&&d.name==this.name){var e=this.changeType(d.params[this.param],
this.value);a.params.modifyBuff(d,this.param,e)}}}});var A={RELATIVE_HP:{},CURRENT_HP:{},MAX_HP:{stat:"hp"},ATTACK:{stat:"attack"},DEFENSE:{stat:"defense"},FOCUS:{stat:"focus"}};ig.ACTION_STEP.SET_VAR_COMBAT_STAT=ig.ActionStepBase.extend({varName:null,stat:null,_wm:new ig.Config({attributes:{varName:{_type:"VarName",_info:"Variable to store relative hp in"},stat:{_type:"String",_info:"Type of Stat",_select:A}}}),init:function(a){this.varName=a.varName;this.stat=A[a.stat]||A.RELATIVE_HP},start:function(a){var b=
ig.Event.getVarName(this.varName);if(b){if(a&&a.isCombatant){var c;if(this.stat.stat)c=a.params.getStat(this.stat.stat);else if(this.stat==A.RELATIVE_HP)c=a.params.getHpFactor();else if(this.stat==A.CURRENT_HP)c=a.params.currentHp;ig.vars.set(b,c)}}else ig.log("SET_VAR_TIME: Variable Name is not a String!")}});var B={RECENT_HIT_CENTER:function(a,b){Vec3.assignC(b,0,0,0);for(var c,d,e,f,g=0,h=a.combo.hitCombatants,i=h.length;i--;){var k=h[i].getAlignedPos(ig.ENTITY_ALIGN.BOTTOM,j),g=g+k.z/h.length;
if(c===void 0){c=d=k.x;e=f=k.y}else{c=Math.min(c,k.x);d=Math.max(d,k.x);e=Math.min(e,k.y);f=Math.max(f,k.y)}}b.z=g;b.x=(c+d)/2;b.y=(e+f)/2}};ig.ACTION_STEP.SET_ATTRIB_POS_COMBAT=ig.ActionStepBase.extend({_wm:new ig.Config({attributes:{attrib:{_type:"String",_info:"Name of attribute to store position"},posType:{_type:"String",_info:"How to determine position",_select:B}}}),init:function(a){this.attrib=a.attrib;this.posType=B[a.posType]},start:function(a){var b=Vec3.create();this.posType(a,b);a.setAttribute(this.attrib,
b)}})});ig.baked=!0;
ig.module("game.feature.combat.combat-event-steps").requires("impact.base.animation","impact.base.action","impact.base.entity","game.feature.combat.entities.drop","game.feature.combat.entities.combatant","game.feature.combat.entities.combat-proxy","impact.feature.effect.effect-steps").defines(function(){ig.FX_FIRST_TARGET_OPTION.PROXY_OWNER=function(a){return a.combatant};ig.FX_FIRST_TARGET_OPTION.PROXY_SRC=function(a){return a.sourceEntity};ig.FX_FIRST_TARGET_OPTION.OWNER_ENEMY=function(a){return a.ownerEnemy};
ig.FX_SECOND_TARGET_OPTION.PROXY_OWNER=function(a,b){a.target2=b.combatant};ig.FX_SECOND_TARGET_OPTION.PROXY_SRC=function(a,b){a.target2=b.sourceEntity};ig.FX_SECOND_TARGET_OPTION.OWNER_ENEMY=function(a,b){a.target2=b.ownerEnemy};var b=Vec3.create();ig.EVENT_STEP.SPAWN_ENEMY=ig.EventStepBase.extend({position:null,enemyInfo:null,enemyType:null,targetPlayer:false,name:null,noEffects:false,_wm:new ig.Config({attributes:{position:{_type:"Vec3",_info:"Point to navigate to",_visualize:true,_pointSelect:true},
enemyInfo:{_type:"EnemyType",_info:"Enemy information",_popup:true},targetPlayer:{_type:"Boolean",_info:"If true, automatically target player"},name:{_type:"StringExpression",_info:"Name of the enemy to access via action",_optional:true},spawnCondition:{_type:"VarCondition",_info:"Condition for Enemy to spawn and despawn",_popup:true,_optional:true},startAction:{_type:"Action",_info:"Action that is immediately performed on enemy",_rec_visualize:ig.ACTION_STEP,_optional:true,_popup:true},noEffects:{_type:"Boolean",
_info:"If true: Do not show appear effect."}}}),init:function(a){this.position=a.position;if(a.enemyInfo)this.enemyInfo=new sc.EnemyInfo(a.enemyInfo);this.targetPlayer=a.targetPlayer||false;this.name=a.name||null;this.spawnCondition=a.spawnCondition||null;this.noEffects=a.noEffects||false;if(a.startAction)this.startAction=new ig.Action("[GENERIC]",a.startAction,false)},clearCached:function(){this.enemyInfo&&this.enemyInfo.clearCached();this.startAction&&this.startAction.clearCached()},start:function(){var a=
ig.Event.getVec3(this.position,b),a=ig.game.spawnEntity(ig.ENTITY.Enemy,a.x-this.enemyInfo.enemyType.size.x/2,a.y-this.enemyInfo.enemyType.size.y/2,a.z,{enemyInfo:this.enemyInfo.getSettings(),name:ig.Event.getExpressionValue(this.name),spawnCondition:this.spawnCondition},!this.noEffects);this.targetPlayer&&a.setTarget(ig.game.playerEntity,true);this.startAction&&a.setAction(this.startAction)}});ig.EVENT_STEP.SPAWN_DESTRUCTIBLE=ig.EventStepBase.extend({_wm:new ig.Config({attributes:{position:{_type:"Vec3",
_info:"spawn point",_visualize:true,_pointSelect:true},desType:{_type:"String",_info:"Type of destructible object",_select:sc.DESTRUCTIBLE_TYPE,_withNull:true},onDestructIncrease:{_type:"VarName",_info:"Variable to increase by one when destroyed",_optional:true},onPreDestructIncrease:{_type:"VarName",_info:"Variable to increase by one when destroyed",_optional:true},effect:{_type:"Effect",_info:"Optional Effect",_optional:true,_popup:true}}}),init:function(a){this.position=a.position;this.desType=
a.desType;this.onDestructIncrease=a.onDestructIncrease;this.onPreDestructIncrease=a.onPreDestructIncrease;if(a.effect)this.effect=new ig.EffectHandle(a.effect)},start:function(){var a=ig.Event.getVec3(this.position,b),a=ig.game.spawnEntity(ig.ENTITY.Destructible,a.x-12,a.y-12,a.z,{desType:this.desType,permaDestruct:false,blockNavMap:true,onDestructIncrease:this.onDestructIncrease,onPreDestructIncrease:this.onPreDestructIncrease},false);this.effect&&this.effect.spawnOnTarget(a)}});ig.EVENT_STEP.SPAWN_ENEMY_ON_ENTITY=
ig.EventStepBase.extend({entity:null,enemyInfo:null,enemyType:null,targetPlayer:false,_wm:new ig.Config({attributes:{entity:{_type:"Entity",_info:"Entity to spawn enemy on"},enemyInfo:{_type:"EnemyType",_info:"Enemy information",_popup:true},targetPlayer:{_type:"Boolean",_info:"If true, automatically target player"},name:{_type:"StringExpression",_info:"Name of the enemy to access via action",_optional:true},spawnCondition:{_type:"VarCondition",_info:"Condition for Enemy to spawn and despawn",_popup:true,
_optional:true}}}),init:function(a){this.entity=a.entity;if(a.enemyInfo)this.enemyInfo=new sc.EnemyInfo(a.enemyInfo);this.targetPlayer=a.targetPlayer||false;this.name=a.name||null;this.spawnCondition=a.spawnCondition||null},clearCached:function(){this.enemyInfo&&this.enemyInfo.clearCached()},start:function(a,b){var d=ig.Event.getEntity(this.entity,b),g=d.coll.pos,d=d.coll.size,g=ig.game.spawnEntity(ig.ENTITY.Enemy,g.x+d.x/2-this.enemyInfo.enemyType.size.x/2,g.y+d.y/2-this.enemyInfo.enemyType.size.y/
2,g.z,{enemyInfo:this.enemyInfo.getSettings(),name:ig.Event.getExpressionValue(this.name),spawnCondition:this.spawnCondition},true);this.targetPlayer&&g.setTarget(ig.game.playerEntity,true)}});ig.EVENT_STEP.SET_DAMAGE_NUMBERS=ig.EventStepBase.extend({visibility:false,_wm:new ig.Config({attributes:{visibility:{_type:"Boolean",_info:"If false, hide damage nummbers. Will be cleared on level change."}}}),init:function(a){this.visibility=a.visibility},start:function(){sc.combat.hideDamageNumbers=!this.visibility}});
ig.EVENT_STEP.KILL_ENEMIES=ig.EventStepBase.extend({enemyType:null,noRumble:false,_wm:new ig.Config({attributes:{enemyType:{_type:"String",_info:"If provided: only remove enemy of this type",_optional:true,_select:"enemies"},noRumble:{_type:"Boolean",_info:"If true, do not rumble screen on enemy kill",_optional:true,_default:"true"}}}),init:function(a){this.enemyType=a.enemyType;this.noRumble=a.noRumble},start:function(){sc.combat.removeEnemies(this.enemyType,null,this.noRumble,true)}});ig.EVENT_STEP.SET_ENEMY_STATE=
ig.EventStepBase.extend({enemy:0,enemyState:0,_wm:new ig.Config({attributes:{enemy:{_type:"Actor",_info:"Enemy to change",_context:"Entity"},enemyState:{_type:"EnemyState",_info:"State of Enemy to switch to"}}}),init:function(a){this.enemy=a.enemy;this.enemyState=a.enemyState},start:function(a,b){var d=ig.Event.getEntity(this.enemy,b);d&&d.changeState(this.enemyState,true)}});ig.EVENT_STEP.SET_ENEMY_TARGET=ig.EventStepBase.extend({enemy:0,target:0,_wm:new ig.Config({attributes:{enemy:{_type:"Actor",
_info:"Enemy to change",_context:"Entity"},target:{_type:"Entity",_info:"Entity to target",_withNull:true}}}),init:function(a){this.enemy=a.enemy;this.target=a.target},start:function(a,b){var d=ig.Event.getEntity(this.enemy,b),g=ig.Event.getEntity(this.target,b);d&&d.setTarget(g,true)}});ig.EVENT_STEP.SET_SCREEN_ENEMY_TARGET=ig.EventStepBase.extend({target:0,_wm:new ig.Config({attributes:{target:{_type:"Entity",_info:"Entity to target",_withNull:true}}}),init:function(a){this.target=a.target},start:function(a,
b){var d=ig.Event.getEntity(this.target,b);sc.combat.setScreenEnemiesTarget(d)}});ig.EVENT_STEP.SET_ALL_ENEMY_TARGET=ig.EventStepBase.extend({target:0,_wm:new ig.Config({attributes:{target:{_type:"Entity",_info:"Entity to target",_withNull:true}}}),init:function(a){this.target=a.target},start:function(a,b){for(var d=ig.Event.getEntity(this.target,b),g=ig.game.entities,h=g.length;h--;){var i=g[h];i instanceof ig.ENTITY.Enemy&&i.setTarget(d,true)}}});ig.EVENT_STEP.REMOVE_ALL_ENEMY_TARGET=ig.EventStepBase.extend({_wm:new ig.Config({attributes:{}}),
init:function(){},start:function(){for(var a=ig.game.entities,b=a.length;b--;){var d=a[b];d instanceof ig.ENTITY.Enemy&&d.setTarget(null,true)}}});ig.EVENT_STEP.RESET_SP=ig.EventStepBase.extend({target:0,_wm:new ig.Config({attributes:{target:{_type:"Entity",_info:"Entity to target",_withNull:true},sp:{_type:"Number",_info:"How much SP to reset. 0.5=50%"}}}),init:function(a){this.target=a.target;this.sp=a.sp},start:function(a,b){var d=ig.Event.getEntity(this.target,b);d&&d.params&&d.params.setRelativeSp(this.sp)}});
ig.EVENT_STEP.SET_RELATIVE_HP=ig.EventStepBase.extend({_wm:new ig.Config({attributes:{target:{_type:"Entity",_info:"Entity to set HP of"},value:{_type:"Number",_info:"Relative amount of HP entity should have. 1= FULL HP"}}}),init:function(a){this.target=a.target;this.value=a.value},start:function(a,b){var d=ig.Event.getEntity(this.target,b);d&&d.params&&d.params.setRelativeHp(this.value)}});ig.EVENT_STEP.REGEN_HP=ig.EventStepBase.extend({_wm:new ig.Config({attributes:{target:{_type:"Entity",_info:"Entity to target"},
value:{_type:"Number",_info:"Relative amount of HP to regen. 1= FULL HP"},showNumbers:{_type:"Boolean",_info:"if true: do not show healing numbers"}}}),init:function(a){this.value={value:a.value};this.target=a.target;this.showNumbers=a.showNumbers},start:function(a,b){var d=ig.Event.getEntity(this.target,b);d&&d.params&&d.heal(this.value,!this.showNumbers)}});ig.EVENT_STEP.SET_TYPED_ENEMY_TARGET=ig.EventStepBase.extend({target:0,_wm:new ig.Config({attributes:{enemyType:{_type:"String",_info:"Type of enemy",
_select:"enemies"},target:{_type:"Entity",_info:"Entity to target",_withNull:true}}}),init:function(a){this.enemyType=a.enemyType;this.target=a.target},start:function(a,b){for(var d=ig.Event.getEntity(this.target,b),g=ig.game.shownEntities,h=g.length;h--;){var i=g[h];i instanceof ig.ENTITY.Enemy&&i.enemyName==this.enemyType&&i.setTarget(d,true)}}});ig.EVENT_STEP.SET_ENEMIES_NAV_TOLERANT=ig.EventStepBase.extend({target:0,_wm:new ig.Config({attributes:{}}),init:function(a){this.enemyType=a.enemyType;
this.target=a.target},start:function(a,b){for(var d=ig.Event.getEntity(this.target,b),g=ig.game.shownEntities,h=g.length;h--;){var i=g[h];i instanceof ig.ENTITY.Enemy&&i.enemyName==this.enemyType&&i.setTarget(d,true)}}});ig.EVENT_STEP.SET_FINAL_DRAMATIC_EFFECT=ig.EventStepBase.extend({effectType:null,_wm:new ig.Config({attributes:{effectType:{_type:"String",_info:"Type of dramatic effect",_select:sc.DRAMATIC_EFFECT,_withNull:true}}}),init:function(a){this.effectType=sc.DRAMATIC_EFFECT[a.effectType]||
null},start:function(){sc.combat.setFinalDramaticEffect(this.effectType)}});ig.EVENT_STEP.SET_COMBAT_SPEED=ig.EventStepBase.extend({speed:0,_wm:new ig.Config({attributes:{speed:{_type:"Number",_info:"Speed of combat, will scale frequency of enemy attacks",_default:1}}}),init:function(a){this.speed=a.speed||0},start:function(){sc.combat.setCombatSpeed(this.speed)}});var a=Vec2.create();ig.EVENT_STEP.MASS_REPLACE_ENTITIES_WITH_ENEMY=ig.EventStepBase.extend({regExp:null,spawnEnemyInfo:null,enemyType:null,
target:null,_wm:new ig.Config({attributes:{regExp:{_type:"String",_info:"Regular Expression used on entityName to find entities"},enemyInfo:{_type:"EnemyType",_info:"Enemy type to swap with entities",_popup:true},target:{_type:"Entity",_info:"Set enemy target when spawned",_optional:true}}}),init:function(a){this.regExp=RegExp(a.regExp);this.enemyInfo=new sc.EnemyInfo(a.enemyInfo);this.target=a.target},clearCached:function(){this.enemyInfo&&this.enemyInfo.clearCached()},start:function(b,d){for(var f=
this.target&&ig.Event.getEntity(this.target,d),g=ig.game.shownEntities,h=g.length;h--;){var i=g[h];if(i&&i.name&&this.regExp.test(i.name)){var j={enemyInfo:this.enemyInfo.getSettings()},j=ig.game.spawnEntity("Enemy",i.coll.pos.x,i.coll.pos.y,i.coll.pos.z,j),k=i.getCenter(a);j.setPos(k.x-j.coll.size.x/2,k.y-j.coll.size.y/2,j.coll.pos.z);i.face&&Vec2.assign(j.face,i.face);i.kill();j.initAnimations(true);f&&j.setTarget(f,true)}}}});ig.EVENT_STEP.SWAP_ENTITY_WITH_ENEMY=ig.EventStepBase.extend({entity:null,
spawnEnemyInfo:null,enemyType:null,manualKill:null,_wm:new ig.Config({attributes:{entity:{_type:"Entity",_info:"Entity to swap with enemy",_context:"Entity"},enemyInfo:{_type:"EnemyType",_info:"Enemy to swap with entity",_popup:true},manualKill:{_type:"VarName",_info:"Instead of killing the enemy, set specified variable to true.",_optional:true}}}),init:function(a){this.entity=a.entity;this.enemyInfo=new sc.EnemyInfo(a.enemyInfo);this.manualKill=a.manualKill||null},clearCached:function(){this.enemyInfo&&
this.enemyInfo.clearCached()},start:function(b,d){var f=ig.Event.getEntity(this.entity,d);if(f){var g={enemyInfo:this.enemyInfo.getSettings(),name:f.name+"_EnemySwap",manualKill:this.manualKill},g=ig.game.spawnEntity("Enemy",f.coll.pos.x,f.coll.pos.y,f.coll.pos.z,g),h=f.getCenter(a);g.setPos(h.x-g.coll.size.x/2,h.y-g.coll.size.y/2,g.coll.pos.z);f.face&&Vec2.assign(g.face,f.face);f.hide();ig.game.swapNamedEntities(f,g);g.initAnimations(true)}}});ig.EVENT_STEP.SWAP_BACK_ENEMY_WITH_ENTITY=ig.EventStepBase.extend({entity:null,
_wm:new ig.Config({attributes:{entity:{_type:"Entity",_info:"Entity to swap with enemy",_context:"Entity"},expCollect:{_type:"Boolean",_info:"Manually kill enemy, collecting EXP etc."}}}),init:function(a){this.entity=a.entity;this.expCollect=a.expCollect},start:function(b,d){var f=ig.Event.getEntity(this.entity,d),g=ig.game.getEntityByName(f.name+"_EnemySwap");if(g&&f){var h=f.getCenter(a);ig.game.swapNamedEntities(g,f);g.setPos(h.x-g.coll.size.x/2,h.y-g.coll.size.y/2,f.coll.pos.z);g.face&&Vec2.assign(g.face,
f.face);this.expCollect?f.doManualKill():f.kill();g.show()}}});ig.EVENT_STEP.SET_COMBAT_ACTIVE=ig.EventStepBase.extend({active:false,_wm:new ig.Config({attributes:{active:{_type:"Boolean",_info:"Activity status of combat"}}}),init:function(a){this.active=a.active},start:function(){sc.combat.setActive(this.active)}});ig.EVENT_STEP.DO_ENEMY_ACTION=ig.EventStepBase.extend({enemy:null,actionName:null,_wm:new ig.Config({attributes:{enemy:{_type:"Actor",_info:"Enemy to change",_context:"Entity"},actionName:{_type:"String",
_info:"Name of action to perform"},noStateReset:{_type:"Boolean",_info:"If true, do not reset state before switching to action. Also keeps actionAttached!"}}}),init:function(a){this.enemy=a.enemy;this.actionName=a.actionName;this.noStateReset=a.noStateReset||false},start:function(a,b){var d=ig.Event.getEntity(this.enemy,b);d&&d.doEnemyAction&&d.doEnemyAction(this.actionName,this.noStateReset)}});var d={RELATIVE_HP:{},CURRENT_HP:{},MAX_HP:{stat:"hp"},ATTACK:{stat:"attack"},DEFENSE:{stat:"defense"},
FOCUS:{stat:"focus"}};ig.EVENT_STEP.SET_VAR_COMBAT_STAT=ig.EventStepBase.extend({varName:null,stat:null,entity:null,_wm:new ig.Config({attributes:{varName:{_type:"VarName",_info:"Variable to store relative hp in"},entity:{_type:"Entity",_info:"Combatant of which to fetch stat"},stat:{_type:"String",_info:"Type of Stat",_select:d}}}),init:function(a){this.varName=a.varName;this.entity=a.entity;this.stat=d[a.stat]||d.RELATIVE_HP},start:function(a,b){var f=ig.Event.getVarName(this.varName);if(f){var g=
ig.Event.getEntity(this.entity,b);if(g&&g.isCombatant){var h;if(this.stat.stat)h=g.params.getStat(this.stat.stat);else if(this.stat==d.RELATIVE_HP)h=g.params.getHpFactor();else if(this.stat==d.CURRENT_HP)h=g.params.currentHp;ig.vars.set(f,h)}}else ig.log("SET_VAR_TIME: Variable Name is not a String!")}});ig.EVENT_STEP.MANUAL_COMBATANT_KILL=ig.EventStepBase.extend({entity:null,_wm:new ig.Config({attributes:{entity:{_type:"Entity",_info:"Combatant to manually kill"}}}),init:function(a){this.entity=
a.entity},start:function(a,b){var d=ig.Event.getEntity(this.entity,b);d&&d.isCombatant&&d.doManualKill()}});ig.EVENT_STEP.MANUAL_COMBATANT_REVIVE=ig.EventStepBase.extend({entity:null,_wm:new ig.Config({attributes:{entity:{_type:"Entity",_info:"Combatant to manually revive",_context:"Entity"}}}),init:function(a){this.entity=a.entity},start:function(a,b){var d=ig.Event.getEntity(this.entity,b);d&&d.isCombatant&&d.doManualRevive(1)}});ig.EVENT_STEP.SET_COMBATANT_MANUAL_KILL=ig.EventStepBase.extend({entity:null,
_wm:new ig.Config({attributes:{entity:{_type:"Entity",_info:"Combatant to set manual kill variable to",_context:"Entity"},varName:{_type:"VarName",_info:"Variable to set to true when combatant is killed"}}}),init:function(a){this.entity=a.entity;this.varName=a.varName},start:function(a,b){var d=ig.Event.getEntity(this.entity,b);if(d&&d.isCombatant)d.manualKill=this.varName}});ig.EVENT_STEP.START_PVP_BATTLE=ig.EventStepBase.extend({winPoints:0,entity:null,_wm:new ig.Config({attributes:{winPoints:{_type:"Integer",
_info:"Number of points to win PVP battle"},enemies:{_type:"Array",_info:"List of all enemies that participate in battle",_sub:{_type:"Entity"}}}}),init:function(a){this.winPoints=a.winPoints;this.enemies=a.enemies},start:function(a,b){for(var d=[],g=0;g<this.enemies.length;g++)d.push(ig.Event.getEntity(this.enemies[g],b));sc.pvp.start(this.winPoints,d)}});ig.EVENT_STEP.PREPARE_PVP_ROUND=ig.EventStepBase.extend({autoContinue:false,_wm:new ig.Config({attributes:{autoContinue:{_type:"Boolean",_info:"If true, automatically stop preparation"}}}),
init:function(a){this.autoContinue=a.autoContinue||false},start:function(){sc.pvp.startNextRound(this.autoContinue)},run:function(){return!this.autoContinue||!sc.pvp.blocking}});ig.EVENT_STEP.START_PVP_ROUND=ig.EventStepBase.extend({_wm:new ig.Config({attributes:{}}),init:function(){},start:function(){sc.pvp.finalizeRoundStart()}});ig.EVENT_STEP.STOP_PVP_BATTLE=ig.EventStepBase.extend({_wm:new ig.Config({attributes:{}}),init:function(){},start:function(){sc.pvp.stop()}});ig.EVENT_STEP.SET_RESPAWN_POINT=
ig.EventStepBase.extend({_wm:new ig.Config({attributes:{entity:{_type:"Actor",_info:"Entity to change",_context:"Entity"},marker:{_type:"Entity",_info:"marker Entity to take position from"}}}),init:function(a){this.entity=a.entity;this.marker=a.marker},start:function(a,b){var d=ig.Event.getEntity(this.entity,b),g=ig.Event.getEntity(this.marker,b);if(d&&g){Vec3.assign(d.respawn.pos,g.coll.pos);Vec2.addMulF(d.respawn.pos,g.coll.size,0.5);Vec2.addMulF(d.respawn.pos,d.coll.size,-0.5)}}});ig.EVENT_STEP.COMBAT_IF=
ig.EventStepBase.extend({conditions:null,withElse:false,branches:{},_wm:new ig.Config({attributes:{entity:{_type:"Entity",_info:"Combatant from which to evaluate combat if"},conditions:{_type:"CombatConditions",_info:"Combat conditions for if statement"},withElse:{_type:"Boolean",_info:"With else case.",_noLabel:true},tmpTarget:{_type:"Entity",_info:"Temp target to set temporarily while combat condition is evaluated",_optional:true}},branchLabel:function(a){switch(a){case "thenStep":return null;case "elseStep":return"else";
case "_end":return"endif"}return"???"}}),init:function(a){this.entity=a.entity;this.tmpTarget=a.tmpTarget;this.conditions=new sc.CombatConditions(a.conditions);this.withElse=a.withElse},getBranchNames:function(){return this.withElse?["thenStep","elseStep"]:["thenStep"]},getNext:function(){var a=ig.Event.getEntity(this.entity),b=this.tmpTarget&&ig.Event.getEntity(this.tmpTarget),d;if(b){d=a.tmpTarget;a.tmpTarget=b}var g=Math.random();if(a)var h=this.conditions.check(a,g);else console.log('COMBAT_IF: Entity "'+
this.entity.name+'" not found.');if(a&&b)a.tmpTarget=d;return h?this.branches.thenStep?this.branches.thenStep:this._nextStep:this.branches.elseStep?this.branches.elseStep:this._nextStep}});ig.EVENT_STEP.REMOVE_PROXIES=ig.EventStepBase.extend({_wm:new ig.Config({attributes:{group:{_type:"String",_info:"Only remove proxies with matching group string"}}}),init:function(a){this.group=a.group||null},start:function(){for(var a=ig.game.entities,b=a.length;b--;){var d=a[b];d&&(d instanceof sc.CombatProxyEntity&&
d.group==this.group)&&d.destroy()}}})});ig.baked=!0;
ig.module("game.feature.combat.enemy-steps").requires("impact.base.animation","impact.base.action","impact.base.entity","game.feature.combat.entities.enemy").defines(function(){ig.ACTION_STEP.CHANGE_ENEMY_ANNOTATION=ig.ActionStepBase.extend({_wm:new ig.Config({attributes:{active:{_type:"String",_info:"The current active state",_select:sc.ENEMY_ANNO_ACTIVE,_optional:true},passive:{_type:"String",_info:"The current passive state",_select:sc.ENEMY_ANNO_PASSIVE,_optional:true},weapon:{_type:"String",
_info:"What weapon is preferred for the enemy",_select:sc.ENEMY_ANNO_WEAPON,_optional:true},extra:{_type:"Array",_info:"The current active state",_sub:{_type:"String",_select:sc.ENEMY_ANNO_EXTRA},_optional:true},element:{_type:"String",_info:"What element should be used",_select:sc.ENEMY_ANNO_ELEMENT,_optional:true}}}),init:function(b){this.active=b.active?sc.ENEMY_ANNO_ACTIVE[b.active]||0:null;this.passive=b.passive?sc.ENEMY_ANNO_PASSIVE[b.passive]||0:null;this.weapon=b.weapon?sc.ENEMY_ANNO_WEAPON[b.weapon]||
0:null;var a=b.extra;if(a)for(var d=this.extra=0;d<a.length;++d)this.extra=this.extra|sc.ENEMY_ANNO_EXTRA[a[d]];else this.extra=null;this.element=b.element?sc.ELEMENT[b.element]||0:null},run:function(b){if(this.active!=null)b.annotate.active=this.active;if(this.passive!=null)b.annotate.passive=this.passive;if(this.weapon!=null)b.annotate.weapon=this.weapon;if(this.extra!=null)b.annotate.extra=this.extra;return true}});ig.ACTION_STEP.DO_ENEMY_ACTION=ig.ActionStepBase.extend({actionName:null,_wm:new ig.Config({attributes:{actionName:{_type:"EnemyActionRef",
_info:"Name of action to perform"},noStateReset:{_type:"Boolean",_info:"If true, do not reset state before switching to action. Also keeps actionAttached!"}}}),init:function(b){this.actionName=b.actionName;this.noStateReset=b.noStateReset||false},run:function(b){b.doEnemyAction(this.actionName,this.noStateReset);return true}});ig.ACTION_STEP.DO_ENEMY_ACTION_INLINE=ig.ActionStepBase.extend({actionName:null,_wm:new ig.Config({attributes:{actionName:{_type:"EnemyActionRef",_info:"Name of action to perform"},
stateReset:{_type:"Boolean",_info:"If true, reset state before inline calling action!"}}}),init:function(b){this.actionName=b.actionName;this.stateReset=b.stateReset},run:function(b){if(b.doEnemyAction)b.doEnemyAction(this.actionName,!this.stateReset,true);else{var a=b.getCombatantRoot();a.getEnemyAction&&b.pushInlineAction(a.getEnemyAction(this.actionName))}return true}});ig.ACTION_STEP.SET_AGGRESSION=ig.ActionStepBase.extend({value:false,_wm:new ig.Config({attributes:{value:{_type:"String",_info:"Set enemy aggression",
_select:sc.ENEMY_AGGRESSION}}}),init:function(b){this.value=sc.ENEMY_AGGRESSION[b.value]},run:function(b){b.aggression=this.value;return true}});ig.ACTION_STEP.SET_ENEMY_ELEMENT_MODE=ig.ActionStepBase.extend({_wm:new ig.Config({attributes:{element:{_type:"String",_info:"Element to change to",_select:sc.ELEMENT},skipEffect:{_type:"Boolean",_info:"If true: don't show transition effect"}}}),init:function(b){this.element=sc.ELEMENT[b.element];this.skipEffect=b.skipEffect||false},start:function(b){!b instanceof
ig.ENTITY.Enemy||b.setElementMode(this.element,this.skipEffect)}})});ig.baked=!0;
ig.module("game.feature.combat.plug-in").requires("game.feature.combat.combat","game.feature.combat.pvp","game.feature.combat.combat-shield","game.feature.combat.combat-force","game.feature.combat.combat-stun","game.feature.combat.combat-assault","game.feature.combat.combat-poi","game.feature.combat.combat-charge","game.feature.combat.combat-sweep","game.feature.combat.stat-change","game.feature.combat.entities.combatant-marble","game.feature.combat.entities.ball","game.feature.combat.entities.combatant",
"game.feature.combat.entities.food-icon","game.feature.combat.entities.drop","game.feature.combat.entities.item-drop","game.feature.combat.entities.enemy","game.feature.combat.entities.enemy-spawner","game.feature.combat.entities.respawn-blocker","game.feature.combat.entities.hit-number","game.feature.combat.entities.burst-spawner","game.feature.combat.entities.stone","game.feature.combat.gui.status-bar","game.feature.combat.gui.pvp-gui","game.feature.combat.gui.hp-bar-boss","game.feature.combat.gui.enemy-display-gui",
"game.feature.combat.model.combat-condition","game.feature.combat.model.combat-params","game.feature.combat.model.combat-status","game.feature.combat.model.enemy-type","game.feature.combat.model.enemy-reaction","game.feature.combat.model.enemy-collab","game.feature.combat.model.enemy-level-scaling","game.feature.combat.model.enemy-tracker","game.feature.combat.model.enemy-booster","game.feature.combat.combat-action-steps","game.feature.combat.combat-event-steps","game.feature.combat.enemy-steps",
"game.feature.combat.stat-change").defines(function(){if(window.wm){wm.postLoadModules.push("game.feature.combat.editors.enemy-editor");wm.postLoadModules.push("game.feature.combat.editors.combat-condition-edit");wm.postLoadModules.push("game.feature.combat.editors.enemy-choice-edit");wm.postLoadModules.push("game.feature.combat.editors.combat-edit");wm.postLoadModules.push("game.feature.combat.editors.pvp-edit");wm.postLoadModules.push("game.feature.combat.editors.proxy-edit");wm.addStepColorRule(/DIRECT_HIT/,
"red");wm.addStepColorRule(/CIRCLE_ATTACK/,"red");wm.addStepColorRule(/TACKLE/,"red");wm.addStepColorRule(/COMBAT/,"violet");wm.addStepColorRule(/ANNOTATION/,"orange")}});ig.baked=!0;
ig.module("game.feature.game-code.game-code").requires("impact.base.game").defines(function(){sc.SPARKLING_SHOES_ID=101;sc.CHRISTMAS_HAD_ID=168;sc.CHRISTMAS_BOOTS_ID=16;sc.GAME_GIMMIKS={SPARKLING_SHOES:{text:"sc.gimmick.sparklingShoes",addItem:sc.SPARKLING_SHOES_ID},HOLIDAY_QUEST:{text:"sc.gimmick.holidayQuest",setKey:"holidayQuest"},VOICE_ACTING:{text:"sc.gimmick.voiceActing",textDisable:"sc.gimmick.voiceActingRemove",onToggle:function(){sc.voiceActing.toggle()}},CARAMELLDANSEN:{text:"sc.gimmick.caramelldansen",
textDisable:"sc.gimmick.caramelldansenRemove",setKey:"caramelldansen"},REGULAR_TREES:{text:"sc.gimmick.regularTrees",textDisable:"sc.gimmick.regularTreesRemove",setKey:"regularTrees"},SPEEDLINES:{text:"sc.gimmick.speedlines",textDisable:"sc.gimmick.speedlinesRemove",setKey:"speedlines"}};sc.GAME_CODES={"WoN-Boots":sc.GAME_GIMMIKS.SPARKLING_SHOES,"Holiday-Man":sc.GAME_GIMMIKS.HOLIDAY_QUEST,"Best-VA":sc.GAME_GIMMIKS.VOICE_ACTING,Caramelldansen:sc.GAME_GIMMIKS.CARAMELLDANSEN,"Regular-Trees":sc.GAME_GIMMIKS.REGULAR_TREES,
Speedlines:sc.GAME_GIMMIKS.SPEEDLINES};sc.GameCode=ig.GameAddon.extend({enabled:[],keys:{},init:function(){this.parent("GameCode");ig.vars.registerVarAccessor("gamecode",this)},enterCode:function(b,a){var d=sc.GAME_CODES[b];if(!d){a||sc.Dialogs.showDialog(ig.lang.get("sc.gimmick.unknown"),null,void 0);return false}var c=false;if(this.enabled.indexOf(d)==-1)this.enabled.push(d);else if(d.textDisable){this.enabled.erase(d);c=true}var e;a||(e=ig.lang.get(c?d.textDisable:d.text));d.setKey&&(this.keys[d.setKey]=
!c);if(d.onToggle)d.onToggle(c);a||sc.Dialogs.showDialog(e,null,void 0);return true},isEnabled:function(b){return this.keys[b]||false},onVarAccess:function(b,a){return this.keys[a[1]]||false},levelLoadedOrder:1E3,onLevelLoaded:function(){for(var b=this.enabled.length;b--;){var a=this.enabled[b];a.addItem&&sc.model.player.getItemAmountWithEquip(a.addItem)==0&&sc.model.player.addItem(a.addItem,1)}}});ig.addGameAddon(function(){sc.gameCode=new sc.GameCode;return sc.gameCode});sc.submitGameCode=function(b){sc.gameCode.enterCode(b)}});
ig.baked=!0;ig.module("game.feature.game-code.plug-in").requires("game.feature.game-code.game-code").defines(function(){ig.langFileList.push("sc.gimmick")});ig.baked=!0;
ig.module("game.feature.interact.gui.interact-gui").requires("impact.feature.gui.gui").defines(function(){var b=Vec2.create();ig.GUI.Interact=ig.GuiElementBase.extend({iconState:0,transitions:{DEFAULT:{state:{alpha:1},time:0.1,timeFunction:KEY_SPLINES.EASE_OUT},NEAR:{state:{alpha:1},time:0.1,timeFunction:KEY_SPLINES.EASE_OUT},AWAY:{state:{alpha:0.9},time:0.1,timeFunction:KEY_SPLINES.EASE_OUT},HIDDEN:{state:{scaleX:0,scaleY:0,alpha:1},time:0.1,timeFunction:KEY_SPLINES.EASE_IN}},gfx:new ig.Image("media/gui/map-ar.png"),
target:null,offset:null,icon:null,timer:0,offsetTimer:0,overlayIcon:null,subGui:null,init:function(a,b){this.parent();this.setSize(24,24);this.setPivot(12,24);this.hook.zIndex=-30;this.hook.invisibleUpdate=true;this.target=a;this.icon=b;this.doStateTransition("HIDDEN",true);this.overlayIcon=new sc.InteractOverlayIcon(this);this.addChildGui(this.overlayIcon)},setIconState:function(a){this.iconState=a;var b=true;if(this.subGui){this.subGui.setIconState(a);this.subGui.isActive(this.iconState)&&(b=false);
b||this.doStateTransition(a==sc.INTERACT_ENTRY_STATE.HIDDEN?"HIDDEN":"DEFAULT")}b&&(this.icon.hasAnim(a)?a==sc.INTERACT_ENTRY_STATE.AWAY?this.doStateTransition("AWAY"):a==sc.INTERACT_ENTRY_STATE.NEAR||a==sc.INTERACT_ENTRY_STATE.BLOCK?this.doStateTransition("NEAR"):this.doStateTransition("DEFAULT"):this.doStateTransition("HIDDEN"))},setSubGui:function(a){this.subGui&&this.removeChildGui(this.subGui);if(this.subGui=a){this.insertChildGui(this.subGui,0);this.subGui.setAlign(ig.GUI_ALIGN.X_CENTER,ig.GUI_ALIGN.Y_BOTTOM)}this.setIconState(this.iconState)},
update:function(){this.timer=(this.timer+ig.system.tick)%this.icon.getMaxTimer(this.iconState);this.offsetTimer=(this.offsetTimer+ig.system.tick)%1;this._updatePos()},remove:function(){this.doStateTransition("HIDDEN",false,true)},_updatePos:function(){var a=0;this.iconState!=sc.INTERACT_ENTRY_STATE.RUNNING&&(a=Math.round(Math.sin(Math.PI*2*(this.offsetTimer/1))*1));this.subGui&&this.subGui.isActive(this.iconState)&&(a=0);ig.system.getScreenFromMapPos(b,Math.round(this.target.coll.pos.x+this.target.coll.size.x/
2),Math.round(this.target.coll.pos.y-this.target.coll.pos.z-this.target.coll.size.z));this.hook.pos.x=b.x-this.hook.size.x/2;this.hook.pos.y=b.y-this.hook.size.y+a+4;this.offset&&Vec2.add(this.hook.pos,this.offset)}});sc.InteractOverlayIcon=ig.GuiElementBase.extend({gfx:new ig.Image("media/gui/message.png"),interactGui:null,init:function(a){this.parent();this.interactGui=a},updateDrawables:function(a){var b=this.interactGui;b.icon.updateDrawables(a,b.iconState,b.timer)}})});ig.baked=!0;
ig.module("game.feature.interact.map-interact").requires("impact.base.game","game.feature.model.game-model","game.feature.interact.gui.interact-gui").defines(function(){var b={dist:1,dir:{x:0,y:0}},a=[],d=Vec2.create(),c=Vec2.create(),e=Vec2.create(),f=Vec2.create(),g={},h=Vec2.create();sc.INTERACT_Z_CONDITION={SAME_Z:1,Z_RANGE_OVERLAP:2};sc.INTERACT_ENTRY_STATE={HIDDEN:0,AWAY:1,NEAR:2,BLOCKED:3,FOCUS:4,RUNNING:5};sc.MapInteract=ig.GameAddon.extend({entries:[],focusEntry:null,interacting:false,hidden:false,
init:function(){this.parent("MapInteract")},addEntry:function(a){if(this.entries.indexOf(a)==-1){this.entries.push(a);ig.gui.addGuiElement(a.gui)}},removeEntry:function(a){a.gui.remove();this.entries.erase(a)},preUpdateOrder:0,onPreUpdate:function(){var g=!sc.control.interactDown(),j=true;if(!ig.game.paused){this.updateHideStatus();if(this.hidden){g=true;j=false}var k=ig.game.playerEntity;if(k)k.getCenter(f);else{g=true;j=false}if(this.interacting)if(g){if(this.focusEntry.handler.onInteractionEnd)this.focusEntry.handler.onInteractionEnd();
this.focusEntry=null;this.interacting=false}else j=false;else this.focusEntry=null;for(var g=-1,l=this.entries.length,o;l--;){var m=this.entries[l],n=m.entity;if(n._killed)this.removeEntry(m);else if(j){o=sc.INTERACT_ENTRY_STATE.AWAY;if(m.blockedDuringCombat&&sc.model.isCombatActive())o=sc.INPUT_FORCER_ENTRIES.HIDDEN;else if(ig.EntityTools.isInScreen(n,16)){n.getCenter(c);Vec2.sub(c,f,e);var p=false;m.zCondition==sc.INTERACT_Z_CONDITION.SAME_Z?p=Math.abs(k.coll.pos.z-n.coll.pos.z)<=ig.COLLISION.HEIGHT_TOLERATE:
m.zCondition==sc.INTERACT_Z_CONDITION.Z_RANGE_OVERLAP&&(p=n.coll.pos.z+n.coll.size.z>=k.coll.pos.z&&k.coll.pos.z+k.coll.size.z>=n.coll.pos.z);k.coll.pos.z>k.coll.baseZPos&&(p=false);var r=Vec2.length(e);if(p&&r<=40+n.coll.size.y/2&&(!m.interrupting||ig.game.isInterruptible()&&!sc.model.isMapLeaveBlocked())&&!k.interactObject){b.dist=1;b.dir.x=0;b.dir.y=0;a=[];if(!ig.game.trace(b,f.x,f.y,Math.floor(k.coll.pos.z+k.coll.size.z*0.75),e.x,e.y,2,2,2,ig.COLLTYPE.IGNORE,k,a)||a[0]==n.coll||(1-b.dist)*r<n.coll.size.x/
2+16){o=sc.INTERACT_ENTRY_STATE.NEAR;if(m.handler.isInteractionBlocked&&m.handler.isInteractionBlocked())o=sc.INTERACT_ENTRY_STATE.BLOCKED;else{p=-1;if(ig.input.currentDevice==ig.INPUT_DEVICES.GAMEPAD)Vec2.angle(e,k.face)<Math.PI/2?p=r:r<16&&(p=r+100);else{ig.system.getScreenFromMapPos(h,n.coll.pos.x+n.coll.size.x/2,n.coll.pos.y-n.coll.pos.z+n.coll.size.y/2-n.coll.size.z/2);d.x=sc.control.getMouseX()-h.x;d.y=sc.control.getMouseY()-h.y;r=Vec2.length(d);n=Math.max(32,(n.coll.size.y+n.coll.size.z)/2);
r<=n&&(p=r)}if(p!=-1&&(g==-1||p<g)){g=p;this.focusEntry=m}}}}}else o=sc.INTERACT_ENTRY_STATE.HIDDEN;m.setState(o)}else m!=this.focusEntry&&m.setState(sc.INTERACT_ENTRY_STATE.HIDDEN)}if(j&&this.focusEntry)if(sc.control.interactPressed()&&!ig.interact.isBlocked()){j=null;this.focusEntry.handler.onInteraction&&(j=this.focusEntry.handler.onInteraction());if(j!==false){this.focusEntry.setState(sc.INTERACT_ENTRY_STATE.RUNNING);ig.interact.setBlockDelay();this.interacting=true}else this.focusEntry.setState(sc.INTERACT_ENTRY_STATE.FOCUS)}else this.focusEntry.setState(sc.INTERACT_ENTRY_STATE.FOCUS)}},
updateHideStatus:function(){var a=ig.game.isControlBlocked();if(this.hidden!=a)if(this.hidden=a)for(a=0;a<this.entries.length;++a)this.entries[a].gui.hide()},forceHide:function(){this.hidden=true;for(var a=0;a<this.entries.length;++a){this.entries[a].setState(sc.INTERACT_ENTRY_STATE.HIDDEN);this.entries[a].gui.hook.pauseGui=true;this.entries[a].gui.hide()}},forceShow:function(){this.hidden=false;for(var a=0;a<this.entries.length;++a)this.entries[a].gui.hook.pauseGui=false}});ig.addGameAddon(function(){return sc.mapInteract=
new sc.MapInteract});sc.MapInteractIcon=ig.Class.extend({tiles:null,noAwayIcon:false,anims:{},frameTime:0,init:function(a,b,c){this.tiles=a;this.frameTime=c;for(var d in b)this.anims[sc.INTERACT_ENTRY_STATE[d]]=b[d]},hasAnim:function(a){return!!this.anims[a]},getMaxTimer:function(a){return(this.anims[a]||this.anims[sc.INTERACT_ENTRY_STATE.NEAR]).length*this.frameTime},updateDrawables:function(a,b,c){var b=this.tiles.getTileSrc(g,(this.anims[b]||this.anims[sc.INTERACT_ENTRY_STATE.NEAR])[Math.floor(c/
this.frameTime)]),c=this.tiles.width,d=this.tiles.height;a.addGfx(this.tiles.image,(24-c)/2,24-d,b.x,b.y,c,d)}});sc.MapInteractEntry=ig.Class.extend({entity:null,handler:null,offset:null,state:sc.INTERACT_ENTRY_STATE.HIDDEN,icon:null,interrupting:false,zCondition:sc.INTERACT_Z_CONDITION.Z_RANGE_OVERLAP,gui:null,blockedDuringCombat:false,init:function(a,b,c,d,e){this.entity=a;this.handler=b;this.icon=c;this.zCondition=d||sc.INTERACT_Z_CONDITION.Z_RANGE_OVERLAP;this.interrupting=e||false;this.gui=new ig.GUI.Interact(a,
c)},setOffset:function(a,b){if(!this.gui.offset)this.gui.offset=Vec2.create();this.gui.offset.x=a;this.gui.offset.y=b},setIcon:function(a){this.icon=a;this.gui.icon=a},setSubGui:function(a){this.gui.setSubGui(a)},setState:function(a){this.state=a;this.gui.setIconState(a)}})});ig.baked=!0;
ig.module("game.feature.map-content.entities.elevator").requires("impact.base.entity","game.feature.interact.map-interact","impact.base.actor-entity").defines(function(){sc.ELEVATOR_TYPE={};sc.ELEVATOR_TYPE.cargoShip={size:{x:64,y:48,z:4},ground:{gfx:"media/entity/objects/elevator.png",x:0,y:24,w:64,h:64,flipX:false},markerDir:"SOUTH",stuckProbility:0.5,switchEntry:{pos:{x:26,y:2,z:4},size:{x:10,y:10,z:9},anims:{sheet:{src:"media/entity/objects/elevator.png",width:16,height:24},SUB:[{name:"active",
time:1,frames:[0]},{name:"disabled",time:1,frames:[0]}]}}};sc.ELEVATOR_TYPE.coldDng={size:{x:96,y:64,z:2},ground:{gfx:"media/map/cold-dng.png",x:400,y:304,w:96,h:80,flipX:false,offset:{x:0,y:0,z:-1}},markerDir:"SOUTH",stuckProbility:0.5,switchEntry:{pos:{x:43,y:0,z:2},size:{x:10,y:6,z:16},anims:{sheet:{src:"media/map/cold-dng.png",width:16,height:16,offX:448,offY:256,xCount:1},SUB:[{name:"active",time:1,frames:[1]},{name:"disabled",time:1,frames:[0]}]}}};sc.ELEVATOR_TYPE.lab={size:{x:96,y:64,z:2},
ground:{gfx:"media/map/lab.png",x:416,y:560,w:96,h:80,flipX:false,offset:{x:0,y:0,z:-1}},markerDir:"SOUTH",stuckProbility:0,switchEntry:{pos:{x:32,y:0,z:2},size:{x:32,y:3,z:13},anims:{sheet:{src:"media/map/lab.png",width:32,height:16,offX:448,offY:528,xCount:1},offset:{x:0,y:0,z:3},renderMode:"lighter",SUB:[{name:"active",time:1,frames:[1]},{name:"disabled",time:1,frames:[0]}]},showFx:{sheet:"map.lab-entrance",name:"elevatorOn"},hideFx:{sheet:"map.lab-entrance",name:"elevatorOff"}}};sc.ELEVATOR_TYPE.labSmall=
{size:{x:32,y:28,z:2},ground:{gfx:"media/map/lab.png",x:464,y:640,w:32,h:32,flipX:false,offset:{x:0,y:0,z:0}},markerDir:"SOUTH",stuckProbility:0,noEndRunble:true,speed:170,switchEntry:{pos:{x:8,y:0,z:2},size:{x:16,y:2,z:20},collType:ig.COLLTYPE.IGNORE,anims:{sheet:{src:"media/map/lab.png",width:16,height:16,offX:496,offY:640,xCount:1},renderMode:"lighter",SUB:[{name:"active",time:1,frames:[1]},{name:"disabled",time:1,frames:[0]}]},showFx:{sheet:"map.lab-entrance",name:"elevatorOnSmall"},hideFx:{sheet:"map.lab-entrance",
name:"elevatorOffSmall"}},partyOffset:[{x:24,y:0},{x:-24,y:0},{x:0,y:4}],singlePerson:true};sc.ELEVATOR_TYPE.labSmallOutside={size:{x:32,y:28,z:2},ground:{gfx:"media/map/lab-entrance.png",x:32,y:64,w:32,h:32,flipX:false,offset:{x:0,y:0,z:0}},markerDir:"SOUTH",stuckProbility:0,noEndRunble:true,speed:170,switchEntry:{pos:{x:8,y:0,z:2},size:{x:16,y:2,z:20},collType:ig.COLLTYPE.IGNORE,anims:{sheet:{src:"media/map/lab-entrance.png",width:16,height:16,offX:32,offY:96,xCount:1},renderMode:"lighter",SUB:[{name:"active",
time:1,frames:[1]},{name:"disabled",time:1,frames:[0]}]}},partyOffset:[{x:24,y:0},{x:-24,y:0},{x:0,y:4}],singlePerson:true};sc.ELEVATOR_TYPE.aridInner={size:{x:64,y:48,z:4},ground:{gfx:"media/map/arid-interior.png",x:384,y:368,w:64,h:56,flipX:false,offset:{x:0,y:0,z:0}},markerDir:"NORTH",stuckProbility:0.5,switchEntry:{pos:{x:24,y:0,z:4},size:{x:16,y:8,z:16},collType:ig.COLLTYPE.IGNORE,anims:{sheet:{src:"media/map/arid-interior.png",width:16,height:24,offX:448,offY:368,xCount:1},renderMode:"lighter",
SUB:[{name:"active",time:1,frames:[0]},{name:"disabled",time:1,frames:[-1]}]}}};sc.ELEVATOR_TYPE.aridInnerHuge={size:{x:448,y:256,z:4},ground:{gfx:"media/map/arid-interior-elevator.png",x:0,y:0,w:448,h:260,flipX:false,offset:{x:0,y:0,z:0}},markerDir:"NORTH",stuckProbility:0,speed:120,startDelta:64,switchEntry:{pos:{x:216,y:96,z:4},size:{x:16,y:8,z:16},collType:ig.COLLTYPE.IGNORE,anims:{sheet:{src:"media/map/arid-interior.png",width:16,height:24,offX:448,offY:368,xCount:1},renderMode:"lighter",SUB:[{name:"active",
time:1,frames:[0]},{name:"disabled",time:1,frames:[-1]}]},showFx:{sheet:"area.arid",name:"elevatorAppear"},hideFx:{sheet:"area.arid",name:"elevatorDisappear"}}};sc.ELEVATOR_TYPE.aridDngWeird={size:{x:64,y:13,z:4},ground:{gfx:"media/map/arid-scaffolding.png",x:416,y:352,w:64,h:32,flipX:false,offset:{x:0,y:0,z:0}},markerDir:"SOUTH",stuckProbility:0,switchEntry:{pos:{x:16,y:0,z:4},size:{x:16,y:2,z:14},collType:ig.COLLTYPE.IGNORE,anims:{sheet:{src:"media/map/arid-scaffolding.png",width:16,height:16,offX:480,
offY:352,xCount:1},SUB:[{name:"active",time:1,frames:[0]},{name:"disabled",time:1,frames:[0]}]}}};sc.ELEVATOR_TYPE.aridDngOutside={size:{x:48,y:32,z:4},ground:{gfx:"media/map/arid-dng-outside.png",x:304,y:24,w:48,h:56,flipX:false},markerDir:"SOUTH",stuckProbility:0,switchEntry:{pos:{x:19,y:0,z:4},size:{x:10,y:8,z:12},anims:{sheet:{src:"media/map/arid-dng-outside.png",width:16,height:24,offX:352,offY:32},SUB:[{name:"active",time:1,frames:[0]},{name:"disabled",time:1,frames:[0]}]}}};sc.ELEVATOR_TYPE.basinKeep=
{size:{x:32,y:48,z:1},ground:{gfx:"media/map/jungle-interior.png",x:480,y:416,w:32,h:96,flipX:false},markerDir:"SOUTH",stuckProbility:0,switchEntry:{pos:{x:16,y:0,z:0},size:{x:16,y:0,z:36},anims:{sheet:{src:"media/map/jungle-interior.png",width:16,height:16,offX:464,offY:416},offset:{z:16},SUB:[{name:"active",time:1,frames:[0]},{name:"disabled",time:1,frames:[0]}]}},posOffset:{x:0,y:-16},partyOffset:[{x:8,y:12},{x:-8,y:24},{x:0,y:16}],closeFrontDoor:true};sc.ELEVATOR_TYPE.finalDngMedium={size:{x:64,
y:48,z:1},ground:{gfx:"media/map/final-dungeon-elevator.png",x:128,y:0,w:64,h:72,flipX:false,offset:{x:0,y:0,z:-2}},markerDir:"SOUTH",stuckProbility:0,switchEntry:{pos:{x:24,y:1,z:1},size:{x:16,y:4,z:20},anims:{sheet:{src:"media/map/final-dungeon-elevator.png",width:16,height:24,offX:128,offY:72,xCount:2},offset:{x:0,y:0,z:0},SUB:[{name:"active",time:1,frames:[1]},{name:"disabled",time:1,frames:[0]}]},showFx:{sheet:"area.final",name:"elevatorOn"},hideFx:{sheet:"area.final",name:"elevatorOff"}}};sc.ELEVATOR_TYPE.finalDngLarge=
{size:{x:128,y:80,z:1},ground:{gfx:"media/map/final-dungeon-elevator.png",x:0,y:0,w:128,h:112,flipX:false,offset:{x:0,y:0,z:-2}},markerDir:"SOUTH",stuckProbility:0,switchEntry:{pos:{x:56,y:1,z:1},size:{x:16,y:4,z:20},anims:{sheet:{src:"media/map/final-dungeon-elevator.png",width:16,height:24,offX:128,offY:72,xCount:2},offset:{x:0,y:0,z:0},SUB:[{name:"active",time:1,frames:[1]},{name:"disabled",time:1,frames:[0]}]},showFx:{sheet:"area.final",name:"elevatorOn"},hideFx:{sheet:"area.final",name:"elevatorOff"}},
posOffset:{x:0,y:-16}};sc.ElevatorModel=ig.GameAddon.extend({sound:null,soundHandle:null,init:function(){this.parent("Elevator");ig.storage.register(this);ig.vars.registerVarAccessor("elevator",this)},startMoveSound:function(a){this.sound&&this.endMoveSound();this.sound=a.clone();a=this.sound.play(true);ig.soundManager.addNamedSound("_elevatorMoving",a)},endMoveSound:function(a){if(this.sound){this.sound.clearCached();this.sound=null;ig.soundManager.stopNamedSounds("_elevatorMoving");a&&a.play()}},
onStoragePreLoad:function(){this.endMoveSound()},onVarAccess:function(a,b){var c=b[1],e=ig.game.namedEntities[c];e||console.warn("Non-Existant Elevator: "+c);e instanceof ig.ENTITY.Elevator||console.warn("Entity of this name is not an elevator: "+c);if(b[2]==="dest")return e.getCurrentDest();console.warn("Unknown Elevator option:"+b[2])}});ig.addGameAddon(function(){return sc.elevatorModel=new sc.ElevatorModel});ig.LANG_CONTEXT.Elevator=function(){return"ELEVATOR"};var b=Vec2.create();ig.ENTITY.Elevator=
ig.Entity.extend({markerDir:null,markerFaceDir:Vec2.create(),elevatorData:null,ground:null,groundGfx:null,condition:null,startZ:0,targetZ:null,stopDelay:0,elevatorVel:0,destinations:[],stuckTimer:0,blockEvent:null,blockEventCondition:null,switchEntity:null,sounds:{},doTeleport:false,_wm:new ig.Config({spawnable:true,attributes:{name:{_type:"String",_info:"Name of the elevator. Used to teleport back to this elevator"},condition:{_type:"VarCondition",_info:"Condition for the elevator to be active",
_popup:true},spawnCondition:{_type:"VarCondition",_info:"Condition for the elevator be there!",_popup:true},elevatorType:{_type:"String",_info:"Type of elevator",_select:sc.ELEVATOR_TYPE},destinations:{_type:"ElevatorDests",_info:"Destinations of Elevator",_popup:true},blockEvent:{_type:"Event",_info:"Event to be performed when using the elevator",_popup:true,_optional:true},blockEventCondition:{_type:"VarCondition",_info:"Condition to show the block event when using the elevator"},faceDir:{_type:"String",
_info:"If defined: override face dir of marker",_select:ig.ActorEntity.FACE8,_optional:true}},label:function(){return"[ "+this.condition+" ]\n"+this.map+" > "+this.marker}}),init:function(a,b,c,e){this.parent(a,b,c,e);this.coll.type=ig.COLLTYPE.BLOCK;this.coll.zGravityFactor=0;this.map=e.map||null;this.marker=e.marker;this.startZ=this.coll.pos.z;this.moveHeight=e.moveHeight;this.sounds.start=new ig.Sound("media/sound/misc/elevator-loop.ogg",0.7);this.sounds.end=new ig.Sound("media/sound/misc/elevator-end.ogg",
0.7);this.faceDir=e.faceDir||null;if(a=sc.ELEVATOR_TYPE[e.elevatorType]){this.elevatorData=a;this.markerDir=this.faceDir||a.markerDir;ig.ActorEntity.getFaceVec(ig.ActorEntity.FACE8[this.markerDir]||0,this.markerFaceDir);this.ground=a.ground;this.groundGfx=new ig.Image(a.ground.gfx);Vec3.assign(this.coll.size,a.size)}this.initDestinatins(e.destinations);this.condition=new ig.VarCondition(e.condition);if(ig.game.marker===this.name)if(a=ig.vars.get("_system.elevator.exitVel")){this.targetZ=this.coll.pos.z;
this.elevatorVel=a;b=this.elevatorData.startDelta||32;this.setZPos(this.coll.pos.z+(a>0?-b:b));this.stopDelay=3}if(e.blockEvent){this.blockEvent=new ig.Event({name:"DOOR BLOCK EVENT",steps:e.blockEvent});this.blockEventCondition=new ig.VarCondition(e.blockEventCondition||"true")}},initDestinatins:function(a){if(a)for(var b=0;b<a.length;++b){var c=a[b];this.destinations.push({label:c.label,height:this.coll.pos.z+c.zMoveOffset,teleportMap:c.teleportMap,teleportMarker:c.teleportMarker,activeCondition:c.activeCondition,
showCondition:c.showCondition,addedSteps:c.addedSteps});ig.langEdit&&ig.langEdit.submitMap("Elevator "+b,new ig.LangLabel(c.label))}},initSprites:function(){this.setSpriteCount(1)},onKill:function(a){this.parent(a);this.sounds.start.clearCached();this.sounds.end.clearCached();this.groundGfx&&this.groundGfx.decreaseRef()},getCurrentDest:function(){if(this.targetZ!==null)return-1;for(var a=this.destinations.length;a--;)if(this.destinations[a].height===this.coll.pos.z)return a;return-1},show:function(a){this.parent(a);
if(this.elevatorData){var b=this.elevatorData.switchEntry;this.switchEntity=ig.game.spawnEntity(sc.ElevatorSwitchEntity,this.coll.pos.x+b.pos.x,this.coll.pos.y+b.pos.y,this.coll.pos.z+b.pos.z,{data:b,ground:this});this.switchEntity.setActive(this.condition.evaluate(),true)}if(!a){ig.game.effects.npc.spawnOnTarget("appear",this);for(var a=this.destinations.length,c=b=-1;a--;)this.destinations[a].height===this.coll.pos.z?c=a:b=a;if(b!=-1&&c!=-1){this.setZPos(this.destinations[b].height);this.moveToDestination(c)}}},
pressSwitch:function(){this.blockEvent&&this.blockEventCondition.evaluate()?sc.Cutscene.startCutscene(this.blockEvent):this.showElevatorOptions()},moveToDestination:function(a){sc.model.message.clearSide(sc.MESSAGE_SIDES_OR_ALL.ALL);if(a=this.destinations[a]){if(Math.abs(a.height-this.coll.pos.z)<ig.COLLISION.EPS)return;sc.elevatorModel.startMoveSound(this.sounds.start);this.targetZ=a.height;var b=this.elevatorData.speed||80;this.elevatorVel=this.targetZ<this.coll.pos.z?-b:b;if(Math.random()<=this.elevatorData.stuckProbility){this.stuckTimer=
0.1+0.2;this.coll.vel.z=this.elevatorVel/4}this.switchEntity.setMoving(true);a.teleportMap&&this.performTeleport(a);if(this.elevatorData.closeFrontDoor){a=ig.game.getEntitiesInRectangle(this.coll.pos.x,this.coll.pos.y+this.coll.size.y,this.coll.pos.z,this.coll.size.x,16,4,this);for(b=a.length;b--;)a[b]instanceof ig.ENTITY.Door&&a[b].close()}}ig.game.varsChangedDeferred()},performTeleport:function(a){var b=[ig.game.playerEntity];if(!this.elevatorData.singlePerson){sc.party.getPartyMemberEntityByIndex(0)&&
b.push(sc.party.getPartyMemberEntityByIndex(0));sc.party.getPartyMemberEntityByIndex(1)&&b.push(sc.party.getPartyMemberEntityByIndex(1))}for(var c=[],e=b.length;e--;)c.push({type:"DO_ACTION",entity:b[e],action:[{type:"WAIT_RANDOM",minTime:0.15,maxTime:0.25},{type:"SET_FACE",face:this.markerDir,rotate:true},{type:"WAIT",time:2}]});a.addedSteps&&c.push.apply(c,a.addedSteps);b=this.getCenter();b.y=b.y-(this.coll.pos.z+this.coll.size.z);b.y=b.y-1.25*this.elevatorVel;c.push({type:"SET_CAMERA_POS",pos:b,
speed:1,transition:"EASE_IN"});c.push({type:"WAIT",time:0.5});if(a.teleportMap){c.push({type:"TELEPORT",map:a.teleportMap,marker:a.teleportMarker});c.push({type:"WAIT",time:10});this.doTeleport=true}a=new ig.Event({steps:c});ig.game.events.callEvent(a,ig.EventRunType.PARALLEL);ig.vars.set("_system.elevator.exitVel",this.elevatorVel)},_addMoveEvent:function(a,b,c,e,f){if(b){var g=this.getAlignedPos(ig.ENTITY_ALIGN.BOTTOM);g.x=g.x+c;g.y=g.y+e;this.elevatorData.posOffset&&Vec2.add(g,this.elevatorData.posOffset);
c=[{type:"SET_WALK_ANIMS",config:"normal"},{type:"SET_COLL_TYPE",value:"IGNORE"},{type:"SET_RELATIVE_SPEED",value:1},{type:"NAVIGATE_TO_POINT",target:g,precise:false,distance:32,teleportOnFail:true,maxTime:1},{type:"SET_RELATIVE_SPEED",value:0.5},{type:"NAVIGATE_TO_POINT",target:g,precise:true,teleportOnFail:true,maxTime:0.5},{type:"SET_FACE",face:"NORTH",rotate:true}];!b.isPlayer&&this.elevatorData.singlePerson?c.push({type:"SET_FACE_TO_ENTITY",entity:ig.game.playerEntity,rotate:true}):c.push({type:"SET_FACE",
face:"NORTH",rotate:true});a.push({type:"DO_ACTION",entity:b,wait:f,action:c})}},showElevatorOptions:function(){for(var a=0,b=0,c=false,e=this.destinations.length;e--;){var f=this.destinations[e];if(f.height!==this.coll.pos.z){b=e;a++;c=c||!!f.teleportMap}}if(a){var g=a===1&&!c,e=ig.game.playerEntity,h=[];sc.party.getPartySize()>=1&&(this.elevatorData.partyOffset?this._addMoveEvent(h,sc.party.getPartyMemberEntityByIndex(0),this.elevatorData.partyOffset[0].x,this.elevatorData.partyOffset[0].y,false):
this._addMoveEvent(h,sc.party.getPartyMemberEntityByIndex(0),16,8,false));sc.party.getPartySize()>=2&&(this.elevatorData.partyOffset?this._addMoveEvent(h,sc.party.getPartyMemberEntityByIndex(1),this.elevatorData.partyOffset[1].x,this.elevatorData.partyOffset[1].y,false):this._addMoveEvent(h,sc.party.getPartyMemberEntityByIndex(1),-16,8,false));this._addMoveEvent(h,e,0,0,true);if(a>1){h.push({type:"ADD_MSG_PERSON",person:{person:sc.model.player.character.name,expression:sc.model.player.getOptionFace()},
side:"RIGHT",order:0,clearSide:false});a={type:"SHOW_CHOICE",person:{person:sc.model.player.character.name,expression:sc.model.player.getOptionFace()},options:[]};for(e=b=0;e<this.destinations.length;++e){f=this.destinations[e];a.options.push({label:f.label,activeCondition:f.activeCondition,showCondition:f.showCondition});c=[];this._addWaitSteps(c);c.push({type:"MOVE_ELEVATOR",entity:this,floorOption:e,wait:!!f.teleportMap});a[b]=c;b++}a.options.push({label:ig.lang.get("sc.map-content.elevator.cancel")});
a[b]=[];h.push(a)}else{g||h.push({type:"WAIT",time:0.1});this._addWaitSteps(h);h.push({type:"MOVE_ELEVATOR",entity:this,floorOption:b,wait:c})}h=new ig.Event({steps:h});g?ig.game.events.callEvent(h,ig.EventRunType.PARALLEL):sc.Cutscene.startCutscene(h)}},_addWaitSteps:function(a){var b=sc.party.getPartyMemberEntityByIndex(0);b&&a.push({type:"WAIT_UNTIL_ACTION_DONE",entity:b});(b=sc.party.getPartyMemberEntityByIndex(1))&&a.push({type:"WAIT_UNTIL_ACTION_DONE",entity:b})},update:function(){if(this.stopDelay>
0){this.stopDelay=this.stopDelay-1;if(this.stopDelay<=0){this.stopDelay=0;this.coll.vel.z=this.elevatorVel}}else if(this.targetZ!==null){this.coll.vel.z=this.coll.vel.z+this.elevatorVel*2*ig.system.tick;var a=(this.targetZ-this.coll.pos.z)*10;this.coll.vel.z=this.elevatorVel>0?this.coll.vel.z.limit(10,Math.min(a,this.elevatorVel)):this.coll.vel.z.limit(Math.max(a,this.elevatorVel),-10)}if(this.stuckTimer>0){a=this.stuckTimer;this.stuckTimer=this.stuckTimer-ig.system.tick;if(a>0.2&&this.stuckTimer<=
0.2){a=new ig.Rumble.RumbleHandle("RANDOM","WEAK","FAST",0.2,false,true);ig.rumble.addRumble(a)}if(this.stuckTimer<=0.2)this.coll.vel.z=0;if(this.stuckTimer<=0)this.stuckTimer=0}this.doTeleport||(this.targetZ!==null&&Math.abs(this.targetZ-this.coll.pos.z)<1?this.setArrived():this.targetZ!==null&&Math.abs(this.targetZ-this.coll.pos.z)<4&&sc.elevatorModel.endMoveSound(this.sounds.end));this.setPos(this.coll.pos.x,this.coll.pos.y,this.coll.pos.z+this.coll.vel.z*ig.system.tick,true);this.parent()},setArrived:function(){sc.elevatorModel.endMoveSound(this.sounds.end);
if(!this.elevatorData.noEndRunble){var a=new ig.Rumble.RumbleHandle("HORIZONTAL","WEAKEST","FAST",0.3,true);ig.rumble.addRumble(a)}this.setZPos(this.targetZ);ig.game.playerEntity.mapStartPos.z=this.coll.pos.z+this.coll.size.z;this.coll.vel.z=0;this.targetZ=null;this.switchEntity.setMoving(false);ig.game.varsChangedDeferred()},deferredUpdate:function(){this.switchEntity.setZPos(this.coll.pos.z+this.coll.size.z)},varsChanged:function(){this.switchEntity&&this.switchEntity.setActive(this.condition.evaluate())},
updateSprites:function(){var a=this.sprites[0];a.setEntityDefault(this,this.ground.w,this.ground.h,ig.ANIM_SHAPE_TYPE.Z_EXPAND,1,this.ground.offset,this.groundGfx,this.ground.x,this.ground.y);a.setFlip(this.ground.flipX,false)},applyMarkerPosition:function(a){this.placeEntity(a);if(a.isPlayer&&this.elevatorData.partyOffset)ig.game.postPlacementAction=this},onPostPlacementAction:function(){sc.party.getPartySize()>=1&&this.placeEntity(sc.party.getPartyMemberEntityByIndex(0),this.elevatorData.partyOffset[0],
this.elevatorData.singlePerson);sc.party.getPartySize()>=2&&this.placeEntity(sc.party.getPartyMemberEntityByIndex(1),this.elevatorData.partyOffset[1],this.elevatorData.singlePerson);ig.game.playerEntity.skin.pet&&this.placeEntity(ig.game.playerEntity.skin.pet,this.elevatorData.partyOffset[2])},placeEntity:function(a,d,c){if(a){var e=this.coll.pos.z+this.coll.size.z,f=this.coll.level;if(c){e=this.startZ;f=ig.game.getLevelIdx(e)}a.coll.level=f;a.coll.baseZPos=e;a.coll.pos.z=e;a.face.x=this.markerFaceDir.x;
a.face.y=this.markerFaceDir.y;c=this.getCenter(b);d&&Vec2.add(c,d);this.elevatorData.posOffset&&Vec2.add(c,this.elevatorData.posOffset);Vec2.addMulF(c,a.coll.size,-0.5);a.setPos(c.x,c.y)}}});sc.ElevatorSwitchEntity=ig.AnimatedEntity.extend({groundEntity:null,interactEntry:null,moving:false,active:false,interactIcons:{up:new sc.MapInteractIcon(new ig.TileSheet("media/gui/map-icon.png",24,24),{FOCUS:[22,23,24,0,20,21],NEAR:[25]},0.15),down:new sc.MapInteractIcon(new ig.TileSheet("media/gui/map-icon.png",
24,24),{FOCUS:[30,31,32,33,34,0,0],NEAR:[35]},0.15)},showFx:null,init:function(a,b,c,e){this.parent(a,b,c,e);this.coll.type=ig.COLLTYPE.VIRTUAL;this.groundEntity=e.ground;a=this.interactIcons.down;b=this.groundEntity.destinations;for(c=b.length;c--;)if(b[c].height>this.coll.pos.z){a=this.interactIcons.up;break}e=e.data;Vec3.assign(this.coll.size,e.size);this.initAnimations(e.anims);this.setCurrentAnim("active");e.collType&&this.coll.setType(e.collType);if(e.showFx)this.showFx=new ig.EffectHandle(e.showFx);
if(e.hideFx)this.hideFx=new ig.EffectHandle(e.hideFx);this.interactEntry=new sc.MapInteractEntry(this,this,a,sc.INTERACT_Z_CONDITION.SAME_Z,true);this._updateState()},setActive:function(a,b){if(this.active!=a&&!b){a&&this.showFx&&this.showFx.spawnOnTarget(this);!a&&this.hideFx&&this.hideFx.spawnOnTarget(this)}this.active=a;this._updateState()},setMoving:function(a){this.moving=a;this._updateState()},_updateState:function(){this.setCurrentAnim(this.active?"active":"disabled");!this.active||this.moving?
sc.mapInteract.removeEntry(this.interactEntry):sc.mapInteract.addEntry(this.interactEntry)},onInteraction:function(){this.groundEntity.pressSwitch()},onKill:function(a){sc.mapInteract.removeEntry(this.interactEntry);this.showFx&&this.showFx.clearCached();this.hideFx&&this.hideFx.clearCached();this.parent(a)}})});ig.baked=!0;
ig.module("game.feature.map-content.map-content-steps").requires("impact.base.action","impact.base.event").defines(function(){ig.EVENT_STEP.OPEN_RHOMBUS_MAP=ig.EventStepBase.extend({_wm:new ig.Config({attributes:{}}),_characterName:null,_mapName:null,init:function(b){this.quest=sc.quests.staticQuests[b.quest];this.npc=b.npc||null;this.map=b.map||null},start:function(b,a){b.done=false;sc.model.stopSkip();sc.model.skipBlock=true;var d=new sc.RhombusMapMenu(function(c,d,f){b.done=true;sc.model.skipBlock=
false;ig.game.teleport(c,d?new ig.TeleportPosition(d):null);c=new ig.Camera.TargetHandle(new ig.Camera.EntityTarget(f),0,0);c.setZoom(1.5);ig.camera.pushTarget(c,0.5,KEY_SPLINES.EASE_IN,null);a.addEventAttached(c)}.bind(this));ig.gui.addGuiElement(d)},run:function(b){return b.done}});ig.EVENT_STEP.MOVE_ELEVATOR=ig.EventStepBase.extend({entity:null,floorOption:0,_wm:new ig.Config({attributes:{entity:{_type:"Entity",_info:"Elevator Entity",_filterClass:"Elevator"},floorOption:{_type:"Number",_info:"The number of the floor option to use."},
wait:{_type:"Boolean",_info:"If true, wait until teleported"}}}),init:function(b){this.entity=b.entity;this.floorOption=b.floorOption;this.wait=b.wait},start:function(b,a){var d=ig.Event.getEntity(this.entity,a);d&&d instanceof ig.ENTITY.Elevator&&d.moveToDestination(this.floorOption)},run:function(){return!this.wait}});ig.EVENT_STEP.MOVE_ELEVATOR_START=ig.EventStepBase.extend({entity:null,floorOption:0,_wm:new ig.Config({attributes:{entity:{_type:"Entity",_info:"Elevator Entity",_filterClass:"Elevator"}}}),
init:function(b){this.entity=b.entity;this.floorOption=b.floorOption;this.wait=b.wait},start:function(b,a){var d=ig.Event.getEntity(this.entity,a);d&&d instanceof ig.ENTITY.Elevator&&d.moveToDestination(this.floorOption)},run:function(){return!this.wait}});ig.EVENT_STEP.UNTRIGGER_PROP=ig.EventStepBase.extend({entity:null,_wm:new ig.Config({attributes:{entity:{_type:"Entity",_info:"Prop entity",_filterClass:"Prop"}}}),init:function(b){this.entity=b.entity},start:function(b,a){var d=ig.Event.getEntity(this.entity,
a);d&&d instanceof ig.ENTITY.Prop&&d.untriggerProp()}})});ig.baked=!0;
ig.module("game.feature.map-content.gui.icon-hover-text").requires("impact.feature.gui.gui","impact.feature.gui.base.box","impact.feature.gui.base.basic-gui","game.feature.interact.map-interact").defines(function(){sc.IconHoverTextGui=ig.BoxGui.extend({transitions:{DEFAULT:{state:{alpha:1,offsetY:8},time:0.1,timeFunction:KEY_SPLINES.EASE_OUT},HIDDEN:{state:{scaleX:0.4,scaleY:0.5,alpha:0,offsetY:8},time:0.1,timeFunction:KEY_SPLINES.EASE_OUT}},ninepatch:new ig.NinePatch("media/gui/message.png",{width:4,
height:4,left:6,top:6,right:6,bottom:6,offsets:{"default":{x:0,y:112}}}),showOnNear:false,init:function(b,a,d,c){this.parent(134,20);this.hook.localAlpha=0.6;this.hook.pos.y=4+(a||0);this.showOnNear=d||false;d=a=0;if(c){d=new sc.TextGui(c,{font:sc.fontsystem.smallFont,maxWidth:134});d.setAlign(ig.GUI_ALIGN.X_CENTER,ig.GUI_ALIGN.Y_TOP);this.addChildGui(d);a=d.hook.size.y+1;d=d.hook.size.x}b=new sc.TextGui(b,{font:sc.fontsystem.smallFont,maxWidth:134});b.setAlign(ig.GUI_ALIGN.X_CENTER,c?ig.GUI_ALIGN.Y_TOP:
ig.GUI_ALIGN.Y_CENTER);b.setPos(0,a);this.addChildGui(b);if(b.hook.size.x>d)d=b.hook.size.x;this.setSize(Math.max(40,d+8),b.hook.size.y+4+a);this.setPivot(this.hook.size.x/2,this.hook.size.y);this.doStateTransition("HIDDEN",true)},setIconState:function(b){b==sc.INTERACT_ENTRY_STATE.FOCUS||this.showOnNear&&b==sc.INTERACT_ENTRY_STATE.NEAR?this.doStateTransition("DEFAULT"):this.doStateTransition("HIDDEN")},isActive:function(b){return b==sc.INTERACT_ENTRY_STATE.FOCUS},remove:function(){this.doStateTransition("HIDDEN",
false,true)}})});ig.baked=!0;
ig.module("game.feature.map-content.map-style").requires("impact.feature.map-content.map-style").defines(function(){ig.MapStyle.registerStyle("default","map",{sheet:"media/entity/style/default-map.png",hasDoorMat:true,teleportField:{x:0,y:160,xCount:3,zHeight:0}});ig.MapStyle.registerStyle("default","puzzle",{sheet:"media/entity/style/default-puzzle.png"});ig.MapStyle.registerStyle("default","puzzle2",{sheet:"media/entity/style/default-puzzle-2.png"});ig.MapStyle.registerStyle("default","destruct",
{sheet:"media/entity/style/default-destruct.png"});ig.MapStyle.registerStyle("default","walls",{colors:{blockFront:"#475ae2",blockTop:"#e6e9ff",pBlockFront:"#80ff83",pBlockTop:"#b3c9ff",npBlockFront:"#eb8835",npBlockTop:"#ffe2ca"}});ig.MapStyle.registerStyle("cargo-hold","map",{sheet:"media/entity/style/cargo-hold-map.png",hasDoorMat:true,teleportField:{x:0,y:160,xCount:3,zHeight:0}});ig.MapStyle.registerStyle("cargo-ship-outer","map",{sheet:"media/entity/style/cargo-outer-map.png",hasDoorMat:false});
ig.MapStyle.registerStyle("cargo-ship-bridge","map",{sheet:"media/entity/style/cargo-bridge-map.png",hasDoorMat:false});ig.MapStyle.registerStyle("rhombus-puzzle","map",{sheet:"media/entity/style/rhombus-dng-map.png",hasDoorMat:true,teleportField:{x:0,y:160,xCount:3,zHeight:0}});ig.MapStyle.registerStyle("rhombus-puzzle","puzzle",{sheet:"media/entity/style/rhombus-dng-puzzle.png"});ig.MapStyle.registerStyle("rhombus-puzzle","walls",{colors:{blockFront:"#71a3ff",blockTop:"#b6dcff",pBlockFront:"#80ff83",
pBlockTop:"#b3c9ff",npBlockFront:"#ffba80",npBlockTop:"#ffd6b3"}});ig.MapStyle.registerStyle("rhombus-outside","map",{sheet:"media/entity/style/rhombus-outside-map.png",hasDoorMat:false,doorGlow:{x:128,y:0,xCount:1},teleportField:{x:0,y:96,xCount:3,zHeight:0},doorVariations:{glass:{x:160,y:0,doorMat:false}}});ig.MapStyle.registerStyle("evo-outside","map",{sheet:"media/entity/style/evo-village-map.png",hasDoorMat:false,doorSound:"EVO",doorGlow:{x:128,y:0,xCount:1},teleportField:{x:0,y:160,xCount:3,
zHeight:0},doorVariations:{bright:{x:160,y:0,doorMat:false},transparent:{x:160,y:48,doorMat:false}}});ig.MapStyle.registerStyle("evo-inner","map",{sheet:"media/entity/style/evo-village-inner-map.png",hasDoorMat:false,doorSound:"EVO",doorVariations:{brick:{x:160,y:0}},stairDoor:{x:160,y:48}});ig.MapStyle.registerStyle("rhombus-interior","map",{sheet:"media/entity/style/rhombus-interior-map.png",hasDoorMat:true,doorGlow:{x:144,y:0,xCount:1,sideX:160,sideY:96},stairDoor:{x:176,y:48}});ig.MapStyle.registerStyle("rookie-harbor-outer",
"map",{sheet:"media/entity/style/rh-outer-map.png",hasDoorMat:false,teleportField:{x:0,y:48,xCount:3,zHeight:0}});ig.MapStyle.registerStyle("rookie-harbor-interior","map",{sheet:"media/entity/style/rh-interior-map.png",hasDoorMat:true,doorVariations:{wood:{x:160,y:0}},stairDoor:{x:160,y:48}});ig.MapStyle.registerStyle("hideout-outer","map",{sheet:"media/entity/style/hideout-outer-map.png",hasDoorMat:false,teleportField:{x:0,y:96,xCount:3,zHeight:0}});ig.MapStyle.registerStyle("hideout-inner","map",
{sheet:"media/entity/style/hideout-inner-map.png",hasDoorMat:false,doorVariations:{dark:{x:160,y:0}},stairDoor:{x:160,y:48}});ig.MapStyle.registerStyle("autumn","map",{sheet:"media/entity/style/autumn-map.png",hasDoorMat:true,teleportField:{x:0,y:160,xCount:3,zHeight:0}});ig.MapStyle.registerStyle("autumn","puzzle",{sheet:"media/entity/style/autumn-puzzle.png"});ig.MapStyle.registerStyle("cave","map",{sheet:"media/entity/style/cave.png",hasDoorMat:true,teleportField:{x:0,y:160,xCount:3,zHeight:0}});
ig.MapStyle.registerStyle("cave","effect",{sheet:"area.cold-dng"});ig.MapStyle.registerStyle("cave","destruct",{sheet:"media/entity/style/cave-destruct.png"});ig.MapStyle.registerStyle("cave","waterblock",{sheet:"media/map/heat-dng.png",x:384,y:304,puddleX:352,puddleY:448});ig.MapStyle.registerStyle("christmas","map",{sheet:"media/entity/style/cargo-hold-map.png",hasDoorMat:true});ig.MapStyle.registerStyle("christmas","destruct",{sheet:"media/entity/style/christmas-destruct.png"});ig.MapStyle.registerStyle("bergen-outer",
"map",{sheet:"media/entity/style/bergen-map.png",hasDoorMat:false,teleportField:{x:0,y:48,xCount:3,zHeight:0}});ig.MapStyle.registerStyle("bergen-outer","destruct",{sheet:"media/entity/style/cold-dng-destruct.png"});ig.MapStyle.registerStyle("bergen-inner","map",{sheet:"media/entity/style/bergen-inner-map.png",hasDoorMat:true,stairDoor:{x:160,y:48},teleportField:{x:0,y:48,xCount:3,zHeight:0},doorVariations:{wood:{x:160,y:0,doorMat:false}}});ig.MapStyle.registerStyle("bergen-inner","destruct",{sheet:"media/entity/style/cold-dng-destruct.png"});
ig.MapStyle.registerStyle("bergen-inner","puzzle",{sheet:"media/entity/style/bergen-inner-puzzle.png"});ig.MapStyle.registerStyle("cold-dng","map",{sheet:"media/entity/style/cold-dng-map.png",hasDoorMat:true,teleportField:{x:0,y:160,xCount:3,zHeight:0}});ig.MapStyle.registerStyle("cold-dng","puzzle",{sheet:"media/entity/style/cold-dng-puzzle.png"});ig.MapStyle.registerStyle("cold-dng","puzzle2",{sheet:"media/entity/style/cold-dng-puzzle-2.png"});ig.MapStyle.registerStyle("cold-dng","walls",{colors:{blockFront:"#71a3ff",
blockTop:"#b6dcff",pBlockFront:"#80ff83",pBlockTop:"#b3c9ff",npBlockFront:"#ffba80",npBlockTop:"#ffd6b3"}});ig.MapStyle.registerStyle("cold-dng","lorry",{sheet:"media/map/cold-dng.png",railX:176,railY:256,lorryX:128,lorryY:272});ig.MapStyle.registerStyle("cold-dng","effect",{sheet:"area.cold-dng"});ig.MapStyle.registerStyle("cold-dng","destruct",{sheet:"media/entity/style/cold-dng-destruct.png"});ig.MapStyle.registerStyle("heat-outer","map",{sheet:"media/entity/style/heat-map.png",hasDoorMat:false,
doorSound:"STONE",teleportField:{x:0,y:48,xCount:3,zHeight:0}});ig.MapStyle.registerStyle("heat-outer","destruct",{sheet:"media/entity/style/heat-destruct.png"});ig.MapStyle.registerStyle("heat-outer","quicksand",{sheet:"media/map/heat-area-hax.png",x:128,y:48});ig.MapStyle.registerStyle("heat-inner","map",{sheet:"media/entity/style/heat-interior-map.png",hasDoorMat:false,doorSound:"STONE",stairDoor:{x:160,y:0}});ig.MapStyle.registerStyle("heat-inner","puzzle",{sheet:"media/entity/style/heat-dng-puzzle.png"});
ig.MapStyle.registerStyle("heat-inner","puzzle2",{sheet:"media/entity/style/heat-dng-puzzle-2.png"});ig.MapStyle.registerStyle("heat-inner","destruct",{sheet:"media/entity/style/heat-dng-destruct.png"});ig.MapStyle.registerStyle("heat-dng","map",{sheet:"media/entity/style/heat-dng-map.png",hasDoorMat:true,doorSound:"STONE",teleportField:{x:0,y:160,xCount:3,zHeight:0},stairDoor:{x:160,y:0}});ig.MapStyle.registerStyle("heat-dng","puzzle",{sheet:"media/entity/style/heat-dng-puzzle.png"});ig.MapStyle.registerStyle("heat-dng",
"puzzle2",{sheet:"media/entity/style/heat-dng-puzzle-2.png"});ig.MapStyle.registerStyle("heat-dng","destruct",{sheet:"media/entity/style/heat-dng-destruct.png"});ig.MapStyle.registerStyle("heat-dng","waterblock",{sheet:"media/map/heat-dng.png",x:384,y:304,puddleX:352,puddleY:448});ig.MapStyle.registerStyle("heat-dng","pipes",{sheet:"media/map/heat-dng.png",x:320,y:144});ig.MapStyle.registerStyle("heat-dng","quicksand",{sheet:"media/map/heat-dng.png",x:160,y:272});ig.MapStyle.registerStyle("heat-dng",
"walls",{colors:{blockFront:"#5e5aac",blockTop:"#d6d4f6",pBlockFront:"#80ff83",pBlockTop:"#b3c9ff",npBlockFront:"#d95c3b",npBlockTop:"#e58c61"}});ig.MapStyle.registerStyle("heat-dng","lorry",{sheet:"media/map/heat-dng.png",railX:176,railY:304,lorryX:128,lorryY:304});ig.MapStyle.registerStyle("heat-dng","coals",{sheet:"media/map/heat-dng.png",x:432,y:144});ig.MapStyle.registerStyle("arid-outer","map",{sheet:"media/entity/style/arid-map.png",hasDoorMat:false,teleportField:{x:0,y:48,xCount:3,zHeight:0},
doorGlow:{x:128,y:0,xCount:1}});ig.MapStyle.registerStyle("arid-outer","puzzle",{sheet:"media/entity/style/arid-puzzle.png"});ig.MapStyle.registerStyle("arid-outer","puzzle2",{sheet:"media/entity/style/arid-puzzle-2.png"});ig.MapStyle.registerStyle("unknown-interior","map",{sheet:"media/entity/style/unknown-interior-map.png",hasDoorMat:true,doorGlow:{x:144,y:0,xCount:1,sideX:160,sideY:96}});ig.MapStyle.registerStyle("unknown-interior","puzzle",{sheet:"media/entity/style/unknown-interior-puzzle.png"});
ig.MapStyle.registerStyle("unknown-interior","puzzle2",{sheet:"media/entity/style/unknown-interior-puzzle-2.png"});ig.MapStyle.registerStyle("unknown-interior","pipes",{sheet:"media/map/arid-interior.png",x:176,y:368});ig.MapStyle.registerStyle("unknown-interior","pipeSwitch",{sheet:"media/map/arid-interior.png",x:224,y:432});ig.MapStyle.registerStyle("unknown-interior","propeller",{sheet:"media/map/arid-interior.png",x:192,y:480});ig.MapStyle.registerStyle("unknown-interior","destruct",{sheet:"media/entity/style/unknown-interior-destruct.png"});
ig.MapStyle.registerStyle("unknown-interior","magnet",{sheet:"media/map/arid-interior.png",x:256,y:512});ig.MapStyle.registerStyle("unknown-interior","tesla",{sheet:"media/map/arid-interior.png",x:288,y:544});ig.MapStyle.registerStyle("unknown-interior","teslaSwitch",{sheet:"media/map/arid-interior.png",x:256,y:544});ig.MapStyle.registerStyle("unknown-interior","anticompressor",{sheet:"media/map/arid-interior.png",x:288,y:592});ig.MapStyle.registerStyle("unknown-interior","dynPlatformSmall",{sheet:"media/map/arid-interior.png",
x:416,y:624});ig.MapStyle.registerStyle("unknown-interior","dynPlatformMedium",{sheet:"media/map/arid-interior.png",x:368,y:624});ig.MapStyle.registerStyle("unknown-interior","effect",{sheet:"area.cold-dng"});ig.MapStyle.registerStyle("unknown-interior","rotateBlocker",{sheet:"media/map/arid-interior.png",x:208,y:656});ig.MapStyle.registerStyle("unknown-interior","waveSwitch",{sheet:"media/map/arid-interior.png",x:224,y:736});ig.MapStyle.registerStyle("unknown-interior","waveblock",{sheet:"media/map/arid-interior.png",
x:304,y:656});ig.MapStyle.registerStyle("unknown-interior","waterblock",{sheet:"media/map/arid-interior.png",x:0,y:784,puddleX:144,puddleY:720});ig.MapStyle.registerStyle("unknown-interior","bouncer",{sheet:"media/map/arid-interior.png",x:128,y:880});ig.MapStyle.registerStyle("jungle-outer","map",{sheet:"media/entity/style/jungle-map.png",hasDoorMat:false,doorSound:"CLOTH",teleportField:{x:0,y:96,xCount:3,zHeight:0},doorGlow:{x:128,y:0,xCount:1},doorVariations:{blue:{x:160,y:0,doorMat:false,doorGlow:{x:288,
y:0,xCount:1}}}});ig.MapStyle.registerStyle("jungle-outer","destruct",{sheet:"media/entity/style/jungle-destruct.png"});ig.MapStyle.registerStyle("jungle-outer","puzzle",{sheet:"media/entity/style/shockwave-dng-puzzle.png"});ig.MapStyle.registerStyle("jungle-outer","puzzle2",{sheet:"media/entity/style/shockwave-dng-puzzle-2.png"});ig.MapStyle.registerStyle("jungle-outer","magnet",{sheet:"media/map/shockwave-dng.png",x:160,y:272});ig.MapStyle.registerStyle("tree-inner","map",{sheet:"media/entity/style/jungle-map.png",
hasDoorMat:false,doorSound:"CLOTH",teleportField:{x:0,y:96,xCount:3,zHeight:0},doorGlow:{x:128,y:0,xCount:1},doorVariations:{blue:{x:160,y:0,doorMat:false,doorGlow:{x:288,y:0,xCount:1}}}});ig.MapStyle.registerStyle("jungle-city","map",{sheet:"media/entity/style/jungle-city-map.png",hasDoorMat:false,doorGlow:{x:128,y:0,xCount:1},teleportField:{x:0,y:48,xCount:3,zHeight:0}});ig.MapStyle.registerStyle("jungle-city","destruct",{sheet:"media/entity/style/jungle-destruct.png"});ig.MapStyle.registerStyle("jungle-city",
"puzzle",{sheet:"media/entity/style/jungle-city-puzzle.png"});ig.MapStyle.registerStyle("jungle-city","puzzle2",{sheet:"media/entity/style/shockwave-dng-puzzle-2.png"});ig.MapStyle.registerStyle("jungle-city","magnet",{sheet:"media/map/shockwave-dng.png",x:160,y:272});ig.MapStyle.registerStyle("jungle-city","waveblock",{sheet:"media/entity/objects/cargoCrateTeleport.png",x:0,y:0});ig.MapStyle.registerStyle("jungle-city-inner","map",{sheet:"media/entity/style/jungle-interior-map.png",hasDoorMat:true,
stairDoor:{x:160,y:0},doorVariations:{metal:{x:160,y:48},elevator:{x:160,y:96}}});ig.MapStyle.registerStyle("jungle-city-inner","puzzle",{sheet:"media/entity/style/jungle-city-puzzle.png"});ig.MapStyle.registerStyle("jungle-city-inner","magnet",{sheet:"media/map/shockwave-dng.png",x:160,y:272});ig.MapStyle.registerStyle("jungle-city-inner","waveblock",{sheet:"media/entity/objects/cargoCrateTeleport.png",x:0,y:0});ig.MapStyle.registerStyle("shockwave-dng","map",{sheet:"media/entity/style/shockwave-dng-map.png",
hasDoorMat:true,doorSound:"STONE",teleportField:{x:0,y:160,xCount:3,zHeight:0},stairDoor:{x:160,y:0}});ig.MapStyle.registerStyle("shockwave-dng","puzzle",{sheet:"media/entity/style/shockwave-dng-puzzle.png"});ig.MapStyle.registerStyle("shockwave-dng","puzzle2",{sheet:"media/entity/style/shockwave-dng-puzzle-2.png"});ig.MapStyle.registerStyle("shockwave-dng","magnet",{sheet:"media/map/shockwave-dng.png",x:160,y:272});ig.MapStyle.registerStyle("shockwave-dng","bouncer",{sheet:"media/map/shockwave-dng-props.png",
x:0,y:0});ig.MapStyle.registerStyle("shockwave-dng","waterblock",{sheet:"media/map/shockwave-dng.png",x:384,y:304,puddleX:352,puddleY:448});ig.MapStyle.registerStyle("shockwave-dng","waveblock",{sheet:"media/map/shockwave-dng.png",x:96,y:480});ig.MapStyle.registerStyle("shockwave-dng","tesla",{sheet:"media/map/shockwave-dng.png",x:240,y:352});ig.MapStyle.registerStyle("shockwave-dng","waveSwitch",{sheet:"media/map/shockwave-dng.png",x:16,y:696});ig.MapStyle.registerStyle("shockwave-dng","anticompressor",
{sheet:"media/map/shockwave-dng.png",x:240,y:400});ig.MapStyle.registerStyle("shockwave-dng","dynPlatformSmall",{sheet:"media/map/shockwave-dng.png",x:48,y:640});ig.MapStyle.registerStyle("shockwave-dng","dynPlatformMedium",{sheet:"media/map/shockwave-dng.png",x:0,y:640});ig.MapStyle.registerStyle("shockwave-dng","lorry",{sheet:"media/map/shockwave-dng.png",railX:176,railY:304,lorryX:128,lorryY:304});ig.MapStyle.registerStyle("shockwave-dng","rotateBlocker",{sheet:"media/map/shockwave-dng.png",x:256,
y:720});ig.MapStyle.registerStyle("shockwave-dng","destruct",{sheet:"media/entity/style/shockwave-dng-destruct.png"});ig.MapStyle.registerStyle("lab","map",{sheet:"media/entity/style/lab-map.png",hasDoorMat:true,teleportField:{x:0,y:160,xCount:3,zHeight:0}});ig.MapStyle.registerStyle("lab","puzzle",{sheet:"media/entity/style/lab-interior-puzzle.png"});ig.MapStyle.registerStyle("lab","puzzle2",{sheet:"media/entity/style/lab-interior-puzzle-2.png"});ig.MapStyle.registerStyle("lab","pipes",{sheet:"media/map/lab.png",
x:0,y:576});ig.MapStyle.registerStyle("lab","pipeSwitch",{sheet:"media/map/lab.png",x:48,y:640});ig.MapStyle.registerStyle("lab","propeller",{sheet:"media/map/lab.png",x:0,y:688});ig.MapStyle.registerStyle("lab","destruct",{sheet:"media/entity/style/lab-interior-destruct.png"});ig.MapStyle.registerStyle("lab","magnet",{sheet:"media/map/lab.png",x:112,y:576});ig.MapStyle.registerStyle("lab","tesla",{sheet:"media/map/lab.png",x:144,y:608});ig.MapStyle.registerStyle("lab","teslaSwitch",{sheet:"media/map/lab.png",
x:112,y:608});ig.MapStyle.registerStyle("lab","anticompressor",{sheet:"media/map/lab.png",x:144,y:656});ig.MapStyle.registerStyle("lab","dynPlatformSmall",{sheet:"media/map/lab.png",x:408,y:672});ig.MapStyle.registerStyle("lab","dynPlatformMedium",{sheet:"media/map/lab.png",x:360,y:672});ig.MapStyle.registerStyle("lab","effect",{sheet:"area.cold-dng"});ig.MapStyle.registerStyle("lab","rotateBlocker",{sheet:"media/map/lab.png",x:192,y:608});ig.MapStyle.registerStyle("lab","waveSwitch",{sheet:"media/map/lab.png",
x:192,y:672});ig.MapStyle.registerStyle("lab","waveblock",{sheet:"media/map/lab.png",x:288,y:608});ig.MapStyle.registerStyle("lab","bouncer",{sheet:"media/map/lab.png",x:320,y:576});ig.MapStyle.registerStyle("lab","coals",{sheet:"media/map/lab.png",x:448,y:176});ig.MapStyle.registerStyle("final-dng-inner","walls",{colors:{blockFront:"#475ae2",blockTop:"#d9eeff",pBlockFront:"#80ff83",pBlockTop:"#b3c9ff",npBlockFront:"#eb8835",npBlockTop:"#fff7e5"},alpha:0.55});ig.MapStyle.registerStyle("final-dng-inner",
"map",{sheet:"media/entity/style/final-dng-map.png",hasDoorMat:true,teleportField:{x:0,y:160,xCount:3,zHeight:0},doorGlow:{x:144,y:0,xCount:1,sideX:160,sideY:96}});ig.MapStyle.registerStyle("final-dng-inner","puzzle",{sheet:"media/entity/style/final-dng-puzzle.png"});ig.MapStyle.registerStyle("final-dng-inner","puzzle2",{sheet:"media/entity/style/final-dng-puzzle-2.png"});ig.MapStyle.registerStyle("final-dng-inner","destruct",{sheet:"media/entity/style/final-dng-destruct.png"});ig.MapStyle.registerStyle("final-dng-inner",
"pipes",{sheet:"media/map/final-dungeon-inner.png",x:64,y:368});ig.MapStyle.registerStyle("final-dng-inner","pipeSwitch",{sheet:"media/map/final-dungeon-inner.png",x:112,y:432});ig.MapStyle.registerStyle("final-dng-inner","propeller",{sheet:"media/map/final-dungeon-inner.png",x:64,y:480});ig.MapStyle.registerStyle("final-dng-inner","magnet",{sheet:"media/map/final-dungeon-inner.png",x:176,y:368});ig.MapStyle.registerStyle("final-dng-inner","tesla",{sheet:"media/map/final-dungeon-inner.png",x:208,
y:400});ig.MapStyle.registerStyle("final-dng-inner","teslaSwitch",{sheet:"media/map/final-dungeon-inner.png",x:176,y:400});ig.MapStyle.registerStyle("final-dng-inner","anticompressor",{sheet:"media/map/final-dungeon-inner.png",x:208,y:448});ig.MapStyle.registerStyle("final-dng-inner","dynPlatformSmall",{sheet:"media/map/final-dungeon-inner.png",x:32,y:480});ig.MapStyle.registerStyle("final-dng-inner","dynPlatformMedium",{sheet:"media/map/final-dungeon-inner.png",x:424,y:464});ig.MapStyle.registerStyle("final-dng-inner",
"effect",{sheet:"area.cold-dng"});ig.MapStyle.registerStyle("final-dng-inner","rotateBlocker",{sheet:"media/map/final-dungeon-inner.png",x:256,y:400});ig.MapStyle.registerStyle("final-dng-inner","waveSwitch",{sheet:"media/map/final-dungeon-inner.png",x:256,y:464});ig.MapStyle.registerStyle("final-dng-inner","waveblock",{sheet:"media/map/final-dungeon-inner.png",x:352,y:400});ig.MapStyle.registerStyle("final-dng-inner","bouncer",{sheet:"media/map/final-dungeon-inner.png",x:384,y:368});ig.MapStyle.registerStyle("final-dng-inner",
"lorry",{sheet:"media/map/final-dungeon-inner.png",railX:304,railY:256,lorryX:464,lorryY:320});ig.MapStyle.registerStyle("final-dng-outer","map",{sheet:"media/entity/style/final-dng-outer-map.png",hasDoorMat:true,teleportField:{x:0,y:160,xCount:3,zHeight:0},doorGlow:{x:144,y:0,xCount:1,sideX:160,sideY:96}});ig.MapStyle.registerStyle("final-dng-outer","puzzle",{sheet:"media/entity/style/final-dng-puzzle.png"});ig.MapStyle.registerStyle("final-dng-outer","puzzle2",{sheet:"media/entity/style/final-dng-puzzle-2.png"});
ig.MapStyle.registerStyle("final-dng-outer","destruct",{sheet:"media/entity/style/final-dng-destruct.png"});ig.MapStyle.registerStyle("final-dng-space","ferro",{space:true});ig.MapStyle.registerStyle("office","map",{sheet:"media/entity/style/office-map.png",hasDoorMat:false,doorSound:"EVO"})});ig.baked=!0;
ig.module("game.feature.map-content.sc-doors").requires("impact.feature.map-content.entities.door").defines(function(){ig.DOOR_TYPE.COLD_DUNGEON={size:{x:64,y:16,z:64},preWait:1.3,openEffect:{sheet:"area.cold-dng",name:"masterDoorOpen"},anims:{shapeType:"Y_FLAT",sheet:{src:"media/map/cold-dng.png",width:48,height:64,xCount:2,offX:336,offY:576},SUB:[{frames:[0],offset:{x:-8,y:-2,z:0},SUB:[{name:"idle"},{name:"open",fx:[{type:"SLIDE",dir:"WEST",start:0,end:1,delay:0.4,duration:1,keySpline:"EASE_IN"}]},
{name:"close",fx:[{type:"SLIDE",dir:"WEST",start:1,end:0,duration:1,keySpline:"EASE_IN"}]}]},{frames:[1],offset:{x:8,y:-2,z:0},SUB:[{name:"idle"},{name:"open",fx:[{type:"SLIDE",dir:"EAST",start:0,end:1,delay:0.4,duration:1,keySpline:"EASE_IN"}]},{name:"close",fx:[{type:"SLIDE",dir:"EAST",start:1,end:0,duration:1,keySpline:"EASE_IN"}]}]}]}};ig.DOOR_TYPE.HEAT_DUNGEON_ENTRANCE={size:{x:56,y:16,z:48},preWait:1.3,preWaitFast:0.5,openEffect:{sheet:"area.heat-dng",name:"masterDoorOpen"},anims:{shapeType:"Y_FLAT",
frames:[0],SUB:[{sheet:{src:"media/map/heat-dng-exterior.png",width:32,height:28,xCount:1,offX:0,offY:128},offset:{x:-12,y:-2,z:0},SUB:[{name:"idle"},{name:"open",fx:[{type:"SLIDE",dir:"WEST",start:0,end:1,delay:0.4,duration:1,keySpline:"EASE_IN"},{type:"SLIDE",dir:"SOUTH",start:0,end:1,delay:0.4,duration:1,keySpline:"EASE_IN"}]},{name:"close",time:1,fx:[{type:"SLIDE",dir:"WEST",start:1,end:0,duration:1,keySpline:"EASE_IN"},{type:"SLIDE",dir:"SOUTH",start:1,end:0,duration:1,keySpline:"EASE_IN"}]}]},
{sheet:{src:"media/map/heat-dng-exterior.png",width:32,height:28,xCount:1,offX:32,offY:128},offset:{x:12,y:-2,z:0},SUB:[{name:"idle"},{name:"open",fx:[{type:"SLIDE",dir:"SOUTH",start:0,end:1,delay:0.4,duration:1,keySpline:"EASE_IN"},{type:"SLIDE",dir:"EAST",start:0,end:1,delay:0.4,duration:1,keySpline:"EASE_IN"}]},{name:"close",time:1,fx:[{type:"SLIDE",dir:"SOUTH",start:1,end:0,duration:1,keySpline:"EASE_IN"},{type:"SLIDE",dir:"EAST",start:1,end:0,duration:1,keySpline:"EASE_IN"}]}]},{sheet:{src:"media/map/heat-dng-exterior.png",
width:36,height:28,xCount:1,offX:0,offY:100},offset:{x:-10,y:-2,z:14},SUB:[{name:"idle"},{name:"open",fx:[{type:"SLIDE",dir:"NORTH",start:0,end:1,delay:0.4,duration:1,keySpline:"EASE_IN"},{type:"SLIDE",dir:"WEST",start:0,end:1,delay:0.4,duration:1,keySpline:"EASE_IN"}]},{name:"close",time:1,fx:[{type:"SLIDE",dir:"NORTH",start:1,end:0,duration:1,keySpline:"EASE_IN"},{type:"SLIDE",dir:"WEST",start:1,end:0,duration:1,keySpline:"EASE_IN"}]}]},{sheet:{src:"media/map/heat-dng-exterior.png",width:28,height:28,
xCount:1,offX:36,offY:100},offset:{x:14,y:-2,z:14},SUB:[{name:"idle"},{name:"open",fx:[{type:"SLIDE",dir:"NORTH",start:0,end:1,delay:0.4,duration:1,keySpline:"EASE_IN"},{type:"SLIDE",dir:"EAST",start:0,end:1,delay:0.4,duration:1,keySpline:"EASE_IN"}]},{name:"close",time:1,fx:[{type:"SLIDE",dir:"NORTH",start:1,end:0,duration:1,keySpline:"EASE_IN"},{type:"SLIDE",dir:"EAST",start:1,end:0,duration:1,keySpline:"EASE_IN"}]}]}]}};ig.DOOR_TYPE.HEAT_DUNGEON_MASTER_DOOR={size:{x:64,y:16,z:48},preWait:1.3,openEffect:{sheet:"area.heat-dng",
name:"masterDoorOpen"},anims:{shapeType:"Y_FLAT",frames:[0],SUB:[{sheet:{src:"media/map/heat-dng.png",width:36,height:28,xCount:1,offX:312,offY:512},offset:{x:-14,y:-2,z:0},SUB:[{name:"idle"},{name:"open",fx:[{type:"SLIDE",dir:"WEST",start:0,end:1,delay:0.4,duration:1,keySpline:"EASE_IN"},{type:"SLIDE",dir:"SOUTH",start:0,end:1,delay:0.4,duration:1,keySpline:"EASE_IN"}]},{name:"close",time:1,fx:[{type:"SLIDE",dir:"WEST",start:1,end:0,duration:1,keySpline:"EASE_IN"},{type:"SLIDE",dir:"SOUTH",start:1,
end:0,duration:1,keySpline:"EASE_IN"}]}]},{sheet:{src:"media/map/heat-dng.png",width:36,height:28,xCount:1,offX:348,offY:512},offset:{x:14,y:-2,z:0},SUB:[{name:"idle"},{name:"open",fx:[{type:"SLIDE",dir:"SOUTH",start:0,end:1,delay:0.4,duration:1,keySpline:"EASE_IN"},{type:"SLIDE",dir:"EAST",start:0,end:1,delay:0.4,duration:1,keySpline:"EASE_IN"}]},{name:"close",time:1,fx:[{type:"SLIDE",dir:"SOUTH",start:1,end:0,duration:1,keySpline:"EASE_IN"},{type:"SLIDE",dir:"EAST",start:1,end:0,duration:1,keySpline:"EASE_IN"}]}]},
{sheet:{src:"media/map/heat-dng.png",width:40,height:32,xCount:1,offX:312,offY:480},offset:{x:-12,y:-2,z:14},SUB:[{name:"idle"},{name:"open",fx:[{type:"SLIDE",dir:"NORTH",start:0,end:1,delay:0.4,duration:1,keySpline:"EASE_IN"},{type:"SLIDE",dir:"WEST",start:0,end:1,delay:0.4,duration:1,keySpline:"EASE_IN"}]},{name:"close",time:1,fx:[{type:"SLIDE",dir:"NORTH",start:1,end:0,duration:1,keySpline:"EASE_IN"},{type:"SLIDE",dir:"WEST",start:1,end:0,duration:1,keySpline:"EASE_IN"}]}]},{sheet:{src:"media/map/heat-dng.png",
width:32,height:32,xCount:1,offX:352,offY:480},offset:{x:16,y:-2,z:14},SUB:[{name:"idle"},{name:"open",fx:[{type:"SLIDE",dir:"NORTH",start:0,end:1,delay:0.4,duration:1,keySpline:"EASE_IN"},{type:"SLIDE",dir:"EAST",start:0,end:1,delay:0.4,duration:1,keySpline:"EASE_IN"}]},{name:"close",time:1,fx:[{type:"SLIDE",dir:"NORTH",start:1,end:0,duration:1,keySpline:"EASE_IN"},{type:"SLIDE",dir:"WEST",start:1,end:0,duration:1,keySpline:"EASE_IN"}]}]}]}};ig.DOOR_TYPE.SHOCKWAVE_DNG_DOOR={size:{x:64,y:16,z:48},
preWait:1.3,preWaitFast:0.5,openEffect:{sheet:"area.shockwave-dng",name:"masterDoorOpen"},openEffectFast:{sheet:"area.shockwave-dng",name:"masterDoorOpenFast"},anims:{shapeType:"Y_FLAT",frames:[0],SUB:[{sheet:{src:"media/map/jungle-props.png",width:36,height:28,xCount:1,offX:440,offY:464},offset:{x:-14,y:-2,z:0},SUB:[{name:"idle"},{name:"open",fx:[{type:"SLIDE",dir:"WEST",start:0,end:1,delay:0.4,duration:1,keySpline:"EASE_IN"},{type:"SLIDE",dir:"SOUTH",start:0,end:1,delay:0.4,duration:1,keySpline:"EASE_IN"}]},
{name:"openFast",fx:[{type:"SLIDE",dir:"WEST",start:0,end:1,delay:0.2,duration:0.8,keySpline:"EASE_IN"},{type:"SLIDE",dir:"SOUTH",start:0,end:1,delay:0.2,duration:0.8,keySpline:"EASE_IN"}]},{name:"close",time:1,fx:[{type:"SLIDE",dir:"WEST",start:1,end:0,duration:1,keySpline:"EASE_IN"},{type:"SLIDE",dir:"SOUTH",start:1,end:0,duration:1,keySpline:"EASE_IN"}]}]},{sheet:{src:"media/map/jungle-props.png",width:36,height:28,xCount:1,offX:476,offY:464},offset:{x:14,y:-2,z:0},SUB:[{name:"idle"},{name:"open",
fx:[{type:"SLIDE",dir:"SOUTH",start:0,end:1,delay:0.4,duration:1,keySpline:"EASE_IN"},{type:"SLIDE",dir:"EAST",start:0,end:1,delay:0.4,duration:1,keySpline:"EASE_IN"}]},{name:"openFast",fx:[{type:"SLIDE",dir:"SOUTH",start:0,end:1,delay:0.2,duration:0.8,keySpline:"EASE_IN"},{type:"SLIDE",dir:"EAST",start:0,end:1,delay:0.2,duration:0.8,keySpline:"EASE_IN"}]},{name:"close",time:1,fx:[{type:"SLIDE",dir:"SOUTH",start:1,end:0,duration:1,keySpline:"EASE_IN"},{type:"SLIDE",dir:"EAST",start:1,end:0,duration:1,
keySpline:"EASE_IN"}]}]},{sheet:{src:"media/map/jungle-props.png",width:40,height:32,xCount:1,offX:440,offY:432},offset:{x:-12,y:-2,z:14},SUB:[{name:"idle"},{name:"open",fx:[{type:"SLIDE",dir:"NORTH",start:0,end:1,delay:0.4,duration:1,keySpline:"EASE_IN"},{type:"SLIDE",dir:"WEST",start:0,end:1,delay:0.4,duration:1,keySpline:"EASE_IN"}]},{name:"openFast",fx:[{type:"SLIDE",dir:"NORTH",start:0,end:1,delay:0.2,duration:0.8,keySpline:"EASE_IN"},{type:"SLIDE",dir:"WEST",start:0,end:1,delay:0.2,duration:0.8,
keySpline:"EASE_IN"}]},{name:"close",time:1,fx:[{type:"SLIDE",dir:"NORTH",start:1,end:0,duration:1,keySpline:"EASE_IN"},{type:"SLIDE",dir:"WEST",start:1,end:0,duration:1,keySpline:"EASE_IN"}]}]},{sheet:{src:"media/map/jungle-props.png",width:32,height:32,xCount:1,offX:480,offY:432},offset:{x:16,y:-2,z:14},SUB:[{name:"idle"},{name:"open",fx:[{type:"SLIDE",dir:"NORTH",start:0,end:1,delay:0.4,duration:1,keySpline:"EASE_IN"},{type:"SLIDE",dir:"EAST",start:0,end:1,delay:0.4,duration:1,keySpline:"EASE_IN"}]},
{name:"openFast",fx:[{type:"SLIDE",dir:"NORTH",start:0,end:1,delay:0.2,duration:0.8,keySpline:"EASE_IN"},{type:"SLIDE",dir:"EAST",start:0,end:1,delay:0.2,duration:0.8,keySpline:"EASE_IN"}]},{name:"close",time:1,fx:[{type:"SLIDE",dir:"NORTH",start:1,end:0,duration:1,keySpline:"EASE_IN"},{type:"SLIDE",dir:"EAST",start:1,end:0,duration:1,keySpline:"EASE_IN"}]}]}]}};ig.DOOR_TYPE.FINAL_DNG_DOOR={size:{x:64,y:16,z:48},preWait:1.3,preWaitFast:0.5,openEffect:{sheet:"area.shockwave-dng",name:"masterDoorOpen"},
openEffectFast:{sheet:"area.shockwave-dng",name:"masterDoorOpenFast"},anims:{shapeType:"Y_FLAT",frames:[0],SUB:[{sheet:{src:"media/map/final-dungeon-outer-props.png",width:24,height:24,xCount:3,offX:0,offY:480},offset:{x:0,y:-3,z:12},SUB:[{name:"idle"},{name:"open",frames:[1,2],time:0.15,fx:[{type:"SLIDE",dir:"NORTH",start:0,end:1,delay:0,duration:0.8,keySpline:"EASE_IN"}]},{name:"openFast",frames:[1,2],time:0.15,fx:[{type:"SLIDE",dir:"NORTH",start:0,end:1,delay:0.2,duration:0.3,keySpline:"EASE_IN"}]},
{name:"close",time:1,fx:[{type:"SLIDE",dir:"NORTH",start:1,end:0,duration:1,keySpline:"EASE_IN"}]}]},{sheet:{src:"media/map/final-dungeon-outer-props.png",width:32,height:48,xCount:1,offX:0,offY:432},offset:{x:-16,y:-2,z:0},SUB:[{name:"idle"},{name:"open",fx:[{type:"SLIDE",dir:"WEST",start:0,end:1,delay:0.4,duration:1,keySpline:"EASE_IN"}]},{name:"openFast",fx:[{type:"SLIDE",dir:"WEST",start:0,end:1,delay:0.3,duration:0.5,keySpline:"EASE_IN"}]},{name:"close",time:1,fx:[{type:"SLIDE",dir:"WEST",start:1,
end:0,duration:1,keySpline:"EASE_IN"}]}]},{sheet:{src:"media/map/final-dungeon-outer-props.png",width:32,height:48,xCount:1,offX:32,offY:432},offset:{x:16,y:-2,z:0},SUB:[{name:"idle"},{name:"open",fx:[{type:"SLIDE",dir:"EAST",start:0,end:1,delay:0.4,duration:1,keySpline:"EASE_IN"}]},{name:"openFast",fx:[{type:"SLIDE",dir:"EAST",start:0,end:1,delay:0.3,duration:0.5,keySpline:"EASE_IN"}]},{name:"close",time:1,fx:[{type:"SLIDE",dir:"EAST",start:1,end:0,duration:1,keySpline:"EASE_IN"}]}]},{sheet:{src:"media/map/final-dungeon-outer-props.png",
width:48,height:24,xCount:1,offX:64,offY:432},offset:{x:0,y:-2,z:24},SUB:[{name:"idle"},{name:"open",fx:[{type:"SLIDE",dir:"NORTH",start:0,end:1,delay:0.4,duration:1,keySpline:"EASE_IN"}]},{name:"openFast",fx:[{type:"SLIDE",dir:"NORTH",start:0,end:1,delay:0.3,duration:0.5,keySpline:"EASE_IN"}]},{name:"close",time:1,fx:[{type:"SLIDE",dir:"NORTH",start:1,end:0,duration:1,keySpline:"EASE_IN"}]}]},{sheet:{src:"media/map/final-dungeon-outer-props.png",width:48,height:24,xCount:1,offX:64,offY:456},offset:{x:0,
y:-2,z:0},SUB:[{name:"idle"},{name:"open",fx:[{type:"SLIDE",dir:"SOUTH",start:0,end:1,delay:0.4,duration:1,keySpline:"EASE_IN"}]},{name:"openFast",fx:[{type:"SLIDE",dir:"SOUTH",start:0,end:1,delay:0.1,duration:0.6,keySpline:"EASE_IN"}]},{name:"close",time:1,fx:[{type:"SLIDE",dir:"SOUTH",start:1,end:0,duration:1,keySpline:"EASE_IN"}]}]}]}};ig.DOOR_TYPE.FINAL_DNG_DOOR_SAPPHIRE={size:{x:112,y:16,z:80},preWait:1.3,preWaitFast:0.5,openEffect:{sheet:"area.shockwave-dng",name:"masterDoorOpen"},openEffectFast:{sheet:"area.shockwave-dng",
name:"masterDoorOpenFast"},anims:{shapeType:"Y_FLAT",frames:[0],SUB:[{sheet:{src:"media/map/forest-plate.png",width:80,height:40,xCount:1,offX:288,offY:208},offset:{x:0,y:-2,z:0},SUB:[{name:"idle"},{name:"open",fx:[{type:"SLIDE",dir:"SOUTH",start:0,end:1,delay:0.4,duration:1,keySpline:"EASE_IN"}]},{name:"openFast",fx:[{type:"SLIDE",dir:"SOUTH",start:0,end:1,delay:0.1,duration:0.6,keySpline:"EASE_IN"}]},{name:"close",time:1,fx:[{type:"SLIDE",dir:"SOUTH",start:1,end:0,duration:1,keySpline:"EASE_IN"}]}]},
{sheet:{src:"media/map/forest-plate.png",width:56,height:48,xCount:1,offX:288,offY:160},offset:{x:-28,y:-2,z:0},SUB:[{name:"idle"},{name:"open",fx:[{type:"SLIDE",dir:"WEST",start:0,end:1,delay:0.4,duration:1,keySpline:"EASE_IN"}]},{name:"openFast",fx:[{type:"SLIDE",dir:"WEST",start:0,end:1,delay:0.3,duration:0.5,keySpline:"EASE_IN"}]},{name:"close",time:1,fx:[{type:"SLIDE",dir:"WEST",start:1,end:0,duration:1,keySpline:"EASE_IN"}]}]},{sheet:{src:"media/map/forest-plate.png",width:56,height:48,xCount:1,
offX:344,offY:160},offset:{x:28,y:-2,z:0},SUB:[{name:"idle"},{name:"open",fx:[{type:"SLIDE",dir:"EAST",start:0,end:1,delay:0.4,duration:1,keySpline:"EASE_IN"}]},{name:"openFast",fx:[{type:"SLIDE",dir:"EAST",start:0,end:1,delay:0.3,duration:0.5,keySpline:"EASE_IN"}]},{name:"close",time:1,fx:[{type:"SLIDE",dir:"EAST",start:1,end:0,duration:1,keySpline:"EASE_IN"}]}]},{sheet:{src:"media/map/forest-plate.png",width:32,height:32,xCount:1,offX:368,offY:208},offset:{x:0,y:-2,z:26},SUB:[{name:"idle"},{name:"open",
frames:[0,0],time:0.15,fx:[{type:"SLIDE",dir:"NORTH",start:0,end:1,delay:0,duration:0.8,keySpline:"EASE_IN"}]},{name:"openFast",frames:[0,0],time:0.15,fx:[{type:"SLIDE",dir:"NORTH",start:0,end:1,delay:0.2,duration:0.3,keySpline:"EASE_IN"}]},{name:"close",time:1,fx:[{type:"SLIDE",dir:"NORTH",start:1,end:0,duration:1,keySpline:"EASE_IN"}]}]},{sheet:{src:"media/map/forest-plate.png",width:56,height:32,xCount:1,offX:288,offY:128},offset:{x:-28,y:-2,z:40},SUB:[{name:"idle"},{name:"open",fx:[{type:"SLIDE",
dir:"WEST",start:0,end:1,delay:0.4,duration:1,keySpline:"EASE_IN"}]},{name:"openFast",fx:[{type:"SLIDE",dir:"WEST",start:0,end:1,delay:0.3,duration:0.5,keySpline:"EASE_IN"}]},{name:"close",time:1,fx:[{type:"SLIDE",dir:"WEST",start:1,end:0,duration:1,keySpline:"EASE_IN"}]}]},{sheet:{src:"media/map/forest-plate.png",width:56,height:32,xCount:1,offX:344,offY:128},offset:{x:28,y:-2,z:40},SUB:[{name:"idle"},{name:"open",fx:[{type:"SLIDE",dir:"EAST",start:0,end:1,delay:0.4,duration:1,keySpline:"EASE_IN"}]},
{name:"openFast",fx:[{type:"SLIDE",dir:"EAST",start:0,end:1,delay:0.3,duration:0.5,keySpline:"EASE_IN"}]},{name:"close",time:1,fx:[{type:"SLIDE",dir:"EAST",start:1,end:0,duration:1,keySpline:"EASE_IN"}]}]},{sheet:{src:"media/map/forest-plate.png",width:64,height:32,xCount:1,offX:288,offY:96},offset:{x:0,y:-2,z:46},SUB:[{name:"idle"},{name:"open",fx:[{type:"SLIDE",dir:"NORTH",start:0,end:1,delay:0.4,duration:1,keySpline:"EASE_IN"}]},{name:"openFast",fx:[{type:"SLIDE",dir:"NORTH",start:0,end:1,delay:0.3,
duration:0.5,keySpline:"EASE_IN"}]},{name:"close",time:1,fx:[{type:"SLIDE",dir:"NORTH",start:1,end:0,duration:1,keySpline:"EASE_IN"}]}]}]}}});ig.baked=!0;
ig.module("game.feature.map-content.prop-interact").requires("impact.feature.map-content.entities.prop","game.feature.map-content.gui.icon-hover-text").defines(function(){sc.PROP_INTERACT_ICONS={INFO:{noEvent:new sc.MapInteractIcon(new ig.TileSheet("media/gui/map-icon.png",40,24,0,168),{FOCUS:[0],NEAR:[1]},0.1),withEvent:new sc.MapInteractIcon(new ig.TileSheet("media/gui/map-icon.png",40,24,0,168),{FOCUS:[2],NEAR:[3]},0.1)},GRAB:{noEvent:new sc.MapInteractIcon(new ig.TileSheet("media/gui/map-icon.png",
24,24),{FOCUS:[40,41,42,41],NEAR:[43]},0.2),withEvent:new sc.MapInteractIcon(new ig.TileSheet("media/gui/map-icon.png",24,24),{FOCUS:[40,41,42,41],NEAR:[43]},0.2)}};sc.PropInteract=ig.Class.extend({prop:null,icon:null,interactEntry:null,permaEffect:null,event:null,combatOkay:false,cutsceneType:null,init:function(b,a){this.prop=b;this.icon=sc.PROP_INTERACT_ICONS[a.icon||"INFO"];if(a.event)this.event=new ig.Event({steps:sc.Cutscene.getLookAtEventSteps(a.event,b)});if(a.permaEffect)this.permaEffect=
new ig.EffectHandle(a.permaEffect);var d=this.event?this.icon.withEvent:this.icon.noEvent;this.combatOkay=a.combatOkay||false;this.cutsceneType=a.cutsceneType||null;this.interactEntry=new sc.MapInteractEntry(this.prop,this,d,sc.INTERACT_Z_CONDITION.Z_RANGE_OVERLAP,true);this.interactEntry.blockedDuringCombat=a.combatOkay!=void 0?!a.combatOkay:true;if(a.hoverText){d=new sc.IconHoverTextGui(new ig.LangLabel(a.hoverText),null,null,a.title?new ig.LangLabel(a.title):null);this.interactEntry.setSubGui(d)}},
onShow:function(){sc.mapInteract.addEntry(this.interactEntry);if(this.permaEffect)return true},onPermaUpdate:function(){if(this.prop.effects.interactPermaHandle){this.prop.effects.interactPermaHandle.stop();this.prop.effects.interactPermaHandle=null}if(this.permaEffect)this.prop.effects.interactPermaHandle=this.permaEffect.spawnOnTarget(this.prop,{duration:-1})},onHide:function(){sc.mapInteract.removeEntry(this.interactEntry);if(this.prop.effects.interactPermaHandle){this.prop.effects.interactPermaHandle.stop();
this.prop.effects.interactPermaHandle=null}},onKill:function(){sc.mapInteract.removeEntry(this.interactEntry);this.event&&this.event.clearCached();this.permaEffect&&this.permaEffect.clearCached()},onInteraction:function(){if(this.event)sc.Cutscene.startEvent(ig.EVENT_TYPE[this.cutsceneType||"CUTSCENE"],this.event,null,this.prop);else return false}});ig.PROP_INTERACT_CLASS=sc.PropInteract});ig.baked=!0;
ig.module("game.feature.map-content.entities.jump-panel").requires("impact.base.entity","impact.feature.effect.effect-sheet").defines(function(){var b={2:{zVel:280,height:32,effectDuration:0.25},3:{zVel:315,height:48,effectDuration:0.3},4:{zVel:350,height:64,effectDuration:0.35},6:{zVel:420,height:96,effectDuration:0.45},8:{zVel:490,height:128,effectDuration:0.55}},a=Vec3.create(),d=Vec3.create();ig.ENTITY.JumpPanel=ig.AnimatedEntity.extend({effects:new ig.EffectSheet("puzzle"),jumpHeightData:null,
condition:null,_wm:new ig.Config({spawnable:true,attributes:{jumpHeight:{_type:"String",_info:"How height to jump (in tiles).",_select:b},condition:{_type:"VarCondition",_info:"A condition for this if any. ",_popup:true}}}),init:function(a,c,d,e){this.parent(a,c,d,e);this.jumpHeightData=b[e.jumpHeight]||b["2"];this.condition=new ig.VarCondition(e.condition||"");this.isOn=this.condition.evaluate();this.coll.type=ig.COLLTYPE.BLOCK;this.coll.setSize(16,16,0);this.initAnimations({sheet:{src:"media/entity/objects/object-effects.png",
width:16,height:16},gfxOffset:{x:0,y:-1},SUB:[{name:"off",time:0.2,frames:[]},{name:"normal",time:0.15,frames:[6,7,8,9,10],repeat:true,globalTiming:true},{name:"glow",time:0.05,frames:[0,0,0,0,0,0,0,0,1,2,3,4,5]}]});window.wm?this.setCurrentAnim("glow"):this.setCurrentAnim(this.isOn?"normal":"off");ig.navigation.registerInfluencer(this)},onTopEntityJump:function(a){if(!this.condition.evaluate()&&a.party==sc.COMBATANT_PARTY.PLAYER)return false;a.coll.float.height?a.doFloatJump(this.jumpHeightData.zVel*
0.43,this.jumpHeightData.effectDuration+0.1,100):a.doJump(this.jumpHeightData.zVel,this.jumpHeightData.height,100,void 0,false);this.effects.spawnOnTarget("jumpTrail",a,{duration:this.jumpHeightData.effectDuration});this.effects.spawnOnTarget("jumpButtom",this);this.setCurrentAnim("glow",true,this.isOn?"normal":"off",true);return true},varsChanged:function(){var a=this.condition.evaluate();if(this.isOn!=a){(this.isOn=a)&&this.effects.spawnOnTarget("jumpButtom",this);this.setCurrentAnim(a?"normal":
"off");this.onNavMapInfluence()}},onNavMapInfluence:function(){var b=this.getAlignedPos(ig.ENTITY_ALIGN.BOTTOM,a),c=Vec3.assign(d,b);Vec3.addC(c,0,-16,this.jumpHeightData.height);(b=ig.navigation.getNodeConnection(b,c,ig.NAV_CONNECTION_TYPE.UPPER_LEVEL))&&b.setExternalData("partyBlocked",!this.isOn)}});var c={FALL:{zVel:155,height:16,speed:150,effectDuration:1.5},FALL_LONG:{zVel:155,height:16,speed:130,effectDuration:3},9:{zVel:160,height:16,speed:360,effectDuration:0.4},10:{zVel:160,height:16,speed:400,
effectDuration:0.45},12:{zVel:200,height:16,speed:400,effectDuration:0.5},14:{zVel:230,height:16,speed:400,effectDuration:0.55},16:{zVel:240,height:16,speed:400,effectDuration:0.62},18:{zVel:270,height:16,speed:400,effectDuration:0.68},20:{zVel:290,height:16,speed:420,effectDuration:0.74},22:{zVel:310,height:16,speed:440,effectDuration:0.8},24:{zVel:320,height:16,speed:460,effectDuration:0.82},26:{zVel:330,height:16,speed:480,effectDuration:0.84},28:{zVel:340,height:16,speed:500,effectDuration:0.86},
30:{zVel:350,height:16,speed:520,effectDuration:0.88},32:{zVel:360,height:16,speed:540,effectDuration:0.9},34:{zVel:370,height:16,speed:560,effectDuration:0.92},36:{zVel:380,height:16,speed:580,effectDuration:0.94},48:{zVel:440,height:16,speed:670,effectDuration:1.12},54:{zVel:470,height:16,speed:700,effectDuration:1.12}},e={NORTH:{dir:{x:0,y:-1},size:{x:16,y:24},tileOffset:8,flipX:false,gfxOffset:{x:0,y:-5}},EAST:{dir:{x:1,y:0},size:{x:24,y:16},tileOffset:0,flipX:false,gfxOffset:{x:1,y:0}},SOUTH:{dir:{x:0,
y:1},size:{x:16,y:24},tileOffset:16,flipX:false,gfxOffset:{x:0,y:-6}},WEST:{dir:{x:-1,y:0},size:{x:24,y:16},tileOffset:0,flipX:true,gfxOffset:{x:-1,y:0}}};ig.ENTITY.JumpPanelFar=ig.AnimatedEntity.extend({panelType:null,effects:new ig.EffectSheet("puzzle"),jumpHeightData:null,condition:null,_wm:new ig.Config({spawnable:true,attributes:{panelType:{_type:"String",_info:"Type of jump Panel",_select:e},jumpDistance:{_type:"String",_info:"How height to jump (in tiles).",_select:c},condition:{_type:"VarCondition",
_info:"A condition for this if any."}}}),init:function(a,b,d,f){this.parent(a,b,d,f);this.panelType=e[f.panelType]||e.NORTH;this.jumpDistance=c[f.jumpDistance]||c["12"];this.condition=new ig.VarCondition(f.condition||"");this.isOn=this.condition.evaluate();this.coll.type=ig.COLLTYPE.BLOCK;this.coll.setSize(this.panelType.size.x,this.panelType.size.y,0);this.initAnimations({sheet:{src:"media/entity/objects/object-effects.png",width:16,height:16,offY:16,xCount:8},gfxOffset:this.panelType.gfxOffset,
tileOffset:this.panelType.tileOffset,flipX:this.panelType.flipX,renderMode:"lighter",SUB:[{name:"off",time:0.2,frames:[]},{name:"normal",time:0.15,frames:[4,5,6,7],repeat:true,globalTiming:true},{name:"glow",time:0.05,frames:[0,0,0,0,0,0,0,0,1,2,3]}]});window.wm?this.setCurrentAnim("glow"):this.setCurrentAnim(this.condition.evaluate()?"normal":"off");ig.navigation.registerInfluencer(this)},onTopEntityJumpFar:function(a){if(!this.condition.evaluate()&&a.party==sc.COMBATANT_PARTY.PLAYER)return false;
Vec2.assign(a.coll.vel,this.panelType.dir);Vec2.length(a.coll.vel,this.jumpDistance.speed);Vec2.assign(a.coll.accelDir,this.panelType.dir);Vec2.assign(a.face,this.panelType.dir);a.coll.float.height?a.doFloatJump(10,this.jumpDistance.effectDuration+0.1,this.jumpDistance.speed):a.doJump(this.jumpDistance.zVel,this.jumpDistance.height,this.jumpDistance.speed,0,false);a.coll.friction.air=0;this.effects.spawnOnTarget("jumpTrailFar",a,{duration:this.jumpDistance.effectDuration});this.effects.spawnOnTarget("jumpButtom",
this);this.setCurrentAnim("glow",true,this.isOn?"normal":"off",true);return true},varsChanged:function(){var a=this.condition.evaluate();if(this.isOn!=a){(this.isOn=a)&&this.effects.spawnOnTarget("jumpButtom",this);this.setCurrentAnim(a?"normal":"off");this.onNavMapInfluence()}},onNavMapInfluence:function(){var b=this.getAlignedPos(ig.ENTITY_ALIGN.BOTTOM,a),c=Vec3.assign(d,b);Vec2.addMulF(c,this.panelType.dir,16);(b=ig.navigation.getNodeConnection(b,c))&&b.setExternalData("partyBlocked",!this.isOn)}});
var f={DEFAULT:{size:{x:24,y:24},tileOffset:0},NORTH:{dir:{x:0,y:-1},size:{x:24,y:24},tileOffset:1},EAST:{dir:{x:1,y:0},size:{x:24,y:24},tileOffset:4},SOUTH:{dir:{x:0,y:1},size:{x:24,y:24},tileOffset:2},WEST:{dir:{x:-1,y:0},size:{x:24,y:24},tileOffset:3}},g={4:{zVel:185,height:32,speed:175,effectDuration:0.4},"4_2":{zVel:190,height:32,speed:190,effectDuration:0.4},8:{zVel:250,height:48,speed:260,effectDuration:0.8}};ig.ENTITY.JumpPanelFloat=ig.AnimatedEntity.extend({panelType:null,effects:new ig.EffectSheet("puzzle"),
jumpHeightData:null,condition:null,dir:null,_wm:new ig.Config({spawnable:true,attributes:{panelType:{_type:"String",_info:"Type of jump Panel",_select:f},jumpDistance:{_type:"String",_info:"How height to jump (in tiles).",_select:g},condition:{_type:"VarCondition",_info:"A condition for this if any."}}}),init:function(a,b,c,d){this.parent(a,b,c,d);this.coll.shadow.size=24;this.panelType=f[d.panelType]||f.DEFAULT;this.jumpDistance=g[d.jumpDistance]||g["4"];this.condition=new ig.VarCondition(d.condition||
"");this.isOn=this.condition.evaluate();this.coll.type=ig.COLLTYPE.TRIGGER;this.coll.setSize(this.panelType.size.x,this.panelType.size.y,0);this.initAnimations({sheet:{src:"media/entity/objects/object-effects.png",width:24,height:24,offX:128+this.panelType.tileOffset*24,offY:144,xCount:2},SUB:[{name:"off",time:0.2,frames:[]},{name:"normal",time:0.1,frames:[0],repeat:true,globalTiming:true},{name:"glow",time:0.1,frames:[0]}]});window.wm?this.setCurrentAnim("glow"):this.setCurrentAnim(this.condition.evaluate()?
"normal":"off");ig.navigation.registerInfluencer(this)},collideWith:function(a){if(!this.condition.evaluate()&&a.party==sc.COMBATANT_PARTY.PLAYER)return false;if(this.panelType.dir){Vec2.assign(a.coll.vel,this.panelType.dir);Vec2.assign(a.coll.accelDir,this.panelType.dir);Vec2.assign(a.face,this.panelType.dir)}Vec2.length(a.coll.vel,this.jumpDistance.speed);a.coll.float.height?a.doFloatJump(10,this.jumpDistance.effectDuration+0.1,this.jumpDistance.speed):a.doJump(this.jumpDistance.zVel,this.jumpDistance.height,
this.jumpDistance.speed,0,false);a.coll.friction.air=0;this.effects.spawnOnTarget("jumpTrailFar",a,{duration:this.jumpDistance.effectDuration});this.effects.spawnOnTarget("jumpButtom",this)},varsChanged:function(){var a=this.condition.evaluate();if(this.isOn!=a){(this.isOn=a)&&this.effects.spawnOnTarget("jumpButtom",this);this.setCurrentAnim(a?"normal":"off");this.onNavMapInfluence()}},onNavMapInfluence:function(){var b=this.getAlignedPos(ig.ENTITY_ALIGN.BOTTOM,a),c=Vec3.assign(d,b);this.panelType.dir&&
Vec2.addMulF(c,this.panelType.dir,16);(b=ig.navigation.getNodeConnection(b,c))&&b.setExternalData("partyBlocked",!this.isOn)}})});ig.baked=!0;
ig.module("game.feature.map-content.entities.teleport-central").requires("impact.base.entity","impact.base.actor-entity","impact.feature.effect.effect-sheet","game.feature.interact.map-interact","game.feature.npc.entities.npc-waypoint").defines(function(){function b(a,b,c,d){var e=c.coll.pos.z+200*d,f=c.getCenter();f.y=f.y-(c.coll.pos.z+Constants.BALL_HEIGHT+8);c=Vec2.create(f);c.y=c.y-64*d;a.push({type:"SET_CAMERA_POS",pos:f,speed:"NORMAL",transition:"EASE_IN_OUT",zoom:1});a.push({type:"DO_ACTION",
entity:b,action:[{type:"SET_FLOAT_HEIGHT",value:8},{type:"SHOW_EFFECT",effect:{sheet:"puzzle.wave-teleport",name:"panelFloat"+(d>0?"Up":"Down")},duration:-1,actionDetached:true},{type:"WAIT",time:0.25}],wait:true,keepState:true});a.push({time:0.1,ignoreSlowDown:false,type:"WAIT"});a.push({color:"white",alpha:1,time:0.6,lighter:true,type:"SET_OVERLAY"});a.push({type:"DO_ACTION",entity:b,action:[{type:"SET_SLIP_THROUGH",value:true},{type:"Z_INTERPOLATE",newZPos:e,duration:0.6,keySpline:"EASE_IN"},{type:"SET_Z_GRAVITY_FACTOR",
value:0}],wait:false,keepState:true});a.push({type:"SET_SCREEN_BLUR",alpha:0.3});a.push({type:"SET_CAMERA_POS",pos:c,speed:0.6,transition:"EASE_IN",zoom:1});a.push({time:0.6,ignoreSlowDown:false,type:"WAIT"});a.push({type:"CLEAR_SCREEN_BLUR"})}sc.TeleportCentralMap={fields:{},registerField:function(a,b){if(a){this.fields[a]||(this.fields[a]=[]);this.fields[a].push(b)}},unregisterField:function(a,b){if(a){var c=this.fields[a];if(c){c.erase(b);c.length==0&&delete this.fields[a]}}},getField:function(a,
b){var c=this.fields[a];if(!c)return null;for(var d=c.length,d=0;d<c.length;++d){var e=c[d];if(e.isExit==b)return e}return c[0]},getFields:function(a){if(a)return this.fields[a]}};var a={CIRCLE:{check:function(a){var b=ig.game.playerEntity.coll,c=b.pos.x+b.size.x-(a.pos.x+a.size.x/2),a=b.pos.y+b.size.y-(a.pos.y+a.size.y/2);return c*c+a*a<d*d},draw:function(a){ig.debugView.addMapPoint(a.pos.x+a.size.x/2,a.pos.y+a.size.y/2,0,d,d,"green",86400,true)}},RECT_OVERLAP:{check:function(a){var b=ig.game.playerEntity.coll,
d=a.pos.x-c,f=a.pos.y-e,k=a.pos.y+a.size.y+e;return b.pos.x<a.pos.x+a.size.x+c&&b.pos.x+b.size.x>d&&b.pos.y<k&&b.pos.y+b.size.y>f},draw:function(a){var b=a.size.x+c*2,d=a.size.y+e*2;ig.debugView.addMapPoint(a.pos.x-c+b/2,a.pos.y-e+d/2,0,b,d,"green",86400)}}},d=112,c=112,e=64;ig.ENTITY.TeleportCentral=ig.Entity.extend({map:"",marker:"",effects:new ig.EffectSheet("puzzle"),fxHandle:null,npcRunnerEnterProb:0,npcRunnerExitProb:0,landmark:null,landmarkTarget:null,landmarkCondition:null,landmarkDetectDelay:3,
hasEffects:true,detectType:"RECT_OVERLAP",wpConnection:null,closePlayerState:{isHealing:false,isTeleport:false,fxHandles:[]},_wm:new ig.Config({spawnable:true,attributes:{npcRunnerEnterProb:{_type:"Number",_info:"Probability that NPCs will enter through this exit"},npcRunnerExitProb:{_type:"Number",_info:"Probability that NPCs will exit through this exit"},effects:{_type:"Boolean",_info:"True if ground effects should be displayed",_default:true},landmark:{_type:"Landmarks",_info:"landmark to activate",
_mapArea:true,_optional:true},target:{_type:"Entity",_info:"Optional target to focus when landmark is activated",_optional:true},condition:{_type:"VarCondition",_info:"Condition for the landmark to activate",_popup:true,_optional:true},detectType:{_type:"String",_info:"Type of detection",_select:a,_default:"RECT_OVERLAP",_optional:true}},scalableX:true,scalableY:true,label:function(){return this.landmark?this.landmark+" > "+this.detectType:""},drawBox:true,boxColor:"rgba(255,255,0, 0.5)",frontColor:"rgba(120,120,0, 0.8)"}),
init:function(a,b,c,d){this.parent(a,b,c,d);this.coll.type=ig.COLLTYPE.NONE;d.size||this.coll.setSize(32,32,0);this.dir=d.dir||"SOUTH";this.npcRunnerEnterProb=d.npcRunnerEnterProb||0;this.npcRunnerExitProb=d.npcRunnerExitProb||0;this.hasEffects=d.effects===void 0?true:d.effects;if(d.landmark){this.landmark=d.landmark;this.landmarkCondition=new ig.VarCondition(d.condition||"");this.detectType=d.detectType||"RECT_OVERLAP";this.landmarkTarget=d.target||null}this.wpConnection=new sc.WPConnection(this)},
update:function(){this.parent();if(this.landmark&&!sc.map.isLandmarkActive(this.landmark,null,true))if(this.landmarkDetectDelay>0)this.landmarkDetectDelay--;else if(!sc.model.isCutscene()&&(this.landmarkCondition.evaluate()&&!sc.pvp.isActive())&&a[this.detectType].check(this.coll)){var b=ig.Event.getEntity(this.landmarkTarget);sc.map.addLandmark(this.landmark,null,b?b:this)}if(this.detectClosePlayer()){b=ig.CollTools.getGroundDistance(this.coll,ig.game.playerEntity.coll)<=160&&!sc.model.isCombatMode();
if(sc.newgame.get("waypoints-heals")){for(var c=ig.game.playerEntity.params.getHpFactor()<1,d=sc.party.getPartySize();d--;)sc.party.getPartyMemberModelByIndex(d).params.getHpFactor()<1&&(c=true);c=b&&c;if(c!==this.closePlayerState.isHealing)if(this.closePlayerState.isHealing=c){c={target2:this,duration:-1};this.closePlayerState.fxHandles.push(ig.game.effects.drops.spawnOnTarget("healingLine",ig.game.playerEntity,c));sc.party.getPartySize()>=1&&this.closePlayerState.fxHandles.push(ig.game.effects.drops.spawnOnTarget("healingLine",
sc.party.getPartyMemberEntityByIndex(0),c));sc.party.getPartySize()>=2&&this.closePlayerState.fxHandles.push(ig.game.effects.drops.spawnOnTarget("healingLine",sc.party.getPartyMemberEntityByIndex(1),c));ig.game.playerEntity.atLandmarkHeal=ig.game.playerEntity.atLandmarkHeal+1;ig.game.playerEntity.params.hpHealTimer=1}else{ig.game.playerEntity.atLandmarkHeal=ig.game.playerEntity.atLandmarkHeal-1;for(c=this.closePlayerState.fxHandles.length;c--;)this.closePlayerState.fxHandles[c].stop();this.closePlayerState.fxHandles.length=
0}}if(sc.newgame.get("waypoints-teleport")&&b!==this.closePlayerState.isTeleport)if(this.closePlayerState.isTeleport=b){b=new ig.GUI.ARBox(ig.game.playerEntity,"Teleport ready!",0,sc.AR_BOX_MODE.NO_LINE,this.color);ig.gui.addGuiElement(b);this.closePlayerState.arGui=b;ig.game.playerEntity.atLandmarkTeleport=ig.game.playerEntity.atLandmarkTeleport+1}else{this.closePlayerState.arGui.remove();ig.game.playerEntity.atLandmarkTeleport=ig.game.playerEntity.atLandmarkTeleport-1}}},detectClosePlayer:function(){return sc.newgame.get("waypoints-heals")||
sc.newgame.get("waypoints-teleport")},onKill:function(a){this.parent(a);this.fxHandle&&this.fxHandle.stop()},show:function(a){this.parent(a);if(!window.wm&&this.hasEffects)this.fxHandle=this.effects.spawnOnTarget("teleportEffect",this,{duration:-1})},enterEntity:function(){},leaveEntity:function(){},applyMarkerPosition:function(a){var b=sc.TeleportCentralMap.getField(this.name,false);if(b)b.applyMarkerPosition(a);else{b=this.coll;a.coll.level=b.level;a.coll.baseZPos=b.baseZPos;a.coll.pos.z=b.pos.z;
ig.ActorEntity.getFaceVec(ig.ActorEntity.FACE8.SOUTH||0,a.face);a.setPos(b.pos.x+b.size.x/2-a.coll.size.x/2,b.pos.y+b.size.y/2-a.coll.size.y/2)}},getRunnerDestination:function(){if(!this.npcRunnerEnterProb&&!this.npcRunnerExitProb)return null;for(var a=sc.TeleportCentralMap.getFields(this.name),b=a.length,c=[],d=null;b--;){var e=a[b];if(!e._hidden){c.push({entity:e,dir:e.dir,type:e.isExit?sc.NPC_RUNNER_DEST_TYPE.EXIT:sc.NPC_RUNNER_DEST_TYPE.ENTER,posType:sc.NPC_RUNNER_DEST_POS_TYPE.CENTER,waiting:true});
d=d||e.map}}return{entries:c,enterProb:this.npcRunnerEnterProb,exitProb:this.npcRunnerExitProb,map:d}},getWPConnect:function(){return this.wpConnection}});var f={SOLID:{gfx:function(a,b,c,d){return{shapeType:"Z_FLAT",offset:{x:0,y:4,z:0},sheet:{src:a,width:32,height:32,xCount:b,offX:c,offY:d},SUB:[{name:"inactive",time:1,frames:[0],repeat:false},{name:"active",time:1,frames:[1],repeat:false},{name:"red",time:1,frames:[2],repeat:false}]}}},AR:{gfx:function(){return{offset:{x:0,y:5,z:0},SUB:[{shapeType:"Z_FLAT",
sheet:{src:"media/entity/objects/upgrade-symbol.png",width:32,height:32,xCount:2,offX:160,offY:0},frames:[0,0,0,1,2,3,4,5],time:0.07,repeat:true,SUB:[{name:"inactive"},{name:"active"},{name:"red"}]},{renderMode:"lighter",sheet:{src:"media/entity/objects/upgrade-symbol.png",width:32,height:40,xCount:1,offX:224},wallY:1,shapeType:"Z_EXPAND",frames:[0,1,2],time:0.1,repeat:true,SUB:[{name:"inactive"},{name:"active"},{name:"red"}]}]}}},AR_FINAL:{gfx:function(){return{offset:{x:0,y:5,z:0},SUB:[{shapeType:"Z_FLAT",
sheet:{src:"media/entity/objects/upgrade-symbol.png",width:32,height:32,xCount:2,offX:32,offY:64},frames:[0],time:0.07,repeat:true,SUB:[{name:"inactive"},{name:"active"},{name:"red"}]},{renderMode:"lighter",sheet:{src:"media/entity/objects/upgrade-symbol.png",width:32,height:40,xCount:1,offX:224},wallY:1,shapeType:"Z_EXPAND",frames:[0,1,2],time:0.1,repeat:true,SUB:[{name:"inactive"},{name:"active"},{name:"red"}]}]}},hideFx:{sheet:"scene.final-teleport",name:"symbolHideFinal"},glowFx:{sheet:"scene.final-teleport",
name:"symbolFinalGlow"}},RHOMBUS_SQR_LEFT:{gfx:function(){return{shapeType:"Z_FLAT",offset:{x:0,y:4,z:0},sheet:{src:"media/map/rhombus-outside.png",width:32,height:32,xCount:1,offX:480,offY:0},time:1,frames:[0],repeat:false,SUB:[{name:"inactive"},{name:"active"},{name:"red"}]}}},RHOMBUS_SQR_RIGHT:{gfx:function(){return{shapeType:"Z_FLAT",offset:{x:1,y:4,z:0},sheet:{src:"media/map/rhombus-outside.png",width:32,height:32,xCount:1,offX:480,offY:0},time:1,frames:[0],repeat:false,flipX:true,SUB:[{name:"inactive"},
{name:"active"},{name:"red"}]}}},BERGEN_LEFT:{gfx:function(){return{shapeType:"Z_FLAT",offset:{x:0,y:4,z:0},sheet:{src:"media/map/bergen-trail.png",width:32,height:32,xCount:1,offX:256,offY:576},time:1,frames:[0],repeat:false,SUB:[{name:"inactive"},{name:"active"},{name:"red"}]}}},HEAT_RIGHT:{gfx:function(){return{shapeType:"Z_FLAT",offset:{x:0,y:4,z:0},sheet:{src:"media/map/heat-area.png",width:32,height:32,xCount:1,offX:64,offY:688},time:1,frames:[0],repeat:false,SUB:[{name:"inactive"},{name:"active"},
{name:"red"}]}}},WAVE_UP:{gfx:function(){return{shapeType:"Z_FLAT",renderMode:"lighter",offset:{x:0,y:4,z:0},sheet:{src:"media/entity/objects/upgrade-symbol.png",width:32,height:32,xCount:4,offX:0,offY:96},time:0.2,frames:[0,1,2,3],repeat:true,SUB:[{name:"inactive"},{name:"active"},{name:"red"}]}},steps:function(a,c,d){b(a,c,d,1)},glowFx:{sheet:"puzzle.wave-teleport",name:"panelGlowUp"}},WAVE_DOWN:{gfx:function(){return{shapeType:"Z_FLAT",renderMode:"lighter",offset:{x:0,y:4,z:0},sheet:{src:"media/entity/objects/upgrade-symbol.png",
width:32,height:32,xCount:4,offX:0,offY:96},time:0.2,frames:[3,2,1,0],repeat:true,SUB:[{name:"inactive"},{name:"active"},{name:"red"}]}},steps:function(a,c,d){b(a,c,d,-1)},glowFx:{sheet:"puzzle.wave-teleport",name:"panelGlowDown"}},RHOMBUS_SQR_STATION:{gfx:function(){return{shapeType:"Z_FLAT",offset:{x:0,y:4,z:0},sheet:{src:"media/map/rhombus-outside.png",width:32,height:32,xCount:2,offX:416,offY:0},time:1,repeat:false,SUB:[{name:"inactive"},{name:"active",frames:[1]},{name:"red",frames:[0]}]}},enterSteps:function(a,
b){var c=a instanceof sc.PlayerBaseEntity?160:480;a instanceof sc.PartyMemberEntity&&(c=c+(sc.party.getCurrentPartyIndex(a.model.name)+1)*48);var d=a.isPlayer?"":"NPC";return[{type:"ADD_Z_POS_DELTA",zDelta:c},{type:"SET_Z_VEL",value:-400},{type:"SET_Z_GRAVITY_FACTOR",value:0},{type:"SHOW_ANIMATION",anim:"idle"},{type:"SHOW_EFFECT",effect:{sheet:b.cacheFx[0],name:"trainTrail"+d},duration:-1,actionDetached:false},{type:"SHOW_EFFECT",effect:{sheet:b.cacheFx[0],name:"trainCubeNoStart"+d},duration:-1,
actionDetached:false},{type:"Z_INTERPOLATE",duration:c/300,newZPos:a.coll.pos.z,keySpline:"EASE_OUT"}]},exitSteps:function(a,b,c){if(!(a instanceof ig.ENTITY.Combatant))a.target=c;a=a.isPlayer?"":"NPC";return[{type:"SHOW_EFFECT",effect:{sheet:b.cacheFx[0],name:"trainCube"+a},duration:-1,actionDetached:false},{type:"SHOW_ANIMATION",anim:"idle"},{type:"WAIT",time:0.25},{type:"SHOW_EFFECT",effect:{sheet:b.cacheFx[0],name:"trainTrail"+a},duration:-1,actionDetached:false},{type:"SET_RELATIVE_SPEED",value:1},
{type:"SET_TEMP_TARGET",kind:"NAMED_ENTITY",key:c.name},{type:"SET_FACE_FIX",value:true},{type:"SET_SPEED",value:50},{type:"STICKY_CIRCLE_AROUND",target:"TARGET",distance:48,duration:0.1,ccw:true,distAdjustSpeed:100,zDistance:1500},{type:"SET_SPEED",value:100},{type:"STICKY_CIRCLE_AROUND",target:"TARGET",distance:48,duration:0.1,ccw:true,distAdjustSpeed:200,zDistance:1500},{type:"SET_SPEED",value:200},{type:"STICKY_CIRCLE_AROUND",target:"TARGET",distance:48,duration:0.8,ccw:true,distAdjustSpeed:300,
zDistance:1500}]},steps:function(a,b,c){b=c.getCenter();b.y=b.y-(c.coll.pos.z+Constants.BALL_HEIGHT+8);c=Vec2.create(b);c.y=c.y-160;a.push({type:"SET_CAMERA_POS",pos:b,speed:"NORMAL",transition:"EASE_IN_OUT",zoom:1});a.push({time:0.3,ignoreSlowDown:false,type:"WAIT"});a.push({type:"SET_SCREEN_BLUR",alpha:0.3});a.push({type:"SET_CAMERA_POS",pos:c,speed:1,transition:"EASE_IN",zoom:1});a.push({time:0.3,ignoreSlowDown:false,type:"WAIT"});a.push({color:"white",alpha:1,time:0.3,lighter:true,type:"SET_OVERLAY"});
a.push({time:0.3,ignoreSlowDown:false,type:"WAIT"});a.push({type:"CLEAR_SCREEN_BLUR"})},longSteps:function(a,b,c){ig.bgm.isPlayingDefault()&&ig.bgm.pause("SLOW");b=c.getCenter();b.y=b.y-(c.coll.pos.z+Constants.BALL_HEIGHT+8);c=Vec2.create(b);c.y=c.y-160;a.push({type:"SET_CAMERA_POS",pos:b,speed:"NORMAL",transition:"EASE_IN_OUT",zoom:1});a.push({time:0.3,ignoreSlowDown:false,type:"WAIT"});a.push({type:"SET_SCREEN_BLUR",alpha:0.3});a.push({type:"SET_CAMERA_POS",pos:c,speed:1,transition:"EASE_IN",zoom:1});
a.push({time:0.3,ignoreSlowDown:false,type:"WAIT"});a.push({color:"white",alpha:1,time:0.3,lighter:true,type:"SET_OVERLAY"});a.push({time:0.3,ignoreSlowDown:false,type:"WAIT"});a.push({type:"CLEAR_SCREEN_BLUR"})},cacheFx:["map.rhombus-sqr"]},RHOMBUS_SQR_STATION_START:{gfx:function(){return{shapeType:"Z_FLAT",offset:{x:0,y:4,z:0},sheet:{src:"media/map/rhombus-outside.png",width:32,height:32,xCount:1,offX:416,offY:32},time:1,repeat:false,SUB:[{name:"inactive"},{name:"active",frames:[0]},{name:"red",
frames:[1]}]}},enterSteps:function(a,b,c){var d=a instanceof sc.PlayerBaseEntity?160:320;a instanceof sc.PartyMemberEntity&&(d=d+(sc.party.getCurrentPartyIndex(a.model.name)+1)*48);var c="tmp._skyRail."+c.name+".enter",e=b.getAlignedPos(ig.ENTITY_ALIGN.TOP),f=Vec3.addC(e,0,d,0,Vec3.create()),a=a.isPlayer?"":"NPC";return[{type:"SET_POS",newPos:f},{type:"CHANGE_VAR_NUMBER",varName:c,changeType:"add",value:1},{type:"SET_Z_GRAVITY_FACTOR",value:0},{type:"SHOW_ANIMATION",anim:"idle"},{type:"SHOW_EFFECT",
effect:{sheet:b.cacheFx[0],name:"trainTrail"+a},duration:-1,actionDetached:false},{type:"SHOW_EFFECT",effect:{sheet:b.cacheFx[0],name:"trainCubeNoStart"+a},duration:-1,actionDetached:false},{type:"INTERPOLATE_POSITION",duration:d/300,newPos:e,keySpline:"EASE_OUT"},{type:"CHANGE_VAR_NUMBER",varName:c,changeType:"sub",value:1}]},exitSteps:function(a,b,c){if(!(a instanceof ig.ENTITY.Combatant))a.target=c;var a=a.isPlayer?"":"NPC",d=b.getAlignedPos(ig.ENTITY_ALIGN.TOP);Vec3.addC(d,0,320,0);c="tmp._skyRail."+
c.name+".exit";return[{type:"SHOW_EFFECT",effect:{sheet:b.cacheFx[0],name:"trainCube"+a},duration:-1,actionDetached:false},{type:"SHOW_ANIMATION",anim:"idle"},{type:"CHANGE_VAR_NUMBER",varName:c,changeType:"add",value:1},{type:"WAIT",time:0.25},{type:"SHOW_EFFECT",effect:{sheet:b.cacheFx[0],name:"trainTrail"+a},duration:-1,actionDetached:false},{type:"SET_RELATIVE_SPEED",value:1},{type:"SET_Z_GRAVITY_FACTOR",value:0},{type:"SET_FACE_FIX",value:true},{type:"INTERPOLATE_POSITION",duration:1,newPos:d,
keySpline:"EASE_IN"},{type:"CHANGE_VAR_NUMBER",varName:c,changeType:"sub",value:1},{type:"WAIT",time:1}]},steps:function(a,b,c){b=c.getCenter();b.y=b.y-(c.coll.pos.z+Constants.BALL_HEIGHT+8);c=Vec2.create(b);c.y=c.y+160;a.push({type:"SET_CAMERA_POS",pos:b,speed:"NORMAL",transition:"EASE_IN_OUT",zoom:1});a.push({time:0.3,ignoreSlowDown:false,type:"WAIT"});a.push({type:"SET_SCREEN_BLUR",alpha:0.3});a.push({type:"SET_CAMERA_POS",pos:c,speed:1,transition:"EASE_IN",zoom:1});a.push({time:0.3,ignoreSlowDown:false,
type:"WAIT"});a.push({color:"white",alpha:1,time:0.3,lighter:true,type:"SET_OVERLAY"});a.push({time:0.3,ignoreSlowDown:false,type:"WAIT"});a.push({type:"CLEAR_SCREEN_BLUR"})},cacheFx:["map.rhombus-sqr"]}};ig.LANG_CONTEXT.TeleportField=function(a){return"TeleportField["+(a.settings.name||"")+"]"};ig.ENTITY.TeleportField=ig.AnimatedEntity.extend({centralName:null,map:null,marker:null,dir:"SOUTH",glowHandle:null,glowFxReplace:null,hideFxReplace:null,initialized:false,longTelCond:null,teleportIcon:new sc.MapInteractIcon(new ig.TileSheet("media/gui/map-icon.png",
40,48,160,168),{FOCUS:[1],NEAR:[0]},0.1),interactEntry:null,effects:{upgrade:new ig.EffectSheet("scene.upgrade"),puzzle:new ig.EffectSheet("puzzle"),teleport:new ig.EffectSheet("teleport"),hideHandle:null},blockEvent:null,blockEventCondition:null,gfxType:null,_wm:new ig.Config({spawnable:true,attributes:{central:{_type:"Entity",_info:"Central Entity the field belongs to",_filterClass:"TeleportCentral",_optional:true},dir:{_type:"String",_info:"View direction of teleport ground.",_select:ig.ActorEntity.FACE4,
_default:"SOUTH"},map:{_type:"Maps",_info:"Map to be loaded",_context:"Map",_optional:true},marker:{_type:"Marker",_info:"Marker on map to teleport player to"},spawnCondition:{_type:"VarCondition",_info:"Condition for teleporter to appear",_popup:true},teleportLabel:{_type:"LangLabel",_info:"Label displayed for teleporter"},longTelCond:{_type:"VarCondition",_info:"Condition for a long teleport sequence",_default:"false"},pseudoExit:{_type:"Boolean",_info:"If true, show exit graphics and behave like exit even without map defined"},
blockEvent:{_type:"Event",_info:"Event to be performed when entering the teleport ground",_popup:true,_optional:true},blockEventCondition:{_type:"VarCondition",_info:"Condition to show the block event when entering this teleport ground"},gfxType:{_type:"String",_info:"Graphical appearance of teleporter.",_select:f}},label:function(){return!this.map?"":this.map+" > "+this.marker},boxColor:"rgba(255,255,0, 0.5)",frontColor:"rgba(120,120,0, 0.8)"}),init:function(a,b,c,d){this.parent(a,b,c,d);this.coll.type=
ig.COLLTYPE.BLOCK;this.centralName=d.central&&d.central.name;sc.TeleportCentralMap.registerField(this.centralName,this);this.map=d.map;this.marker=d.marker;this.dir=d.dir;this.isExit=d.map||d.pseudoExit;this.longTelCond=new ig.VarCondition(d.longTelCond);var a=ig.mapStyle.get("map"),c=b=0,e=void 0,l=1;if(a.teleportField){b=a.teleportField.x;c=a.teleportField.y;e=a.teleportField.xCount;l=a.zHeight||1}this.coll.setSize(24,24,l);this.gfxType=f[d.gfxType]||f.SOLID;if(this.gfxType.glowFx)this.glowFxReplace=
new ig.EffectHandle(this.gfxType.glowFx);if(this.gfxType.hideFx)this.hideFxReplace=new ig.EffectHandle(this.gfxType.hideFx);if(this.gfxType.cacheFx){this.cacheFx=[];for(l=0;l<this.gfxType.cacheFx.length;++l)this.cacheFx[l]=new ig.EffectSheet(this.gfxType.cacheFx[l])}this.initAnimations(this.gfxType.gfx(a.sheet,e,b,c));if(d.blockEvent){this.blockEvent=new ig.Event({name:"DOOR BLOCK EVENT",steps:d.blockEvent});this.blockEventCondition=new ig.VarCondition(d.blockEventCondition||"true")}if(this.hasInteract()){this.interactEntry=
new sc.MapInteractEntry(this,this,this.teleportIcon,sc.INTERACT_Z_CONDITION.Z_RANGE_OVERLAP,true);d=new sc.IconHoverTextGui(new ig.LangLabel(d.teleportLabel),24,true);this.interactEntry.setSubGui(d);this.interactEntry.setOffset(1,0)}this.setCurrentAnim(this.isExit?"red":"active")},show:function(a){this.parent(a);if(this.effects.hideHandle){this.effects.hideHandle.stop();this.effects.hideHandle=null}this.hasInteract()&&sc.mapInteract.addEntry(this.interactEntry);if(!a){this.animState.alpha=0;this.effects.upgrade.spawnOnTarget("symbolAppear",
this,{})}},onHideRequest:function(){if(this.glowHandle){this.glowHandle.stop();this.glowHandle=null}this.hasInteract()&&sc.mapInteract.removeEntry(this.interactEntry);this.effects.hideHandle=this.hideFxReplace?this.hideFxReplace.spawnOnTarget(this,{callback:this}):this.effects.upgrade.spawnOnTarget("symbolHide2",this,{callback:this})},onEffectEvent:function(a){if(a.isDone()){this.effects.hideHandle=null;this.hide()}},onKill:function(a){this.parent(a);this.hasInteract()&&sc.mapInteract.removeEntry(this.interactEntry);
this.glowFxReplace&&this.glowFxReplace.clearCached();this.hideFxReplace&&this.hideFxReplace.clearCached();if(this.cacheFx)for(a=this.cacheFx.length;a--;)this.cacheFx[a].decreaseRef();sc.TeleportCentralMap.unregisterField(this.centralName,this)},hasInteract:function(){return this.map||this.blockEvent},collideWith:function(a){!a instanceof ig.ActorEntity||this.effects.hideHandle||this.glowHandle||this.startGlow()},update:function(){if(this.glowHandle){for(var a=ig.game.getEntitiesOnTop(this),b=false,
c=a.length;c--;)if(a[c]instanceof ig.ActorEntity){b=true;break}if(this.glowHandle&&!b){this.glowHandle.stop();this.glowHandle=null;this.setCurrentAnim(this.isExit?"red":"active")}}if(!this.initialized){this.recheckGlowStart();this.initialized=true}this.parent()},recheckGlowStart:function(){if(!this.glowHandle&&!this.effects.hideHandle){var a=ig.game.getEntitiesOnTop(this);if(a.length>0){for(var b=a.length,c=false;b--;)c=c||a[b]instanceof ig.ActorEntity;c&&this.startGlow()}}},startGlow:function(){if(!this.glowHandle)this.glowHandle=
this.glowFxReplace?this.glowFxReplace.spawnOnTarget(this,{duration:-1}):this.effects.puzzle.spawnOnTarget("teleportBlock",this,{duration:-1})},enterEntity:function(a){var b=this.getEnterActionData(a,!this.gfxType.exitSteps);this.gfxType.exitSteps&&b.push.apply(b,this.gfxType.exitSteps(a,this,ig.game.namedEntities[this.centralName]));b=new ig.Action("doorAction",b);a.setAction(b,true)},leaveEntity:function(a){ig.EffectTools.clearEffects(a);this.effects.teleport.spawnOnTarget(a.soundType=="none"?"showDefaultSilent":
"showDefault",a,{});if(this.gfxType.enterSteps){a=this.gfxType.enterSteps(a,this,ig.game.namedEntities[this.centralName]);return new ig.Action("doorAction",a)}return null},getEnterActionData:function(a,b){var c=a.soundType=="none",d=[{type:"SET_WALK_ANIMS",config:"normal"},{type:"SET_FACE_FIX",value:false},{type:"SET_COLL_TYPE",value:"IGNORE"},{type:"SET_RELATIVE_SPEED",value:1},{type:"NAVIGATE_TO_POINT",target:this.getAlignedPos(ig.ENTITY_ALIGN.BOTTOM),distance:32},{type:"SET_RELATIVE_SPEED",value:0.5},
{type:"SET_COLL_TYPE",value:"TRIGGER"},{type:"NAVIGATE_TO_POINT",target:this.getAlignedPos(ig.ENTITY_ALIGN.BOTTOM),precise:true},{type:"STOP_XY"},{type:"SET_FACE",face:this.dir,rotate:true}];b&&d.push({type:"SHOW_EFFECT",effect:{sheet:"teleport",name:c?"hideDefaultSilent":"hideDefault"},duration:0,wait:true,actionDetached:true});return d},_addMoveEvent:function(a,b,c,d){if(b)if(c){var e=sc.TeleportCentralMap.getFields(this.centralName);if(e&&!(e.length<=c.length))for(var f=e.length;f--;)if(e[f].isExit&&
c.indexOf(e[f])==-1){e[f]._addMoveEvent(a,b,null,d);c.push(e[f]);break}}else{c=this.getEnterActionData(b,false);!d&&this.gfxType.exitSteps&&c.push.apply(c,this.gfxType.exitSteps(b,this,ig.game.namedEntities[this.centralName]));a.push({type:"DO_ACTION",entity:b,action:c,wait:d});if(d&&this.gfxType.exitSteps){c=this.gfxType.exitSteps(b,this,ig.game.namedEntities[this.centralName]);a.push({type:"DO_ACTION",entity:b,action:c,wait:false})}}},onInteraction:function(){if(this.blockEvent&&this.blockEventCondition.evaluate()){sc.Cutscene.startCutscene(this.blockEvent);
return true}var a=ig.game.playerEntity,b=[],c=[this];sc.party.getPartySize()>=1&&this._addMoveEvent(b,sc.party.getPartyMemberEntityByIndex(0),c,false);sc.party.getPartySize()>=2&&this._addMoveEvent(b,sc.party.getPartyMemberEntityByIndex(1),c,false);this._addMoveEvent(b,a,null,true);b.push({type:"SET_TELEPORT_COLOR",lighter:true,color:"white"});if(c=this.longTelCond.evaluate())if(this.gfxType.longSteps)this.gfxType.longSteps(b,a,this);else{b.push({type:"SET_CAMERA_TARGET",entity:a,speed:"NORMAL",transition:"EASE_IN_OUT",
zoom:1});b.push({type:"SHOW_EFFECT",entity:a,effect:{sheet:"teleport",name:"hideSlow"}});b.push({time:0.2,ignoreSlowDown:false,type:"WAIT"});b.push({type:"SET_CAMERA_ZOOM",zoom:3,duration:4,transition:"EASE_IN"});b.push({color:"white",alpha:1,time:3,lighter:true,type:"SET_OVERLAY"});b.push({zoomType:"LIGHT",fadeIn:0.5,duration:4,fadeOut:1,type:"SET_ZOOM_BLUR",name:null});b.push({time:4,ignoreSlowDown:false,type:"WAIT"})}else if(this.gfxType.steps)this.gfxType.steps(b,a,this);else{b.push({type:"SET_CAMERA_TARGET",
entity:a,speed:"FAST",transition:"EASE_IN_OUT",zoom:1});b.push({time:0.1,ignoreSlowDown:false,type:"WAIT"});b.push({color:"white",alpha:1,time:1,lighter:true,type:"SET_OVERLAY"});b.push({type:"SET_CAMERA_ZOOM",zoom:1.5,duration:1,transition:"EASE_IN"});b.push({type:"SHOW_EFFECT",entity:a,effect:{sheet:"teleport",name:"hideDefault"}});b.push({time:1.2,ignoreSlowDown:false,type:"WAIT"})}b.push({type:"TELEPORT",map:this.map,marker:this.marker});b.push({time:3,ignoreSlowDown:false,type:"WAIT"});a=new ig.Event({steps:b});
c?sc.Cutscene.startCutscene(a):ig.game.events.callEvent(a,ig.EventRunType.BLOCKING);return true},varsChanged:function(){this.initialized=false},applyMarkerPosition:function(a){var b=this.coll;a.coll.level=b.level;a.coll.baseZPos=b.baseZPos;a.coll.pos.z=b.pos.z;ig.ActorEntity.getFaceVec(ig.ActorEntity.FACE8[this.dir]||0,a.face);a.setPos(b.pos.x+b.size.x/2-a.coll.size.x/2,b.pos.y+b.size.y/2-a.coll.size.y/2);if(a.isPlayer&&this.gfxType.enterSteps)ig.game.postPlacementAction=this},onPostPlacementAction:function(a){if(this.gfxType.enterSteps){var b=
this.gfxType.enterSteps(a,this,ig.game.namedEntities[this.centralName]),b=new ig.Action("doorAction",b);b.eventAction=true;a.setAction(b)}a=[this];sc.party.getPartySize()>=1&&this._addPartyEnterSteps(sc.party.getPartyMemberEntityByIndex(0),a);sc.party.getPartySize()>=2&&this._addPartyEnterSteps(sc.party.getPartyMemberEntityByIndex(1),a)},_addPartyEnterSteps:function(a,b){if(a){var c=sc.TeleportCentralMap.getFields(this.centralName);if(c&&!(c.length<=b.length))for(var d=c.length;d--;)if(!c[d].isExit&&
b.indexOf(c[d])==-1){c[d].applyMarkerPosition(a);c[d]._addEnterSteps(a);b.push(c[d]);break}}},_addEnterSteps:function(a){if(this.gfxType.enterSteps){var b=this.gfxType.enterSteps(a,this,ig.game.namedEntities[this.centralName]),b=new ig.Action("doorAction",b);b.eventAction=true;a.setAction(b)}},isRunnerDestBlocked:function(){return!!this.glowHandle}})});ig.baked=!0;
ig.module("game.feature.map-content.gui.rhombus-map").requires("impact.feature.gui.base.box","impact.feature.gui.gui","impact.feature.interact.button-interact","game.feature.menu.gui.menu-misc","game.feature.gui.base.numbers","game.feature.menu.gui.enemies.enemy-pages").defines(function(){sc.RhombusMapMenu=ig.GuiElementBase.extend({transitions:{DEFAULT:{state:{},time:0.2,timeFunction:KEY_SPLINES.LINEAR},HIDDEN:{state:{alpha:0},time:0.1,timeFunction:KEY_SPLINES.LINEAR}},callback:null,buttonInteract:null,
buttonGroup:null,locations:[],currentFocus:null,_cursorMoved:false,_gamepadActive:false,_lastDevice:0,_cursorPos:Vec2.createC(-1E4,-1E4),_worldCursor:Vec2.createC(-1E4,-1E4),info:null,help:null,container:null,infoBox:null,init:function(a){this.parent();this.hook.zIndex=90;this.hook.temporary=true;this.hook.size.x=ig.system.width;this.hook.size.y=ig.system.height;this.callback=a||null;this.buttonInteract=new ig.ButtonInteractEntry;this.buttonGroup=new sc.MouseButtonGroup;this.buttonGroup.ignoreActiveFocus=
true;this.buttonGroup.addSelectionCallback(function(a){a&&a.entity&&this.info.setText(a.entity.description)}.bind(this));this.buttonGroup.setMouseFocusLostCallback(function(){this.info.setText("",0.2);this.infoBox.hide()}.bind(this));this.buttonGroup.onButtonTraversal=function(){if(ig.input.currentDevice==ig.INPUT_DEVICES.GAMEPAD&&sc.control.menuConfirm()&&this.currentFocus)this.currentFocus.onButtonPress()}.bind(this);this.buttonInteract.pushButtonGroup(this.buttonGroup);this.container=new ig.GuiElementBase;
this.container.setSize(ig.system.width,ig.system.height);this.addChildGui(this.container);this.cursor=new sc.MapCursor;this.addChildGui(this.cursor);this.info=new sc.InfoBar(this.hook.size.x,21,true);this.info.setAlign(ig.GUI_ALIGN.X_RIGHT,ig.GUI_ALIGN.Y_BOTTOM);this.addChildGui(this.info);this.info.doStateTransition("DEFAULT");this.help=new sc.InfoBar(this.hook.size.x,21,true);this.help.setAlign(ig.GUI_ALIGN.X_LEFT,ig.GUI_ALIGN.Y_TOP);this.help.text.setAlign(ig.GUI_ALIGN.X_LEFT,ig.GUI_ALIGN.Y_CENTER);
this.help.setText(ig.lang.get("sc.gui.menu.rhombus.help"));this.addChildGui(this.help);this.help.doStateTransition("DEFAULT");this.infoBox=new sc.RhombusMenuInfo;this.addChildGui(this.infoBox);ig.interact.addEntry(this.buttonInteract);this.createLocationUIs();this.doStateTransition("DEFAULT",true)},update:function(){this._cursorMoved=false;if(!ig.interact.isBlocked()&&this.buttonGroup.isActive()){if(this._lastDevice!=ig.input.currentDevice){this._gamepadActive=ig.input.currentDevice==ig.INPUT_DEVICES.GAMEPAD;
this._lastDevice=ig.input.currentDevice;var a=null;if(ig.input.currentDevice==ig.INPUT_DEVICES.GAMEPAD){a=this._cursorPos;this._initCursor(a);this._worldCursor.x=a.x;this._worldCursor.y=a.y;this._limitCursorPos();this._cursorMoved=false;if(this.currentFocus)this.currentFocus.focus=false;this.currentFocus=null;this.info.setText("",0.2);this.cursor.moveTo(this._worldCursor.x,this._worldCursor.y)}else if(ig.input.currentDevice==ig.INPUT_DEVICES.KEYBOARD_AND_MOUSE){this._cursorPos.x=this._worldCursor.x;
this._cursorPos.y=this._worldCursor.y;this.cursor.unfocus()}this.cursor.looseFocus()}if(ig.input.currentDevice==ig.INPUT_DEVICES.GAMEPAD){var b=a=0,c=0,d=false;if((c=sc.control.getAxesValue(ig.AXES.LEFT_STICK_X))<-0.5){a=(-100+c*100)*ig.system.actualTick;d=true}else if((c=sc.control.getAxesValue(ig.AXES.LEFT_STICK_X))>0.5){a=(100+c*100)*ig.system.actualTick;d=true}if((c=sc.control.getAxesValue(ig.AXES.LEFT_STICK_Y))<-0.5){b=(-100+c*100)*ig.system.actualTick;d=true}else if((c=sc.control.getAxesValue(ig.AXES.LEFT_STICK_Y))>
0.5){b=(100+c*100)*ig.system.actualTick;d=true}if(d){this._cursorMoved=true;this._worldCursor.x=a>=0?Math.floor(this._worldCursor.x+a):Math.ceil(this._worldCursor.x+a);this._worldCursor.y=b>=0?Math.floor(this._worldCursor.y+b):Math.ceil(this._worldCursor.y+b);this._limitCursorPos();this.cursor.moveTo(this._worldCursor.x,this._worldCursor.y)}}}},createLocationUIs:function(){for(var a=ig.game.shownEntities,b=a.length;b--;){var c=a[b];if(c instanceof ig.ENTITY.RhombusPoint&&(!c.condition||c.condition.evaluate())){c=
this.createLocationUI(c);this.buttonGroup.addFocusGui(c);this.locations.push(c);this.container.addChildGui(c)}}},createLocationUI:function(a){var b=new sc.RhombusMenuLocation(a,this),d=b.hook,a=a.coll;ig.system.getScreenFromMapPos(c,Math.round(a.pos.x+a.size.x/2),Math.round(a.pos.y-a.pos.z-a.size.z/2+a.size.y/2));if(c.x<0)c.x=0;if(c.x>ig.system.width)c.x=ig.system.width;if(c.y<0)c.y=0;if(c.y>ig.system.height)c.y=ig.system.height;d.pos.x=c.x-d.size.x/2;d.pos.y=c.y-d.size.y/2;return b},onButtonPress:function(a){for(var b=
this.locations.length;b--;)this.locations[b].doStateTransition("HIDDEN");this.infoBox.hide();this.doStateTransition("HIDDEN",false,true,function(){ig.interact.removeEntry(this.buttonInteract);this.callback&&this.callback(a.map,a.marker,a)}.bind(this),0)},focusLocation:function(a,b,c){if(this.currentFocus==c){if(ig.input.currentDevice==ig.INPUT_DEVICES.GAMEPAD){this._worldCursor.x=a;this._worldCursor.y=b;this.cursor.focusOnNode(a,b)}}else{this._worldCursor.x=a;this._worldCursor.y=b;if(this.currentFocus&&
this.currentFocus.focus)this.currentFocus.focus=false;if((this.currentFocus=c)&&!this.currentFocus.focus)this.currentFocus.focus=true;this.cursor.focusOnNode(a,b);this.infoBox.show(this.currentFocus)}},unfocus:function(a){if(this.currentFocus==a){if(this.currentFocus)this.currentFocus.focus=false;this.currentFocus=null;this.info.setText("",0.2);this.cursor.unfocus();this.infoBox.hide()}},_initCursor:function(a){if(a.x<=-1E4||a.y<=-1E4){a.x=ig.system.width/2;a.y=ig.system.height/2}},_limitCursorPos:function(){var a=
this._worldCursor.x;this._worldCursor.x=a.limit(5,ig.system.width-Math.floor(this.cursor.hook.size.x/2));a=this._worldCursor.y;this._worldCursor.y=a.limit(41,ig.system.height-this.cursor.hook.size.y-4)}});sc.RhombusMenuInfo=ig.BoxGui.extend({transitions:{DEFAULT:{state:{},time:0.2,timeFunction:KEY_SPLINES.LINEAR},HIDDEN:{state:{alpha:0},time:0.2,timeFunction:KEY_SPLINES.LINEAR}},ninepatch:new ig.NinePatch("media/gui/menu.png",{width:8,height:8,left:8,top:8,right:8,bottom:8,offsets:{"default":{x:432,
y:304},flipped:{x:456,y:304}}}),gfx:new ig.Image("media/gui/rhombus-map.png"),title:null,arrow:null,icon:null,init:function(){this.parent(148,100);this.title=new sc.TextGui("",{font:sc.fontsystem.smallFont});this.title.setAlign(ig.GUI_ALIGN.X_CENTER,ig.GUI_ALIGN.Y_TOP);this.title.setPos(0,2);this.addChildGui(this.title);(new ig.ColorGui("#CCCCCC",144,82)).setPos(3,18);this.icon=new ig.ImageGui(this.gfx,0,0,142,80);this.icon.setAlign(ig.GUI_ALIGN.X_CENTER,ig.GUI_ALIGN.Y_TOP);this.icon.setPos(0,17);
this.addChildGui(this.icon);this.arrow=new sc.RhombusMenuArrow;this.addChildGui(this.arrow);this.doStateTransition("HIDDEN",true)},updateDrawables:function(a){this.parent(a);a.addColor("#CCCCCC",3,this.title.hook.size.y+1,142,1)},show:function(a){this.alignToBase(a.hook);this.setData(a.entity);this.doStateTransition("DEFAULT");this.active=true},hide:function(a){this.doStateTransition("HIDDEN",a);this.active=false},setData:function(a){this.title.setText(a.title);this.icon.offsetY=a.icon*80},alignToBase:function(a){var b=
this.hook,d=b.currentState.alpha==0;c.x=a.pos.x+Math.floor(a.size.x/2);c.y=a.pos.y+Math.floor(a.size.y/2);a=c.y+-46;c.y=Math.max(10,Math.min(ig.system.height-100-10,c.y+-46));if(d)b.pos.y=c.y;var h=38+(a-c.y);if(c.x+173<ig.system.width){this.currentTileOffset="default";if(d)b.pos.x=c.x+20+10;b.doPosTranstition(c.x+20,c.y,0.2,KEY_SPLINES.EASE);this.arrow.setPosition(-10,Math.max(7,Math.min(125,h)),false)}else{this.currentTileOffset="flipped";if(d)b.pos.x=c.x-b.size.x-20-10-1;b.doPosTranstition(c.x-
b.size.x-20-1,c.y,0.2,KEY_SPLINES.EASE);this.arrow.setPosition(b.size.x+1,Math.max(7,Math.min(125,38+(a-c.y))),true)}this.arrow.bottomAnchor=false;this.arrow.flipY=false;if(h<7){this.arrow.bottomAnchor=true;this.arrow.flipY=true}else if(h>125)this.arrow.bottomAnchor=true}});sc.RhombusMenuArrow=ig.GuiElementBase.extend({gfx:new ig.Image("media/gui/menu.png"),transitions:{HIDDEN:{state:{alpha:0},time:0.2,timeFunction:KEY_SPLINES.LINEAR},DEFAULT:{state:{},time:0.2,timeFunction:KEY_SPLINES.LINEAR}},flipX:false,
flipY:false,bottomAnchor:false,init:function(){this.parent();this.setSize(9,15);this.doStateTransition("DEFAULT")},setPosition:function(a,b,c,d,i){this.setPos(a,b);this.flipX=c||false;this.flipY=d||false;this.bottomAnchor=i||false},updateDrawables:function(a){a.addGfx(this.gfx,0,0,this.bottomAnchor?444:434,337,9,15,this.flipX,this.flipY)}});var b=[0.1,0.1,0.1,0.1],a=[0,0,0,0],d=sc.BUTTON_SOUND.submit,c=Vec2.createC(0,0);sc.RhombusMenuLocation=ig.FocusGui.extend({transitions:{DEFAULT:{state:{},time:0.2,
timeFunction:KEY_SPLINES.LINEAR},HIDDEN:{state:{alpha:0,scaleX:0},time:0.2,timeFunction:KEY_SPLINES.LINEAR}},gfx:new ig.Image("media/gui/rhombus-map.png"),entity:null,callback:null,icon:0,origin:false,focusTimer:0,focusFrame:0,init:function(a,b){this.parent(true,false);this.setSize(16,16);this.setPivot(8,8);this.entity=a;this.callback=b;this.origin=a.map==ig.game.previousMap;this.icon=this.entity.icon*24;this.doStateTransition("HIDDEN",true);this.doStateTransition("DEFAULT",false,false,function(){}.bind(this))},
onButtonPress:function(){if(ig.input.currentDevice==ig.INPUT_DEVICES.KEYBOARD_AND_MOUSE){var a=Math.floor(sc.control.getMouseY());if(a<=21||a>=299)return}d.play();this.callback.onButtonPress(this.entity)},update:function(){if(this.focus){this.focusTimer=this.focusTimer+ig.system.actualTick;if(this.focusTimer>=b[this.focusFrame]){this.focusFrame=(this.focusFrame+1)%a.length;this.focusTimer=0}}},updateDrawables:function(b){this.focus&&b.addGfx(this.gfx,-this.hook.pivot.x,-this.hook.pivot.y,144+32*a[this.focusFrame],
0,32,32).setCompositionMode("lighter");b.addGfx(this.gfx,this.hook.pivot.x-12,this.hook.pivot.y-12,144+this.icon,48+(this.origin?24:0),24,24);this.origin&&b.addGfx(this.gfx,-21,-13,208,32,22,17)},isMouseOver:function(){if(!ig.interact.isBlocked()){if(ig.input.currentDevice==ig.INPUT_DEVICES.GAMEPAD){var a=this.getDistanceToCursor();if(this.callback._cursorMoved){this.callback.unfocus(this);return false}if(a<=10){a=this.hook;this.callback.focusLocation(a.pos.x+Math.floor(a.size.x/2)-1,a.pos.y+Math.floor(a.size.y/
2)+1,this,true);return true}this.callback.unfocus(this)}else if(ig.input.currentDevice==ig.INPUT_DEVICES.KEYBOARD_AND_MOUSE){var b=Math.floor(sc.control.getMouseX()),c=Math.floor(sc.control.getMouseY()),a=this.hook;(b=b>=a.pos.x&&b<=a.pos.x+a.size.x&&c>=a.pos.y&&c<=a.pos.y+a.size.y)?this.callback.focusLocation(a.pos.x+Math.floor(a.size.x/2)-1,a.pos.y+Math.floor(a.size.y/2)+1,this):this.callback.unfocus(this);return b}return false}},unfocus:function(){this.focusTimer=0;this.focusFrame=-1;this.callback.unfocus(this)},
getDistanceToCursor:function(){return Math.floor(Vec2.distanceC(this.callback._worldCursor.x,this.callback._worldCursor.y,this.hook.pos.x+Math.floor(this.hook.size.x/2),this.hook.pos.y+Math.floor(this.hook.size.y/2)))}})});ig.baked=!0;
ig.module("game.feature.map-content.entities.rhombus-point").requires("impact.base.entity","game.feature.map-content.gui.rhombus-map").defines(function(){ig.ENTITY.RhombusPoint=ig.Entity.extend({_wm:new ig.Config({spawnable:true,attributes:{title:{_type:"LangLabel",_info:"Name of the teleport location"},description:{_type:"LangLabel",_info:"Short description of the location",_large:true},map:{_type:"Maps",_info:"Map to be teleported to",_context:"Map"},marker:{_type:"Marker",_info:"Marker on Map to be teleported to"},
condition:{_type:"VarCondition",_info:"optional condition for this location to show",_optional:true},icon:{_type:"Integer",_info:"Index of the preview icon to use."}},scalableX:true,scalableY:true,scalableStep:2,drawBox:true,boxColor:"rgba(255, 128, 30, 0.5)",frontColor:"rgba(128, 128, 0, 1)",noZLine:true}),title:null,description:null,condition:null,map:null,marker:null,icon:0,init:function(b,a,d,c){this.parent(b,a,d,c);this.setSize(16,16,0);this.coll.type=ig.COLLTYPE.NONE;this.title=ig.LangLabel.getText(c.title);
this.description=ig.LangLabel.getText(c.description);this.map=c.map;this.marker=c.marker;this.icon=c.icon||0;this.condition=c.condition?new ig.VarCondition(c.condition):null}})});ig.baked=!0;
ig.module("game.feature.map-content.plug-in").requires("game.feature.map-content.entities.elevator","game.feature.map-content.map-content-steps","game.feature.map-content.gui.icon-hover-text","game.feature.map-content.map-style","game.feature.map-content.sc-doors","game.feature.map-content.prop-interact","game.feature.map-content.entities.jump-panel","game.feature.map-content.entities.teleport-central","game.feature.map-content.entities.rhombus-point").defines(function(){ig.langFileList.push("sc.map-content");
window.wm&&wm.postLoadModules.push("game.feature.map-content.editors.map-content-editor")});ig.baked=!0;
ig.module("game.feature.model.model-steps").requires("impact.base.action","impact.base.event","game.feature.player.player-model","game.feature.model.game-model").defines(function(){ig.EVENT_STEP.START_DEMO_HIGHSCORE_TIMER=ig.EventStepBase.extend({_wm:new ig.Config({attributes:{}}),start:function(){sc.model.startHighScoreTimer()}});ig.EVENT_STEP.STOP_DEMO_HIGHSCORE_TIMER=ig.EventStepBase.extend({observatory:false,_wm:new ig.Config({attributes:{observatory:{_type:"Boolean",_info:"True if this is for the observatory challenge.",
_default:false}}}),init:function(b){this.observatory=b.observatory||false},start:function(){sc.model.stopHighScoreTimer(this.observatory)}});ig.EVENT_STEP.SET_TASK=ig.EventStepBase.extend({task:null,keepDisplayed:false,_wm:new ig.Config({attributes:{task:{_type:"LangLabel",_info:"Current task of the game.",_large:true},keepDisplayed:{_type:"Boolean",_info:"Keep Task displayed all the time"}},width:500}),init:function(b){this.task=new ig.LangLabel(b.task);this.keepDisplayed=b.keepDisplayed},start:function(){sc.model.setTask(this.task,
this.keepDisplayed)}});ig.EVENT_STEP.SET_PERMA_TASK=ig.EventStepBase.extend({task:null,_wm:new ig.Config({attributes:{task:{_type:"LangLabel",_info:"Current perma task of the game. Displayed in Synopsis",_large:true}},width:500}),init:function(b){this.task=new ig.LangLabel(b.task)},start:function(){sc.model.setPermaTask(this.task)}});ig.EVENT_STEP.SET_PAUSE_MUSIC_STOP=ig.EventStepBase.extend({stop:false,_wm:new ig.Config({attributes:{stop:{_type:"Boolean",_info:"If true: stop music in pause menu."}},
width:500}),init:function(b){this.stop=b.stop||false},start:function(){sc.model.pauseMusicStop=this.stop}});ig.EVENT_STEP.SET_MOBILITY_BLOCK=ig.EventStepBase.extend({value:null,_wm:new ig.Config({attributes:{value:{_type:"String",_info:"Type of Mobility block. SAVE also blocks teleport",_select:sc.GAME_MOBILITY_BLOCK}}}),init:function(b){this.value=b.value},start:function(){sc.model.setMobilityBlock(this.value)}});ig.EVENT_STEP.ACTIVATE_CANCEL_BUTTON=ig.EventStepBase.extend({text:null,_wm:new ig.Config({attributes:{text:{_type:"LangLabel",
_info:"If defined: enable cancel button with this text. If undefined: disable cancel button"}},width:500}),init:function(b){if(b.text)this.text=new ig.LangLabel(b.text)},start:function(){sc.model.setCancelButton(this.text)}});ig.EVENT_STEP.CLEAR_CANCEL_BUTTON=ig.EventStepBase.extend({_wm:new ig.Config({attributes:{},width:500}),init:function(){},start:function(){sc.model.setCancelButton()}});ig.EVENT_STEP.SET_FORCE_COMBAT=ig.EventStepBase.extend({value:false,_wm:new ig.Config({attributes:{value:{_type:"Boolean",
_info:"True if combat should remain active."}}}),init:function(b){this.value=b.value||false},start:function(){sc.model.setCombatMode(this.value,true)}});ig.EVENT_STEP.FORCE_START_S_RANK=ig.EventStepBase.extend({_wm:new ig.Config({attributes:{}}),init:function(){},start:function(){sc.model.forceStartSRank()}});ig.EVENT_STEP.INCREASE_COMBAT_RANK=ig.EventStepBase.extend({value:false,_wm:new ig.Config({attributes:{value:{_type:"Number",_info:"Increase Combat Rank by this weight. 1=one enemy"}}}),init:function(b){this.value=
b.value},start:function(){sc.model.increaseCombatRank(this.value)}});ig.EVENT_STEP.CLEAR_TASK=ig.EventStepBase.extend({_wm:new ig.Config({attributes:{}}),init:function(){},start:function(){sc.model.setTask(null,false)}});ig.EVENT_STEP.SET_PLAYER_CORE=ig.EventStepBase.extend({core:null,value:null,_wm:new ig.Config({attributes:{core:{_type:"String",_info:"Type of Core.",_select:sc.PLAYER_CORE},value:{_type:"Boolean",_info:"True to activate core."}}}),init:function(b){this.core=sc.PLAYER_CORE[b.core];
this.value=b.value},start:function(){sc.model.player.setCore(this.core,this.value)}});ig.EVENT_STEP.SET_PLAYER_SP_LEVEL=ig.EventStepBase.extend({level:null,_wm:new ig.Config({attributes:{level:{_type:"String",_info:"Type of Core.",_select:{"0":"0 SP",1:"4 SP",2:"8 SP",3:"12 SP",4:"16 SP"}}}}),init:function(b){this.level=b.level},start:function(){sc.model.player.setSpLevel(this.level)}});ig.EVENT_STEP.INCREASE_PLAYER_SP_LEVEL=ig.EventStepBase.extend({_wm:new ig.Config({attributes:{}}),init:function(){},
start:function(){sc.model.player.setSpLevel(sc.model.player.spLevel+1)}});ig.EVENT_STEP.ADD_PLAYER_EXP=ig.EventStepBase.extend({exp:0,level:0,_wm:new ig.Config({attributes:{exp:{_type:"NumberExpression",_info:"Experience count."},level:{_type:"Number",_info:"Level of experience",_optional:true}}}),init:function(b){this.exp=b.exp;this.level=b.level||0},start:function(){var b=this.level||sc.model.player.level,a=ig.Event.getExpressionValue(this.exp),b=sc.model.player.addExperience(a,b,void 0,void 0,
sc.LEVEL_CURVES.STATIC_REGULAR);sc.stats.addMap("player","expOther",b)}});ig.EVENT_STEP.SET_PLAYER_LEVEL_DEBUG=ig.EventStepBase.extend({level:null,_wm:new ig.Config({attributes:{level:{_type:"Number",_info:"New Level of Player"}}}),init:function(b){this.level=b.level},start:function(){var b=Math.max(sc.model.player.level,this.level);sc.model.player.setLevel(b,true);sc.PlayerLevelTools.autoequip(sc.model.player,sc.model.player.config.autoequip,0,b,true,true)}});ig.EVENT_STEP.SET_ALL_PLAYER_CORE=ig.EventStepBase.extend({value:null,
_wm:new ig.Config({attributes:{value:{_type:"Boolean",_info:"True to activate core."}}}),init:function(b){this.value=b.value},start:function(){sc.model.player.setCoreAll(this.value)}})});ig.baked=!0;ig.module("game.feature.model.plug-in").requires("game.feature.model.base-model","game.feature.model.game-model","game.feature.model.model-steps","game.feature.model.options-model").defines(function(){if(window.wm){wm.addStepColorRule(/TASK/,"violet");wm.addStepColorRule(/CORE/,"violet");wm.postLoadModules.push("game.feature.model.editors.options-editors")}});
ig.baked=!0;ig.module("game.feature.skills.plug-in").requires("game.feature.skills.skills","game.feature.skills.skilltree").defines(function(){});ig.baked=!0;
ig.module("game.feature.msg.entities.event-trigger").requires("impact.base.entity").defines(function(){sc.Cutscene={getLookAtEventSteps:function(a,b){a=ig.copy(a);a.unshift(this._getLookAction({player:true},b));a.unshift(this._getLookAction({party:"Member2"},b));a.unshift(this._getLookAction({party:"Member3"},b));a.unshift({type:"SET_CAMERA_TARGET",entity:b,speed:"FAST",transition:"EASE_IN_OUT"});return a},_getLookAction:function(a,b){return{type:"DO_ACTION",entity:a,action:[{type:"SET_FACE_TO_ENTITY",
entity:b,rotate:true},{type:"SET_FACE_FIX",value:true},{type:"SET_RELATIVE_SPEED",value:0.3},{type:"MOVE_TO_ENTITY_DISTANCE",entity:b,min:24,max:40,subRadius:false,maxTime:0.3}]}},startCutscene:function(a,b,c){return ig.game.events.callEvent(a,ig.EventRunType.BLOCKING,this.onEventStart.bind(this),this.onEventEnd.bind(this),b,c)},startCombatCutscene:function(a,b,c){return ig.game.events.callEvent(a,ig.EventRunType.BLOCKING,this.onCombatEventStart.bind(this),this.onEventEnd.bind(this),b,c)},onEventStart:function(){sc.model.enterCutscene(false)},
onCombatEventStart:function(){sc.model.enterCutscene(true)},onEventEnd:function(){sc.model.enterGame()},startMenuEvent:function(a,b){var c=ig.game.events.callEvent(a,ig.EventRunType.BLOCKING,this.onMenuEventStart.bind(this),this.onMenuEventEnd.bind(this),b);c.pauseParallel=true;return c},onMenuEventStart:function(){sc.model.message.setMenuMode(true)},onMenuEventEnd:function(){sc.model.message.setMenuMode(false);sc.model.message.onSceneEnd(false)},startAutoControlEvent:function(a,b,c){a=ig.game.events.callEvent(a,
ig.EventRunType.INTERRUPTABLE,this.onAutoControlStart.bind(this),this.onAutoControlEnd.bind(this),b,c);a.pauseParallel=true;return a},onAutoControlStart:function(){sc.autoControl.setActive(true)},onAutoControlEnd:function(){sc.autoControl.setActive(false)},startEvent:function(a,b,c,e){return a==ig.EVENT_TYPE.CUTSCENE?sc.Cutscene.startCutscene(b,c,e):a==ig.EVENT_TYPE.COMBAT_CUTSCENE?sc.Cutscene.startCombatCutscene(b,c,e):a==ig.EVENT_TYPE.AUTO_CONTROL?sc.Cutscene.startAutoControlEvent(b,c,e):a==ig.EVENT_TYPE.INTERRUPTABLE?
ig.game.events.callEvent(b,ig.EventRunType.INTERRUPTABLE,void 0,void 0,c,e):ig.game.events.callEvent(b,ig.EventRunType.PARALLEL,void 0,void 0,c,e)}};ig.EVENT_TYPE={PARALLEL:1,CUTSCENE:2,INTERRUPTABLE:3,AUTO_CONTROL:4,COMBAT_CUTSCENE:5};ig.EVENT_TRIGGER_TYPE={ALWAYS:0,ONCE_PER_ENTRY:1,ONCE:2};ig.LANG_CONTEXT.EventTrigger=function(a){return"EVENT["+(a.settings.name||"")+"]"};ig.ENTITY.EventTrigger=ig.Entity.extend({eventType:null,startCondition:null,endCondition:null,event:null,eventCall:null,triggerVar:null,
_wm:new ig.Config({spawnable:true,attributes:{eventType:{_type:"String",_info:"Type of event. Cutscenes will stop the movement of the player and can't be executed in parallel. Auto Control events will take over the player's control.",_select:ig.EVENT_TYPE},startCondition:{_type:"VarCondition",_info:"Condition for the event to start",_popup:true},endCondition:{_type:"VarCondition",_info:"Condition for the event to not start (even if start condition is true)",_popup:true,_default:"false"},event:{_type:"Event",
_info:"Event to be performed",_popup:true},triggerType:{_type:"String",_info:"How often should this event be run?",_select:ig.EVENT_TRIGGER_TYPE},loadCondition:{_type:"EventLoadCondition",_info:"If true: condition is checked on map entry and event is only loaded if ture. onStart => Use start conditions, custom => use custom conditions",_optional:true}},label:function(){return""},drawBox:true,boxColor:"rgba(255,0,0, 0.5)",noZLine:true}),init:function(a,b,c,e){this.parent(a,b,c,e);this.coll.type=ig.COLLTYPE.NONE;
this.coll.setSize(16,16,0);this.eventType=ig.EVENT_TYPE[e.eventType]||ig.EVENT_TYPE.PARALLEL;this.startCondition=new ig.VarCondition(e.startCondition);this.endCondition=new ig.VarCondition(e.endCondition);if(a=ig.EVENT_TRIGGER_TYPE[e.triggerType||"ALWAYS"])this.triggerVar=(a==ig.EVENT_TRIGGER_TYPE.ONCE?"map.":"tmp.")+"_entity"+this.mapId+"_triggered";a=true;(b=e.loadCondition)&&(this.endCondition.evaluate()?a=false:this.triggerVar&&ig.vars.get(this.triggerVar)?a=false:b.onStart&&!this.startCondition.evaluate()?
a=false:b.custom&&((new ig.VarCondition(b.custom)).evaluate()||(a=false)));if(e.event&&a)this.event=new ig.Event({name:this.name,steps:e.event})},onKill:function(a){this.parent(a);this.event&&this.event.clearCached();if((this.eventType==ig.EVENT_TYPE.CUTSCENE||this.eventType==ig.EVENT_TYPE.COMBAT_CUTSCENE)&&this.eventCall&&this.eventCall.isRunning())sc.Cutscene.onEventEnd()},update:function(){if(ig.game.isEventStartReady()){if((!this.eventCall||!this.eventCall.isRunning())&&this.startCondition.evaluate()&&
!this.endCondition.evaluate()){if(this.triggerVar&&ig.vars.get(this.triggerVar)||ig.game.isTeleporting())return;if(!this.event)throw Error("Tried to start Event that has not been loaded! Event name: "+this.name);this.eventCall=sc.Cutscene.startEvent(this.eventType,this.event)}this.eventCall&&this.eventCall.isRunning()&&!this.eventCall.isBlocked()&&this.triggerVar&&ig.vars.set(this.triggerVar,true)}},varsChanged:function(){sc.model.isMenu()||this.update()}});var b={IGNORE:0,ABOVE:1,BELOW:2};ig.LANG_CONTEXT.LocationEvent=
function(a){return"LOCAL_EVENT["+(a.settings.name||"")+"]"};ig.ENTITY.LocationEvent=ig.Entity.extend({startCondition:null,event:null,triggerVar:null,_wm:new ig.Config({spawnable:true,attributes:{startCondition:{_type:"VarCondition",_info:"Condition for the event to start",_popup:true},event:{_type:"Event",_info:"Event to be performed when entity is in screen (always parallel)",_popup:true},radius:{_type:"Number",_info:"If specified, only trigger when distance to entity is below the given radius",
_optional:true},heightCompare:{_type:"String",info:"How height comparison matters",_select:b}},label:function(){return""},drawBox:true,boxColor:"rgba(255,0,122, 0.5)",drawCircle:function(a){return a.radius||0},noZLine:true}),init:function(a,d,c,e){this.parent(a,d,c,e);this.coll.type=ig.COLLTYPE.IGNORE;this.coll.setSize(16,16,0);this.startCondition=new ig.VarCondition(e.startCondition);this.triggerVar="map.locEvent.trig"+this.mapId;this.radius=e.radius||0;this.heightCompare=b[e.heightCompare]||0;if(e.event)this.event=
new ig.Event({name:this.name,steps:e.event});ig.vars.get(this.triggerVar)?this.coll.setUpdateType(ig.COLL_UPDATE_TYPE.STATIC):this.coll.setUpdateType(ig.COLL_UPDATE_TYPE.ON_SCREEN)},onKill:function(a){this.parent(a);this.event&&this.event.clearCached()},update:function(){if(!sc.model.isCombatActive()&&!sc.model.message.isSideMessageVisible()&&sc.model.isGame()&&sc.model.isRunning()&&ig.EntityTools.isInScreen(this,-48,-32)&&this.startCondition.evaluate()){var a=ig.game.playerEntity.coll;if(!(this.radius&&
ig.CollTools.getScreenDistance(this.coll,a)>this.radius)&&(!this.heightCompare||!(this.heightCompare==b.ABOVE&&a.pos.z<this.coll.pos.z||this.heightCompare==b.BELOW&&a.pos.z>this.coll.pos.z))){this.coll.setUpdateType(ig.COLL_UPDATE_TYPE.STATIC);if(!ig.vars.get(this.triggerVar)){ig.vars.set(this.triggerVar,1);sc.Cutscene.startEvent(ig.EVENT_TYPE.PARALLEL,this.event)}}}}})});ig.baked=!0;
ig.module("game.feature.msg.gui.message-box").requires("impact.feature.gui.gui","game.feature.gui.base.boxes","game.feature.gui.base.text").defines(function(){sc.MsgBoxGui=ig.GuiElementBase.extend({transitions:{DEFAULT:{state:{alpha:1},time:0.2,timeFunction:KEY_SPLINES.LINEAR},SUB:{state:{alpha:0.8},time:0.2,timeFunction:KEY_SPLINES.LINEAR},HIDDEN:{state:{alpha:0,scaleY:0.3,scaleX:0.3},time:0.2,timeFunction:KEY_SPLINES.LINEAR}},text:null,box:null,personEntry:null,init:function(b,a,d,c,e,f){this.parent();
this.personEntry=e;ig.LANG_DETAILS[ig.currentLang]&&ig.LANG_DETAILS[ig.currentLang].fixedMsgWidth&&(b=202);this.text=new sc.TextGui(d,{maxWidth:b,speed:c,bestRatio:4,optimize:true});this.box=new sc.ArrowBoxGui(this.text.hook.size.x,this.text.hook.size.y,a);this.text.setPos(this.box.PADDING_X,this.box.PADDING_Y);this.text.setBeepSound(f);this.hook.size.x=this.box.hook.size.x;this.hook.size.y=this.box.hook.size.y;this.hook.pivot.x=this.box.hook.pivot.x;this.hook.pivot.y=this.box.hook.pivot.y;this.addChildGui(this.box);
this.addChildGui(this.text)},setPointerDown:function(){this.box.setPointerDown()},setOnFinish:function(b){this.text.textBlock.onFinish=b},isFinished:function(){return this.text.textBlock.isFinished()},skip:function(){this.text.finish()}});sc.ChoiceBoxGui=ig.GuiElementBase.extend({gfx:new ig.Image("media/gui/message.png"),transitions:{DEFAULT:{state:{alpha:1},time:0.2,timeFunction:KEY_SPLINES.LINEAR},HIDDEN:{state:{alpha:0,scaleY:0,scaleX:1},time:0.2,timeFunction:KEY_SPLINES.LINEAR}},choices:null,
buttons:[],buttonInteract:null,buttonGroup:null,bgBox:null,pointerOffsetX:0,delayTimer:0,columns:1,init:function(b,a,d,c,e){this.parent();this.hook.align.y=ig.GUI_ALIGN.Y_BOTTOM;this.hook.localAlpha=0.9;this.choices=b;this.buttonInteract=new ig.ButtonInteractEntry;this.buttonGroup=new sc.ButtonGroup;this.buttonInteract.pushButtonGroup(this.buttonGroup);this.columns=c?c<1?1:c:1;for(var c=Math.ceil(this.choices.length/this.columns),f=0,g=0,e=e||sc.BUTTON_DEFAULT_WIDTH,h=0,i=0,j=0,k=0;k<b.length;++k){var l=
b[k].activeCondition.evaluate();if(b[k].showCondition.evaluate()){l=new sc.ButtonGui(this.choices[k].label,void 0,l,sc.BUTTON_TYPE.ITEM);l.choiceIndex=k;var o=this;l.onButtonPress=function(){o.remove();sc.model.message.selectChoice(this.choiceIndex)};if(b[k].center){l.textChild.setAlign(ig.GUI_ALIGN.X_CENTER,ig.GUI_ALIGN.Y_CENTER);l.textChild.setPos(0,0)}l.setPos(3+f,3+g);if(b[k].stretch){this.buttonGroup.addFocusGui(l,0,h);for(var m=1;m<this.columns;m++)this.buttonGroup.addNull(m,h)}else this.buttonGroup.addFocusGui(l,
i,h);g=g+(l.hook.size.y+0);h++;j<g&&(j=g);if(h>=c){g=0;f=f+(e+1);i++;h=0}e=Math.max(e,l.hook.size.x);this.buttons[k]=l}}this.bgBox=new sc.BlackGrayBox(e*this.columns+6+(this.columns-1),j-0+6-1,true);this.bgBox.hook.localAlpha=this.hook.localAlpha;this.addChildGui(this.bgBox);this.delayTimer=0.3;for(k=0;k<b.length;++k)if(this.buttons[k]){b[k].stretch?this.buttons[k].setWidth(e*this.columns):this.buttons[k].setWidth(e);this.addChildGui(this.buttons[k])}this.setSize(this.bgBox.hook.size.x,this.bgBox.hook.size.y+
12);this.hook.pivot.y=this.hook.size.y;b=a-this.hook.size.x/2;this.pointerOffsetX=this.hook.size.x/2;if(b+this.hook.size.x+2>ig.system.width){this.pointerOffsetX=this.pointerOffsetX+(b+this.hook.size.x+2-ig.system.width);b=ig.system.width-this.hook.size.x-2}else if(b<2){this.pointerOffsetX=this.pointerOffsetX+(b-2);b=2}this.setPos(b,d);this.doStateTransition("HIDDEN",true);this.doStateTransition("DEFAULT")},update:function(){if(this.delayTimer){this.delayTimer=this.delayTimer-ig.system.actualTick;
if(this.delayTimer<=0){this.delayTimer=0;ig.interact.addEntry(this.buttonInteract)}}},updateDrawables:function(b){b.addGfx(this.gfx,this.pointerOffsetX-8,this.hook.size.y-12,32,32,16,12)},remove:function(){ig.interact.removeEntry(this.buttonInteract);this.doStateTransition("HIDDEN",false,true)}})});ig.baked=!0;
ig.module("game.feature.msg.gui.dream-msg").requires("impact.base.image","impact.feature.interact.gui.focus-gui","game.feature.interact.button-group").defines(function(){sc.DREAM_TEXT_POS_TYPE={TOP:1,BOTTOM:2};var b=Vec2.create();sc.DreamMsgGui=ig.GuiElementBase.extend({transitions:{DEFAULT:{state:{alpha:1},time:0.2,timeFunction:KEY_SPLINES.EASE_OUT},TRANSPARENT:{state:{alpha:0.6},time:0.2,timeFunction:KEY_SPLINES.EASE_OUT},HIDDEN:{state:{alpha:0},time:0.2,timeFunction:KEY_SPLINES.EASE_IN}},time:0,
init:function(a,b,c,e,f,g,h,i){this.parent();this.hook.zIndex=90;this.hook.temporary=true;this.target=a;this.posType=b;this.offset=c;this.time=f||0;this.textGui=new sc.TextGui(e,g);this.addChildGui(this.textGui);this.setSize(this.textGui.hook.size.x,this.textGui.hook.size.y);sc.Model.addObserver(sc.model.message,this);this.doStateTransition(i?"TRANSPARENT":"DEFAULT",true);this.textGui.textBlock.onFinish=this._onTextFinish.bind(this);this.textDone=this.textGui.textBlock.isFinished();this.callback=
h;if(!this.time)this.screenInteract=new sc.ScreenInteractEntry(this);this.time||(ig.system.skipMode?this._close():ig.interact.addEntry(this.screenInteract));this._updatePos()},onActionEndDetach:function(){this._close()},onDetach:function(){sc.Model.removeObserver(sc.model.message,this)},setBoxOffset:function(a,b){this.msgBox.hook.pos.x=a;this.msgBox.hook.pos.y=b},_onTextFinish:function(){this.textDone=true},onInteraction:function(){if(this.textDone){this.screenInteract&&ig.interact.removeEntry(this.screenInteract);
this._close()}else this.textGui.finish()},_close:function(){this.doStateTransition("HIDDEN",false,true);this.callback&&this.callback()},update:function(){this.target&&this._updatePos();if(this.time){this.time=this.time-ig.system.tick;this.time<=0&&this._close()}!this.hook.removeAfterTransition&&(this.textDone&&ig.system.skipMode&&!this.time)&&this._close();this.parent()},updateDrawables:function(a){this.bgColor&&a.addColor(this.bgColor,0,0,this.hook.size.x,this.hook.size.y)},_updatePos:function(){if(this.target){var a=
this.target.coll.pos.y-this.target.coll.pos.z,a=this.posType==sc.DREAM_TEXT_POS_TYPE.TOP?a-this.target.coll.size.z:a+this.target.coll.size.y;ig.system.getScreenFromMapPos(b,Math.round(this.target.coll.pos.x+this.target.coll.size.x/2),Math.round(a));this.hook.pos.x=b.x-this.hook.size.x/2;this.hook.pos.y=b.y;this.hook.pos.y=this.posType==sc.DREAM_TEXT_POS_TYPE.TOP?this.hook.pos.y-(8+this.hook.size.y):this.hook.pos.y+8}else{this.hook.pos.x=ig.system.width/2-this.hook.size.x/2;this.hook.pos.y=ig.system.height/
2-this.hook.size.y/2}this.offset&&Vec2.add(this.hook.pos,this.offset);this.hook.pos.x=this.hook.pos.x.limit(0,ig.system.width-this.hook.size.x);this.hook.pos.y=this.hook.pos.y.limit(0,ig.system.height-this.hook.size.y)},modelChanged:function(a,b){if(b==sc.MESSAGE_EVENT.DREAM_MSG_CLOSE&&this.time)this.time=0.001}})});ig.baked=!0;
ig.module("game.feature.msg.gui.message-overlay").requires("impact.feature.gui.gui","game.feature.msg.gui.message-box","game.feature.model.options-model").defines(function(){ig.MessageOverlayGui=ig.GuiElementBase.extend({transitions:{DEFAULT:{state:{},time:0.5,timeFunction:KEY_SPLINES.LINEAR},HIDDEN:{state:{alpha:0},time:0.5,timeFunction:KEY_SPLINES.LINEAR}},messageArea:null,privateMsgBg:null,topBar:null,bottomBar:null,bottomShadow:null,init:function(){this.parent();this.hook.zIndex=50;this.hook.size.x=
ig.system.width;this.hook.size.y=ig.system.height;sc.Model.addObserver(sc.model,this);sc.Model.addObserver(sc.model.message,this);this.screenInteract=new sc.ScreenInteractEntry(this);this.topBar=new ig.MessageOverlayGui.BlackBar;this.topBar.setAlign(ig.GUI_ALIGN.X_LEFT,ig.GUI_ALIGN.Y_TOP);this.addChildGui(this.topBar);this.bottomBar=new ig.MessageOverlayGui.BlackBar;this.bottomBar.setAlign(ig.GUI_ALIGN.X_LEFT,ig.GUI_ALIGN.Y_BOTTOM);this.addChildGui(this.bottomBar);this.privateMsgBg=new sc.PrivateMessageBGGui;
this.addChildGui(this.privateMsgBg);this.messageArea=new ig.MessageAreaGui;this.messageArea.setAlign(ig.GUI_ALIGN.X_LEFT,ig.GUI_ALIGN.Y_BOTTOM);this.addChildGui(this.messageArea);this.topBar.doStateTransition("HIDDEN_TOP",true);this.bottomBar.doStateTransition("HIDDEN_BOTTOM",true);this.addChildGui(new sc.SkipSceneGui)},modelChanged:function(a,b,c){if(a instanceof sc.GameModel){if(b==sc.GAME_MODEL_MSG.STATE_CHANGED||b==sc.GAME_MODEL_MSG.DREAM_MODE_CHANGE){if(a.isCutscene()&&!ig.dreamFx.isActive()){this.topBar.doStateTransition("DEFAULT");
this.bottomBar.doStateTransition("DEFAULT")}else{this.topBar.doStateTransition("HIDDEN_TOP");this.bottomBar.doStateTransition("HIDDEN_BOTTOM")}this.messageArea.doStateTransition("DEFAULT")}}else if(a==sc.model.message&&b==sc.MESSAGE_EVENT.MENU_MODE_CHANGE){if(c){this.hook.pauseGui=true;this.hook.zIndex=1201;ig.gui.sortGui();this.topBar.doStateTransition("DEFAULT");this.bottomBar.doStateTransition("DEFAULT")}else{this.topBar.doStateTransition("HIDDEN_TOP",false,false,this.onPostMenuMode.bind(this));
this.bottomBar.doStateTransition("HIDDEN_BOTTOM")}this.messageArea.doStateTransition("DEFAULT")}},onPostMenuMode:function(){this.hook.pauseGui=false;this.hook.zIndex=50;ig.gui.sortGui()}});ig.MessageOverlayGui.BlackBar=ig.GuiElementBase.extend({transitions:{DEFAULT:{state:{},time:0.3,timeFunction:KEY_SPLINES.EASE_OUT},HIDDEN_TOP:{state:{alpha:1,offsetY:-21},time:0.3,timeFunction:KEY_SPLINES.EASE_IN},HIDDEN_BOTTOM:{state:{alpha:1,offsetY:-21},time:0.3,timeFunction:KEY_SPLINES.EASE_IN}},init:function(){this.parent();
this.hook.size.y=21;this.hook.size.x=ig.system.width},updateDrawables:function(a){a.addColor("black",0,0,ig.system.getDrawPos(this.hook.size.x),ig.system.getDrawPos(this.hook.size.y))}});ig.MessageOverlayGui.BottomShadow=ig.GuiElementBase.extend({gfx:new ig.Image("media/gui/message.png"),transitions:{DEFAULT:{state:{},time:0.3,timeFunction:KEY_SPLINES.EASE_OUT},HIDDEN:{state:{alpha:0},time:0.3,timeFunction:KEY_SPLINES.EASE_IN}},init:function(){this.parent();this.hook.localAlpha=1;this.hook.size.x=
ig.system.width;this.hook.size.y=128;if(!this.constructor.pattern)this.constructor.pattern=this.gfx.createPattern(144,0,16,128,ig.ImagePattern.OPT.REPEAT_X)},updateDrawables:function(a){a.addPattern(this.constructor.pattern,0,0,0,0,this.hook.size.x,this.hook.size.y)}});sc.PRIVATE_MSG_BG_STATE={BLINK:{doBlink:true,textY:8,offY:-48},OPEN_UP:{doSizeTransition:0.5,textY:0},PRE_CLOSE:{wait:0.3,textY:0},CLOSE_DOWN:{doSizeTransition:0.2,inverse:true,textY:8,changeState:"HIDDEN"}};sc.PrivateMessageBGGui=
ig.GuiElementBase.extend({gfx:new ig.Image("media/gui/message.png"),boxNinePatch:new ig.NinePatch("media/gui/message.png",{width:16,height:0,left:24,top:16,right:24,bottom:0,offsets:{upper:{x:64,y:96},lower:{x:64,y:112}}}),sound:{incoming:new ig.Sound("media/sound/hud/calling.ogg",1),outgoing:new ig.Sound("media/sound/hud/calling.ogg",1),open:new ig.Sound("media/sound/hud/take-call.ogg",1),close:new ig.Sound("media/sound/hud/end-call.ogg",1),drop:new ig.Sound("media/sound/hud/end-call.ogg",1),handle:null},
bgPatterns:new ig.ImagePatternSheet("media/gui/message.png",ig.ImagePattern.OPT.REPEAT_X,8,48,128,80,2,1),transitions:{DEFAULT:{state:{},time:0.3,timeFunction:KEY_SPLINES.JUMPY},PRE_HIDDEN:{state:{alpha:0.5},time:0.3,timeFunction:KEY_SPLINES.LINEAR},HIDDEN:{state:{alpha:0.4,scaleY:0},time:0.1,timeFunction:KEY_SPLINES.LINEAR}},bgState:0,bgTimer:0,bgSilent:false,text:null,init:function(){this.parent();this.doStateTransition("HIDDEN",true);this.setAlign(ig.GUI_ALIGN.X_CENTER,ig.GUI_ALIGN.Y_CENTER);this.text=
new sc.TextGui(ig.lang.get("sc.gui.msg.private"));this.text.setAlign(ig.GUI_ALIGN.X_CENTER,ig.GUI_ALIGN.Y_TOP);this.text.setPos(0,4);this.addChildGui(this.text);this.setSize(ig.system.width,32);this.setPivot(ig.system.width,16);sc.Model.addObserver(sc.model.message,this)},setBgState:function(a,b){this.bgState=a;this.bgTimer=0;this.bgState==sc.PRIVATE_MSG_BG_STATE.OPEN_UP&&this.text.setText(ig.lang.get("sc.gui.msg.private"));a.doSizeTransition?this.doPosTranstition(0,a.offY||0,a.doSizeTransition,KEY_SPLINES.EASE_OUT):
this.setPos(0,a.offY||0);this.text.doPosTranstition(0,this.bgState.textY,0.1,KEY_SPLINES.EASE_IN_OUT);this.bgState.changeState&&this.doStateTransition("PRE_HIDDEN");this.sound.handle&&this.sound.handle.stop();if(!b&&!sc.model.isTitle()){this.sound.handle=null;this.bgState==sc.PRIVATE_MSG_BG_STATE.OPEN_UP?this.sound.open.play():this.bgState==sc.PRIVATE_MSG_BG_STATE.CLOSE_DOWN&&this.sound.close.play()}},isReady:function(){return this.bgState==sc.PRIVATE_MSG_BG_STATE.OPEN_UP&&this.bgTimer>=0.3},update:function(){if(this.bgState){this.bgTimer=
this.bgTimer+ig.system.actualTick;if(this.bgState.wait){if(this.bgTimer>=this.bgState.wait){this.setBgState(sc.PRIVATE_MSG_BG_STATE.CLOSE_DOWN,this.bgSilent);this.bgSilent=false}}else if(this.bgState.doBlink){this.setSize(ig.system.width,32);this.setPivot(ig.system.width,16);var a=(1+Math.sin(this.bgTimer*Math.PI*3.6)).limit(0,1);this.hook.localAlpha=a;this.text.hook.localAlpha=a;if(ig.system.skipMode)sc.model.message.onSkipClearBlocking()}else if(this.bgState.doSizeTransition){a=this.bgTimer;this.hook.localAlpha=
1;this.text.hook.localAlpha=1;a=a/this.bgState.doSizeTransition;a=Math.min(a,1);a=KEY_SPLINES.EASE_OUT.get(a);this.bgState.inverse&&(a=1-a);this.setSize(ig.system.width,Math.floor(32*(1-a)+310*a));if(this.bgState.inverse&&a<=0){this.bgState=null;this.setPivot(ig.system.width,16);this.doStateTransition("HIDDEN");sc.model.message.clearBlocking()}else if(!this.bgState.inverse&&a>=1){this.bgState=null;sc.model.message.clearBlocking()}}}},updateDrawables:function(a){var b=this.hook.size.x,c=this.hook.size.y,
e=(b-200)/2;this.boxNinePatch.draw(a,200,16,"upper",e,0);this.boxNinePatch.draw(a,200,16,"lower",e,c-16);var f=c-32;if(f>1){a.addTransform().setAlpha(0.9);c=Math.min(48,Math.floor(f/2));e=Math.min(48,f-c);f=f-c-e;a.addPattern(this.bgPatterns.getPattern(0),0,16,0,0,b,c);a.addPattern(this.bgPatterns.getPattern(1),0,16+c+f,0,48-e,b,e);f>0&&a.addColor("#001428",0,16+c,b,f);a.undoTransform()}},modelChanged:function(a,b,c){if(b==sc.MESSAGE_EVENT.RING_PRIVATE){this.doStateTransition("DEFAULT");a=c?ig.lang.get("sc.gui.msg.outgoing"):
ig.lang.get("sc.gui.msg.incoming");this.text.setText(a);this.setBgState(sc.PRIVATE_MSG_BG_STATE.BLINK);this.sound.handle=c?this.sound.outgoing.play(true):this.sound.incoming.play(true)}else if(b==sc.MESSAGE_EVENT.START_PRIVATE)this.setBgState(sc.PRIVATE_MSG_BG_STATE.OPEN_UP);else if(b==sc.MESSAGE_EVENT.END_PRIVATE){this.bgSilent=c;this.setBgState(sc.PRIVATE_MSG_BG_STATE.PRE_CLOSE,c)}else if(b==sc.MESSAGE_EVENT.DROP_PRIVATE){this.sound.handle&&this.sound.handle.stop();!c&&!sc.model.isTitle()&&this.sound.drop.play();
this.doStateTransition("HIDDEN");sc.model.message.clearBlocking()}}});ig.MessageAreaGui=ig.GuiElementBase.extend({transitions:{DEFAULT:{state:{},time:0.5,timeFunction:KEY_SPLINES.EASE_IN}},clickToContinue:false,entries:{},portraits:{},boardMsg:null,leftOffEntry:null,rightOffEntry:null,messages:[],choiceGui:null,bottomShadow:null,PORTRAIT_GAP:64,MESSAGE_GAP:8,init:function(){this.parent();this.hook.size.x=ig.system.width;this.hook.size.y=ig.system.height;this.bottomShadow=new ig.MessageOverlayGui.BottomShadow;
this.bottomShadow.setAlign(ig.GUI_ALIGN.X_LEFT,ig.GUI_ALIGN.Y_BOTTOM);this.addChildGui(this.bottomShadow);this.bottomShadow.order=1E7;this.leftOffEntry=new ig.MessageOverlayGui.Entry(this,null,true,-1E3);this.leftOffEntry.setPos(-104,0);this.addChildGui(this.leftOffEntry);this.rightOffEntry=new ig.MessageOverlayGui.Entry(this,null,false,-1E3);this.rightOffEntry.setPos(ig.system.width-24,0);this.addChildGui(this.rightOffEntry);this.boardMsg=new sc.MsgBoardGui;this.boardMsg.setAlign(ig.GUI_ALIGN.X_CENTER,
ig.GUI_ALIGN.Y_CENTER);this.boardMsg.setPos(0,-80);this.addChildGui(this.boardMsg);this.boardMsg.hide(true);sc.Model.addObserver(sc.model.message,this)},update:function(){if(this.clickToContinue&&ig.system.skipMode){this.clickToContinue=false;sc.model.message.clearBlocking()}},modelChanged:function(a,d,c){if(d==sc.MESSAGE_EVENT.RING_PRIVATE)this.clickToContinue=false;else if(d==sc.MESSAGE_EVENT.MESSAGE_INTERACT){if(!sc.model.message.autoScript)if(this.clickToContinue)sc.model.message.clearBlocking();
else{ig.interact.setBlockDelay(0);this.skip()}}else if(d==sc.MESSAGE_EVENT.PERSON_ADDED){var e=c;this.portraits[e]=new ig.MessageOverlayGui.Portrait(this,a.getCharExpression(e),a.getSide(e)==sc.MESSAGE_SIDES.LEFT,a.getOrder(e));this.entries[e]=new ig.MessageOverlayGui.Entry(this,e,a.getSide(e)==sc.MESSAGE_SIDES.LEFT,a.getOrder(e),a.getDisplayName(e));this.addChildGui(this.portraits[e]);this.addChildGui(this.entries[e]);this._reorderPortraits(this.portraits[e]);this._pushVisibleDisplayName(this.entries[e]);
this.boardMsg.hasSide()||this.boardMsg.hide()}else if(d==sc.MESSAGE_EVENT.PERSON_REMOVED){e=c;this.portraits[e].remove();this.entries[e].remove();delete this.portraits[e];delete this.entries[e];this._reorderPortraits()}else if(d==sc.MESSAGE_EVENT.PERSON_CHANGED){var e=c,f=a.getOrder(e),g=a.getSide(e)==sc.MESSAGE_SIDES.LEFT,c=this.portraits[e],h=this.entries[e];c.lookRight!=g&&h.clearMessages();c.order=f;h.order=f;c.setExpression(a.getCharExpression(e));h.setDisplayName(a.getDisplayName(e));h.setLookRight(g);
c.setLookRight(g);this._pushVisibleDisplayName(h);this._reorderPortraits()}else if(d==sc.MESSAGE_EVENT.EXPRESSION_CHANGED){e=c;this.portraits[e].setExpression(a.getCharExpression(e),true)}else if(d==sc.MESSAGE_EVENT.NEW_BOARD_MESSAGE){this.clickToContinue=false;e=c.center?ig.Font.ALIGN.CENTER:ig.Font.ALIGN.LEFT;f=b();this.boardMsg.setContent(c.text,e,f,this.onTextFinished.bind(this),c.side)}else if(d==sc.MESSAGE_EVENT.CLEAR_BOARD_MESSAGE)this.boardMsg.hide();else if(d==sc.MESSAGE_EVENT.NEW_MESSAGE){var e=
c.name,d=ig.system.width-256,i=2,g=f=-1E3;for(h in this.entries){this.entries[h].lookRight?g=Math.max(g,this.entries[h].order):f=Math.max(f,this.entries[h].order);i-- >0||(d=d-this.PORTRAIT_GAP)}d=Math.min(d,175);h=e?this.entries[e]:c.left?this.leftOffEntry:this.rightOffEntry;e&&this._pushVisibleDisplayName(h);d=h.addMessage(d,c.text);c=d.hook.size.y+13+2;h=this.messages.length;for(i=false;h--;){var j=this.messages[h];j.setPointerDown();i=i||j.personEntry.order<(j.personEntry.lookRight?g:f);if(c+
j.hook.size.y>128||i&&c+j.hook.size.y>80){j.doPosTranstition(j.hook.pos.x,j.hook.pos.y+j.hook.size.y,0.2,KEY_SPLINES.EASE_OUT);j.doStateTransition("HIDDEN",false,true);this.messages.splice(h,1)}else{j.doPosTranstition(j.hook.pos.x,c,0.2,KEY_SPLINES.EASE_OUT);j.doStateTransition("SUB")}c=c+(j.hook.size.y+2)}this.messages.push(d);e||this._reorderPortraits()}else if(d==sc.MESSAGE_EVENT.SHOW_CHOICE){e=c.name;this.choiceGui=new sc.ChoiceBoxGui(c.options,this.portraits[e].hook.pos.x+64,this.portraits[e].hook.pos.y+
128,c.columns,c.forceWidth);this.addChildGui(this.choiceGui)}else if(d==sc.MESSAGE_EVENT.CLEARED){for(e in this.portraits)if(!c||a.getSide(e)==c){this.portraits[e].remove();this.entries[e].remove();delete this.portraits[e];delete this.entries[e]}(!c||c==sc.MESSAGE_SIDES.LEFT)&&this.leftOffEntry.clearMessages();(!c||c==sc.MESSAGE_SIDES.RIGHT)&&this.rightOffEntry.clearMessages();this.choiceGui&&this.choiceGui.remove()}for(var k in this.portraits)break;a.isPrivateActive()&&(k=false);ig.dreamFx.isActive()&&
(k=false);this.bottomShadow.doStateTransition(k?"DEFAULT":"HIDDEN")},onTextFinished:function(){ig.system.skipMode||sc.model.message.autoContinue?sc.model.message.clearBlocking():this.clickToContinue=true},clearMessages:function(){for(var a=this.messages.length;a--;)this.messages[a].doStateTransition("HIDDEN",false,true);this.messages=[]},skip:function(){if(sc.model.message.hasBoardMessage())this.boardMsg.skip();else{var a=this.messages.length-1;a>=0&&this.messages[a].skip()}},_reorderPortraits:function(a){this.hook.children.sort(function(a,
b){var c=a.gui.order||0,d=b.gui.order||0;a.gui.isEntry||(c=c+1E5);b.gui.isEntry||(d=d+1E5);return d-c});var b=sc.model.message,c=0,e=0,f;for(f in this.portraits)b.getSide(f)==sc.MESSAGE_SIDES.LEFT?e++:c++;e=0+(e==1?this.PORTRAIT_GAP/2:0);c=ig.system.width-128-(c==1?this.PORTRAIT_GAP/2:0);this.leftOffEntry.hasMessages()&&(e=e+48);this.rightOffEntry.hasMessages()&&(c=c-48);if(ig.dreamFx.isActive()){e=e+48;c=c-48}for(var g=b.isPrivateActive()?22:0,h=this.hook.children,i=h.length;i--;){var j=h[i],k=j.gui;
if(!k.isEntry&&!j.removeAfterTransition&&(f=k.name)&&this.portraits[f]){var l;if(b.getSide(f)==sc.MESSAGE_SIDES.LEFT){l=e;e=e+this.PORTRAIT_GAP}else{l=c;c=c-this.PORTRAIT_GAP}if(k==a||k.hook.getStateTransitionProgress()==0){k.setPos(l,g);this.entries[f].setPos(l,g)}else{var o;if(Math.abs(j.pos.x-l)>200){o=KEY_SPLINES.EASE_IN_OUT;k=0.6}else{o=KEY_SPLINES.EASE_OUT;k=0.2}j.doPosTranstition(l,g,k,o,0,true);this.entries[f].doPosTranstition(l,g,k,o,0,true)}}}},_pushVisibleDisplayName:function(a){if(a.displayName){a.setDisplayNameVisible(true);
var b=sc.model.message,c=b.getSide(a.name),e;for(e in this.entries){var f=this.entries[e];f!=a&&b.getSide(e)==c&&f.setDisplayNameVisible(false)}}}});var b=function(){var a=sc.options.get("text-speed")!=void 0?sc.options.get("text-speed"):ig.TextBlock.SPEED.FAST;if(sc.model.message.autoScript)a=ig.TextBlock.SPEED.SLOW;if(ig.system.skipMode)a=ig.TextBlock.SPEED.IMMEDIATE;return a};ig.MessageOverlayGui.Entry=ig.GuiElementBase.extend({name:null,isEntry:true,lookRight:false,order:0,beepSound:new ig.Sound("media/sound/hud/dialog-beep-2.ogg",
1,0.02),transitions:{DEFAULT:{state:{},time:0.3,timeFunction:KEY_SPLINES.EASE_OUT},HIDDEN_LEFT:{state:{alpha:0,offsetX:-32},time:0.3,timeFunction:KEY_SPLINES.EASE_IN},HIDDEN_RIGHT:{state:{alpha:0,offsetX:32},time:0.3,timeFunction:KEY_SPLINES.EASE_IN}},init:function(a,b,c,e,f){this.parent();this.setSize(128,128);this.hook.align.y=ig.GUI_ALIGN.Y_BOTTOM;this.area=a;this.name=b;this.lookRight=c;this.order=e;this.doStateTransition(this.lookRight?"HIDDEN_LEFT":"HIDDEN_RIGHT",true);this.doStateTransition("DEFAULT");
if(!this.name)this.order=-1E3;f&&this.setDisplayName(f)},addMessage:function(a,d){var c=this.lookRight?sc.ArrowBoxGui.POINTER.TOP_LEFT:sc.ArrowBoxGui.POINTER.TOP_RIGHT,e=b();if(!ig.system.skipMode&&ig.dreamFx.isActive())e=ig.TextBlock.SPEED.NORMAL;c=new sc.MsgBoxGui(a,c,d,e,this,ig.dreamFx.isActive()?null:this.beepSound);c.setAlign(this.lookRight?ig.GUI_ALIGN.X_LEFT:ig.GUI_ALIGN.X_RIGHT,ig.GUI_ALIGN.Y_BOTTOM);c.setPos(112,13);this.area.clickToContinue=false;c.setOnFinish(this.area.onTextFinished.bind(this.area));
this.addChildGui(c);c.doStateTransition("HIDDEN",true);c.doStateTransition("DEFAULT");if(c.isFinished())this.area.onTextFinished();return c},hasMessages:function(){for(var a=this.hook.children.length;a--;)if(!this.hook.children[a].removeAfterTransition)return true;return false},clearMessages:function(){for(var a=0;a<this.hook.children.length;a++)this.hook.children[a].transitions.HIDDEN&&this.hook.children[a].doStateTransition("HIDDEN",true,true)},setDisplayNameVisible:function(a){this.displayName&&
this.displayName.doStateTransition(a?"DEFAULT_RIGHT":"HIDDEN_RIGHT")},setDisplayName:function(a){if(!a&&this.displayName){this.displayName.doStateTransition("HIDDEN_RIGHT",false,true);this.displayName=null}else if(!this.displayName&&a){this.displayName=new ig.MessageOverlayGui.DisplayName(a);this.displayName.setAlign(ig.GUI_ALIGN.X_CENTER,ig.GUI_ALIGN.Y_BOTTOM);this.displayName.setPos(0,-1);this.addChildGui(this.displayName);this.displayName.doStateTransition("HIDDEN_RIGHT",true);this.displayName.doStateTransition("DEFAULT_RIGHT")}else this.displayName&&
this.displayName.setText(a)},setLookRight:function(a){this.lookRight=a},remove:function(){this.doStateTransition(this.lookRight?"HIDDEN_LEFT":"HIDDEN_RIGHT",false,true);for(var a=0;a<this.hook.children.length;++a)this.hook.children[a].transitions.HIDDEN&&this.hook.children[a].doStateTransition("HIDDEN",false,true)}});ig.MessageOverlayGui.Portrait=ig.GuiElementBase.extend({name:null,charExpression:null,lookRight:false,order:0,timer:0,displayName:null,transitions:{DEFAULT:{state:{scaleX:-1},time:0.3,
timeFunction:KEY_SPLINES.EASE_OUT},DEFAULT_RIGHT:{state:{scaleX:1},time:0.3,timeFunction:KEY_SPLINES.EASE_OUT},HIDDEN_LEFT:{state:{scaleX:-1,alpha:0,offsetX:-32},time:0.3,timeFunction:KEY_SPLINES.EASE_IN},HIDDEN_RIGHT:{state:{scaleX:1,alpha:0,offsetX:32},time:0.3,timeFunction:KEY_SPLINES.EASE_IN}},init:function(a,b,c,e){this.parent();this.setSize(128,128);this.setPivot(64,64);this.hook.align.y=ig.GUI_ALIGN.Y_BOTTOM;this.area=a;this.name=b.character.name;this.charExpression=b;this.lookRight=c;this.order=
e;this.doStateTransition(this.lookRight?"HIDDEN_LEFT":"HIDDEN_RIGHT",true);this.doStateTransition(this.lookRight?"DEFAULT":"DEFAULT_RIGHT");if(ig.dreamFx.isActive())this.hook.localAlpha=0.5},setLookRight:function(a){this.lookRight=a;this.doStateTransition(this.lookRight?"DEFAULT":"DEFAULT_RIGHT",true)},setExpression:function(a,b){if(b||this.charExpression!=a){this.charExpression=a;this.timer=0}},remove:function(){this.doStateTransition(this.lookRight?"HIDDEN_LEFT":"HIDDEN_RIGHT",false,true);for(var a=
0;a<this.hook.children.length;++a)this.hook.children[a].doStateTransition(this.lookRight?"HIDDEN_LEFT":"HIDDEN_RIGHT",false,true)},update:function(){this.timer=this.timer+ig.system.actualTick},updateDrawables:function(a){var b=this.charExpression.character.data;sc.MsgGuiTools.drawPortrait(a,this.charExpression,this.timer,(128-b.face.width)/2,128-b.face.height)}});ig.MessageOverlayGui.DisplayName=ig.GuiElementBase.extend({ninepatch:new ig.NinePatch("media/gui/message.png",{width:16,height:0,left:16,
top:14,right:16,bottom:0,offsets:{"default":{x:48,y:32}}}),transitions:{DEFAULT:{state:{scaleX:-1},time:0.3,timeFunction:KEY_SPLINES.EASE},DEFAULT_RIGHT:{state:{scaleX:1},time:0.3,timeFunction:KEY_SPLINES.EASE},HIDDEN_LEFT:{state:{scaleX:-1,alpha:0,offsetY:-10},time:0.3,timeFunction:KEY_SPLINES.EASE},HIDDEN_RIGHT:{state:{scaleX:1,alpha:0,offsetY:-10},time:0.3,timeFunction:KEY_SPLINES.EASE}},text:null,init:function(a){this.parent();this.hook.localAlpha=0.7;a=new sc.TextGui(a,{font:sc.fontsystem.font});
a.setAlign(ig.GUI_ALIGN.X_CENTER,ig.GUI_ALIGN.Y_TOP);this.text=a;this.setSize(a.hook.size.x+32,a.hook.size.y);this.setPivot(this.hook.size.x/2,this.hook.size.y/2);this.addChildGui(a)},updateDrawables:function(a){this.ninepatch.draw(a,this.hook.size.x,14,"default",0,2)},setText:function(a){this.text.setText(a);this.setSize(this.text.hook.size.x+32,this.text.hook.size.y);this.setPivot(this.hook.size.x/2,this.hook.size.y/2)}});sc.MsgGuiTools={};sc.MsgGuiTools.drawPortrait=function(a,b,c,e,f,g,h){var b=
sc.playerSkins.replaceFace(b),i=b.character,j=b.expression,k=i.data,i=i.faceImage,b=b.expressionImages,l=k.face.parts,j=k.face.expressions[j],o,m;if(g){o=k.face.centerX-Math.floor(g/2);m=k.face.centerY-Math.floor(h/2)}if(j){var k=j.anim,n=j.time,p=j.repeat||false,r=j.faces,j=null;if(k){j=Math.floor(c/n);p?p>1?j>p&&(j=(j-p)%(k.length-p)+p):j=j%k.length:j=j.limit(0,k.length-1);j=r[k[j]]}else j=r[0];for(p=k=c=0;p<j.length;++p){var n=l[p][j[p]],r=n.destX+c,t=n.destY+k,c=c+(n.subX||0),k=k+(n.subY||0);
if(p==0){o=o+c;m=m+k}var q=i;n.img&&(q=b[n.img]);if(g){if(!n.hideOnClip&&!(o>=r+n.width||o+g<=r||m>=t+n.height||m+h<=t)){var s=Math.max(0,o-r),v=Math.max(0,m-t),y=Math.min(0,o+g-r-n.width)-s,u=Math.min(0,m+h-t-n.height)-v;a.addGfx(q,e-o+s+r,f-m+v+t,n.srcX+s,n.srcY+v,n.width+y,n.height+u)}}else a.addGfx(q,e+r,f+t,n.srcX,n.srcY,n.width,n.height)}}}});ig.baked=!0;
ig.module("game.feature.msg.gui.message-board").requires("impact.feature.gui.gui","game.feature.gui.base.boxes","game.feature.gui.base.text").defines(function(){sc.MsgBoardContentGui=ig.GuiElementBase.extend({transitions:{DEFAULT:{state:{alpha:1},time:0.1,timeFunction:KEY_SPLINES.EASE_OUT},HIDDEN:{state:{alpha:0},time:0.1,timeFunction:KEY_SPLINES.EASE_IN}},text:null,init:function(){this.parent();var a=230;ig.LANG_DETAILS[ig.currentLang]&&ig.LANG_DETAILS[ig.currentLang].fixedMsgWidth&&(a=202);this.text=
new sc.TextGui("WHATEVER",{maxWidth:a,textAlign:ig.Font.ALIGN.LEFT,bestRatio:10,optimize:true});this.text.setAlign(ig.GUI_ALIGN.X_LEFT,ig.GUI_ALIGN.Y_TOP);this.addChildGui(this.text);this.doStateTransition("HIDDEN",true)},setContent:function(a,c,e,f){var g=0,h=0;this.text.setTextAlign(c);this.text.setTextSpeed(e);this.text.textBlock.onFinish=f;this.text.setPos(0,h);this.text.setText(a);h=h+this.text.hook.size.y;g=Math.max(g,this.text.hook.size.x);this.setSize(g,h);this.doStateTransition("HIDDEN",
true);this.doStateTransition("DEFAULT",false,false,null,e==ig.TextBlock.SPEED.IMMEDIATE?b:0)},isFinished:function(){return this.text.textBlock.isFinished()},skip:function(){this.text.finish()}});var b=0.1,a=Vec2.create();sc.MsgBoardGui=ig.GuiElementBase.extend({transitions:{DEFAULT:{state:{alpha:1},time:0.2,timeFunction:KEY_SPLINES.LINEAR},HIDDEN:{state:{alpha:0,scaleY:0.1,scaleX:0.5},time:0.2,timeFunction:KEY_SPLINES.LINEAR}},box:null,content:null,side:null,sizeTransition:{start:Vec2.create(),end:Vec2.create(),
timer:0},init:function(){this.parent();this.box=new sc.ArrowBoxGui(8,8,sc.ArrowBoxGui.POINTER.NONE);this.addChildGui(this.box);this.content=new sc.MsgBoardContentGui;this.content.setAlign(ig.GUI_ALIGN.X_LEFT,ig.GUI_ALIGN.Y_TOP);this.addChildGui(this.content);this.setSide(null)},setSide:function(a){this.side=a;var b=0,e=-80;if(a){e=56;b=96;a==sc.MESSAGE_SIDES.LEFT&&(b=-b)}if(this.hook.pos.x!=b||this.hook.pos.y!=e)this.hook.currentStateName=="HIDDEN"?this.setPos(b,e):this.doPosTranstition(b,e,0.3,KEY_SPLINES.EASE_IN_OUT)},
hasSide:function(){return this.side},setContent:function(a,c,e,f,g){this.content.setContent(a,c,e,f);this.setSide(g);a=this.content.hook.size;c=a.x+20;e=a.y+12;g=250;ig.LANG_DETAILS[ig.currentLang]&&ig.LANG_DETAILS[ig.currentLang].fixedMsgWidth&&(g=220);c=Math.max(g,c);e=Math.max(36,e);this.content.setPos((c-a.x)/2,(e-a.y)/2);if(this.hook.currentStateName=="HIDDEN"){this.doStateTransition("DEFAULT");this.setSize(c,e)}else if(this.hook.size.x!=c||this.hook.size.y!=e){Vec2.assign(this.sizeTransition.start,
this.hook.size);Vec2.assignC(this.sizeTransition.end,c,e);this.sizeTransition.timer=b}this.content.isFinished()&&f()},skip:function(){this.content.skip()},setSize:function(a,b){this.parent(a,b);this.setPivot(a/2,b/2);this.box.setSize(a,b)},update:function(){if(this.sizeTransition.timer){this.sizeTransition.timer=this.sizeTransition.timer-ig.system.actualTick;if(this.sizeTransition.timer<0)this.sizeTransition.timer=0;var d=1-this.sizeTransition.timer/b,d=KEY_SPLINES.EASE_IN_OUT.get(d),d=Vec2.lerp(this.sizeTransition.start,
this.sizeTransition.end,d,a);this.setSize(this.sizeTransition.end.x,d.y)}},hide:function(a){this.doStateTransition("HIDDEN",a)}})});ig.baked=!0;
ig.module("game.feature.msg.msg-steps").requires("impact.base.action","impact.base.event","game.feature.msg.message-model","game.feature.character.character","game.feature.gui.widget.demo-stats","game.feature.gui.widget.demo-highscore","game.feature.msg.gui.dream-msg").defines(function(){ig.EVENT_STEP.SHOW_MSG=ig.EventStepBase.extend({person:null,charExpression:null,message:null,autoContinue:false,hiCount:0,_wm:new ig.Config({attributes:{person:{_type:"PersonExpression",_info:"Talking person"},message:{_type:"LangLabel",
_info:"Message to display",_large:true},autoContinue:{_type:"Boolean",_info:"Automatically continue after message"}},label:function(){return"<em>"+wmPrint("PersonExpression",this.person)+"</em>: <i>"+wmPrint("LangLabel",this.message)+"</i>"+(this.autoContinue?", <i>autoContinue</i>":"")}}),init:function(a){this.person=a.person.person;this.charExpression=new sc.CharacterExpression(a.person.person,a.person.expression);this.message=new ig.LangLabel(a.message);this.autoContinue=a.autoContinue||false;
ig.langEdit&&ig.langEdit.submitMap("MSG "+this.person,this.message);if(this.person=="main.lea"&&a.message&&a.message.en_US)this.hiCount=(this.hiCount=a.message.en_US.match(/hi[.!?]/gi))?this.hiCount.length:0},clearCached:function(){this.charExpression.decreaseRef()},start:function(){this.hiCount&&sc.stats.addMap("misc","hiCount",this.hiCount||0);sc.model.message.setExpression(this.person,this.charExpression);sc.model.message.showMessage(this.person,this.message,this.autoContinue||this._nextStep&&
this._nextStep instanceof ig.EVENT_STEP.SHOW_CHOICE);ig.langEdit&&ig.langEdit.submitRecent("MSG "+this.person,this.message)},run:function(){return!sc.model.message.isBlocking()}});ig.LANG_CONTEXT.SHOW_MSG=function(a){var b="MSG[";a.person&&(b=b+(a.person.person+">"+a.person.expression));return b+"]"};ig.EVENT_STEP.RING_PRIVATE_MSG=ig.EventStepBase.extend({outgoing:false,_wm:new ig.Config({attributes:{outgoing:{_type:"Boolean",_info:"If true: this is an outgoing call"}}}),init:function(a){this.outgoing=
a.outgoing},start:function(){sc.model.message.ringPrivateMessage(this.outgoing)},run:function(){return!sc.model.message.isBlocking()}});ig.EVENT_STEP.START_PRIVATE_MSG=ig.EventStepBase.extend({_wm:new ig.Config({attributes:{}}),init:function(){},start:function(){sc.model.message.isPrivateRing()?sc.model.message.startPrivateMessage():sc.model.message.ringPrivateMessage()},run:function(){if(!sc.model.message.isBlocking()){if(!sc.model.message.isPrivateRing())return true;sc.model.message.startPrivateMessage()}return false}});
ig.EVENT_STEP.END_PRIVATE_MSG=ig.EventStepBase.extend({_wm:new ig.Config({attributes:{skipSounds:{_type:"Boolean",_info:"If true: skip sounds"}}}),init:function(a){this.skipSounds=a.skipSounds||false},start:function(){sc.model.message.endPrivateMessage(this.skipSounds)},run:function(){return!sc.model.message.isBlocking()}});ig.EVENT_STEP.SHOW_OFFSCREEN_MSG=ig.EventStepBase.extend({leftSide:null,message:null,autoContinue:false,_wm:new ig.Config({attributes:{side:{_type:"String",_info:"Side to display message at.",
_select:sc.MESSAGE_SIDES},message:{_type:"LangLabel",_info:"Message to display",_large:true},autoContinue:{_type:"Boolean",_info:"Automaticallt continue after message"}},width:400,label:function(){return"<em>OFFSCREEN ("+(this.side=="LEFT"?"left":"right")+")</em>: <i>"+wmPrint("LangLabel",this.message)+"</i>"+(this.autoContinue?", <i>autoContinue</i>":"")}}),init:function(a){this.leftSide=a.side=="LEFT";this.message=new ig.LangLabel(a.message);this.autoContinue=a.autoContinue||false;ig.langEdit&&
ig.langEdit.submitMap("MSG Offscreen",this.message)},start:function(){sc.model.message.showOffScreenMessage(this.leftSide,this.message,this.autoContinue||this._nextStep&&this._nextStep instanceof ig.EVENT_STEP.SHOW_CHOICE);ig.langEdit&&ig.langEdit.submitRecent("MSG Offscreen",this.message)},run:function(){return!sc.model.message.isBlocking()}});ig.EVENT_STEP.SHOW_CHOICE=ig.EventStepBase.extend({person:null,charExpression:null,columns:null,forceWidth:0,options:[],branches:{},_wm:new ig.Config({attributes:{person:{_type:"PersonExpression",
_info:"Talking person"},options:{_type:"ChoiceOptions",_info:"List of options",_noLabel:true},columns:{_type:"Integer",_info:"Number of buttons columns.",_optional:true,_default:2},forceWidth:{_type:"Integer",_info:"Override the default button width. NOTE: Buttons still get matched when a text is to large.",_optional:true}},branchLabel:function(a){return a=="_end"?"END_SHOW_CHOICE":this.options[a]?"Choice: "+wmPrint("LangLabel",this.options[a].label):"???"}}),init:function(a){this.person=a.person&&
a.person.person;if((this.columns=a.columns)&&this.columns<1)this.columns=1;this.forceWidth=a.forceWidth||0;if(a.person)this.charExpression=new sc.CharacterExpression(a.person.person,a.person.expression);for(var a=a.options||[],b=0;b<a.length;++b){this.options[b]={label:new ig.LangLabel(a[b].label),activeCondition:new ig.VarCondition(a[b].activeCondition),showCondition:new ig.VarCondition(a[b].showCondition),stretch:a[b].stretch||false,center:a[b].center||false};ig.langEdit&&ig.langEdit.submitMap("Choice "+
b,this.options[b].label)}},clearCached:function(){this.charExpression&&this.charExpression.decreaseRef()},start:function(){this.charExpression&&sc.model.message.setExpression(this.person,this.charExpression);sc.model.message.showChoice(this.person,this.options,this.columns,this.forceWidth)},run:function(){return!sc.model.message.isBlocking()},getBranchNames:function(){for(var a=[],b=0;b<this.options.length;++b)a.push(b);return a},getNext:function(){return this.branches[sc.model.message.lastSelectedChoice]||
this._nextStep}});ig.EVENT_STEP.ADD_MSG_PERSON=ig.EventStepBase.extend({charExpression:null,side:0,order:0,clearSide:false,name:null,_wm:new ig.Config({attributes:{person:{_type:"PersonExpression",_info:"Person + Expression to add"},name:{_type:"LangLabel",_info:"Name to display under portrait if any",_optional:true},side:{_type:"String",_info:"Side to display Person at.",_select:sc.MESSAGE_SIDES},order:{_type:"Number",_info:"Determines the order in which people are displayed on one side. LOWER values are in FRONT"},
clearSide:{_type:"Boolean",_info:"Clear the side before adding the person"}}}),init:function(a){this.charExpression=new sc.CharacterExpression(a.person.person,a.person.expression);this.side=sc.MESSAGE_SIDES[a.side];this.order=a.order;this.clearSide=a.clearSide;if(a.name)this.name=new ig.LangLabel(a.name)},clearCached:function(){this.charExpression.decreaseRef()},start:function(){this.clearSide&&sc.model.message.clearSide(this.side);sc.model.message.addPerson(this.charExpression,this.side,this.order,
this.name)}});ig.EVENT_STEP.REMOVE_MSG_PERSON=ig.EventStepBase.extend({person:null,_wm:new ig.Config({attributes:{person:{_type:"Character",_info:"Person to remove"}}}),init:function(a){this.person=a.person},start:function(){sc.model.message.removePerson(this.person)}});ig.EVENT_STEP.SET_MSG_EXPRESSION=ig.EventStepBase.extend({person:null,charExpression:null,_wm:new ig.Config({attributes:{person:{_type:"PersonExpression",_info:"Person + Expression to change"}}}),init:function(a){this.person=a.person.person;
this.charExpression=new sc.CharacterExpression(a.person.person,a.person.expression)},clearCached:function(){this.charExpression.decreaseRef()},start:function(){sc.model.message.setExpression(this.person,this.charExpression)}});ig.EVENT_STEP.CLEAR_MSG=ig.EventStepBase.extend({side:null,_wm:new ig.Config({attributes:{side:{_type:"String",_info:"Side to clear",_select:sc.MESSAGE_SIDES_OR_ALL,_default:"ALL"}}}),init:function(a){this.side=sc.MESSAGE_SIDES_OR_ALL[a.side]},start:function(){sc.model.message.clearSide(this.side)}});
ig.EVENT_STEP.SHOW_CENTER_MSG=ig.EventStepBase.extend({titleText:null,text:null,overMenu:null,_wm:new ig.Config({attributes:{titleText:{_type:"LangLabel",_info:"Title of Box"},text:{_type:"LangLabel",_info:"Message in Box",_large:true},overMenu:{_type:"Boolean",_info:"Show over menu",_optional:true}},width:500}),init:function(a){this.titleText=new ig.LangLabel(a.titleText);this.text=new ig.LangLabel(a.text);this.overMenu=a.overMenu||false;ig.langEdit&&ig.langEdit.submitMap("Center MSG Title",this.titleText);
ig.langEdit&&ig.langEdit.submitMap("Center MSG Content",this.text)},start:function(a){a.done=false;var b=new sc.CenterMsgBoxGui(this.titleText.toString()+"\n"+this.text.toString(),{maxWidth:300,speed:ig.TextBlock.SPEED.FASTEST},"black",0.9,function(){a.done=true},this.overMenu);ig.gui.addGuiElement(b);ig.langEdit&&ig.langEdit.submitRecent("Center MSG Title",this.titleText);ig.langEdit&&ig.langEdit.submitRecent("Center MSG Content",this.text)},run:function(a){return a.done}});ig.EVENT_STEP.SHOW_DREAM_MSG=
ig.EventStepBase.extend({titleText:null,text:null,time:0,_wm:new ig.Config({attributes:{text:{_type:"LangLabel",_info:"Message in Box",_large:true},entity:{_type:"Entity",_info:"Entity the dream text will be displayed above or below. Text will be centered on screen if not specified",_optional:true},posType:{_type:"String",_info:"Whether to display text above or below entity.",_select:sc.DREAM_TEXT_POS_TYPE,_default:"TOP"},offset:{_type:"Vec2",_info:"Offset added to position"},time:{_type:"Number",
_info:"If set the message will stay on for the given amount of time",_optional:true},smallFont:{_type:"Boolean",_info:"If true: use small font",_optional:true}},width:500}),init:function(a){this.text=new ig.LangLabel(a.text);ig.langEdit&&ig.langEdit.submitMap("Dream Text",this.text);this.entity=a.entity;this.posType=sc.DREAM_TEXT_POS_TYPE[a.posType]||sc.DREAM_TEXT_POS_TYPE.TOP;this.offset=a.offset;this.time=a.time||0;this.smallFont=a.smallFont||false},start:function(a,b){a.timer=0;var d=ig.Event.getEntity(this.entity,
b),d=new sc.DreamMsgGui(d,this.posType,this.offset,this.text.toString(),this.time,{maxWidth:400,speed:ig.TextBlock.SPEED.SLOW,textAlign:ig.Font.ALIGN.CENTER,font:this.smallFont?sc.fontsystem.smallFont:sc.fontsystem.font},function(){a.timer=0.2});ig.gui.addGuiElement(d);ig.langEdit&&ig.langEdit.submitRecent("Dream Text",this.text)},run:function(a){if(a.timer){a.timer=a.timer-ig.system.tick;if(a.timer<=0)return true}return false}});ig.ACTION_STEP.SHOW_DREAM_MSG=ig.ActionStepBase.extend({text:null,time:0,
_wm:new ig.Config({attributes:{text:{_type:"LangLabel",_info:"Message in Box",_large:true},entity:{_type:"Entity",_info:"Entity the dream text will be displayed above or below. If not defined, will be displayed above action entity",_optional:true},posType:{_type:"String",_info:"Whether to display text above or below entity.",_select:sc.DREAM_TEXT_POS_TYPE,_default:"TOP"},offset:{_type:"Vec2",_info:"Offset added to position"},time:{_type:"Number",_info:"If set the message will stay on for the given amount of time"}},
width:500}),init:function(a){this.text=new ig.LangLabel(a.text);ig.langEdit&&ig.langEdit.submitMap("Dream Text",this.text);this.entity=a.entity;this.posType=sc.DREAM_TEXT_POS_TYPE[a.posType]||sc.DREAM_TEXT_POS_TYPE.TOP;this.offset=a.offset;this.time=a.time||1},start:function(a){var b=ig.Event.getEntity(this.entity)||a,b=new sc.DreamMsgGui(b,this.posType,this.offset,this.text.toString(),this.time,{maxWidth:140,speed:ig.TextBlock.SPEED.SLOW,textAlign:ig.Font.ALIGN.CENTER,font:sc.fontsystem.smallFont},
null,true);b.hook.zIndex=-30;ig.gui.addGuiElement(b);ig.langEdit&&ig.langEdit.submitRecent("Dream Text",this.text);a.addActionAttached(b);a.stepTimer=a.stepTimer+this.time},run:function(a){return a.stepTimer<=0}});ig.ACTION_STEP.CLEAR_DREAM_MSG=ig.ActionStepBase.extend({_wm:new ig.Config({attributes:{},width:500}),init:function(){},start:function(){sc.model.message.clearDreamMessage()}});sc.TUTORIAL_START_TYPE={TUTORIAL:{skippable:true,title:"sc.gui.bigChoice.tutorial.title",yes:"sc.gui.bigChoice.tutorial.yes",
no:"sc.gui.bigChoice.tutorial.no"},GENERIC:{title:"sc.gui.bigChoice.generic.title",yes:"sc.gui.bigChoice.generic.yes",no:"sc.gui.bigChoice.generic.no"}};ig.EVENT_STEP.SHOW_TUTORIAL_START=ig.EventStepBase.extend({msgType:null,title:null,content:null,imageSrc:null,branches:{},_wm:new ig.Config({attributes:{msgType:{_type:"String",_info:"Type of Message",_select:sc.TUTORIAL_START_TYPE,_default:"TUTORIAL"},title:{_type:"LangLabel",_info:"Title of Toturial"},content:{_type:"LangLabel",_info:"Content of Tutorial",
_large:true},image:{_type:"Image",_info:"Image to be shown over content text",_optional:true}},branchLabel:function(a){switch(a){case "acceptStep":return"on Accept";case "cancelStep":return"on Cancel";case "_end":return"Tutorial End"}return"???"},width:500}),init:function(a){this.msgType=sc.TUTORIAL_START_TYPE[a.msgType]||sc.TUTORIAL_START_TYPE.TUTORIAL;this.title=new ig.LangLabel(a.title);this.content=new ig.LangLabel(a.content);this.imageSrc=a.image;ig.langEdit&&ig.langEdit.submitMap("Tutorial MSG Title",
this.title);ig.langEdit&&ig.langEdit.submitMap("Tutorial MSG Content",this.content)},start:function(a){if(this.msgType.skippable&&sc.options.get("skip-tutorials")){a.done=true;a.accept=false}else{a.done=false;a.accept=false;var b=new sc.TutorialStartGui(this.msgType,this.title.toString(),this.content.toString(),this.imageSrc,function(b){a.done=true;a.accept=b});ig.gui.addGuiElement(b);ig.langEdit&&ig.langEdit.submitRecent("Tutorial MSG Title",this.title);ig.langEdit&&ig.langEdit.submitRecent("Tutorial MSG Content",
this.content)}},run:function(a){return a.done},getBranchNames:function(){return["acceptStep","cancelStep"]},getNext:function(a){return a.accept?this.branches.acceptStep?this.branches.acceptStep:this._nextStep:this.branches.cancelStep?this.branches.cancelStep:this._nextStep}});ig.EVENT_STEP.SHOW_MODAL_CHOICE=ig.EventStepBase.extend({text:null,options:[],branches:{},_wm:new ig.Config({attributes:{text:{_type:"LangLabel",_info:"Text of modal dialog"},options:{_type:"ModalChoiceOptions",_info:"All the options of the modal dialog"}},
branchLabel:function(a){return a=="_end"?"END_MODAL_DIALOG_CHOICE":this.options[a]?"Choice: "+wmPrint("LangLabel",this.options[a].label):"???"}}),init:function(a){this.text=new ig.LangLabel(a.text);for(var a=a.options||[],b=0;b<a.length;++b){this.options[b]=new ig.LangLabel(a[b].label);ig.langEdit&&ig.langEdit.submitMap("Modal Choice "+b,this.options[b])}},start:function(a){a.done=false;a.choice=null;sc.model.stopSkip();sc.model.skipBlock=true;sc.Dialogs.showChoiceDialog(this.text.toString(),sc.DIALOG_INFO_ICON.NONE,
this.options,function(b){sc.model.skipBlock=false;a.done=true;a.choice=b.data})},run:function(a){return a.done},getBranchNames:function(){for(var a=[],b=0;b<this.options.length;++b)a.push(b);return a},getNext:function(a){return this.branches[a.choice]||this._nextStep}});ig.EVENT_STEP.SHOW_TUTORIAL_MSG=ig.EventStepBase.extend({pos:null,size:null,text:null,direction:null,connectPos:0,_wm:new ig.Config({attributes:{text:{_type:"LangLabel",_info:"Tutorial Text description",_large:true},pos:{_type:"Vec2",
_info:"Marker Square position"},size:{_type:"Vec2",_info:"Marker Square size"},direction:{_type:"String",_info:"Direction to show text relative to marker square.",_select:sc.TUT_BOX_POINTING_DIR},connectPos:{_type:"Number",_info:"Point where text line touches marker box. Between 0 to 1. 0= left corner, 1=right corner.",_default:0.5},stopTime:{_type:"Boolean",_info:"If true: Stop time while displaying the message"}},width:500}),init:function(a){this.text=new ig.LangLabel(a.text);this.pos=a.pos;this.size=
a.size;this.direction=sc.TUT_BOX_POINTING_DIR[a.direction]||sc.TUT_BOX_POINTING_DIR.TOP_LEFT;this.connectPos=a.connectPos||0;this.stopTime=a.stopTime||false},start:function(a){a.done=false;var b=new sc.TutorialMarkerGui(this.pos.x,this.pos.y,this.size.x,this.size.y,this.text.toString(),this.direction,this.connectPos,this.stopTime,function(){a.done=true});ig.gui.addGuiElement(b)},run:function(a){return a.done}});var b={PLAYER:function(a){ig.game.playerEntity.getAlignedPos(ig.ENTITY_ALIGN.CENTER,a)},
CROSSHAIR:function(a){var b=ig.game.playerEntity.gui.crosshair;b&&b.getAlignedPos(ig.ENTITY_ALIGN.CENTER,a)},ENEMY:function(a){for(var b=ig.game.shownEntities,d=b.length,g=null;d--;){var h=b[d];if(h instanceof ig.ENTITY.Enemy&&ig.EntityTools.isInScreen(h,-16)){g=h;break}}g=g||ig.game.playerEntity;g.getAlignedPos(ig.ENTITY_ALIGN.CENTER,a)}},a=Vec3.create(),d=Vec2.create();ig.EVENT_STEP.SHOW_TUTORIAL_PLAYER_MSG=ig.EventStepBase.extend({pos:null,size:null,text:null,direction:null,connectPos:0,_wm:new ig.Config({attributes:{text:{_type:"LangLabel",
_info:"Tutorial Text description",_large:true},targetType:{_type:"String",_info:"Marker Square position",_select:b},size:{_type:"Vec2",_info:"Marker Square size"},stopTime:{_type:"Boolean",_info:"If true: Stop time while displaying the message"}},width:500}),init:function(a){this.text=new ig.LangLabel(a.text);this.targetType=b[a.targetType]||b.PLAYER;this.size=a.size;this.stopTime=a.stopTime||false},start:function(b){b.done=false;var e=this.text.toString();this.targetType(a);var f=ig.system.getScreenFromMapPos(d,
a.x,a.y-a.z),g=0,g=f.x<ig.system.width/2?f.y<ig.system.height/2?sc.TUT_BOX_POINTING_DIR.BOTTOM_RIGHT:sc.TUT_BOX_POINTING_DIR.TOP_RIGHT:f.y<ig.system.height/2?sc.TUT_BOX_POINTING_DIR.BOTTOM_LEFT:sc.TUT_BOX_POINTING_DIR.TOP_LEFT;f.x=f.x-this.size.x/2;f.y=f.y-this.size.y/2;f.x=Math.round(f.x);f.y=Math.round(f.y);e=new sc.TutorialMarkerGui(f.x,f.y,this.size.x,this.size.y,e,g,0.5,this.stopTime,function(){b.done=true});ig.gui.addGuiElement(e)},run:function(a){return a.done}});ig.EVENT_STEP.SHOW_DEMO_HIGHSCORE=
ig.EventStepBase.extend({observatory:false,_wm:new ig.Config({attributes:{observatory:{_type:"Boolean",_info:"True if this is for the observatory challenge.",_default:false}}}),init:function(a){this.observatory=a.observatory||false},start:function(a){a.done=false;var b=new sc.DemoHighscore(function(){a.done=true},this.observatory);ig.gui.addGuiElement(b)},run:function(a){return a.done}});ig.EVENT_STEP.SHOW_DEMO_TIME=ig.EventStepBase.extend({observatory:false,_wm:new ig.Config({attributes:{observatory:{_type:"Boolean",
_info:"True if this is for the observatory challenge.",_default:false}}}),init:function(a){this.observatory=a.observatory||false},start:function(a){a.done=false;var b=new sc.DemoLastTime(function(){a.done=true},this.observatory);ig.gui.addGuiElement(b)},run:function(a){return a.done}});ig.EVENT_STEP.SHOW_GET_MSG=ig.EventStepBase.extend({text:null,track:null,wordLearned:false,_wm:new ig.Config({attributes:{msgType:{_type:"String",_info:"Type of get message",_select:["ACTIVATED","OBTAINED","REMOVED",
"ENEMY","EXTENDED","WORD","FRIENDSHIP","PARTY","USED","HAND_OVER","RESET"]},object:{_type:"LangLabel",_info:"Object of get message"}},width:500}),init:function(a){var b=a.msgType;if(b){if(b=="WORD")this.wordLearned=true;if(ig.lang){b=ig.lang.get("sc.gui.get-msg."+b);a=(new ig.LangLabel(a.object)).toString();this.text=ig.lang.grammarReplace(b,a,"\\i[<]"+a+"\\i[>]")}}else this.text="UNKNOWN MSG TYPE";this.track=ig.bgm.loadTrack("ability-got")},clearCached:function(){this.track.clearCached()},start:function(a){a.done=
false;this.wordLearned&&sc.stats.addMap("misc","words",1);var b=new sc.CenterMsgBoxGui(this.text,{maxWidth:300,textAlign:ig.Font.ALIGN.CENTER,speed:ig.TextBlock.SPEED.FASTEST},"white",0.3,function(){a.done=true});b.setBoxOffset(0,-64);ig.gui.addGuiElement(b);ig.bgm.inbetween(this.track,1,ig.BGM_SWITCH_MODE.MEDIUM)},run:function(a){return a.done}});ig.EVENT_STEP.SHOW_SIDE_MSG=ig.EventStepBase.extend({charExpression:null,message:null,hiCount:0,_wm:new ig.Config({attributes:{person:{_type:"PersonExpression",
_info:"Person + Exporession of message"},message:{_type:"LangLabel",_info:"Message to display",_large:true}},label:function(){return"<b>SHOW_SIDE_MSG</b> <em>"+wmPrint("PersonExpression",this.person)+"</em>: <i>"+wmPrint("LangLabel",this.message)+"</i>"}}),init:function(a){this.charExpression=new sc.CharacterExpression(a.person.person,a.person.expression);this.message=new ig.LangLabel(a.message);ig.langEdit&&ig.langEdit.submitMap("Side MSG "+this.charExpression.character.name,this.message);if(this.charExpression.character.name==
"main.lea"&&a.message&&a.message.en_US)this.hiCount=(this.hiCount=a.message.en_US.match(/hi[.!?]/gi))?this.hiCount.length:0},clearCached:function(){this.charExpression.decreaseRef()},start:function(){this.hiCount&&sc.stats.addMap("misc","hiCount",this.hiCount||0);ig.langEdit&&ig.langEdit.submitRecent("Side MSG "+this.charExpression.character.name,this.message);sc.model.message.showSideMessage(this.charExpression,this.message)}});ig.LANG_CONTEXT.SHOW_SIDE_MSG=function(a){var b="SIDE MSG[";a.person&&
(b=b+(a.person.person+">"+a.person.expression));return b+"]"};ig.EVENT_STEP.CLEAR_SIDE_MSG=ig.EventStepBase.extend({_wm:new ig.Config({attributes:{}}),init:function(){},start:function(){sc.model.message.clearSideMessages()}});ig.EVENT_STEP.SHOW_BOARD_MSG=ig.EventStepBase.extend({text:null,title:null,center:null,_wm:new ig.Config({attributes:{text:{_type:"LangLabel",_info:"Text to display.",_large:true},center:{_type:"Boolean",_info:"Center the text."},side:{_type:"String",_info:"If defined: moved board message to side of screen, allowing to display persons in parallel",
_select:sc.MESSAGE_SIDES,_optional:true},autoContinue:{_type:"Boolean",_info:"Automatically continue after message"}},width:600}),init:function(a){this.text=new ig.LangLabel(a.text);this.center=a.center;this.side=sc.MESSAGE_SIDES[a.side]||null;this.autoContinue=a.autoContinue||false;ig.langEdit&&ig.langEdit.submitMap("BOARD MSG TEXT",this.text)},start:function(){sc.model.message.showBoardMessage(this.text,this.center,this.side,this.autoContinue);ig.langEdit&&ig.langEdit.submitRecent("BOARD MSG TEXT",
this.text)},run:function(){return!sc.model.message.isBlocking()}});ig.LANG_CONTEXT.SHOW_BOARD_MSG=function(){return"BOARD_MSG"};ig.EVENT_STEP.CLEAR_BOARD_MSG=ig.EventStepBase.extend({_wm:new ig.Config({attributes:{}}),init:function(){},start:function(){sc.model.message.clearBoardMsg()}});ig.EVENT_STEP.SET_AUTO_SCRIPT=ig.EventStepBase.extend({value:null,_wm:new ig.Config({attributes:{value:{_type:"Boolean",_info:"If true: enable auto script (will automatically continue messages"}}}),init:function(a){this.value=
a.value},start:function(){sc.model.message.autoScript=this.value}})});ig.baked=!0;
ig.module("game.feature.msg.plug-in").requires("game.feature.msg.entities.event-trigger","game.feature.msg.gui.message-box","game.feature.msg.gui.dream-msg","game.feature.msg.gui.message-overlay","game.feature.msg.gui.message-board","game.feature.msg.gui.side-message-hud","game.feature.msg.message-model","game.feature.msg.msg-steps").defines(function(){if(window.wm){wm.postLoadModules.push("game.feature.msg.editors.msg-editor");wm.addStepColorRule(/MSG/,"red");wm.addStepColorRule(/SHOW_CHOICE/,"red")}});
ig.baked=!0;ig.module("game.feature.interact.screen-interact").requires("impact.feature.interact.interact").defines(function(){sc.ScreenInteractEntry=ig.InteractEntry.extend({callbackObject:null,withEscape:false,autoCtrlIgnore:false,init:function(b,a){this.callbackObject=b;this.withEscape=a?a:false},update:function(){if(sc.control.interactPressed(this.withEscape,this.autoCtrlIgnore)){ig.interact.setBlockDelay();this.callbackObject.onInteraction()}}})});ig.baked=!0;
ig.module("game.feature.interact.skip-interact").requires("impact.feature.interact.interact").defines(function(){function b(a,b){return a.order-b.order}sc.SKIP_INTERACT_MSG={ENABLED:1,DISABLED:2,SKIPPED:3};sc.SkipInteract=ig.GameAddon.extend({entries:[],init:function(){},addEntry:function(a){if(this.entries.indexOf(a)==-1){var d=this.getActiveEntry();this.entries.push(a);this.entries.sort(b);a=this.getActiveEntry();if(d!=a){if(d)d.handler.onSkipInteract(sc.SKIP_INTERACT_MSG.DISABLED);a.handler.onSkipInteract(sc.SKIP_INTERACT_MSG.ENABLED)}}},
removeEntry:function(a){var b=this.getActiveEntry();this.entries.erase(a);a=this.getActiveEntry();if(b!=a){if(b)b.handler.onSkipInteract(sc.SKIP_INTERACT_MSG.DISABLED);if(a)a.handler.onSkipInteract(sc.SKIP_INTERACT_MSG.ENABLED)}},getActiveEntry:function(){return this.entries[0]},triggerSkip:function(){var a=this.getActiveEntry();if(a)a.handler.onSkipInteract(sc.SKIP_INTERACT_MSG.SKIPPED)}});sc.SkipInteractEntry=ig.Class.extend({handler:null,order:0,init:function(a,b){this.handler=a;this.order=b},
isActive:function(){return sc.skipInteract.getActiveEntry()==this}});ig.addGameAddon(function(){return sc.skipInteract=new sc.SkipInteract})});ig.baked=!0;ig.module("game.feature.interact.plug-in").requires("game.feature.interact.map-interact","game.feature.interact.gui.interact-gui","game.feature.interact.screen-interact","game.feature.interact.skip-interact").defines(function(){});ig.baked=!0;
ig.module("game.feature.trade.gui.trade-menu").requires("game.feature.trade.trade-model","impact.base.image","impact.feature.gui.gui","game.feature.menu.gui.menu-misc","game.feature.trade.gui.trade-dialog","game.feature.trade.gui.equip-toggle-stats").defines(function(){sc.TradeMenu=ig.GuiElementBase.extend({gfx:new ig.Image("media/gui/menu.png"),transitions:{DEFAULT:{state:{},time:0.2,timeFunction:KEY_SPLINES.EASE},HIDDEN:{state:{},time:0.3,timeFunction:KEY_SPLINES.EASE_IN}},info:null,buffInfo:null,
topbar:null,back:null,help:null,toggleEquip:null,helpGui:null,tradeDialog:null,tradeOffer:null,tradeStats:null,tradeContent:null,money:null,moneyValue:null,init:function(b){this.parent();this.setSize(ig.system.width,ig.system.height);this.setPivot(ig.system.width/2,ig.system.height/2);this.hook.zIndex=1180;this.hook.pauseGui=true;this.tradeContent=b.options||null;this.tradeDialog=new sc.TradeDialogMenu;this.addChildGui(this.tradeDialog);this.tradeOffer=new sc.TradeOfferDisplay;this.addChildGui(this.tradeOffer);
this.tradeStats=new sc.TradeToggleStats;this.addChildGui(this.tradeStats);this.info=new sc.InfoBar;this.info.alpha=1;this.info.hook.transitions={DEFAULT:{state:{},time:0.2,timeFunction:KEY_SPLINES.EASE},HIDDEN:{state:{offsetY:-21},time:0.3,timeFunction:KEY_SPLINES.EASE_IN}};this.info.setAlign(ig.GUI_ALIGN.X_LEFT,ig.GUI_ALIGN.Y_BOTTOM);this.addChildGui(this.info);this.topbar=new ig.ColorGui("#000000",ig.system.width,21);this.topbar.hook.transitions={DEFAULT:{state:{},time:0.2,timeFunction:KEY_SPLINES.EASE},
HIDDEN:{state:{offsetY:-21},time:0.3,timeFunction:KEY_SPLINES.EASE_IN}};this.topbar.doStateTransition("HIDDEN",true);this.addChildGui(this.topbar);this.money=new ig.GuiElementBase;this.money.hook.transitions={DEFAULT:{state:{},time:0.2,timeFunction:KEY_SPLINES.EASE},HIDDEN:{state:{offsetY:-21},time:0.2,timeFunction:KEY_SPLINES.LINEAR}};this.money.setAlign(ig.GUI_ALIGN.X_RIGHT,ig.GUI_ALIGN.Y_TOP);this.money.setSize(125,21);this.money.setPos(144,0);this.moneyValue=new sc.NumberGui(99999999,{transitionTime:0.2});
this.moneyValue.setAlign(ig.GUI_ALIGN.X_RIGHT,ig.GUI_ALIGN.Y_TOP);this.moneyValue.setNumber(sc.model.player.credit,true);this.moneyValue.setPos(14,7);this.money.addChildGui(this.moneyValue);b=new sc.TextGui(ig.lang.get("sc.gui.trade.credits"),{font:sc.fontsystem.tinyFont});b.setPos(0,7);this.money.addChildGui(b);b=new ig.ImageGui(this.gfx,488,32,12,10);b.setAlign(ig.GUI_ALIGN.X_RIGHT,ig.GUI_ALIGN.Y_TOP);b.setPos(0,6);this.money.addChildGui(b);this.addChildGui(this.money);this.money.doStateTransition("HIDDEN",
true);this.buffInfo=new sc.BuffInfo;this.info.addChildGui(this.buffInfo);this.buffInfo.text.annotation.offset.x=-1;this.buffInfo.text.annotation.offset.y=-4;this.buffInfo.text.isHelpVisible=function(){return sc.trade.buffText};b=new sc.ButtonGui("\\i[back]"+ig.lang.get("sc.gui.menu.back"),sc.BUTTON_TOP_MENU_WIDTH,true,sc.BUTTON_TYPE.SMALL,sc.BUTTON_SOUND.back);b.hook.transitions={DEFAULT:{state:{},time:0.2,timeFunction:KEY_SPLINES.EASE},HIDDEN:{state:{offsetX:-sc.BUTTON_TOP_MENU_WIDTH},time:0.2,timeFunction:KEY_SPLINES.LINEAR}};
b.setAlign(ig.GUI_ALIGN.X_RIGHT,ig.GUI_ALIGN.Y_TOP);b.onButtonPress=function(){this._exitMenu()}.bind(this);b.setData({description:ig.lang.get("sc.gui.trade.end")});b.doStateTransition("HIDDEN",true);this.backButton=b;this.addChildGui(this.backButton);b=new sc.ButtonGui("\\i[help4]"+ig.lang.get("sc.gui.trade.toggle"),null,true,sc.BUTTON_TYPE.SMALL);b.hook.transitions={DEFAULT:{state:{},time:0.2,timeFunction:KEY_SPLINES.EASE},HIDDEN:{state:{offsetY:-sc.BUTTON_TYPE.SMALL.height},time:0.2,timeFunction:KEY_SPLINES.LINEAR}};
b.submitSound=null;b.onButtonPress=function(){if(sc.trade.equipID>=0){sc.BUTTON_SOUND.submit.play();sc.trade.toggleCompareMode()}}.bind(this);b.setAlign(ig.GUI_ALIGN.X_RIGHT,ig.GUI_ALIGN.Y_TOP);b.keepMouseFocus=true;b.setPos(73,0);b.setData({description:ig.lang.get("sc.gui.trade.toggleDes")});b.doStateTransition("HIDDEN",true);this.toggleEquip=b;b=new sc.ButtonGui("\\i[help]"+ig.lang.get("sc.gui.menu.hotkeys.help"),void 0,true,sc.BUTTON_TYPE.SMALL);b.keepMouseFocus=true;b.hook.transitions={DEFAULT:{state:{},
time:0.2,timeFunction:KEY_SPLINES.EASE},HIDDEN:{state:{offsetY:-b.hook.size.x},time:0.2,timeFunction:KEY_SPLINES.LINEAR}};b.onButtonPress=this._onHelpButtonPressed.bind(this);b.setAlign(ig.GUI_ALIGN.X_RIGHT,ig.GUI_ALIGN.Y_TOP);b.setPos(73,0);b.doStateTransition("HIDDEN",true);this.help=b;this.addChildGui(this.help);this.money.setPos(this.help.hook.size.x+this.backButton.hook.size.x+12,0)},enterTrade:function(){sc.Model.removeObserver(sc.trade,this);sc.Model.addObserver(sc.trade,this);sc.trade.enterTrade(this.tradeContent);
sc.trade.buttonInteract.clearAllButtons();sc.trade.buttonInteract.addGlobalButton(this.backButton,this._onBackButtonCheck.bind(this));sc.trade.buttonInteract.addGlobalButton(this.help,this._onHelpButtonCheck.bind(this));sc.trade.buttonInteract.addGlobalButton(this.toggleEquip,this._onToggleButtonCheck.bind(this));this.tradeDialog.showMenu();this.tradeOffer.showMenu();this.tradeStats.showMenu();this.buffInfo.setText("");this.doStateTransition("DEFAULT",true);this.info.doStateTransition("DEFAULT");
this.topbar.doStateTransition("DEFAULT");this.backButton.doStateTransition("DEFAULT");this.help.doStateTransition("DEFAULT");this.money.doStateTransition("DEFAULT");var b=sc.trade.getCurrentOffer().get[0];if(sc.inventory.isEquipID(b.id)){sc.trade.setEquipID(b.id);sc.trade.setBuffText("",false)}},_onHelpButtonCheck:function(){return sc.control.menuHotkeyHelp()},_onHelpButtonPressed:function(){this.help.doStateTransition("HIDDEN");this.money.doStateTransition("HIDDEN");this._createHelpGui();ig.gui.addGuiElement(this.helpGui);
this.helpGui.openMenu()},_onBackButtonCheck:function(){return sc.control.menuBack()},_onToggleButtonCheck:function(){return sc.control.menuHotkeyHelp4()},_createHelpGui:function(){if(!this.helpGui){this.helpGui=new sc.HelpScreen(this,ig.lang.get("sc.gui.menu.help-texts.trade.title"),ig.lang.get("sc.gui.menu.help-texts.trade.pages"),function(){this.help.doStateTransition("DEFAULT",false,false,null,0.2);this.money.doStateTransition("DEFAULT",false,false,null,0.2)}.bind(this));this.helpGui.hook.zIndex=
15E4;this.helpGui.hook.pauseGui=true}},_exitMenu:function(){sc.Model.removeObserver(sc.trade,this);this.tradeDialog.hideMenu();this.tradeOffer.hideMenu();this.tradeStats.hideMenu();sc.model.enterRunning();sc.trade.buttonInteract.clearAllButtons();sc.trade.exitTrade();this.helpGui=null;ig.interact.setBlockDelay(0.2);this.backButton.doStateTransition("HIDDEN");this.help.doStateTransition("HIDDEN");this.info.doStateTransition("HIDDEN");this.topbar.doStateTransition("HIDDEN");this.money.doStateTransition("HIDDEN");
this.doStateTransition("HIDDEN",false,true)},modelChanged:function(b,a,d){b==sc.trade&&(a==sc.TRADE_MODEL_EVENT.INFO_TEXT_CHANGED?this.info.setText(sc.trade.infoText,d?0.5:0):a==sc.TRADE_MODEL_EVENT.BUFF_TEXT_CHANGED?this.buffInfo.setText(sc.trade.buffText,d?0.5:0):a==sc.TRADE_MODEL_EVENT.TRADED&&this.moneyValue.setNumber(sc.model.player.credit))}})});ig.baked=!0;
ig.module("game.feature.npc.entities.npc-entity").requires("game.feature.npc.entities.sc-actor","game.feature.character.character","game.feature.interact.map-interact","game.feature.trade.gui.trade-menu").defines(function(){var b=new ig.ActorConfig({jumpingEnabled:true,maxVel:180,weight:200}),a=Vec3.create();Vec2.create();var d=new ig.Action("",[{type:"SET_FACE_TO_ENTITY",entity:{player:true},rotate:true}]),c=new ig.Action("",[{type:"SET_FACE",face:{actorAttrib:"preEventFace"},rotate:true}]);sc.NPC_REACT_TYPE=
{PUSHABLE:0,FIXED_POS:1,FIXED_FACE:2};sc.NPC_GENDER={BOTH:0,MALE:1,FEMALE:2};ig.LANG_CONTEXT.NPC=function(a){return"NPC["+(a.settings.name||"")+"]"};ig.ENTITY.NPC=sc.ActorEntity.extend({characterName:null,character:null,npcStates:[],npcStatesData:null,activeStateIdx:-1,configs:{},hidden:false,interactEntry:null,eventBlocked:false,deferredReset:false,npcEffects:new ig.EffectSheet("npc"),interactIcons:{normal:new sc.MapInteractIcon(new ig.TileSheet("media/gui/map-icon.png",24,24),{FOCUS:[0,1,2,3,4,
5,5,5],NEAR:[6]},0.1),shop:new sc.MapInteractIcon(new ig.TileSheet("media/gui/map-icon.png",24,24,0,240),{FOCUS:[0,0,1,2,3,0,0,0,0],NEAR:[4],AWAY:[5]},0.1),quest:new sc.MapInteractIcon(new ig.TileSheet("media/gui/map-icon.png",24,24,0,216),{FOCUS:[1,0,1,2,3,2],NEAR:[4],AWAY:[5]},0.1),arena:new sc.MapInteractIcon(new ig.TileSheet("media/gui/map-icon.png",24,24,0,264),{FOCUS:[1,0,1,2,3,2],NEAR:[4],AWAY:[5]},0.1),newMsg:new sc.MapInteractIcon(new ig.TileSheet("media/gui/map-icon.png",24,24),{FOCUS:[0,
1,2,3,4,5,5,5],NEAR:[6],AWAY:[7]},0.1),trade:new sc.MapInteractIcon(new ig.TileSheet("media/gui/map-icon.png",40,24,0,144),{FOCUS:[0,1,2,3],NEAR:[4],AWAY:[5]},0.3),xeno:new sc.MapInteractIcon(new ig.TileSheet("media/gui/map-icon.png",40,24,0,192),{FOCUS:[2],NEAR:[2],AWAY:[2]},0.3),xenoEvent:new sc.MapInteractIcon(new ig.TileSheet("media/gui/map-icon.png",40,24,0,192),{FOCUS:[0],NEAR:[1],AWAY:[1]},0.3)},lookAtAction:null,eventCall:null,doPostEventAction:false,xenoDialog:null,xenoDialogGui:null,permaEffect:null,
displayName:null,displayTrigger:null,displayNameRandom:null,respawn:{pos:Vec3.create()},_wm:new ig.Config({spawnable:true,attributes:{characterName:{_type:"Character",_info:"Character of NPC",_context:"Character"},npcStates:{_type:"NPCStates",_info:"Different states of the NPC",_popup:true},analyzable:{_type:"Analyzable",_info:"Analyzable if any.",_compact:true,_optional:true,_popup:true},hideCondition:{_type:"VarCondition",_info:"Condition for entity to become transparent",_optional:true,_width:70}},
label:function(){return""},drawBox:true,boxColor:"rgba(0,0,255, 0.5)"}),hideHandle:null,hideManager:null,init:function(a,b,c,d){this.parent(a,b,c,d);this.coll.setSize(12,12,28);this.coll.edgeSlipInward=true;this.npcStatesData=d.npcStates;this.interactEntry=new sc.MapInteractEntry(this,this,this.interactIcons.normal,sc.INTERACT_Z_CONDITION.Z_RANGE_OVERLAP,true);this.interactEntry.blockedDuringCombat=true;Vec3.assign(this.respawn.pos,this.coll.pos);if(this.characterName=d.characterName){if(window.wm){this._wm=
this._wm.copy();this._wm.drawBox=false}this.character=new sc.Character(this.characterName);this.character.addLoadListener(this)}if(d.analyzable){this.displayName=d.analyzable.text||null;this.displayTrigger=d.analyzable.active||null}else{this.displayName=d.displayName||null;this.displayTrigger=d.displayTrigger||null}if(d.hideCondition)this.hideManager=new ig.EntityHideManager(d.hideCondition)},onTerrainUpdate:function(){this.checkQuickRespawn()},setRespawnPoint:function(a){Vec3.assignC(this.respawn.pos,
a.x-this.coll.size.x/2,a.y-this.coll.size.y/2,a.z)},checkQuickRespawn:function(){var b=this.coll;if(b._collData&&!b._collData.zBaseUncertain)if(b.pos.z<ig.game.minLevelZ&&!this.tooHighToFall&&!this.coll.ignoreCollision){if(b.vel.z<0)b.vel.z=0;this.doQuickRespawn()}else{this.coll.float.height&&!this.jumping&&!ig.CollTools.isCloseToEdge(this.coll)&&(b.baseZPos>=ig.game.minLevelZ&&!ig.terrain.isDangerTerrain(ig.terrain.getTerrain(this.coll,false,true)))&&Vec3.assign(this.respawn.pos,this.coll.pos);if(!(b.pos.z>
b.baseZPos||this.jumping||b.zGravityFactor==0)){b=this.stepStats.terrain;if(ig.terrain.isFallTerrain(b)){var c=this.getAlignedPos(ig.ENTITY_ALIGN.BOTTOM,a);b==ig.TERRAIN.WATER&&ig.game.effects.death.spawnFixed("waterSplash",c.x,c.y,c.z);this.doQuickRespawn(b)}else!ig.CollTools.isCloseToEdge(this.coll)&&(!ig.terrain.isDangerTerrain(this.stepStats.terrain)&&!this.respawn.timer)&&Vec3.assign(this.respawn.pos,this.coll.pos)}}},doQuickRespawn:function(){Vec3.assignC(this.coll.vel,0,0,0);this.setPos(this.respawn.pos.x,
this.respawn.pos.y,this.respawn.pos.z);this.nav.path.redoPathDeferred();ig.game.effects.npc.spawnOnTarget("appear",this)},getQuickMenuSettings:function(){return{type:"NPC",displayName:this.displayName,displayTrigger:this.displayTrigger,randomName:this.displayNameRandom,disabled:this.hidden}},onLoadableComplete:function(c){if(!c)throw Error("Character loading failed for character '"+this.characterName);c=this.character.data;c.size&&Vec3.assign(this.coll.size,c.size);c.shadow==void 0&&(c.shadow=16);
this.animSheet=new ig.AnimationSheet(c.animSheet);for(var d in c.walkAnimSet)this.storeWalkAnims(d,c.walkAnimSet[d]);var g=new ig.ActorConfig;g.loadFromData(c,b);for(var h in c.configs){var i=c.configs[h];this.configs[h]=new ig.ActorConfig;this.configs[h].loadFromData(i,g)}this.setWalkAnims(d);if(d=this.npcStatesData)for(h=0;h<d.length;++h)this.npcStates.push(new sc.NpcState(d[h],this));this.npcStatesData=null;if(window.wm){if(this.npcStates[0]){Vec2.assign(this.face,this.npcStates[0].face);d=Vec3.assign(a,
this.coll.pos);this.setDefaultConfig(this.configs[this.npcStates[0].config]);this.setPos(d.x,d.y,d.z)}}else this.updateNpcState(true);this.lookAtAction=new ig.Action("",[{type:"SET_FACE_TO_ENTITY",entity:this,rotate:true}]);this.lookAtAction.eventAction=true;this.initAnimations()},onKill:function(a){this.parent(a);this.character.decreaseRef();this.animSheet.decreaseRef();for(a=0;a<this.npcStates.length;++a)this.npcStates[a].clearCached()},update:function(){if(this.deferredReset){this.eventBlocked=
false;this.updateNpcState(false,true);this.deferredReset=false}this.interactEntry.gui.hook.localAlpha=this.animState.alpha;this.hideManager&&this.hideManager.update(this);this.parent()},onPartySwapHide:function(){sc.mapInteract.removeEntry(this.interactEntry);this.hide()},postActionUpdate:function(){if(!this.eventCall||!this.eventCall.isRunning()||!this.doPostEventAction){this.eventCall=null;if(this.currentAction&&this.currentAction.eventAction)this.eventBlocked=true;if(!this.currentAction&&!this.eventBlocked)if(this.hasStashedAction())this.resumeStashedAction();
else{var a=this.npcStates[this.activeStateIdx];a&&a.loopAction&&this.setAction(a.loopAction)}if(!this.currentAction&&this.hidden&&!this._hidden&&!this.deferredReset){sc.mapInteract.removeEntry(this.interactEntry);this.animState.alpha=0;this.hide()}if(!this.currentAction&&!sc.model.isCutscene()&&(this.postActionSceneReset||this.eventBlocked)){this.postActionSceneReset=false;this.deferredReset=true}}},varsChanged:function(){this.updateNpcState(false);this.hideManager&&this.hideManager.varsChanged(this)},
resetNpcState:function(a){if(a||this._hidden){this.eventBlocked=false;this.updateNpcState(true,true)}else this.deferredReset=true},setConfig:function(a){this.configs[a]?this.setDefaultConfig(this.configs[a]):ig.warn("NPC: No such config available: "+a)},hasNpcStateChanged:function(){for(var a=this.npcStates.length;a--;)if(this.npcStates[a].condition.evaluate())break;return a!=this.activeStateIdx},updateNpcState:function(b,c){var d=this.currentAction&&this.currentAction.eventAction&&this._hidden,h=
this.eventBlocked||this.currentAction&&this.currentAction.eventAction&&!this._hidden;b&&(h=false);for(var i=this.npcStates.length;i--;)if(this.npcStates[i].condition.evaluate())break;if(!d||this.npcStates[i]&&!this.npcStates[i].hidden)if(c||b||i!=this.activeStateIdx){this.permaEffect&&this.permaEffect.stop();this.permaEffect=null;this.postActionSceneReset=h;this.cancelPostEventAction();var j=this.npcStates[this.activeStateIdx],k=!j||j.hidden;this.activeStateIdx=i;if(i==-1){sc.mapInteract.removeEntry(this.interactEntry);
if(!h){this.hidden=true;this.cancelAction();this.hide()}}else{i=this.npcStates[this.activeStateIdx];if(!h){var l=this.configs[i.config];i.reactType!=sc.NPC_REACT_TYPE.PUSHABLE?l.overwrite("weight",-1):l.clearOverwrite();var o;if(d){o=this.currentAction;this.cancelAction()}if(b)var m=Vec3.assign(a,this.coll.pos);this.setDefaultConfig(this.configs[this.npcStates[0].config]);b&&this.setPos(m.x,m.y,m.z);this.setDefaultConfig(l);this.hidden=i.hidden;d&&this.setAction(o)}if(b)if(this.hidden)this.hide();
else{this.animState.alpha=1;this.show()}this.setMapInteractIcon(i);h||!i.npcEventObj?sc.mapInteract.removeEntry(this.interactEntry):sc.mapInteract.addEntry(this.interactEntry);if(!h)if(b||k&&this.hidden&&this._hidden){this.setPos(i.position.x-this.coll.size.x/2,i.position.y-this.coll.size.y/2,i.position.z);Vec2.assign(this.face,i.face);if(i.permaFx)this.permaEffect=i.permaFx.spawnOnTarget(this,{duration:-1})}else{h=null;if(k&&this._hidden){if(j){this.setPos(j.position.x-this.coll.size.x/2,j.position.y-
this.coll.size.y/2,j.position.z);Vec2.assign(this.face,j.face)}this.show();this.animState.alpha=0;i.showFx?i.showFx.spawnOnTarget(this):this.npcEffects.spawnOnTarget("appear",this,{duration:0});if(j&&j.door)h=(j=ig.Event.getEntity(j.door))&&j.leaveEntity(this)}if(i.permaFx)this.permaEffect=i.permaFx.spawnOnTarget(this,{duration:-1});!d&&i.reactType!=sc.NPC_REACT_TYPE.FIXED_FACE&&this.setAction(i.startAction);h&&this.pushInlineAction(h,true,true)}}}},setMapInteractIcon:function(a){if(a.npcEventType==
sc.NPC_EVENT_TYPE.TRADE){this.interactEntry.setIcon(this.interactIcons.trade);this.interactEntry.setSubGui(a.npcEventObj.iconGui)}else if(a.npcEventType==sc.NPC_EVENT_TYPE.QUEST)this.interactEntry.setIcon(this.interactIcons.quest);else if(a.npcEventType==sc.NPC_EVENT_TYPE.SHOP)this.interactEntry.setIcon(this.interactIcons.shop);else if(a.npcEventType==sc.NPC_EVENT_TYPE.ARENA)this.interactEntry.setIcon(this.interactIcons.arena);else{this.interactEntry.setIcon(this.interactIcons.normal);this.interactEntry.setSubGui(null)}},
setXenoDialog:function(a){this._initXenoDialogGui();this.interactEntry.setSubGui(this.xenoDialogGui);this.xenoDialog=a||null;sc.mapInteract.addEntry(this.interactEntry);this.xenoDialog.getCallbackEvent()?this.interactEntry.setIcon(this.interactIcons.xenoEvent):this.interactEntry.setIcon(this.interactIcons.xeno);this.xenoDialogGui.setText(a.getCurrentText(),a);this.xenoDialogGui.show()},isXenoTextFinished:function(){return this.xenoDialogGui&&this.xenoDialogGui.isTextFinished()},cancelXenoDialog:function(){this.xenoDialog=
null;this.xenoDialogGui.hide();sc.mapInteract.removeEntry(this.interactEntry)},_initXenoDialogGui:function(){if(!this.xenoDialogGui)this.xenoDialogGui=new sc.XenoDialogIcon},onInteraction:function(){var a;if(!sc.quests.hasSolvedQuestsStacked()){if(this.xenoDialog){if(!this.xenoDialog.getCallbackEvent())return false;a=this.xenoDialog.getCallbackEvent();this.xenoDialog.onEventStart()}else{var b=this.npcStates[this.activeStateIdx];b.npcEventObj&&(a=b.npcEventType==sc.NPC_EVENT_TYPE.TRADE?b.npcEventObj.event:
b.npcEventObj)}if(a)this.eventCall=ig.game.events.callEvent(a,ig.EventRunType.BLOCKING,this.onEventStart.bind(this),this.onEventEnd.bind(this),null,this,{character:this.characterName})}},onEventStart:function(){var a=this.npcStates[this.activeStateIdx];ig.game.playerEntity.setAction(this.lookAtAction);var b=sc.party.getPartyMemberEntityByIndex(0),c=sc.party.getPartyMemberEntityByIndex(1);b&&b.setAction(this.lookAtAction);c&&c.setAction(this.lookAtAction);if(a.reactType!=sc.NPC_REACT_TYPE.FIXED_FACE){this.setAttribute("preEventFace",
ig.copy(this.face));this.doPostEventAction=true;this.eventBlocked?this.eventBlocked=false:this.stashAction();this.setAction(d);this.eventBlocked=true}a=this.getCenter();a.y=a.y-this.coll.pos.z;ig.camera.pushTarget(new ig.Camera.TargetHandle(new ig.Camera.PosTarget(a),0,0),"FAST");sc.model.enterCutscene()},onEventEnd:function(){this.eventBlocked=false;if(this.currentAction&&this.currentAction.eventAction)this.postActionSceneReset=true;if(!this.postActionSceneReset&&this.doPostEventAction)if(this.hasStashedAction())this.setAction(c);
else{var a=this.npcStates[this.activeStateIdx];a&&this.setAction(a.startAction)}else this.updateNpcState(false,true);if(this.xenoDialog)this.xenoDialog.onEventEnd();ig.camera.popTarget("FAST");sc.model.enterGame()},startTradeMenu:function(){var a=this.npcStates[this.activeStateIdx];a.npcEventObj&&a.npcEventType==sc.NPC_EVENT_TYPE.TRADE&&a.npcEventObj.startTradeMenu()},cancelPostEventAction:function(){this.clearStashedAction();this.doPostEventAction=false}});sc.NPC_EVENT_TYPE={SIMPLE:0,TRADE:1,QUEST:2,
SHOP:3,ARENA:4};sc.NpcState=ig.Class.extend({_wm:new ig.Config({attributes:{condition:{_type:"VarCondition",_info:"Condition for this page to be active",_height:24},position:{_type:"Vec3",_info:"Position of NPC for this page",_pointSelect:true,_optional:true},reactType:{_type:"String",_info:"How NPC will react on touches and talking",_float:true,_select:sc.NPC_REACT_TYPE,_default:"FIXED_POS"},face:{_type:"Face",_info:"Face direction.",_float:true},config:{_type:"CharConfig",_info:"Configuration of Charater for this page",
_float:true},action:{_type:"Action",_info:"Action to perform constantly",_popup:true,_float:true,_clear:true,_optional:true},showFx:{_type:"Effect",_info:"Action to perform constantly",_popup:true,_float:true,_optional:true},hideFx:{_type:"Effect",_info:"Action to perform constantly",_popup:true,_float:true,_optional:true},permaFx:{_type:"Effect",_info:"Action to perform constantly",_popup:true,_float:true,_optional:true},hidden:{_type:"Boolean",_info:"If true: NPC is hidden.",_float:true,_clear:true},
door:{_type:"Entity",_info:"Door that NPC should enter from/leave to (only specify when hidden!)",_optional:true,_float:true},event:{_type:"NPCEvent",_info:"Type of npc event. e.g. simple event or trade."}}}),condition:null,position:Vec3.create(),config:null,face:Vec2.create(),hidden:false,door:null,startAction:null,loopAction:null,reactType:sc.NPC_REACT_TYPE.PUSHABLE,npcEventObj:null,npcEventType:null,showFx:null,permaFx:null,init:function(a,b){this.condition=new ig.VarCondition(a.condition);if(a.position)ig.Event.getVec3(a.position,
this.position);else{b.getCenter(this.position);this.position.z=b.coll.pos.z}ig.ActorEntity.getFaceVec(ig.ActorEntity.FACE8[a.face]||0,this.face);this.hidden=a.hidden||false;this.config=a.config;if(!b.configs[this.config]){for(var c in b.configs)break;this.config=c}this.door=a.door;this.reactType=sc.NPC_REACT_TYPE[a.reactType||"PUSHABLE"];c=[{type:"NAVIGATE_TO_POINT",target:this.position,maxTime:0,teleportOnFail:true,precise:!this.door&&this.reactType==sc.NPC_REACT_TYPE.FIXED_POS}];this.hidden?c.push({type:"SHOW_EFFECT",
effect:a.hideFx?ig.copy(a.hideFx):{sheet:"npc",name:"disappear"},duration:0,wait:!this.door,actionDetached:true}):c.push({type:"SET_FACE",face:a.face||0,rotate:true});this.door&&c.push({type:"ENTER_DOOR",door:this.door});this.startAction=new ig.Action("[NPC]",c);if(a.showFx)this.showFx=new ig.EffectHandle(a.showFx);if(a.permaFx)this.permaFx=new ig.EffectHandle(a.permaFx);if(a.action&&a.action.length>0&&!this.hidden)this.loopAction=new ig.Action("[NPC]",a.action);if(a.event)if(a.event instanceof Array){if(a.event.length>
0){c={name:"NPC EVENT",steps:a.event};this.npcEventObj=new ig.Event(c);this.npcEventType=sc.NPC_EVENT_TYPE.SIMPLE}}else if(a.event instanceof Object)if(a.event.trade){this.npcEventObj=new sc.TradeInfo(a.event.trade,b);this.npcEventType=sc.NPC_EVENT_TYPE.TRADE}else if(a.event.quest){c={name:"NPC EVENT",steps:a.event.quest};this.npcEventObj=new ig.Event(c);this.npcEventType=sc.NPC_EVENT_TYPE.QUEST}else if(a.event.shop){c={name:"NPC EVENT",steps:a.event.shop};this.npcEventObj=new ig.Event(c);this.npcEventType=
sc.NPC_EVENT_TYPE.SHOP}else if(a.event.arena){c={name:"NPC EVENT",steps:a.event.arena};this.npcEventObj=new ig.Event(c);this.npcEventType=sc.NPC_EVENT_TYPE.ARENA}},clearCached:function(){this.npcEventObj&&this.npcEventObj.clearCached();this.startAction&&this.startAction.clearCached();this.loopAction&&this.loopAction.clearCached();this.showFx&&this.showFx.clearCached();this.permaFx&&this.permaFx.clearCached()}});ig.ACTOR_CONFIGS.NPC={classType:ig.ENTITY.NPC,KEYS:{sizeOverride:null,terrain:0},fromDataFix:function(){typeof this.terrain==
"string"&&(this.terrain=ig.TERRAIN[this.terrain]||0)},apply:function(a){this.sizeOverride&&a.coll.setSize(this.sizeOverride.x,this.sizeOverride.y,this.sizeOverride.z,true);a.terrain=this.terrain||0},load:function(a){this.terrain=a.terrain}}});ig.baked=!0;
ig.module("game.feature.npc.entities.npc-runner-entity").requires("game.feature.npc.entities.sc-actor","game.feature.character.character","game.feature.interact.map-interact","game.feature.trade.gui.trade-menu").defines(function(){var b=new ig.ActorConfig({jumpingEnabled:true,maxVel:180,weight:200,collType:ig.COLLTYPE.IGNORE,soundType:"none"}),a={NORTH:{x:0,y:1},EAST:{x:-1,y:0},SOUTH:{x:0,y:-1},WEST:{x:1,y:0}},d=Vec2.create(),c=Vec3.create();sc.NPCRunnerEntity=sc.ActorEntity.extend({npcEffects:new ig.EffectSheet("npc"),
characterName:null,character:null,configs:{},pushTimer:0,effects:{water:new ig.EffectSheet("scene.water")},init:function(a,c,d,h){this.parent(a,c,d,h);this.coll.setSize(12,12,28);this.coll.edgeSlipInward=true;this.character=h.character;a=this.character.data;a.size&&Vec3.assign(this.coll.size,a.size);a.shadow==void 0&&(a.shadow=16);this.animSheet=h.animSheet;for(var i in a.walkAnimSet)this.storeWalkAnims(i,a.walkAnimSet[i]);i=new ig.ActorConfig;i.loadFromData(a,b);for(var j in a.configs){c=new ig.ActorConfig;
c.loadFromData(a.configs[j],i);c.overwrite("weight",20);c.overwrite("relativeVel",h.speed);this.setDefaultConfig(c);break}this.initAnimations();this.initAction(h.enter,h.exit,h.waypoints,h.partyIdx)},initAction:function(a,b,c,d){var i=Vec3.create(),a=this.getDestinationEntryAndPos(a,sc.NPC_RUNNER_DEST_TYPE.ENTER,d,i),j=Vec3.create(),b=this.getDestinationEntryAndPos(b,sc.NPC_RUNNER_DEST_TYPE.EXIT,d,j);this.setPos(i.x-this.coll.size.x/2,i.y-this.coll.size.y/2,i.z);ig.ActorEntity.getFaceVec(ig.ActorEntity.FACE8[a.dir]||
0,this.face);this.animState.alpha=0;this.npcEffects.spawnOnTarget("appear",this,{duration:0});i=null;a.entity.leaveEntity&&(i=a.entity.leaveEntity(this));j=[{type:"NAVIGATE_TO_POINT",target:j,maxTime:0,precise:false},{type:"SHOW_EFFECT",effect:{sheet:"npc",name:"disappear"},duration:0,wait:false,actionDetached:true},{type:"ENTER_DOOR",door:b.entity}];if(c)for(b=c.length;b--;){var k=c[b],d=Vec3.create();k.getAlignedPos(ig.ENTITY_ALIGN.BOTTOM,d);var l=k.coll.size.x-this.coll.size.x,k=k.coll.size.y-
this.coll.size.y;d.x=d.x+(Math.random()-0.5)*l;d.y=d.y+(Math.random()-0.5)*k;j.unshift({type:"NAVIGATE_TO_POINT",target:d,maxTime:0,precise:false})}a.waiting&&j.unshift({type:"WAIT",time:0.1+Math.random()*1});c=new ig.Action("[NPC]",j);this.setAction(c);i&&this.pushInlineAction(i,true,true)},getDestinationEntryAndPos:function(b,c,d,h){for(var i=b.entries,j=[],k=b.entries.length;k--;){b=i[k];b.type&c&&(c!=sc.NPC_RUNNER_DEST_TYPE.ENTER||!b.entity.isRunnerDestBlocked||!b.entity.isRunnerDestBlocked())&&
j.push(b)}j.length==0&&(j=i);b=j[d%j.length];c=b.entity;c.getAlignedPos(ig.ENTITY_ALIGN.BOTTOM,h);if(b.posType==sc.NPC_RUNNER_DEST_POS_TYPE.SIDE){d=a[b.dir];h.x=h.x+d.x*(c.coll.size.x/2+this.coll.size.x/2);h.y=h.y+d.y*(c.coll.size.y/2+this.coll.size.y/2);if(!d.x){i=Math.max(0,c.coll.size.x-64)/2;h.x=h.x+(2*Math.random()-1)*i}if(!d.y){c=Math.max(0,c.coll.size.y-64)/2;h.y=h.y+(2*Math.random()-1)*c}}return b},update:function(){this.parent();var a=this.coll,b=false;if(a.type==ig.COLLTYPE.IGNORE)for(var g=
ig.game.getEntitiesInRectangle(a.pos.x,a.pos.y,a.pos.z,a.size.x,a.size.y,a.size.z,this),h=g.length;h--;){var i=g[h];if(i instanceof sc.ActorEntity&&i.coll.type!==ig.COLLTYPE.TRIGGER){ig.CollTools.getDistVec2(i.coll,a,d);Vec2.length(d,80*(1-this.pushTimer/1).limit(0,1));Vec2.add(a.pushVel,d);b=true}}this.pushTimer=b?this.pushTimer+ig.system.tick:0;if(ig.terrain.getTerrain(a,true)==ig.TERRAIN.WATER){a=this.getAlignedPos(ig.ENTITY_ALIGN.BOTTOM,c);this.effects.water.spawnFixed("circularSmallSplash",a.x,
a.y,a.z);this.kill()}(sc.model.isCombatActive()||!sc.npcRunner.hasGroup())&&!ig.EntityTools.isInScreen(this,16)&&this.kill();this.currentAction||this.kill()},onKill:function(a){this.parent(a)}})});ig.baked=!0;
ig.module("game.feature.npc.npc-runners").requires("impact.base.game").defines(function(){sc.NPC_RUNNER_GROUP={};var b=[{name:"cross-worlds.triblader-male-blue",prob:1},{name:"cross-worlds.triblader-female-purple",prob:1},{name:"cross-worlds.hexacast-male-dark",prob:1},{name:"cross-worlds.hexacast-male-red",prob:1},{name:"cross-worlds.pentafist-male-dark",prob:1},{name:"cross-worlds.pentafist-female-rasta",prob:1},{name:"cross-worlds.quadroguard-female-gray",prob:1},{name:"cross-worlds.quadroguard-male-black",
prob:1},{name:"cross-worlds.sphero-female-green",prob:0.25},{name:"cross-worlds.sphero-male-brown",prob:0.25}];sc.NPC_RUNNER_GROUP.CROSSCENTRAL={characters:b,npcsPerMinute:80,maxParty:3,runProb:0.5};sc.NPC_RUNNER_GROUP.RHOMBUS_SQUARE={characters:b,npcsPerMinute:40,maxParty:3,runProb:0.4};sc.NPC_RUNNER_GROUP.CROWDED={characters:b,npcsPerMinute:20,maxParty:3,runProb:0.2};sc.NPC_RUNNER_GROUP.LIVELY={characters:b,npcsPerMinute:10,maxParty:3,runProb:0.3};sc.NPC_RUNNER_GROUP.REGULAR={characters:b,npcsPerMinute:6,
maxParty:2,runProb:0.5};sc.NPC_RUNNER_GROUP.FEW={characters:b,npcsPerMinute:2,maxParty:2,runProb:0.5};sc.NPC_RUNNER_DEST_TYPE={ENTER:1,EXIT:2,ENTER_EXIT:3};sc.NPC_RUNNER_DEST_POS_TYPE={CENTER:1,SIDE:2};sc.NpcRunnerSpawner=ig.GameAddon.extend({mapGroup:null,currentGroup:null,groupData:null,lastChars:[],active:false,destinations:{enter:[],enterFullProb:0,exit:[],exitFullProb:0},timer:0,spawnTeamCount:0,currentPartySize:0,spawnEntrance:null,waypoints:null,spawnExit:null,spawnSpeed:0,init:function(){this.parent("NPC Runners")},
cancelSpawning:function(){this.spawnTeamCount=0;this.spawnExit=this.spawnEntrance=null;this.lastChars.length=0},setGroup:function(a){if(this.currentGroup!=a){this.currentGroup&&this.clearGroup();this.currentGroup=a;this.cancelSpawning();if(this.currentGroup){this.groupData={characters:[],fullProb:0,maxTimer:60/this.currentGroup.npcsPerMinute};for(var a=this.currentGroup.characters,b=0;b<a.length;++b){var c=a[b],e={character:new sc.Character(c.name),animSheet:null,prob:c.prob,maxSpeed:c.speed||0};
this.groupData.characters.push(e);this.groupData.fullProb=this.groupData.fullProb+c.prob;e.character.addLoadListener(this)}this.timer=this.groupData.maxTimer*(0.05+Math.random()*0.1)}}},onLoadableComplete:function(a,b){for(var c=this.groupData.characters,e=c.length;e--;)if(c[e].character==b)c[e].animSheet=new ig.AnimationSheet(b.data.animSheet)},hasGroup:function(){return!!this.groupData},resetToMapGroup:function(){this.setGroup(this.mapGroup)},clearGroup:function(){if(this.groupData){for(var a=this.groupData.characters,
b=a.length;b--;){var c=a[b];c.character.decreaseRef();c.animSheet.decreaseRef()}this.groupData=this.currentGroup=null}},initWayPoints:function(){for(var a=ig.game.getEntitiesByType("NPCWaypoint"),b=a.length;b--;)a[b].initWayPoints();sc.NpcWayPointSearcher.resetIndex()},searchDestinations:function(){this.destinations.enter.length=0;this.destinations.exit.length=0;this.destinations.enterFullProb=0;this.destinations.exitFullProb=0;for(var a=ig.game.entities,b=a.length;b--;){var c=a[b];if(c&&c.getRunnerDestination){var e=
c.getRunnerDestination();if(e){for(var f=0,g=e.entries.length;g--;)f=f|e.entries[g].type;e.type=f;e.entity=c;if(e.enterProb&&f&sc.NPC_RUNNER_DEST_TYPE.ENTER){this.destinations.enter.push(e);this.destinations.enterFullProb=this.destinations.enterFullProb+e.enterProb}if(e.exitProb&&f&sc.NPC_RUNNER_DEST_TYPE.EXIT){this.destinations.exit.push(e);this.destinations.exitFullProb=this.destinations.exitFullProb+e.exitProb}}}}this.active=this.destinations.enter.length>0&&this.destinations.exit.length>0;if(this.destinations.enter.length==
1&&this.destinations.exit.length==1&&this.destinations.enter[0]==this.destinations.exit[0])this.active=false},spawnNpcGroup:function(){this.spawnEntrance=this.getRandomDestination(false,null);this.spawnExit=this.getRandomDestination(true,this.spawnEntrance);this.waypoints=this.getWayPoints(this.spawnEntrance.entity,this.spawnExit.entity);var a=Math.random();this.currentPartySize=this.spawnTeamCount=Math.ceil(Math.pow(a,2)*this.currentGroup.maxParty);this.spawnSpeed=Math.random()<=this.currentGroup.runProb?
0.8+Math.random()*0.1:0.5+Math.random()*0.1;this.spawnNpcRunner()},spawnNpcRunner:function(){var a=this.spawnEntrance,b=this.spawnExit,c=this.getRandomCharacter();ig.game.spawnEntity(sc.NPCRunnerEntity,0,0,0,{enter:a,exit:b,partyIdx:this.currentPartySize-this.spawnTeamCount,waypoints:this.waypoints,character:c.character,animSheet:c.animSheet,speed:c.speed||this.spawnSpeed});this.spawnTeamCount--},getRandomDestination:function(a,b){var c=a?this.destinations.exitFullProb:this.destinations.enterFullProb,
e=a?this.destinations.exit:this.destinations.enter;b&&(c=c-(a?b.exitProb:b.enterProb));for(var c=Math.random()*c,f=e.length;f--;){var g=e[f];if(g!=b){c=c-(a?g.exitProb:g.enterProb);if(c<=0)return g}}},getWayPoints:function(a,b){return sc.NpcWayPointSearcher.searchConnection(a.getWPConnect(),b.getWPConnect())},getRandomCharacter:function(){do for(var a,b=Math.random()*this.groupData.fullProb,c=this.groupData.characters,e=c.length;e--;){var f=c[e],b=b-f.prob;if(b<=0){a=f;break}}while(this.lastChars.indexOf(a)!=
-1);this.lastChars.push(a);this.lastChars.length>Math.floor(this.groupData.characters.length/2)&&this.lastChars.shift();return a},preUpdateOrder:100,onPreUpdate:function(){if(this.currentGroup&&this.active&&!sc.model.isCombatActive()&&!ig.game.paused&&!ig.loading){this.timer=this.timer-ig.system.tick;if(this.timer<=0){this.spawnTeamCount>0?this.spawnNpcRunner():this.spawnNpcGroup();this.timer=this.spawnTeamCount?0.3:this.groupData.maxTimer*(0.4+Math.random()*0.6)}}},levelLoadStartOrder:120,onLevelLoadStart:function(a){a=
sc.NPC_RUNNER_GROUP[a.attributes&&a.attributes.npcRunners]||null;this.cancelSpawning();this.mapGroup=a;this.setGroup(a)},levelLoadedOrder:120,onLevelLoaded:function(){this.initWayPoints();this.searchDestinations()},onReset:function(){this.clearGroup()}});ig.addGameAddon(function(){return sc.npcRunner=new sc.NpcRunnerSpawner})});ig.baked=!0;
ig.module("game.feature.npc.npc-steps").requires("impact.base.action","impact.base.event","game.feature.npc.npc-runners").defines(function(){ig.EVENT_STEP.DO_THE_SHAKE=ig.EventStepBase.extend({person:null,expression:null,message:null,_wm:new ig.Config({attributes:{person:{_type:"PersonExpression",_info:"Talking person"}},label:function(){return"<em style='color: greenyellow'>DO THE SHAKE</em>"}}),init:function(b){if(b.person&&b.person.person){this.person=b.person.person;this.charExpression=new sc.CharacterExpression(b.person.person,
b.person.expression)}else this.person=b.person},clearCached:function(){this.charExpression&&this.charExpression.decreaseRef()},start:function(){this.charExpression&&sc.model.message.setExpression(this.person,this.charExpression);var b=ig.lang.get("sc.gui.shakeit.first");this.message=ig.lang.get("sc.gui.shakeit.start")+" ";this.message=this.message+(b[Math.floor(Math.random()*(b.length-1))]+" ");b=ig.lang.get("sc.gui.shakeit.second");this.message=this.message+(b[Math.floor(Math.random()*(b.length-
1))]+" ");b=ig.lang.get("sc.gui.shakeit.third");this.message=this.message+(b[Math.floor(Math.random()*(b.length-1))]+"!");sc.model.message.showMessage(this.person,this.message,false)},run:function(){return!sc.model.message.isBlocking()}});ig.EVENT_STEP.RESET_NPC=ig.EventStepBase.extend({npc:null,_wm:new ig.Config({attributes:{npc:{_type:"Entity",_info:"NPC to reset"}}}),init:function(b){this.npc=b.npc},start:function(b,a){var d=ig.Event.getEntity(this.npc,a);if(d&&d instanceof ig.ENTITY.NPC){d.cancelAction();
d.resetNpcState()}}});ig.EVENT_STEP.SET_NPC_RUNNERS=ig.EventStepBase.extend({frequency:null,_wm:new ig.Config({attributes:{frequency:{_type:"String",_info:"Frequency of NPC Runners. Null = no NPC runners",_select:sc.NPC_RUNNER_GROUP,_withNull:true}}}),init:function(b){this.frequency=b.frequency},start:function(){sc.npcRunner.setGroup(sc.NPC_RUNNER_GROUP[this.frequency]||null)}});ig.EVENT_STEP.RESET_NPC_RUNNERS=ig.EventStepBase.extend({_wm:new ig.Config({attributes:{}}),init:function(){},start:function(){sc.npcRunner.resetToMapGroup()}});
ig.EVENT_STEP.SET_NPC_CONFIG=ig.EventStepBase.extend({npc:null,config:null,_wm:new ig.Config({attributes:{npc:{_type:"NPC",_info:"NPC to change"},config:{_type:"String",_info:"Config name to apply"}}}),init:function(b){this.npc=b.npc;this.config=b.config},start:function(b,a){var d=ig.Event.getEntity(this.npc,a);d&&d instanceof ig.ENTITY.NPC&&d.setConfig(this.config)}});ig.ACTION_STEP.RESET_NPC=ig.ActionStepBase.extend({_wm:new ig.Config({attributes:{}}),init:function(){},run:function(b){b instanceof
ig.ENTITY.NPC&&b.resetNpcState();return true}});ig.ACTION_STEP.APPLY_NPC_CONFIG=ig.EventStepBase.extend({config:null,_wm:new ig.Config({attributes:{config:{_type:"String",_info:"Config name to apply"}}}),init:function(b){this.config=b.config},run:function(b){var a=b.configs[this.config];a&&a.apply(b);return true}})});ig.baked=!0;
ig.module("game.feature.npc.plug-in").requires("game.feature.npc.entities.sc-actor","game.feature.npc.entities.npc-entity","game.feature.npc.entities.npc-runner-entity","game.feature.npc.entities.npc-waypoint","game.feature.npc.npc-runners","game.feature.npc.npc-steps").defines(function(){if(window.wm){wm.postLoadModules.push("game.feature.npc.editors.npc-editor");wm.mapAttribs&&(wm.mapAttribs.npcRunners={_type:"String",_select:sc.NPC_RUNNER_GROUP,_info:"What kind of NPCs will be running around this map",
_withNull:true})}});ig.baked=!0;
ig.module("game.feature.player.entities.crosshair").requires("impact.base.entity").defines(function(){var b=Vec2.create();Vec2.create();var a=Vec3.create(),d=Vec2.create(),c=Vec2.create(),e=Vec2.create(),f=Vec2.create(),g=Vec2.create(),h=Vec3.create(),i=Vec3.create(),j={},k={};ig.ENTITY.Crosshair=ig.Entity.extend({offset:{x:8,y:8,z:0},tileSheet:new ig.TileSheet("media/entity/map-gui/crosshair.png",32,32),thrower:null,controller:null,rangeStart:Math.PI/2,aimTime:0.5,maxAngleMove:Math.PI/128,chargeActive:false,
rangeCurrent:0,currentCharge:0,speedFactor:1,baseSpeedFactor:1,doBlink:true,gamepadMode:false,active:false,special:false,circleGlow:0,_lastDir:Vec2.createC(0,1),_aimDir:Vec2.createC(0,1),_dots:[],_currentDot:0,sounds:{charged:new ig.Sound("media/sound/move/targeting-charged.mp3",0.4)},soundTimer:0,dirHelperDrawInfo:[{x:0,y:-100,tile:3,flipX:0,flipY:0},{x:70,y:-70,tile:4,flipX:0,flipY:0},{x:100,y:0,tile:5,flipX:0,flipY:0},{x:70,y:70,tile:4,flipX:0,flipY:1},{x:0,y:100,tile:3,flipX:0,flipY:1},{x:-70,
y:70,tile:4,flipX:1,flipY:1},{x:-100,y:0,tile:5,flipX:1,flipY:0},{x:-70,y:-70,tile:4,flipX:1,flipY:0}],init:function(a,b,c,d){this.parent(a,b,c,d);this.coll.type=ig.COLLTYPE.NONE;this.coll.friction.ground=0;this.coll.setSize(0,0,0);this.currentCharge=this.aimTime;Vec2.assignC(this.coll.pos,ig.system.width/2,ig.system.height/2);this.thrower=d.thrower;this.controller=d.controller;this.coll.time.parent=this.thrower.coll;for(a=0;a<12;a++)this._dots.push(ig.game.spawnEntity(ig.ENTITY.CrosshairDot,-1E3,
-1E3,0))},initSprites:function(){this.setSpriteCount(1,true)},getDir:function(a){return Vec2.assign(a,this._aimDir)},getThrowDir:function(a){var a=Vec2.assign(a,this._aimDir),b=this.rangeCurrent*(0.5-Math.random());Vec2.rotate(a,b);return a},isThrowCharged:function(){return window.IG_GAME_DEBUG&&ig.game.supercharge||this.special?true:this.chargeActive&&!this.rangeCurrent&&this.controller.isAiming(this)&&this.currentCharge>this.aimTime},setThrown:function(){this.doBlink=true;return this.currentCharge=
0},setBaseSpeedFactor:function(a){this.baseSpeedFactor=a},setSpeedFactor:function(a){this.speedFactor=a},setCircleGlow:function(){this.circleGlow=0.2},reducePrecision:function(a){var b=this.thrower.params?this.thrower.params.getModifier("AIM_STABILITY"):0,a=a*Math.max(0,1-b);this.rangeCurrent=Math.min(this.rangeStart,this.rangeCurrent+this.rangeStart*a);this.doBlink=this.doBlink||this.rangeCurrent>this.rangeStart/2*this.speedFactor*this.baseSpeedFactor},setSpecial:function(a){this.special=a},setActive:function(a){if(this.active!=
a){this.active=a;this.controller.onActiveChange(this);if(this.active)this.rangeCurrent=this.rangeStart*0.75;else{this.doBlink=true;a=sc.model.currentState==sc.GAME_MODEL_STATE.CUTSCENE?2:1;this.thrower.cameraHandle&&this.thrower.cameraHandle.setOffset(0,0,a)}}},deferredUpdate:function(){this.controller.updatePos(this);var a=Vec2.flip(Vec2.sub(this._getThrowerPos(e),this.coll.pos));if(Vec2.isZero(a))a.y=1;var b=Vec2.angle(a,this._lastDir),c=this.maxAngleMove;if(!this.special&&b>2*c){c=this.thrower.params?
this.thrower.params.getModifier("AIM_STABILITY"):0;this.rangeCurrent=this.rangeCurrent+b/2*Math.max(0,1-c);if(this.rangeCurrent>this.rangeStart)this.rangeCurrent=this.rangeStart;this.doBlink=this.doBlink||this.rangeCurrent>this.rangeStart/2*this.speedFactor*this.baseSpeedFactor}Vec2.assign(this._lastDir,a);Vec2.assign(this._aimDir,a);if(this.circleGlow>0)this.circleGlow=this.circleGlow-ig.system.actualTick;if(!this.active)this.currentCharge=this.aimTime;if(!this.active||ig.system.timeFactor<=0&&!sc.autoControl.isActive())for(a=
0;a<this._dots.length;++a){this._dots[a].setCurrentAnim("normal",true);this._dots[a].setPos(-1E3,-1E3)}else{if(this.special)this.currentCharge=this.aimTime;this.currentCharge=this.currentCharge+ig.system.tick;if(this.rangeCurrent>0){if(this.special)this.rangeCurrent=this.rangeCurrent-ig.system.actualTick/this.aimTime*this.rangeStart*2;else{c=this.speedFactor*this.baseSpeedFactor;this.rangeCurrent=this.rangeCurrent-ig.system.tick/this.aimTime*this.rangeStart*c}if(this.rangeCurrent<0){this.rangeCurrent=
0;if(this.currentCharge>this.aimTime)this.currentCharge=this.aimTime}}this.isThrowCharged();b=this.controller.gamepadMode?Vec2.assign(f,a):Vec2.assignC(f,this.coll.pos.x-ig.game.screen.x-ig.system.width/2,this.coll.pos.y-ig.game.screen.y-ig.system.height/2);c=this.controller.getAimingDistance(a,b);if(this.controller.isAiming(this)&&this.thrower.cameraHandle){c=((c-104)/40).limit(0,1);c=c*c;this.thrower.cameraTargets.length>0&&(c=c*0.5);if(c>0){Vec2.length(b,72*c);Vec2.distance(b,this.thrower.cameraHandle.offset)>
2&&this.thrower.cameraHandle.setOffset(b.x,b.y,0,this._aimDir.x,this._aimDir.y)}else this.thrower.cameraHandle.setOffset(0,0,0,this._aimDir.x,this._aimDir.y)}b=this.rangeCurrent/2;if(this.isThrowCharged()){if(this.soundTimer<=0)this.soundTimer=0.1;this.soundTimer=this.soundTimer-ig.system.tick}else this.soundTimer=0;c=Vec2.assign(h,this.thrower.coll.pos);c.x=c.x+(this.thrower.coll.size.x/2-Constants.BALL_SIZE/2);c.y=c.y+(this.thrower.coll.size.y/2-Constants.BALL_SIZE/2);c.z=this.thrower.coll.pos.z;
if(this.thrower.maxJumpHeight!==void 0&&this.thrower.maxJumpHeight>=0)c.z=Math.min(this.thrower.coll.pos.z,this.thrower.maxJumpHeight);c.z=c.z+Constants.BALL_HEIGHT;var d;if(!b&&this.isThrowCharged()){d=this.doBlink?"chargedBlink":"charged";if(this.doBlink){this.doBlink=false;this.sounds.charged.play()}}else d="normal";var g=this.special||this.controller.isAiming(this)?1:0.4,k=this.rangeCurrent||!this.chargeActive?0:Math.floor((this.currentCharge-2*this.aimTime)/0.05).limit(0,10),j=b?6:12;this._currentDot=
0;Vec2.rotate(a,b);var q=Vec3.assignC(i,Constants.BALL_SIZE,Constants.BALL_SIZE,Constants.BALL_Z_HEIGHT);this._updateCrossHair(c,a,q,g,d,k,j,3);if(b){Vec2.rotate(a,-2*b);this._updateCrossHair(c,a,q,g,d,k,j,3)}for(;this._currentDot<this._dots.length;++this._currentDot){this._dots[this._currentDot].setCurrentAnim("normal",true);this._dots[this._currentDot].setPos(-1E3,-1E3)}}},updateSprites:function(){var a=this.sprites[0];if(!this.active||ig.system.timeFactor<=0&&!sc.autoControl.isActive())if(this.circleGlow>
0){var b=this._getThrowerPos(e);b.x=b.x+-sc.ATTACK_INPUT_DISTANCE;b.y=b.y+ +sc.ATTACK_INPUT_DISTANCE;a.renderMode="lighter";a.setPos(b.x,b.y,0);a.setSize(sc.ATTACK_INPUT_DISTANCE*2,0,sc.ATTACK_INPUT_DISTANCE*2,0);a.setImageSrc(this.tileSheet.image,0,64);a.setAlpha(this.circleGlow/0.2)}else a.setAlpha(0);else{var c=this.isThrowCharged(),b=this.controller.isAiming()?1:0.4,d=0;this.rangeCurrent==0&&c&&(d=4+Math.floor(Math.min(2,(this.currentCharge-this.aimTime)/0.1)));var c=this.coll.pos.x-16,f=this.coll.pos.y-
this.coll.pos.z+16;a.renderMode="source-over";a.setPos(c,f,0);a.setSize(32,0,32,0);d=this.tileSheet.getTileSrc(j,d);a.setImageSrc(this.tileSheet.image,d.x,d.y);a.setAlpha(b)}},onKill:function(a){for(var b=0;b<this._dots.length;b++)this._dots[b].kill();this.parent(a)},_updateCrossHair:function(b,e,g,h,i,j,t,q,s){var v=12;Vec2.length(e,24*v);var y=this.isThrowCharged(),u=ig.game.physics.initTraceResult(k),z=[];ig.game.physics._trackEntityTouch=true;var D=ig.game.trace(u,b.x,b.y,b.z,e.x,e.y,g.x,g.y,
g.z,ig.COLLTYPE.PROJECTILE,null,z),C=ig.game.physics._trackEntityTouch=false,A=null,B=-1;Vec2.assign(a,e);Vec2.mulF(a,u.dist);Vec2.add(a,b);a.z=b.z;for(var w=0;w<z.length;++w){var x=z[w].entity;if(x!=s){var E=x.ballDestroyer||x.isBallDestroyer&&x.isBallDestroyer(a,u,y),G=!this.rangeCurrent&&x.isBallAdjust&&x.isBallAdjust(y),J=false;if(E||G)if(x.coll.type==ig.COLLTYPE.BLOCK)J=B==-1;else{var I=x.getCenter(d),K=Vec2.distance(b,I);if(B==-1||K<B){B=K;Vec2.assign(c,I);J=true}}if(J){C=false;A=null;E?C=true:
G&&(A=x)}}}if(B!=-1){w=Vec2.sub(c,b);u.dist=Vec2.dot(w,e)/Vec2.dot(e,e)}v=v*Math.max(0,u.dist);Vec2.length(e,24);s=false;for(w=1;w<v+0.8;w++){s=Math.round(b.x)+e.x*(w>v-0.2?v-0.1:w);y=Math.round(b.y)+e.y*(w>v-0.2?v-0.1:w);if(this._dots[this._currentDot]){this._dots[this._currentDot].setPos(s+g.x/2-Constants.BALL_SIZE/2,y+g.y/2-Constants.BALL_SIZE/2);this._dots[this._currentDot].coll.pos.z=b.z;this._dots[this._currentDot].coll.level=ig.game.getLevelIdx(b.z);this._dots[this._currentDot].setCurrentAnim(i,
true,i=="chargedBlink"?"charged":null);this._dots[this._currentDot].animState.alpha=h;this._dots[this._currentDot].coll.shadow.size=i=="charged"?4:0;++this._currentDot}else return;s=true;if(!--t)return}if(s||--t)if(A||D&&!C&&j&&q){q=q-1;Vec2.length(e,24*v);Vec2.add(b,e);if(A){b.x=b.x+g.x/2;b.y=b.y+g.x/2;q=A.doBallAdjust(b,e,g,q);b.x=b.x-g.x/2;b.y=b.y-g.x/2;j=t}else{v=Vec2.dot(e,u.dir);Vec2.sub(e,Vec2.mulF(u.dir,2*v,f));j=Math.min(t,j)}this._updateCrossHair(b,e,g,Math.max(0.25,h*0.75),i,j,j,q,A)}},
_getThrowerPos:function(a){Vec2.assign(a,this.thrower.coll.pos);a.x=Math.round(a.x)+this.thrower.coll.size.x/2;a.y=Math.round(a.y-this.thrower.coll.pos.z)+this.thrower.coll.size.y/2-Constants.BALL_HEIGHT-Constants.BALL_SIZE/2;return a}});ig.ENTITY.CrosshairDot=ig.AnimatedEntity.extend({blocks:{},tileSheet:new ig.TileSheet("media/entity/map-gui/crosshair.png",8,8,32,0),init:function(a,b,c,d){this.parent(a,b,c,d);this.coll.type=ig.COLLTYPE.NONE;this.coll.setSize(Constants.BALL_SIZE,Constants.BALL_SIZE,
Constants.BALL_Z_HEIGHT);this.coll.time.globalStatic=true;this.initAnimations({offset:{x:0,y:0,z:(16-Constants.BALL_SIZE)/2},sheet:this.tileSheet,SUB:[{name:"normal",time:1,frames:[0]},{name:"charged",time:0.07,frames:[1],repeat:false},{name:"chargedBlink",time:0.07,frames:[2,3,1],repeat:false}]})},update:function(){this.animState.alpha=ig.system.timeFactor<=0&&!sc.autoControl.isActive()?0:1;this.parent()}});sc.PlayerCrossHairController=ig.Class.extend({gamepadMode:false,isAiming:function(){return sc.control.aiming()},
getAimingDistance:function(a,b){var c=this.gamepadMode?a:Vec2.mulC(b,ig.system.height/ig.system.width,1,g);return Vec2.length(c)},onActiveChange:function(a){if(a.active)this.gamepadMode=sc.control.isRightStickDown()},updatePos:function(a){if(this.gamepadMode){if(sc.control.isRightStickDown()){var c=Vec2.flip(Vec2.sub(a._getThrowerPos(e),a.coll.pos)),d=Vec2.assignC(b,sc.control.getAxesValue(ig.AXES.RIGHT_STICK_X)*ig.system.height*0.6,sc.control.getAxesValue(ig.AXES.RIGHT_STICK_Y)*ig.system.height*
0.6);Vec2.lerp(c,d,ig.system.actualTick*18);a._getThrowerPos(a.coll.pos);a.coll.pos.x=a.coll.pos.x+c.x;a.coll.pos.y=a.coll.pos.y+c.y}}else ig.system.getMapFromScreenPos(a.coll.pos,sc.control.getMouseX(),sc.control.getMouseY())}});sc.EventCrossHairController=ig.Class.extend({targetPos:Vec2.create(),gamepadMode:false,isAiming:function(){return true},getAimingDistance:function(){return 0},onActiveChange:function(){},updatePos:function(a){Vec2.assign(a.coll.pos,this.targetPos)}})});ig.baked=!0;
ig.module("game.feature.player.player-level-notifier").defines(function(){sc.PlayerLevelNotifier=ig.Class.extend({levelUpSound:new ig.Sound("media/sound/battle/level-up.ogg"),init:function(){},runLevelUpScene:function(b,a,d){b=this.getLevelUpEvent(b,a);a.clearLevelUp();ig.game.events.callEvent(b,d?ig.EventRunType.PARALLEL:ig.EventRunType.BLOCKING,this.onLevelUpEventStart.bind(this),this.onLevelUpEventEnd.bind(this))},onLevelUpEventStart:function(){sc.model.enterLevelUp()},onLevelUpEventEnd:function(){sc.model.enterRunning();
sc.commonEvents.triggerEvent("LEVEL_UP",{level:sc.model.player.level})},getLevelUpEvent:function(b,a){var d={steps:[{type:"PLAY_SOUND",sound:"media/sound/battle/level-up.ogg",volume:1},{type:"DO_ACTION",entity:b,action:[{type:"WAIT",time:-1}]},{type:"ADD_SLOW_MOTION",name:"levelUp",factor:0,time:0.5},{type:"WAIT",time:0.1,ignoreSlowDown:true},{type:"SET_ENTITY_STATIC_TIME",entity:b,value:true,global:true},{type:"DO_ACTION",entity:b,keepState:true,action:[{type:"SHOW_ANIMATION",anim:"levelUpPre",followUp:"levelUpStand"},
{type:"WAIT",time:-1}]},{type:"SET_CAMERA_TARGET",entity:b,speed:0.6,transition:"EASE_IN_OUT",wait:true,zoom:1.5,waitSkip:0.2},{type:"ADD_GUI",name:null,guiInfo:{type:"LevelUpHud",settings:{deltaValues:ig.copy(a.levelUpDelta)}}},{type:"SET_ZOOM_BLUR",zoomType:"MEDIUM",fadeIn:0.1,duration:0.2,fadeOut:0.5},{type:"WAIT_UNTIL_TRUE",condition:"tmp._levelUpFinished"},{type:"DO_ACTION",entity:b,action:[{type:"SHOW_ANIMATION",anim:"levelUpPreJump"},{type:"WAIT",time:0.2},{type:"SHOW_ANIMATION",anim:"levelUpJump"},
{type:"JUMP",jumpHeight:"M",wait:true,ignoreSounds:true}]},{type:"WAIT",time:0.5,ignoreSlowDown:true},{type:"CLEAR_SLOW_MOTION",name:"levelUp",time:0.1},{type:"SET_ENTITY_STATIC_TIME",entity:b,value:false,global:true}]};return new ig.Event(d)}})});ig.baked=!0;
ig.module("game.feature.player.item-consumption").requires("game.feature.inventory.inventory").defines(function(){sc.ItemConsumption=ig.Class.extend({sounds:{eat:new ig.Sound("media/sound/move/eat.ogg",1)},init:function(){},runItemUseAction:function(b,a,d){if(d&&sc.inventory.getItem(d).type==sc.ITEMS_TYPES.CONS){b=this.getAction(d);ig.game.playerEntity.setAction(b)}},activateItemEffect:function(b,a,d){var c=sc.inventory.getItem(d),a=c.time||0;c.effect&&c.effect.spawnOnTarget&&c.effect.spawnOnTarget(b);
if(c.stats){for(var b=c.stats,c=null,e=b.length,f=false;e--;){c=sc.STAT_CHANGE_SETTINGS[b[e]];switch(c.change){case sc.STAT_CHANGE_TYPE.HEAL:this.runHealChange(c);break;case sc.STAT_CHANGE_TYPE.STATS:case sc.STAT_CHANGE_TYPE.MODIFIER:f=true}}f&&this.runStatChange(b,a,d)}else throw Error("Use Items must have defined a stats property");},runHealChange:function(b){var a=ig.game.playerEntity,b=b.value-1,b=b*(1+a.params.getModifier("ITEM_BOOST")),b=new sc.HealInfo(a.params,{value:b,absolute:false});a.heal(b)},
runStatChange:function(b,a,d){sc.model.player.params.addItemBuff(b,a*(sc.newgame.get("double-buff-time")?2:1),d)},getAction:function(b){var a=sc.inventory.getItem(b).useSpeed||sc.STAT_USE_SPEED.NORMAL,d=sc.inventory.getItem(b).foodSprite||"SANDWICH",c="itemEatFast",e=1,f=1.2;if(a==sc.STAT_USE_SPEED.SLOW){c="itemEatSlow";e=0.6}else if(a==sc.STAT_USE_SPEED.FAST){c="itemEatFastest";f=0.8}return this.createAction([{type:"START_ITEM_CONSUME"},{type:"FOCUS_CAMERA",speed:f,transition:"EASE_IN_OUT",zoom:1.5},
{type:"SET_FACE",face:"SOUTH"},{type:"SHOW_FOOD_ICON",icon:d},{type:"SHOW_ANIMATION",anim:"itemFetch",wait:true},{type:"SHOW_ANIMATION",anim:"itemHold"},{type:"WAIT",time:0.2},{type:"PLAY_SOUND",sound:"media/sound/move/eat.ogg",volume:1,speed:e},{type:"CHANGE_FOOD_ICON",state:"BUBBLE"},{type:"SHOW_ANIMATION",anim:c,wait:true},{type:"CHANGE_FOOD_ICON",state:"DONE"},{type:"CONSUME_ITEM",item:b},{type:"SHOW_ANIMATION",anim:"itemEffect"},{type:"WAIT",time:0.4}])},createAction:function(b){sc.model.player.params.getModifier("ITEM_GUARD")&&
b.unshift({type:"SET_HIT_STABLE",value:"MASSIVE"});b=new ig.Action("consumeItem",b);b.eventAction=true;return b}})});ig.baked=!0;
ig.module("game.feature.player.entities.player-base").requires("game.feature.combat.entities.ball","game.feature.combat.entities.combatant","game.feature.player.entities.crosshair","game.feature.player.player-level-notifier","game.feature.player.item-consumption").defines(function(){sc.PlayerBaseEntity=ig.ENTITY.Combatant.extend({party:sc.COMBATANT_PARTY.PLAYER,material:sc.COMBATANT_MATERIAL.ORGANIC,configs:{normal:null,aiming:null},maxJumpHeight:-1,guard:{damage:0,timer:0,fxSheet:new ig.EffectSheet("guard"),
fxHandle:null,currentKey:null},stunEscapeReady:false,playerTrack:{startedAction:null,trackTimer:0},init:function(b,a,d,c){this.parent(b,a,d,c);this.coll.type=ig.COLLTYPE.VIRTUAL;this.coll.zBounciness=0;this.coll.setSize(16,16,24);this.storeWalkAnims("normal",{idle:"idle",hover:"hover",hoverMove:"hover",move:"walk",run:"run",brake:"brake",preIdle:"preIdle",damage:"damage",fall:"fall",jump:"jump"});this.storeWalkAnims("battle",{idle:"idle",hover:"hover",hoverMove:"hover",move:"walk",run:"run",brake:"brake",
preIdle:"preIdle",damage:"damage",fall:"fall",jump:"jump"});this.storeWalkAnims("aiming",{idle:"aim",move:"aimMove",moveRev:"aimMoveRev",damage:"damage"});this.setWalkAnims("normal");this.configs.normal=new ig.ActorConfig({walkAnims:"normal",maxVel:180,relativeVel:1,accelSpeed:0.8,friction:1.6,airFriction:0.7,hitStable:"LIGHT",jumpingEnabled:true,shadow:16,stepSfxFrames:[2,5],floatHeight:0});this.configs.battle=new ig.ActorConfig({walkAnims:"battle",maxVel:180,relativeVel:1,accelSpeed:0.8,friction:1.6,
airFriction:0.7,hitStable:"LIGHT",jumpingEnabled:true,shadow:16,stepSfxFrames:[2,5],floatHeight:0});this.configs.aiming=new ig.ActorConfig({walkAnims:"aiming",maxVel:100,accelSpeed:0.7,friction:1.6,airFriction:0.7,hitStable:"LIGHT",faceDirFixed:true,jumpingEnabled:true,shadow:16,stepSfxFrames:0,floatHeight:0});this.setDefaultConfig(this.configs.normal)},doPlayerAction:function(b){var a=sc.PLAYER_ACTION[b];if(!a)throw Error("Unknown Action Type: "+b);a=this.model.getAction(a);this.playerTrack.startedAction=
b;this.playerTrack.trackTimer=0.05;this.setAction(a)},startGuardEffect:function(){var b="neutral";this.guard.damage>0.75?b=b+"4":this.guard.damage>0.5?b=b+"3":this.guard.damage>0.25&&(b=b+"2");var a=this.params.getModifier("GUARD_AREA");a>=2?b=b+"_top":a>=1&&(b=b+"_full");if(b!=this.guard.currentKey){this.guard.fxHandle&&this.guard.fxHandle.stop();this.guard.currentKey=b;this.guard.fxHandle=this.guard.fxSheet.spawnOnTarget(b,this,{duration:-1})}},endGuardEffect:function(){if(!(this.guard.damage>=
1)){this.guard.fxHandle&&this.guard.fxHandle.stop();this.guard.fxHandle=null;this.guard.currentKey=null}},damageShield:function(b){var a=this.guard.damage;this.guard.damage=this.guard.damage+b/7;if(a<=0.75&&this.guard.damage>=1)this.guard.damage=0.99;if(this.guard.damage>=1){this.guard.fxHandle&&this.guard.fxHandle.stop();this.guard.fxHandle=this.guard.fxSheet.spawnOnTarget("guardBroken",this,{duration:-1});this.onPlayerShieldBreak&&this.onPlayerShieldBreak();this.guard.timer=5;this.guard.damage=
1;sc.combat.doDramaticEffect(this,this,sc.DRAMATIC_EFFECT.GUARD_BREAK);return true}this.guard.timer=1;this.startGuardEffect();return false},regenShield:function(b){if(!b)if(this.guard.timer>0){this.guard.timer=this.guard.timer-ig.system.tick;if(this.guard.timer<0){this.guard.timer=0;if(this.guard.damage==1){this.guard.fxHandle&&this.guard.fxHandle.stop();this.guard.fxHandle=null;this.guard.damage=0}}}else if(this.guard.damage>0){this.guard.damage=this.guard.damage-ig.system.tick/10;if(this.guard.damage<
0)this.guard.damage=0}},update:function(){if(this.playerTrack.trackTimer){this.playerTrack.trackTimer=this.playerTrack.trackTimer-ig.system.tick;if(this.playerTrack.trackTimer<=0){this.playerTrack.trackTimer=0;this.playerTrack.startedAction=null}}ig.ENTITY.Combatant.prototype.update.call(this)},_addTargetedBy:function(b){this.parent(b);this.updateCombatMode()},_removeTargetedBy:function(b){this.parent(b);this.updateCombatMode()},updateCombatMode:function(){var b=sc.combat.isPlayerPartyInCombat();
sc.model.setCombatMode(b)}})});ig.baked=!0;
ig.module("game.feature.player.entities.player-pet").requires("game.feature.npc.entities.sc-actor").defines(function(){var b=new ig.ActorConfig({jumpingEnabled:true,maxVel:180,weight:20,collType:ig.COLLTYPE.IGNORE,walkAnims:"default",soundType:"none",shadow:16,floatAccel:2}),a=new ig.ActorConfig({jumpingEnabled:true,maxVel:180,weight:-1,collType:ig.COLLTYPE.IGNORE,walkAnims:"default",soundType:"none",shadow:16,floatAccel:2}),d=Vec2.create(),c=Vec3.create();sc.PlayerPetEntity=sc.ActorEntity.extend({npcEffects:new ig.EffectSheet("npc"),
petSkin:null,configs:{},pushTimer:0,posOffset:Vec2.createC(0,-14),state:0,respawnPos:Vec3.create(),idleTimer:0,idleSpecials:0,tempHidden:false,effects:{water:new ig.EffectSheet("scene.water")},init:function(a,c,d,h){this.parent(a,c,d,h);this.coll.setSize(8,8,28);this.coll.edgeSlipInward=true;this.petSkin=h.petSkin;this.tempHidden=this.defaultFollow=false;this.outOfScreenTime=0;this.animSheet=this.petSkin.animSheet;this.storeWalkAnims("default",this.petSkin.walkAnims);this.setWalkAnims("default");
for(a=0;this.animSheet.hasAnimation("idleSpecial"+(a+1));)a=a+1;(this.idleSpecials=a)&&this.resetIdleTimer();a=new ig.ActorConfig;a.loadFromData(this.petSkin.actorConfig,b);this.setDefaultConfig(a);this.initAnimations()},show:function(a){this.parent(a);this.resetPos(a)},resetIdleTimer:function(a){this.idleTimer=2+2*Math.random()+(a||0)},shouldTempHide:function(){return ig.game.playerEntity.interactObject},update:function(){var a=ig.game.playerEntity,b=a._hidden||a.hidePets,g=b||this.shouldTempHide();
if(!this.tempHidden&&g){this.cancelAction();Vec2.assignC(this.coll.accelDir,0,0);b?this.animState.alpha=0:ig.game.effects.npc.spawnOnTarget("disappear",this);this.coll.setType(ig.COLLTYPE.NONE);this.tempHidden=true}else if(this.tempHidden&&!g){this.tempHidden=false;this.coll.setType(ig.COLLTYPE.IGNORE);this.resetPos(true);ig.game.effects.npc.spawnOnTarget("appear",this)}if(!this.currentAction&&!this.tempHidden){b=ig.CollTools.getGroundDistance(this.coll,a.coll);g=this.state;if(sc.model.isCombatActive()&&
(b<=120||b>=200))g=2;!sc.model.isCombatActive()&&b>=24&&(g=1);if(!this.tempHidden){if(!sc.model.isCombatActive()&&!sc.model.isCutscene()){this.outOfScreenTime=ig.EntityTools.isInScreen(this,0)?0:this.outOfScreenTime+ig.system.tick;this.outOfScreenTime>3&&this.resetPos(false,true)}if(this.state!==g){this.state=g;if(g===1){if(!this.defaultFollow){this.nav.path.toEntity(a,16,{posOffset:this.posOffset});this.defaultFollow=true}}else if(g===2){this.defaultFollow=false;this.nav.path.runAway(a,160)}}var g=
false,h=1;if(this.state===1){h=b>48?1:Math.max(0.25,Math.pow(b/48,2));b>56&&(h=Math.min(1.25,1.05+(b-56)/64));this.jumping&&(h=1)}this.coll.relativeVel=h;this.nav.path.startRelativeVel=h;if(this.state===1||this.state===2){if(this.nav.path.moveEntity()){this.state=0;g=true}}else this.state===0&&(g=true);if(g){a=ig.CollTools.getDistVec2(this.coll,a.coll,d);Vec2.rotateToward(this.face,a,Math.PI*2*ig.system.tick*2)}a=this.coll;a.pos.z<=a.baseZPos&&(!this.jumping&&a.zGravityFactor!==0&&!ig.CollTools.isCloseToEdge(this.coll)&&
!ig.terrain.isDangerTerrain(this.stepStats.terrain)&&this.stepStats.terrain!=ig.TERRAIN.QUICKSAND)&&Vec3.assign(this.respawnPos,this.coll.pos)}}this.parent();if(this.idleSpecials&&!this.currentAction)if(Vec2.isZero(this.coll.accelDir)){this.idleTimer=this.idleTimer-ig.system.tick;if(this.idleTimer<=0){a=Math.floor(this.idleSpecials*Math.random())+1;this.setCurrentAnim("idleSpecial"+a,true,this.walkAnims.idle,true);this.resetIdleTimer(2)}}else this.resetIdleTimer();if(!this.tempHidden&&!this.currentAction){a=
this.coll;b=false;if(a.type==ig.COLLTYPE.IGNORE){g=ig.game.getEntitiesInRectangle(a.pos.x,a.pos.y,a.pos.z,a.size.x,a.size.y,a.size.z,this);for(h=g.length;h--;){var i=g[h];if(i instanceof sc.ActorEntity&&i.coll.type!==ig.COLLTYPE.TRIGGER){ig.CollTools.getDistVec2(i.coll,a,d);Vec2.length(d,80*(1-this.pushTimer/1).limit(0,1));Vec2.add(a.pushVel,d);b=true}}}this.pushTimer=b?this.pushTimer+ig.system.tick:0;a=ig.terrain.getTerrain(a,true);if(ig.terrain.isDangerTerrain(a)&&a!=ig.TERRAIN.QUICKSAND){this.getAlignedPos(ig.ENTITY_ALIGN.BOTTOM,
c);this.resetPos(false,true)}}},resetStartPos:function(){var a=ig.game.playerEntity;Vec3.assign(c,a.coll.pos);c.x=c.x+(a.coll.size.x/2-this.coll.size.x/2);c.y=c.y+(a.coll.size.y/2-this.coll.size.x/2);a=Vec2.assign(d,a.face);Vec2.length(a,12);c.x=c.x-a.x;c.y=c.y-a.y;this.coll.setPos(c.x,c.y,c.z)},resetPos:function(a,b){var d=ig.game.playerEntity,d=ig.navigation.getClosePosition(c,d.getAlignedPos(ig.ENTITY_ALIGN.BOTTOM,c),d.coll.size,d,null,48,1,0,ig.NAV_CLOSE_POINT_SEARCH.BEHIND_FACE,false);c.x=c.x-
this.coll.size.x/2;c.y=c.y-this.coll.size.y/2;!d&&b&&Vec3.assign(c,this.respawnPos);this.coll.setPos(c.x,c.y,c.z);if(!a){this.animState.alpha=0;ig.game.effects.teleport.spawnOnTarget("showFast",this)}},onNavigationFailed:function(a){if(a>5){this.nav.failTimer=0;this.resetPos()}},remove:function(){this.kill()}});ig.ENTITY.Pet=sc.ActorEntity.extend({_wm:new ig.Config({spawnable:true,attributes:{pet:{_type:"PetSelect",_info:"Pet to spawn"},action:{_type:"Action",_info:"Action to perform constantly",
_popup:true,_float:true,_clear:true,_optional:true}},label:function(){return""},drawBox:true,boxColor:"rgba(0,255,0, 0.5)"}),pet:null,skin:null,petSkin:null,petOffset:null,loopAction:null,init:function(b,c,d,h){this.parent(b,c,d,h);sc.Model.addObserver(sc.playerSkins,this);this.pet=h.pet||null;if(this.skin=sc.playerSkins.skins[this.pet]){this.coll.setSize(16,16,16);b=this.skin.settings;this.petOffsets=b.petOffsets;this.animSheet=new ig.AnimationSheet(b.animSheet);this.storeWalkAnims("default",b.walkAnims);
this.setWalkAnims("default");c=new ig.ActorConfig;c.loadFromData(b.actorConfig||{},a);this.setDefaultConfig(c);if(b.petSound)this.petSound=new ig.Sound(b.petSound.path,b.petSound.volume,b.petSound.variance);if(window.wm){this._wm=this._wm.copy();this._wm.drawBox=false;this.initAnimations()}if(h.action&&h.action.length>0&&!this.hidden)this.loopAction=new ig.Action("[PET]",h.action)}else{this.coll.setSize(16,16,0);this.coll.type=ig.COLLTYPE.IGNORE}},update:function(){this.parent()},show:function(a){var b=
sc.playerSkins.getCurrentSkin("Pet");b&&b.name==this.pet||sc.model.player.getItemAmount(this.skin.item)<=0||this.parent(a)},hide:function(){ig.EffectTools.clearEffects(this);this.parent()},remove:function(){this.kill()},postActionUpdate:function(){if(!this.doPostEventAction){if(this.currentAction&&this.currentAction.eventAction)this.eventBlocked=true;!this.currentAction&&!this.eventBlocked&&this.loopAction&&this.setAction(this.loopAction)}},getQuickMenuSettings:function(){return{type:"Analyzable",
color:sc.ANALYSIS_COLORS.BLUE,text:sc.inventory.getItemName(this.skin.item)}},onKill:function(a){this.parent(a);sc.Model.removeObserver(sc.playerSkins,this);this.loopAction&&this.loopAction.clearCached();this.petSound&&this.petSound.clearCached()},modelChanged:function(a,b,c){if(b==sc.SKIN_EVENT.SKIN_UPDATE&&c=="Pet")(a=sc.playerSkins.getCurrentSkin("Pet"))&&a.name==this.pet||sc.model.player.getItemAmount(this.skin.item)<=0?this.hide():this.show()}})});ig.baked=!0;
ig.module("game.feature.player.entities.player").requires("impact.feature.env-particles.env-particles","game.feature.combat.entities.ball","game.feature.player.entities.player-base","game.feature.combat.entities.combatant","game.feature.player.entities.crosshair","game.feature.player.entities.player-pet","game.feature.player.player-level-notifier","game.feature.player.item-consumption","game.feature.new-game.new-game-model").defines(function(){function b(a){for(var b=h.length,c=0;b--;)if(a.time>=
h[b]){c=b+1;break}return c=Math.min(a.maxLevel,c)}function a(a,b){if(a[b]>0){a[b]=a[b]-ig.system.tick;a[b]<=0&&(a[b]=0)}}Vec2.create();var d={actionKey:"ATTACK_SPECIAL"},c={actionKey:"THROW_SPECIAL"},e={actionKey:"GUARD_SPECIAL"},f={actionKey:"DASH_SPECIAL"},g=["Neutral","Heat","Cold","Shock","Wave"],h=[0.25,0.5,1];sc.PLAYER_ZOOM=1;var i={thrown:false,melee:false,aim:false,autoThrow:false,attack:false,guard:false,charge:false,dashX:0,dashY:0,switchMode:false,relativeVel:0,moveDir:Vec2.create()},j=
{};ig.ENTITY.Player=sc.PlayerBaseEntity.extend({skin:{appearanceFx:null,appearance:null,stepFx:null,auraFx:null,auraFxHandle:null,pet:null},proxies:null,model:null,state:0,throwCounter:0,attackCounter:0,attackResetTimer:0,throwDir:Vec2.create(),throwDirData:Vec2.create(),doAttack:false,lastMoveDir:Vec2.create(),dashCount:0,dashAttackCount:0,maxDash:3,keepLastMoveDir:0,moveDirStartedTimer:0,jumpPoint:Vec2.create(),jumpForwardDir:Vec2.create(),idle:{timer:0,actions:[],petAction:null},gui:{},cameraHandle:null,
cameraTargets:[],mapStartPos:Vec3.create(),actionBlocked:{action:0,charge:0,dash:0,reaim:0,move:0},combatStats:{lastTarget:null},dashDir:Vec2.create(),dashDirData:Vec2.create(),dashTimer:0,dashBlock:0,doEscapeTimer:0,stunEscapeDash:false,dashPerfect:false,perfectGuardCooldown:0,charging:{time:-1,cancelTime:0,swapped:false,type:null,maxLevel:0,fx:null,block:0,msg:null,executeLevel:0,prefDir:Vec2.create()},chargeThrowCharged:false,floating:false,recordInput:false,interactObject:null,explicitAimStart:0,
levelUpNotifier:null,atLandmarkHeal:0,atLandmarkTeleport:0,itemConsumer:null,isPlayer:true,hidePets:false,init:function(a,b,c,d){this.parent(a,b,c,d);this.levelUpNotifier=new sc.PlayerLevelNotifier;this.itemConsumer=new sc.ItemConsumption;if(sc.model){this.model=sc.model.player;sc.Model.addObserver(this.model,this);sc.Model.addObserver(sc.model,this);this.initModel()}sc.Model.addObserver(sc.playerSkins,this);this.charging.fx=new sc.CombatCharge(this,true);sc.combat.addActiveCombatant(this)},initModel:function(){this.params=
this.model.params;this.params.setCombatant(this);this.animSheet=this.animSheetReplace||this.model.animSheet;sc.Model.addObserver(this.params,this);this.initAnimations();this.copyModelSkills();this.updateModelStats(true);this.updateSkinStepFx();this.updateSkinAura();this.updateSkinPet(false);this.initIdleActions()},replaceAnimSheet:function(a){this.animSheetReplace=a;this.updateAnimSheet()},initIdleActions:function(){this.idle.actions.length=0;if(this.model.name=="Lea"){var a=sc.gameCode.isEnabled("caramelldansen")?
new ig.Action("PLAYER_IDLE",[{type:"SET_FACE",face:"SOUTH",rotate:true},{type:"WAIT",time:0.3},{type:"SHOW_EXTERN_ANIM",anim:{sheet:"player-poses",name:"caramelldansen"}},{type:"WAIT",time:5},{type:"SHOW_ANIMATION",anim:"preIdle",wait:true}],false,false):new ig.Action("PLAYER_IDLE",[{type:"CHANGE_STAT_MAP_NUMBER",map:"misc",stat:"yawns",value:1,changeType:"add"},{type:"SET_FACE",face:"SOUTH_EAST",rotate:true},{type:"SHOW_ANIMATION",anim:"idleStretch",wait:true}],false,false);this.idle.actions.push(a)}},
doPetAction:function(){var a=[{x:0,y:-7},{x:12,y:-1},{x:-12,y:-1},{x:0,y:7}],b=this.skin.pet;if(b.petSkin.petOffsets)a=b.petSkin.petOffsets;a=new ig.Action("PLAYER_IDLE",[{type:"SET_FACE_TO_ENTITY",entity:b,rotate:true},{type:"WAIT",time:0.4},{type:"SET_COLL_TYPE",value:"IGNORE"},{type:"SET_RELATIVE_SPEED",value:0.3},{type:"MOVE_TO_ENTITY_CLOSEST_OFFSET",entity:b,offsets:a,maxTime:0.4,forceTime:true},{type:"SET_FACE_TO_ENTITY",entity:b,rotate:false},{type:"SHOW_ANIMATION",anim:"pet"},{type:"WAIT",
time:1.5},{type:"SHOW_ANIMATION",anim:"preIdle",wait:true},{type:"WAIT",time:1}],false,false);b=[{type:"SHOW_ANIMATION",anim:"idle",viaWalkConfig:true},{type:"SET_FACE_TO_ENTITY",entity:this,rotate:true},{type:"SET_COLL_TYPE",value:"IGNORE"},{type:"WAIT",time:1},{type:"SET_FACE_TO_ENTITY",entity:this,rotate:true},{type:"WAIT",time:0.6},{type:"PLAY_PET_SOUND"},{type:"WAIT",time:0.6},{type:"SHOW_EFFECT",effect:{sheet:"npc",name:"hearts"}}];this.skin.pet.coll.float.height?b.push({type:"SET_Z_VEL",value:100},
{type:"SET_FLOAT_HEIGHT",value:8},{type:"SET_FLOAT_PARAMS",variance:8,accel:10},{type:"WAIT",time:1}):b.push({type:"JUMP",jumpHeight:"S",wait:true,ignoreSounds:true},{type:"JUMP",jumpHeight:"S",wait:true,ignoreSounds:true},{type:"JUMP",jumpHeight:"S",wait:true,ignoreSounds:true});b=new ig.Action("PLAYER_IDLE",b,false,false);this.setAction(a);this.skin.pet.setAction(b)},updateAnimSheet:function(a){var b=null,c=sc.playerSkins.getCurrentSkin("Appearance");if(c&&c.loaded)if(c.noHide)b=c;else if((!sc.model.isCutscene()||
ig.game.events.hasBlockingEventCallHint("SKIN_ALLOWED"))&&!ig.dreamFx.isActive())b=c;if(b!=this.skin.appearance){if(!a){if(this.skin.appearanceFx){this.skin.appearanceFx.setCallback(null);this.skin.appearanceFx.stop();this.skin.appearanceFx=null}b?this.skin.appearanceFx=b.fx.spawnOnTarget("skinOn",this,{callback:this}):this.skin.appearance.fx.spawnOnTarget("skinOff",this)}this.skin.appearance=b}if(this.animSheetReplace)this.animSheet=this.animSheetReplace;else{a=this.model.animSheet;if(this.skin.appearance&&
!this.skin.appearanceFx)a=this.skin.appearance.animSheet;this.animSheet=a}},updateSkinStepFx:function(){var a=sc.playerSkins.getCurrentSkin("StepEffect");this.skin.stepFx=a&&a.loaded?a.fx:null},updateSkinAura:function(){var a=sc.playerSkins.getCurrentSkin("Aura");this.skin.auraFx=a&&a.loaded?a.fx:null;this.skin.auraFxHandle&&this.skin.auraFxHandle.stop();this.skin.auraFxHandle=null;if(this.skin.auraFx){var a="aura",b=g[this.model.currentElementMode];this.skin.auraFx.hasEffect(a+b)&&(a=a+b);this.skin.auraFxHandle=
this.skin.auraFx.spawnOnTarget(a,this,{duration:-1})}},updateSkinPet:function(a){if(this.skin.pet){this.skin.pet.remove();this.skin.pet=null}var b=sc.playerSkins.getCurrentSkin("Pet");if(b&&b.loaded)this.skin.pet=ig.game.spawnEntity(sc.PlayerPetEntity,0,0,0,{petSkin:b},a||false)},onEffectEvent:function(a){if(a==this.skin.appearanceFx&&a.state>=ig.EFFECT_STATE.POST_LOOP){this.skin.appearanceFx=null;this.updateAnimSheet()}},regenPvp:function(a){this.parent(a);this.model.addElementLoad(-1E3)},updateModelStats:function(a){this.regenFactor=
this.params.getModifier("HP_REGEN");if(sc.newgame.get("combat-regen-half"))this.regenFactor=this.regenFactor/2;else if(sc.newgame.get("combat-regen-zero"))this.regenFactor=0;this.stunData.stunEscapeTime=1.5;this.gui.crosshair&&this.gui.crosshair.setBaseSpeedFactor(1+this.params.getModifier("AIM_SPEED"));if(this.params)this.params.criticalDmgFactor=1.5+this.params.getModifier("CRITICAL_DMG");this.stunThreshold=this.params.getModifier("STUN_THRESHOLD");this.updateAnimSheet(a);this.configs.aiming.overwrite("maxVel",
100*(1+this.params.getModifier("AIMING_MOVEMENT")));this.maxDash=Math.round(this.getMaxDashes()+this.params.getModifier("DASH_STEP"));this.spikeDmg.baseFactor=this.params.getModifier("SPIKE_DMG")},getMaxDashes:function(){return this.model.name!="Lea"?3:sc.newgame.get("dash-1")?1:3},hasCameraTarget:function(a){return this.cameraTargets.indexOf(a)!=-1},addCameraTarget:function(a,b){if(this.cameraTargets.indexOf(a)==-1){this.cameraTargets.push(a);this._updateCameraHandle(b||"NORMAL")}},removeCameraTarget:function(a,
b){this.cameraTargets.erase(a);this._updateCameraHandle(b||"NORMAL")},removeAllCameraTargets:function(a){this.cameraTargets.length=0;this._updateCameraHandle(a||"NORMAL")},_updateCameraHandle:function(a){var b=null;if(this.cameraTargets.length==0)b=new ig.Camera.TargetHandle(new ig.Camera.EntityTarget(this),0,0);else{b=[this];b.push.apply(b,this.cameraTargets);b=new ig.Camera.TargetHandle(new ig.Camera.MultiEntityTarget(b,true),0,0)}b.keepZoomFocusAligned=true;sc.PLAYER_ZOOM!=1&&b.setZoom(sc.PLAYER_ZOOM,
0.1);this.cameraHandle?ig.camera.replaceTarget(this.cameraHandle,b,a,KEY_SPLINES.EASE_IN_OUT):ig.camera.pushTarget(b,a,KEY_SPLINES.EASE_IN_OUT);this.cameraHandle=b},onPlayerPlaced:function(){if(ig.camera){for(;ig.camera.getTargetCount()>0;)ig.camera.popTarget();this._updateCameraHandle()}sc.party.onMapEnter();Vec3.assign(this.respawn.pos,this.coll.pos);Vec3.assign(this.mapStartPos,this.coll.pos);this.skin.pet&&this.skin.pet.resetStartPos()},onMoveEffect:function(a){a=="step"&&sc.stats.addMap("player",
"steps",1);this.skin.stepFx&&this.skin.stepFx.hasEffect(a)&&(a=="jump"?this.skin.stepFx.spawnOnTarget("jump",this,{angle:Vec2.clockangle(this.face)}):this.skin.stepFx.spawnOnTarget(a,this));sc.gameCode.isEnabled("speedlines")&&(a=="step"?ig.game.effects.speedlines.spawnOnTarget("speedlinesWalk",this,{duration:0.2,align:"CENTER"}):a=="dash"?ig.game.effects.speedlines.spawnOnTarget("speedlinesDash",this,{duration:0.3,align:"CENTER"}):a=="jump"&&ig.game.effects.speedlines.spawnOnTarget("speedlinesJump",
this,{duration:0.5,align:"CENTER"}))},setAction:function(a,b,c){this.coll.relativeVel=1;this.parent(a,b,c)},doCombatAction:function(a){this.doPlayerAction(a);this.model.increaseActionHeat(sc.PLAYER_ACTION[a]);this.actionBlocked.action=this.actionBlocked.charge=this.actionBlocked.move=this.actionBlocked.reaim=this.actionBlocked.dash=100;sc.gameCode.isEnabled("speedlines")&&ig.game.effects.speedlines.spawnOnTarget("speedlinesDash",this,{duration:0.3,align:"CENTER"})},setActionBlocked:function(a){this.actionBlocked.action=
a.action;this.actionBlocked.charge=a.charge||a.action;this.actionBlocked.dash=a.dash;this.actionBlocked.reaim=a.reaim;this.actionBlocked.move=a.move},clearActionBlocked:function(){this.charging.executeLevel=0;this.actionBlocked.action=this.actionBlocked.move=this.actionBlocked.charge=this.actionBlocked.reaim=this.actionBlocked.dash=0},showChargeEffect:function(a){this.charging.fx.charge(this.model.currentElementMode,a);this.params.notifySpConsume(sc.PLAYER_SP_COST[a-1]);this.cameraHandle.setZoom(sc.PLAYER_ZOOM+
a*0.5/3,0.5,KEY_SPLINES.JUMPY);if(a>=2){a=new ig.ZoomBlurHandle(a==2?"LIGHT":"MEDIUM",0.2,0,0.3);ig.screenBlur.addZoom(a)}},clearCharge:function(){if(this.charging.time!=-1){this.params.notifySpConsume(0);this.charging.time=-1;ig.slowMotion.clearNamed("playerCharge",0);this.gui.crosshair.setSpecial(false);this.coll.time.animStatic=false;this.charging.fx.stop();this.cameraHandle.setZoom(sc.PLAYER_ZOOM,0.5,KEY_SPLINES.EAST_IN_OUT)}},onKill:function(a){this.clearCharge();this.parent(a);sc.Model.removeObserver(this.model,
this);sc.Model.removeObserver(sc.model,this);sc.Model.removeObserver(this.params,this);sc.Model.removeObserver(sc.playerSkins,this);sc.combat.removeActiveCombatant(this);if(!a){a=ig.vars.get("stats.deaths")||0;ig.game.respawn();ig.vars.set("stats.deaths",a+1)}},show:function(){this.parent();this.gui.crosshair=ig.game.spawnEntity(ig.ENTITY.Crosshair,0,0,0,{thrower:this,controller:new sc.PlayerCrossHairController});this.updateModelStats();this.updateSkinAura()},hide:function(){this.parent();if(this.skin.auraFxHandle){this.skin.auraFxHandle.stop();
this.skin.auraFxHandle=null}},getChargeType:function(a,b){return this.dashTimer>0.33?f:a.guarding||sc.control.guarding()&&Vec2.isZero(b.moveDir)?this.model.getCore(sc.PLAYER_CORE.GUARD)?e:d:sc.control.dashHold()?f:this.state==1||(this.state==2||this.state==5)&&this.model.getCore(sc.PLAYER_CORE.THROWING)&&sc.control.aiming()?c:d},getCurrentChargeLevel:function(){return this.charging.time<=0?0:b(this.charging)},getMaxChargeLevel:function(a){var b=0,a=a.actionKey,c=3;for(this.model.name=="Lea"&&(sc.newgame.get("combat-arts-level-1")?
c=1:sc.newgame.get("combat-arts-level-2")&&(c=2));b<c&&this.model.getAction(sc.PLAYER_ACTION[a+(b+1)]);)b++;return b},startCharge:function(a){if(!this.model.getCore(sc.PLAYER_CORE.SPECIAL)||!this.model.getCore(sc.PLAYER_CORE.CLOSE_COMBAT)&&a==d)return false;var b=this.getMaxChargeLevel(a),e=this.model.params.getSp(),f=0;e>=sc.PLAYER_SP_COST[2]?f=3:e>=sc.PLAYER_SP_COST[1]?f=2:e>=sc.PLAYER_SP_COST[0]&&(f=1);b=Math.min(b,f);if(f==0){if(!this.charging.msg||this.charging.msg.isFinished()){f=ig.lang.get("sc.gui.combat.no-sp");
this.charging.msg=new sc.SmallEntityBox(this,f,0.5);ig.gui.addGuiElement(this.charging.msg)}}else{this.charging.msg&&!this.charging.msg.isFinished()&&this.charging.msg.remove();this.charging.msg=null}if(b==0)return false;this.charging.maxLevel=b;this.charging.type=a;Vec2.assignC(this.charging.prefDir,0,0);a==c?this.quickStateSwitch(1):a==d&&this.quickStateSwitch(3);return true},getChargeAction:function(a,b){for(var c=a.actionKey;b&&!this.model.getAction(sc.PLAYER_ACTION[c+b]);)b--;if(!b)return 0;
var d=sc.PLAYER_SP_COST[b-1];sc.newgame.get("infinite-sp")||this.model.params.consumeSp(d);return c+b},quickStateSwitch:function(a){this.state=a;if(a==1){this.gui.crosshair.setActive(true);this.setDefaultConfig(this.configs.aiming)}else{this.gui.crosshair.setActive(false);this.setDefaultConfig(this.configs.normal)}},isElementChangeBlocked:function(){return this.isControlBlocked()||this.charging.time!=-1},isControlBlocked:function(){return this.hasStun()||this.params.isDefeated()||this.interactObject||
this.currentAction&&this.currentAction.eventAction},update:function(){this.playerTrack.lastPlayerAction=null;for(var b=this.cameraTargets.length;b--;){var c=this.cameraTargets[b];c._killed&&this.removeCameraTarget(c)}if(this.attackResetTimer>0){this.attackResetTimer=this.attackResetTimer-ig.system.tick;if(this.attackResetTimer<=0)this.attackCounter=this.attackResetTimer=0}if(this.perfectGuardCooldown>0){this.perfectGuardCooldown=this.perfectGuardCooldown-ig.system.tick;if(this.perfectGuardCooldown<
0)this.perfectGuardCooldown=0}if(!sc.inputForcer.isBlocking()){a(this.actionBlocked,"charge");a(this.actionBlocked,"action");a(this.actionBlocked,"dash");a(this.actionBlocked,"reaim");a(this.actionBlocked,"move");this.model.updateLoop(sc.combat.isInCombat(this));if(this.explicitAimStart){this.explicitAimStart=this.explicitAimStart-ig.system.actualTick;if(this.explicitAimStart<=0)this.explicitAimStart=0}if(this.hasStun()&&this.interactObject){this.interactObject.onInteractObjectDrop();this.explicitAimStart=
0.05;this.interactObject=null}b=this.gatherInput();if(this.doEscapeTimer>0){this.doEscapeTimer=this.doEscapeTimer-ig.system.tick;if(this.doEscapeTimer<=0||this.params.isDefeated()){this.doEscapeTimer=0;Vec2.assignC(this.dashDir,0,0);this.hitStable=sc.ATTACK_TYPE.LIGHT}else if(this.damageTimer>0&&this.damageTimer<=0.2)this.damageTimer=1E-5}if(this.switchedMode){this.switchedMode=false;sc.combat.showModeChange(this,this.model.currentElementMode);this.updateSkinAura()}if(this.isControlBlocked()){this.clearCharge();
this.clearActionBlocked();this.regenShield(false);sc.combat.clearModeAura(this);this.dashBlock=this.dashTimer=this.dashCount=0;this.hasStun()&&this.stunData.time>=this.stunData.stunEscapeTime?this.handleDash(j,b,true,true):this.hasStun()&&this.damageTimer<=0.2?this.handleDash(j,b,true):this.dashDir.x=this.dashDir.y=0;this.attackResetTimer=this.attackCounter=0;b=this.currentAction&&this.currentAction.eventAction?0:4;if(this.state!=b){this.state=b;this.jumpingEnabled=false;if(this.state==0){this.setDefaultConfig(this.configs.normal);
this.defaultConfig.apply(this)}this.gui.crosshair.setActive(false);Vec2.assignC(this.throwDir,0,0);this.doAttack=false}this.parent()}else{if(this.model.hasLevelUp()&&this.coll.pos.z==this.coll.baseZPos&&sc.model.isOutOfCombatDialogReady()){c=(c=(c=this.coll._collData&&this.coll._collData.groundEntry)&&c.parentColl||c)&&c.entity;(!c||!c.isDefeated||!c.isDefeated())&&this.levelUpNotifier.runLevelUpScene(this,this.model)}if(this.currentAction&&this.currentAction.name==="PLAYER_IDLE"&&!Vec2.isZero(b.moveDir)){this.cancelAction();
this.skin.pet&&(this.skin.pet.currentAction&&this.skin.pet.currentAction.name==="PLAYER_IDLE")&&this.skin.pet.cancelAction()}this.currentAction||this.clearActionBlocked();if(!this.jumping&&this.coll.pos.z==this.coll.baseZPos)this.maxJumpHeight=-1;this.handleDash(j,b);this.handleGuard(j,b);this.handleCharge(j,b);this.handleStateChange(j,b);if(this.dashTimer>0){ig.game.firstUpdateLoop&&sc.stats.addMap("player","dashTime",ig.system.rawTick);this.dashTimer=this.dashTimer-ig.system.tick;if(this.dashTimer<=
0){this.dashTimer=0;this.gui.crosshair.setSpeedFactor(1);!j.guarding&&!j.isCharging&&this.defaultConfig.apply(this)}}else{this.dashCount=0;this.updatePlayerMovement(j,b)}if(this.state!=5||j.startState==5)this.gui.crosshair.active&&(this.state!=2||j.guarding)&&!j.isCharging?this.gui.crosshair.getDir(this.face):ig.input.currentDevice==ig.INPUT_DEVICES.KEYBOARD_AND_MOUSE&&j.guarding&&this.gui.crosshair.getDir(this.face);this.handleStateStart(j,b);this.charging.executing=false;!sc.model.isCutscene()&&
(this.state!=0||!Vec2.isZero(this.coll.accelDir)||j.guarding)?sc.combat.showModeAura(this,this.model.currentElementMode):sc.combat.clearModeAura(this);this.parent();if(this.idle.timer>0&&this.currentAnim=="idle"&&!this.isControlBlocked()&&!sc.model.isCutscene()&&!this.currentAction){this.idle.timer=this.idle.timer-ig.system.tick;if(this.idle.timer<=3.75&&this.skin.pet&&ig.CollTools.getGroundDistance(this.skin.pet.coll,this.coll)<32&&Vec2.dot(this.skin.pet.face,this.face)<=0&&this.skin.pet.coll.baseZPos==
this.coll.pos.z){this.idle.timer=0;this.doPetAction()}else if(this.idle.timer<=0){b=this.idle.actions[Math.floor(this.idle.actions.length*Math.random())];this.setAction(b)}}else this.idle.timer=5+Math.random()*5}}},gatherInput:function(){i.thrown=false;i.melee=false;i.aimStart=false;i.aim=false;i.attack=false;i.autoThrow=false;i.charge=false;i.dashX=0;i.dashY=0;i.guard=false;i.relativeVel=this.coll.relativeVel;Vec2.assign(i.moveDir,0,0);if(ig.game.isControlBlocked()){this.explicitAimStart=0.05;return i}i.charge=
sc.control.charge();if(!ig.interact.isBlocked()){if(this.model.getCore(sc.PLAYER_CORE.THROWING)){i.aimStart=sc.control.aimStart();i.aim=sc.control.aiming();i.thrown=sc.control.thrown();i.autoThrow=sc.control.autoThrown()}if(!this.floating&&this.model.getCore(sc.PLAYER_CORE.CLOSE_COMBAT)){i.attack=this.model.getCore(sc.PLAYER_CORE.THROWING)?sc.control.attacking():sc.control.fullScreenAttacking();i.melee=sc.control.melee()}}if(this.model.getCore(sc.PLAYER_CORE.GUARD))i.guard=sc.control.guarding();i.relativeVel=
!this.floating&&this.model.getCore(sc.PLAYER_CORE.MOVE)?sc.control.moveDir(i.moveDir,this.coll.relativeVel):1;if(Vec2.isZero(i.moveDir))this.moveDirStartedTimer=0;else{var a=Vec2.angle(i.moveDir,this.lastMoveDir);if(!Vec2.isZero(this.lastMoveDir)&&Math.abs(a)>Math.PI/3)this.moveDirStartedTimer=0;this.moveDirStartedTimer=this.moveDirStartedTimer+ig.system.actualTick}a=false;if(this.charging.time>=0||sc.inputForcer.isSubmitted())a=true;i.aim&&(a=true);ig.input.currentDevice==ig.INPUT_DEVICES.KEYBOARD_AND_MOUSE&&
(a=true);if(this.keepLastMoveDir<=0&&!Vec2.equal(this.lastMoveDir,i.moveDir))this.keepLastMoveDir=2/60;if(this.keepLastMoveDir>0){this.keepLastMoveDir=this.keepLastMoveDir-ig.system.actualTick;if(!sc.inputForcer.isSubmitted()&&this.keepLastMoveDir>0&&(i.moveDir.x!=0||i.moveDir.y!=0)){if(i.moveDir.x==0)i.moveDir.x=this.lastMoveDir.x;if(i.moveDir.y==0)i.moveDir.y=this.lastMoveDir.y}}Vec2.assign(this.lastMoveDir,i.moveDir);if(!this.jumping&&sc.control.dashing()&&this.dashBlock<0.2&&(a||this.moveDirStartedTimer>
0.05)){i.dashX=i.moveDir.x;i.dashY=i.moveDir.y}return i},handleDash:function(a,b,c,d){if(this.dashBlock>0)this.dashBlock=this.dashBlock-ig.system.tick;if(!this.actionBlocked.dash&&(b.dashX||b.dashY)&&this.dashTimer<=0.4&&this.dashBlock<=0){if(b.dashX)this.dashDir.x=b.dashX;if(b.dashY)this.dashDir.y=b.dashY;if(d){this.doEscapeTimer=0.3;this.hitStable=sc.ATTACK_TYPE.MASSIVE}}a.redashReady=this.dashTimer<=(this.dashCount<this.maxDash?0.15:0.1);if(c)a.redashReady=false;if(!this.jumping&&this.model.getCore(sc.PLAYER_CORE.DASH)){if((this.dashDir.x!=
0||this.dashDir.y!=0)&&a.redashReady){if(this.doEscapeTimer){this.doEscapeTimer=0;this.stunEscapeDash=true;this.resetStunData();this.hitStable=sc.ATTACK_TYPE.LIGHT;sc.combat.showCombatMessage(this,sc.COMBAT_MSG_TYPE.STUN_CANCEL)}else this.stunEscapeDash=false;this.startDash();a.redashReady=false}}else{this.dashCount=0;this.dashTimer=this.dashDir.x=this.dashDir.y=0}},handleGuard:function(a,b){var c=this.guard.damage<1&&a.redashReady&&!this.actionBlocked.action&&(this.charging.time==-1||this.charging.type==
e);a.guarding=false;var d=this.model.getAction(sc.PLAYER_ACTION.GUARD),f=this.model.getAction(sc.PLAYER_ACTION.PERFECT_GUARD);if(c)if(b.guard){if(this.attackCounter&&!this.attackResetTimer)this.attackResetTimer=0.1;if(this.currentAction!=d&&this.currentAction!=f){this.dashTimer=0;if(this.perfectGuardCooldown>0)this.setAction(d);else{this.setAction(f);this.perfectGuardCooldown=0.5}}this.gui.crosshair.setSpeedFactor(0.25);a.guarding=true;ig.game.firstUpdateLoop&&sc.stats.addMap("combat","guardTime",
ig.system.rawTick);this.recordInput&&ig.vars.add("playerVar.input.guardTime",ig.system.tick)}else if(this.charging.time!=-1&&this.charging.type==e)a.guarding=true;else if(this.currentAction==d||this.currentAction==f){this.cancelAction();this.gui.crosshair.setSpeedFactor(1)}this.regenShield(a.guarding)},handleCharge:function(a,c){if(this.charging.block>0){this.charging.block=this.charging.block-ig.system.actualTick;if(this.charging.block<0)this.charging.block=0}else if(c.charge&&this.charging.time==
-1&&this.actionBlocked.charge!=-1&&this.actionBlocked.charge<0.2){var d=this.getChargeType(a,c);if(this.startCharge(d)){this.attackResetTimer=this.attackCounter=0;this.dashAttackCount=Math.min(this.maxDash,this.dashCount);this.dashTimer=0;this.dashDir.x=this.dashDir.y=0;this.charging.swapped=false;this.charging.time=0;this.charging.cancelTime=0}}a.applyCharge=0;a.isCharging=false;if(this.charging.time>=0){a.isCharging=true;if(!this.actionBlocked.charge){if(this.charging.time==0){ig.slowMotion.add(0.1,
0.2,"playerCharge");this.showChargeEffect(1);this.gui.crosshair.setSpecial(true);if(!a.guarding){this.currentAction&&this.cancelAction();this.doPlayerAction("CHARGING")}this.coll.time.animStatic=true;this.gui.crosshair.active?this.gui.crosshair.getDir(this.face):Vec2.isZero(c.moveDir)||Vec2.assign(this.face,c.moveDir)}Vec2.isZero(c.moveDir)||Vec2.assign(this.charging.prefDir,c.moveDir);d=b(this.charging);ig.game.firstUpdateLoop&&sc.stats.addMap("combat","charging",ig.system.rawTick);if(!sc.autoControl.isActive()||
!ig.slowMotion.hasSlowMotion("tutorialMsg"))this.charging.time=this.charging.time+ig.system.actualTick;if(!sc.autoControl.isActive())this.charging.cancelTime=this.charging.cancelTime+ig.system.actualTick;if(this.charging.maxLevel<3)this.charging.time=Math.min(this.charging.time,h[this.charging.maxLevel]-0.05);var e=b(this.charging);if(d>=1&&e!=d){this.charging.cancelTime=0;this.showChargeEffect(e)}}if((this.charging.cancelTime>1||!c.charge)&&this.charging.time>=h[0]){a.applyCharge=b(this.charging);
a.isCharging=false;this.clearCharge();if(this.charging.cancelTime>1)this.charging.block=0.5}}},handleStateChange:function(a,b){a.startState=-1;if(a.isCharging){if(!this.charging.swapped)if(this.charging.type!=e&&a.guarding){this.charging.swapped=true;this.startCharge(e)}else if(this.charging.type!=f&&!a.guarding&&this.charging.time<0.1&&sc.control.dashing()&&!Vec2.isZero(b.moveDir)){this.charging.swapped=true;this.startCharge(f)}else if(this.charging.type==d&&this.model.getCore(sc.PLAYER_CORE.THROWING)&&
sc.control.chargeThrowSwap()){this.charging.swapped=true;this.startCharge(c)}else if(this.charging.type==c&&sc.control.chargeAttackSwap()){this.charging.swapped=true;this.startCharge(d)}}else{if(this.state==4){this.state=0;a.startState=this.state}if(a.applyCharge){this.state=5;if(this.charging.type==c){this.gui.crosshair.getThrowDir(this.throwDir);this.gui.crosshair.setThrown()}a.startState=this.state}else if(this.state==0&&(b.attack||b.melee)){this.state=3;a.startState=this.state}else if(this.state==
0&&(b.aimStart||!this.explicitAimStart&&!this.dashTimer&&b.aim)){this.state=1;a.startState=this.state}else if(this.state==1)if(b.thrown||b.autoThrow&&(!this.dashTimer||a.redashReady)){this.gui.crosshair.getThrowDir(this.throwDir);this.state=2;a.startState=this.state;this.throwCharge=this.gui.crosshair.isThrowCharged();this.gui.crosshair.setThrown();this.gui.crosshair.setSpeedFactor(0.25)}else{if(!b.aim){this.state=0;a.startState=this.state}}else if(this.state==2||this.state==3||this.state==5){var g=
b.thrown&&this.actionBlocked.action>=0&&this.actionBlocked.action<0.2||b.autoThrow&&!this.actionBlocked.action;if(this.gui.crosshair.active&&!this.doAttack&&g){this.gui.crosshair.getThrowDir(this.throwDir);this.throwCharge=this.gui.crosshair.isThrowCharged();this.gui.crosshair.setThrown()}if((b.attack||b.melee)&&this.actionBlocked.action>=0&&this.actionBlocked.action<0.2)this.doAttack=true;if(!this.actionBlocked.action&&!Vec2.isZero(this.throwDir)){this.state=2;a.startState=this.state}else if(!this.actionBlocked.action&&
this.doAttack){this.state=3;a.startState=this.state}else if(!this.currentAction||a.guarding||!this.actionBlocked.move&&(b.moveDir.x!=0||b.moveDir.y!=0)||!this.actionBlocked.reaim&&b.aim){if(this.attackCounter&&!this.attackResetTimer)this.attackResetTimer=0.1;if(this.dashTimer<=0&&!a.guarding){this.cancelAction();this.clearActionBlocked()}if(b.aim){this.state=1;a.startState=this.state}else{this.state=0;a.startState=this.state;this.setCurrentAnim("preIdle",true,"idle")}}}}},updatePlayerMovement:function(a,
b){if(a.guarding){this.state==1&&ig.game.firstUpdateLoop&&sc.stats.addMap("combat","aiming",ig.system.rawTick);Vec2.assignC(this.coll.accelDir,0,0);(b.moveDir.x||b.moveDir.y)&&Vec2.assign(this.face,b.moveDir)}else if(this.state==0||this.state==1){this.state==1&&ig.game.firstUpdateLoop&&sc.stats.addMap("combat","aiming",ig.system.rawTick);if(!this.currentAction||this.currentAction.parallelMove){Vec2.assign(this.coll.accelDir,b.moveDir);this.coll.relativeVel=b.relativeVel}this.jumping&&(Vec2.dot(this.coll.accelDir,
this.jumpForwardDir)>=0&&Vec2.distance(this.coll.pos,this.jumpPoint)<8?Vec2.add(this.coll.accelDir,this.jumpForwardDir):Vec2.assignC(this.jumpForwardDir,0,0))}else this.jumping||Vec2.assignC(this.coll.accelDir,0,0)},handleStateStart:function(a,b){a.startState!=-1&&this.cancelJump();switch(a.startState){case 0:this.recordInput&&ig.vars.set("playerVar.input.aiming",false);this.setWalkAnims("normal");this.setDefaultConfig(this.configs.normal);this.gui.crosshair.setActive(false);break;case 1:this.recordInput&&
ig.vars.set("playerVar.input.aiming",true);this.explicitAimStart=0;this.setDefaultConfig(this.configs.aiming);this.dashTimer<=0&&(!this.jumping&&!a.guarding)&&this.setAction(this.model.getAction(sc.PLAYER_ACTION.AIM_START));this.setWalkAnims("aiming");this.gui.crosshair.chargeActive=this.model.getCore(sc.PLAYER_CORE.CHARGE);this.gui.crosshair.active||this.gui.crosshair.setActive(true);this.gui.crosshair.setSpeedFactor(1);break;case 3:this.recordInput&&ig.vars.set("playerVar.input.aiming",false);ig.input.currentDevice==
ig.INPUT_DEVICES.KEYBOARD_AND_MOUSE&&(this.model.getCore(sc.PLAYER_CORE.THROWING)&&sc.options.get("close-circle"))&&this.gui.crosshair.setCircleGlow();this.attackCounter++;this.attackResetTimer=0;var g;if(this.attackCounter<=3)g=this.attackCounter%2==1?"ATTACK_REV":"ATTACK";else{g="ATTACK_FINISHER";this.attackResetTimer=this.attackCounter=0}ig.vars.add("playerVar.input.melee",1);sc.stats.addMap("player","close",1);this.dashAttackCount=Math.min(this.maxDash,this.dashCount);this.charging.executeLevel=
0;this.startCloseCombatAction(g,b);break;case 2:if(this.recordInput){ig.vars.set("playerVar.input.aiming",false);ig.vars.add("playerVar.input.thrown",1)}this.throwCounter++;g=this.throwCounter%2==0?this.throwCharge?"THROW_CHARGED_REV":"THROW_NORMAL_REV":this.throwCharge?"THROW_CHARGED":"THROW_NORMAL";this.dashAttackCount=Math.min(this.maxDash,this.dashCount);this.charging.executeLevel=0;this.startThrowAction(g,b);break;case 5:g=this.getChargeAction(this.charging.type,a.applyCharge);if(sc.options.get("combat-art-name")){var h=
this.model.getCombatArtName(sc.PLAYER_ACTION[g]);if(h){h=new sc.SmallEntityBox(this,h.toString(),1);h.stopRumble();ig.gui.addGuiElement(h)}}this.charging.executeLevel=a.applyCharge;sc.stats.addMap("combat","specials",1);sc.stats.addMap("combat","specials-"+this.model.currentElementMode+"-level-"+a.applyCharge,1);if(this.charging.type==d){sc.stats.addMap("combat","specialsClose",1);Vec2.isZero(this.charging.prefDir)||Vec2.assign(this.face,this.charging.prefDir);this.startCloseCombatAction(g,b)}else if(this.charging.type==
c){sc.stats.addMap("combat","specialsThrow",1);this.startThrowAction(g,b)}else if(this.charging.type==e){sc.stats.addMap("combat","specialsGuard",1);this.doCombatAction(g)}else if(this.charging.type==f){sc.stats.addMap("combat","specialsDash",1);Vec2.isZero(this.charging.prefDir)||Vec2.assign(this.dashDirData,this.charging.prefDir);this.gui.crosshair.setActive(false);this.setAttribute("dashDir",this.dashDirData);this.doCombatAction(g)}}},startThrowAction:function(a,b){if(this.dashTimer>0)this.dashBlock=
0.3;this.dashTimer=0;Vec2.assign(this.face,this.throwDir);this.coll.pos.z==this.coll.baseZPos?this.setAttribute("dashDir",Vec2.assign(this.dashDirData,b.moveDir)):this.setAttribute("dashDir",Vec2.assignC(this.dashDirData,0,0));Vec2.assign(this.throwDirData,this.throwDir);Vec2.assignC(this.throwDir,0,0);this.doCombatAction(a)},startCloseCombatAction:function(a,b){if(this.dashTimer>0)this.dashBlock=0.3;this.dashTimer=0;this.doAttack=false;this.gui.crosshair.setActive(false);this.coll.pos.z==this.coll.baseZPos?
this.setAttribute("dashDir",Vec2.assign(this.dashDirData,b.moveDir)):this.setAttribute("dashDir",Vec2.assignC(this.dashDirData,0,0));Vec2.isZero(b.moveDir)||Vec2.assign(this.face,b.moveDir);this.doCombatAction(a)},startDash:function(){if(this.state==3){this.recordInput&&ig.vars.add("playerVar.input.attackDashCancel",1);sc.stats.addMap("player","atkDashCancel",1)}this.attackCounter=0;this.dashCount++;this.doAttack=this.dashPerfect=false;Vec2.assignC(this.throwDir,0,0);this.gui.crosshair.active||Vec2.assign(this.face,
this.dashDir);this.setAttribute("dashDir",Vec2.assign(this.dashDirData,this.dashDir));this.dashDir.x=this.dashDir.y=0;if(this.charging.time>=0){if(this.charging.time<=0.2)return;this.clearCharge();this.charging.block=0.5}if(this.state==2)this.state=1;else if(this.state==3){this.setWalkAnims("normal");this.setDefaultConfig(this.configs.normal);this.state=0}if(this.dashCount<=this.maxDash){sc.stats.addMap("player","dash",1);sc.stats.addMap("player","steps",3)}this.clearActionBlocked();this.gui.crosshair.reducePrecision(0.2);
this.gui.crosshair.setSpeedFactor(0.5);this.jumpingEnabled=false;this.dashTimer=sc.newgame.get("dash-1")?0.26:0.36;this.onMoveEffect("dash");var a=this.dashCount<=this.maxDash?this.getMaxDashes()!=3?"DASH_LONG":"DASH":"DASH_SLOW";this.playerTrack.lastPlayerAction=a;this.doPlayerAction(a);this.dashCount<=this.maxDash&&sc.combat.showModeDash(this,this.model.currentElementMode)},deferredUpdate:function(){if(this.interactObject&&this.interactObject.onInteractObjectDeferredUpdate)this.interactObject.onInteractObjectDeferredUpdate(this)},
postActionUpdate:function(){if(this.interactObject&&this.interactObject.onInteractObjectPostActionUpdate)this.interactObject.onInteractObjectPostActionUpdate()},cancelInteract:function(){if(this.interactObject){this.interactObject=null;if(sc.control.aiming())this.explicitAimStart=0.05}},onPreDamageModification:function(a,b,c,d,e,f){this.recordInput&&(f?ig.vars.add("playerVar.input.shieldedHits",1):ig.vars.add("playerVar.input.hits",1));if(f){sc.stats.addMap("combat","shieldedHits",1);if(f==sc.SHIELD_RESULT.PERFECT){ig.vars.add("playerVar.input.perfectShield",
1);sc.stats.addMap("combat","perfectShield",1);if(this.params.getModifier("PERFECT_GUARD_RESET")>=1){this.perfectGuardCooldown=0;for(b=this.shieldsConnections.length;b--;)this.shieldsConnections[b].resetPerfectGuardTime()}}}else sc.stats.addMap("combat","damageHits",1);if(e&&f!=sc.SHIELD_RESULT.PERFECT&&!ig.vars.get("g.newgame.ignoreLeaMustDie"))if(sc.newgame.get("lea-must-die"))e.damage=Math.max(e.damage,this.params.currentHp||1);else if(sc.newgame.get("enemy-damage-15"))e.damage=Math.round(e.damage*
1.5);else if(sc.newgame.get("enemy-damage-2"))e.damage=e.damage*2;else if(sc.newgame.get("enemy-damage-4"))e.damage=e.damage*4;sc.arena.onPreDamageModification(e,f,a);return false},onPlayerShieldBreak:function(){sc.stats.addMap("combat","shieldBreaks",1);this.state=4;this.cancelAction()},onPerfectDash:function(){if(!this.dashPerfect){sc.stats.addMap("player","perfectDash",1);sc.arena.onPerfectDodge();if(this.model.name=="Lea"&&sc.newgame.get("witch-time")&&!ig.vars.get("tmp.slowMotionActive")){sc.combat.showPerfectDashEffect(this);
var a=sc.ProxyTools.getProxy("evadeSloMo",this);a&&a.spawn(this.coll.pos.x,this.coll.pos.y,this.coll.pos.z,this,this.face,true);this.invincibleTimer=4}this.dashPerfect=true}},onDamageTaken:function(a,b){b!=sc.SHIELD_RESULT.PERFECT&&!sc.model.isCutscene()&&sc.stats.addMap("combat","damageTaken",a)},onHeal:function(a,b){sc.stats.addMap("combat","healed",b)},onTargetHit:function(a,b,c,d){if(!ig.vars.get("playerVar.damageStatsIgnore")){sc.stats.addMap("combat","damageGiven",c.damage);sc.stats.setMapMax("combat",
"maxDamage",c.damage)}this.combatStats.lastTarget=a;if(c.critical){sc.stats.addMap("combat","critHits",1);b.ballDamage?sc.stats.addMap("combat","critHitsThrow",1):sc.stats.addMap("combat","critHitsClose",1)}if(b.spFactor){b.ballDamage||sc.stats.addMap("player","closeHits",1);this.model.onTargetHit(a,b,c)}sc.arena.onTargetHit(b,c,d,a);this.parent(a,b,c,d)},onJump:function(a,b){sc.stats.addMap("player","jumps",1);this.maxJumpHeight=this.coll.pos.z+a;Vec2.assign(this.jumpPoint,this.coll.pos);a>=16?Vec2.assign(this.jumpForwardDir,
this.coll.accelDir):Vec2.assignC(this.jumpForwardDir,0,0);this.parent(a,b)},onPhysicsSquish:function(a){if(a.squishRespawn){Vec3.assign(this.respawn.pos,this.mapStartPos);this.quickFall(ig.TERRAIN.HOLE)}},varsChanged:function(){this.condition&&this.condition.evaluate();if(!this.floating&&ig.vars.get("playerVar.staticFloat")){this.floating=true;this.configs.normal.overwrite("floatHeight",6);this.configs.aiming.overwrite("floatHeight",6);this.setDefaultConfig(this.configs.normal)}else if(this.floating&&
!ig.vars.get("playerVar.staticFloat")){this.floating=false;this.configs.normal.clearOverwrite();this.configs.aiming.clearOverwrite();this.setDefaultConfig(this.configs.normal)}if(this.recordInput!=ig.vars.get("playerVar.recordInput"))if(this.recordInput=ig.vars.get("playerVar.recordInput")){ig.vars.set("playerVar.input.thrown",0);ig.vars.set("playerVar.input.aiming",false);ig.vars.set("playerVar.input.guardTime",0);ig.vars.set("playerVar.input.shieldedHits",0);ig.vars.set("playerVar.input.hits",0);
ig.vars.set("playerVar.input.perfectShield",0);ig.vars.set("playerVar.input.attackDashCancel",0);ig.vars.set("playerVar.input.melee",0)}},modelChanged:function(a,b,c){if(a==this.params)b==sc.COMBAT_PARAM_MSG.STATS_CHANGED&&this.updateModelStats();else if(a==this.model)if(b==sc.PLAYER_MSG.ELEMENT_MODE_CHANGE){this.copyModelSkills();this.updateModelStats()}else b==sc.PLAYER_MSG.CONFIG_CHANGED?this.initModel():b==sc.PLAYER_MSG.STATS_CHANGED?this.updateModelStats():b==sc.PLAYER_MSG.ITEM_USED?this.itemConsumer.activateItemEffect(this,
this.model,c):b==sc.PLAYER_MSG.ITEM_TOGGLED&&this.updateModelStats();else a==sc.playerSkins?c=="Appearance"?this.updateAnimSheet():c=="StepEffect"?this.updateSkinStepFx():c=="Aura"?this.updateSkinAura():c=="Pet"&&this.updateSkinPet(true):a==sc.model&&b==sc.GAME_MODEL_MSG.STATE_CHANGED&&this.updateAnimSheet()},copyModelSkills:function(){this.proxies=this.model.getBalls()},doQuickRespawn:function(a,b,c){(a==ig.TERRAIN.WATER||a==ig.TERRAIN.HOLE||a==ig.TERRAIN.COAL||a==ig.TERRAIN.QUICKSAND||a==ig.TERRAIN.HIGHWAY)&&
sc.stats.addMap("player","respawns",1);a==ig.TERRAIN.WATER?sc.stats.addMap("player","waterDeath",1):a==ig.TERRAIN.COAL?sc.stats.addMap("player","coalDeath",1):a==ig.TERRAIN.QUICKSAND?sc.stats.addMap("player","sandDeath",1):a==ig.TERRAIN.HOLE?sc.stats.addMap("player","holeDeath",1):a==ig.TERRAIN.HIGHWAY&&sc.stats.addMap("player","highwayDeath",1);this.parent(a,b,c)},onRespawnEnd:function(){for(var a=ig.game.getOverlapEntities(this),b=a.length;b--;){var c=a[b];(c instanceof ig.ENTITY.WavePushPullBlock||
c instanceof ig.ENTITY.PushPullBlock)&&c.resetPos()}},isThrowCharged:function(){return this.gui.crosshair.isThrowCharged()},setOverrideBall:function(a){this.overrideBall=a},useItem:function(a){this.itemConsumer.runItemUseAction(this,this.model,a)},onVarAccess:function(a,b){return b[1]=="hasElementShield"?this.hasShield("elementOrbShield"):this.parent(a,b)}});window.checkPlayerPos=function(){var a=ig.game.playerEntity;if(a&&!a.debugCheck&&a.coll.pos.x==1)a.debugCheck=true}});ig.baked=!0;
ig.module("game.feature.party.party").requires("impact.feature.storage.storage","impact.base.event","game.feature.menu.map-model","game.feature.model.game-model").defines(function(){var b=Vec3.create();Vec2.create();sc.PARTY_MSG={PARTY_CHANGED:1,DUNGEON_BLOCK_CHANGED:2};sc.PARTY_MAX_MEMBERS=2;var a=[1,0.9,0.75],d=[1,0.8,0.6];sc.PARTY_OPTIONS=["Lea","Shizuka","Shizuka0","Emilie","Sergey","Schneider","Schneider2","Hlin","Grumpy","Buggy","Glasses","Apollo","Joern","Triblader1","Luke"];sc.PARTY_SORT_TYPE=
{STATUS:0,NAME:1,LEVEL:2};sc.PARTY_MEMBER_TYPE={UNKNOWN:0,CONTACT:1,FRIEND:2};sc.PARTY_STRATEGY={};sc.PARTY_STRATEGY.TARGET={WHATEVER:{others:false,same:false},MY_ENEMY:{others:false,same:true},OTHERS:{others:true,same:false}};sc.PARTY_STRATEGY.BEHAVIOUR={OFFENSIVE:{dodgeMin:0.2,dodgeMax:0.75},DEFENSIVE:{dodgeMin:0.4,dodgeMax:1,noAttack:true},DO_NOTHING:{dodgeMin:0.4,dodgeMax:1,doNothing:true,onlyTargetPlayer:true}};sc.PARTY_STRATEGY.ARTS={NORMAL:{factor:1},OFTEN:{factor:4},NEVER:{factor:0}};sc.SOCIAL_ACTION=
{PARTY_JOIN:1,PARTY_LEAVE:2,CONTACT:3};sc.PartyModel=ig.GameAddon.extend({observers:[],models:{},currentParty:[],partyEntities:{},contacts:{},dungeonBlocked:false,lastAreaDungeon:false,_deferredEntityUpdate:false,keepDistance:false,strategyKeys:{TARGET:"WHATEVER",BEHAVIOUR:"OFFENSIVE",ARTS:"NORMAL"},ai:{battle:0,targeting:0,aggressive:0},init:function(){this.parent("Party");for(var a=0;a<sc.PARTY_OPTIONS.length;++a)this.addPartyOption(sc.PARTY_OPTIONS[a]);this.onReset();ig.storage.register(this);
ig.vars.registerVarAccessor("party",this,"VarPartyEditor");sc.Model.addObserver(sc.model,this)},getStrategy:function(a){return sc.PARTY_STRATEGY[a][this.strategyKeys[a]]||{}},updatePartyStrategy:function(a,b){this.strategyKeys[a]=b},getStrategyKey:function(a,b){if(a=="TARGET"){if(b==0)return"WHATEVER";if(b==1)return"MY_ENEMY";if(b==2)return"OTHERS"}else if(a=="BEHAVIOUR"){if(b==0)return"OFFENSIVE";if(b==1)return"DEFENSIVE";if(b==2)return"DO_NOTHING"}else if(a=="ARTS"){if(b==0)return"NORMAL";if(b==
1)return"OFTEN";if(b==2)return"NEVER"}},setContactType:function(a,b){if(this.contacts[a])this.contacts[a].status=b},setOnlineStatus:function(a,b){if(this.contacts[a])this.contacts[a].online=b||false},setLocked:function(a,b){if(this.contacts[a])this.contacts[a].locked=b||false},addPartyOption:function(a){var b=new sc.PartyMemberModel(a);this.models[a]=b},initParty:function(a){for(var a=a.split(","),b=0;b<a.length;++b)this.addPartyMember(a[b],null,true,false,b>=2)},addPartyMember:function(a,b,c,d,i){if(this.currentParty.indexOf(a)==
-1){if(!i){this.setContactType(a,sc.PARTY_MEMBER_TYPE.FRIEND);this.setOnlineStatus(a,true)}this.currentParty.push(a);this.models[a].revive();this.models[a].setTemporary(i||false);if(!b&&d){this._spawnPartyMemberEntity(a,false,false);this._updateEntitiesOffset()}else if(!c)if(b){this._spawnPartyMemberEntity(a,true,false,b);this._updateEntitiesOffset()}else this._deferredEntityUpdate=true;sc.Model.notifyObserver(this,sc.PARTY_MSG.PARTY_CHANGED);ig.game.varsChangedDeferred()}},removePartyMember:function(a,
b,c){if(this.isPartyMember(a)){var d=this.currentParty.indexOf(a);this.currentParty.splice(d,1);this.contacts[a].locked=false;if(!b&&c){this._removePartyMemberEntity(a,null,true);this._updateEntitiesOffset()}else if(b){this._removePartyMemberEntity(a,b);this._updateEntitiesOffset()}else this._deferredEntityUpdate=true;this.models[a].noDie=false;this.models[a].revive();this.models[a].setTemporary(false);sc.Model.notifyObserver(this,sc.PARTY_MSG.PARTY_CHANGED);ig.game.varsChangedDeferred()}},reviveAllPartyMembers:function(){for(var a=
this.currentParty.length;a--;){var b=this.currentParty[a];this.models[b].isAlive()||this.revivePartyMemberEntity(b)}},reviveAllPartyMemberModels:function(){for(var a=this.currentParty.length;a--;){var b=this.currentParty[a];this.models[b]&&this.models[b].revive()}},revivePartyMemberEntity:function(a){var b=this.currentParty.indexOf(a);this.models[a].revive();if(b!=-1){this._spawnPartyMemberEntity(a,true,false,null);this._updateEntitiesOffset()}},modelChanged:function(a,b){b==sc.GAME_MODEL_MSG.STATE_CHANGED&&
a.isCutscene()&&this.reviveAllPartyMembers()},onMemberDefeat:function(a){this.models[a].onDefeat();sc.commonEvents.triggerEvent("PARTY_MEMBER_EVENT",{member:[a],eventType:"DIES"});sc.model.isCombatMode()||this.reviveAllPartyMembers()},keepMapDungeon:function(){this.lastAreaDungeon=this.dungeonBlocked=true;sc.Model.notifyObserver(this,sc.PARTY_MSG.DUNGEON_BLOCK_CHANGED);for(var a=this.currentParty.length;a--;){var b=this.partyEntities[this.currentParty[a]];b&&b.hide()}sc.commonEvents.cancelEvent("DUNGEON_TRANSITION")||
sc.commonEvents.triggerEvent("DUNGEON_TRANSITION",{mapTransition:null,areaTransition:"ENTER"})},onMapEnter:function(){this.partyEntities={};this.resetAi();var a=sc.map.isDungeon(true),b=null,c=null;if(sc.map.isDungeon()){if(!this.dungeonBlocked){this.dungeonBlocked=true;sc.Model.notifyObserver(this,sc.PARTY_MSG.DUNGEON_BLOCK_CHANGED);b="ENTER"}}else{if(this.dungeonBlocked){this.dungeonBlocked=false;sc.Model.notifyObserver(this,sc.PARTY_MSG.DUNGEON_BLOCK_CHANGED);b="LEAVE"}this.respawnMembers()}if(a!=
this.lastAreaDungeon)c=(this.lastAreaDungeon=a)?"ENTER":"LEAVE";(b||c)&&sc.commonEvents.triggerEvent("DUNGEON_TRANSITION",{mapTransition:b,areaTransition:c})},respawnMembers:function(){for(var a=0;a<this.currentParty.length;++a)this.models[this.currentParty[a]].isAlive()&&this._spawnPartyMemberEntity(this.currentParty[a],false,true);this._updateEntitiesOffset()},isDungeonBlocked:function(){return this.dungeonBlocked},isPartyMember:function(a){return this.getCurrentPartyIndex(a)!=-1},isFriend:function(a){return this.contacts[a].status==
sc.PARTY_MEMBER_TYPE.FRIEND},isPartyMemberLocked:function(a){return(a=this.contacts[a])&&a.locked},isPartyMemberOnline:function(a){return(a=this.contacts[a])&&a.online},isDefeated:function(){for(var a=this.currentParty.length;a--;)if(!this.partyEntities[this.currentParty[a]].isDefeated())return false;return ig.game.playerEntity.isDefeated()},getCurrentPartyIndex:function(a){return this.currentParty.indexOf(a)},getPartySize:function(){return this.currentParty.length},getPartySizeAlive:function(a){if(this.isDungeonBlocked())return 0;
for(var b=this.currentParty.length,c=0;b--;){var d=this.getPartyMemberModel(this.currentParty[b]);if(d.isAlive()&&(!a||!d.isAlive().temporary))c=c+1}return c},getDmgFactor:function(){return sc.party.getStrategy("BEHAVIOUR").doNothing?d[0]:d[this.getPartySizeAlive().limit(0,2)]},getPartyMemberModel:function(a){return this.models[a]},getPartyMemberEntity:function(a){return this.partyEntities[a]||null},getPartyMemberEntityByIndex:function(a,b){if(b){var c=this.getPartyMemberModelByIndex(a);if(!c||!c.isAlive())return null}return this.partyEntities[this.currentParty[a]]||
null},getPartyMemberIndex:function(a){return this.currentParty.indexOf(a)},getPartyMemberModelByIndex:function(a){return(a=this.currentParty[a])&&this.models[a]},addExperience:function(b,c,d,h,i){var j=this.getPartySize().limit(0,2);if(i&&i.ignorePartyCount||this.isDungeonBlocked())j=0;for(var j=a[j]||1,k=this.currentParty.length;k--;)this.models[this.currentParty[k]].addExperience(b*j,c,d,h,i);return j},updateEquipment:function(){for(var a=this.currentParty.length,b=[];a--;){var c=this.currentParty[a];
this.models[c].updateAutoEquip()&&b.push(c)}b.length>0&&sc.commonEvents.triggerEvent("PARTY_MEMBER_EVENT",{member:b,eventType:"EQUIP_UPDATE"})},resetMemberPos:function(a){var c=this.partyEntities[a];if(c){a=this._getMemberPos(b,a,false);c.setPos(a.x,a.y,a.z)}},resetAi:function(){this.ai.aggressive=0;this.ai.battle=0;this.ai.targeting=0},_getMemberPos:function(a,c,d){var h=ig.game.playerEntity,c=this.currentParty.indexOf(c);if(d){a=h.getAlignedPos(ig.ENTITY_ALIGN.BOTTOM,a);d=c==1?-16:16;if(Math.abs(h.face.x)>
Math.abs(h.face.y)){a.y=a.y+d;a.x=a.x+(h.face.x>0?-8:8)}else{a.x=a.x+d;a.y=a.y+(h.face.y>0?-8:8)}a.x=a.x-h.coll.size.x/2;a.y=a.y-h.coll.size.y/2}else if(h.coll.pos.z!=h.coll.baseZPos)a=Vec3.assign(a,h.respawn.pos);else{ig.navigation.getClosePosition(a,h.getAlignedPos(ig.ENTITY_ALIGN.BOTTOM,b),h.coll.size,h,null,48,1,0,ig.NAV_CLOSE_POINT_SEARCH.BEHIND_FACE,false);a.x=a.x-h.coll.size.x/2;a.y=a.y-h.coll.size.y/2}return a},doDeferredEntityUpdate:function(){if(!this.dungeonBlocked){for(var a in this.partyEntities)this.isPartyMember(a)||
this._removePartyMemberEntity(a);for(var b=this.currentParty.length;b--;){a=this.currentParty[b];this.partyEntities[a]||this._spawnPartyMemberEntity(a,true,false)}this._updateEntitiesOffset()}},_spawnPartyMemberEntity:function(a,c,d,h){var i=ig.game.playerEntity;if(h){d=h.getAlignedPos(ig.ENTITY_ALIGN.BOTTOM,b);d.x=d.x-i.coll.size.x/2;d.y=d.y+(h.coll.size.y/2-i.coll.size.y)}else d=this._getMemberPos(b,a,d);c=ig.game.spawnEntity(sc.PartyMemberEntity,d.x,d.y,d.z,{partyMemberName:a},!h&&c);this.partyEntities[a]=
c;if(h){Vec2.assign(c.face,h.face);if(h.onPartySwapHide)h.onPartySwapHide();else h.hide()}else Vec2.assign(c.face,i.face);c.initAnimations(true);if(h)c.noFaceRotate=true},_updateEntitiesOffset:function(){for(var a=0;a<this.currentParty.length;++a){var b=this.partyEntities[this.currentParty[a]];if(b)if(this.currentParty.length==1){b.posOffset.x=0;b.posOffset.y=-16}else{b.posOffset.x=a%2==1?-16:16;if(a%2==0&&a==this.currentParty.length-1)b.posOffset.x=0;b.posOffset.y=-8-Math.floor(a/2)*16}}},_removePartyMemberEntity:function(a,
c,d){var h=this.partyEntities[a];if(h){if(c){c.resetNpcState(true);var i=h.getAlignedPos(ig.ENTITY_ALIGN.BOTTOM,b);i.x=i.x-c.coll.size.x/2;i.y=i.y+(h.coll.size.y/2-c.coll.size.y);c.setPos(i.x,i.y,i.z);ig.EntityTools.clearEntitySpriteCut(c);c.show();c.resetNpcState()}h.leaveParty(d||!!c);delete this.partyEntities[a]}},onVarAccess:function(a,b){if(b[0]=="party"){var c=b[1];return c=="has"?this.currentParty.indexOf(b[2])!=-1:c=="alive"?!this.dungeonBlocked&&this.currentParty.indexOf(b[2])!=-1&&this.getPartyMemberModel(b[2]).isAlive():
c=="size"?this.currentParty.length+1:null}},postUpdateOrder:600,onPostUpdate:function(){if(!ig.loading&&!ig.game.paused){if(this._deferredEntityUpdate){this.doDeferredEntityUpdate();this._deferredEntityUpdate=false}for(var a=this.currentParty.length;a--;)this.models[this.currentParty[a]].update()}},onReset:function(){for(var a in this.models)this.models[a].reset();this.currentParty.length=0;this.resetAi();this.updatePartyStrategy("TARGET","WHATEVER");this.updatePartyStrategy("BEHAVIOUR","OFFENSIVE");
this.updatePartyStrategy("ARTS","NORMAL");this.lastAreaDungeon=this.dungeonBlocked=false;for(a=0;a<sc.PARTY_OPTIONS.length;++a)this.contacts[sc.PARTY_OPTIONS[a]]={status:sc.PARTY_MEMBER_TYPE.UNKNOWN,online:true,locked:false};sc.Model.notifyObserver(this,sc.PARTY_MSG.PARTY_CHANGED)},onStorageSave:function(a){var b={},c;for(c in this.models)b[c]=this.models[c].getSaveData();c={};for(var d in this.contacts)c[d]={status:this.contacts[d].status,online:this.contacts[d].online,locked:this.contacts[d].locked};
a.party={models:b,currentParty:ig.copy(this.currentParty),contacts:c,strategies:ig.copy(this.strategyKeys),dungeonBlocked:this.dungeonBlocked,lastAreaDungeon:this.lastAreaDungeon}},onStoragePreLoad:function(a){if(a=a.party){for(var b in this.models)this.models[b].setLoadData(a.models[b]);this.currentParty=ig.copy(a.currentParty);for(var c in this.contacts)if(a.contacts[c]){this.contacts[c].status=a.contacts[c].status||0;this.contacts[c].online=a.contacts[c].online||false;this.contacts[c].locked=a.contacts[c].locked||
false}if(a.strategies)for(c in this.strategyKeys)this.strategyKeys[c]=a.strategies[c]||this.strategyKeys[c];this.dungeonBlocked=a.dungeonBlocked;this.lastAreaDungeon=a.lastAreaDungeon||false}else this.onReset();sc.Model.notifyObserver(this,sc.PARTY_MSG.PARTY_CHANGED)}});ig.addGameAddon(function(){return sc.party=new sc.PartyModel});var c=ig.copy(sc.PARTY_OPTIONS);c.unshift("Member3");c.unshift("Member2");ig.Event.registerEntityFetchType("party",function(a){if(a.indexOf("Member")==0){a=a.substr(6,
1)*1-2;return sc.party.getPartyMemberEntityByIndex(a)}return sc.party.getPartyMemberEntity(a)},{_type:"String",_select:c})});ig.baked=!0;
ig.module("game.feature.player.player-steps").requires("impact.base.animation","impact.base.action","impact.base.entity","game.feature.player.player-config","game.feature.combat.model.combat-params","impact.feature.camera.camera","game.feature.combat.entities.food-icon","game.feature.party.party").defines(function(){function b(a,b){for(var c=a.actionAttached,d=c.length;d--;){var e=c[d];if(e instanceof sc.PlayerCameraFocusHandle){e.add!=b&&c.splice(d,1);return true}}return false}var a={NONE:0,MONEY:1};
ig.EVENT_STEP.SAVE_PLAYER_MODEL_VALUE=ig.EventStepBase.extend({modelType:null,_wm:new ig.Config({attributes:{modelType:{_type:"String",_info:"Mode value to set",_select:a}},label:function(){return"<i>SET</i> "+this.modelType+" TO <b>player.model.value</b>"}}),init:function(b){this.modelType=a[b.modelType]||a.NONE},start:function(){var b=void 0;switch(this.modelType){case a.MONEY:b=sc.model.player.credit>=1E3}b!=void 0&&ig.vars.set("player.model.value",b)}});ig.EVENT_STEP.ADD_PLAYER_CAMERA_TARGET=
ig.EventStepBase.extend({entity:null,_wm:new ig.Config({attributes:{entity:{_type:"Entity",_info:"Entity to target"},speed:{_type:"String",_info:"Speed of camera transition",_select:ig.Camera.SPEED_OPTIONS,_optional:true}}}),init:function(a){this.entity=a.entity;this.speed=a.speed},start:function(a,b){var c=ig.Event.getEntity(this.entity,b);c&&ig.game.playerEntity.addCameraTarget(c,this.speed)}});ig.EVENT_STEP.REMOVE_PLAYER_CAMERA_TARGET=ig.EventStepBase.extend({entity:null,_wm:new ig.Config({attributes:{entity:{_type:"Entity",
_info:"Entity to target"},speed:{_type:"String",_info:"Speed of camera transition",_select:ig.Camera.SPEED_OPTIONS,_optional:true}}}),init:function(a){this.entity=a.entity;this.speed=a.speed},start:function(a,b){var c=ig.Event.getEntity(this.entity,b);c&&ig.game.playerEntity.removeCameraTarget(c,this.speed)}});ig.EVENT_STEP.REMOVE_ALL_PLAYER_CAMERAS=ig.EventStepBase.extend({speed:null,_wm:new ig.Config({attributes:{speed:{_type:"String",_info:"Speed of camera transition",_select:ig.Camera.SPEED_OPTIONS,
_optional:true}}}),init:function(a){this.speed=a.speed},start:function(){ig.game.playerEntity.removeAllCameraTargets(this.speed)}});ig.EVENT_STEP.LEARN_SKILL=ig.EventStepBase.extend({skill:null,_wm:new ig.Config({attributes:{skill:{_type:"Integer",_info:"Skill ID"}}}),init:function(a){this.skill=a.skill},start:function(){sc.model.player.learnSkill(this.skill)}});ig.EVENT_STEP.DO_INLINE_LEVELUP=ig.EventStepBase.extend({skill:null,_wm:new ig.Config({attributes:{}}),init:function(){},start:function(){if(sc.model.player.hasLevelUp()){sc.model.enterGame();
ig.game.playerEntity.levelUpNotifier.runLevelUpScene(ig.game.playerEntity,sc.model.player,true)}},run:function(){if(sc.model.isRunning()){sc.model.enterCutscene();return true}return false}});var d={NEUTRAL:0,HEAT:1,COLD:2,SHOCK:3,WAVE:4,ALL_AVAILABLE:5};ig.EVENT_STEP.RESET_SKILL_TREE=ig.EventStepBase.extend({element:null,_wm:new ig.Config({attributes:{element:{_type:"String",_info:"element to reset",_select:d,_default:d.ALL_AVAILABLE}},label:function(){return"RESET <b>"+this.element+"</b> SKILLTREE"}}),
init:function(a){this.element=d[a.element||"NEUTRAL"]},start:function(){if(this.element>=5)for(var a=0;a<5;a++)sc.model.player.hasElement(a)&&sc.model.player.resetSkillTree(a);else sc.model.player.resetSkillTree(this.element)}});ig.EVENT_STEP.SET_ELEMENT_LOAD=ig.EventStepBase.extend({value:null,_wm:new ig.Config({attributes:{value:{_type:"Number",_info:"Value of load. 0=empty, 1=full (instant elemental overload)"}}}),init:function(a){this.value=a.value||0},start:function(){sc.model.player.setElementLoad(this.value)}});
ig.EVENT_STEP.SWITCH_PLAYER_CONFIG=ig.EventStepBase.extend({name:null,config:null,_wm:new ig.Config({attributes:{name:{_type:"String",_info:"Name of player config",_select:sc.PARTY_OPTIONS}}}),init:function(a){this.name=a.name;this.config=new sc.PlayerConfig(this.name)},clearCached:function(){this.config.decreaseRef()},start:function(){sc.model.player.setConfig(this.config)}});ig.EVENT_STEP.WAIT_UNTIL_PLAYER_CHARGED=ig.EventStepBase.extend({level:null,_wm:new ig.Config({attributes:{level:{_type:"Number",
_info:"Wait until this level of charge has been reached"}}}),init:function(a){this.level=a.level},run:function(){return this.level<=ig.game.playerEntity.getCurrentChargeLevel()}});ig.EVENT_STEP.SWITCH_ELEMENT_MODE=ig.EventStepBase.extend({element:null,_wm:new ig.Config({attributes:{element:{_type:"String",_info:"Element to switch to",_select:sc.ELEMENT},skipEffect:{_type:"Boolean",_info:"If true: do no show effects of changing elements"}}}),init:function(a){this.element=sc.ELEMENT[a.element]||sc.ELEMENT.NEUTRAL;
this.skipEffect=a.skipEffect},start:function(){sc.model.player.setElementMode(this.element,true,this.skipEffect)}});ig.EVENT_STEP.SWITCH_TO_ELEMENT_WITH_COMBAT_ART=ig.EventStepBase.extend({_wm:new ig.Config({attributes:{artType:{_type:"String",_info:"Type of combat art",_select:["THROW","ATTACK","DASH","GUARD"],_optional:true},level:{_type:"Integer",_info:"Minimum Level"},skipEffect:{_type:"Boolean",_info:"If true: do no show effects of changing elements"}}}),init:function(a){this.artType=a.artType||
null;this.level=a.level;this.skipEffect=a.skipEffect},start:function(){for(var a in sc.ELEMENT)if(sc.model.player.getCombatArtLevel(this.artType,sc.ELEMENT[a])>=this.level){sc.model.player.setElementMode(sc.ELEMENT[a],true,this.skipEffect);break}}});ig.EVENT_STEP.SET_VAR_COMBAT_ART_TYPE_WITH_MIN_LEVEL=ig.EventStepBase.extend({_wm:new ig.Config({attributes:{varName:{_type:"VarName",_info:"Will include the type of combat art THROW, ATTACK, DASH or GUARD"},level:{_type:"Integer",_info:"Minimum Level of combat art"}}}),
init:function(a){this.varName=a.varName||null;this.level=a.level},start:function(){for(var a=sc.model.player.currentElementMode,b=["THROW","ATTACK","DASH","GUARD"],c=ig.Event.getVarName(this.varName),d=0;d<b.length;++d){var e=b[d];if(sc.model.player.getCombatArtLevel(e,a)>=this.level){ig.vars.set(c,e);break}}}});ig.EVENT_STEP.HIDE_PETS=ig.EventStepBase.extend({_wm:new ig.Config({attributes:{hide:{_type:"Boolean",_info:"If true: hide pets"}}}),init:function(a){this.hide=a.hide},start:function(){ig.game.playerEntity.hidePets=
this.hide}});var c=Vec3.create(),e=Vec2.create();ig.ACTION_STEP.SHOOT_PROXY_PLAYER=ig.ActionStepBase.extend({proxySrc:null,elementProxy:null,align:0,startDist:0,_wm:new ig.Config({attributes:{proxy:{_type:"ProxyRef",_info:"Ball the entity will shoot",_optional:true},elementProxy:{_type:"String",_info:"Ball the entity will shoot",_optional:true,_select:["QUICK","CHARGED"]},align:{_type:"String",_info:"If defined: use specified alignment to shoot ball",_optional:true,_select:ig.ENTITY_ALIGN},startDist:{_type:"Number",
_info:"If defined: start projectile with given distance from center",_optional:true}}}),init:function(a){a.elementProxy?this.elementProxy=a.elementProxy:this.proxySrc=sc.ProxyTools.prepareSrc(a.proxy);if(a.align)this.align=ig.ENTITY_ALIGN[a.align];this.startDist=a.startDist||0},run:function(a){var b;if(this.elementProxy)if(this.elementProxy=="CHARGED"&&a.overrideBall)b=a.overrideBall;else{b=sc.combat.getElementMode(a);b=sc.PlayerConfig.getElementBall(a,b,this.elementProxy=="CHARGED")}else b=sc.ProxyTools.getProxy(this.proxySrc,
a);if(b){if(this.align)a.getAlignedPos(this.align,c);else{var d=a.maxJumpHeight===void 0?-1:a.maxJumpHeight;c.x=a.coll.pos.x+a.coll.size.x/2;c.y=a.coll.pos.y+a.coll.size.y/2;c.z=d<0?a.coll.pos.z:Math.min(a.coll.pos.z,d);c.z=c.z+Constants.BALL_HEIGHT}d=a.throwDirData||a.face;if(this.startDist){Vec2.assign(e,d);Vec2.length(e,this.startDist);Vec2.add(c,e)}b.spawn(c.x,c.y,c.z,a,d)}return true}});ig.ACTION_STEP.SET_PLAYER_ACTION_BLOCK=ig.ActionStepBase.extend({blockTypes:null,_wm:new ig.Config({attributes:{blockData:{_type:"Object",
_info:"Block Time Data"}}}),init:function(a){assertContent(a,"blockData");this.blockData=a.blockData},run:function(a){a.setActionBlocked&&a.setActionBlocked(this.blockData);return true}});ig.ACTION_STEP.SET_PLAYER_ANIM_SHEET=ig.ActionStepBase.extend({animSheet:null,_wm:new ig.Config({attributes:{animSheet:{_type:"AnimSheetRef",_info:"Animations of enemy"}}}),init:function(a){this.animSheet=new ig.AnimationSheet(a.animSheet)},clearCached:function(){this.animSheet.decreaseRef()},run:function(a){a.replaceAnimSheet&&
a.replaceAnimSheet(sc.playerSkins.replaceAnim(this.animSheet));return true}});ig.ACTION_STEP.CLEAR_PLAYER_ANIM_SHEET=ig.ActionStepBase.extend({_wm:new ig.Config({attributes:{}}),init:function(){},run:function(a){a.replaceAnimSheet&&a.replaceAnimSheet(null);return true}});ig.ACTION_STEP.SET_PLAYER_INVINCIBLE=ig.ActionStepBase.extend({factor:false,_wm:new ig.Config({attributes:{factor:{_type:"Number",_info:"Factor multiplied with base invincibility",_default:1}}}),init:function(a){this.factor=a.factor||
1},run:function(a){var b=3+a.params.getStat("focus")/250+1*a.params.getModifier("DASH_INVINC");a.stunEscapeDash&&(b=b+12);b=b/60*this.factor;a.isPlayer||(b=b+0.2);a.invincibleTimer=b;return true}});ig.ACTION_STEP.PLAYER_ADJUST_FACE=ig.ActionStepBase.extend({time:0,_wm:new ig.Config({attributes:{time:{_type:"Number",_info:"Duration over which to adjust face"}}}),init:function(a){this.time=a.time||0},start:function(a){a.stepTimer=a.stepTimer+this.time},run:function(a){var b=a.getCombatantRoot();b.isPlayer&&
b.gui.crosshair.active&&b.gui.crosshair.getDir(a.face);return a.stepTimer<=0}});ig.ACTION_STEP.PLAYER_ADJUST_MOVE_DIR=ig.ActionStepBase.extend({_wm:new ig.Config({attributes:{}}),init:function(){},start:function(a){if(a.isPlayer){sc.control.moveDir(e,1);Vec2.isZero(e)||Vec2.assign(a.face,e)}}});ig.ACTION_STEP.PLAYER_MOVE_TO_DIR=ig.ActionStepBase.extend({_wm:new ig.Config({attributes:{time:{_type:"Number",_info:"Duration for which player will move along pressed direction"},rotateSpeed:{_type:"Number",
_info:"Speed in which player will rotate to pressed direction. In rotations per seconds.",_default:0.2,_optional:true},stopBeforeEdge:{_type:"Boolean",_info:"If true: Stop before falling down from edge when further moving forward"},allowStop:{_type:"Boolean",_info:"If true: allow player to stop if no direction is pressed"}}}),init:function(a){this.time=a.time||0;this.rotateSpeed=a.rotateSpeed||0;this.stopBeforeEdge=a.stopBeforeEdge;this.allowStop=a.allowStop},start:function(a){a.stepTimer=a.stepTimer+
this.time},run:function(a){var b=false;if(a.isPlayer){sc.control.moveDir(e,1);Vec2.isZero(e)?this.allowStop&&(b=true):this.rotateSpeed?Vec2.rotateToward(a.face,e,this.rotateSpeed*Math.PI*2*ig.system.tick):Vec2.assign(a.face,e)}b?Vec2.assignC(a.coll.accelDir,0,0):Vec2.assign(a.coll.accelDir,a.face);if(this.stopBeforeEdge&&ig.CollTools.isPostMoveOverHole(a.coll,true)){Vec2.assignC(a.coll.accelDir,0,0);Vec2.assignC(a.coll.vel,0,0)}return a.stepTimer<=0}});sc.PlayerCameraFocusHandle=ig.Class.extend({add:false,
speed:null,init:function(a,b){this.add=a;this.speed=b},onActionEndDetach:function(a){this.add?ig.game.playerEntity.removeCameraTarget(a,this.speed):ig.game.playerEntity.addCameraTarget(a,this.speed)}});ig.ACTION_STEP.ADD_PLAYER_CAMERA_TARGET=ig.ActionStepBase.extend({_wm:new ig.Config({attributes:{speed:{_type:"String",_info:"Speed of camera transition",_select:ig.Camera.SPEED_OPTIONS,_optional:true},actionDetached:{_type:"Boolean",_info:"If true: Do NOT undo change when action is cancelled"},onlyAfterRemove:{_type:"Boolean",
_info:"If true: Only add target if it was previously removed within the action. Use this if the goal is to temporary remove a camera target."}}}),init:function(a){this.speed=a.speed;this.actionDetached=a.actionDetached;this.onlyAfterRemove=a.onlyAfterRemove||false},start:function(a){if(!ig.game.playerEntity.hasCameraTarget(a)){var c=!this.onlyAfterRemove&&!this.actionAttached;if(!this.actionDetached)if(b(a,true))c=true;else if(!this.onlyAfterRemove){var d=new sc.PlayerCameraFocusHandle(true,this.speed);
a.addActionAttached(d)}c&&ig.game.playerEntity.addCameraTarget(a,this.speed)}}});ig.ACTION_STEP.REMOVE_PLAYER_CAMERA_TARGET=ig.ActionStepBase.extend({_wm:new ig.Config({attributes:{speed:{_type:"String",_info:"Speed of camera transition",_select:ig.Camera.SPEED_OPTIONS,_optional:true},actionDetached:{_type:"Boolean",_info:"If true: Do NOT undo change when action is cancelled"}}}),init:function(a){this.speed=a.speed;this.actionDetached=a.actionDetached},start:function(a){if(ig.game.playerEntity.hasCameraTarget(a)){ig.game.playerEntity.removeCameraTarget(a,
this.speed);if(!this.actionDetached&&!b(a,false)){var c=new sc.PlayerCameraFocusHandle(false,this.speed);a.addActionAttached(c)}}}});ig.ACTION_STEP.ADD_PLAYER_SHIELD=ig.ActionStepBase.extend({_wm:new ig.Config({attributes:{perfectGuard:{_type:"Boolean",_info:"If true: add perfect guard"}}}),init:function(a){var b={type:"PLAYER",settings:{baseFactor:1,strength:"REGULAR",hitResist:"HEAVY",stableOverride:"MASSIVE",range:0.5}};this.shield=new sc.COMBAT_SHIELDS[b.type](b.settings);this.perfectGuard=a.perfectGuard||
null},clearCached:function(){this.shield&&this.shield.clearCached()},run:function(a){var b=a.getCombatantRoot(),c=0;this.perfectGuard&&(c=0.1*(1+b.params.getModifier("PERFECT_GUARD_WINDOW")));var d=b.params.getModifier("GUARD_AREA");this.shield.range=d>=1?1:0.5;this.shield.strength=d>=2?sc.SHIELD_STRENGTH.BLOCK_ABOVE:sc.SHIELD_STRENGTH.REGULAR;b=b.addShield(this.shield,c);a.addActionAttached(b);return true}});var f={onActionEndDetach:function(){sc.model.player.endItemConsume(false)}};ig.ACTION_STEP.START_ITEM_CONSUME=
ig.ActionStepBase.extend({item:null,_wm:new ig.Config({attributes:{}}),init:function(){},start:function(a){sc.model.player.startItemConsume();a.addActionAttached(f)}});ig.ACTION_STEP.SHOW_FOOD_ICON=ig.ActionStepBase.extend({icon:null,_wm:new ig.Config({attributes:{icon:{_type:"String",_info:"The icon to display",_select:sc.FOOD_SPRITE},offset:{_type:"Vec2",_info:"Offset position of sprite",_optional:true}}}),init:function(a){this.icon=sc.FOOD_SPRITE[a.icon]||0;this.offset=a.offset||null},start:function(a){a=
ig.game.spawnEntity(sc.FoodIconEntity,0,0,0,{icon:this.icon,combatant:a});this.offset&&a.setState(sc.FOOD_ICON_STATE.HOLD,this.offset)}});ig.ACTION_STEP.CHANGE_FOOD_ICON=ig.ActionStepBase.extend({state:null,_wm:new ig.Config({attributes:{state:{_type:"String",_info:"New state of food icon",_select:sc.FOOD_ICON_STATE},offset:{_type:"Vec2",_info:"Offset position of sprite",_optional:true}}}),init:function(a){this.state=sc.FOOD_ICON_STATE[a.state];this.offset=a.offset||null},start:function(a){for(var a=
a.actionAttached,b=a.length;b--;)a[b]instanceof sc.FoodIconEntity&&a[b].setState(this.state,this.offset)}});ig.ACTION_STEP.CONSUME_ITEM=ig.ActionStepBase.extend({item:null,_wm:new ig.Config({attributes:{item:{_type:"Item",_info:"The item to consume."}}}),init:function(a){this.item=a.item||0},start:function(a){sc.model.player.useItem(this.item);sc.model.player.endItemConsume(true);a.removeActionAttached(f)}});ig.ACTION_STEP.PLAY_PET_SOUND=ig.ActionStepBase.extend({item:null,_wm:new ig.Config({attributes:{}}),
init:function(){},start:function(a){a instanceof sc.PlayerPetEntity&&a.petSkin.petSound&&ig.SoundHelper.playAtEntity(a.petSkin.petSound,a,false)}})});ig.baked=!0;
ig.module("game.feature.player.crosshair-steps").requires("impact.base.animation","impact.base.action","impact.base.entity").defines(function(){var b=null;ig.EVENT_STEP.ACTIVATE_CROSSHAIR=ig.EventStepBase.extend({entity:null,_wm:new ig.Config({attributes:{entity:{_type:"Entity",_info:"Entity to focus camera on"}}}),init:function(a){this.entity=a.entity},start:function(a,c){var e=ig.Event.getEntity(this.entity,c);if(e){b=ig.game.spawnEntity(ig.ENTITY.Crosshair,0,0,0,{thrower:e,controller:new sc.EventCrossHairController});
b.chargeActive=true}}});ig.EVENT_STEP.DEACTIVATE_CROSSHAIR=ig.EventStepBase.extend({_wm:new ig.Config({attributes:{}}),init:function(){},start:function(){b&&b.kill()}});ig.EVENT_STEP.SET_CROSSHAIR_TARGET=ig.EventStepBase.extend({pos:null,_wm:new ig.Config({attributes:{pos:{_type:"Vec2",_info:"Target position for CrossHair",_visualize:true,_pointSelect:true}}}),init:function(a){this.pos=a.pos},start:function(){b.setActive(true);ig.Event.getVec2(this.pos,b.controller.targetPos)}});ig.EVENT_STEP.SET_CROSSHAIR_SPEED=
ig.EventStepBase.extend({value:null,_wm:new ig.Config({attributes:{value:{_type:"Number",_info:"Speed of CrossHair. 1 is default, 0 is pause"}}}),init:function(a){this.value=a.value},start:function(){b.setSpeedFactor(this.value)}});ig.EVENT_STEP.REDUCE_CROSSHAIR_PRECISION=ig.EventStepBase.extend({value:null,_wm:new ig.Config({attributes:{value:{_type:"Number",_info:"Amount to reduce. 0=nothing, 1=maximum"}}}),init:function(a){this.value=a.value},start:function(){b.reducePrecision(this.value)}});var a=
Vec2.create();ig.EVENT_STEP.GET_CROSSHAIR_DIR=ig.EventStepBase.extend({variable:null,_wm:new ig.Config({attributes:{variable:{_type:"VarName",_info:"Variable to contain (random) CrossHair direction."}}}),init:function(a){this.variable=a.variable},start:function(){b.getThrowDir(a);ig.vars.set(this.variable,a)}})});ig.baked=!0;
ig.module("game.feature.player.modifiers").requires("impact.base.game").defines(function(){sc.MODIFIERS={};sc.MODIFIERS.AIM_SPEED={icon:8};sc.MODIFIERS.AIM_STABILITY={icon:32};sc.MODIFIERS.AIMING_MOVEMENT={icon:23};sc.MODIFIERS.KNOCKBACK={icon:11};sc.MODIFIERS.RANGED_DMG={icon:10};sc.MODIFIERS.MELEE_DMG={icon:12};sc.MODIFIERS.CRITICAL_DMG={icon:14};sc.MODIFIERS.BREAK_DMG={icon:43};sc.MODIFIERS.SPIKE_DMG={icon:25};sc.MODIFIERS.ASSAULT={icon:13};sc.MODIFIERS.CROSS_COUNTER={icon:42};sc.MODIFIERS.BERSERK=
{icon:46};sc.MODIFIERS.MOMENTUM={icon:52};sc.MODIFIERS.DASH_INVINC={icon:15};sc.MODIFIERS.DASH_STEP={icon:24,noPercent:true};sc.MODIFIERS.GUARD_STRENGTH={icon:20};sc.MODIFIERS.GUARD_SP={icon:29};sc.MODIFIERS.GUARD_AREA={icon:31,noPercent:true};sc.MODIFIERS.PERFECT_GUARD_WINDOW={icon:27};sc.MODIFIERS.PERFECT_GUARD_RESET={icon:28,noPercent:true};sc.MODIFIERS.STUN_THRESHOLD={icon:16};sc.MODIFIERS.OVERHEAT_REDUCTION={icon:22};sc.MODIFIERS.HP_REGEN={icon:17};sc.MODIFIERS.SP_REGEN={icon:47};sc.MODIFIERS.ITEM_GUARD=
{icon:48,noPercent:true};sc.MODIFIERS.ONCE_MORE={icon:45,noPercent:true};sc.MODIFIERS.XP_PLUS={icon:9};sc.MODIFIERS.DROP_CHANCE={icon:19};sc.MODIFIERS.MONEY_PLUS={icon:26};sc.MODIFIERS.XP_ZERO={icon:18,noPercent:true};sc.MODIFIERS.RANK_PLANTS={icon:30,noPercent:true};sc.MODIFIERS.ITEM_BOOST={icon:21};sc.MODIFIERS.APPETITE={icon:44};sc.MODIFIERS.COND_HEALING={icon:41};sc.MODIFIERS.COND_EFFECT_HEAT={icon:33};sc.MODIFIERS.COND_EFFECT_COLD={icon:34};sc.MODIFIERS.COND_EFFECT_SHOCK={icon:35};sc.MODIFIERS.COND_EFFECT_WAVE=
{icon:36};sc.MODIFIERS.COND_EFFECT_ALL={icon:49};sc.MODIFIERS.COND_GUARD_HEAT={icon:37};sc.MODIFIERS.COND_GUARD_COLD={icon:38};sc.MODIFIERS.COND_GUARD_SHOCK={icon:39};sc.MODIFIERS.COND_GUARD_WAVE={icon:40};sc.MODIFIERS.SPIDER_SLOW_DOWN_GUARD={icon:50,noPercent:true};sc.MODIFIERS.BEGONE_ICE={icon:51,noPercent:true};var b=0,a;for(a in sc.MODIFIERS){sc.MODIFIERS[a].order=b;b++}});ig.baked=!0;
ig.module("game.feature.player.player-skin").requires("impact.base.game","game.feature.player.player-model","game.feature.model.game-model").defines(function(){var b={"holiday-hat":{item:168,autoAdd:false,type:"Appearance",settings:{sheet:"player-skins.xmas",fx:"skins.xmas",gui:"xmas.png"}},"sparkling-boots":{item:101,autoAdd:false,type:"StepEffect",settings:{fx:"skin-step.sparkling-boots"}},"holiday-boots":{item:16,autoAdd:false,type:"StepEffect",settings:{fx:"skin-step.holiday-boots"}},"element-aura":{item:519,
autoAdd:false,type:"Aura",settings:{fx:"skin-aura.element"}},"menacing-aura":{item:520,autoAdd:false,type:"Aura",settings:{fx:"skin-aura.menacing"}},"testing-pet":{item:521,autoAdd:false,type:"Pet",settings:{animSheet:"pets.loops-cat",walkAnims:{idle:"idle",move:"move"},actorConfig:{maxVel:60,jumpingEnabled:false},petSound:{path:"media/sound/misc/pet-cat.ogg",volume:0.7}}},"cat-pet":{item:527,autoAdd:false,type:"Pet",settings:{animSheet:"pets.cat",walkAnims:{idle:"idle",move:"move",run:"run",jump:"jump",
fall:"fall"},petSound:{path:"media/sound/misc/pet-cat.ogg",volume:0.7}}},"penguin-pet":{item:528,autoAdd:false,type:"Pet",settings:{animSheet:"pets.penguin",walkAnims:{idle:"idle",move:"move",run:"run",jump:"jump",fall:"fall"},petSound:{path:"media/sound/misc/pet-penguin.ogg",volume:0.7}}},"fox-pet":{item:529,autoAdd:false,type:"Pet",settings:{animSheet:"pets.fox",walkAnims:{idle:"idle",move:"move",run:"run",jump:"jump",fall:"fall"},petSound:{path:"media/sound/misc/pet-fox.ogg",volume:0.7}}},shiba:{item:534,
autoAdd:false,type:"Pet",settings:{animSheet:"pets.shiba",petOffsets:[{x:0,y:-11},{x:16,y:-2},{x:-16,y:-2},{x:0,y:7}],walkAnims:{idle:"idle",move:"move",run:"run",jump:"jump",fall:"fall"},petSound:{path:"media/sound/misc/pet-dog.ogg",volume:0.7}}},"dino-pet":{item:537,autoAdd:false,type:"Pet",settings:{animSheet:"pets.dino",petOffsets:[{x:0,y:-11},{x:20,y:-2},{x:-20,y:-2},{x:0,y:7}],walkAnims:{idle:"idle",move:"move",run:"run",jump:"jump",fall:"fall"},petSound:{path:"media/sound/misc/pet-rex.ogg",
volume:0.9}}},"reaper-pet":{item:538,autoAdd:false,type:"Pet",settings:{animSheet:"pets.reaper",petOffsets:[{x:0,y:-11},{x:16,y:-2},{x:-16,y:-2},{x:0,y:7}],walkAnims:{idle:"idle",move:"move",run:"run",jump:"jump",fall:"fall"},actorConfig:{floatHeight:4},petSound:{path:"media/sound/misc/pet-reaper.ogg",volume:0.7}}},"dragon-pet":{item:539,autoAdd:false,type:"Pet",settings:{animSheet:"pets.dragon",petOffsets:[{x:0,y:-11},{x:16,y:-2},{x:-16,y:-2},{x:0,y:7}],walkAnims:{idle:"idle",move:"move",run:"run",
jump:"jump",fall:"fall"},actorConfig:{floatHeight:8}}},"crow-bar":{item:549,autoAdd:false,type:"Pet",settings:{animSheet:"pets.crowbar",petOffsets:[{x:0,y:-11},{x:16,y:-2},{x:-16,y:-2},{x:0,y:7}],walkAnims:{idle:"idle",move:"move",run:"run",jump:"jump",fall:"fall"}}},"shy-fly":{item:546,autoAdd:false,type:"Pet",settings:{animSheet:"pets.shyfly",petOffsets:[{x:0,y:-11},{x:16,y:-2},{x:-16,y:-2},{x:0,y:7}],walkAnims:{idle:"idle",move:"move",run:"run",jump:"jump",fall:"fall"},actorConfig:{floatHeight:8},
petSound:{path:"media/sound/misc/pet-shy-fly.ogg",volume:0.7}}},tank:{item:547,autoAdd:false,type:"Pet",settings:{animSheet:"pets.tank",petOffsets:[{x:0,y:-7},{x:16,y:2},{x:-16,y:2},{x:0,y:7}],walkAnims:{idle:"idle",move:"move",run:"run",jump:"jump",fall:"fall"},petSound:{path:"media/sound/misc/pet-tank.ogg",volume:0.7}}},psbot:{item:548,autoAdd:false,type:"Pet",settings:{animSheet:"pets.psbot",petOffsets:[{x:0,y:-11},{x:16,y:-2},{x:-16,y:-2},{x:0,y:7}],walkAnims:{idle:"idle",move:"move",run:"run",
jump:"jump",fall:"fall"},petSound:{path:"media/sound/misc/pet-roball.ogg",volume:0.7}}},bat:{item:552,autoAdd:false,type:"Pet",settings:{animSheet:"pets.bat",petOffsets:[{x:0,y:-11},{x:16,y:-2},{x:-16,y:-2},{x:0,y:7}],walkAnims:{idle:"idle",move:"move",run:"run",jump:"jump",fall:"fall"},actorConfig:{floatHeight:6},petSound:{path:"media/sound/misc/pet-bat.ogg",volume:0.7}}},butterfly:{item:553,autoAdd:false,type:"Pet",settings:{animSheet:"pets.butterfly",walkAnims:{idle:"idle",move:"move"},actorConfig:{floatHeight:8}}},
pig:{item:554,autoAdd:false,type:"Pet",settings:{animSheet:"pets.pig",walkAnims:{idle:"idle",move:"move",run:"run",jump:"jump",fall:"fall"},petSound:{path:"media/sound/misc/pet-pig.ogg",volume:0.7}}},plant:{item:555,autoAdd:false,type:"Pet",settings:{animSheet:"pets.plant",walkAnims:{idle:"idle",move:"move",run:"run",jump:"jump",fall:"fall"},petSound:{path:"media/sound/misc/pet-seedling.ogg",volume:1}}},turtle:{item:556,autoAdd:false,type:"Pet",settings:{animSheet:"pets.turtle",petOffsets:[{x:0,y:-11},
{x:16,y:-2},{x:-16,y:-2},{x:0,y:7}],walkAnims:{idle:"idle",move:"move",run:"run",jump:"jump",fall:"fall"},actorConfig:{maxVel:60}}},bot:{item:557,autoAdd:false,type:"Pet",settings:{animSheet:"pets.bot",petOffsets:[{x:0,y:-11},{x:16,y:-2},{x:-16,y:-2},{x:0,y:7}],walkAnims:{idle:"idle",move:"move",run:"run",jump:"jump",fall:"fall"},actorConfig:{floatHeight:6},petSound:{path:"media/sound/misc/pet-bot.ogg",volume:1}}},"ape-pet":{item:558,autoAdd:false,type:"Pet",settings:{animSheet:"pets.ape",walkAnims:{idle:"idle",
move:"move",run:"run",jump:"jump",fall:"fall"},petSound:{path:"media/sound/misc/pet-manki.ogg",volume:0.7}}},"goose-pet":{item:559,autoAdd:false,type:"Pet",settings:{animSheet:"pets.goose",walkAnims:{idle:"idle",move:"move",run:"run",jump:"jump",fall:"fall"},petSound:{path:"media/sound/misc/goose/pet-goose-01.ogg",volume:0.7}}},"roach-pet":{item:628,autoAdd:false,type:"Pet",settings:{animSheet:"pets.bug",walkAnims:{idle:"idle",move:"move",run:"run",jump:"jump",fall:"fall"},petSound:{path:"media/sound/misc/pet-cockroach.ogg",
volume:0.7}}}};sc.PlayerSkinBase=ig.Class.extend({skinType:null,name:null,init:function(a,b,c){this.skinType=a;this.name=b;a=new ig.LoadCollector(this);this.constructSkin(c);a.finalizeLoadableFetching()},onLoadableComplete:function(){this.loaded=true;sc.playerSkins._notifyLoaded(this)},constructSkin:null});sc.PLAYER_SKIN={};sc.PLAYER_SKIN.Appearance=sc.PlayerSkinBase.extend({animSheet:null,fx:null,guiImage:null,noHide:false,character:null,expressions:null,anims:null,guiImageBounds:null,imgReplace:null,
constructSkin:function(a){this.animSheet=new ig.AnimationSheet(a.sheet);this.fx=new ig.EffectSheet(a.fx);this.guiImage=new ig.Image("media/gui/skins/"+a.gui);this.guiImageBounds=a.guiBounds||null;this.noHide=a.noHide||false;if(a.character)this.character=new sc.Character(a.character);if(a.anims){this.anims={};for(var b in a.anims)this.anims[b]=new ig.AnimationSheet(a.anims[b])}if(a.img)this.imgReplace=a.img},onLoadableComplete:function(){if(!this.character||this.expressions)this.parent();else{var a=
new ig.LoadCollector(this),b=this.character.data.face.expressions;this.expressions={};for(var c in b)this.expressions[c]=new sc.CharacterExpression(this.character.name,c);a.finalizeLoadableFetching()}},clearCached:function(){this.animSheet.decreaseRef();if(this.expressions)for(var a in this.expressions)this.expressions[a].decreaseRef();if(this.anims)for(a in this.anims)this.anims[a].decreaseRef();this.character&&this.character.decreaseRef();this.fx.decreaseRef()},replaceFace:function(a){return!this.character||
!this.expressions||a.character.name!="main.lea"?a:this.expressions[a.expression]||a},replaceAnim:function(a){return!this.anims?a:this.anims[a.path]||a},replaceImg:function(a){return!this.imgReplace?a:this.imgReplace[a]||a}});sc.PLAYER_SKIN.Appearance.toggleSet="skins";sc.PLAYER_SKIN.StepEffect=sc.PlayerSkinBase.extend({fx:null,constructSkin:function(a){this.fx=new ig.EffectSheet(a.fx)},clearCached:function(){this.fx.decreaseRef()}});sc.PLAYER_SKIN.StepEffect.toggleSet="stepEffects";sc.PLAYER_SKIN.Aura=
sc.PlayerSkinBase.extend({fx:null,constructSkin:function(a){this.fx=new ig.EffectSheet(a.fx)},clearCached:function(){this.fx.decreaseRef()}});sc.PLAYER_SKIN.Aura.toggleSet="aura";sc.PLAYER_SKIN.Pet=sc.PlayerSkinBase.extend({animSheet:null,walkAnims:null,petOffsets:null,actorConfig:null,constructSkin:function(a){this.animSheet=new ig.AnimationSheet(a.animSheet);this.walkAnims=a.walkAnims;this.petOffsets=a.petOffsets;this.actorConfig=a.actorConfig||{};if(a.petSound)this.petSound=new ig.Sound(a.petSound.path,
a.petSound.volume,a.petSound.variance)},clearCached:function(){this.animSheet.decreaseRef();this.petSound&&this.petSound.clearCached()}});sc.PLAYER_SKIN.Pet.toggleSet="pet";sc.SKIN_EVENT={SKIN_UPDATE:1};sc.PlayerSkinLibrary=ig.GameAddon.extend({observers:[],skins:{},itemToSkin:{},currentSkins:{},init:function(){this.parent("PlayerSkins");for(var a in b)this.registerSkin(a,b[a]);sc.Model.addObserver(sc.model.player,this);ig.extensions.addListener(this,"skin")},onExtensionLoaded:function(a){this.registerSkin(a.id,
a)},registerSkin:function(a,b){if(this.skins[a])throw Error("Tried to register skin of id '"+a+"' twice.");this.skins[a]={item:b.item,autoAdd:b.autoAdd,type:b.type,settings:b.settings};this.itemToSkin[b.item]=a},updateSkins:function(){for(var a in sc.PLAYER_SKIN)this.updateSkinSet(a)},updateSkinSet:function(a){for(var b=this.currentSkins[a],c=null,e=sc.model.player,f=e.toggleSets[sc.PLAYER_SKIN[a].toggleSet].items,g=f.length;g--;){var h=f[g];if(e.getToggleItemState(h)){c=this.itemToSkin[h];break}}if(!(!c&&
!b||c&&b&&b.name==c)){if(b){b.clearCached();this.currentSkins[a]=null}c&&(this.currentSkins[a]=this._createSkin(c));sc.Model.notifyObserver(this,sc.SKIN_EVENT.SKIN_UPDATE,a)}},getCurrentSkin:function(a){return this.currentSkins[a]},replaceFace:function(a){var b=this.getCurrentSkin("Appearance");return!b?a:b.replaceFace(a)},replaceAnim:function(a){if(!a)return a;var b=this.getCurrentSkin("Appearance");return!b?a:b.replaceAnim(a)},replaceImg:function(a){var b=this.getCurrentSkin("Appearance");return!b?
a:b.replaceImg(a)},_createSkin:function(a){var b=this.skins[a];return!b?null:new sc.PLAYER_SKIN[b.type](b.type,a,b.settings)},_notifyLoaded:function(a){sc.Model.notifyObserver(this,sc.SKIN_EVENT.SKIN_UPDATE,a.skinType)},checkItems:function(){for(var a in sc.PLAYER_SKIN)this.checkItemSet(sc.PLAYER_SKIN[a].toggleSet)},checkItemSet:function(a){for(var b=sc.model.player,a=b.toggleSets[a].items,c=a.length;c--;){var e=a[c],f=this.itemToSkin[e];f?this.skins[f].autoAdd&&!b.getItemAmount(e)&&b.addItem(e,1,
true):b.removeItem(e,b.getItemAmount(e))}},getSkinsByType:function(a){var b=[],c;for(c in this.skins)a==this.skins[c].type&&b.push(c);return b},modelChanged:function(a,b){a==sc.model.player&&(b==sc.PLAYER_MSG.ITEM_TOGGLED||b==sc.PLAYER_MSG.SET_PARAMS||b==sc.PLAYER_MSG.RESET_PLAYER)&&this.updateSkins()},levelLoadedOrder:1E3,onLevelLoaded:function(){this.checkItems()}});ig.addGameAddon(function(){return sc.playerSkins=new sc.PlayerSkinLibrary})});ig.baked=!0;
ig.module("game.feature.player.plug-in").requires("game.feature.player.entities.crosshair","game.feature.player.entities.player","game.feature.player.player-steps","game.feature.player.crosshair-steps","game.feature.player.player-model","game.feature.player.modifiers","game.feature.player.player-skin").defines(function(){window.wm&&wm.postLoadModules.push("game.feature.player.editors.player-editors")});ig.baked=!0;
ig.module("game.feature.puzzle.components.push-pullable").requires("impact.base.entity","game.feature.interact.map-interact").defines(function(){var b=Vec2.create(),a=Vec2.create(),d=Vec3.create(),c={};sc.PUSH_PULL_DIRECTION={ALL:0,LEFT_RIGHT:1,UP_DOWN:2};sc.PushPullSounds={};sc.PushPullSounds.Start=new ig.Sound("media/sound/puzzle/push-start.ogg",1);sc.PushPullSounds.Loop=new ig.Sound("media/sound/puzzle/push-loop.ogg",1);sc.PushPullable=ig.Class.extend({entity:null,active:false,gripDir:null,deferredRelease:false,
interactEntry:null,interactIcons:{vertical:new sc.MapInteractIcon(new ig.TileSheet("media/gui/map-icon.png",24,24),{FOCUS:[40,41,42,41],NEAR:[43],RUNNING:[46,47]},0.2),horizontal:new sc.MapInteractIcon(new ig.TileSheet("media/gui/map-icon.png",24,24),{FOCUS:[40,41,42,41],NEAR:[43],RUNNING:[44,45]},0.2)},coordDelta:Vec2.create(),targetPos:Vec2.create(),dragState:0,dragSpeed:100,speedTimer:0,dustTimer:0,rumbleHandle:null,gripCancelTimer:0,soundHandle:null,navBlocker:null,magnetJustEnded:0,init:function(a){this.entity=
a;this.startPos=Vec3.create(this.entity.coll.pos);this.active=false;this.interactEntry=new sc.MapInteractEntry(a,this,this.interactIcons.horizontal,sc.INTERACT_Z_CONDITION.SAME_Z,false);this.rumbleHandle=new ig.Rumble.RumbleHandle("RANDOM","WEAKEST","FAST",-1,0,null);this.interactEntry.setOffset(0,-8);this.navBlocker=ig.navigation.getNavBlock(this.entity)},setActive:function(a){(this.active=a)?sc.mapInteract.addEntry(this.interactEntry):sc.mapInteract.removeEntry(this.interactEntry)},isActive:function(){return this.active},
onInteraction:function(){if(this.dragState==0){var a=ig.game.playerEntity;a.interactObject=this;this.gripCancelTimer=0;var b=this.getMovePlayerToPushableInteractibleEntityBoxThingeeAndSetGripDir();a.setAction(b,true)}},onInteractionEnd:function(){if(this.gripDir)this.deferredRelease=true},isInteractionBlocked:function(){if(this.gripDir)return false;var a=ig.game.playerEntity,f=this.getGripPosAndFace(d),g=a.getCenter(b),g=Vec2.sub(d,g),h=ig.game.physics.initTraceResult(c);return this.entity.pushPullDirection==
sc.PUSH_PULL_DIRECTION.LEFT_RIGHT&&(f=="NORTH"||f=="SOUTH")||this.entity.pushPullDirection==sc.PUSH_PULL_DIRECTION.UP_DOWN&&(f=="WEST"||f=="EAST")?true:ig.game.traceEntity(h,a,g.x,g.y,0,0,ig.COLLISION.HEIGHT_TOLERATE,ig.COLLTYPE.VIRTUAL)},resetPos:function(a,b){if(this.active&&!this.gripDir){if(a){Vec3.assign(this.startPos,a);this.startPos.x=this.startPos.x-this.entity.coll.size.x/2;this.startPos.y=this.startPos.y-this.entity.coll.size.y/2}if(!Vec3.equal(this.entity.coll.pos,this.startPos)){if(!b){var c=
this.entity.getAlignedPos(ig.ENTITY_ALIGN.BOTTOM,d);ig.game.effects.death.spawnFixed("hole_fall",c.x,c.y,c.z)}this.entity.setPos(this.startPos.x,this.startPos.y,this.startPos.z);Vec3.assignC(this.entity.coll.vel,0,0,0);if(!b){this.entity.animState.alpha=0;ig.game.effects.teleport.spawnOnTarget("showQuick",this.entity)}for(var c=ig.game.getEntitiesOnTop(this.entity),h=c.length;h--;){var i=c[h];if(i.isPlayer)i.quickFall(ig.TERRAIN.HOLE);else{var j=i.coll._collData.groundEntryOffset;i.setPos(this.startPos.x+
j.x,this.startPos.y+j.y,this.startPos.z+this.entity.coll.size.z);i.coll.setGroundEntry(null);if(!b){if(i.animState)i.animState.alpha=0;ig.game.effects.teleport.spawnOnTarget("showQuick",i)}}}}}},onUpdate:function(){if(this.magnetJustEnded){this.magnetJustEnded--;this.magnetJustEnded==0&&this.checkLockIn()}var c=this.entity.coll;if(this.active){var d=0;c.pos.z==c.baseZPos&&!this.magnetJustEnded&&(d=ig.terrain.getTerrain(this.entity.coll,false));(c.pos.z<ig.game.minLevelZ||ig.terrain.isFallTerrain(d))&&
this.resetPos()}var d=ig.game.playerEntity,g=this.dragState;if(this.dragState==2||this.dragState==3||this.dragState==4){var h=Vec2.assign(a,this.targetPos),i=this.entity.coll.pos;Vec2.sub(a,i);var j=this.dragSpeed;this.dustTimer=this.dustTimer+ig.system.tick;if(this.speedTimer<0.3){this.speedTimer=this.speedTimer+ig.system.tick;j=j*(this.speedTimer/0.3).limit(0,1)}j=ig.system.tick*j;if(Vec2.length(h)>j){Vec2.length(h,j);this.entity.setPos(i.x+h.x,i.y+h.y)}else{this.entity.setPos(this.targetPos.x,
this.targetPos.y);this.navBlocker&&this.navBlocker.update();if(this.dragState==4){(h=ig.EntityTools.getGroundEntity(this.entity))&&h.onPushPullablePlaced(this.entity);this.dragState=0}else{this.dragState=this.gripDir?1:0;this.entity.setCurrentAnim("default");this.checkLockIn()}}}if(this.active&&(this.dragState==0||this.dragState==1)){if(!this.gripDir){this.dragState=0;this.stopSound();return}if(d.hasAction()){this.dragState=0;this.gripCancelTimer=this.gripCancelTimer+ig.system.tick;if(this.gripCancelTimer>
0.3){d.cancelAction();this.cancelGrip();this.deferredRelease=false}this.stopSound();return}c=this.entity.coll;if(c.pos.z!=c.baseZPos||d.coll.pos.z-d.coll.baseZPos>ig.COLLISION.HEIGHT_TOLERATE||this.deferredRelease){this.deferredRelease=false;this.dragState=0;this.cancelGrip();this.stopSound();return}if(this.dragState==0){this.dragState=1;Vec2.assign(this.coordDelta,d.coll.pos);Vec2.sub(this.coordDelta,this.entity.coll.pos)}h=a;sc.control.moveDir(h,1);Vec2.assign(b,this.entity.coll.pos);Vec2.add(b,
this.coordDelta);d.setPos(b.x,b.y,this.entity.coll.pos.z);if((this.gripDir=="EAST"||this.gripDir=="WEST")&&h.x)this.moveBox(h.x<0?-4:4,0);else if((this.gripDir=="NORTH"||this.gripDir=="SOUTH")&&h.y)this.moveBox(0,h.y<0?-4:4)}if(this.dragState&&this.gripDir){Vec2.assign(b,this.entity.coll.pos);Vec2.add(b,this.coordDelta);d.setPos(b.x,b.y);d.coll.ignoreCollision=true;c.groundSlip=true;d.animationFixed=true;this.dragState==1?d.setCurrentAnim("gripStand"):this.dragState==2?d.setCurrentAnim("gripPull"):
this.dragState==3&&d.setCurrentAnim("gripPush")}if(this.dragState!=g)this.speedTimer=this.dustTimer=0;(this.dragState==0||this.dragState==1)&&this.stopSound()},checkLockIn:function(){var a=ig.EntityTools.getGroundEntity(this.entity);if(a&&a.onPushPullableDetect&&a.onPushPullableDetect(this.entity,d)){Vec2.assign(this.targetPos,d);this.setActive(false);this.gripDir&&this.cancelGrip();this.dragState=4}},onKill:function(){this.navBlocker&&this.navBlocker.remove()},onDeferredUpdate:function(){var a=ig.game.playerEntity;
this.dragState&&this.gripDir&&a.setPos(void 0,void 0,this.entity.coll.pos.z)},updateStateFromIdle:function(){},stopSound:function(){if(this.soundHandle){this.soundHandle.stop();this.soundHandle=null}},cancelGrip:function(){var a=ig.game.playerEntity;a.coll.ignoreCollision=false;a.coll.pos.z-a.coll.baseZPos<=1&&a.setPos(void 0,void 0,a.coll.baseZPos);a.animationFixed=false;this.entity.coll.groundSlip=false;a.cancelInteract();this.gripDir=null;sc.party.keepDistance=false},onInteractObjectDrop:function(){this.cancelGrip()},
getGripPosAndFace:function(a){var c=ig.game.playerEntity;this.entity.getAlignedPos(ig.ENTITY_ALIGN.BOTTOM,a);var d=c.getCenter(b),d=Vec2.sub(d,a);if(Math.abs(d.x)>Math.abs(d.y)){c=this.entity.coll.size.x/2+c.coll.size.x/2;if(d.x<0){a.x=a.x-c;a="EAST"}else{a.x=a.x+c;a="WEST"}}else{c=this.entity.coll.size.y/2+c.coll.size.y/2;if(d.y<0){a.y=a.y-c;a="SOUTH"}else{a.y=a.y+c;a="NORTH"}}return a},getMovePlayerToPushableInteractibleEntityBoxThingeeAndSetGripDir:function(){var a=Vec3.create(),b=this.getGripPosAndFace(a);
b=="WEST"||b=="EAST"?this.interactEntry.setIcon(this.interactIcons.horizontal):this.interactEntry.setIcon(this.interactIcons.vertical);this.gripDir=b;sc.party.keepDistance=true;this.dustTimer=this.speedTimer=0;return new ig.Action("gripStart",[{type:"MOVE_TO_POINT",target:a,precise:false},{type:"SET_FACE",face:b},{type:"SHOW_ANIMATION",anim:"gripStand"},{type:"ALIGN_PUSH_PULL_POS",component:this,duration:0.05}])},moveBox:function(a,b){var d=ig.game.playerEntity,h;a?h=this.gripDir=="EAST"&&a<0||this.gripDir==
"WEST"&&a>0:b&&(h=this.gripDir=="NORTH"&&b>0||this.gripDir=="SOUTH"&&b<0);var i=ig.game.physics.initTraceResult(c);if(!ig.game.traceEntity(i,this.entity,a,b,0,0,1,ig.COLLTYPE.BLOCK,null,d)&&(!h||!ig.game.traceEntity(i,d,a,b,0,0,ig.COLLISION.HEIGHT_TOLERATE,ig.COLLTYPE.BLOCK,null,d))){if(!this.soundHandle)this.soundHandle=sc.PushPullSounds.Loop.play(true);this.entity.setCurrentAnim(a?"moveH":"moveV");if(this.dustTimer>=0.13){this.dustTimer=this.dustTimer-0.13;var j;a?j=a>0?"boxMediumEast":"boxMediumWest":
b&&(j=b>0?"boxMediumSouth":"boxMediumNorth");ig.game.effects.dust.spawnOnTarget(j,this.entity)}this.dragState=h?2:3;Vec2.assign(this.targetPos,this.entity.coll.pos);Vec2.addC(this.targetPos,a,b);this.targetPos.x=Math.round(this.targetPos.x/4)*4;this.targetPos.y=Math.round(this.targetPos.y/4)*4}},onMagnetEnd:function(){this.magnetJustEnded=2;if(this.entity.coll._collData)this.entity.coll._collData.zBaseUncertain=true;this.entity.coll.setType(ig.COLLTYPE.BLOCK);this.setActive(true);this.checkLockIn()}})});
ig.baked=!0;
ig.module("game.feature.puzzle.entities.block").requires("impact.base.entity").defines(function(){ig.ENTITY.Block=ig.AnimatedEntity.extend({tileSheet:new ig.TileSheet("media/entity/objects/block.png",32,32),timer:0,style:0,_wm:new ig.Config({spawnable:true,attributes:{style:Number}}),init:function(b,a,d,c){this.parent(b,a,d,c);this.coll.type=ig.COLLTYPE.BLOCK;this.coll.setSize(16,16,16);if(c.style)this.style=c.style;this.initAnimations({sheet:this.tileSheet,SUB:[{name:"normal",time:1,frames:[0]},
{name:"touched",time:1,frames:[1]}]})},update:function(){this.timer=this.timer-ig.system.tick;this.timer<=0&&this.setCurrentAnim("normal");this.parent()},collideWith:function(){this.setCurrentAnim("touched");this.timer=0.2}})});ig.baked=!0;
ig.module("game.feature.puzzle.entities.blockers").requires("impact.base.entity","impact.feature.effect.effect-sheet").defines(function(){sc.BLOCKER_TYPE={};ig.ENTITY.Blocker=ig.AnimatedEntity.extend({active:false,maxHeight:0,minHeight:0,variable:null,_wm:new ig.Config({spawnable:true,attributes:{blockerType:{_type:"String",_info:"Type of blocking object",_select:sc.BLOCKER_TYPE,_withNull:true},condition:{_type:"VarCondition",_info:"Condition for blocker to be active",_popup:true}}}),init:function(b,
a,d,c){this.parent(b,a,d,c);this.coll.type=ig.COLLTYPE.BLOCK;this.condition=new ig.VarCondition(c.condition);this.active=this.condition.evaluate();if(b=sc.BLOCKER_TYPE[c.blockerType]){this.setSize(b.size.x,b.size.y,b.size.z);this.coll.shape=b.collShape;this.minHeight=b.minHeight;this.maxHeight=this.coll.size.z;a=ig.mapStyle.get("puzzle");b.anims.sheet.src=a.sheet;this.initAnimations(b.anims);if(this.active){this.setCurrentAnim("on");this.setSize(this.coll.size.x,this.coll.size.y,this.maxHeight)}else{this.setCurrentAnim("off");
this.setSize(this.coll.size.x,this.coll.size.y,this.minHeight)}}else this.coll.setSize(32,32,0)},update:function(){this.parent()},varsChanged:function(){var b=this.condition.evaluate();if(this.active!=b)if(this.active=b){this.setSize(this.coll.size.x,this.coll.size.y,this.maxHeight);this.setCurrentAnim("goOn",true,"on")}else this.setCurrentAnim("goOff",true,"off",false,true)},animationEnded:function(){this.setSize(this.coll.size.x,this.coll.size.y,this.minHeight)}});sc.BLOCKER_TYPE.diagonalNW={size:{x:32,
y:32,z:24},collShape:ig.COLLSHAPE.SLOPE_NW,minHeight:2,anims:{sheet:{src:null,width:32,height:64,offY:128},SUB:[{name:"off",time:0.1,frames:[0],repeat:false},{name:"on",time:0.02,frames:[5,6],repeat:true},{name:"goOn",time:0.05,frames:[1,2,3,4],repeat:false},{name:"goOff",time:0.05,frames:[4,3,2,1],repeat:false}]}};sc.BLOCKER_TYPE.diagonalNE={size:{x:32,y:32,z:24},collShape:ig.COLLSHAPE.SLOPE_NE,minHeight:2,anims:{sheet:{src:null,width:32,height:64,offY:128},flipX:true,SUB:[{name:"off",time:0.1,frames:[0],
repeat:false},{name:"on",time:0.02,frames:[5,6],repeat:true},{name:"goOn",time:0.05,frames:[1,2,3,4],repeat:false},{name:"goOff",time:0.05,frames:[4,3,2,1],repeat:false}]}};sc.BLOCKER_TYPE.diagonalSE={size:{x:32,y:32,z:24},collShape:ig.COLLSHAPE.SLOPE_SE,minHeight:2,anims:{sheet:{src:null,width:32,height:64,offY:192},flipX:true,wallY:1,SUB:[{name:"off",time:0.1,frames:[0],repeat:false},{name:"on",time:0.02,frames:[5,6],repeat:true},{name:"goOn",time:0.05,frames:[1,2,3,4],repeat:false},{name:"goOff",
time:0.05,frames:[4,3,2,1],repeat:false}]}};sc.BLOCKER_TYPE.diagonalSW={size:{x:32,y:32,z:24},collShape:ig.COLLSHAPE.SLOPE_SW,minHeight:2,anims:{sheet:{src:"media/entity/objects/blockers.png",width:32,height:64,offY:192},wallY:1,SUB:[{name:"off",time:0.1,frames:[0],repeat:false},{name:"on",time:0.02,frames:[5,6],repeat:true},{name:"goOn",time:0.05,frames:[1,2,3,4],repeat:false},{name:"goOff",time:0.05,frames:[4,3,2,1],repeat:false}]}}});ig.baked=!0;
ig.module("game.feature.puzzle.entities.bomb").requires("impact.base.entity","impact.feature.effect.effect-sheet").defines(function(){var b=Vec2.create();Vec3.create();ig.ENTITY.BombPanel=ig.AnimatedEntity.extend({respawnTimer:0,bomb:null,_wm:new ig.Config({spawnable:true,attributes:{spawnCondition:{_type:"VarCondition",_info:"Condition for Enemy to spawn",_popup:true},noHeatFocus:{_type:"Boolean",_info:"No camera-follow with heat"}}}),effects:{bomb:new ig.EffectSheet("puzzle.bomb")},init:function(a,
b,c,e){this.parent(a,b,c,e);this.noHeatFocus=e.noHeatFocus;this.coll.type=ig.COLLTYPE.BLOCK;this.coll.setSize(24,24,1);this.coll.zGravityFactor=1;a=ig.mapStyle.get("puzzle2");this.initAnimations({sheet:{src:a.sheet,width:24,height:24,xCount:2,offX:0,offY:88},SUB:[{name:"on",time:1,frames:[1],repeat:false},{name:"off",time:1,frames:[0],repeat:false},{name:"blink",time:0.04,frames:[0],repeat:false},{name:"blink",time:0.04,frames:[1,1,1,1,1,1,1,1],framesAlpha:[0,0.2,0.5,0.8,1,0.8,0.5,0.2],repeat:true}]});
this.setCurrentAnim("on")},show:function(a){this.parent(a);if(this.effects.hideHandle){this.effects.hideHandle.stop();this.effects.hideHandle=null}if(!a){this.animState.alpha=0;ig.game.effects.teleport.spawnOnTarget("showDefault",this,{})}this.spawnBomb(a)},onHideRequest:function(){if(this.bomb){this.bomb.destroy();this.bomb=null}this.respawnTimer=0;this.effects.hideHandle=ig.game.effects.teleport.spawnOnTarget("hideDefault",this,{align:ig.ENTITY_ALIGN.CENTER,callback:this})},onEffectEvent:function(a){if(a.isDone()){this.effects.hideHandle=
null;this.hide()}},update:function(){if(this.respawnTimer){this.respawnTimer=this.respawnTimer-ig.system.tick;this.respawnTimer<=0&&this.spawnBomb()}this.parent()},spawnBomb:function(a){this.respawnTimer=0;this.setCurrentAnim("on");var d=this.getCenter(b);this.bomb=ig.game.spawnEntity(sc.BombEntity,d.x,d.y,this.coll.pos.z+this.coll.size.z,{panel:this});this.bomb.noHeatFocus=this.noHeatFocus;a||this.effects.bomb.spawnOnTarget("appear",this.bomb,{})},hasBomb:function(){return!!this.bomb},onBombStart:function(){this.bomb=
null;this.setCurrentAnim("off")},onBombExplode:function(){this.setCurrentAnim("blink");this.respawnTimer=1.5}});sc.BombEntity=ig.AnimatedEntity.extend({panel:null,timer:0,combatant:null,heatMode:false,effects:{bomb:new ig.EffectSheet("puzzle.bomb")},cameraHandle:null,noHeatFocus:false,init:function(a,b,c,e){this.parent(a,b,c,e);this.coll.type=ig.COLLTYPE.VIRTUAL;this.coll.zGravityFactor=1;this.coll.zBounciness=0.5;this.coll.setSize(20,20,16);this.coll.friction.air=0.06;this.coll.shadow.size=20;this.coll.edgeSlipInward=
true;this.coll.setPos(a-this.coll.size.x/2,b-this.coll.size.y/2,c);this.panel=e.panel||null;a=ig.mapStyle.get("puzzle2");this.initAnimations({shapeType:"Y_FLAT",offset:{x:0,y:-3,z:0},sheet:{src:a.sheet,width:24,height:24,xCount:5,offX:0,offY:64},SUB:[{name:"off",time:1,frames:[0],repeat:false},{name:"ticking",time:0.1,frames:[2,1,0,1],repeat:true},{name:"ticking",time:1,frames:[3],repeat:false},{name:"ticking",time:1,frames:[4],repeat:false},{name:"tickingEnd",time:0.03,frames:[0,0,2,2],repeat:true},
{name:"tickingEnd",time:0.03,frames:[3,3,3,3],framesAlpha:[0,0,1,1],repeat:true},{name:"tickingEnd",time:0.03,frames:[4,4,4,4],framesAlpha:[0,0,1,1],repeat:true}]});this.setCurrentAnim("off")},destroy:function(){this.effects.hideHandle=ig.game.effects.teleport.spawnOnTarget("hideDefault",this,{align:ig.ENTITY_ALIGN.CENTER,callback:this})},onEffectEvent:function(a){if(a.isDone()){this.effects.hideHandle=null;this.kill()}},start:function(a,b,c,e){if(!this.timer){this.setCurrentAnim("ticking");this.timer=
3/sc.options.get("assist-puzzle-speed");this.panel&&this.panel.onBombStart();Vec2.assign(this.coll.vel,a);Vec2.length(this.coll.vel,c||180);this.coll.vel.z=e||200;this.combatant=b;this.fxHandle=this.effects.bomb.spawnOnTarget("active",this,{duration:-1})}},setLastSecond:function(){this.timer=0.75;this.setCurrentAnim("tickingEnd");if(this.sprites.length>1){this.sprites[1].setGfxCut(0,0);this.sprites[2].setGfxCut(0,0)}this.fxHandle&&this.fxHandle.stop();this.fxHandle=this.effects.bomb.spawnOnTarget("almost",
this,{duration:-1})},explode:function(){if(!this._killed){var a=this.getAlignedPos(ig.ENTITY_ALIGN.CENTER,Vec3.create());this.effects.bomb.spawnFixed("explosion",a.x,a.y,a.z);a.z=a.z-24;this.panel&&this.panel.onBombExplode();if(this.combatant){a=new sc.CircleHitForce(this.combatant,{attack:{type:"MASSIVE",element:"HEAT",damageFactor:2,spFactor:0,hints:["BOMB"],noHack:true},pos:a,radius:8,zHeight:40,duration:0.1,expandRadius:40,alwaysFull:true,party:"OTHER"});sc.combat.addCombatForce(a)}this.cameraHandle&&
ig.camera.removeTarget(this.cameraHandle,"SLOW",KEY_SPLINES.EASE_IN_OUT);this.kill()}},enterHeatMode:function(a,b){if(!this._killed&&!this.heatMode){this.heatMode=true;var c=this.coll;this.coll.edgeSlipInward=false;Vec2.assign(c.accelDir,a);c.maxVel=400;c.weight=2E3;Vec2.assign(c.vel,a);Vec2.length(c.vel,400);this.timer=2;this.combatant=b;this.fxHandle&&this.fxHandle.stop();if(!this.noHeatFocus){this.cameraHandle=new ig.Camera.TargetHandle(new ig.Camera.MultiEntityTarget([this,ig.game.playerEntity]),
0,0);ig.camera.pushTarget(this.cameraHandle,"FAST",KEY_SPLINES.EASE_IN_OUT)}this.effects.bomb.spawnOnTarget("bombHeatTrail",this,{duration:-1,angle:Vec2.clockangle(a),offset:{z:6}})}},update:function(){this.coll.pos.z<ig.game.minLevelZ&&this.explode();if(this.heatMode){(this.coll.totalBlockTimer>0||this.coll.partlyBlockTimer>0)&&this.explode();this.timer=this.timer-ig.system.tick;this.timer<=0&&this.explode()}else if(this.timer>0){this.timer=this.timer-ig.system.tick;this.timer<=0&&this.explode();
this.currentAnim=="ticking"&&this.timer<=0.75&&this.setLastSecond()}if(this.currentAnim=="ticking"&&this.sprites.length>1){var a=this.sprites[1],b=this.sprites[2],c=a.size.y+a.size.z,e=(this.timer-0.75)/(3/sc.options.get("assist-puzzle-speed")-0.75-1.5),e=e.limit(0,1),e=Math.ceil(8*(1-e));a.setGfxCut(c-1-e,1);b.setGfxCut(c-7-e,7)}a=this.coll;a.friction.terrain=ig.terrain.getTerrain(a,true)==ig.TERRAIN.ICE?0.02:1;this.parent()},absorbFerro:function(){this.cameraHandle&&ig.camera.removeTarget(this.cameraHandle,
"SLOW",KEY_SPLINES.EASE_IN_OUT);this.kill()},ballHit:function(a){if(this.heatMode)return false;var d=a.getHitCenter(this),c=a.getHitVel(this,b),e=a.isBall&&!a.attackInfo.hasHint("CHARGED")&&a.attackInfo.element==sc.ELEMENT.HEAT;if(!a.attackInfo.hasHint("DEEP_FLAME")&&a.isBall&&!a.attackInfo.hasHint("CHARGED")&&(!this.timer||!e)){sc.combat.showHitEffect(this,d,sc.ATTACK_TYPE.NONE,a.getElement(),true,false,true);return true}sc.combat.showHitEffect(this,d,sc.ATTACK_TYPE.MEDIUM,a.getElement(),false,false,
true);if(a.attackInfo.hasHint("DEEP_FLAME")){d=a.getCombatantRoot();d.target&&ig.CollTools.getDistVec2(this.coll,d.target.coll,c);this.enterHeatMode(c,a.getCombatantRoot())}else!e&&a.attackInfo.element==sc.ELEMENT.HEAT?this.enterHeatMode(c,a.getCombatantRoot()):this.timer?this.explode():this.start(c,a.getCombatantRoot());return true},onTouchGround:function(a){if(this.coll.pos.z>=-1&&!this.coll.ignoreCollision){var b=this.getCenter();a<-50&&ig.game.effects.dust.spawnFixed("medium",b.x,b.y,this.coll.pos.z);
if((a=ig.EntityTools.getGroundEntity(this))&&a.bombSnap)this.coll.vel.z=0}},isBallAdjust:function(){return true},doBallAdjust:function(a,b,c){this.getCenter(a);Vec3.assign(c,this.coll.size);return 0},isBallDestroyer:function(a,b,c){return this.heatMode||!c||this.timer&&!sc.model.player.currentElementMode==sc.ELEMENT.HEAT?true:false}});sc.COMBAT_POI.BOMB_PANEL={_wm:{attributes:{ready:{_type:"Boolean",_info:"If true: Bomb panel has to include a bomb "}}},filterEntities:function(a,b,c){for(var c=c.ready,
e=b.length;e--;){var f=b[e];f instanceof ig.ENTITY.BombPanel&&(!c||f.hasBomb())&&a.push(f)}return a}}});ig.baked=!0;
ig.module("game.feature.puzzle.entities.water-bubble").requires("impact.base.entity","impact.feature.effect.effect-sheet").defines(function(){var b=Vec2.create();Vec3.create();ig.ENTITY.WaterBubblePanel=ig.AnimatedEntity.extend({respawnTimer:0,currentBubble:null,active:false,_wm:new ig.Config({spawnable:true,attributes:{spawnCondition:{_type:"VarCondition",_info:"Condition for Enemy to spawn",_popup:true},coalCoolTime:{_type:"Number",_info:"Time coal will be cooled by ice disks created from these bubbles",
_optional:true}}}),effects:{sheet:new ig.EffectSheet("puzzle.water-bubble")},init:function(a,b,c,e){this.parent(a,b,c,e);this.coll.type=ig.COLLTYPE.NONE;this.coll.setSize(24,24,0);this.coll.zGravityFactor=1E3;a=ig.mapStyle.get("puzzle2");this.initAnimations({sheet:{src:a.sheet,width:24,height:24,xCount:2,offX:0,offY:112},SUB:[{name:"on",time:1,frames:[1],repeat:false},{name:"off",time:1,frames:[0],repeat:false},{name:"blink",time:0.04,frames:[0],repeat:false},{name:"blink",time:0.02,frames:[1,1,1,
1,1,1,1,1],framesAlpha:[0,0.2,0.5,0.8,1,0.8,0.5,0.2],repeat:true}]});this.coalCoolTime=e.coalCoolTime;this.setCurrentAnim("on")},show:function(a){this.parent(a);if(!a){this.animState.alpha=0;ig.game.effects.teleport.spawnOnTarget("showDefault",this,{})}this.coll.zGravityFactor=1E3;this.active=true;this.spawnBubble(a)},onHideRequest:function(){this.active=false;this.coll.zGravityFactor=0;this.coll.vel.z=0;if(this.currentBubble){this.currentBubble.panel=null;this.currentBubble.isIdle()&&this.currentBubble.burst()}ig.game.effects.teleport.spawnOnTarget("hideDefault",
this,{callback:this})},onEffectEvent:function(a){a.isDone()&&this.hide()},update:function(){if(this.respawnTimer){this.respawnTimer=this.respawnTimer-ig.system.tick;this.respawnTimer<=0&&this.spawnBubble()}this.parent()},spawnBubble:function(a){if(this.active){this.respawnTimer=0;this.setCurrentAnim("on");var d=this.getCenter(b),d=ig.game.spawnEntity(sc.WaterBubbleEntity,d.x,d.y,this.coll.pos.z+8,{panel:this,coalCoolTime:this.coalCoolTime});if(!a){this.effects.sheet.spawnOnTarget("appear",d,{});d.noSteamFrames=
2}this.currentBubble=d}},onBubbleStart:function(){this.setCurrentAnim("off")},onBubbleBurst:function(){this.currentBubble=null;this.setCurrentAnim("blink");this.respawnTimer=1.5}});Vec2.create();sc.WaterBubbleEntity=ig.AnimatedEntity.extend({panel:null,state:1,timer:0,startZ:0,combatant:null,heatMode:false,effects:{sheet:new ig.EffectSheet("puzzle.water-bubble"),handle:null,hitHandle:null},cameraHandle:null,noHeatFocus:false,target:null,init:function(a,b,c,e){this.parent(a,b,c,e);this.coll.type=ig.COLLTYPE.VIRTUAL;
this.coll.zGravityFactor=1;this.coll.zBounciness=0.5;this.coll.bounciness=0.5;this.coll.setSize(20,20,16);this.coll.friction.air=0.2;this.coll.maxVel=125;this.coll.float.height=8;this.startZ=c;this.coll.float.variance=2;this.coll.shadow.size=16;this.coll.setPos(a-this.coll.size.x/2,b-this.coll.size.y/2,c);this.panel=e.panel||null;this.coalCoolTime=e.coalCoolTime;this.initAnimations({shapeType:"Y_FLAT",offset:{x:0,y:-3,z:0},sheet:{src:"media/entity/objects/object-effects.png",width:24,height:24,xCount:4,
offX:128,offY:16},SUB:[{name:"idle",time:0.1,frames:[0,1,2,3],repeat:true}]});this.setCurrentAnim("idle");if(e.target){this.coll.bounciness=1;this.followTarget(e.target,e.targetTime)}if(e.combatant)this.combatant=e.combatant},absorbFerro:function(){this.panel&&this.panel.onBubbleStart();this.cameraHandle&&ig.camera.removeTarget(this.cameraHandle,"SLOW",KEY_SPLINES.EASE_IN_OUT);this.kill()},isIdle:function(){return this.state==1},followTarget:function(a,b){this.target=a;this.state=2;this.timer=b;ig.CollTools.getDistVec2(this.coll,
this.target.coll,this.coll.accelDir);Vec2.assign(this.coll.vel,this.coll.accelDir);Vec2.length(this.coll.vel,this.coll.maxVel);this.coll.setType(ig.COLLTYPE.IGNORE);this.effects.sheet.spawnOnTarget("selfExplode",this,{duration:-1})},bounce:function(a,b){if(this.state==1)this.state=3;if(this.coll.baseZPos>this.startZ)this.startZ=this.coll.baseZPos+8;Vec2.assign(this.coll.vel,a);Vec2.length(this.coll.vel,b||180);if(!this.timer){this.timer=10/sc.options.get("assist-puzzle-speed");this.panel&&this.panel.onBubbleStart()}if(this.effects.hitHandle){this.effects.hitHandle.setCallback(null);
this.effects.hitHandle.stop()}this.effects.hitHandle=this.effects.sheet.spawnOnTarget("hit",this,{callback:this})},setLastSecond:function(){this.state=4;this.effects.handle=this.effects.sheet.spawnOnTarget("almostBurst",this,{duration:-1})},instantKill:function(){if(!(this._killed||this.state==5)){this.state=5;this.panel&&this.panel.onBubbleBurst();this.kill()}},burst:function(){if(!(this._killed||this.state==5)){this.state=5;if(this.effects.handle){this.effects.handle.stop();this.effects.handle=
null}this.effects.sheet.spawnOnTarget("burst",this,{callback:this,align:"CENTER"});this.panel&&this.panel.onBubbleBurst()}},onEffectEvent:function(a){if(!this._killed&&a.state==ig.EFFECT_STATE.ENDED)a==this.effects.hitHandle?this.effects.hitHandle=null:this.kill()},steam:function(a,b){if(!this._killed){var c=this.getAlignedPos(ig.ENTITY_ALIGN.BOTTOM,Vec3.create());this.effects.sheet.spawnFixed("steamExplosion",c.x,c.y,c.z,null,{angle:Vec2.clockangle(a)});c.z=c.z-8;this.panel&&this.panel.onBubbleBurst();
if(b){c=new sc.CircleHitForce(b,{attack:{type:"MASSIVE",element:"HEAT",damageFactor:1,spFactor:0,hints:["STEAM"],noHack:true},pos:c,radius:8,zHeight:16,duration:0.2,expandRadius:60,alwaysFull:true,party:"OTHER",centralAngle:0.3,dir:ig.copy(a)});sc.combat.addCombatForce(c)}this.cameraHandle&&ig.camera.removeTarget(this.cameraHandle,"SLOW",KEY_SPLINES.EASE_IN_OUT);this.kill()}},circularSteam:function(a){if(!this._killed){var b=this.getAlignedPos(ig.ENTITY_ALIGN.BOTTOM,Vec3.create());this.effects.sheet.spawnFixed("steamExplosion2",
b.x,b.y,b.z,null,{});b.z=b.z-8;this.panel&&this.panel.onBubbleBurst();if(a=a||this.combatant){b=new sc.CircleHitForce(a,{attack:{type:"MASSIVE",element:"HEAT",damageFactor:1,spFactor:0,hints:["STEAM"],noHack:true},pos:b,radius:8,zHeight:16,duration:0.2,expandRadius:32,alwaysFull:true,party:"OTHER",centralAngle:1});sc.combat.addCombatForce(b)}this.cameraHandle&&ig.camera.removeTarget(this.cameraHandle,"SLOW",KEY_SPLINES.EASE_IN_OUT);this.kill()}},turnIce:function(){if(!this._killed){this.panel&&this.panel.onBubbleStart();
var a=this.getCenter(b);ig.game.spawnEntity(sc.IceDiskEntity,a.x,a.y,this.coll.pos.z+8,{panel:this.panel,coalCoolTime:this.coalCoolTime});this.kill()}},update:function(){this.noSteamFrames&&this.noSteamFrames--;if(this.target){ig.CollTools.getDistVec2(this.coll,this.target.coll,b);Vec2.rotateToward(this.coll.accelDir,b,Math.PI*0.5*ig.system.tick);this.coll.float.height=Math.max(8,this.target.coll.pos.z+12-this.coll.baseZPos);Vec2.length(b)<48&&this.circularSteam()}else if(this.state!=1)this.coll.float.height=
Math.max(8,this.startZ-this.coll.baseZPos);else if(this.panel)this.startZ=this.panel.coll.pos.z+8;if(this.state!=5&&this.timer>0){this.timer=this.timer-ig.system.tick;this.timer<=0&&(this.target?this.circularSteam():this.burst());this.state==3&&this.timer<=3&&this.setLastSecond()}this.parent()},ballHit:function(a){var d=a.getElement();if(d!=sc.ELEMENT.HEAT&&a.party!=sc.COMBATANT_PARTY.PLAYER||this.state==5)return false;var c=a.getHitCenter(this),e=a.getHitVel(this,b);d==sc.ELEMENT.HEAT?this.noSteamFrames?
this.instantKill():a.attackInfo&&a.attackInfo.hasHint("STEAM")?this.circularSteam(a.getCombatantRoot()):this.steam(e,a.getCombatantRoot()):d==sc.ELEMENT.COLD?this.turnIce(e):this.bounce(e,120);d=sc.ATTACK_TYPE.LIGHT;if(!a.isBall||a.attackInfo.hasHint("CHARGED"))d=sc.ATTACK_TYPE.MEDIUM;sc.combat.showHitEffect(this,c,d,a.getElement(),false,false,true);return true},isWaterBubble:function(){return true},isBallAdjust:function(){return true},doBallAdjust:function(a,b,c){this.getCenter(a);Vec3.assign(c,
this.coll.size);return 0},isBallDestroyer:function(){return sc.model.player.currentElementMode==sc.ELEMENT.HEAT?true:false}})});ig.baked=!0;
ig.module("game.feature.puzzle.entities.compressor").requires("impact.base.entity","impact.base.actor-entity","impact.feature.effect.effect-sheet").defines(function(){var b=Vec2.create(),a=Vec2.create(),d=Vec2.create(),c=Vec2.create(),e=Vec2.create(),f=Vec3.create(),g=[0,3,6,10],h={3:"Shock",4:"Wave"};ig.ENTITY.Compressor=ig.AnimatedEntity.extend({chargeState:0,dischargeTimer:0,currentElement:0,compressorBall:null,ballHeight:0,_wm:new ig.Config({spawnable:true,attributes:{spawnCondition:{_type:"VarCondition",
_info:"Condition for Enemy to spawn",_popup:true},followCamera:{_type:"Boolean",_info:"If true follow compressor ball with camera"},ballSpeed:{_type:"Number",_info:"Additional factor to slow down ball speed when going along or through walls",_optional:true},fastMode:{_type:"Boolean",_info:"Make sure puzzle element is not slowed down by assist mode"}}}),effects:{sheet:new ig.EffectSheet("puzzle.compressor"),hideHandle:null},sounds:{charge:new ig.Sound("media/sound/puzzle/wave-charge.ogg",0.5,0)},init:function(a,
b,c,d){this.parent(a,b,c,d);this.coll.type=ig.COLLTYPE.VIRTUAL;this.coll.setSize(16,16,24);this.coll.zGravityFactor=1E3;this.followCamera=d.followCamera||false;this.ballSpeed=d.ballSpeed||1;this.fastMode=d.fastMode||false;a=ig.mapStyle.get("puzzle2");this.initAnimations({shapeType:"Z_FLAT",wallY:1,SUB:[{sheet:{src:a.sheet,width:16,height:16,xCount:3,offX:208,offY:176},SUB:[{name:"off",time:1,frames:[0],repeat:false},{name:"shock",time:1,frames:[1],repeat:false},{name:"wave",time:1,frames:[2],repeat:false}]},
{offset:{x:0,y:0,z:6},sheet:{src:a.sheet,width:16,height:16,xCount:3,offX:208,offY:160},SUB:[{name:"off",time:1,frames:[0],repeat:false},{name:"shock",time:0.05,frames:[1,0,1,0,1,0,1,0],repeat:false},{name:"wave",time:0.05,frames:[2,0,2,0,2,0,2,0],repeat:false}]}]});this.setCurrentAnim("off");o=0},show:function(a){this.parent(a);if(this.effects.hideHandle){this.effects.hideHandle.stop();this.effects.hideHandle=null}if(!a){this.animState.alpha=0;ig.game.effects.teleport.spawnOnTarget("showFast",this,
{})}},onHideRequest:function(){this.resetCharge();this.effects.hideHandle=ig.game.effects.teleport.spawnOnTarget("hideFast",this,{callback:this})},onEffectEvent:function(a){if(a==this.effects.hideHandle&&a.isDone()){this.effects.hideHandle=null;this.hide()}},createCompressorBall:function(){var a=this.getCenter();if(this.currentElement==sc.ELEMENT.SHOCK)this.compressorBall=ig.game.spawnEntity(sc.CompressedShockEntity,a.x,a.y,this.coll.pos.z+12,{speed:this.ballSpeed,fastMode:this.fastMode});else if(this.currentElement==
sc.ELEMENT.WAVE)this.compressorBall=ig.game.spawnEntity(sc.CompressedWaveEntity,a.x,a.y,this.coll.pos.z+12,{speed:this.ballSpeed,fastMode:this.fastMode})},update:function(){if(this.chargeState){this.dischargeTimer=this.dischargeTimer-ig.system.tick;if(this.dischargeTimer<=0){this.compressorBall&&this.compressorBall.destroy();this.compressorBall=null;this.chargeState--;if(this.chargeState)this.dischargeTimer=0.4;else{this.currentElement=0;this.setCurrentAnim("off")}}}var a=g[this.chargeState]||0;if(this.ballHeight>
a){this.ballHeight=this.ballHeight-ig.system.tick*(this.ballHeight-a>3?40:7.5);if(this.ballHeight<a)this.ballHeight=a}else if(this.ballHeight<a){this.ballHeight=this.ballHeight+ig.system.tick*40;if(this.ballHeight>a)this.ballHeight=a}this.parent()},resetCharge:function(){this.currentElement=this.chargeState=this.dischargeTimer=this.ballHeight=0;if(this.compressorBall){this.compressorBall.destroy();this.compressorBall=null}},updateSprites:function(){ig.AnimatedEntity.prototype.updateSprites.call(this);
if(this.ballHeight)this.sprites[1].pos.z=this.sprites[1].pos.z+Math.round(this.ballHeight)},ballHit:function(a){if(this.effects.hideHandle)return false;var c=a.getHitCenter(this),d=a.getElement();if(a.getCombatant().party!=sc.COMBATANT_PARTY.PLAYER||a instanceof sc.CompressedBaseEntity)return false;var e=!a.isBall||a.attackInfo&&a.attackInfo.hasHint("CHARGED"),f=sc.ATTACK_TYPE.NONE;if(d==sc.ELEMENT.WAVE||d==sc.ELEMENT.SHOCK){d==sc.ELEMENT.WAVE&&this.setCurrentAnim("wave",true,null,true);d==sc.ELEMENT.SHOCK&&
this.setCurrentAnim("shock",true,null,true);if(d!=this.currentElement){this.compressorBall&&this.compressorBall.destroy();this.compressorBall=null;this.currentElement=d;this.chargeState=0}if(!this.compressorBall&&this.chargeState<3){this.chargeState=Math.min(3,this.chargeState+1);if(this.chargeState>=3){this.effects.sheet.spawnOnTarget("chargeFinal"+h[d],this,{offset:{x:0,y:0,z:16}});this.dischargeTimer=5/sc.options.get("assist-puzzle-speed");this.createCompressorBall()}else{ig.SoundHelper.playAtEntity(this.sounds.charge,
this,false,{speed:1+(this.chargeState-1)*0.2});this.effects.sheet.spawnOnTarget("charge"+h[d],this,{offset:{x:0,y:0,z:6+g[this.chargeState]}});this.dischargeTimer=0.4}}sc.combat.showHitEffect(this,c,f,a.getElement(),false,false,true)}else sc.combat.showHitEffect(this,c,sc.ATTACK_TYPE.NONE,a.getElement(),false,false,true);if(this.compressorBall){c=a.getHitVel(this,b);if(e){this.effects.sheet.spawnOnTarget("shoot"+h[this.currentElement],this,{offset:{x:0,y:0,z:16}});this.compressorBall.shoot(c,a.getCombatantRoot(),
this.followCamera);this.compressorBall=null;this.dischargeTimer=this.chargeState=0;this.setCurrentAnim("off",true,null,true)}else this.compressorBall.nudge(c)}return true},isBallAdjust:function(){return true},doBallAdjust:function(a,b,c){this.getAlignedPos(ig.ENTITY_ALIGN.BOTTOM,a);a.z=a.z+12;this.compressorBall&&Vec3.assign(c,this.compressorBall.coll.size);return 1},isBallDestroyer:function(a,b,c){return!this.compressorBall||!c?true:false}});var i={};sc.CompressedBaseEntity=ig.AnimatedEntity.extend({element:null,
startPos:Vec2.create(),nudgeDir:Vec2.create(),nudgeTimer:0,killTimer:0,collisionList:[],collReleaseTimer:0,collReleaseTimeList:[],globalCount:0,speedFactor:1,effects:{sheet:new ig.EffectSheet("puzzle.compressor"),perma:null,trail:null},init:function(a,b,c,d){this.parent(a,b,c,d);this.globalCount=++o;this.coll.type=ig.COLLTYPE.PROJECTILE;this.coll.setSize(16,16,16);this.coll.pos.x=this.coll.pos.x-this.coll.size.x/2;this.coll.pos.y=this.coll.pos.y-this.coll.size.y/2;this.coll.zGravityFactor=0;this.coll.accelSpeed=
0;this.coll.friction.air=0;this.coll.friction.ground=0;this.coll.bounciness=1;Vec2.assign(this.startPos,this.coll.pos);this.speedFactor=d.speed||1;this.fastMode=d.fastMode||false},_getAssistFactor:function(){return this.fastMode?1:sc.options.get("assist-puzzle-speed")},onKill:function(a){this.parent(a);this.cameraHandle&&ig.camera.removeTarget(this.cameraHandle,"NORMAL",KEY_SPLINES.EASE_IN_OUT);this.collisionList.length=0},nudge:function(a){Vec2.assign(this.nudgeDir,a);Vec2.length(this.nudgeDir,8);
this.nudgeTimer=0.1},shoot:function(a,b,c){this.coll.vel.x=a.x;this.coll.vel.y=a.y;Vec2.length(this.coll.vel,400);this.animState.angle=Vec3.clockangle(this.coll.vel);this.combatant=b;this.effects.trail=this.effects.sheet.spawnOnTarget("trail"+h[this.element],this,{duration:-1,offset:{x:0,y:0,z:4}});this.killTimer=10;this.attackInfo=new sc.AttackInfo(b.params,{element:this.element,hints:["COMPRESSED"]});if(c){this.cameraHandle=new ig.Camera.TargetHandle(new ig.Camera.MultiEntityTarget([this,ig.game.playerEntity],
true),0,0);ig.camera.pushTarget(this.cameraHandle,"FAST",KEY_SPLINES.EASE_IN_OUT)}},destroy:function(){this.kill()},update:function(){this.collReleaseTimer=this.collReleaseTimer+ig.system.tick;if(this.collReleaseTimeList.length>0&&this.collReleaseTimeList[0]<=this.collReleaseTimer){this.collisionList.shift();this.collReleaseTimeList.shift()}if(this.nudgeTimer){this.nudgeTimer=this.nudgeTimer-ig.system.tick;if(this.nudgeTimer<=0){this.coll.setPos(this.startPos.x,this.startPos.y,this.coll.pos.z);this.nudgeTimer=
0}else{var a=KEY_SPLINES.EASE_OUT.get(1-this.nudgeTimer/0.1),a=Math.sin(a*Math.PI);Vec2.assign(b,this.startPos);Vec2.addMulF(b,this.nudgeDir,a);this.coll.setPos(b.x,b.y,this.coll.pos.z)}}if(this.killTimer){this.killTimer=this.killTimer-ig.system.tick;this.killTimer<=0&&this.kill()}o>=this.globalCount+4&&this.kill();this.parent()},collideWith:function(a){if(this.attackInfo&&(a.damage||a.ballHit)&&this.collisionList.indexOf(a)==-1)if(a.damage&&a.party!=this.combatant.party){if(a.damage(this,this.attackInfo)){this.collisionList.push(a);
this.collReleaseTimeList.push(this.collReleaseTimer+0.5);(a.coll.type==ig.COLLTYPE.BLOCK||a.coll.type==ig.COLLTYPE.FENCE)&&this.destroy()}}else if(a.ballHit&&a.ballHit(this)){this.onBallHit&&this.onBallHit(a);a instanceof ig.ENTITY.WaveTeleport&&this.destroy();if(!this._killed){this.collisionList.push(a);this.collReleaseTimeList.push(this.collReleaseTimer+0.5)}}},onCollision:function(){return false},getHitCenter:function(a,b){return this.getOverlapCenterCoords(a,b)},getHitVel:function(a,b){var c=
b||{};Vec2.assign(c,this.coll.vel);return c},getElement:function(){return this.element},getCombatant:function(){return this.combatant},getCombatantRoot:function(){return this.combatant.getCombatantRoot()},getAttackInfo:function(){return this.attackInfo},ballHit:function(a){if(!this.attackInfo)return false;if(a.attackInfo&&a.attackInfo.hasHint("ANTI_COMPRESSOR")){var b="suck"+(this.element==sc.ELEMENT.SHOCK?"Shock":"Wave"),c=this.getAlignedPos(ig.ENTITY_ALIGN.CENTER);this.effects.sheet.spawnOnTarget(b,
a.getCombatant(),{target2Point:c});this.destroy();return true}return false},onCompressorMoveEnd:function(){this.destroy()},isCompressor:function(){return true}});sc.COMPRESSOR_MOVE={effects:{sheet:new ig.EffectSheet("puzzle.compressor")},waveUpdate:function(a){var c=a.getCenter(b);if(c.x<=0||c.x>=ig.game.size.x||c.y<=0||c.y>=ig.game.size.y)a.onCompressorMoveEnd(true);if(a.enterWall.timer){a.enterWall.timer=a.enterWall.timer-ig.system.tick;if(a.enterWall.timer<=0){a.enterWall.timer=0;Vec2.assign(a.coll.vel,
a.enterWall.dir);Vec2.length(a.coll.vel,200*a.speedFactor*a._getAssistFactor())}}if(a.phaseMode&&!a.enterWall.timer){a.wallKillTimer=a.wallKillTimer+ig.system.tick*a._getAssistFactor();if(a.wallKillTimer>j)a.onCompressorMoveEnd(true);else if(a.phaseTraveled>4){if(!ig.game.isAreaBlocked(c.x-8,c.y-8,a.coll.pos.z,16,16,a.coll.size.z,true)){a.phaseMode=false;a.effects.perma.stop();a.effects.perma=this.effects.sheet.spawnOnTarget("ballWave",a,{duration:-1,offset:{x:0,y:0,z:4}});a.effects.trail=this.effects.sheet.spawnOnTarget("trailWave",
a,{duration:-1,offset:{x:0,y:0,z:4}});var c=a.coll,d=a.getCenter(b);d.x=d.x-c.vel.x*a.coll.size.x/2.05;d.y=d.y-c.vel.y*a.coll.size.y/2.05;this.effects.sheet.spawnFixed("waveWallLeave",d.x,d.y,a.coll.pos.z,null,{angle:Math.PI+Vec2.clockangle(c.vel)});Vec2.length(a.coll.vel,400);a.coll.setType(a.startCollType);a.animState.angle=Vec3.clockangle(a.coll.vel)}}else a.phaseTraveled=a.phaseTraveled+ig.system.tick*200*a._getAssistFactor()}else a.wallKillTimer=0},waveMoveTrace:function(a,c){if(!a._killed&&
!a.phaseMode&&c.collided){var d=ig.game.physics.initTraceResult(i),e=a.coll,f=Vec2.assign(b,e.vel);Vec2.length(f,a.coll.size.x+ig.system.tick*2);d=ig.game.trace(d,e.pos.x+e.size.x/2-1,e.pos.y+e.size.y/2-1,e.pos.z,f.x,f.y,2,2,e.size.z,a.startCollType)?d.dir:c.blockDir;Vec2.assign(a.enterWall.dir,d);Vec2.assignC(e.vel,0,0);a.enterWall.timer=k;e=a.getCenter(b);e.x=e.x+d.x*a.coll.size.x/2.05;e.y=e.y+d.y*a.coll.size.y/2.05;this.effects.sheet.spawnFixed("waveWallOrth",e.x,e.y,a.coll.pos.z,null,{angle:Math.PI+
Vec2.clockangle(d)});a.animState.angle=Vec3.clockangle(a.coll.vel);a.coll.setType(ig.COLLTYPE.TRIGGER);a.phaseMode=true;a.phaseTraveled=0;a.effects.perma.stop();if(a.effects.trail){a.effects.trail.stop();a.effects.trail=null}a.effects.perma=this.effects.sheet.spawnOnTarget("ballWaveAlt",a,{duration:-1,offset:{x:0,y:0,z:4}})}},waveCollide:function(c,e){var f=c.coll._collData;if(f&&f.collided&&!c.phaseMode&&this.isAlignCenter(e)){var g=ig.CollTools.getDistVec2(e.coll,c.coll,b),h=Vec2.assign(a,f.blockDir);
Vec2.mulF(h,Vec2.dot(g,f.blockDir));f=e.getCenter(d);Vec2.add(f,h);Vec2.subC(f,c.coll.size.x/2,c.coll.size.y/2);c.coll.setPos(f.x,f.y);c.coll._collData.skipPhysics=false}},waveBallHit:function(a,c){if(c instanceof ig.ENTITY.RegenDestruct){var d=a.getCenter(b),d=new sc.CircleHitForce(a.combatant,{attack:{type:"MEDIUM",element:"WAVE",damageFactor:0,spFactor:0,hints:["COMPRESSED"]},pos:Vec3.createC(d.x,d.y,a.coll.pos.z),radius:32,zHeight:4,duration:0.1,expandRadius:0,alwaysFull:true,party:"OTHER",centralAngle:1});
sc.combat.addCombatForce(d)}},isAlignCenter:function(a){return a instanceof ig.ENTITY.RotateBlocker||a instanceof ig.ENTITY.OneTimeSwitch&&a.switchType=="waveSwitch"?true:false},shockUpdate:function(f){if(f.turnSoundTimer){f.turnSoundTimer=f.turnSoundTimer-ig.system.tick;if(f.turnSoundTimer<0)f.turnSoundTimer=0}if(!Vec2.isZero(f.slidingWall)){var g=Vec2.assign(b,f.coll.vel);Vec2.mulF(g,ig.system.tick);if(f.blockCheck>0){f.blockCheck=f.blockCheck-Vec2.length(g);if(f.blockCheck<=0)f.blockCheck=0}else{var h=
ig.game.physics.initTraceResult(i);if(!ig.game.traceEntity(h,f,g.x,g.y,0,0,0,f.coll.type,null,null)){var j=null,h=ig.game.physics.initTraceResult(i),k=[],o=ig.game.traceEntity(h,f,f.slidingWall.x*4,f.slidingWall.y*4,g.x,g.y,0,f.coll.type,k,null);if(o&&!Vec2.equal(h.dir,f.slidingWall)&&Vec2.dot(f.coll.vel,h.dir)<0){Vec2.addMulF(g,f.slidingWall,4*h.dist);Vec2.addMulF(g,h.dir,-1);j=h.dir}else if(!o){var s=Vec2.assign(a,g);Vec2.mulF(s,-3);Vec2.addMulF(g,f.slidingWall,4);h=ig.game.physics.initTraceResult(i);
if(o=ig.game.traceEntity(h,f,s.x,s.y,g.x,g.y,0,f.coll.type,null,null)){Vec2.addMulF(g,s,h.dist);Vec2.addMulF(g,h.dir,-1);j=h.dir}else this.clearWallSliding(f)}if(!j&&o){h=f._getAssistFactor();for(o=k.length;o--;)k[o].entity.compressorSlow?Vec2.length(f.coll.vel,200*k[o].entity.compressorSlow*f.speedFactor*h):Vec2.length(f.coll.vel,200*f.speedFactor*h)}if(j){if(!f.turnSoundTimer){this.effects.sheet.spawnOnTarget("shockWallTurn",f);f.turnSoundTimer=l}k=Vec2.assign(c,j);Vec2.rotate90CW(k);Vec2.dot(k,
f.slidingWall)>0&&Vec2.flip(k);h=Vec2.assign(a,0,0);Vec2.addMulF(h,f.coll.vel,-0.5);o=Vec2.addMulF(g,k,128,e);Line2.intersect(h,f.coll.vel,g,o,d)&&f.coll.setPos(f.coll.pos.x+d.x,f.coll.pos.y+d.y);Vec2.flip(k);Vec2.assign(f.slidingWall,j);Vec2.assign(f.coll.vel,k);Vec2.length(f.coll.vel,200*f.speedFactor*f._getAssistFactor());f.animState.angle=Vec3.clockangle(f.coll.vel);f.blockCheck=2}}}}},shockMoveTrace:function(a,c){if(c.collided){if(Vec2.isZero(a.slidingWall)){this.effects.sheet.spawnOnTarget("shockWallConnect",
a);a.killTimer=a.killTimer/(0.5*a.speedFactor*a._getAssistFactor())}else if(!a.turnSoundTimer){this.effects.sheet.spawnOnTarget("shockWallTurn",a);a.turnSoundTimer=l}Vec2.assign(b,c.blockDir);Vec2.flip(b);Vec2.length(b,1);a.coll.setPos(a.coll.pos.x+b.x,a.coll.pos.y+b.y);a.coll._collData.skipPhysics=false;Vec2.rotate90CW(b);(Vec2.isZero(a.slidingWall)?Vec2.dot(b,a.coll.vel):-Vec2.dot(b,a.slidingWall))<0&&Vec2.flip(b);Vec2.assign(a.slidingWall,c.blockDir);Vec2.assign(a.coll.vel,b);Vec2.length(a.coll.vel,
200*a.speedFactor*a._getAssistFactor());a.animState.angle=Vec3.clockangle(a.coll.vel)}},clearWallSliding:function(a){if(!Vec2.isZero(a.slidingWall)){Vec3.assignC(a.slidingWall,0,0);Vec2.length(a.coll.vel,400);a.killTimer=a.killTimer*0.5*a.speedFactor}},shootFromWall:function(a,c,d){this.clearWallSliding(a);c=ig.CollTools.getCenterXYAlignedPos(f,a.coll,c.coll);a.setPos(c.x,c.y,c.z);Vec2.assign(b,d);Vec2.length(b,400);Vec2.length(a.coll.vel,4);Vec2.add(b,a.coll.vel);Vec2.assign(a.coll.vel,b);Vec2.length(a.coll.vel,
400);a.wallBounces++}};var j=1.5,k=0.2;sc.CompressedWaveEntity=sc.CompressedBaseEntity.extend({_wm:new ig.Config({spawnable:false,attributes:{}}),phaseMode:false,phaseTraveled:0,wallKillTimer:0,startCollType:ig.COLLTYPE.PROJECTILE,enterWall:{timer:0,dir:Vec2.create()},init:function(a,b,c,d){this.parent(a,b,c,d);this.element=sc.ELEMENT.WAVE;this.effects.perma=this.effects.sheet.spawnOnTarget("ballWave",this,{duration:-1,offset:{x:0,y:0,z:4}})},update:function(){sc.COMPRESSOR_MOVE.waveUpdate(this);
this.parent()},onBallHit:function(a){if(a instanceof ig.ENTITY.RegenDestruct){a=this.getCenter(b);a=new sc.CircleHitForce(this.combatant,{attack:{type:"MEDIUM",element:"WAVE",damageFactor:0,spFactor:0,hints:["COMPRESSED"]},pos:Vec3.createC(a.x,a.y,this.coll.pos.z),radius:32,zHeight:4,duration:0.1,expandRadius:0,alwaysFull:true,party:"OTHER",centralAngle:1});sc.combat.addCombatForce(a)}},collideWith:function(a,b){sc.COMPRESSOR_MOVE.waveCollide(this,a,b);this.parent(a,b)},handleMovementTrace:function(a){sc.COMPRESSOR_MOVE.waveMoveTrace(this,
a)}});var l=0.1,o=0;sc.CompressedShockEntity=sc.CompressedBaseEntity.extend({_wm:new ig.Config({spawnable:false,attributes:{}}),slidingWall:Vec2.create(),blockCheck:0,turnSoundTimer:0,wallBounces:0,init:function(a,b,c,d){this.parent(a,b,c,d);this.element=sc.ELEMENT.SHOCK;this.effects.perma=this.effects.sheet.spawnOnTarget("ballShock",this,{duration:-1,offset:{x:0,y:0,z:4}})},update:function(){sc.COMPRESSOR_MOVE.shockUpdate(this);this.parent()},handleMovementTrace:function(a){sc.COMPRESSOR_MOVE.shockMoveTrace(this,
a)},shootFromWall:function(a,b){sc.COMPRESSOR_MOVE.shootFromWall(this,a,b)}});ig.ENTITY.AntiCompressor=ig.AnimatedEntity.extend({_wm:new ig.Config({spawnable:true,attributes:{spawnCondition:{_type:"VarCondition",_info:"Condition for Anti Compressor to spawn",_popup:true,_optional:true}}}),effects:{sheet:new ig.EffectSheet("puzzle.compressor")},init:function(a,b,c,d){this.parent(a,b,c,d);this.coll.type=ig.COLLTYPE.TRIGGER;this.coll.setSize(16,16,24);this.coll.zGravityFactor=1E3;(a=ig.mapStyle.get("anticompressor"))&&
this.initAnimations({sheet:{src:a.sheet,width:16,height:16,xCount:1,offX:a.x,offY:a.y},SUB:[{size:{x:16,y:16,z:0},SUB:[{name:"idle",time:1,frames:[0],repeat:false},{name:"suck",time:1,frames:[0],repeat:false}]},{shapeType:"Y_FLAT",renderMode:"lighter",SUB:[{name:"idle",time:0.05,frames:[1,1,1,1,1,1,1,1,1,1,1,1],framesGfxOffset:[0,0,0,0,0,-6,0,-5,0,-4,0,-3,0,-2,0,-1,0,0,0,0,0,0,0,0],framesAlpha:[0,0,0.2,0.4,0.6,0.8,1,1,0.8,0.6,0.4,0.2],repeat:true}]}]});this.setCurrentAnim("idle")},show:function(a){this.parent(a);
if(!a){this.animState.alpha=0;ig.game.effects.teleport.spawnOnTarget("showFast",this,{})}},onHideRequest:function(){ig.game.effects.teleport.spawnOnTarget("hideFast",this,{callback:this})},onEffectEvent:function(a){a.isDone()&&this.hide()},ballHit:function(a){if(a&&a.isCompressor&&a.isCompressor()){var b="suck"+(a.element==sc.ELEMENT.SHOCK?"Shock":"Wave"),c=a.getAlignedPos(ig.ENTITY_ALIGN.CENTER);this.effects.sheet.spawnOnTarget(b,this,{target2Point:c});a.onCompressorMoveEnd();return true}return false}});
ig.ENTITY.CompressorBouncer=ig.AnimatedEntity.extend({_wm:new ig.Config({spawnable:true,attributes:{spawnCondition:{_type:"VarCondition",_info:"Condition for Bouncer to spawn",_popup:true,_optional:true},dir:{_type:"Face",_info:"Direction to face",_select:ig.ActorEntity.FACE4},condition:{_type:"VarCondition",_info:"Condition for bouncer to be active",_popup:true}}}),effects:{sheet:new ig.EffectSheet("puzzle.compressor")},face:Vec2.create(),init:function(a,b,c,d){this.parent(a,b,c,d);this.coll.type=
ig.COLLTYPE.TRIGGER;this.coll.setSize(8,8,24);this.coll.zGravityFactor=1E3;this.condition=new ig.VarCondition(d.condition);this.dir=ig.ActorEntity.FACE4[d.dir]||ig.ActorEntity.FACE4.NORTH;ig.ActorEntity.getFaceVec(this.dir,this.face);(a=ig.mapStyle.get("bouncer"))&&this.initAnimations({DOCTYPE:"MULTI_DIR_ANIMATION",sheet:{src:a.sheet,width:16,height:32,offX:a.x,offY:a.y,xCount:4},dirs:4,flipX:[0,0,0,1],tileOffsets:[0,4,8,4],size:{x:16,y:0,z:32},wallY:0,offset:{y:4},SUB:[{name:"off",time:0.1,frames:[0],
repeat:false,wallY:1,offset:{y:-4},size:{x:16,y:16,z:0}},{name:"turnOn",time:0.05,frames:[1,2],repeat:false},{name:"on",time:0.05,frames:[3],repeat:false},{name:"turnOff",time:0.05,frames:[2,1],repeat:false}]});this.isOn=this.condition.evaluate();this.setCurrentAnim(this.isOn?"on":"off")},show:function(a){this.parent(a);if(!a){this.animState.alpha=0;ig.game.effects.teleport.spawnOnTarget("showFast",this,{})}},onHideRequest:function(){ig.game.effects.teleport.spawnOnTarget("hideFast",this,{callback:this})},
onEffectEvent:function(a){a.isDone()&&this.hide()},ballHit:function(a){if(!this.isOn)return false;if(a.shootFromWall){a.shootFromWall(this,this.face);return true}return false},varsChanged:function(){var a=this.condition.evaluate();if(a!=this.isOn)(this.isOn=a)?this.setCurrentAnim("turnOn",true,"on",true):this.setCurrentAnim("turnOff",true,"off",true)}})});ig.baked=!0;
ig.module("game.feature.puzzle.entities.water-block").requires("impact.base.entity","impact.feature.effect.effect-sheet").defines(function(){var b={SQUARE:{shape:ig.COLLSHAPE.RECTANGLE,offY:128,flipX:false,wallY:0},CORNER_NE:{shape:ig.COLLSHAPE.SLOPE_NE,offY:64,flipX:false,wallY:0},CORNER_SE:{shape:ig.COLLSHAPE.SLOPE_SE,offY:0,flipX:false,wallY:1},CORNER_SW:{shape:ig.COLLSHAPE.SLOPE_SW,offY:0,flipX:true,wallY:1},CORNER_NW:{shape:ig.COLLSHAPE.SLOPE_NW,offY:64,flipX:true,wallY:0}},a=Vec2.create();ig.ENTITY.WaterBlock=
ig.AnimatedEntity.extend({blockType:0,state:1,changeDuration:0,timer:0,compressorSlow:0.5,effects:{sheet:new ig.EffectSheet("puzzle.water-bubble"),handle:null,hitHandle:null},_wm:new ig.Config({spawnable:true,attributes:{blockType:{_type:"String",_info:"Type of block",_select:b},changeDuration:{_type:"Number",_info:"Number of seconds for steam or ice state to persist",_default:5}}}),init:function(a,c,e,f){this.parent(a,c,e,f);this.coll.type=ig.COLLTYPE.BLOCK;this.coll.setSize(32,32,32);this.blockType=
b[f.blockType]||b.SQUARE;this.coll.shape=this.blockType.shape;this.changeDuration=f.changeDuration||5;this.navBlocker=ig.navigation.getNavBlock(this,ig.NAV_BLOCKER_TYPE.NO_TOP);(a=ig.mapStyle.get("waterblock"))&&this.initAnimations({namedSheets:{block:{src:a.sheet,width:32,height:64,xCount:4,offX:a.x,offY:a.y+this.blockType.offY},puddle:{src:a.sheet,width:32,height:32,xCount:1,offX:a.puddleX,offY:a.puddleY}},sheet:"block",flipX:this.blockType.flipX,wallY:this.blockType.wallY,pivot:{x:16,y:52},size:{x:32,
y:32,z:32},SUB:[{name:"water",time:0.2,frames:[0,1,2],repeat:true,framesAlpha:[0.7,0.7,0.7]},{name:"frozen",time:0.2,frames:[3],repeat:true},{name:"melting",time:0.2,frames:[0,1,2],repeat:true},{name:"melting",time:0.2,frames:[3],repeat:true,aboveZ:1},{sheet:"puddle",size:{x:32,y:32,z:0},pivot:{x:16,y:16},wallY:1,time:1,frames:[0],repeat:false,SUB:[{name:"puddle"},{name:"regen"}]},{name:"regen",time:1,frames:[0],repeat:false}]});this.terrain=ig.TERRAIN.WATER;this.setCurrentAnim("water")},onKill:function(a){this.parent(a);
this.navBlocker&&this.navBlocker.remove();this.navBlocker=null},steam:function(a,b){if(this.state!=3){this.coll.size.z=0;this.state=3;this.terrain=0;this.effects.sheet.spawnOnTarget("blockSteam",this,{align:"CENTER"});var e=this.getAlignedPos(ig.ENTITY_ALIGN.BOTTOM,Vec3.create());if(b){e=new sc.CircleHitForce(b,{attack:{type:"MASSIVE",element:"HEAT",damageFactor:2,spFactor:0,hints:["STEAM"]},pos:e,radius:8,zHeight:24,duration:0.1,expandRadius:32,alwaysFull:true,party:"OTHER",centralAngle:1});sc.combat.addCombatForce(e)}this.timer=
this.changeDuration/sc.options.get("assist-puzzle-speed");this.navBlocker.update(ig.NAV_BLOCKER_TYPE.NO_BLOCK);this.effects.handle=this.effects.sheet.spawnOnTarget("blockRecharge",this,{align:"CENTER",duration:-1});this.setCurrentAnim("puddle")}},isFrozen:function(){return this.state==2},turnIce:function(){if(this.state!=2){this.navBlocker.update(ig.NAV_BLOCKER_TYPE.REGULAR);this.state=2;this.setCurrentAnim("frozen");this.terrain=ig.TERRAIN.ICE;this.effects.sheet.spawnOnTarget("blockFreeze",this,
{});this.timer=this.changeDuration/sc.options.get("assist-puzzle-speed")}},melt:function(){this.state=1;this.navBlocker.update(ig.NAV_BLOCKER_TYPE.NO_TOP);this.setCurrentAnim("melting");this.effects.sheet.spawnOnTarget("blockMelt",this,{spriteFilter:[1],callback:this});this.terrain=ig.TERRAIN.WATER;this.timer=0},onEffectEvent:function(a){if(a.state==ig.EFFECT_STATE.ENDED)a==this.effects.hitHandle?this.effects.hitHandle=null:this.currentAnim=="melting"&&this.setCurrentAnim("water")},reform:function(){this.coll.setType(ig.COLLTYPE.BLOCK);
this.state=1;this.coll.size.z=32;this.navBlocker.update(ig.NAV_BLOCKER_TYPE.NO_TOP);this.terrain=ig.TERRAIN.WATER;this.setCurrentAnim("water");this.effects.handle&&this.effects.handle.stop();this.effects.handle=null;this.effects.sheet.spawnOnTarget("blockAppear",this,{align:"CENTER"})},bounce:function(){this.effects.hitHandle&&this.effects.hitHandle.stop();this.effects.hitHandle=this.effects.sheet.spawnOnTarget("blockHit",this,{callback:this})},collideWith:function(b,c){if(this.state==1&&c&&!Vec2.isZero(c)){b instanceof
sc.IceDiskEntity&&this.turnIce();if(b instanceof ig.ENTITY.Combatant){this.bounce();Vec2.assign(a,c);Vec2.flip(a);sc.combat.showHitEffect(b,b.getAlignedPos(ig.ENTITY_ALIGN.CENTER),sc.ATTACK_TYPE.LIGHT,sc.ELEMENT.NEUTRAL,false,false,true);b.cancelAction();var e=b.hasStun()?"LIGHT":"MEDIUM",e=b.doDamageMovement(a,e,false,false);b.coll.vel.z=100;b.damageTimer=Math.max(b.damageTimer,e)}}},onGroundAdd:function(a){if(a instanceof sc.IceDiskEntity&&this.state==1){this.turnIce();a.iceBreak()}},ballHit:function(b){if(this.state==
3)return false;var c=b.getHitCenter(this),e=b.getHitVel(this,a);if(b.attackInfo&&b.attackInfo.hasHint("STEAM"))return false;var f=b.getElement();if(this.state==2&&f!=sc.ELEMENT.HEAT)return false;f==sc.ELEMENT.HEAT?this.state==2?this.melt():this.steam(e,b.getCombatantRoot()):f==sc.ELEMENT.COLD?this.turnIce(e):this.bounce();e=sc.ATTACK_TYPE.LIGHT;if(!b.isBall||b.attackInfo.hasHint("CHARGED"))e=sc.ATTACK_TYPE.MEDIUM;sc.combat.showHitEffect(this,c,e,b.getElement(),false,false,true);return true},update:function(){if(this.timer>
0){this.timer=this.timer-ig.system.tick;if(this.timer<=0){this.timer=0;this.state==2?this.melt():this.reform()}}if(this.state==3){var a=1-(this.timer/(this.changeDuration/sc.options.get("assist-puzzle-speed"))).limit(0,1);this.animState.scaleX=a;this.animState.scaleY=a}else{this.animState.scaleX=1;this.animState.scaleY=1}this.parent()}})});ig.baked=!0;
ig.module("game.feature.puzzle.entities.ice-disk").requires("impact.base.entity","impact.feature.effect.effect-sheet").defines(function(){var b=Vec2.create(),a=Vec3.create();sc.IceDiskEntity=ig.AnimatedEntity.extend({timer:0,combatant:null,state:1,effects:{sheet:new ig.EffectSheet("puzzle.water-bubble"),handle:null,hitHandle:null},cameraHandle:null,init:function(a,b,e,f){this.parent(a,b,e,f);this.coll.type=ig.COLLTYPE.VIRTUAL;this.coll.zGravityFactor=1;this.coll.zBounciness=0;this.coll.bounciness=
1;this.coll.setSize(16,16,16);this.coll.setPadding(4,4);this.coll.friction.air=0.2;this.coll.shadow.size=24;this.coll.setPos(a-this.coll.size.x/2,b-this.coll.size.y/2,e);this.remainingHits=5;this.coll.weight=2E5;this.initAnimations({shapeType:"Y_FLAT",offset:{x:0,y:0,z:0},sheet:{src:"media/entity/objects/object-effects.png",width:24,height:24,xCount:1,offX:224,offY:16},SUB:[{name:"idle",time:0.1,frames:[0],repeat:true}]});this.setCurrentAnim("idle");this.panel=f.panel||null;this.coalCoolTime=f.coalCoolTime;
this.timer=8/sc.options.get("assist-puzzle-speed");this.animState.alpha=0;this.coll.vel.z=150;this.effects.sheet.spawnOnTarget("iceAppear",this,{})},slide:function(a,b){if(!this._killed&&this.state!=2){this.state=2;var e=this.coll;e.maxVel=400;e.friction.ground=0;e.friction.air=0;e.noSlipping=true;e.weight=9001;Vec2.assign(e.vel,a);Vec2.round(e.vel,Math.PI*0.03);Vec2.length(e.vel,400);this.timer=1.5;this.attackInfo=new sc.AttackInfo(b.params,{element:sc.ELEMENT.COLD,hints:["ICE_DISK"]});if(!this.combatant)this.combatant=
b;this.effects.handle&&this.effects.handle.stop();this.coll.setType(ig.COLLTYPE.IGNORE);this.effects.sheet.spawnOnTarget("iceTrail",this,{duration:-1,angle:Vec2.clockangle(a),offset:{z:6}})}},consume:function(a){this.state=3;Vec2.assignC(this.coll.vel,0,0);ig.EffectTools.clearEffects(this);this.effects.sheet.spawnOnTarget("iceAbsorb",this,{callback:this,align:"CENTER"});this.cameraHandle&&ig.camera.removeTarget(this.cameraHandle,"SLOW",KEY_SPLINES.EASE_IN_OUT);a&&this.setPos(a.x-this.coll.size.x/
2,a.y-this.coll.size.y/2,a.z)},onKill:function(a){a||this.panel&&this.panel.onBubbleBurst();this.parent(a)},startMelt:function(){if(!this._killed){Vec2.assignC(this.coll.vel,0,0);this.state=3;this.effects.sheet.spawnOnTarget("iceMelt",this,{callback:this,align:"CENTER"})}},onEffectEvent:function(a){this._killed||a.state==ig.EFFECT_STATE.ENDED&&this.kill()},handleMovementTrace:function(a){if(!this._killed){if(a.collided){var b=this.getCenter();b.x=b.x+a.blockDir.x*this.coll.size.x/2.05;b.y=b.y+a.blockDir.y*
this.coll.size.y/2.05;if(!this.remainingHits){this.iceBreak();return}this.remainingHits--;this.effects.sheet.spawnFixed("iceBounce",b.x,b.y,this.coll.pos.z,null,{angle:Vec2.clockangle(a.blockDir)})}this.parent(a)}},iceBreak:function(){if(!this._killed){this.cameraHandle&&ig.camera.removeTarget(this.cameraHandle,"SLOW",KEY_SPLINES.EASE_IN_OUT);var a=this.getAlignedPos(ig.ENTITY_ALIGN.BOTTOM,Vec3.create());this.effects.sheet.spawnFixed("iceBreak",a.x,a.y,a.z,null,{});this.kill()}},turnCooledCoals:function(){if(!this._killed){this.cameraHandle&&
ig.camera.removeTarget(this.cameraHandle,"SLOW",KEY_SPLINES.EASE_IN_OUT);var a=this.getAlignedPos(ig.ENTITY_ALIGN.BOTTOM,Vec3.create());ig.game.spawnEntity(sc.CooledCoals,a.x,a.y,this.coll.pos.z,{panel:this.panel,coalCoolTime:this.coalCoolTime});this.panel=null;this.kill()}},absorbFerro:function(){this.panel=null;this.cameraHandle&&ig.camera.removeTarget(this.cameraHandle,"SLOW",KEY_SPLINES.EASE_IN_OUT);this.kill()},update:function(){if(this.timer){this.timer=this.timer-ig.system.tick;if(this.state==
1&&this.coll.weight!=-1&&this.coll.pos.z==this.coll.baseZPos)this.coll.weight=-1;if(this.timer<=0){this.timer=0;this.state==1?this.startMelt():this.iceBreak()}}this.coll.pos.z<ig.game.minLevelZ&&this.iceBreak();this.coll.pos.z==this.coll.baseZPos&&ig.terrain.getTerrain(this.coll,true)==ig.TERRAIN.COAL&&this.turnCooledCoals();this.parent()},ballHit:function(a){var c=a.getElement();if(this.state==3||c!=sc.ELEMENT.HEAT&&this.state!=1)return false;var e=a.getHitCenter(this),f=a.getHitVel(this,b);sc.combat.showHitEffect(this,
e,sc.ATTACK_TYPE.MEDIUM,a.getElement(),false,false,true);c==sc.ELEMENT.HEAT?this.startMelt():this.slide(f,a.getCombatantRoot());return true},onTouchGround:function(b){if(this.coll.pos.z>=-1&&!this.coll.ignoreCollision){var c=this.getAlignedPos(ig.ENTITY_ALIGN.BOTTOM,a);b<-30&&this.effects.sheet.spawnFixed("iceLand",c.x,c.y,c.z,null,{})}},collideWith:function(a){this.state==2&&(a.damage&&a.party!=this.combatant.party?a.damage(this,this.attackInfo)&&this.iceBreak():a instanceof ig.ENTITY.RegenDestruct&&
a.ballHit(this)&&this.consume(a.getAlignedPos(ig.ENTITY_ALIGN.BOTTOM)))},isBallAdjust:function(){return true},doBallAdjust:function(a,b,e){this.getCenter(a);a.z=this.coll.pos.z;Vec3.assign(e,this.coll.size);return 3},isBallDestroyer:function(a,b,e){return!e||sc.model.player.currentElementMode==sc.ELEMENT.HEAT?true:false},getHitCenter:function(a,b){return this.getOverlapCenterCoords(a,b)},getHitVel:function(a,b){var e=b||{};Vec2.assign(e,this.coll.vel);return e},getElement:function(){return sc.ELEMENT.COLD},
getCombatant:function(){return this.combatant},getCombatantRoot:function(){return this.combatant.getCombatantRoot()},getAttackInfo:function(){return this.attackInfo},isIceDisk:function(){return true}});sc.CooledCoals=ig.AnimatedEntity.extend({timer:0,effects:{sheet:new ig.EffectSheet("puzzle.water-bubble")},init:function(a,b,e,f){this.parent(a,b,e,f);this.coll.type=ig.COLLTYPE.BLOCK;this.terrain=ig.TERRAIN.STONE;this.coll.zGravityFactor=1;this.coll.setSize(28,28,2);this.coll.setPos(a-this.coll.size.x/
2,b-this.coll.size.y/2,e);a=ig.mapStyle.get("coals");this.initAnimations({shapeType:"Y_FLAT",offset:{x:0,y:2,z:0},size:{x:32,y:32,z:0},sheet:{src:a.sheet,width:32,height:32,xCount:1,offX:a.x,offY:a.y},SUB:[{name:"idle",time:0.1,frames:[0],repeat:true}]});this.setCurrentAnim("idle");this.panel=f.panel||null;this.timer=(f.coalCoolTime||5)/sc.options.get("assist-puzzle-speed");this.effects.sheet.spawnOnTarget("coalsAppear",this,{})},onKill:function(a){a||this.panel&&this.panel.onBubbleBurst();this.parent(a)},
startMelt:function(){this._killed||this.effects.sheet.spawnOnTarget("coalsDisappear",this,{callback:this,align:"CENTER"})},onEffectEvent:function(a){this._killed||a.state==ig.EFFECT_STATE.ENDED&&this.kill()},update:function(){if(this.timer){this.timer=this.timer-ig.system.tick;if(this.timer<=0){this.timer=0;this.startMelt()}}this.parent()}})});ig.baked=!0;
ig.module("game.feature.puzzle.entities.key-panel").requires("impact.base.entity","impact.feature.effect.effect-sheet","game.feature.combat.entities.ball","game.feature.menu.map-model").defines(function(){var b={REGULAR:{item:sc.AREA_ITEM_TYPE.DUNGEON_KEY,panel:{size:{x:16,y:16,z:1},sprite:{x:48,y:88,w:24,h:24}},fx:{active:"active",charged:"chargeActive"},ballInfo:new sc.BallInfo({animation:{name:"default",sheet:{src:"media/entity/balls/default.png",width:24,height:24,offY:120,offX:24},time:0.05,
repeat:true,frames:[0,1,2,3]},effects:"ball-special",maxBounce:3,timer:1.5,effectKeys:{bounce:"keyBounce",wall:"keyWall",air:"keyAir",trail:"keyTrail"},attack:{type:"HEAVY",damageFactor:1.3,skillBonus:"RANGED_DMG",hints:["CHARGED","DUNGEON_KEY"]},speed:400,trail:true})},MASTER:{item:sc.AREA_ITEM_TYPE.DUNGEON_MASTER_KEY,panel:{size:{x:24,y:24,z:1},sprite:{x:48,y:112,w:32,h:32}},fx:{active:"activeMaster",charged:"chargeActiveMaster"},ballInfo:new sc.BallInfo({animation:{name:"default",sheet:{src:"media/entity/balls/default.png",
width:24,height:24,offY:144,offX:24},time:0.05,repeat:true,frames:[0,1,2,3]},effects:"ball-special",maxBounce:3,timer:1.5,effectKeys:{bounce:"keyBounceMaster",wall:"keyWallMaster",air:"keyAirMaster",trail:"keyTrailMaster"},attack:{type:"HEAVY",damageFactor:1.3,skillBonus:"RANGED_DMG",hints:["CHARGED","DUNGEON_MASTER_KEY"]},speed:400,trail:true})}};ig.ENTITY.KeyPanel=ig.AnimatedEntity.extend({_wm:new ig.Config({spawnable:true,attributes:{spawnCondition:{_type:"VarCondition",_info:"Condition for Enemy to spawn",
_popup:true},keyType:{_type:"String",_info:"Type of Key Panel",_select:b}}}),effects:{key:new ig.EffectSheet("puzzle.key"),activeHandle:null,chargedHandle:null},throwerEntity:null,active:false,keyType:null,init:function(a,d,c,e){this.parent(a,d,c,e);this.coll.type=ig.COLLTYPE.BLOCK;this.coll.zGravityFactor=1E3;this.keyType=b[e.keyType]||b.REGULAR;a=this.keyType.panel;this.coll.setSize(a.size.x,a.size.y,a.size.z);d=ig.mapStyle.get("puzzle2");this.initAnimations({sheet:{src:d.sheet,width:a.sprite.w,
height:a.sprite.h,xCount:2,offX:a.sprite.x,offY:a.sprite.y},shapeType:"Z_FLAT",offset:{x:0,y:(a.sprite.h-a.size.y)/2,z:0},SUB:[{name:"on",time:1,frames:[1],repeat:false},{name:"off",time:1,frames:[0],repeat:false}]});this.setCurrentAnim("off")},show:function(a){this.parent(a);if(!a){this.animState.alpha=0;this.effects.key.spawnOnTarget("keyPanelAppear",this,{})}},setThrower:function(a){!a&&this.throwerEntity&&this.throwerEntity.setOverrideBall(null);this.throwerEntity=a;this.setActive(this.throwerEntity&&
this.hasKeys());this.throwerEntity&&!this.active&&this.effects.key.spawnOnTarget("noKeysBlink",this)},setActive:function(a){this.active=a;this.setCurrentAnim(this.active?"on":"off");if(this.active&&!this.effects.activeHandle){this.throwerEntity.setOverrideBall(this.keyType.ballInfo);this.effects.activeHandle=this.effects.key.spawnOnTarget(this.keyType.fx.active,this,{duration:-1})}if(!this.active&&this.effects.activeHandle){this.throwerEntity&&this.throwerEntity.setOverrideBall(null);this.effects.activeHandle.stop();
this.effects.activeHandle=null}if(!this.active&&this.effects.chargedHandle){this.effects.chargedHandle.stop();this.effects.chargedHandle=null}},hasKeys:function(){return sc.map.getAreaItemAmount(this.keyType.item)},update:function(){if(this.throwerEntity)if(ig.EntityTools.getGroundEntity(this.throwerEntity)!=this)this.setThrower(null);else{this.setActive(this.hasKeys());if(this.active)if(!this.effects.chargedHandle&&this.throwerEntity.isThrowCharged())this.effects.chargedHandle=this.effects.key.spawnOnTarget(this.keyType.fx.charged,
this,{duration:-1});else if(this.effects.chargedHandle&&!this.throwerEntity.isThrowCharged()){this.effects.chargedHandle.stop();this.effects.chargedHandle=null}}this.parent()},collideWith:function(a){!this.throwerEntity&&a==ig.game.playerEntity&&this.setThrower(a)}})});ig.baked=!0;
ig.module("game.feature.puzzle.entities.ball-changer").requires("impact.base.actor-entity","impact.base.entity","impact.base.game","game.feature.combat.model.combat-params","impact.feature.effect.effect-sheet").defines(function(){var b=Vec3.create();ig.ENTITY.BallChanger=ig.AnimatedEntity.extend({isOn:false,condition:null,changerType:null,disableTimer:0,disableBall:null,ballTime:0,resetBounce:false,_wm:new ig.Config({spawnable:true,attributes:{changerType:{_type:"BallChangerType",_info:"Type of BallChanger",
_popup:true},condition:{_type:"VarCondition",_info:"Condition for BallChanger to be active"},ballTime:{_type:"Number",_info:"How long the ball will be alive after bouncing with this block. (default=0.5)",_optional:true,_default:0.5},resetBounce:{_type:"Boolean",_info:"If true, bounces are reset when this changer is hit",_optional:true,_default:true}},drawBox:true,boxColor:"rgba(255,255,0, 0.5)"}),fx:{sheet:new ig.EffectSheet("puzzle.ball-changer")},init:function(a,b,c,e){this.parent(a,b,c,e);this.coll.type=
ig.COLLTYPE.IGNORE;this.coll.weight=-1;this.coll.zGravityFactor=1E3;Vec3.assignC(this.coll.size,24,24,24);this.condition=new ig.VarCondition(e.condition);this.ballTime=e.ballTime||0;this.resetBounce=e.resetBounce||false;if(e.changerType){if(window.wm){this._wm=this._wm.copy();this._wm.drawBox=false}a=e.changerType;this.changerType=new sc.BALL_CHANGER_TYPE[a.type](a.settings);a=ig.mapStyle.get("puzzle2");b=this.changerType.icon;this.initAnimations({namedSheets:{base:{src:a.sheet,width:16,height:16,
offX:144,offY:64},sphere:{src:a.sheet,width:16,height:16,offX:192,offY:64,xCount:4},icon:{src:a.sheet,width:16,height:16,offX:144,offY:80,xCount:3}},SUB:[{size:{x:16,y:16,z:0},offset:{y:-4},sheet:"base",SUB:[{name:"off",time:1,frames:[0]},{name:"on",time:1,frames:[2]},{name:"show",time:0.06,frames:[1,2]},{name:"hide",time:0.06,frames:[1,0]},{name:"used",time:0.15,frames:[1,2,1,0],repeat:true}]},{size:{x:16,y:0,z:16},offset:{z:12,y:-5},renderMode:"lighter",sheet:"sphere",SUB:[{name:"on",time:0.15,
frames:[0,1,2,3,0,1,2,3],repeat:true,tileOffset:4+this.changerType.sphereColor*4,framesGfxOffset:[0,0,0,1,0,1,0,1,0,0,0,-1,0,-1,0,-1]},{name:"show",time:0.03,frames:[0,1,2,3]},{name:"hide",time:0.03,frames:[3,2,1,0]}]},{size:{x:16,y:0,z:16},offset:{z:13,y:-4},sheet:"icon",frames:[b,b,b,b,b,b,b,b],flipX:this.changerType.flipX,flipY:this.changerType.flipY,framesGfxOffset:[0,0,0,1,0,1,0,1,0,0,0,-1,0,-1,0,-1],time:0.15,repeat:true,SUB:[{name:"on"}]}]});this.isOn=this.condition.evaluate();this.setCurrentAnim(this.isOn?
"on":"off")}},update:function(){if(this.disableBall&&this.disableBall._killed){this.isOn&&this.setCurrentAnim("show",true,"on",true);this.disableBall=null}if(this.disableTimer>0){this.disableTimer=this.disableTimer-ig.system.tick;if(this.disableTimer<=0){this.isOn&&this.setCurrentAnim("show",true,"on",true);this.disableTimer=0}}this.parent()},varsChanged:function(){var a=this.condition.evaluate();if(a!=this.isOn){this.isOn=a;this.fx.sheet.spawnOnTarget("appear",this);this.setCurrentAnim(this.isOn?
"show":"hide",true,this.isOn?"on":"off",true)}},ballHit:function(a){if(!a.isBall||this.disableBall||a.attackInfo&&a.attackInfo.hasHint("NO_PUZZLE")||!this.condition.evaluate())return false;this.ballTime&&a&&a.resetTime(this.ballTime/a.speedFactor);this.resetBounce&&a&&a.resetBounceCount();if(!this.changerType.onBallTouch(a,this))return false;this.setCurrentAnim("hide",true,"used",true);if(this.changerType.centerBall){var d=ig.CollTools.getCenterXYAlignedPos(b,a.coll,this.coll);a.grabPoint(d)}a.addIgnore(this);
this.changerType.waitForBallKill?this.disableBall=a:this.disableTimer=0.2;return false}});sc.BallChangerType=ig.Class.extend({icon:0,sphereColor:0,flipX:false,flipY:false,centerBall:false,waitForBallKill:false,onBallTouch:function(){}});sc.BALL_CHANGER_TYPE={};sc.BALL_CHANGER_TYPE.CHANGE_DIR=sc.BallChangerType.extend({_wm:new ig.Config({attributes:{dir:{_type:"Face",_info:"Direction to face",_select:ig.ActorEntity.FACE8}}}),dir:Vec2.create(),sound:new ig.Sound("media/sound/puzzle/redirect.ogg",1),
init:function(a){this.centerBall=true;a=ig.ActorEntity.FACE8[a.dir];ig.ActorEntity.getFaceVec(a,this.dir);switch(a){case ig.ActorEntity.FACE8.NORTH:this.icon=0;break;case ig.ActorEntity.FACE8.EAST:this.icon=1;break;case ig.ActorEntity.FACE8.SOUTH:this.icon=0;this.flipY=true;break;case ig.ActorEntity.FACE8.WEST:this.icon=1;this.flipX=true;break;case ig.ActorEntity.FACE8.NORTH_EAST:this.icon=2;break;case ig.ActorEntity.FACE8.SOUTH_EAST:this.icon=2;this.flipY=true;break;case ig.ActorEntity.FACE8.SOUTH_WEST:this.icon=
2;this.flipX=this.flipY=true;break;case ig.ActorEntity.FACE8.NORTH_WEST:this.icon=2;this.flipX=true}},onBallTouch:function(a){if(a.totalTimer<0.07)return false;ig.SoundHelper.playAtEntity(this.sound,a);a.clearIgnored();a.changeDirection(this.dir);return true}});sc.BALL_CHANGER_TYPE.CHANGE_SPEED=sc.BallChangerType.extend({_wm:new ig.Config({attributes:{factor:{_type:"Number",_info:"Relative speed factor",_default:0.5}}}),factor:null,waitForBallKill:true,sound:{speedUp:new ig.Sound("media/sound/puzzle/speed-up.ogg",
1),slowDown:new ig.Sound("media/sound/puzzle/slow-down.ogg",1)},init:function(a){this.factor=a.factor||0.5;this.icon=3},onBallTouch:function(a){var b=sc.options.get("assist-puzzle-speed");if(this.factor>1){ig.SoundHelper.playAtEntity(this.sound.speedUp,a);b=1/b}else this.factor<1&&ig.SoundHelper.playAtEntity(this.sound.slowDown,a);a.resetTime();a.changeSpeed(this.factor*b,true);return true}});sc.BALL_CHANGER_TYPE.RESET_SPEED=sc.BallChangerType.extend({_wm:new ig.Config({attributes:{}}),factor:null,
sound:{reset:new ig.Sound("media/sound/puzzle/reset.ogg",1),speedUp:new ig.Sound("media/sound/puzzle/speed-up.ogg",1),slowDown:new ig.Sound("media/sound/puzzle/slow-down.ogg",1)},init:function(){this.icon=4},onBallTouch:function(a){var b=a.speedFactor;a.resetSpeed()&&(b>1?ig.SoundHelper.playAtEntity(this.sound.slowDown,a):b<1?ig.SoundHelper.playAtEntity(this.sound.speedUp,a):ig.SoundHelper.playAtEntity(this.sound.reset,a));return true}});sc.BALL_CHANGER_TYPE.CHANGE_ELEMENT=sc.BallChangerType.extend({_wm:new ig.Config({attributes:{element:{_type:"String",
_info:"Element to change to",_select:["HEAT","COLD","SHOCK","WAVE"]}}}),element:null,effects:new ig.EffectSheet("puzzle.ball-changer"),fxKey:null,init:function(a){this.element=sc.ELEMENT[a.element];switch(this.element){case sc.ELEMENT.HEAT:this.icon=5;this.sphereColor=1;this.fxKey="heatConvert";break;case sc.ELEMENT.COLD:this.icon=6;this.sphereColor=2;this.fxKey="coldConvert";break;case sc.ELEMENT.SHOCK:this.icon=7;this.sphereColor=3;this.fxKey="shockConvert";break;case sc.ELEMENT.WAVE:this.icon=
8;this.sphereColor=4;this.fxKey="waveConvert"}},onBallTouch:function(a,b){var c=a.getCombatantRoot();if(c.isPlayer){var e=a.attackInfo.hasHint("CHARGED");if(c=sc.PlayerConfig.getElementBall(c,this.element,e)){this.effects.spawnOnTarget(this.fxKey,b,{align:ig.ENTITY_ALIGN.BOTTOM,offset:{z:12}});a.setBallInfo(c.data,true)}}return true}})});ig.baked=!0;
ig.module("game.feature.puzzle.entities.walls").requires("impact.base.entity","impact.feature.effect.effect-sheet").defines(function(){sc.WALL_COLL_TYPES={BLOCK:0,PBLOCK:1,NPBLOCK:2};sc.WALL_HORIZONTAL_ENDS={CONTINUE:0,STOP:1};sc.WALL_VERTICAL_ENDS={CONTINUE:0,STOP:1,CORNER_LEFT:2,CORNER_RIGHT:3};ig.ENTITY.WallBase=ig.Entity.extend({condition:null,active:false,wallCollType:0,wallZHeight:0,wallBlockers:[],skipRender:false,noNavMapBlock:false,init:function(a,b,c,e){this.parent(a,b,c,e);this.coll.size.z=
1;if(!e.size){this.coll.size.x=8;this.coll.size.y=8}this.noNavMapBlock=e.noNavMapBlock||false;this.coll.type=ig.COLLTYPE.BLOCK;this.coll.time.globalStatic=true;this.wallCollType=e.collType||"BLOCK";this.wallZHeight=e.wallZHeight||32;this.condition=new ig.VarCondition(e.condition);this.skipRender=e.skipRender||false;this.active=this.condition.evaluate()},onKill:function(a){this.parent(a)},updateWallBlockers:function(a){for(var b=0;b<this.wallBlockers.length;++b)this.wallBlockers[b].setActive(this.active,
a)},varsChanged:function(){var a=this.condition.evaluate();if(this.active!=a){this.active=a;this.updateWallBlockers()}}});var b={};ig.ENTITY.WallHorizontal=ig.ENTITY.WallBase.extend({gfx:null,patterns:null,leftEnd:0,rightEnd:0,_wm:new ig.Config({spawnable:true,scalableX:true,attributes:{skipRender:{_type:"Boolean",_info:"True if the wall should be invisible",_default:false},leftEnd:{_type:"String",_info:"Left End Type",_select:sc.WALL_HORIZONTAL_ENDS},rightEnd:{_type:"String",_info:"Right End Type",
_select:sc.WALL_HORIZONTAL_ENDS},condition:{_type:"VarCondition",_info:"Condition for wall to be active",_popup:true},collType:{_type:"String",_info:"Collision Types of Wall. BLOCK - Blocks all, PBLOCK - Blocks only projectiles, NPBLOCK - Blocks only non projectiles",_select:sc.WALL_COLL_TYPES},wallZHeight:{_type:"Number",_info:"Total height of the wall, when active",_default:32},noNavMapBlock:{_type:"Boolean",_info:"If true: do not block nav map"}}}),init:function(a,b,c,e){this.parent(a,b,c,e);a=
ig.mapStyle.get("puzzle");this.gfx=new ig.Image(a.sheet);this.patterns=new ig.ImagePatternSheet(a.sheet,ig.ImagePattern.OPT.REPEAT_X,8,16,176,64,1,1);this.leftEnd=sc.WALL_HORIZONTAL_ENDS[e.leftEnd]||sc.WALL_HORIZONTAL_ENDS.CONTINUE;this.rightEnd=sc.WALL_HORIZONTAL_ENDS[e.rightEnd]||sc.WALL_HORIZONTAL_ENDS.CONTINUE},show:function(a){this.parent(a);this.wallBlockers.push(ig.game.spawnEntity("WallBlocker",this.coll.pos.x,this.coll.pos.y,this.coll.pos.z+this.coll.size.z,{size:{x:this.coll.size.x-0-0,
y:8,z:this.wallZHeight},collType:this.wallCollType,skipRender:this.skipRender,noNavMapBlock:this.noNavMapBlock}));this.updateWallBlockers(true)},initSprites:function(){this.setSpriteCount(1+(this.leftEnd?1:0)+(this.rightEnd?1:0))},update:function(){this.parent()},updateSprites:function(){if(!this.skipRender){var a=this.coll,d=this.leftEnd?8:0,c=a.size.x-(this.leftEnd?8:0)-(this.rightEnd?8:0),e=0;if(c>0){this.sprites[e].setPos(a.pos.x+d,a.pos.y,a.pos.z);this.sprites[e].setSize(c,a.size.y,a.size.z,
a.size.y);this.sprites[e].setImageSrc(this.patterns.getPattern(0),0,0);e++}if(this.leftEnd){this.sprites[e].setPos(a.pos.x,a.pos.y,a.pos.z);this.sprites[e].setSize(8,a.size.y,a.size.z,a.size.y);var f=this.gfx.getTileSrc(b,2,8,16,176,64);this.sprites[e].setImageSrc(this.gfx,f.x,f.y);e++}if(this.rightEnd){this.sprites[e].setPos(a.pos.x+c+d,a.pos.y,a.pos.z);this.sprites[e].setSize(8,a.size.y,a.size.z,a.size.y);f=this.gfx.getTileSrc(b,3,8,16,176,64);this.sprites[e].setImageSrc(this.gfx,f.x,f.y)}}}});
ig.ENTITY.WallVertical=ig.ENTITY.WallBase.extend({gfx:null,patterns:null,topEnd:0,bottomEnd:0,_wm:new ig.Config({spawnable:true,scalableY:true,attributes:{skipRender:{_type:"Boolean",_info:"True if the wall should be invisible",_default:false},topEnd:{_type:"String",_info:"Top End Type",_select:sc.WALL_VERTICAL_ENDS},bottomEnd:{_type:"String",_info:"Bottom End Type",_select:sc.WALL_VERTICAL_ENDS},condition:{_type:"VarCondition",_info:"Condition for wall to be active",_popup:true},collType:{_type:"String",
_info:"Collision Types of Wall. BLOCK - Blocks all, PBLOCK - Blocks only projectiles, NPBLOCK - Blocks only non projectiles",_select:sc.WALL_COLL_TYPES},wallZHeight:{_type:"Number",_info:"Total height of the wall, when active",_default:32},noNavMapBlock:{_type:"Boolean",_info:"If true: do not block nav map"}}}),init:function(a,b,c,e){this.parent(a,b,c,e);a=ig.mapStyle.get("puzzle");this.gfx=new ig.Image(a.sheet);this.patterns=new ig.ImagePatternSheet(a.sheet,ig.ImagePattern.OPT.REPEAT_Y,8,16,184,
64,1,1);this.topEnd=sc.WALL_VERTICAL_ENDS[e.topEnd]||sc.WALL_VERTICAL_ENDS.CONTINUE;this.bottomEnd=sc.WALL_VERTICAL_ENDS[e.bottomEnd]||sc.WALL_VERTICAL_ENDS.CONTINUE},show:function(a){this.parent(a);this.wallBlockers.push(ig.game.spawnEntity("WallBlocker",this.coll.pos.x+0,this.coll.pos.y+0,this.coll.pos.z+this.coll.size.z,{size:{x:8,y:this.coll.size.y-0-0,z:this.wallZHeight},collType:this.wallCollType,skipRender:this.skipRender,noNavMapBlock:this.noNavMapBlock}));this.updateWallBlockers(true)},initSprites:function(){this.setSpriteCount(1+
(this.topEnd?1:0)+(this.bottomEnd?1:0))},update:function(){this.parent()},updateSprites:function(){if(!this.skipRender){var a=this.coll,d=this.topEnd?9:1,c=a.size.y-(this.topEnd?8:0)-(this.bottomEnd?8:0),e=0;if(c>0){this.sprites[e].setPos(a.pos.x,a.pos.y+d,a.pos.z);this.sprites[e].setSize(a.size.x,c,a.size.z,0);this.sprites[e].setImageSrc(this.patterns.getPattern(0),0,0);e++}if(this.topEnd){var f=0;switch(this.topEnd){case sc.WALL_VERTICAL_ENDS.STOP:f=f+5;break;case sc.WALL_VERTICAL_ENDS.CORNER_LEFT:f=
f+4;break;case sc.WALL_VERTICAL_ENDS.CORNER_RIGHT:f=f+6}f=this.gfx.getTileSrc(b,f,8,16,176,64);this.sprites[e].setPos(a.pos.x,a.pos.y,a.pos.z);this.sprites[e].setSize(a.size.x,8,a.size.z,8);this.sprites[e].setImageSrc(this.gfx,f.x,f.y);e++}if(this.bottomEnd){f=0;switch(this.bottomEnd){case sc.WALL_VERTICAL_ENDS.STOP:f=f+8;break;case sc.WALL_VERTICAL_ENDS.CORNER_LEFT:f=f+7;break;case sc.WALL_VERTICAL_ENDS.CORNER_RIGHT:f=f+9}f=this.gfx.getTileSrc(b,f,8,16,176,64);this.sprites[e].setPos(a.pos.x,a.pos.y+
c+d,a.pos.z);this.sprites[e].setSize(a.size.x,8,a.size.z,8);this.sprites[e].setImageSrc(this.gfx,f.x,f.y)}}}});ig.ENTITY.WallBlocker=ig.Entity.extend({maxHeight:0,colorGfx:null,maxAlpha:0.76,timer:0,MOVE_TIME:0.3,GLOW_TIME:0.1,skipRender:false,navBlocker:null,noNavMapBlock:false,effectPattern:null,_wm:new ig.Config({spawnable:false,attributes:{collType:{_type:"String",_info:"Top End Type",_select:ig.COLLTYPE}}}),init:function(a,b,c,e){this.parent(a,b,c,e);this.coll.type=ig.COLLTYPE.BLOCK;this.coll.time.globalStatic=
true;this.noNavMapBlock=e.noNavMapBlock;if(!ig.system.limitSoundUse)this.sounds={goUp:new ig.Sound("media/sound/puzzle/barrier-up.ogg",0.9,false),goDown:new ig.Sound("media/sound/puzzle/barrier-down.ogg",0.9,false)};this.skipRender=e.skipRender||false;this.coll.type=ig.COLLTYPE[e.collType];a=ig.mapStyle.get("walls").colors;c=b="#fff";switch(e.collType){case "BLOCK":c=a.blockFront;b=a.blockTop;this.coll.type=ig.COLLTYPE.FENCE;break;case "PBLOCK":c=a.pBlockFront;b=a.pBlockTop;break;case "NPBLOCK":c=
a.npBlockFront;b=a.npBlockTop;this.coll.type=ig.COLLTYPE.NPFENCE}this.colorGfx=new ig.DoubleColor(new ig.TransitionColor(b,"white"),new ig.TransitionColor(c,"white"));this.maxAlpha=ig.mapStyle.get("walls").alpha||0.76;this.effectPattern=new ig.ImagePatternSheet("media/entity/objects/object-effects.png",ig.ImagePattern.OPT.REPEAT_X_AND_Y,16,16,176,0,1,1);this.maxHeight=this.coll.size.z},onKill:function(a){this.navBlocker&&this.navBlocker.remove();this.effectPattern.decreaseRef();this.parent(a)},initSprites:function(){this.setSpriteCount(2)},
update:function(){if(this.timer>0)this.timer=this.timer-ig.system.tick},updateSprites:function(){if(!this.skipRender){var a=this.coll,b=this.sprites[0],c=this.sprites[1];if(a.size.z==0&&this.timer<=0){b.setImageSrc(null);c.setImageSrc(null)}else{var e=0,f=0;if(this.timer>0){e=((this.timer-(a.size.z?this.GLOW_TIME:0))/this.MOVE_TIME).limit(0,1);e=KEY_SPLINES[a.size.z?"EASE_IN":"EASE_OUT"].get(e);f=((this.timer-(a.size.z?0:this.MOVE_TIME))/this.GLOW_TIME).limit(0,1);a.size.z||(f=1-f)}this.colorGfx.color1.setColorBWeight(f);
this.colorGfx.color2.setColorBWeight(f);f=a.size.z?(1-e)*this.maxHeight:e*this.maxHeight;e=(a.size.z?1-e:e)*this.maxAlpha;b.setPos(a.pos.x,a.pos.y,a.pos.z);b.setSize(a.size.x,a.size.y,f);b.setImageSrc(this.colorGfx);b.aboveZ=1;b.setAlpha(e);c.setPos(a.pos.x,a.pos.y,a.pos.z);c.setSize(a.size.x,a.size.y,f);c.setAlpha(e);c.aboveZ=1;c.renderMode="lighter";b=a.pos.x+ig.game.backgroundAnimTimer*16;a=a.pos.y-a.pos.z-a.size.z+ig.game.backgroundAnimTimer*16;c.setImageSrc(this.effectPattern.getPattern(0),b,
a)}}},setActive:function(a,b){this.setSize(this.coll.size.x,this.coll.size.y,a?this.maxHeight:0);if(a&&!this.navBlocker&&!this.noNavMapBlock)this.navBlocker=ig.navigation.getNavBlock(this);else if(!a&&this.navBlocker){this.navBlocker.remove();this.navBlocker=null}if(!b){this.timer=this.GLOW_TIME+this.MOVE_TIME;this.sounds&&(a?ig.SoundHelper.playAtEntity(this.sounds.goUp,this):ig.SoundHelper.playAtEntity(this.sounds.goDown,this))}}})});ig.baked=!0;
ig.module("game.feature.puzzle.entities.glowing-line").requires("impact.base.entity").defines(function(){ig.ENTITY.GlowingLine=ig.Entity.extend({patterns:null,timer:0,glowing:false,_wm:new ig.Config({spawnable:true,attributes:{condition:{_type:"VarCondition",_info:"Condition on which the line will glow"}},scalableX:true,scalableY:true,scalableStep:16,label:function(){return""}}),init:function(b,a,d,c){this.parent(b,a,d,c);this.coll.type=ig.COLLTYPE.NONE;this.coll.time.globalStatic=true;c.size||this.coll.setSize(8,
8,0);b=ig.mapStyle.get("puzzle");this.patterns=new ig.ImagePatternSheet(b.sheet,ig.ImagePattern.OPT.REPEAT_X_OR_Y,16,16,176,80,4,1);this.condition=new ig.VarCondition(c.condition);this.glowing=this.condition.evaluate()},initSprites:function(){this.setSpriteCount(1)},update:function(){if(this.timer>0)this.timer=this.timer-ig.system.tick},updateSprites:function(){var b=this.glowing?3:0;this.timer>0&&(b=b-Math.min(2,Math.floor(this.timer/0.05)));var a=this.coll,d=this.sprites[0];d.setPos(a.pos.x,a.pos.y,
a.pos.z);d.setSize(a.size.x,a.size.y,a.size.z);d.setImageSrc(this.patterns.getPattern(b),0,0)},varsChanged:function(){var b=this.condition&&this.condition.evaluate();if(b&&!this.glowing){this.glowing=true;this.timer=0.25}else if(!b&&this.glowing){this.glowing=false;this.timer=0}}})});ig.baked=!0;
ig.module("game.feature.puzzle.entities.lorry").requires("impact.base.entity","impact.feature.effect.effect-sheet","impact.base.actor-entity").defines(function(){sc.LORRY_TYPES={};sc.LORRY_MOVE_TYPES={PERMA_MOVE:{perma:true},ON_TOUCH_PERMA_MOVE:{onTouchStart:true},ON_TOUCH_MOVE_ONCE:{onTouchStart:true,onPauseFreeStop:true},WHILE_TOUCH_MOVE:{onTouchStart:true,onFreeStop:true,onPauseFreeStop:true}};sc.LORRY_SPEED={};sc.LORRY_SPEED.SLOW=60;sc.LORRY_SPEED.DEFAULT=90;sc.LORRY_SPEED.FAST=120;sc.LORRY_SPEED.FASTER=
180;sc.LORRY_SPEED.FASTEST=240;var b=Vec3.create(),a=Vec3.create(),d=new ig.EffectSheet("puzzle.lorry");ig.ENTITY.Lorry=ig.AnimatedEntity.extend({lorryType:null,respawnTimer:0,moveType:null,initDir:Vec2.create(),moving:false,maxSpeed:0,currentSpeed:0,slowDownAccel:0,pauseTimer:0,lightHandle:null,bombSnap:true,fxHandle:null,moveDest:{prevRail:null,currentRail:null,nextRail:null,points:[],pointIdx:0},_wm:new ig.Config({spawnable:true,attributes:{spawnCondition:{_type:"VarCondition",_info:"Condition for Enemy to spawn",
_popup:true},lorryType:{_type:"String",_info:"Type/Size of the Lorry",_select:sc.LORRY_TYPES},moveType:{_type:"String",_info:"How the platform moves",_select:sc.LORRY_MOVE_TYPES},initDir:{_type:"String",_info:"The initial direction of the platform",_select:ig.ActorEntity.FACE4},speed:{_type:"String",_info:"Speed of lorry",_select:sc.LORRY_SPEED},moveCondition:{_type:"VarCondition",_info:"Additional condition for lorry to move",_optional:true},fastMode:{_type:"Boolean",_info:"Make sure puzzle element is not slowed down by assist mode"}}}),
init:function(a,b,d,g){this.parent(a,b,d,g);this.coll.type=ig.COLLTYPE.BLOCK;this.moveType=sc.LORRY_MOVE_TYPES[g.moveType]||sc.LORRY_MOVE_TYPES.PERMA_MOVE;ig.ActorEntity.getFaceVec(ig.ActorEntity.FACE4[g.initDir],this.initDir);this.maxSpeed=sc.LORRY_SPEED[g.speed]||sc.LORRY_SPEED.DEFAULT;this.moveCondition=new ig.VarCondition(g.moveCondition||null);this.fastMode=g.fastMode||false;a=ig.mapStyle.get("lorry");if(this.lorryType=g=sc.LORRY_TYPES[g.lorryType]){this.coll.setSize(g.size.x,g.size.y,g.size.z);
this.initAnimations({sheet:{src:a.sheet,width:g.gfx.w,height:g.gfx.h,xCount:g.gfx.xCount,offX:a.lorryX+g.gfx.x,offY:a.lorryY+g.gfx.y},SUB:[{name:"off",time:1,frames:[0],repeat:false},{name:"on",time:1,frames:[1],repeat:false}]})}this.moveType.perma&&(!window.wm&&this.moveCondition.evaluate())&&this.setMove(true,true)},show:function(a){this.parent(a);if(!a){this.animState.alpha=0;d.spawnOnTarget("lorryAppear",this,{align:"TOP"})}},resetPos:function(a,e){var f=this.getAlignedPos(ig.ENTITY_ALIGN.TOP,
b);d.spawnFixed("lorryDisappear",f.x,f.y,f.z);this.setPos(a.x,a.y,a.z);this.grabRail(e);this.setMove(false,true);this.pauseTimer=this.slowDownAccel=this.currentSpeed=this.animState.alpha=0;d.spawnOnTarget("lorryAppear",this,{align:"TOP"})},setMove:function(a,b){this.moving=a;this.setCurrentAnim(this.moving?"on":"off");if(this.moving&&!this.lightHandle){this.fxHandle=d.spawnOnTarget("lorryRuns",this,{duration:-1});this.lightHandle=new ig.LightHandle(this,ig.LIGHT_SIZE.XL,0.2,0.2,-1,1);ig.light.addLightHandle(this.lightHandle);
b||d.spawnOnTarget("lorryActivate",this,{align:"TOP"})}else if(!this.moving&&this.lightHandle){this.fxHandle&&this.fxHandle.stop();this.lightHandle.stop();this.lightHandle=null;b||d.spawnOnTarget("lorryDeactivate",this,{align:"TOP"})}},update:function(){this.moveDest.currentRail||this.grabRail(this.initDir);if(this.moving)if(this.pauseTimer>0){this.pauseTimer=this.pauseTimer-ig.system.tick;if(this.pauseTimer<=0)this.pauseTimer=0;if(this.moveType.onPauseFreeStop){var a=ig.game.getEntitiesOnTop(this);
a.indexOf(ig.game.playerEntity)==-1&&this.setMove(false)}}else{this.moveLorry();if(this.moveType.onFreeStop){a=ig.game.getEntitiesOnTop(this);if(a.indexOf(ig.game.playerEntity)==-1){this.currentSpeed=0;this.setMove(false)}}}this.parent()},moveLorry:function(){var c=this.getAlignedPos(ig.ENTITY_ALIGN.BOTTOM,b),d=this.moveDest,f;f=this.maxSpeed*(this.fastMode?1:sc.options.get("assist-puzzle-speed"));if(!this.slowDownAccel&&this.currentSpeed>=f||this.slowDownAccel&&this.currentSpeed<=15){this.currentSpeed=
this.currentSpeed.limit(15,f);f=this.currentSpeed*ig.system.tick}else{var g=this.slowDownAccel?-this.slowDownAccel:f*2;f=this.currentSpeed*ig.system.tick+g*ig.system.tick*ig.system.tick;this.currentSpeed=this.currentSpeed+g*ig.system.tick}for(g=false;f;){var h=d.points[d.pointIdx],i=Vec3.sub(h,c,a),j=Vec3.length(i);if(j<=f){f=f-j;Vec3.assign(c,h);if(!this.stepPoint()){f=0;g=true}}else{Vec3.length(i,f);Vec3.add(c,i);f=0}}f=this.coll;f.setPos(c.x-f.size.x/2,c.y-f.size.y/2,c.z,true);if(g){this.slowDownAccel=
0;this.flip();this.pauseTimer=1}else if(!this.slowDownAccel){f=this.currentSpeed*0.5;c=d.currentRail.getGoalDistance(c,d.prevRail,f);if(c<f)this.slowDownAccel=0.5*this.currentSpeed*this.currentSpeed/c}},collideWith:function(a){if(this.moveCondition.evaluate()&&this.moveType.onTouchStart&&a.isPlayer&&!this.moving){this.pauseTimer=0.4;this.setMove(true)}},varsChanged:function(){var a=this.moveCondition.evaluate();if(!a&&this.moving){this.currentSpeed=0;this.setMove(false)}else if(a&&!this.moving){a=
ig.game.getEntitiesOnTop(this);if(!this.moveType.onTouchStart||a.indexOf(ig.game.playerEntity)!=-1){this.pauseTimer=0.4;this.setMove(true)}}},stepPoint:function(){var a=this.moveDest;if(a.pointIdx<a.points.length-1){a.pointIdx++;return true}if(a.nextRail){var b=a.points.last();a.nextRail.getPoints(a,b);return true}return false},flip:function(){for(var a=this.moveDest,b=[],d=a.points.length;d--;)b.push(a.points[d]);a.points=b;a.pointIdx=b.length-a.pointIdx;b=a.prevRail;a.prevRail=a.nextRail;a.nextRail=
b},grabRail:function(a){for(var d=this.getAlignedPos(ig.ENTITY_ALIGN.BOTTOM,b),f=ig.game.getEntitiesInRectangle(d.x-1,d.y-1,d.z-1,2,2,2,this),g=f.length;g--;)f[g]instanceof ig.ENTITY.LorryRail&&f[g].getInitialPoints(this.moveDest,d,a)},applyMarkerPosition:function(a){a.coll.level=this.coll.level;a.coll.pos.z=a.coll.baseZPos=this.coll.baseZPos+this.coll.size.z;a.face.x=this.initDir.x;a.face.y=this.initDir.y;a.setPos(this.coll.pos.x+this.coll.size.x/2-a.coll.size.x/2,this.coll.pos.y+this.coll.size.y/
2-a.coll.size.y/2);this.setMove(true,true);this.currentSpeed=this.maxSpeed*(this.fastMode?1:sc.options.get("assist-puzzle-speed"))}});ig.ENTITY.LorryRespawner=ig.AnimatedEntity.extend({lorrySrc:null,lorry:null,initDir:Vec2.create(),lastAlpha:0,_wm:new ig.Config({spawnable:true,attributes:{spawnCondition:{_type:"VarCondition",_info:"Condition for Enemy to spawn",_popup:true},lorryEntity:{_type:"Entity",_info:"The lorry entity to be respawned at this point"},initDir:{_type:"String",_info:"The initial direction of the platform",
_select:ig.ActorEntity.FACE4}},drawBox:true,boxColor:"rgba(0,255,255, 0.5)"}),init:function(a,b,d,g){this.parent(a,b,d,g);this.coll.type=ig.COLLTYPE.NONE;this.coll.setSize(32,32,0);ig.ActorEntity.getFaceVec(ig.ActorEntity.FACE4[g.initDir],this.initDir);this.lorrySrc=g.lorryEntity;this.lastAlpha=0},fetchLorry:function(){if((this.lorry=ig.Event.getEntity(this.lorrySrc))&&this.lorry.lorryType){var a=ig.mapStyle.get("lorry"),b=this.lorry.lorryType;if(b){var d=this.coll,g=b.size.x-this.coll.size.x,h=b.size.y-
this.coll.size.y;d.setSize(b.size.x,b.size.y,0);this.initAnimations({sheet:{src:a.sheet,width:b.gfx.w-2,height:b.gfx.h-2,offX:a.lorryX+b.gfx.x+1,offY:a.lorryY+b.gfx.y+1+b.gfx.h*2},renderMode:"lighter",SUB:[{name:"default",time:1,frames:[0],repeat:false}]});this.setPos(d.pos.x-g/2,d.pos.y-h/2,d.pos.z)}}},update:function(){this.lorry||this.fetchLorry();if(this.lorry){var a=1,b=ig.game.playerEntity;ig.EntityTools.getGroundEntity(b)==this.lorry&&(a=0);var d=ig.CollTools.getGroundDistance(this.coll,this.lorry.coll);
!this.lorry.moving&&d>48&&(d=200);d<48?a=0:d<200&&(a=a*((d-48)/152));var a=KEY_SPLINES.EASE_OUT.get(a),g=ig.system.tick*10;this.lastAlpha=g*a+this.lastAlpha*(1-g);this.animState.alpha=this.lastAlpha;this.animState.scaleX=this.lastAlpha;this.animState.scaleY=this.lastAlpha;a=ig.CollTools.getGroundDistance(b.coll,this.coll);if(d>=200&&a<=48){this.lorry.resetPos(this.coll.pos,this.initDir);d=b.coll;this.lorry.coll.intersectsWith(d.pos.x,d.pos.y,d.pos.z,d.size.x,d.size.y,d.size.z)&&b.setPos(d.pos.x,d.pos.y,
d.pos.z+this.lorry.coll.size.z)}}this.parent()}});sc.LORRY_TYPES.BIG={size:{x:48,y:48,z:2},gfx:{x:0,y:0,w:48,h:48,xCount:1}};sc.LORRY_RAIL_TYPES={};ig.ENTITY.LorryRail=ig.AnimatedEntity.extend({entries:[],currentEntry:null,connectedNeighbours:false,_wm:new ig.Config({spawnable:true,attributes:{spawnCondition:{_type:"VarCondition",_info:"Condition for Enemy to spawn",_popup:true},railType:{_type:"String",_info:"Type of rail",_select:sc.LORRY_RAIL_TYPES},altTypes:{_type:"LorryAltTypes",_info:"Other types depending on var conditions",
_optional:true}}}),init:function(a,b,d,g){this.parent(a,b,d,g);this.coll.type=ig.COLLTYPE.TRIGGER;g.size||this.coll.setSize(16,16,0);if((a=sc.LORRY_RAIL_TYPES[g.railType])&&(a.scaleX||a.scaleY)){(!a.scaleX&&this.coll.size.x!=16||!a.scaleY&&this.coll.size.y!=16)&&this.coll.setSize(16,16,0);if(window.wm){this._wm=this._wm.copy();this._wm.scalableX=a.scaleX;this._wm.scalableY=a.scaleY;this._wm.scalableStep=16}}else this.coll.setSize(a.gfx.w?a.gfx.w:16,16,0);this.pushEntry(g.railType,null);if(g.altTypes){g=
g.altTypes;for(a=0;a<g.length;++a)this.pushEntry(g[a].railType,new ig.VarCondition(g[a].condition))}this.updateEntry(true)},initSprites:function(){this.setSpriteCount(this.entries.length)},show:function(a){this.parent(a);if(!a){this.animState.alpha=0;d.spawnOnTarget("railAppear",this)}},connectNeighbours:function(){if(!this.connectedNeighbours){for(var a=this.entries.length;a--;)this.connectNeighboursForEntry(this.entries[a]);this.connectedNeighbours=true}},connectNeighboursForEntry:function(a){if(a)for(var b=
2;b--;){for(var d=a.points[b?0:a.points.length-1],d=ig.game.getEntitiesInRectangle(d.x-1,d.y-1,d.z-1,2,2,2,this),g=null,h=d.length;h--;)d[h]instanceof ig.ENTITY.LorryRail&&(g=d[h]);a.neighbours.push(g)}},pushEntry:function(a,b){var d={condition:b,sheet:null,patternSheet:null,points:[],neighbours:[]},g=ig.mapStyle.get("lorry"),h=sc.LORRY_RAIL_TYPES[a];if(g&&h){h.scaleX||h.scaleY?d.patternSheet=new ig.ImagePatternSheet(g.sheet,h.scaleX?ig.ImagePattern.OPT.REPEAT_X:ig.ImagePattern.OPT.REPEAT_Y,16,16,
g.railX+h.gfx.x,g.railY+h.gfx.y,1,1):d.sheet={gfx:new ig.Image(g.sheet),x:g.railX+h.gfx.x,y:g.railY+h.gfx.y,w:h.gfx.w||16,h:16};g=h.points;for(h=0;h<g.length;++h){var i=g[h],j=Vec3.create(this.coll.pos);j.x=j.x+this.coll.size.x*i.x;j.y=j.y+this.coll.size.y*i.y;j.z=j.z+this.coll.size.z*(i.z||0);d.points.push(j)}}this.entries.push(d)},getInitialPoints:function(b,d,f){this.connectNeighbours();var g=this.currentEntry,d=Vec3.sub(g.points[0],d,a);Vec2.dot(d,f)<=0?this._transferPoints(b,g,false):this._transferPoints(b,
g,true)},getGoalDistance:function(a,b,d){this.connectNeighbours();for(var g=this.currentEntry,h,i,j=-1;j<this.entries.length;++j){g=j==-1?this.currentEntry:this.entries[j];if(!(j!=-1&&g==this.currentEntry))if(g.neighbours[0]==b){h=g.points.last();i=g.neighbours[1]}else if(g.neighbours[1]==b){h=g.points[0];i=g.neighbours[0]}}if(!h)return 0;a=Vec3.distance(a,h);return a<d&&i?a+i.getGoalDistance(h,this,d-a):a},getPoints:function(a,b){this.connectNeighbours();var d;d=this._getPointsForEntry(a,this.currentEntry,
b,-1);if(d!=0)for(var g=this.entries.length;g--;){d=this._getPointsForEntry(a,this.entries[g],b,d);if(d==0)break}},_getPointsForEntry:function(a,b,d,g){var h=Vec3.distance(d,b.points[0]),d=Vec3.distance(d,b.points.last());if(h<=d&&(g==-1||h<g)){this._transferPoints(a,b,false);return h}if(d<h&&(g==-1||d<g)){this._transferPoints(a,b,true);return d}return g},_transferPoints:function(a,b,d){a.currentRail=this;a.pointIdx=1;if(d){a.prevRail=b.neighbours[1];a.nextRail=b.neighbours[0];a.points.length=0;for(d=
b.points.length;d--;)a.points.push(b.points[d])}else{a.prevRail=b.neighbours[0];a.nextRail=b.neighbours[1];a.points.length=0;a.points.push.apply(a.points,b.points)}},updateEntry:function(a){for(var b=this.entries.length;b--;){var f=this.entries[b];if(!f.condition||f.condition.evaluate()){if(this.currentEntry!=f){a||d.spawnOnTarget("railSwitch",this);this.currentEntry=f}break}}},update:function(){this.connectNeighbours();this.parent()},onKill:function(a){this.parent(a);for(a=this.entries.length;a--;){var b=
this.entries[a];b.patternSheet&&b.patternSheet.decreaseRef();b.sheet&&b.sheet.gfx.decreaseRef()}},setEntrySprite:function(a,b){var d=this.coll;b.sheet?a.setEntityDefault(this,b.sheet.w,b.sheet.h,"NO_EXPAND",0,null,b.sheet.gfx,b.sheet.x,b.sheet.y):b.patternSheet&&a.setEntityDefault(this,d.size.x,d.size.y,"NO_EXPAND",0,null,b.patternSheet.getPattern(0),0,0);a.setPivot(d.size.x/2,d.size.y/2);a.setPivot(d.size.x/2,d.size.y/2);a.setTransform(1,1,this.animState.angle);a.setAlpha(this.animState.alpha);this.animState.updateSpriteColor(this)},
updateSprites:function(){var a=0.4,b=this.sprites.length-1,d=this.entries.length,g=this.sprites[b--];for(this.setEntrySprite(g,this.currentEntry);d--;)if(this.entries[d]!=this.currentEntry){g=this.sprites[b--];this.setEntrySprite(g,this.entries[d]);g.setAlpha(g.alpha*a);a=a*0.4}},varsChanged:function(){this.updateEntry()}});sc.LORRY_RAIL_TYPES.HORIZONTAL={gfx:{x:32,y:0},scaleX:true,points:[{x:0,y:0.5},{x:1,y:0.5}]};sc.LORRY_RAIL_TYPES.VERTICAL={gfx:{x:32,y:16},scaleY:true,points:[{x:0.5,y:0},{x:0.5,
y:1}]};sc.LORRY_RAIL_TYPES.CURVE_SE={gfx:{x:0,y:0},points:[{x:1,y:0.5},{x:0.5,y:1}]};sc.LORRY_RAIL_TYPES.CURVE_SW={gfx:{x:16,y:16},points:[{x:0,y:0.5},{x:0.5,y:1}]};sc.LORRY_RAIL_TYPES.CURVE_NE={gfx:{x:0,y:16},points:[{x:0.5,y:0},{x:1,y:0.5}]};sc.LORRY_RAIL_TYPES.CURVE_NW={gfx:{x:16,y:0},points:[{x:0.5,y:0},{x:0,y:0.5}]};sc.LORRY_RAIL_TYPES.DIAG1={gfx:{x:0,y:0,w:32},points:[{x:0.75,y:0},{x:0.25,y:1}]};sc.LORRY_RAIL_TYPES.DIAG2={gfx:{x:0,y:16,w:32},points:[{x:0.25,y:0},{x:0.75,y:1}]};sc.LORRY_RAIL_TYPES.HORIZONTAL_SWITCH=
{gfx:{x:32,y:32},scaleX:true,points:[{x:0,y:0.5},{x:1,y:0.5}]};sc.LORRY_RAIL_TYPES.VERTICAL_SWITCH={gfx:{x:32,y:48},scaleY:true,points:[{x:0.5,y:0},{x:0.5,y:1}]};sc.LORRY_RAIL_TYPES.CURVE_SE_SWITCH={gfx:{x:0,y:32},points:[{x:1,y:0.5},{x:0.5,y:1}]};sc.LORRY_RAIL_TYPES.CURVE_SW_SWITCH={gfx:{x:16,y:32},points:[{x:0,y:0.5},{x:0.5,y:1}]};sc.LORRY_RAIL_TYPES.CURVE_NE_SWITCH={gfx:{x:0,y:48},points:[{x:0.5,y:0},{x:1,y:0.5}]};sc.LORRY_RAIL_TYPES.CURVE_NW_SWITCH={gfx:{x:16,y:48},points:[{x:0.5,y:0},{x:0,y:0.5}]};
sc.LORRY_RAIL_TYPES.STOP_WEST={gfx:{x:48,y:0},points:[{x:1,y:0.5},{x:0.5,y:0.5}]};sc.LORRY_RAIL_TYPES.STOP_EAST={gfx:{x:48,y:16},points:[{x:0,y:0.5},{x:0.5,y:0.5}]};sc.LORRY_RAIL_TYPES.STOP_SOUTH={gfx:{x:48,y:32},points:[{x:0.5,y:0},{x:0.5,y:0.5}]};sc.LORRY_RAIL_TYPES.STOP_NORTH={gfx:{x:48,y:48},points:[{x:0.5,y:1},{x:0.5,y:0.5}]}});ig.baked=!0;
ig.module("game.feature.puzzle.entities.ferro").requires("impact.base.entity","impact.base.actor-entity","impact.feature.effect.effect-sheet").defines(function(){function b(a,b){for(var c=a.coll,c=ig.game.getEntitiesInRectangle(c.pos.x-2,c.pos.y-2,c.pos.z-0,c.size.x+4,c.size.y+4,2,this),d=c.length;d--;){var e=c[d];(e instanceof ig.ENTITY.FerroLine||e instanceof ig.ENTITY.FerroRespawner)&&(!e.spot&&!e.spotSetting)&&e.assignFerroSpot(b)}}var a=Vec2.create(),d=Vec3.create(),c=null,e=null,f=null;ig.ENTITY.FerroSpot=
ig.AnimatedEntity.extend({state:0,reached:false,source:false,ferro:null,searched:false,effects:{sheet:new ig.EffectSheet("puzzle.ferro"),handle:null},_wm:new ig.Config({spawnable:true,attributes:{source:{_type:"Boolean",_info:"If true: is source of Ferro"},variable:{_type:"VarName",_info:"Variable set to true when spot is reached by ferro element. When source: Only spawn if variable is set to true.",_optional:true},activeCondition:{_type:"VarCondition",_info:"Condition for FerroSpot to be active. Source spot disabled: will temporary disable all spots but keep reach state. Other spots disabled: will set reached to false ",
_popup:true}}}),init:function(a,b,c,d){this.parent(a,b,c,d);this.coll.type=ig.COLLTYPE.TRIGGER;this.coll.setSize(32,32,24);this.source=d.source;this.variable=d.variable;this.activeCondition=new ig.VarCondition(d.activeCondition);if(this.source&&!window.wm)e?this.source=false:e=this;this.reached=this.variable?ig.vars.get(this.variable):this.source;a=ig.mapStyle.get("ferro");b=0;a&&a.space&&(b=72);this.initAnimations({namedSheets:{floor:{src:"media/entity/objects/ferro.png",width:32,height:32,xCount:3,
offX:0,offY:280+b},glow:{src:"media/entity/objects/ferro.png",width:24,height:24,xCount:2,offX:96,offY:328}},repeat:true,SUB:[{sheet:"floor",frames:[0],time:0.2,tileOffset:0,size:{x:32,y:32,z:0},wallY:0,SUB:[{name:"off"},{name:"on",tileOffset:2},{name:"respawn",tileOffset:2},{name:"standby",tileOffset:1}]},{sheet:"glow",frames:[0],time:0.2,tileOffset:0,renderMode:"lighter",SUB:[{name:"on",tileOffset:0,offset:{y:-6},size:{x:24,y:0,z:24}},{name:"on",tileOffset:1,offset:{y:-16},size:{x:24,y:8,z:16},
wallY:1}]}]});this.isActive()&&(this.source?this.setCarry(true):this.setStandby(true))},show:function(a){this.parent(a);if(!a){this.animState.alpha=0;ig.game.effects.teleport.spawnOnTarget("showQuick",this,{})}this.source&&this.state===1&&(c||this.spawnFerro(a))},onKill:function(a){e===this&&(e=null);f==this&&(f=null);this.parent(a)},spawnFerro:function(b){var c=this.getCenter(a);this.ferro=ig.game.spawnEntity(sc.FerroEntity,c.x-8,c.y-8,this.coll.pos.z+12,{spot:this});this.showPermaFx();b||this.effects.sheet.spawnOnTarget("appear",
this.ferro,{})},isActive:function(){return!this.reached||this.source&&!this.activeCondition.evaluate()||!this.source&&e&&!e.isActive()?false:true},showPermaFx:function(){this.clearPermaFx();this.effects.handle=this.effects.sheet.spawnOnTarget("spotActive",this,{duration:-1})},clearPermaFx:function(){if(this.effects.handle){this.effects.handle.stop();this.effects.handle=null}},setOff:function(){this.state=0;this.setCurrentAnim("off")},setCarry:function(a){this.variable&&!ig.vars.get(this.variable)&&
ig.vars.set(this.variable,true);this.reached=true;a||this.effects.sheet.spawnOnTarget(this.state==0?"spotActivate":"spotTouch",this);this.state=1;this.setCurrentAnim("on")},setStandby:function(a){a||this.effects.sheet.spawnOnTarget("spotRelease",this);this.reached=true;this.state=2;this.setCurrentAnim("standby");this.checkNonSourceInactive()},setRespawn:function(){this.state=3;this.setCurrentAnim("respawn")},update:function(){if(!this.searched){b(this,this);this.searched=true}if(this.state==1&&this.ferro){var c=
ig.CollTools.getDistVec2(this.coll,this.ferro.coll,a);if(Math.abs(c.x)>28||Math.abs(c.y)>28){this.setStandby();this.ferro=null}}this.parent()},ballHit:function(b){if(this.state!=1&&b instanceof sc.FerroEntity){if(b.state==k.RESPAWN&&b.lastSpot!=this)return false;var c=ig.CollTools.getDistVec2(b.coll,this.coll,a);if(Vec2.dot(c,b.coll.vel)<0)return false;if(this.state==0)b.ignoreTimer=0.5;this.setCarry();this.ferro=b;b.assignSpot(this);return true}return false},varsChanged:function(){if(this.isActive()&&
this.state===0)if(this.source){var a=f||this;a.setCarry();a.spawnFerro();a!==this&&this.setStandby()}else this.setStandby();else if(!this.isActive()&&this.state!==0){this.setOff();this.source&&c&&c.remove()}this.checkNonSourceInactive()},checkNonSourceInactive:function(){if(!this.source&&!this.activeCondition.evaluate()&&this.state!==1){this.state===2&&this.setOff();f===this&&(f=e);c&&c.lastSpot==this&&c.assignSpot(e);this.reached=false}}});var g=[0],h=[1,2,3,4],i=[5,6,7],j=[1];ig.ENTITY.FerroLine=
ig.Entity.extend({patterns:null,spotSetting:null,spot:null,state:null,timer:0,currentAnim:g,_wm:new ig.Config({spawnable:true,attributes:{spot:{_type:"Entity",_info:"FerroSpot connected to line",_optional:true}},scalableX:true,scalableY:true,scalableStep:8,label:function(){return""}}),init:function(a,b,c,d){this.parent(a,b,c,d);this.coll.type=ig.COLLTYPE.TRIGGER;this.coll.time.globalStatic=true;d.size||this.coll.setSize(8,8,0);this.spotSetting=d.spot;this.patterns=new ig.ImagePatternSheet("media/entity/objects/ferro.png",
ig.ImagePattern.OPT.REPEAT_X_OR_Y,8,8,96,280,4,2)},initSprites:function(){this.setSpriteCount(1)},assignFerroSpot:function(a){this.spot=a;this.state=this.spot.state;this.updateAnim(true);b(this,a)},update:function(){this.spotSetting&&!this.spot&&this.assignFerroSpot(ig.Event.getEntity(this.spotSetting));if(this.spot&&this.spot.state!=this.state){this.state=this.spot.state;this.updateAnim(false)}this.timer=this.timer+ig.system.tick},updateAnim:function(a){if(this.state==0)this.currentAnim=g;else if(this.state==
1)this.currentAnim=h;else if(this.state==2)this.currentAnim=i;else if(this.state==3)this.currentAnim=j;this.timer=a?this.currentAnim.length*0.05:0},updateSprites:function(){var a=Math.floor(this.timer/0.05).limit(0,this.currentAnim.length-1),a=this.currentAnim[a],b=this.coll,c=this.sprites[0];c.setPos(b.pos.x,b.pos.y,b.pos.z);c.setSize(b.size.x,b.size.y,b.size.z);c.setImageSrc(this.patterns.getPattern(a),0,0)}});ig.ENTITY.FerroRespawner=ig.AnimatedEntity.extend({state:0,hits:0,timer:0,hitSound:new ig.Sound("media/sound/puzzle/ferro-switch-hit.ogg",
0.9),_wm:new ig.Config({spawnable:true,attributes:{spot:{_type:"Entity",_info:"FerroSpot connected to line",_optional:true}}}),init:function(a,b,c,d){this.parent(a,b,c,d);this.coll.type=ig.COLLTYPE.VIRTUAL;this.coll.setSize(16,16,24);this.spotSetting=d.spot;this.initAnimations({namedSheets:{floor:{src:"media/entity/objects/ferro.png",width:16,height:16,xCount:3,offX:0,offY:312},pole:{src:"media/entity/objects/ferro.png",width:16,height:24,xCount:6,offX:0,offY:328}},repeat:true,SUB:[{sheet:"floor",
frames:[0],time:0.033,tileOffset:0,size:{x:16,y:16,z:0},wallY:0,SUB:[{name:"off"},{name:"on",tileOffset:2},{name:"poleUp",tileOffset:2},{name:"poleDown",tileOffset:2},{name:"pole0",tileOffset:1},{name:"pole1",tileOffset:1},{name:"pole2",tileOffset:1},{name:"pole3",tileOffset:2},{name:"respawn",tileOffset:1}]},{sheet:"pole",time:0.033,tileOffset:0,size:{x:16,y:0,z:24},repeat:false,offset:{y:-4},SUB:[{name:"poleUp",frames:[5,4,3,2,1]},{name:"poleDown",frames:[3,4,5]},{name:"pole0",frames:[0]},{name:"pole1",
frames:[1]},{name:"pole2",frames:[2]},{name:"pole3",frames:[3]},{name:"respawn",frames:[0,1,2]}]}]})},assignFerroSpot:function(a){this.spot=a;this.updateState(true);b(this,a)},updateState:function(a){var b=this.state;this.state=this.spot.state;this.hits=0;if(this.state==2){this.coll.setType(ig.COLLTYPE.VIRTUAL);a?this.setCurrentAnim("pole0"):this.setCurrentAnim("poleUp",true,"pole0",true)}else if(this.state==0){this.coll.setType(ig.COLLTYPE.TRIGGER);b==2&&!a?this.setCurrentAnim("poleDown",true,"off",
true):this.setCurrentAnim("off")}else if(this.state==1){this.coll.setType(ig.COLLTYPE.TRIGGER);b!=0&&!a?this.setCurrentAnim("poleDown",true,"on",true):this.setCurrentAnim("on")}else if(this.state==3){this.coll.setType(ig.COLLTYPE.VIRTUAL);this.setCurrentAnim("respawn",true,"pole3")}},update:function(){this.spotSetting&&!this.spot&&this.assignFerroSpot(ig.Event.getEntity(this.spotSetting));if(this.hits){this.timer=this.timer-ig.system.tick;if(this.timer<=0){this.hits--;this.timer=0.05;this.updateHitAnim()}}this.spot&&
this.spot.state!=this.state&&this.updateState(false);this.parent()},ballHit:function(a){if(this.state!=2)return false;this.hits++;this.timer=0.3;ig.SoundHelper.playAtEntity(this.hitSound,this,false,{speed:this.hits*0.05+1-3*0.05});this.updateHitAnim();if(this.hits<3)sc.combat.showHitEffect(this,a.getHitCenter(this,d),sc.ATTACK_TYPE.LIGHT,a.getElement(),false,false,true,[1]);else{sc.combat.showHitEffect(this,a.getHitCenter(this,d),sc.ATTACK_TYPE.MASSIVE,a.getElement(),false,false,true,[1]);c.respawn(this.spot)}return true},
updateHitAnim:function(){this.setCurrentAnim("pole"+this.hits,true)}});var k={IDLE:{start:function(a){a.coll.setType(ig.COLLTYPE.IGNORE);a.setCurrentAnim(a.getAbsorbAnim("idle"));a.resetColl()},update:function(){return false},onQuickStop:function(a){Vec2.mulF(a.coll.vel,0.5)}},RESPAWN:{noInterrupt:true,noMerge:true,start:function(a){a.coll.setType(ig.COLLTYPE.IGNORE);Vec3.assign(a.mergeStartPos,a.coll.pos);var b=a.distanceTo(a.lastSpot);a.mergeTimer=(b/640).limit(0.3,1);a.timer=a.mergeTimer;a.lastSpot.setRespawn();
a.effects.handle=a.effects.sheet.spawnOnTarget("respawn",a,{duration:-1,offset:{x:0,y:0,z:4}})},update:function(a){a.timer=a.timer-ig.system.tick;var b=KEY_SPLINES.EASE_IN.get(Math.max(0,a.timer/a.mergeTimer)),c=a.lastSpot.getAlignedPos(ig.ENTITY_ALIGN.BOTTOM,d);Vec3.addC(c,-8,-8,12);b=Vec3.lerp(c,a.mergeStartPos,b,d);a.setPos(b.x,b.y,b.z,true);if(a.timer<=0){a.startZ=b.z;a.setState(k.IDLE);Vec3.assignC(a.coll.vel,0,0)}}},DELETE:{noInterrupt:true,noMerge:true,start:function(a){a.coll.setType(ig.COLLTYPE.IGNORE);
Vec3.assign(a.mergeStartPos,a.coll.pos);var b=a.distanceTo(a.lastSpot);a.mergeTimer=(b/640).limit(0.1,1);a.timer=a.mergeTimer;a.effects.handle=a.effects.sheet.spawnOnTarget("delete",a,{duration:-1,offset:{x:0,y:0,z:4}})},update:function(a){a.timer=a.timer-ig.system.tick;var b=KEY_SPLINES.EASE_IN.get(Math.max(0,a.timer/a.mergeTimer)),c=a.lastSpot.getAlignedPos(ig.ENTITY_ALIGN.BOTTOM,d);Vec3.addC(c,-8,-8,12);b=Vec3.lerp(c,a.mergeStartPos,b,d);a.setPos(b.x,b.y,b.z,true);a.timer<=0&&a.kill()}},GATE_ABSORB:{noInterrupt:true,
noMerge:true,start:function(a){a.coll.setType(ig.COLLTYPE.IGNORE);a.timer=0.3;a.effects.handle=a.effects.sheet.spawnOnTarget("delete",a,{duration:-1,offset:{x:0,y:0,z:4}});ig.vars.set("tmp.ferroGateAbsorb",true)},update:function(a){a.timer=a.timer-ig.system.tick;a.timer<=0&&a.kill()}},BARRIER_BREAK:{start:function(a){a.resetColl();a.coll.bounciness=0.001;a.coll.friction.air=0.4;a.timer=0.1;Vec2.length(a.coll.vel,200);Vec2.assign(a.coll.accelDir,a.coll.vel);a.coll.maxVel=200},update:function(a){Vec2.assign(a.coll.vel,
a.coll.accelDir);Vec2.length(a.coll.vel,200);a.timer=a.timer-ig.system.tick;a.timer<=0&&a.setState(k.IDLE)}},NEUTRAL:{start:function(a,b,c){a.coll.bounciness=0;a.coll.friction.air=0.4;a.coll.float.height=12;a.effects.sheet.spawnOnTarget("hit",a,{duration:0,offset:{x:0,y:0,z:4}});a.setCurrentAnim(a.getAbsorbAnim("bounce"),true,a.getAbsorbAnim("idle"),true);Vec2.assign(a.coll.vel,b);Vec2.length(a.coll.vel,c.isBall?300:250);return true},update:function(a){a.setState(k.IDLE)}},BOUNCE_BACK:{start:function(a,
b){a.coll.bounciness=0;a.coll.friction.air=0.4;a.coll.float.height=12;a.effects.handle=a.effects.sheet.spawnOnTarget("bounceAway",a,{duration:-1,offset:{x:0,y:0,z:4}});a.setCurrentAnim(a.getAbsorbAnim("bounce"),true,a.getAbsorbAnim("idle"),true);Vec2.assign(a.coll.vel,b);Vec2.rotate(a.coll.vel,(Math.random()>0.5?0.25:-0.25)*2*Math.PI);Vec2.length(a.coll.vel,700);a.coll.bounciness=1;a.coll.friction.air=0;a.coll.float.variance=2;a.coll.float.maxSpeed=400;a.coll.float.accel=10;a.timer=0.25;return true},
update:function(a){a.timer=a.timer-ig.system.tick;if(a.timer<=0){a.timer=0;Vec2.mulF(a.coll.vel,0.3);a.setState(k.IDLE)}}},BOUNCE_BACK_BORDER:{start:function(a,b){a.coll.bounciness=0;a.coll.friction.air=0.4;a.coll.float.height=12;a.effects.handle=a.effects.sheet.spawnOnTarget("bounceAway",a,{duration:-1,offset:{x:0,y:0,z:4}});a.setCurrentAnim(a.getAbsorbAnim("bounce"),true,a.getAbsorbAnim("idle"),true);Vec2.assign(a.coll.vel,b);Vec2.length(a.coll.vel,400);a.coll.bounciness=1;a.coll.friction.air=0;
a.coll.float.variance=2;a.coll.float.maxSpeed=400;a.coll.float.accel=10;a.timer=0.2;return true},update:function(a){a.timer=a.timer-ig.system.tick;if(a.timer<=0){a.timer=0;Vec2.mulF(a.coll.vel,0.3);a.setState(k.IDLE)}}},BOUNCE_BACK_SMALL:{start:function(a,b){a.coll.bounciness=0;a.coll.friction.air=0.4;a.coll.float.height=12;a.effects.handle=a.effects.sheet.spawnOnTarget("bounceAway",a,{duration:-1,offset:{x:0,y:0,z:4}});a.setCurrentAnim(a.getAbsorbAnim("bounce"),true,a.getAbsorbAnim("idle"),true);
Vec2.assign(a.coll.vel,b);Vec2.rotate(a.coll.vel,(Math.random()>0.5?0.1:-0.1)*2*Math.PI);Vec2.length(a.coll.vel,350);a.coll.bounciness=1;a.coll.friction.air=0;a.coll.float.variance=2;a.coll.float.maxSpeed=400;a.coll.float.accel=10;a.timer=0.25;return true},update:function(a){a.timer=a.timer-ig.system.tick;if(a.timer<=0){a.timer=0;Vec2.mulF(a.coll.vel,0.3);a.setState(k.IDLE)}}},HEAT:{start:function(a,b,c){a.coll.setType(ig.COLLTYPE.IGNORE);a.setCurrentAnim(a.getAbsorbAnim("heat"),true,null,true);Vec2.assign(a.coll.vel,
b);Vec2.round(a.coll.vel,Math.PI*0.03);b=c.attackInfo&&c.attackInfo.hasHint("CHARGED");a.timer=c.isBall&&!b?0.2:0.4;Vec2.length(a.coll.vel,400);a.effects.handle=a.effects.sheet.spawnOnTarget("heatHit",a,{duration:-1,offset:{x:0,y:0,z:4},rotateFace:-1});a.coll.bounciness=0;a.coll.friction.air=0;a.coll.float.height=12;a.coll.float.variance=2;a.coll.float.maxSpeed=400;a.coll.float.accel=10;a.attackInfo=new sc.AttackInfo(ig.game.playerEntity.params,{element:sc.ELEMENT.HEAT,hints:["FERRO"]});return true},
update:function(a){a.coll.bounciness=1;a.animState.angle=Vec2.clockangle(a.coll.vel);a.timer=a.timer-ig.system.tick;if(a.timer<=0)if(a.effects.handle){a.setCurrentAnim(a.getAbsorbAnim("idle"));Vec2.mulF(a.coll.vel,0.6);a.resetColl(true);a.timer=0.3}else{a.timer=0;a.setState(k.IDLE)}},onQuickStop:function(a){Vec2.mulF(a.coll.vel,0.5);a.timer=0}},COLD:{start:function(a,b){a.coll.setType(ig.COLLTYPE.IGNORE);a.setCurrentAnim(a.getAbsorbAnim("cold"),true,null,true);Vec2.assign(a.coll.vel,b);a.timer=0.7;
a.coll.bounciness=0;a.coll.zBounciness=0.7;a.coll.friction.ground=0.4;a.coll.friction.air=0.05;Vec2.length(a.coll.vel,350);var c=Math.min(120,Math.max(0,ig.CollTools.getJumpSpeedToHeight(a.coll,a.startZ+16)));a.coll.vel.z=c;a.effects.handle=a.effects.sheet.spawnOnTarget("coldHit",a,{duration:-1,offset:{x:0,y:0,z:4}});a.attackInfo=new sc.AttackInfo(ig.game.playerEntity.params,{element:sc.ELEMENT.COLD,hints:["FERRO"]});a.coll.float.height=0;return true},update:function(a){a.timer=a.timer-ig.system.tick;
if(a.effects.handle){a.animState.angle=a.animState.angle+ig.system.tick*3;a.timer<=0&&a.coll.pos.z==a.coll.baseZPos?this.breakIce(a):a.coll.pos.z==a.coll.baseZPos&&Vec2.length(a.coll.vel)<25&&this.breakIce(a)}else a.timer<=0&&a.setState(k.IDLE)},breakIce:function(a){a.overlapActivateCheck();a.timer=0;Vec2.mulF(a.coll.vel,0.5);a.startZ=a.coll.baseZPos+12;a.resetColl(true);a.setCurrentAnim(a.getAbsorbAnim("idle"));a.timer=0.3},onTouchGround:function(a,b){a.effects.sheet.spawnOnTarget("coldLand",a,{duration:0,
offset:{x:0,y:0,z:4}});(b<-200||a.timer<=0)&&this.breakIce(a)},onQuickStop:function(a){Vec2.mulF(a.coll.vel,0.15);a.timer=0}},SHOCK:{noBarrierStop:true,start:function(a,b,c){a.coll.setType(ig.COLLTYPE.IGNORE);a.setCurrentAnim(a.getAbsorbAnim("shock"),true,null,true);b=c.attackInfo&&c.attackInfo.hasHint("CHARGED");a.timer=c.isBall&&!b?0.25:0.5;a.effects.handle=a.effects.sheet.spawnOnTarget("shockHit",a,{duration:-1,offset:{x:0,y:0,z:4},target2:ig.game.playerEntity});a.coll.bounciness=0;a.coll.friction.air=
0;a.coll.float.height=12;a.coll.float.variance=2;a.coll.float.maxSpeed=400;a.coll.float.accel=10;a.attackInfo=new sc.AttackInfo(ig.game.playerEntity.params,{element:sc.ELEMENT.SHOCK,hints:["FERRO"]});return true},update:function(b){b.timer=b.timer-ig.system.tick;if(b.effects.handle){var c=ig.CollTools.getDistVec2(b.coll,ig.game.playerEntity.coll,a);if(Vec2.length(c)<32){Vec2.mulF(b.coll.vel,0.1);b.resetColl(true);b.setCurrentAnim(b.getAbsorbAnim("idle"));b.timer=0.3}else if(b.timer<=0){Vec2.mulF(b.coll.vel,
0.6);b.setCurrentAnim(b.getAbsorbAnim("idle"));b.resetColl(true);b.timer=0.3}else{Vec2.assign(b.coll.vel,c);Vec2.length(b.coll.vel,400)}}else if(b.timer<=0){b.timer=0;b.setState(k.IDLE)}},onQuickStop:function(a){Vec2.mulF(a.coll.vel,0.5);a.timer=0}},WAVE:{start:function(a,b,c){if(c.isBall&&c.attackInfo&&c.attackInfo.hasHint("CHARGED")){a.coll.setType(ig.COLLTYPE.IGNORE);a.setTeleportBall(c);a.setCurrentAnim(a.getAbsorbAnim("wave"),true,null,true);a.effects.sheet.spawnOnTarget("waveHit",a,{duration:-1,
offset:{x:0,y:0,z:4},target2:c})}else a.setState(k.IDLE);return false},update:function(){}},BOMB_FLY:{noInterrupt:true,start:function(a,b){var c=a.coll;c.maxVel=400;c.weight=2E3;Vec2.assign(c.accelDir,b);Vec2.assign(c.vel,b);Vec2.length(c.vel,400);a.timer=2;a.effects.handle=a.effects.bomb.spawnOnTarget("bombHeatTrail",a,{duration:-1,angle:Vec2.clockangle(b),offset:{z:2}})},update:function(a){if(a.coll.totalBlockTimer>0||a.coll.partlyBlockTimer>0)this.explode(a);else{a.timer=a.timer-ig.system.tick;
a.timer<=0&&this.explode(a)}},explode:function(a){var b=a.getAlignedPos(ig.ENTITY_ALIGN.CENTER,Vec3.create());a.effects.bomb.spawnFixed("explosion",b.x,b.y,b.z);b.z=b.z-24;a.panel&&a.panel.onBombExplode();b=new sc.CircleHitForce(ig.game.playerEntity,{attack:{type:"MASSIVE",element:"HEAT",damageFactor:2,spFactor:0,hints:["BOMB","FERRO_IGNORE"],noHack:true},pos:b,radius:8,zHeight:40,duration:0.1,expandRadius:40,alwaysFull:true,party:"OTHER"});Vec2.assignC(a.coll.vel,0,0);Vec2.assignC(a.coll.accelDir,
0,0);sc.combat.addCombatForce(b);a.clearAbsorbState();a.setState(k.IDLE)}},ICEDISK:{start:function(a){a.setCurrentAnim("icedisk",true,null,true);var b=a.coll;b.float.height=0;b.weight=2E5;b.friction.air=0.2;Vec3.assignC(b.vel,0,0,150);b.zBounciness=0;b.bounciness=1;a.mergeEntity=null;a.effects.bubble.spawnOnTarget("iceAppear",a,{})},update:function(){},ballHit:function(a,b,c,d){if(c.isBall&&c.attackInfo&&!c.attackInfo.hasHint("CHARGED"))return true;if(d===sc.ELEMENT.HEAT){a.panel&&a.panel.onBubbleBurst();
a.resetColl();a.clearAbsorbState();a.setState(k.IDLE);a.effects.bubble.spawnOnTarget("iceMeltFerror",a,{})}else a.setState(k.ICEDISK_SLIDE,b,c);return true},onTouchGround:function(a,b){a.overlapActivateCheck();var c=a.getAlignedPos(ig.ENTITY_ALIGN.BOTTOM,d);b<-30&&a.effects.bubble.spawnFixed("iceLand",c.x,c.y,c.z,null,{})}},ICEDISK_SLIDE:{noInterrupt:true,start:function(a,b){var c=a.coll;c.setType(ig.COLLTYPE.IGNORE);c.friction.ground=0;c.friction.air=0;c.maxVel=400;c.weight=9001;c.noSlipping=true;
c.zBounciness=0;c.bounciness=1;Vec2.assign(c.vel,b);Vec2.length(c.vel,400);a.timer=1.5;a.attackInfo=new sc.AttackInfo(ig.game.playerEntity.params,{element:sc.ELEMENT.COLD,hints:["ICE_DISK","FERRO"]});a.remainingHits=5;a.effects.handle=a.effects.bubble.spawnOnTarget("iceTrail",a,{duration:-1,angle:Vec2.clockangle(b),offset:{z:2}})},update:function(){},onMoveTrace:function(a,b){if(b.collided){var c=a.getCenter();c.x=c.x+b.blockDir.x*a.coll.size.x/2.05;c.y=c.y+b.blockDir.y*a.coll.size.y/2.05;if(a.remainingHits){a.remainingHits--;
a.effects.bubble.spawnFixed("iceBounce",c.x,c.y,a.coll.pos.z,null,{angle:Vec2.clockangle(b.blockDir)})}else this.iceBreak(a)}},iceBreak:function(a){var b=a.getAlignedPos(ig.ENTITY_ALIGN.BOTTOM,Vec3.create());a.effects.bubble.spawnFixed("iceBreak",b.x,b.y,b.z,null,{});a.startZ=a.coll.baseZPos+12;a.panel&&a.panel.onBubbleBurst();a.resetColl();a.clearAbsorbState();a.setState(k.IDLE);a.effects.sheet.spawnOnTarget("absorbRegen",a)},onAttackHit:function(a){this.iceBreak(a)},ballHitFilter:function(a){return a instanceof
ig.ENTITY.RegenDestruct},onOtherBallHit:function(a){a.consume()}},WAVE_COMPRESSOR:{noInterrupt:true,start:function(a,b,c){a.coll.setType(ig.COLLTYPE.IGNORE);a.setCurrentAnim(a.getAbsorbAnim("waveCompressor"),true,null,true);a.element=sc.ELEMENT.WAVE;a.timer=-0.4;a.fastMode=c.fastMode;a.phaseMode=false;a.phaseTraveled=0;a.wallKillTimer=0;a.enterWall.timer=0;a.speedFactor=c.speedFactor;Vec2.assignC(a.enterWall.dir,0,0);a.setMergeEntity(c);a.coll.float.height=0;a.coll.zGravityFactor=0;a.coll.vel.z=0;
a.coll.accelSpeed=0;a.coll.friction.air=0;a.coll.friction.ground=0;a.coll.bounciness=1;Vec2.assign(a.savedDir,b);a.animState.angle=Vec3.clockangle(a.coll.vel);a.effects.perma=sc.COMPRESSOR_MOVE.effects.sheet.spawnOnTarget("ballWave",a,{duration:-1,offset:{x:0,y:0,z:4}});sc.COMPRESSOR_MOVE.effects.sheet.spawnOnTarget("chargeFinalWave",a,{offset:{x:0,y:0,z:4}});a.attackInfo=new sc.AttackInfo(ig.game.playerEntity.params,{element:sc.ELEMENT.WAVE,hints:["COMPRESSED","FERRO"]})},update:function(a){if(a.timer<
0){a.timer=a.timer+ig.system.tick;Vec2.assignC(a.coll.vel,0,0);if(a.timer>=0){a.timer=10;Vec2.assign(a.coll.vel,a.savedDir);Vec2.length(a.coll.vel,400);a.effects.trail=sc.COMPRESSOR_MOVE.effects.sheet.spawnOnTarget("trailWave",a,{duration:-1,offset:{x:0,y:0,z:4}})}}if(a.timer>0){sc.COMPRESSOR_MOVE.waveUpdate(a);a.timer=a.timer-ig.system.tick*a._getAssistFactor();if(a.timer<=0){a.timer=0;a.onCompressorMoveEnd(a.phaseMode)}}},onMoveTrace:function(a,b){sc.COMPRESSOR_MOVE.waveMoveTrace(a,b)},onCollideWith:function(a,
b,c){sc.COMPRESSOR_MOVE.waveCollide(a,b,c)},onOtherBallHit:function(a,b){sc.COMPRESSOR_MOVE.waveBallHit(a,b);if(b instanceof ig.ENTITY.WaveTeleport)this.onCompressorMoveEnd()}},SHOCK_COMPRESSOR:{noInterrupt:true,start:function(a,b,c){a.coll.setType(ig.COLLTYPE.IGNORE);a.setCurrentAnim(a.getAbsorbAnim("shockCompressor"),true,null,true);a.element=sc.ELEMENT.SHOCK;a.timer=-0.4;a.fastMode=c.fastMode;Vec2.assign(a.slidingWall,c.slidingWall);a.blockCheck=c.blockCheck;a.turnSoundTimer=c.turnSoundTimer;a.wallBounces=
c.wallBounces;a.speedFactor=c.speedFactor;a.setMergeEntity(c);a.coll.float.height=0;a.coll.zGravityFactor=0;a.coll.vel.z=0;a.coll.accelSpeed=0;a.coll.friction.air=0;a.coll.friction.ground=0;a.coll.bounciness=1;Vec2.assign(a.savedDir,c.coll.vel);a.animState.angle=Vec3.clockangle(a.coll.vel);a.effects.handle=a.effects.sheet.spawnOnTarget("shockCompressor",a,{duration:-1,offset:{x:0,y:0,z:4}});a.effects.perma=sc.COMPRESSOR_MOVE.effects.sheet.spawnOnTarget("ballShock",a,{duration:-1,offset:{x:0,y:0,z:4}});
sc.COMPRESSOR_MOVE.effects.sheet.spawnOnTarget("chargeFinalShock",a,{offset:{x:0,y:0,z:4}});a.attackInfo=new sc.AttackInfo(ig.game.playerEntity.params,{element:sc.ELEMENT.SHOCK,hints:["COMPRESSED","FERRO"]})},update:function(a){a.killCloseRegenDestruct(24);if(a.timer<0){Vec2.assignC(a.coll.vel,0,0);a.timer=a.timer+ig.system.tick;if(a.timer>=0){a.timer=10/a.speedFactor;Vec2.assign(a.coll.vel,a.savedDir);a.effects.trail=sc.COMPRESSOR_MOVE.effects.sheet.spawnOnTarget("trailShock",a,{duration:-1,offset:{x:0,
y:0,z:4}})}}if(a.timer>0){sc.COMPRESSOR_MOVE.shockUpdate(a);a.timer=a.timer-ig.system.tick*a._getAssistFactor();if(a.timer<=0){a.timer=0;a.onCompressorMoveEnd(false)}}},onMoveTrace:function(a,b){sc.COMPRESSOR_MOVE.shockMoveTrace(a,b)},shootFromWall:function(a,b,c){sc.COMPRESSOR_MOVE.shootFromWall(a,b,c)},onOtherBallHit:function(){}}},l={anims:{idle:"bomb",bounce:"bomb",shock:"bombShock"},start:function(){},elementReact:[sc.ELEMENT.HEAT],ballHit:function(a,b,c){a.resetColl();a.setState(k.BOMB_FLY,
b,c);return true},onReset:function(a){a.panel&&a.panel.onBombExplode()}},o={anims:{idle:"bubble",bounce:"bubble",shock:"bubble"},start:function(){},elementReact:[sc.ELEMENT.HEAT,sc.ELEMENT.COLD],ballHit:function(a,b,c,d){d==sc.ELEMENT.HEAT&&this.steam(a,b,c.getCombatantRoot());if(d==sc.ELEMENT.COLD){a.resetColl();a.setState(k.ICEDISK,b,c)}return true},steam:function(a,b,c){var d=a.getAlignedPos(ig.ENTITY_ALIGN.BOTTOM,Vec3.create());a.effects.bubble.spawnFixed("steamExplosion",d.x,d.y,d.z,null,{angle:Vec2.clockangle(b)});
d.z=d.z-8;a.panel&&a.panel.onBubbleBurst();c=new sc.CircleHitForce(c,{attack:{type:"MASSIVE",element:"HEAT",damageFactor:1,spFactor:0,hints:["STEAM","FERRO_IGNORE"],noHack:true},pos:d,radius:8,zHeight:16,duration:0.2,expandRadius:60,alwaysFull:true,party:"OTHER",centralAngle:0.3,dir:ig.copy(b)});sc.combat.addCombatForce(c);a.resetColl();a.clearAbsorbState();a.setState(k.IDLE);Vec2.assign(a.coll.vel,b);Vec2.length(a.coll.vel,120);Vec2.flip(a.coll.vel);a.effects.sheet.spawnOnTarget("absorbRegen",a)},
onReset:function(a){a.panel&&a.panel.onBubbleBurst()}};sc.FerroEntity=ig.AnimatedEntity.extend({state:null,absorbState:null,timer:0,ignoreTimer:0,startZ:0,teleportBall:null,panel:null,mergeTimer:0,mergeEntity:null,mergeStartPos:Vec3.create(),attackInfo:null,savedDir:Vec2.create(),element:null,combatant:null,collisionList:[],collReleaseTimer:0,collReleaseTimeList:[],fastMode:false,speedFactor:1,phaseMode:false,phaseTraveled:0,wallKillTimer:0,enterWall:{timer:0,dir:Vec2.create()},slidingWall:Vec2.create(),
blockCheck:0,turnSoundTimer:0,wallBounces:0,startCollType:ig.COLLTYPE.IGNORE,lastSpot:null,effects:{sheet:new ig.EffectSheet("puzzle.ferro"),bomb:new ig.EffectSheet("puzzle.bomb"),bubble:new ig.EffectSheet("puzzle.water-bubble"),handle:null,hitHandle:null,perma:null,trail:null},_wm:new ig.Config({spawnable:true,attributes:{spawnCondition:{_type:"VarCondition",_info:"Condition for Enemy to spawn",_popup:true}}}),init:function(a,b,d,e){this.parent(a,b,d,e);this.coll.type=ig.COLLTYPE.IGNORE;this.coll.setSize(16,
16,24);this.startZ=d;this.coll.setPadding(2,2);this.state=k.IDLE;this.lastSpot=e.spot||null;a=new ig.LightHandle(this,ig.LIGHT_SIZE.L,0.1,0.1,-1,1,false);a.setOffset(0,4,0);ig.light.addLightHandle(a);this.initAnimations({shapeType:"Y_FLAT",wallY:0,sheet:{src:"media/entity/objects/ferro.png",width:32,height:40,xCount:8,offX:0,offY:0},repeat:true,offset:{x:0,y:0,z:-6},SUB:[{name:"idle",frames:[0,1,2,3],time:0.2,tileOffset:0},{name:"bounce",frames:[2,2,3,0,1,1,0],time:0.05,tileOffset:4,repeat:false},
{name:"bomb",frames:[0,1,2,3],time:0.1,tileOffset:16},{name:"bombShock",frames:[0,1,2,3],time:0.1,tileOffset:16},{name:"heat",frames:[0,1,2,3],time:0.05,tileOffset:20},{name:"bubble",frames:[0,1,2,3],time:0.1,tileOffset:24},{name:"icedisk",frames:[0,1,2,3],time:0.1,tileOffset:28,repeat:false},{name:"cold",frames:[0,1,2,3],time:0.0833,tileOffset:32,repeat:false},{name:"shock",frames:[0,1,2,3],time:0.05,tileOffset:40},{name:"shockCompressor",frames:[-1],time:0.05,tileOffset:40,offset:{y:6,z:0}},{name:"bombShock",
frames:[0,1,2,3],time:0.05,tileOffset:40},{name:"wave",frames:[0,1,2,3],time:0.05,tileOffset:52},{name:"waveCompressor",frames:[0,1,2,3],time:0.05,tileOffset:60,offset:{y:6,z:0}}]});this.setCurrentAnim("idle");this.resetColl();c=this;f=null},remove:function(a){this.lastSpot.clearPermaFx();f=this.lastSpot;c=null;if(this.absorbState){this.absorbState.onReset(this);this.clearAbsorbState()}this.resetColl();a?this.setState(k.GATE_ABSORB):this.setState(k.DELETE)},respawn:function(a){a&&this.assignSpot(a);
if(this.absorbState){this.absorbState.onReset(this);this.clearAbsorbState()}this.resetColl();this.setState(k.RESPAWN)},isRespawning:function(){return this.state==k.RESPAWN},assignSpot:function(a){if(this.lastSpot!=a){this.lastSpot&&this.lastSpot.clearPermaFx();this.lastSpot=a;a.showPermaFx()}},resetColl:function(a){this.coll.setType(ig.COLLTYPE.IGNORE);this.coll.zGravityFactor=1;this.coll.float.height=12;this.coll.float.variance=2;this.coll.float.accel=2;this.coll.relativeVel=1;this.coll.maxVel=200;
this.coll.shadow.size=16;this.coll.zBounciness=0.5;this.coll.bounciness=0;this.coll.accelSpeed=1;this.coll.friction.ground=0.4;this.coll.friction.air=0.4;this.coll.weight=200;this.animState.angle=0;this.coll.noSlipping=false;this.speedFactor=1;Vec2.assignC(this.coll.accelDir,0,0);this.clearTeleportBall();if(this.effects.perma){this.effects.perma.stop();this.effects.perma=null}if(this.effects.trail){this.effects.trail.stop();this.effects.trail=null}if(this.effects.handle){this.effects.handle.stop();
this.effects.handle=null}if(!a)this.attackInfo=null},getAbsorbAnim:function(a){return!this.absorbState?a:this.absorbState.anims[a]||a},show:function(a){this.parent(a);if(!a){this.animState.alpha=0;ig.game.effects.teleport.spawnOnTarget("showQuick",this,{})}},onKill:function(a){c===this&&(c=null);this.parent(a)},update:function(){var a=this.coll;if(this.ignoreTimer){this.ignoreTimer=this.ignoreTimer-ig.system.tick;if(this.ignoreTimer<=0)this.ignoreTimer=0}if(a.pos.z<ig.game.minLevelZ)this.respawn();
else if(a.pos.z==a.baseZPos){a=ig.terrain.getTerrain(this.coll,true);ig.terrain.isFallTerrain(a)&&this.respawn()}this.collReleaseTimer=this.collReleaseTimer+ig.system.tick;if(this.collReleaseTimeList.length>0&&this.collReleaseTimeList[0]<=this.collReleaseTimer){this.collisionList.shift();this.collReleaseTimeList.shift()}this.handleSurrounding();if(this.mergeEntity){ig.CollTools.getDistVec2(this.coll,this.mergeEntity.coll,this.coll.vel);Vec2.mulF(this.coll.vel,8);this.mergeTimer=this.mergeTimer-ig.system.tick;
a=Math.max(0,this.mergeTimer/0.1);a=Vec3.lerp(this.mergeEntity.coll.pos,this.mergeStartPos,a,d);this.setPos(a.x,a.y,this.coll.pos.z,true);if(this.mergeTimer<=0){this.mergeTimer=0;this.mergeEntity=null}}this.state.update(this);if(this.coll.float.height){this.updateStartZ();this.coll.float.height=Math.max(12,this.startZ-this.coll.baseZPos)}this.parent()},handleSurrounding:function(){var a=this.coll;if(this.state==k.IDLE){for(var b=-2,b=ig.game.getEntitiesInRectangle(a.pos.x-b,a.pos.y-b,a.pos.z-14,a.size.x+
b*2,a.size.y+b*2,32,this),c=b.length,d=0,e=null;c--;){var f=b[c];if(f instanceof ig.ActorEntity){var g=ig.CollTools.getGroundDistance(f.coll,this.coll);if(!e||g<d){d=g;e=f}}}if(e){ig.CollTools.getDistVec2(e.coll,this.coll,this.coll.accelDir);this.coll.maxVel=200;this.coll.relativeVel=0.15}else{b=2;b=ig.game.getEntitiesInRectangle(a.pos.x-b,a.pos.y-b,a.pos.z-14,a.size.x+b*2,a.size.y+b*2,32,this);c=b.length;d=0;for(e=null;c--;){f=b[c];if(this.isCloseInEntity(f)){g=ig.CollTools.getGroundDistance(f.coll,
this.coll);if(!e||g<d){d=g;e=f}}}if(e){ig.CollTools.getDistVec2(this.coll,e.coll,this.coll.accelDir);this.coll.maxVel=200;this.coll.relativeVel=Math.min(0.25,d/80)}else Vec2.assignC(this.coll.accelDir,0,0)}}},isCloseInEntity:function(a){return a instanceof ig.ENTITY.FerroSpot||a instanceof ig.ENTITY.OneTimeSwitch&&a.isOn&&a.activeTime?true:false},updateStartZ:function(){if(this.coll.baseZPos>this.startZ)this.startZ=this.coll.baseZPos+12},setState:function(a,b,c){this.state=a;return this.state.start(this,
b,c)},setAbsorbState:function(a,b,c){this.effects.sheet.spawnOnTarget("absorb",this,{target2Point:b.getAlignedPos(ig.ENTITY_ALIGN.CENTER)});b.absorbFerro(this);this.absorbState=a;this.absorbState.start(this,b);this.setMergeEntity(b);this.panel=c;this.setState(k.IDLE)},setMergeEntity:function(a){this.mergeEntity=a;this.mergeTimer=0.1;Vec3.assign(this.mergeStartPos,this.coll.pos)},clearAbsorbState:function(){this.absorbState=this.panel=null},ballHit:function(b){if(!this.teleportBall&&!this.state.noInterrupt&&
!this.ignoreTimer){var c=b.getHitCenter(this),d=b.getElement(),e=b.getCombatant().getCombatantRoot();if(b.attackInfo&&b.attackInfo.hasHint("FERRO_IGNORE")||b instanceof sc.FerroWaveAttack||sc.bounceSwitchGroups.isBallOfAnyGroup(b))return false;this.combatant=e;e=b.getHitVel(this,a);if(b.attackInfo&&b.attackInfo.hasHint("FERRO_BOUNCE")){this.resetColl();return this.setState(k.BOUNCE_BACK,e,b)}if(b.attackInfo&&b.attackInfo.hasHint("FERRO_BOUNCE")){this.resetColl();return this.setState(k.BOUNCE_BACK,
e,b)}if(b.attackInfo&&b.attackInfo.hasHint("FERRO_BOUNCE_BORDER")){this.resetColl();return this.setState(k.BOUNCE_BACK_BORDER,e,b)}if(b.attackInfo&&b.attackInfo.hasHint("FERRO_BOUNCE_SMALL")){if(this.state==k.IDLE){this.resetColl();return this.setState(k.BOUNCE_BACK_SMALL,e,b)}}else{if(this.state.ballHit)return this.state.ballHit(this,e,b,d);if(this.absorbState&&this.absorbState.elementReact.indexOf(d)!==-1)return this.absorbState.ballHit(this,e,b,d);this.updateStartZ();this.resetColl();var f=k.NEUTRAL;
if(b instanceof sc.CompressedWaveEntity){b.destroy();f=k.WAVE_COMPRESSOR}else if(b instanceof sc.CompressedShockEntity){b.destroy();f=k.SHOCK_COMPRESSOR}else if(d==sc.ELEMENT.HEAT)f=k.HEAT;else if(d==sc.ELEMENT.COLD)f=k.COLD;else if(d==sc.ELEMENT.SHOCK)f=k.SHOCK;else if(d==sc.ELEMENT.WAVE)f=k.WAVE;sc.combat.showHitEffect(this,c,sc.ATTACK_TYPE.LIGHT,d,false,false,true);return this.setState(f,e,b)}}},collideWith:function(a,b){if(this.state!=k.DELETE&&this.state!=k.GATE_ABSORB){if(this.state.onCollideWith)this.state.onCollideWith(this,
a,b);if(this.collisionList.indexOf(a)==-1)if(a.name=="ferroGate")this.remove(true);else{if(!this.absorbState&&!this.state.noMerge){if(a instanceof sc.BombEntity){this.setAbsorbState(l,a,a.panel);return}if(a instanceof sc.WaterBubbleEntity){this.setAbsorbState(o,a,a.panel);return}if(a instanceof sc.IceDiskEntity){this.setAbsorbState(o,a,a.panel);this.setState(k.ICEDISK,b,null);return}}if(this.attackInfo&&(a.damage&&a.party!=sc.COMBATANT_PARTY.PLAYER)&&a.damage(this,this.attackInfo)){this.collisionList.push(a);
this.collReleaseTimeList.push(this.collReleaseTimer+0.5);if(this.state.onAttackHit)this.state.onAttackHit(this,a)}else if(a instanceof ig.ENTITY.RegenDestruct&&!this.state.noInterrupt)if(this.attackInfo&&a.ballHit(this)){this.collisionList.push(a);this.collReleaseTimeList.push(this.collReleaseTimer+0.5);this.killCloseRegenDestruct(32,a);!this.mergeEntity&&!this.state.noBarrierStop&&this.setState(k.BARRIER_BREAK)}else{if(this.state!=k.BARRIER_BREAK&&!this.state.noBarrierStop){this.setState(k.IDLE);
Vec2.length(this.coll.vel);ig.CollTools.getDistVec2(a.coll,this.coll,this.coll.vel);Vec2.length(this.coll.vel,100)}}else if(a instanceof ig.ENTITY.FerroSpot||a instanceof ig.ENTITY.OneTimeSwitch&&a.switchType=="ferroSwitch"){if(!(a instanceof ig.ENTITY.FerroSpot&&a.state!=0&&sc.model.isCombatActive())){var c=a instanceof ig.ENTITY.FerroSpot||!a.hasOverlap&&a.activeTime&&a.timer+0.05<a.activeTime;if(a.ballHit(this)&&c&&this.state.onQuickStop)this.state.onQuickStop(this,a instanceof ig.ENTITY.FerroSpot)}}else if(a.ballHit&&
this.state.onOtherBallHit&&(!this.state.ballHitFilter||this.state.ballHitFilter(a))&&a.ballHit(this)){if(this.state.onOtherBallHit)this.state.onOtherBallHit(this,a,b);this.collisionList.push(a);this.collReleaseTimeList.push(this.collReleaseTimer+0.5)}}}},overlapActivateCheck:function(){for(var a=ig.game.getOverlapEntities(this),b=a.length;b--;)this.collideWith(a[b],null)},killCloseRegenDestruct:function(a,b){for(var c=this.getAlignedPos(ig.ENTITY_ALIGN.BOTTOM,d),c=ig.game.getEntitiesInCircle(c,a,
1,4,null,null,null,b),e=c.length;e--;){var f=c[e];f instanceof ig.ENTITY.RegenDestruct&&f.ballHit(this)}},onPhysicsSquish:function(){this.respawn()},onTouchGround:function(a){if(this.state.onTouchGround)this.state.onTouchGround(this,a)},handleMovementTrace:function(a){if(this.state.onMoveTrace)this.state.onMoveTrace(this,a);this.parent(a)},setTeleportBall:function(a){this.teleportBall=a;a.addEntityAttached(this)},clearTeleportBall:function(){if(this.teleportBall){this.teleportBall.removeEntityAttached(this);
this.teleportBall=null}},onEntityKillDetach:function(){this.teleportBall=null;this.setState(k.IDLE)},doTeleport:function(){this.teleportBall=null;this.startZ=this.coll.pos.z;this.setState(k.IDLE)},onTeleportStart:function(a){ig.game.spawnEntity(sc.FerroWaveAttack,this.coll.pos.x-16,this.coll.pos.y-16,this.coll.pos.z,{waveTeleporter:a})},getTeleportZOffset:function(){return 12},getHitCenter:function(a,b){return this.getOverlapCenterCoords(a,b)},getHitVel:function(a,b){var c=b||{};Vec2.assign(c,this.coll.vel);
return c},getElement:function(){return this.attackInfo.element},getCombatant:function(){return ig.game.playerEntity},getCombatantRoot:function(){return ig.game.playerEntity},getAttackInfo:function(){return this.attackInfo},isWaterBubble:function(){return this.absorbState==o&&!(this.state==k.ICEDISK||this.state==k.ICEDISK_SLIDE)},isIceDisk:function(){return this.state==k.ICEDISK_SLIDE},steam:function(a,b){o.steam(this,a,b)},isCompressor:function(){return this.state==k.WAVE_COMPRESSOR||this.state==
k.SHOCK_COMPRESSOR},consume:function(){this.panel&&this.panel.onBubbleBurst();this.resetColl();this.clearAbsorbState();this.setState(k.IDLE);this.startZ=this.coll.baseZPos+12;this.effects.sheet.spawnOnTarget("absorbRegen",this);Vec2.mulF(this.coll.vel,-0.2)},onCompressorMoveEnd:function(a){if(a)this.respawn();else{this.resetColl();Vec2.length(this.coll.vel,150);this.setState(k.IDLE)}},_getAssistFactor:function(){return this.fastMode?1:sc.options.get("assist-puzzle-speed")},isBallAdjust:function(){return sc.model.player.currentElementMode==
sc.ELEMENT.WAVE?false:true},doBallAdjust:function(a,b,c){this.getCenter(a);Vec3.assign(c,this.coll.size);if(this.state==k.ICEDISK)return 5;sc.model.player.currentElementMode==sc.ELEMENT.SHOCK&&ig.CollTools.getDistVec2(this.coll,ig.game.playerEntity.coll,b);return sc.model.player.currentElementMode==sc.ELEMENT.HEAT?5:0},isBallDestroyer:function(){return this.state==k.ICEDISK&&sc.model.player.currentElementMode==sc.ELEMENT.HEAT||this.absorbState==o&&(sc.model.player.currentElementMode==sc.ELEMENT.HEAT||
sc.model.player.currentElementMode==sc.ELEMENT.COLD)?true:false},shootFromWall:function(a,b){this.state.shootFromWall&&this.state.shootFromWall(this,a,b)}});sc.FerroWaveAttack=ig.Entity.extend({startPos:Vec3.create(),targetPos:Vec3.create(),combatant:null,attackInfo:null,collisionList:[],timer:0,startedMove:false,effects:{sheet:new ig.EffectSheet("puzzle.ferro"),handle:null},init:function(a,b,c,d){this.parent(a,b,c,d);this.coll.type=ig.COLLTYPE.TRIGGER;this.coll.setSize(48,48,24);this.coll.zGravityFactor=
0;d.waveTeleporter.getAlignedPos(ig.ENTITY_ALIGN.BOTTOM,this.targetPos);this.targetPos.z=this.targetPos.z+8;this.getAlignedPos(ig.ENTITY_ALIGN.BOTTOM,this.startPos);this.combatant=ig.game.playerEntity;this.party=this.combatant.party;this.attackInfo=new sc.AttackInfo(this.combatant.params,{element:sc.ELEMENT.WAVE,hints:["COMPRESSED","FERRO"]});this.timer=0.5;this.effects.sheet.spawnFixed("waveConnect",this.startPos.x,this.startPos.y,this.startPos.z+4,this,{duration:0.4,target2Point:this.targetPos,
target2Offset:{x:0,y:0,z:8}})},update:function(){this.timer=this.timer-ig.system.tick;if(this.timer<0.2){if(!this.startedMove){this.startedMove=true;var a=Vec3.clockangle(Vec3.sub(this.targetPos,this.startPos,d));this.effects.sheet.spawnOnTarget("waveBall",this,{duration:-1,offset:{x:0,y:0,z:4}});this.effects.sheet.spawnOnTarget("waveBallTrail",this,{duration:-1,offset:{x:0,y:0,z:4},angle:a})}a=Math.min(1,1-this.timer/0.2);a=Vec3.lerp(this.startPos,this.targetPos,a,d);this.setPos(a.x-this.coll.size.x/
2,a.y-this.coll.size.y/2,a.z,true)}if(this.timer<=0){this.timer=0;this.kill()}else this.parent()},collideWith:function(a){if(this.attackInfo&&(a.damage||a.ballHit)&&this.collisionList.indexOf(a)==-1&&!(a instanceof sc.FerroEntity))a.damage&&a.party!=this.combatant.party?a.damage(this,this.attackInfo)&&this.collisionList.push(a):a.ballHit&&a.ballHit(this)&&(this._killed||this.collisionList.push(a))},getHitCenter:function(a,b){return this.getOverlapCenterCoords(a,b)},getHitVel:function(a,b){var c=b||
{};Vec2.assign(c,this.coll.vel);return c},getElement:function(){return this.attackInfo.element},getCombatant:function(){return this.combatant},getCombatantRoot:function(){return this.combatant.getCombatantRoot()},getAttackInfo:function(){return this.attackInfo}})});ig.baked=!0;
ig.module("game.feature.puzzle.entities.one-time-switch").requires("impact.base.entity").defines(function(){sc.ONE_TIME_SWTICH_TYPE={};ig.ENTITY.OneTimeSwitch=ig.AnimatedEntity.extend({hitCondition:null,ballDestroyer:true,timer:0,fullZHeight:0,variable:"",isOn:false,sounds:{hit:new ig.Sound("media/sound/battle/hit-7.ogg",0.4),bing:new ig.Sound("media/sound/puzzle/switch-activate-2.ogg",1)},switchType:null,data:null,fx:{},fxHandle:null,fxHideHandle:null,hasOverlap:false,_wm:new ig.Config({spawnable:true,
attributes:{switchType:{_type:"String",_info:"Type of Switch",_select:sc.ONE_TIME_SWTICH_TYPE},variable:{_type:"VarName",_info:"Variable to be se to true when switch is activated"},addValue:{_type:"VarName",_info:"Variable to increase by one when switch is activated"},activeTime:{_type:"Number",_info:"If >0: only keep switch active for said amount of time"},fixCount:{_type:"Integer",_info:"If >0: if addValue reached fixCount, remain active permanently"},spawnCondition:{_type:"VarCondition",_info:"Condition for Enemy to spawn",
_popup:true,_optional:true},fastMode:{_type:"Boolean",_info:"Make sure puzzle element is not slowed down by assist mode"}},label:function(){return"[ "+this.variable+" ]\n"+this.addValue+"++"}}),init:function(b,a,d,c){this.parent(b,a,d,c);this.coll.type=ig.COLLTYPE.VIRTUAL;this.coll.zGravityFactor=1E3;this.switchType=c.switchType;this.fastMode=c.fastMode||false;if(b=sc.ONE_TIME_SWTICH_TYPE[c.switchType]){if(b.collType)this.coll.type=b.collType;Vec3.assign(this.coll.size,b.size);Vec2.assign(this.coll.padding,
b.padding);this.hitCondition=b.hitCondition;this.fullZHeight=this.coll.size.z;if(b.noBallDestroyer)this.ballDestroyer=false;a=b.anims;if(b.useStyleSheet)if(d=ig.mapStyle.get(b.useStyleSheet)){a=ig.copy(a);if(a.sheet){a.sheet.src=d.sheet;if(d.x!==void 0)a.sheet.offX=d.x;if(d.y!==void 0)a.sheet.offY=d.y}else if(a.namedSheets)for(var e in a.namedSheets){var f=a.namedSheets[e];f.src=d.sheet;d.x!==void 0&&(f.offX=f.offX+d.x);d.y!==void 0&&(f.offY=f.offY+d.y)}}this.initAnimations(a);this.data=b;if(b.fx)for(var g in b.fx)this.fx[g]=
new ig.EffectHandle(b.fx[g])}this.variable=c.variable;this.addValue=c.addValue;this.activeTime=c.activeTime;this.fixCount=c.fixCount||0;if(!this.activeTime)this.coll.time.globalStatic=true;ig.vars.setDefault(this.variable,0);ig.vars.setDefault(this.addValue,0);if(this.fixCount&&ig.vars.get(this.addValue)>=this.fixCount){this.isOn=true;this.activeTime=0}if(this.variable)this.isOn=ig.vars.get(this.variable);if(this.isOn)this.coll.size.z=this.data.activeZHeight;this.setCurrentAnim(this.isOn?"on":this.getOffAnim())},
show:function(b){this.parent(b);if(this.fxHideHandle){this.fxHideHandle.stop();this.fxHideHandle=null}if(!b){this.animState.alpha=0;this.fx.show?this.fx.show.spawnOnTarget(this,{}):ig.game.effects.teleport.spawnOnTarget("showQuick",this,{})}},onHideRequest:function(){if(this.activeTime&&this.isOn){this.timer=0;this.setOff()}this.fx.hide?this.fxHideHandle=this.fx.hide.spawnOnTarget(this,{callback:this}):ig.game.effects.teleport.spawnOnTarget("hideQuick",this,{callback:this})},onEffectEvent:function(b){if(b==
this.fxHideHandle&&b.isDone()){this.fxHideHandle=null;this.hide()}},onKill:function(b){this.activeTime&&this.isOn&&this.setOff();for(var a in this.fx)this.fx[a].clearCached();this.parent(b)},update:function(){if(this.hasOverlap){var b=this.coll,a=b.pos,d=b.size,c=b.padding.x,b=b.padding.y,a=ig.game.getEntitiesInRectangle(a.x-c,a.y-b,a.z,d.x+c*2,d.y+b*2,d.z,this),d=a.length;for(this.hasOverlap=false;d--;)if(this.data.hitCondition(this,a[d]))this.hasOverlap=true;this.hasOverlap||this.setTempOn()}if(this.timer&&
!this.hasOverlap){this.timer=this.timer-ig.system.tick;if(this.timer<=0){this.timer=0;this.setOff();this.fxHandle&&this.fxHandle.stop();this.fxHandle=null;this.fx.tmpOnEnd&&this.fx.tmpOnEnd.spawnOnTarget(this);this.animSheet.hasAnimation("tmpOnEnd")?this.setCurrentAnim("tmpOnEnd",true,this.getOffAnim()):this.setCurrentAnim(this.getOffAnim())}else if(this.timer<this.data.preStopTime&&this.currentAnim!="tmpOnSlow"){if(this.fx.tmpOnSlow){this.fxHandle&&this.fxHandle.stop();this.fxHandle=this.fx.tmpOnSlow.spawnOnTarget(this,
{duration:-1})}this.setCurrentAnim("tmpOnSlow",true)}}this.parent()},ballHit:function(b){if(this.fxHideHandle||b.attackInfo&&b.attackInfo.hasHint("NO_PUZZLE")||this.hasOverlap)return false;if(this.hitCondition(this,b)){if(this.isOn&&(!this.activeTime||this.hasOverlap))return true;if(!this.isOn){ig.vars.set(this.variable,true);ig.vars.add(this.addValue,1);this.isOn=true}this.data.hideHitEffect||sc.combat.showHitEffect(this,b.getHitCenter(this),sc.ATTACK_TYPE.MASSIVE,b.getElement(),false,false,true);
ig.SoundHelper.playAtEntity(this.sounds.hit,this);ig.SoundHelper.playAtEntity(this.sounds.bing,this);if(this.activeTime){this.timer=this.activeTime/(this.fastMode?1:sc.options.get("assist-puzzle-speed"));if(this.data.checkOverlap)this.hasOverlap=true;this.setTempOn(this.hasOverlap)}else this.setOn()}else{if(this.data.ignoreInvalid)return false;sc.combat.showHitEffect(this,b.getHitCenter(this),sc.ATTACK_TYPE.NONE,b.getElement(),false,false,true)}return true},animationEnded:function(b){b=="preOn"&&
this.finalizeOn()},setTempOn:function(b){this.fxHandle&&this.fxHandle.stop();this.fxHandle=b?this.fx.tmpOnOverlap&&this.fx.tmpOnOverlap.spawnOnTarget(this,{duration:-1}):this.fx.tmpOn&&this.fx.tmpOn.spawnOnTarget(this,{duration:-1});this.setCurrentAnim(b?"tmpOnOverlap":"tmpOn",true,null)},setOn:function(){this.fxHandle&&this.fxHandle.stop();this.fxHandle=null;this.fx.on&&this.fx.on.spawnOnTarget(this);this.animSheet.hasAnimation("preOn")?this.setCurrentAnim("preOn",true,null,true,true):this.finalizeOn()},
finalizeOn:function(){this.coll.size.z=this.data.activeZHeight;this.animSheet.hasAnimation("preOnEnd")?this.setCurrentAnim("preOnEnd",true,"on"):this.setCurrentAnim("on",true)},varsChanged:function(){if(this.variable){var b=ig.vars.get(this.variable);if(this.isOn!=b){this.isOn=b;this.coll.size.z=this.isOn?this.activeZHeight:this.fullZHeight;this.setCurrentAnim(this.isOn?"on":this.getOffAnim(),true,null,true)}}if(this.activeTime&&this.fixCount&&ig.vars.get(this.addValue)>=this.fixCount){this.timer=
this.activeTime=0;this.setOn()}},getOffAnim:function(){return!this.activeTime||!this.animSheet.hasAnimation("tmpOff")?"off":"tmpOff"},setOff:function(){this.isOn=false;ig.vars.set(this.variable,false);ig.vars.sub(this.addValue,1)}});sc.ONE_TIME_SWTICH_TYPE["default"]={size:{x:16,y:16,z:17},padding:{x:4,y:4},activeZHeight:0,useStyleSheet:"puzzle",anims:{offset:{x:0,y:0,z:0},sheet:{src:null,width:16,height:32},SUB:[{name:"off",time:0.1,frames:[0,1,2,3],repeat:true},{name:"preOn",time:0.03,frames:[8,
9,10,11,8,9,10,11,8,9,10,11,8,9,10,11,8,9,10,10,11,11,11,8,8,8,8,8,12,13],repeat:false},{name:"preOnEnd",time:0.1,frames:[14,15],repeat:false},{name:"on",time:1,frames:[15],repeat:false},{name:"tmpOn",time:0.025,frames:[4,5,6,7],repeat:true},{name:"tmpOnSlow",time:0.05,frames:[4,5,6,7],repeat:true}]},hitCondition:function(b,a){return a.party==sc.COMBATANT_PARTY.PLAYER}};sc.ONE_TIME_SWTICH_TYPE["turret-switch"]={size:{x:24,y:24,z:21},padding:{x:0,y:0},activeZHeight:21,anims:{offset:{x:-1,y:1,z:0},
sheet:{src:"media/entity/objects/switch-special.png",width:24,height:48},SUB:[{name:"off",time:0.1,frames:[0],repeat:true},{name:"preOn",time:0.03,frames:[0,1,1,1,2],repeat:false},{name:"preOnEnd",time:0.03,frames:[3],repeat:false},{name:"on",time:1,frames:[3],repeat:false}]},hitCondition:function(b,a){return a.party==sc.COMBATANT_PARTY.ENEMY}};sc.ONE_TIME_SWTICH_TYPE.propeller={size:{x:16,y:16,z:24},padding:{x:4,y:4},activeZHeight:21,preStopTime:1,useStyleSheet:"propeller",anims:{sheet:{src:"media/map/heat-dng.png",
width:24,height:32,offX:320,offY:256},SUB:[{name:"off",time:0.1,frames:[0],repeat:true},{name:"tmpOn",time:0.033,frames:[3,4,5],repeat:true},{name:"tmpOnSlow",time:0.05,frames:[1,2,0],repeat:true},{name:"tmpOnEnd",time:0.05,frames:[0,0,1,1,2,2,0,0,0,1,1,1,2,2,2,2],repeat:false},{name:"on",time:0.033,frames:[3,4,5],repeat:true}]},fx:{tmpOn:{sheet:"puzzle.propeller",name:"tmpOn"},tmpOnSlow:{sheet:"puzzle.propeller",name:"tmpOnSlow"},tmpOnEnd:{sheet:"puzzle.propeller",name:"tmpOnEnd"}},hitCondition:function(b,
a){return a.attackInfo&&a.attackInfo.hasHint("STEAM")}};sc.ONE_TIME_SWTICH_TYPE.steamPipe={collType:ig.COLLTYPE.BLOCK,size:{x:16,y:16,z:10},padding:{x:0,y:0},activeZHeight:10,preStopTime:1,ignoreInvalid:true,hideHitEffect:true,useStyleSheet:"pipeSwitch",anims:{sheet:{src:"media/map/heat-dng.png",width:16,height:24,offX:368,offY:208,xCount:1},wallY:1,SUB:[{name:"off",time:0.1,frames:[0],repeat:true},{name:"on",time:0.1,frames:[1],repeat:true},{name:"tmpOn",time:0.05,frames:[0],repeat:true},{name:"tmpOn",
time:0.05,frames:[1,1,1,1,1,1],framesAlpha:[1,0.75,0.5,0.5,0.75,1],repeat:true},{name:"tmpOnSlow",time:0.05,frames:[1,0],repeat:true}]},fx:{tmpOn:{sheet:"puzzle.water-bubble",name:"steamSwitchTmp"},on:{sheet:"puzzle.water-bubble",name:"steamSwitchOn"}},hitCondition:function(b,a){return a.attackInfo&&a.attackInfo.hasHint("STEAM_PIPE")}};sc.ONE_TIME_SWTICH_TYPE.teslaSwitch={collType:ig.COLLTYPE.VIRTUAL,size:{x:16,y:16,z:16},padding:{x:0,y:0},activeZHeight:16,preStopTime:1,hideHitEffect:true,useStyleSheet:"teslaSwitch",
anims:{sheet:{src:"media/map/shockwave-dng.png",width:16,height:32,offX:208,offY:368,xCount:2},wallY:0,SUB:[{name:"off",time:0.1,frames:[0],repeat:true},{name:"on",time:0.1,frames:[1],repeat:true},{name:"tmpOn",time:0.05,frames:[0],repeat:true},{name:"tmpOn",time:0.05,frames:[1,1,1,1,1,1],framesAlpha:[1,0.75,0.5,0.5,0.75,1],repeat:true},{name:"tmpOnSlow",time:0.05,frames:[1,0],repeat:true}]},fx:{tmpOn:{sheet:"puzzle.tesla",name:"switchOnTmp"},on:{sheet:"puzzle.tesla",name:"switchOn"}},hitCondition:function(b,
a){return a.attackInfo&&a.attackInfo.hasHint("LIGHTNING")}};sc.ONE_TIME_SWTICH_TYPE.arSwitch={size:{x:16,y:16,z:17},padding:{x:4,y:4},activeZHeight:0,anims:{offset:{x:0,y:0,z:0},sheet:{src:"media/entity/objects/dungeon-ar.png",width:16,height:32,offX:192,offY:64,xCount:4},renderMode:"lighter",SUB:[{name:"off",time:0.1,frames:[0,1,2,3],repeat:true},{name:"preOn",time:0.03,frames:[8,9,10,11,8,9,10,11,8,9,10,11,8,9,10,11,8,9,10,10,11,11,11,8,8,8,8,8,12,13],repeat:false},{name:"preOnEnd",time:0.1,frames:[14,
15],repeat:false},{name:"on",time:1,frames:[15],repeat:false},{name:"tmpOn",time:0.025,frames:[4,5,6,7],repeat:true},{name:"tmpOnSlow",time:0.05,frames:[4,5,6,7],repeat:true}]},fx:{show:{sheet:"ar",name:"arSwitchShow"},hide:{sheet:"ar",name:"arSwitchHide"}},hitCondition:function(b,a){return a.party==sc.COMBATANT_PARTY.PLAYER}};sc.ONE_TIME_SWTICH_TYPE.waveSwitch={collType:ig.COLLTYPE.BLOCK,size:{x:24,y:24,z:24},padding:{x:0,y:0},activeZHeight:24,preStopTime:1,ignoreInvalid:true,hideHitEffect:false,
useStyleSheet:"waveSwitch",anims:{namedSheets:{box:{src:"media/map/shockwave-dng.png",width:24,height:48,offX:0,offY:0,xCount:1},shock:{src:"media/map/shockwave-dng.png",width:24,height:40,offX:24,offY:8}},SUB:[{wallY:1,sheet:"box",SUB:[{name:"on",time:0.1,frames:[0],repeat:true},{name:"off",time:0.1,frames:[0],repeat:true},{name:"tmpOn",time:0.1,frames:[0],repeat:true},{name:"tmpOnSlow",time:0.1,frames:[0],repeat:true},{name:"tmpOnEnd",time:0.1,frames:[0],repeat:true}]},{sheet:"shock",renderMode:"lighter",
SUB:[{name:"off",time:0.05,frames:[0,1,2,3],repeat:true},{name:"tmpOn",time:0.033,frames:[4,5,-1,-1,-1,5],repeat:true},{name:"tmpOnSlow",time:0.033,frames:[4,5,-1,5],repeat:true},{name:"tmpOnEnd",time:0.066,frames:[5],repeat:true}]}]},fx:{tmpOn:{sheet:"puzzle.compressor",name:"waveSwitchTmpOn"},on:{sheet:"puzzle.compressor",name:"waveSwitchOn"}},hitCondition:function(b,a){return a.attackInfo&&a.attackInfo.hasHint("COMPRESSED")&&a.getElement()==sc.ELEMENT.WAVE}};sc.ONE_TIME_SWTICH_TYPE.ferroSwitch=
{collType:ig.COLLTYPE.TRIGGER,size:{x:16,y:16,z:24},padding:{x:2,y:2},activeZHeight:24,preStopTime:1,ignoreInvalid:true,hideHitEffect:true,checkOverlap:true,noBallDestroyer:true,anims:{namedSheets:{ground:{src:"media/entity/objects/ferro.png",width:16,height:16,offX:144,offY:352},holo:{src:"media/entity/objects/ferro.png",width:16,height:16,offX:144,offY:320,xCount:6}},SUB:[{wallY:0,size:{x:16,y:16,z:0},sheet:"ground",time:0.1,repeat:true,SUB:[{name:"on",frames:[2]},{name:"off",frames:[1]},{name:"tmpOff",
frames:[5]},{name:"tmpOnOverlap",frames:[3]},{name:"tmpOn",time:0.066,frames:[3,3,4,0,0,4],repeat:true},{name:"tmpOnSlow",time:0.05,frames:[3,4,0,4],repeat:true},{name:"tmpOnEnd",time:0.1,frames:[3,0],repeat:true}]},{sheet:"holo",renderMode:"lighter",size:{x:16,y:0,z:16},SUB:[{name:"off",time:0.1,frames:[0,1,2,3],repeat:true,offset:{z:14}},{name:"tmpOff",time:0.1,frames:[6,7,8,9],repeat:true,offset:{z:14}},{name:"on",time:0.1,frames:[4],repeat:true},{name:"on",time:0.1,frames:[5],repeat:true,offset:{y:-9}}]}]},
fx:{tmpOn:{sheet:"puzzle.ferro",name:"switchTmpOn"},tmpOnOverlap:{sheet:"puzzle.ferro",name:"switchTmpOverlap"},on:{sheet:"puzzle.ferro",name:"switchOn"}},hitCondition:function(b,a){return a instanceof sc.FerroEntity&&!a.isRespawning()}}});ig.baked=!0;
ig.module("game.feature.puzzle.entities.element-shield").requires("impact.base.entity","impact.base.actor-entity","impact.feature.effect.effect-sheet").defines(function(){function b(a){return a instanceof sc.ElementShieldEntity}var a=["---","Heat","Cold","Shock","Wave"],d=Vec2.create(),c=Vec3.create();ig.ENTITY.ElementShieldSrc=ig.AnimatedEntity.extend({respawnTimer:0,currentShield:null,active:false,_wm:new ig.Config({spawnable:true,attributes:{spawnCondition:{_type:"VarCondition",_info:"Condition for Enemy to spawn",
_popup:true},element:{_type:"String",_info:"Element of shield",_select:["HEAT","COLD","SHOCK","WAVE"],_default:"HEAT"},onActivateAdd:{_type:"VarName",_info:"Add 1 if shield is activated",_optional:true}}}),init:function(a,b,c,d){this.parent(a,b,c,d);this.coll.type=ig.COLLTYPE.NONE;this.coll.setSize(16,16,0);this.coll.zGravityFactor=1E3;this.element=d.element||"HEAT";this.onActivateAdd=d.onActivateAdd||null;a=ig.mapStyle.get("puzzle2");this.initAnimations({sheet:{src:a.sheet,width:16,height:16,xCount:1,
offX:32,offY:48},SUB:[{name:"idle",time:1,frames:[0],repeat:false}]});this.setCurrentAnim("on")},show:function(a){this.parent(a);if(!a){this.animState.alpha=0;ig.game.effects.teleport.spawnOnTarget("showQuick",this,{})}this.active=true;this.spawnShield(a)},onHideRequest:function(){this.active=false;if(this.currentShield){this.currentShield.panel=null;this.currentShield.destroy()}ig.game.effects.teleport.spawnOnTarget("hideQuick",this,{callback:this})},onEffectEvent:function(a){a.isDone()&&this.hide()},
update:function(){if(this.respawnTimer){this.respawnTimer=this.respawnTimer-ig.system.tick;this.respawnTimer<=0&&this.spawnShield()}this.parent()},spawnShield:function(a){if(this.active){this.respawnTimer=0;this.setCurrentAnim("on");var b=this.getCenter(d);this.currentShield=ig.game.spawnEntity(sc.ElementShieldBallEntity,b.x,b.y,this.coll.pos.z+12,{panel:this,element:this.element},!a)}},onShieldReset:function(){this.currentShield=null;this.respawnTimer=1;this.onActivateAdd&&ig.vars.add(this.onActivateAdd,
1)}});sc.ElementShieldBallEntity=ig.AnimatedEntity.extend({_wm:new ig.Config({spawnable:true,attributes:{element:{_type:"String",_info:"Element of shield",_select:["HEAT","COLD","SHOCK","WAVE"]}}}),effects:{sheet:new ig.EffectSheet("puzzle.shield")},sounds:{charge:new ig.Sound("media/sound/puzzle/element-ball-charge.ogg",1,0)},panel:null,state:0,charge:{current:0,prev:0,timer:0},dischargeTimer:0,init:function(a,b,c,d){this.parent(a,b,c,d);this.coll.type=ig.COLLTYPE.IGNORE;this.coll.setSize(16,16,
16);this.coll.zGravityFactor=1;this.coll.float.height=12;this.coll.float.variance=3;this.coll.float.accel=5;this.coll.shadow.size=16;this.coll.zBounciness=0.5;this.coll.bounciness=0;this.coll.friction.air=0.2;this.coll.setPos(a-this.coll.size.x/2,b-this.coll.size.y/2,c);this.coll.setPadding(2,2);this.element=sc.ELEMENT[d.element];this.panel=d.panel;this.rotateTimer=0;a=new ig.LightHandle(this,ig.LIGHT_SIZE.L,0.1,0.1,-1,1,false);a.setOffset(0,4,0);ig.light.addLightHandle(a);this.initAnimations({shapeType:"Y_FLAT",
wallY:0,sheet:{src:"media/entity/objects/object-effects.png",width:24,height:24,xCount:5,offX:128,offY:64},SUB:[{time:1,frames:[0],repeat:false,SUB:[{name:"idle"},{name:"charge"}]},{time:1,renderMode:"lighter",repeat:false,SUB:[{name:"idle",frames:[1+(this.element-1)*2]},{name:"idle",frames:[-1,-1,-1,-1,0,1,2,3,4,5,-1,-1,-1,-1,-1,-1,-1,-1],time:0.05,tileOffset:9,repeat:true},{name:"charge",frames:[1+(this.element-1)*2]},{name:"charge",frames:[2+(this.element-1)*2]}]}]});this.setCurrentAnim("idle")},
show:function(b){this.parent(b);if(!b){this.animState.alpha=0;this.effects.sheet.spawnOnTarget("show"+a[this.element],this,{offset:{x:0,y:0,z:4}})}},onEffectEvent:function(a){if(!this._killed&&a.state==ig.EFFECT_STATE.ENDED){if(a==this.effects.hitHandle)this.effects.hitHandle=null;this.isDestroyed()&&this.kill()}},onActionEndDetach:function(){this.state<3&&this.destroy()},update:function(){var a=this.isCharged()?3:this.charge.current||Vec2.length(this.coll.vel)>20?2:1;this.rotateTimer=(this.rotateTimer+
a*ig.system.tick)%1;if(this.charge.timer){this.charge.timer=this.charge.timer-ig.system.tick;if(this.charge.timer<=0){this.charge.timer=0;this.charge.current||this.setCurrentAnim("idle")}}if(this.dischargeTimer){this.dischargeTimer=this.dischargeTimer-ig.system.tick;if(this.dischargeTimer<=0)if(this.isCharged())this.destroy();else{this.charge.prev=this._getVisibleCharge();this.charge.current--;this.charge.timer=0.1;this.dischargeTimer=this.charge.current>0?0.1:0}}this.parent()},updateSprites:function(){ig.AnimatedEntity.prototype.updateSprites.call(this);
if(this.sprites.length>0&&!this.isDestroyed()){var a=this.rotateTimer/1,b=this.sprites[0];b.setPivot(12,12);b.setTransform(1,1,a*Math.PI*2);b.setAlpha(0.6)}if(this.currentAnim=="charge"&&this.sprites.length>=3){a=this._getVisibleCharge()/4;a=a==1?24:2+Math.round(20*a);b=24-a;this.sprites[1].setGfxCut(0,a);this.sprites[2].setGfxCut(b,0)}else{this.sprites[1]&&this.sprites[1].setGfxCut(0,0);this.sprites[2]&&this.sprites[2].setGfxCut(0,0)}},_getVisibleCharge:function(){var a=this.charge.timer/0.1;return this.charge.prev*
a+this.charge.current*(1-a)},bounce:function(a,b,c){if(this.panel&&this.state==0)this.state=1;Vec2.assign(this.coll.vel,a);Vec2.length(this.coll.vel,b||180);c&&Vec2.flip(this.coll.vel)},ballHit:function(b){if(this.state>=3)return true;b.getHitCenter(this);var c=b.getElement(),g=b.getCombatant().getCombatantRoot();if(g.party!=sc.COMBATANT_PARTY.PLAYER)return false;var h=b.getHitVel(this,d),c=this.element==c,i=1;if(b instanceof sc.CompressedShockEntity||b instanceof sc.CompressedWaveEntity){i=2;b.destroy()}if(c){this.charge.prev=
this._getVisibleCharge();this.charge.current=this.charge.current+i;this.charge.timer=0;this.dischargeTimer=0.3*i;if(this.charge.current>=4){this.charge.current=4;this.state=3;ig.game.spawnEntity(sc.ElementShieldEntity,0,0,0,{source:this,element:this.element,target:g})}this.setCurrentAnim("charge")}this.clearHitHandle();g="hit";if(c){g="charge"+a[this.element];i=1+(this.charge.current-1)*0.2;ig.SoundHelper.playAtEntity(this.sounds.charge,this,false,{speed:i})}if(this.charge.current>=4){this.dischargeTimer=
0.3;Vec2.mulF(this.coll.vel,0);this.coll.time.globalStatic=true;this.effects.hitHandle=this.effects.sheet.spawnOnTarget(g+"Max",this,{duration:-1,offset:{x:0,y:0,z:4}});sc.combat.doDramaticEffect(this,ig.game.playerEntity,sc.DRAMATIC_EFFECT.ELEMENT_SHIELD,true)}else this.effects.hitHandle=this.effects.sheet.spawnOnTarget(g,this,{callback:this,duration:0.3,offset:{x:0,y:0,z:4}});i=150;if(this.isCharged()){i=!b.isBall?350:250;c=false}else if(b.isBall)b.attackInfo.hasHint("CHARGED")||(i=100);else{i=
100;c=false}!c||ig.CollTools.getGroundDistance(this.coll,ig.game.playerEntity.coll)>32?this.bounce(h,i,c):Vec2.mulF(this.coll.vel,0.5);return true},isBallDestroyer:function(){return true},isIdle:function(){return this.state==0},isCharged:function(){return this.state==3},isDestroyed:function(){return this.state==4},clearHitHandle:function(){if(this.effects.hitHandle){this.effects.hitHandle.setCallback(null);this.effects.hitHandle.stop()}},destroy:function(){if(!this.isDestroyed()){if(this.panel)this.panel.onShieldReset();
this.state=4;this.clearHitHandle();this.effects.hitHandle=this.effects.sheet.spawnOnTarget("destroy"+a[this.element],this,{callback:this,offset:{x:0,y:0,z:4}})}}});sc.ElementShieldEntity=ig.AnimatedEntity.extend({effects:{sheet:new ig.EffectSheet("puzzle.shield"),handle:null},target:null,timer:0,endWarning:false,init:function(c,d,g,h){this.parent(c,d,g,h);this.coll.type=ig.COLLTYPE.NONE;this.coll.setSize(48,48,0);this.element=h.element;this.target=h.target;c=h.source;this.initAnimations({guiSprites:true,
sheet:{src:"media/entity/objects/object-effects.png",width:48,height:48,xCount:2,offX:0,offY:64},offset:{y:256,z:256},SUB:[{time:1,frames:[0],repeat:false,name:"default"},{time:1,renderMode:"lighter",repeat:false,SUB:[{name:"default",frames:[1+this.element],offset:{y:257,z:257}},{name:"default",frames:[1],offset:{y:258,z:258}}]}]});this.setCurrentAnim("default");this.timer=8.4;this._updatePos();d=this.effects.sheet.spawnOnTarget("shieldAppear",this);d.setIgnoreSlowdown();d=this.effects.sheet.spawnOnTarget("shieldStart"+
a[this.element],this.target,{offset:{z:12},target2:c,target2Offset:{x:0,y:0,z:4}});d.setIgnoreSlowdown();this.effects.handle=this.effects.sheet.spawnOnTarget("shieldAura",this,{duration:-1});this.target.clearEntityAttached(b);this.target.addEntityAttached(this);c=[1,1,1,1];c[this.element-1]=0;c=new sc.COMBAT_SHIELDS.DIRECTIONAL({baseFactor:1,elementFactors:c,strength:"BLOCK_ALL",hitResist:"MASSIVE",stableOverride:"MASSIVE",neutralize:true,duration:-1,range:1},"elementOrbShield");this.connection=this.target.addShield(c,
0)},onEntityKillDetach:function(){this.timer&&this.destroy()},_updatePos:function(){var a=this.target.getAlignedPos(ig.ENTITY_ALIGN.BOTTOM,c);Vec2.addMulF(a,this.coll.size,-0.5);a.z=a.z+12;this.setPos(a.x,a.y,a.z)},deferredUpdate:function(){this._updatePos();if(this.timer){this.timer=this.timer-ig.system.tick;if(this.timer/8<0.25&&!this.endWarning){this.endWarning=true;if(this.effects.handle){this.effects.handle.stop();this.effects.handle=this.effects.sheet.spawnOnTarget("shieldAuraEnd",this,{duration:-1})}}if(sc.model.isCutscene())this.timer=
0;this.timer<=0&&this.destroy()}},destroy:function(){this.timer=0;this.connection.onEntityKillDetach();if(this.effects.handle){this.effects.handle.stop();this.effects.handle=null}this.effects.sheet.spawnOnTarget("shieldClear"+a[this.element],this,{callback:this})},onEffectEvent:function(a){this._killed||a.state==ig.EFFECT_STATE.ENDED&&this.kill()},updateSprites:function(){ig.AnimatedEntity.prototype.updateSprites.call(this);if(this.sprites.length>=2){var a=this.timer/2;this.sprites[1].setPivot(24,
24);this.sprites[1].rotate=a*Math.PI*2}if(this.timer<=8){var a=this.timer/8,b=1;a<0.25&&(b=Math.abs(Math.cos((0.25-a)*8/0.15*Math.PI)));this.sprites.length>=2&&this.sprites[1].setAlpha(b);if(this.sprites.length>=3){b=Math.ceil(4+KEY_SPLINES.EASE_IN_OUT.get(1-a)*40);a=0.5*(1-a);this.sprites[2].setGfxCut(b,0);this.sprites[2].setTransform(1,1,a*Math.PI*2)}}}});sc.ElementShieldEntity.clearRunningShields=function(a){a.clearEntityAttached(b)}});ig.baked=!0;
ig.module("game.feature.puzzle.entities.floor-switch").requires("impact.base.entity","impact.feature.effect.effect-sheet").defines(function(){sc.FLOOR_SWITCH_TYPE={PERMANENT:{permanent:true},WHILE_ON_TOP:{delay:0},UNDOABLE:{permanent:true,undoable:true}};ig.ENTITY.FloorSwitch=ig.AnimatedEntity.extend({hitCondition:null,ballDestroyer:true,switchType:null,variable:"",isOn:false,lockCondition:null,setOnDelay:0,effects:{sheet:new ig.EffectSheet("puzzle")},_wm:new ig.Config({spawnable:true,attributes:{spawnCondition:{_type:"VarCondition",
_info:"Condition for Anti Compressor to spawn",_popup:true,_optional:true},switchType:{_type:"String",_info:"Type of floor switch",_select:sc.FLOOR_SWITCH_TYPE},variable:{_type:"VarName",_info:"Variable to be increased by 1 when switch is activated. IMPORTANT: MUST BE TMP when switchType ist NOT PERMANENT!"},lockCondition:{_type:"VarCondition",_info:"If specified: Switch will always stick while condition is true",_optional:true}},label:function(){return"[ "+this.variable+" ]"}}),init:function(b,a,
d,c){this.parent(b,a,d,c);this.coll.type=ig.COLLTYPE.BLOCK;this.coll.zGravityFactor=1;this.coll.weight=-1;this.coll.time.globalStatic=true;this.coll.setSize(16,16,1);b=ig.mapStyle.get("puzzle2");this.initAnimations({sheet:{src:b.sheet,width:16,height:16,offX:0,offY:48},SUB:[{name:"off",time:1,frames:[0],repeat:false},{name:"on",time:1,frames:[1],repeat:false}]});this.switchType=sc.FLOOR_SWITCH_TYPE[c.switchType]||sc.FLOOR_SWITCH_TYPE.PERMANENT;this.variable=c.variable;if(c.lockCondition)this.lockCondition=
new ig.VarCondition(c.lockCondition);ig.vars.setDefault(this.variable,0);if(this.switchType.permanent)this.isOn=ig.vars.get(this.variable);if(!this.switchType.permanent&&this.lockCondition&&this.lockCondition.evaluate()){this.isOn=true;ig.vars.add(this.variable,1)}if(this.isOn)this.coll.size.z=1;this.setCurrentAnim(this.isOn?"on":"off")},show:function(b){this.parent(b);if(!b){this.animState.alpha=0;ig.game.effects.teleport.spawnOnTarget("showFast",this,{})}},onHideRequest:function(){ig.game.effects.teleport.spawnOnTarget("hideFast",
this,{callback:this})},onEffectEvent:function(b){if(b.isDone()){this.deactivate();this.hide()}},_isStillPressed:function(){var b=ig.game.getEntitiesOnTop(this),a=this.coll,a=ig.game.getEntitiesInRectangle(a.pos.x,a.pos.y,a.pos.z,a.size.x,a.size.y,a.size.z+1,this);return this.checkEntityArraySupport(b)||this.checkEntityArraySupport(a)},update:function(){if((this.isOn||this.setOnDelay)&&!this.switchType.permanent&&(!this.lockCondition||!this.lockCondition.evaluate()))this._isStillPressed()||this.deactivate();
if(this.setOnDelay){this.setOnDelay=this.setOnDelay-ig.system.tick;if(this.setOnDelay<=0){this.setOnDelay=0;this.activate(true)}}this.parent()},activate:function(b){if(!this.isOn)if(!b&&this.switchType.delay){if(!this.setOnDelay)this.setOnDelay=this.switchType.delay}else{this.setCurrentAnim("on");this.isOn=true;ig.vars.add(this.variable,1);this.effects.sheet.spawnOnTarget("floorSwitchActivate",this)}},deactivate:function(){this.setOnDelay=0;if(this.isOn){this.isOn=false;this.setCurrentAnim("off");
this.switchType.undoable?ig.vars.set(this.variable,0):ig.vars.sub(this.variable,1);this.effects.sheet.spawnOnTarget("floorSwitchDeactivate",this)}},varsChanged:function(){if(this.isOn&&(this.switchType.undoable&&this.variable)&&!ig.vars.get(this.variable)){this.deactivate();this._isStillPressed()&&this.activate()}},collideWith:function(b){this.isEntitySupported(b)&&this.activate()},onGroundAdd:function(b){this.isEntitySupported(b)&&this.activate()},checkEntityArraySupport:function(b){for(var a=b.length;a--;)if(this.isEntitySupported(b[a]))return true;
return false},isEntitySupported:function(b){return b.isPlayer?!this.isOn&&!this.switchType.permanent&&!ig.CollTools.isMinOverlap(this.coll,b.coll,4,4)?false:true:b instanceof ig.ENTITY.PushPullBlock||b instanceof ig.ENTITY.WavePushPullBlock||b instanceof ig.ENTITY.SlidingBlock?true:false}});sc.COMBAT_POI.FLOOR_SWITCH={_wm:{attributes:{}},filterEntities:function(b,a){for(var d=a.length;d--;){var c=a[d];c instanceof ig.ENTITY.FloorSwitch&&b.push(c)}return b}}});ig.baked=!0;
ig.module("game.feature.puzzle.entities.magnet").requires("impact.base.entity","impact.feature.effect.effect-sheet","game.feature.combat.combat-target-event","impact.base.actor-entity").defines(function(){var b=Vec2.create(),a={};sc.COMBAT_ENEMY_EVENT.MAGNET_PULL={_wm:{attributes:{}},check:function(){return true}};ig.ENTITY.Magnet=ig.AnimatedEntity.extend({dir:0,targetDir:0,defaultDir:0,face:Vec2.create(),altDirs:[],pull:{timer:0,entities:[],pulling:[],moved:[],done:false},effects:{sheet:new ig.EffectSheet("puzzle.magnet"),
handle:null},_wm:new ig.Config({spawnable:true,attributes:{dir:{_type:"Face",_info:"Direction to face",_select:ig.ActorEntity.FACE4},spawnCondition:{_type:"VarCondition",_info:"Condition for prop to appear",_popup:true},altDirs:{_type:"MagnetAltDirs",_info:"Other types depending on var conditions",_optional:true}}}),init:function(a,b,e,f){this.parent(a,b,e,f);this.coll.type=ig.COLLTYPE.VIRTUAL;this.coll.setSize(16,16,24);this.coll.zGravityFactor=1E3;this.dir=this.targetDir=this.defaultDir=ig.ActorEntity.FACE4[f.dir]||
0;ig.ActorEntity.getFaceVec(this.dir,this.face);if(a=ig.mapStyle.get("magnet")){this.initAnimations({DOCTYPE:"MULTI_DIR_ANIMATION",sheet:{src:a.sheet,width:16,height:32,offX:a.x,offY:a.y},shapeType:"Y_FLAT",SUB:[{dirs:8,flipX:[0,0,0,0,0,1,1,1],tileOffsets:[0,3,1,4,2,4,1,3],dirOffsets:[[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[1,0,0],[1,0,0],[1,0,0]],SUB:[{name:"off",time:0.1,frames:[0],repeat:false}]},{dirs:4,flipX:[0,0,0,1],tileOffsets:[0,1,2,1],dirOffsets:[[0,0,0],[0,0,0],[0,0,0],[1,0,0]],SUB:[{name:"on",
time:0.05,frames:[0,5],repeat:true}]}]});this.setCurrentAnim("off")}if(f.altDirs){f=f.altDirs;for(a=0;a<f.length;++a)this.altDirs[a]={condition:new ig.VarCondition(f[a].condition),dir:ig.ActorEntity.FACE4[f[a].dir]}}this.updateDir(true)},onHideRequest:function(){ig.game.effects.teleport.spawnOnTarget("hideDefault",this,{callback:this})},onEffectEvent:function(a){a.isDone()&&this.hide()},update:function(){if(this.isPullActive()){this.pullEntities();if(this.pull.timer>0){this.fetchPullEntities();this.pull.timer=
this.pull.timer-ig.system.tick;if(this.pull.timer<=0)this.pull.timer=0}if(!this.isPullActive()){this.effects.handle.stop();this.effects.handle=null;this.pull.entities.length=0;this.setCurrentAnim("off")}}else if(this.targetDir!=this.dir){var a=ig.ActorEntity.getFaceVec(this.targetDir,b);if(Vec2.rotateToward(this.face,a,Math.PI*2*ig.system.tick*3))this.dir=this.targetDir}this.parent()},startPull:function(){this.dir=this.targetDir;ig.ActorEntity.getFaceVec(this.dir,this.face);this.pull.timer=0.4;this.setCurrentAnim("on");
this.effects.handle=this.effects.sheet.spawnOnTarget("active",this,{duration:-1,offset:{x:0,y:0,z:14},angle:Vec2.clockangle(this.face)});this.fetchPullEntities()},fetchPullEntities:function(){var a=-8,c=-8,e=16,f=16;if(this.face.x){e=640;a=this.face.x<0?-640:0}if(this.face.y){f=640;c=this.face.y<0?-640:0}for(var g=this.coll,h=this.getCenter(b),a=ig.game.getEntitiesInRectangle(h.x+a,h.y+c,g.pos.z+4,e,f,16,this,this.pull.entities),c=a.length;c--;){e=a[c];if(e.onMagnetStart&&e.onMagnetStart()){e.coll.zGravityFactor=
0;e.magnetGrabId=this.id;this.effects.sheet.spawnOnTarget("pull",e,{duration:-1});this.pull.entities.push(e);this.pull.pulling.push(e)}}},isPullActive:function(){return this.pull.timer>0||this.pull.pulling.length>0},pullEntities:function(){for(var d=true,c=this.pull.pulling.length,e=a;c--;){var f=this.pull.pulling[c];if(f.magnetGrabId==this.id){var g=ig.CollTools.getDistVec2(this.coll,f.coll,b),e=this.face.x?Math.abs(g.x)-f.coll.size.x/2-this.coll.size.x/2:Math.abs(g.y)-f.coll.size.y/2-this.coll.size.y/
2;if(e>0){var e=Math.min(ig.system.tick*300,e),g=-this.face.x*e,h=-this.face.y*e,e=ig.game.physics.initTraceResult(a);ig.game.traceEntity(e,f,g,h,0,0,0,ig.COLLTYPE.IGNORE);if(e.dist>0){this.pull.moved[c]=true;d=false;f.setPos(f.coll.pos.x+g*e.dist,f.coll.pos.y+h*e.dist,f.coll.pos.z,true)}}}}if(d){for(c=this.pull.pulling.length;c--;){f=this.pull.pulling[c];ig.EffectTools.clearEffects(f);f.onMagnetEnd(this.pull.moved[c]);f.coll.zGravityFactor=1;f.coll.vel.z=0}this.pull.pulling.length=0;this.pull.moved.length=
0}},varsChanged:function(){this.updateDir(false)},updateDir:function(a){for(var b=this.defaultDir,e=this.altDirs.length;e--;)if(this.altDirs[e].condition.evaluate()){b=this.altDirs[e].dir;break}if(b!=this.targetDir){this.dir=this.targetDir;this.targetDir=b}if(a){this.dir=this.targetDir;ig.ActorEntity.getFaceVec(this.dir,this.face)}},ballHit:function(a){var b=a.getHitCenter(this);a.getElement()==sc.ELEMENT.SHOCK&&!this.isPullActive()&&this.startPull();sc.combat.showHitEffect(this,b,sc.ATTACK_TYPE.NONE,
a.getElement(),false,false,true);return true}})});ig.baked=!0;
ig.module("game.feature.puzzle.entities.multi-hit-switch").requires("impact.base.entity").defines(function(){sc.MULTI_HIT_SWTICH_TYPE={};ig.ENTITY.MultiHitSwitch=ig.AnimatedEntity.extend({hitCondition:null,ballDestroyer:true,activeZHeight:0,variable:"",isOn:false,hitsToActive:0,currentHits:0,decreaseDelay:0,decreaseRepeat:0,timerUntilDecrease:0,timerDecreaseStep:0,hitSound:new ig.Sound("media/sound/battle/hit-7.ogg",0.4),countSound:new ig.Sound("media/sound/puzzle/counter.ogg",1),activateSound:new ig.Sound("media/sound/puzzle/switch-activate-2.ogg",
1),fx:{},_wm:new ig.Config({spawnable:true,attributes:{switchType:{_type:"String",_info:"Type of Switch",_select:sc.MULTI_HIT_SWTICH_TYPE},variable:{_type:"VarName",_info:"Variable to be se to true when switch is activated"},addValue:{_type:"VarName",_info:"Variable to increase by one when switch is activated"},spawnCondition:{_type:"VarCondition",_info:"Condition for Enemy to spawn",_popup:true,_optional:true}},label:function(){return"Hits: "+this.hitsToActive+" [ "+this.variable+" ]\n"+this.addValue+
"++"}}),init:function(b,a,d,c){this.parent(b,a,d,c);this.coll.type=ig.COLLTYPE.VIRTUAL;this.coll.time.globalStatic=true;if(b=sc.MULTI_HIT_SWTICH_TYPE[c.switchType]){Vec3.assign(this.coll.size,b.size);Vec2.assign(this.coll.padding,b.padding);this.hitCondition=b.hitCondition;this.hitsToActive=b.hitCount;this.activeZHeight=b.activeZHeight;this.decreaseDelay=b.decreaseDelay;this.decreaseRepeat=b.decreaseRepeat;if(b.useStyleSheet){a=ig.mapStyle.get("puzzle");b.anims.sheet.src=a.sheet}if(b.fx)for(var e in b.fx)this.fx[e]=
new ig.EffectHandle(b.fx[e]);this.initAnimations(b.anims)}this.variable=c.variable;this.addValue=c.addValue;ig.vars.setDefault(this.variable,0);ig.vars.setDefault(this.addValue,0);if(this.isOn=ig.vars.get(this.variable))this.coll.size.z=this.activeZHeight;this.setCurrentAnim(this.isOn?"on":"off")},show:function(b){this.parent(b);if(this.fxHideHandle){this.fxHideHandle.stop();this.fxHideHandle=null}if(!b){this.animState.alpha=0;this.fx.show?this.fx.show.spawnOnTarget(this,{}):ig.game.effects.teleport.spawnOnTarget("showQuick",
this,{})}},onHideRequest:function(){this.fx.hide?this.fxHideHandle=this.fx.hide.spawnOnTarget(this,{callback:this}):ig.game.effects.teleport.spawnOnTarget("hideQuick",this,{callback:this})},onEffectEvent:function(b){if(b==this.fxHideHandle&&b.isDone()){this.fxHideHandle=null;this.hide()}},onKill:function(b){for(var a in this.fx)this.fx[a].clearCached();this.parent(b)},update:function(){this.parent();if(!(this.isOn||this.currentHits<=0))if(this.timerUntilDecrease<=0)if(this.timerDecreaseStep<=0){this.currentHits--;
this.timerDecreaseStep=this.decreaseRepeat;this._setAnimation()}else this.timerDecreaseStep=this.timerDecreaseStep-ig.system.tick;else this.timerUntilDecrease=this.timerUntilDecrease-ig.system.tick},ballHit:function(b){if(!this.isOn&&this.hitCondition(this,b)){this.timerUntilDecrease=this.decreaseDelay;this.timerDecreaseStep=this.decreaseRepeat;this.currentHits++;ig.SoundHelper.playAtEntity(this.hitSound,this);if(this.currentHits>=this.hitsToActive){this.isOn=true;this.setCurrentAnim("switch",true,
null,true,true);sc.combat.showHitEffect(this,b.getHitCenter(this),sc.ATTACK_TYPE.MASSIVE,b.getElement(),false,false,true);ig.SoundHelper.playAtEntity(this.activateSound,this);ig.vars.set(this.variable,true);ig.vars.add(this.addValue,1)}else{this._setAnimation();ig.SoundHelper.playAtEntity(this.countSound,this);sc.combat.showHitEffect(this,b.getHitCenter(this),sc.ATTACK_TYPE.LIGHT,b.getElement(),false,false,true)}}else sc.combat.showHitEffect(this,b.getHitCenter(this),sc.ATTACK_TYPE.NONE,b.getElement(),
false,false,true);return true},animationEnded:function(b){if(b=="switch"){this.coll.size.z=this.activeZHeight;this.setCurrentAnim("switch_end",true,"on")}},_setAnimation:function(){this.setCurrentAnim(this.currentHits?"step"+this.currentHits:"off")}});sc.MULTI_HIT_SWTICH_TYPE["default"]={size:{x:16,y:16,z:17},padding:{x:4,y:4},activeZHeight:0,hitCount:5,decreaseDelay:0.3,decreaseRepeat:0.05,useStyleSheet:true,anims:{offset:{x:0,y:0,z:0},sheet:{src:null,width:16,height:32,offY:32},SUB:[{name:"off",
time:1,frames:[0],repeat:false},{name:"switch",time:0.05,frames:[5,6,7,8,9,5,6,7,8,9,5,6,6,7,7,8,8,9,9,9,10,10,10,10,11,12],repeat:false},{name:"switch_end",time:0.03,frames:[13],repeat:false},{name:"on",time:1,frames:[13],repeat:false},{name:"step1",time:1,frames:[1],repeat:false},{name:"step2",time:1,frames:[2],repeat:false},{name:"step3",time:1,frames:[3],repeat:false},{name:"step4",time:1,frames:[4],repeat:false}]},hitCondition:function(b,a){return a.party==sc.COMBATANT_PARTY.PLAYER}};sc.MULTI_HIT_SWTICH_TYPE.arSwitch=
{size:{x:16,y:16,z:17},padding:{x:4,y:4},activeZHeight:0,hitCount:5,decreaseDelay:0.3,decreaseRepeat:0.05,useStyleSheet:false,anims:{offset:{x:0,y:0,z:0},sheet:{src:"media/entity/objects/dungeon-ar.png",width:16,height:32,offY:256},renderMode:"lighter",SUB:[{name:"off",time:1,frames:[0],repeat:false},{name:"switch",time:0.05,frames:[5,6,7,8,9,5,6,7,8,9,5,6,6,7,7,8,8,9,9,9,10,10,10,10,11,12],repeat:false},{name:"switch_end",time:0.03,frames:[13],repeat:false},{name:"on",time:1,frames:[13],repeat:false},
{name:"step1",time:1,frames:[1],repeat:false},{name:"step2",time:1,frames:[2],repeat:false},{name:"step3",time:1,frames:[3],repeat:false},{name:"step4",time:1,frames:[4],repeat:false}]},fx:{show:{sheet:"ar",name:"arSwitchShow"},hide:{sheet:"ar",name:"arSwitchHide"}},hitCondition:function(b,a){return a.party==sc.COMBATANT_PARTY.PLAYER}};sc.MULTI_HIT_SWTICH_TYPE.old={size:{x:16,y:16,z:17},activeZHeight:0,hitCount:4,decreaseDelay:0.3,decreaseRepeat:0.05,anims:{offset:{x:-1,y:1,z:0},sheet:{src:"media/entity/objects/switch2.png",
width:16,height:32},SUB:[{name:"off",time:1,frames:[16],repeat:false},{name:"switch",time:0.03,frames:[4,5,6,7,4,5,6,7,4,5,6,7,4,5,6,7,4,5,6,6,7,7,7,4,4,4,4,4,8,9],repeat:false},{name:"switch_end",time:0.03,frames:[10,11,12,13,14,15],repeat:false},{name:"on",time:1,frames:[15],repeat:false},{name:"step1",time:1,frames:[17],repeat:false},{name:"step2",time:1,frames:[18],repeat:false},{name:"step3",time:1,frames:[19],repeat:false}]},hitCondition:function(b,a){return a.party==sc.COMBATANT_PARTY.PLAYER}}});
ig.baked=!0;
ig.module("game.feature.puzzle.entities.bounce-switch").requires("impact.base.entity","impact.base.game","impact.feature.effect.effect-sheet").defines(function(){sc.BounceSwitchGroups=ig.GameAddon.extend({groups:{},effects:new ig.EffectSheet("puzzle"),init:function(){this.parent("BounceSwitchGroups")},registerSwitch:function(b,a){var d=this.getGroup(b.group);d.endSwitch=b;d.variable=a;ig.vars.setDefault(d.variable,false);if(this.isGroupResolved(b.group))for(var c=d.blocks.length;c--;)d.blocks[c].onGroupResolve(true)},registerBlock:function(b){this.getGroup(b.group).blocks.push(b)},
evaluateGroup:function(b){var a=this.getGroup(b);this.resetCamera(b);a.cameraHandle&&ig.camera.removeTarget(a.cameraHandle,"NORMAL",KEY_SPLINES.EASE_IN_OUT);a.finalHit&&a.blockHitCount==a.blocks.length?this.resolveGroup(b):this.resetGroup(b)},resetGroup:function(b){for(var b=this.getGroup(b),a=b.blocks.length;a--;)b.blocks[a].onGroupReset();b.endSwitch.onGroupReset();b.finalHit=false;b.blockHitCount=0},resolveGroup:function(b){b=this.getGroup(b);ig.vars.set(b.variable,true);for(var a=b.blocks.length;a--;)b.blocks[a].onGroupResolve(false);
b.endSwitch.onGroupResolve()},setCameraBall:function(b,a){this.resetCamera(b);var d=this.groups[b];d.overrideHandle=new ig.Camera.TargetHandle(new ig.Camera.MultiEntityTarget([a,ig.game.playerEntity]),0,0);ig.camera.pushTarget(d.overrideHandle,"FAST",KEY_SPLINES.EASE_IN_OUT)},setCameraPos:function(b,a){this.resetCamera(b);var d=this.groups[b];d.overrideHandle=new ig.Camera.TargetHandle(new ig.Camera.PosTarget(a),0,0);ig.camera.pushTarget(d.overrideHandle,"FAST",KEY_SPLINES.EASE_IN_OUT)},resetCamera:function(b){b=
this.groups[b];b.overrideHandle&&ig.camera.removeTarget(b.overrideHandle,"FAST",KEY_SPLINES.EASE_IN_OUT)},isGroupBallConflict:function(b,a){b=this.getGroup(b);return b.currentBall&&b.currentBall!=a},isGroupResolved:function(b){return(b=this.getGroup(b))&&ig.vars.get(b.variable)},isBallOfAnyGroup:function(b){for(var a in this.groups)if(this.groups[a]&&this.groups[a].currentBall==b)return true;return false},getEndSwitch:function(b){return this.getGroup(b).endSwitch},getHitCount:function(b){return this.getGroup(b).blockHitCount},
onBlockHit:function(b,a){var d=this.getGroup(b.group);if(d.currentBall&&d.currentBall!=a)return false;if(!d.currentBall){d.currentBall=a;this.effects.spawnOnTarget("bounceTrail",a,{duration:-1,align:ig.ENTITY_ALIGN.CENTER});a.changeSpeed(0.75)}d.blockHitCount++;return d.blockHitCount},onSwitchHit:function(b,a){var d=this.getGroup(b.group);if(d.currentBall&&d.currentBall!=a)return false;d.currentBall=a;d.finalHit=true;return d.blockHitCount==d.blocks.length?true:false},onDeferredUpdate:function(){for(var b in this.groups){var a=
this.groups[b];if(a.currentBall&&a.currentBall._killed){a.currentBall=null;this.evaluateGroup(b)}}},onReset:function(){this.groups={}},onLevelLoadStart:function(){this.groups={}},getGroup:function(b){this.groups[b]||(this.groups[b]={endSwitch:null,variable:null,blocks:[],blockHitCount:0,finalHit:false,currentBall:null,cameraHandle:null,overrideHandle:null});return this.groups[b]}});ig.addGameAddon(function(){return sc.bounceSwitchGroups=new sc.BounceSwitchGroups});ig.ENTITY.BounceSwitch=ig.AnimatedEntity.extend({ballDestroyer:true,
variable:null,group:null,isOn:false,effects:new ig.EffectSheet("puzzle"),sounds:{hit:new ig.Sound("media/sound/puzzle/highlight-switch-1.ogg",1),bing:new ig.Sound("media/sound/puzzle/highlight-switch-2.ogg",1),fail:new ig.Sound("media/sound/puzzle/highlight-switch-3.ogg",1)},timer:0,cameraHandle:null,_wm:new ig.Config({spawnable:true,attributes:{variable:{_type:"VarName",_info:"Variable to be se to true when switch is activated"},group:{_type:"String",_info:"Group Name to assign bouncing blocks to switch"}},
label:function(){return"<"+this.group+">\n[ "+this.variable+" ]"}}),init:function(b,a,d,c){this.parent(b,a,d,c);this.coll.type=ig.COLLTYPE.VIRTUAL;this.coll.time.globalStatic=true;Vec3.assignC(this.coll.size,24,24,24);this.group=c.group;this.variable=c.variable;window.wm||sc.bounceSwitchGroups.registerSwitch(this,c.variable);b=ig.mapStyle.get("puzzle2");this.initAnimations({namedSheets:{base:{src:b.sheet,width:24,height:28,offX:168,xCount:2},cube:{src:b.sheet,width:16,height:24,offX:224,xCount:2},
top:{src:b.sheet,width:8,height:8,offX:216,offY:48}},SUB:[{size:{x:24,y:26,z:0},offset:{y:0},sheet:"base",SUB:[{name:"off",time:0.1,frames:[0]},{name:"rolling",time:0.1,frames:[0]},{name:"rollingEnd",time:0.1,frames:[0]},{name:"flyDown",time:0.033,frames:[0,0,1]},{name:"impact",time:0.05,frames:[2]},{name:"on",time:0.1,frames:[3]}]},{size:{x:16,y:16,z:8},offset:{z:12,y:-4},sheet:"cube",repeat:true,SUB:[{name:"off",time:0.1,frames:[0,1,2,3]},{name:"rolling",time:0.03,frames:[0,1,2,3]},{name:"rollingEnd",
time:0.06,frames:[0,1,2,3,3,0,0,0],repeat:false},{name:"flyDown",time:0.033,frames:[0,0,-1],repeat:false,framesGfxOffset:[0,2,0,6,0,0]}]},{size:{x:8,y:8,z:0},offset:{z:20,y:-8},sheet:"top",repeat:true,frames:[0],time:0.05,SUB:[{name:"off"},{name:"rolling",frames:[0,1,2,3,4]},{name:"rollingEnd",frames:[0,1,2,3,4]}]}]});if(this.isOn=sc.bounceSwitchGroups.isGroupResolved(this.group))this.coll.size.z=0;this.setCurrentAnim(this.isOn?"on":"off")},update:function(){if(this.timer>0){this.timer=this.timer-
ig.system.tick;if(this.timer<=0){this.setCurrentAnim("rollingEnd",true,null,true,true);this.timer=0}}this.parent()},ballHit:function(b){if(this.isOn||!b.isBall||sc.bounceSwitchGroups.isGroupBallConflict(this.group,b)){sc.combat.showHitEffect(this,b.getHitCenter(this),sc.ATTACK_TYPE.NONE,b.getElement(),false,false,true);return true}if(!this.isOn){this.isOn=true;this.setCurrentAnim("rolling");if(sc.bounceSwitchGroups.onSwitchHit(this,b)){sc.combat.showHitEffect(this,b.getHitCenter(this),sc.ATTACK_TYPE.MASSIVE,
b.getElement(),false,false,true);this.effects.spawnOnTarget("bounceFinal",this);ig.SoundHelper.playAtEntity(this.sounds.hit,this)}else{sc.combat.showHitEffect(this,b.getHitCenter(this),sc.ATTACK_TYPE.NONE,b.getElement(),false,false,true);ig.SoundHelper.playAtEntity(this.sounds.fail,this)}}return true},animationEnded:function(b){if(b=="rollingEnd")this.setCurrentAnim("flyDown",true,null,true,true);else if(b=="flyDown"){this.coll.size.z=0;if(this.cameraHandle){ig.camera.removeTarget(this.cameraHandle,
"NORMAL",KEY_SPLINES.EASE_IN_OUT);this.cameraHandle=null}this.effects.spawnOnTarget("bounceHit",this,{offset:{z:4}});this.setCurrentAnim("impact",true,"on");ig.SoundHelper.playAtEntity(this.sounds.bing,this)}},onGroupReset:function(){this.effects.spawnOnTarget("bounceDenied",this);this.isOn=false;this.setCurrentAnim("off")},onGroupResolve:function(){this.timer=0.5;this.cameraHandle=new ig.Camera.TargetHandle(new ig.Camera.EntityTarget(this),0,0);ig.camera.pushTarget(this.cameraHandle,"FAST",KEY_SPLINES.EASE_OUT);
var b=new ig.Rumble.RumbleHandle("RANDOM","STRONGER","FASTER",0.3,true);ig.rumble.addRumble(b)}});sc.BOUNCE_BLOCK_TYPE={};ig.ENTITY.BounceBlock=ig.AnimatedEntity.extend({group:null,blockState:0,maxZHeight:0,timer:null,cameraAction:null,effects:new ig.EffectSheet("puzzle"),ballTime:0,sounds:{bing:new ig.Sound("media/sound/puzzle/highlight-block.ogg",0.8)},_wm:new ig.Config({spawnable:true,attributes:{blockType:{_type:"String",_info:"Type of Switch",_select:sc.BOUNCE_BLOCK_TYPE},group:{_type:"String",
_info:"Group of bounce switch this block belongs to"},action:{_type:"BounceAction",_info:"Action to perform when block is hit",_popup:true,_optional:true},ballTime:{_type:"Number",_info:"How long the ball will be alive after bouncing with this block. (default=0.5)",_optional:true}},label:function(){return"[ "+this.variable+" ]\n"}}),init:function(b,a,d,c){this.parent(b,a,d,c);this.coll.type=ig.COLLTYPE.BLOCK;this.coll.time.globalStatic=true;this.coll.weight=-1;this.coll.zGravityFactor=1E3;Vec3.assignC(this.coll.size,
16,16,24);this.timer=new ig.WeightTimer;this.group=c.group;this.ballTime=c.ballTime||0.5;window.wm||sc.bounceSwitchGroups.registerBlock(this);if(c.action){b=c.action;this.action={minHit:b.minHit,camera:b.camera}}if(c=sc.BOUNCE_BLOCK_TYPE[c.blockType]){Vec3.assign(this.coll.size,c.size);this.coll.shape=c.shape;b=ig.mapStyle.get("puzzle2");c.anims.namedSheets.block.src=b.sheet;if(c.anims.namedSheets.ground)c.anims.namedSheets.ground.src=b.sheet;this.initAnimations(c.anims)}this.maxZHeight=this.coll.size.z;
if(sc.bounceSwitchGroups.isGroupResolved(this.group))this.onGroupResolve(true);else this.blockState=0;this.setCurrentAnim(this.blockState?"on":"off")},ballHit:function(b,a){if(!b.isBall||sc.bounceSwitchGroups.isGroupBallConflict(this.group,b)){sc.combat.showHitEffect(this,b.getHitCenter(this),sc.ATTACK_TYPE.NONE,b.getElement(),false,false,true);return true}if(!a||Vec2.isZero(a))return false;if(!this.blockState){this.blockState=1;var d=sc.bounceSwitchGroups.getGroup(this.group);ig.SoundHelper.playAtEntity(this.sounds.bing,
this,false,{speed:1-(d.blocks.length+2-d.blockHitCount)*0.03});b.resetBounceCount();b.resetTime(this.ballTime/b.speedFactor);b.cleanDirection(0.025);sc.combat.showHitEffect(this,b.getHitCenter(this),sc.ATTACK_TYPE.HEAVY,b.getElement(),false,false,true);this.effects.spawnOnTarget("bounceHit",this);this.setCurrentAnim("on");d=sc.bounceSwitchGroups.onBlockHit(this,b);if(this.action&&this.action.minHit<=d){d=this.action.camera.type;d=="reset"?sc.bounceSwitchGroups.resetCamera(this.group):d=="ball"?sc.bounceSwitchGroups.setCameraBall(this.group,
b):d=="fixed"&&sc.bounceSwitchGroups.setCameraPos(this.group,this.action.camera.value)}}return false},onGroupResolve:function(b){this.blockState=2;b?this.coll.setSize(this.coll.size.x,this.coll.size.y,0):this.timer.set(1,ig.TIMER_MODE.ONCE);this.setCurrentAnim("on")},onGroupReset:function(){this.blockState==0&&this.effects.spawnOnTarget("bounceDenied",this);this.blockState=0;this.setCurrentAnim("off")},update:function(){if(!this.timer.done()){this.timer.tick();var b=KEY_SPLINES.EASE_IN_OUT.get(this.timer.get());
this.blockState==2&&(b=1-b);b=Math.round(this.maxZHeight*b);this.coll.setSize(this.coll.size.x,this.coll.size.y,b)}this.parent()},updateSprites:function(){ig.AnimatedEntity.prototype.updateSprites.call(this);if(this.sprites.length)this.sprites[0].src.y=this.sprites[0].src.y-(this.maxZHeight-this.coll.size.z)}});sc.BOUNCE_BLOCK_TYPE["default"]={size:{x:24,y:24,z:23},shape:ig.COLLSHAPE.RECTANGLE,anims:{namedSheets:{block:{src:null,width:24,height:48}},sheet:"block",SUB:[{name:"off",time:1,frames:[0],
repeat:false},{name:"on",time:1,frames:[1],repeat:false}]}};sc.BOUNCE_BLOCK_TYPE.slopeNE={size:{x:24,y:24,z:23},shape:ig.COLLSHAPE.SLOPE_NE,anims:{namedSheets:{block:{src:null,width:24,height:48,offX:48},ground:{src:null,width:24,height:24,offX:144}},SUB:[{sheet:"block",aboveZ:1,SUB:[{name:"off",time:1,frames:[0],repeat:false},{name:"on",time:1,frames:[1],repeat:false}]},{sheet:"ground",size:{x:24,y:24,z:0},frames:[0],SUB:[{name:"off"},{name:"on"}]}]}};sc.BOUNCE_BLOCK_TYPE.slopeSE={size:{x:24,y:24,
z:23},shape:ig.COLLSHAPE.SLOPE_SE,anims:{namedSheets:{block:{src:null,width:24,height:48,offX:96},ground:{src:null,width:24,height:24,offX:144,offY:24}},SUB:[{sheet:"block",wallY:1,SUB:[{name:"off",time:1,frames:[0],repeat:false},{name:"on",time:1,frames:[1],repeat:false}]},{sheet:"ground",size:{x:24,y:23,z:1},frames:[0],wallY:1,SUB:[{name:"off"},{name:"on"}]}]}};sc.BOUNCE_BLOCK_TYPE.slopeSW={size:{x:24,y:24,z:23},shape:ig.COLLSHAPE.SLOPE_SW,anims:{namedSheets:{block:{src:null,width:24,height:48,
offX:96},ground:{src:null,width:24,height:24,offX:144,offY:24}},flipX:true,SUB:[{sheet:"block",wallY:1,SUB:[{name:"off",time:1,frames:[0],repeat:false},{name:"on",time:1,frames:[1],repeat:false}]},{sheet:"ground",size:{x:24,y:23,z:1},frames:[0],wallY:1,SUB:[{name:"off"},{name:"on"}]}]}};sc.BOUNCE_BLOCK_TYPE.slopeNW={size:{x:24,y:24,z:23},shape:ig.COLLSHAPE.SLOPE_NW,anims:{namedSheets:{block:{src:null,width:24,height:48,offX:48},ground:{src:null,width:24,height:24,offX:144}},flipX:true,SUB:[{sheet:"block",
aboveZ:1,SUB:[{name:"off",time:1,frames:[0],repeat:false},{name:"on",time:1,frames:[1],repeat:false}]},{sheet:"ground",size:{x:24,y:24,z:0},frames:[0],SUB:[{name:"off"},{name:"on"}]}]}}});ig.baked=!0;
ig.module("game.feature.puzzle.entities.thermo-pole").requires("impact.base.entity","impact.feature.effect.effect-sheet","game.feature.combat.combat-poi").defines(function(){var b=Vec3.create();sc.ElementPoleGroups={groups:{},registerDest:function(a,b){if(a.group){var c=this.getGroup(a.group);c.dests[a.element]=a;if(b){c.currentDest=a;for(var d=c.hitCount=c.poles.length;d--;)c.poles[d].onDestInit(a.element)}}},registerPole:function(a){if(a.group){var b=this.getGroup(a.group);b.poles.push(a);if(b.currentDest){b.hitCount=
b.poles.length;a.onDestInit(b.currentDest.element)}}},getGroup:function(a){this.groups[a]||(this.groups[a]={dests:{},poles:[],currentBall:null,currentDest:null,hitCount:0});return this.groups[a]},deleteGroup:function(a){a&&delete this.groups[a]},onPoleHit:function(a,b,c){if(a.active){var d=b.getElement();if(!d)return false;if(!a.group)return true;var e=this.getGroup(a.group),d=e.dests[d]||null;if(e.currentBall&&e.currentBall!=b&&!c||e.currentDest&&e.currentDest!=d){this.onGroupChargeCancel(a);c=false}if(d&&
!d.isOn()){if(c||e.hitCount>=e.poles.length)return true;e.currentBall=b;e.currentDest=d;e.hitCount++;b=e.hitCount==e.poles.length;d.onPoleHit(a,b,e.poles);if(b)for(b=e.poles.length;b--;){c=e.poles[b];if(a!=c)c.onComplete()}}return true}},getChargeState:function(b){if(!b.group)return a.TMP;b=this.getGroup(b.group);return!b.currentDest?a.TMP:b.hitCount<b.poles.length?a.PENDING:a.GROUP},onFinalizeGroup:function(a){a=this.getGroup(a.group);a.currentBall=null;for(var b=a.poles.length;b--;)a.poles[b].onFinalize()},
onCancelCheck:function(a){a=this.getGroup(a.group);if(a.hitCount==a.poles.length)return false;if(a.currentBall._killed){a.currentBall=null;a.hitCount=0;for(var b=a.poles.length;b--;)a.poles[b].onCancel();return true}return false},onGroupChargeCancel:function(a){if(!a.group)return null;var b=this.getGroup(a.group);b.currentDest.onCancel();b.currentDest=null;b.hitCount=0;b.currentBall=null;for(var c=b.poles.length;c--;){var d=b.poles[c];if(d!=a)d.onCancel()}}};sc.TERMO_POLE_TYPE={};sc.TERMO_POLE_TYPE.LONG=
{size:{x:16,y:16,z:48},src:{x:0,y:144},changeHeight:32};sc.TERMO_POLE_TYPE.LONG_64={size:{x:16,y:16,z:80},src:{x:80,y:144},changeHeight:64};sc.TERMO_POLE_TYPE.SHORT={size:{x:16,y:16,z:16},src:{x:0,y:208}};var a={NONE:{timed:false},TMP:{timed:true,blink:true},PENDING:{timed:false,blink:true},GROUP:{timed:false},DISCHARGE:{timed:true}},d=null;ig.ENTITY.ElementPole=ig.AnimatedEntity.extend({data:null,gfx:null,group:null,active:false,charge:{state:a.NONE,element:0,prevElement:0,timer:0,lightHandles:[]},
effects:{sheet:new ig.EffectSheet("puzzle.thermo-pole"),handle:null,hideHandle:null},_wm:new ig.Config({spawnable:true,attributes:{poleType:{_type:"String",_info:"Type of Pole",_select:sc.TERMO_POLE_TYPE},group:{_type:"String",_info:"Group of ThermoPoleDest this pole belongs to"},spawnCondition:{_type:"VarCondition",_info:"Condition for prop to appear",_popup:true}}}),init:function(a,b,c,e){this.parent(a,b,c,e);this.coll.type=ig.COLLTYPE.VIRTUAL;this.coll.zGravityFactor=1E3;this.group=e.group;if(e.spawnCondition){d||
(d=new ig.VarCondition);d.setCondition(e.spawnCondition);this.active=d.evaluate()}else this.active=true;this.data=sc.TERMO_POLE_TYPE[e.poleType]||sc.TERMO_POLE_TYPE.SHORT;this.coll.setSize(this.data.size.x,this.data.size.y,this.data.size.z);Vec2.assignC(this.coll.padding,4,4);if(a=ig.mapStyle.get("puzzle2"))this.gfx=new ig.Image(a.sheet);this.charge.timer=new ig.WeightTimer(false);sc.ElementPoleGroups.registerPole(this)},onKill:function(a){sc.ElementPoleGroups.deleteGroup(this.group);this.gfx&&this.gfx.decreaseRef();
this.parent(a)},show:function(a){this.parent(a);if(this.effects.hideHandle){this.effects.hideHandle.stop();this.effects.hideHandle=null}if(!a){this.animState.alpha=0;ig.game.effects.teleport.spawnOnTarget("showDefault",this,{})}this.active=true},onHideRequest:function(){this.active=false;this.charge.state!=a.NONE&&this.discharge(true);this.effects.hideHandle=ig.game.effects.teleport.spawnOnTarget("hideDefault",this,{callback:this})},onEffectEvent:function(a){if(a==this.effects.hideHandle&&a.isDone()){this.effects.hideHandle=
null;this.hide()}},initSprites:function(){this.setSpriteCount(3)},update:function(){if(this.charge.state!=a.NONE){this.charge.timer.tick();if(this.charge.state.timed&&this.charge.timer.done())this.charge.state==a.DISCHARGE?this.charge.state=a.NONE:this.discharge()}this.parent()},updateSprites:function(){if(this.gfx){var b=this.data.src,c=this.sprites[0],d=this.coll.size.y+this.coll.size.z;c.setEntityDefault(this,16,d,"NO_EXPAND",1,null,this.gfx,b.x,b.y);c.setAlpha(this.animState.alpha);var c=this.sprites[1],
e=this.sprites[2];if(this.charge.state==a.DISCHARGE){var f=this.charge.prevElement*16;c.setEntityDefault(this,16,d,"NO_EXPAND",1,null,this.gfx,b.x+f,b.y);d=c.size.y+c.size.z;b=Math.round(this.charge.timer.get()*d);c.setGfxCut(b,0);c.setAlpha(this.animState.alpha);c.renderMode="lighter";e.setInvisible()}else if(this.charge.element){var f=this.charge.element*16,l=this.charge.timer.getTimePassed(),o=0.3,m=4;if(this.charge.state.blink){o=0.5;m=8}l=(1-o+o/2*Math.sin(Math.PI*2*l*m))*(4*l*m).limit(0,1);
c.setGfxCut(0,0);c.setEntityDefault(this,16,d,"NO_EXPAND",1,null,this.gfx,b.x+f,b.y);c.renderMode="lighter";c.setAlpha(Math.min(l*2,1)*this.animState.alpha);if(l>0.5){e.setEntityDefault(this,16,d,"NO_EXPAND",1,null,this.gfx,b.x+f,b.y);e.renderMode="lighter";e.setAlpha(l*2-1)}else e.setInvisible()}else{c.setInvisible();e.setInvisible()}this.animState.updateSpriteColor(this)}},chargeElement:function(a,b,c,d){if(this.active){this.charge.prevElement=this.charge.element;this.charge.element=a;!d&&(c!=this.charge.state||
this.charge.prevElement!=this.charge.element)&&this.showEffect(a,b,c);this.charge.timer.set(8,ig.TIMER_MODE.ONCE);this.charge.state=c;if(!this.charge.lightHandles.length)if(this.data.changeHeight){this.addLight(4-this.data.changeHeight/2);this.addLight(4+this.data.changeHeight/2)}else this.addLight(4)}},resetTimer:function(b){this.charge.state==a.TMP&&this.charge.timer.setRemainingTime(b)},addLight:function(a){if(this.active){var b=new ig.LightHandle(this,ig.LIGHT_SIZE.XL,0.1,0.3,-1,1,false);b.setOffset(0,
0,a);ig.light.addLightHandle(b);this.charge.lightHandles.push(b)}},discharge:function(b){this.effects.handle&&this.effects.handle.stop();b||this.effects.sheet.spawnOnTarget("discharge",this);this.effects.handle=null;this.charge.timer.set(0.5,ig.TIMER_MODE.ONCE);this.charge.prevElement=this.charge.element;this.charge.element=0;this.charge.state=a.DISCHARGE;for(b=this.charge.lightHandles.length;b--;)this.charge.lightHandles[b].stop();this.charge.lightHandles.length=0},showEffect:function(b,c,d){c=e[b]+
"Circle"+(c?"Down":"Up");this.effects.sheet.spawnOnTarget(c,this,{offset:{z:12}});if(d==a.TMP){this.effects.handle&&this.effects.handle.stop();c=e[b]+"Temp";this.effects.handle=this.effects.sheet.spawnOnTarget(c,this,{offset:{x:1,z:this.data.changeHeight?12+this.data.changeHeight:12},duration:-1})}},ballHit:function(c){if(this.active){if(!c.isBall||c.party!=sc.COMBATANT_PARTY.PLAYER)return false;var d=c.getElement();if(!sc.ElementPoleGroups.onPoleHit(this,c,this.charge.element==d)){sc.combat.showHitEffect(this,
c.getHitCenter(this),sc.ATTACK_TYPE.NONE,c.getElement(),false,false,true);return true}var e=false;this.charge.state!=a.TMP&&c.cleanDirection(0.015);if(this.data.changeHeight){var e=c.coll.pos.z>this.coll.pos.z+this.coll.size.z/2,f=ig.CollTools.getCenterXYAlignedPos(b,c.coll,this.coll);f.z=e?this.coll.pos.z+12:this.coll.pos.z+this.data.changeHeight+12;c.grabPoint(f,0.5)}this.chargeElement(d,e,sc.ElementPoleGroups.getChargeState(this));if(this.charge.element!=this.charge.prevElement){if(this.charge.state==
a.GROUP)return true;c.timer<0.2&&c.resetTime(0.2)}c.addIgnore(this);return false}},onComplete:function(){this.effects.handle&&this.effects.handle.stop();this.effects.handle=null;this.chargeElement(this.charge.element,false,a.GROUP)},onDestInit:function(b){this.chargeElement(b,false,a.GROUP,true)},onFinalize:function(){},onCancel:function(){this.charge.element&&this.discharge()},isBallAdjust:function(){if(this.active)return this.data.changeHeight},doBallAdjust:function(a,b,c,d){if(c.x!=Constants.BALL_SIZE)return 0;
b=a.z>this.coll.pos.z+this.coll.size.z/2;this.getCenter(a);a.z=b?this.coll.pos.z+12:this.coll.pos.z+this.data.changeHeight+12;return d},isBallDestroyer:function(){return false}});var c={OFF:1,CHARGING:2,ON:3};ig.ENTITY.ElementPoleDest=ig.AnimatedEntity.extend({group:null,element:null,state:c.OFF,_wm:new ig.Config({spawnable:true,attributes:{group:{_type:"String",_info:"Group of ThermoPoleDest this pole belongs to"},element:{_type:"String",_info:"Element of Destination",_select:["HEAT","COLD","SHOCK",
"WAVE"]},variable:{_type:"VarName",_info:"Variable to be se to true when switch is activated"},activeTime:{_type:"Number",_info:"If >0: only keep switch active for said amount of time"}}}),effects:{sheet:new ig.EffectSheet("puzzle.thermo-pole"),handle:null,lightHandle:null},init:function(a,b,d,e){this.parent(a,b,d,e);this.coll.type=ig.COLLTYPE.VIRTUAL;this.coll.setSize(16,16,0);this.coll.zGravityFactor=1E3;this.group=e.group;this.element=sc.ELEMENT[e.element]||sc.ELEMENT.HEAT;this.variable=e.variable;
this.activeTime=e.activeTime;a=ig.mapStyle.get("puzzle2");this.initAnimations({sheet:{src:a.sheet,width:16,height:16,offX:0,offY:240},SUB:[{time:0.1,frames:[0],repeat:true,SUB:[{name:"off"},{name:"tmpOn"},{name:"tmpOnEnd"},{name:"on"}]},{tileOffset:this.element*2-1,repeat:true,SUB:[{name:"off",time:0.3,frames:[0,0,0,0],framesGfxOffset:[0,1,0,0,0,-1,0,0]},{name:"tmpOn",time:0.1,frames:[1,1,1,1],framesAlpha:[1,0.66,0.33,0.66,1]},{name:"tmpOnEnd",time:0.033,frames:[1,1,1,1],framesAlpha:[1,0.5,0.25,0.5,
1]},{name:"on",time:0.1,frames:[1,1,1,1],framesAlpha:[1,0.9,0.8,0.9,1]}]}]});if(a=ig.vars.get(this.variable)){this.turnOnGfx();this.state=c.ON}sc.ElementPoleGroups.registerDest(this,a)},onKill:function(a){this.timer&&this.turnOff();sc.ElementPoleGroups.deleteGroup(this.group);this.parent(a)},update:function(){if(this.timer){this.timer=this.timer-ig.system.tick;this.timer<=1&&this.currentAnim!="tmpOnEnd"&&this.setCurrentAnim("tmpOnEnd");if(this.timer<=0){this.timer=0;sc.ElementPoleGroups.onGroupChargeCancel(this);
this.turnOff()}}if(this.state==c.CHARGING&&sc.ElementPoleGroups.onCancelCheck(this)){this.state=c.IDLE;this.setCurrentAnim("off",true)}this.parent()},isOn:function(){return this.state==c.ON},onPoleHit:function(a,b,d){var f=e[this.element]+"Charge";this.state=b?c.ON:c.CHARGING;a.effects.handle&&a.effects.handle.stop();if(b)for(b=d.length;b--;){var k=this.effects.sheet.spawnOnTarget(f,this,{target2:d[b],target2Align:ig.ENTITY_ALIGN.TOP});if(d[b]==a){k.setCallback(this);this.effects.handle=k}}else a.effects.handle=
this.effects.sheet.spawnOnTarget(f+"Prepare",this,{target2:a,target2Align:ig.ENTITY_ALIGN.TOP,duration:-1})},onEffectEvent:function(a){a.state==ig.EFFECT_STATE.POST_LOOP&&this.turnOn()},onCancel:function(){this.turnOff()},turnOn:function(){this.effects.handle=null;sc.ElementPoleGroups.onFinalizeGroup(this);this.effects.sheet.spawnOnTarget(e[this.element]+"Activate",this);ig.vars.set(this.variable,true);this.turnOnGfx()},turnOnGfx:function(){if(!this.effects.lightHandle){var a=new ig.LightHandle(this,
ig.LIGHT_SIZE.L,0.1,0.1,-1,1,false);a.setOffset(0,0,0);ig.light.addLightHandle(a);this.effects.lightHandle=a}if(this.activeTime){this.timer=this.activeTime/sc.options.get("assist-puzzle-speed");this.setCurrentAnim("tmpOn",true)}else this.setCurrentAnim("on",true)},turnOff:function(){this.effects.lightHandle&&this.effects.lightHandle.stop();this.effects.lightHandle=null;ig.vars.set(this.variable,false);this.effects.handle&&this.effects.handle.setCallback(null);this.effects.handle=null;this.timer=0;
this.state=c.OFF;this.setCurrentAnim("off",true)}});var e={};e[sc.ELEMENT.HEAT]="flame";e[sc.ELEMENT.COLD]="ice";e[sc.ELEMENT.SHOCK]="shock";e[sc.ELEMENT.WAVE]="wave";var f={ALL:0,SMALL:1,TALL:2};sc.COMBAT_POI.ELEMENT_POLE={_wm:{attributes:{element:{_type:"String",_info:"Element the pole is charged to",_select:sc.ELEMENT},size:{_type:"String",_info:"Type of Pole to select",_select:f}}},filterEntities:function(b,c,d){for(var e=sc.ELEMENT[d.element],d=f[d.size],k=c.length;k--;){var l=c[k];l instanceof
ig.ENTITY.ElementPole&&!(l.charge.state!=a.TMP&&l.charge.state!=a.GROUP)&&l.charge.element==e&&!(d==f.SMALL&&l.data.changeHeight)&&(d!=f.TALL||l.data.changeHeight)&&b.push(l)}return b}}});ig.baked=!0;
ig.module("game.feature.puzzle.entities.push-pull-block").requires("impact.base.actor-entity","impact.base.entity","game.feature.puzzle.components.push-pullable").defines(function(){Vec3.createC(0,0,0);sc.PUSH_PULL_TYPES={};ig.ENTITY.PushPullBlock=ig.AnimatedEntity.extend({_wm:new ig.Config({spawnable:true,attributes:{pushPullType:{_type:"String",_info:"Type of push pull block",_select:sc.PUSH_PULL_TYPES},spawnCondition:{_type:"VarCondition",_info:"Condition for Block to spawn",_popup:true}}}),effects:{sheet:new ig.EffectSheet("puzzle"),
hideHandle:null},pushPullable:null,squishRespawn:true,compressorSlow:0.5,pushPullDirection:0,bombSnap:true,init:function(b,a,d,c){this.parent(b,a,d,c);this.coll.type=ig.COLLTYPE.BLOCK;this.coll.zGravityFactor=1E3;this.coll.zBounciness=0;this.coll.weight=-1;this.coll.shadow.size=32;if(b=sc.PUSH_PULL_TYPES[c.pushPullType]){this.terrain=b.terrain;Vec3.assign(this.coll.size,b.size);if(b.useStyleSheet){a=ig.mapStyle.get("puzzle");b.anims.sheet.src=a.sheet}this.initAnimations(b.anims);this.pushPullDirection=
b.direction||sc.PUSH_PULL_DIRECTION.ALL}this.pushPullable=new sc.PushPullable(this)},show:function(b){this.parent(b);if(this.effects.hideHandle){this.effects.hideHandle.stop();this.effects.hideHandle=null}this.pushPullable.setActive(true);if(!b){this.animState.alpha=0;ig.game.effects.teleport.spawnOnTarget("showQuick",this)}},onHideRequest:function(){this.effects.hideHandle=ig.game.effects.teleport.spawnOnTarget("hideQuick",this,{align:ig.ENTITY_ALIGN.CENTER,callback:this});this.pushPullable.setActive(false)},
onEffectEvent:function(b){if(b.isDone()&&this.effects.hideHandle){this.effects.hideHandle=null;this.hide()}},update:function(){this.pushPullable.onUpdate();this.parent()},deferredUpdate:function(){this.pushPullable.onDeferredUpdate();if(this.coll.pos.z==this.coll.baseZPos){this.coll.zGravityFactor=1;this.coll.zBounciness=0.3}},resetPos:function(b,a){this.pushPullable.resetPos(b,a)},onInteraction:function(){this.pushPullable.onInteraction()},onInteractionEnd:function(){this.pushPullable.onInteractionEnd()},
onKill:function(b){this.parent(b);this.pushPullable.onKill()},onMagnetStart:function(){if(!this.magnet&&!this.pushPullable.isActive())return false;this.magnet=true;this.coll.setType(ig.COLLTYPE.NPBLOCK);this.pushPullable.setActive(false);return true},onMagnetEnd:function(b){this.magnet=false;b&&this.effects.sheet.spawnOnTarget("boxThud",this);this.pushPullable.onMagnetEnd()}});sc.PUSH_PULL_TYPES.Large={size:{x:32,y:32,z:32},terrain:ig.TERRAIN.METAL,useStyleSheet:true,anims:{sheet:{src:null,width:32,
height:64,offX:224,offY:128},aboveZ:1,wallY:0.05,SUB:[{name:"default",time:1,frames:[0],repeat:false},{name:"moveV",time:0.03,frames:[0,0],framesGfxOffset:[0,0,0,0],repeat:true},{name:"moveH",time:0.03,frames:[0,0],framesGfxOffset:[0,0,0,0],repeat:true}]}};sc.PUSH_PULL_TYPES.BergenLeftRight={size:{x:32,y:32,z:32},terrain:ig.TERRAIN.WOOD,direction:sc.PUSH_PULL_DIRECTION.LEFT_RIGHT,anims:{sheet:{src:"media/entity/objects/puzzle-elements-1.png",width:32,height:64,offX:32,offY:32},aboveZ:1,wallY:0.05,
SUB:[{name:"default",time:1,frames:[0],repeat:false},{name:"moveV",time:0.03,frames:[0,0],framesGfxOffset:[0,0,0,0],repeat:true},{name:"moveH",time:0.03,frames:[0,0],framesGfxOffset:[0,0,0,0],repeat:true}]}};sc.PUSH_PULL_TYPES.BergenUpDown={size:{x:32,y:32,z:32},terrain:ig.TERRAIN.WOOD,direction:sc.PUSH_PULL_DIRECTION.UP_DOWN,anims:{sheet:{src:"media/entity/objects/puzzle-elements-1.png",width:32,height:64,offX:64,offY:32},aboveZ:1,wallY:0.05,SUB:[{name:"default",time:1,frames:[0],repeat:false},{name:"moveV",
time:0.03,frames:[0,0],framesGfxOffset:[0,0,0,0],repeat:true},{name:"moveH",time:0.03,frames:[0,0],framesGfxOffset:[0,0,0,0],repeat:true}]}};sc.PUSH_PULL_TYPES.SmallTest={size:{x:16,y:16,z:16},terrain:ig.TERRAIN.METAL,anims:{sheet:{src:"media/entity/objects/puzzle-elements-1.png",width:16,height:32},aboveZ:1,SUB:[{name:"default",time:1,frames:[0],repeat:false},{name:"move",time:0.05,frames:[0,1,2,1],repeat:true}]},walkAnims:{idle:"default",move:"move"}};ig.ENTITY.WavePushPullBlock=ig.AnimatedEntity.extend({_wm:new ig.Config({spawnable:true,
attributes:{pushPullType:{_type:"String",_info:"Type of push pull block",_select:sc.PUSH_PULL_TYPES},spawnCondition:{_type:"VarCondition",_info:"Condition for Block to spawn",_popup:true}}}),pushPullable:null,phased:false,squishRespawn:true,compressorSlow:0.5,bombSnap:true,effects:{sheet:new ig.EffectSheet("puzzle"),hideHandle:null},init:function(b,a,d,c){this.parent(b,a,d,c);this.coll.type=ig.COLLTYPE.BLOCK;this.coll.zGravityFactor=1E3;this.coll.zBounciness=0;this.coll.weight=-1;this.coll.shadow.size=
32;this.coll.setSize(32,32,32);b=ig.mapStyle.get("waveblock");this.initAnimations({sheet:{src:b.sheet,width:32,height:64,offX:b.x,offY:b.y},aboveZ:1,SUB:[{name:"default",time:1,frames:[0],repeat:false},{name:"phasing",time:1,frames:[0],repeat:false,renderMode:"lighter"},{name:"moveV",time:0.03,frames:[0,0],framesGfxOffset:[0,0,0,0],repeat:true},{name:"moveH",time:0.03,frames:[0,0],framesGfxOffset:[0,0,0,0],repeat:true}]});this.pushPullable=new sc.PushPullable(this)},show:function(b){this.parent(b);
if(this.effects.hideHandle){this.effects.hideHandle.stop();this.effects.hideHandle=null}this.pushPullable.setActive(true);if(!b){this.animState.alpha=0;ig.game.effects.teleport.spawnOnTarget("showQuick",this)}},onHideRequest:function(){this.effects.hideHandle=ig.game.effects.teleport.spawnOnTarget("hideQuick",this,{align:ig.ENTITY_ALIGN.CENTER,callback:this});this.pushPullable.setActive(false)},onEffectEvent:function(b){if(b.isDone()&&this.effects.hideHandle){this.effects.hideHandle=null;this.hide()}},
update:function(){this.pushPullable.onUpdate();this.parent()},deferredUpdate:function(){this.pushPullable.onDeferredUpdate();if(this.coll.pos.z==this.coll.baseZPos){this.coll.zGravityFactor=1;this.coll.zBounciness=0.3}},onInteraction:function(){this.pushPullable.onInteraction()},onInteractionEnd:function(){this.pushPullable.onInteractionEnd()},onKill:function(b){this.parent(b);this.pushPullable.onKill()},resetPos:function(b,a){this.pushPullable.resetPos(b,a)},onEntityKillDetach:function(){if(this.phased){this.phased=
false;this.setCurrentAnim("default")}},doTeleport:function(){this.phased=false;this.setCurrentAnim("default")},ballHit:function(b){if(this.phased)return false;if(this.pushPullable.isActive()){if(b.getElement()!=sc.ELEMENT.WAVE||!(b.isBall&&b.attackInfo.hasHint("CHARGED")||b instanceof sc.CompressedWaveEntity))return false;this.phased=true;b.addEntityAttached(this);this.setCurrentAnim("phasing");return false}},onMagnetStart:function(){if(!this.magnet&&!this.pushPullable.isActive())return false;this.magnet=
true;this.coll.setType(ig.COLLTYPE.NPBLOCK);this.pushPullable.setActive(false);return true},onMagnetEnd:function(b){this.magnet=false;b&&this.effects.sheet.spawnOnTarget("boxThud",this);this.pushPullable.onMagnetEnd()}})});ig.baked=!0;
ig.module("game.feature.puzzle.entities.push-pull-dest").requires("impact.base.actor-entity","impact.base.entity","game.feature.puzzle.components.push-pullable").defines(function(){var b=Vec2.create(),a=Vec3.create();sc.PUSH_PULL_DEST_TYPES={};var d={PERMANENT:1,TEMP:2};ig.ENTITY.PushPullDest=ig.AnimatedEntity.extend({variable:null,zMove:0,saveType:0,placedData:null,placed:false,zStart:0,placeTimer:0,delayed:false,effects:new ig.EffectSheet("puzzle"),sound:{lockIn:new ig.Sound("media/sound/puzzle/push-click.ogg",
1)},_wm:new ig.Config({spawnable:true,attributes:{pushPullDestType:{_type:"String",_info:"Type of push pull dest",_select:sc.PUSH_PULL_DEST_TYPES},zMove:{_type:"Number",_info:"Z Movememnt aber PushPullable has been placed"},saveType:{_type:"String",_info:"How state of box should be saved",_select:d},variable:{_type:"String",_info:"Variable to increase when push-pullable is placed"}}}),init:function(a,b,f,g){this.parent(a,b,f,g);this.coll.type=ig.COLLTYPE.BLOCK;this.coll.zGravityFactor=0;this.coll.zBounciness=
0.3;this.coll.weight=-1;this.coll.shadow.size=16;this.placeTimer=new ig.WeightTimer;this.variable=g.variable||null;this.zMove=g.zMove||0;this.saveType=d[g.saveType||"PERMANENT"];this.zStart=this.coll.pos.z;if(a=sc.PUSH_PULL_DEST_TYPES[g.pushPullDestType]){this.terrain=a.terrain;Vec3.assign(this.coll.size,a.size);if(a.useStyleSheet){b=ig.mapStyle.get("puzzle");a.anims.sheet.src=b.sheet}this.initAnimations(a.anims)}this.loadPushPullable()},onPushPullableDetect:function(a,d){var f=ig.CollTools.getDistVec2(this.coll,
a.coll,b);if(Vec2.length(f)<=8){Vec2.assign(d,this.coll.pos);return true}return false},onPushPullablePlaced:function(a){this.savePushPullable(a);this.placeTimer.set(0.2,ig.TIMER_MODE.ONCE);this.effects.spawnOnTarget("boxLockIn",a)},savePushPullable:function(a){this.placedData={id:a.mapId};this.placed=true;a=this._getVarName();ig.vars.set(a,this.placedData);this.variable&&ig.vars.add(this.variable,1)},loadPushPullable:function(){(this.placedData=ig.vars.get(this._getVarName()))&&this.setZPos(this.zStart+
this.zMove)},initPushPullable:function(){if(!this.placed&&this.placedData){var b=ig.game.getEntityByMapId(this.placedData.id);if(b){var d=this.getAlignedPos(ig.ENTITY_ALIGN.BOTTOM,a);b.resetPos(d,true);b.pushPullable.setActive(false);this.placed=true}}},_getVarName:function(){return(this.saveType==d.TEMP?"tmp.":"map.")+"entity"+this.mapId+"_placed"},update:function(){if(!this.placeTimer.done()){this.placeTimer.tick();var a=this.placeTimer.get();if(this.delayed)this.setZPos(this.zStart+a*this.zMove);
else if(a==1){this.sound.lockIn.play();this.placeTimer.set(Math.abs(0.4),ig.TIMER_MODE.ONCE);this.delayed=true}}this.parent()},deferredUpdate:function(){!this.placed&&this.placedData&&this.initPushPullable()},onInteraction:function(){this.pushPullable.onInteraction()},onInteractionEnd:function(){this.pushPullable.onInteractionEnd()}});sc.PUSH_PULL_DEST_TYPES.DEFAULT={size:{x:32,y:32,z:0},terrain:ig.TERRAIN.METAL,useStyleSheet:true,anims:{sheet:{src:null,width:32,height:32,offX:224,offY:96},aboveZ:1,
SUB:[{name:"default",time:1,frames:[0],repeat:false}]}}});ig.baked=!0;
ig.module("game.feature.puzzle.entities.sliding-block").requires("impact.base.actor-entity","impact.base.entity","impact.feature.effect.effect-sheet").defines(function(){var b=Vec2.create(),a={};ig.ENTITY.SlidingBlock=ig.AnimatedEntity.extend({_wm:new ig.Config({spawnable:true,attributes:{}}),moving:false,moveDir:Vec2.create(),bombSnap:true,squishRespawn:true,effects:{sheet:new ig.EffectSheet("puzzle.sliding-block"),handle:null},init:function(a,b,e,f){this.parent(a,b,e,f);this.coll.type=ig.COLLTYPE.BLOCK;
this.coll.zGravityFactor=1;this.coll.zBounciness=0.3;this.coll.weight=-1;this.coll.shadow.size=16;this.coll.setSize(32,32,32);this.terrain=ig.TERRAIN.METAL;a=ig.mapStyle.get("puzzle");this.initAnimations({sheet:{src:a.sheet,width:32,height:64,offX:224,offY:192},aboveZ:1,wallY:0.1,SUB:[{name:"default",time:1,frames:[0],repeat:false}]})},ballHit:function(d){var c=d.getHitCenter(this),e=false;!d.isBall&&!d.attackInfo.hasHint("BOMB")&&(e=true);d.isBall&&!d.attackInfo.hasHint("CHARGED")&&(e=true);if(this.moving||
e){sc.combat.showHitEffect(this,c,sc.ATTACK_TYPE.NONE,d.getElement(),true,false,true);return true}Vec2.flip(ig.ActorEntity.getFaceVec(d.getCollideSide(this),this.moveDir));d=Vec2.assign(b,this.moveDir);c=ig.game.physics.initTraceResult(a);if(ig.game.traceEntity(c,this,d.x,d.y,0,0,0,ig.COLLTYPE.IGNORE))this.effects.sheet.spawnOnTarget("blocked",this);else{this.moving=true;this.effects.handle=this.effects.sheet.spawnOnTarget("slide",this,{duration:-1})}return true},update:function(){if(this.moving){var d=
Vec2.assign(b,this.moveDir);Vec2.length(d,400*ig.system.tick);var c=ig.game.physics.initTraceResult(a);if(ig.game.traceEntity(c,this,d.x,d.y,0,0,1,ig.COLLTYPE.IGNORE,null,null,1)){Vec2.mulF(d,c.dist);this.moving=false;this.effects.handle&&this.effects.handle.stop();this.coll.vel.z=0}c=this.coll;this.setPos(c.pos.x+d.x,c.pos.y+d.y,c.pos.z,true)}this.parent()}})});ig.baked=!0;
ig.module("game.feature.puzzle.entities.switch").requires("impact.base.entity").defines(function(){ig.ENTITY.Switch=ig.AnimatedEntity.extend({ballDestroyer:true,variable:"",isOn:false,sounds:{hit:new ig.Sound("media/sound/battle/hit-7.ogg",0.4),bing:new ig.Sound("media/sound/puzzle/switch-activate-2.ogg",1)},_wm:new ig.Config({spawnable:true,attributes:{variable:{_type:"VarName",_info:"Variable set to true when switch is hit"}},label:function(){return"[ "+this.variable+" ]"}}),init:function(b,a,d,
c){this.parent(b,a,d,c);this.coll.type=ig.COLLTYPE.VIRTUAL;this.coll.setSize(16,16,24);this.coll.setPadding(4,4);this.coll.zGravityFactor=1E3;b=ig.mapStyle.get("puzzle");this.initAnimations({sheet:{src:b.sheet,width:24,height:24,offX:0,offY:64},repeat:true,time:0.15,SUB:[{name:"off",frames:[6]},{name:"switchOn",frames:[6]},{name:"on",frames:[6]},{name:"switchOff",frames:[6]},{name:"off",frames:[0,0,0,0,0,0],framesSpriteOffset:[0,0,12,0,0,12,0,0,13,0,0,14,0,0,14,0,0,13]},{name:"switchOn",time:0.07,
frames:[1,2],framesSpriteOffset:[0,0,13,0,0,13]},{name:"on",frames:[3,3,3,3,3,3],framesSpriteOffset:[0,0,12,0,0,12,0,0,13,0,0,14,0,0,14,0,0,13]},{name:"switchOff",time:0.07,frames:[4,5],framesSpriteOffset:[0,0,13,0,0,13]}]});this.variable=c.variable;ig.vars.setDefault(this.variable,0);this.isOn=ig.vars.get(this.variable);this.setCurrentAnim(this.isOn?"on":"off")},ballHit:function(b){if(b.attackInfo&&b.attackInfo.hasHint("NO_PUZZLE"))return false;ig.vars.set(this.variable,!ig.vars.get(this.variable));
sc.combat.showHitEffect(this,b.getHitCenter(this),sc.ATTACK_TYPE.MEDIUM,b.getElement(),false,false,true);ig.SoundHelper.playAtEntity(this.sounds.hit,this);ig.SoundHelper.playAtEntity(this.sounds.bing,this);return true},varsChanged:function(){var b=ig.vars.get(this.variable);if(this.isOn!=b){this.isOn=b;this.setCurrentAnim(this.isOn?"switchOn":"switchOff",true,this.isOn?"on":"off",true)}}})});ig.baked=!0;
ig.module("game.feature.puzzle.entities.destructible").requires("impact.base.entity","impact.feature.effect.effect-sheet").defines(function(){sc.DESTRUCTIBLE_TYPE={};var b=Vec2.create();ig.ENTITY.Destructible=ig.AnimatedEntity.extend({enemyInfo:null,permaDestruct:null,onDestructIncrease:null,onPreDestructIncrease:null,hitSide:null,hitCount:0,conditionFunction:null,sounds:{hit:new ig.Sound("media/sound/battle/block-hit.ogg",1),block:new ig.Sound("media/sound/battle/hit-block.ogg",0.5)},effects:{base:new ig.EffectSheet("puzzle.destructible"),
pre:null,boom:null,debris:null,debrisAngle:0,debrisDelay:0,preHandle:null,boomHandle:null},range:{key:null,delay:0,killTimer:-1,padding:0},keyConsume:null,hitSound:null,blockNavMap:false,navBlocker:null,blinkTimer:0,noBlinking:false,varState:0,_wm:new ig.Config({spawnable:true,attributes:{desType:{_type:"String",_info:"Type of destructible object",_select:sc.DESTRUCTIBLE_TYPE,_withNull:true},enemyInfo:{_type:"EnemyType",_info:"Enemy to spawn after destruction",_popup:true,_withNull:true},spawnCondition:{_type:"VarCondition",
_info:"Condition for Enemy to spawn",_popup:true},blockNavMap:{_type:"Boolean",__info:"If true, block path map and update when destroyed"},permaDestruct:{_type:"Boolean",_info:"If true, then destructible stays destroyed after reentering map"},onDestructIncrease:{_type:"VarName",_info:"Variable to increase by one when destroyed",_optional:true},onPreDestructIncrease:{_type:"VarName",_info:"Variable to increase by one when destroyed",_optional:true}}}),init:function(a,b,c,e){this.parent(a,b,c,e);this.coll.type=
ig.COLLTYPE.BLOCK;this.coll.zGravityFactor=1;this.coll.zBounciness=0.5;this.permaDestruct=e.permaDestruct||false;this.onDestructIncrease=e.onDestructIncrease||null;this.onPreDestructIncrease=e.onPreDestructIncrease||null;b=ig.mapStyle.get("effect");if(a=sc.DESTRUCTIBLE_TYPE[e.desType]){this.hitCount=a.hitCount;this.coll.size=a.size;if(a.collType)this.coll.type=a.collType;this.hitSide=a.hitSide||[1,1,1,1];this.hitSound=a.hitSound;this.conditionFunction=a.hitCondition;this.effects.debrisAngle=(a.debrisAngle||
0)*2*Math.PI;this.effects.debrisDelay=a.debrisDelay||0.1;this.noBlinking=a.noBlinking||false;this.keyConsume=a.keyConsume;this.terrain=a.terrain||null;if(this.keyConsume||a.onlyPerma)this.permaDestruct=true;a.range&&ig.merge(this.range,a.range);if(a.debris){c=ig.copy(a.debris);if(!c.sheet)c.sheet=b.sheet;this.effects.debris=new ig.EffectHandle(c)}if(a.boom)this.effects.boom=new ig.EffectHandle(a.boom);if(a.preBoom)this.effects.pre=new ig.EffectHandle(a.preBoom);if(e.enemyInfo&&e.enemyInfo.type)this.enemyInfo=
new sc.EnemyInfo(e.enemyInfo);b=ig.mapStyle.get("destruct");a=ig.copy(a.anims);if(a.namedSheets)for(var f in a.namedSheets)a.namedSheets[f].src=b.sheet;else if(!a.sheet.src)a.sheet.src=b.sheet;this.initAnimations(a)}else{this.coll.size.x=32;this.coll.size.y=32}this.blockNavMap=e.blockNavMap;if(!window.wm&&this.permaDestruct&&ig.vars.get(this.getDestructVarName())){this.varState=2;this.kill()}this.blinkTimer=Math.random()*5+1},show:function(a){this.parent(a);if(!a){this.animState.alpha=0;ig.game.effects.teleport.spawnOnTarget("showFast",
this,{})}if(this.blockNavMap)this.navBlocker=ig.navigation.getNavBlock(this)},onKill:function(a){this.parent(a);this.setVariables();this.navBlocker&&this.navBlocker.remove();this.enemyInfo&&this.enemyInfo.clearCached();this.effects.debris&&this.effects.debris.clearCached();this.effects.boom&&this.effects.boom.clearCached();this.effects.pre&&this.effects.pre.clearCached()},onSave:function(){this.setVariables()},getDestructVarName:function(){return"map._entity"+this.mapId+"_destroyed"},update:function(){if(this.effects.boomHandle){if(this.effects.debrisDelay>
0){this.effects.debrisDelay=this.effects.debrisDelay-ig.system.tick;this.effects.debrisDelay<=0&&this.throwDebris()}}else if(!this.effects.preHandle){if(this.blinkTimer<=0)this.blinkTimer=Math.random()*2+4;this.blinkTimer=this.blinkTimer-ig.system.tick;if(!this.noBlinking&&this.sprites.length>1){var a=this.sprites[1],b=a.size.y+a.size.z,c=b,e=0;if(this.blinkTimer<1){c=Math.round((this.blinkTimer-0.08)/0.92*b);c<0&&(c=0);e=Math.round((1-this.blinkTimer/0.92)*b);e<0&&(e=0)}a.setGfxCut(c,e)}}if(this.range.killTimer>=
0){this.range.killTimer=this.range.killTimer-ig.system.tick;this.range.killTimer<0&&this.destroy(true)}this.parent()},onEffectEvent:function(a){if(a==this.effects.preHandle){if(this.effects.preHandle.isDone()){this.effects.preHandle=null;this.destroy()}}else if(a==this.effects.boomHandle&&this.effects.boomHandle.isDone()){if(this.effects.debrisDelay>0){this.effects.debrisDelay=0;this.throwDebris()}this.kill()}},ballHit:function(a){if(this.effects.preHandle||this.effects.boomHandle||(!a.attackInfo||
!a.attackInfo.hasHint("BOMB"))&&!ig.EntityTools.isInScreen(this,40))return false;var d=a.getCollideSide(this,b),c=a.attackInfo&&a.attackInfo.hasHint("CHARGED"),e=c?sc.ATTACK_TYPE.MEDIUM:sc.ATTACK_TYPE.LIGHT,f=a.getHitCenter(this);if(!this.hitSide[d]||this.conditionFunction&&!this.conditionFunction(a)){if(!this.hitSide[d]){this.effects.base.spawnOnTarget("shieldBlink",this,{spriteFilter:[2]});ig.SoundHelper.playAtEntity(this.sounds.block,this)}return false}if(this.keyConsume){if(!a.attackInfo||!a.attackInfo.hasHint(this.keyConsume))return false;
d=sc.AREA_ITEM_TYPE[this.keyConsume];if(sc.map.getAreaItemAmount(d)==0)return true;d=sc.map.getAreaItemId(d);sc.model.player.removeItem(d,1)}this.hitCount=this.hitCount-(c?2:1);this.hitCount<=0&&(e=sc.ATTACK_TYPE.MASSIVE);sc.combat.showHitEffect(this,f,e,a.getElement(),false,false,true);this.hitCount<=0?this.startDestruction():this.hitSound&&ig.SoundHelper.playAtEntity(this.hitSound,this);return true},startDestruction:function(){if(!this._killed&&!this.effects.boomHandle&&!this.effects.preHandle){this.varState=
1;this.onPreDestructIncrease&&ig.vars.add(this.onPreDestructIncrease,1);this.hitCount=0;this.effects.pre?this.effects.preHandle=this.effects.pre.spawnOnTarget(this,{align:"CENTER",callback:this}):this.destroy();this.range.key&&this.invokeRangeKill(this.range.startDelay)}},destroy:function(a){if(!this._killed&&!this.effects.boomHandle){this.hitCount=0;this.setCurrentAnim("hit",true);var b=this.getCenter();this.coll.type=ig.COLLTYPE.IGNORE;a||this.setVariables();if(this.effects.boom)this.effects.boomHandle=
this.effects.boom.spawnFixed(b.x,b.y,this.coll.pos.z+this.coll.size.z/2,this,{callback:this});else{this.throwDebris();this.kill()}}},setVariables:function(){if(this.varState==1){this.varState=2;this.permaDestruct&&ig.vars.set(this.getDestructVarName(),true);this.onDestructIncrease&&ig.vars.add(this.onDestructIncrease,1)}},invokeRangeKill:function(a){for(var b=this.coll,c=this.range.padding,b=ig.game.getEntitiesInRectangle(b.pos.x-c,b.pos.y-c,b.pos.z-c,this.coll.size.x+2*c,this.coll.size.y+2*c,this.coll.size.z+
2*c,this),c=b.length;c--;){var e=b[c];if(e.onRangeKill)e.onRangeKill(this.range.key,a)}},onRangeKill:function(a,b){if(!this.effects.boomHandle&&!this.effects.preHandle&&this.range.key==a&&!(this.range.killTimer>=0)){this.range.killTimer=b;this.varState=1;this.setVariables();this.invokeRangeKill(b+this.range.delay)}},throwDebris:function(){var a=this.getCenter();this.effects.debris&&this.effects.debris.spawnFixed(a.x,a.y,this.coll.pos.z,null,{angle:this.debrisAngle});if(this.enemyInfo){a={enemyInfo:this.enemyInfo.getSettings()};
ig.game.spawnEntity("Enemy",this.coll.pos.x,this.coll.pos.y,this.coll.pos.z,a).invincibleTimer=0.05}},isBallDestroyer:function(a,b){var c=b.dir,c=Math.abs(c.x)>Math.abs(c.y)?ig.ActorEntity.FACE4[c.x>0?"WEST":"EAST"]:ig.ActorEntity.FACE4[c.y>0?"NORTH":"SOUTH"];return this.hitSide[c]}});sc.DESTRUCTIBLE_TYPE.boxMedium={hitCount:1,size:{x:24,y:24,z:22},boom:{sheet:"puzzle.destructible",name:"medium"},debris:{sheet:"cube-debris",name:"medium"},anims:{sheet:{src:null,width:24,height:48,offX:64},SUB:[{name:"default",
time:1,frames:[0],repeat:false},{name:"default",time:1,frames:[1],repeat:false,aboveZ:1}]}};sc.DESTRUCTIBLE_TYPE.boxMedNorth={hitCount:1,size:{x:24,y:24,z:22},boom:{sheet:"puzzle.destructible",name:"medium"},debris:{sheet:"cube-debris",name:"medium"},hitSide:[1,0,0,0],anims:{sheet:{src:null,width:24,height:48,offX:64},SUB:[{name:"default",time:1,frames:[0],repeat:false},{name:"default",time:1,frames:[1],repeat:false,aboveZ:1},{name:"default",time:1,frames:[2],repeat:false,aboveZ:1}]}};sc.DESTRUCTIBLE_TYPE.boxMedEast=
{hitCount:1,size:{x:24,y:24,z:22},boom:{sheet:"puzzle.destructible",name:"medium"},debris:{sheet:"cube-debris",name:"medium"},hitSide:[0,1,0,0],anims:{sheet:{src:null,width:24,height:48,offX:64},SUB:[{name:"default",time:1,frames:[0],repeat:false},{name:"default",time:1,frames:[1],repeat:false,aboveZ:1},{name:"default",time:1,frames:[5],repeat:false,aboveZ:1}]}};sc.DESTRUCTIBLE_TYPE.boxMedSouth={hitCount:1,size:{x:24,y:24,z:22},boom:{sheet:"puzzle.destructible",name:"medium"},debris:{sheet:"cube-debris",
name:"medium"},hitSide:[0,0,1,0],anims:{sheet:{src:null,width:24,height:48,offX:64},SUB:[{name:"default",time:1,frames:[0],repeat:false},{name:"default",time:1,frames:[1],repeat:false,aboveZ:1},{name:"default",time:1,frames:[3],repeat:false,aboveZ:1}]}};sc.DESTRUCTIBLE_TYPE.boxMedWest={hitCount:1,size:{x:24,y:24,z:22},boom:{sheet:"puzzle.destructible",name:"medium"},debris:{sheet:"cube-debris",name:"medium"},hitSide:[0,0,0,1],anims:{sheet:{src:null,width:24,height:48,offX:64},SUB:[{name:"default",
time:1,frames:[0],repeat:false},{name:"default",time:1,frames:[1],repeat:false,aboveZ:1},{name:"default",time:1,frames:[4],repeat:false,aboveZ:1}]}};sc.DESTRUCTIBLE_TYPE.boxLarge={hitCount:2,size:{x:32,y:32,z:32},boom:{sheet:"puzzle.destructible",name:"large"},debris:{sheet:"cube-debris",name:"large"},hitSound:new ig.Sound("media/sound/battle/block-hit.ogg",0.7),anims:{sheet:{src:null,width:32,height:64},SUB:[{name:"default",time:1,frames:[0],repeat:false},{name:"default",time:1,frames:[1],repeat:false,
aboveZ:1}]}};sc.DESTRUCTIBLE_TYPE.iceBlock={hitCount:1,size:{x:24,y:24,z:24},terrain:ig.TERRAIN.ICE,boom:{sheet:"puzzle.destructible",name:"iceBlockBoom"},hitCondition:function(a){return a.attackInfo&&a.attackInfo.element==sc.ELEMENT.HEAT},anims:{sheet:{src:null,width:24,height:48,offX:96,offY:96},SUB:[{name:"default",time:1,frames:[0],repeat:false},{name:"default",time:1,frames:[1],repeat:false,aboveZ:1}]}};sc.DESTRUCTIBLE_TYPE.bombBlock={hitCount:1,size:{x:32,y:32,z:32},boom:{sheet:"puzzle.destructible",
name:"bombBlockBoom"},debris:{name:"bombBlockDebris"},hitCondition:function(a){return a.attackInfo&&a.attackInfo.hasHint("BOMB")},anims:{sheet:{src:null,width:32,height:48,offX:0,offY:64},SUB:[{name:"default",time:1,frames:[0],repeat:false},{name:"default",time:1,frames:[1],repeat:false,aboveZ:1}]}};sc.DESTRUCTIBLE_TYPE.bombWallNorth={hitCount:1,size:{x:32,y:4,z:48},boom:{sheet:"puzzle.destructible",name:"bombBlockBoom"},debris:{name:"bombBlockDebrisWall"},debrisAngle:0.5,hitCondition:function(a){return a.attackInfo&&
a.attackInfo.hasHint("BOMB")},anims:{sheet:{src:null,width:32,height:48,offX:0,offY:112},SUB:[{name:"default",time:1,frames:[0],repeat:false},{name:"default",time:1,frames:[1],repeat:false,aboveZ:1}]}};sc.DESTRUCTIBLE_TYPE.bombWallEast={hitCount:1,size:{x:16,y:32,z:32},boom:{sheet:"puzzle.destructible",name:"bombBlockBoom"},debris:{name:"bombBlockDebrisWall"},debrisAngle:0.75,hitCondition:function(a){return a.attackInfo&&a.attackInfo.hasHint("BOMB")},anims:{sheet:{src:null,width:16,height:64,offX:64,
offY:64},SUB:[{name:"default",time:1,frames:[0],repeat:false},{name:"default",time:1,frames:[1],repeat:false,aboveZ:1}]}};sc.DESTRUCTIBLE_TYPE.bombWallWest={hitCount:1,size:{x:16,y:32,z:32},boom:{sheet:"puzzle.destructible",name:"bombBlockBoom"},debris:{name:"bombBlockDebrisWall"},debrisAngle:0.25,hitCondition:function(a){return a.attackInfo&&a.attackInfo.hasHint("BOMB")},anims:{sheet:{src:null,width:16,height:64,offX:64,offY:64},flipX:true,SUB:[{name:"default",time:1,frames:[0],repeat:false},{name:"default",
time:1,frames:[1],repeat:false,aboveZ:1}]}};sc.DESTRUCTIBLE_TYPE.keyWallNorth={hitCount:1,size:{x:32,y:4,z:32},preBoom:{sheet:"puzzle.destructible",name:"keyDoorPre"},keyConsume:"DUNGEON_KEY",anims:{sheet:{src:null,width:32,height:32,offX:96,offY:48},offset:{x:0,y:-4,z:0},SUB:[{name:"default",time:1,frames:[0],repeat:false},{name:"default",time:1,frames:[1],repeat:false,aboveZ:1}]}};sc.DESTRUCTIBLE_TYPE.keyPillar={hitCount:1,collType:ig.COLLTYPE.FENCE,size:{x:16,y:16,z:96},preBoom:{sheet:"puzzle.destructible",
name:"keyPillarPre"},boom:{sheet:"puzzle.destructible",name:"keyPillarBoom"},range:{key:"KEY_PILLAR",delay:0.1,padding:8,startDelay:1},keyConsume:"DUNGEON_KEY",anims:{sheet:{src:null,width:16,height:48,offX:176,offY:48},pivot:{x:8,y:48},SUB:[{name:"default",time:1,frames:[0],repeat:false},{name:"default",time:1,frames:[1],repeat:false,aboveZ:1}]}};sc.DESTRUCTIBLE_TYPE.keyPillarAR={hitCount:1,collType:ig.COLLTYPE.FENCE,size:{x:16,y:16,z:96},preBoom:{sheet:"puzzle.destructible",name:"keyPillarPre"},
boom:{sheet:"puzzle.destructible",name:"keyPillarBoom"},range:{key:"KEY_PILLAR",delay:0.1,padding:8},hitCondition:function(){return false},onlyPerma:true,noBlinking:true,anims:{namedSheets:{floor:{src:null,width:16,height:16,offX:144,offY:80},ar:{src:null,width:16,height:48,offX:160,offY:48}},SUB:[{name:"default",sheet:"floor",time:1,frames:[0],repeat:false,shapeType:"Z_FLAT",pivot:{x:8,y:16}},{name:"default",sheet:"ar",time:0.05,frames:[0,0,0,0,0,0],framesAlpha:[1,1,1,0.8,0.6,0.8],repeat:true,renderMode:"lighter",
pivot:{x:8,y:48}}]}};sc.DESTRUCTIBLE_TYPE.masterKeyWallColdDungeon={hitCount:1,size:{x:64,y:4,z:64},preBoom:{sheet:"puzzle.destructible",name:"keyDoorMasterPre"},keyConsume:"DUNGEON_MASTER_KEY",anims:{sheet:{src:"media/map/cold-dng.png",width:64,height:64,offX:176,offY:416,xCount:1},offset:{x:0,y:-4,z:0},SUB:[{name:"default",time:1,frames:[0],repeat:false},{name:"default",time:1,frames:[1],repeat:false,aboveZ:1}]}};sc.DESTRUCTIBLE_TYPE.masterKeyWallHeatDungeon={hitCount:1,size:{x:64,y:4,z:48},preBoom:{sheet:"puzzle.destructible",
name:"keyDoorMasterPre"},keyConsume:"DUNGEON_MASTER_KEY",anims:{sheet:{src:"media/map/heat-dng.png",width:64,height:48,offX:320,offY:544,xCount:1},offset:{x:0,y:-4,z:0},SUB:[{name:"default",time:1,frames:[0],repeat:false},{name:"default",time:1,frames:[1],repeat:false,aboveZ:1}]}};sc.DESTRUCTIBLE_TYPE.masterKeyWallTreeDungeon={hitCount:1,size:{x:64,y:4,z:48},preBoom:{sheet:"puzzle.destructible",name:"keyDoorMasterPre"},keyConsume:"DUNGEON_MASTER_KEY",anims:{sheet:{src:"media/map/shockwave-dng.png",
width:64,height:48,offX:320,offY:544,xCount:1},offset:{x:0,y:-4,z:0},SUB:[{name:"default",time:1,frames:[0],repeat:false},{name:"default",time:1,frames:[1],repeat:false,aboveZ:1}]}};sc.DESTRUCTIBLE_TYPE.masterKeyWallFinalDungeon={hitCount:1,size:{x:64,y:4,z:48},preBoom:{sheet:"puzzle.destructible",name:"keyDoorMasterPre"},keyConsume:"DUNGEON_MASTER_KEY",anims:{sheet:{src:"media/map/final-dungeon-outer.png",width:64,height:48,offX:384,offY:528,xCount:2},offset:{x:0,y:-4,z:0},SUB:[{name:"default",time:1,
frames:[0],repeat:false},{name:"default",time:1,frames:[1],repeat:false,aboveZ:1}]}};sc.DESTRUCTIBLE_TYPE.autumnWall={hitCount:1,size:{x:32,y:8,z:40},boom:{sheet:"puzzle.destructible",name:"wallBlockBoom"},debris:{sheet:"area.autumn",name:"wallBoom"},hitSound:new ig.Sound("media/sound/battle/block-hit.ogg",0.7),anims:{sheet:{src:"media/map/autumn-outside.png",width:32,height:48,offX:32,offY:768},SUB:[{name:"default",time:1,frames:[0],repeat:false},{name:"default",time:1,frames:[1],repeat:false,aboveZ:1}]}};
sc.DESTRUCTIBLE_TYPE.autumnWall2={hitCount:1,size:{x:48,y:8,z:40},boom:{sheet:"puzzle.destructible",name:"wallBlockBoom"},debris:{sheet:"area.autumn",name:"wallBoom"},hitSound:new ig.Sound("media/sound/battle/block-hit.ogg",0.7),anims:{sheet:{src:"media/map/autumn-outside.png",width:48,height:48,offX:32,offY:816},SUB:[{name:"default",time:1,frames:[0],repeat:false},{name:"default",time:1,frames:[1],repeat:false,aboveZ:1}]}};sc.DESTRUCTIBLE_TYPE.autumnWall3={hitCount:1,size:{x:32,y:8,z:40},boom:{sheet:"puzzle.destructible",
name:"wallBlockBoom"},debris:{sheet:"area.autumn",name:"wallBoom"},hitSound:new ig.Sound("media/sound/battle/block-hit.ogg",0.7),anims:{sheet:{src:"media/map/autumn-outside.png",width:32,height:48,offX:32,offY:864},SUB:[{name:"default",time:1,frames:[0],repeat:false},{name:"default",time:1,frames:[1],repeat:false,aboveZ:1}]}}});ig.baked=!0;
ig.module("game.feature.puzzle.entities.item-destruct").requires("impact.base.entity","impact.feature.effect.effect-sheet","game.feature.menu.menu-model").defines(function(){sc.ITEM_DESTRUCT_TYPE={};var b=Vec3.create();ig.ENTITY.ItemDestruct=ig.AnimatedEntity.extend({_wm:new ig.Config({spawnable:true,attributes:{desType:{_type:"String",_info:"Type of destructible object",_select:sc.ITEM_DESTRUCT_TYPE,_withNull:true},items:{_type:"ItemsDropRate",_info:"Items dropped",_popup:true},perma:{_type:"Boolean",
_info:"True if cannot be respawned",_default:"false",_optional:true},indest:{_type:"Boolean",_info:"True if cannot be destroyed",_default:"true",_optional:true},trigger:{_type:"String",_info:"var tp set to true once the prop has been destroyed. Only works once.",_optional:true},increment:{_type:"VarName",_info:"add 1 to the given variable",_optional:true},enemyInfo:{_type:"EnemyType",_info:"Enemy to spawn after destruction",_popup:true,_withNull:true}}}),blinkTimer:0,dropped:false,itemDrops:[],typeData:null,
permaDeath:false,globalKey:null,enemyInfo:null,enemyChance:-1,boomEffect:null,debrisEffect:null,trigger:"",indestructible:false,init:function(a,b,c,e){this.parent(a,b,c,e);this.coll.type=ig.COLLTYPE.VIRTUAL;this.coll.zGravityFactor=1;this.coll.zBounciness=0.5;this.coll.setUpdateType(ig.COLL_UPDATE_TYPE.ON_SCREEN);a=sc.ITEM_DESTRUCT_TYPE[e.desType];this.permaDeath=e.perma||false;this.trigger=e.trigger||"";this.indestructible=e.indest||false;if(a){if(e.enemyInfo&&e.enemyInfo.type){this.enemyInfo=new sc.EnemyInfo(e.enemyInfo);
this.enemyChance=e.enemyInfo.chance||-1}this.typeData=a;Vec3.assign(this.coll.size,a.size);if(a.gravity!=void 0)this.coll.zGravityFactor=a.gravity;this.boomEffect=new ig.EffectHandle(a.boom);this.debrisEffect=new ig.EffectHandle(a.debris);this.initAnimations(a.anims)}else{this.coll.size.x=32;this.coll.size.y=32}if(e._globalSettingKey)this.globalKey={key:e._globalSettingKey,anim:e.desType};if(e=e.items){e.sort(function(a,b){return a.prob-b.prob});for(b=a=0;b<e.length;++b){a=a+e[b].prob;this.itemDrops.push({id:e[b].id,
prob:a})}}e=ig.vars.get(this._getVarPrefix()+".respawnTime");this.permaDeath?ig.vars.get("map.itemDestructPerma"+this.mapId)&&this.setDropped():e&&e>sc.combat.time&&this.setDropped();this.blinkTimer=Math.random()*5+1},_getVarPrefix:function(){return"session.map.itemDestruct"+this.mapId},onKill:function(a){this.parent(a);this.boomEffect&&this.boomEffect.clearCached();this.debrisEffect&&this.debrisEffect.clearCached();this.enemyInfo&&this.enemyInfo.clearCached()},update:function(){if(this.blinkTimer<=
0)this.blinkTimer=Math.random()*2+4;this.blinkTimer=this.blinkTimer-ig.system.tick;this.parent();if(this.sprites.length>1){var a=this.sprites[1],b=a.size.y+a.size.z,c=b,e=0;if(this.blinkTimer<1){c=Math.round((this.blinkTimer-0.15)/0.85*b);c<0&&(c=0);e=Math.round((1-this.blinkTimer/0.85)*b);e<0&&(e=0)}a.setGfxCut(c,e)}},ballHit:function(a){if(this.dropped||this.indestructible||!ig.CollTools.isInScreen(this.coll,0))return false;var b=a.attackInfo&&a.attackInfo.hasHint("CHARGED")?sc.ATTACK_TYPE.MEDIUM:
sc.ATTACK_TYPE.LIGHT,c=a.getHitCenter(this),b=sc.ATTACK_TYPE.HEAVY;sc.stats.addMap("player","propsDestroyed",1);sc.combat.showHitEffect(this,c,b,a.getElement(),false,false,true);this.destroy();return true},destroy:function(){this.setDropped();var a=this.getCenter(b);this.typeData.effectOffset&&Vec3.add(a,this.typeData.effectOffset);this.boomEffect.spawnFixed(a.x,a.y,this.coll.pos.z+this.coll.size.z/2);this.debrisEffect.spawnFixed(a.x,a.y,this.coll.pos.z+this.coll.size.z/2);this.dropItem();a=sc.combat.time+
300;ig.vars.set(this._getVarPrefix()+".respawnTime",a);this.permaDeath&&ig.vars.set("map.itemDestructPerma"+this.mapId,true);this.trigger&&!ig.vars.get(this.trigger)&&ig.vars.set(this.trigger,true);if(this.enemyInfo&&Math.random()<=this.enemyChance){a={enemyInfo:this.enemyInfo.getSettings()};ig.game.spawnEntity("Enemy",this.coll.pos.x,this.coll.pos.y,this.coll.pos.z,a).invincibleTimer=0.05}},setDropped:function(){this.dropped=true;this.setCurrentAnim("dropped",true);this.coll.type=ig.COLLTYPE.IGNORE;
this.coll.setUpdateType(ig.COLL_UPDATE_TYPE.STATIC)},dropItem:function(){for(var a=Math.random(),b=sc.model.player.params,c=b.getModifier("RANK_PLANTS")?sc.model.getCombatRankDropRate():1,b=((b.getModifier("DROP_CHANCE")||0)+1)*c*sc.newgame.getDropRateMultiplier(),c=0;c<this.itemDrops.length;++c){var e=this.itemDrops[c];if(a<=e.prob*b||e.prob>=1){this.globalKey&&sc.menu.incrementDropCount(this.globalKey.key,this.globalKey.anim);sc.ItemDropEntity.spawnDrops(this,ig.ENTITY_ALIGN.CENTER,ig.game.playerEntity,
e.id,1,sc.ITEM_DROP_TYPE.PROP);if(b>1)b=Math.max(b-1,1);else break}}},isBallDestroyer:function(){return!this.dropped}});sc.ITEM_DESTRUCT_TYPE.StoneOfValor={size:{x:16,y:16,z:22},effectOffset:{x:0,y:0,z:12},boom:{sheet:"puzzle.destructible",name:"small"},debris:{sheet:"area.stones",name:"burstValor"},anims:{shapeType:"Y_FLAT",sheet:{src:"media/entity/objects/destructible-stones.png",width:24,height:32,offY:0},SUB:[{name:"default",time:1,frames:[0],repeat:false},{name:"default",time:1,frames:[1],repeat:false},
{name:"dropped",time:1,frames:[2],repeat:false}]}};sc.ITEM_DESTRUCT_TYPE.StoneOfSpace={size:{x:16,y:16,z:22},effectOffset:{x:0,y:0,z:12},boom:{sheet:"puzzle.destructible",name:"small"},debris:{sheet:"area.stones",name:"burstSpace"},anims:{shapeType:"Y_FLAT",sheet:{src:"media/entity/objects/destructible-stones.png",width:24,height:32,offY:32},SUB:[{name:"default",time:1,frames:[0],repeat:false},{name:"default",time:1,frames:[1],repeat:false},{name:"dropped",time:1,frames:[2],repeat:false}]}};sc.ITEM_DESTRUCT_TYPE.StoneOfTruth=
{size:{x:16,y:16,z:22},effectOffset:{x:0,y:0,z:12},boom:{sheet:"puzzle.destructible",name:"small"},debris:{sheet:"area.stones",name:"burstTruth"},anims:{shapeType:"Y_FLAT",sheet:{src:"media/entity/objects/destructible-stones.png",width:24,height:32,offY:64},SUB:[{name:"default",time:1,frames:[0],repeat:false},{name:"default",time:1,frames:[1],repeat:false},{name:"dropped",time:1,frames:[2],repeat:false}]}};sc.ITEM_DESTRUCT_TYPE.StoneOfSpirit={size:{x:16,y:16,z:22},effectOffset:{x:0,y:0,z:12},boom:{sheet:"puzzle.destructible",
name:"small"},debris:{sheet:"area.stones",name:"burstSpirit"},anims:{shapeType:"Y_FLAT",sheet:{src:"media/entity/objects/destructible-stones.png",width:24,height:32,offY:96},SUB:[{name:"default",time:1,frames:[0],repeat:false},{name:"default",time:1,frames:[1],repeat:false},{name:"dropped",time:1,frames:[2],repeat:false}]}};sc.ITEM_DESTRUCT_TYPE.StoneOfAges={size:{x:16,y:16,z:22},effectOffset:{x:0,y:0,z:12},boom:{sheet:"puzzle.destructible",name:"small"},debris:{sheet:"area.stones",name:"burstAges"},
anims:{shapeType:"Y_FLAT",sheet:{src:"media/entity/objects/destructible-stones.png",width:24,height:32,offY:128},SUB:[{name:"default",time:1,frames:[0],repeat:false},{name:"default",time:1,frames:[1],repeat:false},{name:"dropped",time:1,frames:[2],repeat:false}]}};sc.ITEM_DESTRUCT_TYPE.StoneOfNothing={size:{x:16,y:16,z:22},effectOffset:{x:0,y:0,z:12},boom:{sheet:"puzzle.destructible",name:"small"},debris:{sheet:"area.stones",name:"burst"},anims:{shapeType:"Y_FLAT",sheet:{src:"media/entity/objects/destructible-stones.png",
width:24,height:32,offY:160},SUB:[{name:"default",time:1,frames:[0],repeat:false},{name:"default",time:1,frames:[1],repeat:false},{name:"dropped",time:1,frames:[2],repeat:false}]}};sc.ITEM_DESTRUCT_TYPE.AutumnPlantA={size:{x:16,y:16,z:22},effectOffset:{x:0,y:0,z:12},boom:{sheet:"puzzle.destructible",name:"small"},debris:{sheet:"area.autumn",name:"plantBurst"},anims:{shapeType:"Y_FLAT",sheet:{src:"media/entity/objects/autumn-destructibles.png",width:24,height:32,offX:0},SUB:[{name:"default",time:1,
frames:[0],repeat:false},{name:"default",time:1,frames:[1],repeat:false},{name:"dropped",time:1,frames:[2],repeat:false}]}};sc.ITEM_DESTRUCT_TYPE["Autumn-Ground-1"]={size:{x:16,y:16,z:22},effectOffset:{x:0,y:0,z:12},boom:{sheet:"puzzle.destructible",name:"small"},debris:{sheet:"area.autumn",name:"plantBurst"},anims:{shapeType:"Y_FLAT",sheet:{src:"media/entity/objects/autumn-destructibles.png",width:24,height:32,offX:0},SUB:[{name:"default",time:1,frames:[0],repeat:false},{name:"default",time:1,frames:[1],
repeat:false},{name:"dropped",time:1,frames:[2],repeat:false}]}};sc.ITEM_DESTRUCT_TYPE["Autumn-Ground-2"]={size:{x:16,y:16,z:22},effectOffset:{x:0,y:0,z:12},boom:{sheet:"puzzle.destructible",name:"small"},debris:{sheet:"area.autumn",name:"plantBurst"},anims:{shapeType:"Y_FLAT",sheet:{src:"media/entity/objects/autumn-destructibles.png",width:24,height:32,offY:32},SUB:[{name:"default",time:1,frames:[0],repeat:false},{name:"default",time:1,frames:[1],repeat:false},{name:"dropped",time:1,frames:[2],repeat:false}]}};
sc.ITEM_DESTRUCT_TYPE["Autumn-Water-1"]={size:{x:16,y:16,z:22},effectOffset:{x:0,y:0,z:12},boom:{sheet:"puzzle.destructible",name:"small"},debris:{sheet:"area.autumn",name:"plantBurst"},anims:{shapeType:"Y_FLAT",sheet:{src:"media/entity/objects/autumn-destructibles.png",width:24,height:32,offY:64},SUB:[{name:"default",time:1,frames:[0],repeat:false},{name:"default",time:1,frames:[1],repeat:false},{name:"dropped",time:1,frames:[2],repeat:false}]}};sc.ITEM_DESTRUCT_TYPE["Autumn-Water-2"]={size:{x:16,
y:16,z:22},effectOffset:{x:0,y:0,z:12},boom:{sheet:"puzzle.destructible",name:"small"},debris:{sheet:"area.autumn",name:"plantBurst"},anims:{shapeType:"Y_FLAT",sheet:{src:"media/entity/objects/autumn-destructibles.png",width:24,height:32,offY:96},SUB:[{name:"default",time:1,frames:[0],repeat:false},{name:"default",time:1,frames:[1],repeat:false},{name:"dropped",time:1,frames:[2],repeat:false}]}};sc.ITEM_DESTRUCT_TYPE["Autumn-Special"]={size:{x:16,y:16,z:22},effectOffset:{x:0,y:0,z:12},boom:{sheet:"puzzle.destructible",
name:"small"},debris:{sheet:"area.autumn",name:"plantBurst"},anims:{shapeType:"Y_FLAT",sheet:{src:"media/entity/objects/autumn-destructibles.png",width:24,height:32,offY:128},SUB:[{name:"default",time:1,frames:[0],repeat:false},{name:"default",time:1,frames:[1],repeat:false},{name:"dropped",time:1,frames:[2],repeat:false}]}};sc.ITEM_DESTRUCT_TYPE["Autumn-Water-Special"]={size:{x:16,y:16,z:22},effectOffset:{x:0,y:0,z:12},boom:{sheet:"puzzle.destructible",name:"small"},debris:{sheet:"area.autumn",name:"plantBurst"},
anims:{shapeType:"Y_FLAT",sheet:{src:"media/entity/objects/autumn-destructibles.png",width:24,height:32,offY:160},SUB:[{name:"default",time:1,frames:[0],repeat:false},{name:"default",time:1,frames:[1],repeat:false},{name:"dropped",time:1,frames:[2],repeat:false}]}};sc.ITEM_DESTRUCT_TYPE["Autumn-Fall-Ground-1"]={size:{x:16,y:16,z:22},effectOffset:{x:0,y:0,z:12},boom:{sheet:"puzzle.destructible",name:"small"},debris:{sheet:"area.autumn",name:"plantBurst"},anims:{shapeType:"Y_FLAT",sheet:{src:"media/entity/objects/autumn-destructibles.png",
width:24,height:32,offX:128},SUB:[{name:"default",time:1,frames:[0],repeat:false},{name:"default",time:1,frames:[1],repeat:false},{name:"dropped",time:1,frames:[2],repeat:false}]}};sc.ITEM_DESTRUCT_TYPE["Autumn-Fall-Ground-2"]={size:{x:16,y:16,z:22},effectOffset:{x:0,y:0,z:12},boom:{sheet:"puzzle.destructible",name:"small"},debris:{sheet:"area.autumn",name:"plantBurst"},anims:{shapeType:"Y_FLAT",sheet:{src:"media/entity/objects/autumn-destructibles.png",width:24,height:32,offY:32,offX:128},SUB:[{name:"default",
time:1,frames:[0],repeat:false},{name:"default",time:1,frames:[1],repeat:false},{name:"dropped",time:1,frames:[2],repeat:false}]}};sc.ITEM_DESTRUCT_TYPE["Autumn-Fall-Water-1"]={size:{x:16,y:16,z:22},effectOffset:{x:0,y:0,z:12},boom:{sheet:"puzzle.destructible",name:"small"},debris:{sheet:"area.autumn",name:"plantBurst"},anims:{shapeType:"Y_FLAT",sheet:{src:"media/entity/objects/autumn-destructibles.png",width:24,height:32,offY:64,offX:128},SUB:[{name:"default",time:1,frames:[0],repeat:false},{name:"default",
time:1,frames:[1],repeat:false},{name:"dropped",time:1,frames:[2],repeat:false}]}};sc.ITEM_DESTRUCT_TYPE["Autumn-Fall-Water-2"]={size:{x:16,y:16,z:22},effectOffset:{x:0,y:0,z:12},boom:{sheet:"puzzle.destructible",name:"small"},debris:{sheet:"area.autumn",name:"plantBurst"},anims:{shapeType:"Y_FLAT",sheet:{src:"media/entity/objects/autumn-destructibles.png",width:24,height:32,offY:96,offX:128},SUB:[{name:"default",time:1,frames:[0],repeat:false},{name:"default",time:1,frames:[1],repeat:false},{name:"dropped",
time:1,frames:[2],repeat:false}]}};sc.ITEM_DESTRUCT_TYPE["Autumn-Fall-Special"]={size:{x:16,y:16,z:22},effectOffset:{x:0,y:0,z:12},boom:{sheet:"puzzle.destructible",name:"small"},debris:{sheet:"area.autumn",name:"plantBurst"},anims:{shapeType:"Y_FLAT",sheet:{src:"media/entity/objects/autumn-destructibles.png",width:24,height:32,offY:128,offX:128},SUB:[{name:"default",time:1,frames:[0],repeat:false},{name:"default",time:1,frames:[1],repeat:false},{name:"dropped",time:1,frames:[2],repeat:false}]}};
sc.ITEM_DESTRUCT_TYPE["Autumn-Fall-Water-Special"]={size:{x:16,y:16,z:22},effectOffset:{x:0,y:0,z:12},boom:{sheet:"puzzle.destructible",name:"small"},debris:{sheet:"area.autumn",name:"plantBurst"},anims:{shapeType:"Y_FLAT",sheet:{src:"media/entity/objects/autumn-destructibles.png",width:24,height:32,offY:160,offX:128},SUB:[{name:"default",time:1,frames:[0],repeat:false},{name:"default",time:1,frames:[1],repeat:false},{name:"dropped",time:1,frames:[2],repeat:false}]}};sc.ITEM_DESTRUCT_TYPE["Bergen-PlantA-1"]=
{size:{x:16,y:16,z:22},effectOffset:{x:0,y:0,z:12},boom:{sheet:"puzzle.destructible",name:"small"},debris:{sheet:"area.bergen",name:"plantBurst"},anims:{shapeType:"Y_FLAT",sheet:{src:"media/map/bergen-trail.png",width:24,height:32,offX:0,offY:384},SUB:[{name:"default",time:1,frames:[0],repeat:false},{name:"default",time:1,frames:[1],repeat:false},{name:"dropped",time:1,frames:[2],repeat:false}]}};sc.ITEM_DESTRUCT_TYPE["Bergen-PlantA-2"]={size:{x:16,y:16,z:22},effectOffset:{x:0,y:0,z:12},boom:{sheet:"puzzle.destructible",
name:"small"},debris:{sheet:"area.bergen",name:"plantBurst"},anims:{shapeType:"Y_FLAT",sheet:{src:"media/map/bergen-trail.png",width:24,height:32,offX:0,offY:416},SUB:[{name:"default",time:1,frames:[0],repeat:false},{name:"default",time:1,frames:[1],repeat:false},{name:"dropped",time:1,frames:[2],repeat:false}]}};sc.ITEM_DESTRUCT_TYPE["Bergen-PlantA-Rare"]={size:{x:16,y:16,z:22},effectOffset:{x:0,y:0,z:12},boom:{sheet:"puzzle.destructible",name:"small"},debris:{sheet:"area.bergen",name:"plantBurst"},
anims:{shapeType:"Y_FLAT",sheet:{src:"media/map/bergen-trail.png",width:24,height:32,offX:144,offY:384},SUB:[{name:"default",time:1,frames:[0],repeat:false},{name:"default",time:1,frames:[1],repeat:false},{name:"dropped",time:1,frames:[2],repeat:false}]}};sc.ITEM_DESTRUCT_TYPE["Bergen-PlantB-1"]={size:{x:16,y:16,z:22},effectOffset:{x:0,y:0,z:12},boom:{sheet:"puzzle.destructible",name:"small"},debris:{sheet:"area.bergen",name:"plantBurst"},anims:{shapeType:"Y_FLAT",sheet:{src:"media/map/bergen-trail.png",
width:24,height:32,offX:0,offY:448},SUB:[{name:"default",time:1,frames:[0],repeat:false},{name:"default",time:1,frames:[1],repeat:false},{name:"dropped",time:1,frames:[2],repeat:false}]}};sc.ITEM_DESTRUCT_TYPE["Bergen-PlantB-2"]={size:{x:16,y:16,z:22},effectOffset:{x:0,y:0,z:12},boom:{sheet:"puzzle.destructible",name:"small"},debris:{sheet:"area.bergen",name:"plantBurst"},anims:{shapeType:"Y_FLAT",sheet:{src:"media/map/bergen-trail.png",width:24,height:32,offX:0,offY:480},SUB:[{name:"default",time:1,
frames:[0],repeat:false},{name:"default",time:1,frames:[1],repeat:false},{name:"dropped",time:1,frames:[2],repeat:false}]}};sc.ITEM_DESTRUCT_TYPE["Bergen-PlantB-Rare"]={size:{x:16,y:16,z:22},effectOffset:{x:0,y:0,z:12},boom:{sheet:"puzzle.destructible",name:"small"},debris:{sheet:"area.bergen",name:"plantBurst"},anims:{shapeType:"Y_FLAT",sheet:{src:"media/map/bergen-trail.png",width:24,height:32,offX:144,offY:448},SUB:[{name:"default",time:1,frames:[0],repeat:false},{name:"default",time:1,frames:[1],
repeat:false},{name:"dropped",time:1,frames:[2],repeat:false}]}};sc.ITEM_DESTRUCT_TYPE["Bergen-PlantA-1-Snow"]={size:{x:16,y:16,z:22},effectOffset:{x:0,y:0,z:12},boom:{sheet:"puzzle.destructible",name:"small"},debris:{sheet:"area.bergen",name:"plantBurstSnow"},anims:{shapeType:"Y_FLAT",sheet:{src:"media/map/bergen-trail.png",width:24,height:32,offX:72,offY:384},SUB:[{name:"default",time:1,frames:[0],repeat:false},{name:"default",time:1,frames:[1],repeat:false},{name:"dropped",time:1,frames:[2],repeat:false}]}};
sc.ITEM_DESTRUCT_TYPE["Bergen-PlantA-2-Snow"]={size:{x:16,y:16,z:22},effectOffset:{x:0,y:0,z:12},boom:{sheet:"puzzle.destructible",name:"small"},debris:{sheet:"area.bergen",name:"plantBurstSnow"},anims:{shapeType:"Y_FLAT",sheet:{src:"media/map/bergen-trail.png",width:24,height:32,offX:72,offY:416},SUB:[{name:"default",time:1,frames:[0],repeat:false},{name:"default",time:1,frames:[1],repeat:false},{name:"dropped",time:1,frames:[2],repeat:false}]}};sc.ITEM_DESTRUCT_TYPE["Bergen-PlantA-Snow-Rare"]={size:{x:16,
y:16,z:22},effectOffset:{x:0,y:0,z:12},boom:{sheet:"puzzle.destructible",name:"small"},debris:{sheet:"area.bergen",name:"plantBurst"},anims:{shapeType:"Y_FLAT",sheet:{src:"media/map/bergen-trail.png",width:24,height:32,offX:144,offY:416},SUB:[{name:"default",time:1,frames:[0],repeat:false},{name:"default",time:1,frames:[1],repeat:false},{name:"dropped",time:1,frames:[2],repeat:false}]}};sc.ITEM_DESTRUCT_TYPE["Bergen-PlantB-1-Snow"]={size:{x:16,y:16,z:22},effectOffset:{x:0,y:0,z:12},boom:{sheet:"puzzle.destructible",
name:"small"},debris:{sheet:"area.bergen",name:"plantBurstSnow"},anims:{shapeType:"Y_FLAT",sheet:{src:"media/map/bergen-trail.png",width:24,height:32,offX:72,offY:448},SUB:[{name:"default",time:1,frames:[0],repeat:false},{name:"default",time:1,frames:[1],repeat:false},{name:"dropped",time:1,frames:[2],repeat:false}]}};sc.ITEM_DESTRUCT_TYPE["Bergen-PlantB-2-Snow"]={size:{x:16,y:16,z:22},effectOffset:{x:0,y:0,z:12},boom:{sheet:"puzzle.destructible",name:"small"},debris:{sheet:"area.bergen",name:"plantBurstSnow"},
anims:{shapeType:"Y_FLAT",sheet:{src:"media/map/bergen-trail.png",width:24,height:32,offX:72,offY:480},SUB:[{name:"default",time:1,frames:[0],repeat:false},{name:"default",time:1,frames:[1],repeat:false},{name:"dropped",time:1,frames:[2],repeat:false}]}};sc.ITEM_DESTRUCT_TYPE["Bergen-PlantB-Snow-Rare"]={size:{x:16,y:16,z:22},effectOffset:{x:0,y:0,z:12},boom:{sheet:"puzzle.destructible",name:"small"},debris:{sheet:"area.bergen",name:"plantBurstSnow"},anims:{shapeType:"Y_FLAT",sheet:{src:"media/map/bergen-trail.png",
width:24,height:32,offX:144,offY:480},SUB:[{name:"default",time:1,frames:[0],repeat:false},{name:"default",time:1,frames:[1],repeat:false},{name:"dropped",time:1,frames:[2],repeat:false}]}};sc.ITEM_DESTRUCT_TYPE["Bergen-Snow-Crystal"]={size:{x:16,y:16,z:22},effectOffset:{x:0,y:0,z:8},boom:{sheet:"puzzle.destructible",name:"small"},debris:{sheet:"area.bergen",name:"burstSnow"},anims:{shapeType:"Y_FLAT",sheet:{src:"media/map/bergen-trail.png",width:24,height:32,offX:216,offY:480},SUB:[{name:"default",
time:1,frames:[0],repeat:false},{name:"default",time:1,frames:[1],repeat:false},{name:"dropped",time:1,frames:[2],repeat:false}]}};sc.ITEM_DESTRUCT_TYPE["Bergen-Vase-1"]={size:{x:16,y:10,z:18},effectOffset:{x:0,y:0,z:9},boom:{sheet:"puzzle.destructible",name:"small"},debris:{sheet:"area.bergen",name:"vase-break"},anims:{shapeType:"Y_FLAT",sheet:{src:"media/map/bergen-trail.png",width:16,height:28,offX:224,offY:964},SUB:[{name:"default",time:1,frames:[0],repeat:false},{name:"default",time:1,frames:[1],
repeat:false},{name:"dropped",time:1,frames:[2],repeat:false}]}};sc.ITEM_DESTRUCT_TYPE["Cold-Dng-Egg-1"]={size:{x:14,y:16,z:16},effectOffset:{x:0,y:0,z:9},boom:{sheet:"puzzle.destructible",name:"small"},debris:{sheet:"area.cold-dng",name:"eggs"},anims:{wallY:0.4,sheet:{src:"media/map/cold-dng.png",width:16,height:32,offX:192,offY:560},SUB:[{name:"default",time:1,frames:[0],repeat:false},{name:"default",time:1,frames:[1],repeat:false,aboveZ:1},{name:"dropped",time:1,frames:[2],repeat:false}]}};sc.ITEM_DESTRUCT_TYPE["Cold-Dng-Egg-2"]=
{size:{x:14,y:16,z:16},effectOffset:{x:0,y:0,z:9},boom:{sheet:"puzzle.destructible",name:"small"},debris:{sheet:"area.cold-dng",name:"eggs"},anims:{wallY:0.4,sheet:{src:"media/map/cold-dng.png",width:16,height:32,offX:192,offY:592},SUB:[{name:"default",time:1,frames:[0],repeat:false},{name:"default",time:1,frames:[1],repeat:false,aboveZ:1},{name:"dropped",time:1,frames:[2],repeat:false}]}};sc.ITEM_DESTRUCT_TYPE["Cold-Dng-Egg-3"]={size:{x:14,y:16,z:16},effectOffset:{x:0,y:0,z:9},boom:{sheet:"puzzle.destructible",
name:"small"},debris:{sheet:"area.cold-dng",name:"eggs"},anims:{wallY:0.4,sheet:{src:"media/map/cold-dng.png",width:16,height:32,offX:192,offY:624},SUB:[{name:"default",time:1,frames:[0],repeat:false},{name:"default",time:1,frames:[1],repeat:false,aboveZ:1},{name:"dropped",time:1,frames:[2],repeat:false}]}};sc.ITEM_DESTRUCT_TYPE["Cold-Dng-Egg-4"]={size:{x:24,y:16,z:16},effectOffset:{x:0,y:0,z:9},boom:{sheet:"puzzle.destructible",name:"small"},debris:{sheet:"area.cold-dng",name:"eggs"},anims:{wallY:0.4,
sheet:{src:"media/map/cold-dng.png",width:32,height:32,offX:240,offY:560},SUB:[{name:"default",time:1,frames:[0],repeat:false},{name:"default",time:1,frames:[1],repeat:false,aboveZ:1},{name:"dropped",time:1,frames:[2],repeat:false}]}};sc.ITEM_DESTRUCT_TYPE["Cold-Dng-Egg-Special-A"]={size:{x:36,y:24,z:24},effectOffset:{x:0,y:0,z:9},boom:{sheet:"puzzle.destructible",name:"small"},debris:{sheet:"area.cold-dng",name:"eggs"},anims:{wallY:0.4,sheet:{src:"media/map/cold-dng.png",width:40,height:48,offX:72,
offY:560},SUB:[{name:"default",time:1,frames:[0],repeat:false},{name:"default",time:1,frames:[1],repeat:false,aboveZ:1},{name:"dropped",time:1,frames:[2],repeat:false}]}};sc.ITEM_DESTRUCT_TYPE["Cold-Dng-Egg-Special-B"]={size:{x:36,y:24,z:24},effectOffset:{x:0,y:0,z:9},boom:{sheet:"puzzle.destructible",name:"small"},debris:{sheet:"area.cold-dng",name:"eggs"},anims:{wallY:0.4,sheet:{src:"media/map/cold-dng.png",width:40,height:48,offX:72,offY:608},SUB:[{name:"default",time:1,frames:[0],repeat:false},
{name:"default",time:1,frames:[1],repeat:false,aboveZ:1},{name:"dropped",time:1,frames:[2],repeat:false}]}};sc.ITEM_DESTRUCT_TYPE["Heat-Cactus-1"]={size:{x:16,y:16,z:22},effectOffset:{x:0,y:0,z:12},boom:{sheet:"puzzle.destructible",name:"small"},debris:{sheet:"area.heat",name:"plantBurst"},anims:{shapeType:"Y_FLAT",sheet:{src:"media/map/heat-area.png",width:24,height:32,offX:208,offY:320},SUB:[{name:"default",time:1,frames:[0],repeat:false},{name:"default",time:1,frames:[1],repeat:false},{name:"dropped",
time:1,frames:[2],repeat:false}]}};sc.ITEM_DESTRUCT_TYPE["Heat-Cactus-2"]={size:{x:16,y:16,z:22},effectOffset:{x:0,y:0,z:12},boom:{sheet:"puzzle.destructible",name:"small"},debris:{sheet:"area.heat",name:"plantBurst"},anims:{shapeType:"Y_FLAT",sheet:{src:"media/map/heat-area.png",width:24,height:32,offX:208,offY:352},SUB:[{name:"default",time:1,frames:[0],repeat:false},{name:"default",time:1,frames:[1],repeat:false},{name:"dropped",time:1,frames:[2],repeat:false}]}};sc.ITEM_DESTRUCT_TYPE["Heat-Cactus-Special"]=
{size:{x:16,y:16,z:22},effectOffset:{x:0,y:0,z:12},boom:{sheet:"puzzle.destructible",name:"small"},debris:{sheet:"area.heat",name:"plantBurst"},anims:{shapeType:"Y_FLAT",sheet:{src:"media/map/heat-area.png",width:24,height:32,offX:208,offY:384},SUB:[{name:"default",time:1,frames:[0],repeat:false},{name:"default",time:1,frames:[1],repeat:false},{name:"dropped",time:1,frames:[2],repeat:false}]}};sc.ITEM_DESTRUCT_TYPE["Heat-Dry-Cactus-1"]={size:{x:16,y:16,z:22},effectOffset:{x:0,y:0,z:12},boom:{sheet:"puzzle.destructible",
name:"small"},debris:{sheet:"area.heat",name:"plantBurst"},anims:{shapeType:"Y_FLAT",sheet:{src:"media/map/heat-props.png",width:24,height:32,offX:176,offY:128},SUB:[{name:"default",time:1,frames:[0],repeat:false},{name:"default",time:1,frames:[1],repeat:false},{name:"dropped",time:1,frames:[2],repeat:false}]}};sc.ITEM_DESTRUCT_TYPE["Heat-Dry-Cactus-2"]={size:{x:16,y:16,z:22},effectOffset:{x:0,y:0,z:12},boom:{sheet:"puzzle.destructible",name:"small"},debris:{sheet:"area.heat",name:"plantBurst"},anims:{shapeType:"Y_FLAT",
sheet:{src:"media/map/heat-props.png",width:24,height:32,offX:176,offY:160},SUB:[{name:"default",time:1,frames:[0],repeat:false},{name:"default",time:1,frames:[1],repeat:false},{name:"dropped",time:1,frames:[2],repeat:false}]}};sc.ITEM_DESTRUCT_TYPE["Heat-Palmapple-1"]={size:{x:16,y:16,z:22},effectOffset:{x:0,y:0,z:12},boom:{sheet:"puzzle.destructible",name:"small"},debris:{sheet:"area.heat",name:"plantBurst"},anims:{shapeType:"Y_FLAT",sheet:{src:"media/map/heat-area.png",width:24,height:32,offX:208,
offY:416},SUB:[{name:"default",time:1,frames:[0],repeat:false},{name:"default",time:1,frames:[1],repeat:false},{name:"dropped",time:1,frames:[2],repeat:false}]}};sc.ITEM_DESTRUCT_TYPE["Heat-Palmapple-2"]={size:{x:16,y:16,z:22},effectOffset:{x:0,y:0,z:12},boom:{sheet:"puzzle.destructible",name:"small"},debris:{sheet:"area.heat",name:"plantBurst"},anims:{shapeType:"Y_FLAT",sheet:{src:"media/map/heat-area.png",width:24,height:32,offX:208,offY:448},SUB:[{name:"default",time:1,frames:[0],repeat:false},
{name:"default",time:1,frames:[1],repeat:false},{name:"dropped",time:1,frames:[2],repeat:false}]}};sc.ITEM_DESTRUCT_TYPE["Heat-Palmapple-Special"]={size:{x:16,y:16,z:22},effectOffset:{x:0,y:0,z:12},boom:{sheet:"puzzle.destructible",name:"small"},debris:{sheet:"area.heat",name:"plantBurst"},anims:{shapeType:"Y_FLAT",sheet:{src:"media/map/heat-area.png",width:24,height:32,offX:208,offY:480},SUB:[{name:"default",time:1,frames:[0],repeat:false},{name:"default",time:1,frames:[1],repeat:false},{name:"dropped",
time:1,frames:[2],repeat:false}]}};sc.ITEM_DESTRUCT_TYPE["Heat-Dry-Bush-1"]={size:{x:16,y:16,z:22},effectOffset:{x:0,y:0,z:12},boom:{sheet:"puzzle.destructible",name:"small"},debris:{sheet:"area.heat",name:"plantBurstRed"},anims:{shapeType:"Y_FLAT",sheet:{src:"media/map/heat-area.png",width:24,height:32,offX:280,offY:320},SUB:[{name:"default",time:1,frames:[0],repeat:false},{name:"default",time:1,frames:[1],repeat:false},{name:"dropped",time:1,frames:[2],repeat:false}]}};sc.ITEM_DESTRUCT_TYPE["Heat-Dry-Bush-2"]=
{size:{x:16,y:16,z:22},effectOffset:{x:0,y:0,z:12},boom:{sheet:"puzzle.destructible",name:"small"},debris:{sheet:"area.heat",name:"plantBurstRed"},anims:{shapeType:"Y_FLAT",sheet:{src:"media/map/heat-area.png",width:24,height:32,offX:280,offY:352},SUB:[{name:"default",time:1,frames:[0],repeat:false},{name:"default",time:1,frames:[1],repeat:false},{name:"dropped",time:1,frames:[2],repeat:false}]}};sc.ITEM_DESTRUCT_TYPE["Heat-Dry-Bush-Special"]={size:{x:16,y:16,z:22},effectOffset:{x:0,y:0,z:12},boom:{sheet:"puzzle.destructible",
name:"small"},debris:{sheet:"area.heat",name:"plantBurstRed"},anims:{shapeType:"Y_FLAT",sheet:{src:"media/map/heat-area.png",width:24,height:32,offX:280,offY:384},SUB:[{name:"default",time:1,frames:[0],repeat:false},{name:"default",time:1,frames:[1],repeat:false},{name:"dropped",time:1,frames:[2],repeat:false}]}};sc.ITEM_DESTRUCT_TYPE["Heat-Bones-1"]={size:{x:16,y:16,z:22},effectOffset:{x:0,y:0,z:12},boom:{sheet:"puzzle.destructible",name:"small"},debris:{sheet:"area.heat",name:"boneBurst"},anims:{shapeType:"Y_FLAT",
sheet:{src:"media/map/heat-area.png",width:24,height:32,offX:208,offY:512},SUB:[{name:"default",time:1,frames:[0],repeat:false},{name:"default",time:1,frames:[1],repeat:false},{name:"dropped",time:1,frames:[2],repeat:false}]}};sc.ITEM_DESTRUCT_TYPE["Heat-Bones-2"]={size:{x:16,y:16,z:22},effectOffset:{x:0,y:0,z:12},boom:{sheet:"puzzle.destructible",name:"small"},debris:{sheet:"area.heat",name:"boneBurst"},anims:{shapeType:"Y_FLAT",sheet:{src:"media/map/heat-area.png",width:24,height:32,offX:208,offY:544},
SUB:[{name:"default",time:1,frames:[0],repeat:false},{name:"default",time:1,frames:[1],repeat:false},{name:"dropped",time:1,frames:[2],repeat:false}]}};sc.ITEM_DESTRUCT_TYPE["Heat-Bones-Special"]={size:{x:16,y:16,z:22},effectOffset:{x:0,y:0,z:12},boom:{sheet:"puzzle.destructible",name:"small"},debris:{sheet:"area.heat",name:"boneBurst"},anims:{shapeType:"Y_FLAT",sheet:{src:"media/map/heat-area.png",width:24,height:32,offX:280,offY:512},SUB:[{name:"default",time:1,frames:[0],repeat:false},{name:"default",
time:1,frames:[1],repeat:false},{name:"dropped",time:1,frames:[2],repeat:false}]}};sc.ITEM_DESTRUCT_TYPE["Heat-Hill-1"]={size:{x:16,y:16,z:22},effectOffset:{x:0,y:0,z:12},boom:{sheet:"puzzle.destructible",name:"small"},debris:{sheet:"area.heat",name:"termiteDust"},anims:{wallY:1,shapeType:"Y_FLAT",sheet:{src:"media/map/heat-area.png",width:24,height:32,offX:280,offY:416},SUB:[{name:"default",time:1,frames:[0],repeat:false},{name:"default",time:1,frames:[1],repeat:false},{name:"dropped",time:1,frames:[2],
repeat:false}]}};sc.ITEM_DESTRUCT_TYPE["Heat-Hill-2"]={size:{x:16,y:16,z:22},effectOffset:{x:0,y:0,z:12},boom:{sheet:"puzzle.destructible",name:"small"},debris:{sheet:"area.heat",name:"termiteDust"},anims:{wallY:1,shapeType:"Y_FLAT",sheet:{src:"media/map/heat-area.png",width:24,height:32,offX:280,offY:448},SUB:[{name:"default",time:1,frames:[0],repeat:false},{name:"default",time:1,frames:[1],repeat:false},{name:"dropped",time:1,frames:[2],repeat:false}]}};sc.ITEM_DESTRUCT_TYPE["Heat-Hill-Special"]=
{size:{x:16,y:16,z:22},effectOffset:{x:0,y:0,z:12},boom:{sheet:"puzzle.destructible",name:"small"},debris:{sheet:"area.heat",name:"termiteDust"},anims:{wallY:1,shapeType:"Y_FLAT",sheet:{src:"media/map/heat-area.png",width:24,height:32,offX:280,offY:480},SUB:[{name:"default",time:1,frames:[0],repeat:false},{name:"default",time:1,frames:[1],repeat:false},{name:"dropped",time:1,frames:[2],repeat:false}]}};sc.ITEM_DESTRUCT_TYPE["Bakii-Vase"]={size:{x:16,y:12,z:20},effectOffset:{x:0,y:0,z:9},boom:{sheet:"puzzle.destructible",
name:"small"},debris:{sheet:"area.heat",name:"vase-break"},anims:{shapeType:"Y_FLAT",sheet:{src:"media/map/heat-area.png",width:16,height:32,offX:464,offY:320},SUB:[{name:"default",time:1,frames:[0],repeat:false},{name:"default",time:1,frames:[1],repeat:false},{name:"dropped",time:1,frames:[2],repeat:false}]}};sc.ITEM_DESTRUCT_TYPE["Jungle-Flower-1"]={size:{x:16,y:16,z:22},effectOffset:{x:0,y:0,z:12},boom:{sheet:"puzzle.destructible",name:"small"},debris:{sheet:"area.jungle",name:"plantBurstViolet"},
anims:{shapeType:"Y_FLAT",sheet:{src:"media/map/jungle-props.png",width:24,height:32,offX:0,offY:224},SUB:[{name:"default",time:1,frames:[0],repeat:false},{name:"default",time:1,frames:[1],repeat:false},{name:"dropped",time:1,frames:[2],repeat:false}]}};sc.ITEM_DESTRUCT_TYPE["Jungle-Flower-2"]={size:{x:16,y:16,z:22},effectOffset:{x:0,y:0,z:12},boom:{sheet:"puzzle.destructible",name:"small"},debris:{sheet:"area.jungle",name:"plantBurstViolet"},anims:{shapeType:"Y_FLAT",sheet:{src:"media/map/jungle-props.png",
width:24,height:32,offX:0,offY:256},SUB:[{name:"default",time:1,frames:[0],repeat:false},{name:"default",time:1,frames:[1],repeat:false},{name:"dropped",time:1,frames:[2],repeat:false}]}};sc.ITEM_DESTRUCT_TYPE["Jungle-Flower-Special"]={size:{x:16,y:16,z:22},effectOffset:{x:0,y:0,z:12},boom:{sheet:"puzzle.destructible",name:"small"},debris:{sheet:"area.jungle",name:"plantBurstViolet"},anims:{shapeType:"Y_FLAT",sheet:{src:"media/map/jungle-props.png",width:24,height:32,offX:0,offY:288},SUB:[{name:"default",
time:1,frames:[0],repeat:false},{name:"default",time:1,frames:[1],repeat:false},{name:"dropped",time:1,frames:[2],repeat:false}]}};sc.ITEM_DESTRUCT_TYPE["Jungle-Bees-1"]={size:{x:16,y:16,z:22},effectOffset:{x:0,y:0,z:12},boom:{sheet:"puzzle.destructible",name:"small"},debris:{sheet:"area.jungle",name:"honeyBurst"},gravity:0,anims:{shapeType:"Y_FLAT",sheet:{src:"media/map/jungle-props.png",width:24,height:32,offX:0,offY:320},SUB:[{name:"default",time:1,frames:[0],repeat:false},{name:"default",time:1,
frames:[1],repeat:false},{name:"dropped",time:1,frames:[2],repeat:false}]}};sc.ITEM_DESTRUCT_TYPE["Jungle-Bees-2"]={size:{x:16,y:16,z:22},effectOffset:{x:0,y:0,z:12},boom:{sheet:"puzzle.destructible",name:"small"},debris:{sheet:"area.jungle",name:"honeyBurst"},gravity:0,anims:{shapeType:"Y_FLAT",sheet:{src:"media/map/jungle-props.png",width:24,height:32,offX:0,offY:352},SUB:[{name:"default",time:1,frames:[0],repeat:false},{name:"default",time:1,frames:[1],repeat:false},{name:"dropped",time:1,frames:[2],
repeat:false}]}};sc.ITEM_DESTRUCT_TYPE["Jungle-Bees-3"]={size:{x:16,y:16,z:22},effectOffset:{x:0,y:0,z:12},boom:{sheet:"puzzle.destructible",name:"small"},debris:{sheet:"area.jungle",name:"honeyBurst"},gravity:0,anims:{shapeType:"Y_FLAT",sheet:{src:"media/map/jungle-props.png",width:24,height:32,offX:0,offY:352},flipX:true,SUB:[{name:"default",time:1,frames:[0],repeat:false},{name:"default",time:1,frames:[1],repeat:false},{name:"dropped",time:1,frames:[2],repeat:false}]}};sc.ITEM_DESTRUCT_TYPE["Jungle-Waterplant-1"]=
{size:{x:16,y:16,z:22},effectOffset:{x:0,y:0,z:12},boom:{sheet:"puzzle.destructible",name:"small"},debris:{sheet:"area.jungle",name:"plantBurstWater"},anims:{shapeType:"Y_FLAT",sheet:{src:"media/map/jungle-props.png",width:24,height:32,offX:72,offY:224},SUB:[{name:"default",time:1,frames:[0],repeat:false},{name:"default",time:1,frames:[1],repeat:false},{name:"dropped",time:1,frames:[2],repeat:false}]}};sc.ITEM_DESTRUCT_TYPE["Jungle-Waterplant-2"]={size:{x:16,y:16,z:22},effectOffset:{x:0,y:0,z:12},
boom:{sheet:"puzzle.destructible",name:"small"},debris:{sheet:"area.jungle",name:"plantBurstWater"},anims:{shapeType:"Y_FLAT",sheet:{src:"media/map/jungle-props.png",width:24,height:32,offX:72,offY:256},SUB:[{name:"default",time:1,frames:[0],repeat:false},{name:"default",time:1,frames:[1],repeat:false},{name:"dropped",time:1,frames:[2],repeat:false}]}};sc.ITEM_DESTRUCT_TYPE["Jungle-Waterplant-Special"]={size:{x:16,y:16,z:22},effectOffset:{x:0,y:0,z:12},boom:{sheet:"puzzle.destructible",name:"small"},
debris:{sheet:"area.jungle",name:"plantBurstWater"},anims:{shapeType:"Y_FLAT",sheet:{src:"media/map/jungle-props.png",width:24,height:32,offX:72,offY:288},SUB:[{name:"default",time:1,frames:[0],repeat:false},{name:"default",time:1,frames:[1],repeat:false},{name:"dropped",time:1,frames:[2],repeat:false}]}};sc.ITEM_DESTRUCT_TYPE["Jungle-Waterplant-Closed-1"]={size:{x:16,y:16,z:22},effectOffset:{x:0,y:0,z:12},boom:{sheet:"puzzle.destructible",name:"small"},debris:{sheet:"area.jungle",name:"plantBurstWater"},
anims:{shapeType:"Y_FLAT",sheet:{src:"media/map/jungle-props.png",width:24,height:32,offX:0,offY:384},SUB:[{name:"default",time:1,frames:[0],repeat:false},{name:"default",time:1,frames:[1],repeat:false},{name:"dropped",time:1,frames:[2],repeat:false}]}};sc.ITEM_DESTRUCT_TYPE["Jungle-Waterplant-Closed-2"]={size:{x:16,y:16,z:22},effectOffset:{x:0,y:0,z:12},boom:{sheet:"puzzle.destructible",name:"small"},debris:{sheet:"area.jungle",name:"plantBurstWater"},anims:{shapeType:"Y_FLAT",sheet:{src:"media/map/jungle-props.png",
width:24,height:32,offX:0,offY:416},SUB:[{name:"default",time:1,frames:[0],repeat:false},{name:"default",time:1,frames:[1],repeat:false},{name:"dropped",time:1,frames:[2],repeat:false}]}};sc.ITEM_DESTRUCT_TYPE["Jungle-Shroom-1"]={size:{x:16,y:16,z:22},effectOffset:{x:0,y:0,z:12},boom:{sheet:"puzzle.destructible",name:"small"},debris:{sheet:"area.jungle",name:"shroomBurst"},anims:{shapeType:"Y_FLAT",sheet:{src:"media/map/jungle-props.png",width:24,height:32,offX:72,offY:320},SUB:[{name:"default",time:1,
frames:[0],repeat:false},{name:"default",time:1,frames:[1],repeat:false},{name:"dropped",time:1,frames:[2],repeat:false}]}};sc.ITEM_DESTRUCT_TYPE["Jungle-Shroom-2"]={size:{x:16,y:16,z:22},effectOffset:{x:0,y:0,z:12},boom:{sheet:"puzzle.destructible",name:"small"},debris:{sheet:"area.jungle",name:"shroomBurst"},anims:{shapeType:"Y_FLAT",sheet:{src:"media/map/jungle-props.png",width:24,height:32,offX:72,offY:352},SUB:[{name:"default",time:1,frames:[0],repeat:false},{name:"default",time:1,frames:[1],
repeat:false},{name:"dropped",time:1,frames:[2],repeat:false}]}};sc.ITEM_DESTRUCT_TYPE["Jungle-Shroom-Special"]={size:{x:16,y:16,z:22},effectOffset:{x:0,y:0,z:12},boom:{sheet:"puzzle.destructible",name:"small"},debris:{sheet:"area.jungle",name:"shroomBurst"},anims:{shapeType:"Y_FLAT",sheet:{src:"media/map/jungle-props.png",width:24,height:32,offX:72,offY:384},SUB:[{name:"default",time:1,frames:[0],repeat:false},{name:"default",time:1,frames:[1],repeat:false},{name:"dropped",time:1,frames:[2],repeat:false}]}};
sc.ITEM_DESTRUCT_TYPE["Jungle-Flower-Dotted-1"]={size:{x:16,y:16,z:22},effectOffset:{x:0,y:0,z:12},boom:{sheet:"puzzle.destructible",name:"small"},debris:{sheet:"area.jungle",name:"plantBurstViolet"},anims:{shapeType:"Y_FLAT",sheet:{src:"media/map/jungle-props.png",width:24,height:32,offX:72,offY:416},SUB:[{name:"default",time:1,frames:[0],repeat:false},{name:"default",time:1,frames:[1],repeat:false},{name:"dropped",time:1,frames:[2],repeat:false}]}};sc.ITEM_DESTRUCT_TYPE["Jungle-Flower-Dotted-2"]=
{size:{x:16,y:16,z:22},effectOffset:{x:0,y:0,z:12},boom:{sheet:"puzzle.destructible",name:"small"},debris:{sheet:"area.jungle",name:"plantBurstViolet"},anims:{shapeType:"Y_FLAT",sheet:{src:"media/map/jungle-props.png",width:24,height:32,offX:72,offY:448},SUB:[{name:"default",time:1,frames:[0],repeat:false},{name:"default",time:1,frames:[1],repeat:false},{name:"dropped",time:1,frames:[2],repeat:false}]}};sc.ITEM_DESTRUCT_TYPE["Jungle-Flower-Dotted-Special"]={size:{x:16,y:16,z:22},effectOffset:{x:0,
y:0,z:12},boom:{sheet:"puzzle.destructible",name:"small"},debris:{sheet:"area.jungle",name:"plantBurstViolet"},anims:{shapeType:"Y_FLAT",sheet:{src:"media/map/jungle-props.png",width:24,height:32,offX:72,offY:480},SUB:[{name:"default",time:1,frames:[0],repeat:false},{name:"default",time:1,frames:[1],repeat:false},{name:"dropped",time:1,frames:[2],repeat:false}]}};sc.ITEM_DESTRUCT_TYPE["Sapphire-Bush-1"]={size:{x:16,y:16,z:22},effectOffset:{x:0,y:0,z:12},boom:{sheet:"puzzle.destructible",name:"small"},
debris:{sheet:"area.forest",name:"plantBurst"},anims:{shapeType:"Y_FLAT",sheet:{src:"media/map/forest.png",width:24,height:32,offX:0,offY:704},SUB:[{name:"default",time:1,frames:[0],repeat:false},{name:"default",time:1,frames:[1],repeat:false},{name:"dropped",time:1,frames:[2],repeat:false,shapeType:"Z_FLAT"}]}};sc.ITEM_DESTRUCT_TYPE["Sapphire-Bush-2"]={size:{x:16,y:16,z:22},effectOffset:{x:0,y:0,z:12},boom:{sheet:"puzzle.destructible",name:"small"},debris:{sheet:"area.forest",name:"plantBurst"},
anims:{shapeType:"Y_FLAT",sheet:{src:"media/map/forest.png",width:24,height:32,offX:0,offY:736},SUB:[{name:"default",time:1,frames:[0],repeat:false},{name:"default",time:1,frames:[1],repeat:false},{name:"dropped",time:1,frames:[2],repeat:false,shapeType:"Z_FLAT"}]}};sc.ITEM_DESTRUCT_TYPE["Sapphire-Bush-Special"]={size:{x:16,y:16,z:22},effectOffset:{x:0,y:0,z:12},boom:{sheet:"puzzle.destructible",name:"small"},debris:{sheet:"area.forest",name:"plantBurst"},anims:{shapeType:"Y_FLAT",sheet:{src:"media/map/forest.png",
width:24,height:32,offX:0,offY:768},SUB:[{name:"default",time:1,frames:[0],repeat:false},{name:"default",time:1,frames:[1],repeat:false},{name:"dropped",time:1,frames:[2],repeat:false,shapeType:"Z_FLAT"}]}};sc.ITEM_DESTRUCT_TYPE["Sapphire-Bamboo-1"]={size:{x:16,y:16,z:22},effectOffset:{x:0,y:0,z:12},boom:{sheet:"puzzle.destructible",name:"small"},debris:{sheet:"area.forest",name:"bambooBurst"},anims:{shapeType:"Y_FLAT",sheet:{src:"media/map/forest.png",width:24,height:32,offX:72,offY:704},SUB:[{name:"default",
time:1,frames:[0],repeat:false},{name:"default",time:1,frames:[1],repeat:false},{name:"dropped",time:1,frames:[2],repeat:false,shapeType:"Z_FLAT"}]}};sc.ITEM_DESTRUCT_TYPE["Sapphire-Bamboo-2"]={size:{x:16,y:16,z:22},effectOffset:{x:0,y:0,z:12},boom:{sheet:"puzzle.destructible",name:"small"},debris:{sheet:"area.forest",name:"bambooBurst"},anims:{shapeType:"Y_FLAT",sheet:{src:"media/map/forest.png",width:24,height:32,offX:72,offY:736},SUB:[{name:"default",time:1,frames:[0],repeat:false},{name:"default",
time:1,frames:[1],repeat:false},{name:"dropped",time:1,frames:[2],repeat:false,shapeType:"Z_FLAT"}]}};sc.ITEM_DESTRUCT_TYPE["Sapphire-Bamboo-Special"]={size:{x:16,y:16,z:22},effectOffset:{x:0,y:0,z:12},boom:{sheet:"puzzle.destructible",name:"small"},debris:{sheet:"area.forest",name:"bambooBurst"},anims:{shapeType:"Y_FLAT",sheet:{src:"media/map/forest.png",width:24,height:32,offX:72,offY:768},SUB:[{name:"default",time:1,frames:[0],repeat:false},{name:"default",time:1,frames:[1],repeat:false},{name:"dropped",
time:1,frames:[2],repeat:false,shapeType:"Z_FLAT"}]}};sc.ITEM_DESTRUCT_TYPE["Sapphire-Cobalt-1"]={size:{x:16,y:16,z:22},effectOffset:{x:0,y:0,z:8},boom:{sheet:"puzzle.destructible",name:"small"},debris:{sheet:"area.cave-cobalt",name:"cobaltBurst"},anims:{shapeType:"Y_FLAT",sheet:{src:"media/map/cave-cobalt.png",width:24,height:32,offX:0,offY:0},SUB:[{name:"default",time:1,frames:[0],repeat:false},{name:"default",time:1,frames:[1],repeat:false},{name:"dropped",time:1,frames:[2],repeat:false,shapeType:"Z_FLAT"}]}};
sc.ITEM_DESTRUCT_TYPE["Sapphire-Cobalt-2"]={size:{x:16,y:16,z:22},effectOffset:{x:0,y:0,z:8},boom:{sheet:"puzzle.destructible",name:"small"},debris:{sheet:"area.cave-cobalt",name:"cobaltBurst"},anims:{shapeType:"Y_FLAT",sheet:{src:"media/map/cave-cobalt.png",width:24,height:32,offX:0,offY:32},SUB:[{name:"default",time:1,frames:[0],repeat:false},{name:"default",time:1,frames:[1],repeat:false},{name:"dropped",time:1,frames:[2],repeat:false,shapeType:"Z_FLAT"}]}};sc.ITEM_DESTRUCT_TYPE["Sapphire-Cobalt-Special"]=
{size:{x:16,y:16,z:22},effectOffset:{x:0,y:0,z:8},boom:{sheet:"puzzle.destructible",name:"small"},debris:{sheet:"area.cave-cobalt",name:"cobaltBurst"},anims:{shapeType:"Y_FLAT",sheet:{src:"media/map/cave-cobalt.png",width:24,height:32,offX:0,offY:64},SUB:[{name:"default",time:1,frames:[0],repeat:false},{name:"default",time:1,frames:[1],repeat:false},{name:"dropped",time:1,frames:[2],repeat:false,shapeType:"Z_FLAT"}]}};sc.ITEM_DESTRUCT_TYPE.TrashBag1={size:{x:32,y:16,z:16},effectOffset:{x:0,y:0,z:8},
boom:{sheet:"puzzle.destructible",name:"small"},debris:{sheet:"area.jungle",name:"trashBag"},anims:{shapeType:"Y_FLAT",sheet:{src:"media/map/jungle-props.png",width:32,height:32,offX:352,offY:528},SUB:[{name:"default",time:1,frames:[0],repeat:false},{name:"default",time:1,frames:[1],repeat:false},{name:"dropped",time:1,frames:[2],repeat:false,shapeType:"Z_FLAT"}]}};sc.ITEM_DESTRUCT_TYPE.TrashBag2={size:{x:32,y:16,z:16},effectOffset:{x:0,y:0,z:8},boom:{sheet:"puzzle.destructible",name:"small"},debris:{sheet:"area.jungle",
name:"trashBag"},anims:{shapeType:"Y_FLAT",sheet:{src:"media/map/jungle-props.png",width:32,height:32,offX:352,offY:560},SUB:[{name:"default",time:1,frames:[0],repeat:false},{name:"default",time:1,frames:[1],repeat:false},{name:"dropped",time:1,frames:[2],repeat:false,shapeType:"Z_FLAT"}]}};sc.ITEM_DESTRUCT_TYPE.TrashBag3={size:{x:32,y:16,z:24},effectOffset:{x:0,y:0,z:8},boom:{sheet:"puzzle.destructible",name:"small"},debris:{sheet:"area.jungle",name:"trashBag"},anims:{shapeType:"Y_FLAT",sheet:{src:"media/map/jungle-props.png",
width:32,height:40,offX:352,offY:592},SUB:[{name:"default",time:1,frames:[0],repeat:false},{name:"default",time:1,frames:[1],repeat:false},{name:"dropped",time:1,frames:[2],repeat:false,shapeType:"Z_FLAT"}]}};sc.ITEM_DESTRUCT_TYPE.TrashBag4={size:{x:32,y:16,z:24},effectOffset:{x:0,y:0,z:8},boom:{sheet:"puzzle.destructible",name:"small"},debris:{sheet:"area.jungle",name:"trashBag"},anims:{shapeType:"Y_FLAT",sheet:{src:"media/map/jungle-props.png",width:32,height:40,offX:352,offY:632},SUB:[{name:"default",
time:1,frames:[0],repeat:false},{name:"default",time:1,frames:[1],repeat:false},{name:"dropped",time:1,frames:[2],repeat:false,shapeType:"Z_FLAT"}]}};sc.ITEM_DESTRUCT_TYPE["Final-Cone-1"]={size:{x:24,y:20,z:22},effectOffset:{x:0,y:0,z:12},boom:{sheet:"puzzle.destructible",name:"small"},debris:{sheet:"area.final",name:"plantBurst"},anims:{shapeType:"Y_FLAT",sheet:{src:"media/map/final-dungeon-outer-props.png",width:48,height:32,offX:0,offY:128},SUB:[{name:"default",time:1,frames:[0],repeat:false},
{name:"default",time:1,frames:[1],repeat:false},{name:"dropped",time:1,frames:[2],repeat:false,shapeType:"Z_FLAT"}]}};sc.ITEM_DESTRUCT_TYPE["Final-Cone-2"]={size:{x:26,y:20,z:22},effectOffset:{x:0,y:0,z:12},boom:{sheet:"puzzle.destructible",name:"small"},debris:{sheet:"area.final",name:"plantBurst"},anims:{shapeType:"Y_FLAT",sheet:{src:"media/map/final-dungeon-outer-props.png",width:48,height:40,offX:0,offY:160},SUB:[{name:"default",time:1,frames:[0],repeat:false},{name:"default",time:1,frames:[1],
repeat:false},{name:"dropped",time:1,frames:[2],repeat:false,shapeType:"Z_FLAT"}]}};sc.ITEM_DESTRUCT_TYPE["Final-Cone-3"]={size:{x:24,y:20,z:22},effectOffset:{x:0,y:0,z:12},boom:{sheet:"puzzle.destructible",name:"small"},debris:{sheet:"area.final",name:"plantBurstPink"},anims:{shapeType:"Y_FLAT",sheet:{src:"media/map/final-dungeon-outer-props.png",width:40,height:32,offX:0,offY:200},SUB:[{name:"default",time:1,frames:[0],repeat:false},{name:"default",time:1,frames:[1],repeat:false},{name:"dropped",
time:1,frames:[2],repeat:false,shapeType:"Z_FLAT"}]}};sc.ITEM_DESTRUCT_TYPE["Final-Cone-4"]={size:{x:24,y:20,z:28},effectOffset:{x:0,y:0,z:12},boom:{sheet:"puzzle.destructible",name:"small"},debris:{sheet:"area.final",name:"plantBurstPink"},anims:{shapeType:"Y_FLAT",sheet:{src:"media/map/final-dungeon-outer-props.png",width:40,height:48,offX:0,offY:230},SUB:[{name:"default",time:1,frames:[0],repeat:false},{name:"default",time:1,frames:[1],repeat:false},{name:"dropped",time:1,frames:[2],repeat:false,
shapeType:"Z_FLAT"}]}};sc.ITEM_DESTRUCT_TYPE["Final-Shard"]={size:{x:24,y:20,z:28},effectOffset:{x:0,y:0,z:12},boom:{sheet:"puzzle.destructible",name:"small"},debris:{sheet:"area.final",name:"crystalBurst"},anims:{shapeType:"Y_FLAT",sheet:{src:"media/map/final-dungeon-outer-props.png",width:32,height:48,offX:152,offY:440},SUB:[{name:"default",time:1,frames:[0],repeat:false},{name:"default",time:1,frames:[1],repeat:false},{name:"dropped",time:1,frames:[2],repeat:false,shapeType:"Z_FLAT"}]}};sc.ITEM_DESTRUCT_TYPE["Beach-Coral-1"]=
{size:{x:24,y:16,z:22},effectOffset:{x:0,y:0,z:12},boom:{sheet:"puzzle.destructible",name:"small"},debris:{sheet:"area.beach",name:"plantBurstPink"},anims:{shapeType:"Y_FLAT",sheet:{src:"media/map/beach-props.png",width:24,height:32,offX:0,offY:0},SUB:[{name:"default",time:1,frames:[0],repeat:false},{name:"default",time:1,frames:[1],repeat:false},{name:"dropped",time:1,frames:[2],repeat:false,wallY:1}]}};sc.ITEM_DESTRUCT_TYPE["Beach-Coral-2"]={size:{x:24,y:16,z:22},effectOffset:{x:0,y:0,z:12},boom:{sheet:"puzzle.destructible",
name:"small"},debris:{sheet:"area.beach",name:"plantBurstViolet"},anims:{shapeType:"Y_FLAT",sheet:{src:"media/map/beach-props.png",width:24,height:32,offX:0,offY:32},SUB:[{name:"default",time:1,frames:[0],repeat:false},{name:"default",time:1,frames:[1],repeat:false},{name:"dropped",time:1,frames:[2],repeat:false,wallY:1}]}};sc.ITEM_DESTRUCT_TYPE["Beach-Grey-1"]={size:{x:24,y:16,z:22},effectOffset:{x:0,y:0,z:12},boom:{sheet:"puzzle.destructible",name:"small"},debris:{sheet:"area.beach",name:"plantBurstGrey"},
anims:{shapeType:"Y_FLAT",sheet:{src:"media/map/beach-props.png",width:24,height:32,offX:0,offY:64},SUB:[{name:"default",time:1,frames:[0],repeat:false},{name:"default",time:1,frames:[1],repeat:false},{name:"dropped",time:1,frames:[2],repeat:false,wallY:1}]}};sc.ITEM_DESTRUCT_TYPE["Beach-Grey-2"]={size:{x:24,y:16,z:22},effectOffset:{x:0,y:0,z:12},boom:{sheet:"puzzle.destructible",name:"small"},debris:{sheet:"area.beach",name:"plantBurstGrey"},anims:{shapeType:"Y_FLAT",sheet:{src:"media/map/beach-props.png",
width:24,height:32,offX:0,offY:96},SUB:[{name:"default",time:1,frames:[0],repeat:false},{name:"default",time:1,frames:[1],repeat:false},{name:"dropped",time:1,frames:[2],repeat:false,wallY:1}]}};sc.ITEM_DESTRUCT_TYPE["Beach-Green-1"]={size:{x:24,y:16,z:22},effectOffset:{x:0,y:0,z:12},boom:{sheet:"puzzle.destructible",name:"small"},debris:{sheet:"area.beach",name:"plantBurstGreen"},anims:{shapeType:"Y_FLAT",sheet:{src:"media/map/beach-props.png",width:24,height:32,offX:0,offY:128},SUB:[{name:"default",
time:1,frames:[0],repeat:false},{name:"default",time:1,frames:[1],repeat:false},{name:"dropped",time:1,frames:[2],repeat:false,wallY:1}]}};sc.ITEM_DESTRUCT_TYPE["Beach-Green-2"]={size:{x:24,y:16,z:22},effectOffset:{x:0,y:0,z:12},boom:{sheet:"puzzle.destructible",name:"small"},debris:{sheet:"area.beach",name:"plantBurstBlue"},anims:{shapeType:"Y_FLAT",sheet:{src:"media/map/beach-props.png",width:24,height:32,offX:0,offY:160},SUB:[{name:"default",time:1,frames:[0],repeat:false},{name:"default",time:1,
frames:[1],repeat:false},{name:"dropped",time:1,frames:[2],repeat:false,wallY:1}]}}});ig.baked=!0;
ig.module("game.feature.puzzle.entities.regen-destruct").requires("impact.base.entity","impact.feature.effect.effect-sheet").defines(function(){sc.REGEN_DESTRUCT_TYPE={};var b=Vec2.create();ig.ENTITY.RegenDestruct=ig.AnimatedEntity.extend({hitSide:null,conditionFunction:null,effects:{base:new ig.EffectSheet("puzzle.destructible"),boom:null,debris:null,regen:null,hide:null,boomHandle:null,regenHandle:null,hideHandle:null},blockNavMap:false,navBlocker:null,blinkTimer:0,regenMaxTime:0,regenTimer:0,collType:null,
collideCallback:null,zHeight:0,onDestroyIncrease:null,_wm:new ig.Config({spawnable:true,attributes:{desType:{_type:"String",_info:"Type of regen destructible object",_select:sc.REGEN_DESTRUCT_TYPE,_withNull:true},spawnCondition:{_type:"VarCondition",_info:"Condition for destructible to spawn",_popup:true},activeCondition:{_type:"VarCondition",_info:"Condition for destructible to be active. Otherwise is always 'destroyed'",_popup:true},onDestroyIncrease:{_type:"VarName",_info:"Variable to increase when destroyed'",
_optional:true},blockNavMap:{_type:"Boolean",_info:"If true, block path map and update when destroyed"},regenTime:{_type:"Number",_info:"Time in seconds for destruct to regenerate",_default:1}}}),init:function(a,b,e,f){this.parent(a,b,e,f);this.coll.type=ig.COLLTYPE.BLOCK;this.coll.zGravityFactor=1;this.coll.zBounciness=0.5;this.desTypeName=f.desType;b=ig.mapStyle.get("effect");if(a=ig.copy(sc.REGEN_DESTRUCT_TYPE[f.desType])){this.coll.size=a.size;this.zHeight=a.size.z;this.collType=a.collType||ig.COLLTYPE.BLOCK;
this.coll.setType(this.collType);this.coll.shadow.size=a.shadow||0;if(a.zGravityFactor!==void 0)this.coll.zGravityFactor=a.zGravityFactor;this.hitSide=a.hitSide||[1,1,1,1];this.hitSound=a.hitSound;this.conditionFunction=a.hitCondition;this.noBlinking=a.noBlinking||false;this.collideCallback=a.onCollision||null;this.terrain=a.terrain||null;if(a.debris){e=ig.copy(a.debris);if(!e.sheet)e.sheet=b.sheet;this.effects.debris=new ig.EffectHandle(e)}if(a.boom)this.effects.boom=new ig.EffectHandle(a.boom);
if(a.regen)this.effects.regen=new ig.EffectHandle(a.regen);if(a.hide)this.effects.hide=new ig.EffectHandle(a.hide);b=ig.mapStyle.get("destruct");e=a.anims;if(b)if(e.namedSheets)for(var g in a.anims.namedSheets){if(!e.namedSheets[g].src)e.namedSheets[g].src=b.sheet}else if(!e.sheet.src)e.sheet.src=b.sheet;this.initAnimations(e);this.setCurrentAnim("default")}else{this.coll.size.x=32;this.coll.size.y=32}this.onDestroyIncrease=f.onDestroyIncrease;this.blockNavMap=f.blockNavMap;this.blinkTimer=Math.random()*
5+1;this.regenMaxTime=f.regenTime;this.activeCondition=new ig.VarCondition(f.activeCondition)},show:function(a){this.parent(a);this.coll.setType(this.collType);if(this.effects.hideHandle){this.effects.hideHandle.stop();this.effects.hideHandle=null}if(!a){this.animState.alpha=0;ig.game.effects.teleport.spawnOnTarget("showFast",this,{})}if(this.blockNavMap)this.navBlocker=ig.navigation.getNavBlock(this);this.activeCondition.evaluate()||this.destroy(true,true)},onHideRequest:function(){if(this.navBlocker){this.navBlocker.remove();
this.navBlocker=null}this.coll.setType(ig.COLLTYPE.IGNORE);this.effects.hide?this.effects.hideHandle=this.effects.hide.spawnOnTarget(this,{callback:this}):this.hide()},onKill:function(a){this.parent(a);this.navBlocker&&this.navBlocker.remove();this.effects.debris&&this.effects.debris.clearCached();this.effects.boom&&this.effects.boom.clearCached();this.effects.regen&&this.effects.regen.clearCached();this.effects.hide&&this.effects.hide.clearCached()},startRegen:function(){this.setCurrentAnim("cut",
true);if(this.regenMaxTime)this.regenTimer=this.regenMaxTime/sc.options.get("assist-puzzle-speed");else if(!this.regenerate())this.regenTimer=1E-5},isActive:function(){return this.activeCondition.evaluate()&&!this.regenTimer},regenerate:function(){for(var a=ig.game.getEntitiesOnTop(this),b=a.length;b--;){if(a[b]instanceof ig.ENTITY.SlidingBlock)return false;this.collType!=ig.COLLTYPE.BLOCK&&a[b].doQuickRespawn&&a[b].doQuickRespawn()}this.coll.setType(this.collType);this.coll.size.z=this.zHeight;this.onDestroyIncrease&&
ig.vars.sub(this.onDestroyIncrease,1);if(this.animSheet.hasAnimation("transition")){this.setCurrentAnim("transition",true);this.effects.regenHandle=this.effects.regen.spawnOnTarget(this,{align:"CENTER",spriteFilter:[1],callback:this})}else{if(this.effects.regen)this.effects.regenHandle=this.effects.regen.spawnOnTarget(this,{align:"CENTER",callback:this});this.setCurrentAnim("regen",true,"default")}return true},regenComplete:function(){this.setCurrentAnim("default",true);this.blinkTimer=Math.random()*
5+1;if(this.sprites.length>1){var a=this.sprites[1];a.setGfxCut(a.size.y+a.size.x,0)}},update:function(){if(this.regenTimer&&!this.effects.hideHandle)if(this.activeCondition.evaluate()){this.regenTimer=this.regenTimer-ig.system.tick;if(this.regenTimer<=0){this.regenTimer=0;if(!this.regenerate())this.regenTimer=1E-5}}else this.regenTimer=1E-5;else if(!this.effects.regenHandle&&!this.effects.boomHandle&&!this.effects.hideHandle){if(this.blinkTimer<=0)this.blinkTimer=Math.random()*2+4;this.blinkTimer=
this.blinkTimer-ig.system.tick;if(!this.noBlinking&&this.sprites.length>1){var a=this.sprites[1],b=a.size.y+a.size.z,e=b,f=0;if(this.blinkTimer<1){e=Math.round((this.blinkTimer-0.08)/0.92*b);e<0&&(e=0);f=Math.round((1-this.blinkTimer/0.92)*b);f<0&&(f=0)}a.setGfxCut(e,f)}}this.parent()},onEffectEvent:function(a){if(a==this.effects.hideHandle){if(a.isDone()){this.effects.hideHandle=null;this.hide()}}else if(a==this.effects.regenHandle){if(this.effects.regenHandle.isDone()){this.effects.regenHandle=
null;this.regenComplete()}}else if(a==this.effects.boomHandle&&this.effects.boomHandle.isDone()){this.effects.boomHandle=null;this.startRegen()}},ballHit:function(a){if(this.regenTimer||(this.effects.boomHandle||this.effects.hideHandle)||!ig.EntityTools.isInScreen(this,40))return false;var c=a.getCollideSide(this,b),e=a.attackInfo&&a.attackInfo.hasHint("CHARGED")?sc.ATTACK_TYPE.MEDIUM:sc.ATTACK_TYPE.LIGHT,f=a.getHitCenter(this);if(!this.hitSide[c]||this.conditionFunction&&!this.conditionFunction(a,
this)){if(!this.hitSide[c]){this.effects.base.spawnOnTarget("shieldBlink",this,{spriteFilter:[2]});ig.SoundHelper.playAtEntity(this.sounds.block,this)}return false}e=sc.ATTACK_TYPE.MASSIVE;sc.combat.showHitEffect(this,f,e,a.getElement(),false,false,true);if(this.effects.regenHandle){this.effects.regenHandle.stop();this.effects.regenHandle=null}this.destroy();return true},destroy:function(a,b){if(!this.regenTimer&&!this.effects.boomHandle){this.hitCount=0;if(this.effects.regenHandle){this.effects.regenHandle.stop();
this.effects.regenHandle=null}this.onDestroyIncrease&&ig.vars.add(this.onDestroyIncrease,1);var e=this.getCenter();this.coll.setType(ig.COLLTYPE.BLOCK);this.coll.size.z=0;if(b)this.startRegen();else if(this.animSheet.hasAnimation("transition")&&this.effects.boom){this.setCurrentAnim("transition",true);this.effects.boomHandle=this.effects.boom.spawnFixed(e.x,e.y,this.coll.pos.z+this.coll.size.z/2,this,{spriteFilter:[1],callback:this});this.throwDebris()}else{!a&&this.effects.boom&&this.effects.boom.spawnFixed(e.x,
e.y,this.coll.pos.z+this.coll.size.z/2,this);this.setCurrentAnim("destroy",true,"cut");this.throwDebris();this.startRegen()}this.sprites.length>1&&this.sprites[1].setGfxCut(0,0)}},varsChanged:function(){this._hidden||this.coll.size.z>0&&!this.activeCondition.evaluate()&&this.destroy(true)},collideWith:function(a,b){this.coll.size.z>0&&this.collideCallback&&this.collideCallback(a,b,this)},throwDebris:function(){var a=this.getCenter();this.effects.debris&&this.effects.debris.spawnFixed(a.x,a.y,this.coll.pos.z,
null,{angle:this.debrisAngle})},isBallDestroyer:function(a,b){if(this.coll.type!=ig.COLLTYPE.BLOCK)return false;var e=b.dir,e=Math.abs(e.x)>Math.abs(e.y)?ig.ActorEntity.FACE4[e.x>0?"WEST":"EAST"]:ig.ActorEntity.FACE4[e.y>0?"NORTH":"SOUTH"];return this.hitSide[e]}});sc.REGEN_DESTRUCT_TYPE.iceBlock={size:{x:24,y:24,z:24},boom:{sheet:"puzzle.destructible",name:"iceBlockBoomQuick"},regen:{sheet:"puzzle.destructible",name:"iceBlockRegen"},terrain:ig.TERRAIN.ICE,hitCondition:function(a){return a.attackInfo&&
a.attackInfo.element==sc.ELEMENT.HEAT},anims:{namedSheets:{fullIce:{src:null,width:24,height:48,offX:96,offY:96},bottomIce:{src:null,width:24,height:24,offX:144,offY:96}},SUB:[{sheet:"bottomIce",shapeType:"Z_FLAT",frames:[0],repeat:false,SUB:[{name:"cut"},{name:"transition"}]},{shapeType:"Z_EXPAND",sheet:"fullIce",SUB:[{name:"default",time:1,frames:[0],repeat:false},{name:"default",time:1,frames:[1],repeat:false,aboveZ:1},{name:"transition",time:1,frames:[0],repeat:false}]}]}};var a=Vec2.create();
sc.REGEN_DESTRUCT_TYPE.flame={size:{x:32,y:32,z:24},noBlinking:true,collType:ig.COLLTYPE.NPFENCE,boom:{sheet:"puzzle.flame",name:"boom"},hitCondition:function(a,b){if(a.attackInfo&&a.attackInfo.hasHint("ICE_DISK"))return true;b.setCurrentAnim("shuffle",true,"default",true);a.addIgnore&&a.addIgnore(b);return false},onCollision:function(b,c,e){if(c&&b instanceof ig.ENTITY.Combatant){Vec2.assign(a,c);Vec2.flip(a);e.setCurrentAnim("shuffle",true,"default",true);sc.combat.showHitEffect(b,b.getAlignedPos(ig.ENTITY_ALIGN.CENTER),
sc.ATTACK_TYPE.LIGHT,sc.ELEMENT.HEAT,false,false,false);b.cancelAction();var f=b.hasStun()?"MEDIUM":"HEAVY",f=b.doDamageMovement(a,f,false,false);b.damageTimer=Math.max(b.damageTimer,f)}if(c&&b.isWaterBubble&&b.isWaterBubble()){e.setCurrentAnim("shuffle",true,"default",true);Vec2.assign(a,c);Vec2.flip(a);b.steam(a,b.combatant||ig.game.playerEntity)}},anims:{namedSheets:{flame:{src:"media/entity/effects/heat.png",width:32,height:48,offX:288,offY:288},bottom:{src:null,width:16,height:16,offX:168,offY:96}},
SUB:[{sheet:"bottom",shapeType:"Z_FLAT",frames:[0],repeat:false,offset:{x:0,y:-8,z:0},SUB:[{name:"default"},{name:"destroy"},{name:"cut"},{name:"regen"},{name:"shuffle"}]},{sheet:"flame",offset:{x:0,y:0,z:8},SUB:[{name:"default",time:0.1,frames:[3,4,5,6],repeat:true},{name:"destroy",time:0.066,frames:[2,1,0],repeat:false},{name:"regen",time:0.066,frames:[0,1,2],repeat:false},{name:"shuffle",time:0.05,frames:[0,1,2],repeat:false}]}]}};sc.REGEN_DESTRUCT_TYPE.shock={size:{x:16,y:16,z:48},noBlinking:true,
collType:ig.COLLTYPE.NPFENCE,boom:{sheet:"puzzle.tesla",name:"boom"},hitCondition:function(a,b){if(a.getElement()==sc.ELEMENT.WAVE&&a.attackInfo&&a.attackInfo.hasHint("COMPRESSED"))return true;a.addIgnore&&a.addIgnore(b);return false},onCollision:function(b,c){if(c&&b instanceof ig.ENTITY.Combatant){Vec2.assign(a,c);Vec2.flip(a);sc.combat.showHitEffect(b,b.getAlignedPos(ig.ENTITY_ALIGN.CENTER),sc.ATTACK_TYPE.LIGHT,sc.ELEMENT.SHOCK,false,false,false);b.cancelAction();var e=b.hasStun()?"MEDIUM":"HEAVY",
e=b.doDamageMovement(a,e,false,false);b.damageTimer=Math.max(b.damageTimer,e)}if(c&&b instanceof sc.WaterBubbleEntity){Vec2.assign(a,c);Vec2.flip(a);b.steam(a,b.combatant||ig.game.playerEntity)}},anims:{namedSheets:{shock:{src:"media/map/shockwave-dng.png",width:16,height:40,offX:16,offY:744},bottom:{src:"media/map/shockwave-dng.png",width:16,height:16,offX:0,offY:768},ball:{src:"media/map/shockwave-dng.png",width:16,height:16,offX:0,offY:736,xCount:1}},SUB:[{sheet:"bottom",shapeType:"Z_FLAT",frames:[0],
repeat:false,SUB:[{name:"default"},{name:"destroy"},{name:"cut"},{name:"regen"}]},{sheet:"shock",offset:{x:0,y:-8,z:0},renderMode:"lighter",SUB:[{name:"default",time:0.05,frames:[0,1,2,3,4,5],repeat:true},{name:"destroy",time:0.066,frames:[4,4,4,4],framesAlpha:[0.8,0.6,0.3,0],repeat:false},{name:"regen",time:0.05,frames:[0,1,2,3,4,5],framesAlpha:[0.2,0.4,0.6,0.8],repeat:false}]},{sheet:"ball",shapeType:"Y_FLAT",SUB:[{name:"default",time:0.1,frames:[0,0,0,0,0,0],repeat:true,framesSpriteOffset:[0,0,
32,0,0,33,0,0,33,0,0,32,0,0,31,0,0,31]},{name:"cut",time:0.5,frames:[1],repeat:false,shapeType:"Z_FLAT"},{name:"destroy",time:0.05,frames:[1,1,1,1,1,1,1,1,1],repeat:false,framesSpriteOffset:[0,0,30,0,0,28,0,0,24,0,0,18,0,0,10,0,0,2,0,0,0,0,0,1,0,0,0]},{name:"regen",time:0.05,frames:[0,0,0,0,0,0],repeat:false,framesSpriteOffset:[0,0,8,0,0,16,0,0,24,0,0,28,0,0,30,0,0,31]}]}]}};sc.REGEN_DESTRUCT_TYPE.ferroHeat={size:{x:16,y:16,z:48},noBlinking:true,collType:ig.COLLTYPE.NPFENCE,boom:{sheet:"puzzle.ferro",
name:"barHeatBreak"},regen:{sheet:"puzzle.ferro",name:"barRegen"},hide:{sheet:"puzzle.ferro",name:"barHide"},shadow:16,zGravityFactor:0,hitCondition:function(a,b){if(a.getElement()==sc.ELEMENT.COLD&&a.attackInfo&&a.attackInfo.hasHint("FERRO"))return true;a.addIgnore&&a.addIgnore(b);return false},onCollision:function(b,c){if(c&&b instanceof ig.ENTITY.Combatant){Vec2.assign(a,c);Vec2.flip(a);sc.combat.showHitEffect(b,b.getAlignedPos(ig.ENTITY_ALIGN.CENTER),sc.ATTACK_TYPE.LIGHT,sc.ELEMENT.HEAT,false,
false,false);b.cancelAction();var e=b.hasStun()?"MEDIUM":"HEAVY",e=b.doDamageMovement(a,e,false,false);b.damageTimer=Math.max(b.damageTimer,e)}if(c&&b instanceof sc.WaterBubbleEntity){Vec2.assign(a,c);Vec2.flip(a);b.steam(a,b.combatant||ig.game.playerEntity)}},anims:{namedSheets:{pillar:{src:"media/entity/objects/ferro-barrier.png",width:24,height:48,offX:0,offY:0,xCount:6}},SUB:[{sheet:"pillar",offset:{x:0,y:0,z:0},SUB:[{name:"default",time:0.1,frames:[0,1,2],repeat:true,tileOffset:0},{name:"destroy",
time:0.1,frames:[0,1,2,3],repeat:false,tileOffset:12,shapeType:"Y_FLAT"},{name:"cut",time:0.1,frames:[3],repeat:false,tileOffset:12},{name:"regen",time:0.066,frames:[3,2,1],repeat:false,tileOffset:12,shapeType:"Y_FLAT"}]}]}};sc.REGEN_DESTRUCT_TYPE.ferroCold={size:{x:16,y:16,z:48},noBlinking:true,collType:ig.COLLTYPE.NPFENCE,boom:{sheet:"puzzle.ferro",name:"barColdBreak"},regen:{sheet:"puzzle.ferro",name:"barRegen"},hide:{sheet:"puzzle.ferro",name:"barHide"},shadow:16,zGravityFactor:0,hitCondition:function(a,
b){if(a.getElement()==sc.ELEMENT.HEAT&&a.attackInfo&&a.attackInfo.hasHint("FERRO"))return true;a.addIgnore&&a.addIgnore(b);return false},onCollision:function(b,c){if(c&&b instanceof ig.ENTITY.Combatant){Vec2.assign(a,c);Vec2.flip(a);sc.combat.showHitEffect(b,b.getAlignedPos(ig.ENTITY_ALIGN.CENTER),sc.ATTACK_TYPE.LIGHT,sc.ELEMENT.COLD,false,false,false);b.cancelAction();var e=b.hasStun()?"MEDIUM":"HEAVY",e=b.doDamageMovement(a,e,false,false);b.damageTimer=Math.max(b.damageTimer,e)}if(c&&b instanceof
sc.WaterBubbleEntity){Vec2.assign(a,c);Vec2.flip(a);b.steam(a,b.combatant||ig.game.playerEntity)}},anims:{namedSheets:{pillar:{src:"media/entity/objects/ferro-barrier.png",width:24,height:48,offX:0,offY:0,xCount:6}},SUB:[{sheet:"pillar",offset:{x:0,y:0,z:0},SUB:[{name:"default",time:0.1,frames:[0,1,2],repeat:true,tileOffset:3},{name:"destroy",time:0.1,frames:[0,1,2,3],repeat:false,tileOffset:12,shapeType:"Y_FLAT"},{name:"cut",time:0.1,frames:[3],repeat:false,tileOffset:12},{name:"regen",time:0.066,
frames:[3,2,1],repeat:false,tileOffset:12,shapeType:"Y_FLAT"}]}]}};sc.REGEN_DESTRUCT_TYPE.ferroShock={size:{x:16,y:16,z:48},noBlinking:true,collType:ig.COLLTYPE.NPFENCE,boom:{sheet:"puzzle.ferro",name:"barShockBreak"},regen:{sheet:"puzzle.ferro",name:"barRegen"},hide:{sheet:"puzzle.ferro",name:"barHide"},shadow:16,zGravityFactor:0,hitCondition:function(a,b){if(a.getElement()==sc.ELEMENT.WAVE&&a.attackInfo&&a.attackInfo.hasHint("FERRO"))return true;a.addIgnore&&a.addIgnore(b);return false},onCollision:function(b,
c){if(c&&b instanceof ig.ENTITY.Combatant){Vec2.assign(a,c);Vec2.flip(a);sc.combat.showHitEffect(b,b.getAlignedPos(ig.ENTITY_ALIGN.CENTER),sc.ATTACK_TYPE.LIGHT,sc.ELEMENT.SHOCK,false,false,false);b.cancelAction();var e=b.hasStun()?"MEDIUM":"HEAVY",e=b.doDamageMovement(a,e,false,false);b.damageTimer=Math.max(b.damageTimer,e)}if(c&&b instanceof sc.WaterBubbleEntity){Vec2.assign(a,c);Vec2.flip(a);b.steam(a,b.combatant||ig.game.playerEntity)}},anims:{namedSheets:{pillar:{src:"media/entity/objects/ferro-barrier.png",
width:24,height:48,offX:0,offY:0,xCount:6}},SUB:[{sheet:"pillar",offset:{x:0,y:0,z:0},SUB:[{name:"default",time:0.1,frames:[0,1,2],repeat:true,tileOffset:6},{name:"destroy",time:0.1,frames:[0,1,2,3],repeat:false,tileOffset:12,shapeType:"Y_FLAT"},{name:"cut",time:0.1,frames:[3],repeat:false,tileOffset:12},{name:"regen",time:0.066,frames:[3,2,1],repeat:false,tileOffset:12,shapeType:"Y_FLAT"}]}]}};sc.REGEN_DESTRUCT_TYPE.ferroWave={size:{x:16,y:16,z:48},noBlinking:true,collType:ig.COLLTYPE.NPFENCE,boom:{sheet:"puzzle.ferro",
name:"barWaveBreak"},regen:{sheet:"puzzle.ferro",name:"barRegen"},hide:{sheet:"puzzle.ferro",name:"barHide"},shadow:16,zGravityFactor:0,hitCondition:function(a,b){if(a.getElement()==sc.ELEMENT.SHOCK&&a.attackInfo&&a.attackInfo.hasHint("FERRO"))return true;a.addIgnore&&a.addIgnore(b);return false},onCollision:function(b,c){if(c&&b instanceof ig.ENTITY.Combatant){Vec2.assign(a,c);Vec2.flip(a);sc.combat.showHitEffect(b,b.getAlignedPos(ig.ENTITY_ALIGN.CENTER),sc.ATTACK_TYPE.LIGHT,sc.ELEMENT.WAVE,false,
false,false);b.cancelAction();var e=b.hasStun()?"MEDIUM":"HEAVY",e=b.doDamageMovement(a,e,false,false);b.damageTimer=Math.max(b.damageTimer,e)}if(c&&b instanceof sc.WaterBubbleEntity){Vec2.assign(a,c);Vec2.flip(a);b.steam(a,b.combatant||ig.game.playerEntity)}},anims:{namedSheets:{pillar:{src:"media/entity/objects/ferro-barrier.png",width:24,height:48,offX:0,offY:0,xCount:6}},SUB:[{sheet:"pillar",offset:{x:0,y:0,z:0},SUB:[{name:"default",time:0.1,frames:[0,1,2],repeat:true,tileOffset:9},{name:"destroy",
time:0.1,frames:[0,1,2,3],repeat:false,tileOffset:12,shapeType:"Y_FLAT"},{name:"cut",time:0.1,frames:[3],repeat:false,tileOffset:12},{name:"regen",time:0.066,frames:[3,2,1],repeat:false,tileOffset:12,shapeType:"Y_FLAT"}]}]}};sc.COMBAT_POI.REGEN_DESTRUCT={_wm:{attributes:{destructType:{_type:"String",_info:"Type of Regen Destruct",_select:sc.REGEN_DESTRUCT_TYPE},active:{_type:"Boolean",_info:"If true: Regen panel has to be active "}}},filterEntities:function(a,b,e){for(var f=e.active,e=e.destructType,
g=b.length;g--;){var h=b[g];h instanceof ig.ENTITY.RegenDestruct&&h.desTypeName==e&&(!f||h.isActive())&&a.push(h)}return a}}});ig.baked=!0;
ig.module("game.feature.puzzle.entities.extract-platform").requires("game.config","impact.base.entity").defines(function(){sc.EXTRACT_PLATFORM_TYPE={};ig.ENTITY.ExtractPlatform=ig.AnimatedEntity.extend({_wm:new ig.Config({spawnable:true,attributes:{extractType:{_type:"String",_info:"Type of extractable platform",_select:sc.EXTRACT_PLATFORM_TYPE},activeZHeight:{_type:"Number",_info:"The z position when active."},inactiveZHeight:{_type:"Number",_info:"The z position when inactive."},condition:{_type:"VarCondition",
_info:"Condition for the platform to move up",_popup:true}}}),condition:null,terrain:null,zTimer:0,zTime:0,activeZHeight:0,inactiveZHeight:0,activeState:false,_baseZ:0,_startZ:0,_targetZ:0,init:function(b,a,d,c){this.parent(b,a,d,c);this.coll.type=ig.COLLTYPE.BLOCK;this.coll.zBounciness=0;this._baseZ=this.coll.pos.z;this.condition=new ig.VarCondition(c.condition);this.activeZHeight=c.activeZHeight||0;b=sc.EXTRACT_PLATFORM_TYPE[c.extractType];this.zTimer=this.zTime=b.extractTime;Vec3.assign(this.coll.size,
b.size);this.activeState=this.condition.evaluate();window.wm||(this.activeState?this.setZPos(this._baseZ-this.coll.size.z+this.activeZHeight):this.setZPos(this._baseZ-this.coll.size.z+this.inactiveZHeight));this.initAnimations(b.anims)},update:function(){this.parent();if(this.zTimer<this.zTime){this.zTimer=this.zTimer+ig.system.tick;var b=Math.min(1,Math.max(0,this.zTimer)/this.zTime),b=KEY_SPLINES.LINEAR.get(b),a=this._startZ*(1-b)+this._targetZ*b;if(b==1)this.zTimer=this.zTime;this.setZPos(a)}},
varsChanged:function(){var b=this.condition.evaluate();if(this.activeState!=b){this.activeState=b;this._startZ=this.coll.pos.z;this._targetZ=this.activeState?this._baseZ-this.coll.size.z+this.activeZHeight:this._baseZ-this.coll.size.z+this.inactiveZHeight;this.zTimer=0}}});sc.EXTRACT_PLATFORM_TYPE.Small={size:{x:16,y:16,z:16},extractTime:0.3,terrain:ig.TERRAIN.METAL,anims:{sheet:{src:"media/entity/objects/puzzle-elements-1.png",width:16,height:32},SUB:[{name:"default",time:1,frames:[0],repeat:false}]}};
sc.EXTRACT_PLATFORM_TYPE.Large={size:{x:32,y:32,z:32},extractTime:0.3,terrain:ig.TERRAIN.METAL,anims:{sheet:{src:"media/entity/objects/puzzle-elements-1.png",width:32,height:64,offY:32},SUB:[{name:"default",time:1,frames:[0],repeat:false}]}}});ig.baked=!0;
ig.module("game.feature.puzzle.entities.dynamic-platform").requires("impact.base.actor-entity","impact.base.entity").defines(function(){var b=Vec3.createC(0,0,0);sc.DYNAMIC_PLATFORM_TYPES={};ig.ENTITY.DynamicPlatform=ig.ActorEntity.extend({_wm:new ig.Config({spawnable:true,attributes:{platformType:{_type:"String",_info:"Type of extractable platform",_select:sc.DYNAMIC_PLATFORM_TYPES},states:{_type:"DynamicPlatformDests",_info:"the states to iterate. ",_popup:true},pauseCondition:{_type:"VarCondition",
_info:"Condition to pause the platform to move.",_popup:true,_default:"false"},pauseAnimation:{_type:"EntityAnim",_info:"Animation to be played on pause",_optional:true},skipWait:{_type:"Boolean",_info:"True if actions should be interrupted when switching states.",_default:true},spawnCondition:{_type:"VarCondition",_info:"Condition for Enemy to spawn",_popup:true,_optional:true}}}),currentState:null,states:[],pauseCondition:null,pauseAnimation:null,baseConfig:null,paused:false,skipWaitForAction:false,
_switchState:false,_stateReached:false,fx:{},init:function(a,d,c,e){this.parent(a,d,c,e);this.skipWaitForAction=e.skipWait;a=sc.DYNAMIC_PLATFORM_TYPES[e.platformType];Vec3.assign(this.coll.size,a.size);this.terrain=a.terrain;d=a.anims;if(a.styleKey)if(c=ig.mapStyle.get(a.styleKey)){d=ig.copy(a.anims);d.sheet.src=c.sheet;d.sheet.offX=c.x;d.sheet.offY=c.y;d.sheet.xCount=c.xCount}if(a.fx)for(var f in a.fx)this.fx[f]=new ig.EffectHandle(a.fx[f]);this.animSheet=new ig.AnimationSheet(d);for(var g in a.walkAnims)this.storeWalkAnims(g,
a.walkAnims[g]);f=32;if(a.shadowSize!==void 0)f=a.shadowSize;this.baseConfig=new ig.ActorConfig({collType:ig.COLLTYPE.BLOCK,walkAnims:g,zGravityFactor:0,weight:-1,maxVel:180,relativeVel:1,accelSpeed:1.5,friction:1.6,airFriction:0.7,shadow:f,shadowType:ig.COLL_SHADOW_TYPE.STATIC_SIZE});this.pauseCondition=new ig.VarCondition(e.pauseCondition);this.pauseAnimation=e.pauseAnimation;g=this.getAlignedPos(ig.ENTITY_ALIGN.BOTTOM,b);e=e.states;f=null;if(e)for(a=0;a<e.length;a++){f=e[a];var d=f.useAbsolute?
f.position:Vec3.add(f.position,g,Vec3.create()),c=[{type:"INTERPOLATE_POSITION",newPos:d,keySpline:f.keySpline,duration:f.duration||0}],h=new ig.ActorConfig({walkAnims:f.animation},this.baseConfig);this.states.push({action:f.action?new ig.Action(null,f.action):null,condition:new ig.VarCondition(f.condition),config:h,pos:d,startAction:new ig.Action(null,c),startDuration:f.duration||0,playOnce:f.playOnce||false})}if(window.wm)this.states.length>0&&this.setDefaultConfig(this.states[0].config);else{this.updateStates(true);
this.updatePause()}this.initAnimations()},show:function(a){this.parent(a);if(this.fxHideHandle){this.fxHideHandle.stop();this.fxHideHandle=null}if(!a){this.animState.alpha=0;this.fx.show?this.fx.show.spawnOnTarget(this,{}):ig.game.effects.teleport.spawnOnTarget("showQuick",this,{})}},onHideRequest:function(){this.fx.hide?this.fxHideHandle=this.fx.hide.spawnOnTarget(this,{callback:this}):ig.game.effects.teleport.spawnOnTarget("hideQuick",this,{callback:this})},onEffectEvent:function(a){if(a==this.fxHideHandle&&
a.isDone()){this.fxHideHandle=null;this.hide()}},update:function(){this.parent()},postActionUpdate:function(){if(!this.hasAction()&&!this.paused)if(this._switchState){this.playCurrentState();this._switchState=false}else{(!this.currentState.playOnce||!this._stateReached)&&this.setAction(this.currentState.action);this._stateReached=true}},onKill:function(a){this.parent(a);this.animSheet.clearCached();for(var b in this.fx)this.fx[b].clearCached()},updateStates:function(a){for(var b=this.states.length,
c=null,e=null;b--;){c=this.states[b];if(c.condition.evaluate()){e=c;break}}if(e!=this.currentState){this.currentState=e;this.currentState.played=false;if(a||this.skipWaitForAction||!this._stateReached)this.playCurrentState(a);else{this._stateReached=false;this._switchState=true}}},playCurrentState:function(a){this.setDefaultConfig(this.currentState.config);if(a){this.setPos(this.currentState.pos.x-this.coll.size.x/2,this.currentState.pos.y-this.coll.size.y/2,this.currentState.pos.z);this._switchState=
false}else if(this.currentState.startDuration!=0)this.setAction(this.currentState.startAction);else{this.setAction(this.currentState.action);this._stateReached=true}},varsChanged:function(){this.updateStates();this.updatePause()},updatePause:function(){var a=this.pauseCondition&&this.pauseCondition.evaluate();if(a!=this.paused)if(this.paused=a){this.stashAction();if(this.pauseAnimation){this.setCurrentAnim(this.pauseAnimation,true,null,true);this.animationFixed=true}Vec2.assignC(this.coll.accelDir,
0,0);Vec2.assignC(this.coll.vel,0,0)}else{this.animationFixed=false;this.resumeStashedAction()}}});sc.DYNAMIC_PLATFORM_TYPES.DefaultSmall={size:{x:32,y:32,z:2},styleKey:"dynPlatformSmall",terrain:ig.TERRAIN.METAL,anims:{sheet:{src:null,width:32,height:32,offX:0,offY:0},SUB:[{name:"on",time:1,frames:[0],repeat:false},{name:"off",time:1,frames:[1],repeat:false}]},walkAnims:{on:{idle:"on"},off:{idle:"off"}}};sc.DYNAMIC_PLATFORM_TYPES.DefaultMedium={size:{x:32,y:32,z:2},styleKey:"dynPlatformMedium",terrain:ig.TERRAIN.METAL,
anims:{sheet:{src:null,width:32,height:32,offX:0,offY:0},SUB:[{name:"on",time:1,frames:[0],repeat:false},{name:"off",time:1,frames:[1],repeat:false}]},walkAnims:{on:{idle:"on"},off:{idle:"off"}}};sc.DYNAMIC_PLATFORM_TYPES.Small={size:{x:16,y:16,z:16},terrain:ig.TERRAIN.METAL,anims:{sheet:{src:"media/entity/objects/puzzle-elements-1.png",width:16,height:32},SUB:[{name:"default",time:1,frames:[0],repeat:false},{name:"move",time:0.05,frames:[0,1,2,1],repeat:true}]},walkAnims:{"default":{idle:"default",
move:"move"}}};sc.DYNAMIC_PLATFORM_TYPES.Large={size:{x:32,y:32,z:32},terrain:ig.TERRAIN.METAL,anims:{sheet:{src:"media/entity/objects/puzzle-elements-1.png",width:32,height:64,offY:32},SUB:[{name:"default",time:1,frames:[0],repeat:false},{name:"move",time:0.05,frames:[0,1,2,1],repeat:true}]},walkAnims:{"default":{idle:"default",move:"move"}}};sc.DYNAMIC_PLATFORM_TYPES.RhombusMedium={size:{x:32,y:32,z:32},terrain:ig.TERRAIN.METAL,anims:{sheet:{src:"media/entity/objects/dynamic-blocks.png",width:32,
height:64},SUB:[{name:"redOn",time:1,frames:[0],repeat:false},{name:"redOff",time:1,frames:[1],repeat:false},{name:"greenOn",time:1,frames:[2],repeat:false},{name:"greenOff",time:1,frames:[3],repeat:false},{name:"blueOn",time:1,frames:[4],repeat:false},{name:"blueOff",time:1,frames:[5],repeat:false}]},walkAnims:{greenOn:{idle:"greenOn"},greenOff:{idle:"greenOff"},redOn:{idle:"redOn"},redOff:{idle:"redOff"},blueOn:{idle:"blueOn"},blueOff:{idle:"blueOff"}}};sc.DYNAMIC_PLATFORM_TYPES.Floating={size:{x:32,
y:32,z:0},terrain:ig.TERRAIN.METAL,anims:{sheet:{src:"media/entity/objects/dynamic-blocks.png",width:32,height:36},shapeType:"Z_EXPAND",offset:{x:0,y:0,z:-4},SUB:[{name:"redOn",time:1,frames:[0],repeat:false},{name:"redOff",time:1,frames:[1],repeat:false},{name:"greenOn",time:1,frames:[2],repeat:false},{name:"greenOff",time:1,frames:[3],repeat:false},{name:"blueOn",time:1,frames:[4],repeat:false},{name:"blueOff",time:1,frames:[5],repeat:false}]},walkAnims:{greenOn:{idle:"greenOn"},greenOff:{idle:"greenOff"},
redOn:{idle:"redOn"},redOff:{idle:"redOff"},blueOn:{idle:"blueOn"},blueOff:{idle:"blueOff"}}};sc.DYNAMIC_PLATFORM_TYPES.FloatingBig={size:{x:64,y:64,z:0},terrain:ig.TERRAIN.METAL,anims:{sheet:{src:"media/entity/objects/dynamic-blocks.png",width:64,height:68,offY:40},shapeType:"Z_EXPAND",offset:{x:0,y:0,z:-4},SUB:[{name:"blueOn",time:1,frames:[0],repeat:false},{name:"blueOff",time:1,frames:[1],repeat:false}]},walkAnims:{blueOn:{idle:"blueOn"},blueOff:{idle:"blueOff"}}};sc.DYNAMIC_PLATFORM_TYPES.AridBig=
{size:{x:80,y:72,z:2},terrain:ig.TERRAIN.METAL,anims:{sheet:{src:"media/map/arid-interior.png",width:80,height:72,offX:336,offY:672},shapeType:"Z_EXPAND",wallY:1,SUB:[{name:"default",time:1,frames:[0],repeat:false}]},walkAnims:{"default":{idle:"default"}}};sc.DYNAMIC_PLATFORM_TYPES.ArWallH={size:{x:32,y:8,z:24},shadowSize:0,terrain:ig.TERRAIN.LASER,anims:{sheet:{src:"media/entity/objects/dungeon-ar.png",width:32,height:32,offX:56,offY:144},renderMode:"lighter",SUB:[{name:"default",time:0.05,frames:[0,
0],framesAlpha:[1,0.8],repeat:true}]},walkAnims:{on:{idle:"default"}},fx:{show:{sheet:"teleport",name:"barrierShow"},hide:{sheet:"teleport",name:"barrierHide"}}};sc.DYNAMIC_PLATFORM_TYPES.ArWallV={size:{x:8,y:32,z:24},shadowSize:0,terrain:ig.TERRAIN.LASER,anims:{sheet:{src:"media/entity/objects/dungeon-ar.png",width:8,height:56,offX:24,offY:176},renderMode:"lighter",SUB:[{name:"default",time:0.05,frames:[0,0],framesAlpha:[1,0.8],repeat:true}]},walkAnims:{on:{idle:"default"}},fx:{show:{sheet:"teleport",
name:"barrierShow"},hide:{sheet:"teleport",name:"barrierHide"}}}});ig.baked=!0;
ig.module("game.feature.puzzle.entities.ol-platform").requires("impact.base.entity","impact.feature.base.entities.object-layer-view").defines(function(){sc.OL_PLATFORM_SPEED={FLEGMON:10,SLOWEST:25,SLOWER:50,SLOW:75,MEDIUM:100,FAST:150};var b=Vec3.create(),a=Vec3.create();ig.ENTITY.OLPlatform=ig.Entity.extend({_wm:new ig.Config({spawnable:true,scalableX:true,scalableY:true,scalableStep:4,attributes:{layer:{_type:"String",_info:"Object Layer from which to display graphic.",_select:{object1:1,object2:1,
object3:1}},zHeight:{_type:"Number",_info:"Z height of displayed object"},wallY:{_type:"Number",_info:"Wall Y Value"},terrain:{_type:"String",_info:"Type of ground terrain",_select:ig.TERRAIN},states:{_type:"OlPlatformStates",_info:"States of the platform",_popup:true},speed:{_type:"String",_info:"Speed of transition",_select:sc.OL_PLATFORM_SPEED},staticSpeed:{_type:"Boolean",_info:"Speed independent of distance"},positionSound:{_type:"Boolean",_info:"Make sound positional",_default:false},shape:{_type:"String",
_info:"Height-Shape of Block Entity",_select:ig.COLLSHAPE,_optional:true},spawnCondition:{_type:"VarCondition",_info:"Condition for prop to appear",_popup:true,_optional:true}},drawBox:false,boxColor:"rgba(120,255,120, 0.5)",frontColor:"rgba(80,244,80, 0.5)",alwaysRecreate:true}),terrain:null,maps:null,startPos:Vec3.create(),states:[],speed:0,staticSpeed:false,squishRespawn:true,usePositionalSound:false,sound:{move:new ig.Sound("media/sound/puzzle/push-start.ogg",1)},_lastPos:Vec3.create(),timer:null,
currentState:null,spritesInitialized:false,navBlocker:null,quickNavUpdate:false,init:function(a,b,e,f){this.parent(a,b,e,f);this.coll.type=ig.COLLTYPE.BLOCK;this.coll.size.z=f.zHeight||0;this.terrain=f.terrain||0;this.speed=sc.OL_PLATFORM_SPEED[f.speed||"MEDIUM"];this.wallY=(f.wallY||0).limit(0,1);this.staticSpeed=f.staticSpeed||false;this.usePositionalSound=f.positionSound||false;this.coll.shape=ig.COLLSHAPE[f.shape||"RECTANGLE"];this.maps=ig.game.getObjectMaps(f.layer);Vec3.assign(this.startPos,
this.coll.pos);this.timer=new ig.WeightTimer;if(a=f.states)for(b=0;b<a.length;++b){e=a[b];f=null;e.layer&&(f=ig.game.getObjectMaps(e.layer));this.states.push({condition:new ig.VarCondition(e.condition),pos:Vec3.add(e.offset,this.startPos,Vec3.create()),maps:f,spline:KEY_SPLINES[e.spline||"EASE_IN_OUT"]})}a=ig.ObjectLayerTools.getSpriteCount(this,this.maps);this.setSpriteCount(a);window.wm||this.updateState(true)},show:function(a){this.parent(a);this.navBlocker=ig.navigation.getNavBlock(this)},onKill:function(){this.navBlocker&&
this.navBlocker.remove();this.parent()},updateState:function(b){for(var c=this.states.length,e=null;c--;){var f=this.states[c];if(f.condition.evaluate()){e=f;break}}if(e&&e!=this.currentState){Vec3.assign(this._lastPos,this.coll.pos);if(b)Vec3.assign(this.coll.pos,e.pos);else{b=this.sound.move.play();this.getAlignedPos(ig.ENTITY_ALIGN.CENTER,a);this.usePositionalSound&&b.setFixPosition(a,800);b=Vec3.distance(this._lastPos,e.pos);this.staticSpeed&&(b=32);b=b/this.speed;this.timer.set(b,ig.TIMER_MODE.ONCE);
this.quickNavUpdate=b>1}if(this.currentState&&this.currentState.maps!=e.maps)this.spritesInitialized=false}this.currentState=e},update:function(){this.parent();if(!this.timer.done()){this.timer.tick();var a=this.timer.get();if(this.quickNavUpdate&&this.timer.getTimePassed()>1){this.quickNavUpdate=false;this.navBlocker&&this.navBlocker.update()}a=this.currentState.spline.get(a);Vec3.lerp(this._lastPos,this.currentState.pos,a,b);this.setPos(b.x,b.y,b.z,true);this.timer.done()&&this.navBlocker&&this.navBlocker.update()}},
updateSprites:function(){if(!this.spritesInitialized){var a=this.currentState&&this.currentState.maps||this.maps,c=Vec3.sub(this.coll.pos,this.startPos,b);if(ig.ObjectLayerTools.updateSprites(this,a,this.wallY,c))this.spritesInitialized=false}},varsChanged:function(){this.updateState()}})});ig.baked=!0;
ig.module("game.feature.puzzle.entities.enemy-counter").requires("game.feature.combat.combat","impact.base.entity").defines(function(){ig.ENTITY.EnemyCounter=ig.AnimatedEntity.extend({gfx:null,enemyGroup:null,enemyCount:0,preCount:0,postCount:0,preVariable:null,postVariable:null,done:false,shuffleCondition:null,timer:0,MAX_FLASH_TIME:0.5,sounds:{count:new ig.Sound("media/sound/puzzle/counter.ogg",0.7),done:new ig.Sound("media/sound/puzzle/switch-activate-2.ogg",1)},effects:{sheet:new ig.EffectSheet("puzzle"),
hideHandle:null},_wm:new ig.Config({spawnable:true,attributes:{spawnCondition:{_type:"VarCondition",_info:"VarCondition to make enemy counter appear",_popup:true},enemyGroup:{_type:"String",_info:"Enemy Group that is considered for counting"},enemyCount:{_type:"Number",_info:"Number of enemies that needs to be defeated"},preVariable:{_type:"VarName",_info:"Variable to be set to true when all enemies are defeated."},postVariable:{_type:"VarName",_info:"Variable to be set to true when the last marble reached the counter."},
countVariable:{_type:"VarName",_info:"Variable to be set to the current enemyCount value."},shuffleCondition:{_type:"VarCondition",_info:"if provided: shuffle when condition evaluates to true",_optional:true}},label:function(){return""+this.maxCount+" => ["+this.preVariable+"] > ["+this.postVariable+"]"}}),init:function(a,b,c,e){this.parent(a,b,c,e);this.coll.type=ig.COLLTYPE.BLOCK;this.coll.setSize(32,30,2);this.coll.time.globalStatic=true;a=ig.mapStyle.get("puzzle");this.gfx=new ig.Image(a.sheet);
this.enemyGroup=e.enemyGroup;this.enemyCount=e.enemyCount;this.preVariable=e.preVariable;this.postVariable=e.postVariable;this.countVariable=e.countVariable;this.shuffleCondition=e.shuffleCondition?new ig.VarCondition(e.shuffleCondition):null;this.postCount=this.preCount=(this.done=ig.vars.get(this.postVariable))?0:this.enemyCount;sc.combat.addCombatListener(this);this.countVariable&&ig.vars.set(this.countVariable,this.postCount)},show:function(a){this.parent(a);if(this.effects.hideHandle){this.effects.hideHandle.stop();
this.effects.hideHandle=null}if(!a){this.animState.alpha=0;this.effects.sheet.spawnOnTarget("enemyCounterAppear",this,{})}},onHideRequest:function(){this.effects.hideHandle=this.effects.sheet.spawnOnTarget("enemyCounterDisappear",this,{callback:this})},onEffectEvent:function(a){if(a.isDone()){this.effects.hideHandle=null;this.hide()}},initSprites:function(){this.setSpriteCount(4)},update:function(){if(this.timer>0)this.timer=this.timer-ig.system.tick},onCombatEvent:function(a,b){if(this.preCount>
0&&b==sc.COMBAT_EVENT.DEFEATED&&a.party==sc.COMBATANT_PARTY.ENEMY&&(!this.enemyGroup||a.enemyGroup==this.enemyGroup)){this.preCount--;this.preCount==0&&ig.vars.set(this.preVariable,true);return this}},onCombatMarbleReach:function(){this.decreaseCount()},updateSprites:function(){var a=this.done?64:0,b=this.coll;this.sprites[0].setPos(b.pos.x,b.pos.y,b.pos.z);this.sprites[0].setSize(b.size.x,b.size.y,b.size.z,b.size.y);this.sprites[0].setPivot(b.size.x/2,(b.size.y+b.size.z)/2);this.sprites[0].setImageSrc(this.gfx,
0+a,96);this.sprites[0].setAlpha(this.animState.alpha);this.sprites[0].setTransform(this.animState.scaleX,this.animState.scaleY,this.animState.angle);if(this.timer>0){this.sprites[3].setPos(b.pos.x,b.pos.y,b.pos.z);this.sprites[3].setSize(b.size.x,b.size.y,b.size.z);this.sprites[0].setPivot(b.size.x/2,(b.size.y+b.size.z)/2);this.sprites[3].setImageSrc(this.gfx,32+a,96);this.sprites[3].setAlpha(this.timer/this.MAX_FLASH_TIME*this.animState.alpha);this.sprites[3].setTransform(this.animState.scaleX,
this.animState.scaleY,this.animState.angle)}else this.sprites[3].setImageSrc(null);if(this.done){this.sprites[1].setImageSrc(null);this.sprites[2].setImageSrc(null)}else{var c=this.postCount;this.shuffleCondition&&this.shuffleCondition.evaluate()&&(c=Math.floor(Math.random()*100));a=Math.floor(c/10);c=c%10;this.sprites[1].setPos(b.pos.x+9,b.pos.y+6,b.pos.z);this.sprites[1].setSize(16,16,0,0);this.sprites[1].setImageSrc(this.gfx,128+a%5*16,96+(a>=5?16:0));this.sprites[1].setAlpha(this.animState.alpha);
this.sprites[1].setTransform(this.animState.scaleX,this.animState.scaleY,this.animState.angle);this.sprites[2].setPos(b.pos.x+14,b.pos.y+11,b.pos.z);this.sprites[2].setSize(16,16,0,0);this.sprites[2].setImageSrc(this.gfx,128+c%5*16,96+(c>=5?16:0));this.sprites[2].setAlpha(this.animState.alpha);this.sprites[2].setTransform(this.animState.scaleX,this.animState.scaleY,this.animState.angle)}},onKill:function(a){sc.combat.removeCombatListener(this);this.parent(a)},decreaseCount:function(){if(this.postCount>
0){this.timer=this.MAX_FLASH_TIME;this.postCount--;this.countVariable&&ig.vars.set(this.countVariable,this.postCount);if(this.postCount==0){this.done=true;ig.vars.set(this.postVariable,true);ig.SoundHelper.playAtEntity(this.sounds.done,this)}else ig.SoundHelper.playAtEntity(this.sounds.count,this)}}});var b={DEFAULT:0,INCREASE:1};ig.ENTITY.KillCounter=ig.Entity.extend({enemyGroup:null,killCount:0,mode:b.DEFAULT,preCount:0,variable:null,done:false,_wm:new ig.Config({spawnable:true,attributes:{spawnCondition:{_type:"VarCondition",
_info:"Spawn Condition",_popup:true},countMode:{_type:"Select",_info:"DEFAULT: set count to kill count and trigger when all killed. INCREASE: just increase countVar every time an enemy dies.",_select:b},enemyGroup:{_type:"String",_info:"Enemy Group that is considered for counting"},killCount:{_type:"Number",_info:"Number of kills to do."},variable:{_type:"VarName",_info:"Variable to be set to true when all kill count is reached"},countVariable:{_type:"VarName",_info:"Variable to be set to the current enemyCount value."}},
drawBox:true,scalableX:true,scalableY:true,boxColor:"rgba(0,0,255, 0.5)",frontColor:"rgba(0,0,120, 0.8)",label:function(){return this.mode==b.DEFAULT?""+this.killCount+" => ["+this.variable+"]":this.countVariable+"++"}}),init:function(a,d,c,e){this.parent(a,d,c,e);this.coll.type=ig.COLLTYPE.NONE;e.size||this.coll.setSize(32,32,0);this.mode=e.countMode?b[e.countMode]:b.DEFAULT;this.coll.time.globalStatic=true;this.enemyGroup=e.enemyGroup;this.killCount=e.killCount;this.variable=e.variable;this.countVariable=
e.countVariable;this.preCount=(this.done=this.variable?ig.vars.get(this.variable):false)?0:this.killCount;sc.combat.addCombatListener(this);this.countVariable&&this.mode==b.DEFAULT&&ig.vars.set(this.countVariable,this.preCount)},onCombatEvent:function(a,d){if(this.preCount>0&&d==sc.COMBAT_EVENT.DEFEATED&&a.party==sc.COMBATANT_PARTY.ENEMY&&(!this.enemyGroup||a.enemyGroup==this.enemyGroup))if(this.mode==b.DEFAULT){this.preCount--;this.countVariable&&ig.vars.set(this.countVariable,this.preCount);if(this.preCount==
0){ig.vars.set(this.variable,true);this.done=true}}else this.mode==b.INCREASE&&this.countVariable&&ig.vars.add(this.countVariable,1)},onKill:function(a){sc.combat.removeCombatListener(this);this.parent(a)}})});ig.baked=!0;
ig.module("game.feature.puzzle.entities.group-switch").requires("impact.base.entity").defines(function(){sc.GROUP_SWITCH_TYPE={};sc.GROUP_SWITCH_UPDATE_TYPE={};sc.GROUP_SWITCH_UPDATE_TYPE.LOCAL=0;sc.GROUP_SWITCH_UPDATE_TYPE.GLOBAL=1;var b={};ig.ENTITY.GroupSwitch=ig.AnimatedEntity.extend({hitCondition:null,ballDestroyer:true,activeCondition:null,group:null,updateType:sc.GROUP_SWITCH_UPDATE_TYPE.LOCAL,activeBoolVar:null,activeCountVar:null,activeZHeight:0,firstTrigger:null,isOn:false,sounds:{hit:new ig.Sound("media/sound/battle/hit-7.ogg",
0.4),bing:new ig.Sound("media/sound/puzzle/switch-activate-2.ogg",1)},time:0,timer:0,isSpinning:false,_wm:new ig.Config({spawnable:true,attributes:{switchType:{_type:"String",_info:"Type of Group Switch",_select:sc.GROUP_SWITCH_TYPE},updateType:{_type:"String",_info:"Update type for the group switch",_select:sc.GROUP_SWITCH_UPDATE_TYPE},group:{_type:"String",_info:"The associated group for this switch. Must be set for global type switches."},activeTime:{_type:"Number",_info:"the time the switch (or all switches in the group if global) stays active."},
activeBoolVar:{_type:"VarName",_info:"Variable is set to true when all switches are activated"},activeCountVar:{_type:"VarName",_info:"This variable stored the number of active switches in this group"},firstTrigger:{_type:"VarName",_info:"Set to true when one of the first switches in a group is hit.",_optional:true}},label:function(){return"[ "+this.activeBoolVar+" ]\n"+this.activeCountVar+"++"}}),init:function(a,d,c,e){this.parent(a,d,c,e);this.coll.type=ig.COLLTYPE.VIRTUAL;this.coll.time.globalStatic=
true;a=sc.GROUP_SWITCH_TYPE[e.switchType];ig.mapStyle.get("switch");if(a){Vec3.assign(this.coll.size,a.size);this.hitCondition=a.hitCondition;this.activeZHeight=a.activeZHeight;if(a.useStyleSheet){d=ig.mapStyle.get("puzzle");a.anims.sheet.src=d.sheet}this.initAnimations(a.anims)}this.updateType=sc.GROUP_SWITCH_UPDATE_TYPE[e.updateType];this.group=e.group;this.time=e.activeTime;this.timer=0;this.activeCondition=new ig.VarCondition(e.activeCondition||"false");this.activeBoolVar=e.activeBoolVar;this.activeCountVar=
e.activeCountVar;this.firstTrigger=e.firstTrigger||null;this.activeCountVar&&ig.vars.setDefault(this.activeCountVar,0);ig.vars.setDefault(this.activeBoolVar,0);b[this.group]||(b[this.group]={entities:[],master:null,activeCount:0});b[this.group].entities.push(this);(this.isOn=ig.vars.get(this.activeBoolVar))?this.coll.size.z=this.activeZHeight:this.activeCountVar&&ig.vars.set(this.activeCountVar,0);this.setCurrentAnim(this.isOn?"on":"off")},onKill:function(a){this.isOn||this.activeCountVar&&ig.vars.set(this.activeCountVar,
0);delete b[this.group];this.parent(a)},setOff:function(){this.setCurrentAnim("off",true,null,true,false);this.isSpinning=0;this.isOn=false},setOn:function(){this.isOn=true;this.setCurrentAnim("switch",true,null,true,true)},update:function(){if(!this.isOn&&this.timer){this.timer=this.timer-ig.system.tick;if(this.timer<=0){this.timer=0;var a=b[this.group];if(this.updateType==sc.GROUP_SWITCH_UPDATE_TYPE.LOCAL){this.activeCountVar&&ig.vars.sub(this.activeCountVar,1);this.setOff();a.activeCount--}else if(this.updateType==
sc.GROUP_SWITCH_UPDATE_TYPE.GLOBAL&&this==a.master){this.activeCountVar&&ig.vars.set(this.activeCountVar,0);for(var d=a.entities.length;d--;)a.entities[d].setOff();a.master=null;a.activeCount=0}}}this.parent()},ballHit:function(a){if(!this.isOn&&!this.isSpinning&&this.hitCondition(this,a)){this.isSpinning=true;this.setCurrentAnim("spinning",true,null,true,false);sc.combat.showHitEffect(this,a.getHitCenter(this),sc.ATTACK_TYPE.MASSIVE,a.getElement(),false,false,true);ig.SoundHelper.playAtEntity(this.sounds.hit,
this);ig.SoundHelper.playAtEntity(this.sounds.bing,this);a=b[this.group];this.timer=this.time/sc.options.get("assist-puzzle-speed");if(this.updateType==sc.GROUP_SWITCH_UPDATE_TYPE.GLOBAL&&!a.master){a.master=this;this.firstTrigger&&ig.vars.set(this.firstTrigger,true)}a.activeCount++;this.activeCountVar&&ig.vars.add(this.activeCountVar,1);if(a.activeCount==a.entities.length){for(var d=a.entities.length;d--;)a.entities[d].setOn();ig.vars.set(this.activeBoolVar,true)}}else sc.combat.showHitEffect(this,
a.getHitCenter(this),sc.ATTACK_TYPE.NONE,a.getElement(),false,false,true);return true},animationEnded:function(a){if(a=="switch"){this.coll.size.z=this.activeZHeight;this.setCurrentAnim("switch_end",true,"on")}}});sc.GROUP_SWITCH_TYPE["default"]={size:{x:16,y:16,z:17},activeZHeight:0,useStyleSheet:true,anims:{offset:{x:0,y:0,z:0},sheet:{src:null,width:16,height:32},SUB:[{name:"off",time:0.1,frames:[0,1,2,3],repeat:true},{name:"spinning",time:0.03,frames:[4,5,6,7],repeat:true},{name:"switch",time:0.03,
frames:[8,9,10,11,8,9,10,11,8,9,10,11,8,9,10,11,8,9,10,10,11,11,11,8,8,8,8,8,12,13],repeat:false},{name:"switch_end",time:0.1,frames:[14,15],repeat:false},{name:"on",time:1,frames:[15],repeat:false}]},hitCondition:function(a,b){return b.party==sc.COMBATANT_PARTY.PLAYER}}});ig.baked=!0;
ig.module("game.feature.puzzle.entities.chest").requires("impact.base.actor-entity","impact.base.entity","game.feature.interact.map-interact","game.feature.inventory.inventory","game.feature.menu.menu-model").defines(function(){sc.CHEST_TYPE={};sc.CHEST_KEY={};sc.CHEST_KEY.BRONZE=154;sc.CHEST_KEY.SILVER=155;sc.CHEST_KEY.GOLD=156;ig.ENTITY.Chest=ig.AnimatedEntity.extend({_wm:new ig.Config({spawnable:true,attributes:{chestType:{_type:"String",_info:"Type of the chest.",_select:sc.CHEST_TYPE},item:{_type:"Item",
_info:"The item to spawn."},amount:{_type:"Number",_info:"Amount of the given item. 0 = 1.",_default:1},spawnCondition:{_type:"VarCondition",_info:"Condition for Enemy to spawn",_popup:true},variable:{_type:"VarName",_info:"the value to add 1 to",_optional:true},trigger:{_type:"VarName",_info:"trigger to set to true the only 'once' when chest is activated",_optional:true},hideCondition:{_type:"VarCondition",_info:"Condition for entity to become transparent",_optional:true},noTrack:{_type:"Boolean",
_info:"If true, this chest is not tracked in the area counter",_optional:true,_default:true},detectCondition:{_type:"VarCondition",_info:"Condition for Detector to pick up the chest",_popup:true,_optional:true}},label:function(){return this._itemName+" + "+this.amount}}),mapIcons:new sc.MapInteractIcon(new ig.TileSheet("media/gui/map-icon.png",24,24),{FOCUS:[50,51,52,51],NEAR:[53]},0.2),mapIconsKey:new sc.MapInteractIcon(new ig.TileSheet("media/gui/map-icon.png",24,24),{FOCUS:[55,56,57,58,57,58,57,
56],NEAR:[54]},0.2),effects:{sheet:new ig.EffectSheet("map.chest"),handle:null},interactEntry:null,hideHandle:null,isOpen:false,chestVariable:false,item:null,amount:0,chestType:null,lockedIcon:false,_itemName:null,_trigger:null,_initialized:false,_noTrack:false,init:function(b,a,d,c){this.parent(b,a,d,c);this.coll.type=ig.COLLTYPE.NONE;this.coll.zGravityFactor=1;this.interactEntry=new sc.MapInteractEntry(this,this,this.mapIcons,sc.INTERACT_Z_CONDITION.Z_RANGE_OVERLAP,false);this.interactEntry.blockedDuringCombat=
true;this._trigger=c.trigger||null;this._noTrack=c.noTrack||false;b=sc.CHEST_TYPE[c.chestType]||sc.CHEST_TYPE["default"];this.item=c.item||0;this.chestType=b;this.coll.setSize(17,13,12);this.chestVariable=(b=c.variable||"")&&b!=""?b:"map.chest_"+this.mapId;this._itemName=ig.LangLabel.getText(sc.inventory.getItem(this.item).name)||"NULL";this.amount=c.amount||1;this.initAnimations({SUB:[{shapeType:"Y_FLAT",sheet:{src:"media/entity/objects/treasure.png",width:16,height:24},time:0.05,frames:[0,0,0,0,
0,0,0,0,1,2,3,4,5],repeat:true,SUB:[{name:"idle"},{name:"idleBronze"},{name:"idleSilver"},{name:"idleGold"},{name:"idleKey"},{name:"idleMasterKey"}]},{shapeType:"Y_FLAT",sheet:{src:"media/entity/objects/treasure.png",width:24,height:24,offY:56},SUB:[{name:"idleBronze",time:0.05,frames:[3],repeat:true},{name:"idleSilver",time:0.05,frames:[2],repeat:true},{name:"idleGold",time:0.05,frames:[0],repeat:true},{name:"idleKey",time:0.05,frames:[4],repeat:true},{name:"idleMasterKey",time:0.05,frames:[5],repeat:true}]},
{sheet:{src:"media/entity/objects/treasure.png",width:24,height:32,offY:24},gfxOffset:{x:0,y:4},SUB:[{name:"open",time:0.1,frames:[0,1,2,3],repeat:false},{name:"end",time:0.1,frames:[4],repeat:false,shapeType:"Z_FLAT"}]}]});if(ig.vars.get(this.chestVariable)){this.isOpen=true;this.setCurrentAnim("end",true,null,true)}else{this.setCurrentAnim(this.chestType.anim||"idle",true,null,true);this.coll.float.height=6;this.coll.float.variance=2;this.coll.shadow.size=16}this.animState.alpha=1;if(c.hideCondition)this.hideManager=
new ig.EntityHideManager(c.hideCondition);if(c.detectCondition)this.detectCondition=new ig.VarCondition(c.detectCondition)},_initGfx:function(){this._initialized=true;var b=sc.map.getAreaItemType(this.item);if(b=="DUNGEON_KEY")this.chestType=sc.CHEST_TYPE.Key;else if(b=="DUNGEON_MASTER_KEY")this.chestType=sc.CHEST_TYPE.MasterKey;!this.isOpen&&this.chestType.anim&&this.setCurrentAnim(this.chestType.anim,true,null,true)},onEffectEvent:function(b){if(this.hideHandle){if(b.isDone()){this.hideHandle=null;
this.hide()}}else b.isDone()&&this._reallyOpenUp()},show:function(b){this.parent(b);if(!b){this.animState.alpha=0;ig.game.effects.teleport.spawnOnTarget("showDefault",this,{})}if(!this.isOpen){this._updateIcon();sc.mapInteract.addEntry(this.interactEntry)}},_updateIcon:function(){var b=this.chestType.item?false:true;b||(b=sc.model.player.hasItem(this.chestType.item));b?this.interactEntry.setIcon(this.mapIcons):this.interactEntry.setIcon(this.mapIconsKey)},onHideRequest:function(){sc.mapInteract.removeEntry(this.interactEntry);
this.hideHandle=ig.game.effects.teleport.spawnOnTarget("hideDefault",this,{callback:this})},update:function(){this._initialized||this._initGfx();this.hideManager&&this.hideManager.update(this);this.parent()},onInteraction:function(){var b=ig.game.playerEntity;if(b.currentAction&&b.currentAction.eventAction)return false;if(this.isOpen)return true;if(this.chestType.item&&!sc.model.player.hasItem(this.chestType.item)){if(this._trigger&&!ig.vars.get(this._trigger)){ig.vars.set(this._trigger,true);return true}return false}var a=
[{type:"SET_TERRAIN_FRICTION_IGNORE",value:true},{type:"SET_WALK_ANIMS",config:"normal"},{type:"SET_RELATIVE_SPEED",value:0.5},{type:"SET_FACE_TO_ENTITY",entity:this,rotate:true},{type:"SET_FACE_FIX",value:true},{type:"MOVE_TO_ENTITY_DISTANCE",entity:this,min:16,max:20,maxTime:0.2},{type:"SHOW_ANIMATION",anim:"chestOpen"}],d=this.chestType.openEffect?1.2:0.8;if(this._trigger&&!ig.vars.get(this._trigger)){a.push({type:"CHANGE_VAR_BOOL",varName:this._trigger,changeType:"set",value:true});a.push({type:"WAIT",
time:0.8})}else{a.push({type:"OPEN_CHEST",entity:this});a.push({type:"WAIT",time:d})}a.push({type:"SHOW_ANIMATION",anim:"preIdle",wait:true});a=new ig.Action("openChest",a);a.eventAction=true;b.setAction(a)},openUp:function(){this.chestType.openEffect?this.effects.sheet.spawnOnTarget(this.chestType.openEffect,this,{callback:this,spriteFilter:[1]}):this._reallyOpenUp()},_reallyOpenUp:function(){if(!this.isOpen){this.isOpen=true;this.effects.sheet.spawnOnTarget("openRegular",this);sc.ItemDropEntity.spawnDrops(this,
ig.ENTITY_ALIGN.CENTER,ig.game.playerEntity,this.item,this.amount,sc.ITEM_DROP_TYPE.CHEST);if(!this._noTrack){sc.stats.addMap("chests",sc.map.currentPlayerArea.path,1);sc.stats.addMap("chests","total",1);sc.stats.setMap("chests","totalRate",sc.map.getTotalChestsFound(true))}sc.mapInteract.removeEntry(this.interactEntry);this.setCurrentAnim("open",true,null,true,true);ig.vars.add(this.chestVariable,1);ig.vars.set(this._trigger,true);this.coll.float.height=0;this.coll.shadow.size=0}},isOpened:function(){return this.isOpen},
animationEnded:function(b){b=="open"&&this.setCurrentAnim("end",true,null,true)},varsChanged:function(){this.isOpen||this._updateIcon();this.hideManager&&this.hideManager.varsChanged(this)}});ig.ACTION_STEP.OPEN_CHEST=ig.ActionStepBase.extend({entity:0,init:function(b){this.entity=b.entity},start:function(){var b=ig.Event.getEntity(this.entity);b&&b.openUp&&b.openUp()}});sc.CHEST_TYPE.Default={anim:"idle"};sc.CHEST_TYPE.Bronze={item:sc.CHEST_KEY.BRONZE,anim:"idleBronze",openEffect:"keyOpenBronze"};
sc.CHEST_TYPE.Silver={item:sc.CHEST_KEY.SILVER,anim:"idleSilver",openEffect:"keyOpenSilver"};sc.CHEST_TYPE.Gold={item:sc.CHEST_KEY.GOLD,anim:"idleGold",openEffect:"keyOpenGold"};sc.CHEST_TYPE.Key={anim:"idleKey"};sc.CHEST_TYPE.MasterKey={anim:"idleMasterKey"}});ig.baked=!0;
ig.module("game.feature.puzzle.entities.quick-sand").requires("impact.feature.influencer.influencer","impact.feature.terrain.terrain","impact.feature.effect.effect-sheet").defines(function(){ig.terrain.registerDangerTerrain(ig.TERRAIN.QUICKSAND);ig.QuickSand=ig.Class.extend({influence:null,timer:0,teleportDelay:0,effects:{sheet:new ig.EffectSheet("puzzle.quicksand"),handle:null},init:function(){},onUpdate:function(b,a){var d=a.coll,c=a.stepStats.centerTerrain==ig.TERRAIN.QUICKSAND&&d.pos.z==d.baseZPos;
if(a.currentAction&&a.currentAction.name=="waveTeleportAction"){c=false;this.teleportDelay=0.4}else if(this.teleportDelay){this.teleportDelay=this.teleportDelay-ig.system.tick;if(this.teleportDelay<=0)this.teleportDelay=0;c=false}a instanceof sc.CombatProxyEntity&&(c=false);a instanceof sc.PlayerPetEntity&&(c=false);d.groundConnect!=ig.COLL_GROUND_CONNECT.LOOSE&&(c=false);d.friction.ignoreTerrain&&(c=false);a.respawn&&a.respawn.timer&&(c=false);if(!this.influence&&c){this.influence=new ig.InfluenceEntry;
this.influence.moveXYScale=0.9;b.addInfluence(this.influence);this.timer=0;this.effects.handle=this.effects.sheet.spawnOnTarget("sandTrail",a,{duration:-1})}else if(this.influence&&!c){this.timer/2>0.3&&a.doJump(100,0,80);this.endQuicksand(b,0.1)}if(this.influence){this.timer=this.timer+ig.system.tick;c=this.timer/2;this.influence.groundSinkZ=d.size.z*c;this.influence.moveXYScale=1-c*0.7;if(this.timer>=2)if((d=ig.EntityTools.getGroundEntity(a))&&d.onQuickSandFall&&a.isPlayer){this.endQuicksand(b,
1);d.onQuickSandFall(a)}else{this.endQuicksand(b,0);a.quickFall&&a.quickFall(ig.TERRAIN.QUICKSAND)}}},endQuicksand:function(b,a){a?this.influence.setFadeOut(0.1):b.removeInfluence(this.influence);this.effects.handle.stop();this.influence=this.effects.handle=null}});ig.InfluencerCallbacks.addCallback(ig.QuickSand);ig.ENTITY.QuicksandHole=ig.AnimatedEntity.extend({_wm:new ig.Config({spawnable:true,attributes:{spawnCondition:{_type:"VarCondition",_info:"Condition for Enemy to spawn",_popup:true},map:{_type:"Maps",
_info:"Map to be loaded",_context:"Map"},marker:{_type:"Marker",_info:"Marker on map to teleport player to"}},label:function(){return this.map+"\n"+this.marker}}),effects:{sheet:new ig.EffectSheet("puzzle.quicksand")},init:function(b,a,d,c){this.parent(b,a,d,c);this.coll.type=ig.COLLTYPE.BLOCK;this.coll.setSize(32,32,0);b=ig.mapStyle.get("quicksand");this.initAnimations({sheet:{src:b.sheet,width:32,height:32,offX:b.x,offY:b.y},SUB:[{name:"defaukt",time:0.2,frames:[0,1,2,3],repeat:true}]});this.map=
c.map;this.marker=c.marker;this.influence=new ig.InfluenceEntry;this.influence.setPushType(sc.INFLUENCE_PUSH.PULL,0,0,40);this.influence.setPushEntityCenter(this)},show:function(b){this.parent(b);if(!b){this.animState.alpha=0;ig.game.effects.teleport.spawnOnTarget("showAlpha",this,{})}},update:function(){this.parent()},onQuickSandFall:function(b){this.effects.sheet.spawnOnTarget("sandDive",b);b=new ig.Event({steps:[{type:"TELEPORT",map:this.map,marker:this.marker}]});ig.game.events.callEvent(b,ig.EventRunType.BLOCKING)},
onGroundAdd:function(b){b.influencer&&b.influencer.addInfluence(this.influence)},onGroundRemove:function(b){b.influencer&&b.influencer.removeInfluence(this.influence)}})});ig.baked=!0;
ig.module("game.feature.puzzle.entities.spiderweb").requires("impact.feature.influencer.influencer","impact.feature.terrain.terrain","impact.feature.effect.effect-sheet").defines(function(){ig.Spiderweb=ig.Class.extend({influence:null,timer:0,effects:{sheet:new ig.EffectSheet("puzzle.quicksand"),handle:null},init:function(){},onUpdate:function(b,a){if(a.party!=sc.COMBATANT_PARTY.ENEMY){var d=a.coll,c=a.stepStats.centerTerrain==ig.TERRAIN.SPIDERWEB&&d.pos.z==d.baseZPos;a.isPlayer&&sc.model.player.params.getModifier("SPIDER_SLOW_DOWN_GUARD")>
0&&(c=false);d.groundConnect!=ig.COLL_GROUND_CONNECT.LOOSE&&(c=false);a.respawn&&a.respawn.timer&&(c=false);if(!this.influence&&c){this.influence=new ig.InfluenceEntry;b.addInfluence(this.influence);this.timer=0}else this.influence&&!c&&this.endSpiderweb(b,0.1);if(this.influence){this.timer=this.timer+ig.system.tick;d=(this.timer/0.3).limit(0,1);this.influence.moveXYScale=0.9-d*0.6}}},endSpiderweb:function(b,a){a?this.influence.setFadeOut(a):b.removeInfluence(this.influence);this.influence=null}});
ig.InfluencerCallbacks.addCallback(ig.Spiderweb)});ig.baked=!0;
ig.module("game.feature.puzzle.entities.steam-pipes").requires("impact.base.entity","impact.feature.effect.effect-sheet").defines(function(){sc.STEAM_PIPE_TYPES={};var b=4/220,a=Vec2.create(),d=Vec2.create(),c=Vec3.create();sc.SteamTools={propagateSteam:function(b,c,d,h){for(var c=this.getGlobalPoint(a,b,c),i=ig.game.getEntitiesInRectangle(c.x-1,c.y-1,b.coll.pos.z-1,4,4,4,b),j=i.length;j--;){var k=i[j];if(k.receiveSteam&&k.receiveSteam(c,d,h))return true}h&&h.stop(c,b.coll.pos.z);return false},getClosestPoint:function(a,
b,c,h){var i=this.getGlobalPoint(d,a,b[0]),j=Vec2.distance(i,c),i=this.getGlobalPoint(d,a,b[1]),a=Vec2.distance(i,c);return h&&Math.min(j,a)>h?-1:j<a?0:1},getGlobalPoint:function(a,b,c){a=Vec2.assign(a,c);Vec2.mul(a,b.coll.size);Vec2.add(a,b.coll.pos);return a}};sc.SteamGlowEntity=ig.Entity.extend({lightHandle:null,init:function(a,b,c,d){this.parent(a,b,c,d);this.setSize(0,0,0);this.lightHandle=new ig.LightHandle(this,ig.LIGHT_SIZE.S,0.1,0.3,-1,1,true);ig.light.addLightHandle(this.lightHandle)},stop:function(a,
b){var c=new sc.CircleHitForce(ig.game.playerEntity,{attack:{type:"MASSIVE",element:"HEAT",damageFactor:0,spFactor:0,hints:["STEAM_PIPE"]},pos:Vec3.createC(a.x,a.y,b),radius:4,zHeight:4,duration:0.1,expandRadius:0,alwaysFull:true,party:"OTHER",centralAngle:1});sc.combat.addCombatForce(c);this.lightHandle.stop();this.kill()}});ig.ENTITY.SteamPipe=ig.Entity.extend({pipeType:null,gfx:null,steam:{startPoint:0,duration:0,startTimer:0,endTimer:0,lightTimer:0,propagated:false,glowEntity:null},_wm:new ig.Config({alwaysRecreate:true,
spawnable:true,attributes:{pipeType:{_type:"String",_info:"Type of rail",_select:sc.STEAM_PIPE_TYPES}}}),init:function(a,b,c,d){this.parent(a,b,c,d);this.coll.type=ig.COLLTYPE.BLOCK;a=ig.mapStyle.get("pipes");d=this.pipeType=sc.STEAM_PIPE_TYPES[d.pipeType]||sc.STEAM_PIPE_TYPES.HORIZONTAL;if(a&&d){if(!d.scaleX||this.coll.size.x%16!=0)this.coll.size.x=d.size.x;if(!d.scaleY||this.coll.size.y%16!=0)this.coll.size.y=d.size.y;this.coll.size.z=d.size.z;if(d.scaleX||d.scaleY){if(window.wm){this._wm=this._wm.copy();
this._wm.scalableX=d.scaleX;this._wm.scalableY=d.scaleY;this._wm.scalableStep=16}b=d.scaleX?ig.ImagePattern.OPT.REPEAT_X:ig.ImagePattern.OPT.REPEAT_Y;this.gfx={pattern:new ig.ImagePatternSheet(a.sheet,b,d.gfx.w||16,d.gfx.h|16,a.x+d.gfx.x,a.y+d.gfx.y,1,1),glowPattern:new ig.ImagePatternSheet(a.sheet,b,d.gfx.w||16,d.gfx.h|16,a.x+d.gfx.x,a.y+d.gfx.y+32,1,1)}}else this.gfx={sheet:new ig.Image(a.sheet),x:a.x+d.gfx.x,y:a.y+d.gfx.y}}else this.coll.setSize(16,16,6)},onKill:function(a){if(this.gfx){this.gfx.pattern&&
this.gfx.pattern.decreaseRef();this.gfx.glowPattern&&this.gfx.glowPattern.decreaseRef();this.gfx.sheet&&this.gfx.sheet.decreaseRef()}this.parent(a)},initSprites:function(){this.setSpriteCount(4);for(var a=this.coll,b=this.sprites.length;b--;){var c=this.sprites[b];c.setSize(a.size.x,a.size.y,this.pipeType.renderHeight,a.size.y);c.setPosFromEntity(this,null,null,0)}},update:function(){if(this.steam.duration){if(!this.steam.propagated){this.steam.startTimer=this.steam.startTimer+ig.system.tick;if(this.steam.startTimer>=
this.steam.duration){var b=this.pipeType.points[1-this.steam.startPoint];sc.SteamTools.propagateSteam(this,b,this.steam.fastMode,this.steam.glowEntity);this.steam.propagated=true}}this.steam.lightTimer=this.steam.lightTimer+ig.system.tick;if(this.steam.glowEntity&&this.steam.lightTimer>=this.steam.duration)this.steam.glowEntity=null;if(this.steam.glowEntity&&this.steam.lightTimer>=0){var c=this.pipeType.points[this.steam.startPoint],b=this.pipeType.points[1-this.steam.startPoint],b=Vec2.lerp(c,b,
this.steam.lightTimer/this.steam.duration,a),b=sc.SteamTools.getGlobalPoint(d,this,b),c=Math.round(this.steam.glowEntity.coll.pos.z*0.8+(this.coll.pos.z+(this.coll.size.z==32?17:2))*0.2);this.steam.glowEntity.setPos(b.x,b.y,c)}this.steam.endTimer=this.steam.endTimer+ig.system.tick;if(this.steam.endTimer>=this.steam.duration)this.steam.duration=0}this.parent()},updateSprites:function(){var a=this.sprites[0];this.gfx.pattern?a.setImageSrc(this.gfx.pattern.getPattern(0),0,0):a.setImageSrc(this.gfx.sheet,
this.gfx.x,this.gfx.y);for(var a=3,c=b/(this.steam.fastMode?1:sc.options.get("assist-puzzle-speed"));a--;){var d=this.sprites[a+1];if(this.steam.duration){this.gfx.pattern?d.setImageSrc(this.gfx.glowPattern.getPattern(0),0,0):d.setImageSrc(this.gfx.sheet,this.gfx.x,this.gfx.y+32);d.setGfxCut(0,0,0,0);d.renderMode="lighter";var h=this.pipeType.points[this.steam.startPoint],i=(1-this.steam.startTimer/this.steam.duration).limit(0,1);this._cutSprite(d,h,i);h=this.pipeType.points[1-this.steam.startPoint];
i=((this.steam.endTimer+a*c)/this.steam.duration).limit(0,1);this._cutSprite(d,h,i)}else d.setInvisible()}},_cutSprite:function(a,b,c){if(b.y==0.5){c=Math.round(a.size.x*c);b.x==1?a.gfxCut.left=c:a.gfxCut.right=c}else{c=Math.round((a.size.y+a.size.z)*c);b.y==1?a.gfxCut.top=c:a.gfxCut.bottom=c}},receiveSteam:function(a,b,c){a=sc.SteamTools.getClosestPoint(this,this.pipeType.points,a,4);if(a==-1)return false;this.steam.startPoint=a;var d=this.pipeType.scaleX?this.coll.size.x:this.pipeType.scaleY?this.coll.size.y:
16;this.steam.fastMode=b;b=220*(b?1:sc.options.get("assist-puzzle-speed"));this.steam.duration=d/b;this.steam.startTimer=0;this.steam.endTimer=-40/b;this.steam.lightTimer=-8/b;this.steam.propagated=false;c||(c=ig.game.spawnEntity(sc.SteamGlowEntity,a.x,a.y,this.coll.pos.z,{}));this.steam.glowEntity=c;this.steam.lightHandle=null;return true}});sc.STEAM_PIPE_TYPES.HORIZONTAL={gfx:{x:32,y:0},scaleX:true,size:{x:16,y:12,z:5},renderHeight:4,points:[{x:0,y:0.5},{x:1,y:0.5}]};sc.STEAM_PIPE_TYPES.VERTICAL=
{gfx:{x:32,y:16},scaleY:true,size:{x:16,y:16,z:5},renderHeight:0,points:[{x:0.5,y:0},{x:0.5,y:1}]};sc.STEAM_PIPE_TYPES.CURVE_SE={gfx:{x:0,y:0},size:{x:16,y:12,z:5},renderHeight:4,points:[{x:1,y:0.5},{x:0.5,y:1}]};sc.STEAM_PIPE_TYPES.CURVE_SW={gfx:{x:16,y:0},size:{x:16,y:12,z:5},renderHeight:4,points:[{x:0,y:0.5},{x:0.5,y:1}]};sc.STEAM_PIPE_TYPES.CURVE_NE={gfx:{x:0,y:16},size:{x:16,y:16,z:5},renderHeight:0,points:[{x:0.5,y:0},{x:1,y:0.5}]};sc.STEAM_PIPE_TYPES.CURVE_NW={gfx:{x:16,y:16},size:{x:16,y:16,
z:5},renderHeight:0,points:[{x:0.5,y:0},{x:0,y:0.5}]};sc.STEAM_PIPE_TYPES.END_NORTH={gfx:{x:48,y:6},size:{x:16,y:16,z:5},renderHeight:10,points:[{x:0.5,y:0},{x:0.5,y:1}]};sc.STEAM_PIPE_TYPES.OVEN_EAST={gfx:{x:64,y:0},size:{x:16,y:12,z:32},renderHeight:20,points:[{x:0,y:0.5},{x:1,y:0.5}]};sc.STEAM_PIPE_TYPES.OVEN_WEST={gfx:{x:80,y:0},size:{x:16,y:12,z:32},renderHeight:20,points:[{x:0,y:0.5},{x:1,y:0.5}]};sc.STEAM_PIPE_TYPES.UPPER_PIPE={gfx:{x:96,y:0,w:16,h:32},size:{x:16,y:12,z:32},renderHeight:20,
scaleX:true,points:[{x:0,y:0.5},{x:1,y:0.5}]};sc.STEAM_TURNOUT_TYPES={};ig.ENTITY.SteamTurnout=ig.AnimatedEntity.extend({turnDefault:null,turnAlt:null,condition:null,points:[],isOn:false,effects:{sheet:new ig.EffectSheet("puzzle.water-bubble")},_wm:new ig.Config({alwaysRecreate:true,spawnable:true,attributes:{turnDefault:{_type:"String",_info:"Default turn of turnout",_select:sc.STEAM_TURNOUT_TYPES},turnAlt:{_type:"String",_info:"Alternative turn of turnout",_select:sc.STEAM_TURNOUT_TYPES},condition:{_type:"VarCondition",
_info:"Condition to switch to turnAlt"}}}),init:function(a,b,c,d){this.parent(a,b,c,d);this.coll.type=ig.COLLTYPE.BLOCK;this.coll.setSize(16,16,10);a=ig.mapStyle.get("pipes");b=sc.STEAM_TURNOUT_TYPES[d.turnDefault]||sc.STEAM_TURNOUT_TYPES.CURVE_NE;c=sc.STEAM_TURNOUT_TYPES[d.turnAlt]||sc.STEAM_TURNOUT_TYPES.CURVE_NE;this.points.push(b.points);this.points.push(c.points);this.initAnimations({shapeType:"XY_EXPAND",wallY:1,sheet:{src:a.sheet,width:16,height:24,xCount:3,offX:a.x,offY:a.y+64},SUB:[{name:"off",
time:0.1,frames:[b.tile],repeat:true},{name:"on",time:0.1,frames:[c.tile],repeat:true}]});this.condition=new ig.VarCondition(d.condition);this.isOn=this.condition.evaluate();this.setCurrentAnim(this.isOn?"on":"off")},receiveSteam:function(a,b,c){this.effects.sheet.spawnOnTarget("steamTurnout",this);var d=this.points[this.isOn?1:0],i=sc.SteamTools.getClosestPoint(this,d,a,4);i==-1?c.stop(a,this.coll.pos.z):sc.SteamTools.propagateSteam(this,d[1-i],b,c);return true},varsChanged:function(){var a=this.condition.evaluate();
if(this.isOn!=a){this.isOn=a;this.effects.sheet.spawnOnTarget("turnoutChange",this);this.setCurrentAnim(this.isOn?"on":"off",true)}}});sc.STEAM_TURNOUT_TYPES.HORIZONTAL={tile:2,points:[{x:0,y:0.5},{x:1,y:0.5}]};sc.STEAM_TURNOUT_TYPES.VERTICAL={tile:5,points:[{x:0.5,y:0},{x:0.5,y:1}]};sc.STEAM_TURNOUT_TYPES.CURVE_SE={tile:0,points:[{x:1,y:0.5},{x:0.5,y:1}]};sc.STEAM_TURNOUT_TYPES.CURVE_SW={tile:1,points:[{x:0,y:0.5},{x:0.5,y:1}]};sc.STEAM_TURNOUT_TYPES.CURVE_NE={tile:3,points:[{x:0.5,y:0},{x:1,y:0.5}]};
sc.STEAM_TURNOUT_TYPES.CURVE_NW={tile:4,points:[{x:0.5,y:0},{x:0,y:0.5}]};ig.ENTITY.SteamOven=ig.AnimatedEntity.extend({effects:{sheet:new ig.EffectSheet("puzzle.water-bubble"),handle:null},_wm:new ig.Config({spawnable:true,attributes:{fastMode:{_type:"Boolean",_info:"Make sure puzzle element is not slowed down by assist mode"}}}),init:function(a,b,c,d){this.parent(a,b,c,d);this.coll.type=ig.COLLTYPE.BLOCK;this.coll.setSize(16,16,32);a=ig.mapStyle.get("pipes");this.fastMode=d.fastMode;this.initAnimations({namedSheets:{floor:{src:a.sheet,
width:16,height:16,xCount:1,offX:a.x+80,offY:a.y+64},top:{src:a.sheet,width:16,height:32,xCount:1,offX:a.x+64,offY:a.y+64}},SUB:[{name:"default",sheet:"floor",time:0.2,frames:[0,1,2,1],repeat:true,size:{x:16,y:16,z:0}},{name:"default",sheet:"top",time:0.1,frames:[0],repeat:true,size:{x:16,y:16,z:16},offset:{x:0,y:0,z:12}}]});this.setCurrentAnim("default");this.lightHandle=new ig.LightHandle(this,ig.LIGHT_SIZE.L,0,0.2,-1,1,true);this.lightHandle.setOffset(0,0,-16);ig.light.addLightHandle(this.lightHandle)},
collideWith:function(a,b){if(b&&!Vec2.isZero(b)&&a.isIceDisk&&a.isIceDisk()&&a.coll.pos.z==this.coll.pos.z){this.startSteam();var d=this.getAlignedPos(ig.ENTITY_ALIGN.BOTTOM,c);a.consume(d)}},startSteam:function(){this.effects.sheet.spawnOnTarget("ovenActivate",this);sc.SteamTools.propagateSteam(this,{x:0,y:0.5},this.fastMode);sc.SteamTools.propagateSteam(this,{x:1,y:0.5},this.fastMode)}})});ig.baked=!0;
ig.module("game.feature.puzzle.entities.tesla-coil").requires("impact.base.entity","impact.feature.effect.effect-sheet").defines(function(){function b(a,b){return b.distance-a.distance}var a=Vec3.create();sc.TESLA_COIL_TYPE={};ig.ENTITY.TeslaCoil=ig.AnimatedEntity.extend({chargeTimer:0,chargeHitExceptions:null,source:false,fast:false,effects:{sheet:new ig.EffectSheet("puzzle.tesla"),handle:null},effectAlign:null,_wm:new ig.Config({spawnable:true,attributes:{coilType:{_type:"String",_info:"Type of TeslaCoil",
_select:sc.TESLA_COIL_TYPE},varOnCharge:{_type:"VarName",_info:"Var set to true when tesla coil begins charging",_optional:true},varOnDischarge:{_type:"VarName",_info:"Var set to true when tesla coil discharges",_optional:true},align:{_type:"String",_info:"Alignment of effect relative to target",_select:ig.ENTITY_ALIGN,_optional:true},spawnCondition:{_type:"VarCondition",_info:"Condition for prop to appear",_popup:true}}}),init:function(a,b,e,f){this.parent(a,b,e,f);this.coll.type=ig.COLLTYPE.VIRTUAL;
this.coll.weight=-1;this.coll.zGravityFactor=1E3;if(a=sc.TESLA_COIL_TYPE[f.coilType]||sc.TESLA_COIL_TYPE.SOURCE){Vec3.assign(this.coll.size,a.size);this.source=a.source;this.fast=a.fast||false;if(a.collType)this.coll.type=a.collType;this.dischargeAction=a.dischargeAction||null;b=a.anims;if(b.sheet.src)this.initAnimations(b);else if(e=ig.mapStyle.get("tesla")){b=ig.copy(a.anims);b.sheet.src=e.sheet;b.sheet.offX=b.sheet.offX+e.x;b.sheet.offY=b.sheet.offY+e.y;this.initAnimations(b)}this.setCurrentAnim("off")}this.varOnCharge=
f.varOnCharge||null;this.varOnDischarge=f.varOnDischarge||null;this.effectAlign=f.align||null},show:function(a){this.parent(a);if(!a){this.animState.alpha=0;ig.game.effects.teleport.spawnOnTarget("showFast",this,{})}},onHideRequest:function(){ig.game.effects.teleport.spawnOnTarget("hideDefault",this,{callback:this})},onEffectEvent:function(a){a.isDone()&&this.hide()},onActionEndDetach:function(){this.kill()},extendCharge:function(a){this.chargeHitExceptions=a;this.chargeTimer=0.1},dischargeAction:null,
discharge:function(d){this.varOnDischarge&&ig.vars.set(this.varOnDischarge,true);this.sprites.length>1&&this.sprites[1].setGfxCut(0,0);this.setCurrentAnim("flash",true,"off",true);var c=this.getAlignedPos(ig.ENTITY_ALIGN.BOTTOM,a);c.z=c.z-32;for(var e=ig.game.getEntitiesInCircle(c,96,1,160,null,null,null,this,d),c=e.length,f=[];c--;){var g=e[c];if(g instanceof ig.ENTITY.TeslaCoil&&!g.source||g instanceof ig.ENTITY.OneTimeSwitch&&g.switchType=="teslaSwitch"){var h=ig.CollTools.getGroundDistance(g.coll,
this.coll);f.push({ent:g,distance:h})}}if(f.length){f.sort(b);for(c=f.length;c--;){e=false;for(g=c+1;!e&&g<f.length;++g){h=ig.CollTools.getGroundDistance(f[c].ent.coll,f[g].ent.coll);h<f[c].distance&&(e=true)}e?f.splice(c,1):d.push(f[c].ent)}for(c=f.length;c--;){h=f[c].ent;if(h instanceof ig.ENTITY.TeslaCoil)h.dischargeAction?h.dischargeAction(d,this.effectAlign):h.extendCharge(d);else if(h instanceof ig.ENTITY.OneTimeSwitch){e=h.getAlignedPos(ig.ENTITY_ALIGN.BOTTOM,a);e=new sc.CircleHitForce(ig.game.playerEntity,
{attack:{type:"MASSIVE",element:"HEAT",damageFactor:0,spFactor:0,hints:["LIGHTNING"]},pos:Vec3.createC(e.x,e.y,e.z),radius:4,zHeight:4,duration:0.1,expandRadius:0,alwaysFull:true,party:"OTHER",centralAngle:1});sc.combat.addCombatForce(e)}this.effects.sheet.spawnOnTarget("lightning",h,{align:ig.ENTITY_ALIGN.TOP,target2:this,target2Align:ig.ENTITY_ALIGN.TOP})}}else this.effects.sheet.spawnOnTarget("fail",this,{align:ig.ENTITY_ALIGN.TOP})},update:function(){if(this.chargeTimer){this.chargeTimer=this.chargeTimer-
ig.system.tick;if(this.chargeTimer<=0){this.chargeTimer=0;if(this.effects.handle){this.effects.handle.stop();this.effects.handle=null}this.discharge(this.chargeHitExceptions||[this]);this.chargeHitExceptions=null}else this.source&&this.sprites.length>=2&&this.sprites[1].setGfxCut(48-27*(1-this.chargeTimer/(this.fast?0.5:1)),0)}this.parent()},ballHit:function(a){if(!this.source)return false;var b=a.getHitCenter(this),e=a.getElement();if(!this.chargeTimer&&e==sc.ELEMENT.SHOCK&&a.attackInfo&&a.attackInfo.hasHint("COMPRESSED")){this.varOnCharge&&
ig.vars.set(this.varOnCharge,true);this.chargeTimer=this.fast?0.5:1;this.setCurrentAnim("charge");this.effects.handle=this.effects.sheet.spawnOnTarget("charging",this,{duration:-1,align:ig.ENTITY_ALIGN.TOP});this.effects.sheet.spawnFixed("chargeStart",b.x,b.y,b.z,this)}sc.combat.showHitEffect(this,b,sc.ATTACK_TYPE.NONE,a.getElement(),false,false,true);return true}});sc.TESLA_COIL_TYPE.SOURCE={size:{x:16,y:16,z:32},anims:{sheet:{src:null,width:24,height:48,offX:0,offY:0,xCount:2},wallY:1,SUB:[{name:"off",
time:0.1,frames:[0],repeat:true},{name:"charge",time:0.1,frames:[0],repeat:true},{name:"charge",time:0.1,frames:[1],repeat:true,renderMode:"lighter"},{name:"flash",time:0.1,frames:[0],repeat:false},{name:"flash",time:0.05,frames:[1,1,1,1,1,1,1,1],framesAlpha:[1,1,1,0.9,0.8,0.6,0.4,0.2],repeat:false,renderMode:"lighter"}]},source:true};sc.TESLA_COIL_TYPE.SOURCE_FAST={size:{x:16,y:16,z:32},anims:{sheet:{src:null,width:24,height:48,offX:0,offY:0,xCount:2},wallY:1,SUB:[{name:"off",time:0.1,frames:[0],
repeat:true},{name:"charge",time:0.1,frames:[0],repeat:true},{name:"charge",time:0.1,frames:[1],repeat:true,renderMode:"lighter"},{name:"flash",time:0.1,frames:[0],repeat:false},{name:"flash",time:0.05,frames:[1,1,1,1,1,1,1,1],framesAlpha:[1,1,1,0.9,0.8,0.6,0.4,0.2],repeat:false,renderMode:"lighter"}]},source:true,fast:true};sc.TESLA_COIL_TYPE.SOURCE_LOOSE={size:{x:16,y:16,z:32},anims:{sheet:{src:"media/entity/objects/tesla-loose.png",width:24,height:64,offX:24,offY:0,xCount:2},wallY:0.125,offset:{x:4,
y:0,z:-16},shapeType:"Z_EXPAND",SUB:[{name:"off",time:0.1,frames:[0],repeat:true},{name:"charge",time:0.1,frames:[0],repeat:true},{name:"charge",time:0.1,frames:[1],repeat:true,renderMode:"lighter"},{name:"flash",time:0.1,frames:[0],repeat:false},{name:"flash",time:0.05,frames:[1,1,1,1,1,1,1,1],framesAlpha:[1,1,1,0.9,0.8,0.6,0.4,0.2],repeat:false,renderMode:"lighter"}]},source:true};sc.TESLA_COIL_TYPE.SOURCE_LOOSE_FLIP={size:{x:16,y:16,z:32},anims:{sheet:{src:"media/entity/objects/tesla-loose.png",
width:24,height:64,offX:24,offY:0,xCount:2},wallY:0.125,offset:{x:-4,y:0,z:-16},flipX:true,shapeType:"Z_EXPAND",SUB:[{name:"off",time:0.1,frames:[0],repeat:true},{name:"charge",time:0.1,frames:[0],repeat:true},{name:"charge",time:0.1,frames:[1],repeat:true,renderMode:"lighter"},{name:"flash",time:0.1,frames:[0],repeat:false},{name:"flash",time:0.05,frames:[1,1,1,1,1,1,1,1],framesAlpha:[1,1,1,0.9,0.8,0.6,0.4,0.2],repeat:false,renderMode:"lighter"}]},source:true};sc.TESLA_COIL_TYPE.EXTENDER={size:{x:16,
y:16,z:16},anims:{sheet:{src:null,width:16,height:32,offX:16,offY:48,xCount:2},wallY:0.5,SUB:[{name:"off",time:0.1,frames:[0],repeat:true},{name:"flash",time:0.1,frames:[0],repeat:false},{name:"flash",time:0.05,frames:[1,1,1,1,1,1,1,1],framesAlpha:[1,1,1,0.9,0.8,0.6,0.4,0.2],repeat:false,renderMode:"lighter"}]}};sc.TESLA_COIL_TYPE.EXTENDER_LOOSE={size:{x:16,y:16,z:16},anims:{sheet:{src:"media/entity/objects/tesla-loose.png",width:16,height:40,offX:88,offY:0,xCount:2},wallY:0.5,shapeType:"Z_EXPAND",
offset:{x:0,y:0,z:-8},SUB:[{name:"off",time:0.1,frames:[0],repeat:true},{name:"flash",time:0.1,frames:[0],repeat:false},{name:"flash",time:0.05,frames:[1,1,1,1,1,1,1,1],framesAlpha:[1,1,1,0.9,0.8,0.6,0.4,0.2],repeat:false,renderMode:"lighter"}]}};sc.TESLA_COIL_TYPE.EXTENDER_LOOSE_FLIP={size:{x:16,y:16,z:16},anims:{sheet:{src:"media/entity/objects/tesla-loose.png",width:16,height:40,offX:88,offY:0,xCount:2},wallY:0.5,flipX:true,shapeType:"Z_EXPAND",offset:{x:0,y:0,z:-8},SUB:[{name:"off",time:0.1,frames:[0],
repeat:true},{name:"flash",time:0.1,frames:[0],repeat:false},{name:"flash",time:0.05,frames:[1,1,1,1,1,1,1,1],framesAlpha:[1,1,1,0.9,0.8,0.6,0.4,0.2],repeat:false,renderMode:"lighter"}]}};sc.TESLA_COIL_TYPE.EXTENDER_IGNORE={size:{x:16,y:16,z:16},collType:ig.COLLTYPE.IGNORE,anims:{sheet:{src:null,width:16,height:32,offX:16,offY:48,xCount:2},wallY:0.5,shapeType:"Y_FLAT",SUB:[{name:"off",time:0.1,frames:[0],repeat:true},{name:"flash",time:0.1,frames:[0],repeat:false},{name:"flash",time:0.05,frames:[1,
1,1,1,1,1,1,1],framesAlpha:[1,1,1,0.9,0.8,0.6,0.4,0.2],repeat:false,renderMode:"lighter"}]}};sc.TESLA_COIL_TYPE.GROUND_DISCHARGE={size:{x:16,y:16,z:16},anims:{sheet:{src:null,width:16,height:32,offX:16,offY:80,xCount:2},wallY:1,SUB:[{name:"off",time:0.1,frames:[0],repeat:true},{name:"flash",time:0.1,frames:[0],repeat:false},{name:"flash",time:0.05,frames:[1,1,1,1,1,1,1,1],framesAlpha:[1,1,1,0.9,0.8,0.6,0.4,0.2],repeat:false,renderMode:"lighter"}]},dischargeAction:function(b,c){this.setCurrentAnim("flash",
true,"off",true);this.effects.sheet.spawnOnTarget("groundShock",this,{align:c||ig.ENTITY_ALIGN.BOTTOM});var e=this.getAlignedPos(ig.ENTITY_ALIGN.BOTTOM,a),e=new sc.CircleHitForce(ig.game.playerEntity,{attack:{type:"MASSIVE",element:"SHOCK",damageFactor:1,spFactor:0,hints:["GROUND_SHOCK"]},pos:Vec3.createC(e.x,e.y,e.z),radius:16,zHeight:48,duration:0.2,expandRadius:64,alwaysFull:true,party:"OTHER",centralAngle:1});sc.combat.addCombatForce(e)}};sc.TESLA_COIL_TYPE.WHALE_DISCHARGE={size:{x:16,y:16,z:16},
anims:{sheet:{src:"media/entity/objects/tesla-loose.png",width:16,height:24,offX:88,offY:0,xCount:2},wallY:1,offset:{x:0,y:-8,z:0},SUB:[{name:"off",time:0.1,frames:[0],repeat:true},{name:"flash",time:0.1,frames:[0],repeat:false},{name:"flash",time:0.05,frames:[1,1,1,1,1,1,1,1],framesAlpha:[1,1,1,0.9,0.8,0.6,0.4,0.2],repeat:false,renderMode:"lighter"}]},dischargeAction:function(){this.setCurrentAnim("flash",true,"off",true);this.effects.sheet.spawnOnTarget("groundShock",this,{align:ig.ENTITY_ALIGN.BOTTOM});
var b=this.getAlignedPos(ig.ENTITY_ALIGN.BOTTOM,a),b=new sc.CircleHitForce(ig.game.playerEntity,{attack:{type:"MASSIVE",element:"SHOCK",damageFactor:1,spFactor:0,hints:["GROUND_SHOCK"]},pos:Vec3.createC(b.x,b.y,b.z-16),radius:16,zHeight:16,duration:0.2,expandRadius:64,alwaysFull:true,party:"PLAYER",centralAngle:1});sc.combat.addCombatForce(b)}};sc.TESLA_COIL_TYPE.GROUND_DISCHARGE_FISH={size:{x:16,y:16,z:16},anims:{sheet:{src:null,width:16,height:32,offX:16,offY:80,xCount:2},wallY:1,SUB:[{name:"off",
time:0.1,frames:[0],repeat:true},{name:"flash",time:0.1,frames:[0],repeat:false},{name:"flash",time:0.05,frames:[1,1,1,1,1,1,1,1],framesAlpha:[1,1,1,0.9,0.8,0.6,0.4,0.2],repeat:false,renderMode:"lighter"}]},dischargeAction:function(b,c){this.setCurrentAnim("flash",true,"off",true);this.effects.sheet.spawnOnTarget("groundShock",this,{align:c||ig.ENTITY_ALIGN.BOTTOM});var e=this.getAlignedPos(ig.ENTITY_ALIGN.BOTTOM,a),e=new sc.CircleHitForce(ig.game.playerEntity,{attack:{type:"NONE",element:"NEUTRAL",
damageFactor:1,spFactor:0,hints:["DISCHARGE_FISH"],hitInvincible:true,limiter:"SIGNAL"},pos:Vec3.createC(e.x,e.y,e.z-32),radius:128,zHeight:96,duration:0,expandRadius:0,alwaysFull:true,party:"OTHER",centralAngle:1});sc.combat.addCombatForce(e)}}});ig.baked=!0;
ig.module("game.feature.puzzle.entities.wave-teleport").requires("impact.base.entity","impact.feature.effect.effect-sheet","game.feature.combat.combat-target-event").defines(function(){var b=Vec2.create(),a=Vec2.create(),d=Vec2.create();sc.COMBAT_ENEMY_EVENT.WAVE_TELEPORT={_wm:{attributes:{angle:{_type:"Number",_info:"Minimum angle different between vectors pointing to old and new target position. 0.5= at least 90 degree difference. 1.0= essentially impossible (180 degree)"}}},check:function(b,e,
f,g){e=ig.CollTools.getDistVec2(b.coll,e.coll,a);b=b.getCenter(d);Vec2.sub(b,f.newPos);Vec2.flip(b);return Vec2.angle(e,b)>=g.angle*Math.PI}};ig.ENTITY.WaveTeleport=ig.AnimatedEntity.extend({effects:{sheet:new ig.EffectSheet("puzzle.wave-teleport"),handle:null,hideHandle:null},teleportTimer:0,teleportTargets:[],_wm:new ig.Config({spawnable:true,attributes:{spawnCondition:{_type:"VarCondition",_info:"Condition for Enemy to spawn",_popup:true}}}),permaRemove:false,delayedHide:false,init:function(a,
b,d,g){this.parent(a,b,d,g);this.coll.type=ig.COLLTYPE.TRIGGER;this.coll.setSize(16,16,24);this.coll.shadow.size=16;this.coll.zGravityFactor=9001;this.coll.setPadding(4,4);this.initAnimations({shapeType:"Y_FLAT",offset:{x:0,y:-4,z:8},sheet:{src:"media/entity/objects/object-effects.png",width:24,height:24,xCount:5,offX:128,offY:40},SUB:[{name:"idle",time:0.1,frames:[0],repeat:true,framesAlpha:[0.5]},{name:"idle",time:0.133,frames:[1,2,3,4],repeat:true,renderMode:"lighter"}]});this.setCurrentAnim("idle")},
show:function(a){this.parent(a);if(this.effects.hideHandle){this.effects.hideHandle.stop();this.effects.hideHandle=null}if(!a){this.animState.alpha=0;this.effects.sheet.spawnOnTarget("appear",this,{align:ig.ENTITY_ALIGN.CENTER})}},onActionEndDetach:function(){this.effects.hideHandle=this.effects.sheet.spawnOnTarget("disappear",this,{align:ig.ENTITY_ALIGN.CENTER,callback:this});this.permaRemove=true},onHideRequest:function(){this.effects.hideHandle=this.effects.sheet.spawnOnTarget("disappear",this,
{align:ig.ENTITY_ALIGN.CENTER,callback:this})},onEffectEvent:function(a){if(a.isDone()&&this.effects.hideHandle){this.effects.hideHandle=null;this.teleportTimer?this.delayedHide=true:this.permaRemove?this.kill():this.hide()}},startTeleport:function(){if(this.teleportTargets.length==0){this.teleportTargets.push(ig.game.playerEntity);for(var a=sc.party.getPartySize();a--;){var d=sc.party.getPartyMemberEntityByIndex(a);d&&this.teleportTargets.push(d)}}d=new ig.Action("waveTeleportAction",[{type:"WAIT",
time:-1}]);d.eventAction=true;for(a=this.teleportTargets.length;a--;){var f=this.teleportTargets[a],g=f.getCenter(b);this.effects.sheet.spawnFixed("trail",g.x,g.y,f.coll.pos.z+12,null,{target2:this,target2Align:ig.ENTITY_ALIGN.CENTER});this.effects.sheet.spawnOnTarget("hide",f,{target2:this,target2Align:ig.ENTITY_ALIGN.CENTER});if(f instanceof ig.ENTITY.Combatant){f.invincibleTimer=-1;f.setAction(d)}f.onTeleportStart&&f.onTeleportStart(this);f=ig.game.getEntitiesOnTop(f);for(g=f.length;g--;)f[g]instanceof
ig.ENTITY.WavePushPullBlock||this.effects.sheet.spawnOnTarget("hide",f[g],{target2:this,target2Align:ig.ENTITY_ALIGN.CENTER})}this.teleportTimer=0.1},doTeleport:function(){for(var a=0,d=new ig.Action("waveTeleportAction",[{type:"WAIT",time:0}]),f=this.teleportTargets.length,g=0;g<f;++g){var h=this.teleportTargets[g],i=this.getCenter(b);h.sendEnemyEvent&&h.sendEnemyEvent(sc.COMBAT_ENEMY_EVENT.WAVE_TELEPORT,{newPos:i});if(h instanceof ig.ENTITY.Combatant)h.invincibleTimer=0;if(h instanceof sc.PartyMemberEntity)h.resetPos();
else{for(var j=ig.game.getEntitiesOnTop(h),k=i.x-h.coll.size.x/2,i=i.y-h.coll.size.y/2,l=this.coll.pos.z+a,o=j.length;o--;)if(j[o]instanceof ig.ENTITY.WavePushPullBlock)j[o].coll.setGroundEntry(null);else{this.effects.sheet.spawnOnTarget("show",j[o]);var m=j[o].coll;m.setGroundEntry(null);m.setPos(m.pos.x+k-h.coll.pos.x,m.pos.y+i-h.coll.pos.y,m.pos.z+l-h.coll.pos.z)}l=h.getTeleportZOffset?l+h.getTeleportZOffset():l+h.coll.float.height;h.setPos(k,i,l);a=a+h.coll.size.z}if(h.isPlayer){ig.camera.isActiveTarget(h.cameraHandle)&&
ig.camera.retarget("FASTER",KEY_SPLINES.EASE_IN_OUT);d.eventAction=true}this.effects.sheet.spawnOnTarget("show",h);h.setAction&&h.setAction(d);h.doTeleport&&h.doTeleport(this)}this.teleportTargets.length=0},update:function(){this.animState.angle=this.animState.angle+ig.system.tick*1;if(this.teleportTimer){this.teleportTimer=this.teleportTimer-ig.system.tick;if(this.teleportTimer<=0){this.teleportTimer=0;this.doTeleport();if(this.delayedHide){this.delayedHide=true;this.permaRemove?this.kill():this.hide()}}}this.parent()},
hasBlockOnTop:function(){for(var a=this.coll,a=ig.game.getEntitiesInRectangle(a.pos.x-8,a.pos.y-8,a.pos.z,a.size.x+16,a.size.y+16,a.size.z,this),b=a.length;b--;){var d=a[b];if(d instanceof ig.ENTITY.WavePushPullBlock||d instanceof ig.ENTITY.PushPullBlock||d instanceof sc.FerroEntity)return true}return false},ballHit:function(a){var b=a.getHitCenter(this),d=a.getElement();if(this.hasBlockOnTop())return false;var g=(a.isBall||a instanceof sc.CompressedWaveEntity)&&a.getCombatantRoot().isPlayer;if((!a.isBall||
a.attackInfo.hasHint("CHARGED"))&&g&&d==sc.ELEMENT.WAVE&&!this.teleportTimer){d=a.entityAttached;for(g=d.length;g--;)if(d[g].doTeleport){this.teleportTargets.push(d[g]);d.splice(g,1)}if(this.teleportTargets.length==0&&a.isBall&&!ig.EntityTools.isInScreen(this,32)||this.teleportTargets.length==0&&ig.CollTools.getGroundDistance(this.coll,ig.game.playerEntity.coll)<48||this.teleportTargets.length==0&&ig.game.playerEntity.currentAction&&ig.game.playerEntity.currentAction.eventAction)return false;sc.combat.showHitEffect(this,
b,sc.ATTACK_TYPE.NONE,a.getElement(),false,false,true);this.startTeleport();return true}return false},isBallDestroyer:function(a,b,d){return!d||sc.model.player.currentElementMode!=sc.ELEMENT.WAVE||ig.CollTools.getGroundDistance(this.coll,ig.game.playerEntity.coll)<48||this.hasBlockOnTop()?false:true}})});ig.baked=!0;
ig.module("game.feature.puzzle.puzzle-steps").requires("impact.base.action","impact.base.event","impact.base.entity").defines(function(){var b=Vec3.create(),a=Vec3.create(),d=Vec2.create();ig.EVENT_STEP.DESTROY_DESTRUCTIBLE=ig.EventStepBase.extend({entity:null,_wm:new ig.Config({attributes:{entity:{_type:"Entity",_info:"Destructible to destroy"}}}),init:function(a){this.entity=a.entity||null},start:function(a,b){var c=ig.Event.getEntity(this.entity,b);c&&c.startDestruction&&c.startDestruction()}});
ig.ACTION_STEP.ALIGN_PUSH_PULL_POS=ig.ActionStepBase.extend({component:null,duration:0,init:function(a){this.component=a.component;this.duration=a.duration},start:function(a){a.stepData.startPos=a.getAlignedPos(ig.ENTITY_ALIGN.BOTTOM);a.stepData.duration=this.duration;a.stepTimer=a.stepData.duration},run:function(a){var c=1-(a.stepTimer/a.stepData.duration).limit(0,1);this.component.getGripPosAndFace(b);Vec3.lerp(a.stepData.startPos,b,c,b);a.setPos(b.x-a.coll.size.x/2,b.y-a.coll.size.y/2,b.z,true);
return c>=1}});ig.EVENT_STEP.RESET_PUSH_PULL_POS=ig.EventStepBase.extend({_wm:new ig.Config({attributes:{entity:{_type:"Entity",_info:"Pushpull entity"},pos:{_type:"Vec3",_info:"If defined, reset to this position",_actorOption:true,_visualize:true,_pointSelect:true,_optional:true}}}),init:function(a){this.entity=a.entity;this.pos=a.pos||null},start:function(a,c){var d=ig.Event.getEntity(this.entity,c);if(d){var e=null;this.pos&&(e=ig.Event.getVec3(this.pos,b));d.resetPos&&d.resetPos(e)}}});ig.ACTION_STEP.DO_WAVE_TELEPORT=
ig.ActionStepBase.extend({entity:null,init:function(a){this.entity=a.entity},start:function(){this.entity.doTeleport()}});ig.ACTION_STEP.THROW_BOMB=ig.ActionStepBase.extend({gfx:null,offset:null,align:null,speed:null,zVel:null,timeAdvance:null,_wm:new ig.Config({attributes:{offset:{_type:"Offset",_info:"Offset relative to entity ground center from which to shoot"},align:{_type:"String",_info:"Alignment relative to entity from which to shoot",_select:ig.ENTITY_ALIGN},speed:{_type:"Number",_info:"The XY speed of the thrown bomb",
_optional:true},zVel:{_type:"Number",_info:"The z speed of the thrown bomb",_optional:true},timeAdvance:{_type:"Number",_info:"Time in seconds the timer of the bomb should be advanced"}}}),init:function(a){this.offset=a.offset;this.align=a.align;this.speed=a.speed;this.zVel=a.zVel;this.timeAdvance=a.timeAdvance||0;a=ig.mapStyle.get("puzzle2");this.gfx=new ig.Image(a.sheet)},clearCached:function(){this.gfx.decreaseRef()},start:function(a){var c=a.getAlignedPos(this.align,b);this.offset&&Vec3.add(c,
this.offset);c=ig.game.spawnEntity(sc.BombEntity,c.x,c.y,c.z,{});c.start(a.face,a,this.speed,this.zVel);c.timer=c.timer-this.timeAdvance}});var c=[];ig.ACTION_STEP.RAIN_BOMB=ig.ActionStepBase.extend({gfx:null,count:null,offset:null,align:null,area:null,zVary:null,_wm:new ig.Config({attributes:{count:{_type:"Integer",_info:"Number of bombs"},offset:{_type:"Offset",_info:"Offset relative to entity ground center from which to shoot"},align:{_type:"String",_info:"Alignment relative to entity from which to shoot",
_select:ig.ENTITY_ALIGN},area:{_type:"Vec2",_info:"Area on which to rain the bombs randomly"},zVary:{_type:"Number",_info:"Value to +- vary the z height"}}}),init:function(a){this.count=a.count;this.offset=a.offset;this.align=a.align;this.area=a.area;this.zVary=a.zVary||0;a=ig.mapStyle.get("puzzle2");this.gfx=new ig.Image(a.sheet)},clearCached:function(){this.gfx.decreaseRef()},start:function(a){a=a.getAlignedPos(this.align,b);this.offset&&Vec3.add(a,this.offset);for(var e=this.count;e--;){var h=
5;do{var i=false,j=Vec2.assignC(d,0,0);j.x=(Math.random()-0.5)*this.area.x;j.y=(Math.random()-0.5)*this.area.y;for(var k=c.length;k--;)if(Vec2.distance(c[k],j)<48){i=true;break}}while(h--&&i);c.push(Vec2.create(j));h=(Math.random()-0.5)*this.zVary;j=ig.game.spawnEntity(sc.BombEntity,a.x+j.x,a.y+j.y,a.z+h,{});j.noHeatFocus=true;j.coll.zBounciness=0.25}c.length=0}});ig.EVENT_STEP.SPAWN_BOMB=ig.EventStepBase.extend({gfx:null,pos:null,offset:null,align:null,area:null,zVary:null,_wm:new ig.Config({attributes:{point:{_type:"Vec3",
_info:"Where to spawn bomb",_visualize:true,_pointSelect:true},zHeight:{_type:"Number",_info:"From how height the bomb will fall"},zVary:{_type:"Number",_info:"Value to +- vary the z height"}}}),init:function(a){this.point=a.point;this.zHeight=a.zHeight;this.zVary=a.zVary||0;a=ig.mapStyle.get("puzzle2");this.gfx=new ig.Image(a.sheet)},clearCached:function(){this.gfx.decreaseRef()},start:function(){var a=ig.Event.getVec3(this.point,b);a.z=a.z+(this.zHeight+(Math.random()-0.5)*this.zVary);a=ig.game.spawnEntity(sc.BombEntity,
a.x,a.y,a.z,{});a.noHeatFocus=true;a.coll.zBounciness=0.25}});ig.EVENT_STEP.SPAWN_BUBBLE=ig.EventStepBase.extend({offset:null,_wm:new ig.Config({attributes:{point:{_type:"Vec3",_info:"Where to spawn bubble",_visualize:true,_pointSelect:true}}}),init:function(a){this.point=a.point},start:function(){var a=ig.Event.getVec3(this.point,b);ig.game.spawnEntity(sc.WaterBubbleEntity,a.x,a.y,a.z,{})}});ig.EVENT_STEP.DESTROY_BOMBS=ig.EventStepBase.extend({_wm:new ig.Config({attributes:{}}),init:function(){},
clearCached:function(){},start:function(){for(var a=ig.game.getEntitiesByType(sc.BombEntity),b=a.length;b--;)a[b].explode()}});ig.ACTION_STEP.SHOOT_BUBBLE=ig.ActionStepBase.extend({gfx:null,offset:null,align:null,speed:null,zVel:null,timeAdvance:null,_wm:new ig.Config({attributes:{offset:{_type:"Offset",_info:"Offset relative to entity ground center from which to shoot"},align:{_type:"String",_info:"Alignment relative to entity from which to shoot",_select:ig.ENTITY_ALIGN},duration:{_type:"Number",
_info:"Time in seconds until bubble explodes",_default:3}}}),init:function(a){this.offset=a.offset;this.align=ig.ENTITY_ALIGN[a.align]||ig.ENTITY_ALIGN.BOTTOM;this.gfx=new ig.Image("media/entity/objects/object-effects.png");this.duration=a.duration||3},clearCached:function(){this.gfx.decreaseRef()},start:function(a){var c=a.getAlignedPos(this.align,b);this.offset&&Vec3.add(c,this.offset);ig.game.spawnEntity(sc.WaterBubbleEntity,c.x,c.y,c.z,{combatant:a.getCombatantRoot(),target:a.getTarget(),targetTime:this.duration})}});
ig.ACTION_STEP.SET_ELEMENT_POLE_TIMER=ig.ActionStepBase.extend({_wm:new ig.Config({attributes:{time:{_type:"Number",_info:"Minimum time that currently targeted element pole should have, if temporary"}}}),init:function(a){this.time=a.time},start:function(a){(a=a.tmpTarget)&&a instanceof ig.ENTITY.ElementPole&&a.resetTimer(this.time)}});ig.ACTION_STEP.PLACE_WAVE_TELEPORT=ig.ActionStepBase.extend({_wm:new ig.Config({attributes:{align:{_type:"String",_info:"Alignment relative to entity from which to shoot",
_select:ig.ENTITY_ALIGN}}}),init:function(a){this.align=ig.ENTITY_ALIGN[a.align]},start:function(a){var c=a.getAlignedPos(this.align,b);c.x=c.x-8;c.y=c.y-8;c=ig.game.spawnEntity(ig.ENTITY.WaveTeleport,c.x,c.y,c.z,{});a.addActionAttached(c)}});var e={EXTENDER_LOOSE:["EXTENDER_LOOSE","EXTENDER_LOOSE_FLIP"],SOURCE_LOOSE:["SOURCE_LOOSE","SOURCE_LOOSE_FLIP"],WHALE_DISCHARGE:["WHALE_DISCHARGE"]};ig.ACTION_STEP.PLACE_TESLA_COIL=ig.ActionStepBase.extend({_wm:new ig.Config({attributes:{align:{_type:"String",
_info:"Alignment relative to entity from which to shoot",_select:ig.ENTITY_ALIGN},teslaType:{_type:"String",_info:"Type of Teslacoil",_select:e}}}),init:function(a){this.align=ig.ENTITY_ALIGN[a.align];this.teslaType=e[a.teslaType]||e.EXTENDER_LOOSE},start:function(a){var c=a.getAlignedPos(this.align,b);c.x=c.x-8;c.y=c.y-8;var d=this.teslaType.random(),c=ig.game.spawnEntity(ig.ENTITY.TeslaCoil,c.x,c.y,c.z,{coilType:d});a.addActionAttached(c)}});ig.ACTION_STEP.PLACE_ELEMENT_SHIELD=ig.ActionStepBase.extend({_wm:new ig.Config({attributes:{align:{_type:"String",
_info:"Alignment relative to entity from which to shoot",_select:ig.ENTITY_ALIGN},element:{_type:"String",_info:"Element of Shield Ball",_select:["HEAT","COLD","SHOCK","WAVE"]}}}),init:function(a){this.align=ig.ENTITY_ALIGN[a.align];this.element=a.element},start:function(a){var c=a.getAlignedPos(this.align,b),c=ig.game.spawnEntity(sc.ElementShieldBallEntity,c.x,c.y,c.z,{element:this.element},true);a.addActionAttached(c)}});ig.ACTION_STEP.WAIT_UNTIL_ELEMENT_SHIELD_USED=ig.ActionStepBase.extend({_wm:new ig.Config({attributes:{}}),
init:function(a){this.align=ig.ENTITY_ALIGN[a.align];this.element=a.element},run:function(a){for(var a=a.actionAttached,b=a.length;b--;)if(a[b]instanceof sc.ElementShieldBallEntity&&!a[b].isDestroyed())return false;return true}});ig.ACTION_STEP.STOP_PLAYER_ELEMENT_SHIELD=ig.ActionStepBase.extend({_wm:new ig.Config({attributes:{}}),init:function(a){this.align=ig.ENTITY_ALIGN[a.align];this.element=a.element},start:function(){sc.ElementShieldEntity.clearRunningShields(ig.game.playerEntity)}});ig.EVENT_STEP.STOP_PLAYER_ELEMENT_SHIELD=
ig.EventStepBase.extend({_wm:new ig.Config({attributes:{}}),init:function(a){this.align=ig.ENTITY_ALIGN[a.align];this.element=a.element},start:function(){sc.ElementShieldEntity.clearRunningShields(ig.game.playerEntity)}});ig.ACTION_STEP.DO_PLATFORM_SHOCKWAVE=ig.ActionStepBase.extend({_wm:new ig.Config({attributes:{align:{_type:"String",_info:"Alignment relative to entity from which to start shockwave",_select:ig.ENTITY_ALIGN},offset:{_type:"Offset",_info:"Offset to position"},height:{_type:"Number",
_info:"How high platforms should move"},duration:{_type:"Number",_info:"Duration of height movement"},range:{_type:"Number",_info:"Total range of impact"},expandSpeed:{_type:"Number",_info:"How fast to expand shockwave along xy (pixels per seconds)"},minDistance:{_type:"Number",_info:"Minimum distance to center for platform to move"},color:{_type:"String",_info:"Color to blink while going up",_optional:true}}}),init:function(a){this.align=ig.ENTITY_ALIGN[a.align];this.offset=a.offset||null;this.height=
a.height||24;this.range=a.range||600;this.duration=a.duration||1;this.expandSpeed=a.expandSpeed||200;this.minDistance=a.minDistance||0;this.color=a.color||null},start:function(a){a=a.getAlignedPos(this.align,b);this.offset&&Vec3.add(a,this.offset);sc.BossPlatforms.startImpact(a,this.height,this.range,this.expandSpeed,this.duration,this.minDistance,this.color)}});ig.EVENT_STEP.FIX_SHOCKWAVE_PLATFORMS=ig.EventStepBase.extend({_wm:new ig.Config({attributes:{pointA:{_type:"Vec3",_info:"Point of first platform to be fixed",
_visualize:true,_pointSelect:true},pointB:{_type:"Vec3",_info:"If defined: Rise all platforms overlapping with the bounding box of A and B",_visualize:true,_pointSelect:true,_optional:true},height:{_type:"Number",_info:"How high platforms should be fixed"},minHeight:{_type:"Number",_info:"If defined, will vary height randomly between this value and height",_optional:true}}}),init:function(a){this.pointA=a.pointA||null;this.pointB=a.pointB||null;this.height=a.height||24;this.minHeight=a.minHeight||
null},start:function(){if(this.pointA)for(var c=ig.Event.getVec3(this.pointA,b),d=this.pointB?ig.Event.getVec3(this.pointB,a):c,e=Math.min(c.x,d.x),i=Math.max(c.x,d.x),j=Math.min(c.y,d.y),d=Math.max(c.y,d.y),c=ig.game.getEntitiesInRectangle(e-1,j-1,c.z-1,i-e+2,d-j+2,2),e=c.length;e--;)if(c[e]instanceof ig.ENTITY.BossPlatform){i=this.height;this.minHeight&&(i=Math.round(i-(this.height-this.minHeight)*Math.random()));c[e].setFixedHeight(i)}}});ig.EVENT_STEP.RELEASE_FIXED_PLATFORMS=ig.EventStepBase.extend({_wm:new ig.Config({attributes:{}}),
init:function(){},start:function(){sc.BossPlatforms.releaseHeightFix()}})});ig.baked=!0;
ig.module("game.feature.puzzle.entities.rotate-blocker").requires("impact.base.entity","impact.feature.effect.effect-sheet","game.feature.interact.map-interact").defines(function(){sc.ROTATE_BLOCKER_DIR={NE:0,SE:1,SW:2,NW:3};var b=[{angle:0,collShape:ig.COLLSHAPE.SLOPE_NE,anim:"ne"},{angle:0.25,collShape:ig.COLLSHAPE.SLOPE_SE,anim:"se"},{angle:0.5,collShape:ig.COLLSHAPE.SLOPE_SW,anim:"sw"},{angle:0.75,collShape:ig.COLLSHAPE.SLOPE_NW,anim:"nw"}];ig.ENTITY.RotateBlocker=ig.AnimatedEntity.extend({_wm:new ig.Config({spawnable:true,
attributes:{spawnCondition:{_type:"VarCondition",_info:"Condition for Enemy to spawn",_popup:true,_optional:true},dir:{_type:"String",_info:"Start direction of triangular block shape",_select:sc.ROTATE_BLOCKER_DIR},condition:{_type:"VarCondition",_info:"Condition for RotateBlocker to be active"}}}),active:true,currentDir:0,currentAngle:0,destAngle:0,turnTimer:0,interactIcons:{vertical:new sc.MapInteractIcon(new ig.TileSheet("media/gui/map-icon.png",24,24,120,24),{FOCUS:[0,1,2,2],NEAR:[3]},0.133)},
effects:{sheet:null},init:function(a,d,c,e){this.parent(a,d,c,e);this.coll.type=ig.COLLTYPE.BLOCK;this.setSize(32,32,32);this.currentDir=sc.ROTATE_BLOCKER_DIR[e.dir]||sc.ROTATE_BLOCKER_DIR.NE;a=b[this.currentDir];this.destAngle=this.currentAngle=a.angle;this.coll.shape=a.collShape;(d=ig.mapStyle.get("rotateBlocker"))&&this.initAnimations({namedSheets:{ground:{src:d.sheet,width:32,height:32,offX:d.x,offY:d.y,xCount:1},block:{src:d.sheet,width:32,height:64,offX:d.x+32,offY:d.y}},SUB:[{sheet:"ground",
shapeType:"Z_FLAT",frames:[1],SUB:[{name:"off"},{name:"ne"},{name:"se"},{name:"sw"},{name:"nw"},{name:"turn"}]},{sheet:"block",renderMode:"lighter",SUB:[{name:"ne",frames:[1],flipX:false},{name:"se",frames:[0],flipX:false,wallY:1},{name:"sw",frames:[0],flipX:true,wallY:1},{name:"nw",frames:[1],flipX:true}]},{sheet:"ground",shapeType:"Y_FLAT",renderMode:"lighter",frames:[0],SUB:[{name:"turn",offset:{z:1}},{name:"turn",offset:{z:4}},{name:"turn",offset:{z:8}},{name:"turn",offset:{z:12}},{name:"turn",
offset:{z:16}},{name:"turn",offset:{z:20}},{name:"turn",offset:{z:24}},{name:"turn",offset:{z:28}},{name:"turn",offset:{z:32}}]}]});this.setCurrentAnim(a.anim);this.interactEntry=new sc.MapInteractEntry(this,this,this.interactIcons.vertical,sc.INTERACT_Z_CONDITION.SAME_Z,false);this.effects.sheet=new ig.EffectSheet("puzzle.rotate-blocker");this.condition=new ig.VarCondition(e.condition)},show:function(a){this.parent(a);if(this.effects.hideHandle){this.effects.hideHandle.stop();this.effects.hideHandle=
null}window.wm||this.setActive(this.condition.evaluate(),true);if(!a){this.animState.alpha=0;ig.game.effects.teleport.spawnOnTarget("showFast",this,{})}},onHideRequest:function(){sc.mapInteract.removeEntry(this.interactEntry);this.effects.hideHandle=ig.game.effects.teleport.spawnOnTarget("hideFast",this,{callback:this})},setActive:function(a,d){this.turnTimer=0;this.active=a;if(this.effects.deactHandle){this.effects.deactHandle.setCallback(null);this.effects.deactHandle=null}if(this.active){this.coll.setType(ig.COLLTYPE.BLOCK);
this.setCurrentAnim(b[this.currentDir].anim);sc.mapInteract.addEntry(this.interactEntry);d||this.effects.sheet.spawnOnTarget("appear",this,{spriteFilter:[1]})}else{this.coll.setType(ig.COLLTYPE.TRIGGER);sc.mapInteract.removeEntry(this.interactEntry);d?this.setCurrentAnim("off"):this.effects.deactHandle=this.effects.sheet.spawnOnTarget("disappear",this,{spriteFilter:[1]})}},onEffectEvent:function(a){if(a==this.effects.deactHandle){this.effects.deactHandle=null;this.setCurrentAnim("off")}else if(a==
this.effects.hideHandle){this.effects.hideHandle=null;this.hide()}},onKill:function(a){this.effects.sheet.decreaseRef();this.parent(a)},onInteraction:function(){this.turn((this.currentDir+1)%4);var a=ig.game.playerEntity,b=new ig.Action("openChest",[{type:"SET_WALK_ANIMS",config:"normal"},{type:"SET_RELATIVE_SPEED",value:0.5},{type:"SET_FACE_TO_ENTITY",entity:this,rotate:true},{type:"SET_FACE_FIX",value:true},{type:"SHOW_ANIMATION",anim:"chestOpen"},{type:"MOVE_TO_ENTITY_DISTANCE",entity:this,min:28,
max:40,maxTime:0.2},{type:"WAIT",time:0.2}]);b.eventAction=true;a.setAction(b);return false},ballHit:function(a){a.isBall&&a.cleanDirection(0.025);return false},turn:function(a){this.effects.sheet.spawnOnTarget("rotate",this);this.currentDir=a;this.currentAngle=this.destAngle%1;a=b[this.currentDir];this.destAngle=a.angle||1;this.coll.shape=a.collShape;this.setCurrentAnim("turn");this.turnTimer=0.2+0.1},update:function(){if(this.turnTimer){this.turnTimer=this.turnTimer-ig.system.tick;if(this.turnTimer<=
0){this.turnTimer=0;this.setCurrentAnim(b[this.currentDir].anim);this.currentAngle=this.destAngle%1}}this.parent()},updateSprites:function(){ig.AnimatedEntity.prototype.updateSprites.call(this);if(this.turnTimer)for(var a=this.sprites.length-1,b=0.1/(a-1),c=0;a--;){var e=this.sprites[a+1],f=1-((this.turnTimer-0.1+c)/0.2).limit(0,1),f=KEY_SPLINES.EASE_IN_OUT.get(f),f=this.currentAngle*(1-f)+this.destAngle*f;e.setPivot(16,16);e.setTransform(1,1,f*2*Math.PI);c=c+b}},varsChanged:function(){var a=this.condition.evaluate();
a!=this.active&&this.setActive(a)}})});ig.baked=!0;
ig.module("game.feature.puzzle.entities.boss-platform").requires("impact.base.entity","impact.feature.base.entities.object-layer-view").defines(function(){var b=Vec3.create(),a=Vec2.create();sc.BossPlatforms={list:[],registerPlatform:function(a){this.list.push(a)},unregisterPlatform:function(a){this.list.push(a)},startImpact:function(b,c,e,f,g,h,i){for(var f=e/f,j=this.list.length;j--;){var k=this.list[j],l=k.getCenter(a);Vec2.sub(l,b);l=Vec2.length(l);if(l<e&&l>=h){var o=1-1*(l/e);k.nudge(c*o,(l-
h)/(e-h)*f,g*(1-0.35*(l/e)),o,i)}}},releaseHeightFix:function(){for(var a=this.list.length;a--;)this.list[a].releaseHeightFix()}};ig.ENTITY.BossPlatform=ig.Entity.extend({_wm:new ig.Config({spawnable:true,scalableX:true,scalableY:true,scalableStep:4,attributes:{layer:{_type:"String",_info:"Object Layer from which to display graphic.",_select:{object1:1,object2:1,object3:1}},zHeight:{_type:"Number",_info:"Z height of displayed object"},shape:{_type:"String",_info:"Height-Shape of Block Entity",_select:ig.COLLSHAPE,
_optional:true},wallY:{_type:"Number",_info:"Wall Y Value"}},drawBox:false,boxColor:"rgba(120,255,120, 0.5)",frontColor:"rgba(80,244,80, 0.5)",alwaysRecreate:true}),terrain:null,maps:null,startPos:Vec3.create(),movements:[],fixedHeight:0,fixedState:0,color:null,colorAlpha:0,respawnOkay:true,gfx:null,init:function(a,b,e,f){this.parent(a,b,e,f);this.coll.type=ig.COLLTYPE.BLOCK;this.coll.size.z=f.zHeight||0;this.terrain=f.terrain||0;this.wallY=(f.wallY||0).limit(0,1);this.coll.shape=ig.COLLSHAPE[f.shape||
"RECTANGLE"];this.maps=ig.game.getObjectMaps(f.layer);Vec3.assign(this.startPos,this.coll.pos);this.timer=new ig.WeightTimer;this.setSpriteCount(0);this.totalSprites=ig.ObjectLayerTools.getSpriteCount(this,this.maps);this.coll.setUpdateType(ig.COLL_UPDATE_TYPE.STATIC);sc.BossPlatforms.registerPlatform(this);this.gfx=new ig.Image("media/map/arid-heaven.png")},show:function(a){this.parent(a)},onKill:function(){this.parent();sc.BossPlatforms.unregisterPlatform(this);this.gfx.decreaseRef()},update:function(){var a=
0;this.colorAlpha=0;this.color=null;for(var b=this.movements.length;b--;){var e=this.movements[b];e.timer.tick();if(e.state==2){var f=e.timer.get(),g=e.height*Math.sin(f*Math.PI),a=a+g,g=e.intensity*Math.sin(f*Math.PI);this.colorAlpha=this.colorAlpha+g;this.color=e.color;if(e.fixed&&f>=0.5&&this.fixedState==2)this.fixedState=3}if(e.timer.done())if(e.state==1){e.state=2;e.timer.set(e.duration,ig.TIMER_MODE.ONCE)}else e.state==2&&this.movements.splice(b,1)}if(this.fixedState==3)a=this.fixedHeight;a=
this.startPos.z+Math.round(a);this.setPos(this.startPos.x,this.startPos.y,a,true);if(this.movements.length==0){this.color=null;if(this.fixedState==4)this.fixedState=this.fixedHeight=0;this.coll.setUpdateType(ig.COLL_UPDATE_TYPE.STATIC)}this.parent()},nudge:function(a,b,e,f,g){if(!(this.fixedState>=2)){a={state:1,height:a,duration:e,intensity:f,color:g||"#444",timer:new ig.WeightTimer};if(this.fixedState==1){a.height=this.fixedHeight;a.fixed=true;this.fixedState=2}a.timer.set(b,ig.TIMER_MODE.ONCE);
this.movements.push(a);this.coll.setUpdateType(ig.COLL_UPDATE_TYPE.DYNAMIC)}},setFixedHeight:function(a){this.fixedState=1;this.fixedHeight=a},releaseHeightFix:function(){if(this.fixedState&&this.fixedState<4){var a={state:2,height:this.fixedHeight,duration:0.4,intensity:1,color:"#000",timer:new ig.WeightTimer};a.timer.set(0.4,ig.TIMER_MODE.ONCE);a.timer.setRemainingTime(0.2);this.movements.push(a);this.coll.setUpdateType(ig.COLL_UPDATE_TYPE.DYNAMIC);this.fixedState=4}},updateSprites:function(){if(!this.color&&
this.fixedState<2)this.setSpriteCount(0);else{this.setSpriteCount(this.totalSprites+(this.fixedState?1:0));var a=this.maps,c=Vec3.sub(this.coll.pos,this.startPos,b);ig.ObjectLayerTools.updateSprites(this,a,this.wallY,c);if(this.fixedState){a=this.sprites[this.sprites.length-1];c=this.coll;a.setPos(c.pos.x,c.pos.y,c.pos.z+c.size.z);a.setSize(c.size.x,c.size.y,0,0);a.aboveZ=1;a.setImageSrc(this.gfx,96,128);a.setAlpha(Math.min(1,(this.coll.pos.z-this.startPos.z)/this.fixedHeight*4))}if(this.color)for(c=
this.sprites.length;c--;){a=this.sprites[c];a.noOverlapSolving=true;a.setLighterOverlayColor(this.color,this.colorAlpha)}}}})});ig.baked=!0;
ig.module("game.feature.puzzle.plug-in").requires("game.feature.puzzle.components.push-pullable","game.feature.puzzle.entities.block","game.feature.puzzle.entities.blockers","game.feature.puzzle.entities.bomb","game.feature.puzzle.entities.water-bubble","game.feature.puzzle.entities.compressor","game.feature.puzzle.entities.water-block","game.feature.puzzle.entities.ice-disk","game.feature.puzzle.entities.key-panel","game.feature.puzzle.entities.ball-changer","game.feature.puzzle.entities.walls",
"game.feature.puzzle.entities.glowing-line","game.feature.puzzle.entities.lorry","game.feature.puzzle.entities.ferro","game.feature.puzzle.entities.one-time-switch","game.feature.puzzle.entities.element-shield","game.feature.puzzle.entities.floor-switch","game.feature.puzzle.entities.magnet","game.feature.puzzle.entities.multi-hit-switch","game.feature.puzzle.entities.bounce-switch","game.feature.puzzle.entities.thermo-pole","game.feature.puzzle.entities.push-pull-block","game.feature.puzzle.entities.push-pull-dest",
"game.feature.puzzle.entities.sliding-block","game.feature.puzzle.entities.switch","game.feature.puzzle.entities.destructible","game.feature.puzzle.entities.item-destruct","game.feature.puzzle.entities.regen-destruct","game.feature.puzzle.entities.extract-platform","game.feature.puzzle.entities.dynamic-platform","game.feature.puzzle.entities.ol-platform","game.feature.puzzle.entities.enemy-counter","game.feature.puzzle.entities.group-switch","game.feature.puzzle.entities.chest","game.feature.puzzle.entities.quick-sand",
"game.feature.puzzle.entities.spiderweb","game.feature.puzzle.entities.steam-pipes","game.feature.puzzle.entities.tesla-coil","game.feature.puzzle.entities.wave-teleport","game.feature.puzzle.puzzle-steps","game.feature.puzzle.entities.rotate-blocker","game.feature.puzzle.entities.boss-platform").defines(function(){window.wm&&wm.postLoadModules.push("game.feature.puzzle.editors.puzzle-editors")});ig.baked=!0;
ig.module("game.feature.menu.menu-steps").requires("impact.base.utils","impact.base.event","impact.base.action","game.feature.menu.menu-model","game.feature.menu.map-model","game.feature.menu.lore-model").defines(function(){ig.EVENT_STEP.ADD_PLANT=ig.EventStepBase.extend({key:null,anim:null,_wm:new ig.Config({attributes:{plant:{_type:"DropSelect",_info:"drop to update"}}}),init:function(b){this.key=b.plant;this.anim=ig.globalSettings.getGlobalSettingOptions("ENTITY","ItemDestruct")[this.key].desType},
start:function(){sc.menu.incrementDropCount(this.key,this.anim)}});ig.EVENT_STEP.UNLOCK_ENEMY=ig.EventStepBase.extend({enemy:null,asSpecial:null,_wm:new ig.Config({attributes:{enemy:{_type:"EnemySearch",_info:"Enemy to unlock, note that this enemy, use this only for special enemies."},asSpecial:{_type:"Boolean",_info:"if true 'special' will be displayed instead of kill count",_default:true}}}),init:function(b){this.enemy=b.enemy;this.asSpecial=b.asSpecial==void 0?true:b.asSpecial},start:function(){sc.stats.setMap("combat",
"kill"+this.enemy,this.asSpecial?-1:1);sc.stats.setMap("combat","enemyCompletionRate",sc.combat.getTotalEnemiesFound(true))}});ig.EVENT_STEP.UNLOCK_LORE=ig.EventStepBase.extend({lore:null,notify:false,_wm:new ig.Config({attributes:{lore:{_type:"LoreSelect",_info:"Lore to unlock. Unlocks ALL entries "},notify:{_type:"Boolean",_info:"True if notification should be displayed",_default:false}}}),init:function(b){this.lore=b.lore;this.notify=b.notify||false},start:function(){sc.lore.unlockLore(this.lore,
this.notify)}});ig.EVENT_STEP.UNLOCK_LORE_ALL=ig.EventStepBase.extend({_wm:new ig.Config({attributes:{}}),init:function(){},start:function(){window.IG_GAME_DEBUG&&sc.lore.unlockLoreAll()}});ig.EVENT_STEP.UNLOCK_LORE_FIRST_TIME=ig.EventStepBase.extend({_wm:new ig.Config({attributes:{}}),init:function(){},start:function(){sc.lore.notifyFirstActivated()}});ig.EVENT_STEP.UNLOCK_LORE_ENTRY=ig.EventStepBase.extend({lore:null,entry:null,notify:false,_wm:new ig.Config({attributes:{lore:{_type:"LoreSelect",
_info:"Lore to the entry is associated with",_context:"Lore"},entry:{_type:"LoreEntrySelect",_info:"The entry to unlock"},notify:{_type:"Boolean",_info:"True if notification should be displayed",_default:false}}}),init:function(b){this.lore=b.lore;this.entry=b.entry;this.notify=b.notify||false},start:function(){sc.lore.unlockLoreEntry(this.lore,this.entry,this.notify)}});ig.EVENT_STEP.UNLOCK_LORE_LIST=ig.EventStepBase.extend({lories:null,entry:null,notify:false,_wm:new ig.Config({attributes:{lories:{_type:"Array",
_info:"The list from which to pick. will unlock the next 'locked' entry in the array.",_sub:{_type:"LoreSelect"},_subWidth:150},notify:{_type:"Boolean",_info:"True if notification should be displayed",_default:false}}}),init:function(b){this.lories=b.lories||[];this.notify=b.notify||false},start:function(){if(this.lories.length>0)for(var b=0,a=this.lories.length;b<a;b++)if(!sc.lore.isLoreUnlocked(this.lories[b])){sc.lore.unlockLore(this.lories[b],this.notify);break}}});ig.EVENT_STEP.ACTIVATE_LANDMARK=
ig.EventStepBase.extend({area:null,landmark:null,_wm:new ig.Config({attributes:{area:{_type:"Area",_info:"Area to select landmark from",_select:"areas",_context:"Area"},landmark:{_type:"Landmarks",_info:"Landmark to activate"}}}),init:function(b){this.area=b.area;this.landmark=b.landmark},start:function(){sc.map.addLandmark(this.landmark,this.area)}});ig.EVENT_STEP.SET_LANDMARK_ACTIVE_STATE=ig.EventStepBase.extend({area:null,landmark:null,_wm:new ig.Config({attributes:{area:{_type:"Area",_info:"Area to select landmark from",
_select:"areas",_context:"Area"},landmark:{_type:"Landmarks",_info:"Landmark to set state of. If not defined: Set state of all landmarks of area (if found)",_optional:true},state:{_type:"Boolean",_info:"New Active State of Landmark"}}}),init:function(b){this.area=b.area;this.landmark=b.landmark;this.state=b.state},start:function(){this.landmark?sc.map.setLandmarkActiveState(this.landmark,this.state,this.area):sc.map.setAreaLandmarksActiveState(this.area,this.state)}});ig.EVENT_STEP.UNDO_OPENED_CHEST_TRACK=
ig.EventStepBase.extend({_wm:new ig.Config({attributes:{map:{_type:"Maps",_info:"Map of the chest",_context:"Map"},area:{_type:"Area",_info:"Area of the map",_select:"areas",_context:"Area"},chestId:{_type:"Integer",_info:"Entity id of the chest that is no more"},variable:{_type:"String",_info:"Alternative Variable used for chest. Do NOT add map. prefix!",_optional:true}}}),init:function(b){this.map=b.map;this.area=b.area;this.chestId=b.chestId||0;this.variable=b.variable||null},start:function(){var b=
"maps."+this.map.toPath("","").toCamel()+".",b=this.variable?b+this.variable:NaN+this.chestId;if(ig.vars.get(b)){ig.vars.set(b,false);sc.stats.subMap("chests",this.area,1);sc.stats.subMap("chests","total",1)}}});ig.EVENT_STEP.OPEN_SHOP=ig.EventStepBase.extend({shop:null,_wm:new ig.Config({attributes:{shop:{_type:"Shop",_info:"The Shop to access. Below you can see the content",_context:"Shop"}}}),init:function(b){this.shop=b.shop||null},start:function(){var b=ig.database.get("shops")[this.shop];if(sc.MENU_SHOP_TYPES[b.shopType]==
sc.MENU_SHOP_TYPES.COIN)sc.menu.shopCoinMode=true;sc.menu.shopID=this.shop;sc.menu.setDirectMode(true,sc.MENU_SUBMENU.SHOP);sc.model.enterMenu(true);sc.model.prevSubState=sc.GAME_MODEL_SUBSTATE.RUNNING}});ig.EVENT_STEP.OPEN_QUEST_HUB=ig.EventStepBase.extend({hub:null,_wm:new ig.Config({attributes:{hub:{_type:"QuestHub",_info:"The hub to access.",_context:"QuestHub"}}}),init:function(b){this.hub=b.hub||null},start:function(){sc.menu.questHubID=this.hub;sc.menu.setDirectMode(true,sc.MENU_SUBMENU.QUEST_HUB);
sc.model.enterMenu(true);sc.model.prevSubState=sc.GAME_MODEL_SUBSTATE.RUNNING}});ig.EVENT_STEP.UNDO_VISITED_AREA=ig.EventStepBase.extend({hub:null,_wm:new ig.Config({attributes:{area:{_type:"String",_select:"areas",_info:"Visited area to be undone. WARNING: Will delete ALL map variables of those maps"}}}),init:function(b){this.area=b.area;this.areaLoadable=new sc.AreaLoadable(this.area)},clearCached:function(){this.areaLoadable.decreaseRef()},start:function(){sc.map.undoVisitedArea(this.area,this.areaLoadable)}})});
ig.baked=!0;
ig.module("game.feature.menu.plug-in").requires("game.feature.menu.area-loadable","game.feature.menu.menu-steps","game.feature.menu.gui.menu-misc","game.feature.menu.gui.base-menu","game.feature.menu.gui.main-menu","game.feature.menu.gui.start-menu","game.feature.menu.gui.equip.equip-menu","game.feature.menu.gui.list-boxes","game.feature.menu.gui.circuit.circuit-menu","game.feature.menu.gui.circuit.circuit-misc","game.feature.menu.gui.item.item-menu","game.feature.menu.gui.map.map-menu","game.feature.menu.gui.social.social-menu",
"game.feature.menu.gui.save.save-menu","game.feature.menu.gui.options.options-menu","game.feature.menu.gui.shop.shop-menu","game.feature.menu.gui.synop.synop-menu","game.feature.menu.gui.quests.quest-menu","game.feature.menu.gui.quest-hub.quest-hub-menu","game.feature.menu.gui.enemies.enemy-menu","game.feature.menu.gui.lore.lore-menu","game.feature.menu.gui.help.help-menu","game.feature.menu.gui.status.status-menu","game.feature.menu.gui.museum.museum-menu","game.feature.menu.gui.stats.stats-menu",
"game.feature.menu.gui.trophy.trophy-menu","game.feature.menu.gui.trade.trader-menu","game.feature.menu.gui.botanics.botanics-menu","game.feature.menu.gui.arena.arena-menu","game.feature.menu.gui.new-game.new-game-menu","game.feature.menu.menu-model","game.feature.menu.lore-model").defines(function(){if(window.wm){if(wm.mapAttribs){wm.mapAttribs.area={_type:"String",_select:"areas",_info:"Area of the map.",_default:"fallback"};wm.mapAttribs.oobSound={_type:"String",_select:ig.DANGER_TERRAIN,_info:"Area of the map.",
_default:"HOLE"}}wm.postLoadModules.push("game.feature.menu.editors.area-editors");wm.postLoadModules.push("game.feature.menu.editors.lore-editors");wm.postLoadModules.push("game.feature.menu.editors.shop-editors");wm.postLoadModules.push("game.feature.menu.editors.drop-editors");wm.postLoadModules.push("game.feature.menu.editors.toggle-set-editors");wm.addStepColorRule(/LORE/,"orange")}});ig.baked=!0;
ig.module("game.feature.quick-menu.gui.quick-item-menu").requires("impact.base.image","impact.feature.gui.gui","impact.feature.gui.base.basic-gui","game.feature.interact.button-group","game.feature.menu.gui.list-boxes","game.feature.menu.gui.menu-misc").defines(function(){var b=Vec2.createC(0,0);Vec2.createC(0,0);sc.QuickItemArrow=ig.GuiElementBase.extend({gfx:new ig.Image("media/gui/menu.png"),transitions:{HIDDEN:{state:{alpha:0},time:0.2,timeFunction:KEY_SPLINES.LINEAR},DEFAULT:{state:{},time:0.2,
timeFunction:KEY_SPLINES.LINEAR}},flipX:false,flipY:false,bottomAnchor:false,init:function(){this.parent();this.setSize(9,15);this.doStateTransition("DEFAULT")},setPosition:function(a,b,c,e,f){this.setPos(a,b);this.flipX=c||false;this.flipY=e||false;this.bottomAnchor=f||false},updateDrawables:function(a){a.addGfx(this.gfx,0,0,this.bottomAnchor?444:434,337,9,15,this.flipX,this.flipY)}});sc.QuickItemMenu=ig.BoxGui.extend({gfx:new ig.Image("media/gui/basic.png"),ninepatch:new ig.NinePatch("media/gui/menu.png",
{width:8,height:8,left:8,top:8,right:8,bottom:8,offsets:{"default":{x:432,y:304},flipped:{x:456,y:304}}}),transitions:{HIDDEN:{state:{alpha:0},time:0.2,timeFunction:KEY_SPLINES.LINEAR},DEFAULT:{state:{},time:0.2,timeFunction:KEY_SPLINES.LINEAR}},base:null,anchor:null,list:null,arrow:null,buttongroup:null,_hidden:true,init:function(a,b){this.parent(175,147);this.base=a.hook;this.anchor=b.hook;this.buttongroup=new sc.ButtonGroup(false,ig.BUTTON_GROUP_SELECT_TYPE.VERTICAL);this.buttongroup.addSelectionCallback(this.onSelection.bind(this));
this.buttongroup.addPressCallback(this.onPress.bind(this));this.buttongroup.setMouseFocusLostCallback(function(){sc.quickmodel.setInfoText("",true);sc.quickmodel.setBuffText("",true)}.bind(this));sc.Model.addObserver(sc.quickmodel,this);this.list=new sc.ButtonListBox(1,0,20);this.list.buttonInteract=sc.quickmodel.buttonInteract;this.list.setPos(2,13);this.list.setSize(171,123);this.list.setButtonGroup(this.buttongroup);this.list.showBottomBar=false;this.addChildGui(this.list);var c=new sc.TextGui(ig.lang.get("sc.gui.menu.select"),
{speed:ig.TextBlock.SPEED.IMMEDIATE,font:sc.fontsystem.tinyFont});c.setPos(8,6);this.addChildGui(c);c=new sc.TextGui(ig.lang.get("sc.gui.menu.quantity"),{speed:ig.TextBlock.SPEED.IMMEDIATE,font:sc.fontsystem.tinyFont});c.setPos(6,6);c.setAlign(ig.GUI_ALIGN.X_RIGHT,ig.GUI_ALIGN.Y_TOP);this.addChildGui(c);var c=sc.model.player.params,e={size:sc.NUMBER_SIZE.TINY,color:sc.GUI_NUMBER_COLOR.GREY};this.maxBuffs=new sc.NumberGui(4,e);this.maxBuffs.setAlign(ig.GUI_ALIGN.X_RIGHT,ig.GUI_ALIGN.Y_BOTTOM);this.maxBuffs.setPos(6,
3);this.maxBuffs.setNumber(c.getMaxBuffs());this.addChildGui(this.maxBuffs);this.currentBuffs=new sc.NumberGui(4,e);this.currentBuffs.setAlign(ig.GUI_ALIGN.X_RIGHT,ig.GUI_ALIGN.Y_BOTTOM);this.currentBuffs.setPos(20,3);this.currentBuffs.setNumber(c.currentItemBuffs);this.addChildGui(this.currentBuffs);c=new ig.ImageGui(this.gfx,208,18,5,5);c.setAlign(ig.GUI_ALIGN.X_RIGHT,ig.GUI_ALIGN.Y_BOTTOM);c.setPos(14,4);this.addChildGui(c);c=new sc.TextGui(ig.lang.get("sc.gui.menu.item.buff")+":",{font:sc.fontsystem.tinyFont});
c.setAlign(ig.GUI_ALIGN.X_RIGHT,ig.GUI_ALIGN.Y_BOTTOM);c.setPos(28,2);this.addChildGui(c);this.arrow=new sc.QuickItemArrow;this.addChildGui(this.arrow);this.doStateTransition("HIDDEN",true)},update:function(){if(this.isVisible()&&(this.buttongroup.isActive()&&!ig.interact.isBlocked())&&sc.control.menuBack()){sc.BUTTON_SOUND.back.play();sc.quickmodel.enterNone()}},updateDrawables:function(a){this.parent(a);a.addColor("#7E7E7E",2,135,171,1)},updateList:function(a){var b=this.list.getScrollY(),c=this.buttongroup.current.y;
if(!sc.options.get("quick-cursor"))c=b=0;this.buttongroup.clear();this.list.clear(true);for(var e=sc.model.player,f=e.getItemSubList(sc.ITEMS_TYPES.CONS,sc.SORT_TYPE.ORDER,true),g=null,h=g=null,i=null,j=0,k=0,l=0;l<f.length;l++){k=e.items[f[l]]||0;j++;i=sc.inventory.getItem(f[l]);new ig.LangLabel(i.name);g="\\i["+(i.icon+sc.inventory.getRaritySuffix(i.rarity||0)||"item-default")+"]"+ig.LangLabel.getText(i.name);h=ig.LangLabel.getText(i.description);g=new sc.ItemBoxButton(g,142,26,k||1,f[l],h,void 0,
void 0);i.isBuff&&sc.model.player.params.hasMaxBuffs()&&g.setActive(false);e.isFavorite(f[l])&&this.addFavoriteOverlay(g);this.list.addButton(g)}this.list._prevIndex=c;c=Math.min(c,Math.max(0,j-1));ig.input.mouseGuiActive?this.buttongroup.setCurrentFocus(0,c):this.buttongroup.focusCurrentButton(0,c,false,a);this.list.scrollToY(b,true)},show:function(){if(this._hidden){this._hidden=false;this.updateList(true);var a=this.hook;b.x=this.base.pos.x+this.anchor.pos.x+Math.floor(this.anchor.size.x/2);b.y=
this.base.pos.y+this.anchor.pos.y+Math.floor(this.anchor.size.y/2);var d=b.y+-46;b.y=Math.max(10,Math.min(ig.system.height-137-10-22-70,b.y+-46));a.pos.y=b.y;if(b.x+240<ig.system.width){this.currentTileOffset="default";a.pos.x=b.x+27+30;a.doPosTranstition(b.x+27,b.y,0.2,KEY_SPLINES.EASE_OUT);this.arrow.setPosition(-10,42+(d-b.y),false)}else{this.currentTileOffset="flipped";a.pos.x=b.x-a.size.x-27-30-1;a.doPosTranstition(b.x-a.size.x-27-1,b.y,0.2,KEY_SPLINES.EASE_OUT);this.arrow.setPosition(a.size.x+
1,42+(d-b.y),true)}a=sc.model.player.params;this.maxBuffs.setNumber(a.getMaxBuffs());this.currentBuffs.setNumber(a.currentItemBuffs);ig.interact.setBlockDelay(0.2);this.list.activate(sc.quickmodel.buttonInteract);this.doStateTransition("DEFAULT")}},hide:function(){if(!this._hidden){this._hidden=true;this.list.deactivate(sc.quickmodel.buttonInteract);sc.quickmodel.setBuffText("",true);this.doStateTransition("HIDDEN")}},addFavoriteOverlay:function(a){var b=new ig.ImageGui(this.ninepatch.gfx,256,480,
19,17);b.setPos(0,0);a.addChildGui(b)},onSelection:function(a){sc.quickmodel.setInfoText(a.data.description);a.data.id&&(sc.inventory.isBuffID(a.data.id)?sc.quickmodel.setBuffText(sc.inventory.getBuffString(a.data.id),null,a.data.id):sc.quickmodel.setBuffText("",false))},onPress:function(a){if(a.data&&(!sc.inventory.isBuffID(a.data.id)||!sc.model.player.params.hasMaxBuffs())){ig.game.playerEntity.useItem(a.data.id);sc.quickmodel.skipActiveState=true;sc.model.enterRunning()}},modelChanged:function(a,
b){a==sc.quickmodel&&(b==sc.QUICK_MODEL_EVENT.SWITCH_STATE?sc.quickmodel.isQuickItems()?this.show():this.hide():b==sc.QUICK_MODEL_EVENT.EXIT_MENU&&this.hide())}})});ig.baked=!0;
ig.module("game.feature.quick-menu.gui.quick-misc").requires("impact.base.image","impact.feature.gui.gui","impact.feature.gui.base.basic-gui","game.feature.gui.base.numbers","game.feature.combat.combat","game.feature.menu.gui.enemies.enemy-pages","game.feature.quick-menu.gui.quick-item-menu").defines(function(){var b=Vec2.createC(0,0),a=[1,1,1,1],d=null;sc.QuickMenuBuffsGui=ig.BoxGui.extend({ninepatch:new ig.NinePatch("media/gui/menu.png",{width:8,height:8,left:8,top:8,right:8,bottom:8,offsets:{"default":{x:456,
y:304},flipped:{x:456,y:304}}}),transitions:{DEFAULT:{state:{},time:0.2,timeFunction:KEY_SPLINES.LINEAR},HIDDEN:{state:{alpha:0,offsetX:-65},time:0.2,timeFunction:KEY_SPLINES.LINEAR}},init:function(){this.parent(50,40);this.setPos(2,23);this.setAlign(ig.GUI_ALIGN.X_LEFT,ig.GUI_ALIGN.Y_BOTTOM);this.doStateTransition("HIDDEN",true)},show:function(a,b){if(a){this.removeAllChildren();for(var d=sc.inventory.getItem(sc.quickmodel.buffID).stats,g=d.length,h=50,i=1;g--;){var j=sc.STAT_CHANGE_SETTINGS[d[g]];
if(j.type.key!="heal"){j=new sc.QuickBuffEntry(j);j.setPos(1,i);h=Math.max(h,j.hook.size.x);i=i+j.hook.size.y;this.addChildGui(j)}}this.hook.size.x=h+4;this.hook.size.y=Math.max(16,i);this.doStateTransition("DEFAULT")}else this.doStateTransition("HIDDEN",false,false,null,b)},hide:function(a){this.doStateTransition("HIDDEN",a)}});sc.QuickBuffEntry=ig.GuiElementBase.extend({icon:null,description:null,init:function(a){this.parent();this.icon=new sc.TextGui("\\i["+a.icon+"]\\i["+a.grade+"]",{font:sc.fontsystem.tinyFont});
this.icon.setPos(2,2);this.addChildGui(this.icon);var b=this.getStatName(a.type,a.change),b=a.negative?b+(" \\c[1]- "+-1*this.getStatValue(a.type,a.value,a.change)+"%\\c[0]"):b+(" \\c[2]+ "+this.getStatValue(a.type,a.value,a.change)+"%\\c[0]");this.statName=new sc.TextGui(b,{font:sc.fontsystem.smallFont});this.statName.setPos(19,0);this.addChildGui(this.statName);this.setSize(this.statName.hook.size.x+21,14)},getStatName:function(a,b,d){var g="param";if(b==sc.STAT_CHANGE_TYPE.STATS)if(a.key=="elemFactor")switch(a.index){case 0:g=
"heat";break;case 1:g="cold";break;case 2:g="shock";break;case 3:g="wave"}else a.key=="hp"?g="maxhp":a.key=="attack"?g="atk":a.key=="defense"?g="def":a.key=="focus"&&(g="foc");else if(b==sc.STAT_CHANGE_TYPE.MODIFIER)g=(!d?"modifier.":"")+a.key;else if(b==sc.STAT_CHANGE_TYPE.HEAL)return"ERROR ERROR";return ig.lang.get("sc.gui.menu.equip."+(d?"descriptions.":"")+g)},getStatValue:function(a,b,d){d==sc.STAT_CHANGE_TYPE.STATS&&(b=a.key=="elemFactor"?(b-1)*-1:b-1);return Math.round(b*100)}});sc.QuickLocationBox=
ig.BoxGui.extend({ninepatch:new ig.NinePatch("media/gui/menu.png",{width:5,height:5,left:5,top:5,right:5,bottom:5,offsets:{"default":{x:100,y:425}}}),transitions:{HIDDEN:{state:{alpha:0,scaleY:0.2},time:0.2,timeFunction:KEY_SPLINES.LINEAR},DEFAULT:{state:{},time:0.2,timeFunction:KEY_SPLINES.EASE}},location:null,hasTemp:false,init:function(){this.parent(188,20,true);this.location=new sc.TextGui("Autumn's Rise - Entrance");this.location.setPos(26,1);this.addChildGui(this.location);this.doStateTransition("HIDDEN",
true)},updateDrawables:function(a){this.parent(a);a.addGfx(this.ninepatch.gfx,9,1,418,33,12,18)},show:function(a){this.updateLocationName();if(a){this.hasTemp=true;this.doStateTransition("DEFAULT",false,false,function(){this.doStateTransition("HIDDEN",false,false,function(){this.hasTemp=false}.bind(this),2)}.bind(this),0.2)}else{this.hasTemp=false;this.hook.stateCallback=null;this.doStateTransition("DEFAULT")}},hide:function(a){this.hasTemp||this.doStateTransition("HIDDEN",a)},forceHide:function(){this.hasTemp=
false;this.hook.stateCallback=null;this.doStateTransition("HIDDEN",false)},onCutsceneStart:function(){if(this.hasTemp&&this.hook.currentStateName==="DEFAULT"&&this.hook.anim.timer<0){this.hasTemp=false;this.doStateTransition("HIDDEN",true)}},updateLocationName:function(){this.location.setText(sc.map.getCurrentAreaName()+" - "+sc.map.getCurrentMapName());this.setSize(this.location.hook.size.x+30,20);this.hook.pivot.y=this.hook.size.y}});sc.QuickFocusScreen=ig.GuiElementBase.extend({boxes:{},subGuis:[],
prevType:null,init:function(){this.parent()},registerType:function(a){if(sc.QUICK_INFO_BOXES[a]&&!this.boxes[a]){var b=new sc.QUICK_INFO_BOXES[a];this.boxes[a]=b;this.addChildGui(b)}},addSubGui:function(a){if(a){this.subGuis.push(a);this.insertChildGui(a,1)}},show:function(a,b,d){if(this.prevType!=a){this.prevType&&this.hide(this.prevType);this.prevType=a}(a=this.boxes[a])&&!a.active&&a.show(b,d)},hide:function(a){var b=this.boxes[a];b&&b.active&&this.boxes[a].hide()},resetSubGuis:function(){for(var a=
this.subGuis.length;a--;)this.subGuis[a].remove();this.subGuis.length=0},reset:function(){for(var a in this.boxes)this.boxes[a].hide(true)}});sc.QUICK_INFO_BOXES={};sc.QUICK_INFO_BOXES.Enemy=ig.BoxGui.extend({ninepatch:new ig.NinePatch("media/gui/menu.png",{width:8,height:8,left:8,top:8,right:8,bottom:8,offsets:{"default":{x:432,y:304},flipped:{x:456,y:304}}}),transitions:{HIDDEN:{state:{alpha:0},time:0.2,timeFunction:KEY_SPLINES.LINEAR},DEFAULT:{state:{},time:0.2,timeFunction:KEY_SPLINES.EASE}},
title:null,arrow:null,baseHp:null,baseAttack:null,baseDefense:null,baseFocus:null,resistance:null,anchor:null,enemy:null,active:false,init:function(){this.parent(127,140);this.title=new sc.TextGui("",{font:sc.fontsystem.smallFont});this.title.setAlign(ig.GUI_ALIGN.X_CENTER,ig.GUI_ALIGN.Y_TOP);this.title.setPos(0,2);this.addChildGui(this.title);var a=21;this.baseHp=this.createStatusLine("maxhp",0,4,a);a=a+14;this.baseAttack=this.createStatusLine("atk",1,4,a);a=a+14;this.baseDefense=this.createStatusLine("def",
2,4,a);a=a+14;this.baseFocus=this.createStatusLine("foc",3,4,a);a=a+18;this.resistance=new sc.EnemyResistence;this.resistance.setPos(4,a);this.addChildGui(this.resistance);this.arrow=new sc.QuickItemArrow;this.addChildGui(this.arrow);this.doStateTransition("HIDDEN",true)},updateDrawables:function(a){this.parent(a);a.addColor("#CCCCCC",3,this.title.hook.size.y+1+(this.tiny?5:0),121,1)},show:function(a){this.alignToBase(a.hook);this.setData(a.entity.enemyName,a.entity);this.doStateTransition("DEFAULT");
this.active=true},hide:function(a){this.doStateTransition("HIDDEN",a);this.active=false},setData:function(b,e){var f=sc.combat.enemyDataList[b];this.title.setFont(sc.fontsystem.smallFont);this.title.setText(sc.combat.getEnemyName(b));if(this.title.hook.size.x>=121){this.title.setFont(sc.fontsystem.tinyFont);this.title.setPos(0,6);this.tiny=true}else{this.tiny=false;this.title.setPos(0,2)}this.resistance.hide();d||(d=new ig.VarCondition);d.setCondition(f.hideStats||"false");if(d.evaluate()){this.baseHp.number.scramble=
true;this.baseAttack.number.scramble=true;this.baseDefense.number.scramble=true;this.baseFocus.number.scramble=true;this.baseHp.setNumber(9999,true);this.baseAttack.setNumber(999,true);this.baseDefense.setNumber(999,true);this.baseFocus.setNumber(999,true)}else{this.baseHp.number.scramble=false;this.baseAttack.number.scramble=false;this.baseDefense.number.scramble=false;this.baseFocus.number.scramble=false;if(e.params){this.baseHp.setNumber(e.params.getStat("hp"),true);this.baseAttack.setNumber(e.params.getStat("attack"),
true);this.baseDefense.setNumber(e.params.getStat("defense"),true);this.baseFocus.setNumber(e.params.getStat("focus"),true);this.resistance.setResistance(e.params.getStat("elemFactor")||a,true)}}},createStatusLine:function(a,b,d,g){a=new sc.EnemyBaseParamLine(ig.lang.get("sc.gui.menu.equip."+a),b);a.setPos(d,g);this.addChildGui(a);return a},alignToBase:function(a){var d=this.hook,f=d.currentState.alpha==0;b.x=a.pos.x+Math.floor(a.size.x/2);b.y=a.pos.y+Math.floor(a.size.y/2);a=b.y+-46;b.y=Math.max(10,
Math.min(ig.system.height-140-10,b.y+-46));if(f)d.pos.y=b.y;var g=38+(a-b.y);if(b.x+173<ig.system.width){this.currentTileOffset="default";if(f)d.pos.x=b.x+20+10;d.doPosTranstition(b.x+20,b.y,0.2,KEY_SPLINES.EASE);this.arrow.setPosition(-10,Math.max(7,Math.min(125,g)),false)}else{this.currentTileOffset="flipped";if(f)d.pos.x=b.x-d.size.x-20-10-1;d.doPosTranstition(b.x-d.size.x-20-1,b.y,0.2,KEY_SPLINES.EASE);this.arrow.setPosition(d.size.x+1,Math.max(7,Math.min(125,38+(a-b.y))),true)}this.arrow.bottomAnchor=
false;this.arrow.flipY=false;if(g<7){this.arrow.bottomAnchor=true;this.arrow.flipY=true}else if(g>125)this.arrow.bottomAnchor=true}});sc.QuickArrowBox=ig.GuiElementBase.extend({ninepatch:new ig.NinePatch("media/gui/menu.png",{width:4,height:4,left:4,top:4,right:4,bottom:4,offsets:{"default":{x:480,y:126}}}),name:null,arrowOff:Vec2.createC(0,0),init:function(a,b,d){this.parent();this.name=new sc.TextGui(a,{font:sc.fontsystem.tinyFont,maxWidth:d||0});this.name.setPos(4,1);this.addChildGui(this.name);
this.setSize(this.name.hook.size.x+7,b?this.name.hook.size.y+1:9)},updateDrawables:function(a){this.ninepatch.draw(a,this.hook.size.x,this.hook.size.y,"default");a.addGfx(this.ninepatch.gfx,this.hook.size.x/2-1.5-this.arrowOff.x,this.arrowOff.y<0?-2:this.hook.size.y-1,480,122,3,3,false,this.arrowOff.y<0?true:false)},setPosition:function(a,d){var f=a.screenCoords;if(f){var g=this.hook;b.x=f.x+a.size.x/2-g.size.x/2;b.y=f.y-(d.coll.size.y+14);if(b.x<0){b.x=b.x*-1;b.x=b.x+1;this.arrowOff.x=Math.max(4,
Math.min(g.size.x-4,b.x))}else if(b.x+g.size.x>ig.system.width){b.x=ig.system.width-(b.x+g.size.x+1);this.arrowOff.x=-Math.max(4,Math.min(g.size.x-4,-b.x))}else{b.x=0;this.arrowOff.x=0}if(b.y<0){this.arrowOff.y=-1;b.y=d.coll.size.y+6;this.setStateValue("HIDDEN","offsetY",-8)}else{b.y=-(d.coll.size.y+14);this.arrowOff.y=0;this.setStateValue("HIDDEN","offsetY",8)}this.setPos(this.getCenter(a)+b.x,a.pos.y+b.y)}},getCenter:function(a){return a.pos.x+a.size.x/2-this.hook.size.x/2}});sc.QuickBorderArrowLevelBox=
ig.GuiElementBase.extend({ninepatch:new ig.NinePatch("media/gui/menu.png",{width:4,height:0,left:4,top:9,right:4,bottom:0,offsets:{"default":{x:480,y:112}}}),levelNumber:null,displayColor:0,sizeTransition:null,nameVisible:false,init:function(a,b){this.parent();this.setSize(32,9);var d=(b&&b.level.override?b.level.override:sc.combat.getEnemyLevel(a))||1;this.displayColor=this.getLevelColor(d);this.levelNumber=new sc.NumberGui(99,{leadingZeros:2,size:sc.NUMBER_SIZE.TINY,color:this.displayColor});this.levelNumber.setAlign(ig.GUI_ALIGN.X_RIGHT,
ig.GUI_ALIGN.Y_TOP);this.levelNumber.setPos(4,2);this.addChildGui(this.levelNumber);this.levelNumber.setNumber(d)},update:function(){if(this.sizeTransition){this.sizeTransition.timer=this.sizeTransition.timer+ig.system.actualTick;var a=Math.min(1,Math.max(0,this.sizeTransition.timer)/this.sizeTransition.time),a=this.sizeTransition.timeFunction.get(a);this.hook.size.x=Math.round(this.sizeTransition.startWidth*(1-a)+this.sizeTransition.width*a);this.hook.size.y=Math.round(this.sizeTransition.startHeight*
(1-a)+this.sizeTransition.height*a);if(a==1)this.sizeTransition=null}},updateDrawables:function(a){this.ninepatch.draw(a,this.hook.size.x,this.hook.size.y,"default");a.addGfx(this.ninepatch.gfx,this.hook.size.x/2-1.5,this.hook.size.y-1,480,122,3,3);a.addGfx(this.ninepatch.gfx,this.hook.size.x-27,2,493,112+this.displayColor*6,9,5)},doSizeTransition:function(a,b,d,g,h){if(d)this.sizeTransition={startWidth:this.hook.size.x,width:a||0,startHeight:this.hook.size.y,height:b||0,time:d,timeFunction:g||KEY_SPLINES.EASE,
timer:0-(h||0)};else{this.hook.size.x=a;this.hook.size.y=b}},getLevelColor:function(a){var b=sc.model.player,d=b.level,d=(0.8*b.getAvgEquipLevel()+0.2*d)/a,a=1-d;return a>=0.25?sc.GUI_NUMBER_COLOR.RED:a>=0.15?sc.GUI_NUMBER_COLOR.ORANGE:a<=-0.2?sc.GUI_NUMBER_COLOR.GREEN:sc.GUI_NUMBER_COLOR.WHITE}})});ig.baked=!0;
ig.module("game.feature.quick-menu.gui.quick-screen-types").requires("impact.base.image","impact.feature.gui.gui","impact.feature.gui.base.basic-gui","impact.feature.interact.gui.focus-gui","game.feature.gui.base.numbers","game.feature.combat.combat","game.feature.quick-menu.gui.quick-misc").defines(function(){var b=Vec2.createC(0,0);sc.QUICK_MENU_TYPES={};sc.ANALYSIS_COLORS={RED:0,BLUE:1,GREEN:2,ORANGE:3,YELLOW:4,GREY:5,PURPLE:6};sc.SHOW_TYPE={DEFAULT:0,INSTANT:1};sc.QuickMenuTypesBase=ig.FocusGui.extend({gfx:new ig.Image("media/gui/menu.png"),
transitions:{DEFAULT:{state:{},time:0.2,timeFunction:KEY_SPLINES.EASE},HIDDEN:{state:{alpha:0},time:0.2,timeFunction:KEY_SPLINES.LINEAR}},type:null,entity:null,screen:null,focusable:true,showType:sc.SHOW_TYPE.DEFAULT,color:sc.ANALYSIS_COLORS.GREY,typeIcon:null,_fadeTimer:0,init:function(a,b,c){this.parent(true,false);this.type=a||null;this.entity=b.entity;this.screen=c;this.screen.registerType(a);this.hook.setMouseRecord(true);this.typeIcon=new ig.ImageGui(this.gfx,504+this.color*14,144,13,13);this.typeIcon.setAlign(ig.GUI_ALIGN.X_CENTER,
ig.GUI_ALIGN.Y_CENTER);this.typeIcon.hook.transitions={DEFAULT:{state:{},time:0.1,timeFunction:KEY_SPLINES.LINEAR},HIDDEN:{state:{alpha:0},time:0.1,timeFunction:KEY_SPLINES.LINEAR}};this.addChildGui(this.typeIcon);this.typeIcon.doStateTransition("HIDDEN",true);this.setSize(16,16);this.doStateTransition("HIDDEN",true)},update:function(){this.hasTransition()&&this.hook.currentStateName=="HIDDEN"&&this.alignGuiPosition();if(this.focusable&&this._fadeTimer<0.5){this._fadeTimer=this._fadeTimer+ig.system.actualTick;
if(this._fadeTimer>=0.5)this._fadeTimer=0}},updateDrawables:function(a){var b=this._fadeTimer/0.5;a.addTransform().setPivot(8,8).setScale(0.8+b,0.8+b);a.addGfx(this.gfx,0,0,504,120,15,15).setAlpha(this.typeIcon.hook.currentState.alpha*(1-b));a.undoTransform()},setSize:function(a,b){this.parent(a,b)},isMouseOver:function(){if(sc.quickmodel.isQuickCheck()&&!ig.interact.isBlocked()&&this.focusable&&sc.quickmodel.isDeviceSynced()){if(ig.input.currentDevice==ig.INPUT_DEVICES.GAMEPAD){if(sc.quickmodel.cursorMoved){sc.quickmodel.analFocus==
this&&this.screen.hide(this.type);sc.quickmodel.unfocusEntity(this);return false}var a=this.hook;if(Math.floor(Vec2.distanceC(sc.quickmodel.cursor.x,sc.quickmodel.cursor.y,a.pos.x+Math.floor(a.size.x/2),a.pos.y+Math.floor(a.size.y/2)))<=10){a=this.hook;sc.quickmodel.focusEntity(a.pos.x+Math.floor(a.size.x/2),a.pos.y+Math.floor(a.size.y/2),this,true);sc.quickmodel.analFocus==this&&this.screen.show(this.type,this);return false}sc.quickmodel.analFocus==this&&this.screen.hide(this.type);sc.quickmodel.unfocusEntity(this);
return false}if(ig.input.currentDevice==ig.INPUT_DEVICES.KEYBOARD_AND_MOUSE){var b=Math.floor(sc.control.getMouseX()),c=Math.floor(sc.control.getMouseY()),a=this.hook;if(b=b>=a.pos.x&&b<=a.pos.x+a.size.x&&c>=a.pos.y&&c<=a.pos.y+a.size.y){if(sc.quickmodel.analFocus&&sc.quickmodel.analFocus!=this){sc.quickmodel.unfocusEntity(sc.quickmodel.analFocus);this.screen.hide(this.type)}sc.quickmodel.focusEntity(a.pos.x+Math.floor(a.size.x/2),a.pos.y+Math.floor(a.size.y/2),this);this.screen.show(this.type,this)}else{sc.quickmodel.analFocus==
this&&this.screen.hide(this.type);sc.quickmodel.unfocusEntity(this)}return b}return false}},focusGained:function(){this.parent()},focusLost:function(){this.parent()},setIconColor:function(a){this.color=a||0;this.typeIcon.offsetX=504+this.color*14},show:function(a){this.doStateTransition("DEFAULT",a);this.showType==sc.SHOW_TYPE.INSTANT&&this.typeIcon.doStateTransition("DEFAULT")},hide:function(a){this.doStateTransition("HIDDEN",a);this.showType==sc.SHOW_TYPE.INSTANT&&this.typeIcon.doStateTransition("HIDDEN")},
alignGuiPosition:function(a,d){if(this.entity){var c=this.hook,e=this.entity.coll;ig.system.getScreenFromMapPos(b,Math.round(e.pos.x+e.size.x/2),Math.round(e.pos.y-e.pos.z-e.size.z/2+e.size.y/2));if(b.x<7)b.x=7;if(b.x>ig.system.width-6)b.x=ig.system.width-6;if(b.y<3)b.y=3;if(b.y>ig.system.height-10)b.y=ig.system.height-10;c.pos.x=b.x-c.size.x/2+(a|0);c.pos.y=b.y-c.size.y/2+(d|0)+4}},onAnalysisEnter:function(){this._fadeTimer=-0.1;this.showType==sc.SHOW_TYPE.DEFAULT&&this.typeIcon.doStateTransition("DEFAULT");
this.typeIcon.doStateTransition("DEFAULT")},onAnalysisExit:function(){this.showType==sc.SHOW_TYPE.DEFAULT&&this.typeIcon.doStateTransition("HIDDEN");sc.quickmodel.analFocus==this&&this.screen.hide(this.type)}});sc.QUICK_MENU_TYPES.Analyzable=sc.QuickMenuTypesBase.extend({nameGui:null,displayNameAllTime:false,init:function(a,b,c){this.parent(a,b,c);this.setIconColor(b.color);this.showType=b.showType||0;if(a=ig.LangLabel.getText(b.text)){b.visible&&((new ig.VarCondition(b.visible)).evaluate()||(a="???"));
this.nameGui=new sc.QuickArrowBox(a,true,200);this.nameGui.setPivot(this.nameGui.hook.size.x/2,0);this.nameGui.hook.transitions={DEFAULT:{state:{},time:0.1,timeFunction:KEY_SPLINES.EASE},HIDDEN:{state:{alpha:0,scaleX:0.3,offsetY:8},time:0.2,timeFunction:KEY_SPLINES.LINEAR}};this.nameGui.doStateTransition("HIDDEN",true);this.screen.addSubGui(this.nameGui)}else this.focusable=false},onAnalysisEnter:function(){if(this.nameGui){this.nameGui.setPosition(this.hook,this.entity);this.parent()}},onAnalysisExit:function(){if(this.nameGui){this.parent();
this.nameGui.doStateTransition("HIDDEN")}},focusGained:function(){this.nameGui&&this.nameGui.doStateTransition("DEFAULT")},focusLost:function(){this.nameGui&&this.nameGui.doStateTransition("HIDDEN")},alignGuiPosition:function(){this.parent();this.nameGui&&this.nameGui.setPosition(this.hook,this.entity)}});sc.QUICK_MENU_TYPES.NPC=sc.QuickMenuTypesBase.extend({color:sc.ANALYSIS_COLORS.BLUE,nameGui:null,displayNameAllTime:false,init:function(a,b,c){this.parent(a,b,c);a=null;b=this.entity;if(b.displayName)a=
ig.LangLabel.getText(b.displayName);else if(b.character.data.name)a=ig.LangLabel.getText(b.character.data.name,true);else if(b.displayNameRandom)a=b.displayNameRandom;a=="MISSING LABEL"&&(a=null);if(b.npcStates[b.activeStateIdx])switch(b.npcStates[b.activeStateIdx].npcEventType){case sc.NPC_EVENT_TYPE.TRADE:this.color=sc.ANALYSIS_COLORS.GREEN;a=a?ig.lang.get("sc.gui.trade.trader")+": "+a:ig.lang.get("sc.gui.trade.trader");break;case sc.NPC_EVENT_TYPE.SHOP:this.color=sc.ANALYSIS_COLORS.GREEN;a=a?ig.lang.get("sc.gui.trade.shop")+
": "+a:ig.lang.get("sc.gui.trade.shop");break;case sc.NPC_EVENT_TYPE.QUEST:this.showType=sc.SHOW_TYPE.INSTANT;this.color=sc.ANALYSIS_COLORS.PURPLE;a=a?ig.lang.get("sc.gui.trade.quest")+": "+a:ig.lang.get("sc.gui.trade.quest")}this.setIconColor(this.color);if(a){b.displayTrigger&&((new ig.VarCondition(b.displayTrigger)).evaluate()||(a="???"));this.nameGui=new sc.QuickArrowBox(a);this.nameGui.setPivot(this.nameGui.hook.size.x/2,0);this.nameGui.hook.transitions={DEFAULT:{state:{},time:0.1,timeFunction:KEY_SPLINES.EASE},
HIDDEN:{state:{alpha:0,scaleX:0.3,offsetY:8},time:0.2,timeFunction:KEY_SPLINES.LINEAR}};this.nameGui.doStateTransition("HIDDEN",true);this.screen.addSubGui(this.nameGui)}else this.focusable=false},onAnalysisEnter:function(){if(this.nameGui){this.nameGui.setPosition(this.hook,this.entity);this.parent()}},onAnalysisExit:function(){if(this.nameGui){this.parent();this.nameGui.doStateTransition("HIDDEN")}},focusGained:function(){this.nameGui&&this.nameGui.doStateTransition("DEFAULT")},focusLost:function(){this.nameGui&&
this.nameGui.doStateTransition("HIDDEN")},alignGuiPosition:function(){this.parent();this.nameGui&&this.nameGui.setPosition(this.hook,this.entity)}});sc.QUICK_MENU_TYPES.Enemy=sc.QuickMenuTypesBase.extend({color:sc.ANALYSIS_COLORS.RED,level:null,init:function(a,b,c){this.parent(a,b,c);this.level=new sc.QuickBorderArrowLevelBox(this.entity.enemyName,this.entity);this.level.setAlign(ig.GUI_ALIGN.X_CENTER,ig.GUI_ALIGN.Y_CENTER);this.addChildGui(this.level)},alignGuiPosition:function(){this.parent();var a=
this.entity.coll.size.z/2+this.entity.coll.size.y/2,a=this.entity.dmgZFocus?a-this.entity.dmgZFocus:this.entity.cameraZFocus?a-(this.entity.cameraZFocus+48):a-(this.entity.coll.size.z+this.entity.coll.size.y+8);this.level.setPos(0,a)}})});ig.baked=!0;
ig.module("game.feature.quick-menu.gui.quick-screen").requires("impact.base.image","impact.feature.gui.gui","game.feature.quick-menu.gui.quick-screen-types","game.feature.menu.gui.menu-misc","game.feature.quick-menu.gui.quick-misc").defines(function(){sc.QuickMenuAnalysisCursor=ig.GuiElementBase.extend({gfx:new ig.Image("media/gui/menu.png"),transitions:{DEFAULT:{state:{},time:0.1,timeFunction:KEY_SPLINES.LINEAR},HIDDEN:{state:{alpha:0},time:0.1,timeFunction:KEY_SPLINES.LINEAR}},focusOffset:{x:0,
y:0},focus:false,_focusTimer:0,_focusTime:0,_focusOffset:0,_lastDevice:0,_gamepadActive:false,init:function(){this.parent();this.setSize(23,23)},addObservers:function(){sc.Model.addObserver(sc.quickmodel,this)},removeObservers:function(){sc.Model.removeObserver(sc.quickmodel,this)},update:function(){if(this._lastDevice!=ig.input.currentDevice){this._gamepadActive=ig.input.currentDevice==ig.INPUT_DEVICES.GAMEPAD;this._lastDevice=ig.input.currentDevice}if(this._focusTimer<this._focusTime){this._focusTimer=
this._focusTimer+ig.system.tick;if(this._focusTimer>=this._focusTime){this._focusTimer=this._focusTime;this._focusOffset=this.focus?2:0}else this._focusOffset=Math.floor((this._focusTime?1:-1)*(this._focusTimer/this._focusTime)*2)}},updateDrawables:function(b){this.focus?b.addGfx(this.gfx,-1,-1,512+(this.focus?24:0),160,23,23):this._gamepadActive&&b.addGfx(this.gfx,-1,-1,512+(this.focus?24:0),160,23,23)},focusOnNode:function(b,a){this.setPos(b-Math.floor(this.hook.size.x/2),a-Math.floor(this.hook.size.y/
2)-this.focusOffset.y);this.focus=true;this._focusTimer=0;this._focusTime=0.2;this._focusOffset=0},unfocus:function(){this.focus=false;this._focusTime=this._focusTimer=0.2;this._focusOffset=0},moveTo:function(b,a,d,c){d&&ig.input.currentDevice==ig.INPUT_DEVICES.GAMEPAD?this.doPosTranstition(b-Math.floor(this.hook.size.x/2),a-Math.floor(this.hook.size.y/2)-this.focusOffset.y,c,KEY_SPLINES.EASE):this.setPos(b-Math.floor(this.hook.size.x/2),a-Math.floor(this.hook.size.y/2)-this.focusOffset.y);if(this.focus){this._focusTimer=
0;this._focusTime=0.2;this._focusOffset=3;this.focus=false}},modelChanged:function(b,a){if(b==sc.quickmodel)if(a==sc.QUICK_MODEL_EVENT.INPUT_MODEL_TOGGLED){this._focusTime=this._focusTimer=0.2;this._focusOffset=0}else a==sc.QUICK_MODEL_EVENT.FOCUS_NODE?this.focusOnNode(sc.quickmodel.cursor.x,sc.quickmodel.cursor.y):a==sc.QUICK_MODEL_EVENT.UNFOCUS?this.unfocus():a==sc.QUICK_MODEL_EVENT.ENSURE_FOCUS&&(this.focus||this.focusOnNode(sc.quickmodel.cursor.x,sc.quickmodel.cursor.y))}});sc.QuickMenuAnalysis=
ig.GuiElementBase.extend({gfx:new ig.Image("media/gui/menu.png"),transitions:{DEFAULT:{state:{},time:0.2,timeFunction:KEY_SPLINES.LINEAR},HIDDEN:{state:{alpha:0},time:0.2,timeFunction:KEY_SPLINES.LINEAR}},buttonGroup:null,cursor:null,entities:[],iconContainer:null,focusContainer:null,corners:[],background:null,_cursorPos:Vec2.createC(-1E4,-1E4),entered:false,init:function(){this.parent();this.setSize(ig.system.width,ig.system.height);sc.Model.addObserver(sc.quickmodel,this);this.buttonGroup=new sc.MouseButtonGroup;
this.buttonGroup.ignoreActiveFocus=true;this.buttonGroup.addSelectionCallback(function(){}.bind(this));this.buttonGroup.setMouseFocusLostCallback(function(){}.bind(this));if(!this.constructor.PATTERN)this.constructor.PATTERN=this.gfx.createPattern(512,352,64,64,ig.ImagePattern.OPT.REPEAT_X_AND_Y);this.background=new ig.GuiElementBase;this.background.hook.transitions={DEFAULT:{state:{},time:0.2,timeFunction:KEY_SPLINES.LINEAR},HIDDEN:{state:{alpha:0},time:0.2,timeFunction:KEY_SPLINES.LINEAR}};this.background.updateDrawables=
function(b){b.addPattern(this.constructor.PATTERN,0,0,0,0,this.hook.size.x,this.hook.size.y).setCompositionMode("lighter")}.bind(this);this.background.doStateTransition("HIDDEN",true);this.addChildGui(this.background);this.createCorner();this.createCorner(true);this.createCorner(false,true);this.createCorner(true,true);this.iconContainer=new ig.GuiElementBase;this.iconContainer.setSize(ig.system.width,ig.system.height);this.addChildGui(this.iconContainer);this.cursor=new sc.QuickMenuAnalysisCursor;
this.cursor.doStateTransition("HIDDEN",true);this.addChildGui(this.cursor);this.focusContainer=new sc.QuickFocusScreen;this.addChildGui(this.focusContainer)},update:function(){sc.quickmodel.cursorMoved=false;if(this.isVisible()&&this.buttonGroup.isActive()&&!ig.interact.isBlocked())if(sc.control.menuBack()){sc.BUTTON_SOUND.back.play();sc.quickmodel.enterNone()}else{if(sc.quickmodel.lastDevice!=ig.input.currentDevice){sc.quickmodel.lastDevice=ig.input.currentDevice;sc.quickmodel.gamepadActive=ig.input.currentDevice==
ig.INPUT_DEVICES.GAMEPAD;var b=null;if(ig.input.currentDevice==ig.INPUT_DEVICES.GAMEPAD){b=this._cursorPos;this.initCursor(b);sc.quickmodel.cursor.x=b.x;sc.quickmodel.cursor.y=b.y;this.limitCursorPos();sc.quickmodel.resetCursor();this.cursor.moveTo(sc.quickmodel.cursor.x,sc.quickmodel.cursor.y)}else if(ig.input.currentDevice==ig.INPUT_DEVICES.KEYBOARD_AND_MOUSE){this._cursorPos.x=sc.quickmodel.cursor.x;this._cursorPos.y=sc.quickmodel.cursor.y;this.cursor.unfocus()}sc.quickmodel.toggleInputMode()}if(ig.input.currentDevice==
ig.INPUT_DEVICES.GAMEPAD){var a=b=0,d=0,c=false;if((d=sc.control.getAxesValue(ig.AXES.LEFT_STICK_X))<-0.5){b=(-100+d*100)*ig.system.actualTick;c=true}else if((d=sc.control.getAxesValue(ig.AXES.LEFT_STICK_X))>0.5){b=(100+d*100)*ig.system.actualTick;c=true}if((d=sc.control.getAxesValue(ig.AXES.LEFT_STICK_Y))<-0.5){a=(-100+d*100)*ig.system.actualTick;c=true}else if((d=sc.control.getAxesValue(ig.AXES.LEFT_STICK_Y))>0.5){a=(100+d*100)*ig.system.actualTick;c=true}if(c){sc.quickmodel.cursorMoved=true;sc.quickmodel.cursor.x=
b>=0?Math.floor(sc.quickmodel.cursor.x+b):Math.ceil(sc.quickmodel.cursor.x+b);sc.quickmodel.cursor.y=a>=0?Math.floor(sc.quickmodel.cursor.y+a):Math.ceil(sc.quickmodel.cursor.y+a);this.limitCursorPos();this.cursor.moveTo(sc.quickmodel.cursor.x,sc.quickmodel.cursor.y)}}}},show:function(){this.iconContainer.removeAllChildren();this.entities.length=0;this.buttonGroup.clear();this.focusContainer.resetSubGuis();for(var b=null,b=null,a=ig.game.shownEntities,d=a.length;d--;){var c=a[d];if(c&&c.getQuickMenuSettings&&
(c.isQuickMenuVisible&&c.isQuickMenuVisible()||ig.EntityTools.isInScreen(c,0))){b=c.getQuickMenuSettings();if(!b.disabled&&sc.QUICK_MENU_TYPES[b.type]){b.entity=c;b=new sc.QUICK_MENU_TYPES[b.type](b.type,b,this.focusContainer);b.alignGuiPosition(0,0);this.iconContainer.addChildGui(b);b.show();this.entities.push(b);this.buttonGroup.addFocusGui(b)}}}this.focusContainer.reset();this.doStateTransition("DEFAULT")},hide:function(){for(var b=this.iconContainer.hook.children.length;b--;){this.iconContainer.hook.children[b].gui.hide();
this.iconContainer.hook.children[b].removeAfterTransition=true}for(b=this.entities.length;b--;)this.entities[b].onAnalysisExit();for(b=this.corners.length;b--;)this.corners[b].doStateTransition("DEFAULT")},enter:function(){sc.quickmodel.buttonInteract.pushButtonGroup(this.buttonGroup);for(var b=this.entities.length;b--;){this.entities[b].focusLost();this.entities[b].onAnalysisEnter()}for(b=this.corners.length;b--;)this.corners[b].doStateTransition("DEFAULT");sc.quickmodel.resetCursor();this.cursor.addObservers();
this.cursor.doStateTransition("DEFAULT");if(sc.quickmodel.lastDevice!=ig.input.currentDevice){sc.quickmodel.gamepadActive=ig.input.currentDevice==ig.INPUT_DEVICES.GAMEPAD;sc.quickmodel.lastDevice=ig.input.currentDevice}this.focusCenter();ig.interact.setBlockDelay(0.2);this.background.doStateTransition("DEFAULT");this.entered=true},exit:function(){this.cursor.unfocus();this.cursor.removeObservers();this.cursor.doStateTransition("HIDDEN");for(var b=this.entities.length;b--;)this.entities[b].onAnalysisExit();
for(b=this.corners.length;b--;)this.corners[b].doStateTransition("HIDDEN");this.background.doStateTransition("HIDDEN");sc.quickmodel.buttonInteract.removeButtonGroup(this.buttonGroup);this.entered=false},focusCenter:function(){if(this.entered){var b=this._cursorPos;b.x=sc.quickmodel.cursor.x;b.y=sc.quickmodel.cursor.y;this.limitCursorPos();this.cursor.moveTo(sc.quickmodel.cursor.x,sc.quickmodel.cursor.y)}else if(ig.input.currentDevice==ig.INPUT_DEVICES.GAMEPAD){b=this._cursorPos;this.initCursor(b);
sc.quickmodel.cursor.x=ig.system.width/2;sc.quickmodel.cursor.y=ig.system.height/2;this.limitCursorPos();this.cursor.moveTo(sc.quickmodel.cursor.x,sc.quickmodel.cursor.y)}},initCursor:function(b){if(b.x<=-1E4||b.y<=-1E4){b.x=ig.system.width/2;b.y=ig.system.height/2}},limitCursorPos:function(){var b=sc.quickmodel.cursor.x;sc.quickmodel.cursor.x=b.limit(1,ig.system.width-Math.floor(this.cursor.hook.size.x/2)-1);b=sc.quickmodel.cursor.y;sc.quickmodel.cursor.y=b.limit(1,ig.system.height-this.cursor.hook.size.y-
1)},createCorner:function(b,a){var d=new ig.ImageGui(this.gfx,512,280,104,65);d.setAlign(b?ig.GUI_ALIGN.X_RIGHT:ig.GUI_ALIGN.X_LEFT,a?ig.GUI_ALIGN.Y_BOTTOM:ig.GUI_ALIGN.Y_TOP);d.hook.transitions={DEFAULT:{state:{},time:0.2,timeFunction:KEY_SPLINES.EASE},HIDDEN:{state:{alpha:0,offsetX:-20},time:0.2,timeFunction:KEY_SPLINES.LINEAR}};d.doStateTransition("HIDDEN",true);d.flipX=b||false;d.flipY=a||false;d.renderMode="lighter";this.corners.push(d);this.addChildGui(d)},modelChanged:function(b,a){b==sc.quickmodel&&
(a==sc.QUICK_MODEL_EVENT.SWITCH_STATE?sc.quickmodel.isQuickCheck()?this.enter():this.exit():a==sc.QUICK_MODEL_EVENT.EXIT_MENU&&this.exit())}})});ig.baked=!0;
ig.module("game.feature.quick-menu.gui.circle-menu").requires("impact.base.image","impact.feature.gui.gui","impact.feature.gui.base.basic-gui","impact.feature.interact.gui.focus-gui","game.feature.interact.button-group").defines(function(){var b=Vec2.createC(0,0);sc.RingMenuButton=ig.FocusGui.extend({gfx:new ig.Image("media/gui/menu.png"),transitions:{HIDDEN:{state:{alpha:0},time:0.2,timeFunction:KEY_SPLINES.LINEAR},DEFAULT:{state:{},time:0.2,timeFunction:KEY_SPLINES.LINEAR}},state:0,alpha:1,alphaTimer:0,
endPos:Vec2.createC(0,0),origin:Vec2.createC(40,40),endPosActive:Vec2.createC(0,0),data:null,submitSound:null,blockedSound:null,init:function(a,b,c){this.parent(true,true);this.setPos(this.origin.x,this.origin.y);this.setSize(32,32);this.setPivot(16,16);this.state=a;this.endPos.x=b;this.endPos.y=c;this.submitSound=sc.BUTTON_SOUND.submit;this.blockedSound=sc.BUTTON_SOUND.denied},invokeButtonPress:function(){this.parent();this.submitSound&&this.submitSound.play()},focusGained:function(){this.parent();
if(this.focus){this.alphaTimer=0;this.alpha=1}},update:function(){this.alphaTimer=(this.alphaTimer+ig.system.actualTick)%1;var a=this.alphaTimer/1,a=KEY_SPLINES.EASE_IN_OUT.get(1-(a>0.5?1-(a-0.5)*2:a*2));this.alpha=0.8*a+0.2},updateDrawables:function(a){a.addGfx(this.gfx,0,0,400,304,32,32);this.active?this.focus?a.addGfx(this.gfx,0,0,400,336,32,32).setAlpha(this.alpha):this.pressed&&a.addGfx(this.gfx,0,0,400,336,32,32):this.focus&&a.addGfx(this.gfx,0,0,400,272,32,32);a.addGfx(this.gfx,8,8,432+(this.state-
1)*16,352+(this.active?0:16),16,16)},show:function(a,b){b&&this.setPressed(false);this.doStateTransition("DEFAULT",false,false,null,a);this.doPosTranstition(this.endPos.x,this.endPos.y,0.2,KEY_SPLINES.EASE_OUT,a)},hide:function(){this.focusLost();this.setPressed(false);this.doStateTransition("HIDDEN");this.doPosTranstition(this.origin.x,this.origin.y,0.2,KEY_SPLINES.LINEAR)},activate:function(){this.doStateTransition("DEFAULT");this.doPosTranstition(this.endPosActive.x,this.endPosActive.y,0.1,KEY_SPLINES.LINEAR)},
deactivate:function(){this.doStateTransition("HIDDEN");this.focusLost();this.doPosTranstition(this.endPos.x,this.endPos.y,0.1,KEY_SPLINES.LINEAR)}});sc.ItemTimerOverlay=ig.GuiElementBase.extend({transitions:{HIDDEN:{state:{alpha:0},time:0.1,timeFunction:KEY_SPLINES.LINEAR},DEFAULT:{state:{},time:0.1,timeFunction:KEY_SPLINES.LINEAR}},isActive:true,numberGui:null,button:null,init:function(a){this.parent();this.setSize(32,32);this.button=a;this.numberGui=new sc.NumberGui(60,{leadingZeros:2,size:sc.NUMBER_SIZE.NORMAL,
noZero:true,color:sc.GUI_NUMBER_COLOR.RED});this.numberGui.setAlign(ig.GUI_ALIGN.X_CENTER,ig.GUI_ALIGN.Y_CENTER);this.numberGui.setNumber(0);this.addChildGui(this.numberGui)},update:function(){this.numberGui.setNumber(Math.ceil(sc.model.player.itemBlockTimer))}});sc.QuickMenuButtonGroup=ig.ButtonGroup.extend({sounds:{focus:new ig.Sound("media/sound/menu/menu-hover.ogg",0.9)},init:function(){this.parent();this.addNull(0,0)},setButtons:function(a,b,c,e){a&&this.addFocusGui(a,0,1);b&&this.addFocusGui(b,
0,2);c&&this.addFocusGui(c,0,3);e&&this.addFocusGui(e,0,4)},isNonMouseMenuInput:function(){return sc.control.menuConfirm()||sc.control.leftDown()||sc.control.rightDown()||sc.control.upDown()||sc.control.downDown()},doButtonTraversal:function(a){if(!a){sc.control.menuConfirm()&&this.invokeCurrentButton();this.hasCD(1)&&sc.control.leftDown()?this.focusCurrentButton(0,1):this.hasCD(2)&&sc.control.upDown()?this.focusCurrentButton(0,2):this.hasCD(3)&&sc.control.rightDown()?this.focusCurrentButton(0,3):
this.hasCD(4)&&sc.control.downDown()&&this.focusCurrentButton(0,4)}},focusCurrentButton:function(a,b,c,e,f){if(!this.buttonInteract||!this.buttonInteract.mouseOverGui)if(f||!(this.current.x==a&&this.current.y==b)){this.elements[this.current.x][this.current.y]&&this.elements[this.current.x][this.current.y].focusLost();this.current.x=a%this.elements.length;this.current.y=b%this.elements[this.current.x].length;e=e!=void 0?e:false;a=this.elements[this.current.x][this.current.y];a.keepPressed&&!this.soundsOnPressed?
a.pressed||!e&&this.sounds.focus&&this.sounds.focus.play():!e&&this.sounds.focus&&this.sounds.focus.play();a.focusGained();c||this._invokeSelectionCallbacks(a)}},hasCD:function(a){return this.elements[0][a]}});sc.QuickRingMenu=ig.GuiElementBase.extend({gfx:new ig.Image("media/gui/menu.png"),transitions:{HIDDEN:{state:{alpha:0,scaleX:0.5,scaleY:0.5,angle:1},time:0.2,timeFunction:KEY_SPLINES.LINEAR},PRE_DEFAULT:{state:{alpha:0,scaleX:0.5,scaleY:0.5,angle:-1},time:0.2,timeFunction:KEY_SPLINES.LINEAR},
DEFAULT:{state:{},time:0.2,timeFunction:KEY_SPLINES.EASE_OUT}},buttongroup:null,items:null,map:null,check:null,party:null,buttons:[],init:function(){this.parent();this.setSize(112,112);this.setPivot(56,56);sc.Model.addObserver(sc.quickmodel,this);this.buttongroup=new sc.QuickMenuButtonGroup;this.buttongroup.addPressCallback(function(a){if(a.state!=void 0)switch(a.state){case sc.QUICK_MENU_STATE.ITEMS:sc.quickmodel.enterItems();this._unfocusAll(a);break;case sc.QUICK_MENU_STATE.MAP:this._unfocusAll();
sc.menu.setDirectMode(true,sc.MENU_SUBMENU.MAP);sc.model.enterMenu(true);sc.model.prevSubState=sc.GAME_MODEL_SUBSTATE.RUNNING;break;case sc.QUICK_MENU_STATE.CHECK:sc.quickmodel.enterCheck();this._unfocusAll();break;case sc.QUICK_MENU_STATE.PARTY:sc.quickmodel.enterParty();this._unfocusAll(a)}}.bind(this));this.createButtons();this.doStateTransition("HIDDEN",true)},update:function(){this._updatePos()},updateDrawables:function(a){a.addGfx(this.gfx,16,16,320,288,80,80)},enter:function(){this.doStateTransition("PRE_DEFAULT",
true);this.doStateTransition("DEFAULT");(!sc.model.isSaveAllowed()||sc.model.isTeleportBlocked())&&!sc.autoControl.isActive()?this.map.setActive(false):this.map.setActive(true);sc.pvp.isActive()||sc.model.player.itemBlockTimer>0||sc.quickmodel.itemsBlocked?this.items.setActive(false):this.items.setActive(true);!sc.model.player.getCore(sc.PLAYER_CORE.MENU_SOCIAL)||sc.party.currentParty.length<=0?this.party.setActive(false):this.party.setActive(true);for(var a=this.buttons.length;a--;)this.buttons[a].show();
this._updatePos();sc.quickmodel.buttonInteract.pushButtonGroup(this.buttongroup)},exit:function(){this.doStateTransition("HIDDEN");for(var a=this.buttons.length;a--;)this.buttons[a].hide();sc.quickmodel.buttonInteract.removeButtonGroup(this.buttongroup)},show:function(){this.doStateTransition("DEFAULT")},hide:function(){this.doStateTransition("HIDDEN")},createButtons:function(){for(var a=[],d=0;d<360;d=d+90){b.x=56-35*Math.sin(d*Math.PI/180);b.y=56-35*Math.cos(d*Math.PI/180);a.push({x:b.x,y:b.y})}this.items=
this._createRingButton("items",sc.QUICK_MENU_STATE.ITEMS,a,0,1);this.check=this._createRingButton("analyze",sc.QUICK_MENU_STATE.CHECK,a,0,2);this.party=this._createRingButton("party",sc.QUICK_MENU_STATE.PARTY,a,0,3);this.map=this._createRingButton("map",sc.QUICK_MENU_STATE.MAP,a,0,4);this.items.addChildGui(new sc.ItemTimerOverlay(this.items));this.buttongroup.setButtons(this.check,this.items,this.map,this.party)},_unfocusAll:function(){for(var a=this.buttons.length;a--;)this.buttons[a].focusLost()},
_createRingButton:function(a,b,c){var e=new sc.RingMenuButton(b,Math.floor(c[b-1].x-16)+1,Math.floor(c[b-1].y-16)+1);e.data=ig.lang.get("sc.gui.quick-menu.description."+a);e.endPosActive.x=Math.floor(c[0].x-16)+1;e.endPosActive.y=Math.floor(c[0].y-16)+5;this.addChildGui(e);return this.buttons[b-1]=e},_updatePos:function(){var a=ig.game.playerEntity,d=this.hook;if(a){a=a.coll;ig.system.getScreenFromMapPos(b,Math.round(a.pos.x+a.size.x/2),Math.round(a.pos.y-a.pos.z-a.size.z/2+a.size.y/2));d.pos.x=b.x-
d.size.x/2;d.pos.y=b.y-d.size.y/2;d.pos.x=Math.max(0,Math.min(ig.system.width-d.size.x,d.pos.x));d.pos.y=Math.max(0,Math.min(ig.system.height-d.size.y,d.pos.y))}},_setStateActive:function(a){var a=a-1,b=this.buttons.length;if(this.buttons[a]){for(;b--;)b!=a&&this.buttons[b].deactivate();this.buttons[a].activate()}else{for(;b--;)this.buttons[b].show(0,true);sc.quickmodel.isQuickNone()&&!ig.input.mouseGuiActive&&(sc.quickmodel.previousState==sc.QUICK_MENU_STATE.ITEMS?this.buttons[0].focusGained():sc.quickmodel.previousState==
sc.QUICK_MENU_STATE.PARTY?this.buttons[2].focusGained():sc.quickmodel.previousState==sc.QUICK_MENU_STATE.CHECK&&this.buttongroup.focusCurrentButton(0,1,false,true,true))}},modelChanged:function(a,b){if(a==sc.quickmodel&&b==sc.QUICK_MODEL_EVENT.SWITCH_STATE)if(sc.quickmodel.isQuickCheck())this.hide();else{this.show();this._setStateActive(sc.quickmodel.currentState)}}})});ig.baked=!0;
ig.module("game.feature.quick-menu.gui.quick-party").requires("impact.base.image","impact.feature.gui.gui","impact.feature.gui.base.basic-gui","game.feature.interact.button-group","game.feature.menu.gui.list-boxes","game.feature.menu.gui.menu-misc","game.feature.quick-menu.gui.quick-item-menu").defines(function(){var b=Vec2.createC(0,0);sc.QuickPartyStrategyMenu=ig.BoxGui.extend({gfx:new ig.Image("media/gui/basic.png"),ninepatch:new ig.NinePatch("media/gui/menu.png",{width:8,height:8,left:8,top:8,
right:8,bottom:8,offsets:{"default":{x:432,y:304},flipped:{x:456,y:304}}}),transitions:{HIDDEN:{state:{alpha:0},time:0.2,timeFunction:KEY_SPLINES.LINEAR},DEFAULT:{state:{},time:0.2,timeFunction:KEY_SPLINES.LINEAR}},base:null,anchor:null,arrow:null,rows:[],currentText:[],buttongroup:null,_hidden:true,init:function(a,b){this.parent(202,115);this.base=a.hook;this.anchor=b.hook;this.buttongroup=new sc.RowButtonGroup;this.buttongroup.enableMultiPressed=true;this.buttongroup.soundsOnPressed=true;this.buttongroup.addSelectionCallback(this.onSelection.bind(this));
this.buttongroup.addPressCallback(this.onPress.bind(this));this.buttongroup.setMouseFocusLostCallback(function(){sc.quickmodel.setInfoText("",true);sc.quickmodel.setBuffText("",true)}.bind(this));this.buttongroup.setLeftRightCallback(function(){return true}.bind(this));sc.Model.addObserver(sc.quickmodel,this);var c=new sc.TextGui(ig.lang.get("sc.gui.quick-menu.strategy.headers.target"),{font:sc.fontsystem.tinyFont});c.setPos(9,4);this.addChildGui(c);c=new sc.TextGui(ig.lang.get("sc.gui.quick-menu.strategy.headers.behaviour"),
{font:sc.fontsystem.tinyFont});c.setPos(9,41);this.addChildGui(c);c=new sc.TextGui(ig.lang.get("sc.gui.quick-menu.strategy.headers.arts"),{font:sc.fontsystem.tinyFont});c.setPos(9,78);this.addChildGui(c);this.arrow=new sc.QuickItemArrow;this.addChildGui(this.arrow);this.addRow("TARGET",0);this.addRow("BEHAVIOUR",1);this.addRow("ARTS",2);this.doStateTransition("HIDDEN",true)},update:function(){if(this.isVisible()&&(this.buttongroup.isActive()&&!ig.interact.isBlocked())&&sc.control.menuBack()){sc.BUTTON_SOUND.back.play();
sc.quickmodel.enterNone()}},updateDrawables:function(a){this.parent(a);a.addColor("#7E7E7E",2,11,198,1);a.addColor("#7E7E7E",2,48,198,1);a.addColor("#7E7E7E",2,85,198,1)},addRow:function(a,b){this.rows[b]=[];var c=this.createButton(a,0,b,sc.BUTTON_TYPE.GROUP_LEFT);c.setPos(8,15+b*37);this.addChildGui(c);c=this.createButton(a,1,b,sc.BUTTON_TYPE.GROUP);c.setPos(38,15+b*37);this.addChildGui(c);c=this.createButton(a,2,b,sc.BUTTON_TYPE.GROUP_RIGHT);c.setPos(68,15+b*37);this.addChildGui(c);c=new ig.ImageGui(this.ninepatch.gfx,
560,213,9,7);c.setPos(102,22+b*37);this.addChildGui(c);c=new sc.TextGui("");c.setPos(115,17+b*37);this.addChildGui(c);this.currentText[b]=c},createButton:function(a,b,c,e){e=new sc.ButtonGui("\\i[party-"+a+"-"+b+"]",29,true,e,null,true);e.textChild.setPos(b==0?2:0,0);e.data={description:ig.lang.get("sc.gui.quick-menu.strategy.description."+a)[b],id:b,row:c,key:a};e.noFocusOnPressed=true;this.buttongroup.addFocusGui(e,b,c);return this.rows[c][b]=e},show:function(){if(this._hidden){this._hidden=false;
var a=this.hook;b.x=this.base.pos.x+this.anchor.pos.x+Math.floor(this.anchor.size.x/2);b.y=this.base.pos.y+this.anchor.pos.y+Math.floor(this.anchor.size.y/2);var d=b.y+-46;b.y=Math.max(10,Math.min(ig.system.height-115-10-22,b.y+-46));a.pos.y=b.y;if(b.x+240<ig.system.width){this.currentTileOffset="default";a.pos.x=b.x+27+30;a.doPosTranstition(b.x+27,b.y,0.2,KEY_SPLINES.EASE_OUT);this.arrow.setPosition(-10,42+(d-b.y),false)}else{this.currentTileOffset="flipped";a.pos.x=b.x-a.size.x-27-30-1;a.doPosTranstition(b.x-
a.size.x-27-1,b.y,0.2,KEY_SPLINES.EASE_OUT);this.arrow.setPosition(a.size.x+1,42+(d-b.y),true)}ig.interact.setBlockDelay(0.2);this.resetRow("TARGET",0);this.resetRow("BEHAVIOUR",1);this.resetRow("ARTS",2);a=this.rows[1][2];if(sc.arena.active){a.setActive(false);a.setText("\\i[party-BEHAVIOUR-2-grey]",true)}else{a.setActive(true);a.setText("\\i[party-BEHAVIOUR-2]",true)}sc.quickmodel.buttonInteract.pushButtonGroup(this.buttongroup);this.doStateTransition("DEFAULT")}},hide:function(){if(!this._hidden){this._hidden=
true;sc.quickmodel.buttonInteract.removeButtonGroup(this.buttongroup);this.doStateTransition("HIDDEN")}},resetRow:function(a,b){var c=this.getButtonIndex(sc.party.strategyKeys[a],b);this.resetButtons(this.rows[b][c],this.rows[b]);this.buttongroup.setPressedFocusGui(this.rows[b][c]);this.currentText[b].setText(ig.lang.get("sc.gui.quick-menu.strategy.names."+a)[c])},resetButtons:function(a,b){for(var c=b.length;c--;)b[c]!=a&&b[c].setPressed(false)},getButtonIndex:function(a,b){if(b==0){if(a=="WHATEVER")return 0;
if(a=="MY_ENEMY")return 1;if(a=="OTHERS")return 2}else if(b==1){if(a=="OFFENSIVE")return 0;if(a=="DEFENSIVE")return 1;if(a=="DO_NOTHING")return 2}else if(b==2){if(a=="NORMAL")return 0;if(a=="OFTEN")return 1;if(a=="NEVER")return 2}},onSelection:function(a){a.data&&a.data.description&&sc.quickmodel.setInfoText(a.data.description)},onPress:function(a){if(a.data){a=a.data;sc.party.updatePartyStrategy(a.key,sc.party.getStrategyKey(a.key,a.id));this.resetRow(a.key,a.row)}},modelChanged:function(a,b){a==
sc.quickmodel&&(b==sc.QUICK_MODEL_EVENT.SWITCH_STATE?sc.quickmodel.isQuickParty()?this.show():this.hide():b==sc.QUICK_MODEL_EVENT.EXIT_MENU&&this.hide())}})});ig.baked=!0;
ig.module("game.feature.quick-menu.gui.quick-menu").requires("impact.base.image","impact.feature.gui.gui","game.feature.quick-menu.gui.quick-screen","game.feature.quick-menu.gui.circle-menu","game.feature.quick-menu.gui.quick-item-menu","game.feature.quick-menu.gui.quick-party","game.feature.menu.gui.menu-misc").defines(function(){sc.QuickMenu=ig.GuiElementBase.extend({ringmenu:null,items:null,analysis:null,party:null,location:null,info:null,buffInfo:null,buffStats:null,backButton:null,init:function(){this.parent();
this.setSize(ig.system.width,ig.system.height);this.setPivot(ig.system.width/2,ig.system.height/2);this.hook.zIndex=1180;this.hook.pauseGui=true;sc.Model.addObserver(sc.model,this);sc.Model.addObserver(sc.map,this);sc.Model.addObserver(sc.quickmodel,this);sc.Model.addObserver(sc.message,this);this.analysis=new sc.QuickMenuAnalysis;this.addChildGui(this.analysis);this.ringmenu=new sc.QuickRingMenu;this.addChildGui(this.ringmenu);this.items=new sc.QuickItemMenu(this.ringmenu,this.ringmenu.items);this.addChildGui(this.items);
this.party=new sc.QuickPartyStrategyMenu(this.ringmenu,this.ringmenu.items);this.addChildGui(this.party);this.info=new sc.InfoBar;this.info.setAlign(ig.GUI_ALIGN.X_LEFT,ig.GUI_ALIGN.Y_BOTTOM);this.addChildGui(this.info);this.buffInfo=new sc.BuffInfo;this.info.addChildGui(this.buffInfo);this.buffStats=new sc.QuickMenuBuffsGui;this.addChildGui(this.buffStats);this.location=new sc.QuickLocationBox;this.location.setAlign(ig.GUI_ALIGN.X_LEFT,ig.GUI_ALIGN.Y_BOTTOM);this.location.setPos(0,16);this.addChildGui(this.location);
this.doStateTransition("DEFAULT")},_checkBackButtonInput:function(){return sc.control.menuBack()},_enterMenu:function(){sc.quickmodel.enterQuickMenu();sc.mapInteract.forceHide();sc.model.clearTopMessage();this.buffInfo.setText("");this.buffStats.hide(true);this.ringmenu.enter();this.analysis.show();sc.options.get("quick-location")!=sc.QUICK_LOCATION_OPTION.NONE&&!sc.arena.active&&this.location.show();ig.interact.setBlockDelay(0.2)},_exitMenu:function(){sc.quickmodel.buttonInteract.clearAllButtons();
this.ringmenu.exit();this.analysis.hide();this.info.doStateTransition("HIDDEN");sc.quickmodel.exitQuickMenu();ig.interact.setBlockDelay(0.2);this.location.hide();this.buffStats.hide();sc.mapInteract.forceShow()},_setInfoBarAndLocation:function(){sc.quickmodel.isQuickItems()||sc.quickmodel.isQuickParty()?this.info.doStateTransition("DEFAULT"):this.info.doStateTransition("HIDDEN");if(sc.quickmodel.isQuickCheck()||sc.quickmodel.isQuickItems()||sc.quickmodel.isQuickParty())this.location.hide();else if(sc.options.get("quick-location")!=
sc.QUICK_LOCATION_OPTION.NONE){this.location.doPosTranstition(0,10,0.2,KEY_SPLINES.LINEAR);sc.arena.active||this.location.show()}},modelChanged:function(b,a,d){if(b==sc.model){b.isCutscene()&&this.location.forceHide();if(a==sc.GAME_MODEL_MSG.SUB_STATE_CHANGED){sc.model.isPaused()&&this.location.forceHide();sc.model.isQuickMenu()?this._enterMenu():this._exitMenu()}}else if(b==sc.quickmodel)if(a==sc.QUICK_MODEL_EVENT.SWITCH_STATE){this._setInfoBarAndLocation();this.buffStats.hide();this.buffInfo.setText("")}else if(a==
sc.QUICK_MODEL_EVENT.INFO_TEXT_CHANGED)this.info.setText(sc.quickmodel.infoText,d?0.5:0);else{if(a==sc.QUICK_MODEL_EVENT.BUFF_TEXT_CHANGED){d=d||false;this.buffInfo.setText(sc.quickmodel.buffText,d?0.5:0);this.buffStats.show(sc.quickmodel.buffID,d?0.5:0)}}else b==sc.map?a==sc.MAP_EVENT.MAP_ENTERED&&sc.options.get("quick-location")==sc.QUICK_LOCATION_OPTION.MAP&&!sc.model.isCutscene()&&sc.model.player.getCore(sc.PLAYER_CORE.QUICK_MENU)&&(sc.arena.active||this.location.show(true)):b==sc.message&&a==
sc.MESSAGE_EVENT.NEW_SIDE_MESSAGE&&this.location.forceHide()}})});ig.baked=!0;
ig.module("game.feature.quick-menu.entities.analyzable").requires("impact.base.entity","game.feature.quick-menu.gui.quick-screen-types").defines(function(){var b={DEFAULT:{showType:sc.SHOW_TYPE.DEFAULT,color:sc.ANALYSIS_COLORS.GREY},QUEST:{showType:sc.SHOW_TYPE.INSTANT,color:sc.ANALYSIS_COLORS.PURPLE},SPECIAL:{showType:sc.SHOW_TYPE.DEFAULT,color:sc.ANALYSIS_COLORS.YELLOW}};ig.LANG_CONTEXT.Analyzable=function(a){return"Analyzable["+(a.settings.analType||"")+"]"};ig.ENTITY.Analyzable=ig.Entity.extend({_wm:new ig.Config({spawnable:true,
attributes:{spawnCondition:{_type:"VarCondition",_info:"Condition for Enemy to spawn",_popup:true},analType:{_type:"Select",_info:"Type of the Analyzable",_select:b,_default:"DEFAULT"},visible:{_type:"VarCondition",_info:'Condition to check if text is visible, if not "???" will be shown instead'},text:{_type:"LangLabel",_info:"Name to display above the entity",_compact:true,_large:true,_withNull:true},distance:{_type:"Number",_info:"If defined will be visible at the border if below the given distance",
_optional:true}},label:function(){return""},drawBox:true,boxColor:"rgba(0,255,0, 0.5)"}),color:sc.ANALYSIS_COLORS.GREY,text:null,visible:null,init:function(a,d,c,e){this.parent(a,d,c,e);this.coll.type=ig.COLLTYPE.IGNORE;this.coll.setSize(16,16,0);this.text=e.text||null;this.visible=e.visible||null;this.distance=e.distance||0;if(e.analType){this.color=b[e.analType].color||sc.ANALYSIS_COLORS.GREY;this.showType=b[e.analType].showType||sc.SHOW_TYPE.DEFAULT}else{this.color=sc.ANALYSIS_COLORS[e.color]||
sc.ANALYSIS_COLORS.GREY;this.showType=e.showType?sc.SHOW_TYPE[e.showType]:0}},isQuickMenuVisible:function(){return this.distance&&ig.CollTools.getGroundDistance(this.coll,ig.game.playerEntity.coll)<this.distance?true:false},getQuickMenuSettings:function(){return{type:"Analyzable",color:this.color,text:this.text,visible:this.visible,showType:this.showType}}})});ig.baked=!0;
ig.module("game.feature.quick-menu.plug-in").requires("game.feature.quick-menu.quick-menu-model","game.feature.quick-menu.gui.quick-menu","game.feature.quick-menu.gui.circle-menu","game.feature.quick-menu.gui.quick-item-menu","game.feature.quick-menu.entities.analyzable").defines(function(){window.wm&&wm.postLoadModules.push("game.feature.quick-menu.editors.quick-menu-editors")});ig.baked=!0;
ig.module("game.feature.tutorial.input-forcer").requires("impact.base.game","impact.feature.gui.gui").defines(function(){sc.InputForcerGui=ig.GuiElementBase.extend({titleText:null,hintText:null,transitions:{DEFAULT:{state:{alpha:1},time:0.1,timeFunction:KEY_SPLINES.EASE_OUT},HIDDEN:{state:{alpha:0,scaleX:1.5,scaleY:1.5},time:0.1,timeFunction:KEY_SPLINES.EASE_OUT}},init:function(){this.parent();this.hook.temporary=true;this.setSize(ig.system.width,ig.system.height);this.setPivot(ig.system.width/2,
ig.system.height/2);this.titleText=new sc.TextGui("",{maxWidth:300,textAlign:ig.Font.ALIGN.CENTER});this.titleText.setAlign(ig.GUI_ALIGN.X_CENTER,ig.GUI_ALIGN.Y_CENTER);this.titleText.setPos(0,-64);this.addChildGui(this.titleText);this.hintText=new sc.TextGui("",{maxWidth:300,textAlign:ig.Font.ALIGN.CENTER});this.hintText.setAlign(ig.GUI_ALIGN.X_CENTER,ig.GUI_ALIGN.Y_CENTER);this.hintText.setPos(0,64);this.addChildGui(this.hintText)},show:function(a,b){this.titleText.setText(ig.LangLabel.getText(b.title));
ig.input.currentDevice==ig.INPUT_DEVICES.GAMEPAD?this.hintText.setText(ig.LangLabel.getText(b.textGamepad)):this.hintText.setText(ig.LangLabel.getText(b.textKeyboard));ig.gui.addGuiElement(this);this.doStateTransition("HIDDEN",true);this.doStateTransition("DEFAULT")},remove:function(){this.doStateTransition("HIDDEN",false,true)}});sc.InputForcer=ig.GameAddon.extend({activeEntry:null,texts:{title:null,textKeyboard:null,textGamepad:null},gui:null,blocked:false,darknessHandle:null,lightHandle:null,inputSubmitted:false,
sounds:{start:new ig.Sound("media/sound/hud/popup-2.ogg",1)},init:function(){this.parent("InputForcer");this.gui=new sc.InputForcerGui},setEntry:function(a,b,e,f){this.activeEntry=sc.INPUT_FORCER_ENTRIES[a]||null;this.texts.title=b;this.texts.textGamepad=f;this.texts.textKeyboard=e;this.update()},isBlocking:function(){return this.blocked},clearEntry:function(){this.blocked&&this._endBlock();this.activeEntry=null},isSubmitted:function(){return this.inputSubmitted},preUpdateOrder:10,onPreUpdate:function(){this.update()},
onReset:function(){this.clearEntry()},update:function(){if(this.activeEntry){var a=this.activeEntry.check();!a&&!this.blocked?this._startBlock(this.activeEntry.cancelAction):a&&this.blocked&&this._endBlock();if(a&&!this.activeEntry.keep)this.activeEntry=null;if(a)this.inputSubmitted=true}else this.inputSubmitted=false},_startBlock:function(a){this.gui.show(this.activeEntry,this.texts);ig.slowMotion.add(0,0,"forceInput");ig.slowMotion.forceUpdate();ig.soundManager.pushPaused();this.sounds.start.play();
this.darknessHandle=new ig.DarknessHandle(true);this.darknessHandle.setTemporary(null,0.8,-1,0.2,0.2);ig.light.addDarknessHandle(this.darknessHandle);this.blocked=true;a&&ig.game.playerEntity.cancelAction();this.lightHandle=new ig.LightHandle(ig.game.playerEntity,ig.LIGHT_SIZE.L,0,0,-1,1,false);ig.light.addLightHandle(this.lightHandle)},_endBlock:function(){ig.soundManager.popPaused();ig.slowMotion.clearNamed("forceInput",0);ig.slowMotion.forceUpdate();this.darknessHandle.stop();this.lightHandle.stop();
this.blocked=false;this.gui.remove();var a=ig.game.playerEntity;a&&(a.currentAction&&a.currentAction.eventAction)&&a.cancelAction()}});ig.addGameAddon(function(){return sc.inputForcer=new sc.InputForcer});sc.INPUT_FORCER_ENTRIES={};var b=Vec2.create(),a=Vec2.create();sc.INPUT_FORCER_ENTRIES.DODGE_RIGHT={cancelAction:true,check:function(){if(!sc.control.dashing())return false;sc.control.moveDir(b,0,true);if(Vec2.isZero(b))return false;Vec2.assignC(a,1,0);return Vec2.angle(a,b)>Math.PI*0.2?false:true},
keep:false};sc.INPUT_FORCER_ENTRIES.ATTACK_LEFT={cancelAction:true,check:function(){return!sc.control.fullScreenAttacking()?false:true},keep:false};sc.INPUT_FORCER_ENTRIES.CHARGE_HOLD={check:function(){return!sc.control.charge()?false:true},keep:true};sc.INPUT_FORCER_ENTRIES.CHARGE_RELEASE={check:function(){return sc.control.charge()?false:true},keep:false}});ig.baked=!0;
ig.module("game.feature.tutorial.tutorial-steps").requires("impact.base.action","game.feature.tutorial.input-forcer").defines(function(){ig.EVENT_STEP.START_FORCE_INPUT=ig.EventStepBase.extend({inputEntry:null,title:null,textKeyboard:null,textGamepad:null,_wm:new ig.Config({attributes:{inputEntry:{_type:"String",_info:"Name of player config",_select:sc.INPUT_FORCER_ENTRIES},title:{_type:"LangLabel",_info:"Title of input forcer"},textKeyboard:{_type:"LangLabel",_info:"Text for Keyboard"},textGamepad:{_type:"LangLabel",
_info:"Text for Gamepad"}}}),init:function(b){this.inputEntry=b.inputEntry;this.title=b.title;this.textKeyboard=b.textKeyboard;this.textGamepad=b.textGamepad},start:function(){sc.inputForcer.setEntry(this.inputEntry,this.title,this.textKeyboard,this.textGamepad)},run:function(){return!sc.inputForcer.isBlocking()}});ig.EVENT_STEP.CLEAR_FORCE_INPUT=ig.EventStepBase.extend({_wm:new ig.Config({attributes:{}}),init:function(){},start:function(){sc.inputForcer.clearEntry()}})});ig.baked=!0;
ig.module("game.feature.tutorial.plug-in").requires("game.feature.tutorial.input-forcer","game.feature.tutorial.tutorial-steps").defines(function(){});ig.baked=!0;
ig.module("game.feature.trade.gui.trade-icon").requires("impact.feature.gui.gui","impact.feature.gui.base.box","impact.feature.gui.base.basic-gui","game.feature.interact.map-interact").defines(function(){sc.TradeIconGui=ig.BoxGui.extend({transitions:{DEFAULT:{state:{alpha:1,offsetY:8},time:0.1,timeFunction:KEY_SPLINES.EASE_OUT},HIDDEN:{state:{scaleX:0.4,scaleY:0.5,alpha:0,offsetY:8},time:0.1,timeFunction:KEY_SPLINES.EASE_OUT}},ninepatch:new ig.NinePatch("media/gui/message.png",{width:4,height:4,left:6,
top:6,right:6,bottom:6,offsets:{"default":{x:0,y:112}}}),numberGfx:new ig.Image("media/gui/menu.png"),tradeInfo:null,tradeIcon:null,lineGui:null,entries:[],init:function(b){this.parent(138,40);this.hook.localAlpha=0.6;this.hook.pos.y=7;this.tradeInfo=sc.trade.getTrader(b);this._createContent();this.doStateTransition("HIDDEN",true)},setIconState:function(b){if(b==sc.INTERACT_ENTRY_STATE.FOCUS){this._updateTexts();this.doStateTransition("DEFAULT")}else this.doStateTransition("HIDDEN")},isActive:function(b){return b==
sc.INTERACT_ENTRY_STATE.FOCUS},_createContent:function(){this._createStatic();for(var b=14,a=-1,d=this.tradeInfo.options,c=null,e=null,f=null,g=null,h=sc.inventory,i=0;i<d.length;i++)for(var e=d[i].get,j=0;j<e.length;j++){var g=h.getItem(e[j].id),f="\\i["+(g.icon+sc.inventory.getRaritySuffix(g.rarity||0)||"item-default")+"]"+ig.LangLabel.getText(g.name),k=0;g.type==sc.ITEMS_TYPES.EQUIP&&(k=g.level||1);c=new sc.TextGui(f);c.tradeName=f;c.setAlign(ig.GUI_ALIGN.X_CENTER,ig.GUI_ALIGN.Y_TOP);c.setPos(0,
b);c.level=k;c.isScalable=g.isScalable;c.numberGfx=this.numberGfx;k>0&&c.setDrawCallback(function(a,b){sc.MenuHelper.drawLevel(this.level,a,b,this.numberGfx,this.isScalable)}.bind(c));this.addChildGui(c);this.entries.push({gui:c,require:d[i].require});b=b+(c.hook.size.y-2);if(a<c.hook.size.x)a=c.hook.size.x}this.setSize(Math.min(a+21,138),b+6);this.setPivot(this.hook.size.x/2,this.hook.size.y)},_createStatic:function(){var b=new sc.TextGui(ig.lang.get("sc.gui.trade.tradeOffer"),{font:sc.fontsystem.tinyFont});
b.setAlign(ig.GUI_ALIGN.X_CENTER,ig.GUI_ALIGN.Y_TOP);b.setPos(0,4);this.addChildGui(b);this.lineGui=new ig.ColorGui("#ccc",b.hook.size.x+10,1);this.lineGui.setAlign(ig.GUI_ALIGN.X_CENTER,ig.GUI_ALIGN.Y_TOP);this.lineGui.setPos(0,12);this.addChildGui(this.lineGui)},_updateTexts:function(){for(var b=this.entries.length;b--;){var a=this.entries[b].gui;this._hasMissingItem(this.entries[b].require)?a.setText("\\c[4]"+a.tradeName+"\\c[0]"):a.setText(a.tradeName)}},_hasMissingItem:function(b){for(var a=
b.length;a--;)if(sc.model.player.getItemAmountWithEquip(b[a].id)<b[a].amount)return true},remove:function(){this.doStateTransition("HIDDEN",false,true)}})});ig.baked=!0;
ig.module("game.feature.trade.trade-steps").requires("impact.base.action","impact.base.event").defines(function(){ig.EVENT_STEP.RESET_TRADER=ig.EventStepBase.extend({trader:null,_wm:new ig.Config({attributes:{trader:{_type:"TraderSelect",_info:"The trader to reset."}}}),init:function(b){this.trader=b.trader},start:function(){sc.trade.resetTrader(this.trader)}});ig.EVENT_STEP.START_NPC_TRADE_MENU=ig.EventStepBase.extend({_wm:new ig.Config({attributes:{withBranches:{_type:"Boolean",_info:"If true, use branches to determine whether things where traded or not."}},
branchLabel:function(b){switch(b){case "traded":return"ON TRADE DONE";case "canceled":return"ON TRADE CANCELED";case "_end":return"end trade"}return"???"}}),init:function(b){this.withBranches=b.withBranches||false},start:function(b,a){if(a.callEntity instanceof ig.ENTITY.NPC){b._stashedPersons=sc.model.message.hasPerson();b._stashedPersons&&sc.model.message.stashPersons();a.callEntity.startTradeMenu()}},run:function(b){var a=!sc.model.isOnMapMenu();a&&b._stashedPersons&&sc.model.message.showStashedPersons();
return a},getBranchNames:function(){return this.withBranches?["traded","canceled"]:null},getNext:function(){return!this.withBranches?this._nextStep:sc.trade.sessionTradeCount>0?this.branches.traded||this._nextStep:this.branches.canceled||this._nextStep}})});ig.baked=!0;ig.module("game.feature.trade.plug-in").requires("game.feature.trade.gui.trade-menu","game.feature.trade.gui.trade-icon","game.feature.trade.trade-steps").defines(function(){window.wm&&wm.postLoadModules.push("game.feature.trade.editors.trade-editor")});
ig.baked=!0;
ig.module("game.feature.save-preset.save-preset").requires("impact.base.loader","impact.base.game").defines(function(){var b=["0-before-boss","1-rhombus-dng-start","2-continue-story","3-autumn-rise","4-apollo-duel","5-before-bergen","6-before-maroon","7-fajro-temple","8-autumns-fall"];sc.SavePresetData=ig.JsonLoadable.extend({cacheType:"SavePresetData",title:null,sub:null,saveSlot:null,onCacheCleared:function(){},getJsonPath:function(){return ig.root+this.path.toPath("data/save-presets/",".json")+
ig.getCacheSuffix()},onload:function(a){this.title=new ig.LangLabel(a.title);this.sub=new ig.LangLabel(a.sub);this.saveSlot=new ig.SaveSlot(a.savefile);sc.version.updateSaveSlotVersion(this.saveSlot)}});sc.SavePreset=ig.GameAddon.extend({slots:[],init:function(){if(!window.wm)for(var a=0;a<b.length;++a)this.slots[a]=new sc.SavePresetData(b[a])},load:function(a){a=ig.copy(this.slots[a].saveSlot);ig.game.loadStart(a)}});sc.savePreset=new sc.SavePreset;ig.addGameAddon(function(){return sc.savePreset})});
ig.baked=!0;ig.module("game.feature.save-preset.plug-in").requires("game.feature.save-preset.save-preset").defines(function(){});ig.baked=!0;
ig.module("game.feature.xeno-dialogs.entities.xeno-dialog").requires("impact.base.entity","impact.feature.effect.effect-sheet").defines(function(){var b=80,a=200,d=120,c=a,b=b*b,a=a*a,d=d*d,e=[];ig.LANG_CONTEXT.XenoDialog=function(a){return"XENO_DIALOG["+(a.settings.name||"")+"]"};ig.ENTITY.XenoDialog=ig.Entity.extend({_wm:new ig.Config({spawnable:true,attributes:{spawnCondition:{_type:"VarCondition",_info:"optional spawn condition, leave empty for true",_popup:true},dialog:{_type:"XenoDialog",_info:"The dialog"},
ignoreZ:{_type:"Boolean",_info:"If true, ignore Z pos when checking range",_optional:true,_default:true},endlessDialog:{_type:"Boolean",_info:"if true, skip dialog wait after dialog has been completed resulting in an endless dialog loop"},once:{_type:"Boolean",_info:"Only play this dialog once."}},drawBox:true,draw:function(a,b){if(!wm.mapConfig.boxDraw.hidden){if(b.members&&b.members.length==0)b.members=null;b._initMembers();if(a)for(var d=b.members.length;d--;)b.sprites.push(ig.spritePool.get(false));
else if(b.members&&b.sprites.length!=1)for(var e=null,j=null,d=b.members.length,k=2,l=b.coll.pos.x+b.coll.size.x/2,o=b.coll.pos.y+b.coll.size.y/2-b.coll.pos.z;d--;)if(b.members[d]){e=b.members[d].coll;j=b.sprites[b.sprites.length-k];k++;if(j){j.setPos(e.pos.x,e.pos.y,e.pos.z);j.setSize(16,16,0);j.setImageSrc(new ig.ComplexLineCircleBox("rgba(128,0,128, 0.5)","rgba(200, 200, 200, 0.1)",l,o,c))}}}},boxColor:"rgba(128,0,128, 0.5)",label:function(){return""}}),dialog:null,members:null,running:false,blockTimer:0,
padTimer:0,currentTextIndex:-1,currentEntity:null,currentText:"",currentEvent:null,fx:{sheet:new ig.EffectSheet("npc"),handle:null},once:false,hasRunOnce:false,ignoreZ:false,init:function(a,b,c,d){this.parent(a,b,c,d);this.coll.setSize(16,16,0);this.coll.type=ig.COLLTYPE.IGNORE;this.endlessDialog=d.endlessDialog;this.once=d.once||false;this.ignoreZ=d.ignoreZ||false;if(this.once&&ig.vars.get("map.xeno-dialog-once_"+this.mapId))this.hasRunOnce=true;this.dialog=[];a=d.dialog;for(b=0;b<a.length;b++)if(c=
a[b]){c={entitySource:c.entity,text:new ig.LangLabel(c.text),event:c.event?new ig.Event({steps:c.event}):null,entity:null,timePadding:c.timePadding};ig.langEdit&&ig.langEdit.submitMap("Xeno MSG "+(c.entitySource&&c.entitySource.name),c.text);this.dialog.push(c)}},onHideRequest:function(){this.cancelDialog();this.hide()},onKill:function(a){this.cancelDialog();this.parent(a)},update:function(){this.parent();this._initMembers();var c=!sc.model.isCutscene()&&this.currentEntity&&this.currentEvent&&!sc.model.isCombatActive();
c&&!this.fx.handle?this._showFx():!c&&this.fx.handle&&this._clearFx();if(!ig.game.isControlBlocked()&&!sc.model.isCutscene())if(this.blockTimer>0)this.blockTimer=this.blockTimer-ig.system.tick;else if(!this.once||!this.hasRunOnce)if(this.running)if(this.currentTextIndex==-1?this._isInRange(d):this._isInRange(a)){if(this.padTimer>0)this.padTimer=this.padTimer-ig.system.tick;this.padTimer<=0&&this._showNextMessage()}else this.cancelDialog();else this._isInRange(b,!this.ignoreZ)&&this.startDialog()},
startDialog:function(){for(var a=e.length;a--;)e[a].cancelDialog();this.running=true;e.push(this)},cancelDialog:function(){if(this.currentTextIndex>=this.dialog.length&&this.once){ig.vars.set("map.xeno-dialog-once_"+this.mapId,true);this.hasRunOnce=true}this._clearFx();this.running=false;this._clearCurrentIndex();this.currentTextIndex=-1;this.padTimer=0;e.erase(this)},getCurrentText:function(){return this.currentText||"Hello World"},getCallbackEvent:function(){return this.currentEvent},onEventStart:function(){this._clearFx();
this.running=false;this._clearCurrentIndex();this.blockTimer=1;this.currentTextIndex=-1;this.padTimer=0},onEventEnd:function(){this.blockTimer=1;this.cancelDialog()},_clearFx:function(){if(this.fx.handle){this.fx.handle.stop();this.fx.handle=null}},_showFx:function(){if(sc.options.get("xeno-pointer"))this.fx.handle=this.fx.sheet.spawnOnTarget("xenoAlert",ig.game.playerEntity,{duration:-1,target2:this.currentEntity,offset:{x:0,y:0,z:12},target2Offset:{x:0,y:0,z:12}})},_showNextMessage:function(){this._clearCurrentIndex();
this._clearFx();this.currentTextIndex++;if(this.currentTextIndex>=this.dialog.length){if(this.once){this.running=false;ig.vars.set("map.xeno-dialog-once_"+this.mapId,true);this.hasRunOnce=true}if(this.endlessDialog)this.currentTextIndex=0;else{this.currentTextIndex=-1;this.padTimer=2;return true}}var a=this.dialog[this.currentTextIndex];this.currentEntity=a.entity;this.currentEvent=a.event;this.currentText=a.text;ig.langEdit&&ig.langEdit.submitRecent("Xeno MSG "+(a.entitySource&&a.entitySource.name),
a.text);this.currentEntity.setXenoDialog(this);this.padTimer=a.timePadding==void 0?Math.max(1.5,this.currentText.toString().length/25*1.1+1.2):this.currentText.toString().length*0.03+a.timePadding;if(this.currentEvent)this.padTimer=this.padTimer+2;return false},_clearCurrentIndex:function(){if(!(this.currentTextIndex<0)){this.currentEntity.cancelXenoDialog();this.currentEvent=this.currentText=this.currentEntity=null}},_isInRange:function(a,b){for(var c=ig.game.playerEntity.coll,d=this.members.length,
e=null,k=0,e=0;d--;){e=this.members[d].coll;if(!(b&&c.pos.z!=e.baseZPos)){k=c.pos.x+c.size.x/2-(e.pos.x+e.size.x/2);e=c.pos.y+c.size.y/2-(e.pos.y+e.size.y/2);if(k*k+e*e<=a)return true}}return false},_initMembers:function(){if(!this.members){this.members=[];for(var a=this.dialog.length,b=null,c=null;a--;){b=this.dialog[a];(c=ig.Event.getEntity(b.entitySource))&&this.members.indexOf(c)==-1&&this.members.push(c);b.entity=c||null}}}})});ig.baked=!0;
ig.module("game.feature.xeno-dialogs.gui.xeno-icon").requires("impact.feature.gui.gui","impact.feature.gui.base.box","impact.feature.gui.base.basic-gui","game.feature.interact.map-interact","game.feature.msg.gui.msg-skip-hud").defines(function(){sc.XenoDialogIcon=ig.BoxGui.extend({transitions:{DEFAULT:{state:{alpha:1,offsetY:8},time:0.1,timeFunction:KEY_SPLINES.EASE_OUT},HIDDEN:{state:{scaleX:0.4,scaleY:0.5,alpha:0,offsetY:8},time:0.1,timeFunction:KEY_SPLINES.EASE_OUT}},ninepatch:new ig.NinePatch("media/gui/message.png",
{width:4,height:4,left:6,top:6,right:6,bottom:6,offsets:{"default":{x:0,y:112},highlight:{x:16,y:112}}}),textGui:null,skipGui:null,xenoDialog:null,skipEntry:null,init:function(){this.parent(40,40);this.hook.localAlpha=0.7;this.hook.pos.y=4;this.textGui=new sc.TextGui("This is a sample text.",{font:sc.fontsystem.smallFont,maxWidth:140,speed:ig.TextBlock.SPEED.SLOW,linePadding:0,optimize:true,bestRatio:4});this.textGui.setAlign(ig.GUI_ALIGN.X_CENTER,ig.GUI_ALIGN.Y_CENTER);this.textGui.textBlock.onFinish=
this.onTextFinish.bind(this);this.addChildGui(this.textGui);this.setSize(this.textGui.hook.size.x+8,this.textGui.hook.size.y+4);this.setPivot(this.hook.size.x/2,this.hook.size.y);this.doStateTransition("HIDDEN",true);this.skipGui=new sc.MsgSkipGui;this.addChildGui(this.skipGui);this.skipGui.doStateTransition("HIDDEN",true);this.skipGui.setAlign(ig.GUI_ALIGN.X_LEFT,ig.GUI_ALIGN.Y_BOTTOM);this.skipEntry=new sc.SkipInteractEntry(this,20)},onTextFinish:function(){this.updateSkipIcon()},isTextFinished:function(){return this.textGui.textBlock.isFinished()},
updateSkipIcon:function(){this.textGui.textBlock.isFinished()&&this.skipEntry.isActive()?this.skipGui.show():this.skipGui.hide()},setText:function(b,a){this.xenoDialog=a;this.textGui.setText(b||"This is an empty test");var d=this.xenoDialog.currentEvent?3:2,c=Math.max(30,this.textGui.hook.size.x+(this.xenoDialog.currentEvent?6:4)*2);this.setSize(c,this.textGui.hook.size.y+d*2);this.setPivot(this.hook.size.x/2,this.hook.size.y);this.skipGui.setPos(this.hook.size.x+1,0);sc.skipInteract.addEntry(this.skipEntry);
this.currentTileOffset=this.xenoDialog.currentEvent?"highlight":"default";this.hook.localAlpha=this.xenoDialog.currentEvent?0.85:0.7;this.updateSkipIcon()},show:function(){this.textGui.reset();this.doStateTransition("DEFAULT")},hide:function(){sc.skipInteract.removeEntry(this.skipEntry);this.updateSkipIcon();this.doStateTransition("HIDDEN")},onSkipInteract:function(b){b==sc.SKIP_INTERACT_MSG.SKIPPED&&(this.textGui.textBlock.isFinished()?this.xenoDialog._showNextMessage():this.textGui.finish());this.updateSkipIcon()},
setIconState:function(){},isActive:function(b){return b!=sc.INPUT_FORCER_ENTRIES.HIDDEN},remove:function(){this.doStateTransition("HIDDEN",false,true)}})});ig.baked=!0;ig.module("game.feature.xeno-dialogs.plug-in").requires("game.feature.xeno-dialogs.entities.xeno-dialog","game.feature.xeno-dialogs.gui.xeno-icon").defines(function(){window.wm&&wm.postLoadModules.push("game.feature.xeno-dialogs.editors.xeno-dialog-editor")});ig.baked=!0;
ig.module("game.feature.quest.quest-types").defines(function(){sc.QuestSubTaskBase=ig.Class.extend({type:null,init:function(b){this.type=b.type||"THROWS_ERROR"}});sc.QUEST_SUB_TASK={};sc.QUEST_SUB_TASK.COLLECT=sc.QuestSubTaskBase.extend({_wm:new ig.Config({attributes:{item:{_type:"Item",_info:"The item to collect."},amount:{_type:"Number",_info:"the amount you need to collect.",_default:1},keepItems:{_type:"Boolean",_info:"True if the player can keep the items",_default:"false"},hideName:{_type:"Boolean",
_optional:true,_default:"true",_info:"True if the name should be hidden until at least one of the item has been found or the sub task is finished"},hideMax:{_type:"Boolean",_optional:true,_default:"true",_info:"True if the max number should be hidden until the subtask is solved."}}}),item:0,amount:0,keepItems:false,hideName:false,hideMax:false,init:function(b){this.parent(b);this.item=b.item;this.amount=b.amount;this.keepItems=b.keepItems;this.hideName=b.hideName||false;this.hideMax=b.hideMax||false},
initState:function(b){b.collected=sc.model.player.getItemAmount(this.item)},updateState:function(b,a,d,c){if(c||a.item==this.item)b.collected=sc.model.player.getItemAmount(this.item)},getCurrentValue:function(b,a){return a?this.amount-b.collected:b.collected},finalize:function(){this.keepItems||sc.model.player.removeItem(this.item,this.amount,false,true)},isFulfilled:function(b){return b.collected>=this.amount},reset:function(){}});sc.QUEST_SUB_TASK.KILL=sc.QuestSubTaskBase.extend({_wm:new ig.Config({attributes:{enemy:{_type:"EnemyName",
_info:"The enemy you need to defeat"},amount:{_type:"Number",_info:"the amount you need to defeat.",_default:1}}}),enemy:0,amount:0,init:function(b){this.parent(b);this.enemy=b.enemy;this.amount=b.amount},initState:function(b){b.killed=0},updateState:function(b,a){a.enemy==this.enemy&&(b.killed=b.killed+a.amount)},getCurrentValue:function(b,a){return a?this.amount-b.killed:b.killed},isFulfilled:function(b){return b.killed>=this.amount},reset:function(b){ig.debug("RESTORE [KILL]: enemy:"+this.enemy+
", amount: "+this.amount);b.killed=0}});sc.QUEST_SUB_TASK.CONDITION=sc.QuestSubTaskBase.extend({_wm:new ig.Config({attributes:{label:{_type:"String",_info:"The label inside the quest that will be set to true"},text:{_type:"LangLabel",_info:"The text that should be displayed as subtask",_optional:true},shortText:{_type:"LangLabel",_info:"short version for minified GUI",_optional:true}},label:function(){return"<b>CONDITION</b>  <code>label:"+this.label+(this.text?" text: <i style='color: orange'>"+
wmPrint("LangLabel",this.text)+"</i>":"")}}),text:null,"short":null,label:null,init:function(b){this.parent(b);this.text=b.text?new ig.LangLabel(b.text):"";this.short=b.shortText?new ig.LangLabel(b.shortText):null;this.label=b.label||null},initState:function(b){b.active=false},updateState:function(b,a,d){if(this.label==a.label){b.active=a.value;b.active&&(d[this.label]=true)}},getCurrentValue:function(b,a){return a?false:b.active},isFulfilled:function(b){return b.active},reset:function(b,a){ig.debug("RESTORE [CONDITION]: label:"+
this.label);b.active=false;a[this.label]=false}});sc.QUEST_SUB_TASK.QUEST=sc.QuestSubTaskBase.extend({_wm:new ig.Config({attributes:{quest:{_type:"SubQuestSelect",_info:"Quest to solve. Select parent quest first."},text:{_type:"LangLabel",_info:"The text that should be displayed as subtask",_optional:true},shortText:{_type:"LangLabel",_info:"short version for minified GUI",_optional:true}},label:function(){return"<b>QUEST</b>  <code>quest:"+this.quest+(this.text?" text: <i style='color: orange'>"+
wmPrint("LangLabel",this.text)+"</i>":"")}}),quest:null,text:null,"short":null,init:function(b){this.parent(b);this.quest=b.quest||null;this.text=b.text?new ig.LangLabel(b.text):"";this.short=b.shortText?new ig.LangLabel(b.shortText):null},initState:function(b){b.active=false},updateState:function(b,a,d,c){if(c){b.active=sc.quests.isQuestSolved(this.quest);ig.debug("SubQuest done after prev task finished: "+this.quest+" | state: "+b.active)}else this.quest==a.quest&&(b.active=a.value)},getCurrentValue:function(b,
a){return a?false:b.active},isFulfilled:function(b){return b.active}});sc.QUEST_SUB_TASK.LANDMARK=sc.QuestSubTaskBase.extend({_wm:new ig.Config({attributes:{area:{_type:"Select",_info:"The item to check",_select:"areas"},amount:{_type:"Number",_info:"the amount you need to unlock.",_default:1}}}),area:0,amount:0,init:function(b){this.parent(b);this.area=b.area;this.amount=b.amount},initState:function(b){b.unlocked=sc.map.getTotalLandmarksFoundInArea(this.area)},updateState:function(b,a,d,c){if(c||
a.area==this.area)b.unlocked=sc.map.getTotalLandmarksFoundInArea(this.area)},getCurrentValue:function(b,a){return a?this.amount-b.unlocked:b.unlocked},isFulfilled:function(b){return b.unlocked>=this.amount}});sc.QuestTask=ig.Class.extend({task:"",subTasks:[],containsCollect:false,subQuests:null,skipNotify:false,init:function(b,a){this.task=new ig.LangLabel(b.task);this.subTasks=[];this.skipNotify=b.skipNotify||false;for(var d=b.subtasks,c=0;c<d.length;c++){var e=new sc.QUEST_SUB_TASK[d[c].type](d[c]);
if(e.type=="CONDITION")a.labelList.push(e.label);else if(e.type=="COLLECT"||e.type=="LANDMARK")this.containsCollect=true;else if(e.type=="QUEST"){if(!this.subQuests)this.subQuests=[];this.subQuests.push(e.quest)}this.subTasks.push(e)}}});sc.Quest=ig.Class.extend({name:"",level:1,order:0,description:"",endDescription:"",tasks:null,rewards:null,id:null,person:null,personAfter:null,labelList:[],hideRewards:false,area:null,noTrack:false,extension:false,parentQuest:null,elite:false,mandatory:false,hubSettings:null,
location:{area:"",map:""},timeStamp:0,character:null,init:function(b,a){this.level=b.level||1;this.name=new ig.LangLabel(b.name);this.description=new ig.LangLabel(b.description);this.endDescription=new ig.LangLabel(b.briefing);this.rewards=b.rewards||{};this.id=a||null;this.noTrack=b.noTrack||false;this.extension=b.extension||false;this.order=b.order||-1;this.person=new ig.LangLabel(b.person||"???");this.hideRewards=b.hideRewards||false;this.area=b.area||null;this.parentQuest=b.parent||null;this.elite=
b.elite||null;this.mandatory=b.mandatory||false;this.hubSettings=b.hubSettings||null;if(b.hubSettings)this.hubSettings={character:b.hubSettings.character||null,hideChar:b.hubSettings.hideChar||false,location:new ig.LangLabel(b.hubSettings.location||"???"),condition:b.hubSettings.condition||""};if(b.personAfter)this.personAfter=new ig.LangLabel(b.personAfter||"???");this.tasks=[];for(var d=b.tasks,c=0;c<d.length;c++){this.tasks.push(new sc.QuestTask(d[c],this));if(c>0&&this.tasks[c].subQuests)throw Error("Sub Quest found in"+
c+" task. Can only be in first task!");}}})});ig.baked=!0;
ig.module("game.feature.quest.quest-model").requires("impact.base.game","impact.base.loader","impact.feature.database.database","game.config","game.feature.quest.quest-types","game.feature.model.game-model","game.feature.combat.combat","game.feature.timers.timers-model").defines(function(){var b={quest:null,state:null},a={item:0,amount:0,enemy:null,quest:null};sc.QUEST_LIST_TYPE={ACTIVE:0,SOLVED:1,ALL:2};sc.QUEST_SORT_TYPE={ACCEPTED:0,ORDER:1,NAME:2,LEVEL:3};var d={"rookie-harbor":0,"autumn-area":1,
"autumn-fall":2,"bergen-trails":3,bergen:4,"heat-area":5,"heat-village":6,jungle:7,"jungle-city":8};sc.QuestModel=ig.GameAddon.extend({observers:[],staticQuests:{},activeQuests:[],finishedQuests:{},focusQuest:-1,markedQuests:[],_activeQuestIndex:{},_solvedQueue:[],_solvedTimer:0,_hasSolveDialogs:false,_subQuest:[],init:function(){this.parent("Quests");this._loadStaticQuests();if(window.wm){ig.database.register("quests","QuestEnumEditor","Quests");ig.database.register("questHubs","QuestHubList","Quest Hubs")}ig.storage.register(this);
ig.vars.registerVarAccessor("quest",this,"VarQuestEditor");ig.vars.registerVarAccessor("questHubs",this,"VarQuestHubEditor");sc.combat.addCombatListener(this);sc.Model.addObserver(sc.model.player,this)},getTotalQuestsSolved:function(a,b,d,g){var h=0,i=0,j;for(j in this.staticQuests)if(!(b&&this.staticQuests[j].area!=b)&&(!d||this.staticQuests[j].hubSettings)&&!this.staticQuests[j].noTrack&&!this.staticQuests[j].extension){this.finishedQuests[j]&&h++;i++}return i?a?h/i:h:g?1:0},getTotalHubQuestsSolved:function(a,
b){b=b||{total:0,solved:0};b.total=0;b.solved=0;for(var d in this.staticQuests){var g=this.staticQuests[d];if(a==g.area&&(g.hubSettings&&!g.noTrack)&&(!g.extension||ig.extensions.hasExtension(g.extension))){this.finishedQuests[d]&&b.solved++;b.total++}}},hasAreaQuests:function(a){var b=this.staticQuests,d;for(d in b)if(b[d].area==a)return true;return false},onPreUpdate:function(){if(sc.model.isOutOfCombatDialogReady())if(this._solvedQueue.length>=1)if(this._solvedTimer<=0){var a=this._solvedQueue.splice(0,
1)[0];this._hasSolveDialogs=true;a=this.getQuestEvent(this.staticQuests[a]);sc.Cutscene.startCutscene(a);this._solvedTimer=0}else this._solvedTimer=this._solvedTimer-ig.system.actualTick;else this._hasSolveDialogs=false},resetOrder:-1,onReset:function(){this.activeQuests.length=0;this._activeQuestIndex={};this.focusQuest=-1;this._solvedTimer=this._solvedQueue.length=0;this.finishedQuests={};this.markedQuests=[];sc.Model.notifyObserver(this,sc.QUEST_MODEL_EVENT.FAV_QUEST_CHANGED)},popInlineSolvedQuest:function(){if(this._solvedQueue.length>=
1){this._hasSolveDialogs=true;ig.vars.set("tmp._questRewardsFinished",false);var a=this._solvedQueue.splice(0,1)[0];this.getInlineQuestResolve(this.staticQuests[a]);return true}return this._hasSolveDialogs=false},getInlineQuestResolve:function(a){a=ig.gui.createEventGui(null,"QuestSolvedDialog",{quest:a});ig.gui.spawnEventGui(a)},getQuestEvent:function(a){return new ig.Event({steps:[{type:"WAIT",time:0.2,ignoreSlowDown:true},{type:"ADD_GUI",name:null,guiInfo:{type:"QuestSolvedDialog",settings:{quest:a}}},
{type:"WAIT_UNTIL_TRUE",condition:"tmp._questRewardsFinished"},{type:"WAIT",time:0.1,ignoreSlowDown:true}]})},markQuest:function(a){if(this.isQuestSolved(a)){this.markedQuests.erase(a);this.focusQuest=-1;sc.Model.notifyObserver(this,sc.QUEST_MODEL_EVENT.FAV_QUEST_CHANGED,-1E4)}else{this.markedQuests.indexOf(a)==-1?this.markedQuests.push(a):this.markedQuests.erase(a);this.focusQuest=-1;sc.Model.notifyObserver(this,sc.QUEST_MODEL_EVENT.FAV_QUEST_CHANGED,-1E4);this.sortIDList(this.markedQuests)}},isMarkedQuest:function(a){for(var b=
this.markedQuests.length;b--;)if(a==this.markedQuests[b])return true;return false},hasQuestSolvedDialogs:function(){return this._hasSolveDialogs},hasSolvedQuestsStacked:function(){return this._solvedQueue.length>0},setFavQuestOld:function(a){if(a<0)return false;a==this.focusQuest&&(a=-1);var b=this.focusQuest;this.focusQuest=a;sc.Model.notifyObserver(this,sc.QUEST_MODEL_EVENT.FAV_QUEST_CHANGED,b);return true},cycleFavQuest:function(a,b){if(this.markedQuests.length!=0){var d=this.focusQuest,a=a||0;
this.focusQuest=this.focusQuest+a;if(a>=0){if(this.focusQuest>=this.markedQuests.length)this.focusQuest=-1}else if(this.focusQuest==-2)this.focusQuest=this.markedQuests.length-1;else if(this.focusQuest<0)this.focusQuest=-1;if(this.focusQuest!=-1&&this.isMarkedQuestDone()){this.markedQuests.splice(this.focusQuest,1);this.cycleFavQuest(a,b)}else b||sc.Model.notifyObserver(this,sc.QUEST_MODEL_EVENT.FAV_QUEST_CHANGED,d)}},sendNotification:function(a,d,f){a==sc.QUEST_MODEL_EVENT.FINISHED&&this.setQuestFinished(d.quest,
f);b.state=d||null;b.quest=d.quest||null;sc.Model.notifyObserver(this,a,b)},createQuest:function(a){a=new sc.Quest(a);this._setCurrentLocationAndTime(a);var d=new sc.QuestState(a);b.quest=a;b.state=d;this.activeQuests.push(d);sc.Model.notifyObserver(this,sc.QUEST_MODEL_EVENT.ADDED,b);sc.commonEvents.triggerEvent("QUEST_ACCEPTED",{});ig.game.varsChangedDeferred()},activateStaticQuest:function(a,d,f){var g=this.staticQuests[a];if(!g)throw Error("Could not find quest with ID: "+a);if(this._hasAlreadyFinished(g))throw Error("Static quest is already finished! Quest ID: "+
a);this._setCurrentLocationAndTime(g,d,f);d=new sc.QuestState(g);if(!d.finished){this.activeQuests.push(d);this._activeQuestIndex[a]=this.activeQuests.length-1;b.quest=g;b.state=d;sc.stats.setMapMax("quests","active",this.activeQuests.length);sc.menu.addLog({type:"QUEST",accept:true,quest:a});sc.Model.notifyObserver(this,sc.QUEST_MODEL_EVENT.ADDED,b);sc.commonEvents.triggerEvent("QUEST_ACCEPTED",{})}ig.game.varsChangedDeferred();return d},solveQuestCondition:function(b,d){for(var f=this.staticQuests[b],
g=this.activeQuests.length;g--;){var h=this.activeQuests[g];if(h.quest==f){h.labels[d]=true;a.label=d;a.value=true;h.updateState("CONDITION",a);ig.game.varsChangedDeferred();return}}throw Error("Tried to solve condition of quest that is not active");},updateQuestLocation:function(a){if(this.isQuestActive(a)){a=this.staticQuests[a];a.location.area=sc.map.getCurrentPlayerAreaName();a.location.map=sc.map.getCurrentMapName(true)}},resetQuestTask:function(a,b){var d=this._activeQuestIndex[a];if(d!=void 0){this.activeQuests[d].resetTaskIndex(b);
ig.game.varsChangedDeferred()}},updateActiveQuests:function(a,b){for(var d=this.activeQuests.length;d--;)this.activeQuests[d].updateState(a,b);ig.game.varsChangedDeferred()},resolveActiveQuestChanges:function(a,b){for(var d=this.activeQuests.length;d--;)this.activeQuests[d].updateState(a,b,true);ig.game.varsChangedDeferred()},setQuestFinished:function(b,d){if(this.finishedQuests[b.id])throw Error("Static quest has already been finished! ID: "+b.id);if(!d){var f=this._activeQuestIndex[b.id];if(f==
void 0){console.error("Quest with State %O is not an active quest and cannot be finished!",b.id);return}this.activeQuests.splice(f,1);for(var g in this._activeQuestIndex)this._activeQuestIndex[g]>=f&&(this._activeQuestIndex[g]=this._activeQuestIndex[g]-1)}sc.menu.addLog({type:"QUEST",finish:true,quest:b.id});this._solvedQueue.push(b.id);if((f=this.getMarkedQuest())&&f.id==b.id)this.focusQuest=-1;this.isMarkedQuest(b.id)&&this.markQuest(b.id);if(b.id){this.finishedQuests[b.id]={solved:true};d||delete this._activeQuestIndex[b.id]}sc.stats.addMap("quests",
"solved",1);sc.stats.setMap("quests","solvedTotal",this.getTotalQuestsSolved(true));ig.game.varsChangedDeferred();a.quest=b.id;a.value=true;this.updateActiveQuests("QUEST",a)},finishUpQuest:function(a){this._collectRewards(a);sc.Model.notifyObserver(this,sc.QUEST_MODEL_EVENT.POST_FINISHED,a)},isQuestActive:function(a){return this._activeQuestIndex[a]!=void 0},isQuestSolved:function(a){return this.finishedQuests[a]},isQuestLabelSolved:function(a,b){var d=this.getQuestState(a);return d?d.labels[b]:
this.isQuestSolved(a.id)?true:false},getQuestState:function(a){return this.activeQuests[this._activeQuestIndex[a.id]]},getSubQuests:function(a){if(a.tasks[0]&&a.tasks[0].subQuests)return a.tasks[0].subQuests},getQuestTask:function(a,b){if(this.staticQuests[a])return this.staticQuests[a].tasks[b]},getStaticQuest:function(a){return this.staticQuests[a]},isTaskDone:function(a,b){var d=this.activeQuests[this._activeQuestIndex[a.id]];return d?d.currentTask>b:this.finishedQuests[a.id]?true:false},getCurrentTask:function(a,
b){var d=this.activeQuests[this._activeQuestIndex[a.id]];if(d)return b?d.highestTask:d.currentTask;if(this.finishedQuests[a.id])return a.tasks.length-1},getQuestName:function(a){return!this.staticQuests[a]?"NO QUEST":this.staticQuests[a].name},getQuestList:function(a,b){var d=[];if(a==sc.QUEST_LIST_TYPE.ACTIVE||a==sc.QUEST_LIST_TYPE.ALL)for(var g=this.activeQuests.length;g--;)d.push(this.activeQuests[g].quest);if(a==sc.QUEST_LIST_TYPE.SOLVED||a==sc.QUEST_LIST_TYPE.ALL)for(var h in this.finishedQuests)d.push(this.staticQuests[h]);
b!=void 0&&this.sortQuestList(d,b);return d},sortIDList:function(a){a.sort(function(a,b){return this.staticQuests[b].timeStamp-this.staticQuests[a].timeStamp}.bind(this))},sortQuestList:function(a,b){switch(b){case sc.QUEST_SORT_TYPE.ACCEPTED:a.sort(function(a,b){return b.timeStamp-a.timeStamp});break;case sc.QUEST_SORT_TYPE.ORDER:a.sort(function(a,b){var c=a.order,e=b.order,c=c+(d[a.area]||0)*1E5,e=e+(d[b.area]||0)*1E5;return c-e});break;case sc.QUEST_SORT_TYPE.NAME:a.sort(function(a,b){return a.name.toString().localeCompare(b.name.toString())});
break;case sc.QUEST_SORT_TYPE.LEVEL:a.sort(function(a,b){return a.level!=b.level?a.level-b.level:b.timeStamp-a.timeStamp})}},getActiveQuestID:function(a){return this._activeQuestIndex[a.id]},_sortOrder:function(a,b){return a.order-b.order},getMarkedQuest:function(){return this.focusQuest<0?null:this.staticQuests[this.markedQuests[this.focusQuest]]},getCurrentMarkedQuestTaskIndex:function(){return this.focusQuest<0?null:this.activeQuests[this.getActiveQuestID(this.staticQuests[this.markedQuests[this.focusQuest]])].currentTask},
isMarkedQuestDone:function(){if(!this.markedQuests[this.focusQuest])return true;var a=this.activeQuests[this.getActiveQuestID(this.staticQuests[this.markedQuests[this.focusQuest]])];return!a?true:a.isDone()},isMarkedTaskDone:function(a){return this.focusQuest<0?false:this.activeQuests[this.focusQuest].currentTask>a},getMarkedTaskIndex:function(a){for(var b=this.activeQuests[this.focusQuest].quest,d=b.tasks.length;d--;)if(b.tasks[d]==a)return d},getSubTaskState:function(a,b,d){return this.activeQuests[this._activeQuestIndex[a.id]]?
this.activeQuests[this._activeQuestIndex[a.id]].done[b][d]:{}},isSubTaskDone:function(a,b,d){return this.activeQuests[this._activeQuestIndex[a.id]]?a.tasks[b].subTasks[d].isFulfilled(this.activeQuests[this._activeQuestIndex[a.id]].done[b][d]):false},onVarAccess:function(a,b){if(b[0]=="quest"){var d=this._activeQuestIndex[b[1]];if(d!=void 0&&d>=0){if(d=this.activeQuests[d])switch(b[2]){case "started":return true;case "solved":return d.finished;case "task":return d.currentTask==b[3]*1;case "currentTask":return d.currentTask;
case "subtask":return d.isSubTaskSolved(b[3]*1);case "subvalue":return d.getCurrentSubTaskValue(b[3]*1)+"";case "subrequire":return d.getCurrentSubTaskValue(b[3]*1,true)+"";case "label":return d.labels[b[3]]}}else if(this.finishedQuests[b[1]]){d=this.staticQuests[b[1]];switch(b[2]){case "task":return d.tasks.length==b[3]*1;case "currentTask":return d.tasks.length;default:return true}}}},onCombatEvent:function(b,d){if(d==sc.COMBAT_EVENT.DEFEATED){a.enemy=b.enemyName||null;a.amount=1;this.updateActiveQuests("KILL",
a)}},onLandmarkEvent:function(b){if(b){a.area=b;this.updateActiveQuests("LANDMARK",a)}},modelChanged:function(b,d,f){if(b==sc.model.player)if(d==sc.PLAYER_MSG.ITEM_OBTAINED){a.item=f.id;a.amount=f.amount;this.updateActiveQuests("COLLECT",a)}else if(d==sc.PLAYER_MSG.ITEM_REMOVED){a.item=f.id;a.amount=-f.amount;this.resolveActiveQuestChanges("COLLECT",a)}else if(d==sc.PLAYER_MSG.ITEM_USED){a.item=f;a.amount=-1;this.resolveActiveQuestChanges("COLLECT",a)}else if(d==sc.PLAYER_MSG.EQUIP_CHANGE)if(f.amount<
0){a.item=f.id;a.amount=-1;this.resolveActiveQuestChanges("COLLECT",a)}else if(f.amount>0){a.item=f.id;a.amount=1;this.updateActiveQuests("COLLECT",a)}},_collectRewards:function(a){if(a.rewards){var b=sc.model.player,d=a.rewards;if(d.exp){a=b.addExperience(d.exp.exp,a.level,d.exp.bonus,true,sc.LEVEL_CURVES.QUEST);sc.stats.addMap("quests","exp",a)}if(d.money){b.addCredit(d.money);sc.stats.addMap("quests","money",d.money||0)}if(d.cp){a=d.cp.element;if(a=="ALL_ELEMENTS"){b.addSkillPoints(d.cp.amount,
sc.ELEMENT.HEAT,false,true);b.addSkillPoints(d.cp.amount,sc.ELEMENT.COLD,false,true);b.addSkillPoints(d.cp.amount,sc.ELEMENT.SHOCK,false,true);b.addSkillPoints(d.cp.amount,sc.ELEMENT.WAVE,false,true);sc.stats.addMap("quest","cp",d.cp.amount)}else{b.addSkillPoints(d.cp.amount,a=="ALL"?-1:sc.ELEMENT[a],a=="ALL",true);sc.stats.addMap("quest","cp",d.cp.amount*(a=="ALL"?5:1))}}if(d.items)for(a=0;a<d.items.length;a++){b.addItem(d.items[a].id,d.items[a].amount,true);sc.stats.addMap("quests","rewards",1)}}},
updateTimeStamp:function(a,b){a.timeStamp=sc.stats.getMap("player","playtime")+b},_setCurrentLocationAndTime:function(a,b,d){a.location.area=sc.map.getCurrentPlayerAreaName();a.location.map=d?sc.map.getMapName(d):sc.map.getCurrentMapName(true);a.timeStamp=sc.stats.getMap("player","playtime");a.character=b||null},_hasAlreadyFinished:function(a){return this.finishedQuests[a.id]},_loadStaticQuests:function(){this.staticQuests={};var a=ig.database.get("quests"),b;for(b in a)this.staticQuests[b]=new sc.Quest(a[b],
b);ig.JSON_LOG&&ig.log("%cDATABASE: %cLoaded Static Quests: \n%O","color:orange","",this.staticQuests)},onStorageSave:function(a){var b={};b.focusQuest=this.focusQuest;b.markedQuests=ig.copy(this.markedQuests);b.finished=ig.copy(this.finishedQuests);b.solvedQueue=ig.copy(this._solvedQueue);var d={},g=null,h;for(h in this.staticQuests){g=this.staticQuests[h];g.timeStamp>0&&(d[h]={time:g.timeStamp,location:{area:g.location.area.data,map:g.location.map.data},character:g.character})}b.locale=d;d=[];g=
this.activeQuests.length;for(h=null;g--;){h=this.activeQuests[g];d[g]=h.getSaveData()}b.states=d;a.quests=b},onStoragePreLoad:function(a){(a=a.quests)||(a={});this.focusQuest=a.focusQuest==void 0?-1:a.focusQuest;this.markedQuests=a.markedQuests||[];if(this.markedQuests.length==0)this.focusQuest=-1;else for(var b=0;b<this.markedQuests.length;b++)if(!this.staticQuests[this.markedQuests[b]]){this.markedQuests.length=0;this.focusQuest=-1}this._solvedQueue=a.solvedQueue||[];this._solvedTimer=0;var d=null,
b=a.locale,g;for(g in b)if(this.staticQuests[g]){d=this.staticQuests[g];d.location.area=new ig.LangLabel(b[g].location.area||"???");d.location.map=new ig.LangLabel(b[g].location.map||"???");d.timeStamp=b[g].time;d.character=b[g].character?b[g].character:null}this.finishedQuests=a.finished||{};g=a.states||[];this._activeQuestIndex={};this.activeQuests.length=0;for(var h=null,i=false,j=[],b=0;b<g.length;++b){a=g[b];if(d=this.staticQuests[g[b].id]){if(d.tasks.length!=a.completed.length){i=true;h=new sc.QuestState(d);
j.push(d)}else{h=new sc.QuestState(d,true);h.setLoadData(a)}if(!h.finished){this._activeQuestIndex[d.id]=this.activeQuests.length;this.activeQuests.push(h)}}else i=true}if(!this.activeQuests[this.focusQuest])this.focusQuest=-1;for(d in this.finishedQuests)this.staticQuests[d]||delete this.finishedQuests[d];if(i){for(b=j.length;b--;)this.checkIfSubQuests(j[b]);ig.game.addTeleportMessage(ig.lang.get("sc.gui.loading.questUpdate"))}sc.stats.setMap("quests","solvedTotal",this.getTotalQuestsSolved(true));
sc.Model.notifyObserver(this,sc.QUEST_MODEL_EVENT.FAV_QUEST_CHANGED,-1E5)},checkIfSubQuests:function(b){if(b=b.tasks[0].subQuests)for(var d=b.length;d--;)if(this.isQuestSolved(b[d])){a.quest=b[d];a.value=true;this.updateActiveQuests("QUEST",a)}}});sc.QuestState=ig.Class.extend({quest:null,done:[],currentTask:0,highestTask:0,finished:false,labels:{},init:function(a,b){this.quest=a;!b&&this.initState()},finalizeTask:function(a){for(var a=a.subTasks,b=a.length;b--;){a[b].finalize&&a[b].finalize();sc.stats.addMap("quests",
"subtasks",1);sc.stats.addMap("quests","subtasks"+a[b].type,1)}},initState:function(a){var b=this.quest.tasks,d;for(d in this.labels)this.labels[d]=false;this.done.length=0;d=null;for(var g=true,h=false,i=0;i<b.length;i++){d=b[i].subTasks;this.done[i]=[];for(var g=true,j=d[k],k=0;k<d.length;k++){j=d[k];this.done[i][k]={};j.initState(this.done[i][k],this.labels);j.isFulfilled(this.done[i][k])||(g=false)}if(g){if(!h){this.currentTask++;this.highestTask=this.currentTask;if(this.currentTask>=2){sc.stats.addMap("quests",
"tasks",1);this.finalizeTask(b[this.currentTask-2])}}}else h=true}if(this.currentTask>this.done.length-1){this.highestTask=this.currentTask=this.done.length;this.finalizeTask(b[this.currentTask-1]);this.done.length>=2&&this.finalizeTask(b[this.currentTask-2]);this.finished=true;sc.stats.addMap("quests","tasks",1);!a&&sc.quests.sendNotification(sc.QUEST_MODEL_EVENT.FINISHED,this,true)}},updateState:function(a,b,d){if(!(this.currentTask>=this.done.length)){this.checkSubTask(a,b,this.currentTask)?this.increaseTaskIndex():
sc.quests.sendNotification(sc.QUEST_MODEL_EVENT.UPDATE,this);if(d&&this.currentTask>0)if(this.checkSubTask(a,b,this.currentTask-1))sc.quests.sendNotification(sc.QUEST_MODEL_EVENT.UPDATE,this);else{a=this.quest.tasks[this.currentTask];this.currentTask=this.currentTask-1;sc.stats.subMap("quests","tasks",1);for(b=a.length;b--;){sc.stats.subMap("quests","subtasks",1);sc.stats.subMap("quests","subtasks"+a[b].type,1)}sc.quests.sendNotification(sc.QUEST_MODEL_EVENT.TASK_UNDONE,this)}}},increaseTaskIndex:function(){if(this.currentTask>=
this.done.length-1){this.highestTask=this.currentTask=this.done.length;this.finalizeTask(this.quest.tasks[this.currentTask-1]);this.done.length>=2&&this.finalizeTask(this.quest.tasks[this.currentTask-2]);this.finished=true;sc.stats.addMap("quests","tasks",1);sc.quests.sendNotification(sc.QUEST_MODEL_EVENT.FINISHED,this)}else{var a=this.highestTask!=this.currentTask;this.currentTask++;this.highestTask=this.currentTask;this.currentTask>=2&&this.finalizeTask(this.quest.tasks[this.currentTask-2]);sc.stats.addMap("quests",
"tasks",1);a||sc.menu.addLog({type:"QUEST",task:this.currentTask-1,quest:this.quest.id});sc.quests.sendNotification(sc.QUEST_MODEL_EVENT.TASK_DONE,this);this.hasCollectSubtask(this.currentTask)&&(this.checkSubTask("COLLECT",null,this.currentTask,true)||this.checkSubTask("LANDMARK",null,this.currentTask,true))&&this.increaseTaskIndex()}ig.game.varsChangedDeferred()},resetTaskIndex:function(a){if(!(a>=this.currentTask)){for(var b=this.currentTask;b>a;){b--;for(var d=this.quest.tasks[b].subTasks,g=d.length;g--;){var h=
d[g];h.reset&&h.reset(this.getSubTaskData(g,b),this.labels);sc.stats.subMap("quests","subtasks",1);sc.stats.subMap("quests","subtasks"+h.type,1)}sc.stats.subMap("quests","tasks",1)}this.currentTask=b;sc.quests.sendNotification(sc.QUEST_MODEL_EVENT.TASK_UNDONE,this)}},hasCollectSubtask:function(a){return this.quest.tasks[a].containsCollect},skipPreviousTask:function(){return this.quest.tasks[Math.max(this.currentTask-1,0)].skipNotify},checkSubTask:function(a,b,d,g){for(var d=Math.max(0,d),h=this.quest.tasks[d].subTasks,
i=h.length,j=null,k=this.labels,l=null,o=true;i--;){j=h[i];l=this.getSubTaskData(i,d);j.type==a&&j.updateState(l,b,k,g);j.isFulfilled(l)||(o=false)}return o},isSubTaskSolved:function(a){var b=this.quest.tasks[this.currentTask].subTasks[a];return b?b.isFulfilled(this.done[this.currentTask][a]):false},getCurrentSubTaskValue:function(a,b){var d=this.quest.tasks[this.currentTask].subTasks[a];return d?d.getCurrentValue(this.done[this.currentTask][a],b):0},getCurrentTask:function(){return this.quest.tasks[this.currentTask]},
getSubTaskData:function(a,b){return this.done[b==void 0?this.currentTask:b][a]},isDone:function(){return this.currentTask>=this.done.length},getSaveData:function(){var a={};a.id=this.quest.id;a.task=this.currentTask;a.highest=this.highestTask;a.finished=this.finished;a.completed=ig.copy(this.done);a.labels=ig.copy(this.labels);return a},setLoadData:function(a){this.finished=a.finished||false;this.currentTask=a.task||0;this.highestTask=a.highest;this.done=a.completed;var a=a.labels,b;for(b in a)this.labels[b]=
a[b]}});sc.QUEST_MODEL_EVENT={};sc.QUEST_MODEL_EVENT.ADDED=0;sc.QUEST_MODEL_EVENT.UPDATE=1;sc.QUEST_MODEL_EVENT.TASK_DONE=2;sc.QUEST_MODEL_EVENT.TASK_UNDONE=3;sc.QUEST_MODEL_EVENT.SUBTASK_DONE=4;sc.QUEST_MODEL_EVENT.FINISHED=5;sc.QUEST_MODEL_EVENT.POST_FINISHED=6;sc.QUEST_MODEL_EVENT.FAV_QUEST_CHANGED=7;ig.addGameAddon(function(){return sc.quests=new sc.QuestModel})});ig.baked=!0;
ig.module("game.feature.quest.quest-steps").requires("impact.base.action","impact.base.entity","impact.base.event","game.feature.quest.quest-model","game.feature.menu.gui.quests.quest-misc").defines(function(){ig.EVENT_STEP.CREATE_QUEST=ig.EventStepBase.extend({settings:null,_wm:new ig.Config({attributes:{name:{_type:"LangLabel",_info:"Name of the quest",_compact:true},level:{_type:"Number",_info:"Level of the quest"},description:{_type:"LangLabel",_info:"Starting description text",_large:true,_compact:true,
_height:70},briefing:{_type:"LangLabel",_info:"Ending description text",_large:true,_compact:true,_height:70},rewards:{_type:"QuestRewards",_info:"The rewards the player gets for completing the quest.",_popup:true},tasks:{_type:"QuestTaskList",_info:"The tasks to complete"}},label:function(){return"<b style='color: limegreen'>CREATE QUEST</b> name: <i>"+new ig.LangLabel(this.name)+"</i>, description: <i>"+new ig.LangLabel(this.description)+"</i>, tasks: <i>"+(this.tasks?this.tasks.length:0)+"</i>"}}),
init:function(b){this.settings=b},start:function(){sc.quests.createQuest(this.settings)}});ig.EVENT_STEP.START_STATIC_QUEST=ig.EventStepBase.extend({quest:null,_wm:new ig.Config({attributes:{quest:{_type:"QuestNameSelect",_info:"The quest to start"}},label:function(){return"<b style='color: limegreen'> START STATIC QUEST </b> <i>"+this.quest+"</i>"}}),init:function(b){this.quest=b.quest||""},start:function(){sc.quests.activateStaticQuest(this.quest)}});ig.EVENT_STEP.SOLVE_QUEST_CONDITION=ig.EventStepBase.extend({questId:null,
label:null,_wm:new ig.Config({attributes:{quest:{_type:"QuestLabelSelect",_info:"The label to set to active"}},label:function(){return"<b style='color: limegreen'> SOLVE QUEST CONDITION </b> <i>"+wmPrint("QuestLabelSelect",this.quest)+"</i>"}}),init:function(b){this.questId=b.quest.quest;this.label=b.quest.label||null},start:function(){sc.quests.solveQuestCondition(this.questId,this.label)}});ig.EVENT_STEP.UPDATE_QUEST_LOCATION=ig.EventStepBase.extend({questId:null,_wm:new ig.Config({attributes:{quest:{_type:"Quest",
_info:"the quest to update. ONLY WORKS IF QUEST IS ACTIVE!"}},label:function(){return"<b style='color: limegreen'> UPDATE QUEST LOCATION </b> <i>"+this.quest+"</i>"}}),init:function(b){this.questId=b.quest},start:function(){console.log(this.questId);sc.quests.updateQuestLocation(this.questId)}});ig.EVENT_STEP.RESET_QUEST_TASK=ig.EventStepBase.extend({quest:null,index:-1,_wm:new ig.Config({attributes:{quest:{_type:"Quest",_info:"The quest on which the index should be reset",_context:"Quest"},task:{_type:"TaskIndex",
_info:"The quest task to reset to"}}}),init:function(b){this.quest=b.quest||null;this.index=b.task==void 0?-1:b.task},start:function(){this.index==void 0||this.index<0||sc.quests.resetQuestTask(this.quest,this.index)}});ig.EVENT_STEP.OPEN_QUEST_DIALOG=ig.EventStepBase.extend({quest:null,acceptVar:null,npc:null,_wm:new ig.Config({attributes:{quest:{_type:"Quest",_info:"The quest to open",_ignoreSubs:true},npc:{_type:"Character",_info:"Character to use as quest giver, override default and can be used in event triggers.",
_optional:true},map:{_type:"Maps",_info:"Map to show instead of the automated one",_optional:true}},branchLabel:function(b){switch(b){case "accepted":return"on accept";case "declined":return"on decline";case "_end":return"end quest dialog"}return"???"}}),_characterName:null,_mapName:null,init:function(b){this.quest=sc.quests.staticQuests[b.quest];this.npc=b.npc||null;this.map=b.map||null},getBranchNames:function(){return["accepted","declined"]},start:function(b,a){this._characterName=this.npc||a.data.character||
null;if(this.map)this._mapName=this.map||a.data.mapName||null;b.done=false;b._stashedPersons=sc.model.message.hasPerson();b._timer=b._stashedPersons?0.2:0;b._stashedPersons&&sc.model.message.stashPersons()},run:function(b){if(b._timer>=0){b._timer=b._timer-ig.system.actualTick;if(b._timer<0){sc.model.stopSkip();sc.model.skipBlock=true;var a=new sc.QuestDialogWrapper(this.quest,function(a){b.accepted=a;b.done=true}.bind(this),false,this._characterName,this._mapName);ig.gui.addGuiElement(a)}}if(b.done){sc.model.skipBlock=
false;b._stashedPersons&&sc.model.message.showStashedPersons()}return b.done},getNext:function(b){return b.accepted?this.branches.accepted||this._nextStep:this.branches.declined||this._nextStep}});ig.EVENT_STEP.FINISH_STATIC_QUEST=ig.EventStepBase.extend({quest:null,_wm:new ig.Config({attributes:{quest:{_type:"QuestNameSelect",_info:"The label to set to solve"}},label:function(){return"<b style='color: limegreen'> OPEN QUEST DIALOG </b> <i>"+this.quest+"</i> "}}),init:function(b){this.quest=sc.quests.staticQuests[b.quest]},
start:function(){sc.quests.setQuestFinished(this.quest)}});ig.EVENT_STEP.RESOLVE_FINISHED_QUESTS=ig.EventStepBase.extend({_wm:new ig.Config({attributes:{}}),init:function(){},start:function(b){b.timer=0;sc.model.stopSkip();sc.model.skipBlock=true},run:function(b){if(!b.timer||ig.vars.get("tmp._questRewardsFinished")){if(b.timer){b.timer=b.timer-ig.system.tick;if(b.timer<=0)b.timer=0;return false}if(!sc.quests.popInlineSolvedQuest()){sc.model.skipBlock=false;return true}b.timer=0.1}return false}})});
ig.baked=!0;ig.module("game.feature.quest.plug-in").requires("game.feature.quest.quest-types","game.feature.quest.quest-steps","game.feature.quest.quest-model").defines(function(){if(window.wm){wm.postLoadModules.push("game.feature.quest.editors.quest-editors");wm.postLoadModules.push("game.feature.quest.editors.quest-hub-editors");wm.addStepColorRule(/QUEST/,"limegreen")}});ig.baked=!0;
ig.module("game.feature.party.party-steps").requires("impact.base.action","impact.base.event","game.feature.party.party").defines(function(){ig.EVENT_STEP.SET_CONTACT_ONLINE=ig.EventStepBase.extend({member:null,online:null,_wm:new ig.Config({attributes:{member:{_type:"String",_info:"Party member to add",_select:sc.PARTY_OPTIONS},online:{_type:"Boolean",_info:"True if online."}}}),init:function(a){this.member=a.member;this.online=a.online},start:function(){sc.party.setOnlineStatus(this.member,this.online)}});
ig.EVENT_STEP.SET_MEMBER_LOCKED=ig.EventStepBase.extend({member:null,locked:null,_wm:new ig.Config({attributes:{member:{_type:"String",_info:"Party member to change",_select:sc.PARTY_OPTIONS},locked:{_type:"Boolean",_info:"True if locked."}}}),init:function(a){this.member=a.member;this.locked=a.locked},start:function(){sc.party.setLocked(this.member,this.locked)}});ig.EVENT_STEP.SET_CONTACT_TYPE=ig.EventStepBase.extend({member:null,status:null,_wm:new ig.Config({attributes:{member:{_type:"String",
_info:"Party member to add",_select:sc.PARTY_OPTIONS},status:{_type:"String",_info:"Status to set",_select:sc.PARTY_MEMBER_TYPE}}}),init:function(a){this.member=a.member;this.status=sc.PARTY_MEMBER_TYPE[a.status]||0},start:function(){sc.party.setContactType(this.member,this.status)}});ig.EVENT_STEP.SET_CONTACT_TYPE_ALL=ig.EventStepBase.extend({status:null,_wm:new ig.Config({attributes:{status:{_type:"String",_info:"Status to set",_select:sc.PARTY_MEMBER_TYPE}}}),init:function(a){this.status=sc.PARTY_MEMBER_TYPE[a.status]||
0},start:function(){for(var a in sc.party.contacts)sc.party.setContactType(a,this.status)}});ig.EVENT_STEP.ADD_PARTY_MEMBER=ig.EventStepBase.extend({member:null,npc:null,_wm:new ig.Config({attributes:{member:{_type:"String",_info:"Party member to add",_select:sc.PARTY_OPTIONS},npc:{_type:"NPC",_info:"NPC that will turn into the party member",_optional:true},skipEffect:{_type:"Boolean",_info:"If true: skip NPC show effect"},temporary:{_type:"Boolean",_info:"If true: add Party member temporary"}}}),
init:function(a){this.member=a.member;this.npc=a.npc;this.skipEffect=a.skipEffect||false;this.temporary=a.temporary||false},start:function(a,b){var e=ig.Event.getEntity(this.npc,b);sc.party.addPartyMember(this.member,e,false,this.skipEffect,this.temporary)}});ig.EVENT_STEP.SET_PARTY_MEMBER_LEVEL=ig.EventStepBase.extend({member:null,level:null,exp:null,updateEquipment:false,_wm:new ig.Config({attributes:{member:{_type:"String",_info:"Party member to add",_select:sc.PARTY_OPTIONS},level:{_type:"Integer",
_info:"Level to set"},exp:{_type:"Integer",_info:"Exp to set"},updateEquipment:{_type:"Boolean",_info:"If true, also update equipment of party member"}}}),init:function(a){this.member=a.member;this.level=a.level||1;this.exp=a.exp||0;this.updateEquipment=a.updateEquipment||false},start:function(){sc.party.getPartyMemberModel(this.member).setLevel(this.level,this.exp,this.updateEquipment,true)}});ig.EVENT_STEP.SET_PARTY_MEMBER_NO_DIE=ig.EventStepBase.extend({noDie:false,_wm:new ig.Config({attributes:{member:{_type:"String",
_info:"Party member to modify",_select:sc.PARTY_OPTIONS},noDie:{_type:"Boolean",_info:"If true: party member won't die, even if you kill him"}}}),init:function(a){this.member=a.member;this.noDie=a.noDie||false},start:function(){sc.party.getPartyMemberModel(this.member).setNoDie(this.noDie)}});ig.EVENT_STEP.SET_PARTY_MEMBER_SP_LEVEL=ig.EventStepBase.extend({_wm:new ig.Config({attributes:{member:{_type:"String",_info:"Party member to add",_select:sc.PARTY_OPTIONS},level:{_type:"String",_info:"Type of Core.",
_select:{"0":"0 SP",1:"4 SP",2:"8 SP",3:"12 SP",4:"16 SP"}}}}),init:function(a){this.member=a.member;this.level=a.level},start:function(){sc.party.getPartyMemberModel(this.member).setSpLevel(this.level)}});ig.EVENT_STEP.SET_PARTY_MEMBER_ALL_ELEMENTS=ig.EventStepBase.extend({_wm:new ig.Config({attributes:{member:{_type:"String",_info:"Party member to add",_select:sc.PARTY_OPTIONS},allElements:{_type:"Boolean",_info:"If true: has all elements. If false: has all elements player has"}}}),init:function(a){this.member=
a.member;this.allElements=a.allElements},start:function(){sc.party.getPartyMemberModel(this.member).setAllElements(this.allElements)}});ig.EVENT_STEP.REMOVE_PARTY_MEMBER=ig.EventStepBase.extend({member:null,npc:null,_wm:new ig.Config({attributes:{member:{_type:"String",_info:"Party member to add",_select:sc.PARTY_OPTIONS},npc:{_type:"NPC",_info:"NPC that will turn into the party member",_optional:true},skipEffect:{_type:"Boolean",_info:"If true: skip NPC show effect"}}}),init:function(a){this.member=
a.member;this.npc=a.npc;this.skipEffect=a.skipEffect||false},start:function(a,b){var e=ig.Event.getEntity(this.npc,b);sc.party.removePartyMember(this.member,e,this.skipEffect)}});ig.EVENT_STEP.REVIVE_PARTY_MEMBER=ig.EventStepBase.extend({member:null,_wm:new ig.Config({attributes:{member:{_type:"String",_info:"Party member to revive",_select:sc.PARTY_OPTIONS}}}),init:function(a){this.member=a.member},start:function(){sc.party.getPartyMemberModel(this.member).isAlive()||sc.party.revivePartyMemberEntity(this.member)}});
ig.EVENT_STEP.REVIVE_ALL_PARTY_MEMBERS=ig.EventStepBase.extend({_wm:new ig.Config({attributes:{}}),start:function(){sc.party.reviveAllPartyMemberModels()}});ig.EVENT_STEP.SET_PARTY_AI=ig.EventStepBase.extend({_wm:new ig.Config({attributes:{battle:{_type:"Number",_info:"Battle AI Factor: 0=default, 1=always the best possible decision.",_optional:true},aggressive:{_type:"Number",_info:"Aggressiveness Factor: 0=default, 1=attacks as often as possible",_optional:true},targeting:{_type:"Number",_info:"Influence enemy targeting behavior: 0=default, 1=enemies will always target party members, -1=enemies will always target player",
_optional:true}}}),init:function(a){if(a.battle!==void 0)this.battle=a.battle;if(a.aggressive!==void 0)this.aggressive=a.aggressive;if(a.targeting!==void 0)this.targeting=a.targeting},start:function(){if(this.battle!==void 0)sc.party.ai.battle=this.battle;if(this.battle!==void 0)sc.party.ai.aggressive=this.aggressive;if(this.targeting!==void 0)sc.party.ai.targeting=this.targeting}});ig.EVENT_STEP.PARTY_KEEP_MAP_DUNGEON=ig.EventStepBase.extend({_wm:new ig.Config({attributes:{}}),init:function(){},
start:function(){sc.party.keepMapDungeon()}});var b={RANDOM:function(a){return a[Math.floor(a.length*Math.random())]},LOWEST_HP:function(a){for(var b=a.length,e=null,f=0;b--;){var g=a[b];if(!e||f>g.params.getHpFactor()){f=g.params.getHpFactor();e=g}}return e},FIRST:function(a){return a[0]},SECOND:function(a){return a[1]},HAS_NO_PROXY:function(a,b){for(var e=a.length;e--;){var f=a[e];if(!sc.CombatProxyTools.hasProxy(f,b))return f}return null}},a=[];ig.ACTION_STEP.SET_PARTY_TEMP_TARGET=ig.ActionStepBase.extend({_wm:new ig.Config({attributes:{kind:{_type:"String",
_info:"Kind of temp target",_select:b},includeSelf:{_type:"Boolean",_info:"If true: also include self as possible target"},enemyFilter:{_type:"Array",_info:"Only for enemy: filter for enemy type",_optional:true,_sub:{_type:"EnemySearch"}},selectKey:{_type:"StringExpression",_info:"Search Key used for some selection criteria of 'kind'"}}}),init:function(a){this.kind=b[a.kind]||b.PLAYER;this.includeSelf=a.includeSelf||false;this.enemyFilter=a.enemyFilter||null;this.selectKey=a.selectKey||null},start:function(b){var c=
b.getCombatantRoot();a.length=0;if(c.party==sc.COMBATANT_PARTY.PLAYER){var e=this.includeSelf;(e||!c.isPlayer)&&!ig.game.playerEntity.isDefeated()&&a.push(ig.game.playerEntity);var f=sc.party.getPartyMemberEntityByIndex(0);f&&((e||f!=c)&&!f.isDefeated())&&a.push(f);(f=sc.party.getPartyMemberEntityByIndex(1))&&((e||f!=c)&&!f.isDefeated())&&a.push(f)}else{e=this.enemyFilter;this.includeSelf&&a.push(c);for(var f=sc.combat.getActiveCombatants(sc.COMBATANT_PARTY.ENEMY),g=f.length;g--;){var h=f[g];h!=c&&
!(e&&e.indexOf(h.enemyName)==-1)&&a.push(h)}}if(a.length){c=this.kind(a,this.selectKey);b.tmpTarget=c}else b.tmpTarget=null}});ig.ACTION_STEP.SET_TARGET_TO_PARTYMEMBER=ig.ActionStepBase.extend({_wm:new ig.Config({attributes:{member:{_type:"String",_info:"Party member to add",_select:sc.PARTY_OPTIONS}}}),init:function(a){this.member=a.member},start:function(a){if(sc.party.getPartyMemberModel(this.member).isAlive()){var b=sc.party.getPartyMemberEntity(this.member);b&&a.setTarget(b)}}});ig.ACTION_STEP.CONSUME_PARTY_SANDWICH=
ig.ActionStepBase.extend({init:function(a){this.sandwich=a.sandwich},start:function(a){a.consumeSandwich&&a.consumeSandwich(this.sandwich)}})});ig.baked=!0;
ig.module("game.feature.party.party-member-model").requires("game.feature.model.base-model","game.feature.combat.model.combat-params","game.feature.combat.entities.ball","game.feature.player.player-config","game.feature.achievements.stats-model").defines(function(){sc.PARTY_MEMBER_MSG={ELEMENT_MODE_CHANGE:1,EXP_CHANGE:3,LEVEL_CHANGE:4,STATS_CHANGED:5};var b=[{heal:0.25},{heal:0.5},{heal:0.7}],a=[{level:1,count:[1,0,0]},{level:10,count:[2,0,0]},{level:20,count:[3,1,0]},{level:30,count:[4,2,0]},{level:40,
count:[5,3,1]},{level:50,count:[6,4,1]},{level:60,count:[7,5,2]}];sc.PartyMemberModel=ig.Class.extend({observers:[],core:{},config:null,animSheet:null,stats:null,params:null,name:null,clazz:null,character:null,equipLevel:0,level:1,exp:0,combatStyle:null,spLevel:0,allElements:false,equip:{head:-1,leftArm:-1,rightArm:-1,torso:-1,feet:-1},baseParams:{elemFactor:[1,1,1,1]},equipParams:null,equipModifiers:null,baseConfig:null,elementConfigs:{},reviveTimer:0,skills:[],healing:{sandwich:[0,0,0],cooldown:0,
needRestock:true},temporary:false,noDie:false,currentElementMode:0,init:function(a){this.params=new sc.CombatParams;this.config=new sc.PlayerConfig(a);this.config.addLoadListener(this)},onLoadableComplete:function(){var a=this.config;this.name=a.name;this.clazz=a.clazz;this.combatStyle=a.combatStyle;this.walkAnims=a.walkAnims;this.character=a.character;this.defaultExpression=new sc.CharacterExpression(a.character.name,"DEFAULT");this.animSheet=a.animSheet;this.proxies=a.proxies;this.stats=a.stats;
this.baseConfig=a.baseConfig;this.elementConfigs=a.elementConfigs;this.skillRanking=a.skillRanking;this.updateStats()},getHeadIdx:function(){return this.config.headIdx},setEquipment:function(a,b){sc.PlayerLevelTools.equip(this.equip,a,b)},clearEquipment:function(){for(var a in this.equip)this.equip[a]=-1},updateAutoEquip:function(a){if(this._updateAutoEquip(this.level,a)){this.updateStats();return true}return false},_updateAutoEquip:function(a,b){var e=sc.PlayerLevelTools.autoequip(this,this.config.autoequip,
this.equipLevel,a,false,b);if(e>this.equipLevel){this.equipLevel=e;return true}return false},setElementMode:function(a){this.currentElementMode=a;this.params.setBaseParams(this.elementConfigs[this.currentElementMode].baseParams);this.params.setModifiers(this.elementConfigs[this.currentElementMode].modifiers);sc.Model.notifyObserver(this,sc.PARTY_MEMBER_MSG.STATS_CHANGED)},updateStats:function(){sc.PlayerLevelTools.computeBaseParams(this.baseParams,this.stats,this.level);this.equipParams=ig.copy(this.baseParams);
this.equipModifiers={};sc.PlayerLevelTools.updateEquipStats(this.equip,this.equipParams,this.equipModifiers);for(var a in sc.ELEMENT)this.elementConfigs[sc.ELEMENT[a]].preSkillInit();this.skills.length=0;sc.skilltree.autoSkill(this.skills,this.level,this.skillRanking);for(var b=this.skills.length;b--;)this.skills[b].applyOnConfigs(this.elementConfigs);this.baseConfig.update(this.equipParams,this.equipModifiers);for(a in sc.ELEMENT)this.elementConfigs[sc.ELEMENT[a]].update(this.equipParams,this.equipModifiers);
this.params.setBaseParams(this.elementConfigs[this.currentElementMode].baseParams);this.params.setModifiers(this.elementConfigs[this.currentElementMode].modifiers);sc.Model.notifyObserver(this,sc.PARTY_MEMBER_MSG.STATS_CHANGED)},isAlive:function(){return this.reviveTimer==0},onDefeat:function(){this.reviveTimer=sc.arena.active?0:30},revive:function(){this.params.revive();this.reviveTimer=0;this.restockSandwich()},setTemporary:function(a){this.temporary=a},setNoDie:function(a){this.noDie=a},update:function(){if(this.healing.cooldown){this.healing.cooldown=
this.healing.cooldown-ig.system.tick;if(this.healing.cooldown<=0||!sc.model.isCombatMode())this.healing.cooldown=0}this.healing.needRestock&&!sc.model.isCombatMode()&&this.restockSandwich();if(this.reviveTimer){this.reviveTimer=this.reviveTimer-ig.system.tick;if(this.reviveTimer<=0||!sc.model.isCombatMode()){sc.arena.active||sc.commonEvents.triggerEvent("PARTY_MEMBER_EVENT",{member:[this.name],eventType:"REVIVED"});sc.party.revivePartyMemberEntity(this.name)}}},getCharacterName:function(){return this.character?
this.character.data&&this.character.data.name?ig.LangLabel.getText(this.character.data.name):null:null},getCharacterRealName:function(){return this.character?this.character.data&&this.character.data.realname?ig.LangLabel.getText(this.character.data.realname):null:null},getAction:function(a){return this.elementConfigs[this.currentElementMode].getAction(a)||this.baseConfig.getAction(a)},getActionMaxLevel:function(a){return this.elementConfigs[this.currentElementMode].getActionMaxLevel(a)},getCombatArtName:function(a){return this.elementConfigs[this.currentElementMode].getActiveCombatArtName(a)},
getBalls:function(){return this.config.proxies},getSaveData:function(){return{level:this.level,equipLevel:this.equipLevel,exp:this.exp,spLevel:this.spLevel,allElements:this.allElements,temporary:this.temporary,noDie:this.noDie}},setLoadData:function(a){a=a||{};this.level=a.level||1;this.exp=a.exp||0;this.equipLevel=0;this.temporary=a.temporary||false;this.noDie=a.noDie||false;this.allElements=a.allElements||false;this.setSpLevel(a.spLevel||1);this.clearEquipment();this._updateAutoEquip(a.equipLevel||
1);this.updateStats();this.restockSandwich()},reset:function(){this.level=1;this.equipLevel=this.exp=0;this.noDie=this.temporary=this.allElements=false;this.revive();this.setSpLevel(2);this.clearEquipment();this.config.loaded&&this.updateStats()},setSpLevel:function(a){if(!(a<0||a>=sc.SP_LEVEL.length)){this.spLevel=a;this.params.setMaxSp(sc.SP_LEVEL[a])}},setAllElements:function(a){this.allElements=a},addExperience:function(a,b,e,f,g){a=sc.PlayerLevelTools.computeExp(a,this.level,b,void 0,void 0,
g);if(!(this.level>=sc.EXP_MAX_LEVEL)){this.exp=this.exp+a;if(this.exp>=sc.EXP_PER_LEVEL){this.level=this.level+Math.floor(this.exp/sc.EXP_PER_LEVEL);this.exp=this.level>=sc.EXP_MAX_LEVEL?0:this.exp%sc.EXP_PER_LEVEL;this.updateStats();sc.Model.notifyObserver(this,sc.PARTY_MEMBER_MSG.LEVEL_CHANGE)}sc.Model.notifyObserver(this,sc.PARTY_MEMBER_MSG.EXP_CHANGE)}},setLevel:function(a,b,e,f,g){if(!f||this.level<a||this.level==a&&this.exp<b){this.exp=b;this.level=a}this.updateStats();e&&this.updateAutoEquip(g);
sc.Model.notifyObserver(this,sc.PARTY_MEMBER_MSG.LEVEL_CHANGE);sc.Model.notifyObserver(this,sc.PARTY_MEMBER_MSG.EXP_CHANGE)},hasSandwich:function(){for(var a=this.healing.sandwich,b=a.length;b--;)if(a[b])return true;return false},canEatSandwich:function(){return sc.arena.active&&sc.arena.hasChallenge("NO_ITEMS")?false:this.hasSandwich()&&!this.healing.cooldown},restockSandwich:function(){this.healing.needRestock=false;for(var b=this.level,c=a.length;c--;){var e=a[c];if(b>=e.level){for(b=this.healing.sandwich.length;b--;)this.healing.sandwich[b]=
e.count[b];break}}},getBestSandwich:function(a){var c=a,e=c?-1:1;do{if(this.healing.sandwich[c])return c;c=c+e;c<0&&(c=b.length-1);c>b.length-1&&(c=0)}while(c!=a);return false},consumeSandwich:function(a,c){c.heal({value:b[a].heal});this.healing.sandwich[a]--;this.healing.cooldown=10;this.healing.needRestock=true},getSandwichAction:function(a){var b="SANDWICH";this.combatStyle.foodSprites&&(b=this.combatStyle.foodSprites[a]);return new ig.Action("consumeItem",[{type:"SET_FACE",face:"SOUTH"},{type:"WAIT",
time:0.3},{type:"SHOW_FOOD_ICON",icon:b,offset:this.combatStyle.foodOffset},{type:"SHOW_ANIMATION",anim:"itemFetch",wait:true},{type:"SHOW_ANIMATION",anim:"itemHold"},{type:"WAIT",time:0.2},{type:"CHANGE_FOOD_ICON",state:"BUBBLE",offset:this.combatStyle.foodBubbleOffset},{type:"PLAY_SOUND",sound:"media/sound/move/eat.ogg",volume:1},{type:"SHOW_ANIMATION",anim:"itemEatFast"},{type:"WAIT",time:0.8},{type:"CHANGE_FOOD_ICON",state:"DONE"},{type:"CONSUME_PARTY_SANDWICH",sandwich:a},{type:"SHOW_ANIMATION",
anim:"itemEffect"},{type:"WAIT",time:0.6}])}})});ig.baked=!0;
ig.module("game.feature.party.entities.party-member-entity").requires("game.feature.player.entities.player-base").defines(function(){function b(a){if(a>0){a=a-ig.system.tick;a<=0&&(a=0)}return a}var a={ATTACK:{actionKey:"ATTACK_SPECIAL",idx:0},THROW:{actionKey:"THROW_SPECIAL",idx:1,distant:true},GUARD:{actionKey:"GUARD_SPECIAL",idx:2},DASH:{actionKey:"DASH_SPECIAL",idx:3,distant:true}},d=["ATTACK","THROW","GUARD","DASH"],c=[],e=[0.2,0.25,0.3],f={IDLE:{start:function(a,b,c,d){a.updateDefaultConfig(false);
d.faceRotateTimer=Math.random()*0.2},update:function(a,b,c,d){Vec2.assignC(a.coll.accelDir,0,0);if(sc.model.isCombatActive()&&sc.party.getStrategy("BEHAVIOUR").doNothing||sc.party.keepDistance){c.outOfScreenTime=0;d=sc.party.keepDistance?200:320;return c.distance<(sc.party.keepDistance?64:120)||c.distance>d?f.STAY_AWAY:f.ROTATE}a.updateDefaultConfig(false);if(c.distance>48)return f.FOLLOW;if(c.distance<4)return f.BACKOFF;if(!a.noFaceRotate){c=c.distVec;if(b.isPlayer&&Vec2.angle(c,b.face)<1*Math.PI)c=
b.face;a=Vec2.angle(c,a.face);d.faceRotateTimer=a>Math.PI*0.05?d.faceRotateTimer+ig.system.tick:Math.random()*0.2;if(a>Math.PI*0.5||d.faceRotateTimer>0.25)return f.ROTATE}}},STAY_AWAY:{start:function(a){a.noFaceRotate=false;a.updateDefaultConfig(false);a.setNavTarget(12);a.timer.move=4},update:function(a,b,c){a.coll.relativeVel=1;c.outOfScreenTime=0;if(a.nav.path.moveEntity()||a.timer.move<=0)return f.IDLE;a.jumping||c.outOfScreenTime>3&&a.resetPos()}},BACKOFF:{start:function(a){a.updateDefaultConfig(false);
a.noFaceRotate=false;a.coll.relativeVel=0.5;a.setNavTarget(2)},update:function(a,b,c){a.faceDirFixed=true;Vec2.assign(a.face,c.distVec);if(c.distance>=16){Vec2.assignC(a.coll.accelDir,0,0);return f.IDLE}if(a.nav.path.moveEntity())return f.IDLE}},ROTATE:{start:function(a){a.updateDefaultConfig(false)},update:function(a,b,c){var d=c.distVec;if(b.isPlayer&&Vec2.angle(d,b.face)<1*Math.PI)d=b.face;Vec2.rotateToward(a.face,d,Math.PI*2*ig.system.tick*2);Vec2.assignC(a.coll.accelDir,0,0);if(!(sc.model.isCombatActive()&&
sc.party.getStrategy("BEHAVIOUR").doNothing||sc.party.keepDistance)&&c.distance>48)return f.FOLLOW;if(Vec2.angle(d,a.face)<Math.PI*0.05)return f.IDLE}},FOLLOW:{start:function(a){a.noFaceRotate=false;a.updateDefaultConfig(false);a.setNavTarget(1)},update:function(a,b,c){if(sc.model.isCombatActive()&&sc.party.getStrategy("BEHAVIOUR").doNothing||sc.party.keepDistance)return f.STAY_AWAY;b=80+sc.party.getPartyMemberIndex(a.model.name)*40;b=c.distance>b?1:Math.max(0.25,c.distance/b);a.jumping&&(b=1);a.coll.relativeVel=
b;a.nav.path.startRelativeVel=b;if(a.nav.path.moveEntity())return f.IDLE;a.jumping||c.outOfScreenTime>3&&a.resetPos()}},COMBAT_IDLE:{start:function(a){a.reselectTarget();a.faceToTarget.active=true},update:function(a,b,c){Vec2.assignC(a.coll.accelDir,0,0);if(a.target&&!sc.model.isCutscene()){var d=a.params.getHpFactor(),e=0.5;sc.EnemyAnno.isWeak(b,a)&&(e=0.33);if(d<=e&&a.model.canEatSandwich())return f.COMBAT_HEALING;d=sc.party.getStrategy("TARGET").others&&a.target==ig.game.playerEntity.combatStats.lastTarget;
if((b=ig.navigation.isTargetReachable(a,b,a.model.combatStyle.normDistance+40,true))&&!d&&!sc.party.getStrategy("BEHAVIOUR").noAttack&&!a.timer.attack){if(sc.EnemyAnno.shouldBePassive(a.target,a)){a.timer.attack=0.2;return f.COMBAT_SIDEWAYS}a.timer.noAttackTime=0;a.updateElement();if(a.params.getSp()){c=sc.EnemyAnno.isWeak(a.target,a)?1:a.params.getRelativeSp();c=c*sc.party.getStrategy("ARTS").factor;Math.random()<c&&a.selectCombatArt()}c=a.model.combatStyle.throwProb;a.currentCombatArt?c=a.currentCombatArt.distant?
1:0:sc.EnemyAnno.useMelee(a.target)?c=0:sc.EnemyAnno.useRanged(a.target)&&(c=1);return Math.random()<c?f.COMBAT_THROWING:f.MELEE}if(!b||c.distance<a.model.combatStyle.minDistance||c.distance>a.model.combatStyle.normDistance+40)return f.COMBAT_ADJUST;if(a.timer.move<=0&&a.timer.attack>0.5){a.timer.move=0.5+Math.random()*0.5;return f.COMBAT_SIDEWAYS}}}},COMBAT_SIDEWAYS:{start:function(a,b,c,d){a.updateDefaultConfig(true);a.faceToTarget.active=true;if(sc.EnemyAnno.hasLookAway(b,a))a.faceToTarget.offset=
0.5;a.coll.relativeVel=a.model.combatStyle.sidewaySpeed||1;a.setNavTarget(5);a.timer.move=1;d.attackCount=0},update:function(a){if(a.nav.path.moveEntity()||a.timer.move<=0)return f.COMBAT_IDLE}},COMBAT_HEALING:{start:function(a,b,c,d){a.updateDefaultConfig(false);a.faceToTarget.active=false;a.coll.relativeVel=1;a.setNavTarget(11);a.timer.move=1;d.healingStart=false},update:function(a,b,c,d){if(d.healingStart){if(!a.currentAction)return f.COMBAT_IDLE}else(a.nav.path.moveEntity()||a.timer.move<=0)&&
this.startHealing(a,c,d)},startHealing:function(a,b,c){var b=0,d=a.params.getHpFactor();d<0.25?b=2:d<0.33&&(b=1);c.healingStart=true;c=a.model.getBestSandwich(b);if(c!==false){c=a.model.getSandwichAction(c);a.setAction(c)}}},COMBAT_THROWING:{start:function(a,b,c,d){a.updateDefaultConfig(false);a.faceToTarget.active=false;a.coll.relativeVel=1;if(sc.EnemyAnno.hasAttackBack(a.target,a)){a.setNavTarget(9);a.timer.move=2}else if(sc.EnemyAnno.hasAttackFront(a.target,a)){a.setNavTarget(10);a.timer.move=
2}else{a.updateDefaultConfig(true);a.faceToTarget.active=true;a.coll.relativeVel=0.7;a.setNavTarget(6);a.timer.move=1}d.attackCount=0},update:function(a,b,c,d){if(d.attackCount==0){if(a.nav.path.moveEntity()||a.timer.move<=0){a.faceToTarget.active=true;a.updateDefaultConfig(true);this.startThrow(a,c,d)}}else if(d.attackCount<a.model.combatStyle.throwCount&&!a.timer.action)this.startThrow(a,c,d);else if(d.attackCount==a.model.combatStyle.throwCount&&!a.timer.action)if(a.currentCombatArt)a.startCombatArtCharging();
else{a.resetAttackTimer();return f.COMBAT_IDLE}},startThrow:function(a,b,c){a.cancelAction();c.attackCount++;var d=a.model.getAction(sc.PLAYER_ACTION.THROW_NORMAL_REV),c=c.attackCount==1?"THROW_CHARGED":!d||c.attackCount%2==1?"THROW_NORMAL":"THROW_NORMAL_REV";Vec2.assign(a.face,b.distVec);Vec2.assign(a.throwDirData,b.distVec);a.setAttribute("dashDir",a.face);a.doPlayerAction(c)}},COMBAT_ADJUST:{start:function(a,b,c,d){a.nav.path.interrupt();a.coll.relativeVel=1;a.setNavTarget(3);a.timer.move=1;d.doInit=
true;if(a.nav.path.getDistance()>0)a.faceToTarget.active=false},update:function(a,b,c,d){if(a.nav.path.moveEntity()||a.timer.move<=0)if(c.distance>a.model.combatStyle.normDistance+40)a.setNavTarget(3);else return f.COMBAT_IDLE;else if(d.doInit){d.doInit=false;a.updateDefaultConfig(false)}}},PERMA_PUNCH:{start:function(a,b,c,d){d.attackCount=0},update:function(a,b,c,d){a.timer.action||this.startAttack(a,c,d)},startAttack:function(a,b,c){a.cancelAction();c.attackCount++;c=c.attackCount%2==1?"ATTACK":
"ATTACK_REV";a.coll.setType(ig.COLLTYPE.VIRTUAL);Vec2.assign(a.face,b.distVec);a.setAttribute("dashDir",Vec2.create());a.doPlayerAction(c)}},MELEE:{start:function(a,b,c,d){a.nav.path.interrupt();a.updateDefaultConfig(false);a.coll.relativeVel=1;d.directionMove=false;if(sc.EnemyAnno.hasAttackBack(a.target,a)){d.directionMove=true;a.setNavTarget(7)}else if(sc.EnemyAnno.hasAttackFront(a.target,a)){d.directionMove=true;a.setNavTarget(8)}else a.setNavTarget(4);a.timer.move=3;d.attackCount=0},update:function(a,
b,c,d){if(d.directionMove){if((b=a.nav.path.moveEntity())||a.timer.move<=0){a.setNavTarget(4);d.directionMove=false}}else if(d.attackCount==0)(b=a.nav.path.moveEntity())||c.distance<16?this.startAttack(a,c,d):c.distance<32&&a.coll.setType(ig.COLLTYPE.VIRTUAL);else if(d.attackCount<a.model.combatStyle.comboCount&&!a.timer.action){if(c.distance>a.model.combatStyle.meleeDistance*2){a.resetAttackTimer();return f.COMBAT_IDLE}this.startAttack(a,c,d)}else if(d.attackCount==a.model.combatStyle.comboCount&&
!a.timer.action){a.resetAttackTimer();return f.COMBAT_IDLE}},startAttack:function(a,b,c){a.cancelAction();c.attackCount++;a.coll.setType(ig.COLLTYPE.VIRTUAL);Vec2.assign(a.face,b.distVec);a.setAttribute("dashDir",a.face);c.attackCount==a.model.combatStyle.comboCount&&a.currentCombatArt?a.startCombatArtCharging():a.doPlayerAction(c.attackCount==a.model.combatStyle.comboCount?"ATTACK_FINISHER":c.attackCount%2==1?"ATTACK":"ATTACK_REV")}},DODGE:{start:function(a,b){a.nav.path.interrupt();a.updateDefaultConfig(false);
var c=ig.NAV_DODGE_TYPE.NEUTRAL;sc.EnemyAnno.keepFarDistance(b)&&(c=ig.NAV_DODGE_TYPE.GET_AWAY);ig.navigation.getDodgePosition(g,a,a.threat,48,c);c=a.getAlignedPos(ig.ENTITY_ALIGN.BOTTOM);Vec3.sub(c,g);Vec3.flip(c);a.timer.dodge=0.25;a.faceToTarget.active=true;a.setAttribute("dashDir",c);a.doPlayerAction("DASH")},update:function(a){if(!a.currentAction)return a.inCombat?f.COMBAT_IDLE:f.IDLE}}};Vec2.create();var g=Vec3.create(),h=["normal","battle","aiming","interogate"];sc.PartyMemberEntity=sc.PlayerBaseEntity.extend({party:sc.COMBATANT_PARTY.PLAYER,
material:sc.COMBATANT_MATERIAL.ORGANIC,configs:{normal:null,aiming:null},guard:{damage:0,timer:0,fxSheet:new ig.EffectSheet("guard"),fxHandle:null,currentKey:null},model:null,posOffset:Vec2.create(),navTarget:null,state:null,inCombat:false,targetStats:{distVec:Vec2.create(),distance:0,outOfScreenTime:0},stateData:{},timer:{action:0,move:0,attack:0,noAttackTime:0,dodge:0},throwDirData:Vec2.create(),currentCombatArt:null,charging:{max:0,current:0,timer:0},init:function(a,b,c,d){this.parent(a,b,c,d);
this.configs.normal.overwrite("collType",ig.COLLTYPE.SEMI_IGNORE);this.configs.battle.overwrite("collType",ig.COLLTYPE.SEMI_IGNORE);this.configs.aiming.overwrite("collType",ig.COLLTYPE.SEMI_IGNORE);this.configs.aiming.overwrite("maxVel",180);this.configs.aiming.overwrite("relativeVel",100/180);this.setDefaultConfig(this.configs.normal);this.model=sc.party.getPartyMemberModel(d.partyMemberName);sc.Model.addObserver(this.model,this);if(this.model.walkAnims)for(a=h.length;a--;){b=h[a];this.model.walkAnims[b]&&
this.storeWalkAnims(b,this.model.walkAnims[b])}this.animSheet=this.model.animSheet;this.proxies=this.model.getBalls();this.initAnimations();this.params=this.model.params;this.params.setCombatant(this);this.updateModelStats();d.posOffset&&Vec2.assign(this.posOffset,d.posOffset);this.state=f.IDLE;this.state.start(this,ig.game.playerEntity,this.targetStats,this.stateData);this.charging.fx=new sc.CombatCharge(this,false)},updateDefaultConfig:function(a){a?this.setDefaultConfig(this.configs.aiming):this.setDefaultConfig(this.goToCombat()?
this.configs.battle:this.configs.normal)},show:function(a){this.parent(a);if(!a){this.animState.alpha=0;ig.game.effects.teleport.spawnOnTarget("showDefault",this,{align:"CENTER"});this.setAction(i)}},onPreDamageModification:function(a,b,c,d,e){if(e&&e.damage>=this.params.currentHp&&this.model.noDie)return a.survive=true;return false},onInstantDamage:function(a){return a>=this.params.currentHp&&this.model.noDie},onKill:function(a){this.model&&sc.Model.removeObserver(this.model,this);if(this.model&&
this.params.isDefeated())sc.party.onMemberDefeat(this.model.name);this.parent(a)},leaveParty:function(a){if(!this._killed){sc.Model.removeObserver(this.model,this);this.model=null;this.endCombat();a?this.kill():this.setAction(j)}},resetAttackTimer:function(){var a;a=this.target&&sc.EnemyAnno.isWeak(this.target)?1:1.5+Math.random()*1.5;sc.party.getPartySize()==2&&(a=a*2);a=a*(1-sc.party.ai.aggressive);this.timer.attack=a},startCombat:function(){this.selectTarget();if(this.target){this.inCombat=true;
this.timer.attack=1+Math.random()*1;this.changeState(f.COMBAT_IDLE)}},endCombat:function(){this.setTarget(null);this.inCombat=false;this.changeState(f.IDLE)},startCombatArtCharging:function(){this.setCurrentAnim("charge",false,null,true);this.animationFixed=true;this.timer.action=-1;this.charging.max=1;this.charging.level=0;var a=this.model.getCombatArtName(sc.PLAYER_ACTION[this.currentCombatArt.actionKey+this.charging.max]);if(a&&sc.options.get("party-combat-arts")!=sc.PARTY_COMBAT_ARTS.NONE){a=
new sc.SmallEntityBox(this,a.toString(),1);a.stopRumble();ig.gui.addGuiElement(a)}this.doCombatArtCharge()},doCombatArtCharge:function(){this.charging.timer=e[this.charging.level];this.faceToTarget.active=true;this.charging.level++;this.charging.fx.charge(this.model.currentElementMode,this.charging.level,sc.options.get("party-combat-arts")!=sc.PARTY_COMBAT_ARTS.FULL)},cancelCharge:function(){if(this.currentCombatArt){this.charging.timer=0;this.currentCombatArt=null;this.charging.fx.stop();this.animationFixed=
false}},doCombatArt:function(){this.charging.fx.stop();var a=this.currentCombatArt.actionKey+this.charging.max;this.params.consumeSp(sc.PLAYER_SP_COST[this.charging.max-1]);this.cancelCharge();this.doPlayerAction(a);this.coll.relativeVel=1;this.faceToTarget.active=false},setAction:function(a,b,c){if(!this.eventBlocked&&sc.model.isCutscene()&&a&&a.eventAction){this.eventBlocked=true;this.updateDefaultConfig(false)}this.parent(a,b,c)},setActionBlocked:function(a){this.timer.action=a.action;this.timer.dodge=
a.dash||0},hasValidTarget:function(){return this.target&&!this.target._killed&&!this.target.isDefeated()&&this.target.target},selectTarget:function(){if(!this.hasValidTarget()){var a=sc.combat.getPlayerTarget(this);this.setTarget(a)}},reselectTarget:function(){var a=sc.combat.getPlayerTarget(this);(a||!this.hasValidTarget())&&this.setTarget(a)},hasElement:function(a){return this.model.allElements?true:sc.newgame.get("keep-elements")&&a!=sc.ELEMENT.NEUTRAL?ig.vars.get("g.newgame.elements."+a)||false:
sc.model.player.hasElement(a)},getBestElement:function(){if(!this.target||!this.model||!sc.model.player.getCore(sc.PLAYER_CORE.ELEMENT_CHANGE))return sc.ELEMENT.NEUTRAL;var a=0,b=1,c=1;if(Math.random()<=sc.EnemyAnno.getUnderstandFactor(this.target,this,1))for(var d=sc.EnemyAnno.getElement(this.target),e=this.target.params&&this.target.params.getStat("elemFactor"),f=sc.ELEMENT_MAX+1;f--;)if(this.hasElement(f)){if(f==d||this.target.elementFilter&&this.target.elementFilter==f)return f;if(f&&e&&e[f-1]>=
b){if(e[f-1]==b){c++;if(Math.random()<1/c)continue}else c=1;a=f;b=e[f-1]}}return a},consumeSandwich:function(a){this.model.consumeSandwich(a,this)},updateElement:function(){if(this.model){var a=this.getBestElement();a!=this.model.currentElementMode&&this.model.setElementMode(a)}},updateModelStats:function(){this.regenFactor=this.params.getModifier("HP_REGEN");this.spikeDmg.baseFactor=this.params.getModifier("SPIKE_DMG");this.stunThreshold=this.params.getModifier("STUN_THRESHOLD");if(this.params)this.params.criticalDmgFactor=
1.5+this.params.getModifier("CRITICAL_DMG")},modelChanged:function(a,b){a==this.model&&b==sc.PARTY_MEMBER_MSG.STATS_CHANGED&&this.updateModelStats()},selectCombatArt:function(){for(var b=0;b<d.length;++b)c[b]=this.model.getActionMaxLevel(a[d[b]].actionKey);if(sc.EnemyAnno.useRanged(this.target)){c[a.ATTACK.idx]=0;c[a.DASH.idx]=0}sc.EnemyAnno.useMelee(this.target)&&(c[a.THROW.idx]=0);for(var e=[],b=c.length;b--;)c[b]>0&&e.push(b);if(e.length>0){b=e[Math.floor(Math.random()*e.length)];if(c[b])this.currentCombatArt=
a[d[b]]}},changeState:function(a){this.state=a;this.cancelAction();a=this.target||ig.game.playerEntity;this.state.start&&this.state.start(this,a,this.targetStats,this.stateData)},isControlBlocked:function(){return!this.model||this.hasStun()||this.params.isDefeated()||this.currentAction&&this.currentAction.eventAction||this.currentAction==i},getDodgeProbability:function(a){var b=0.5;(a=a.getCombatant())&&(b=sc.EnemyAnno.getUnderstandFactor(a,this,1));a=sc.party.getStrategy("BEHAVIOUR");return(1-b)*
a.dodgeMin+b*a.dodgeMax},goToCombat:function(){return sc.model.isCombatActive()&&!sc.party.getStrategy("BEHAVIOUR").doNothing},update:function(){if(!this.eventBlocked||!sc.model.isCutscene()){if(this.eventBlocked){this.navTarget=null;this.changeState(f.IDLE);this.eventBlocked=false}this.targetStats.outOfScreenTime=ig.EntityTools.isInScreen(this,0)?0:this.targetStats.outOfScreenTime+ig.system.tick;this.timer.attack=b(this.timer.attack);this.timer.move=b(this.timer.move);this.timer.action=b(this.timer.action);
this.timer.dodge=b(this.timer.dodge);var a=ig.game.playerEntity;if(this.isControlBlocked()){this.state=null;this.cancelCharge();this.timer.action=0}else{if(this.charging.timer){this.charging.timer=this.charging.timer-ig.system.tick;this.charging.timer<=0&&(this.charging.level==this.charging.max?this.doCombatArt():this.doCombatArtCharge())}else if(this.timer.action&&!this.currentAction){this.timer.action=0;this.timer.dodge=0}this.state||this.changeState(this.inCombat?f.COMBAT_IDLE:f.IDLE);if(sc.model.isCombatActive()&&
!this.jumping&&this.timer.dodge==0){var c=sc.combat.getNearbyThreat(this,48,1);if(!c&&(this.target&&sc.EnemyAnno.keepFarDistance(this.target,this))&&ig.CollTools.getGroundDistance(this.coll,this.target.coll)<240)c=this.target;if(c){this.timer.dodge=0.25;if(Math.random()<this.getDodgeProbability(c)){this.threat=c;this.changeState(f.DODGE)}}}if(!this.timer.action&&!this.jumping)if(this.goToCombat()){if(this.inCombat){if(!this.hasValidTarget()){this.selectTarget();this.target?this.changeState(f.COMBAT_IDLE):
this.endCombat()}}else this.startCombat();this.timer.noAttackTime=this.timer.noAttackTime+ig.system.tick;if(this.timer.noAttackTime>5){this.timer.noAttackTime=0;this.reselectTarget()}}else this.inCombat&&this.endCombat();a=this.target||a;ig.CollTools.getDistVec2(this.coll,a.coll,this.targetStats.distVec);this.targetStats.distance=Vec2.length(this.targetStats.distVec);this.targetStats.distance=this.targetStats.distance-a.coll.size.x/2;(a=this.state.update(this,a,this.targetStats,this.stateData))&&
this.changeState(a)}}else{this.noFaceRotate=true;this.cancelCharge()}this.parent();this.model||this.currentAction||this.kill()},resetPos:function(a){sc.party.resetMemberPos(this.model.name);a||ig.game.effects.teleport.spawnOnTarget("showFast",this);this.nav.path.mapVersion=-1;this.target&&this.reselectTarget()},setNavTarget:function(a){a==1?this.navTarget!=a&&this.nav.path.toEntity(ig.game.playerEntity,16,{posOffset:this.posOffset}):a==2?this.nav.path.dodge(ig.game.playerEntity,32):a==12?this.nav.path.runAway(ig.game.playerEntity,
sc.party.keepDistance?100:240):this.target&&(a==3?this.nav.path.runAway(this.target,this.model.combatStyle.normDistance,true):a==4?this.nav.path.toEntity(this.target,this.model.combatStyle.meleeDistance):a==7?this.nav.path.runToFace(this.target,0.5,32,80):a==8?this.nav.path.runToFace(this.target,0,32,80):a==5?this.nav.path.sideways(this.target,80,16,true):a==6?this.nav.path.runAway(this.target,this.model.combatStyle.normDistance-20,true):a==9?this.nav.path.runToFace(this.target,0.5,this.model.combatStyle.normDistance-
20,this.model.combatStyle.normDistance+12,true):a==10?this.nav.path.runToFace(this.target,0,this.model.combatStyle.normDistance-20,this.model.combatStyle.normDistance+12,true):a==11&&this.nav.path.runAway(this.target,240));this.navTarget=a},onNavigationFailed:function(a){if(a>5){this.nav.failTimer=0;this.resetPos()}}});var i=new ig.Action("enemyStart",[{type:"WAIT",time:0.4}]),j=new ig.Action("enemyStart",[{type:"SHOW_EFFECT",effect:{sheet:"teleport",name:"hideDefault"},wait:true,align:"CENTER",actionDetached:true}])});
ig.baked=!0;ig.module("game.feature.party.plug-in").requires("game.feature.party.party","game.feature.party.party-steps","game.feature.party.party-member-model","game.feature.party.entities.party-member-entity").defines(function(){window.wm&&wm.postLoadModules.push("game.feature.party.editors.party-editors")});ig.baked=!0;
ig.module("game.feature.common-event.common-event").requires("impact.feature.storage.storage","game.feature.party.party").defines(function(){function b(a,b){return a-b}var a=["D","E","C","B","A","S"],d=["ENTER","LEAVE"];sc.COMMON_EVENT_TYPE={CALL:{_wm:new ig.Config({attributes:{}}),check:function(){return true}},ENEMY_ATTACKS:{_wm:new ig.Config({attributes:{enemies:{_type:"Array",_info:"Types of enemy attacking",_sub:{_type:"String",_select:"enemies"},_optional:true},levelGapAbove:{_type:"Integer",
_info:"LevelGap: Enemy Level - Player Level",_optional:true},levelGapBelow:{_type:"Integer",_info:"LevelGap: Enemy Level - Player Level",_optional:true},playerStarted:{_type:"Boolean",_info:"If defined: only trigger when player started battle if true or if not player started if false",_optional:true},battleStarted:{_type:"Boolean",_info:"If defined => true: only trigger when start of battle, false: only trigger when enemies join during battle",_optional:true}}}),cutsceneCheck:true,check:function(a,
b){return a.enemies&&!b.enemies.intersect(a.enemies)||a.levelGapAbove!==void 0&&b.levelGap<a.levelGapAbove||a.levelGapBelow!==void 0&&b.levelGap>a.levelGapBelow||a.playerStarted!==void 0&&a.playerStarted!=b.playerStarted||a.battleStarted!==void 0&&a.battleStarted!=b.battleStarted?false:true}},ENEMY_DEFEATED:{_wm:new ig.Config({attributes:{enemy:{_type:"String",_info:"Type of enemy defeated",_select:"enemies",_optional:true}}}),cutsceneCheck:true,check:function(a,b){return!a.enemy||a.enemy==b.enemy}},
BATTLE_OVER:{_wm:new ig.Config({attributes:{killCount:{_type:"Integer",_info:"Minimum amount of killed enemies"},rank:{_type:"String",_info:"Minimum rank at cooldown",_select:a,_optional:true}}}),cutsceneCheck:true,check:function(a,b){if(a.killCount>b.killCount)return false;if(a.rank){var c=sc.model.getCombatRankByLabel(a.rank);return b.rank>=c}return true}},COOLDOWN_START:{_wm:new ig.Config({attributes:{enemies:{_type:"Array",_info:"Type of enemy defeated",_sub:{_type:"String",_select:"enemies"},
_optional:true},killCount:{_type:"Integer",_info:"Minimum amount of killed enemies"},rank:{_type:"String",_info:"Minimum rank at cooldown",_select:a,_optional:true},rankReached:{_type:"String",_info:"Rank that was reached since last cooldown",_select:a,_optional:true}}}),cutsceneCheck:true,check:function(a,b){if(a.enemies&&!b.enemies.intersect(a.enemies))return false;if(a.rankReached){var c=sc.model.getCombatRankByLabel(a.rankReached);if(b.rank<c||b.prevRank>=c)return false}if(a.rank){c=sc.model.getCombatRankByLabel(a.rank);
return b.rank>=c}return true}},LEVEL_UP:{_wm:new ig.Config({attributes:{level:{_type:"Integer",_info:"Minimum Level reached"}}}),cutsceneCheck:true,check:function(a,b){return a.level>=b.rank}},MENU_LEAVE:{_wm:new ig.Config({attributes:{}}),check:function(){return true}},QUEST_ACCEPTED:{_wm:new ig.Config({attributes:{}}),triggerAll:true,check:function(){return true}},PARTY_MEMBER_EVENT:{_wm:new ig.Config({attributes:{member:{_type:"String",_info:"Party member that just DIED",_select:sc.PARTY_OPTIONS},
eventType:{_type:"String",_info:"Type of party member event",_select:["DIES","REVIVED","EQUIP_UPDATE"]}}}),cutsceneCheck:true,check:function(a,b){return b.member.indexOf(a.member)==-1?false:a.eventType==b.eventType}},DUNGEON_TRANSITION:{_wm:new ig.Config({attributes:{mapTransition:{_type:"String",_info:"If defined: react on map dungeon change",_select:d,_withNull:true},areaTransition:{_type:"String",_info:"If defined: react on area dungeon change",_select:d,_withNull:true}}}),cutsceneCheck:true,check:function(a,
b){return(!a.mapTransition||a.mapTransition==b.mapTransition)&&(!a.areaTransition||a.areaTransition==b.areaTransition)}},SOCIAL_ACTION:{_wm:new ig.Config({attributes:{member:{_type:"String",_info:"Party member that we do the social action with",_select:sc.PARTY_OPTIONS,_optional:true},actionType:{_type:"String",_info:"Type of social action",_select:sc.SOCIAL_ACTION}}}),check:function(a,b){return a.member&&a.member!=b.member?false:sc.SOCIAL_ACTION[a.actionType]==b.actionType},startEvent:function(a,
b){return sc.Cutscene.startMenuEvent(a,b)}},MAP_ENTERED:{_wm:new ig.Config({attributes:{}}),cutsceneCheck:true,check:function(){return true}},FORCE_UPDATE:{_wm:new ig.Config({attributes:{}}),triggerAll:true,check:function(){return true}}};sc.COMMON_EVENT_FREQUENCY={ALWAYS:{},REGULAR:{prop:1},SOMETIMES:{prop:0.5},RARE:{prop:0.2}};sc.COMMON_EVENT_REPEAT={REPEAT:1,ONCE:2};var c=["REGULAR","SOMETIMES","RARE"],e=[];sc.CommonEvents=ig.GameAddon.extend({events:{},eventsByType:{},runData:{},delayedTriggerStack:[],
delayedTriggerTimer:0,init:function(){ig.storage.register(this);window.wm&&ig.database.register("commonEvents","CommonEnumEditor","Common Events");this._loadCommonEvents()},onReset:function(){this.runData={}},onStorageSave:function(a){var b={},c;for(c in this.runData){var d=this.runData[c];this.events[c]&&this.events[c].repeat==sc.COMMON_EVENT_REPEAT.ONCE&&(b[c]=ig.copy(d))}a.commonEvents={runData:b}},onStoragePreLoad:function(a){a=a.commonEvents||{};this.runData=ig.copy(a.runData||{});for(var b in this.runData)if(this.runData[b].runCount){this.runData[b].trigger=
this.runData[b].runCount;delete this.runData[b].runCount}},onDeferredUpdate:function(){if(this.delayedTriggerTimer){if(sc.model.isCutscene()||sc.model.isTeleport()){this.delayedTriggerTimer=0;this.delayedTriggerStack.length=0}this.delayedTriggerTimer=this.delayedTriggerTimer-ig.system.actualTick;if(this.delayedTriggerTimer<=0){this.delayedTriggerTimer=0;for(var a=this.delayedTriggerStack.length;a--;){var b=this.delayedTriggerStack[a];this._forcedTriggerEvent(b.type,b.eventData,sc.model.message.isSideMessageVisible())}this.delayedTriggerStack.length=
0}}},_loadCommonEvents:function(){this.events={};var a=ig.database.get("commonEvents");ig.LangLabel.setOriginFile("data/database.json");for(var b in a){var c=new sc.CommonEvent(b,a[b]);this.events[b]=c;var d=c.type;this.eventsByType[d]||(this.eventsByType[d]=[]);this.eventsByType[d].push(c)}ig.LangLabel.setOriginFile(null)},triggerEvent:function(a,b){if(sc.autoControl.isActive())return null;if(sc.COMMON_EVENT_TYPE[a].cutsceneCheck){this.delayedTriggerTimer=0.2;this.delayedTriggerStack.push({type:a,
eventData:ig.copy(b)})}else return this._forcedTriggerEvent(a,b);return null},cancelEvent:function(a){for(var b=false,c=this.delayedTriggerStack.length;c--;)if(this.delayedTriggerStack[c].type==a){this.delayedTriggerStack.splice(c,1);b=true}return b},startCallEvent:function(a){if((a=this.events[a])&&this._checkEventExecution(a,{},Math.random()))return this._startCommonEvent(a)},getInlineCallEvent:function(a){a=this.events[a];return!a?null:a.getEvent()},getInlineCallData:function(a){a=this.events[a];
if(!a)return null;var b=a.getCallData(this.getRunCount(a));this.increaseTriggerCount(a);return b},_forcedTriggerEvent:function(a,b,c){var d=sc.COMMON_EVENT_TYPE[a],e=null,k=[];do{var l=this.selectEvent(a,b,k,c);if(l){k.push(l);e=this._startCommonEvent(l)}}while(d.triggerAll&&l);return e},_checkEventExecution:function(a,b,c){if(!a.check(b)||a.repeat==sc.COMMON_EVENT_REPEAT.ONCE&&this.getTriggerCount(a)>=a.loopCount||a.frequency.prop&&a.frequency.prop<c)return false;if(this.getRunCount(a)==0){this.increaseTriggerCount(a);
return false}return true},_startCommonEvent:function(a){var b=a.start(this.getRunCount(a));this.increaseTriggerCount(a);return b},selectEvent:function(a,b,d,i){a=this.eventsByType[a];if(!a)return null;var j=c.length,k=Math.random();e.length=0;for(var l=-1,j=0;j<a.length;++j){var o=a[j];if(d.indexOf(o)==-1&&(!i||o.overrideSideMessage)&&this._checkEventExecution(o,b,k)){if(!o.frequency.prop)return o;if(!(o.repeat!=sc.COMMON_EVENT_REPEAT.ONCE&&l!=-1)){var m=this.getTriggerCount(o);if(o.repeat==sc.COMMON_EVENT_REPEAT.ONCE&&
(l==-1||m<l)){e.length=0;l=m}(l==-1||m==l)&&e.push(o)}}}return e[Math.floor(Math.random()*e.length)]},getRunCount:function(a){if(!a.runOnTrigger)return 1;var b=this.getTriggerCount(a)+1;return a.runOnTrigger.indexOf(b)+1},getTriggerCount:function(a){return this.runData[a.name]&&this.runData[a.name].trigger||0},increaseTriggerCount:function(a){this.runData[a.name]||(this.runData[a.name]={trigger:0});var b=this.runData[a.name];b.trigger=b.trigger+1||1;a.repeat!=sc.COMMON_EVENT_REPEAT.ONCE&&(b.trigger=
b.trigger%a.loopCount)}});sc.CommonEvent=ig.Class.extend({name:null,type:null,typeDetails:null,frequency:null,repeat:null,runOnTrigger:null,loopCount:0,condition:null,event:null,init:function(a,c){this.name=a;if(c.type){this.type=c.type.type;this.typeDetails=c.type}this.frequency=sc.COMMON_EVENT_FREQUENCY[c.frequency];this.repeat=sc.COMMON_EVENT_REPEAT[c.repeat];this.condition=new ig.VarCondition(c.condition);this.eventType=ig.EVENT_TYPE[c.eventType]||ig.EVENT_TYPE.PARALLEL;this.runOnTrigger=c.runOnTrigger||
null;this.overrideSideMessage=c.overrideSideMessage||false;if(this.runOnTrigger){this.runOnTrigger.sort(b);this.loopCount=this.runOnTrigger.last()}else this.loopCount=1;this.event=new ig.Event({steps:c.event,input:{runCount:{_type:"Number"}}});this.event.common=true},check:function(a){return!this.condition.evaluate()?false:sc.COMMON_EVENT_TYPE[this.type].check(this.typeDetails,a)},start:function(a){var a=this.getCallData(a),b=sc.COMMON_EVENT_TYPE[this.type];return b.startEvent?b.startEvent(this.event,
a):sc.Cutscene.startEvent(this.eventType,this.event,a)},getEvent:function(){return this.event},getCallData:function(a){return{runCount:a}}});ig.addGameAddon(function(){return sc.commonEvents=new sc.CommonEvents})});ig.baked=!0;
ig.module("game.feature.common-event.common-event-steps").requires("game.feature.common-event.common-event","impact.base.action","impact.base.event").defines(function(){ig.EVENT_STEP.TRIGGER_COMMON_EVENTS=ig.EventStepBase.extend({commonEventType:null,_wm:new ig.Config({attributes:{commonEventType:{_type:"String",_info:"Type of Common Event",_select:sc.COMMON_EVENT_TYPE}}}),init:function(b){this.commonEventType=b.commonEventType},start:function(){sc.commonEvents.triggerEvent(this.commonEventType,{})}});
ig.EVENT_STEP.CALL_EVENT=ig.EventStepBase.extend({callEvent:null,_wm:new ig.Config({attributes:{callEvent:{_type:"CallEvent",_info:"Call event that will be called."}}}),init:function(b){this.callEvent=b.callEvent},start:function(){sc.commonEvents.startCallEvent(this.callEvent)}});ig.EVENT_STEP.CALL_EVENT_INLINE=ig.EventStepBase.extend({callEvent:null,_wm:new ig.Config({attributes:{callEvent:{_type:"CallEvent",_info:"Call event that will be called."}}}),init:function(b){this.callEvent=b.callEvent},
getInlineEvent:function(){return sc.commonEvents.getInlineCallEvent(this.callEvent)},getInlineEventInput:function(){return sc.commonEvents.getInlineCallData(this.callEvent)}});ig.EVENT_STEP.CANCEL_COMMON_EVENTS=ig.EventStepBase.extend({_wm:new ig.Config({attributes:{commonEventType:{_type:"String",_info:"Type of Common Event to cancel",_select:sc.COMMON_EVENT_TYPE}}}),init:function(b){this.commonEventType=b.commonEventType},start:function(){sc.commonEvents.cancelEvent(this.commonEventType)}})});
ig.baked=!0;ig.module("game.feature.common-event.plug-in").requires("game.feature.common-event.common-event","game.feature.common-event.common-event-steps").defines(function(){window.wm&&wm.postLoadModules.push("game.feature.common-event.editors.common-event-editors")});ig.baked=!0;
ig.module("game.feature.voice-acting.voice-acting").requires("impact.base.game").defines(function(){sc.VA_CONFIG={};sc.VoiceActing=ig.GameAddon.extend({active:false,loaded:false,voices:{},init:function(){},toggle:function(){(this.active=!this.active)&&this.load()},load:function(){if(!this.loaded){for(var b in sc.VA_CONFIG){for(var a=sc.VA_CONFIG[b],d=[],c=0;c<a.length;++c)d[c]=this.loadConfigSounds(a[c]);this.voices[b]=d}this.loaded=true}},loadConfigSounds:function(b){for(var a={sounds:[],filter:b.filter},
d=0;d<b.sounds.length;++d){var c=b.sounds[d];a.sounds[d]=new ig.Sound("media/sound/va/"+c.src,(c.volume||1)*1.5,0,"voiceActing")}return a},play:function(b,a){if(this.active){var d=b.character.name,c=b.expression;a instanceof ig.LangLabel&&(a=a.data.en_US);a=a||"";if(d=this.voices[d]){for(var e=[],f=0,g=d.length;g--;){var h=d[g],i=0;if(h.filter&&h.filter.text&&a.toLowerCase().indexOf(h.filter.text.toLowerCase())!=-1){i=i+h.filter.text.length;h.filter.expressions&&h.filter.expressions.indexOf(c)!=-1&&
(i=i+100)}if(i>f){e.length=0;f=i}if(i==f)for(i=h.sounds.length;i--;)e.push(h.sounds[i])}e.length>0&&e.random().play()}}}});ig.addGameAddon(function(){return sc.voiceActing=new sc.VoiceActing})});ig.baked=!0;
ig.module("game.feature.voice-acting.va-config").requires("game.feature.voice-acting.voice-acting").defines(function(){sc.VA_CONFIG["main.lea"]=[{sounds:[{src:"lea/bye.ogg",volume:1}],filter:{text:"Bye"}},{sounds:[{src:"lea/bye-question.ogg",volume:1}],filter:{text:"Bye?"}},{sounds:[{src:"lea/haaaaii.ogg",volume:1},{src:"lea/haaaaii-2.ogg",volume:1}],filter:{text:"Hi",expressions:["EXCITED"]}},{sounds:[{src:"lea/hi-dissapointed.ogg",volume:1}],filter:{text:"Hi",expressions:["EXHAUSTED","ANNOYED",
"MOPING"]}},{sounds:[{src:"lea/hi-question.ogg",volume:1}],filter:{text:"Hi",expressions:["SURPRISED_TOWARD","SURPRISED_AWAY","NERVOUS"]}},{sounds:[{src:"lea/hi.ogg",volume:1},{src:"lea/hi-2.ogg",volume:1},{src:"lea/hi-3.ogg",volume:1}],filter:{text:"Hi"}},{sounds:[{src:"lea/how.ogg",volume:1},{src:"lea/how-2.ogg",volume:1}],filter:{text:"How"}},{sounds:[{src:"lea/lea.ogg",volume:1},{src:"lea/lea-2.ogg",volume:1},{src:"lea/lea-3.ogg",volume:1}],filter:{text:"Lea"}},{sounds:[{src:"lea/lea-dissapointed.ogg",
volume:1}],filter:{text:"Lea",expressions:["ANNOYED","MOPING"]}},{sounds:[{src:"lea/hmmm.ogg",volume:1}],filter:{text:"...!"}},{sounds:[{src:"lea/seufz.ogg",volume:1},{src:"lea/seufz-2.ogg",volume:1}],filter:{text:"..."}},{sounds:[{src:"lea/huh.ogg",volume:1}],filter:{text:"...?"}},{sounds:[],filter:{text:"[nods]"}},{sounds:[],filter:{text:"[shakes head]"}}];sc.VA_CONFIG["main.shizuka"]=[{sounds:[{src:"shizuka/alligator.ogg",volume:1}]},{sounds:[{src:"shizuka/bakka.ogg",volume:1},{src:"shizuka/bakka-2.ogg",
volume:1},{src:"shizuka/bakka-3.ogg",volume:1}]},{sounds:[{src:"shizuka/chikusho.ogg",volume:1}]},{sounds:[{src:"shizuka/gomenasai.ogg",volume:1}]},{sounds:[{src:"shizuka/jameruuu.ogg",volume:1},{src:"shizuka/jameruuu-2.ogg",volume:1}]},{sounds:[{src:"shizuka/jameruuu.ogg",volume:1},{src:"shizuka/jameruuu-2.ogg",volume:1}]},{sounds:[{src:"shizuka/kawaiiii.ogg",volume:1}]}];sc.VA_CONFIG["main.sergey"]=[{sounds:[{src:"sergey/binary.ogg",volume:1}]},{sounds:[{src:"sergey/can-you-hear-me.ogg",volume:1}]},
{sounds:[{src:"sergey/customer-service.ogg",volume:1}]},{sounds:[{src:"sergey/hotline.ogg",volume:1}]},{sounds:[{src:"sergey/is-this-working.ogg",volume:1}]},{sounds:[{src:"sergey/is-this-working-2.ogg",volume:1}]},{sounds:[{src:"sergey/turn-it-off-and-on.ogg",volume:1}]}];sc.VA_CONFIG["main.schneider"]=[{sounds:[{src:"schneider/ah-hallo.ogg",volume:1}]},{sounds:[{src:"schneider/bratwurst.ogg",volume:1}]},{sounds:[{src:"schneider/fabelhaft.ogg",volume:1}]},{sounds:[{src:"schneider/holeroe.ogg",volume:1},
{src:"schneider/holeroe-2.ogg",volume:1},{src:"schneider/holeroe-3.ogg",volume:1}],filter:{text:"Holer\u00f6"}},{sounds:[{src:"schneider/holla-the-woodfairy.ogg",volume:1}]},{sounds:[{src:"schneider/i-think-i-spider.ogg",volume:1}]},{sounds:[{src:"schneider/ja.ogg",volume:1}]},{sounds:[{src:"schneider/jaja-thats-how-it-is.ogg",volume:1}]},{sounds:[{src:"schneider/my-akzent.ogg",volume:1}]},{sounds:[{src:"schneider/my-lovely.mister-singing-club.ogg",volume:1}]},{sounds:[{src:"schneider/my-pig-whistles.ogg",
volume:1}]},{sounds:[{src:"schneider/neineinein.ogg",volume:1}]},{sounds:[{src:"schneider/noone-can-reach-me-the-water.ogg",volume:1}]},{sounds:[{src:"schneider/sauerkraut.ogg",volume:1}]},{sounds:[{src:"schneider/schifffahrtskapitaensmuetze.ogg",volume:1}]},{sounds:[{src:"schneider/that-makes-me-nobody-so-easy-after.ogg",volume:1}]}];sc.VA_CONFIG["main.emilie"]=[{sounds:[{src:"emilie/au-reviour.ogg",volume:1}],filter:{text:"revoir"}},{sounds:[{src:"emilie/bonjour.ogg",volume:1},{src:"emilie/bonjour-2.ogg",
volume:1}],filter:{text:"Bonjour"}},{sounds:[{src:"emilie/non.ogg",volume:1}],filter:{text:"non"}},{sounds:[{src:"emilie/oui.ogg",volume:1},{src:"emilie/oui-2.ogg",volume:1}],filter:{text:"oui"}},{sounds:[{src:"emilie/je-mapelle-emilie.ogg",volume:1}],filter:{text:"emilie"}},{sounds:[{src:"emilie/sacre-bleu.ogg",volume:1},{src:"emilie/sacre-bleu-2.ogg",volume:1}],filter:{text:"Sacrebleu"}},{sounds:[{src:"emilie/oulala-2.ogg",volume:1},{src:"emilie/oulala-3.ogg",volume:1}]},{sounds:[{src:"emilie/exquise-moir.ogg",
volume:1}]}];sc.VA_CONFIG["main.carla"]=[{sounds:[{src:"carla/atta-girl.ogg",volume:1}],filter:{text:"attagirl"}},{sounds:[{src:"carla/come-on.ogg",volume:1}],filter:{text:"C'mon"}},{sounds:[{src:"carla/good-job.ogg",volume:1}],filter:{text:"Good"}},{sounds:[{src:"carla/gotcha.ogg",volume:1}],filter:{text:"gotcha"}},{sounds:[{src:"carla/u-know.ogg",volume:1}],filter:{text:"y'know"}}];sc.VA_CONFIG["main.captain"]=[{sounds:[{src:"jet/aarrr.ogg",volume:1}]},{sounds:[{src:"jet/ahoi.ogg",volume:1}]},{sounds:[{src:"jet/aye.ogg",
volume:1}]},{sounds:[{src:"jet/aye-mate.ogg",volume:1}]},{sounds:[{src:"jet/dead-men-tell-no-lies.ogg",volume:1}]},{sounds:[{src:"jet/fire-in-the-hole.ogg",volume:1}]},{sounds:[{src:"jet/hmpf.ogg",volume:1},{src:"jet/hmpf-2.ogg",volume:1}]},{sounds:[{src:"jet/laugh.ogg",volume:1}]},{sounds:[{src:"jet/scallywag.ogg",volume:1}]},{sounds:[{src:"jet/time-for-some-grog.ogg",volume:1}]},{sounds:[{src:"jet/walk-the-plank.ogg",volume:1}]},{sounds:[{src:"jet/yarrr.ogg",volume:1}]},{sounds:[{src:"jet/ye-dobber.ogg",
volume:1}],filter:{text:"Dobber"}},{sounds:[{src:"jet/ye-hornswaggle.ogg",volume:1}]}];sc.VA_CONFIG["main.genius"]=[{sounds:[{src:"satoshi/cough.ogg",volume:1},{src:"satoshi/cough-2.ogg",volume:1},{src:"satoshi/cough-3.ogg",volume:1}]},{sounds:[{src:"satoshi/daijube.ogg",volume:1},{src:"satoshi/daijube.ogg",volume:1}]},{sounds:[{src:"satoshi/yatta.ogg",volume:1},{src:"satoshi/yatta.ogg",volume:1}]}];sc.VA_CONFIG["antagonists.designer"]=[{sounds:[{src:"designer/amusing.ogg",volume:1.25},{src:"designer/amusing-2.ogg",
volume:1.25}]},{sounds:[{src:"designer/everything-by-design.ogg",volume:1.25}]},{sounds:[{src:"designer/extraordinary.ogg",volume:1.25}]},{sounds:[{src:"designer/laugh.ogg",volume:1.25},{src:"designer/laugh-2.ogg",volume:1.25}]},{sounds:[{src:"designer/proposterous.ogg",volume:1.25}],filter:{text:"preposterous"}},{sounds:[{src:"designer/tse.ogg",volume:1.25}]},{sounds:[{src:"designer/we-are-pleased.ogg",volume:1.25}]}];sc.VA_CONFIG["antagonists.gautham"]=[{sounds:[{src:"shady-guy/baka.ogg",volume:1}]},
{sounds:[{src:"shady-guy/kuso.ogg",volume:1},{src:"shady-guy/kuso-2.ogg",volume:1}]},{sounds:[{src:"shady-guy/madda-madda.ogg",volume:1},{src:"shady-guy/madda-madda-2.ogg",volume:1}]},{sounds:[{src:"shady-guy/masaka.ogg",volume:1},{src:"shady-guy/masaka-2.ogg",volume:1},{src:"shady-guy/masaka-3.ogg",volume:1}]},{sounds:[{src:"shady-guy/mate.ogg",volume:1},{src:"shady-guy/mate-2.ogg",volume:1}]},{sounds:[{src:"shady-guy/nani.ogg",volume:1},{src:"shady-guy/nani-2.ogg",volume:1},{src:"shady-guy/nani-3.ogg",
volume:1}]},{sounds:[{src:"shady-guy/nyehehe.ogg",volume:1}]}];sc.VA_CONFIG["antagonists.fancyguy"]=[{sounds:[{src:"apollo/cop.ogg",volume:1},{src:"apollo/cop-2.ogg",volume:1}]},{sounds:[{src:"apollo/hold-it.ogg",volume:1},{src:"apollo/hold-it-2.ogg",volume:1}]},{sounds:[{src:"apollo/hold-on.ogg",volume:1}]},{sounds:[{src:"apollo/objection.ogg",volume:1}]},{sounds:[{src:"apollo/stay-there.ogg",volume:1}]},{sounds:[{src:"apollo/wait-a-minute.ogg",volume:1},{src:"apollo/wait-a-minute-2.ogg",volume:1}]},
{sounds:[{src:"apollo/you-are-cheating.ogg",volume:1},{src:"apollo/you-cheater.ogg",volume:1}],filter:{text:"cheat"}},{sounds:[{src:"apollo/you-faker.ogg",volume:1}]},{sounds:[{src:"apollo/youre-no-real-spheromancer.ogg",volume:1}]}]});ig.baked=!0;ig.module("game.feature.voice-acting.plug-in").requires("game.feature.voice-acting.voice-acting","game.feature.voice-acting.va-config").defines(function(){});ig.baked=!0;
ig.module("game.feature.credits.credit-loadable").requires("impact.base.game","impact.base.loader").defines(function(){sc.CreditSectionLoadable=ig.Loadable.extend({cacheType:"Credit",data:null,lowestFloor:0,init:function(b){this.parent(b)},loadInternal:function(b){$.ajax({dataType:"json",url:ig.root+b.toPath("data/credits/",".json")+ig.getCacheSuffix(),context:this,success:this.onload.bind(this),error:this.onerror.bind(this)})},onerror:function(){this.data=null;this.loadingFinished(false)},onload:function(b){this.data=
b;this.loadingFinished(true)}});sc.CreditsManager=ig.GameAddon.extend({speed:1,init:function(){this.parent("CreditsManager")},reset:function(){this.speed=1},onTeleport:function(){this.reset()},onReset:function(){this.reset()}});ig.addGameAddon(function(){return sc.credits=new sc.CreditsManager})});ig.baked=!0;
ig.module("game.feature.credits.gui.credits-gui").requires("game.feature.gui.base.boxes","impact.feature.gui.gui","impact.feature.gui.base.basic-gui","impact.base.image","impact.base.lang","game.feature.gui.base.boxes","game.feature.credits.credit-loadable","game.feature.gui.base.text").defines(function(){ig.GUI.CreditSection=ig.GuiElementBase.extend({transitions:{DEFAULT:{state:{},time:0.2,timeFunction:KEY_SPLINES.LINEAR},HIDDEN:{state:{alpha:0},time:0.2,timeFunction:KEY_SPLINES.LINEAR}},credits:null,
imageContent:null,content:null,contentWidth:0,finished:false,isOffscreen:false,triggers:{},init:function(b){this.parent();this.setSize(ig.system.width,ig.system.height);this.hook.zIndex=99;this.hook.clip=true;this.credits=b;this.contentWidth=ig.system.width-(this.credits.data.border||64)*2;this.content=new ig.GuiElementBase;this.content.setSize(this.contentWidth,ig.system.height);this.imageContent=new ig.GuiElementBase;this.imageContent.setSize(ig.system.width,ig.system.height);this.addChildGui(this.imageContent);
this.addChildGui(this.content);this.doStateTransition("HIDDEN",true)},update:function(){var b=this.content.hook.pos.y,b=b+-30*ig.system.actualTick*sc.credits.speed;if(!this.finished&&b<=-this.content.hook.size.y+ig.system.height)this.finished=true;if(this.finished&&b<=-this.content.hook.size.y){this.isOffscreen=true;this.remove()}this.content.hook.pos.y=b},onAttach:function(){this.createSection();this.doStateTransition("DEFAULT",true)},onDetach:function(){},varsChanged:function(){},remove:function(){this.doStateTransition("HIDDEN",
true,true)},createSection:function(){var b=this.credits.data;this.content.setPos(this.getAlignPos(b.align),ig.system.height);var b=b.entries,a=Vec2.createC(),d;for(d in b){var c=b[d];if(c.key=="BASE"){var e=c.names;c.hideHeader||this.createHeader(c.header,a,e.length==0);if(e.length>0){var f=c.columns,g=this.createColumnGuis(f,a);this.createNames(e,f,g,a);a.y=a.y+(c.bottomPad||60)}else a.y=a.y+(c.bottomPad||30)}else c.key=="IMAGE"?this.createImage(c,a):c.key=="TRIGGER"&&this.createTrigger(c.name,a)}this.content.hook.size.y=
a.y},createImage:function(b,a){var d=b.image,c=new ig.GuiElementBase;c.setAlign(ig.GUI_ALIGN_X[b.alignX||"CENTER"],ig.GUI_ALIGN.Y_TOP);c.setPos(0,a.y);if(d){var d=new ig.ImageGui(new ig.Image(d.src),d.offX,d.offY,d.width,d.height),e=b.offset?b.offset.x:0,f=b.top!=void 0?b.top:0,f=f+(b.offset?b.offset.y:0);d.setPos(e,f);c.addChildGui(d);c.setSize(d.hook.size.x,d.hook.pos.y+d.hook.size.y+(b.bottom!=void 0?b.bottom:100))}else c.setSize(2,(b.top!=void 0?b.top:0)+(b.bottom!=void 0?b.bottom:100));this.content.addChildGui(c);
a.y=a.y+c.hook.size.y},createHeader:function(b,a,d){var c=new sc.TextGui(ig.LangLabel.getText(b),{maxWidth:this.contentWidth});c.hook.transitions={DEFAULT:{state:{},time:0.4,timeFunction:KEY_SPLINES.EASE_OUT},HIDDEN:{state:{scaleY:1E-4},time:0.2,timeFunction:KEY_SPLINES.LINEAR}};c.onVisibilityChange=function(){c.isVisible()?c.doStateTransition("DEFAULT",false,false,null,1.2/sc.credits.speed):c.doStateTransition("HIDDEN",true)}.bind(this);c.setAlign(ig.GUI_ALIGN.X_CENTER,ig.GUI_ALIGN.Y_TOP);c.setPos(0,
a.y);c.doStateTransition("HIDDEN",true);this.content.addChildGui(c);a.y=a.y+c.hook.size.y;if(!d){var e=new sc.LineGui(c.hook.size.x+10);e.setAlign(ig.GUI_ALIGN.X_CENTER,ig.GUI_ALIGN.Y_TOP);e.setPos(0,a.y);e.hook.transitions={HIDDEN:{state:{scaleX:1E-5},time:0,timeFunction:KEY_SPLINES.LINEAR},DEFAULT:{state:{scaleX:1},time:1,timeFunction:KEY_SPLINES.EASE_OUT}};e.onVisibilityChange=function(){e.isVisible()?e.doStateTransition("DEFAULT",false,false,null,1.2/sc.credits.speed):e.doStateTransition("HIDDEN",
true)}.bind(this);e.doStateTransition("HIDDEN",true);this.content.addChildGui(e);a.y=a.y+(e.hook.size.y+2)}},createColumnGuis:function(b,a){var d=0,c=Math.floor((this.contentWidth-16*(b-1))/b),e=new ig.GuiElementBase;e.setPos(0,a.y);e.setSize(this.contentWidth,20);var f=[];f.push(e);for(var g=0;g<b;g++){var h=new ig.GuiElementBase;h.onVisibilityChange=function(){if(this.isVisible())for(var a=this.hook.children,b=0;b<a.length;b++){a[b].doStateTransition("HIDDEN",true);a[b].doStateTransition("DEFAULT",
false,false,null,(1+0.6*b)/sc.credits.speed)}};h.setPos(d,0);h.setSize(c,20);e.addChildGui(h);d=d+(c+16);f.push(h)}this.content.addChildGui(e);return f},createNames:function(b,a,d,c){for(var e=1,f=Math.floor((this.contentWidth-16*(a-1))/a),g=0,h=0,i=0;i<b.length;i++){var j=new sc.TextGui(ig.LangLabel.getText(b[i]),{maxWidth:f,linePadding:-1});j.hook.transitions={DEFAULT:{state:{},time:1,timeFunction:KEY_SPLINES.LINEAR},HIDDEN:{state:{alpha:0},time:0.2,timeFunction:KEY_SPLINES.LINEAR}};if(a>1)if(e==
1){j.setAlign(ig.GUI_ALIGN.X_RIGHT,ig.GUI_ALIGN.Y_TOP);j.setTextAlign(ig.Font.ALIGN.RIGHT)}else if(e>=a){j.setAlign(ig.GUI_ALIGN.X_LEFT,ig.GUI_ALIGN.Y_TOP);j.setTextAlign(ig.Font.ALIGN.LEFT)}else{j.setAlign(ig.GUI_ALIGN.X_CENTER,ig.GUI_ALIGN.Y_TOP);j.setTextAlign(ig.Font.ALIGN.CENTER)}else j.setAlign(ig.GUI_ALIGN.X_CENTER,ig.GUI_ALIGN.Y_TOP);j.setTextAlign(ig.Font.ALIGN.CENTER);j.setPos(0,h);j.hook.size.y+2>g&&(g=j.hook.size.y+2);d[e].addChildGui(j);e++;if(e>a){e=1;h=h+g;g=0}else i==b.length-1&&(h=
h+g)}for(b=d.length;b--;)d[b].hook.size.y=h;c.y=c.y+h},createTrigger:function(b,a){var d=new ig.GuiElementBase;d.setPos(0,a.y);d.setSize(2,2);d.onVisibilityChange=function(){if(d.isVisible())d.skipFirst?this.triggers[b]=true:d.skipFirst=true}.bind(this);this.content.addChildGui(d)},getAlignPos:function(b){var a=0;b=="CENTER"?a=ig.system.width/2-this.content.hook.size.x/2:b=="RIGHT"&&(a=128);return a}})});ig.baked=!0;
ig.module("game.feature.credits.credits-steps").requires("impact.base.action","impact.base.event","game.feature.credits.credit-loadable").defines(function(){ig.EVENT_STEP.SHOW_CREDIT_SECTION=ig.EventStepBase.extend({name:null,credits:null,guiElement:null,_wm:new ig.Config({attributes:{name:{_type:"String",_info:"Name of the section. MUST BE GIVEN"},credits:{_type:"Select",_info:"Credit Section to show",_select:"credits"}}}),init:function(b){this.name=b.name;if(!this.name)throw Error("No name for credits entry!");
if(!window.wm)this.credits=new sc.CreditSectionLoadable(b.credits)},start:function(){if(this.name){var b=ig.gui.namedGuiElements[this.name];b&&b.remove()}this.guiElement=ig.gui.createEventGui(this.name,"CreditSection",this.credits);ig.gui.spawnEventGui(this.guiElement)},clearCached:function(){this.guiElement&&ig.gui.freeEventGui(this.guiElement);this.credits&&this.credits.decreaseRef()}});ig.EVENT_STEP.SET_CREDITS_SPEED=ig.EventStepBase.extend({value:1,_wm:new ig.Config({attributes:{value:{_type:"Number",
_info:"Credit speed scaling. Default is 1.",_default:1}}}),init:function(b){this.value=b.value},start:function(){sc.credits.speed=this.value}});ig.EVENT_STEP.WAIT_UNTIL_CREDIT_TRIGGER=ig.EventStepBase.extend({credits:null,trigger:null,_wm:new ig.Config({attributes:{credits:{_type:"String",_info:"Name of the credit section gui which contains the trigger"},trigger:{_type:"CreditsTriggerSelect",_info:"Name of the trigger"}}}),init:function(b){assertContent(b,"trigger","credits");this.trigger=b.trigger.trigger;
this.credits=b.credits},start:function(b){var a=ig.gui.namedGuiElements[this.credits];if(a)b._gui=a},run:function(b){return!b._gui?true:b._gui&&!b._gui.triggers[this.trigger]?false:true}});ig.EVENT_STEP.WAIT_UNTIL_CREDIT_SECTION_DONE=ig.EventStepBase.extend({name:null,offscreen:false,_wm:new ig.Config({attributes:{name:{_type:"String",_info:"Name of the section. MUST BE GIVEN"},offscreen:{_type:"Boolean",_info:"If true, waits until credits entry is really offscreen",_default:false}}}),init:function(b){assertContent(b,
"name");this.name=b.name;this.offscreen=b.offscreen||false},start:function(b){var a=ig.gui.namedGuiElements[this.name];if(a)b._gui=a},run:function(b){return!b._gui?true:b._gui&&(this.offscreen?!b._gui.isOffscreen:!b._gui.finished)?false:true}})});ig.baked=!0;
ig.module("game.feature.credits.plug-in").requires("game.feature.credits.credit-loadable","game.feature.credits.gui.credits-gui","game.feature.credits.credits-steps").defines(function(){if(window.wm){wm.addStepColorRule(/CREDIT/,"pink");wm.addStepColorRule(/CREDITS/,"pink");wm.postLoadModules.push("game.feature.credits.editors.credits-editors")}});ig.baked=!0;
ig.module("game.feature.arena.entities.arena-spawn").requires("impact.base.entity").defines(function(){sc.ARENA_ALIGN_X={CENTER:0,LEFT:1,RIGHT:2};sc.ARENA_ALIGN_Y={CENTER:0,TOP:1,BOTTOM:2};ig.ENTITY.ArenaSpawn=ig.Entity.extend({text:"",_wm:new ig.Config({spawnable:true,attributes:{text:{_type:"String",_info:"Text to display in information.",_large:true}},scalableX:true,scalableY:true,drawBox:true,label:function(){return"\n"+this.text},boxColor:"rgba(30, 30, 30, 0.5)",frontColor:"rgba(0, 0, 0, 0.5)"}),
init:function(b,a,d,c){this.parent(b,a,d,c);this.coll.type=ig.COLLTYPE.NONE;this.coll.size.z=0;this.text=c.text||""}})});ig.baked=!0;
ig.module("game.feature.arena.arena-loadable").requires("impact.base.game","impact.base.loader").defines(function(){sc.ArenaCache=ig.Cacheable.extend({cacheType:"ARENA_CACHE",init:function(){this.parent();sc.arena.loadCache()},onCacheCleared:function(){sc.arena.clearCache()},getCacheKey:function(){return"arenaCacheKey"}});sc.CupAsset=ig.Loadable.extend({cacheType:"CupAsset",data:null,key:null,init:function(b,a){this.key=b;this.parent(a)},loadInternal:function(b){$.ajax({dataType:"json",url:ig.getFilePath(ig.root+
b.toPath("data/arena/",".json")+ig.getCacheSuffix()),context:this,success:this.onload.bind(this),error:this.onerror.bind(this)})},onerror:function(){this.data=null;this.loadingFinished(false)},onload:function(b){this.data=b;this.loadingFinished(true)}})});ig.baked=!0;
ig.module("game.feature.arena.arena-bonus-objectives").requires("impact.base.game","impact.feature.storage.storage","game.feature.achievements.stats-model").defines(function(){function b(a){var b=a%60;return Math.floor(a/60)+":"+(b<10?"0":"")+b}sc.ARENA_MAX_BONUS_OBJECTIVES=6;sc.ARENA_BONUS_OBJECTIVE={};sc.ARENA_DEFAULT_BONUS_OBJECTIVES={NO_DAMAGE_TAKEN:{points:1E4},NO_ITEMS_USED:{points:5E3,ignoreOn:"PVP_BATTLE"},PVP_FLAWLESS:{points:1E4,challenge:"PVP_BATTLE"}};sc.ARENA_BONUS_OBJECTIVE.NO_DAMAGE_TAKEN=
{_type:"EMPTY",order:-10001,init:function(a,b){b._startHits=sc.stats.getMap("combat","damageTaken")},check:function(a){return ig.perf.grantArenaBonus?true:sc.stats.getMap("combat","damageTaken")==a._startHits},getText:function(a){return a}};sc.ARENA_BONUS_OBJECTIVE.NO_ITEMS_USED={_type:"EMPTY",order:-1E4,init:function(a,b){b._startUses=sc.stats.getMap("items","used")},check:function(a){return ig.perf.grantArenaBonus?true:sc.stats.getMap("items","used")==a._startUses},getText:function(a){return a}};
sc.ARENA_BONUS_OBJECTIVE.PVP_FLAWLESS={_type:"EMPTY",order:-100,init:function(a,b){b._startHits=sc.stats.getMap("combat","damageTaken")},check:function(){if(ig.perf.grantArenaBonus)return true;var a=sc.arena.runtime.scoreStats.PVP_ROUND_LOST;return a?a.count<1:true},getText:function(a){return a}};sc.ARENA_BONUS_OBJECTIVE.EFFECTIVE_DAMAGE={_type:"Integer",_prefix:"target",order:100,init:function(a,b){b._damageTarget=a.target;b._startDamage=sc.stats.getMap("arena","effectiveDamage")||0},check:function(a){return(sc.stats.getMap("arena",
"effectiveDamage")||0)-a._startDamage>=a._damageTarget},getText:function(a,b,c){return a.replace("[!]",c?b._damageTarget:b.target)}};sc.ARENA_BONUS_OBJECTIVE.HIT_COUNTER={_type:"Integer",_prefix:"value",order:1E3,init:function(a,b){b._maxHits=a.value;b._startHits=sc.stats.getMap("combat","damageHits")},check:function(a){return(sc.stats.getMap("combat","damageHits")||0)-a._startHits<a._maxHits},getText:function(a,b,c){return a.replace("[!]",c?b._maxHits:b.value)}};sc.ARENA_BONUS_OBJECTIVE.TIME={_type:"Integer",
_prefix:"seconds",order:0,displayRangePoints:true,init:function(a,b){b._time=a.seconds},check:function(a){return sc.timers.timers.arenaTimerReal?sc.timers.getPassedTime("arenaTimerReal")<=a._time*2:false},getText:function(a,d,c){d=c?d._time:d.seconds;if(c){c=Math.ceil(sc.timers.getPassedTime("arenaTimerReal"));return a.replace("[!]",b(c)+"\\i[slash-highlight]"+b(d))}return a.replace("[!]",b(d))},getPoints:function(a,b){var c=(sc.timers.getPassedTime("arenaTimerReal")/a._time-1).limit(0,1);return b-
Math.round(b*c)},getPointsRange:function(a){return a.points}};sc.ARENA_BONUS_OBJECTIVE.COMBAT_ARTS_USED={_type:"Integer",_prefix:"target",order:4E3,init:function(a,b){b._target=a.target;b._start=sc.stats.getMap("combat","specials")||0},check:function(a){return(sc.stats.getMap("combat","specials")||0)-a.start>=a._target},getText:function(a,b,c){return a.replace("[!]",c?b._target:b.target)}};sc.ARENA_BONUS_OBJECTIVE.CHAIN={_type:"Integer",_prefix:"target",order:5E3,init:function(a,b){b._target=a.target},
check:function(a){return sc.arena.runtime.chain>=a._target},getText:function(a,b,c){return a.replace("[!]",c?b._target:b.target)}};sc.ARENA_BONUS_OBJECTIVE.ITEMS_USED={_type:"Integer",_prefix:"amount",order:1E4,init:function(a,b){b._maxUses=a.amount;b._startUses=sc.stats.getMap("items","used")},check:function(a){return(sc.stats.getMap("items","used")||0)-a._startUses<a._maxUses},getText:function(a,b,c){return a.replace("[!]",c?b._maxUses:b.amount)}}});ig.baked=!0;
ig.module("game.feature.arena.arena-score-types").requires("impact.base.game").defines(function(){sc.ARENA_SCORE_TYPES={DAMAGE_DONE:{order:0,"static":true},DAMAGE_DONE_EFFECTIVE:{order:1,"static":true,asBonus:true},DAMAGE_TAKEN:{order:2,staticMultiplier:25,"static":true,asMali:true},KILL:{points:500,order:100,chain:true},BOSS_KILL:{points:5E3,order:101,chain:true},TARGET_KILL:{points:500,order:102,chain:true},MULTI_KILL:{points:1E3,order:103,chain:true},ENVIRONMENT_KILL:{points:1E3,order:104},ONE_HIT_KILL:{points:10,
order:105,chain:true},LOCK_FINISH:{points:500,order:200},LOCK_FINISH_3:{points:1E3,order:201},ELEMENT_OVERLOAD:{points:-1E4,order:300,asMali:true},PERFECT_SHIELD:{points:100,order:3E3,dimReturns:true},PERFECT_DODGE:{points:100,order:4E3,dimReturns:true},ENEMY_BREAK:{points:500,order:5E3},GUARD_COUNTER:{points:500,order:6E3},STATUS_INFLICT:{points:250,order:7E3},PVP_ROUND_WON:{points:5E3,order:8E3},PVP_ROUND_LOST:{points:-5E3,order:8001,asMali:true},ENEMY_HEAL:{order:2E3,"static":true,asMali:true}}});
ig.baked=!0;
ig.module("game.feature.arena.arena-challenges").requires("impact.base.game").defines(function(){sc.ARENA_CHALLENGES={};sc.ArenaChallengeBase=ig.Class.extend({state:false,icon:0,init:function(b,a){this.icon=b||0;this.callback=a},toggle:function(b){this.state=b!=void 0?b:!this.state;this.callback&&this.callback()}});sc.ArenaChallengePlayerBase=sc.ArenaChallengeBase.extend({core:null,init:function(b,a){this.parent(a,this.onToggle.bind(this));this.core=b},onToggle:function(){sc.model.player.setCore(sc.PLAYER_CORE[this.core],!this.state)}});
sc.ARENA_CHALLENGES.NO_MELEE=new sc.ArenaChallengePlayerBase("CLOSE_COMBAT",2);sc.ARENA_CHALLENGES.NO_RANGED=new sc.ArenaChallengePlayerBase("THROWING",3);sc.ARENA_CHALLENGES.NO_DASH=new sc.ArenaChallengePlayerBase("DASH",4);sc.ARENA_CHALLENGES.NO_GUARD=new sc.ArenaChallengePlayerBase("GUARD",5);sc.ARENA_CHALLENGES.NO_COMBAT_ARTS=new sc.ArenaChallengePlayerBase("SPECIAL",6);sc.ARENA_CHALLENGES.NO_HP_REGEN=new sc.ArenaChallengeBase(9);sc.ARENA_CHALLENGES.NO_ITEMS=new sc.ArenaChallengeBase(7,function(){sc.quickmodel.setItemBlock(this.state)});
sc.ARENA_CHALLENGES.LEA_MUST_DIE=new sc.ArenaChallengeBase(8);sc.ARENA_CHALLENGES.ENVIRO_HAZARD=new sc.ArenaChallengeBase(10);sc.ARENA_CHALLENGES.PVP_BATTLE=new sc.ArenaChallengeBase(12);sc.ARENA_CHALLENGES.WEAPON_ADJUST=new sc.ArenaChallengeBase(13)});ig.baked=!0;
ig.module("game.feature.arena.arena-cheer").requires("impact.base.game","impact.base.sound").defines(function(){var b={APPLAUSE:{sounds:[{sound:"media/sound/arena/applause-short-01.ogg",volume:0.6},{sound:"media/sound/arena/applause-short-02.ogg",volume:0.6},{sound:"media/sound/arena/applause-short-03.ogg",volume:0.6}],maxVariance:0.15,cooldown:1,cooldownVariance:1},SURPRISED:{sounds:[{sound:"media/sound/arena/crowd-ouh-01.ogg",volume:0.6},{sound:"media/sound/arena/crowd-ouh-02.ogg",volume:0.6},{sound:"media/sound/arena/crowd-ouh-03.ogg",
volume:0.6}],maxVariance:0.15,cooldown:1,cooldownVariance:1}};sc.ArenaCrowdCheerController=ig.Class.extend({soundPool:{},update:function(){for(var a in this.soundPool){var b=this.soundPool[a];if(b.timer>0)b.timer=b.timer-ig.system.tick}},play:function(a){if(a=="RANDOM"){a=Object.keys(b);a=a[Math.floor(Math.random()*a.length)]}if(this.soundPool[a]){var d=this.soundPool[a];if(d.timer<=0){d.sounds[Math.floor(Math.random()*d.sounds.length)].play();d.timer=b[a].cooldown+Math.random()*b[a].cooldownVariance}}},
resetTimers:function(){for(var a in this.soundPool)this.soundPool[a].timer=0},loadCache:function(){for(var a in b){this.soundPool[a]={sounds:[],timer:0};for(var d=b[a].sounds,c=0;c<d.length;c++)this.soundPool[a].sounds.push(new ig.Sound(d[c].sound,d[c].volume,d[c].variance||b[a].maxVariance))}},clearCache:function(){for(var a in this.soundPool)for(var b=this.soundPool[a].sounds,c=b.length;c--;)b[c].clearCached();this.soundPool={}}})});ig.baked=!0;
ig.module("game.feature.arena.arena").requires("impact.base.game","impact.feature.storage.storage","game.feature.model.base-model","game.feature.arena.entities.arena-spawn","game.feature.arena.arena-loadable","game.feature.combat.combat","game.feature.arena.arena-bonus-objectives","game.feature.arena.arena-score-types","game.feature.arena.arena-challenges","game.feature.arena.arena-cheer").defines(function(){var b={"rookie-cup":{order:100},"seeker-cup":{order:200},"boss-cup":{order:1E3},"faction-cup-1":{order:2E3},
"faction-cup-2":{order:2100},"rookie-team-cup":{order:101},"faction-team-cup-1":{order:200}},a={"console-cup-1":{order:100}},d=[0.2,0.3,0.5];sc.ARENA_MEDALS_TROPHIES={BRONZE:1,SILVER:2,GOLD:3,PLATIN:4,TRUE_PLATIN:5};sc.ARENA_BASE_TYPE={SOLO_CUP:"SOLO_CUP",TEAM_CUP:"TEAM_CUP",SOLO_CUSTOM:"SOLO_CUSTOM",TEAM_CUSTOM:"TEAM_CUSTOM"};sc.ARENA_ROUND_MODE={DEFAULT:"DEFAULT"};sc.ARENA_CHAIN_MAX_TIME=10;sc.ARENA_SORT_TYPES={ORDER:0};sc.ARENA_SILVER_MEDAL_QUOTA=0.7;sc.ARENA_RUSH_COIN_QUOTA=0.5;sc.ARENA_TROPHY_QUOTA=
0.75;sc.ARENA_EVENT={};sc.ARENA_MAX_CHAIN_HITS=2;sc.ARENA_MAX_CHAIN_MULTIPLIER=999;var c=null,e=Vec3.createC(0,0,0),f={value:0};sc.ARENA_PAUSE_ACTIONS={NONE:0,RESTART:1,LOBBY:2};ig.perf.grantArenaBonus=false;ig.perf.enableArenaRound=window.IG_GAME_DEBUG;sc.Arena=ig.GameAddon.extend({active:false,arenaCache:null,runtime:null,coins:0,coinsSpend:0,cups:{},observers:[],partyStash:[],pauseOverlay:null,sounds:null,effects:new ig.EffectSheet("arena"),_pauseBlock:false,_endRoundEnd:false,_exitCup:false,_pauseAction:0,
_isFinalHit:false,_partySettingBehaviour:null,_hasCustomCups:false,init:function(){this.parent("Arena");for(var c in b)this.registerCup(c,b[c]);for(c in a)this.registerCup(c,a[c]);this.sounds=new sc.ArenaCrowdCheerController;ig.storage.register(this);ig.vars.registerVarAccessor("arena",this,"VarArenaEditor");ig.extensions.addListener(this,"arena");sc.Model.addObserver(sc.model,this)},postUpdateOrder:700,onPostUpdate:function(){if(!ig.loading&&!ig.game.paused&&this.active){ig.game.firstUpdateLoop&&
sc.stats.addMap("arena","time",ig.system.tick);var a=this.runtime;if(a.killTimer>0)a.killTimer=a.killTimer-ig.system.tick;if(!a.roundFinished&&a.roundStarted&&a.chainTimer>0&&!sc.model.isCutscene()){a.chainTimer=a.chainTimer-ig.system.tick;!a.chainGui.pulsing&&a.chainTimer/sc.ARENA_CHAIN_MAX_TIME<=0.5&&a.chainGui.setPulse(true);if(a.chainTimer<=0){a.chain=0;a.rushChain=0;a.chainGui.setChainNumber(0)}}this.sounds.update()}},onReset:function(){this.clearProgress();this._cleaRuntimeCache(true);if(this.arenaCache){this.arenaCache.decreaseRef();
this.arenaCache=null}this.sounds.resetTimers();sc.combat.setCombatSpeed(1);this.runtime=null;this.active=false;this.coinsSpend=this.coins=this.partyStash.length=0;this._hasCustomCups=this._endRoundDone=this._pauseBlock=false;this._pauseAction=0;sc.combat.removeCombatListener(this)},levelLoadStartOrder:1,onLevelLoadStart:function(){if(this.active){var a=this.runtime;this.resetRuntimeRoundStats();var b=this.getCurrentRound(),c=this.getCupCore(a.cup,"music");if(!a.defaultBgmTrack)a.defaultBgmTrack=ig.bgm.loadTrack(a.rush?
c.rushMusic||"challenge":c.music||"challenge");this.addChallengeMods();(!a.rush||a.currentRound==0)&&sc.model.player.params.removeAllBuffs();sc.party.reviveAllPartyMemberModels();if(!this.pauseOverlay){this.pauseOverlay=new sc.ArenaChallengeOverlay;ig.gui.addGuiElement(this.pauseOverlay)}this.pauseOverlay.setChallengeMods(a.challengeMods);if(!this.isCurrentRoundCustom()){if(b.music){a.bgmTrack&&ig.warn("Unclear bgm track found: "+a.bgmTrack.name);a.bgmTrack=ig.bgm.loadTrack(b.music||"lolfanfare")}b=
b.waves;c=b.length;a.enemyInfo&&ig.warn("enemyInfo cache might not be cleared!");for(var d=[];c--;){d[c]=[];for(var e=b[c].enemies,f=e.length;f--;)d[c][f]=new sc.EnemyInfo(e[f])}a.enemyInfo=d}}},levelLoadedOrder:200,onLevelLoaded:function(){if(this.active&&!this.isCurrentRoundCustom()){this.runtime.roundStartedPre=true;sc.commonEvents.startCallEvent("arena-start-round")}},onVarsChanged:function(){if(this.active){var a=this.runtime;if(a.playerDeath<2&&a.roundStarted&&ig.vars.get("tmp.playerDeathArena")){a.playerDeath=
2;sc.commonEvents.startCallEvent("arena-player-death")}}},onPvpRoundFinished:function(a){a==sc.COMBATANT_PARTY.PLAYER?this.addScore("PVP_ROUND_WON"):this.addScore("PVP_ROUND_LOST")},onPreDamageModification:function(a,b){if(this.active&&!(this.runtime.roundEndPre||this._pauseAction>0))if(b==sc.SHIELD_RESULT.PERFECT)this.addScore("PERFECT_SHIELD");else if(a&&a.damage>0){var c=this.runtime;c.chainHits--;if(c.chainHits<=0){c.chain=0;c.rushChain=0;c.chainGui.setChainNumber(0)}else c.chain>=2&&c.chainGui.rumble();
c.chainHits/sc.ARENA_MAX_CHAIN_HITS<=0.5&&c.chainGui.setPulse(true);var d=sc.model.player.params;if(this.hasChallenge("LEA_MUST_DIE"))a.damage=d.currentHp;if(d.currentHp-a.damage<=0&&c.playerDeath<1)if(d.currentHp>0&&d.getModifier("ONCE_MORE"))this.addScore("DAMAGE_TAKEN",-a.damage);else{if(!sc.pvp.isActive()){c.playerDeath=1;c.chain=0;c.rushChain=0;c.rushChainMax=0;c.chainGui.setChainNumber(0);this._pauseBlock=true;this._endRoundDone=false;ig.bgm.pause("IMMEDIATELY");sc.stats.addMap("arena","deaths",
1);sc.commonEvents.startCallEvent("arena-player-death-pre")}}else ig.perf.grantArenaBonus||this.addScore("DAMAGE_TAKEN",-a.damage)}},onTargetHit:function(a,b,c,d){if(this.active){b.status>0&&a.element>0&&d.params.statusStates[a.element-1].active&&this.addScore("STATUS_INFLICT");this.refreshChainTimer(true)}},onPreDamageApply:function(a,b,c,d,e){if(this.active&&!(c==sc.SHIELD_RESULT.PERFECT||d.getCombatantRoot().party!=sc.COMBATANT_PARTY.PLAYER||this.isEnemyBlocked(a))){c=1;if(d.params.buffs.length>
0)for(var d=d.params.buffs,f=0,g=d.length;f<g;f++)if(d[f]instanceof sc.ActionBuff&&d[f].name=="sergeyHax"){c=e.attackerParams.getStat("attack",true)/e.attackerParams.getStat("attack",false);break}a=Math.min(Math.max(0,a.params.currentHp),Math.floor(b.damage*c));if(a>0){this.addScore("DAMAGE_DONE",a);b=Math.floor(a-a/b.defensiveFactor);if(b>0){sc.stats.addMap("arena","effectiveDamage",b);this.addScore("DAMAGE_DONE_EFFECTIVE",b)}}}},onPreInstantDamage:function(a,b){if(this.active&&!(a.party!=sc.COMBATANT_PARTY.ENEMY||
a.getCombatantRoot().party==sc.COMBATANT_PARTY.PLAYER||this.isEnemyBlocked(a))){b=Math.min(Math.max(0,a.params.currentHp),b);b>0&&this.addScore("DAMAGE_DONE",b)}},onLockEnd:function(a,b,c,d){if(this.active&&!this.isEnemyBlocked(a)&&a.params&&a.params.isDefeated()){d==2?this.addScore("LOCK_FINISH"):d==3&&this.addScore("LOCK_FINISH_3");this.sounds.play("SURPRISED")}},onElementOverload:function(){this.addScore("ELEMENT_OVERLOAD")},onPerfectDodge:function(){this.addScore("PERFECT_DODGE")},onGuardCounter:function(a){if(this.active&&
!this.isEnemyBlocked(a)){a.getCombatStat("guardCounters",0)<=0&&this.addScore("GUARD_COUNTER");this.sounds.play("SURPRISED")}},onEnemyBreak:function(a){if(this.active&&!this.isEnemyBlocked(a)){a.getCombatStat("breaks",0)<=0&&this.addScore("ENEMY_BREAK");this.sounds.play("SURPRISED")}},onHitKill:function(a){this.isEnemyBlocked(a)||this.addScore("ONE_HIT_KILL")},onCombatantHeal:function(a,b){if(this.active&&!a.getCombatantRoot().isPlayer&&!(a.party!=sc.COMBATANT_PARTY.ENEMY||this.isEnemyBlocked(a))){var c=
a.params.currentHp,d=a.params.getStat("hp");c+b>d&&(b=d-c);b>0&&this.addScore("ENEMY_HEAL",-b)}},onCombatantDeathHit:function(a,b){if(this.active&&!this.runtime.playerDeath&&!(this.runtime.roundEndPre||this._pauseAction>0)){sc.stats.addMap("arena","kills",1);var c=this.runtime;if(!this.isEnemyBlocked(b)){this.increaseChain();b.enemyType&&b.enemyType.boss?this.addScore("BOSS_KILL"):this.addScore("KILL");c.killTimer>0&&this.addScore("MULTI_KILL");c.killTimer=0.3}this.sounds.play("APPLAUSE");if(!c.customRound){this.isEnemyBlocked(b)||
c.roundKills++;if(c.roundKills>=c.waveKillsNeeded){var d=this.getCurrentRound();if(c.currentWave==d.waves.length-1){c.rush?c.currentRound==c.rounds.length-1&&ig.bgm.pause("IMMEDIATELY"):ig.bgm.pause("IMMEDIATELY");c.roundEndPre=true;sc.commonEvents.startCallEvent("arena-end-round")}else sc.commonEvents.startCallEvent("arena-next-wave")}}}},onEnvironmentKill:function(a){this.active&&!(a.party!=sc.COMBATANT_PARTY.ENEMY||this.isEnemyBlocked(a))&&this.addScore("ENVIRONMENT_KILL")},onFinalDeathHit:function(){var a=
this.runtime;if(this.active&&(!a.playerDeath&&!(a.roundEndPre||this._pauseAction>0))&&a.customRound){this._isFinalHit=true;a.roundEndPre=true;ig.game.varsChangedDeferred()}},spawnCurrentWave:function(a,b,c){if(this.active&&!this.runtime.playerDeath&&!(this.runtime.roundEndPre||this._pauseAction>0)){var d=this.getCurrentRound(),e=d.waves,f=this.runtime;if(b)f.currentWave=Math.min(f.currentWave+1,e.length-1);e=e[f.currentWave];sc.combat.setCombatSpeed(e.speed?e.speed||1:d.speed||1);f.waveKillsNeeded=
f.waveKillsNeeded+e.enemies.length;for(var g=e.enemies,b=g.length;b--;)this._spawnEnemy(b,g[b],this._getLevelToSpawn(g[b],e,d,this.getCupCore(f.cup)),a);if(c){a=ig.game.entities;for(b=a.length;b--;){c=a[b];c instanceof ig.ENTITY.Enemy&&c.setTarget(ig.game.playerEntity,true)}}ig.game.varsChangedDeferred()}},startRound:function(){var a=this.runtime,b=this.getCurrentRound();a.scoreStats={};this.addGui();sc.timers.timers.arenaTimer?sc.timers.resumeTimer("arenaTimer"):sc.timers.addTimer("arenaTimer",sc.TIMER_TYPES.COUNTER,
null,null,null,true,true,null,ig.lang.get("sc.gui.arena.time"),true);if(!sc.pvp.isActive())ig.game.playerEntity.manualKill="tmp.playerDeathArena";sc.timers.addTimer("arenaTimerReal",sc.TIMER_TYPES.COUNTER,null,null,null,false,true);a.customRound=b.customCode||false;a.roundKills=0;a.score=0;a.roundFinished=false;a.roundStarted=true;a.chainHits=sc.ARENA_MAX_CHAIN_HITS;a.prevScoreType=null;a.killTimer=0;a.chain=0;a.chainGui.setChainNumber(0,true);a.prevMedal=this.getCupMedal(a.cup,a.currentRound);if(!a.rush||
a.rush&&a.currentRound==0){f.value=1;ig.game.playerEntity.heal(f,true);sc.model.player.setElementMode(0,true,true);sc.party.reviveAllPartyMembers()}else{f.value=0.5;ig.game.playerEntity.heal(f,false)}sc.model.player.params.resetSp();for(var c in a.challengeMods){ig.debug("CHALLENGE ON: "+c);sc.ARENA_CHALLENGES[c].toggle(true)}this.addBonusObjectives();sc.model.setTask(this.getCurrentObjective(),false,0);if(!b.customCode){a.rush&&a.currentRound==0?ig.bgm.play(a.bgmTrack||a.defaultBgmTrack,1,"IMMEDIATELY"):
a.rush||ig.bgm.play(a.bgmTrack||a.defaultBgmTrack,1,"IMMEDIATELY");a=ig.game.entities;for(b=a.length;b--;){c=a[b];c instanceof ig.ENTITY.Enemy&&c.setTarget(ig.game.playerEntity,true)}}},endRound:function(){ig.system.skipMode=false;var a=this.runtime;this._pauseBlock=true;this._endRoundDone=false;sc.timers.stopTimer("arenaTimer");sc.timers.stopTimer("arenaTimerReal");a.timer=sc.timers.timers.arenaTimerReal?sc.timers.getPassedTime("arenaTimerReal"):0;a.scoreGui&&a.scoreGui.remove();ig.gui.freeEventGui(a.scoreGui);
a.scoreGui=null;a.roundStarted=false;a.roundFinished=true;a.chainGui.pulsing&&a.chainGui.setPulse(false);a=new sc.ArenaRoundEndOverlay;ig.gui.addGuiElement(a);a.show()},endRoundDeath:function(){ig.system.skipMode=false;var a=this.runtime;this._pauseBlock=true;this._endRoundDone=false;sc.timers.stopTimer("arenaTimer");sc.timers.stopTimer("arenaTimerReal");a.timer=0;a.chainGui.pulsing&&a.chainGui.setPulse(false);a=new sc.ArenaPlayerDeathOverlay;ig.gui.addGuiElement(a);a.show()},stopTimers:function(){sc.timers.stopTimer("arenaTimer");
sc.timers.stopTimer("arenaTimerReal")},resumeTimers:function(){sc.timers.resumeTimer("arenaTimer");sc.timers.resumeTimer("arenaTimerReal")},startNextRound:function(a){var b=this.runtime;this._cleaRuntimeCache(false);sc.model.setTask(null,false);if(b.scoreGui){b.scoreGui.remove();ig.gui.freeEventGui(b.scoreGui);b.scoreGui=null}b.chainGui&&b.chainGui.setChainNumber(0);sc.timers.removeTimer("arenaTimerReal");b.rush||sc.timers.removeTimer("arenaTimer");a&&b.currentRound++;this._endRoundDone=true},restartCup:function(){var a=
this.runtime;a.currentRound=0;a.rushChain=0;a.rushChainMax=0;if(a.rush)for(var a=a.rushScores,b=a.length;b--;){a[b].points=0;a[b].medal=0;a[b].time=0}sc.timers.removeTimer("arenaTimer");this.startNextRound(false)},prepareLobbyReturn:function(){var a=this.runtime;a.chainGui&&a.chainGui.setChainNumber(0);if(a.scoreGui){a.scoreGui.remove();ig.gui.freeEventGui(a.scoreGui);a.scoreGui=null}sc.timers.removeTimer("arenaTimerReal");sc.timers.removeTimer("arenaTimer");this._endRoundDone=true},teleportToCurrentRound:function(){var a=
this.runtime.rounds[this.runtime.currentRound];ig.game.teleport(a.map,a.spawn?new ig.TeleportPosition(a.spawn):null)},resetRuntimeRoundStats:function(){var a=this.runtime;sc.stats.setMap("arena","effectiveDamage",0);this.sounds.resetTimers();this._validateCoins();a.playerDeath=0;this._pauseBlock=this._isFinalHit=false;this._pauseAction=0;this._endRoundDone=false;a.challengeMods={};a.bonusObjectives.length=0;a.roundEndPre=false;a.roundKills=0;a.roundStarted=false;a.roundStartedPre=false;a.roundFinished=
false;a.currentWave=0;a.waveKillsNeeded=0;a.scoreStats={};a.enemyIgnore={};a.scoreIgnore={};a.prevScoreType=null},addChallengeMods:function(){var a=this.runtime;a.challengeMods=this.getChallengeMods(a.cup,a.currentRound)},addBonusObjectives:function(){var a=this.runtime,b=this.getCurrentRound();a.bonusObjectives.length=0;for(var b=b.bonuses,c=b.length;c--;){var d={},e=b[c];sc.ARENA_BONUS_OBJECTIVE[e.type].init(e,d);a.bonusObjectives.push({type:e.type,points:e.points,data:d})}for(var f in sc.ARENA_DEFAULT_BONUS_OBJECTIVES){d=
{};e=sc.ARENA_DEFAULT_BONUS_OBJECTIVES[f];if(!e.challenge||this.hasChallenge(e.challenge))if(!e.ignoreOn||!this.hasChallenge(e.ignoreOn)){sc.ARENA_BONUS_OBJECTIVE[f].init(e,d);a.bonusObjectives.push({type:f,points:e.points,data:d})}}},addGui:function(){var a=this.runtime;if(a.scoreGui){a.scoreGui.remove();ig.gui.freeEventGui(a.scoreGui)}var b=ig.gui.createEventGui("score","ScoreHud",{taskTitle:ig.lang.get("sc.gui.arena.score"),maxValue:999999999,time:0.2,useDots:true,variable:"arena.score",cutsceneOkay:true});
ig.gui.spawnEventGui(b);a.scoreGui=b;if(a.chainGui)a.chainGui.setPos(0,22);else{b=new sc.ArenaChainHud;ig.gui.addGuiElement(b);a.chainGui=b}ig.game.varsChangedDeferred()},addScore:function(a,b){if(this.active&&sc.ARENA_SCORE_TYPES[a]&&!this.runtime.scoreIgnore[a]){var c=sc.ARENA_SCORE_TYPES[a],d=0,e=this.runtime,f=e.scoreStats;f[a]||(f[a]={count:0,value:0,repeated:1,"static":c["static"]});if(f[a].static){d=1;c.staticMultiplier&&!this.hasChallenge("PVP_BATTLE")&&(d=c.staticMultiplier);d=Math.floor(b*
d)}else{var g=c.chain||false,n=c.dimReturns||false,d=c.points||0;g&&(d=d*this.getChainMultiplier());if(e.prevScoreType==a)f[a].repeated++;else if(e.prevScoreType)f[e.prevScoreType].repeated=1;n&&(d=d/f[a].repeated);f[a].count++;d=Math.floor(d)}e.score=e.score+d;if(e.score<0)e.score=0;f[a].value=f[a].value+d;e.prevScoreType=a;ig.game.varsChangedDeferred()}},addScoreIgnore:function(a){this.active&&sc.ARENA_SCORE_TYPES[a]&&(this.runtime.scoreIgnore[a]=true)},removeScoreIgnore:function(a){this.active&&
sc.ARENA_SCORE_TYPES[a]&&this.runtime.scoreIgnore[a]&&delete this.runtime.scoreIgnore[a]},clearScoreIgnore:function(){if(this.active)this.runtime.scoreIgnore={}},increaseChain:function(a){var a=a||1,b=this.runtime;b.chainHits=sc.ARENA_MAX_CHAIN_HITS;b.chain=b.chain+a;b.rushChain=b.rushChain+a;b.rushChainMax=Math.max(b.rushChain,b.rushChainMax);b.chain<0?this.resetChain():this.refreshChainTimer()},refreshChainTimer:function(a){var b=sc.arena.runtime;b.chainTimer=sc.ARENA_CHAIN_MAX_TIME;b.chainHits=
sc.ARENA_MAX_CHAIN_HITS;b.chainGui.pulsing&&b.chainGui.setPulse(false);a||b.chainGui&&b.chainGui.setChainNumber(b.chain)},resetChain:function(){var a=this.runtime;a.chainHits=sc.ARENA_MAX_CHAIN_HITS;a.chain=0;a.rushChain=0;a.chainGui.setChainNumber(0);a.chainTimer=sc.ARENA_CHAIN_MAX_TIME},getChainMultiplier:function(){return Math.min(sc.ARENA_MAX_CHAIN_MULTIPLIER,Math.max(1,1+(this.runtime.chain-1)))},enterArenaMode:function(a,b){this.active=true;sc.model.setMobilityBlock("CHECKPOINT");sc.model.player.setCore(sc.PLAYER_CORE.CREDITS,
false);sc.model.player.setCore(sc.PLAYER_CORE.EXP,false);sc.model.player.setCore(sc.PLAYER_CORE.ITEMS,false);this.arenaCache=new sc.ArenaCache;this.runtime={scoreIgnore:{},enemyIgnore:{},defaultBgmTrack:null,bgmTrack:null,scoreGui:null,chainGui:null,score:0,prevScore:0,timer:0,cup:a,prevMedal:0,customRound:false,preTrophy:this.getCupTrophy(a),chain:0,rushChain:0,rushChainMax:0,chainHits:sc.ARENA_MAX_CHAIN_HITS,chainTimer:0,type:this.getCupCoreAttrib(a,"type"),roundKills:0,currentWave:0,waveKillsNeeded:0,
playerDeath:0,rush:b==-1,roundStarted:false,roundStartedPre:false,scoreStats:{},prevScoreType:null,roundEndPre:false,bonusObjectives:[],challengeMods:{},currentRound:b==-1?0:b,enemyInfo:null,rounds:this.getCupRounds(a)};if(this.runtime.rush){var c=this.runtime;c.rushScores=[];for(var d=c.rounds,e=0;e<d.length;e++)c.rushScores.push({points:0,medal:0,time:0})}this._partySettingBehaviour=sc.party.strategyKeys.BEHAVIOUR;!this.isCupSolo(this.runtime.cup)&&this._partySettingBehaviour=="DO_NOTHING"&&sc.party.updatePartyStrategy("BEHAVIOUR",
"OFFENSIVE");if(this.hasAscendedChallenge(this.runtime.cup)){sc.inventory.updateScaledEquipment(this.getCupLevel(this.runtime.cup));sc.model.player.updateStats()}},exitArenaMode:function(){this.active=false;sc.combat.setCombatSpeed(1);sc.combat.removeCombatListener(this);if(this.hasAscendedChallenge(this.runtime.cup)){sc.inventory.updateScaledEquipment(sc.model.player.level);sc.model.player.updateStats()}this.arenaCache.decreaseRef();this.arenaCache=null;this._cleaRuntimeCache(true);sc.model.setTask();
sc.timers.removeTimer("arenaTimerReal");sc.timers.removeTimer("arenaTimer");ig.game.playerEntity.manualKill=null;sc.party.updatePartyStrategy("BEHAVIOUR",this._partySettingBehaviour);if(this.pauseOverlay){this.pauseOverlay.remove();this.pauseOverlay=null}var a=this.runtime;a.chainGui&&a.chainGui.doStateTransition("HIDDEN",false,true);if(a.scoreGui){a.scoreGui.remove();ig.gui.freeEventGui(a.scoreGui)}sc.model.player.setCore(sc.PLAYER_CORE.CREDITS,true);sc.model.player.setCore(sc.PLAYER_CORE.EXP,true);
sc.model.player.setCore(sc.PLAYER_CORE.ITEMS,true);sc.model.setMobilityBlock("NONE");this._endRoundDone=this._pauseBlock=false;this.runtime=null;this._exitCup=true;this._isFinalHit=false;this._partySettingBehaviour=null;sc.arena.isCupSolo(a.cup)&&this.unstashPartyMembers();ig.game.teleport("rhombus-sqr.interior.arena-01",new ig.TeleportPosition("CUP_END"))},stashPartyMembers:function(){this.partyStash.length>=1&&ig.warn("Trying to stash party members while other are stashed.");this.partyStash.length=
0;for(var a=sc.party.currentParty,b=0;b<a.length;b++)this.partyStash.push(a[b]);for(a=0;a<this.partyStash.length;a++)sc.party.removePartyMember(this.partyStash[a],null,true)},unstashPartyMembers:function(){if(this.partyStash.length>=1){for(var a=0;a<this.partyStash.length;a++)sc.party.addPartyMember(this.partyStash[a],null,null,true);this.partyStash.length=0}},registerCup:function(a,b,c){this.cups[a]?ig.warn("Cup with id '"+a+"' already exists."):this.cups[a]={path:b.path||a,order:b.order!=void 0?
b.order:9999999,extension:c||false,data:null,progress:null}},loadCache:function(){ig.JSON_LOG&&ig.log("%cLOADABLE: %cLoading Cup Cache: \n%O","color:#149AEB","",this.cups);for(var a in this.cups){var b=this.cups[a];if(b.path){b.data=new sc.CupAsset(a,b.path);b.data.addLoadListener(this)}}this.sounds.loadCache()},clearCache:function(){ig.JSON_LOG&&ig.log("%cLOADABLE: %cClearing Cup Cache: \n%O","color:#149AEB","",this.cups);for(var a in this.cups){var b=this.cups[a];if(b.path&&b.data){b.data.decreaseRef();
b.data=null}}this.sounds.clearCache()},initMetaData:function(a){if(this.cups[a]){this.cups[a].name=this.getCupCoreAttrib(a,"name");this.cups[a].condition=this.getCupCoreAttrib(a,"condition")||null;this.cups[a].noRush=this.getCupCoreAttrib(a,"noRush")||false;var b=this.getCupCoreAttrib(a,"type");if(this.cups[a].extension){b=="SOLO_CUP"&&(this.getCupCore(a).type="SOLO_CUSTOM");b=="TEAM_CUP"&&(this.getCupCore(a).type="TEAM_CUSTOM")}b=this.getCupCoreAttrib(a,"type");if(b=="SOLO_CUSTOM"||b=="TEAM_CUSTOM")this._hasCustomCups=
true;if(this.cups[a].progress){b=this.getCupRounds(a);a=this.cups[a].progress.rounds;if(b.length!=a.length)if(b.length>a.length)for(var c=a.length;c<b.length;c++)a.push({medal:0,points:0,time:0,cleared:0});else a.length=b.length}else this.setEmptyProgress(a)}else throw Error("Cup not found: "+a);},setEmptyProgress:function(a){var b=this.getCupRounds(a);if(!b)this.cups[a].progress=null;for(var c={rush:{medal:0,points:0,time:0,cleared:0,chain:0},rounds:[]},d=0;d<b.length;d++)c.rounds.push({medal:0,
points:0,time:0,cleared:0});this.cups[a].progress=c},setPauseAction:function(a){this._pauseAction=a},saveScore:function(a,b){a<0&&(a=0);var c=this.runtime,d=b?this.cups[c.cup].progress.rush:this.cups[c.cup].progress.rounds[c.currentRound];c.score=a;var e=b?c.preTrophy:this.getCupTrophy(c.cup);c.prevMedal=d.medal;d.cleared++;d.points=Math.max(d.points,a);d.medal=this.getMedalForCurrentRound(d.points,b);d.time=c.timer<=0?0:d.time<=0?c.timer:Math.min(c.timer,d.time);sc.stats.addMap("arena","score",a);
if(d.medal>0){sc.stats.addMap("arena","totalMedals",1);sc.stats.addMap("arena","medals-got-"+d.medal,1)}if(c.rush&&!b){var f=c.rushScores[c.currentRound];f.points=Math.max(a,0);f.medal=this.getMedalForCurrentRound(f.points,b);f.time=Math.max(c.timer,0)}if(b){d.chain=Math.max(d.chain,c.rushChainMax);sc.stats.addMap("arena","rushCleared",1)}else sc.stats.addMap("arena","roundsCleared",1);return this.getCupTrophy(c.cup)>e},saveRushScore:function(){var a=this.runtime;a.timer=sc.timers.getPassedTime("arenaTimer");
for(var b=a.rushScores.length,c=0;b--;)c=c+a.rushScores[b].points;return this.saveScore(c,true)},addEnemyIgnore:function(a){this.active&&a&&(this.runtime.enemyIgnore[a]=true)},removeEnemyIgnore:function(a){this.active&&a&&(this.runtime.enemyIgnore[a]=false)},removeArenaCoins:function(a){this.coinsSpend=this.coinsSpend+a;this.coins=this.coins-a},clearProgress:function(a,b){if(a){if(this.cups[a].progress){if(b!=void 0)return this._clearProgress(a,b);this._clearProgress(a,-1);for(var c=0;c<this.cups[a].progress.rounds.length;c++)this._clearProgress(a,
c)}}else for(var d in this.cups)if(this.cups[d].progress){this._clearProgress(d,-1);for(c=0;c<this.cups[d].progress.rounds.length;c++)this._clearProgress(d,c)}},_getCoinWeightMultiplier:function(a,b){a=Math.min(a,3);b=Math.min(b,3);if(b-a>0){for(var c=0,e=a;e<b;e++)c=c+d[e];return c}return 0},_validateCoins:function(){var a=0,b;for(b in this.cups)this.isCupCustom(b)||(a=a+this.getArenaCoinsObtainedInCup(b));this.coins=a-this.coinsSpend;if(this.coins<0)this.coins=0},_clearProgress:function(a,b){if(this.cups[a].progress){if(b==
-1)this.cups[a].progress.rush={points:0,medal:0,time:0,cleared:0,chain:0};this.cups[a].progress.rounds[b]={points:0,medal:0,time:0,cleared:0}}},_cleaRuntimeCache:function(a){var b=this.runtime;if(b){if(sc.pvp.isActive()){sc.pvp.onReset();sc.model.setCombatMode(false,true)}ig.gui.clearNamedGuiElements();if(a){b.defaultBgmTrack&&b.defaultBgmTrack.clearCached();b.defaultBgmTrack=null}b.bgmTrack&&b.bgmTrack.clearCached();b.bgmTrack=null;if(b.enemyInfo){for(a=b.enemyInfo.length;a--;)for(var c=b.enemyInfo[a].length;c--;)b.enemyInfo[a][c].clearCached();
b.enemyInfo=null}for(var d in b.challengeMods){ig.debug("CHALLENGE OFF: "+d);sc.ARENA_CHALLENGES[d].toggle(false)}}},_spawnEnemy:function(a,b,c,d){var f=ig.game.getEntityByName(b.marker),a=this.runtime.enemyInfo[this.runtime.currentWave][a],f=f.coll,o=a.enemyType,b=b.align,m=e,m=m||Vec3.createC(0,0,0);m.z=f.pos.z;b=b||g;switch(sc.ARENA_ALIGN_X[b.alignX||"CENTER"]){case sc.ARENA_ALIGN_X.LEFT:m.x=f.pos.x;break;case sc.ARENA_ALIGN_X.CENTER:m.x=f.pos.x+f.size.x/2-o.size.x/2;break;case sc.ARENA_ALIGN_X.RIGHT:m.x=
f.pos.x+f.size.x-o.size.x}switch(sc.ARENA_ALIGN_Y[b.alignY||"CENTER"]){case sc.ARENA_ALIGN_Y.TOP:m.y=f.pos.y;break;case sc.ARENA_ALIGN_Y.CENTER:m.y=f.pos.y+f.size.y/2-o.size.y/2;break;case sc.ARENA_ALIGN_Y.BOTTOM:m.y=f.pos.y+f.size.y-o.size.y}m.x=m.x+(b.offset?b.offset.x||0:0);m.y=m.y+(b.offset?b.offset.y||0:0);m.z=m.z+(b.offset?b.offset.z||0:0);a=a.getSettings();a.level=c;ig.game.spawnEntity(ig.ENTITY.Enemy,e.x,e.y,e.z,{enemyInfo:a},!d)},_getLevelToSpawn:function(a,b,c,d){return a.level?ig.Event.getExpressionValue(a.level):
b.level?ig.Event.getExpressionValue(b.level):c.level?ig.Event.getExpressionValue(c.level):d.level?ig.Event.getExpressionValue(d.level):1},onExtensionLoaded:function(a,b){this.registerCup(a.id,a,this.isSafeExtension(b))},isSafeExtension:function(a){return a.path=="post-game"?false:true},modelChanged:function(a,b){this.active&&b==sc.GAME_MODEL_MSG.SUB_STATE_CHANGED&&(sc.model.isPaused()&&this.hasAnyChallenge()?this.pauseOverlay&&this.pauseOverlay.show():this.pauseOverlay&&this.pauseOverlay.hide())},
onLoadableComplete:function(a,b){if(a&&b&&this.cups[b.key]){this.initMetaData(b.key);for(var c=b.data.rounds,d=c.length;d--;){var e=c[d];if(!e.platPoints||e.platPoints<e.points)e.platPoints=(e.points||1E3)*1E3}}},onVarAccess:function(a,b){if(b[0]=="arena"&&b[1]){switch(b[1]){case "currentRound":return this.runtime.currentRound;case "currentWave":return this.runtime.currentWave;case "active":return this.active;case "isCurrentSolo":return this.runtime?this.isCupSolo(this.runtime.cup):false;case "roundCameraTarget":return this.getCurrentRound().camFocus||
"";case "roundFocusTarget":return this.getCurrentRound().roundFocus||"";case "waveCameraTarget":return b[2]&&b[2]=="next"?this.getNextWave().camFocus||"":this.getCurrentWave().camFocus||"";case "objective":return this.getCurrentObjective();case "enemyLevel":return ig.Event.getExpressionValue(this.getCurrentRound().level)||this.getCupLevel(this.runtime.cup)||0;case "roundLevel":return ig.Event.getExpressionValue(this.getCurrentRound().level)||0;case "cupLevel":return this.getCupLevel(this.runtime.cup)||
0;case "isRush":return this.active&&this.runtime.rush;case "finalHit":return this._isFinalHit;case "isLastWave":return this.runtime.currentWave==this.getCurrentRound().waves.length-1;case "isLastRound":return this.isCurrentRoundLast();case "isCustomRound":return this.runtime.customRound;case "isPauseRestart":return this._pauseAction==sc.ARENA_PAUSE_ACTIONS.RESTART;case "isPauseLobby":return this._pauseAction==sc.ARENA_PAUSE_ACTIONS.LOBBY;case "score":return this.runtime?this.runtime.score:0;case "roundStarted":return this.runtime?
this.runtime.roundStarted:false;case "roundFinished":return this.runtime?this.runtime.roundFinished:false;case "cupEnded":return this._exitCup;case "hasCustomCups":return this._hasCustomCups}if(this.cups[b[1]])switch(b[2]){case "name":return this.getCupName(b[1]);case "isSolo":return this.isCupSolo(b[1])}}throw Error("Unsupported var access path: "+a);},clearEndFlag:function(){if(this._exitCup){this._exitCup=false;this._pauseAction=sc.ARENA_PAUSE_ACTIONS.NONE}},getTotalArenaCompletion:function(){var a=
0,c=0,d;for(d in b){a=a+this.getCupCompletion(d);c++}return a/c},getTotalDefaultCups:function(a){if(a){a=Object.keys(b);a.sort(function(a,c){return b[a].order-b[c].order}.bind(this));for(var c={},d=0;d<a.length;d++)c[a[d]]=b[a[d]];return c}return b},getTotalDefaultTrophies:function(a,c){var d=0,e=0,f;for(f in b){var g=this.getCupTrophy(f);if(this.isCupUnlocked(f))if(a==0){d=d+g;e=e+5}else{g>=a&&d++;e++}}return c?e:d},isSideMessagesBlocked:function(){return!this.active?false:this.runtime.roundStartedPre||
this.runtime.roundStarted},isEnemyBlocked:function(a){if(!this.active)return false;if(a)return this.runtime.enemyIgnore[a.enemyName]?true:a.getAttribute("arenaIgnore")!=void 0},getCupCompletion:function(a){var b=this.cups[a];if(b&&b.progress){var c=b.progress,a=1,d=c.rush.medal>=sc.ARENA_MEDALS_TROPHIES.GOLD?1:0;if(b.noRush)d=a=0;if(c){b=c.rounds;for(c=b.length;c--;){b[c].medal>=sc.ARENA_MEDALS_TROPHIES.GOLD&&d++;a++}return d/a}}return 0},getCurrentObjective:function(){var a=this.getCurrentRound();
return a.objective?ig.LangLabel.getText(a.objective):ig.lang.get("sc.gui.arena.menu.objectiveDefault")},getChallengeMods:function(a,b){var c={},d=this.getCupCoreAttrib(a,"mods"),e=0;if(d)for(e=d.length;e--;)c[d[e]]={global:true};if(b>=0)if(d=this.getCupRounds(a)[b||0].mods)for(e=d.length;e--;)c[d[e]]||(c[d[e]]={global:false});return c},isStatusModifierBlocked:function(a){return!this.active?false:this.runtime.challengeMods["NO_"+a]},hasAnyChallenge:function(){for(var a in this.runtime.challengeMods)return true;
return false},hasChallenge:function(a){return!this.active?false:this.runtime.challengeMods[a]},hasAscendedChallenge:function(a){return this.getCupCoreAttrib(a,"mods")},isScoreNewRecord:function(a,b,c){b=b||this.runtime.cup;c=c||this.runtime.currentRound;return!this.cups[b]||!this.cups[b].progress?false:a>(c<0?this.cups[b].progress.rush.points:this.cups[b].progress.rounds[c].points)},isPauseBlocked:function(){return this._pauseBlock},getCurrentWave:function(){return this.runtime.rounds[this.runtime.currentRound].waves[this.runtime.currentWave]},
getNextWave:function(){var a=this.runtime.rounds[this.runtime.currentRound],b=this.runtime.currentWave;return a.waves[b+1]?a.waves[b+1]:null},getCurrentRound:function(){return this.runtime.rounds[this.runtime.currentRound]},isCurrentRoundCustom:function(){return this.runtime.rounds[this.runtime.currentRound].customCode},isCurrentRoundLast:function(){return this.runtime.currentRound==this.runtime.rounds.length-1},isCupSolo:function(a){a=this.getCupCoreAttrib(a,"type");return a=="SOLO_CUP"||a=="SOLO_CUSTOM"},
isCupCustom:function(a){a=this.getCupCoreAttrib(a,"type");return a=="SOLO_CUSTOM"||a=="TEAM_CUSTOM"},getRoundCompletionTotal:function(a,b){return this.cups[a]?b==-1?this.cups[a].progress.rush.cleared:this.cups[a].progress.rounds[b].cleared:0},getRoundMedalRequirement:function(a,b,c,d){if(a=this.getCupRounds(a)){if(b==-1){for(var b=a.length,e=0;b--;)e=e+(d?a[b].platPoints?a[b].platPoints:a[b].points*1E3:a[b].points);return Math.round(e*(c?sc.ARENA_SILVER_MEDAL_QUOTA:1))}return Math.round(a[b][d?"platPoints":
"points"]*(c?sc.ARENA_SILVER_MEDAL_QUOTA:1))}return 0},getMedalForCurrentRound:function(a,b){var c=this.runtime;if(b){if(a>=this.getRoundMedalRequirement(c.cup,-1,false,true))return sc.ARENA_MEDALS_TROPHIES.PLATIN;if(a>=this.getRoundMedalRequirement(c.cup,-1,false,false))return sc.ARENA_MEDALS_TROPHIES.GOLD;if(a>=this.getRoundMedalRequirement(c.cup,-1,true,false))return sc.ARENA_MEDALS_TROPHIES.SILVER}else{c=c.rounds[c.currentRound];if(c.platPoints&&a>=c.platPoints)return sc.ARENA_MEDALS_TROPHIES.PLATIN;
if(a>=c.points)return sc.ARENA_MEDALS_TROPHIES.GOLD;if(a>=~~(c.points*sc.ARENA_SILVER_MEDAL_QUOTA))return sc.ARENA_MEDALS_TROPHIES.SILVER}return sc.ARENA_MEDALS_TROPHIES.BRONZE},getTotalArenaCoins:function(){return this.coins},getArenaCoinsObtainedInCup:function(a){if(this.cups[a]&&this.cups[a].progress){var b,c=this.cups[a].progress;b=0+this.getArenaCoinsObtainedInRound(a,-1);for(c=c.rounds.length;c--;)b=b+this.getArenaCoinsObtainedInRound(a,c);return b}},getArenaCoinsObtainedInRound:function(a,
b,c){if(this.cups[a]&&this.cups[a].progress){var d=this.cups[a].progress;return b==-1?this.getAvailableArenaCoinsInRound(a,b)*this._getCoinWeightMultiplier(c||0,d.rush.medal):this.getAvailableArenaCoinsInRound(a,b)*this._getCoinWeightMultiplier(c||0,d.rounds[b].medal)}},getAvailableArenaCoinsInCup:function(a,b){var c=this.getCupRounds(a);if(c){for(var d=c.length,e=0;d--;)e=e+(c[d].coins||0);b||(e=e+~~(e*sc.ARENA_RUSH_COIN_QUOTA));return e}return 0},getAvailableArenaCoinsInRound:function(a,b){if(b==
-1)return~~(this.getAvailableArenaCoinsInCup(a,true)*sc.ARENA_RUSH_COIN_QUOTA);var c=this.getCupRounds(a);return c?c[b].coins||0:0},getTotalPoints:function(a,b){if(this.cups[a]&&this.cups[a].progress){for(var c=0,d=this.cups[a].progress.rounds,e=d.length;e--;)c=c+d[e].points;b&&(c=c+this.cups[a].progress.rush.points);return c}return-1},getRoundPoints:function(a,b){if(this.cups[a]&&this.cups[a].progress){if(b==-1)return this.cups[a].progress.rush.points;if(this.cups[a].progress.rounds[b])return this.cups[a].progress.rounds[b].points}return 0},
getTotalTime:function(a){if(this.cups[a]&&this.cups[a].progress){for(var b=0,a=this.cups[a].progress.rounds,c=a.length;c--;)b=b+a[c].time;return b}return-1},getRoundTime:function(a,b){if(this.cups[a]&&this.cups[a].progress){if(b==-1)return this.cups[a].progress.rush.time;if(this.cups[a].progress.rounds[b])return this.cups[a].progress.rounds[b].time}return-1},hasMedalsForTrophy:function(a){if(this.cups[a]&&this.cups[a].progress){for(var a=this.cups[a].progress,b=a.rounds.length;b--;)if(a.rounds[b].medal<=
0)return false;return true}return false},getCupTrophy:function(a){if(this.cups[a]){if(!this.hasMedalsForTrophy(a))return 0;for(var b=this.cups[a].progress,a=this.cups[a].noRush||false,c=0,d=b.rounds.length;d--;)c=c+b.rounds[d].medal;c=c/b.rounds.length;d=~~c;c=c>d?c-d>=sc.ARENA_TROPHY_QUOTA?Math.round(c):d:d;if(c>=4&&(a||b.rush.medal==4)){sc.stats.setMap("arena","unlockedTruePlatin",1);return 5}return d}return-1},getCupMedal:function(a,b){if(this.cups[a]){if(b<=-1)return this.cups[a].progress.rush.medal;
if(this.cups[a].progress.rounds[b])return this.cups[a].progress.rounds[b].medal}return-1},getCupLevel:function(a){return(a=this.getCupCore(a))?ig.Event.getExpressionValue(a.level):-1},getRoundsCleared:function(a){for(var b=this.getCupRounds(a),a=this.cups[a].progress.rounds,b=b.length,c=0;b--;)a[b]&&a[b].cleared>=1&&c++;return c},isCupUnlocked:function(a){if(a=this.cups[a]){c||(c=new ig.VarCondition);if(a.condition){c.setCondition(a.condition);return c.evaluate()}return true}return false},getCupName:function(a){if(this.cups[a]&&
this.cups[a].name)return ig.LangLabel.getText(this.cups[a].name);var b=this.getCupCore(a);return b?ig.LangLabel.getText(b.name):"\\c[1]~"+a+"\\c[0]"},getCupDescription:function(a){var b=this.getCupCore(a);return b?ig.LangLabel.getText(b.info):"\\c[1]~"+a+"\\c[0]"},getCupDifficultyIcon:function(a){var b=this.getCupCore(a);return b?"\\i[diff-"+parseInt(b.difficulty).limit(1,6)+"]":"\\c[1]~"+a+"\\c[0]"},getCupProgress:function(a){return this.cups[a]?this.cups[a].progress:null},getCupCore:function(a){return(a=
this.getCupData(a))?a.core:null},getCupCoreAttrib:function(a,b){var c=this.getCupData(a);return c?c.core[b]:null},getCupRounds:function(a){return(a=this.getCupData(a))?a.rounds:null},getCupData:function(a){return this.cups[a]&&this.cups[a].data?this.cups[a].data.data:null},getSortedCupList:function(a,b){var c=[],d;for(d in this.cups){var e=this.cups[d];e.data&&e.data.data.core.type==a&&c.push(d)}if(b!=void 0)switch(b){case sc.ARENA_SORT_TYPES.ORDER:c.sort(function(a,b){return(this.cups[a].order||
0)-(this.cups[b].order||0)}.bind(this))}return c},onStorageSave:function(a){var b={cupData:{}},c;for(c in this.cups)if(this.cups[c]&&this.cups[c].progress){for(var d=this.cups[c].progress,e={rush:{medal:d.rush.medal,points:d.rush.points,time:d.rush.time,cleared:d.rush.cleared,chain:d.rush.chain},rounds:[]},f=0;f<d.rounds.length;f++)e.rounds.push({medal:d.rounds[f].medal,points:d.rounds[f].points,time:d.rounds[f].time,cleared:d.rounds[f].cleared});b.cupData[c]=e;b.cupData[c].name=ig.copy(this.cups[c].name);
b.cupData[c].noRush=this.cups[c].noRush||false;b.cupData[c].condition=ig.copy(this.cups[c].condition)}else b.cupData[c]={};b.coins=this.coins||0;b.coinsSpend=this.coinsSpend||0;a.arena=b},onStoragePreLoad:function(a){this.clearProgress();if(a.arena){var b=a.arena.cupData,c;for(c in b){if(this.cups[c]){var d=b[c];if(d&&d.rush&&d.rounds){for(var e={rush:{medal:d.rush.medal||0,points:d.rush.points||0,time:d.rush.time||0,cleared:d.rush.cleared||0,chain:d.rush.chain||0},rounds:[]},f=0;f<d.rounds.length;f++)e.rounds.push({medal:d.rounds[f].medal||
0,points:d.rounds[f].points||0,time:d.rounds[f].time||0,cleared:d.rounds[f].cleared||0});this.cups[c].progress=e;this.cups[c].name=d.name||null;this.cups[c].condition=d.condition||null;this.cups[c].noRush=d.noRush||null}}d=this.getCupCoreAttrib(c,"type");e=this.getCupCoreAttrib(c,"extension");if(!e||ig.extensions.hasExtension(e))if(d=="SOLO_CUSTOM"||d=="TEAM_CUSTOM")this._hasCustomCups=true}this.coins=a.arena.coins||0;this.coinsSpend=a.arena.coinsSpend||0}},onNewGameApply:function(a){this.onStoragePreLoad(a);
this.coinsSpend=0}});ig.addGameAddon(function(){return sc.arena=new sc.Arena});var g={alignX:"CENTER",alignY:"CENTER"}});ig.baked=!0;
ig.module("game.feature.arena.gui.arena-effect-display").requires("impact.feature.gui.gui").defines(function(){sc.ArenaMedalEffect=ig.GuiElementBase.extend({gfx:new ig.Image("media/gui/circuit.png"),transitions:{DEFAULT:{state:{},time:0.2,timeFunction:KEY_SPLINES.LINEAR},HIDDEN:{state:{alpha:0},time:0.2,timeFunction:KEY_SPLINES.LINEAR}},medal:0,isTrophy:false,display:null,container:null,effectDone:false,init:function(){this.parent();this.setSize(128,128);this.setPivot(64,64);this.hook.invisibleUpdate=
true;this.container=new ig.GuiElementBase;this.container.hook.invisibleUpdate=true;this.container.hook.clip=true;this.container.setSize(128,128);this.container.setPos(0,0);this.addChildGui(this.container)},show:function(b,a){this.medal=b||false;this.isTrophy=a||false;this.display&&this.display.remove(true);this.display=new sc.NPCDisplayGui("misc.menu-effect-large",true,null,this.onLoaded.bind(this),true);this.container.addChildGui(this.display)},hide:function(b){b&&this.display.clearEffects();this.display&&
this.display.remove(true);this.doStateTransition("HIDDEN",true,true)},getMedalEffectName:function(b,a){if(a)switch(b){case 1:return"bronze-trophy";case 2:return"silver-trophy";case 3:return"gold-trophy";case 4:return"platin-trophy";case 5:return"true-platin-trophy"}else switch(b){case 1:return"bronze";case 2:return"silver";case 3:return"gold";case 4:return"platin"}return"test1"},onLoaded:function(b){if(b.npc){b.setPos(this.container.hook.size.x/2-b.hook.size.x/2,this.container.hook.size.y/2-b.hook.size.y/
2);b.playEffect("arena",this.getMedalEffectName(this.medal,this.isTrophy),{callback:this,align:ig.ENTITY_ALIGN.CENTER,offset:{x:0,y:0},duration:-1})}},onEffectEvent:function(b){if(b.state==ig.EFFECT_STATE.ENDED)this.effectDone=true}})});ig.baked=!0;
ig.module("game.feature.arena.gui.arena-round-gui").requires("impact.feature.rumble.rumble","impact.feature.gui.gui","impact.feature.gui.base.basic-gui","impact.feature.gui.base.box","game.feature.gui.hud.right-hud","game.feature.gui.base.text","game.feature.menu.gui.menu-misc","game.feature.menu.gui.arena.arena-misc","game.feature.arena.gui.arena-effect-display").defines(function(){var b={buttons:[{x:4,y:-29,label:"nextRound",delay:0},{x:12,y:-0,label:"restart",delay:0},{x:4,y:29,label:"giveUp",
delay:0}],deathButtons:[{x:4,y:-16,label:"restart",delay:0},{x:4,y:16,label:"giveUp",delay:0}],end:[{x:4,y:-29,label:"restart",delay:0},{x:12,y:0,label:"summary",delay:0.016},{x:4,y:29,label:"return",delay:0}]},a={buttons:[{x:4,y:-45,label:"nextRound",delay:0},{x:12,y:-16,label:"repeat",delay:0.016},{x:12,y:16,label:"summary",delay:0.016},{x:4,y:45,label:"return",delay:0}],deathButtons:[{x:4,y:-29,label:"repeat",delay:0},{x:12,y:0,label:"summary",delay:0.016},{x:4,y:29,label:"return",delay:0}],end:[{x:4,
y:-45,label:"nextRound",delay:0},{x:12,y:-16,label:"repeat",delay:0.016},{x:12,y:16,label:"summary",delay:0.016},{x:4,y:45,label:"return",delay:0}]};sc.ArenaRoundEndButtons=ig.GuiElementBase.extend({gfx:new ig.Image("media/gui/arena-gui.png"),transitions:{DEFAULT:{state:{},time:0.2,timeFunction:KEY_SPLINES.LINEAR},HIDDEN:{state:{alpha:0},time:0.2,timeFunction:KEY_SPLINES.LINEAR}},callback:null,buttonInteract:null,buttonGroup:null,background:null,buttons:[],info:null,dialogBlock:false,_playerDeath:false,
_isLastRound:false,confirm:new ig.Sound("media/sound/arena/arena-cup-select.ogg",0.8),init:function(c,d,f){this.parent();this.setAlign(ig.GUI_ALIGN_X.LEFT,ig.GUI_ALIGN_Y.CENTER);this.setSize(88,176);this.callback=c;this.info=d;this._playerDeath=f||false;this._isLastRound=sc.arena.isCurrentRoundLast();this.buttonInteract=new ig.ButtonInteractEntry;this.buttonGroup=new sc.ButtonGroup(false,ig.BUTTON_GROUP_SELECT_TYPE.VERTICAL,true);this.buttonGroup.addPressCallback(this.onButtonPressed.bind(this));
this.buttonGroup.addSelectionCallback(this.onButtonSelect.bind(this));this.buttonGroup.setMouseFocusLostCallback(this.onMouseFocusLost.bind(this));this.background=new ig.ImageGui(this.gfx,160,32,88,176);this.background.hook.localAlpha=0.5;this.background.hook.transitions={DEFAULT:{state:{},time:0.2,timeFunction:KEY_SPLINES.LINEAR},HIDDEN:{state:{alpha:0,offsetX:-44},time:0.2,timeFunction:KEY_SPLINES.LINEAR}};this.background.doStateTransition("HIDDEN",true);this.addChildGui(this.background);c=sc.arena.runtime.rush?
b:a;f=f?c.deathButtons:sc.arena.isCurrentRoundLast()?c.end:c.buttons;for(c=0;c<f.length;c++){var d=f[c],g=new sc.ButtonGui(ig.lang.get("sc.gui.arena.buttons.names."+d.label),120);g.submitSound=null;g.blockedSound=null;g.bgGui.flipped=true;g.highlightGui.flipped=true;g.setData({delay:d.delay,description:ig.lang.get("sc.gui.arena.buttons.description."+d.label),id:c});g.hook.transitions={DEFAULT:{state:{},time:0.2,timeFunction:KEY_SPLINES.EASE},HIDDEN:{state:{offsetX:-(130+d.x)},time:0.2,timeFunction:KEY_SPLINES.LINEAR}};
g.setAlign(ig.GUI_ALIGN_X.LEFT,ig.GUI_ALIGN_Y.CENTER);g.setPos(d.x,d.y);g.doStateTransition("HIDDEN",true);this.addChildGui(g);this.buttonGroup.addFocusGui(g,0,c);this.buttons.push(g)}this.buttonInteract.pushButtonGroup(this.buttonGroup);this.doStateTransition("HIDDEN",true)},handleRushMode:function(a){if(sc.options.get("arena-confirm")){sc.BUTTON_SOUND.submit.play();var b=this.getDialogText(true,a);if(b){this.dialogBlock=true;sc.Dialogs.showYesNoDialog(b,sc.DIALOG_INFO_ICON.QUESTION,function(b){this.dialogBlock=
false;if(b.data==0){this.confirm.play();this.callback(true,a,this._isLastRound)}else b.data==1&&sc.BUTTON_SOUND.submit.play()}.bind(this),true)}else this.callback(true,a,this._isLastRound)}else{this.confirm.play();this.callback(true,a,this._isLastRound)}},handleDefaultMode:function(a){if(sc.options.get("arena-confirm")){sc.BUTTON_SOUND.submit.play();var b=this.getDialogText(false,a);if(b){this.dialogBlock=true;sc.Dialogs.showYesNoDialog(b,sc.DIALOG_INFO_ICON.QUESTION,function(b){this.dialogBlock=
false;if(b.data==0){this.confirm.play();this.callback(false,a,this._isLastRound)}else b.data==1&&sc.BUTTON_SOUND.submit.play()}.bind(this),true)}else this.callback(false,a,this._isLastRound)}else{this.confirm.play();this.callback(false,a,this._isLastRound)}},getDialogText:function(a,b){if(a)if(this._playerDeath){if(b==0)return ig.lang.get("sc.gui.arena.dialogs.restart");if(b==1)return ig.lang.get("sc.gui.arena.dialogs.giveUp")}else if(this._isLastRound){if(b==0)return ig.lang.get("sc.gui.arena.dialogs.restart");
if(b==1)return null;if(b==2)return ig.lang.get("sc.gui.arena.dialogs.lobby")}else{if(b==0)return ig.lang.get("sc.gui.arena.dialogs.next");if(b==1)return ig.lang.get("sc.gui.arena.dialogs.restart");if(b==2)return ig.lang.get("sc.gui.arena.dialogs.giveUp")}else if(this._playerDeath){if(b==0)return ig.lang.get("sc.gui.arena.dialogs.repeat");if(b==1)return null;if(b==2)return ig.lang.get("sc.gui.arena.dialogs.lobby")}else{if(b==0)return ig.lang.get("sc.gui.arena.dialogs.next");if(b==1)return ig.lang.get("sc.gui.arena.dialogs.repeat");
if(b==2)return null;if(b==3)return ig.lang.get("sc.gui.arena.dialogs.lobby")}},onButtonPressed:function(a){sc.arena.runtime.rush?this.handleRushMode(a.data.id):this.handleDefaultMode(a.data.id)},onButtonSelect:function(a){a.data?this.info.setText(a.data.description):this.info.setText("",0.5)},onMouseFocusLost:function(){this.info.setText("",0.5)},show:function(){this.doStateTransition("DEFAULT",true);this.background.doStateTransition("DEFAULT");for(var a=this.buttons.length;a--;)this.buttons[a].doStateTransition("DEFAULT",
false,false,null,this.buttons[a].data.delay+0.032);a=sc.arena.runtime;!a.rush&&!this._playerDeath&&a.currentRound==a.rounds.length-1&&this.buttons[0].setActive(false);ig.interact.addEntry(this.buttonInteract)},hide:function(){this.background.doStateTransition("HIDDEN");for(var a=this.buttons.length;a--;)this.buttons[a].doStateTransition("HIDDEN");ig.interact.removeEntry(this.buttonInteract)}});sc.ArenaCoinsHud=ig.GuiElementBase.extend({ninepatch:new ig.NinePatch("media/gui/arena-gui.png",{width:18,
height:0,left:14,top:14,right:0,bottom:0,offsets:{"default":{x:96,y:34}}}),panel:null,number:null,coins:null,add:0,init:function(){this.parent();this.setAlign(ig.GUI_ALIGN_X.RIGHT,ig.GUI_ALIGN_Y.BOTTOM);this.setPivot(0,7);this.setPos(0,70);this.panel=new ig.BoxGui(120,14,false,this.ninepatch);this.panel.setAlign(ig.GUI_ALIGN_X.RIGHT,ig.GUI_ALIGN_Y.CENTER);this.panel.hook.localAlpha=0.5;this.panel.hook.transitions={DEFAULT:{state:{},time:0.2,timeFunction:KEY_SPLINES.LINEAR},HIDDEN:{state:{alpha:0,
offsetX:-d/2,scaleY:0},time:0.2,timeFunction:KEY_SPLINES.LINEAR}};this.panel.doStateTransition("HIDDEN",true);this.addChildGui(this.panel);this.coins=new ig.ImageGui(this.ninepatch.gfx,135,66,18,18);this.coins.setAlign(ig.GUI_ALIGN_X.RIGHT,ig.GUI_ALIGN_Y.CENTER);this.coins.setPos(5,0);this.panel.addChildGui(this.coins);this.number=new sc.MoneyTextGui(false,true);this.number.setAlign(ig.GUI_ALIGN_X.RIGHT,ig.GUI_ALIGN_Y.CENTER);this.number.setPos(this.coins.hook.size.x+5+3,0);this.panel.addChildGui(this.number);
this.setSize(this.number.hook.pos.x+this.number.hook.size.x+5,14);this.panel.setSize(this.hook.size.x,this.hook.size.y)},addRushCoins:function(){var a=sc.arena.runtime;this.add=sc.arena.getArenaCoinsObtainedInRound(a.cup,-1,a.prevMedal);this.number.number.setNumber(this.add)},show:function(){this.panel.doStateTransition("HIDDEN",true);var a=sc.arena.runtime;this.add=sc.arena.getArenaCoinsObtainedInRound(a.cup,a.currentRound,a.prevMedal);this.add>0&&this.panel.doStateTransition("DEFAULT",false,false,
function(){this.number.number.setNumber(this.add)}.bind(this),0.1)},hide:function(){this.panel.doStateTransition("HIDDEN")}});var d=134;sc.ArenaMedalHud=ig.GuiElementBase.extend({ninepatch:new ig.NinePatch("media/gui/arena-gui.png",{width:18,height:0,left:14,top:14,right:0,bottom:0,offsets:{"default":{x:96,y:34}}}),panel:null,text:null,medal:null,effect:null,callback:null,init:function(a){this.parent();this.setAlign(ig.GUI_ALIGN_X.RIGHT,ig.GUI_ALIGN_Y.BOTTOM);this.setSize(d,32);this.setPivot(0,16);
this.setPos(0,96);this.callback=a;this.panel=new ig.BoxGui(d,13,false,this.ninepatch);this.panel.setAlign(ig.GUI_ALIGN_X.RIGHT,ig.GUI_ALIGN_Y.CENTER);this.panel.hook.localAlpha=0.5;this.panel.hook.transitions={DEFAULT:{state:{},time:0.2,timeFunction:KEY_SPLINES.LINEAR},HIDDEN:{state:{alpha:0,offsetX:-d/2,scaleY:0},time:0.2,timeFunction:KEY_SPLINES.LINEAR}};this.panel.doStateTransition("HIDDEN",true);this.addChildGui(this.panel);this.text=new sc.TextGui("Bronze");this.text.hook.transitions={DEFAULT:{state:{},
time:0.2,timeFunction:KEY_SPLINES.LINEAR},HIDDEN:{state:{alpha:0,offsetX:15},time:0.2,timeFunction:KEY_SPLINES.EASE_IN_OUT}};this.text.setAlign(ig.GUI_ALIGN_X.RIGHT,ig.GUI_ALIGN_Y.TOP);this.text.setPos(58,-2);this.panel.addChildGui(this.text);this.medal=new ig.GuiElementBase;this.medal.setSize(32,32);this.medal.setAlign(ig.GUI_ALIGN_X.RIGHT,ig.GUI_ALIGN_Y.CENTER);this.medal.setPos(13,0);this.addChildGui(this.medal);this.effect=new sc.ArenaMedalEffect;this.effect.setAlign(ig.GUI_ALIGN_X.CENTER,ig.GUI_ALIGN_Y.CENTER);
this.medal.addChildGui(this.effect)},show:function(a){this.panel.doStateTransition("HIDDEN",true);this.text.doStateTransition("HIDDEN",true);var b=ig.lang.get("sc.gui.arena.medals")[Math.max(0,Math.min(4,a-1))];this.text.setText(b);this.panel.doStateTransition("DEFAULT",false,false,function(){this.text.doStateTransition("DEFAULT",false,false,function(){this.callback&&this.callback()}.bind(this),0.2)}.bind(this),0.1);this.effect.show(a,false)},hide:function(){this.panel.doStateTransition("HIDDEN");
this.effect.hide()}});sc.ArenaRoundEndHeader=ig.BoxGui.extend({transitions:{DEFAULT:{state:{},time:0.5,timeFunction:KEY_SPLINES.EASE_OUT},HIDDEN:{state:{alpha:0,scaleX:0},time:0.2,timeFunction:KEY_SPLINES.LINEAR}},ninepatch:new ig.NinePatch("media/gui/arena-gui.png",{width:16,height:0,left:66,top:15,right:66,bottom:0,offsets:{"default":{x:82,y:1},white:{x:82,y:17}}}),text:null,init:function(){this.parent(262,15);this.setAlign(ig.GUI_ALIGN_X.CENTER,ig.GUI_ALIGN_Y.TOP);this.setPivot(131,0);this.setPos(0,
32);this.text=new sc.TextGui("");this.text.setAlign(ig.GUI_ALIGN_X.CENTER,ig.GUI_ALIGN_Y.TOP);this.text.setPos(0,-2);this.addChildGui(this.text);this.overlay=new ig.BoxGui(262,15,false,this.ninepatch);this.overlay.hook.transitions={DEFAULT:{state:{},time:0.25,timeFunction:KEY_SPLINES.LINEAR},HIDDEN:{state:{alpha:0},time:0.25,timeFunction:KEY_SPLINES.LINEAR}};this.overlay.currentTileOffset="white";this.overlay.doStateTransition("HIDDEN",true);this.addChildGui(this.overlay);this.doStateTransition("HIDDEN",
true)},show:function(a,b){b=b||ig.lang.get("sc.gui.arena.roundClear").replace("[!]",sc.arena.runtime.currentRound+1);this.text.setText(b);this.overlay.doStateTransition("DEFAULT",false,false,function(){this.overlay.doStateTransition("HIDDEN",false,false,null,0.2)}.bind(this));this.doStateTransition("DEFAULT",false,false,a)},hide:function(){this.doStateTransition("HIDDEN")}});sc.ArenaSummary=sc.RightHudBoxGui.extend({summaryContent:null,scrollPanel:null,container:null,total:null,totalOverlay:null,
entries:[],currentIndex:0,timer:0,totalValue:0,addEntries:false,containerHeight:0,done:false,callback:null,scoreCountSound:new ig.Sound("media/sound/arena/arena-score-count.ogg",1,0.1),scoreDotSound:new ig.Sound("media/sound/arena/score-dot.ogg",0.8),scoreDotPitch:0.8,init:function(a){this.parent(ig.lang.get("sc.gui.arena.summary"));this.callback=a||null;var b=sc.options.get("min-sidebar")&&sc.options.get("pixel-size")==sc.PIXEL_SIZE.TWO;this.summaryContent=new ig.GuiElementBase;this.summaryContent.setSize(220,
117+(b?152:0));a=-2;this.scrollPanel=new sc.ScrollPane(sc.ScrollType.Y_ONLY);this.scrollPanel.showTopBar=false;this.scrollPanel.showBottomBar=false;this.scrollPanel.setAlign(ig.GUI_ALIGN_X.RIGHT,ig.GUI_ALIGN_Y.TOP);this.scrollPanel.setSize(218,101*(b?2.5:1));this.scrollPanel.setPos(-1,a);this.summaryContent.addChildGui(this.scrollPanel);a=a+this.scrollPanel.hook.size.y;b=new sc.LineGui(220);b.setPos(0,a);this.summaryContent.addChildGui(b);this.container=new ig.GuiElementBase;this.scrollPanel.setContent(this.container);
this.total=new sc.STATS_ENTRY_TYPE.KeyValue("total",{value:1,maxValue:999999999,asNumber:true,numberDots:true,numberSize:sc.NUMBER_SIZE.TEXT,transitionTime:0.2},226);this.total.keyGui.setText(ig.lang.get("sc.gui.arena.total")+":");this.total.setPos(-3,a);this.total.setValueAsNumber(0,true);this.summaryContent.addChildGui(this.total);this.totalOverlay=new sc.NumberGui(999999999,{size:sc.NUMBER_SIZE.TEXT,dots:true,transitionTime:0.2,color:sc.GUI_NUMBER_COLOR.NO_SHADOW});this.totalOverlay.hook.transitions=
{DEFAULT:{state:{},time:0.1,timeFunction:KEY_SPLINES.LINEAR},HIDDEN:{state:{alpha:0},time:0.1,timeFunction:KEY_SPLINES.LINEAR}};this.totalOverlay.setAlign(ig.GUI_ALIGN.X_RIGHT,ig.GUI_ALIGN.Y_CENTER);this.totalOverlay.setPos(5,0);this.totalOverlay.doStateTransition("HIDDEN",true);this.total.addChildGui(this.totalOverlay);this.pushContent(this.summaryContent,false,2,2);this.contentEntries[0].hook.localAlpha=0.5},update:function(){if(this.addEntries){if(this.currentIndex>0){if(this.scoreDotPitch<1.5)this.scoreDotPitch=
this.scoreDotPitch+0.6*ig.system.tick;this.scoreDotSound.play(false,{speed:this.scoreDotPitch})}if(this.timer<=0)if(this.currentIndex==-1){this.timer=0.1;this.currentIndex=0}else{var a=this.entries[this.currentIndex],b=null,b=a.separator?this._addSeparator(a.text):a.data?this._addBonusEntry(a.type,a.data,a.points):this._addEntry(a.key,a.stats);this.currentIndex++;this.container.hook.size.y=this.container.hook.size.y+(b.hook.size.y+0);this.scrollPanel.recalculateScrollBars(true);this.scrollPanel.setScrollY(this.container.hook.size.y,
false,0.1,KEY_SPLINES.LINEAR);this.timer=0.1;if(this.currentIndex>=this.entries.length){this.addEntries=false;this.done=true;this.timer=0.2}}else this.timer=this.timer-ig.system.tick}else if(this.done&&this.timer>0){this.timer=this.timer-ig.system.tick;if(this.scoreDotPitch<1.5)this.scoreDotPitch=this.scoreDotPitch+0.6*ig.system.tick;this.scoreDotSound.play(false,{speed:this.scoreDotPitch});if(this.timer<=0){this.totalOverlay.setMaxNumber(Math.max(0,this.totalValue));this.totalOverlay.setNumber(Math.max(0,
this.totalValue),true);this.totalOverlay.doStateTransition("DEFAULT",false,false,function(){this.totalOverlay.doStateTransition("HIDDEN")}.bind(this));this.scoreCountSound.play();this.callback&&this.callback()}}},updateScroll:function(){if(this.done){sc.control.menuScrollUp()?this.scrollPanel.scrollY(-14):sc.control.menuScrollDown()&&this.scrollPanel.scrollY(14);sc.control.arenaScrollDown()?this.scrollPanel.scrollY(140*ig.system.tick):sc.control.arenaScrollUp()&&this.scrollPanel.scrollY(-140*ig.system.tick)}},
skip:function(){if(!this.done){this.addEntries=false;for(var a=this.currentIndex;a<this.entries.length;a++){var b=this.entries[this.currentIndex],d=null,d=b.separator?this._addSeparator(b.text,true):b.data?this._addBonusEntry(b.type,b.data,b.points,true):this._addEntry(b.key,b.stats,true);this.currentIndex++;this.container.hook.size.y=this.container.hook.size.y+(d.hook.size.y+0)}this.scrollPanel.recalculateScrollBars(true);this.scrollPanel.setScrollY(this.container.hook.size.y,false,0.1,KEY_SPLINES.LINEAR);
this.totalOverlay.setMaxNumber(Math.max(0,this.totalValue));this.totalOverlay.setNumber(Math.max(0,this.totalValue),true);this.totalOverlay.doStateTransition("DEFAULT",false,false,function(){this.totalOverlay.doStateTransition("HIDDEN")}.bind(this));this.scoreCountSound.play();this.timer=0;this.done=true}},show:function(){this.parent();var a=sc.arena.runtime.scoreStats,b;for(b in a)this.entries.push({key:b,stats:a[b]});this.entries.sort(function(a,b){return sc.ARENA_SCORE_TYPES[a.key].order-sc.ARENA_SCORE_TYPES[b.key].order});
b=sc.arena.runtime.bonusObjectives;for(var a=[],d=b.length;d--;){var g=b[d];(ig.perf.grantArenaBonus||sc.ARENA_BONUS_OBJECTIVE[g.type].check(g.data))&&a.push(b[d])}if(a.length>0){a.sort(function(a,b){return sc.ARENA_BONUS_OBJECTIVE[a.type].order-sc.ARENA_BONUS_OBJECTIVE[b.type].order});this.entries.push({separator:true,text:ig.lang.get("sc.gui.arena.menu.bonuses")});for(b=0;b<a.length;b++)this.entries.push(a[b])}this.totalValue=0;this.addEntries=true;this.currentIndex=-1;this.timer=0.2},_addSeparator:function(a,
b){var d=new sc.TextGui("\\c[3]"+a+"\\c[0]",{font:sc.fontsystem.smallFont});d.hook.transitions={DEFAULT:{state:{},time:0.2,timeFunction:KEY_SPLINES.LINEAR},HIDDEN:{state:{alpha:0},time:0.2,timeFunction:KEY_SPLINES.LINEAR}};d.hook.size.y=14;d.setPos(0,this.container.hook.size.y);d.doStateTransition("HIDDEN",true);d.doStateTransition("DEFAULT",b);this.container.addChildGui(d);return d},_addBonusEntry:function(a,b,d,g){d=sc.ARENA_BONUS_OBJECTIVE[a].getPoints?sc.ARENA_BONUS_OBJECTIVE[a].getPoints(b,d):
d;this.totalValue=this.totalValue+d;this.total.setValueAsNumber(Math.max(0,this.totalValue));a="\\i[insetArrow]"+sc.ARENA_BONUS_OBJECTIVE[a].getText(ig.lang.get("sc.gui.arena.bonuses."+a),b,true);d=new sc.ArenaSummary.Entry(a,d,d,0,true,false,sc.GUI_NUMBER_COLOR.WHITE,g);d.setPos(0,this.container.hook.size.y);this.container.addChildGui(d);return d},_addEntry:function(a,b,d){var g=sc.ARENA_SCORE_TYPES[a],h=0,i=0;if(g["static"]){h=i=b.value;a=ig.lang.get("sc.gui.arena.scoreTypes."+a);if(g.staticMultiplier&&
!sc.arena.hasChallenge("PVP_BATTLE")){a=g.asMali?a+"\\i[timesRed]":a+"\\i[times]";a=a+g.staticMultiplier}}else{h=b.value;i=b.count*g.points}this.totalValue=this.totalValue+h;this.total.setValueAsNumber(Math.max(0,this.totalValue));a=new sc.ArenaSummary.Entry(a,h,i,b.count,g["static"],g.asBonus,g.asMali,d);a.setPos(0,this.container.hook.size.y);this.container.addChildGui(a);return a}});sc.ArenaSummary.Entry=ig.SimpleGui.extend({gfx:new ig.Image("media/gui/menu.png"),transitions:{DEFAULT:{state:{},
time:0.2,timeFunction:KEY_SPLINES.LINEAR},HIDDEN:{state:{alpha:0},time:0.2,timeFunction:KEY_SPLINES.LINEAR}},keyGui:null,valueGui:null,extraKey:null,extraValue:null,init:function(a,b,d,g,h,i,j,k){this.parent();this.setSize(213,14);if(!this.constructor.PATTERN)this.constructor.PATTERN=this.gfx.createPattern(560,192,15,4,ig.ImagePattern.OPT.REPEAT_X);var l="",l=!h&&sc.ARENA_SCORE_TYPES[a].getName?sc.ARENA_SCORE_TYPES[a].getName()||"MISSING SCORE TYPE NAME":h?a:ig.lang.get("sc.gui.arena.scoreTypes."+
a)+(j?"\\i[timesRed]":"\\i[times]")+g;i?l="\\i[insetArrow]\\c[2]"+l+"\\c[0]":j&&(l="\\c[1]"+l+"\\c[0]");this.keyGui=new sc.TextGui(l,{font:sc.fontsystem.smallFont});this.keyGui.setPos(0,0);this.addChildGui(this.keyGui);this.valueGui=new sc.NumberGui(Math.abs(d),{size:sc.NUMBER_SIZE.SMALL,transitionTime:0.2,showPlus:i,signed:j});this.valueGui.setAlign(ig.GUI_ALIGN.X_RIGHT,ig.GUI_ALIGN.Y_TOP);this.valueGui.setPos(0,3);i?this.valueGui.setColor(sc.GUI_NUMBER_COLOR.GREEN):j&&this.valueGui.setColor(sc.GUI_NUMBER_COLOR.RED);
this.addChildGui(this.valueGui);if(!h&&b>d){this.valueGui.setNumber(d,k);this.hook.size.y=this.hook.size.y+14;a=b-d;this.extraKey=new sc.TextGui("\\i[insetArrow]\\c["+(a>0?2:1)+"]"+ig.lang.get("sc.gui.arena."+(a>0?"chainBonus":"dimReturns"))+"\\c[0]",{font:sc.fontsystem.smallFont});this.extraKey.setPos(0,14);this.addChildGui(this.extraKey);this.extraValue=new sc.NumberGui(Math.abs(a),{size:sc.NUMBER_SIZE.SMALL,transitionTime:0.2,signed:true,showPlus:true});this.extraValue.setAlign(ig.GUI_ALIGN.X_RIGHT,
ig.GUI_ALIGN.Y_TOP);this.extraValue.setColor(a>0?sc.GUI_NUMBER_COLOR.GREEN:sc.GUI_NUMBER_COLOR.RED);this.extraValue.setPos(0,17);this.extraValue.setNumber(a,k);this.addChildGui(this.extraValue)}else this.valueGui.setNumber(b,k);this.doStateTransition("HIDDEN",true);this.doStateTransition("DEFAULT",k)},updateDrawables:function(a){if(this.keyGui&&this.valueGui){var b=this.keyGui.hook.size.x+this.keyGui.hook.pos.x+1,d=this.hook.size.x-this.keyGui.hook.size.x-this.valueGui.hook.size.x-1,d=Math.floor(d/
3)*3;a.addPattern(this.constructor.PATTERN,b,9,0,0,d,4);if(this.extraKey){b=this.extraKey.hook.size.x+this.extraKey.hook.pos.x+1;d=this.hook.size.x-this.extraKey.hook.size.x-this.extraValue.hook.size.x-1;d=Math.floor(d/3)*3;a.addPattern(this.constructor.PATTERN,b,23,0,0,d,4)}}}})});ig.baked=!0;
ig.module("game.feature.arena.gui.arena-trophy-gui").requires("impact.feature.gui.gui","impact.feature.gui.base.basic-gui","impact.feature.gui.base.box","game.feature.gui.base.text","game.feature.menu.gui.menu-misc","game.feature.menu.gui.arena.arena-misc","game.feature.arena.gui.arena-effect-display","game.feature.gui.widget.modal-dialog").defines(function(){sc.ArenaCupOverview=ig.GuiElementBase.extend({gfx:new ig.Image("media/gui/menu.png"),transitions:{DEFAULT:{state:{},time:0.2,timeFunction:KEY_SPLINES.EASE_OUT},
HIDDEN:{state:{alpha:0},time:0.2,timeFunction:KEY_SPLINES.EASE_IN}},interact:null,content:null,msgBox:null,header:null,medals:null,list:null,trophy:null,effect:null,total:null,time:null,rushTime:null,rushChain:null,totalOverlay:null,score:null,trophyHeader:null,trophyFooter:null,callback:null,entries:[],currentIndex:0,timer:0,totalValue:0,totalTime:0,addEntries:false,cup:null,trophyType:null,state:0,blockTimer:0,initGui:false,scoreCountSound:new ig.Sound("media/sound/arena/arena-score-count.ogg",
0.8,0.1),scoreDotSound:new ig.Sound("media/sound/arena/score-dot.ogg",0.8),scoreDotPitch:0.8,init:function(b,a){this.parent();this.hook.zIndex=9999998;this.hook.localAlpha=0.8;this.hook.temporary=true;this.hook.pauseGui=true;this.hook.size.x=ig.system.width;this.hook.size.y=ig.system.height;this.cup=b;this.callback=a;this.interact=new sc.ScreenInteractEntry(this,true);var d=sc.arena.getCupCore(this.cup).noRush||false;this.content=new ig.GuiElementBase;this.content.setSize(280,166-(d?40:0));this.header=
new sc.TextGui("");this.header.setAlign(ig.GUI_ALIGN_X.CENTER,ig.GUI_ALIGN_Y.TOP);this.header.setPos(0,-4);this.content.addChildGui(this.header);var c=new ig.ColorGui("#7E7E7E",280,1);c.setAlign(ig.GUI_ALIGN_X.CENTER,ig.GUI_ALIGN_Y.TOP);c.setPos(0,13);this.content.addChildGui(c);this.medals=new ig.GuiElementBase;this.list=new sc.ScrollPane(sc.ScrollType.Y_ONLY);this.list.showTopBar=false;this.list.showBottomBar=false;this.list.setContent(this.medals);this.list.setSize(184,76);this.list.setPos(0,13);
this.content.addChildGui(this.list);c=new ig.ColorGui("#7E7E7E",280,1);c.setAlign(ig.GUI_ALIGN_X.CENTER,ig.GUI_ALIGN_Y.TOP);c.setPos(0,13+this.list.hook.size.y-1);this.content.addChildGui(c);this.total=new sc.STATS_ENTRY_TYPE.KeyValue("total",{value:1,maxValue:999999999,asNumber:true,numberDots:true,numberSize:sc.NUMBER_SIZE.TEXT,transitionTime:0.2},286);this.total.keyGui.setText(ig.lang.get("sc.gui.arena.totalScore"));this.total.setPos(-3,13+this.list.hook.size.y);this.total.setValueAsNumber(0,true);
this.content.addChildGui(this.total);this.totalOverlay=new sc.NumberGui(999999999,{size:sc.NUMBER_SIZE.TEXT,dots:true,transitionTime:0.2,color:sc.GUI_NUMBER_COLOR.NO_SHADOW});this.totalOverlay.hook.transitions={DEFAULT:{state:{},time:0.1,timeFunction:KEY_SPLINES.LINEAR},HIDDEN:{state:{alpha:0},time:0.1,timeFunction:KEY_SPLINES.LINEAR}};this.totalOverlay.setAlign(ig.GUI_ALIGN.X_RIGHT,ig.GUI_ALIGN.Y_CENTER);this.totalOverlay.setPos(5,0);this.totalOverlay.doStateTransition("HIDDEN",true);this.total.addChildGui(this.totalOverlay);
this.time=new sc.STATS_ENTRY_TYPE.Time("total",{value:function(){return 0},leading:2,max:99,millis:true,hideHours:true,transitionTime:0.2},286);this.time.keyGui.setText(ig.lang.get("sc.gui.arena.menu.time"));this.time.setPos(-3,this.total.hook.pos.y+20);this.time.setTime(0,true);this.content.addChildGui(this.time);this.rushTime=new sc.STATS_ENTRY_TYPE.Time("total",{value:function(){return 0},leading:2,max:99,millis:true,hideHours:true,transitionTime:0.2},262);this.rushTime.keyGui.setText(ig.lang.get("sc.gui.arena.menu.rush"));
this.rushTime.setPos(-3,this.time.hook.pos.y+20);this.rushTime.setTime(0,true);!d&&this.content.addChildGui(this.rushTime);this.rushTime.hook.pos.x=this.rushTime.hook.pos.x+24;c=new ig.ImageGui(this.gfx,512,207,17,16);c.setPos(-17,-1);this.rushTime.addChildGui(c);this.rushChain=new sc.STATS_ENTRY_TYPE.KeyValue("total",{value:1,maxValue:999999999,asNumber:true,numberDots:true,numberSize:sc.NUMBER_SIZE.TEXT,transitionTime:0.2},286);this.rushChain.keyGui.setText(ig.lang.get("sc.gui.arena.rushChainHigh"));
this.rushChain.setPos(-3,this.rushTime.hook.pos.y+20);this.rushChain.setValueAsNumber(0,true);!d&&this.content.addChildGui(this.rushChain);this.trophy=new ig.GuiElementBase;this.trophy.setSize(96,74);this.trophy.setPos(184,14);this.content.addChildGui(this.trophy);this.trophyType=sc.arena.getCupTrophy(this.cup);if(this.trophyType>0){this.trophyHeader=new sc.TextGui("\\c[4]"+ig.lang.get("sc.gui.arena.overview.trophyHeader")+"\\c[0]",{font:sc.fontsystem.smallFont});this.trophyHeader.hook.transitions=
{DEFAULT:{state:{},time:0.4,timeFunction:KEY_SPLINES.EASE_OUT},HIDDEN:{state:{alpha:0,offsetX:30},time:0.2,timeFunction:KEY_SPLINES.EASE_IN_OUT}};this.trophyHeader.setPos(2,0);this.trophyHeader.doStateTransition("HIDDEN",true);this.trophy.addChildGui(this.trophyHeader);d=ig.lang.get("sc.gui.arena.medals")[this.trophyType-1];this.trophyFooter=new sc.TextGui("\\c[4]"+d+"\\c[0]",{font:sc.fontsystem.smallFont,maxWidth:76,textAlign:ig.Font.ALIGN.RIGHT,linePadding:-3});this.trophyFooter.setAlign(ig.GUI_ALIGN_X.RIGHT,
ig.GUI_ALIGN_Y.BOTTOM);this.trophyFooter.setPos(0,-2);this.trophyFooter.hook.transitions={DEFAULT:{state:{},time:0.4,timeFunction:KEY_SPLINES.EASE_OUT},HIDDEN:{state:{alpha:0,offsetX:30},time:0.2,timeFunction:KEY_SPLINES.EASE_IN_OUT}};this.trophyFooter.setPos(2,0);this.trophyFooter.doStateTransition("HIDDEN",true);this.trophy.addChildGui(this.trophyFooter);this.effect=new sc.ArenaMedalEffect;this.effect.setAlign(ig.GUI_ALIGN_X.CENTER,ig.GUI_ALIGN_Y.CENTER);this.trophy.addChildGui(this.effect)}else{this.trophyHeader=
new sc.TextGui("\\c[4]"+ig.lang.get("sc.gui.arena.overview.trophyNone")+"\\c[9]",{font:sc.fontsystem.smallFont,maxWidth:80,textAlign:ig.Font.ALIGN.CENTER});this.trophyHeader.hook.transitions={DEFAULT:{state:{},time:0.4,timeFunction:KEY_SPLINES.EASE_OUT},HIDDEN:{state:{alpha:0},time:0.2,timeFunction:KEY_SPLINES.EASE_IN_OUT}};this.trophyHeader.setAlign(ig.GUI_ALIGN_X.CENTER,ig.GUI_ALIGN_Y.CENTER);this.trophy.addChildGui(this.trophyHeader)}this.msgBox=new sc.CenterBoxGui(this.content);this.msgBox.setAlign(ig.GUI_ALIGN.X_CENTER,
ig.GUI_ALIGN.Y_CENTER);this.addChildGui(this.msgBox);this.doStateTransition("HIDDEN",true)},update:function(){if(this.blockTimer>0)this.blockTimer=this.blockTimer-ig.system.tick;else{if(this.done){sc.control.menuScrollUp()?this.list.scrollY(-18):sc.control.menuScrollDown()&&this.list.scrollY(18);sc.control.arenaScrollDown()?this.list.scrollY(140*ig.system.tick):sc.control.arenaScrollUp()&&this.list.scrollY(-140*ig.system.tick)}if(this.addEntries){if(this.currentIndex>0){if(this.scoreDotPitch<1.5)this.scoreDotPitch=
this.scoreDotPitch+0.6*ig.system.tick;this.scoreDotSound.play(false,{speed:this.scoreDotPitch})}if(this.timer<=0)if(this.currentIndex==-1){this.timer=0.1;this.currentIndex=0}else{if(!this.initGui){this.rushTime.setTime(sc.arena.getRoundTime(this.cup,-1));this.rushChain.setValueAsNumber(sc.arena.getCupProgress(this.cup).rush.chain);this.initGui=true}var b=this.entries[this.currentIndex],a=new sc.ArenaCupOverview.MedalEntry(b.id,b.medal,false,b.isRush),d=~~(b.id/10);a.setPos(1+b.id%10*18,2+d*18);this.medals.addChildGui(a);
this.totalValue=this.totalValue+b.points;this.total.setValueAsNumber(this.totalValue);if(b.time){this.totalTime=this.totalTime+b.time;this.time.setTime(this.totalTime)}this.currentIndex++;this.medals.hook.size.y=2+(d+1)*18;this.list.recalculateScrollBars(true);this.list.setScrollY(this.medals.hook.size.y,false,0.1,KEY_SPLINES.LINEAR);this.timer=0.1;if(this.currentIndex>=this.entries.length){this.addEntries=false;this.done=true;this.timer=0.2;this.trophyHeader&&this.trophyHeader.doStateTransition("DEFAULT");
this.trophyFooter&&this.trophyFooter.doStateTransition("DEFAULT",false,false,null,0.4)}}else this.timer=this.timer-ig.system.tick}else if(this.done&&this.timer>0){this.timer=this.timer-ig.system.tick;if(this.scoreDotPitch<1.5)this.scoreDotPitch=this.scoreDotPitch+0.6*ig.system.tick;this.scoreDotSound.play(false,{speed:this.scoreDotPitch});if(this.timer<=0){this.totalOverlay.setMaxNumber(this.totalValue);this.totalOverlay.setNumber(this.totalValue,true);this.totalOverlay.doStateTransition("DEFAULT",
false,false,function(){this.totalOverlay.doStateTransition("HIDDEN")}.bind(this));this.scoreCountSound.play();this.state=1;this.effect&&this.effect.show(this.trophyType,true)}}}},updateDrawables:function(b){b.addColor("#000",0,0,this.hook.size.x,this.hook.size.y)},show:function(b){ig.interact.addEntry(this.interact);this.blockTimer=0.1;b=b||ig.lang.get("sc.gui.arena.overview.cupHeader").replace("[CUP_NAME]",sc.arena.getCupName(this.cup));this.header.setText(b);this.addMedals();this.msgBox.doStateTransition("DEFAULT");
this.doStateTransition("DEFAULT")},hide:function(){this.addEntries=false;this.blockTimer=1;this.effect&&this.effect.hide(true);ig.interact.removeEntry(this.interact);ig.interact.setBlockDelay(0.2);this.msgBox.doStateTransition("HIDDEN");this.doStateTransition("HIDDEN",false,true)},addMedals:function(){this.medals.removeAllChildren();this.list.recalculateScrollBars(true);this.totalTime=this.totalValue=this.entries.length=0;this.time.setTime(0,true);this.rushTime.setTime(0,true);this.rushChain.setValueAsNumber(0,
true);this.total.setValueAsNumber(0,true);var b=sc.arena.getCupProgress(this.cup),a=sc.arena.getCupCore(this.cup).noRush||false;if(b){a||this.entries.push({id:0,medal:b.rush.medal||0,points:b.rush.points||0,isRush:true});for(var b=b.rounds,d=0;d<b.length;d++){var c=b[d];this.entries.push({id:a?d:d+1,medal:c.medal||0,time:c.time||0,points:c.points||0})}}else throw Error("No Round Progress found: "+this.cup);this.totalValue=0;this.addEntries=true;this.currentIndex=-1;this.timer=0.1},skip:function(){if(!this.done){this.addEntries=
false;if(this.currentIndex<0)this.currentIndex=0;for(var b=this.currentIndex;b<this.entries.length;b++){var a=this.entries[this.currentIndex],d=new sc.ArenaCupOverview.MedalEntry(a.id,a.medal,true,a.isRush),c=~~(a.id/10);d.setPos(1+a.id%10*18,2+c*18);this.medals.addChildGui(d);this.totalValue=this.totalValue+a.points;if(a.time)this.totalTime=this.totalTime+a.time;this.currentIndex++;this.medals.hook.size.y=2+(c+1)*18}this.total.setValueAsNumber(this.totalValue);this.list.recalculateScrollBars(true);
this.list.setScrollY(this.medals.hook.size.y,false,0.1,KEY_SPLINES.LINEAR);this.trophyHeader&&this.trophyHeader.doStateTransition("DEFAULT");this.trophyFooter&&this.trophyFooter.doStateTransition("DEFAULT");this.rushTime.setTime(sc.arena.getRoundTime(this.cup,-1));this.rushChain.setValueAsNumber(sc.arena.getCupProgress(this.cup).rush.chain);this.time.setTime(this.totalTime);this.totalOverlay.setMaxNumber(this.totalValue);this.totalOverlay.setNumber(this.totalValue,true);this.totalOverlay.doStateTransition("DEFAULT",
false,false,function(){this.totalOverlay.doStateTransition("HIDDEN")}.bind(this));this.scoreCountSound.play();this.effect&&this.effect.show(this.trophyType,true);this.timer=0;this.done=true}},onInteraction:function(){if(!(this.blockTimer>0))if(this.state==0){this.blockTimer=0.2;this.skip();this.state=1}else{this.hide();this.callback&&this.callback()}}});sc.ArenaCupOverview.MedalEntry=ig.GuiElementBase.extend({transitions:{DEFAULT:{state:{},time:0.2,timeFunction:KEY_SPLINES.LINEAR},HIDDEN:{state:{alpha:0},
time:0.2,timeFunction:KEY_SPLINES.LINEAR}},gfx:new ig.Image("media/gui/arena-gui.png"),medal:0,medalGui:null,overlay:null,rush:null,init:function(b,a,d,c){this.parent();this.setSize(16,16);this.medal=a||0;this.medalGui=new ig.ImageGui(this.gfx,this.medal*16,0,16,16);this.medalGui.hook.transitions={DEFAULT:{state:{},time:0.4,timeFunction:KEY_SPLINES.EASE_OUT},HIDDEN:{state:{alpha:0,scaleX:1.5,scaleY:1.5},time:0.2,timeFunction:KEY_SPLINES.LINEAR}};this.medalGui.doStateTransition("HIDDEN",true);this.medalGui.doStateTransition("DEFAULT",
d);this.addChildGui(this.medalGui);if(a>0&&!d){this.overlay=new ig.ImageGui(this.gfx,this.medal*16,16,16,16);this.overlay.hook.transitions={DEFAULT:{state:{alpha:1},time:0.4,timeFunction:KEY_SPLINES.EASE_OUT},HIDDEN:{state:{alpha:0,scaleX:1.5,scaleY:1.5},time:0.2,timeFunction:KEY_SPLINES.LINEAR},HIDDEN_NO_SCALE:{state:{alpha:0},time:0.2,timeFunction:KEY_SPLINES.LINEAR}};this.overlay.doStateTransition("HIDDEN",true);this.overlay.doStateTransition("DEFAULT",false,false,function(){this.overlay.doStateTransition("HIDDEN_NO_SCALE")}.bind(this));
this.addChildGui(this.overlay)}if(c){b=new sc.TextGui(ig.lang.get("sc.gui.arena.rushAbbreviated"),{font:sc.fontsystem.tinyFont});b.setAlign(ig.GUI_ALIGN_X.CENTER,ig.GUI_ALIGN_Y.CENTER);b.setPos(1,1);this.rush=new ig.ColorGui("#000",b.hook.size.x+1,b.hook.size.y-1);this.rush.hook.localAlpha=1;this.rush.setAlign(ig.GUI_ALIGN_X.LEFT,ig.GUI_ALIGN_Y.TOP);this.rush.addChildGui(b);this.medalGui.addChildGui(this.rush)}}})});ig.baked=!0;
ig.module("game.feature.arena.gui.arena-rush-gui").requires("impact.feature.gui.gui","impact.feature.gui.base.basic-gui","impact.feature.gui.base.box","game.feature.gui.base.text","game.feature.menu.gui.menu-misc","game.feature.menu.gui.arena.arena-misc","game.feature.arena.gui.arena-effect-display","game.feature.gui.widget.modal-dialog","game.feature.arena.gui.arena-trophy-gui").defines(function(){sc.ArenaRushOverview=ig.GuiElementBase.extend({gfx:new ig.Image("media/gui/menu.png"),transitions:{DEFAULT:{state:{},
time:0.2,timeFunction:KEY_SPLINES.EASE_OUT},HIDDEN:{state:{alpha:0},time:0.2,timeFunction:KEY_SPLINES.EASE_IN}},interact:null,content:null,msgBox:null,header:null,medals:null,list:null,medal:null,effect:null,total:null,time:null,totalOverlay:null,medalHeader:null,medalFooter:null,callback:null,entries:[],currentIndex:0,timer:0,totalValue:0,addEntries:false,cup:null,medalType:null,state:0,blockTimer:0,initGui:false,scoreCountSound:new ig.Sound("media/sound/arena/arena-score-count.ogg",0.8,0.1),scoreDotSound:new ig.Sound("media/sound/arena/score-dot.ogg",
0.8),scoreDotPitch:0.8,init:function(b){this.parent();this.hook.zIndex=9999998;this.hook.localAlpha=0.8;this.hook.temporary=true;this.hook.pauseGui=true;this.hook.size.x=ig.system.width;this.hook.size.y=ig.system.height;this.cup=sc.arena.runtime.cup;this.callback=b;this.medalType=sc.arena.getCupMedal(this.cup,-1);this.interact=new sc.ScreenInteractEntry(this,true);this.content=new ig.GuiElementBase;this.content.setSize(280,146);this.header=new sc.TextGui(ig.lang.get("sc.gui.arena.rushModeDone"));
this.header.setAlign(ig.GUI_ALIGN_X.CENTER,ig.GUI_ALIGN_Y.TOP);this.header.setPos(0,-4);this.content.addChildGui(this.header);b=new ig.ColorGui("#7E7E7E",280,1);b.setAlign(ig.GUI_ALIGN_X.CENTER,ig.GUI_ALIGN_Y.TOP);b.setPos(0,13);this.content.addChildGui(b);this.medals=new ig.GuiElementBase;this.list=new sc.ScrollPane(sc.ScrollType.Y_ONLY);this.list.showTopBar=false;this.list.showBottomBar=false;this.list.setContent(this.medals);this.list.setSize(184,76);this.list.setPos(0,13);this.content.addChildGui(this.list);
b=new ig.ColorGui("#7E7E7E",280,1);b.setAlign(ig.GUI_ALIGN_X.CENTER,ig.GUI_ALIGN_Y.TOP);b.setPos(0,13+this.list.hook.size.y-1);this.content.addChildGui(b);this.total=new sc.STATS_ENTRY_TYPE.KeyValue("total",{value:1,maxValue:999999999,asNumber:true,numberDots:true,numberSize:sc.NUMBER_SIZE.TEXT,transitionTime:0.2},286);this.total.keyGui.setText(ig.lang.get("sc.gui.arena.totalScore"));this.total.setPos(-3,13+this.list.hook.size.y);this.total.setValueAsNumber(0,true);this.content.addChildGui(this.total);
this.totalOverlay=new sc.NumberGui(999999999,{size:sc.NUMBER_SIZE.TEXT,dots:true,transitionTime:0.2,color:sc.GUI_NUMBER_COLOR.NO_SHADOW});this.totalOverlay.hook.transitions={DEFAULT:{state:{},time:0.1,timeFunction:KEY_SPLINES.LINEAR},HIDDEN:{state:{alpha:0},time:0.1,timeFunction:KEY_SPLINES.LINEAR}};this.totalOverlay.setAlign(ig.GUI_ALIGN.X_RIGHT,ig.GUI_ALIGN.Y_CENTER);this.totalOverlay.setPos(5,0);this.totalOverlay.doStateTransition("HIDDEN",true);this.total.addChildGui(this.totalOverlay);this.time=
new sc.STATS_ENTRY_TYPE.Time("total",{value:function(){return 0},leading:2,max:99,millis:true,hideHours:true,transitionTime:sc.arena.getCupRounds(this.cup).length*0.1+0.1},286);this.time.keyGui.setText(ig.lang.get("sc.gui.arena.time"));this.time.setPos(-3,this.total.hook.pos.y+20);this.time.setTime(0,true);this.content.addChildGui(this.time);this.rushChain=new sc.STATS_ENTRY_TYPE.KeyValue("total",{value:1,maxValue:999999999,asNumber:true,numberDots:true,numberSize:sc.NUMBER_SIZE.TEXT,transitionTime:0.2},
286);this.rushChain.keyGui.setText(ig.lang.get("sc.gui.arena.rushChainHigh"));this.rushChain.setPos(-3,this.time.hook.pos.y+20);this.rushChain.setValueAsNumber(0,true);this.content.addChildGui(this.rushChain);this.medal=new ig.GuiElementBase;this.medal.setSize(96,74);this.medal.setPos(184,14);this.content.addChildGui(this.medal);this.medalHeader=new sc.TextGui("\\c[4]"+ig.lang.get("sc.gui.arena.overview.trophyHeader")+"\\c[0]",{font:sc.fontsystem.smallFont});this.medalHeader.hook.transitions={DEFAULT:{state:{},
time:0.4,timeFunction:KEY_SPLINES.EASE_OUT},HIDDEN:{state:{alpha:0,offsetX:30},time:0.2,timeFunction:KEY_SPLINES.EASE_IN_OUT}};this.medalHeader.setPos(2,0);this.medalHeader.doStateTransition("HIDDEN",true);this.medal.addChildGui(this.medalHeader);b=ig.lang.get("sc.gui.arena.medals")[this.medalType-1];this.medalFooter=new sc.TextGui("\\c[4]"+b+"\\c[0]",{font:sc.fontsystem.smallFont,maxWidth:76,textAlign:ig.Font.ALIGN.RIGHT,linePadding:-3});this.medalFooter.setAlign(ig.GUI_ALIGN_X.RIGHT,ig.GUI_ALIGN_Y.BOTTOM);
this.medalFooter.setPos(0,-2);this.medalFooter.hook.transitions={DEFAULT:{state:{},time:0.4,timeFunction:KEY_SPLINES.EASE_OUT},HIDDEN:{state:{alpha:0,offsetX:30},time:0.2,timeFunction:KEY_SPLINES.EASE_IN_OUT}};this.medalFooter.setPos(2,0);this.medalFooter.doStateTransition("HIDDEN",true);this.medal.addChildGui(this.medalFooter);this.effect=new sc.ArenaMedalEffect;this.effect.setAlign(ig.GUI_ALIGN_X.CENTER,ig.GUI_ALIGN_Y.CENTER);this.medal.addChildGui(this.effect);this.msgBox=new sc.CenterBoxGui(this.content);
this.msgBox.setAlign(ig.GUI_ALIGN.X_CENTER,ig.GUI_ALIGN.Y_CENTER);this.addChildGui(this.msgBox);this.doStateTransition("HIDDEN",true)},update:function(){if(this.blockTimer>0)this.blockTimer=this.blockTimer-ig.system.tick;if(this.done){sc.control.menuScrollUp()?this.list.scrollY(-18):sc.control.menuScrollDown()&&this.list.scrollY(18);sc.control.arenaScrollDown()?this.list.scrollY(140*ig.system.tick):sc.control.arenaScrollUp()&&this.list.scrollY(-140*ig.system.tick)}if(this.addEntries){if(this.currentIndex>
0){if(this.scoreDotPitch<1.5)this.scoreDotPitch=this.scoreDotPitch+0.6*ig.system.tick;this.scoreDotSound.play(false,{speed:this.scoreDotPitch})}if(this.timer<=0)if(this.currentIndex==-1){this.timer=0.1;this.currentIndex=0}else{if(!this.initGui){this.time.setTime(sc.arena.runtime.timer);this.rushChain.setValueAsNumber(sc.arena.getCupProgress(this.cup).rush.chain);this.initGui=true}var b=this.entries[this.currentIndex],a=new sc.ArenaCupOverview.MedalEntry(b.id,b.medal),d=~~(b.id/10);a.setPos(1+b.id%
10*18,2+d*18);this.medals.addChildGui(a);this.totalValue=this.totalValue+b.points;this.total.setValueAsNumber(this.totalValue);this.currentIndex++;this.medals.hook.size.y=2+(d+1)*18;this.list.recalculateScrollBars(true);this.list.setScrollY(this.medals.hook.size.y,false,0.1,KEY_SPLINES.LINEAR);this.timer=0.1;if(this.currentIndex>=this.entries.length){this.addEntries=false;this.done=true;this.timer=0.2;this.medalHeader&&this.medalHeader.doStateTransition("DEFAULT");this.medalFooter&&this.medalFooter.doStateTransition("DEFAULT",
false,false,null,0.4)}}else this.timer=this.timer-ig.system.tick}else if(this.done&&this.timer>0){this.timer=this.timer-ig.system.tick;if(this.scoreDotPitch<1.5)this.scoreDotPitch=this.scoreDotPitch+0.6*ig.system.tick;this.scoreDotSound.play(false,{speed:this.scoreDotPitch});if(this.timer<=0){this.totalOverlay.setMaxNumber(this.totalValue);this.totalOverlay.setNumber(this.totalValue,true);this.totalOverlay.doStateTransition("DEFAULT",false,false,function(){this.totalOverlay.doStateTransition("HIDDEN")}.bind(this));
this.scoreCountSound.play();this.state=1;this.effect&&this.effect.show(this.medalType,false)}}},updateDrawables:function(b){b.addColor("#000",0,0,this.hook.size.x,this.hook.size.y)},show:function(){ig.interact.addEntry(this.interact);this.blockTimer=0.2;this.addMedals();this.msgBox.doStateTransition("DEFAULT");this.doStateTransition("DEFAULT")},hide:function(){this.addEntries=false;this.blockTimer=1;this.effect&&this.effect.hide(true);ig.interact.removeEntry(this.interact);ig.interact.setBlockDelay(0.2);
this.msgBox.doStateTransition("HIDDEN");this.doStateTransition("HIDDEN",false,true)},addMedals:function(){this.medals.removeAllChildren();this.list.recalculateScrollBars(true);var b=sc.arena.runtime.rushScores;if(b)for(var a=0;a<b.length;a++){var d=b[a];this.entries.push({id:a,medal:d.medal||0,time:d.time||0,points:d.points||0})}else throw Error("No Round Progress found: "+this.cup);this.totalValue=0;this.addEntries=true;this.currentIndex=-1;this.timer=0.1},skip:function(){if(!this.done&&this.addEntries){this.addEntries=
false;if(this.currentIndex<0)this.currentIndex=0;for(var b=this.currentIndex;b<this.entries.length;b++){var a=this.entries[this.currentIndex],d=new sc.ArenaCupOverview.MedalEntry(a.id,a.medal,true),c=~~(a.id/10);d.setPos(1+a.id%10*18,2+c*18);this.medals.addChildGui(d);this.totalValue=this.totalValue+a.points;this.currentIndex++;this.medals.hook.size.y=2+(c+1)*18}this.total.setValueAsNumber(this.totalValue,true);this.list.recalculateScrollBars(true);this.list.setScrollY(this.medals.hook.size.y,false,
0.1,KEY_SPLINES.LINEAR);if(!this.initGui){this.time.setTime(sc.arena.runtime.timer,true);this.initGui=true}this.medalHeader&&this.medalHeader.doStateTransition("DEFAULT");this.medalFooter&&this.medalFooter.doStateTransition("DEFAULT");this.rushChain.setValueAsNumber(sc.arena.getCupProgress(this.cup).rush.chain);this.totalOverlay.setMaxNumber(this.totalValue);this.totalOverlay.setNumber(this.totalValue,true);this.totalOverlay.doStateTransition("DEFAULT",false,false,function(){this.totalOverlay.doStateTransition("HIDDEN")}.bind(this));
this.scoreCountSound.play();this.effect&&this.effect.show(this.medalType,false);this.timer=0;this.done=true}},onInteraction:function(){if(this.state==0){this.blockTimer=0.2;this.skip();this.state=1}else{this.hide();this.callback&&this.callback()}}})});ig.baked=!0;
ig.module("game.feature.arena.gui.arena-gui").requires("impact.feature.rumble.rumble","impact.feature.gui.gui","impact.feature.gui.base.basic-gui","impact.feature.gui.base.box","game.feature.gui.base.boxes","game.feature.arena.arena","game.feature.gui.hud.right-hud","game.feature.gui.base.text","game.feature.menu.gui.menu-misc","game.feature.menu.gui.arena.arena-misc","game.feature.arena.gui.arena-effect-display","game.feature.arena.gui.arena-round-gui","game.feature.arena.gui.arena-trophy-gui","game.feature.arena.gui.arena-rush-gui").defines(function(){sc.ArenaPlayerDeathOverlay=
ig.GuiElementBase.extend({transitions:{DEFAULT:{state:{},time:0.5,timeFunction:KEY_SPLINES.LINEAR},HIDDEN:{state:{},time:0.3,timeFunction:KEY_SPLINES.LINEAR}},done:false,init:function(){this.parent();this.setSize(ig.system.width,ig.system.height);this.hook.zIndex=98;this.header=new sc.ArenaRoundEndHeader;this.addChildGui(this.header);this.info=new sc.InfoBar(null,null,true);this.info.setAlign(ig.GUI_ALIGN_X.LEFT,ig.GUI_ALIGN_Y.BOTTOM);this.info.setPos(0,1);this.info.doStateTransition("DEFAULT");this.addChildGui(this.info);
this.buttons=new sc.ArenaRoundEndButtons(function(a,b){if(a)if(b==0){sc.arena.restartCup();this.hide();sc.commonEvents.startCallEvent("arena-teleport")}else{if(b==1){sc.arena.prepareLobbyReturn();this.hide();sc.commonEvents.startCallEvent("arena-end-cup")}}else if(b==0){sc.arena.startNextRound(false);this.hide();sc.commonEvents.startCallEvent("arena-teleport")}else if(b==1){this.overview=new sc.ArenaCupOverview(sc.arena.runtime.cup,function(){this.overview=null}.bind(this),true);ig.gui.addGuiElement(this.overview);
this.overview.show()}else if(b==2){sc.arena.prepareLobbyReturn();this.hide();sc.commonEvents.startCallEvent("arena-end-cup")}}.bind(this),this.info,true);this.addChildGui(this.buttons)},show:function(){this.header.show(function(){this.buttons.show()}.bind(this),ig.lang.get("sc.gui.arena.roundFail"));this.doStateTransition("DEFAULT",true)},hide:function(){this.buttons.hide();this.header.hide();this.doStateTransition("HIDDEN",false,true)}});sc.ArenaRoundEndOverlay=ig.GuiElementBase.extend({transitions:{DEFAULT:{state:{},
time:0.5,timeFunction:KEY_SPLINES.LINEAR},HIDDEN:{state:{},time:0.3,timeFunction:KEY_SPLINES.LINEAR}},interact:null,header:null,summary:null,medal:null,coins:null,buttons:null,info:null,rushChain:null,overview:null,done:false,state:0,waitTimer:0,initTimer:0,init:function(){this.parent();this.setSize(ig.system.width,ig.system.height);this.hook.zIndex=102;this.interact=new sc.ScreenInteractEntry(this,false);this.header=new sc.ArenaRoundEndHeader;this.addChildGui(this.header);this.rushChain=new sc.ArenaChainHud(true);
this.addChildGui(this.rushChain);this.summary=new sc.ArenaSummary(function(){if(this.state==0){this.state=1;this.waitTimer=0.4;this.checkNewRecord()}}.bind(this));if(!sc.arena.isCupCustom(sc.arena.runtime.cup)){this.coins=new sc.ArenaCoinsHud;this.addChildGui(this.coins)}this.medal=new sc.ArenaMedalHud(function(){if(this.state==1){this.state=2;this.waitTimer=0.2;this.saveScore();this.coins&&this.coins.show()}}.bind(this));this.addChildGui(this.medal);this.info=new sc.InfoBar(null,null,true);this.info.setAlign(ig.GUI_ALIGN_X.LEFT,
ig.GUI_ALIGN_Y.BOTTOM);this.info.setPos(0,1);this.info.doStateTransition("DEFAULT");this.addChildGui(this.info);this.buttons=new sc.ArenaRoundEndButtons(function(a,b,c){if(a)if(c)if(b==0){ig.bgm.pause("FAST_OUT");sc.arena.restartCup();this.hide();sc.commonEvents.startCallEvent("arena-teleport")}else if(b==1){this.overview=new sc.ArenaCupOverview(sc.arena.runtime.cup,function(){this.overview=null}.bind(this),true);ig.gui.addGuiElement(this.overview);this.overview.show()}else{if(b==2){sc.arena.prepareLobbyReturn();
this.hide();sc.commonEvents.startCallEvent("arena-end-cup")}}else if(b==0){sc.arena.startNextRound(b==0);this.hide();sc.commonEvents.startCallEvent("arena-teleport")}else if(b==1){ig.bgm.pause("FAST_OUT");sc.arena.restartCup();this.hide();sc.commonEvents.startCallEvent("arena-teleport")}else{if(b==2){sc.arena.prepareLobbyReturn();this.hide();sc.commonEvents.startCallEvent("arena-end-cup")}}else if(b<=1){sc.arena.startNextRound(b==0);this.hide();sc.commonEvents.startCallEvent("arena-teleport")}else if(b==
2){this.overview=new sc.ArenaCupOverview(sc.arena.runtime.cup,function(){this.overview=null}.bind(this),true);ig.gui.addGuiElement(this.overview);this.overview.show()}else if(b==3){sc.arena.prepareLobbyReturn();this.hide();sc.commonEvents.startCallEvent("arena-end-cup")}}.bind(this),this.info);this.addChildGui(this.buttons);this.doStateTransition("HIDDEN",true)},update:function(){!this.overview&&!this.buttons.dialogBlock&&this.summary&&this.summary.updateScroll();if(this.initTimer>0)this.initTimer=
this.initTimer-ig.system.tick;if(this.waitTimer>0){this.waitTimer=this.waitTimer-ig.system.rawTick;if(this.waitTimer<=0)if(this.state==1)this.medal.show(sc.arena.getMedalForCurrentRound(this.summary.totalValue));else if(this.state==2)this.buttons.show();else if(this.state==3){this.overview=new sc.ArenaCupOverview(sc.arena.runtime.cup,function(){this.state=2;this.waitTimer=0.2;this.overview=null}.bind(this));ig.gui.addGuiElement(this.overview);this.overview.show(ig.lang.get("sc.gui.arena.newTrophy"))}else if(this.state==
4){var a=sc.arena.saveRushScore();this.overview=new sc.ArenaRushOverview(function(){this.coins&&this.coins.addRushCoins();this.state=a?3:2;this.waitTimer=0.2;this.overview=null}.bind(this));ig.gui.addGuiElement(this.overview);this.overview.show()}}},checkNewRecord:function(){if(sc.arena.isScoreNewRecord(this.summary.totalValue)){sc.commonEvents.startCallEvent("arena-new-record");var a=new sc.SmallEntityBox(ig.game.playerEntity,ig.lang.get("sc.gui.arena.newRecord"),3,null,10);a.hideSmall=true;a.stopRumble();
this.addChildGui(a)}},saveScore:function(){if(sc.arena.saveScore(this.summary.totalValue)&&!sc.arena.runtime.rush)this.state=3;if(sc.arena.runtime.rush&&sc.arena.isCurrentRoundLast())this.state=4},onInteraction:function(){if(!(this.waitTimer>0||this.initTimer>0))if(this.state==0){this.summary.skip();this.state=1;this.waitTimer=0.2;this.checkNewRecord()}else if(this.state==1){this.state=2;this.waitTimer=0.2;this.saveScore();this.coins&&this.coins.show(true)}},show:function(){this.initTimer=0.8;ig.interact.addEntry(this.interact);
sc.gui.rightHudPanel.addHudBoxBefore(this.summary,sc.gui.moneyHud);this.header.show(function(){this.summary.show()}.bind(this));var a=sc.arena.runtime;if(a.rush&&a.chain>1){a.chainGui.doPosTranstition(0,40,0.2,KEY_SPLINES.EASE);this.rushChain.show();this.rushChain.animateChainNumber(0,a.rushChain,0.4)}this.doStateTransition("DEFAULT",true)},hide:function(){this.buttons.hide();this.medal.hide();this.coins&&this.coins.hide();this.summary.remove();this.header.hide();this.info.setText("",0.1);this.rushChain.hide();
ig.interact.removeEntry(this.interact);this.doStateTransition("HIDDEN",false,true)}});var b={x:0,y:0};sc.ArenaChainHud=ig.GuiElementBase.extend({transitions:{DEFAULT:{state:{},time:0.2,timeFunction:KEY_SPLINES.LINEAR},HIDDEN:{state:{alpha:0},time:0.2,timeFunction:KEY_SPLINES.LINEAR}},ninepatch:new ig.NinePatch("media/gui/message.png",{width:12,height:0,left:12,top:12,right:0,bottom:0,offsets:{"default":{x:49,y:32}}}),panel:null,text:null,number:null,pulsing:false,timer:null,initNumber:null,targetNumber:null,
done:null,chainSound:new ig.Sound("media/sound/arena/chain-counter.ogg",0.7),init:function(a){this.parent();this.setSize(58,18);this.setAlign(ig.GUI_ALIGN_X.RIGHT,ig.GUI_ALIGN_Y.BOTTOM);this.setPos(0,22);this.hook.zIndex=99;this.panel=new ig.BoxGui(58,12,false,this.ninepatch);this.panel.hook.localAlpha=0.5;this.panel.hook.transitions={DEFAULT:{state:{},time:0.2,timeFunction:KEY_SPLINES.LINEAR},HIDDEN:{state:{alpha:0,scaleY:0},time:0.2,timeFunction:KEY_SPLINES.LINEAR}};this.panel.setAlign(ig.GUI_ALIGN_X.RIGHT,
ig.GUI_ALIGN_Y.CENTER);this.panel.setPos(0,0);this.addChildGui(this.panel);this.text=new sc.TextGui(ig.lang.get("sc.gui.arena."+(a?"rushChain":"chain")));this.text.setAlign(ig.GUI_ALIGN_X.RIGHT,ig.GUI_ALIGN_Y.CENTER);this.text.setPos(4,0);this.panel.addChildGui(this.text);this.panel.setSize(4+this.text.hook.size.x+24,12);this.number=new sc.ArenaChainHud.Number(a);this.number.setAlign(ig.GUI_ALIGN_X.RIGHT,ig.GUI_ALIGN_Y.TOP);this.number.setPos(4+this.text.hook.size.x+1,1);this.addChildGui(this.number);
this.hide(true)},update:function(){if(this.animating){this.timer&&this.timer.tick();var a=this._getCurrentNumber();this.number.setChainNumber(a);if(this.timer.done())this.animating=false}},show:function(){this.panel.doStateTransition("DEFAULT");this.number.doStateTransition("DEFAULT",true)},hide:function(a){this.panel.doStateTransition("HIDDEN",a);this.number.doStateTransition("HIDDEN",a)},animateChainNumber:function(a,b,c){if(!this.timer)this.timer=new ig.WeightTimer(true);this.animating=true;this.timer.set(c||
0.2);this.initNumber=a||0;this.targetNumber=b||0},setChainNumber:function(a,b){if(a>=2){this.show();this.number.setChainNumber(a);var c=0.9+Math.min(5,a)/5*0.7;this.chainSound.play(false,{speed:c})}else{this.pulsing=false;this.number.setPulse(false);this.hide(b)}},setPulse:function(a){this.pulsing=a||false;this.number.setPulse(a)},rumble:function(){this.number.rumble()},_getCurrentNumber:function(){if(this.timer.done())return this.targetNumber;var a=this.timer.get();return Math.floor((1-a)*this.initNumber+
a*this.targetNumber)}});sc.ArenaChainHud.Number=ig.GuiElementBase.extend({transitions:{DEFAULT:{state:{},time:0.2,timeFunction:KEY_SPLINES.LINEAR},HIDDEN:{state:{alpha:0},time:0.2,timeFunction:KEY_SPLINES.LINEAR}},one:null,ten:null,hun:null,init:function(a){this.parent();this.setSize(39,15);this.one=new sc.ArenaChainHud.Digit(a);this.one.setAlign(ig.GUI_ALIGN_X.RIGHT,ig.GUI_ALIGN_Y.TOP);this.addChildGui(this.one);this.ten=new sc.ArenaChainHud.Digit(a);this.ten.setAlign(ig.GUI_ALIGN_X.RIGHT,ig.GUI_ALIGN_Y.TOP);
this.ten.setPos(13,0);this.addChildGui(this.ten);this.hun=new sc.ArenaChainHud.Digit(a);this.hun.setAlign(ig.GUI_ALIGN_X.RIGHT,ig.GUI_ALIGN_Y.TOP);this.hun.setPos(26,0);this.addChildGui(this.hun);this.setChainNumber(-1)},setChainNumber:function(a){var b=Math.floor(a/10)%10;b<=0&&(b=-1);var c=Math.floor(a/100)%10;c<=0&&(c=-1);this.one.setDigit(a%10);this.ten.setDigit(b);this.hun.setDigit(c)},setPulse:function(a){this.one.setPulse(a);this.ten.setPulse(a);this.hun.setPulse(a)},rumble:function(){this.one.rumble();
this.ten.rumble();this.hun.rumble()}});sc.ArenaChainHud.Digit=ig.GuiElementBase.extend({gfx:new ig.Image("media/gui/basic.png"),transitions:{DEFAULT:{state:{},time:0.2,timeFunction:KEY_SPLINES.LINEAR},HIDDEN:{state:{alpha:0},time:0.2,timeFunction:KEY_SPLINES.LINEAR},LIT:{state:{scaleX:1.3,scaleY:1.3},time:0.1,timeFunction:KEY_SPLINES.LINEAR}},digit:-1,timer:0,rumbleHandle:0,pulsing:false,pulseAfter:false,rush:false,init:function(a){this.parent();this.setSize(14,15);this.setPivot(7,7.5);this.rush=
a||false},setDigit:function(a,b){this.digit=a;if(this.digit<0){this.timer=0;this.doStateTransition("HIDDEN",b)}else if(b){this.timer=0;this.doStateTransition("DEFAULT")}else{this.timer=0.2;this.doStateTransition("DEFAULT",true);this.doStateTransition("LIT",false,false,function(){this.doStateTransition("DEFAULT")}.bind(this))}},setPulse:function(a){this.pulsing=a||false;if(this.rumbleHandle&&a)this.pulseAfter=true;else if(this.pulsing){this.rumbleHandle=new ig.Rumble.RumbleHandle("RANDOM","WEAKESTEST",
"FASTEST",-1);this.alphaTimer=1;this.alpha=0}else this.rumbleHandle=null},rumble:function(){this.rumbleHandle=new ig.Rumble.RumbleHandle("RANDOM","WEAKER","FASTEST",0.2);this.timer=0.2},update:function(){if(this.timer>0){this.timer=this.timer-ig.system.tick;if(this.timer<0)this.timer=0}if(this.pulsing){this.alphaTimer=(this.alphaTimer+ig.system.actualTick)%1;var a=this.alphaTimer/1,a=KEY_SPLINES.EASE_IN_OUT.get(1-(a>0.5?1-(a-0.5)*2:a*2));this.alpha=a*0.5}this.rumbleHandle&&this.rumbleHandle.update();
if(this.rumbleHandle&&this.rumbleHandle.isDone()){this.rumbleHandle=null;this.pulseAfter&&this.setPulse(this.pulsing)}},updateDrawables:function(a){if(this.digit>=0){var d=this.rumbleHandle?this.rumbleHandle.offset:b;a.addGfx(this.gfx,d.x,d.y,this.digit*13,this.rush?141:96,13,15);this.pulsing&&a.addGfx(this.gfx,d.x,d.y,this.digit*13,126,13,15).setAlpha(this.alpha);this.timer>0&&a.addGfx(this.gfx,d.x,d.y,this.digit*13,111,13,15).setAlpha(this.timer/0.2)}}});sc.ArenaChallengeOverlay=sc.SideBoxGui.extend({init:function(){this.parent(false,
ig.lang.get("sc.gui.arena.menu.challenges"));this.setAlign(ig.GUI_ALIGN.X_LEFT,ig.GUI_ALIGN.Y_BOTTOM);this.setPos(0,2);this.hook.pauseGui=true;this.hook.zIndex=101;this.doStateTransition("HIDDEN")},setChallengeMods:function(a){this.hide(true);this.clearContent();var b=0,c=new ig.GuiElementBase,e;for(e in a){a=new sc.ArenaChallengeEntry(e,260);if(b){var f=new ig.ColorGui("#545454",270,1);f.setPos(-2,-3);a.addChildGui(f)}a.setPos(0,b);c.addChildGui(a);b=b+a.hook.size.y}c.setSize(260,b-4);this.pushContent(c)}})});
ig.baked=!0;
ig.module("game.feature.arena.gui.arena-start-gui").requires("impact.feature.rumble.rumble","impact.feature.gui.gui","impact.feature.gui.base.basic-gui","impact.feature.gui.base.box","game.feature.gui.hud.right-hud","game.feature.gui.base.text","game.feature.menu.gui.menu-misc","game.feature.menu.gui.arena.arena-misc").defines(function(){sc.ArenaRoundStartHud=ig.GuiElementBase.extend({transitions:{DEFAULT:{state:{},time:0.2,timeFunction:KEY_SPLINES.LINEAR},HIDDEN:{state:{alpha:0,scaleY:0.2},time:0.2,
timeFunction:KEY_SPLINES.LINEAR}},timer:0,done:false,round:null,name:null,container:null,init:function(){this.parent();this.setAlign(ig.GUI_ALIGN_X.LEFT,ig.GUI_ALIGN_Y.CENTER);this.setSize(ig.system.width,40);this.setPivot(0,this.hook.size.y/2);this.setPos(0,-80);this.hook.zIndex=99;this.timer=2;var b=sc.arena.runtime.currentRound,a=sc.arena.getCurrentRound(),d=ig.lang.get("sc.gui.arena.round"),d=d.replace("[!]",b+1);this.round=new sc.TextGui(d);this.round.setAlign(ig.GUI_ALIGN_X.CENTER,ig.GUI_ALIGN_Y.TOP);
this.round.hook.transitions={DEFAULT:{state:{offsetX:5},time:2,timeFunction:KEY_SPLINES.LINEAR},CENTER:{state:{offsetX:-5},time:0.2,timeFunction:KEY_SPLINES.LINEAR},HIDDEN:{state:{alpha:0,offsetX:-100},time:0.2,timeFunction:KEY_SPLINES.LINEAR},AWAY:{state:{alpha:0,offsetX:100},time:0.2,timeFunction:KEY_SPLINES.LINEAR}};this.round.doStateTransition("HIDDEN",true);this.round.setPos(0,4);this.addChildGui(this.round);b=sc.arena.runtime.challengeMods;this.container=new ig.GuiElementBase;this.container.setAlign(ig.GUI_ALIGN_X.LEFT,
ig.GUI_ALIGN_Y.CENTER);this.container.setPos(10,0);var c=d=0,e=0,f;for(f in b){var g=new sc.ArenaRoundStartHud.ChallengeEntry(f,b[f].global);g.setPos(d,c);d=d+19;e++;if(e>=10){c=c+19;d=0}this.container.addChildGui(g)}this.container.setSize(190,18*(~~(e/10)+1));this.addChildGui(this.container);this.name=new sc.TextGui(ig.LangLabel.getText(a.name));this.name.setAlign(ig.GUI_ALIGN_X.CENTER,ig.GUI_ALIGN_Y.BOTTOM);this.name.hook.transitions={DEFAULT:{state:{offsetX:-5},time:2,timeFunction:KEY_SPLINES.LINEAR},
CENTER:{state:{offsetX:5},time:0.2,timeFunction:KEY_SPLINES.LINEAR},HIDDEN:{state:{alpha:0,offsetX:100},time:0.2,timeFunction:KEY_SPLINES.LINEAR},AWAY:{state:{alpha:0,offsetX:-100},time:0.2,timeFunction:KEY_SPLINES.LINEAR}};this.name.doStateTransition("HIDDEN",true);this.name.setPos(0,4);this.addChildGui(this.name);this.doStateTransition("HIDDEN",true);this.doStateTransition("DEFAULT");this.round.doStateTransition("CENTER",false,false,function(){this.round.doStateTransition("DEFAULT",false,false,
function(){this.round.doStateTransition("AWAY")}.bind(this))}.bind(this));this.name.doStateTransition("CENTER",false,false,function(){this.name.doStateTransition("DEFAULT",false,false,function(){this.name.doStateTransition("AWAY")}.bind(this))}.bind(this))},updateDrawables:function(b){var a=this.hook.size;b.addColor("#000",0,0,a.x,a.y).setAlpha(0.5);b.addColor("#FFF",0,1,a.x,1).setAlpha(0.5);b.addColor("#FFF",0,a.y-2,a.x,1).setAlpha(0.5)},update:function(){if(this.timer>=0&&!this.hasTransition()){this.timer=
this.timer-ig.system.tick;this.timer<=0&&this.doStateTransition("HIDDEN",false,true,function(){this.done=true}.bind(this))}}});sc.ArenaRoundStartHud.ChallengeEntry=ig.GuiElementBase.extend({gfx:new ig.Image("media/gui/arena-gui.png"),transitions:{DEFAULT:{state:{},time:0.2,timeFunction:KEY_SPLINES.LINEAR},HIDDEN:{state:{alpha:0},time:0.2,timeFunction:KEY_SPLINES.LINEAR}},icon:0,challenge:null,global:false,init:function(b,a){this.parent();this.setSize(18,18);this.global=a||false;this.challenge=sc.ARENA_CHALLENGES[b||
"NO_MELEE"];this.icon=this.challenge.icon||1},updateDrawables:function(b){b.addGfx(this.gfx,0,0,256+this.icon%6*18,~~(this.icon/6)*18,18,18);this.global&&b.addGfx(this.gfx,0,0,128,48,18,18)}})});ig.baked=!0;
ig.module("game.feature.arena.arena-steps").requires("impact.base.action","impact.base.entity","impact.feature.camera.camera","game.feature.arena.arena","game.feature.arena.gui.arena-gui","game.feature.arena.gui.arena-start-gui").defines(function(){ig.EVENT_STEP.RESET_ARENA_CHAIN=ig.EventStepBase.extend({_wm:new ig.Config({attributes:{}}),start:function(){sc.arena.active&&sc.arena.resetChain()}});ig.EVENT_STEP.INCREASE_ARENA_CHAIN=ig.EventStepBase.extend({_wm:new ig.Config({attributes:{amount:{_type:"Integer",
_info:"Increases the chain by the given amount",_default:1}}}),amount:0,init:function(b){this.amount=b.amount||1},start:function(){sc.arena.active&&sc.arena.increaseChain(this.amount)}});ig.EVENT_STEP.ADD_ARENA_SCORE_IGNORE=ig.EventStepBase.extend({_wm:new ig.Config({attributes:{scoreType:{_type:"Select",_info:"Score type to ignore, gets reset every round.",_select:sc.ARENA_SCORE_TYPES}}}),scoreType:null,init:function(b){this.scoreType=b.scoreType||null},start:function(){this.scoreType&&sc.arena.addScoreIgnore(this.scoreType)}});
ig.EVENT_STEP.REMOVE_ARENA_SCORE_IGNORE=ig.EventStepBase.extend({_wm:new ig.Config({attributes:{scoreType:{_type:"Select",_info:"Score type to remove, gets reset every round.",_select:sc.ARENA_SCORE_TYPES}}}),scoreType:null,init:function(b){this.scoreType=b.scoreType||null},start:function(){this.scoreType&&sc.arena.removeScoreIgnore(this.scoreType)}});ig.EVENT_STEP.CLEAR_ARENA_SCORE_IGNORE=ig.EventStepBase.extend({_wm:new ig.Config({attributes:{}}),start:function(){sc.arena.clearScoreIgnore()}});
ig.EVENT_STEP.ADD_ARENA_IGNORE_TYPE=ig.EventStepBase.extend({_wm:new ig.Config({attributes:{enemy:{_type:"EnemySearch",_info:"Enemy to ignore. Will be cleared each round."}}}),enemy:null,init:function(b){this.enemy=b.enemy||null},start:function(){this.enemy&&sc.arena.addEnemyIgnore(this.enemy)}});ig.EVENT_STEP.ADD_ARENA_SCORE=ig.EventStepBase.extend({_wm:new ig.Config({attributes:{type:{_type:"Select",_info:"Type of the score. This is used to for the list at the end of the round.",_select:sc.ARENA_SCORE_TYPES,
_default:"KILL"}}}),type:null,init:function(b){this.type=b.type||null},start:function(){this.type&&this.arena.addScore(this.type)}});ig.EVENT_STEP.OPEN_ARENA_MENU=ig.EventStepBase.extend({arenaCache:null,custom:false,noWait:false,_wm:new ig.Config({attributes:{custom:{_type:"Boolean",_info:"If true, open menu for custom cups."},noWait:{_type:"Boolean",_info:"If true, do not wait for menu to be closed in order to continue events",_optional:true}}}),init:function(b){this.custom=b.custom||false;this.noWait=
b.noWait||false;this.arenaCache=new sc.ArenaCache},start:function(){sc.menu.arenaCustomMode=this.custom;sc.menu.setDirectMode(true,sc.MENU_SUBMENU.ARENA);sc.model.enterMenu(true);sc.model.prevSubState=sc.GAME_MODEL_SUBSTATE.RUNNING},run:function(){return this.noWait?true:!sc.menu.menuEntered},clearCached:function(){this.arenaCache.decreaseRef()}});ig.EVENT_STEP.START_ARENA_CUP=ig.EventStepBase.extend({_wm:new ig.Config({attributes:{}}),init:function(){},start:function(){if(sc.arena.active){var b=
sc.arena.runtime;if(b){sc.arena.isCupSolo(b.cup)&&sc.arena.stashPartyMembers();b=b.rounds[b.currentRound];ig.game.teleport(b.map,b.spawn?new ig.TeleportPosition(b.spawn):null)}}}});ig.EVENT_STEP.END_ARENA_CUP=ig.EventStepBase.extend({_wm:new ig.Config({attributes:{}}),init:function(){},start:function(){sc.arena.active&&sc.arena.exitArenaMode()}});ig.EVENT_STEP.CLEAR_ARENA_END_FLAG=ig.EventStepBase.extend({_wm:new ig.Config({attributes:{}}),init:function(){},start:function(){sc.arena.clearEndFlag()}});
ig.EVENT_STEP.SPAWN_ARENA_WAVE=ig.EventStepBase.extend({_wm:new ig.Config({attributes:{silent:{_type:"Boolean",_info:"If true, do now show any effects",_default:false},increase:{_type:"Boolean",_info:"If true, increase the current wave counter before spawning the wave",_default:false},focusPlayer:{_type:"Boolean",_info:"If true, enemies will focus the player. Only if this is true the drammatic effect is auto set",_default:true}}}),init:function(b){this.silent=b.silent||false;this.increase=b.increase||
false;this.focusPlayer=b.focusPlayer||false},start:function(){sc.arena.active&&sc.arena.spawnCurrentWave(this.silent,this.increase,this.focusPlayer)}});ig.EVENT_STEP.START_ARENA_ROUND=ig.EventStepBase.extend({_wm:new ig.Config({attributes:{scoreGui:{_type:"Boolean",_info:"Enable/Disable ScoreGui. Default is true",_optional:true,_default:true},timeGui:{_type:"Boolean",_info:"Enable/Disable Timer Gui. Default is true",_optional:true,_default:true}}}),score:true,time:true,init:function(b){this.score=
b.scoreGui!=void 0?b.scoreGui:true;this.time=b.timeGui!=void 0?b.timeGui:true},start:function(){sc.arena.active&&sc.arena.startRound(this.score,this.time)}});ig.EVENT_STEP.TP_TO_CUR_ARENA_ROUND=ig.EventStepBase.extend({_wm:new ig.Config({attributes:{}}),init:function(){},start:function(){sc.arena.active&&sc.arena.teleportToCurrentRound()}});ig.EVENT_STEP.PREP_ARENA_ROUND_END=ig.EventStepBase.extend({_wm:new ig.Config({attributes:{}}),start:function(){if(sc.arena.active)sc.arena.runtime.roundEndPre=
true}});ig.EVENT_STEP.END_ARENA_ROUND=ig.EventStepBase.extend({_wm:new ig.Config({attributes:{onDeath:{_type:"Boolean",_info:"If true, round was ended through player death",_optional:true,_default:true}}}),onDeath:false,init:function(b){this.onDeath=b.onDeath||false},start:function(){sc.arena.active&&(this.onDeath?sc.arena.endRoundDeath():sc.arena.endRound())},run:function(){return sc.arena._endRoundDone}});ig.EVENT_STEP.SHOW_ARENA_ROUND_GUI=ig.EventStepBase.extend({_wm:new ig.Config({attributes:{wait:{_type:"Boolean",
_info:"If true, wait until the gui has finished animating."}}}),init:function(b){this.wait=b.wait||false},start:function(b){var a=new sc.ArenaRoundStartHud;ig.gui.addGuiElement(a);if(this.wait)b._gui=a},run:function(b){return this.wait?b._gui.done:true}});ig.ACTION_STEP.ADD_ARENA_IGNORE_TYPE=ig.ActionStepBase.extend({_wm:new ig.Config({attributes:{enemy:{_type:"EnemySearch",_info:"Enemy to ignore. Will be cleared each round."}}}),enemy:null,init:function(b){this.enemy=b.enemy||null},start:function(){this.enemy&&
sc.arena.addEnemyIgnore(this.enemy)}})});ig.baked=!0;ig.module("game.feature.arena.plug-in").requires("game.feature.arena.arena","game.feature.arena.entities.arena-spawn","game.feature.arena.gui.arena-gui","game.feature.arena.arena-steps").defines(function(){if(window.wm){wm.postLoadModules.push("game.feature.arena.editors.arena-editors");wm.addStepColorRule(/ARENA/,"orange")}});ig.baked=!0;
ig.module("game.feature.new-game.new-game-steps").requires("impact.base.action","impact.base.event","game.feature.new-game.new-game-model").defines(function(){ig.EVENT_STEP.APPLY_NEW_GAME_DATA=ig.EventStepBase.extend({_wm:new ig.Config({attributes:{atRhombus:{_type:"Boolean",_info:"If true, apply data for when you start at Rhombus"}}}),init:function(b){this.atRhombus=b.atRhombus},start:function(){sc.newgame.applyStoreData(this.atRhombus)}})});ig.baked=!0;
ig.module("game.feature.new-game.plug-in").requires("game.feature.new-game.new-game-model","game.feature.new-game.new-game-steps").defines(function(){window.wm&&wm.postLoadModules.push("game.feature.new-game.editors.new-game-editors")});ig.baked=!0;
ig.module("game.feature.game-sense.game-sense-model").requires("impact.base.image","impact.base.game","game.feature.model.game-model","game.feature.model.options-model").defines(function(){ig.perf.gameSense=true;sc.GAME_SENSE_GAME="CROSS_CODE";sc.GAME_SENSE_DEVICE={KEYBOARD:"keyboard",MOUSE:"mouse",RGB_PER_KEY_ZONES:"rgb-per-key-zones"};sc.GAME_SENSE_ZONE={FUNCTION_KEYS:"function-keys",MAIN_KEYBOARD:"main-keyboard",KEYPAD:"keypad",NUMBER_KEYS:"number-keys",MACRO_KEYS:"macro-keys"};sc.GAME_SENSE_MODE=
{COLOR:"color",PERCENT:"percent",COUNT:"count"};sc.GAME_SENSE_ICON={NO_ICON:0,HEALTH:1,ARMOR:2,AMMUNITION:3,MONEY:4,FLASH_EXPLOSION:5,KILLS:6,HEADSHOT:7,HELMET:8,HUNGER:10,AIR_BREATH:11,COMPASS:12,TOOL_PICKAXE:13,MANA_POTION:14,CLOCK:15,LIGHTNING:16,ITEM_BACKPACK:17};sc.GameSense=ig.GameAddon.extend({controllers:[],active:false,url:null,_heartbeatTimer:0,_deferredStack:[],_prevOptionState:false,init:function(){this.parent("GameSense");if(ig.platform==ig.PLATFORM_TYPES.DESKTOP){this._createEndpoint();
sc.Model.addObserver(sc.model,this);sc.Model.addObserver(sc.options,this);this._prevOptionState=sc.options.get("game-sense")}},deferredUpdateOrder:600,onDeferredUpdate:function(){if(this.active){for(var b=this.controllers.length;b--;)if(this.controllers[b].isActive)this.controllers[b].onUpdate();if(ig.game.firstUpdateLoop&&this._heartbeatTimer>0){this._heartbeatTimer=this._heartbeatTimer-ig.system.rawTick;if(this._heartbeatTimer<=0){this.sendHeartbeat();this._heartbeatTimer=8}}}},onWindowFocusChanged:function(b){(!b&&
!sc.model.isTitle()||this.active)&&this.sendHeartbeat()},addController:function(b){b&&this.controllers.indexOf(b)==-1&&(this.active?this.controllers.push(b):this._deferredStack.push(b))},bindEventHandler:function(b,a){return this.post("bind_game_event",b,a)},sendSimpleEventUpdate:function(b,a,d){return this.post("game_event",{game:sc.GAME_SENSE_GAME,event:b,data:{value:a||0}},d)},post:function(b,a,d){if(this.active){var c=new XMLHttpRequest;c.addEventListener("error",function(){this.active=false}.bind(this));
c.addEventListener("abort",function(){this.active=false}.bind(this));try{c.open("POST",this.url+"/"+b,true);c.setRequestHeader("Content-Type","application/json");c.send(JSON.stringify(a));c.onreadystatechange=function(){c.readyState==XMLHttpRequest.DONE&&c.status==200&&d&&d()}}catch(e){this.active=false}return c}},startHeartbeat:function(){this._heartbeatTimer=8},sendHeartbeat:function(){this.post("game_heartbeat",{game:sc.GAME_SENSE_GAME});for(var b=this.controllers.length;b--;)if(this.controllers[b].isActive)this.controllers[b].onHeartBeat()},
endHeartbeat:function(){this._heartbeatTimer=0},modelChanged:function(b,a){if(b==sc.model){if(a==sc.GAME_MODEL_MSG.STATE_CHANGED)if(sc.model.isTitle()){this._disableControllers();this.endHeartbeat()}else if(sc.model.isGame()&&sc.options.get("game-sense")){this._bindHandlers();this.startHeartbeat()}}else if(b==sc.options&&a==sc.OPTIONS_EVENT.OPTION_CHANGED){var d=sc.options.get("game-sense");if(d!=this._prevOptionState){if(!sc.model.isTitle()&&d){this._bindHandlers();this.startHeartbeat();this.sendHeartbeat()}else if(!d){this._disableControllers();
this.endHeartbeat()}this._prevOptionState=d}}},_bindHandlers:function(){for(var b=this.controllers.length;b--;){this.controllers[b].isBound||this.controllers[b].bindHandler();this.controllers[b].isActive=true}},_disableControllers:function(){for(var b=this.controllers.length;b--;){this.controllers[b].isActive=false;this.controllers[b].deactivate&&this.controllers[b].deactivate()}},_createEndpoint:function(){var b;if(process.platform==="darwin")b="/Library/Application Support/SteelSeries Engine 3/coreProps.json";
else if(process.platform==="win32")b="%PROGRAMDATA%/SteelSeries/SteelSeries Engine 3/coreProps.json";else return;b=b.replace(/%([^%]+)%/g,function(a,b){return process.env[b]});window.require("fs").readFile(b,{encoding:"utf-8"},function(a,b){if(!a){var c=JSON.parse(b);if(c.address){this.url="http://"+c.address;this.active=true;ig.JSON_LOG&&ig.log("%cGAME SENSE: %cEndpoint Discovered: \n%O","color:#149AEB","",this.url);this._registerGame()}}}.bind(this))},_registerGame:function(){this.post("game_metadata",
{game:sc.GAME_SENSE_GAME,game_display_name:document.title,developer:"Radical Fish Games",deinitialize_timer_length_ms:1E4},function(){ig.JSON_LOG&&ig.log("%cGAME SENSE: %cGame Registered!","color:#149AEB","");for(var b=this._deferredStack.length;b--;)this.addController(this._deferredStack[b])}.bind(this))}});sc.GameSenseControllerBase=ig.Class.extend({isActive:false,isBound:false,bindHandler:function(){},onUpdate:function(){},onHeartBeat:function(){}});sc.GSHelper={color:function(b,a,d){return{red:b,
green:a,blue:d}},range:function(b,a,d,c,e){return{low:c,high:e,color:this.color(b,a,d)}}};ig.addGameAddon(function(){return sc.gamesense=new sc.GameSense})});ig.baked=!0;
ig.module("game.feature.game-sense.controllers.hp-controller").requires("impact.base.game","game.feature.model.base-model","game.feature.game-sense.game-sense-model").defines(function(){sc.GameSenseHPController=sc.GameSenseControllerBase.extend({init:function(){sc.Model.addObserver(sc.model.player.params,this);sc.Model.addObserver(sc.model.player,this)},bindHandler:function(){var b={game:sc.GAME_SENSE_GAME,event:"HEALTH_BAR",min_value:0,max_value:100,icon_id:1,handlers:[{"device-type":sc.GAME_SENSE_DEVICE.KEYBOARD,
zone:sc.GAME_SENSE_ZONE.FUNCTION_KEYS,color:[{low:0,high:33,color:sc.GSHelper.color(255,0,0)},{low:34,high:100,color:sc.GSHelper.color(0,255,0)}],mode:sc.GAME_SENSE_MODE.PERCENT,rate:{frequency:[{low:0,high:33,frequency:5}]}}]};sc.gamesense.bindEventHandler(b,function(){}.bind(this))},onHeartBeat:function(){this.updateHpValue()},updateHpValue:function(){if(this.isActive){var b=sc.model.player.params,b=Math.round(b.currentHp/b.getStat("hp")*100).limit(0,100);sc.gamesense.sendSimpleEventUpdate("HEALTH_BAR",
b)}},modelChanged:function(b,a){b==sc.model.player.params?(a==sc.COMBAT_PARAM_MSG.HP_CHANGED||a==sc.COMBAT_PARAM_MSG.STATS_CHANGED||a==sc.COMBAT_PARAM_MSG.RESET_STATS)&&this.updateHpValue():b==sc.model.player&&(a==sc.PLAYER_MSG.SET_PARAMS||a==sc.PLAYER_MSG.CONFIG_CHANGED)&&this.updateHpValue()}})});ig.baked=!0;
ig.module("game.feature.game-sense.controllers.element-controller").requires("impact.base.game","game.feature.model.base-model","game.feature.game-sense.game-sense-model").defines(function(){sc.GameSenseElementKey=ig.Class.extend({element:0,eventName:"ELEMENT_0",zone:"keyboard-5",color:null,value:0,init:function(b,a,d){this.element=b||0;this.eventName="ELEMENT_"+this.element;this.zone=d?"keyboard-"+d:"keyboard-5";this.color=a||sc.GSHelper.color(255,255,255)},bindHandler:function(){sc.gamesense.bindEventHandler({game:sc.GAME_SENSE_GAME,
event:this.eventName,min_value:0,max_value:1,handlers:[{"device-type":sc.GAME_SENSE_DEVICE.RGB_PER_KEY_ZONES,zone:this.zone,color:this.color,mode:sc.GAME_SENSE_MODE.COUNT}]})},updateElement:function(){var b=sc.model.player.getCore(this.element+8)?1:0;sc.gamesense.sendSimpleEventUpdate(this.eventName,b?1:0)}});sc.GameSenseElementController=sc.GameSenseControllerBase.extend({elements:[],init:function(){sc.Model.addObserver(sc.model.player,this);ig.storage.register(this);this.elements.push(new sc.GameSenseElementKey(sc.ELEMENT.COLD,
sc.GSHelper.color(0,200,255),1));this.elements.push(new sc.GameSenseElementKey(sc.ELEMENT.SHOCK,sc.GSHelper.color(180,0,255),2));this.elements.push(new sc.GameSenseElementKey(sc.ELEMENT.HEAT,sc.GSHelper.color(255,0,0),3));this.elements.push(new sc.GameSenseElementKey(sc.ELEMENT.WAVE,sc.GSHelper.color(0,255,120),4));this.elements.push(new sc.GameSenseElementKey(sc.ELEMENT.NEUTRAL,sc.GSHelper.color(255,255,255),5))},bindHandler:function(){var b={game:sc.GAME_SENSE_GAME,event:"LOGO_ELEMENT",min_value:0,
max_value:5,handlers:[{"device-type":sc.GAME_SENSE_DEVICE.RGB_PER_KEY_ZONES,zone:"logo",color:[sc.GSHelper.range(255,255,255,1,1),sc.GSHelper.range(255,0,0,2,2),sc.GSHelper.range(0,200,255,3,3),sc.GSHelper.range(180,0,255,4,4),sc.GSHelper.range(0,255,120,5,5)],mode:sc.GAME_SENSE_MODE.COUNT}]};sc.gamesense.bindEventHandler(b);for(b=this.elements.length;b--;)this.elements[b].bindHandler()},onHeartBeat:function(){this.updateElementKeys()},deactivate:function(){for(var b=this.elements.length;b--;)this.elements[b].value=
0},updateElementKeys:function(){if(this.isActive){sc.gamesense.sendSimpleEventUpdate("LOGO_ELEMENT",sc.model.player.currentElementMode+1);for(var b=this.elements.length;b--;)this.elements[b].updateElement()}},modelChanged:function(b,a){if(b==sc.model.player&&(a==sc.PLAYER_MSG.ELEMENT_MODE_CHANGE||a==sc.PLAYER_MSG.CORE_CHANGED||sc.PLAYER_MSG.STATS_CHANGED))sc.model.isTitle()||this.updateElementKeys()}})});ig.baked=!0;
ig.module("game.feature.game-sense.plug-in").requires("game.feature.game-sense.game-sense-model","game.feature.game-sense.controllers.hp-controller","game.feature.game-sense.controllers.element-controller").defines(function(){});ig.baked=!0;
ig.module("game.features").requires("game.loader","game.constants","impact.feature.database.plug-in","impact.feature.gamepad.plug-in","impact.feature.base.plug-in","impact.feature.bgm.plug-in","impact.feature.event-sheet.plug-in","impact.feature.camera.plug-in","impact.feature.rumble.plug-in","impact.feature.slow-motion.plug-in","impact.feature.effect.plug-in","impact.feature.gui.plug-in","impact.feature.light.plug-in","impact.feature.height-map.plug-in","impact.feature.navigation.plug-in","impact.feature.map-content.plug-in",
"impact.feature.map-image.plug-in","impact.feature.overlay.plug-in","impact.feature.dream-fx.plug-in","impact.feature.parallax.plug-in","impact.feature.screen-blur.plug-in","impact.feature.terrain.plug-in","impact.feature.interact.plug-in","impact.feature.env-particles.plug-in","impact.feature.storage.plug-in","impact.feature.weather.plug-in","impact.feature.map-sounds.plug-in","impact.feature.nwf.plug-in","impact.feature.video.plug-in","impact.feature.influencer.plug-in","impact.feature.greenworks.plug-in",
"game.feature.version.plug-in","game.feature.timers.plug-in","game.feature.achievements.plug-in","game.feature.auto-control.plug-in","game.feature.inventory.plug-in","game.feature.font.font-system","game.feature.ar.plug-in","game.feature.base.plug-in","game.feature.bgm.plug-in","game.feature.character.plug-in","game.feature.combat.plug-in","game.feature.game-code.plug-in","game.feature.gui.plug-in","game.feature.map-content.plug-in","game.feature.model.plug-in","game.feature.skills.plug-in","game.feature.msg.plug-in",
"game.feature.interact.plug-in","game.feature.npc.plug-in","game.feature.player.plug-in","game.feature.puzzle.plug-in","game.feature.control.control","game.feature.menu.plug-in","game.feature.quick-menu.plug-in","game.feature.tutorial.plug-in","game.feature.trade.plug-in","game.feature.save-preset.plug-in","game.feature.xeno-dialogs.plug-in","game.feature.quest.plug-in","game.feature.party.plug-in","game.feature.common-event.plug-in","game.feature.voice-acting.plug-in","game.feature.credits.plug-in",
"game.feature.arena.plug-in","game.feature.new-game.plug-in","game.feature.game-sense.plug-in").defines(function(){});ig.baked=!0;
ig.module("game.feature.beta.beta-controls").requires("impact.base.game").defines(function(){sc.BetaControls=ig.GameAddon.extend({init:function(){this.parent("BetaControls")},postUpdateOrder:9E3,onPostUpdate:function(){ig.input.pressed("langedit")&&ig.langEdit&&ig.langEdit.showMask();ig.input.pressed("savedialog")&&window.SHOW_SAVE_DIALOG(ig.storage.getLastSlotData())}});sc.submitSaveImport=function(b){b&&ig.storage.pushSlotData(b)};ig.addGameAddon(function(){return sc.betaControls=new sc.BetaControls})});
ig.baked=!0;ig.module("game.feature.beta.plug-in").requires("game.feature.beta.beta-controls").defines(function(){});ig.baked=!0;
ig.module("impact.feature.lang-edit.lang-edit").requires("impact.base.game").defines(function(){ig.LANG_EDIT_API_BASE="https://www.cross-code.com/page/api/";ig.LANG_EDIT_SUBMIT_URL=ig.LANG_EDIT_API_BASE+"lang-edit-submit.php";ig.LANG_EDIT_OVERVIEW_URL=ig.LANG_EDIT_API_BASE+"lang-edit-overview.php";ig.LANG_EDIT_LIST_URL=ig.LANG_EDIT_API_BASE+"lang-edit-list.php";ig.LANG_EDIT_RESOLVE_URL=ig.LANG_EDIT_API_BASE+"lang-edit-resolve.php";ig.LANG_SEND_URL=ig.LANG_EDIT_API_BASE+"lang-send.php";ig.LANG_GET_URL=
ig.LANG_EDIT_API_BASE+"lang-get.php";ig.LANG_BATCHES_GET_URL=ig.LANG_EDIT_API_BASE+"lang-batches.php";ig.LangEdit=ig.GameAddon.extend({mapEntries:[],recentEntries:[],maskVisible:false,mask:null,form:null,panels:{user:null,map:null,recent:null},userName:null,userpassword:null,mapEntryList:null,saveLabel:null,errorLabel:null,init:function(){this.parent("LangEdit")},submitCustomFile:function(b,a,d,c){if(!a instanceof ig.LangLabel)throw Error("You can only submit langLabels to lang-edit");if(!c||!this.isWhatRecent(b)){this.recentEntries.push({what:b,
content:a,file:d});this.recentEntries.length>200&&this.recentEntries.shift()}},submitMap:function(b,a){if(!a instanceof ig.LangLabel)throw Error("You can only submit langLabels to lang-edit");this.mapEntries.push({what:b,content:a})},submitRecent:function(b,a){if(!a instanceof ig.LangLabel)throw Error("You can only submit langLabels to lang-edit");this.recentEntries.push({what:b,content:a});this.recentEntries.length>200&&this.recentEntries.shift()},isWhatRecent:function(b){for(var a=this.recentEntries.length;a--;)if(b==
this.recentEntries[a].what)return true;return false},toggleMask:function(){this.maskVisible?this.closeMask():this.showMask()},showMask:function(){this.maskVisible=true;ig.system.setFocusLost();this.mask||this._createMask();if(!this.mapEntryList)this.mapEntryList=this._createEntryList(this.mapEntries);this.mask.find(".map").empty().append(this.mapEntryList);this.mask.find(".recent").empty().append(this._createEntryList(this.recentEntries));this._resetEntryList(this.panels.map);if(localStorage.getItem("ccLangEditUser")){this.panels.user.hide();
this.userName.val(localStorage.getItem("ccLangEditUser"));this.userEmail.val(localStorage.getItem("ccLangEditEmail"));this._updateUserText()}else this.panels.user.show();this.panels.map.hide();this.panels.recent.show();this.mask.show();this.panels.recent[0].scrollTop=this.panels.recent[0].scrollHeight},closeMask:function(){this.maskVisible=false;ig.system.focusLost=false;this.mask.hide()},_createMask:function(){var b=ig.dom.create("div");b.addClass("langEdit");var a=ig.dom.create("div");a.addClass("container");
b.append(a);var d=ig.dom.html('<div class="header"></div>');d.append(ig.dom.html("<h2>"+ig.lang.get("sc.gui.lang-edit.title")+"</h2>"));var c=ig.dom.html("<button>"+ig.lang.get("sc.gui.lang-edit.map")+"</button>"),e=ig.dom.html("<button>"+ig.lang.get("sc.gui.lang-edit.recent")+"</button>"),f=ig.dom.html('<div class="userInfo" >'+ig.lang.get("sc.gui.lang-edit.user-prefix")+' <span class="name" ></span> (<span class="email"></span>) <a>'+ig.lang.get("sc.gui.lang-edit.user-edit")+"</a></div>");d.append(c);
d.append(e);d.append(f);var g=this.form=ig.dom.create("form"),h=this.panels.user=ig.dom.html('<div class="user"></div>');this.panels.user.append(ig.dom.html("<h2>"+ig.lang.get("sc.gui.lang-edit.user-credentials")+"</h2>"));this.userName=ig.dom.html('<input type="text" name="userName" placeholder="'+ig.lang.get("sc.gui.lang-edit.user-name")+'"/>');this.userEmail=ig.dom.html('<input type="text" name="userEmail" placeholder="'+ig.lang.get("sc.gui.lang-edit.user-email")+'"/>');this.panels.user.append(this.userName);
this.panels.user.append(this.userEmail);var i=ig.dom.html('<button type="button">'+ig.lang.get("sc.gui.lang-edit.submit")+"</button>");h.append(i);ig.dom.bind(i,"click",this._onUserSubmit.bind(this));var j=this.panels.map=ig.dom.html('<div class="map"></div>'),k=this.panels.recent=ig.dom.html('<div class="recent"></div>');g.append(j);g.append(k);g.append(h);var i=ig.dom.html('<div class="footer" ></div>'),l=ig.dom.html('<button type="submit">'+ig.lang.get("sc.gui.lang-edit.send-report")+"</button>"),
o=ig.dom.html('<button type="button">'+ig.lang.get("sc.gui.lang-edit.cancel")+"</button>");i.append(l);i.append(o);ig.dom.bind(c,"click",function(){j.show();k.hide()});ig.dom.bind(e,"click",function(){k.show();j.hide()});ig.dom.bind(f.find("a"),"click",function(){h.show()});this.saveLabel=ig.dom.html('<div class="saving" >'+ig.lang.get("sc.gui.lang-edit.sending")+"</div>");this.saveLabel.css({display:"none"});this.errorLabel=ig.dom.html('<div class="error" ><h2>'+ig.lang.get("sc.gui.lang-edit.error")+
"</h2><div></div></div>");this.errorLabel.css({display:"none"});ig.dom.bind(this.errorLabel,"click",function(){this.errorLabel.hide()}.bind(this));a.append(d);a.append(i);a.append(g);a.append(this.saveLabel);a.append(this.errorLabel);ig.dom.bind(a,"click",function(a){a=a.target;if(a.className=="original"){var b=$(a.parentNode),c=b.find(".modification"),d=b.find(".comment");if(b.hasClass("edit"))!d.val()&&c.val()==a.value&&b.removeClass("edit");else{b.addClass("edit");c.select()}}});ig.dom.bind(o,
"click",this.closeMask.bind(this));ig.dom.bind(l,"click",this._submit.bind(this));this.mask=b;this.mask.hide();document.body.appendChild(this.mask[0])},_createEntryList:function(b){for(var a=ig.dom.create("ul"),d=0;d<b.length;++d){var c=b[d],e=ig.dom.create("li"),f=ig.dom.create("label");f.text(c.what&&c.what.toString());var g=ig.dom.html('<input type="hidden" readonly name="id[]" class="id">'),h=Math.abs(c.content.langUid);g.val(h);var i=c.file;if(!i)i=c.content.originFile;h=ig.dom.html('<input type="hidden" readonly name="file[]" class="file">');
h.val(i);i=ig.dom.html('<textarea readonly name="original[]" class="original"></textarea>');i.val(c.content.toString());var j=ig.dom.html('<textarea name="modification[]" class="modification"></textarea>');j.val(c.content.toString());c=ig.dom.html('<textarea name="comment[]" class="comment" placeholder="'+ig.lang.get("sc.gui.lang-edit.comment")+'"></textarea>');e.append(g);e.append(h);e.append(f);e.append(i);e.append(j);e.append(c);a.append(e)}return a},_resetEntryList:function(b){b.find("li.edit").each(function(){var a=
$(this);a.find(".modification").val(a.find(".original").val());a.find(".comment").val("");a.removeClass("edit")})},_onUserSubmit:function(){localStorage.setItem("ccLangEditUser",this.userName.val());localStorage.setItem("ccLangEditEmail",this.userEmail.val());this.panels.user.hide();this._updateUserText()},_updateUserText:function(){this.mask.find(".userInfo .name").text(this.userName.val());this.mask.find(".userInfo .email").text(this.userEmail.val())},_submit:function(){var b={userName:this.userName.val(),
userEmail:this.userEmail.val(),map:ig.game.mapName.toPath("data/maps/",".json"),lang:ig.currentLang,changes:[]};this.mask.find("li.edit").each(function(){var a=$(this),c=a.find(".id").val(),e=a.find(".original").val(),f=a.find(".modification").val(),g=a.find(".comment").val(),a=a.find(".file").val()||null;(e!=f||g)&&b.changes.push({id:c,original:e,modification:f,comment:g,file:a})});if(b.changes.length>0){var a=JSON.stringify(b),a="data="+encodeURIComponent(a);this.saveLabel.show();$.ajax({url:ig.LANG_EDIT_SUBMIT_URL,
type:"POST",dataType:"json",async:true,data:a,success:this._saveResponse.bind(this),error:this._saveResponse.bind(this)})}else this.closeMask()},_saveResponse:function(b){this.saveLabel.hide();console.log(b);if(b.success!==true){b.responseText?this.errorLabel.find("div").text(b.responseText):this.errorLabel.find("div").text("No response?");this.errorLabel.show()}else this.closeMask()},levelLoadStartOrder:-100,onLevelLoadStart:function(){this.mapEntries.length=0;this.recentEntries.length=0;this.mapEntryList=
null}});ig.addGameAddon(function(){return ig.langEdit=new ig.LangEdit})});ig.baked=!0;ig.module("impact.feature.lang-edit.plug-in").requires("impact.feature.lang-edit.lang-edit").defines(function(){});ig.baked=!0;ig.module("game.beta").requires("game.feature.beta.plug-in","impact.feature.lang-edit.plug-in").defines(function(){});ig.baked=!0;
ig.module("game.main").requires("impact.base.game","game.config","game.features","game.beta").defines(function(){sc.EmptyLoader=ig.Loader.extend({draw:function(){}});sc.START_MODE={STORY:0,GRINDING:1,PUZZLE:2,NEW_GAME_PLUS:3};sc.CrossCode=ig.Game.extend({mapLoader:sc.EmptyLoader,gravity:800,shadowImage:new ig.Image("media/entity/shadow.png"),transitionTimer:0,currentTeleportColor:{r:0,g:0,b:0},teleportColor:{r:0,g:0,b:0,lighter:false,timeIn:0.3,timeOut:0.3},effects:{dust:new ig.EffectSheet("dust"),
teleport:new ig.EffectSheet("teleport"),npc:new ig.EffectSheet("npc"),death:new ig.EffectSheet("combatant"),speedlines:new ig.EffectSheet("speedlines"),drops:new ig.EffectSheet("drops")},sounds:{popup:new ig.Sound("media/sound/hud/popup.ogg",0.8)},_slotToLoad:0,_startMode:sc.START_MODE.STORY,_teleportMessages:[],init:function(){this.parent();sc.version.hasVersionChanged()&&sc.version.saveCurrentVersion();sc.options.keyBinder.initBindings();ig.input.bind(ig.KEY.MOUSE1,"aim");ig.input.bind(ig.KEY.MOUSE2,
"dash");ig.input.bind(ig.KEY.MWHEEL_UP,"scrollUp");ig.input.bind(ig.KEY.MWHEEL_DOWN,"scrollDown");ig.input.bind(ig.KEY.F8,"snapshot");ig.input.bind(ig.KEY.F7,"langedit");ig.input.bind(ig.KEY.F10,"savedialog");ig.platform==ig.PLATFORM_TYPES.DESKTOP&&ig.input.bind(ig.KEY.F11,"fullscreen");window.IG_GAME_DEBUG&&ig.JSON_LOG&&ig.game.printGameAddonsString();ig.gui.addGuiElement(new sc.MasterOverlayGui);ig.gui.addGuiElement(new sc.TitleScreenGui);ig.gui.addGuiElement(new sc.LoadingScreenGui);ig.gui.addGuiElement(new ig.MessageOverlayGui);
sc.gui={};sc.gui.statusHud=new sc.StatusHudGui;ig.gui.addGuiElement(sc.gui.statusHud);ig.gui.addGuiElement(new sc.CombatHudGui);ig.gui.addGuiElement(new sc.ElementalLoadOverlayGui);ig.gui.addGuiElement(new sc.ElementHudGui);ig.gui.addGuiElement(new sc.SpChangeHudGui);ig.gui.addGuiElement(new sc.SideMessageHudGui);ig.gui.addGuiElement(new sc.MainMenu);ig.gui.addGuiElement(new sc.QuickMenu);ig.gui.addGuiElement(new sc.PauseScreenGui);window.testGui=new sc.TopMsgHudGui;ig.gui.addGuiElement(window.testGui);
sc.gui.rightHudPanel=new sc.RightHudGui;sc.gui.taskHud=new sc.TaskHudBox;sc.gui.moneyHud=new sc.MoneyHudBox;sc.gui.itemHud=new sc.ItemHudBox;sc.gui.featHud=new sc.FeatHud;sc.gui.questHud=new sc.FavQuestHud;sc.gui.questTaskHud=new sc.QuestUpdateHud;sc.gui.landmarkHud=new sc.LandmarkHud;sc.gui.loreHud=new sc.LoreUpdateHud;sc.gui.dropHud=new sc.DropUpdateHud;sc.gui.rightHudPanel.addHudBox(sc.gui.taskHud);sc.gui.rightHudPanel.addHudBox(sc.gui.questHud);sc.gui.rightHudPanel.addHudBox(sc.gui.questTaskHud);
sc.gui.rightHudPanel.addHudBox(sc.gui.landmarkHud);sc.gui.rightHudPanel.addHudBox(sc.gui.loreHud);sc.gui.rightHudPanel.addHudBox(sc.gui.dropHud);sc.gui.rightHudPanel.addHudBox(sc.gui.featHud);sc.gui.rightHudPanel.addHudBox(sc.gui.moneyHud);sc.gui.rightHudPanel.addHudBox(sc.gui.itemHud);ig.gui.addGuiElement(sc.gui.rightHudPanel);ig.overlay.setColor(0,0,0,1,0);sc.gamesense.addController(new sc.GameSenseHPController);sc.gamesense.addController(new sc.GameSenseElementController);ig.storage.setAutoSaveCondCallback(function(b){return b==
"NEW"||b=="LOAD"?false:!sc.model.isSaveBlocked()});ig.storage.setCheckpointCondCallback(function(){return!sc.model.isCheckpointBlocked()});this.physics.groundDangerCallback=function(b){b=ig.terrain.getMapTerrain(b.pos.x+b.size.x/2,b.pos.y+b.size.y/2,b.level,0,0);return ig.terrain.isFallTerrain(b)?true:false};this.physics.groundEntityDangerCallback=function(b){return ig.terrain.isFallTerrain(b.entity.terrain)?true:false}},onGameLoopStart:function(){window.IG_LOAD_SLOT!=void 0?this.loadStart(window.IG_LOAD_SLOT):
window.SC_SKIP_TITLE?this.start():sc.model.enterTitle()},update:function(){if(this.transitionTimer>0){this.transitionTimer=this.transitionTimer-ig.system.actualTick;this.transitionTimer<=0&&this.transitionEnded()}this.parent()},draw:function(){this.parent()},getVersion:function(){return sc.version.toString()},addTeleportMessage:function(b){this._teleportMessages.push(b)},start:function(b,a){this._startMode=b!=void 0?b:sc.START_MODE.STORY;sc.model.enterNewGame();sc.model.enterGame();this.transitionTimer=
a||0.3},loadStart:function(b){this._slotToLoad=b||0;sc.model.enterLoadGame();sc.model.enterGame();this.transitionTimer=0.3},gotoTitle:function(){this.setTeleportColor(0,0,0,false);this.currentTeleportColor.r=0;this.currentTeleportColor.g=0;this.currentTeleportColor.b=0;this.transitionTimer=0.8;sc.model.enterReset()},transitionEnded:function(){switch(sc.model.currentSubState){case sc.GAME_MODEL_SUBSTATE.NEWGAME:sc.Debug&&sc.Debug.onNewGame();if(this._startMode==sc.START_MODE.GRINDING)this.teleport("rookie-harbor.west",
new ig.TeleportPosition("start"),"NEW");else if(this._startMode==sc.START_MODE.PUZZLE)this.teleport("rhombus-dng.entrance",new ig.TeleportPosition("start"),"NEW");else if(this._startMode==sc.START_MODE.NEW_GAME_PLUS)this.teleport("newgame",new ig.TeleportPosition("start"),"NEW");else if(window.LOAD_LEVEL_ON_GAME_START){var b=window.MARKER_ON_GAME_START,b=b?new ig.TeleportPosition(b):null;this.teleport(window.LOAD_LEVEL_ON_GAME_START,b,"NEW")}else this.teleport("hideout.entrance",new ig.TeleportPosition("start"),
"NEW");break;case sc.GAME_MODEL_SUBSTATE.RESET:sc.model.enterRunning();ig.game.reset();sc.model.enterTitle();break;case sc.GAME_MODEL_SUBSTATE.LOADGAME:ig.storage.loadSlot(this._slotToLoad)}},hardReset:function(){sc.model.enterRunning();ig.game.reset()},reloadCheckpoint:function(){this.setTeleportTime(1,0.3);ig.storage.loadCheckpoint()},reloadAutosave:function(){this.setTeleportTime(1,0.3);ig.storage.loadAutosave()},respawn:function(){sc.combat.effects.combat.spawnFixed("playerDefeat",0,0,0).setIgnoreSlowdown();
var b=new ig.Event({steps:[{type:"ADD_SLOW_MOTION",factor:0.001,time:0,name:"playerRespawn"},{type:"SET_ZOOM_BLUR",zoomType:"MEDIUM",fadeIn:0.5,duration:1,fadeOut:1},{type:"SET_CAMERA_TARGET",entity:ig.game.playerEntity,speed:0.1,transition:"EASE_OUT",zoom:1},{type:"WAIT",time:0.3,ignoreSlowDown:true},{type:"CLEAR_SLOW_MOTION",name:"playerRespawn",time:0.4},{type:"ADD_SLOW_MOTION",factor:0.05,time:0.8},{type:"SET_CAMERA_ZOOM",zoom:3,duration:2,transition:"EASE_IN"},{type:"WAIT",time:0.2,ignoreSlowDown:true},
{type:"WAIT",time:0.5,ignoreSlowDown:true},{type:"SET_OVERLAY_CORNER",alpha:0,time:0.5,color:"RED"},{type:"SET_OVERLAY",alpha:1,time:0.5,color:"white"},{type:"WAIT",time:1,ignoreSlowDown:true},{type:"ADD_SLOW_MOTION",factor:0,time:0},{type:"SET_OVERLAY",alpha:1,time:0.5,color:"black"},{type:"WAIT",time:1,ignoreSlowDown:true},{type:"LOAD"}]});this.events.callEvent(b,ig.EventRunType.BLOCKING)},isEventStartReady:function(){return this.playerEntity&&this.playerEntity.isDefeated()&&!this.playerEntity.manualKill&&
!sc.pvp.isActive()?false:true},setTeleportColor:function(b,a,d,c){this.teleportColor.r=b;this.teleportColor.g=a;this.teleportColor.b=d;this.teleportColor.lighter=c},setTeleportTime:function(b,a){this.teleportColor.timeIn=b;this.teleportColor.timeOut=a},onTeleportStart:function(){ig.overlay.setColor(this.teleportColor.r,this.teleportColor.g,this.teleportColor.b,1,this.teleportColor.timeIn,this.teleportColor.lighter);this.currentTeleportColor.r=this.teleportColor.r;this.currentTeleportColor.g=this.teleportColor.g;
this.currentTeleportColor.b=this.teleportColor.b;this.teleportColor.r=0;this.teleportColor.g=0;this.teleportColor.b=0;this.teleportColor.lighter=false;sc.model.enterTeleport();return this.teleportColor.timeIn},onTeleportEnd:function(){sc.model.enterLoading()},createPlayer:function(){var b=this.getEntitiesByType(ig.ENTITY.Player)[0];b||(b=this.spawnEntity(ig.ENTITY.Player,0,0,0));this.playerEntity=b},getErrorData:function(b){b.save=ig.storage.getAutoSlotData()},loadLevel:function(b,a,d){if(ig.storage.resetAfterTeleport){sc.model.player.regenerate();
ig.storage.resetAfterTeleport=false}sc.model.isCutscene()&&sc.model.enterGame();this.parent(b,a,d)},loadingComplete:function(){this.parent();this.handleLoadingComplete()},handleLoadingComplete:function(){if(this._teleportMessages.length>0){ig.game.setPaused(true);var b=this._teleportMessages.pop();this.sounds.popup.play();sc.Dialogs.showInfoDialog(b,true,this.handleLoadingComplete.bind(this));this.hasTeleportMessageShown=true}else{this.hasTeleportMessageShown=false;sc.model.enterRunning();ig.overlay.setAlpha(0,
this.teleportColor.timeOut);this.teleportColor.timeOut=0.3;this.teleportColor.timeIn=0.3;if(!sc.commonEvents.triggerEvent("FORCE_UPDATE",{})){if(!this.playerEntity.hasAction()){b=new ig.Event({steps:[{type:"DO_ACTION",entity:this.playerEntity,action:[{type:"WAIT",time:0.1},{type:"WAIT_UNTIL_ON_GROUND"}]}]});ig.game.events.callEvent(b,ig.EventRunType.BLOCKING)}sc.commonEvents.triggerEvent("MAP_ENTERED",{})}}}});window.startCrossCode=function(){window.IG_GAME_DEBUG&&sc.Debug.gameStart();ig.main("#canvas",
"#game",sc.CrossCode,window.IG_GAME_FPS||60,window.IG_WIDTH,window.IG_HEIGHT,window.IG_GAME_SCALE,sc.StartLoader)}});
